;
(function () {
  function _typeof(o) { "@babel/helpers - typeof"; return _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && "function" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? "symbol" : typeof o; }, _typeof(o); }
  function _superPropGet(t, o, e, r) { var p = _get2(_getPrototypeOf(1 & r ? t.prototype : t), o, e); return 2 & r && "function" == typeof p ? function (t) { return p.apply(e, t); } : p; }
  function _get2() { return _get2 = "undefined" != typeof Reflect && Reflect.get ? Reflect.get.bind() : function (e, t, r) { var p = _superPropBase(e, t); if (p) { var n = Object.getOwnPropertyDescriptor(p, t); return n.get ? n.get.call(arguments.length < 3 ? e : r) : n.value; } }, _get2.apply(null, arguments); }
  function _superPropBase(t, o) { for (; !{}.hasOwnProperty.call(t, o) && null !== (t = _getPrototypeOf(t));); return t; }
  function _wrapNativeSuper(t) { var r = "function" == typeof Map ? new Map() : void 0; return _wrapNativeSuper = function _wrapNativeSuper(t) { if (null === t || !_isNativeFunction(t)) return t; if ("function" != typeof t) throw new TypeError("Super expression must either be null or a function"); if (void 0 !== r) { if (r.has(t)) return r.get(t); r.set(t, Wrapper); } function Wrapper() { return _construct(t, arguments, _getPrototypeOf(this).constructor); } return Wrapper.prototype = Object.create(t.prototype, { constructor: { value: Wrapper, enumerable: !1, writable: !0, configurable: !0 } }), _setPrototypeOf(Wrapper, t); }, _wrapNativeSuper(t); }
  function _construct(t, e, r) { if (_isNativeReflectConstruct()) return Reflect.construct.apply(null, arguments); var o = [null]; o.push.apply(o, e); var p = new (t.bind.apply(t, o))(); return r && _setPrototypeOf(p, r.prototype), p; }
  function _isNativeFunction(t) { try { return -1 !== Function.toString.call(t).indexOf("[native code]"); } catch (n) { return "function" == typeof t; } }
  function ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }
  function _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }
  function _slicedToArray(r, e) { return _arrayWithHoles(r) || _iterableToArrayLimit(r, e) || _unsupportedIterableToArray(r, e) || _nonIterableRest(); }
  function _nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
  function _iterableToArrayLimit(r, l) { var t = null == r ? null : "undefined" != typeof Symbol && r[Symbol.iterator] || r["@@iterator"]; if (null != t) { var e, n, i, u, a = [], f = !0, o = !1; try { if (i = (t = t.call(r)).next, 0 === l) { if (Object(t) !== t) return; f = !1; } else for (; !(f = (e = i.call(t)).done) && (a.push(e.value), a.length !== l); f = !0); } catch (r) { o = !0, n = r; } finally { try { if (!f && null != t.return && (u = t.return(), Object(u) !== u)) return; } finally { if (o) throw n; } } return a; } }
  function _arrayWithHoles(r) { if (Array.isArray(r)) return r; }
  function _regenerator() { /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */ var e, t, r = "function" == typeof Symbol ? Symbol : {}, n = r.iterator || "@@iterator", o = r.toStringTag || "@@toStringTag"; function i(r, n, o, i) { var c = n && n.prototype instanceof Generator ? n : Generator, u = Object.create(c.prototype); return _regeneratorDefine2(u, "_invoke", function (r, n, o) { var i, c, u, f = 0, p = o || [], y = !1, G = { p: 0, n: 0, v: e, a: d, f: d.bind(e, 4), d: function d(t, r) { return i = t, c = 0, u = e, G.n = r, a; } }; function d(r, n) { for (c = r, u = n, t = 0; !y && f && !o && t < p.length; t++) { var o, i = p[t], d = G.p, l = i[2]; r > 3 ? (o = l === n) && (u = i[(c = i[4]) ? 5 : (c = 3, 3)], i[4] = i[5] = e) : i[0] <= d && ((o = r < 2 && d < i[1]) ? (c = 0, G.v = n, G.n = i[1]) : d < l && (o = r < 3 || i[0] > n || n > l) && (i[4] = r, i[5] = n, G.n = l, c = 0)); } if (o || r > 1) return a; throw y = !0, n; } return function (o, p, l) { if (f > 1) throw TypeError("Generator is already running"); for (y && 1 === p && d(p, l), c = p, u = l; (t = c < 2 ? e : u) || !y;) { i || (c ? c < 3 ? (c > 1 && (G.n = -1), d(c, u)) : G.n = u : G.v = u); try { if (f = 2, i) { if (c || (o = "next"), t = i[o]) { if (!(t = t.call(i, u))) throw TypeError("iterator result is not an object"); if (!t.done) return t; u = t.value, c < 2 && (c = 0); } else 1 === c && (t = i.return) && t.call(i), c < 2 && (u = TypeError("The iterator does not provide a '" + o + "' method"), c = 1); i = e; } else if ((t = (y = G.n < 0) ? u : r.call(n, G)) !== a) break; } catch (t) { i = e, c = 1, u = t; } finally { f = 1; } } return { value: t, done: y }; }; }(r, o, i), !0), u; } var a = {}; function Generator() {} function GeneratorFunction() {} function GeneratorFunctionPrototype() {} t = Object.getPrototypeOf; var c = [][n] ? t(t([][n]())) : (_regeneratorDefine2(t = {}, n, function () { return this; }), t), u = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(c); function f(e) { return Object.setPrototypeOf ? Object.setPrototypeOf(e, GeneratorFunctionPrototype) : (e.__proto__ = GeneratorFunctionPrototype, _regeneratorDefine2(e, o, "GeneratorFunction")), e.prototype = Object.create(u), e; } return GeneratorFunction.prototype = GeneratorFunctionPrototype, _regeneratorDefine2(u, "constructor", GeneratorFunctionPrototype), _regeneratorDefine2(GeneratorFunctionPrototype, "constructor", GeneratorFunction), GeneratorFunction.displayName = "GeneratorFunction", _regeneratorDefine2(GeneratorFunctionPrototype, o, "GeneratorFunction"), _regeneratorDefine2(u), _regeneratorDefine2(u, o, "Generator"), _regeneratorDefine2(u, n, function () { return this; }), _regeneratorDefine2(u, "toString", function () { return "[object Generator]"; }), (_regenerator = function _regenerator() { return { w: i, m: f }; })(); }
  function _regeneratorDefine2(e, r, n, t) { var i = Object.defineProperty; try { i({}, "", {}); } catch (e) { i = 0; } _regeneratorDefine2 = function _regeneratorDefine(e, r, n, t) { function o(r, n) { _regeneratorDefine2(e, r, function (e) { return this._invoke(r, n, e); }); } r ? i ? i(e, r, { value: n, enumerable: !t, configurable: !t, writable: !t }) : e[r] = n : (o("next", 0), o("throw", 1), o("return", 2)); }, _regeneratorDefine2(e, r, n, t); }
  function asyncGeneratorStep(n, t, e, r, o, a, c) { try { var i = n[a](c), u = i.value; } catch (n) { return void e(n); } i.done ? t(u) : Promise.resolve(u).then(r, o); }
  function _asyncToGenerator(n) { return function () { var t = this, e = arguments; return new Promise(function (r, o) { var a = n.apply(t, e); function _next(n) { asyncGeneratorStep(a, r, o, _next, _throw, "next", n); } function _throw(n) { asyncGeneratorStep(a, r, o, _next, _throw, "throw", n); } _next(void 0); }); }; }
  function _callSuper(t, o, e) { return o = _getPrototypeOf(o), _possibleConstructorReturn(t, _isNativeReflectConstruct() ? Reflect.construct(o, e || [], _getPrototypeOf(t).constructor) : o.apply(t, e)); }
  function _possibleConstructorReturn(t, e) { if (e && ("object" == _typeof(e) || "function" == typeof e)) return e; if (void 0 !== e) throw new TypeError("Derived constructors may only return object or undefined"); return _assertThisInitialized(t); }
  function _assertThisInitialized(e) { if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return e; }
  function _isNativeReflectConstruct() { try { var t = !Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); } catch (t) {} return (_isNativeReflectConstruct = function _isNativeReflectConstruct() { return !!t; })(); }
  function _getPrototypeOf(t) { return _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function (t) { return t.__proto__ || Object.getPrototypeOf(t); }, _getPrototypeOf(t); }
  function _inherits(t, e) { if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function"); t.prototype = Object.create(e && e.prototype, { constructor: { value: t, writable: !0, configurable: !0 } }), Object.defineProperty(t, "prototype", { writable: !1 }), e && _setPrototypeOf(t, e); }
  function _setPrototypeOf(t, e) { return _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function (t, e) { return t.__proto__ = e, t; }, _setPrototypeOf(t, e); }
  function _toConsumableArray(r) { return _arrayWithoutHoles(r) || _iterableToArray(r) || _unsupportedIterableToArray(r) || _nonIterableSpread(); }
  function _nonIterableSpread() { throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
  function _iterableToArray(r) { if ("undefined" != typeof Symbol && null != r[Symbol.iterator] || null != r["@@iterator"]) return Array.from(r); }
  function _arrayWithoutHoles(r) { if (Array.isArray(r)) return _arrayLikeToArray(r); }
  function _classCallCheck(a, n) { if (!(a instanceof n)) throw new TypeError("Cannot call a class as a function"); }
  function _defineProperties(e, r) { for (var t = 0; t < r.length; t++) { var o = r[t]; o.enumerable = o.enumerable || !1, o.configurable = !0, "value" in o && (o.writable = !0), Object.defineProperty(e, _toPropertyKey(o.key), o); } }
  function _createClass(e, r, t) { return r && _defineProperties(e.prototype, r), t && _defineProperties(e, t), Object.defineProperty(e, "prototype", { writable: !1 }), e; }
  function _defineProperty(e, r, t) { return (r = _toPropertyKey(r)) in e ? Object.defineProperty(e, r, { value: t, enumerable: !0, configurable: !0, writable: !0 }) : e[r] = t, e; }
  function _toPropertyKey(t) { var i = _toPrimitive(t, "string"); return "symbol" == _typeof(i) ? i : i + ""; }
  function _toPrimitive(t, r) { if ("object" != _typeof(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || "default"); if ("object" != _typeof(i)) return i; throw new TypeError("@@toPrimitive must return a primitive value."); } return ("string" === r ? String : Number)(t); }
  function _createForOfIteratorHelper(r, e) { var t = "undefined" != typeof Symbol && r[Symbol.iterator] || r["@@iterator"]; if (!t) { if (Array.isArray(r) || (t = _unsupportedIterableToArray(r)) || e && r && "number" == typeof r.length) { t && (r = t); var _n3 = 0, F = function F() {}; return { s: F, n: function n() { return _n3 >= r.length ? { done: !0 } : { done: !1, value: r[_n3++] }; }, e: function e(r) { throw r; }, f: F }; } throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); } var o, a = !0, u = !1; return { s: function s() { t = t.call(r); }, n: function n() { var r = t.next(); return a = r.done, r; }, e: function e(r) { u = !0, o = r; }, f: function f() { try { a || null == t.return || t.return(); } finally { if (u) throw o; } } }; }
  function _unsupportedIterableToArray(r, a) { if (r) { if ("string" == typeof r) return _arrayLikeToArray(r, a); var t = {}.toString.call(r).slice(8, -1); return "Object" === t && r.constructor && (t = r.constructor.name), "Map" === t || "Set" === t ? Array.from(r) : "Arguments" === t || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t) ? _arrayLikeToArray(r, a) : void 0; } }
  function _arrayLikeToArray(r, a) { (null == a || a > r.length) && (a = r.length); for (var e = 0, n = Array(a); e < a; e++) n[e] = r[e]; return n; }
  System.register([], function (exports, module) {
    'use strict';

    return {
      execute: function execute() {
        var _LinearGradientEffect, _RadialGradientEffect, _resolvedGlobal$docum;
        var __vite_style__ = document.createElement('style');
        __vite_style__.textContent = "html,\nbody,\n* {\n  padding: 0;\n  margin: 0;\n}\nhtml,\nbody {\n  height: 100%;\n  overflow: hidden;\n}\nvideo {\n  position: absolute;\n  top: 0;\n  left: 0;\n  z-index: 2;\n  outline: none;\n}\n.center-element {\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n}\n/*$vite$:1*/";
        document.head.appendChild(__vite_style__);
        exports({
          $: chainFunctions,
          B: assertTruthy,
          D: hexColor,
          F: For,
          G: combineStyles,
          H: onCleanup,
          I: Index,
          J: Block,
          K: untrack,
          L: LazyRow,
          M: createRoot,
          N: Dynamic,
          O: Button,
          P: Poster,
          S: Show,
          W: TileRow,
          Y: getImageUrl,
          Z: convertItemsToTiles,
          a: createResource,
          a0: Switch,
          a1: Match,
          a2: LazyColumn,
          a3: TitleRow,
          a6: getOwner,
          a9: Suspense,
          b: createComputed,
          c: createSignal,
          d: batch,
          e: createSelector,
          f: createEffect,
          g: onMount,
          i: List,
          j: createMemo,
          o: on,
          x: useFocusStack,
          y: children
        });
        false              && function polyfill() {
          var relList = document.createElement("link").relList;
          if (relList && relList.supports && relList.supports("modulepreload")) return;
          var _iterator = _createForOfIteratorHelper(document.querySelectorAll("link[rel=\"modulepreload\"]")),
            _step;
          try {
            for (_iterator.s(); !(_step = _iterator.n()).done;) {
              var link = _step.value;
              processPreload(link);
            }
          } catch (err) {
            _iterator.e(err);
          } finally {
            _iterator.f();
          }
          new MutationObserver(function (mutations) {
            var _iterator2 = _createForOfIteratorHelper(mutations),
              _step2;
            try {
              for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {
                var mutation = _step2.value;
                if (mutation.type !== "childList") continue;
                var _iterator3 = _createForOfIteratorHelper(mutation.addedNodes),
                  _step3;
                try {
                  for (_iterator3.s(); !(_step3 = _iterator3.n()).done;) {
                    var node = _step3.value;
                    if (node.tagName === "LINK" && node.rel === "modulepreload") processPreload(node);
                  }
                } catch (err) {
                  _iterator3.e(err);
                } finally {
                  _iterator3.f();
                }
              }
            } catch (err) {
              _iterator2.e(err);
            } finally {
              _iterator2.f();
            }
          }).observe(document, {
            childList: true,
            subtree: true
          });
          function getFetchOpts(link) {
            var fetchOpts = {};
            if (link.integrity) fetchOpts.integrity = link.integrity;
            if (link.referrerPolicy) fetchOpts.referrerPolicy = link.referrerPolicy;
            if (link.crossOrigin === "use-credentials") fetchOpts.credentials = "include";else if (link.crossOrigin === "anonymous") fetchOpts.credentials = "omit";else fetchOpts.credentials = "same-origin";
            return fetchOpts;
          }
          function processPreload(link) {
            if (link.ep) return;
            link.ep = true;
            var fetchOpts = getFetchOpts(link);
            fetch(link.href, fetchOpts);
          }
        }();
        var scriptRel = 'modulepreload';
        var assetsURL = function assetsURL(dep) {
          return "/solid-demo-app/" + dep;
        };
        var seen = {};
        var __vitePreload = function preload(baseModule, deps, importerUrl) {
          var promise = Promise.resolve();
          if (false              && deps && deps.length > 0) {
            var allSettled = function allSettled(promises$2) {
              return Promise.all(promises$2.map(function (p) {
                return Promise.resolve(p).then(function (value$1) {
                  return {
                    status: "fulfilled",
                    value: value$1
                  };
                }, function (reason) {
                  return {
                    status: "rejected",
                    reason: reason
                  };
                });
              }));
            };
            document.getElementsByTagName("link");
            var cspNonceMeta = document.querySelector("meta[property=csp-nonce]");
            var cspNonce = (cspNonceMeta === null || cspNonceMeta === void 0 ? void 0 : cspNonceMeta.nonce) || (cspNonceMeta === null || cspNonceMeta === void 0 ? void 0 : cspNonceMeta.getAttribute("nonce"));
            promise = allSettled(deps.map(function (dep) {
              dep = assetsURL(dep);
              if (dep in seen) return;
              seen[dep] = true;
              var isCss = dep.endsWith(".css");
              var cssSelector = isCss ? "[rel=\"stylesheet\"]" : "";
              if (document.querySelector("link[href=\"".concat(dep, "\"]").concat(cssSelector))) return;
              var link = document.createElement("link");
              link.rel = isCss ? "stylesheet" : scriptRel;
              if (!isCss) link.as = "script";
              link.crossOrigin = "";
              link.href = dep;
              if (cspNonce) link.setAttribute("nonce", cspNonce);
              document.head.appendChild(link);
              if (isCss) return new Promise(function (res, rej) {
                link.addEventListener("load", res);
                link.addEventListener("error", function () {
                  return rej(/* @__PURE__ */new Error("Unable to preload CSS for ".concat(dep)));
                });
              });
            }));
          }
          function handlePreloadError(err$2) {
            var e$1 = new Event("vite:preloadError", {
              cancelable: true
            });
            e$1.payload = err$2;
            window.dispatchEvent(e$1);
            if (!e$1.defaultPrevented) throw err$2;
          }
          return promise.then(function (res) {
            var _iterator4 = _createForOfIteratorHelper(res || []),
              _step4;
            try {
              for (_iterator4.s(); !(_step4 = _iterator4.n()).done;) {
                var item = _step4.value;
                if (item.status !== "rejected") continue;
                handlePreloadError(item.reason);
              }
            } catch (err) {
              _iterator4.e(err);
            } finally {
              _iterator4.f();
            }
            return baseModule().catch(handlePreloadError);
          });
        };
        var __vite_import_meta_env__$1 = {
          "BASE_URL": "/solid-demo-app/",
          "DEV": false,
          "LEGACY": true,
          "MODE": "production",
          "PROD": true,
          "SSR": false
        };
        function createWebGLContext(canvas) {
          var forceWebGL2 = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;
          var contextSpy = arguments.length > 2 ? arguments[2] : undefined;
          var config = {
            alpha: true,
            antialias: false,
            depth: false,
            stencil: true,
            desynchronized: false,
            // Disabled because it prevents Visual Regression Tests from working
            // failIfMajorPerformanceCaveat: true,
            powerPreference: "high-performance",
            premultipliedAlpha: true,
            preserveDrawingBuffer: false
          };
          var gl =
          // TODO: Remove this assertion once this issue is fixed in TypeScript
          // https://github.com/microsoft/TypeScript/issues/53614
          canvas.getContext(forceWebGL2 ? "webgl2" : "webgl", config) || canvas.getContext("experimental-webgl", config);
          if (!gl) {
            throw new Error("Unable to create WebGL context");
          }
          if (contextSpy) {
            return new Proxy(gl, {
              get: function get(target, prop) {
                var value = target[prop];
                if (typeof value === "function") {
                  contextSpy.increment(String(prop));
                  return value.bind(target);
                }
                return value;
              }
            });
          }
          return gl;
        }
        function assertTruthy(condition, message) {
          if (isProductionEnvironment() === true) return;
          if (!condition) {
            throw new Error(message || "Assertion failed");
          }
        }
        function mergeColorProgress$1(rgba1, rgba2, p) {
          var r1 = Math.trunc(rgba1 >>> 24);
          var g1 = Math.trunc(rgba1 >>> 16 & 255);
          var b1 = Math.trunc(rgba1 >>> 8 & 255);
          var a1 = Math.trunc(rgba1 & 255);
          var r2 = Math.trunc(rgba2 >>> 24);
          var g2 = Math.trunc(rgba2 >>> 16 & 255);
          var b2 = Math.trunc(rgba2 >>> 8 & 255);
          var a2 = Math.trunc(rgba2 & 255);
          var r = Math.round(r2 * p + r1 * (1 - p));
          var g = Math.round(g2 * p + g1 * (1 - p));
          var b = Math.round(b2 * p + b1 * (1 - p));
          var a = Math.round(a2 * p + a1 * (1 - p));
          return (r << 24 | g << 16 | b << 8 | a) >>> 0;
        }
        function mergeColorAlpha(rgba, alpha) {
          var r = rgba >>> 24;
          var g = rgba >>> 16 & 255;
          var b = rgba >>> 8 & 255;
          var a = Math.trunc((rgba & 255) * alpha);
          return (r << 24 | g << 16 | b << 8 | a) >>> 0;
        }
        var premultiplyRGB = true;
        function setPremultiplyMode(mode) {
          premultiplyRGB = mode === "webgl";
        }
        function mergeColorAlphaPremultiplied(rgba, alpha) {
          var flipEndianess = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;
          var newAlpha = (rgba & 255) / 255 * alpha;
          var rgbAlpha = premultiplyRGB ? newAlpha : 1;
          var r = Math.trunc((rgba >>> 24) * rgbAlpha);
          var g = Math.trunc((rgba >>> 16 & 255) * rgbAlpha);
          var b = Math.trunc((rgba >>> 8 & 255) * rgbAlpha);
          var a = Math.trunc(newAlpha * 255);
          if (flipEndianess) {
            return (a << 24 | b << 16 | g << 8 | r) >>> 0;
          }
          return (r << 24 | g << 16 | b << 8 | a) >>> 0;
        }
        function hasOwn(obj, prop) {
          return Object.prototype.hasOwnProperty.call(obj, prop);
        }
        function isProductionEnvironment() {
          return __vite_import_meta_env__$1 && true;
        }
        var nextId = 1;
        function getNewId() {
          return nextId++;
        }

        /*
         * If not stated otherwise in this file or this component's LICENSE file the
         * following copyright and licenses apply:
         *
         * Copyright 2023 Comcast Cable Communications Management, LLC.
         *
         * Licensed under the Apache License, Version 2.0 (the License);
         * you may not use this file except in compliance with the License.
         * You may obtain a copy of the License at
         *
         * http://www.apache.org/licenses/LICENSE-2.0
         *
         * Unless required by applicable law or agreed to in writing, software
         * distributed under the License is distributed on an "AS IS" BASIS,
         * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
         * See the License for the specific language governing permissions and
         * limitations under the License.
         */
        /**
         * EventEmitter base class
         */
        var EventEmitter = /*#__PURE__*/function () {
          function EventEmitter() {
            _classCallCheck(this, EventEmitter);
            _defineProperty(this, "eventListeners", {});
          }
          return _createClass(EventEmitter, [{
            key: "on",
            value: function on(event, listener) {
              var listeners = this.eventListeners[event];
              if (!listeners) {
                listeners = [];
              }
              listeners.push(listener);
              this.eventListeners[event] = listeners;
            }
          }, {
            key: "off",
            value: function off(event, listener) {
              var listeners = this.eventListeners[event];
              if (!listeners) {
                return;
              }
              if (!listener) {
                delete this.eventListeners[event];
                return;
              }
              var index = listeners.indexOf(listener);
              if (index >= 0) {
                listeners.splice(index, 1);
              }
            }
          }, {
            key: "once",
            value: function once(event, listener) {
              var _this = this;
              var _onceListener = function onceListener(target, data) {
                _this.off(event, _onceListener);
                listener(target, data);
              };
              this.on(event, _onceListener);
            }
          }, {
            key: "emit",
            value: function emit(event, data) {
              var _this2 = this;
              var listeners = this.eventListeners[event];
              if (!listeners) {
                return;
              }
              _toConsumableArray(listeners).forEach(function (listener) {
                listener(_this2, data);
              });
            }
          }, {
            key: "removeAllListeners",
            value: function removeAllListeners() {
              this.eventListeners = {};
            }
          }]);
        }();
        /*
         * If not stated otherwise in this file or this component's LICENSE file the
         * following copyright and licenses apply:
         *
         * Copyright 2023 Comcast Cable Communications Management, LLC.
         *
         * Licensed under the Apache License, Version 2.0 (the License);
         * you may not use this file except in compliance with the License.
         * You may obtain a copy of the License at
         *
         * http://www.apache.org/licenses/LICENSE-2.0
         *
         * Unless required by applicable law or agreed to in writing, software
         * distributed under the License is distributed on an "AS IS" BASIS,
         * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
         * See the License for the specific language governing permissions and
         * limitations under the License.
         */
        var TextureType;
        (function (TextureType) {
          TextureType[TextureType["generic"] = 0] = "generic";
          TextureType[TextureType["color"] = 1] = "color";
          TextureType[TextureType["image"] = 2] = "image";
          TextureType[TextureType["noise"] = 3] = "noise";
          TextureType[TextureType["renderToTexture"] = 4] = "renderToTexture";
          TextureType[TextureType["subTexture"] = 5] = "subTexture";
        })(TextureType || (TextureType = {}));
        /**
         * Represents a source of texture data for a CoreContextTexture.
         *
         * @remarks
         * Texture sources are used to populate a CoreContextTexture when that texture
         * is loaded. Texture data retrieved by the CoreContextTexture by the
         * `getTextureData` method. It's the responsibility of the concerete `Texture`
         * subclass to implement this method appropriately.
         */
        var Texture = /*#__PURE__*/function (_EventEmitter2) {
          // 2 seconds
          function Texture(txManager) {
            var _this3;
            _classCallCheck(this, Texture);
            _this3 = _callSuper(this, Texture);
            _defineProperty(_this3, "txManager", void 0);
            /**
             * The dimensions of the texture
             *
             * @remarks
             * Until the texture data is loaded for the first time the value will be
             * `null`.
             */
            _defineProperty(_this3, "_dimensions", null);
            _defineProperty(_this3, "_error", null);
            // aggregate state
            _defineProperty(_this3, "state", 'initial');
            _defineProperty(_this3, "renderableOwners", []);
            _defineProperty(_this3, "renderable", false);
            _defineProperty(_this3, "type", TextureType.generic);
            _defineProperty(_this3, "preventCleanup", false);
            _defineProperty(_this3, "ctxTexture", void 0);
            _defineProperty(_this3, "textureData", null);
            /**
             * Memory used by this texture in bytes
             *
             * @remarks
             * This is tracked by the TextureMemoryManager and updated when the texture
             * is loaded/freed. Set to 0 when texture is not loaded.
             */
            _defineProperty(_this3, "memUsed", 0);
            _defineProperty(_this3, "retryCount", 0);
            _defineProperty(_this3, "maxRetryCount", void 0);
            /**
             * Timestamp when texture was created (for startup grace period)
             */
            _defineProperty(_this3, "createdAt", Date.now());
            /**
             * Flag to track if grace period has expired to avoid repeated Date.now() calls
             */
            _defineProperty(_this3, "gracePeriodExpired", false);
            _this3.txManager = txManager;
            _this3.maxRetryCount = txManager.maxRetryCount;
            return _this3;
          }
          _inherits(Texture, _EventEmitter2);
          return _createClass(Texture, [{
            key: "dimensions",
            get: function get() {
              return this._dimensions;
            }
          }, {
            key: "error",
            get: function get() {
              return this._error;
            }
            /**
             * Checks if the texture is within the startup grace period.
             * During this period, textures are protected from cleanup to prevent
             * race conditions during app initialization.
             */
          }, {
            key: "isWithinStartupGracePeriod",
            value: function isWithinStartupGracePeriod() {
              // If grace period already expired, return false immediately
              if (this.gracePeriodExpired) {
                return false;
              }
              // Check if grace period has expired now
              var hasExpired = Date.now() - this.createdAt >= Texture.STARTUP_GRACE_PERIOD;
              if (hasExpired) {
                // Cache the result to avoid future Date.now() calls
                this.gracePeriodExpired = true;
                return false;
              }
              return true;
            }
            /**
             * Checks if the texture can be safely cleaned up.
             * Considers the renderable state, startup grace period, and renderable owners.
             */
          }, {
            key: "canBeCleanedUp",
            value: function canBeCleanedUp() {
              // Never cleanup if explicitly prevented
              if (this.preventCleanup) {
                return false;
              }
              // Don't cleanup if still within startup grace period
              if (this.isWithinStartupGracePeriod()) {
                return false;
              }
              // Don't cleanup if not renderable
              if (this.renderable === true) {
                return false;
              }
              // Don't cleanup if there are still renderable owners
              if (this.renderableOwners.length > 0) {
                return false;
              }
              // Safe to cleanup
              return true;
            }
            /**
             * Add/remove an owner to/from the Texture based on its renderability.
             *
             * @remarks
             * Any object can own a texture, be it a CoreNode or even the state object
             * from a Text Renderer.
             *
             * When the reference to the texture that an owner object holds is replaced
             * or cleared it must call this with `renderable=false` to release the owner
             * association.
             *
             * @param owner
             * @param renderable
             */
          }, {
            key: "setRenderableOwner",
            value: function setRenderableOwner(owner, renderable) {
              var oldSize = this.renderableOwners.length;
              var hasOwnerIndex = this.renderableOwners.indexOf(owner);
              if (renderable === true) {
                if (hasOwnerIndex === -1) {
                  // Add the owner to the set
                  this.renderableOwners.push(owner);
                }
                var newSize = this.renderableOwners.length;
                if (oldSize !== newSize && newSize === 1) {
                  var _this$onChangeIsRende;
                  this.renderable = true;
                  (_this$onChangeIsRende = this.onChangeIsRenderable) === null || _this$onChangeIsRende === void 0 || _this$onChangeIsRende.call(this, true);
                  this.load();
                }
              } else {
                if (hasOwnerIndex !== -1) {
                  this.renderableOwners.splice(hasOwnerIndex, 1);
                }
                var _newSize = this.renderableOwners.length;
                if (oldSize !== _newSize && _newSize === 0) {
                  var _this$onChangeIsRende2;
                  this.renderable = false;
                  (_this$onChangeIsRende2 = this.onChangeIsRenderable) === null || _this$onChangeIsRende2 === void 0 || _this$onChangeIsRende2.call(this, false);
                  // note, not doing a cleanup here, cleanup is managed by the Stage/TextureMemoryManager
                  // when it deems appropriate based on memory pressure
                }
              }
            }
          }, {
            key: "load",
            value: function load() {
              if (this.retryCount > this.maxRetryCount) {
                // We've exceeded the max retry count, do not attempt to load again
                return;
              }
              this.txManager.loadTexture(this);
            }
            /**
             * Load the core context texture for this Texture.
             * The ctxTexture is created by the renderer and lives on the GPU.
             *
             * @returns
             */
          }, {
            key: "loadCtxTexture",
            value: function loadCtxTexture() {
              if (this.ctxTexture === undefined) {
                this.ctxTexture = this.txManager.renderer.createCtxTexture(this);
              }
              return this.ctxTexture;
            }
            /**
             * Free the core context texture for this Texture.
             *
             * @remarks
             * The ctxTexture is created by the renderer and lives on the GPU.
             */
          }, {
            key: "free",
            value: function free() {
              var _this$ctxTexture;
              (_this$ctxTexture = this.ctxTexture) === null || _this$ctxTexture === void 0 || _this$ctxTexture.free();
            }
            /**
             * Release the texture data and core context texture for this Texture without changing state.
             *
             * @remarks
             * The ctxTexture is created by the renderer and lives on the GPU.
             */
          }, {
            key: "release",
            value: function release() {
              var _this$ctxTexture2;
              (_this$ctxTexture2 = this.ctxTexture) === null || _this$ctxTexture2 === void 0 || _this$ctxTexture2.release();
              this.ctxTexture = undefined;
              this.freeTextureData();
            }
            /**
             * Destroy the texture.
             *
             * @remarks
             * This method is called when the texture is no longer needed and should be
             * cleaned up.
             */
          }, {
            key: "destroy",
            value: function destroy() {
              // Only free GPU resources if we're in a state where they exist
              if (this.state === 'loaded') {
                this.free();
              }
              // Always free texture data regardless of state
              this.freeTextureData();
            }
            /**
             * Free the source texture data for this Texture.
             *
             * @remarks
             * The texture data is the source data that is used to populate the CoreContextTexture.
             * e.g. ImageData that is downloaded from a URL.
             */
          }, {
            key: "freeTextureData",
            value: function freeTextureData() {
              var _this4 = this;
              queueMicrotask(function () {
                _this4.textureData = null;
              });
            }
          }, {
            key: "setState",
            value: function setState(state, errorOrDimensions) {
              var _this5 = this;
              if (this.state === state) {
                return;
              }
              var payload = null;
              if (state === 'loaded') {
                // Clear any previous error when successfully loading
                this._error = null;
                if (errorOrDimensions !== undefined && 'width' in errorOrDimensions === true && 'height' in errorOrDimensions === true && errorOrDimensions.width !== undefined && errorOrDimensions.height !== undefined) {
                  this._dimensions = errorOrDimensions;
                }
                payload = this._dimensions;
              } else if (state === 'failed') {
                this._error = errorOrDimensions;
                payload = this._error;
                // increment the retry count for the texture
                // this is used to compare against maxRetryCount, if set
                // to determine if we should try loading again
                this.retryCount += 1;
                queueMicrotask(function () {
                  _this5.release();
                });
              } else if (state === 'loading') {
                // Clear error and reset dimensions when starting to load
                // This ensures stale dimensions from previous loads don't persist
                this._error = null;
                this._dimensions = null;
              } else {
                this._error = null;
              }
              // emit the new state
              this.state = state;
              this.emit(state, payload);
            }
            /**
             * Get the texture data for this texture.
             *
             * @remarks
             * This method is called by the CoreContextTexture when the texture is loaded.
             * The texture data is then used to populate the CoreContextTexture.
             *
             * @returns
             * The texture data for this texture.
             */
          }, {
            key: "getTextureData",
            value: (function () {
              var _getTextureData = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee() {
                return _regenerator().w(function (_context) {
                  while (1) switch (_context.n) {
                    case 0:
                      if (!(this.textureData === null)) {
                        _context.n = 2;
                        break;
                      }
                      _context.n = 1;
                      return this.getTextureSource();
                    case 1:
                      this.textureData = _context.v;
                    case 2:
                      return _context.a(2, this.textureData);
                  }
                }, _callee, this);
              }));
              function getTextureData() {
                return _getTextureData.apply(this, arguments);
              }
              return getTextureData;
            }()
            /**
             * Make a cache key for this texture.
             *
             * @remarks
             * Each concrete `Texture` subclass must implement this method to provide an
             * appropriate cache key for the texture type including the texture's
             * properties that uniquely identify a copy of the texture. If the texture
             * type does not support caching, then this method should return `false`.
             *
             * @param props
             * @returns
             * A cache key for this texture or `false` if the texture type does not
             * support caching.
             */
            // eslint-disable-next-line @typescript-eslint/no-unused-vars
            )
          }, {
            key: "retry",
            value:
            /**
             * Retry the texture by resetting retryCount and setting state to 'initial'.
             *
             * @remarks
             * This allows the texture to be loaded again.
             */
            function retry() {
              this.release();
              this.retryCount = 0;
              this.load();
            }
          }], [{
            key: "makeCacheKey",
            value: function makeCacheKey(props) {
              return false;
            }
            /**
             * Resolve the default values for the texture's properties.
             *
             * @remarks
             * Each concrete `Texture` subclass must implement this method to provide
             * default values for the texture's optional properties.
             *
             * @param props
             * @returns
             * The default values for the texture's properties.
             */
          }, {
            key: "resolveDefaults",
            value: function resolveDefaults(
            // eslint-disable-next-line @typescript-eslint/no-unused-vars
            props) {
              return {};
            }
          }]);
        }(EventEmitter);
        /*
         * If not stated otherwise in this file or this component's LICENSE file the
         * following copyright and licenses apply:
         *
         * Copyright 2023 Comcast Cable Communications Management, LLC.
         *
         * Licensed under the Apache License, Version 2.0 (the License);
         * you may not use this file except in compliance with the License.
         * You may obtain a copy of the License at
         *
         * http://www.apache.org/licenses/LICENSE-2.0
         *
         * Unless required by applicable law or agreed to in writing, software
         * distributed under the License is distributed on an "AS IS" BASIS,
         * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
         * See the License for the specific language governing permissions and
         * limitations under the License.
         */
        /**
         * Grace period in milliseconds to prevent premature cleanup during app startup
         * This helps prevent race conditions when bounds calculation is delayed
         */
        _defineProperty(Texture, "STARTUP_GRACE_PERIOD", 2000);
        var PROTOCOL_REGEX = /^(data|ftps?|https?):/;
        var getNormalizedRgbaComponents = function getNormalizedRgbaComponents(rgba) {
          var r = rgba >>> 24;
          var g = rgba >>> 16 & 0xff;
          var b = rgba >>> 8 & 0xff;
          var a = rgba & 0xff;
          return [r / 255, g / 255, b / 255, a / 255];
        };
        var getRgbaComponents = function getRgbaComponents(rgba) {
          var r = rgba >>> 24;
          var g = rgba >>> 16 & 0xff;
          var b = rgba >>> 8 & 0xff;
          var a = rgba & 0xff;
          return [r, g, b, a];
        };
        function getNormalizedAlphaComponent(rgba) {
          return (rgba & 0xff) / 255.0;
        }
        /**
         * Get a CSS color string from a RGBA color
         *
         * @param color
         * @returns
         */
        function getRgbaString(color) {
          var r = Math.floor(color[0] * 255.0);
          var g = Math.floor(color[1] * 255.0);
          var b = Math.floor(color[2] * 255.0);
          var a = Math.floor(color[3] * 255.0);
          return "rgba(".concat(r, ",").concat(g, ",").concat(b, ",").concat(a.toFixed(4), ")");
        }
        function createBound(x1, y1, x2, y2, out) {
          if (out) {
            out.x1 = x1;
            out.y1 = y1;
            out.x2 = x2;
            out.y2 = y2;
            return out;
          }
          return {
            x1: x1,
            y1: y1,
            x2: x2,
            y2: y2
          };
        }
        function boundsOverlap(a, b) {
          return a.x1 < b.x2 && a.x2 > b.x1 && a.y1 < b.y2 && a.y2 > b.y1;
        }
        function convertBoundToRect(bound, out) {
          if (out) {
            out.x = bound.x1;
            out.y = bound.y1;
            out.width = bound.x2 - bound.x1;
            out.height = bound.y2 - bound.y1;
            return out;
          }
          return {
            x: bound.x1,
            y: bound.y1,
            width: bound.x2 - bound.x1,
            height: bound.y2 - bound.y1
          };
        }
        function intersectRect(a, b, out) {
          var x = Math.max(a.x, b.x);
          var y = Math.max(a.y, b.y);
          var width = Math.min(a.x + a.width, b.x + b.width) - x;
          var height = Math.min(a.y + a.height, b.y + b.height) - y;
          if (width > 0 && height > 0) {
            if (out) {
              out.x = x;
              out.y = y;
              out.width = width;
              out.height = height;
              return out;
            }
            return {
              x: x,
              y: y,
              width: width,
              height: height
            };
          }
          if (out) {
            out.x = 0;
            out.y = 0;
            out.width = 0;
            out.height = 0;
            return out;
          }
          return {
            x: 0,
            y: 0,
            width: 0,
            height: 0
          };
        }
        function copyRect(a, out) {
          if (out) {
            out.x = a.x;
            out.y = a.y;
            out.width = a.width;
            out.height = a.height;
            return out;
          }
          return {
            x: a.x,
            y: a.y,
            width: a.width,
            height: a.height
          };
        }
        function compareRect(a, b) {
          if (a === b) {
            return true;
          }
          if (a === null || b === null) {
            return false;
          }
          return a.x === b.x && a.y === b.y && a.width === b.width && a.height === b.height;
        }
        function boundInsideBound(bound1, bound2) {
          return bound1.x1 <= bound2.x2 && bound1.y1 <= bound2.y2 && bound1.x2 >= bound2.x1 && bound1.y2 >= bound2.y1;
        }
        function boundLargeThanBound(bound1, bound2) {
          return bound1.x1 < bound2.x1 && bound1.x2 > bound2.x2 && bound1.y1 < bound2.y1 && bound1.y2 > bound2.y2;
        }
        function pointInBound(x, y, bound) {
          return !(x < bound.x1 || x > bound.x2 || y < bound.y1 || y > bound.y2);
        }
        function isBoundPositive(bound) {
          return bound.x1 < bound.x2 && bound.y1 < bound.y2;
        }
        /**
         * Create a preload bounds from a strict bound
         *
         * @param strictBound The strict boundary of the node
         * @param boundsMargin Boundary margin to apply to the strictBound
         * @returns
         */
        function createPreloadBounds(strictBound, boundsMargin) {
          return createBound(strictBound.x1 - boundsMargin[3], strictBound.y1 - boundsMargin[0], strictBound.x2 + boundsMargin[1], strictBound.y2 + boundsMargin[2]);
        }
        function convertUrlToAbsolute(url) {
          // handle local file imports if the url isn't remote resource or data blob
          if (self.location.protocol === 'file:' && !PROTOCOL_REGEX.test(url)) {
            var path = self.location.pathname.split('/');
            path.pop();
            var _basePath = path.join('/');
            var baseUrl = self.location.protocol + '//' + _basePath;
            // check if url has a leading dot
            if (url.charAt(0) === '.') {
              url = url.slice(1);
            }
            // check if url has a leading slash
            if (url.charAt(0) === '/') {
              url = url.slice(1);
            }
            return baseUrl + '/' + url;
          }
          var absoluteUrl = new URL(url, self.location.href);
          return absoluteUrl.href;
        }
        function isBase64Image(src) {
          return src.startsWith('data:') === true;
        }
        function dataURIToBlob(dataURI) {
          var _dataURI$match;
          dataURI = dataURI.replace(/^data:/, '');
          var type = ((_dataURI$match = dataURI.match(/image\/[^;]+/)) === null || _dataURI$match === void 0 ? void 0 : _dataURI$match[0]) || '';
          var base64 = dataURI.replace(/^[^,]+,/, '');
          var sliceSize = 1024;
          var byteCharacters = atob(base64);
          var bytesLength = byteCharacters.length;
          var slicesCount = Math.ceil(bytesLength / sliceSize);
          var byteArrays = new Array(slicesCount);
          for (var sliceIndex = 0; sliceIndex < slicesCount; ++sliceIndex) {
            var begin = sliceIndex * sliceSize;
            var end = Math.min(begin + sliceSize, bytesLength);
            var bytes = new Array(end - begin);
            for (var offset = begin, i = 0; offset < end; ++i, ++offset) {
              var _byteCharacters$offse;
              bytes[i] = (_byteCharacters$offse = byteCharacters[offset]) === null || _byteCharacters$offse === void 0 ? void 0 : _byteCharacters$offse.charCodeAt(0);
            }
            byteArrays[sliceIndex] = new Uint8Array(bytes);
          }
          return new Blob(byteArrays, {
            type: type
          });
        }

        /*
         * If not stated otherwise in this file or this component's LICENSE file the
         * following copyright and licenses apply:
         *
         * Copyright 2023 Comcast Cable Communications Management, LLC.
         *
         * Licensed under the Apache License, Version 2.0 (the License);
         * you may not use this file except in compliance with the License.
         * You may obtain a copy of the License at
         *
         * http://www.apache.org/licenses/LICENSE-2.0
         *
         * Unless required by applicable law or agreed to in writing, software
         * distributed under the License is distributed on an "AS IS" BASIS,
         * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
         * See the License for the specific language governing permissions and
         * limitations under the License.
         */
        /**
         * A 3D matrix representing a 2D graphics transformation
         *
         * @remarks
         * For convenience, entries in the first two rows can be accessed by the following
         * properties:
         * | ta tb tx |
         * | tc td ty |
         * | 0  0  1  |
         *
         * This matrix is optimized for 2D transformations and hence the last row will
         * always be considered [0, 0 ,1].
         *
         * To access a column major array for WebGL, use the {@link getFloatArr} method.
         */
        var Matrix3d = /*#__PURE__*/function () {
          /**
           * Creates a new 3x3 matrix.
           *
           * @param entries Row-major 3x3 matrix
           */
          function Matrix3d() {
            _classCallCheck(this, Matrix3d);
            _defineProperty(this, "ta", void 0);
            _defineProperty(this, "tb", void 0);
            _defineProperty(this, "tx", void 0);
            _defineProperty(this, "tc", void 0);
            _defineProperty(this, "td", void 0);
            _defineProperty(this, "ty", void 0);
            _defineProperty(this, "_floatArr", null);
            /**
             * Potential Mutation Flag
             *
             * @remarks
             * This flag is set to true whenever the matrix is potentially modified.
             * We don't waste CPU trying to identify if each operation actually modifies
             * the matrix. Instead, we set this flag to true whenever we think the matrix
             * is modified. This signals that the `floatArr` should to be updated.
             */
            _defineProperty(this, "mutation", void 0);
            this.ta = 0;
            this.tb = 0;
            this.tx = 0;
            this.tc = 0;
            this.td = 0;
            this.ty = 0;
            this.mutation = true;
          }
          /**
           * Returns a temporary matrix that can be used for calculations.
           *
           * @remarks
           * This is useful for avoiding allocations in tight loops.
           *
           * The matrix is not guaranteed to be the same between calls.
           *
           * @returns
           */
          return _createClass(Matrix3d, [{
            key: "translate",
            value: function translate(x, y) {
              this.tx = this.ta * x + this.tb * y + this.tx;
              this.ty = this.tc * x + this.td * y + this.ty;
              this.mutation = true;
              return this;
            }
          }, {
            key: "scale",
            value: function scale(sx, sy) {
              this.ta = this.ta * sx;
              this.tb = this.tb * sy;
              this.tc = this.tc * sx;
              this.td = this.td * sy;
              this.mutation = true;
              return this;
            }
          }, {
            key: "rotate",
            value: function rotate(angle) {
              if (angle === 0 || !(angle % Math.PI * 2)) {
                return this;
              }
              var cos = Math.cos(angle);
              var sin = Math.sin(angle);
              var e0 = this.ta * cos + this.tb * sin;
              var e1 = this.tb * cos - this.ta * sin;
              var e3 = this.tc * cos + this.td * sin;
              var e4 = this.td * cos - this.tc * sin;
              this.ta = e0;
              this.tb = e1;
              this.tc = e3;
              this.td = e4;
              this.mutation = true;
              return this;
            }
          }, {
            key: "multiply",
            value: function multiply(other) {
              return Matrix3d.multiply(this, other, this);
            }
            /**
             * Returns the matrix as a Float32Array in column-major order.
             *
             * @remarks
             * This method is optimized to avoid unnecessary allocations. The same array
             * is returned every time this method is called, and is updated in place.
             *
             * WARNING: Use the array only for passing directly to a WebGL shader uniform
             * during a frame render. Do not modify or hold onto the array for longer than
             * a frame.
             */
          }, {
            key: "getFloatArr",
            value: function getFloatArr() {
              if (!this._floatArr) {
                this._floatArr = new Float32Array(9);
              }
              if (this.mutation) {
                this._floatArr[0] = this.ta;
                this._floatArr[1] = this.tc;
                this._floatArr[2] = 0;
                this._floatArr[3] = this.tb;
                this._floatArr[4] = this.td;
                this._floatArr[5] = 0;
                this._floatArr[6] = this.tx;
                this._floatArr[7] = this.ty;
                this._floatArr[8] = 1;
                this.mutation = false;
              }
              return this._floatArr;
            }
          }], [{
            key: "temp",
            get: function get() {
              return tempMatrix;
            }
          }, {
            key: "multiply",
            value: function multiply(a, b, out) {
              var e0 = a.ta * b.ta + a.tb * b.tc;
              var e1 = a.ta * b.tb + a.tb * b.td;
              var e2 = a.ta * b.tx + a.tb * b.ty + a.tx;
              var e3 = a.tc * b.ta + a.td * b.tc;
              var e4 = a.tc * b.tb + a.td * b.td;
              var e5 = a.tc * b.tx + a.td * b.ty + a.ty;
              if (!out) {
                out = new Matrix3d();
              }
              out.ta = e0;
              out.tb = e1;
              out.tx = e2;
              out.tc = e3;
              out.td = e4;
              out.ty = e5;
              out.mutation = true;
              return out;
            }
          }, {
            key: "identity",
            value: function identity(out) {
              if (!out) {
                out = new Matrix3d();
              }
              out.ta = 1;
              out.tb = 0;
              out.tx = 0;
              out.tc = 0;
              out.td = 1;
              out.ty = 0;
              out.mutation = true;
              return out;
            }
          }, {
            key: "translate",
            value: function translate(x, y, out) {
              if (!out) {
                out = new Matrix3d();
              }
              out.ta = 1;
              out.tb = 0;
              out.tx = x;
              out.tc = 0;
              out.td = 1;
              out.ty = y;
              out.mutation = true;
              return out;
            }
          }, {
            key: "scale",
            value: function scale(sx, sy, out) {
              if (!out) {
                out = new Matrix3d();
              }
              out.ta = sx;
              out.tb = 0;
              out.tx = 0;
              out.tc = 0;
              out.td = sy;
              out.ty = 0;
              out.mutation = true;
              return out;
            }
          }, {
            key: "rotate",
            value: function rotate(angle, out) {
              var cos = Math.cos(angle);
              var sin = Math.sin(angle);
              if (!out) {
                out = new Matrix3d();
              }
              out.ta = cos;
              out.tb = -sin;
              out.tx = 0;
              out.tc = sin;
              out.td = cos;
              out.ty = 0;
              out.mutation = true;
              return out;
            }
          }, {
            key: "copy",
            value: function copy(src, dst) {
              if (!dst) {
                dst = new Matrix3d();
              }
              dst.ta = src.ta;
              dst.tc = src.tc;
              dst.tb = src.tb;
              dst.td = src.td;
              dst.tx = src.tx;
              dst.ty = src.ty;
              dst.mutation = true;
              return dst;
            }
          }]);
        }();
        var tempMatrix = new Matrix3d();
        var rx1 = 0;
        var rx2 = 2;
        var rx3 = 4;
        var rx4 = 6;
        var ry1 = 1;
        var ry2 = 3;
        var ry3 = 5;
        var ry4 = 7;
        var RenderCoords = /*#__PURE__*/function () {
          function RenderCoords(entries) {
            _classCallCheck(this, RenderCoords);
            _defineProperty(this, "data", void 0);
            this.data = new Float32Array(8);
            if (entries) {
              this.data[rx1] = entries[rx1];
              this.data[rx2] = entries[rx2];
              this.data[rx3] = entries[rx3];
              this.data[rx4] = entries[rx4];
              this.data[ry1] = entries[ry1];
              this.data[ry2] = entries[ry2];
              this.data[ry3] = entries[ry3];
              this.data[ry4] = entries[ry4];
            }
          }
          return _createClass(RenderCoords, [{
            key: "x1",
            get: function get() {
              return this.data[rx1];
            }
          }, {
            key: "x2",
            get: function get() {
              return this.data[rx2];
            }
          }, {
            key: "x3",
            get: function get() {
              return this.data[rx3];
            }
          }, {
            key: "x4",
            get: function get() {
              return this.data[rx4];
            }
          }, {
            key: "y1",
            get: function get() {
              return this.data[ry1];
            }
          }, {
            key: "y2",
            get: function get() {
              return this.data[ry2];
            }
          }, {
            key: "y3",
            get: function get() {
              return this.data[ry3];
            }
          }, {
            key: "y4",
            get: function get() {
              return this.data[ry4];
            }
          }], [{
            key: "translate",
            value: function translate(x1, y1, x2, y2, x3, y3, x4, y4, out) {
              if (!out) {
                out = new RenderCoords();
              }
              out.data[rx1] = x1;
              out.data[rx2] = x2;
              out.data[rx3] = x3;
              out.data[rx4] = x4;
              out.data[ry1] = y1;
              out.data[ry2] = y2;
              out.data[ry3] = y3;
              out.data[ry4] = y4;
              return out;
            }
          }]);
        }();
        /*
         * If not stated otherwise in this file or this component's LICENSE file the
         * following copyright and licenses apply:
         *
         * Copyright 2023 Comcast Cable Communications Management, LLC.
         *
         * Licensed under the Apache License, Version 2.0 (the License);
         * you may not use this file except in compliance with the License.
         * You may obtain a copy of the License at
         *
         * http://www.apache.org/licenses/LICENSE-2.0
         *
         * Unless required by applicable law or agreed to in writing, software
         * distributed under the License is distributed on an "AS IS" BASIS,
         * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
         * See the License for the specific language governing permissions and
         * limitations under the License.
         */
        /**
         * Core Utility Functions
         *
         * @module
         */
        var getTimingBezier$1 = function getTimingBezier$1(a, b, c, d) {
          var xc = 3.0 * a;
          var xb = 3.0 * (c - a) - xc;
          var xa = 1.0 - xc - xb;
          var yc = 3.0 * b;
          var yb = 3.0 * (d - b) - yc;
          var ya = 1.0 - yc - yb;
          return function (time) {
            if (time >= 1.0) {
              return 1;
            }
            if (time <= 0) {
              return 0;
            }
            var t = 0.5,
              cbx,
              cbxd,
              dx;
            for (var it = 0; it < 20; it++) {
              cbx = t * (t * (t * xa + xb) + xc);
              dx = time - cbx;
              if (dx > -1e-8 && dx < 1e-8) {
                return t * (t * (t * ya + yb) + yc);
              }
              // Cubic bezier derivative.
              cbxd = t * (t * (3 * xa) + 2 * xb) + xc;
              if (cbxd > 1e-10 && cbxd < 1e-10) {
                // Problematic. Fall back to binary search method.
                break;
              }
              t += dx / cbxd;
            }
            // Fallback: binary search method. This is more reliable when there are near-0 slopes.
            var minT = 0;
            var maxT = 1;
            for (var _it = 0; _it < 20; _it++) {
              t = 0.5 * (minT + maxT);
              cbx = t * (t * (t * xa + xb) + xc);
              dx = time - cbx;
              if (dx > -1e-8 && dx < 1e-8) {
                // Solution found!
                return t * (t * (t * ya + yb) + yc);
              }
              if (dx < 0) {
                maxT = t;
              } else {
                minT = t;
              }
            }
          };
        };
        var timingMapping$1 = {};
        var timingLookup$1 = {
          ease: [0.25, 0.1, 0.25, 1.0],
          'ease-in': [0.42, 0, 1.0, 1.0],
          'ease-out': [0, 0, 0.58, 1.0],
          'ease-in-out': [0.42, 0, 0.58, 1.0],
          'ease-in-sine': [0.12, 0, 0.39, 0],
          'ease-out-sine': [0.12, 0, 0.39, 0],
          'ease-in-out-sine': [0.37, 0, 0.63, 1],
          'ease-in-cubic': [0.32, 0, 0.67, 0],
          'ease-out-cubic': [0.33, 1, 0.68, 1],
          'ease-in-out-cubic': [0.65, 0, 0.35, 1],
          'ease-in-circ': [0.55, 0, 1, 0.45],
          'ease-out-circ': [0, 0.55, 0.45, 1],
          'ease-in-out-circ': [0.85, 0, 0.15, 1],
          'ease-in-back': [0.36, 0, 0.66, -0.56],
          'ease-out-back': [0.34, 1.56, 0.64, 1],
          'ease-in-out-back': [0.68, -0.6, 0.32, 1.6]
        };
        var defaultTiming$1 = function defaultTiming$1(t) {
          return t;
        };
        var parseCubicBezier$1 = function parseCubicBezier$1(str) {
          //cubic-bezier(0.84, 0.52, 0.56, 0.6)
          var regex = /-?\d*\.?\d+/g;
          var match = str.match(regex);
          if (match) {
            var _match = _slicedToArray(match, 4),
              num1 = _match[0],
              num2 = _match[1],
              num3 = _match[2],
              num4 = _match[3];
            var a = parseFloat(num1 || '0.42');
            var b = parseFloat(num2 || '0');
            var c = parseFloat(num3 || '1');
            var d = parseFloat(num4 || '1');
            var timing = getTimingBezier$1(a, b, c, d);
            timingMapping$1[str] = timing;
            return timing;
          }
          // parse failed, return linear
          console.warn('Unknown cubic-bezier timing: ' + str);
          return defaultTiming$1;
        };
        var getTimingFunction$1 = function getTimingFunction$1(str) {
          if (str === 'linear') {
            return defaultTiming$1;
          }
          if (timingMapping$1[str] !== undefined) {
            return timingMapping$1[str] || defaultTiming$1;
          }
          if (str === 'step-start') {
            return function () {
              return 1;
            };
          }
          if (str === 'step-end') {
            return function (time) {
              return time === 1 ? 1 : 0;
            };
          }
          var lookup = timingLookup$1[str];
          if (lookup !== undefined) {
            var _lookup = _slicedToArray(lookup, 4),
              a = _lookup[0],
              b = _lookup[1],
              c = _lookup[2],
              d = _lookup[3];
            // eslint-disable-next-line @typescript-eslint/ban-ts-comment
            // @ts-ignore - TS doesn't understand that we've checked for undefined
            // eslint-disable-next-line @typescript-eslint/no-unsafe-argument
            var timing = getTimingBezier$1(a, b, c, d);
            timingMapping$1[str] = timing;
            return timing;
          }
          if (str.startsWith('cubic-bezier')) {
            return parseCubicBezier$1(str);
          }
          console.warn('Unknown timing function: ' + str);
          return defaultTiming$1;
        };
        /**
         * Convert bytes to string of megabytes with 2 decimal points
         *
         * @param bytes
         * @returns
         */
        function bytesToMb$1(bytes) {
          return (bytes / 1024 / 1024).toFixed(2);
        }

        /*
         * If not stated otherwise in this file or this component's LICENSE file the
         * following copyright and licenses apply:
         *
         * Copyright 2023 Comcast Cable Communications Management, LLC.
         *
         * Licensed under the Apache License, Version 2.0 (the License);
         * you may not use this file except in compliance with the License.
         * You may obtain a copy of the License at
         *
         * http://www.apache.org/licenses/LICENSE-2.0
         *
         * Unless required by applicable law or agreed to in writing, software
         * distributed under the License is distributed on an "AS IS" BASIS,
         * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
         * See the License for the specific language governing permissions and
         * limitations under the License.
         */
        var CoreAnimation = /*#__PURE__*/function (_EventEmitter3) {
          function CoreAnimation(node, props, settings) {
            var _settings$delay, _settings$duration, _settings$loop, _settings$repeat, _settings$repeatDelay, _settings$stopMethod;
            var _this6;
            _classCallCheck(this, CoreAnimation);
            _this6 = _callSuper(this, CoreAnimation);
            _defineProperty(_this6, "node", void 0);
            _defineProperty(_this6, "props", void 0);
            _defineProperty(_this6, "settings", void 0);
            _defineProperty(_this6, "progress", 0);
            _defineProperty(_this6, "delayFor", 0);
            _defineProperty(_this6, "delay", 0);
            _defineProperty(_this6, "timingFunction", void 0);
            _defineProperty(_this6, "propValuesMap", {});
            _defineProperty(_this6, "dynPropValuesMap", undefined);
            _this6.node = node;
            _this6.props = props;
            for (var key in props) {
              if (key !== 'shaderProps') {
                if (_this6.propValuesMap['props'] === undefined) {
                  _this6.propValuesMap['props'] = {};
                }
                _this6.propValuesMap['props'][key] = {
                  start: node[key] || 0,
                  target: props[key]
                };
              } else if (node.shader.type !== 'DynamicShader') {
                _this6.propValuesMap['shaderProps'] = {};
                for (var _key2 in props.shaderProps) {
                  _this6.propValuesMap['shaderProps'][_key2] = {
                    start: node.shader.props[_key2],
                    target: props.shaderProps[_key2]
                  };
                }
              } else {
                var shaderPropKeys = Object.keys(props.shaderProps);
                var spLength = shaderPropKeys.length;
                _this6.dynPropValuesMap = {};
                for (var j = 0; j < spLength; j++) {
                  var effectName = shaderPropKeys[j];
                  var _effect = props.shaderProps[effectName];
                  _this6.dynPropValuesMap[effectName] = {};
                  var effectProps = Object.entries(_effect);
                  var eLength = effectProps.length;
                  for (var k = 0; k < eLength; k++) {
                    var _effectProps$k = _slicedToArray(effectProps[k], 2),
                      _key3 = _effectProps$k[0],
                      value = _effectProps$k[1];
                    _this6.dynPropValuesMap[effectName][_key3] = {
                      start: node.shader.props[effectName][_key3],
                      target: value
                    };
                  }
                }
              }
            }
            var easing = settings.easing || 'linear';
            var delay = (_settings$delay = settings.delay) !== null && _settings$delay !== void 0 ? _settings$delay : 0;
            _this6.settings = {
              duration: (_settings$duration = settings.duration) !== null && _settings$duration !== void 0 ? _settings$duration : 0,
              delay: delay,
              easing: easing,
              loop: (_settings$loop = settings.loop) !== null && _settings$loop !== void 0 ? _settings$loop : false,
              repeat: (_settings$repeat = settings.repeat) !== null && _settings$repeat !== void 0 ? _settings$repeat : 0,
              repeatDelay: (_settings$repeatDelay = settings.repeatDelay) !== null && _settings$repeatDelay !== void 0 ? _settings$repeatDelay : 0,
              stopMethod: (_settings$stopMethod = settings.stopMethod) !== null && _settings$stopMethod !== void 0 ? _settings$stopMethod : false
            };
            _this6.timingFunction = getTimingFunction$1(easing);
            _this6.delayFor = delay;
            _this6.delay = delay;
            return _this6;
          }
          _inherits(CoreAnimation, _EventEmitter3);
          return _createClass(CoreAnimation, [{
            key: "reset",
            value: function reset() {
              this.progress = 0;
              this.delayFor = this.settings.delay || 0;
              this.update(0);
            }
          }, {
            key: "restoreValues",
            value: function restoreValues(target, valueMap) {
              var entries = Object.entries(valueMap);
              var eLength = entries.length;
              for (var i = 0; i < eLength; i++) {
                var _entries$i = _slicedToArray(entries[i], 2),
                  key = _entries$i[0],
                  value = _entries$i[1];
                target[key] = value.start;
              }
            }
          }, {
            key: "restore",
            value: function restore() {
              this.reset();
              if (this.propValuesMap['props'] !== undefined) {
                this.restoreValues(this.node, this.propValuesMap['props']);
              }
              if (this.propValuesMap['shaderProps'] !== undefined) {
                this.restoreValues(this.node.shader.props, this.propValuesMap['shaderProps']);
              }
              if (this.dynPropValuesMap !== undefined) {
                var dynEntries = Object.keys(this.dynPropValuesMap);
                var dynEntriesL = dynEntries.length;
                if (dynEntriesL > 0) {
                  for (var i = 0; i < dynEntriesL; i++) {
                    var key = dynEntries[i];
                    this.restoreValues(this.node.shader.props[key], this.dynPropValuesMap[key]);
                  }
                }
              }
            }
          }, {
            key: "reverseValues",
            value: function reverseValues(valueMap) {
              var entries = Object.entries(valueMap);
              var eLength = entries.length;
              for (var i = 0; i < eLength; i++) {
                var _entries$i2 = _slicedToArray(entries[i], 2),
                  key = _entries$i2[0],
                  value = _entries$i2[1];
                valueMap[key] = {
                  start: value.target,
                  target: value.start
                };
              }
            }
          }, {
            key: "reverse",
            value: function reverse() {
              this.progress = 0;
              if (this.propValuesMap['props'] !== undefined) {
                this.reverseValues(this.propValuesMap['props']);
              }
              if (this.propValuesMap['shaderProps'] !== undefined) {
                this.reverseValues(this.propValuesMap['shaderProps']);
              }
              if (this.dynPropValuesMap !== undefined) {
                var dynEntries = Object.keys(this.dynPropValuesMap);
                var dynEntriesL = dynEntries.length;
                if (dynEntriesL > 0) {
                  for (var i = 0; i < dynEntriesL; i++) {
                    var key = dynEntries[i];
                    this.reverseValues(this.dynPropValuesMap[key]);
                  }
                }
              }
              // restore stop method if we are not looping
              if (!this.settings.loop) {
                this.settings.stopMethod = false;
              }
            }
          }, {
            key: "applyEasing",
            value: function applyEasing(p, s, e) {
              return (this.timingFunction(p) || p) * (e - s) + s;
            }
          }, {
            key: "updateValue",
            value: function updateValue(propName, propValue, startValue, easing) {
              if (this.progress === 1) {
                return propValue;
              }
              if (this.progress === 0) {
                return startValue;
              }
              var endValue = propValue;
              if (propName.indexOf('color') !== -1) {
                if (startValue === endValue) {
                  return startValue;
                }
                if (easing) {
                  var easingProgressValue = this.timingFunction(this.progress) || this.progress;
                  return mergeColorProgress$1(startValue, endValue, easingProgressValue);
                }
                return mergeColorProgress$1(startValue, endValue, this.progress);
              }
              if (easing) {
                return this.applyEasing(this.progress, startValue, endValue);
              }
              return startValue + (endValue - startValue) * this.progress;
            }
          }, {
            key: "updateValues",
            value: function updateValues(target, valueMap, easing) {
              var entries = Object.entries(valueMap);
              var eLength = entries.length;
              for (var i = 0; i < eLength; i++) {
                var _entries$i3 = _slicedToArray(entries[i], 2),
                  key = _entries$i3[0],
                  value = _entries$i3[1];
                target[key] = this.updateValue(key, value.target, value.start, easing);
              }
            }
          }, {
            key: "update",
            value: function update(dt) {
              var _this$settings = this.settings,
                duration = _this$settings.duration,
                loop = _this$settings.loop,
                easing = _this$settings.easing,
                stopMethod = _this$settings.stopMethod;
              var delayFor = this.delayFor;
              if (this.node.destroyed) {
                // cleanup
                this.emit('destroyed', {});
                return;
              }
              if (duration === 0 && delayFor === 0) {
                this.emit('finished', {});
                return;
              }
              if (this.delayFor > 0) {
                this.delayFor -= dt;
                if (this.delayFor >= 0) {
                  // Either no or more delay left. Exit.
                  return;
                } else {
                  // We went beyond the delay time, add it back to dt so we can continue
                  // with the animation.
                  dt = -this.delayFor;
                  this.delayFor = 0;
                }
              }
              if (duration === 0) {
                // No duration, we are done.
                this.emit('finished', {});
                return;
              }
              if (this.progress === 0) {
                // Progress is 0, we are starting the post-delay part of the animation.
                this.emit('animating', {});
              }
              this.progress += dt / duration;
              if (this.progress > 1) {
                this.progress = loop ? 0 : 1;
                this.delayFor = this.delay;
                if (stopMethod) {
                  // If there's a stop method emit finished so the stop method can be applied.
                  // TODO: We should probably reevaluate how stopMethod is implemented as currently
                  // stop method 'reset' does not work when looping.
                  this.emit('finished', {});
                  return;
                }
              }
              if (this.propValuesMap['props'] !== undefined) {
                this.updateValues(this.node, this.propValuesMap['props'], easing);
              }
              if (this.propValuesMap['shaderProps'] !== undefined) {
                this.updateValues(this.node.shader.props, this.propValuesMap['shaderProps'], easing);
              }
              if (this.dynPropValuesMap !== undefined) {
                var dynEntries = Object.keys(this.dynPropValuesMap);
                var dynEntriesL = dynEntries.length;
                if (dynEntriesL > 0) {
                  for (var i = 0; i < dynEntriesL; i++) {
                    var key = dynEntries[i];
                    this.updateValues(this.node.shader.props[key], this.dynPropValuesMap[key], easing);
                  }
                }
              }
              if (this.progress < 1) {
                this.emit('tick', {
                  progress: this.progress
                });
              }
              if (this.progress === 1) {
                this.emit('finished', {});
              }
            }
          }]);
        }(EventEmitter);
        /*
         * If not stated otherwise in this file or this component's LICENSE file the
         * following copyright and licenses apply:
         *
         * Copyright 2023 Comcast Cable Communications Management, LLC.
         *
         * Licensed under the Apache License, Version 2.0 (the License);
         * you may not use this file except in compliance with the License.
         * You may obtain a copy of the License at
         *
         * http://www.apache.org/licenses/LICENSE-2.0
         *
         * Unless required by applicable law or agreed to in writing, software
         * distributed under the License is distributed on an "AS IS" BASIS,
         * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
         * See the License for the specific language governing permissions and
         * limitations under the License.
         */
        var CoreAnimationController = /*#__PURE__*/function (_EventEmitter4) {
          function CoreAnimationController(manager, animation) {
            var _this7;
            _classCallCheck(this, CoreAnimationController);
            _this7 = _callSuper(this, CoreAnimationController);
            _defineProperty(_this7, "manager", void 0);
            _defineProperty(_this7, "animation", void 0);
            _defineProperty(_this7, "stoppedPromise", void 0);
            /**
             * If this is null, then the animation is in a finished / stopped state.
             */
            _defineProperty(_this7, "stoppedResolve", null);
            _defineProperty(_this7, "state", void 0);
            _this7.manager = manager;
            _this7.animation = animation;
            _this7.state = 'stopped';
            // Initial stopped promise is resolved (since the animation is stopped)
            _this7.stoppedPromise = Promise.resolve();
            // Bind event handlers
            _this7.onAnimating = _this7.onAnimating.bind(_this7);
            _this7.onFinished = _this7.onFinished.bind(_this7);
            _this7.onTick = _this7.onTick.bind(_this7);
            _this7.onDestroy = _this7.onDestroy.bind(_this7);
            return _this7;
          }
          _inherits(CoreAnimationController, _EventEmitter4);
          return _createClass(CoreAnimationController, [{
            key: "start",
            value: function start() {
              if (this.state !== 'running' && this.state !== 'scheduled') {
                this.makeStoppedPromise();
                this.registerAnimation();
                this.state = 'scheduled';
              }
              return this;
            }
          }, {
            key: "stop",
            value: function stop() {
              this.unregisterAnimation();
              if (this.stoppedResolve !== null) {
                this.stoppedResolve();
                this.stoppedResolve = null;
                this.emit('stopped', this);
              }
              this.animation.reset();
              this.state = 'stopped';
              return this;
            }
          }, {
            key: "pause",
            value: function pause() {
              this.unregisterAnimation();
              this.state = 'paused';
              return this;
            }
          }, {
            key: "restore",
            value: function restore() {
              this.stoppedResolve = null;
              this.animation.restore();
              return this;
            }
          }, {
            key: "waitUntilStopped",
            value: function waitUntilStopped() {
              return this.stoppedPromise;
            }
          }, {
            key: "registerAnimation",
            value: function registerAnimation() {
              // Hook up event listeners
              this.animation.once('finished', this.onFinished);
              this.animation.on('animating', this.onAnimating);
              this.animation.on('tick', this.onTick);
              this.animation.on('destroyed', this.onDestroy);
              // Then register the animation
              this.manager.registerAnimation(this.animation);
            }
          }, {
            key: "unregisterAnimation",
            value: function unregisterAnimation() {
              // First unregister the animation
              this.manager.unregisterAnimation(this.animation);
              // Then unhook event listeners
              this.animation.off('finished', this.onFinished);
              this.animation.off('animating', this.onAnimating);
              this.animation.off('tick', this.onTick);
              this.animation.off('destroy', this.onDestroy);
            }
          }, {
            key: "makeStoppedPromise",
            value: function makeStoppedPromise() {
              var _this8 = this;
              if (this.stoppedResolve === null) {
                this.stoppedPromise = new Promise(function (resolve) {
                  _this8.stoppedResolve = resolve;
                });
              }
            }
          }, {
            key: "onDestroy",
            value: function onDestroy() {
              this.unregisterAnimation();
              this.state = 'stopped';
            }
          }, {
            key: "onFinished",
            value: function onFinished() {
              // If the animation is looping, then we need to restart it.
              var _this$animation$setti = this.animation.settings,
                loop = _this$animation$setti.loop,
                stopMethod = _this$animation$setti.stopMethod;
              if (stopMethod === 'reverse') {
                this.animation.once('finished', this.onFinished);
                this.animation.reverse();
                return;
              }
              if (loop) {
                return;
              }
              // unregister animation
              this.unregisterAnimation();
              // resolve promise
              if (this.stoppedResolve !== null) {
                this.stoppedResolve();
                this.stoppedResolve = null;
              }
              this.emit('stopped', this);
              this.state = 'stopped';
            }
          }, {
            key: "onAnimating",
            value: function onAnimating() {
              this.state = 'running';
              this.emit('animating', this);
            }
          }, {
            key: "onTick",
            value: function onTick(_animation, data) {
              this.emit('tick', data);
            }
          }]);
        }(EventEmitter);
        /*
         * If not stated otherwise in this file or this component's LICENSE file the
         * following copyright and licenses apply:
         *
         * Copyright 2023 Comcast Cable Communications Management, LLC.
         *
         * Licensed under the Apache License, Version 2.0 (the License);
         * you may not use this file except in compliance with the License.
         * You may obtain a copy of the License at
         *
         * http://www.apache.org/licenses/LICENSE-2.0
         *
         * Unless required by applicable law or agreed to in writing, software
         * distributed under the License is distributed on an "AS IS" BASIS,
         * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
         * See the License for the specific language governing permissions and
         * limitations under the License.
         */
        var CoreNodeRenderState;
        (function (CoreNodeRenderState) {
          CoreNodeRenderState[CoreNodeRenderState["Init"] = 0] = "Init";
          CoreNodeRenderState[CoreNodeRenderState["OutOfBounds"] = 2] = "OutOfBounds";
          CoreNodeRenderState[CoreNodeRenderState["InBounds"] = 4] = "InBounds";
          CoreNodeRenderState[CoreNodeRenderState["InViewport"] = 8] = "InViewport";
        })(CoreNodeRenderState || (CoreNodeRenderState = {}));
        var CoreNodeRenderStateMap = new Map();
        CoreNodeRenderStateMap.set(CoreNodeRenderState.Init, 'init');
        CoreNodeRenderStateMap.set(CoreNodeRenderState.OutOfBounds, 'outOfBounds');
        CoreNodeRenderStateMap.set(CoreNodeRenderState.InBounds, 'inBounds');
        CoreNodeRenderStateMap.set(CoreNodeRenderState.InViewport, 'inViewport');
        var UpdateType;
        (function (UpdateType) {
          /**
           * Child updates
           */
          UpdateType[UpdateType["Children"] = 1] = "Children";
          /**
           * Scale/Rotate transform update
           *
           * @remarks
           * CoreNode Properties Updated:
           * - `scaleRotateTransform`
           */
          UpdateType[UpdateType["ScaleRotate"] = 2] = "ScaleRotate";
          /**
           * Translate transform update (x/y/width/height/pivot/mount)
           *
           * @remarks
           * CoreNode Properties Updated:
           * - `localTransform`
           */
          UpdateType[UpdateType["Local"] = 4] = "Local";
          /**
           * Global Transform update
           *
           * @remarks
           * CoreNode Properties Updated:
           * - `globalTransform`
           * - `renderCoords`
           * - `renderBound`
           */
          UpdateType[UpdateType["Global"] = 8] = "Global";
          /**
           * Clipping rect update
           *
           * @remarks
           * CoreNode Properties Updated:
           * - `clippingRect`
           */
          UpdateType[UpdateType["Clipping"] = 16] = "Clipping";
          /**
           * Calculated ZIndex update
           *
           * @remarks
           * CoreNode Properties Updated:
           * - `calcZIndex`
           */
          UpdateType[UpdateType["CalculatedZIndex"] = 32] = "CalculatedZIndex";
          /**
           * Z-Index Sorted Children update
           *
           * @remarks
           * CoreNode Properties Updated:
           * - `children` (sorts children by their `calcZIndex`)
           */
          UpdateType[UpdateType["ZIndexSortedChildren"] = 64] = "ZIndexSortedChildren";
          /**
           * Premultiplied Colors update
           *
           * @remarks
           * CoreNode Properties Updated:
           * - `premultipliedColorTl`
           * - `premultipliedColorTr`
           * - `premultipliedColorBl`
           * - `premultipliedColorBr`
           */
          UpdateType[UpdateType["PremultipliedColors"] = 128] = "PremultipliedColors";
          /**
           * World Alpha update
           *
           * @remarks
           * CoreNode Properties Updated:
           * - `worldAlpha` = `parent.worldAlpha` * `alpha`
           */
          UpdateType[UpdateType["WorldAlpha"] = 256] = "WorldAlpha";
          /**
           * Render State update
           *
           * @remarks
           * CoreNode Properties Updated:
           * - `renderState`
           */
          UpdateType[UpdateType["RenderState"] = 512] = "RenderState";
          /**
           * Is Renderable update
           *
           * @remarks
           * CoreNode Properties Updated:
           * - `isRenderable`
           */
          UpdateType[UpdateType["IsRenderable"] = 1024] = "IsRenderable";
          /**
           * Render Texture update
           */
          UpdateType[UpdateType["RenderTexture"] = 2048] = "RenderTexture";
          /**
           * Track if parent has render texture
           */
          UpdateType[UpdateType["ParentRenderTexture"] = 4096] = "ParentRenderTexture";
          /**
           * Render Bounds update
           */
          UpdateType[UpdateType["RenderBounds"] = 8192] = "RenderBounds";
          /**
           * None
           */
          UpdateType[UpdateType["None"] = 0] = "None";
          /**
           * All
           */
          UpdateType[UpdateType["All"] = 14335] = "All";
        })(UpdateType || (UpdateType = {}));
        /**
         * A visual Node in the Renderer scene graph.
         *
         * @remarks
         * CoreNode is an internally used class that represents a Renderer Node in the
         * scene graph. See INode.ts for the public APIs exposed to Renderer users
         * that include generic types for Shaders.
         */
        var CoreNode = /*#__PURE__*/function (_EventEmitter5) {
          function CoreNode(stage, props) {
            var _this9;
            _classCallCheck(this, CoreNode);
            _this9 = _callSuper(this, CoreNode);
            _defineProperty(_this9, "stage", void 0);
            _defineProperty(_this9, "children", []);
            _defineProperty(_this9, "_id", getNewId());
            _defineProperty(_this9, "props", void 0);
            _defineProperty(_this9, "updateType", UpdateType.All);
            _defineProperty(_this9, "childUpdateType", UpdateType.None);
            _defineProperty(_this9, "globalTransform", void 0);
            _defineProperty(_this9, "scaleRotateTransform", void 0);
            _defineProperty(_this9, "localTransform", void 0);
            _defineProperty(_this9, "sceneGlobalTransform", void 0);
            _defineProperty(_this9, "renderCoords", void 0);
            _defineProperty(_this9, "sceneRenderCoords", void 0);
            _defineProperty(_this9, "renderBound", void 0);
            _defineProperty(_this9, "strictBound", void 0);
            _defineProperty(_this9, "preloadBound", void 0);
            _defineProperty(_this9, "clippingRect", {
              x: 0,
              y: 0,
              width: 0,
              height: 0,
              valid: false
            });
            _defineProperty(_this9, "isRenderable", false);
            _defineProperty(_this9, "renderState", CoreNodeRenderState.Init);
            _defineProperty(_this9, "worldAlpha", 1);
            _defineProperty(_this9, "premultipliedColorTl", 0);
            _defineProperty(_this9, "premultipliedColorTr", 0);
            _defineProperty(_this9, "premultipliedColorBl", 0);
            _defineProperty(_this9, "premultipliedColorBr", 0);
            _defineProperty(_this9, "calcZIndex", 0);
            _defineProperty(_this9, "hasRTTupdates", false);
            _defineProperty(_this9, "parentHasRenderTexture", false);
            _defineProperty(_this9, "rttParent", null);
            _defineProperty(_this9, "destroyed", false);
            _defineProperty(_this9, "onTextureLoaded", function (_, dimensions) {
              var _this9$props$textureO;
              _this9.autosizeNode(dimensions);
              _this9.setUpdateType(UpdateType.IsRenderable);
              // Texture was loaded. In case the RAF loop has already stopped, we request
              // a render to ensure the texture is rendered.
              _this9.stage.requestRender();
              // If parent has a render texture, flag that we need to update
              if (_this9.parentHasRenderTexture) {
                _this9.notifyParentRTTOfUpdate();
              }
              // ignore 1x1 pixel textures
              if (dimensions.width > 1 && dimensions.height > 1) {
                _this9.emit('loaded', {
                  type: 'texture',
                  dimensions: dimensions
                });
              }
              // Trigger a local update if the texture is loaded and the resizeMode is 'contain'
              if (((_this9$props$textureO = _this9.props.textureOptions) === null || _this9$props$textureO === void 0 || (_this9$props$textureO = _this9$props$textureO.resizeMode) === null || _this9$props$textureO === void 0 ? void 0 : _this9$props$textureO.type) === 'contain') {
                _this9.setUpdateType(UpdateType.Local);
              }
            });
            _defineProperty(_this9, "onTextureFailed", function (_, error) {
              // immediately set isRenderable to false, so that we handle the error
              // without waiting for the next frame loop
              _this9.isRenderable = false;
              _this9.updateTextureOwnership(false);
              _this9.setUpdateType(UpdateType.IsRenderable);
              // If parent has a render texture, flag that we need to update
              if (_this9.parentHasRenderTexture) {
                _this9.notifyParentRTTOfUpdate();
              }
              // only emit failed outward if we've exhausted all retry attempts
              if (_this9.texture !== null && _this9.texture.retryCount > _this9.texture.maxRetryCount) {
                _this9.emit('failed', {
                  type: 'texture',
                  error: error
                });
              }
            });
            _defineProperty(_this9, "onTextureFreed", function () {
              // immediately set isRenderable to false, so that we handle the error
              // without waiting for the next frame loop
              _this9.isRenderable = false;
              _this9.updateTextureOwnership(false);
              _this9.setUpdateType(UpdateType.IsRenderable);
              // If parent has a render texture, flag that we need to update
              if (_this9.parentHasRenderTexture) {
                _this9.notifyParentRTTOfUpdate();
              }
              _this9.emit('freed', {
                type: 'texture'
              });
            });
            _this9.stage = stage;
            _this9.props = _objectSpread(_objectSpread({}, props), {}, {
              parent: null,
              texture: null,
              src: null,
              rtt: false
            });
            // Assign props to instance
            _this9.parent = props.parent;
            _this9.texture = props.texture;
            _this9.src = props.src;
            _this9.rtt = props.rtt;
            _this9.interactive = props.interactive;
            if (props.boundsMargin) {
              _this9.boundsMargin = Array.isArray(props.boundsMargin) ? props.boundsMargin : [props.boundsMargin, props.boundsMargin, props.boundsMargin, props.boundsMargin];
            }
            _this9.setUpdateType(UpdateType.ScaleRotate | UpdateType.Local | UpdateType.RenderBounds | UpdateType.RenderState);
            if (isProductionEnvironment() === false && props.preventCleanup === true) {
              console.warn('CoreNode.preventCleanup: Is deprecated and will be removed in upcoming release, please use textureOptions.preventCleanup instead');
            }
            // if the default texture isn't loaded yet, wait for it to load
            // this only happens when the node is created before the stage is ready
            if (_this9.stage.defaultTexture && _this9.stage.defaultTexture.state !== 'loaded') {
              _this9.stage.defaultTexture.once('loaded', function () {
                _this9.setUpdateType(UpdateType.IsRenderable);
              });
            }
            return _this9;
          }
          //#region Textures
          _inherits(CoreNode, _EventEmitter5);
          return _createClass(CoreNode, [{
            key: "loadTexture",
            value: function loadTexture() {
              var _this0 = this;
              var texture = this.props.texture;
              assertTruthy(texture);
              // If texture is already loaded / failed, trigger loaded event manually
              // so that users get a consistent event experience.
              // We do this in a microtask to allow listeners to be attached in the same
              // synchronous task after calling loadTexture()
              queueMicrotask(function () {
                var _this0$props$textureO, _this0$props$textureO2;
                if (_this0.textureOptions.preload === true) {
                  _this0.stage.txManager.loadTexture(texture);
                }
                texture.preventCleanup = (_this0$props$textureO = (_this0$props$textureO2 = _this0.props.textureOptions) === null || _this0$props$textureO2 === void 0 ? void 0 : _this0$props$textureO2.preventCleanup) !== null && _this0$props$textureO !== void 0 ? _this0$props$textureO : false;
                texture.on('loaded', _this0.onTextureLoaded);
                texture.on('failed', _this0.onTextureFailed);
                texture.on('freed', _this0.onTextureFreed);
                // If the parent is a render texture, the initial texture status
                // will be set to freed until the texture is processed by the
                // Render RTT nodes. So we only need to listen fo changes and
                // no need to check the texture.state until we restructure how
                // textures are being processed.
                if (_this0.parentHasRenderTexture) {
                  _this0.notifyParentRTTOfUpdate();
                  return;
                }
                if (texture.state === 'loaded') {
                  assertTruthy(texture.dimensions);
                  _this0.onTextureLoaded(texture, texture.dimensions);
                } else if (texture.state === 'failed') {
                  assertTruthy(texture.error);
                  _this0.onTextureFailed(texture, texture.error);
                } else if (texture.state === 'freed') {
                  _this0.onTextureFreed(texture);
                }
              });
            }
          }, {
            key: "unloadTexture",
            value: function unloadTexture() {
              if (this.texture !== null) {
                this.texture.off('loaded', this.onTextureLoaded);
                this.texture.off('failed', this.onTextureFailed);
                this.texture.off('freed', this.onTextureFreed);
                this.texture.setRenderableOwner(this._id, false);
              }
            }
          }, {
            key: "autosizeNode",
            value: function autosizeNode(dimensions) {
              if (this.autosize) {
                this.width = dimensions.width;
                this.height = dimensions.height;
              }
            }
          }, {
            key: "setUpdateType",
            value:
            //#endregion Textures
            /**
             * Change types types is used to determine the scope of the changes being applied
             *
             * @remarks
             * See {@link UpdateType} for more information on each type
             *
             * @param type
             */
            function setUpdateType(type) {
              this.updateType |= type;
              var parent = this.props.parent;
              if (!parent) return;
              if ((parent.updateType & UpdateType.Children) === 0) {
                // Inform the parent if it doesnt already have a child update
                parent.setUpdateType(UpdateType.Children);
              }
            }
          }, {
            key: "sortChildren",
            value: function sortChildren() {
              this.children.sort(function (a, b) {
                return a.calcZIndex - b.calcZIndex;
              });
            }
          }, {
            key: "updateScaleRotateTransform",
            value: function updateScaleRotateTransform() {
              var _this$props = this.props,
                rotation = _this$props.rotation,
                scaleX = _this$props.scaleX,
                scaleY = _this$props.scaleY;
              // optimize simple translation cases
              if (rotation === 0 && scaleX === 1 && scaleY === 1) {
                this.scaleRotateTransform = undefined;
                return;
              }
              this.scaleRotateTransform = Matrix3d.rotate(rotation, this.scaleRotateTransform).scale(scaleX, scaleY);
            }
          }, {
            key: "updateLocalTransform",
            value: function updateLocalTransform() {
              var _this$props$textureOp;
              var _this$props2 = this.props,
                x = _this$props2.x,
                y = _this$props2.y,
                width = _this$props2.width,
                height = _this$props2.height;
              var mountTranslateX = this.props.mountX * width;
              var mountTranslateY = this.props.mountY * height;
              if (this.scaleRotateTransform) {
                var pivotTranslateX = this.props.pivotX * width;
                var pivotTranslateY = this.props.pivotY * height;
                this.localTransform = Matrix3d.translate(x - mountTranslateX + pivotTranslateX, y - mountTranslateY + pivotTranslateY, this.localTransform).multiply(this.scaleRotateTransform).translate(-pivotTranslateX, -pivotTranslateY);
              } else {
                this.localTransform = Matrix3d.translate(x - mountTranslateX, y - mountTranslateY, this.localTransform);
              }
              // Handle 'contain' resize mode
              var texture = this.props.texture;
              if (texture && texture.dimensions && ((_this$props$textureOp = this.props.textureOptions) === null || _this$props$textureOp === void 0 || (_this$props$textureOp = _this$props$textureOp.resizeMode) === null || _this$props$textureOp === void 0 ? void 0 : _this$props$textureOp.type) === 'contain') {
                var resizeModeScaleX = 1;
                var resizeModeScaleY = 1;
                var extraX = 0;
                var extraY = 0;
                var _texture$dimensions = texture.dimensions,
                  tw = _texture$dimensions.width,
                  th = _texture$dimensions.height;
                var txAspectRatio = tw / th;
                var nodeAspectRatio = width / height;
                if (txAspectRatio > nodeAspectRatio) {
                  // Texture is wider than node
                  // Center the node vertically (shift down by extraY)
                  // Scale the node vertically to maintain original aspect ratio
                  var scaleX = width / tw;
                  var scaledTxHeight = th * scaleX;
                  extraY = (height - scaledTxHeight) / 2;
                  resizeModeScaleY = scaledTxHeight / height;
                } else {
                  // Texture is taller than node (or equal)
                  // Center the node horizontally (shift right by extraX)
                  // Scale the node horizontally to maintain original aspect ratio
                  var scaleY = height / th;
                  var scaledTxWidth = tw * scaleY;
                  extraX = (width - scaledTxWidth) / 2;
                  resizeModeScaleX = scaledTxWidth / width;
                }
                // Apply the extra translation and scale to the local transform
                this.localTransform.translate(extraX, extraY).scale(resizeModeScaleX, resizeModeScaleY);
              }
              this.setUpdateType(UpdateType.Global);
            }
            /**
             * @todo: test for correct calculation flag
             * @param delta
             */
          }, {
            key: "update",
            value: function update(delta, parentClippingRect) {
              if (this.updateType & UpdateType.ScaleRotate) {
                this.updateScaleRotateTransform();
                this.setUpdateType(UpdateType.Local);
              }
              if (this.updateType & UpdateType.Local) {
                this.updateLocalTransform();
                this.setUpdateType(UpdateType.Global);
              }
              var parent = this.props.parent;
              var renderState = null;
              // Handle specific RTT updates at this node level
              if (this.updateType & UpdateType.RenderTexture && this.rtt) {
                this.hasRTTupdates = true;
              }
              if (this.updateType & UpdateType.Global) {
                assertTruthy(this.localTransform);
                if (this.parentHasRenderTexture === true && (parent === null || parent === void 0 ? void 0 : parent.rtt) === true) {
                  // we are at the start of the RTT chain, so we need to reset the globalTransform
                  // for correct RTT rendering
                  this.globalTransform = Matrix3d.identity();
                  // Maintain a full scene global transform for bounds detection
                  this.sceneGlobalTransform = Matrix3d.copy((parent === null || parent === void 0 ? void 0 : parent.globalTransform) || Matrix3d.identity()).multiply(this.localTransform);
                } else if (this.parentHasRenderTexture === true && (parent === null || parent === void 0 ? void 0 : parent.rtt) === false) {
                  // we're part of an RTT chain but our parent is not the main RTT node
                  // so we need to propogate the sceneGlobalTransform of the parent
                  // to maintain a full scene global transform for bounds detection
                  this.sceneGlobalTransform = Matrix3d.copy((parent === null || parent === void 0 ? void 0 : parent.sceneGlobalTransform) || this.localTransform).multiply(this.localTransform);
                  this.globalTransform = Matrix3d.copy((parent === null || parent === void 0 ? void 0 : parent.globalTransform) || this.localTransform, this.globalTransform);
                } else {
                  this.globalTransform = Matrix3d.copy((parent === null || parent === void 0 ? void 0 : parent.globalTransform) || this.localTransform, this.globalTransform);
                }
                if (parent !== null) {
                  this.globalTransform.multiply(this.localTransform);
                }
                this.calculateRenderCoords();
                this.updateBoundingRect();
                this.setUpdateType(UpdateType.RenderState | UpdateType.Children);
                this.childUpdateType |= UpdateType.Global;
                if (this.clipping === true) {
                  this.setUpdateType(UpdateType.Clipping | UpdateType.RenderBounds);
                  this.childUpdateType |= UpdateType.RenderBounds;
                }
              }
              if (this.updateType & UpdateType.RenderBounds) {
                this.createRenderBounds();
                this.setUpdateType(UpdateType.RenderState);
                this.setUpdateType(UpdateType.Children);
                this.childUpdateType |= UpdateType.RenderBounds;
              }
              if (this.updateType & UpdateType.RenderState) {
                renderState = this.checkRenderBounds();
                this.setUpdateType(UpdateType.IsRenderable);
                // if we're not going out of bounds, update the render state
                // this is done so the update loop can finish before we mark a node
                // as out of bounds
                if (renderState !== CoreNodeRenderState.OutOfBounds) {
                  this.updateRenderState(renderState);
                }
              }
              if (this.updateType & UpdateType.WorldAlpha) {
                if (parent) {
                  this.worldAlpha = parent.worldAlpha * this.props.alpha;
                } else {
                  this.worldAlpha = this.props.alpha;
                }
                this.setUpdateType(UpdateType.Children | UpdateType.PremultipliedColors | UpdateType.IsRenderable);
                this.childUpdateType |= UpdateType.WorldAlpha;
              }
              if (this.updateType & UpdateType.IsRenderable) {
                this.updateIsRenderable();
              }
              if (this.updateType & UpdateType.Clipping) {
                this.calculateClippingRect(parentClippingRect);
                this.setUpdateType(UpdateType.Children);
                this.childUpdateType |= UpdateType.Clipping;
                this.childUpdateType |= UpdateType.RenderBounds;
              }
              if (this.updateType & UpdateType.PremultipliedColors) {
                this.premultipliedColorTl = mergeColorAlphaPremultiplied(this.props.colorTl, this.worldAlpha, true);
                // If all the colors are the same just sent them all to the same value
                if (this.props.colorTl === this.props.colorTr && this.props.colorBl === this.props.colorBr && this.props.colorTl === this.props.colorBl) {
                  this.premultipliedColorTr = this.premultipliedColorBl = this.premultipliedColorBr = this.premultipliedColorTl;
                } else {
                  this.premultipliedColorTr = mergeColorAlphaPremultiplied(this.props.colorTr, this.worldAlpha, true);
                  this.premultipliedColorBl = mergeColorAlphaPremultiplied(this.props.colorBl, this.worldAlpha, true);
                  this.premultipliedColorBr = mergeColorAlphaPremultiplied(this.props.colorBr, this.worldAlpha, true);
                }
              }
              // No need to update zIndex if there is no parent
              if (parent !== null && this.updateType & UpdateType.CalculatedZIndex) {
                this.calculateZIndex();
                // Tell parent to re-sort children
                parent.setUpdateType(UpdateType.ZIndexSortedChildren);
              }
              if (this.props.strictBounds === true && this.renderState === CoreNodeRenderState.OutOfBounds) {
                this.updateType &= ~UpdateType.RenderBounds; // remove render bounds update
                return;
              }
              if (this.updateType & UpdateType.Children && this.children.length > 0) {
                for (var i = 0, length = this.children.length; i < length; i++) {
                  var child = this.children[i];
                  child.setUpdateType(this.childUpdateType);
                  if (child.updateType === 0) {
                    continue;
                  }
                  var childClippingRect = this.clippingRect;
                  if (this.rtt === true) {
                    childClippingRect = {
                      x: 0,
                      y: 0,
                      width: 0,
                      height: 0,
                      valid: false
                    };
                  }
                  child.update(delta, childClippingRect);
                }
              }
              // If the node has an RTT parent and requires a texture re-render, inform the RTT parent
              // if (this.parentHasRenderTexture && this.updateType & UpdateType.RenderTexture) {
              // @TODO have a more scoped down updateType for RTT updates
              if (this.parentHasRenderTexture && this.updateType > 0) {
                this.notifyParentRTTOfUpdate();
              }
              // Sorting children MUST happen after children have been updated so
              // that they have the oppotunity to update their calculated zIndex.
              if (this.updateType & UpdateType.ZIndexSortedChildren) {
                // reorder z-index
                this.sortChildren();
              }
              // If we're out of bounds, apply the render state now
              // this is done so nodes can finish their entire update loop before
              // being marked as out of bounds
              if (renderState === CoreNodeRenderState.OutOfBounds) {
                this.updateRenderState(renderState);
                this.updateIsRenderable();
                if (this.rtt === true && renderState === CoreNodeRenderState.OutOfBounds) {
                  // notify children that we are going out of bounds
                  // we have to do this now before we stop processing the render tree
                  this.notifyChildrenRTTOfUpdate(renderState);
                  // this.childUpdateType |= UpdateType.RenderState;
                }
              }
              // reset update type
              this.updateType = 0;
              this.childUpdateType = 0;
            }
          }, {
            key: "findParentRTTNode",
            value: function findParentRTTNode() {
              var rttNode = this.parent;
              while (rttNode && !rttNode.rtt) {
                rttNode = rttNode.parent;
              }
              return rttNode;
            }
          }, {
            key: "getRTTParentRenderState",
            value: function getRTTParentRenderState() {
              var rttNode = this.rttParent || this.findParentRTTNode();
              if (!rttNode) {
                return null;
              }
              return rttNode.renderState;
            }
          }, {
            key: "notifyChildrenRTTOfUpdate",
            value: function notifyChildrenRTTOfUpdate(renderState) {
              var _iterator5 = _createForOfIteratorHelper(this.children),
                _step5;
              try {
                for (_iterator5.s(); !(_step5 = _iterator5.n()).done;) {
                  var child = _step5.value;
                  // force child to update render state
                  child.updateRenderState(renderState);
                  child.updateIsRenderable();
                  child.notifyChildrenRTTOfUpdate(renderState);
                }
              } catch (err) {
                _iterator5.e(err);
              } finally {
                _iterator5.f();
              }
            }
          }, {
            key: "notifyParentRTTOfUpdate",
            value: function notifyParentRTTOfUpdate() {
              if (this.parent === null) {
                return;
              }
              var rttNode = this.rttParent || this.findParentRTTNode();
              if (!rttNode) {
                return;
              }
              // If an RTT node is found, mark it for re-rendering
              rttNode.hasRTTupdates = true;
              rttNode.setUpdateType(UpdateType.RenderTexture);
              // if rttNode is nested, also make it update its RTT parent
              if (rttNode.parentHasRenderTexture === true) {
                rttNode.notifyParentRTTOfUpdate();
              }
            }
          }, {
            key: "checkRenderBounds",
            value: function checkRenderBounds() {
              assertTruthy(this.renderBound);
              assertTruthy(this.strictBound);
              assertTruthy(this.preloadBound);
              if (boundInsideBound(this.renderBound, this.strictBound)) {
                return CoreNodeRenderState.InViewport;
              }
              if (boundInsideBound(this.renderBound, this.preloadBound)) {
                return CoreNodeRenderState.InBounds;
              }
              // check if we're larger then our parent, we're definitely in the viewport
              if (boundLargeThanBound(this.renderBound, this.strictBound)) {
                return CoreNodeRenderState.InViewport;
              }
              // check if we dont have dimensions, take our parent's render state
              if (this.parent !== null && (this.props.width === 0 || this.props.height === 0)) {
                return this.parent.renderState;
              }
              return CoreNodeRenderState.OutOfBounds;
            }
          }, {
            key: "updateBoundingRect",
            value: function updateBoundingRect() {
              var transform = this.sceneGlobalTransform || this.globalTransform;
              var renderCoords = this.sceneRenderCoords || this.renderCoords;
              assertTruthy(transform);
              assertTruthy(renderCoords);
              var tb = transform.tb,
                tc = transform.tc;
              var x1 = renderCoords.x1,
                y1 = renderCoords.y1,
                x3 = renderCoords.x3,
                y3 = renderCoords.y3;
              if (tb === 0 || tc === 0) {
                this.renderBound = createBound(x1, y1, x3, y3, this.renderBound);
              } else {
                var x2 = renderCoords.x2,
                  x4 = renderCoords.x4,
                  y2 = renderCoords.y2,
                  y4 = renderCoords.y4;
                this.renderBound = createBound(Math.min(x1, x2, x3, x4), Math.min(y1, y2, y3, y4), Math.max(x1, x2, x3, x4), Math.max(y1, y2, y3, y4), this.renderBound);
              }
            }
          }, {
            key: "createRenderBounds",
            value: function createRenderBounds() {
              assertTruthy(this.stage);
              if (this.parent !== null && this.parent.strictBound !== undefined) {
                // we have a parent with a valid bound, copy it
                var parentBound = this.parent.strictBound;
                this.strictBound = createBound(parentBound.x1, parentBound.y1, parentBound.x2, parentBound.y2);
                this.preloadBound = createPreloadBounds(this.strictBound, this.boundsMargin);
              } else {
                // no parent or parent does not have a bound, take the stage boundaries
                this.strictBound = this.stage.strictBound;
                this.preloadBound = this.stage.preloadBound;
              }
              // if clipping is disabled, we're done
              if (this.props.clipping === false) {
                return;
              }
              // only create local clipping bounds if node itself is in bounds
              // this can only be done if we have a render bound already
              if (this.renderBound === undefined) {
                return;
              }
              // if we're out of bounds, we're done
              if (boundInsideBound(this.renderBound, this.strictBound) === false) {
                return;
              }
              // clipping is enabled and we are in bounds create our own bounds
              var _this$props3 = this.props,
                x = _this$props3.x,
                y = _this$props3.y,
                width = _this$props3.width,
                height = _this$props3.height;
              // Pick the global transform if available, otherwise use the local transform
              // global transform is only available if the node in an RTT chain
              var _ref = this.sceneGlobalTransform || this.globalTransform || {},
                tx = _ref.tx,
                ty = _ref.ty;
              var _x = tx !== null && tx !== void 0 ? tx : x;
              var _y = ty !== null && ty !== void 0 ? ty : y;
              this.strictBound = createBound(_x, _y, _x + width, _y + height, this.strictBound);
              this.preloadBound = createPreloadBounds(this.strictBound, this.boundsMargin);
            }
          }, {
            key: "updateRenderState",
            value: function updateRenderState(renderState) {
              if (renderState === this.renderState) {
                return;
              }
              var previous = this.renderState;
              this.renderState = renderState;
              var event = CoreNodeRenderStateMap.get(renderState);
              assertTruthy(event);
              this.emit(event, {
                previous: previous,
                current: renderState
              });
            }
            /**
             * Updates the `isRenderable` property based on various conditions.
             */
          }, {
            key: "updateIsRenderable",
            value: function updateIsRenderable() {
              var newIsRenderable = false;
              var needsTextureOwnership = false;
              // If the node is out of bounds or has an alpha of 0, it is not renderable
              if (this.checkBasicRenderability() === false) {
                this.updateTextureOwnership(false);
                this.setRenderable(false);
                return;
              }
              if (this.texture !== null) {
                // preemptive check for failed textures this will mark the current node as non-renderable
                // and will prevent further checks until the texture is reloaded or retry is reset on the texture
                if (this.texture.retryCount > this.texture.maxRetryCount) {
                  // texture has failed to load, we cannot render
                  this.updateTextureOwnership(false);
                  this.setRenderable(false);
                  return;
                }
                needsTextureOwnership = true;
                // we're only renderable if the texture state is loaded
                newIsRenderable = this.texture.state === 'loaded';
              } else if ((this.hasShader() || this.hasColorProperties() === true) && this.hasDimensions() === true) {
                // This mean we have dimensions and a color set, so we can render a ColorTexture
                if (this.stage.defaultTexture && this.stage.defaultTexture.state === 'loaded') {
                  newIsRenderable = true;
                }
              }
              this.updateTextureOwnership(needsTextureOwnership);
              this.setRenderable(newIsRenderable);
            }
            /**
             * Checks if the node is renderable based on world alpha, dimensions and out of bounds status.
             */
          }, {
            key: "checkBasicRenderability",
            value: function checkBasicRenderability() {
              if (this.worldAlpha === 0 || this.isOutOfBounds() === true) {
                return false;
              } else {
                return true;
              }
            }
            /**
             * Sets the renderable state and triggers changes if necessary.
             * @param isRenderable - The new renderable state
             */
          }, {
            key: "setRenderable",
            value: function setRenderable(isRenderable) {
              this.isRenderable = isRenderable;
            }
            /**
             * Changes the renderable state of the node.
             */
          }, {
            key: "updateTextureOwnership",
            value: function updateTextureOwnership(isRenderable) {
              var _this$texture;
              (_this$texture = this.texture) === null || _this$texture === void 0 || _this$texture.setRenderableOwner(this._id, isRenderable);
            }
            /**
             * Checks if the node is out of the viewport bounds.
             */
          }, {
            key: "isOutOfBounds",
            value: function isOutOfBounds() {
              return this.renderState <= CoreNodeRenderState.OutOfBounds;
            }
            /**
             * Checks if the node has dimensions (width/height)
             */
          }, {
            key: "hasDimensions",
            value: function hasDimensions() {
              return this.props.width !== 0 && this.props.height !== 0;
            }
            /**
             * Checks if the node has any color properties set.
             */
          }, {
            key: "hasColorProperties",
            value: function hasColorProperties() {
              return this.props.color !== 0 || this.props.colorTop !== 0 || this.props.colorBottom !== 0 || this.props.colorLeft !== 0 || this.props.colorRight !== 0 || this.props.colorTl !== 0 || this.props.colorTr !== 0 || this.props.colorBl !== 0 || this.props.colorBr !== 0;
            }
          }, {
            key: "hasShader",
            value: function hasShader() {
              return this.props.shader !== null;
            }
          }, {
            key: "calculateRenderCoords",
            value: function calculateRenderCoords() {
              var width = this.width,
                height = this.height;
              var _this$globalTransform = this.globalTransform,
                tx = _this$globalTransform.tx,
                ty = _this$globalTransform.ty,
                ta = _this$globalTransform.ta,
                tb = _this$globalTransform.tb,
                tc = _this$globalTransform.tc,
                td = _this$globalTransform.td;
              if (tb === 0 && tc === 0) {
                var minX = tx;
                var maxX = tx + width * ta;
                var minY = ty;
                var maxY = ty + height * td;
                this.renderCoords = RenderCoords.translate(
                //top-left
                minX, minY,
                //top-right
                maxX, minY,
                //bottom-right
                maxX, maxY,
                //bottom-left
                minX, maxY, this.renderCoords);
              } else {
                this.renderCoords = RenderCoords.translate(
                //top-left
                tx, ty,
                //top-right
                tx + width * ta, ty + width * tc,
                //bottom-right
                tx + width * ta + height * tb, ty + width * tc + height * td,
                //bottom-left
                tx + height * tb, ty + height * td, this.renderCoords);
              }
              if (this.sceneGlobalTransform === undefined) {
                return;
              }
              var _this$sceneGlobalTran = this.sceneGlobalTransform,
                stx = _this$sceneGlobalTran.tx,
                sty = _this$sceneGlobalTran.ty,
                sta = _this$sceneGlobalTran.ta,
                stb = _this$sceneGlobalTran.tb,
                stc = _this$sceneGlobalTran.tc,
                std = _this$sceneGlobalTran.td;
              if (stb === 0 && stc === 0) {
                var _minX = stx;
                var _maxX = stx + width * sta;
                var _minY = sty;
                var _maxY = sty + height * std;
                this.sceneRenderCoords = RenderCoords.translate(
                //top-left
                _minX, _minY,
                //top-right
                _maxX, _minY,
                //bottom-right
                _maxX, _maxY,
                //bottom-left
                _minX, _maxY, this.sceneRenderCoords);
              } else {
                this.sceneRenderCoords = RenderCoords.translate(
                //top-left
                stx, sty,
                //top-right
                stx + width * sta, sty + width * stc,
                //bottom-right
                stx + width * sta + height * stb, sty + width * stc + height * std,
                //bottom-left
                stx + height * stb, sty + height * std, this.sceneRenderCoords);
              }
            }
            /**
             * This function calculates the clipping rectangle for a node.
             *
             * The function then checks if the node is rotated. If the node requires clipping and is not rotated, a new clipping rectangle is created based on the node's global transform and dimensions.
             * If a parent clipping rectangle exists, it is intersected with the node's clipping rectangle (if it exists), or replaces the node's clipping rectangle.
             *
             * Finally, the node's parentClippingRect and clippingRect properties are updated.
             */
          }, {
            key: "calculateClippingRect",
            value: function calculateClippingRect(parentClippingRect) {
              assertTruthy(this.globalTransform);
              var clippingRect = this.clippingRect,
                props = this.props,
                gt = this.globalTransform;
              var clipping = props.clipping;
              var isRotated = gt.tb !== 0 || gt.tc !== 0;
              if (clipping === true && isRotated === false) {
                clippingRect.x = gt.tx;
                clippingRect.y = gt.ty;
                clippingRect.width = this.width * gt.ta;
                clippingRect.height = this.height * gt.td;
                clippingRect.valid = true;
              } else {
                clippingRect.valid = false;
              }
              if (parentClippingRect.valid === true && clippingRect.valid === true) {
                // Intersect parent clipping rect with node clipping rect
                intersectRect(parentClippingRect, clippingRect, clippingRect);
              } else if (parentClippingRect.valid === true) {
                // Copy parent clipping rect
                copyRect(parentClippingRect, clippingRect);
                clippingRect.valid = true;
              }
            }
          }, {
            key: "calculateZIndex",
            value: function calculateZIndex() {
              var _props$parent, _props$parent2;
              var props = this.props;
              var z = props.zIndex || 0;
              var p = ((_props$parent = props.parent) === null || _props$parent === void 0 ? void 0 : _props$parent.zIndex) || 0;
              var zIndex = z;
              if ((_props$parent2 = props.parent) !== null && _props$parent2 !== void 0 && _props$parent2.zIndexLocked) {
                zIndex = z < p ? z : p;
              }
              this.calcZIndex = zIndex;
            }
            /**
             * Destroy the node and cleanup all resources
             */
          }, {
            key: "destroy",
            value: function destroy() {
              if (this.destroyed === true) {
                return;
              }
              this.destroyed = true;
              this.unloadTexture();
              this.clippingRect.valid = false;
              this.isRenderable = false;
              this.renderCoords = undefined;
              this.renderBound = undefined;
              this.strictBound = undefined;
              this.preloadBound = undefined;
              this.globalTransform = undefined;
              this.scaleRotateTransform = undefined;
              this.localTransform = undefined;
              this.props.texture = null;
              this.props.shader = this.stage.defShaderCtr;
              while (this.children.length > 0) {
                var _this$children$;
                (_this$children$ = this.children[0]) === null || _this$children$ === void 0 || _this$children$.destroy();
              }
              // This very action will also remove the node from the parent's children array
              this.parent = null;
              if (this.rtt) {
                this.stage.renderer.removeRTTNode(this);
              }
              this.removeAllListeners();
            }
          }, {
            key: "renderQuads",
            value: function renderQuads(renderer) {
              // Prevent quad rendering if parent has a render texture
              // and renderer is not currently rendering to a texture
              if (this.parentHasRenderTexture) {
                if (!renderer.renderToTextureActive) {
                  return;
                }
                // Prevent quad rendering if parent render texture is not the active render texture
                if (this.parentRenderTexture !== renderer.activeRttNode) {
                  return;
                }
              }
              assertTruthy(this.globalTransform);
              assertTruthy(this.renderCoords);
              // add to list of renderables to be sorted before rendering
              renderer.addQuad({
                width: this.props.width,
                height: this.props.height,
                colorTl: this.premultipliedColorTl,
                colorTr: this.premultipliedColorTr,
                colorBl: this.premultipliedColorBl,
                colorBr: this.premultipliedColorBr,
                // if we do not have a texture, use the default texture
                // this assumes any renderable node is either a distinct texture or a ColorTexture
                texture: this.texture || this.stage.defaultTexture,
                textureOptions: this.textureOptions,
                zIndex: this.zIndex,
                shader: this.shader.shader,
                shaderProps: this.shader.getResolvedProps(),
                alpha: this.worldAlpha,
                clippingRect: this.clippingRect,
                tx: this.globalTransform.tx,
                ty: this.globalTransform.ty,
                ta: this.globalTransform.ta,
                tb: this.globalTransform.tb,
                tc: this.globalTransform.tc,
                td: this.globalTransform.td,
                renderCoords: this.renderCoords,
                rtt: this.rtt,
                parentHasRenderTexture: this.parentHasRenderTexture,
                framebufferDimensions: this.framebufferDimensions
              });
            }
            //#region Properties
          }, {
            key: "id",
            get: function get() {
              return this._id;
            }
          }, {
            key: "data",
            get: function get() {
              return this.props.data;
            },
            set: function set(d) {
              this.props.data = d;
            }
          }, {
            key: "x",
            get: function get() {
              return this.props.x;
            },
            set: function set(value) {
              if (this.props.x !== value) {
                this.props.x = value;
                this.setUpdateType(UpdateType.Local);
              }
            }
          }, {
            key: "absX",
            get: function get() {
              var _this$props$parent, _this$props$parent2;
              return this.props.x + -this.props.width * this.props.mountX + (((_this$props$parent = this.props.parent) === null || _this$props$parent === void 0 ? void 0 : _this$props$parent.absX) || ((_this$props$parent2 = this.props.parent) === null || _this$props$parent2 === void 0 || (_this$props$parent2 = _this$props$parent2.globalTransform) === null || _this$props$parent2 === void 0 ? void 0 : _this$props$parent2.tx) || 0);
            }
          }, {
            key: "absY",
            get: function get() {
              var _this$props$parent$ab, _this$props$parent3;
              return this.props.y + -this.props.height * this.props.mountY + ((_this$props$parent$ab = (_this$props$parent3 = this.props.parent) === null || _this$props$parent3 === void 0 ? void 0 : _this$props$parent3.absY) !== null && _this$props$parent$ab !== void 0 ? _this$props$parent$ab : 0);
            }
          }, {
            key: "y",
            get: function get() {
              return this.props.y;
            },
            set: function set(value) {
              if (this.props.y !== value) {
                this.props.y = value;
                this.setUpdateType(UpdateType.Local);
              }
            }
          }, {
            key: "width",
            get: function get() {
              return this.props.width;
            },
            set: function set(value) {
              if (this.props.width !== value) {
                this.props.width = value;
                this.setUpdateType(UpdateType.Local);
                if (this.props.rtt) {
                  this.texture = this.stage.txManager.createTexture('RenderTexture', {
                    width: this.width,
                    height: this.height
                  });
                  this.setUpdateType(UpdateType.RenderTexture);
                }
              }
            }
          }, {
            key: "height",
            get: function get() {
              return this.props.height;
            },
            set: function set(value) {
              if (this.props.height !== value) {
                this.props.height = value;
                this.setUpdateType(UpdateType.Local);
                if (this.props.rtt) {
                  this.texture = this.stage.txManager.createTexture('RenderTexture', {
                    width: this.width,
                    height: this.height
                  });
                  this.setUpdateType(UpdateType.RenderTexture);
                }
              }
            }
          }, {
            key: "scale",
            get: function get() {
              // The CoreNode `scale` property is only used by Animations.
              // Unlike INode, `null` should never be possibility for Animations.
              return this.scaleX;
            },
            set: function set(value) {
              // The CoreNode `scale` property is only used by Animations.
              // Unlike INode, `null` should never be possibility for Animations.
              this.scaleX = value;
              this.scaleY = value;
            }
          }, {
            key: "scaleX",
            get: function get() {
              return this.props.scaleX;
            },
            set: function set(value) {
              if (this.props.scaleX !== value) {
                this.props.scaleX = value;
                this.setUpdateType(UpdateType.ScaleRotate);
              }
            }
          }, {
            key: "scaleY",
            get: function get() {
              return this.props.scaleY;
            },
            set: function set(value) {
              if (this.props.scaleY !== value) {
                this.props.scaleY = value;
                this.setUpdateType(UpdateType.ScaleRotate);
              }
            }
          }, {
            key: "mount",
            get: function get() {
              return this.props.mount;
            },
            set: function set(value) {
              if (this.props.mountX !== value || this.props.mountY !== value) {
                this.props.mountX = value;
                this.props.mountY = value;
                this.props.mount = value;
                this.setUpdateType(UpdateType.Local);
              }
            }
          }, {
            key: "mountX",
            get: function get() {
              return this.props.mountX;
            },
            set: function set(value) {
              if (this.props.mountX !== value) {
                this.props.mountX = value;
                this.setUpdateType(UpdateType.Local);
              }
            }
          }, {
            key: "mountY",
            get: function get() {
              return this.props.mountY;
            },
            set: function set(value) {
              if (this.props.mountY !== value) {
                this.props.mountY = value;
                this.setUpdateType(UpdateType.Local);
              }
            }
          }, {
            key: "pivot",
            get: function get() {
              return this.props.pivot;
            },
            set: function set(value) {
              if (this.props.pivotX !== value || this.props.pivotY !== value) {
                this.props.pivotX = value;
                this.props.pivotY = value;
                this.props.pivot = value;
                this.setUpdateType(UpdateType.Local);
              }
            }
          }, {
            key: "pivotX",
            get: function get() {
              return this.props.pivotX;
            },
            set: function set(value) {
              if (this.props.pivotX !== value) {
                this.props.pivotX = value;
                this.setUpdateType(UpdateType.Local);
              }
            }
          }, {
            key: "pivotY",
            get: function get() {
              return this.props.pivotY;
            },
            set: function set(value) {
              if (this.props.pivotY !== value) {
                this.props.pivotY = value;
                this.setUpdateType(UpdateType.Local);
              }
            }
          }, {
            key: "rotation",
            get: function get() {
              return this.props.rotation;
            },
            set: function set(value) {
              if (this.props.rotation !== value) {
                this.props.rotation = value;
                this.setUpdateType(UpdateType.ScaleRotate);
              }
            }
          }, {
            key: "alpha",
            get: function get() {
              return this.props.alpha;
            },
            set: function set(value) {
              this.props.alpha = value;
              this.setUpdateType(UpdateType.PremultipliedColors | UpdateType.WorldAlpha | UpdateType.Children | UpdateType.IsRenderable);
              this.childUpdateType |= UpdateType.WorldAlpha;
            }
          }, {
            key: "autosize",
            get: function get() {
              return this.props.autosize;
            },
            set: function set(value) {
              this.props.autosize = value;
            }
          }, {
            key: "boundsMargin",
            get: function get() {
              var _ref2, _this$props$boundsMar, _this$parent;
              return (_ref2 = (_this$props$boundsMar = this.props.boundsMargin) !== null && _this$props$boundsMar !== void 0 ? _this$props$boundsMar : (_this$parent = this.parent) === null || _this$parent === void 0 ? void 0 : _this$parent.boundsMargin) !== null && _ref2 !== void 0 ? _ref2 : this.stage.boundsMargin;
            },
            set: function set(value) {
              if (value === this.props.boundsMargin) {
                return;
              }
              if (value === null) {
                this.props.boundsMargin = value;
              } else {
                var bm = Array.isArray(value) ? value : [value, value, value, value];
                this.props.boundsMargin = bm;
              }
              this.setUpdateType(UpdateType.RenderBounds);
            }
          }, {
            key: "clipping",
            get: function get() {
              return this.props.clipping;
            },
            set: function set(value) {
              this.props.clipping = value;
              this.setUpdateType(UpdateType.Clipping | UpdateType.RenderBounds | UpdateType.Children);
              this.childUpdateType |= UpdateType.Global | UpdateType.Clipping;
            }
          }, {
            key: "color",
            get: function get() {
              return this.props.color;
            },
            set: function set(value) {
              this.colorTop = value;
              this.colorBottom = value;
              this.colorLeft = value;
              this.colorRight = value;
              this.props.color = value;
              this.setUpdateType(UpdateType.PremultipliedColors);
            }
          }, {
            key: "colorTop",
            get: function get() {
              return this.props.colorTop;
            },
            set: function set(value) {
              if (this.props.colorTl !== value || this.props.colorTr !== value) {
                this.colorTl = value;
                this.colorTr = value;
              }
              this.props.colorTop = value;
              this.setUpdateType(UpdateType.PremultipliedColors);
            }
          }, {
            key: "colorBottom",
            get: function get() {
              return this.props.colorBottom;
            },
            set: function set(value) {
              if (this.props.colorBl !== value || this.props.colorBr !== value) {
                this.colorBl = value;
                this.colorBr = value;
              }
              this.props.colorBottom = value;
              this.setUpdateType(UpdateType.PremultipliedColors);
            }
          }, {
            key: "colorLeft",
            get: function get() {
              return this.props.colorLeft;
            },
            set: function set(value) {
              if (this.props.colorTl !== value || this.props.colorBl !== value) {
                this.colorTl = value;
                this.colorBl = value;
              }
              this.props.colorLeft = value;
              this.setUpdateType(UpdateType.PremultipliedColors);
            }
          }, {
            key: "colorRight",
            get: function get() {
              return this.props.colorRight;
            },
            set: function set(value) {
              if (this.props.colorTr !== value || this.props.colorBr !== value) {
                this.colorTr = value;
                this.colorBr = value;
              }
              this.props.colorRight = value;
              this.setUpdateType(UpdateType.PremultipliedColors);
            }
          }, {
            key: "colorTl",
            get: function get() {
              return this.props.colorTl;
            },
            set: function set(value) {
              this.props.colorTl = value;
              this.setUpdateType(UpdateType.PremultipliedColors);
            }
          }, {
            key: "colorTr",
            get: function get() {
              return this.props.colorTr;
            },
            set: function set(value) {
              this.props.colorTr = value;
              this.setUpdateType(UpdateType.PremultipliedColors);
            }
          }, {
            key: "colorBl",
            get: function get() {
              return this.props.colorBl;
            },
            set: function set(value) {
              this.props.colorBl = value;
              this.setUpdateType(UpdateType.PremultipliedColors);
            }
          }, {
            key: "colorBr",
            get: function get() {
              return this.props.colorBr;
            },
            set: function set(value) {
              this.props.colorBr = value;
              this.setUpdateType(UpdateType.PremultipliedColors);
            }
            // we're only interested in parent zIndex to test
            // if we should use node zIndex is higher then parent zIndex
          }, {
            key: "zIndexLocked",
            get: function get() {
              return this.props.zIndexLocked || 0;
            },
            set: function set(value) {
              this.props.zIndexLocked = value;
              this.setUpdateType(UpdateType.CalculatedZIndex | UpdateType.Children);
              for (var i = 0, length = this.children.length; i < length; i++) {
                this.children[i].setUpdateType(UpdateType.CalculatedZIndex);
              }
            }
          }, {
            key: "zIndex",
            get: function get() {
              return this.props.zIndex;
            },
            set: function set(value) {
              this.props.zIndex = value;
              this.setUpdateType(UpdateType.CalculatedZIndex | UpdateType.Children);
              for (var i = 0, length = this.children.length; i < length; i++) {
                this.children[i].setUpdateType(UpdateType.CalculatedZIndex);
              }
            }
          }, {
            key: "parent",
            get: function get() {
              return this.props.parent;
            },
            set: function set(newParent) {
              var oldParent = this.props.parent;
              if (oldParent === newParent) {
                return;
              }
              this.props.parent = newParent;
              if (oldParent) {
                var index = oldParent.children.indexOf(this);
                assertTruthy(index !== -1, "CoreNode.parent: Node not found in old parent's children!");
                oldParent.children.splice(index, 1);
                oldParent.setUpdateType(UpdateType.Children | UpdateType.ZIndexSortedChildren);
              }
              if (newParent) {
                newParent.children.push(this);
                // Since this node has a new parent, to be safe, have it do a full update.
                this.setUpdateType(UpdateType.All);
                // Tell parent that it's children need to be updated and sorted.
                newParent.setUpdateType(UpdateType.Children | UpdateType.ZIndexSortedChildren);
                // If the new parent has an RTT enabled, apply RTT inheritance
                if (newParent.rtt || newParent.parentHasRenderTexture) {
                  this.applyRTTInheritance(newParent);
                }
              }
              this.updateScaleRotateTransform();
              // fetch render bounds from parent
              this.setUpdateType(UpdateType.RenderBounds | UpdateType.Children);
            }
          }, {
            key: "preventCleanup",
            get: function get() {
              return this.props.textureOptions.preventCleanup || false;
            },
            set: function set(value) {
              if (isProductionEnvironment() === false) {
                console.warn('CoreNode.preventCleanup: Is deprecated and will be removed in upcoming release, please use textureOptions.preventCleanup instead');
              }
              this.props.textureOptions.preventCleanup = value;
            }
          }, {
            key: "rtt",
            get: function get() {
              return this.props.rtt;
            },
            set: function set(value) {
              if (this.props.rtt === value) {
                return;
              }
              this.props.rtt = value;
              if (value === true) {
                this.initRenderTexture();
                this.markChildrenWithRTT();
              } else {
                this.cleanupRenderTexture();
              }
              this.setUpdateType(UpdateType.RenderTexture);
              if (this.parentHasRenderTexture === true) {
                this.notifyParentRTTOfUpdate();
              }
            }
          }, {
            key: "initRenderTexture",
            value: function initRenderTexture() {
              this.texture = this.stage.txManager.createTexture('RenderTexture', {
                width: this.width,
                height: this.height
              });
              this.stage.renderer.renderToTexture(this);
            }
          }, {
            key: "cleanupRenderTexture",
            value: function cleanupRenderTexture() {
              this.unloadTexture();
              this.clearRTTInheritance();
              this.hasRTTupdates = false;
              this.texture = null;
            }
          }, {
            key: "markChildrenWithRTT",
            value: function markChildrenWithRTT() {
              var node = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;
              var parent = node || this;
              var _iterator6 = _createForOfIteratorHelper(parent.children),
                _step6;
              try {
                for (_iterator6.s(); !(_step6 = _iterator6.n()).done;) {
                  var child = _step6.value;
                  child.setUpdateType(UpdateType.All);
                  child.parentHasRenderTexture = true;
                  child.markChildrenWithRTT();
                }
              } catch (err) {
                _iterator6.e(err);
              } finally {
                _iterator6.f();
              }
            }
            // Apply RTT inheritance when a node has an RTT-enabled parent
          }, {
            key: "applyRTTInheritance",
            value: function applyRTTInheritance(parent) {
              if (parent.rtt) {
                // Only the RTT node should be added to `renderToTexture`
                parent.setUpdateType(UpdateType.RenderTexture);
              }
              // Propagate `parentHasRenderTexture` downwards
              this.markChildrenWithRTT(parent);
            }
            // Clear RTT inheritance when detaching from an RTT chain
          }, {
            key: "clearRTTInheritance",
            value: function clearRTTInheritance() {
              // if this node is RTT itself stop the propagation important for nested RTT nodes
              // for the initial RTT node this is already handled in `set rtt`
              if (this.rtt) {
                return;
              }
              var _iterator7 = _createForOfIteratorHelper(this.children),
                _step7;
              try {
                for (_iterator7.s(); !(_step7 = _iterator7.n()).done;) {
                  var child = _step7.value;
                  // force child to update everything as the RTT inheritance has changed
                  child.parentHasRenderTexture = false;
                  child.rttParent = null;
                  child.setUpdateType(UpdateType.All);
                  child.clearRTTInheritance();
                }
              } catch (err) {
                _iterator7.e(err);
              } finally {
                _iterator7.f();
              }
            }
          }, {
            key: "shader",
            get: function get() {
              return this.props.shader;
            },
            set: function set(value) {
              if (this.props.shader === value) {
                return;
              }
              this.props.shader = value;
              this.setUpdateType(UpdateType.IsRenderable);
            }
          }, {
            key: "src",
            get: function get() {
              return this.props.src;
            },
            set: function set(imageUrl) {
              if (this.props.src === imageUrl) {
                return;
              }
              this.props.src = imageUrl;
              if (!imageUrl) {
                this.texture = null;
                return;
              }
              this.texture = this.stage.txManager.createTexture('ImageTexture', {
                src: imageUrl,
                width: this.props.width,
                height: this.props.height,
                type: this.props.imageType,
                sx: this.props.srcX,
                sy: this.props.srcY,
                sw: this.props.srcWidth,
                sh: this.props.srcHeight,
                maxRetryCount: this.props.textureOptions.maxRetryCount
              });
            }
          }, {
            key: "imageType",
            get: function get() {
              return this.props.imageType || null;
            },
            set: function set(type) {
              if (this.props.imageType === type) {
                return;
              }
              this.props.imageType = type;
            }
          }, {
            key: "srcHeight",
            get: function get() {
              return this.props.srcHeight;
            },
            set: function set(value) {
              this.props.srcHeight = value;
            }
          }, {
            key: "srcWidth",
            get: function get() {
              return this.props.srcWidth;
            },
            set: function set(value) {
              this.props.srcWidth = value;
            }
          }, {
            key: "srcX",
            get: function get() {
              return this.props.srcX;
            },
            set: function set(value) {
              this.props.srcX = value;
            }
          }, {
            key: "srcY",
            get: function get() {
              return this.props.srcY;
            },
            set: function set(value) {
              this.props.srcY = value;
            }
            /**
             * Returns the framebuffer dimensions of the node.
             * If the node has a render texture, the dimensions are the same as the node's dimensions.
             * If the node does not have a render texture, the dimensions are inherited from the parent.
             * If the node parent has a render texture and the node is a render texture, the nodes dimensions are used.
             */
          }, {
            key: "framebufferDimensions",
            get: function get() {
              if (this.parentHasRenderTexture && !this.rtt && this.parent) {
                return this.parent.framebufferDimensions;
              }
              return {
                width: this.width,
                height: this.height
              };
            }
            /**
             * Returns the parent render texture node if it exists.
             */
          }, {
            key: "parentRenderTexture",
            get: function get() {
              var parent = this.parent;
              while (parent) {
                if (parent.rtt) {
                  return parent;
                }
                parent = parent.parent;
              }
              return null;
            }
          }, {
            key: "texture",
            get: function get() {
              return this.props.texture;
            },
            set: function set(value) {
              if (this.props.texture === value) {
                return;
              }
              var oldTexture = this.props.texture;
              if (oldTexture) {
                this.unloadTexture();
              }
              this.props.texture = value;
              if (value !== null) {
                value.setRenderableOwner(this._id, this.isRenderable);
                this.loadTexture();
              }
              this.setUpdateType(UpdateType.IsRenderable);
            }
          }, {
            key: "textureOptions",
            get: function get() {
              return this.props.textureOptions;
            },
            set: function set(value) {
              this.props.textureOptions = value;
            }
          }, {
            key: "strictBounds",
            get: function get() {
              return this.props.strictBounds;
            },
            set: function set(v) {
              if (v === this.props.strictBounds) {
                return;
              }
              this.props.strictBounds = v;
              this.setUpdateType(UpdateType.RenderBounds | UpdateType.Children);
              this.childUpdateType |= UpdateType.RenderBounds | UpdateType.Children;
            }
          }, {
            key: "interactive",
            get: function get() {
              return this.props.interactive;
            },
            set: function set(value) {
              this.props.interactive = value;
              // Update Stage's interactive Set
              if (value === true) {
                this.stage.interactiveNodes.add(this);
              }
            }
          }, {
            key: "animate",
            value: function animate(props, settings) {
              var animation = new CoreAnimation(this, props, settings);
              var controller = new CoreAnimationController(this.stage.animationManager, animation);
              return controller;
            }
          }, {
            key: "flush",
            value: function flush() {
              // no-op
            }
          }]);
        }(EventEmitter);
        /*
         * If not stated otherwise in this file or this component's LICENSE file the
         * following copyright and licenses apply:
         *
         * Copyright 2023 Comcast Cable Communications Management, LLC.
         *
         * Licensed under the Apache License, Version 2.0 (the License);
         * you may not use this file except in compliance with the License.
         * You may obtain a copy of the License at
         *
         * http://www.apache.org/licenses/LICENSE-2.0
         *
         * Unless required by applicable law or agreed to in writing, software
         * distributed under the License is distributed on an "AS IS" BASIS,
         * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
         * See the License for the specific language governing permissions and
         * limitations under the License.
         */
        /**
         * Platform render loop initiator
         */
        var startLoop = function startLoop(stage) {
          var isIdle = false;
          var lastFrameTime = 0;
          var _runLoop = function runLoop() {
            var currentTime = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;
            var targetFrameTime = stage.targetFrameTime;
            // Check if we should throttle this frame
            if (targetFrameTime > 0 && currentTime - lastFrameTime < targetFrameTime) {
              // Too early for next frame, schedule with setTimeout for precise timing
              var _delay = targetFrameTime - (currentTime - lastFrameTime);
              setTimeout(function () {
                return requestAnimationFrame(_runLoop);
              }, _delay);
              return;
            }
            lastFrameTime = currentTime;
            stage.updateFrameTime();
            stage.updateAnimations();
            if (!stage.hasSceneUpdates()) {
              // We still need to calculate the fps else it looks like the app is frozen
              stage.calculateFps();
              if (targetFrameTime > 0) {
                // Use setTimeout for throttled idle frames
                setTimeout(function () {
                  return requestAnimationFrame(_runLoop);
                }, Math.max(targetFrameTime, 16.666666666666668));
              } else {
                // Use standard idle timeout when not throttling
                setTimeout(function () {
                  return requestAnimationFrame(_runLoop);
                }, 16.666666666666668);
              }
              if (!isIdle) {
                stage.eventBus.emit('idle');
                isIdle = true;
              }
              if (stage.txMemManager.checkCleanup() === true) {
                stage.txMemManager.cleanup();
              }
              stage.flushFrameEvents();
              return;
            }
            isIdle = false;
            stage.drawFrame();
            stage.flushFrameEvents();
            // Schedule next frame
            if (targetFrameTime > 0) {
              // Use setTimeout + rAF combination for precise FPS control
              var nextFrameDelay = Math.max(0, targetFrameTime - (performance.now() - currentTime));
              setTimeout(function () {
                return requestAnimationFrame(_runLoop);
              }, nextFrameDelay);
            } else {
              // Use standard rAF when not throttling
              requestAnimationFrame(_runLoop);
            }
          };
          requestAnimationFrame(_runLoop);
        };
        /**
         * Return unix timestamp
         * @return {number}
         */
        var getTimeStamp = function getTimeStamp() {
          return performance ? performance.now() : Date.now();
        };

        /*
         * If not stated otherwise in this file or this component's LICENSE file the
         * following copyright and licenses apply:
         *
         * Copyright 2023 Comcast Cable Communications Management, LLC.
         *
         * Licensed under the Apache License, Version 2.0 (the License);
         * you may not use this file except in compliance with the License.
         * You may obtain a copy of the License at
         *
         * http://www.apache.org/licenses/LICENSE-2.0
         *
         * Unless required by applicable law or agreed to in writing, software
         * distributed under the License is distributed on an "AS IS" BASIS,
         * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
         * See the License for the specific language governing permissions and
         * limitations under the License.
         */
        var AnimationManager = /*#__PURE__*/function () {
          function AnimationManager() {
            _classCallCheck(this, AnimationManager);
            _defineProperty(this, "activeAnimations", new Set());
          }
          return _createClass(AnimationManager, [{
            key: "registerAnimation",
            value: function registerAnimation(animation) {
              this.activeAnimations.add(animation);
            }
          }, {
            key: "unregisterAnimation",
            value: function unregisterAnimation(animation) {
              this.activeAnimations.delete(animation);
            }
          }, {
            key: "update",
            value: function update(dt) {
              this.activeAnimations.forEach(function (animation) {
                animation.update(dt);
              });
            }
          }]);
        }();
        /*
         * If not stated otherwise in this file or this component's LICENSE file the
         * following copyright and licenses apply:
         *
         * Copyright 2023 Comcast Cable Communications Management, LLC.
         *
         * Licensed under the Apache License, Version 2.0 (the License);
         * you may not use this file except in compliance with the License.
         * You may obtain a copy of the License at
         *
         * http://www.apache.org/licenses/LICENSE-2.0
         *
         * Unless required by applicable law or agreed to in writing, software
         * distributed under the License is distributed on an "AS IS" BASIS,
         * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
         * See the License for the specific language governing permissions and
         * limitations under the License.
         */
        /**
         * Note that, within the createImageWorker function, we must only use ES5 code to keep it ES5-valid after babelifying, as
         *  the converted code of this section is converted to a blob and used as the js of the web worker thread.
         *
         * The createImageWorker function is a web worker that fetches an image from a URL and returns an ImageBitmap object.
         * The eslint @typescript rule is disabled for the entire function because the function is converted to a blob and used as the
         * js of the web worker thread, so the typescript syntax is not valid in this context.
         */
        /* eslint-disable */
        function createImageWorker() {
          function hasAlphaChannel(mimeType) {
            return mimeType.indexOf('image/png') !== -1;
          }
          function getImage(src, premultiplyAlpha, x, y, width, height, options) {
            return new Promise(function (resolve, reject) {
              var xhr = new XMLHttpRequest();
              xhr.open('GET', src, true);
              xhr.responseType = 'blob';
              xhr.onload = function () {
                // On most devices like WebOS and Tizen, the file protocol returns 0 while http(s) protocol returns 200
                if (xhr.status !== 200 && xhr.status !== 0) {
                  return reject(new Error('Failed to load image: ' + xhr.statusText));
                }
                var blob = xhr.response;
                premultiplyAlpha !== undefined ? premultiplyAlpha : hasAlphaChannel(blob.type);
                // createImageBitmap with crop and options
                {
                  // Fallback for browsers that do not support createImageBitmap with options
                  // this is supported for Chrome v50 to v52/54 that doesn't support options
                  createImageBitmap(blob).then(function (data) {
                    resolve({
                      data: data,
                      premultiplyAlpha: premultiplyAlpha
                    });
                  }).catch(function (error) {
                    reject(error);
                  });
                }
              };
              xhr.onerror = function () {
                reject(new Error('Network error occurred while trying to fetch the image.'));
              };
              xhr.send();
            });
          }
          self.onmessage = function (event) {
            var src = event.data.src;
            var id = event.data.id;
            var premultiplyAlpha = event.data.premultiplyAlpha;
            event.data.sx;
            event.data.sy;
            event.data.sw;
            event.data.sh;
            getImage(src, premultiplyAlpha).then(function (data) {
              // @ts-ignore ts has wrong postMessage signature
              self.postMessage({
                id: id,
                src: src,
                data: data
              }, [data.data]);
            }).catch(function (error) {
              self.postMessage({
                id: id,
                src: src,
                error: error.message
              });
            });
          };
        }
        /* eslint-enable */
        var ImageWorkerManager = /*#__PURE__*/function () {
          function ImageWorkerManager(numImageWorkers, createImageBitmapSupport) {
            var _this1 = this;
            _classCallCheck(this, ImageWorkerManager);
            _defineProperty(this, "imageWorkersEnabled", true);
            _defineProperty(this, "messageManager", {});
            _defineProperty(this, "workers", []);
            _defineProperty(this, "workerIndex", 0);
            _defineProperty(this, "nextId", 0);
            this.workers = this.createWorkers(numImageWorkers, createImageBitmapSupport);
            this.workers.forEach(function (worker) {
              worker.onmessage = _this1.handleMessage.bind(_this1);
            });
          }
          return _createClass(ImageWorkerManager, [{
            key: "handleMessage",
            value: function handleMessage(event) {
              var _event$data = event.data,
                id = _event$data.id,
                data = _event$data.data,
                error = _event$data.error;
              var msg = this.messageManager[id];
              if (msg) {
                var _msg = _slicedToArray(msg, 2),
                  resolve = _msg[0],
                  reject = _msg[1];
                delete this.messageManager[id];
                if (error) {
                  reject(new Error(error));
                } else {
                  resolve(data);
                }
              }
            }
          }, {
            key: "createWorkers",
            value: function createWorkers() {
              var numWorkers = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 1;
              var createImageBitmapSupport = arguments.length > 1 ? arguments[1] : undefined;
              var workerCode = "(".concat(createImageWorker.toString(), ")()");
              // Replace placeholders with actual initialization values
              if (createImageBitmapSupport.options === true) {
                workerCode = workerCode.replace('var supportsOptionsCreateImageBitmap = false;', 'var supportsOptionsCreateImageBitmap = true;');
              }
              if (createImageBitmapSupport.full === true) {
                workerCode = workerCode.replace('var supportsOptionsCreateImageBitmap = false;', 'var supportsOptionsCreateImageBitmap = true;');
                workerCode = workerCode.replace('var supportsFullCreateImageBitmap = false;', 'var supportsFullCreateImageBitmap = true;');
              }
              workerCode = workerCode.replace('"use strict";', '');
              var blob = new Blob([workerCode], {
                type: 'application/javascript'
              });
              var blobURL = (self.URL ? URL : webkitURL).createObjectURL(blob);
              var workers = [];
              for (var i = 0; i < numWorkers; i++) {
                workers.push(new Worker(blobURL));
              }
              return workers;
            }
          }, {
            key: "getNextWorker",
            value: function getNextWorker() {
              var worker = this.workers[this.workerIndex];
              this.workerIndex = (this.workerIndex + 1) % this.workers.length;
              return worker;
            }
          }, {
            key: "getImage",
            value: function getImage(src, premultiplyAlpha, sx, sy, sw, sh) {
              var _this10 = this;
              return new Promise(function (resolve, reject) {
                try {
                  if (_this10.workers) {
                    var id = _this10.nextId++;
                    _this10.messageManager[id] = [resolve, reject];
                    var nextWorker = _this10.getNextWorker();
                    if (nextWorker) {
                      nextWorker.postMessage({
                        id: id,
                        src: src,
                        premultiplyAlpha: premultiplyAlpha,
                        sx: sx,
                        sy: sy,
                        sw: sw,
                        sh: sh
                      });
                    }
                  }
                } catch (error) {
                  reject(error);
                }
              });
            }
          }]);
        }();
        /*
         * If not stated otherwise in this file or this component's LICENSE file the
         * following copyright and licenses apply:
         *
         * Copyright 2023 Comcast Cable Communications Management, LLC.
         *
         * Licensed under the Apache License, Version 2.0 (the License);
         * you may not use this file except in compliance with the License.
         * You may obtain a copy of the License at
         *
         * http://www.apache.org/licenses/LICENSE-2.0
         *
         * Unless required by applicable law or agreed to in writing, software
         * distributed under the License is distributed on an "AS IS" BASIS,
         * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
         * See the License for the specific language governing permissions and
         * limitations under the License.
         */
        /**
         * Texture consisting of only a 1x1 color pixel
         *
         * @remarks
         * The pixel color is set with the {@link ColorTextureProps.color} prop.
         *
         * This is the default texture used for a Node if it's
         * {@link INodeProps.texture} prop is set to `null` (the default)
         *
         * Generally the 1x1 color pixel is stretched to whatever the set dimensions of
         * a Node are.
         */
        var ColorTexture = /*#__PURE__*/function (_Texture2) {
          function ColorTexture(txManager, props) {
            var _this11;
            _classCallCheck(this, ColorTexture);
            _this11 = _callSuper(this, ColorTexture, [txManager]);
            _defineProperty(_this11, "type", TextureType.color);
            _defineProperty(_this11, "props", void 0);
            _this11.props = ColorTexture.resolveDefaults(props);
            return _this11;
          }
          _inherits(ColorTexture, _Texture2);
          return _createClass(ColorTexture, [{
            key: "color",
            get: function get() {
              return this.props.color;
            },
            set: function set(color) {
              this.props.color = color;
            }
          }, {
            key: "getTextureSource",
            value: function () {
              var _getTextureSource = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee2() {
                var pixelData;
                return _regenerator().w(function (_context2) {
                  while (1) switch (_context2.n) {
                    case 0:
                      pixelData = new Uint8Array(4);
                      if (this.color === 0xffffffff) {
                        pixelData[0] = 255;
                        pixelData[1] = 255;
                        pixelData[2] = 255;
                        pixelData[3] = 255;
                      } else {
                        pixelData[0] = this.color >> 16 & 0xff; // Red
                        pixelData[1] = this.color >> 8 & 0xff; // Green
                        pixelData[2] = this.color & 0xff; // Blue
                        pixelData[3] = this.color >>> 24 & 0xff; // Alpha
                      }
                      return _context2.a(2, {
                        data: pixelData,
                        premultiplyAlpha: true
                      });
                  }
                }, _callee2, this);
              }));
              function getTextureSource() {
                return _getTextureSource.apply(this, arguments);
              }
              return getTextureSource;
            }()
          }], [{
            key: "makeCacheKey",
            value: function makeCacheKey(props) {
              var resolvedProps = ColorTexture.resolveDefaults(props);
              return "ColorTexture,".concat(resolvedProps.color);
            }
          }, {
            key: "resolveDefaults",
            value: function resolveDefaults(props) {
              return {
                color: props.color || 0xffffffff
              };
            }
          }]);
        }(Texture);
        /*
         * If not stated otherwise in this file or this component's LICENSE file the
         * following copyright and licenses apply:
         *
         * Copyright 2023 Comcast Cable Communications Management, LLC.
         *
         * Licensed under the Apache License, Version 2.0 (the License);
         * you may not use this file except in compliance with the License.
         * You may obtain a copy of the License at
         *
         * http://www.apache.org/licenses/LICENSE-2.0
         *
         * Unless required by applicable law or agreed to in writing, software
         * distributed under the License is distributed on an "AS IS" BASIS,
         * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
         * See the License for the specific language governing permissions and
         * limitations under the License.
         */
        /**
         * Tests if the given location is a compressed texture container
         * @param url
         * @remarks
         * This function is used to determine if the given image url is a compressed
         * and only supports the following extensions: .ktx and .pvr
         * @returns
         */
        _defineProperty(ColorTexture, "z$__type__Props", void 0);
        function isCompressedTextureContainer(url) {
          return /\.(ktx|pvr)$/.test(url);
        }
        /**
         * Loads a compressed texture container
         * @param url
         * @returns
         */
        var loadCompressedTexture = /*#__PURE__*/function () {
          var _ref3 = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee3(url) {
            var response, arrayBuffer, _t;
            return _regenerator().w(function (_context3) {
              while (1) switch (_context3.p = _context3.n) {
                case 0:
                  _context3.p = 0;
                  _context3.n = 1;
                  return fetch(url);
                case 1:
                  response = _context3.v;
                  if (response.ok) {
                    _context3.n = 2;
                    break;
                  }
                  throw new Error("Failed to fetch compressed texture: ".concat(response.status, " ").concat(response.statusText));
                case 2:
                  _context3.n = 3;
                  return response.arrayBuffer();
                case 3:
                  arrayBuffer = _context3.v;
                  if (!(url.indexOf('.ktx') !== -1)) {
                    _context3.n = 4;
                    break;
                  }
                  return _context3.a(2, loadKTXData(arrayBuffer));
                case 4:
                  return _context3.a(2, loadPVRData(arrayBuffer));
                case 5:
                  _context3.p = 5;
                  _t = _context3.v;
                  throw new Error("Failed to load compressed texture from ".concat(url, ": ").concat(_t));
                case 6:
                  return _context3.a(2);
              }
            }, _callee3, null, [[0, 5]]);
          }));
          return function loadCompressedTexture(_x2) {
            return _ref3.apply(this, arguments);
          };
        }();
        /**
         * Loads a KTX texture container and returns the texture data
         * @param buffer
         * @returns
         */
        var loadKTXData = /*#__PURE__*/function () {
          var _ref4 = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee4(buffer) {
            var view, littleEndian, mipmaps, data, offset, i, imageSize;
            return _regenerator().w(function (_context4) {
              while (1) switch (_context4.n) {
                case 0:
                  view = new DataView(buffer);
                  littleEndian = view.getUint32(12) === 16909060 ? true : false;
                  mipmaps = [];
                  data = {
                    glInternalFormat: view.getUint32(28, littleEndian),
                    pixelWidth: view.getUint32(36, littleEndian),
                    pixelHeight: view.getUint32(40, littleEndian),
                    numberOfMipmapLevels: view.getUint32(56, littleEndian),
                    bytesOfKeyValueData: view.getUint32(60, littleEndian)
                  };
                  offset = 64; // Key Value Pairs of data start at byte offset 64
                  // But the only known kvp is the API version, so skipping parsing.
                  offset += data.bytesOfKeyValueData;
                  for (i = 0; i < data.numberOfMipmapLevels; i++) {
                    imageSize = view.getUint32(offset);
                    offset += 4;
                    mipmaps.push(view.buffer.slice(offset, imageSize));
                    offset += imageSize;
                  }
                  return _context4.a(2, {
                    data: {
                      glInternalFormat: data.glInternalFormat,
                      mipmaps: mipmaps,
                      width: data.pixelWidth || 0,
                      height: data.pixelHeight || 0,
                      type: 'ktx'
                    },
                    premultiplyAlpha: false
                  });
              }
            }, _callee4);
          }));
          return function loadKTXData(_x3) {
            return _ref4.apply(this, arguments);
          };
        }();
        /**
         * Loads a PVR texture container and returns the texture data
         * @param buffer
         * @returns
         */
        var loadPVRData = /*#__PURE__*/function () {
          var _ref5 = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee5(buffer) {
            var pvrHeaderLength, pvrFormatEtc1, pvrWidth, pvrHeight, pvrMipmapCount, pvrMetadata, arrayBuffer, header, dataOffset, pvrtcData, mipmaps, data, offset, width, height, i, level, view;
            return _regenerator().w(function (_context5) {
              while (1) switch (_context5.n) {
                case 0:
                  // pvr header length in 32 bits
                  pvrHeaderLength = 13; // for now only we only support: COMPRESSED_RGB_ETC1_WEBGL
                  pvrFormatEtc1 = 0x8d64;
                  pvrWidth = 7;
                  pvrHeight = 6;
                  pvrMipmapCount = 11;
                  pvrMetadata = 12;
                  arrayBuffer = buffer;
                  header = new Int32Array(arrayBuffer, 0, pvrHeaderLength); // @ts-expect-error Object possibly undefined
                  dataOffset = header[pvrMetadata] + 52;
                  pvrtcData = new Uint8Array(arrayBuffer, dataOffset);
                  mipmaps = [];
                  data = {
                    pixelWidth: header[pvrWidth],
                    pixelHeight: header[pvrHeight],
                    numberOfMipmapLevels: header[pvrMipmapCount] || 0
                  };
                  offset = 0;
                  width = data.pixelWidth || 0;
                  height = data.pixelHeight || 0;
                  for (i = 0; i < data.numberOfMipmapLevels; i++) {
                    level = (width + 3 >> 2) * (height + 3 >> 2) * 8;
                    view = new Uint8Array(arrayBuffer, pvrtcData.byteOffset + offset, level);
                    mipmaps.push(view);
                    offset += level;
                    width = width >> 1;
                    height = height >> 1;
                  }
                  return _context5.a(2, {
                    data: {
                      glInternalFormat: pvrFormatEtc1,
                      mipmaps: mipmaps,
                      width: data.pixelWidth || 0,
                      height: data.pixelHeight || 0,
                      type: 'pvr'
                    },
                    premultiplyAlpha: false
                  });
              }
            }, _callee5);
          }));
          return function loadPVRData(_x4) {
            return _ref5.apply(this, arguments);
          };
        }();

        /*
         * If not stated otherwise in this file or this component's LICENSE file the
         * following copyright and licenses apply:
         *
         * Copyright 2023 Comcast Cable Communications Management, LLC.
         *
         * Licensed under the Apache License, Version 2.0 (the License);
         * you may not use this file except in compliance with the License.
         * You may obtain a copy of the License at
         *
         * http://www.apache.org/licenses/LICENSE-2.0
         *
         * Unless required by applicable law or agreed to in writing, software
         * distributed under the License is distributed on an "AS IS" BASIS,
         * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
         * See the License for the specific language governing permissions and
         * limitations under the License.
         */
        /**
         * Tests if the given location is a SVG
         * @param url
         * @remarks
         * This function is used to determine if the given image url is a SVG
         * image
         * @returns
         */
        function isSvgImage(url) {
          return /\.(svg)(\?.*)?$/.test(url);
        }
        /**
         * Loads a SVG image
         * @param url
         * @returns
         */
        var loadSvg = function loadSvg(url, width, height, sx, sy, sw, sh) {
          return new Promise(function (resolve, reject) {
            var canvas = document.createElement('canvas');
            var ctx = canvas.getContext('2d');
            assertTruthy(ctx);
            ctx.imageSmoothingEnabled = true;
            var img = new Image();
            img.onload = function () {
              var x = sx !== null && sx !== void 0 ? sx : 0;
              var y = sy !== null && sy !== void 0 ? sy : 0;
              var w = width || img.width;
              var h = height || img.height;
              canvas.width = w;
              canvas.height = h;
              ctx.drawImage(img, 0, 0, w, h);
              resolve({
                data: ctx.getImageData(x, y, sw !== null && sw !== void 0 ? sw : w, sh !== null && sh !== void 0 ? sh : h),
                premultiplyAlpha: false
              });
            };
            img.onerror = function (err) {
              reject(err);
            };
            img.src = url;
          });
        };

        /*
         * If not stated otherwise in this file or this component's LICENSE file the
         * following copyright and licenses apply:
         *
         * Copyright 2020 Metrological
         *
         * Licensed under the Apache License, Version 2.0 (the License);
         * you may not use this file except in compliance with the License.
         * You may obtain a copy of the License at
         *
         * http://www.apache.org/licenses/LICENSE-2.0
         *
         * Unless required by applicable law or agreed to in writing, software
         * distributed under the License is distributed on an "AS IS" BASIS,
         * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
         * See the License for the specific language governing permissions and
         * limitations under the License.
         */
        function fetchJson(url) {
          var responseType = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '';
          return new Promise(function (resolve, reject) {
            var xhr = new XMLHttpRequest();
            xhr.responseType = responseType;
            xhr.onreadystatechange = function () {
              if (xhr.readyState == XMLHttpRequest.DONE) {
                // On most devices like WebOS and Tizen, the file protocol returns 0 while http(s) protocol returns 200
                if (xhr.status === 0 || xhr.status === 200) {
                  resolve(xhr.response);
                } else {
                  reject(xhr.statusText);
                }
              }
            };
            xhr.open('GET', url, true);
            xhr.send(null);
          });
        }

        /*
         * If not stated otherwise in this file or this component's LICENSE file the
         * following copyright and licenses apply:
         *
         * Copyright 2023 Comcast Cable Communications Management, LLC.
         *
         * Licensed under the Apache License, Version 2.0 (the License);
         * you may not use this file except in compliance with the License.
         * You may obtain a copy of the License at
         *
         * http://www.apache.org/licenses/LICENSE-2.0
         *
         * Unless required by applicable law or agreed to in writing, software
         * distributed under the License is distributed on an "AS IS" BASIS,
         * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
         * See the License for the specific language governing permissions and
         * limitations under the License.
         */
        /**
         * Texture consisting of an image loaded from a URL
         *
         * @remarks
         * The ImageTexture's {@link ImageTextureProps.src} prop defines the image URL
         * to be downloaded.
         *
         * By default, the texture's alpha values will be premultiplied into its color
         * values which is generally the desired setting before they are sent to the
         * texture's associated {@link Shader}. However, in special cases you may want
         * the Shader to receive straight (non-premultiplied) values. In that case you
         * can disable the default behavior by setting the
         * {@link ImageTextureProps.premultiplyAlpha} prop to `false`.
         */
        var ImageTexture = /*#__PURE__*/function (_Texture3) {
          function ImageTexture(txManager, props) {
            var _resolvedProps$maxRet;
            var _this12;
            _classCallCheck(this, ImageTexture);
            var resolvedProps = ImageTexture.resolveDefaults(props);
            _this12 = _callSuper(this, ImageTexture, [txManager]);
            _defineProperty(_this12, "type", TextureType.image);
            _defineProperty(_this12, "props", void 0);
            _this12.props = resolvedProps;
            _this12.maxRetryCount = (_resolvedProps$maxRet = resolvedProps.maxRetryCount) !== null && _resolvedProps$maxRet !== void 0 ? _resolvedProps$maxRet : _this12.txManager.maxRetryCount;
            return _this12;
          }
          _inherits(ImageTexture, _Texture3);
          return _createClass(ImageTexture, [{
            key: "hasAlphaChannel",
            value: function hasAlphaChannel(mimeType) {
              return mimeType.indexOf('image/png') !== -1;
            }
          }, {
            key: "loadImageFallback",
            value: function () {
              var _loadImageFallback = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee6(src, hasAlpha) {
                var img;
                return _regenerator().w(function (_context6) {
                  while (1) switch (_context6.n) {
                    case 0:
                      img = new Image();
                      if (typeof src === 'string' && isBase64Image(src) === false) {
                        img.crossOrigin = 'anonymous';
                      }
                      return _context6.a(2, new Promise(function (resolve, reject) {
                        img.onload = function () {
                          resolve({
                            data: img,
                            premultiplyAlpha: hasAlpha
                          });
                        };
                        img.onerror = function (err) {
                          var errorMessage = err instanceof Error ? err.message : err instanceof Event ? "Image loading failed for ".concat(img.src) : 'Unknown image loading error';
                          reject(new Error("Image loading failed: ".concat(errorMessage)));
                        };
                        if (src instanceof Blob) {
                          img.src = URL.createObjectURL(src);
                        } else {
                          img.src = src;
                        }
                      }));
                  }
                }, _callee6);
              }));
              function loadImageFallback(_x1, _x10) {
                return _loadImageFallback.apply(this, arguments);
              }
              return loadImageFallback;
            }()
          }, {
            key: "createImageBitmap",
            value: function (_createImageBitmap) {
              function createImageBitmap(_x5, _x6, _x7, _x8, _x9, _x0) {
                return _createImageBitmap.apply(this, arguments);
              }
              createImageBitmap.toString = function () {
                return _createImageBitmap.toString();
              };
              return createImageBitmap;
            }(/*#__PURE__*/function () {
              var _ref6 = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee7(blob, premultiplyAlpha, sx, sy, sw, sh) {
                var hasAlphaChannel, imageBitmapSupported, bitmap, _bitmap, _t2, _t3, _t4, _t5, _t6;
                return _regenerator().w(function (_context7) {
                  while (1) switch (_context7.p = _context7.n) {
                    case 0:
                      hasAlphaChannel = premultiplyAlpha !== null && premultiplyAlpha !== void 0 ? premultiplyAlpha : blob.type.includes('image/png');
                      imageBitmapSupported = this.txManager.imageBitmapSupported;
                      if (!(imageBitmapSupported.full === true && sw !== null && sh !== null)) {
                        _context7.n = 4;
                        break;
                      }
                      _context7.p = 1;
                      _context7.n = 2;
                      return createImageBitmap(blob, sx || 0, sy || 0, sw, sh, {
                        premultiplyAlpha: hasAlphaChannel ? 'premultiply' : 'none',
                        colorSpaceConversion: 'none',
                        imageOrientation: 'none'
                      });
                    case 2:
                      bitmap = _context7.v;
                      return _context7.a(2, {
                        data: bitmap,
                        premultiplyAlpha: hasAlphaChannel
                      });
                    case 3:
                      _context7.p = 3;
                      _t2 = _context7.v;
                      throw new Error("Failed to create image bitmap with crop: ".concat(_t2));
                    case 4:
                      if (!(imageBitmapSupported.basic === true)) {
                        _context7.n = 8;
                        break;
                      }
                      _context7.p = 5;
                      _context7.n = 6;
                      return createImageBitmap(blob);
                    case 6:
                      _t3 = _context7.v;
                      _t4 = hasAlphaChannel;
                      return _context7.a(2, {
                        data: _t3,
                        premultiplyAlpha: _t4
                      });
                    case 7:
                      _context7.p = 7;
                      _t5 = _context7.v;
                      throw new Error("Failed to create basic image bitmap: ".concat(_t5));
                    case 8:
                      _context7.p = 8;
                      _context7.n = 9;
                      return createImageBitmap(blob, {
                        premultiplyAlpha: hasAlphaChannel ? 'premultiply' : 'none',
                        colorSpaceConversion: 'none',
                        imageOrientation: 'none'
                      });
                    case 9:
                      _bitmap = _context7.v;
                      return _context7.a(2, {
                        data: _bitmap,
                        premultiplyAlpha: hasAlphaChannel
                      });
                    case 10:
                      _context7.p = 10;
                      _t6 = _context7.v;
                      throw new Error("Failed to create image bitmap with options: ".concat(_t6));
                    case 11:
                      return _context7.a(2);
                  }
                }, _callee7, this, [[8, 10], [5, 7], [1, 3]]);
              }));
              return function (_x11, _x12, _x13, _x14, _x15, _x16) {
                return _ref6.apply(this, arguments);
              };
            }())
          }, {
            key: "loadImage",
            value: function () {
              var _loadImage = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee8(src) {
                var _this$props4, premultiplyAlpha, sx, sy, sw, sh, blob, _t7, _t8;
                return _regenerator().w(function (_context8) {
                  while (1) switch (_context8.p = _context8.n) {
                    case 0:
                      _this$props4 = this.props, premultiplyAlpha = _this$props4.premultiplyAlpha, sx = _this$props4.sx, sy = _this$props4.sy, sw = _this$props4.sw, sh = _this$props4.sh;
                      if (!(this.txManager.hasCreateImageBitmap === true)) {
                        _context8.n = 8;
                        break;
                      }
                      if (!(isBase64Image(src) === false && this.txManager.hasWorker === true && this.txManager.imageWorkerManager !== null)) {
                        _context8.n = 3;
                        break;
                      }
                      _context8.p = 1;
                      return _context8.a(2, this.txManager.imageWorkerManager.getImage(src, premultiplyAlpha, sx, sy, sw, sh));
                    case 2:
                      _context8.p = 2;
                      _t7 = _context8.v;
                      throw new Error("Failed to load image via worker: ".concat(_t7));
                    case 3:
                      if (!(isBase64Image(src) === true)) {
                        _context8.n = 4;
                        break;
                      }
                      blob = dataURIToBlob(src);
                      _context8.n = 7;
                      break;
                    case 4:
                      _context8.p = 4;
                      _context8.n = 5;
                      return fetchJson(src, 'blob');
                    case 5:
                      blob = _context8.v;
                      _context8.n = 7;
                      break;
                    case 6:
                      _context8.p = 6;
                      _t8 = _context8.v;
                      throw new Error("Failed to fetch image blob from ".concat(src, ": ").concat(_t8));
                    case 7:
                      return _context8.a(2, this.createImageBitmap(blob, premultiplyAlpha, sx, sy, sw, sh));
                    case 8:
                      return _context8.a(2, this.loadImageFallback(src, premultiplyAlpha !== null && premultiplyAlpha !== void 0 ? premultiplyAlpha : true));
                  }
                }, _callee8, this, [[4, 6], [1, 2]]);
              }));
              function loadImage(_x17) {
                return _loadImage.apply(this, arguments);
              }
              return loadImage;
            }()
          }, {
            key: "getTextureSource",
            value: function () {
              var _getTextureSource2 = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee9() {
                var _this$props$premultip;
                var resp, _t9;
                return _regenerator().w(function (_context9) {
                  while (1) switch (_context9.p = _context9.n) {
                    case 0:
                      _context9.p = 0;
                      _context9.n = 1;
                      return this.determineImageTypeAndLoadImage();
                    case 1:
                      resp = _context9.v;
                      _context9.n = 3;
                      break;
                    case 2:
                      _context9.p = 2;
                      _t9 = _context9.v;
                      this.setState('failed', _t9);
                      return _context9.a(2, {
                        data: null
                      });
                    case 3:
                      if (!(resp.data === null)) {
                        _context9.n = 4;
                        break;
                      }
                      this.setState('failed', Error('ImageTexture: No image data'));
                      return _context9.a(2, {
                        data: null
                      });
                    case 4:
                      return _context9.a(2, {
                        data: resp.data,
                        premultiplyAlpha: (_this$props$premultip = this.props.premultiplyAlpha) !== null && _this$props$premultip !== void 0 ? _this$props$premultip : true
                      });
                  }
                }, _callee9, this, [[0, 2]]);
              }));
              function getTextureSource() {
                return _getTextureSource2.apply(this, arguments);
              }
              return getTextureSource;
            }()
          }, {
            key: "determineImageTypeAndLoadImage",
            value: function determineImageTypeAndLoadImage() {
              var _this$props5 = this.props,
                src = _this$props5.src,
                premultiplyAlpha = _this$props5.premultiplyAlpha,
                type = _this$props5.type;
              if (src === null) {
                return {
                  data: null
                };
              }
              if (typeof src !== 'string') {
                if (src instanceof Blob) {
                  if (this.txManager.hasCreateImageBitmap === true) {
                    var _this$props6 = this.props,
                      sx = _this$props6.sx,
                      sy = _this$props6.sy,
                      sw = _this$props6.sw,
                      sh = _this$props6.sh;
                    return this.createImageBitmap(src, premultiplyAlpha, sx, sy, sw, sh);
                  } else {
                    return this.loadImageFallback(src, premultiplyAlpha !== null && premultiplyAlpha !== void 0 ? premultiplyAlpha : true);
                  }
                }
                if (src instanceof ImageData) {
                  return {
                    data: src,
                    premultiplyAlpha: premultiplyAlpha
                  };
                }
                return {
                  data: src(),
                  premultiplyAlpha: premultiplyAlpha
                };
              }
              var absoluteSrc = convertUrlToAbsolute(src);
              if (type === 'regular') {
                return this.loadImage(absoluteSrc);
              }
              if (type === 'svg') {
                return loadSvg(absoluteSrc, this.props.width, this.props.height, this.props.sx, this.props.sy, this.props.sw, this.props.sh);
              }
              if (isSvgImage(src) === true) {
                return loadSvg(absoluteSrc, this.props.width, this.props.height, this.props.sx, this.props.sy, this.props.sw, this.props.sh);
              }
              if (type === 'compressed') {
                return loadCompressedTexture(absoluteSrc);
              }
              if (isCompressedTextureContainer(src) === true) {
                return loadCompressedTexture(absoluteSrc);
              }
              // default
              return this.loadImage(absoluteSrc);
            }
            /**
             * Generates a cache key for the ImageTexture based on the provided props.
             * @param props - The props used to generate the cache key.
             * @returns The cache key as a string, or `false` if the key cannot be generated.
             */
          }], [{
            key: "makeCacheKey",
            value: function makeCacheKey(props) {
              var _resolvedProps$premul;
              var resolvedProps = ImageTexture.resolveDefaults(props);
              // Only cache key-able textures; prioritise key
              var key = resolvedProps.key || resolvedProps.src;
              if (typeof key !== 'string') {
                return false;
              }
              // if we have source dimensions, cache the texture separately
              var dimensionProps = '';
              if (resolvedProps.sh !== null && resolvedProps.sw !== null) {
                var _resolvedProps$sx, _resolvedProps$sy;
                dimensionProps += ',';
                dimensionProps += (_resolvedProps$sx = resolvedProps.sx) !== null && _resolvedProps$sx !== void 0 ? _resolvedProps$sx : '';
                dimensionProps += (_resolvedProps$sy = resolvedProps.sy) !== null && _resolvedProps$sy !== void 0 ? _resolvedProps$sy : '';
                dimensionProps += resolvedProps.sw || '';
                dimensionProps += resolvedProps.sh || '';
              }
              return "ImageTexture,".concat(key, ",").concat((_resolvedProps$premul = resolvedProps.premultiplyAlpha) !== null && _resolvedProps$premul !== void 0 ? _resolvedProps$premul : 'true').concat(dimensionProps);
            }
          }, {
            key: "resolveDefaults",
            value: function resolveDefaults(props) {
              var _props$src, _props$premultiplyAlp, _props$key, _props$type, _props$width, _props$height, _props$sx, _props$sy, _props$sw, _props$sh, _props$maxRetryCount;
              return {
                src: (_props$src = props.src) !== null && _props$src !== void 0 ? _props$src : '',
                premultiplyAlpha: (_props$premultiplyAlp = props.premultiplyAlpha) !== null && _props$premultiplyAlp !== void 0 ? _props$premultiplyAlp : true,
                // null,
                key: (_props$key = props.key) !== null && _props$key !== void 0 ? _props$key : null,
                type: (_props$type = props.type) !== null && _props$type !== void 0 ? _props$type : null,
                width: (_props$width = props.width) !== null && _props$width !== void 0 ? _props$width : null,
                height: (_props$height = props.height) !== null && _props$height !== void 0 ? _props$height : null,
                sx: (_props$sx = props.sx) !== null && _props$sx !== void 0 ? _props$sx : null,
                sy: (_props$sy = props.sy) !== null && _props$sy !== void 0 ? _props$sy : null,
                sw: (_props$sw = props.sw) !== null && _props$sw !== void 0 ? _props$sw : null,
                sh: (_props$sh = props.sh) !== null && _props$sh !== void 0 ? _props$sh : null,
                maxRetryCount: (_props$maxRetryCount = props.maxRetryCount) !== null && _props$maxRetryCount !== void 0 ? _props$maxRetryCount : null
              };
            }
          }]);
        }(Texture);
        /*
         * If not stated otherwise in this file or this component's LICENSE file the
         * following copyright and licenses apply:
         *
         * Copyright 2023 Comcast Cable Communications Management, LLC.
         *
         * Licensed under the Apache License, Version 2.0 (the License);
         * you may not use this file except in compliance with the License.
         * You may obtain a copy of the License at
         *
         * http://www.apache.org/licenses/LICENSE-2.0
         *
         * Unless required by applicable law or agreed to in writing, software
         * distributed under the License is distributed on an "AS IS" BASIS,
         * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
         * See the License for the specific language governing permissions and
         * limitations under the License.
         */
        /**
         * Texture consisting of a random grid of greyscale pixels
         *
         * @remarks
         * The width and height of the NoiseTexture are defined by it's
         * {@link NoiseTextureProps.width} and {@link NoiseTextureProps.height}
         * properties. The {@link NoiseTextureProps.cacheId} prop can be varied in order
         * to bypass cache and get newly randomized texture data.
         */
        _defineProperty(ImageTexture, "z$__type__Props", void 0);
        var NoiseTexture = /*#__PURE__*/function (_Texture4) {
          function NoiseTexture(txManager, props) {
            var _this13;
            _classCallCheck(this, NoiseTexture);
            _this13 = _callSuper(this, NoiseTexture, [txManager]);
            _defineProperty(_this13, "props", void 0);
            _defineProperty(_this13, "type", TextureType.noise);
            _this13.props = NoiseTexture.resolveDefaults(props);
            return _this13;
          }
          _inherits(NoiseTexture, _Texture4);
          return _createClass(NoiseTexture, [{
            key: "getTextureSource",
            value: function () {
              var _getTextureSource3 = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee0() {
                var _this$props7, width, height, size, pixelData8, i, v;
                return _regenerator().w(function (_context0) {
                  while (1) switch (_context0.n) {
                    case 0:
                      _this$props7 = this.props, width = _this$props7.width, height = _this$props7.height;
                      size = width * height * 4;
                      pixelData8 = new Uint8ClampedArray(size);
                      for (i = 0; i < size; i += 4) {
                        v = Math.floor(Math.random() * 256);
                        pixelData8[i] = v;
                        pixelData8[i + 1] = v;
                        pixelData8[i + 2] = v;
                        pixelData8[i + 3] = 255;
                      }
                      // Noise texture data ready - dimensions will be set during upload
                      return _context0.a(2, {
                        data: new ImageData(pixelData8, width, height)
                      });
                  }
                }, _callee0, this);
              }));
              function getTextureSource() {
                return _getTextureSource3.apply(this, arguments);
              }
              return getTextureSource;
            }()
          }], [{
            key: "makeCacheKey",
            value: function makeCacheKey(props) {
              if (props.cacheId === undefined) {
                return false;
              }
              var resolvedProps = NoiseTexture.resolveDefaults(props);
              return "NoiseTexture,".concat(resolvedProps.width, ",").concat(resolvedProps.height, ",").concat(resolvedProps.cacheId);
            }
          }, {
            key: "resolveDefaults",
            value: function resolveDefaults(props) {
              var _props$width2, _props$height2, _props$cacheId;
              return {
                width: (_props$width2 = props.width) !== null && _props$width2 !== void 0 ? _props$width2 : 128,
                height: (_props$height2 = props.height) !== null && _props$height2 !== void 0 ? _props$height2 : 128,
                cacheId: (_props$cacheId = props.cacheId) !== null && _props$cacheId !== void 0 ? _props$cacheId : 0
              };
            }
          }]);
        }(Texture);
        /*
         * If not stated otherwise in this file or this component's LICENSE file the
         * following copyright and licenses apply:
         *
         * Copyright 2023 Comcast Cable Communications Management, LLC.
         *
         * Licensed under the Apache License, Version 2.0 (the License);
         * you may not use this file except in compliance with the License.
         * You may obtain a copy of the License at
         *
         * http://www.apache.org/licenses/LICENSE-2.0
         *
         * Unless required by applicable law or agreed to in writing, software
         * distributed under the License is distributed on an "AS IS" BASIS,
         * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
         * See the License for the specific language governing permissions and
         * limitations under the License.
         */
        _defineProperty(NoiseTexture, "z$__type__Props", void 0);
        var subTextureId = 0;
        /**
         * A Texture that is a sub-region of another Texture.
         *
         * @remarks
         * The parent texture can be a Sprite Sheet/Texture Atlas and set using the
         * {@link SubTextureProps.texture} prop. The sub-region relative to the parent
         * texture is defined with the {@link SubTextureProps.x},
         * {@link SubTextureProps.y}, {@link SubTextureProps.width}, and
         * {@link SubTextureProps.height} pixel values.
         */
        var SubTexture = /*#__PURE__*/function (_Texture5) {
          function SubTexture(txManager, props) {
            var _this14;
            _classCallCheck(this, SubTexture);
            _this14 = _callSuper(this, SubTexture, [txManager]);
            _defineProperty(_this14, "props", void 0);
            _defineProperty(_this14, "parentTexture", void 0);
            _defineProperty(_this14, "type", TextureType.subTexture);
            _defineProperty(_this14, "subtextureId", "subtexture-".concat(subTextureId++));
            _defineProperty(_this14, "onParentTxLoaded", function () {
              // We ignore the parent's passed dimensions, and simply use the SubTexture's
              // configured dimensions (because that's all that matters here)
              _this14.forwardParentTxState('loaded', {
                width: _this14.props.width,
                height: _this14.props.height
              });
            });
            _defineProperty(_this14, "onParentTxFailed", function (target, error) {
              //decrement with 1 because in the failed state it will do +1 again.
              _this14.retryCount = _this14.parentTexture.retryCount - 1;
              _this14.forwardParentTxState('failed', error);
            });
            _defineProperty(_this14, "onParentTxLoading", function () {
              _this14.forwardParentTxState('loading');
            });
            _defineProperty(_this14, "onParentTxFreed", function () {
              _this14.forwardParentTxState('freed');
            });
            _this14.props = SubTexture.resolveDefaults(props || {});
            assertTruthy(_this14.props.texture, 'SubTexture requires a parent texture');
            assertTruthy(_this14.props.texture instanceof ImageTexture, 'SubTexture requires an ImageTexture parent');
            // Resolve parent texture from cache or fallback to provided texture
            _this14.parentTexture = txManager.resolveParentTexture(_this14.props.texture);
            if (_this14.renderableOwners.length > 0) {
              _this14.parentTexture.setRenderableOwner(_this14.subtextureId, true);
            }
            // If parent texture is already loaded / failed, trigger loaded event manually
            // so that users get a consistent event experience.
            // We do this in a microtask to allow listeners to be attached in the same
            // synchronous task after calling loadTexture()
            queueMicrotask(function () {
              var parentTx = _this14.parentTexture;
              if (parentTx.state === 'loaded' && parentTx.dimensions) {
                _this14.onParentTxLoaded(parentTx, parentTx.dimensions);
              } else if (parentTx.state === 'loading') {
                _this14.onParentTxLoading();
              } else if (parentTx.state === 'failed' && parentTx.error) {
                _this14.onParentTxFailed(parentTx, parentTx.error);
              } else if (parentTx.state === 'freed') {
                _this14.onParentTxFreed();
              }
              parentTx.on('loading', _this14.onParentTxLoading);
              parentTx.on('loaded', _this14.onParentTxLoaded);
              parentTx.on('failed', _this14.onParentTxFailed);
              parentTx.on('freed', _this14.onParentTxFreed);
            });
            return _this14;
          }
          _inherits(SubTexture, _Texture5);
          return _createClass(SubTexture, [{
            key: "forwardParentTxState",
            value: function forwardParentTxState(state, errorOrDimensions) {
              this.setState(state, errorOrDimensions);
            }
          }, {
            key: "onChangeIsRenderable",
            value: function onChangeIsRenderable(isRenderable) {
              // Propagate the renderable owner change to the parent texture
              this.parentTexture.setRenderableOwner(this.subtextureId, isRenderable);
            }
          }, {
            key: "getTextureSource",
            value: function () {
              var _getTextureSource4 = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee1() {
                return _regenerator().w(function (_context1) {
                  while (1) switch (_context1.n) {
                    case 0:
                      return _context1.a(2, {
                        data: this.props
                      });
                  }
                }, _callee1, this);
              }));
              function getTextureSource() {
                return _getTextureSource4.apply(this, arguments);
              }
              return getTextureSource;
            }() // eslint-disable-next-line @typescript-eslint/no-unused-vars
          }], [{
            key: "makeCacheKey",
            value: function makeCacheKey(props) {
              return false;
            }
          }, {
            key: "resolveDefaults",
            value: function resolveDefaults(props) {
              return {
                texture: props.texture,
                x: props.x || 0,
                y: props.y || 0,
                width: props.width || 0,
                height: props.height || 0
              };
            }
          }]);
        }(Texture);
        /*
         * If not stated otherwise in this file or this component's LICENSE file the
         * following copyright and licenses apply:
         *
         * Copyright 2023 Comcast Cable Communications Management, LLC.
         *
         * Licensed under the Apache License, Version 2.0 (the License);
         * you may not use this file except in compliance with the License.
         * You may obtain a copy of the License at
         *
         * http://www.apache.org/licenses/LICENSE-2.0
         *
         * Unless required by applicable law or agreed to in writing, software
         * distributed under the License is distributed on an "AS IS" BASIS,
         * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
         * See the License for the specific language governing permissions and
         * limitations under the License.
         */
        _defineProperty(SubTexture, "z$__type__Props", void 0);
        var RenderTexture = /*#__PURE__*/function (_Texture6) {
          function RenderTexture(txManager, props) {
            var _this15;
            _classCallCheck(this, RenderTexture);
            _this15 = _callSuper(this, RenderTexture, [txManager]);
            _defineProperty(_this15, "props", void 0);
            _defineProperty(_this15, "type", TextureType.renderToTexture);
            _this15.props = RenderTexture.resolveDefaults(props || {});
            return _this15;
          }
          _inherits(RenderTexture, _Texture6);
          return _createClass(RenderTexture, [{
            key: "width",
            get: function get() {
              return this.props.width;
            },
            set: function set(value) {
              this.props.width = value;
            }
          }, {
            key: "height",
            get: function get() {
              return this.props.height;
            },
            set: function set(value) {
              this.props.height = value;
            }
          }, {
            key: "getTextureSource",
            value: function () {
              var _getTextureSource5 = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee10() {
                return _regenerator().w(function (_context10) {
                  while (1) switch (_context10.n) {
                    case 0:
                      return _context10.a(2, {
                        data: null,
                        premultiplyAlpha: null
                      });
                  }
                }, _callee10);
              }));
              function getTextureSource() {
                return _getTextureSource5.apply(this, arguments);
              }
              return getTextureSource;
            }()
          }], [{
            key: "resolveDefaults",
            value: function resolveDefaults(props) {
              return {
                width: props.width || 256,
                height: props.height || 256
              };
            }
          }]);
        }(Texture);
        _defineProperty(RenderTexture, "z$__type__Props", void 0);
        function validateCreateImageBitmap() {
          return _validateCreateImageBitmap.apply(this, arguments);
        }
        function _validateCreateImageBitmap() {
          _validateCreateImageBitmap = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee25() {
            var _bitmap$close;
            var pngBinaryData, support, blob, bitmap, _bitmapWithOptions$cl, options, bitmapWithOptions, _bitmapWithFullOption, bitmapWithFullOptions, _t14, _t15;
            return _regenerator().w(function (_context26) {
              while (1) switch (_context26.p = _context26.n) {
                case 0:
                  // Test if createImageBitmap is supported using a simple 1x1 PNG image
                  // prettier-ignore
                  pngBinaryData = new Uint8Array([0x89, 0x50, 0x4e, 0x47, 0x0d, 0x0a, 0x1a, 0x0a,
                  // PNG signature
                  0x00, 0x00, 0x00, 0x0d,
                  // IHDR chunk length
                  0x49, 0x48, 0x44, 0x52,
                  // "IHDR" chunk type
                  0x00, 0x00, 0x00, 0x01,
                  // Width: 1
                  0x00, 0x00, 0x00, 0x01,
                  // Height: 1
                  0x01,
                  // Bit depth: 1
                  0x03,
                  // Color type: Indexed
                  0x00,
                  // Compression method: Deflate
                  0x00,
                  // Filter method: None
                  0x00,
                  // Interlace method: None
                  0x25, 0xdb, 0x56, 0xca,
                  // CRC for IHDR
                  0x00, 0x00, 0x00, 0x03,
                  // PLTE chunk length
                  0x50, 0x4c, 0x54, 0x45,
                  // "PLTE" chunk type
                  0x00, 0x00, 0x00,
                  // Palette entry: Black
                  0xa7, 0x7a, 0x3d, 0xda,
                  // CRC for PLTE
                  0x00, 0x00, 0x00, 0x01,
                  // tRNS chunk length
                  0x74, 0x52, 0x4e, 0x53,
                  // "tRNS" chunk type
                  0x00,
                  // Transparency for black: Fully transparent
                  0x40, 0xe6, 0xd8, 0x66,
                  // CRC for tRNS
                  0x00, 0x00, 0x00, 0x0a,
                  // IDAT chunk length
                  0x49, 0x44, 0x41, 0x54,
                  // "IDAT" chunk type
                  0x08, 0xd7,
                  // Deflate header
                  0x63, 0x60, 0x00, 0x00, 0x00, 0x02, 0x00, 0x01,
                  // Zlib-compressed data
                  0xe2, 0x21, 0xbc, 0x33,
                  // CRC for IDAT
                  0x00, 0x00, 0x00, 0x00,
                  // IEND chunk length
                  0x49, 0x45, 0x4e, 0x44,
                  // "IEND" chunk type
                  0xae, 0x42, 0x60, 0x82 // CRC for IEND
                  ]);
                  support = {
                    basic: false,
                    options: false,
                    full: false
                  }; // Test basic createImageBitmap support
                  blob = new Blob([pngBinaryData], {
                    type: 'image/png'
                  });
                  _context26.n = 1;
                  return createImageBitmap(blob);
                case 1:
                  bitmap = _context26.v;
                  (_bitmap$close = bitmap.close) === null || _bitmap$close === void 0 || _bitmap$close.call(bitmap);
                  support.basic = true;
                  // Test createImageBitmap with options support
                  _context26.p = 2;
                  options = {
                    premultiplyAlpha: 'none'
                  };
                  _context26.n = 3;
                  return createImageBitmap(blob, options);
                case 3:
                  bitmapWithOptions = _context26.v;
                  (_bitmapWithOptions$cl = bitmapWithOptions.close) === null || _bitmapWithOptions$cl === void 0 || _bitmapWithOptions$cl.call(bitmapWithOptions);
                  support.options = true;
                  _context26.n = 5;
                  break;
                case 4:
                  _context26.p = 4;
                  _t14 = _context26.v;
                case 5:
                  _context26.p = 5;
                  _context26.n = 6;
                  return createImageBitmap(blob, 0, 0, 1, 1, {
                    premultiplyAlpha: 'none'
                  });
                case 6:
                  bitmapWithFullOptions = _context26.v;
                  (_bitmapWithFullOption = bitmapWithFullOptions.close) === null || _bitmapWithFullOption === void 0 || _bitmapWithFullOption.call(bitmapWithFullOptions);
                  support.full = true;
                  _context26.n = 8;
                  break;
                case 7:
                  _context26.p = 7;
                  _t15 = _context26.v;
                case 8:
                  return _context26.a(2, support);
              }
            }, _callee25, null, [[5, 7], [2, 4]]);
          }));
          return _validateCreateImageBitmap.apply(this, arguments);
        }
        var TextureErrorCode;
        (function (TextureErrorCode) {
          TextureErrorCode["MEMORY_THRESHOLD_EXCEEDED"] = "MEMORY_THRESHOLD_EXCEEDED";
          TextureErrorCode["TEXTURE_DATA_NULL"] = "TEXTURE_DATA_NULL";
          TextureErrorCode["TEXTURE_TYPE_NOT_REGISTERED"] = "TEXTURE_TYPE_NOT_REGISTERED";
        })(TextureErrorCode || (TextureErrorCode = {}));
        var defaultMessages = _defineProperty(_defineProperty(_defineProperty({}, TextureErrorCode.MEMORY_THRESHOLD_EXCEEDED, 'Memory threshold exceeded'), TextureErrorCode.TEXTURE_DATA_NULL, 'Texture data is null'), TextureErrorCode.TEXTURE_TYPE_NOT_REGISTERED, 'Texture type is not registered');
        var TextureError = /*#__PURE__*/function (_Error) {
          function TextureError(codeOrMessage, maybeMessage) {
            var _this16;
            _classCallCheck(this, TextureError);
            var isCode = Object.values(TextureErrorCode).includes(codeOrMessage);
            var code = isCode ? codeOrMessage : undefined;
            var message;
            if (isCode && code) {
              message = maybeMessage !== null && maybeMessage !== void 0 ? maybeMessage : defaultMessages[code];
            } else {
              message = String(codeOrMessage);
            }
            _this16 = _callSuper(this, TextureError, [message]);
            _defineProperty(_this16, "code", void 0);
            _this16.name = (this instanceof TextureError ? this.constructor : void 0).name;
            if (code) _this16.code = code;
            return _this16;
          }
          _inherits(TextureError, _Error);
          return _createClass(TextureError);
        }(/*#__PURE__*/_wrapNativeSuper(Error));
        /*
         * If not stated otherwise in this file or this component's LICENSE file the
         * following copyright and licenses apply:
         *
         * Copyright 2023 Comcast Cable Communications Management, LLC.
         *
         * Licensed under the Apache License, Version 2.0 (the License);
         * you may not use this file except in compliance with the License.
         * You may obtain a copy of the License at
         *
         * http://www.apache.org/licenses/LICENSE-2.0
         *
         * Unless required by applicable law or agreed to in writing, software
         * distributed under the License is distributed on an "AS IS" BASIS,
         * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
         * See the License for the specific language governing permissions and
         * limitations under the License.
         */
        var CoreTextureManager = /*#__PURE__*/function (_EventEmitter6) {
          function CoreTextureManager(stage, settings) {
            var _this17;
            _classCallCheck(this, CoreTextureManager);
            _this17 = _callSuper(this, CoreTextureManager);
            /**
             * Map of textures by cache key
             */
            _defineProperty(_this17, "keyCache", new Map());
            /**
             * Map of cache keys by texture
             */
            _defineProperty(_this17, "inverseKeyCache", new WeakMap());
            /**
             * Map of texture constructors by their type name
             */
            _defineProperty(_this17, "txConstructors", {});
            _defineProperty(_this17, "maxRetryCount", void 0);
            _defineProperty(_this17, "priorityQueue", []);
            _defineProperty(_this17, "uploadTextureQueue", []);
            _defineProperty(_this17, "initialized", false);
            _defineProperty(_this17, "stage", void 0);
            _defineProperty(_this17, "numImageWorkers", void 0);
            _defineProperty(_this17, "imageWorkerManager", null);
            _defineProperty(_this17, "hasCreateImageBitmap", !!self.createImageBitmap);
            _defineProperty(_this17, "imageBitmapSupported", {
              basic: false,
              options: false,
              full: false
            });
            _defineProperty(_this17, "hasWorker", !!self.Worker);
            /**
             * Renderer that this texture manager is associated with
             *
             * @remarks
             * This MUST be set before the texture manager is used. Otherwise errors
             * will occur when using the texture manager.
             */
            _defineProperty(_this17, "renderer", void 0);
            /**
             * The current frame time in milliseconds
             *
             * @remarks
             * This is used to populate the `lastRenderableChangeTime` property of
             * {@link Texture} instances when their renderable state changes.
             *
             * Set by stage via `updateFrameTime` method.
             */
            _defineProperty(_this17, "frameTime", 0);
            var numImageWorkers = settings.numImageWorkers,
              createImageBitmapSupport = settings.createImageBitmapSupport,
              maxRetryCount = settings.maxRetryCount;
            _this17.stage = stage;
            _this17.numImageWorkers = numImageWorkers;
            _this17.maxRetryCount = maxRetryCount;
            if (createImageBitmapSupport === 'auto') {
              validateCreateImageBitmap().then(function (result) {
                _this17.initialize(result);
              }).catch(function () {
                console.warn('[Lightning] createImageBitmap is not supported on this browser. ImageTexture will be slower.');
                // initialized without image worker manager and createImageBitmap
                _this17.initialized = true;
                _this17.emit('initialized');
              });
            } else {
              _this17.initialize({
                basic: createImageBitmapSupport === 'basic',
                options: createImageBitmapSupport === 'options',
                full: createImageBitmapSupport === 'full'
              });
            }
            _this17.registerTextureType('ImageTexture', ImageTexture);
            _this17.registerTextureType('ColorTexture', ColorTexture);
            _this17.registerTextureType('NoiseTexture', NoiseTexture);
            _this17.registerTextureType('SubTexture', SubTexture);
            _this17.registerTextureType('RenderTexture', RenderTexture);
            return _this17;
          }
          _inherits(CoreTextureManager, _EventEmitter6);
          return _createClass(CoreTextureManager, [{
            key: "registerTextureType",
            value: function registerTextureType(textureType, textureClass) {
              this.txConstructors[textureType] = textureClass;
            }
          }, {
            key: "initialize",
            value: function initialize(support) {
              this.hasCreateImageBitmap = support.basic || support.options || support.full;
              this.imageBitmapSupported = support;
              if (!this.hasCreateImageBitmap) {
                console.warn('[Lightning] createImageBitmap is not supported on this browser. ImageTexture will be slower.');
              }
              if (this.hasCreateImageBitmap && this.hasWorker && this.numImageWorkers > 0) {
                this.imageWorkerManager = new ImageWorkerManager(this.numImageWorkers, support);
              } else {
                console.warn('[Lightning] Imageworker is 0 or not supported on this browser. Image loading will be slower.');
              }
              this.initialized = true;
              this.emit('initialized');
            }
            /**
             * Enqueue a texture for uploading to the GPU.
             *
             * @param texture - The texture to upload
             */
          }, {
            key: "enqueueUploadTexture",
            value: function enqueueUploadTexture(texture) {
              if (this.uploadTextureQueue.includes(texture) === false) {
                this.uploadTextureQueue.push(texture);
              }
            }
            /**
             * Create a texture
             *
             * @param textureType - The type of texture to create
             * @param props - The properties to use for the texture
             */
          }, {
            key: "createTexture",
            value: function createTexture(textureType, props) {
              var texture;
              var TextureClass = this.txConstructors[textureType];
              if (!TextureClass) {
                throw new TextureError(TextureErrorCode.TEXTURE_TYPE_NOT_REGISTERED, "Texture type \"".concat(textureType, "\" is not registered"));
              }
              // eslint-disable-next-line @typescript-eslint/no-explicit-any, @typescript-eslint/no-unsafe-argument
              var cacheKey = TextureClass.makeCacheKey(props);
              if (cacheKey && this.keyCache.has(cacheKey)) {
                // eslint-disable-next-line @typescript-eslint/no-non-null-assertion
                texture = this.keyCache.get(cacheKey);
              } else {
                // eslint-disable-next-line @typescript-eslint/no-unsafe-argument, @typescript-eslint/no-explicit-any
                texture = new TextureClass(this, props);
                if (cacheKey) {
                  this.initTextureToCache(texture, cacheKey);
                }
              }
              return texture;
            }
            /**
             * Override loadTexture to use the batched approach.
             *
             * @param texture - The texture to load
             * @param immediate - Whether to prioritize the texture for immediate loading
             */
          }, {
            key: "loadTexture",
            value: (function () {
              var _loadTexture = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee11(texture, priority) {
                var textureDataResult, shouldUploadImmediately;
                return _regenerator().w(function (_context11) {
                  while (1) switch (_context11.n) {
                    case 0:
                      if (!(texture.type === TextureType.subTexture)) {
                        _context11.n = 1;
                        break;
                      }
                      return _context11.a(2);
                    case 1:
                      if (!(texture.state === 'loaded')) {
                        _context11.n = 2;
                        break;
                      }
                      return _context11.a(2);
                    case 2:
                      if (!(texture.state === 'loading')) {
                        _context11.n = 3;
                        break;
                      }
                      return _context11.a(2);
                    case 3:
                      if (!(this.initialized === false)) {
                        _context11.n = 4;
                        break;
                      }
                      this.priorityQueue.push(texture);
                      return _context11.a(2);
                    case 4:
                      texture.setState('loading');
                      // Get texture data - early return on failure
                      _context11.n = 5;
                      return texture.getTextureData().catch(function (err) {
                        console.error(err);
                        texture.setState('failed');
                        return null;
                      });
                    case 5:
                      textureDataResult = _context11.v;
                      if (!(textureDataResult === null || texture.state === 'failed')) {
                        _context11.n = 6;
                        break;
                      }
                      return _context11.a(2);
                    case 6:
                      // Handle non-image textures: upload immediately
                      shouldUploadImmediately = texture.type !== TextureType.image || priority === true;
                      if (!(shouldUploadImmediately === true)) {
                        _context11.n = 8;
                        break;
                      }
                      _context11.n = 7;
                      return this.uploadTexture(texture).catch(function (err) {
                        console.error("Failed to upload texture:", err);
                        texture.setState('failed');
                      });
                    case 7:
                      return _context11.a(2);
                    case 8:
                      // Queue image textures for throttled upload
                      this.enqueueUploadTexture(texture);
                    case 9:
                      return _context11.a(2);
                  }
                }, _callee11, this);
              }));
              function loadTexture(_x18, _x19) {
                return _loadTexture.apply(this, arguments);
              }
              return loadTexture;
            }()
            /**
             * Upload a texture to the GPU
             *
             * @param texture Texture to upload
             * @returns Promise that resolves when the texture is fully loaded
             */
            )
          }, {
            key: "uploadTexture",
            value: (function () {
              var _uploadTexture = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee12(texture) {
                var coreContext;
                return _regenerator().w(function (_context12) {
                  while (1) switch (_context12.n) {
                    case 0:
                      if (!(this.stage.txMemManager.doNotExceedCriticalThreshold === true && this.stage.txMemManager.criticalCleanupRequested === true)) {
                        _context12.n = 1;
                        break;
                      }
                      // we're at a critical memory threshold, don't upload textures
                      texture.setState('failed', new TextureError(TextureErrorCode.MEMORY_THRESHOLD_EXCEEDED));
                      return _context12.a(2);
                    case 1:
                      if (!(texture.state === 'failed' || texture.state === 'freed')) {
                        _context12.n = 2;
                        break;
                      }
                      return _context12.a(2);
                    case 2:
                      if (!(texture.state === 'loaded')) {
                        _context12.n = 3;
                        break;
                      }
                      return _context12.a(2);
                    case 3:
                      if (!(texture.textureData === null)) {
                        _context12.n = 4;
                        break;
                      }
                      texture.setState('failed', new TextureError(TextureErrorCode.TEXTURE_DATA_NULL, 'Texture data is null, cannot upload texture'));
                      return _context12.a(2);
                    case 4:
                      coreContext = texture.loadCtxTexture();
                      if (!(coreContext !== null && coreContext.state === 'loaded')) {
                        _context12.n = 5;
                        break;
                      }
                      texture.setState('loaded');
                      return _context12.a(2);
                    case 5:
                      _context12.n = 6;
                      return coreContext.load();
                    case 6:
                      return _context12.a(2);
                  }
                }, _callee12, this);
              }));
              function uploadTexture(_x20) {
                return _uploadTexture.apply(this, arguments);
              }
              return uploadTexture;
            }()
            /**
             * Check if a texture is being processed
             */
            )
          }, {
            key: "isProcessingTexture",
            value: function isProcessingTexture(texture) {
              return this.uploadTextureQueue.includes(texture) === true;
            }
            /**
             * Process a limited number of uploads.
             *
             * @param maxProcessingTime - The maximum processing time in milliseconds
             */
          }, {
            key: "processSome",
            value: (function () {
              var _processSome = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee13(maxProcessingTime) {
                var startTime, texture, _texture, _t0, _t1;
                return _regenerator().w(function (_context13) {
                  while (1) switch (_context13.p = _context13.n) {
                    case 0:
                      if (!(this.initialized === false)) {
                        _context13.n = 1;
                        break;
                      }
                      return _context13.a(2);
                    case 1:
                      startTime = getTimeStamp(); // Process priority queue
                    case 2:
                      if (!(this.priorityQueue.length > 0 && getTimeStamp() - startTime < maxProcessingTime)) {
                        _context13.n = 8;
                        break;
                      }
                      // eslint-disable-next-line @typescript-eslint/no-non-null-assertion
                      texture = this.priorityQueue.pop();
                      _context13.p = 3;
                      _context13.n = 4;
                      return texture.getTextureData();
                    case 4:
                      _context13.n = 5;
                      return this.uploadTexture(texture);
                    case 5:
                      _context13.n = 7;
                      break;
                    case 6:
                      _context13.p = 6;
                      _t0 = _context13.v;
                      console.error('Failed to process priority texture:', _t0);
                      // Continue with next texture instead of stopping entire queue
                    case 7:
                      _context13.n = 2;
                      break;
                    case 8:
                      if (!(this.uploadTextureQueue.length > 0 && getTimeStamp() - startTime < maxProcessingTime)) {
                        _context13.n = 13;
                        break;
                      }
                      // eslint-disable-next-line @typescript-eslint/no-non-null-assertion
                      _texture = this.uploadTextureQueue.shift();
                      _context13.p = 9;
                      _context13.n = 10;
                      return this.uploadTexture(_texture);
                    case 10:
                      _context13.n = 12;
                      break;
                    case 11:
                      _context13.p = 11;
                      _t1 = _context13.v;
                      console.error('Failed to upload texture:', _t1);
                      // Continue with next texture instead of stopping entire queue
                    case 12:
                      _context13.n = 8;
                      break;
                    case 13:
                      return _context13.a(2);
                  }
                }, _callee13, this, [[9, 11], [3, 6]]);
              }));
              function processSome(_x21) {
                return _processSome.apply(this, arguments);
              }
              return processSome;
            }())
          }, {
            key: "hasUpdates",
            value: function hasUpdates() {
              return this.uploadTextureQueue.length > 0;
            }
            /**
             * Initialize a texture to the cache
             *
             * @param texture Texture to cache
             * @param cacheKey Cache key for the texture
             */
          }, {
            key: "initTextureToCache",
            value: function initTextureToCache(texture, cacheKey) {
              var keyCache = this.keyCache,
                inverseKeyCache = this.inverseKeyCache;
              keyCache.set(cacheKey, texture);
              inverseKeyCache.set(texture, cacheKey);
            }
            /**
             * Get a texture from the cache
             *
             * @param cacheKey
             */
          }, {
            key: "getTextureFromCache",
            value: function getTextureFromCache(cacheKey) {
              return this.keyCache.get(cacheKey);
            }
            /**
             * Remove a texture from the cache
             *
             * @remarks
             * Called by Texture Cleanup when a texture is freed.
             *
             * @param texture
             */
          }, {
            key: "removeTextureFromCache",
            value: function removeTextureFromCache(texture) {
              var inverseKeyCache = this.inverseKeyCache,
                keyCache = this.keyCache;
              var cacheKey = inverseKeyCache.get(texture);
              if (cacheKey) {
                keyCache.delete(cacheKey);
              }
            }
            /**
             * Resolve a parent texture from the cache or fallback to the provided texture.
             *
             * @param texture - The provided texture to resolve.
             * @returns The cached or provided texture.
             */
          }, {
            key: "resolveParentTexture",
            value: function resolveParentTexture(texture) {
              if (!(texture !== null && texture !== void 0 && texture.props)) {
                return texture;
              }
              var cacheKey = ImageTexture.makeCacheKey(texture.props);
              var cachedTexture = cacheKey ? this.getTextureFromCache(cacheKey) : undefined;
              return cachedTexture !== null && cachedTexture !== void 0 ? cachedTexture : texture;
            }
          }]);
        }(EventEmitter);
        /*
         * If not stated otherwise in this file or this component's LICENSE file the
         * following copyright and licenses apply:
         *
         * Copyright 2023 Comcast Cable Communications Management, LLC.
         *
         * Licensed under the Apache License, Version 2.0 (the License);
         * you may not use this file except in compliance with the License.
         * You may obtain a copy of the License at
         *
         * http://www.apache.org/licenses/LICENSE-2.0
         *
         * Unless required by applicable law or agreed to in writing, software
         * distributed under the License is distributed on an "AS IS" BASIS,
         * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
         * See the License for the specific language governing permissions and
         * limitations under the License.
         */
        var weightConversions = {
          normal: 400,
          bold: 700,
          bolder: 900,
          lighter: 100
        };
        var fontWeightToNumber = function fontWeightToNumber(weight) {
          if (typeof weight === 'number') {
            return weight;
          }
          return weightConversions[weight] || 400;
        };
        function resolveFontToUse(familyMapsByPriority, family, weightIn, style, stretch) {
          var weight = fontWeightToNumber(weightIn);
          var _iterator8 = _createForOfIteratorHelper(familyMapsByPriority),
            _step8;
          try {
            for (_iterator8.s(); !(_step8 = _iterator8.n()).done;) {
              var fontFamiles = _step8.value;
              var fontFaces = fontFamiles[family];
              if (!fontFaces) {
                continue;
              }
              if (fontFaces.size === 1) {
                // No Exact match found, find nearest weight match
                console.warn("TrFontManager: Only one font face found for family: '".concat(family, "' - will be used for all weights and styles"));
                return fontFaces.values().next().value;
              }
              var weightMap = new Map();
              var _iterator9 = _createForOfIteratorHelper(fontFaces),
                _step9;
              try {
                for (_iterator9.s(); !(_step9 = _iterator9.n()).done;) {
                  var fontFace = _step9.value;
                  var fontFamilyWeight = fontWeightToNumber(fontFace.descriptors.weight);
                  if (fontFamilyWeight === weight && fontFace.descriptors.style === style && fontFace.descriptors.stretch === stretch) {
                    return fontFace;
                  }
                  weightMap.set(fontFamilyWeight, fontFace);
                }
                // No Exact match found, find nearest weight match
              } catch (err) {
                _iterator9.e(err);
              } finally {
                _iterator9.f();
              }
              var msg = "TrFontManager: No exact match: '".concat(family, " Weight: ").concat(weight, " Style: ").concat(style, " Stretch: ").concat(stretch, "'");
              console.error(msg);
              // Follow the CSS font-weight algorithm to find the nearest weight match
              // https://www.w3.org/TR/2018/REC-css-fonts-3-20180920/#font-matching-algorithm
              if (weight === 400 && weightMap.has(500)) {
                return weightMap.get(500);
              }
              if (weight === 500 && weightMap.has(400)) {
                return weightMap.get(400);
              }
              if (weight < 400) {
                while (weight > 0) {
                  if (weightMap.has(weight)) {
                    return weightMap.get(weight);
                  }
                  weight -= 100;
                }
                // reset back for the next loop
                weight = 600;
              }
              while (weight < 1000) {
                if (weightMap.has(weight)) {
                  return weightMap.get(weight);
                }
                weight += 100;
              }
              // finally check lower again
              weight = 500;
              while (weight > 0) {
                if (weightMap.has(weight)) {
                  return weightMap.get(weight);
                }
                weight -= 100;
              }
            }
          } catch (err) {
            _iterator8.e(err);
          } finally {
            _iterator8.f();
          }
          return;
        }
        var TrFontManager = /*#__PURE__*/function () {
          function TrFontManager(textRenderers) {
            _classCallCheck(this, TrFontManager);
            _defineProperty(this, "textRenderers", void 0);
            _defineProperty(this, "fontCache", new Map());
            this.textRenderers = textRenderers;
            // Intentionally left blank
          }
          return _createClass(TrFontManager, [{
            key: "addFontFace",
            value: function addFontFace(font) {
              // All the font face to all of the text renderers that support it
              for (var trId in this.textRenderers) {
                var tr = this.textRenderers[trId];
                if (tr && tr.isFontFaceSupported(font)) {
                  tr.addFontFace(font);
                }
              }
            }
            /**
             * Utility method to resolve a single font face from a list of prioritized family maps based on
             * a set of font properties.
             *
             * @remarks
             * These are to be used by a text renderer to resolve a font face if needed.
             *
             * @param familyMapsByPriority
             * @param props
             * @returns
             */
          }, {
            key: "resolveFontFace",
            value: function resolveFontFace(familyMapsByPriority, props, rendererType) {
              var fontFamily = props.fontFamily,
                fontWeight = props.fontWeight,
                fontStyle = props.fontStyle,
                fontStretch = props.fontStretch;
              var fontCacheString = "".concat(rendererType, "_").concat(fontFamily, "_").concat(fontStyle, "_").concat(fontWeight, "_").concat(fontStretch);
              if (this.fontCache.has(fontCacheString) === true) {
                return this.fontCache.get(fontCacheString);
              }
              var resolvedFont = resolveFontToUse(familyMapsByPriority, fontFamily, fontWeight, fontStyle, fontStretch);
              if (resolvedFont !== undefined) {
                this.fontCache.set(fontCacheString, resolvedFont);
              }
              return resolvedFont;
            }
          }]);
        }();
        /*
         * If not stated otherwise in this file or this component's LICENSE file the
         * following copyright and licenses apply:
         *
         * Copyright 2023 Comcast Cable Communications Management, LLC.
         *
         * Licensed under the Apache License, Version 2.0 (the License);
         * you may not use this file except in compliance with the License.
         * You may obtain a copy of the License at
         *
         * http://www.apache.org/licenses/LICENSE-2.0
         *
         * Unless required by applicable law or agreed to in writing, software
         * distributed under the License is distributed on an "AS IS" BASIS,
         * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
         * See the License for the specific language governing permissions and
         * limitations under the License.
         */
        var CoreShader = /*#__PURE__*/function () {
          function CoreShader() {
            _classCallCheck(this, CoreShader);
          }
          return _createClass(CoreShader, null, [{
            key: "makeCacheKey",
            value:
            // abstract draw(): void;
            function makeCacheKey(props) {
              return false;
            }
          }, {
            key: "resolveDefaults",
            value: function resolveDefaults(props) {
              return {};
            }
          }]);
        }();
        /*
         * If not stated otherwise in this file or this component's LICENSE file the
         * following copyright and licenses apply:
         *
         * Copyright 2023 Comcast Cable Communications Management, LLC.
         *
         * Licensed under the Apache License, Version 2.0 (the License);
         * you may not use this file except in compliance with the License.
         * You may obtain a copy of the License at
         *
         * http://www.apache.org/licenses/LICENSE-2.0
         *
         * Unless required by applicable law or agreed to in writing, software
         * distributed under the License is distributed on an "AS IS" BASIS,
         * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
         * See the License for the specific language governing permissions and
         * limitations under the License.
         */
        //#endregion Types
        function createShader(glw, type, source) {
          var shader = glw.createShader(type);
          if (!shader) {
            var glError = glw.getError();
            throw new Error("Unable to create the shader: ".concat(type === glw.VERTEX_SHADER ? 'VERTEX_SHADER' : 'FRAGMENT_SHADER', ".").concat(glError ? " WebGlContext Error: ".concat(glError) : ''));
          }
          glw.shaderSource(shader, source);
          glw.compileShader(shader);
          var success = !!glw.getShaderParameter(shader, glw.COMPILE_STATUS);
          if (success) {
            return shader;
          }
          console.error(glw.getShaderInfoLog(shader));
          glw.deleteShader(shader);
        }
        function createProgram(glw, vertexShader, fragmentShader) {
          var program = glw.createProgram();
          if (!program) {
            throw new Error('Unable to create program');
          }
          glw.attachShader(program, vertexShader);
          glw.attachShader(program, fragmentShader);
          glw.linkProgram(program);
          var success = !!glw.getProgramParameter(program, glw.LINK_STATUS);
          if (success) {
            return program;
          }
          console.warn(glw.getProgramInfoLog(program));
          glw.deleteProgram(program);
          return undefined;
        }

        /*
         * If not stated otherwise in this file or this component's LICENSE file the
         * following copyright and licenses apply:
         *
         * Copyright 2023 Comcast Cable Communications Management, LLC.
         *
         * Licensed under the Apache License, Version 2.0 (the License);
         * you may not use this file except in compliance with the License.
         * You may obtain a copy of the License at
         *
         * http://www.apache.org/licenses/LICENSE-2.0
         *
         * Unless required by applicable law or agreed to in writing, software
         * distributed under the License is distributed on an "AS IS" BASIS,
         * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
         * See the License for the specific language governing permissions and
         * limitations under the License.
         */
        var WebGlCoreShader = /*#__PURE__*/function (_CoreShader) {
          function WebGlCoreShader(options) {
            var _this18;
            _classCallCheck(this, WebGlCoreShader);
            _this18 = _callSuper(this, WebGlCoreShader);
            _defineProperty(_this18, "boundBufferCollection", null);
            _defineProperty(_this18, "buffersBound", false);
            _defineProperty(_this18, "program", void 0);
            /**
             * Vertex Array Object
             *
             * @remarks
             * Used by WebGL2 Only
             */
            _defineProperty(_this18, "vao", void 0);
            _defineProperty(_this18, "renderer", void 0);
            _defineProperty(_this18, "glw", void 0);
            _defineProperty(_this18, "attributeBuffers", void 0);
            _defineProperty(_this18, "attributeLocations", void 0);
            _defineProperty(_this18, "attributeNames", void 0);
            _defineProperty(_this18, "uniformLocations", void 0);
            _defineProperty(_this18, "uniformTypes", void 0);
            _defineProperty(_this18, "supportsIndexedTextures", void 0);
            var renderer = _this18.renderer = options.renderer;
            var glw = _this18.glw = _this18.renderer.glw;
            _this18.supportsIndexedTextures = options.supportsIndexedTextures || false;
            // Check that extensions are supported
            var webGl2 = glw.isWebGl2();
            var requiredExtensions = webGl2 && options.webgl2Extensions || !webGl2 && options.webgl1Extensions || [];
            var glVersion = webGl2 ? '2.0' : '1.0';
            requiredExtensions.forEach(function (extensionName) {
              if (!glw.getExtension(extensionName)) {
                throw new Error("Shader \"".concat(_this18.constructor.name, "\" requires extension \"").concat(extensionName, "\" for WebGL ").concat(glVersion, " but wasn't found"));
              }
            });
            // Gather shader sources
            // - If WebGL 2 and special WebGL 2 sources are provided, we copy those sources and delete
            // the extra copy of them to save memory.
            // TODO: This could be further made optimal by just caching the compiled shaders and completely deleting
            // the source code
            var shaderSources = options.shaderSources || _this18.constructor.shaderSources;
            if (!shaderSources) {
              throw new Error("Shader \"".concat(_this18.constructor.name, "\" is missing shaderSources."));
            } else if (webGl2 && shaderSources !== null && shaderSources !== void 0 && shaderSources.webGl2) {
              shaderSources.fragment = shaderSources.webGl2.fragment;
              shaderSources.vertex = shaderSources.webGl2.vertex;
              delete shaderSources.webGl2;
            }
            var textureUnits = renderer.system.parameters.MAX_VERTEX_TEXTURE_IMAGE_UNITS;
            var vertexSource = shaderSources.vertex instanceof Function ? shaderSources.vertex(textureUnits) : shaderSources.vertex;
            var fragmentSource = shaderSources.fragment instanceof Function ? shaderSources.fragment(textureUnits) : shaderSources.fragment;
            var vertexShader = createShader(glw, glw.VERTEX_SHADER, vertexSource);
            var fragmentShader = createShader(glw, glw.FRAGMENT_SHADER, fragmentSource);
            if (!vertexShader || !fragmentShader) {
              throw new Error("Unable to create the following shader(s): ".concat([!vertexShader && 'VERTEX_SHADER', !fragmentShader && 'FRAGMENT_SHADER'].filter(Boolean).join(' and ')));
            }
            var program = createProgram(glw, vertexShader, fragmentShader);
            if (!program) {
              throw new Error('Unable to create program');
            }
            _this18.program = program;
            _this18.attributeLocations = {};
            _this18.attributeBuffers = {};
            _this18.attributeNames = [];
            _toConsumableArray(options.attributes).forEach(function (attributeName) {
              var location = glw.getAttribLocation(_this18.program, attributeName);
              if (location < 0) {
                throw new Error("".concat(_this18.constructor.name, ": Vertex shader must have an attribute \"").concat(attributeName, "\"!"));
              }
              var buffer = glw.createBuffer();
              if (!buffer) {
                throw new Error("".concat(_this18.constructor.name, ": Could not create buffer for attribute \"").concat(attributeName, "\""));
              }
              _this18.attributeLocations[attributeName] = location;
              _this18.attributeBuffers[attributeName] = buffer;
              _this18.attributeNames.push(attributeName);
            });
            _this18.uniformLocations = {};
            _this18.uniformTypes = {};
            options.uniforms.forEach(function (uniform) {
              var location = glw.getUniformLocation(_this18.program, uniform.name);
              _this18.uniformTypes[uniform.name] = uniform.uniform;
              if (!location) {
                console.warn("Shader \"".concat(_this18.constructor.name, "\" could not get uniform location for \"").concat(uniform.name, "\""));
                return;
              }
              _this18.uniformLocations[uniform.name] = location;
            });
            return _this18;
          }
          _inherits(WebGlCoreShader, _CoreShader);
          return _createClass(WebGlCoreShader, [{
            key: "bindBufferAttribute",
            value: function bindBufferAttribute(location, buffer, attribute) {
              var glw = this.glw;
              glw.enableVertexAttribArray(location);
              glw.vertexAttribPointer(buffer, location, attribute.size, attribute.type, attribute.normalized, attribute.stride, attribute.offset);
            }
          }, {
            key: "disableAttribute",
            value: function disableAttribute(location) {
              this.glw.disableVertexAttribArray(location);
            }
          }, {
            key: "disableAttributes",
            value: function disableAttributes() {
              for (var loc in this.attributeLocations) {
                this.disableAttribute(this.attributeLocations[loc]);
              }
              this.boundBufferCollection = null;
            }
            /**
             * Given two sets of Shader props destined for this Shader, determine if they can be batched together
             * to reduce the number of draw calls.
             *
             * @remarks
             * This is used by the {@link WebGlCoreRenderer} to determine if it can batch multiple consecutive draw
             * calls into a single draw call.
             *
             * By default, this returns false (meaning no batching is allowed), but can be
             * overridden by child classes to provide more efficient batching.
             *
             * @param propsA
             * @param propsB
             * @returns
             */
          }, {
            key: "canBatchShaderProps",
            value: function canBatchShaderProps(propsA, propsB) {
              return false;
            }
          }, {
            key: "bindRenderOp",
            value: function bindRenderOp(renderOp, props) {
              var _renderOp$textures$;
              this.bindBufferCollection(renderOp.buffers);
              // Since we're not using batched rendering yet we can safely test
              // for first texture only
              if (renderOp.textures.length > 0 && (_renderOp$textures$ = renderOp.textures[0]) !== null && _renderOp$textures$ !== void 0 && _renderOp$textures$.ctxTexture) {
                this.bindTextures(renderOp.textures);
              }
              var glw = renderOp.glw,
                parentHasRenderTexture = renderOp.parentHasRenderTexture,
                renderToTexture = renderOp.renderToTexture;
              // Skip if the parent and current operation both have render textures
              if (renderToTexture && parentHasRenderTexture) {
                return;
              }
              // Bind render texture framebuffer dimensions as resolution
              // if the parent has a render texture
              if (parentHasRenderTexture) {
                var _ref7 = renderOp.framebufferDimensions || {},
                  width = _ref7.width,
                  height = _ref7.height;
                // Force pixel ratio to 1.0 for render textures since they are always 1:1
                // the final render texture will be rendered to the screen with the correct pixel ratio
                glw.uniform1f(this.getUniformLocation('u_pixelRatio'), 1.0);
                // Set resolution to the framebuffer dimensions
                glw.uniform2f(this.getUniformLocation('u_resolution'), width !== null && width !== void 0 ? width : 0, height !== null && height !== void 0 ? height : 0);
              } else {
                glw.uniform1f(this.getUniformLocation('u_pixelRatio'), renderOp.options.pixelRatio);
                glw.uniform2f(this.getUniformLocation('u_resolution'), glw.canvas.width, glw.canvas.height);
              }
              if (props) {
                // Bind optional automatic uniforms
                // These are only bound if their keys are present in the props.
                if (hasOwn(props, '$dimensions')) {
                  var dimensions = props.$dimensions;
                  if (!dimensions) {
                    dimensions = renderOp.dimensions;
                  }
                  glw.uniform2f(this.getUniformLocation('u_dimensions'), dimensions.width, dimensions.height);
                }
                if (hasOwn(props, '$alpha')) {
                  var alpha = props.$alpha;
                  if (!alpha) {
                    alpha = renderOp.alpha;
                  }
                  glw.uniform1f(this.getUniformLocation('u_alpha'), alpha);
                }
                this.bindProps(props);
              }
            }
          }, {
            key: "getUniformLocation",
            value: function getUniformLocation(name) {
              return this.uniformLocations[name] || null;
            }
          }, {
            key: "bindBufferCollection",
            value: function bindBufferCollection(buffer) {
              if (this.boundBufferCollection === buffer) {
                return;
              }
              for (var attributeName in this.attributeLocations) {
                var resolvedBuffer = buffer.getBuffer(attributeName);
                var resolvedInfo = buffer.getAttributeInfo(attributeName);
                assertTruthy(resolvedBuffer, "Buffer for \"".concat(attributeName, "\" not found"));
                assertTruthy(resolvedInfo);
                this.bindBufferAttribute(this.attributeLocations[attributeName], resolvedBuffer, resolvedInfo);
              }
              this.boundBufferCollection = buffer;
            }
          }, {
            key: "bindProps",
            value: function bindProps(props) {
              // Implement in child class
            }
          }, {
            key: "bindTextures",
            value: function bindTextures(textures) {
              // no defaults
            }
          }, {
            key: "attach",
            value: function attach() {
              this.glw.useProgram(this.program);
              if (this.glw.isWebGl2() && this.vao) {
                this.glw.bindVertexArray(this.vao);
              }
            }
          }, {
            key: "detach",
            value: function detach() {
              this.disableAttributes();
            }
          }]);
        }(CoreShader);
        /*
         * If not stated otherwise in this file or this component's LICENSE file the
         * following copyright and licenses apply:
         *
         * Copyright 2023 Comcast Cable Communications Management, LLC.
         *
         * Licensed under the Apache License, Version 2.0 (the License);
         * you may not use this file except in compliance with the License.
         * You may obtain a copy of the License at
         *
         * http://www.apache.org/licenses/LICENSE-2.0
         *
         * Unless required by applicable law or agreed to in writing, software
         * distributed under the License is distributed on an "AS IS" BASIS,
         * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
         * See the License for the specific language governing permissions and
         * limitations under the License.
         */
        _defineProperty(WebGlCoreShader, "shaderSources", void 0);
        var DefaultShader = /*#__PURE__*/function (_WebGlCoreShader2) {
          function DefaultShader(renderer) {
            _classCallCheck(this, DefaultShader);
            return _callSuper(this, DefaultShader, [{
              renderer: renderer,
              attributes: ['a_position', 'a_textureCoordinate', 'a_color'],
              uniforms: [{
                name: 'u_resolution',
                uniform: 'uniform2fv'
              }, {
                name: 'u_pixelRatio',
                uniform: 'uniform1f'
              }, {
                name: 'u_texture',
                uniform: 'uniform2fv'
              }]
            }]);
          }
          _inherits(DefaultShader, _WebGlCoreShader2);
          return _createClass(DefaultShader, [{
            key: "bindTextures",
            value: function bindTextures(textures) {
              var glw = this.glw;
              glw.activeTexture(0);
              glw.bindTexture(textures[0].ctxTexture);
            }
          }]);
        }(WebGlCoreShader);
        /*
         * If not stated otherwise in this file or this component's LICENSE file the
         * following copyright and licenses apply:
         *
         * Copyright 2023 Comcast Cable Communications Management, LLC.
         *
         * Licensed under the Apache License, Version 2.0 (the License);
         * you may not use this file except in compliance with the License.
         * You may obtain a copy of the License at
         *
         * http://www.apache.org/licenses/LICENSE-2.0
         *
         * Unless required by applicable law or agreed to in writing, software
         * distributed under the License is distributed on an "AS IS" BASIS,
         * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
         * See the License for the specific language governing permissions and
         * limitations under the License.
         */
        // import type { Texture } from '../textures/Texture';
        _defineProperty(DefaultShader, "shaderSources", {
          vertex: "\n      # ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n      # else\n      precision mediump float;\n      # endif\n\n      attribute vec2 a_position;\n      attribute vec2 a_textureCoordinate;\n      attribute vec4 a_color;\n\n      uniform vec2 u_resolution;\n      uniform float u_pixelRatio;\n\n\n      varying vec4 v_color;\n      varying vec2 v_textureCoordinate;\n\n      void main() {\n        vec2 normalized = a_position * u_pixelRatio;\n        vec2 screenSpace = vec2(2.0 / u_resolution.x, -2.0 / u_resolution.y);\n\n        v_color = a_color;\n        v_textureCoordinate = a_textureCoordinate;\n\n        gl_Position = vec4(normalized.x * screenSpace.x - 1.0, normalized.y * -abs(screenSpace.y) + 1.0, 0.0, 1.0);\n        gl_Position.y = -sign(screenSpace.y) * gl_Position.y;\n      }\n    ",
          fragment: "\n      # ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n      # else\n      precision mediump float;\n      # endif\n\n      uniform vec2 u_resolution;\n      uniform sampler2D u_texture;\n\n      varying vec4 v_color;\n      varying vec2 v_textureCoordinate;\n\n      void main() {\n          vec4 color = texture2D(u_texture, v_textureCoordinate);\n          gl_FragColor = vec4(v_color) * texture2D(u_texture, v_textureCoordinate);\n      }\n    "
        });
        var DefaultShaderBatched = /*#__PURE__*/function (_WebGlCoreShader3) {
          function DefaultShaderBatched(renderer) {
            var _this19;
            _classCallCheck(this, DefaultShaderBatched);
            _this19 = _callSuper(this, DefaultShaderBatched, [{
              renderer: renderer,
              attributes: ['a_position', 'a_textureCoordinate', 'a_color', 'a_textureIndex'],
              uniforms: [{
                name: 'u_resolution',
                uniform: 'uniform2fv'
              }, {
                name: 'u_pixelRatio',
                uniform: 'uniform1f'
              }, {
                name: 'u_textures[0]',
                uniform: 'uniform1iv'
              }]
            }]);
            _defineProperty(_this19, "supportsIndexedTextures", true);
            return _this19;
          }
          _inherits(DefaultShaderBatched, _WebGlCoreShader3);
          return _createClass(DefaultShaderBatched, [{
            key: "bindTextures",
            value: function bindTextures(texture) {
              var renderer = this.renderer,
                glw = this.glw;
              if (texture.length > renderer.system.parameters.MAX_VERTEX_TEXTURE_IMAGE_UNITS) {
                throw new Error("DefaultShaderBatched: Cannot bind more than ".concat(renderer.system.parameters.MAX_VERTEX_TEXTURE_IMAGE_UNITS, " textures"));
              }
              texture.forEach(function (t, i) {
                glw.activeTexture(i);
                glw.bindTexture(t.ctxTexture);
              });
              var samplers = Array.from(Array(texture.length).keys());
              this.glw.uniform1iv(this.getUniformLocation('u_textures[0]'), samplers);
            }
          }]);
        }(WebGlCoreShader);
        _defineProperty(DefaultShaderBatched, "shaderSources", {
          vertex: "\n      # ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n      # else\n      precision mediump float;\n      # endif\n\n      attribute vec2 a_textureCoordinate;\n      attribute vec2 a_position;\n      attribute vec4 a_color;\n      attribute float a_textureIndex;\n      attribute float a_depth;\n\n      uniform vec2 u_resolution;\n      uniform float u_pixelRatio;\n\n      varying vec4 v_color;\n      varying vec2 v_textureCoordinate;\n      varying float v_textureIndex;\n\n      void main(){\n        vec2 normalized = a_position * u_pixelRatio / u_resolution;\n        vec2 zero_two = normalized * 2.0;\n        vec2 clip_space = zero_two - 1.0;\n\n        // pass to fragment\n        v_color = a_color;\n        v_textureCoordinate = a_textureCoordinate;\n        v_textureIndex = a_textureIndex;\n\n        // flip y\n        gl_Position = vec4(clip_space * vec2(1.0, -1.0), 0, 1);\n      }\n    ",
          fragment: function fragment(textureUnits) {
            return "\n      #define txUnits ".concat(textureUnits, "\n      # ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n      # else\n      precision mediump float;\n      # endif\n\n      uniform vec2 u_resolution;\n      uniform sampler2D u_image;\n      uniform sampler2D u_textures[txUnits];\n\n      varying vec4 v_color;\n      varying vec2 v_textureCoordinate;\n      varying float v_textureIndex;\n\n      vec4 sampleFromTexture(sampler2D textures[").concat(textureUnits, "], int idx, vec2 uv) {\n        ").concat(Array.from(Array(textureUnits).keys()).map(function (idx) {
              return "\n          ".concat(idx !== 0 ? 'else ' : '', "if (idx == ").concat(idx, ") {\n            return texture2D(textures[").concat(idx, "], uv);\n          }\n        ");
            }).join(''), "\n        return texture2D(textures[0], uv);\n      }\n\n      void main(){\n        gl_FragColor = vec4(v_color) * sampleFromTexture(u_textures, int(v_textureIndex), v_textureCoordinate);\n      }\n    ");
          }
        });
        var ShaderEffect = /*#__PURE__*/function () {
          function ShaderEffect(options) {
            _classCallCheck(this, ShaderEffect);
            _defineProperty(this, "priority", 1);
            _defineProperty(this, "name", '');
            _defineProperty(this, "ref", void 0);
            _defineProperty(this, "target", void 0);
            _defineProperty(this, "passParameters", '');
            _defineProperty(this, "declaredUniforms", '');
            _defineProperty(this, "uniformInfo", {});
            var ref = options.ref,
              target = options.target,
              _options$props = options.props,
              props = _options$props === void 0 ? {} : _options$props;
            this.ref = ref;
            this.target = target;
            var uniformInfo = {};
            var passParameters = [];
            var declaredUniforms = '';
            var uniforms = this.constructor.uniforms || {};
            for (var u in uniforms) {
              var unif = uniforms[u];
              var uniType = unif.type;
              //make unique uniform name
              var uniformName = "".concat(ref, "_").concat(u);
              var define = '';
              if (unif.size) {
                define = "[".concat(unif.size(props), "]");
              }
              passParameters.push(uniformName);
              declaredUniforms += "uniform ".concat(uniType, " ").concat(uniformName).concat(define, ";");
              uniformInfo[u] = {
                name: uniformName,
                uniform: uniforms[u].method
              };
            }
            this.passParameters = passParameters.join(',');
            this.declaredUniforms = declaredUniforms;
            this.uniformInfo = uniformInfo;
          }
          return _createClass(ShaderEffect, null, [{
            key: "getEffectKey",
            value: function getEffectKey(props) {
              return '';
            }
          }, {
            key: "getMethodParameters",
            value: function getMethodParameters(uniforms, props) {
              var res = [];
              for (var u in uniforms) {
                var uni = uniforms[u];
                var define = '';
                if (uni.size) {
                  define = "[".concat(uni.size(props), "]");
                }
                res.push("".concat(uni.type, " ").concat(u).concat(define));
              }
              return res.join(',');
            }
          }, {
            key: "resolveDefaults",
            value: function resolveDefaults(props) {
              return {};
            }
          }, {
            key: "makeEffectKey",
            value: function makeEffectKey(props) {
              return false;
            }
          }]);
        }();
        _defineProperty(ShaderEffect, "uniforms", {});
        _defineProperty(ShaderEffect, "methods", void 0);
        _defineProperty(ShaderEffect, "onShaderMask", void 0);
        _defineProperty(ShaderEffect, "onColorize", void 0);
        _defineProperty(ShaderEffect, "onEffectMask", void 0);
        var effectCache = new Map();
        var getResolvedEffect = function getResolvedEffect(effects, effectContructors) {
          var key = JSON.stringify(effects);
          if (effectCache.has(key)) {
            return effectCache.get(key);
          }
          effects = effects !== null && effects !== void 0 ? effects : [];
          var resolvedEffects = [];
          var effectsLength = effects.length;
          var i = 0;
          for (; i < effectsLength; i++) {
            var _effects$i = effects[i],
              name = _effects$i.name,
              type = _effects$i.type,
              props = _effects$i.props;
            var resolvedEffect = {
              name: name,
              type: type,
              props: {}
            };
            var effectConstructor = effectContructors[type];
            var defaultPropValues = effectConstructor.resolveDefaults(props);
            var uniforms = effectConstructor.uniforms;
            var uniformKeys = Object.keys(uniforms);
            var uniformsLength = uniformKeys.length;
            var j = 0;
            for (; j < uniformsLength; j++) {
              var _key4 = uniformKeys[j];
              var uniform = uniforms[_key4];
              var result = {
                value: defaultPropValues[_key4],
                programValue: undefined,
                method: uniform.method,
                updateOnBind: uniform.updateOnBind || false,
                hasValidator: uniform.validator !== undefined,
                hasProgramValueUpdater: uniform.updateProgramValue !== undefined
              };
              var validatedValue = result.hasValidator && uniform.validator(defaultPropValues[_key4], defaultPropValues) || defaultPropValues[_key4];
              if (defaultPropValues[_key4] !== validatedValue) {
                result.validatedValue = validatedValue;
              }
              if (result.hasProgramValueUpdater) {
                uniform.updateProgramValue(result);
              }
              if (result.programValue === undefined) {
                result.programValue = result.value;
              }
              resolvedEffect.props[_key4] = result;
            }
            resolvedEffects.push(resolvedEffect);
          }
          effectCache.set(key, resolvedEffects);
          return resolvedEffects;
        };
        var DynamicShader = /*#__PURE__*/function (_WebGlCoreShader4) {
          function DynamicShader(renderer, props, effectContructors) {
            var _this20;
            _classCallCheck(this, DynamicShader);
            var shader = DynamicShader.createShader(props, effectContructors);
            _this20 = _callSuper(this, DynamicShader, [{
              renderer: renderer,
              attributes: ['a_position', 'a_textureCoordinate', 'a_color'],
              uniforms: [{
                name: 'u_resolution',
                uniform: 'uniform2fv'
              }, {
                name: 'u_pixelRatio',
                uniform: 'uniform1f'
              }, {
                name: 'u_texture',
                uniform: 'uniform2fv'
              }, {
                name: 'u_dimensions',
                uniform: 'uniform2fv'
              }, {
                name: 'u_alpha',
                uniform: 'uniform1f'
              }].concat(_toConsumableArray(shader.uniforms)),
              shaderSources: {
                vertex: shader.vertex,
                fragment: shader.fragment
              }
            }]);
            _defineProperty(_this20, "effects", []);
            _this20.effects = shader.effects;
            return _this20;
          }
          _inherits(DynamicShader, _WebGlCoreShader4);
          return _createClass(DynamicShader, [{
            key: "bindTextures",
            value: function bindTextures(textures) {
              var glw = this.glw;
              glw.activeTexture(0);
              glw.bindTexture(textures[0].ctxTexture);
            }
          }, {
            key: "bindUniformMethods",
            value: function bindUniformMethods(props) {
              var _this21 = this;
              var glw = this.glw;
              var effects = props.effects;
              var effectsL = effects.length;
              for (var i = 0; i < effectsL; i++) {
                var uniformInfo = this.effects[i].uniformInfo;
                var _effect2 = effects[i];
                var propKeys = Object.keys(_effect2.props);
                var propsLength = propKeys.length;
                var _loop = function _loop() {
                    var key = propKeys[j];
                    var method = _effect2.props[key].method;
                    var location = _this21.getUniformLocation(uniformInfo[key].name);
                    if (method === 'uniform2fv' || method === 'uniform2iv' ||
                    //uniform === 'uniform3fv	' || <--- check why this isnt recognized
                    method === 'uniform3iv' || method === 'uniform4fv' || method === 'uniform4iv' || method === 'uniformMatrix2fv' || method === 'uniformMatrix3fv' || method === 'uniformMatrix4fv' || method === 'uniform1f' || method === 'uniform1fv' || method === 'uniform1i' || method === 'uniform1iv') {
                      _effect2.props[key].setUniformValue = function () {
                        glw[method](location, this.programValue);
                      };
                      return 0; // continue
                    }
                    if (method === 'uniform2f' || method === 'uniform2i') {
                      _effect2.props[key].setUniformValue = function () {
                        glw[method](location, this.programValue[0], this.programValue[1]);
                      };
                      return 0; // continue
                    }
                    if (method === 'uniform3f' || method === 'uniform3i') {
                      _effect2.props[key].setUniformValue = function () {
                        glw[method](location, this.programValue[0], this.programValue[1], this.programValue[2]);
                      };
                      return 0; // continue
                    }
                    if (method === 'uniform4f' || method === 'uniform4i') {
                      _effect2.props[key].setUniformValue = function () {
                        glw[method](location, this.programValue[0], this.programValue[1], this.programValue[2], this.programValue[3]);
                      };
                      return 0; // continue
                    }
                  },
                  _ret;
                for (var j = 0; j < propsLength; j++) {
                  _ret = _loop();
                  if (_ret === 0) continue;
                }
              }
            }
          }, {
            key: "bindProps",
            value: function bindProps(props) {
              var effects = props.effects;
              var effectsL = effects.length;
              var i = 0;
              for (; i < effectsL; i++) {
                var _effect3 = effects[i];
                var propKeys = Object.keys(_effect3.props);
                var propsLength = propKeys.length;
                var j = 0;
                for (; j < propsLength; j++) {
                  var key = propKeys[j];
                  var prop = _effect3.props[key];
                  if (prop.updateOnBind === true) {
                    var _this$renderer$shMana;
                    var uniform = (_this$renderer$shMana = this.renderer.shManager.getRegisteredEffects()[_effect3.type]) === null || _this$renderer$shMana === void 0 ? void 0 : _this$renderer$shMana.uniforms[key];
                    uniform === null || uniform === void 0 || uniform.updateProgramValue(_effect3.props[key], props);
                  }
                  prop.setUniformValue();
                }
              }
            }
          }, {
            key: "canBatchShaderProps",
            value: function canBatchShaderProps(propsA, propsB) {
              if (propsA.$alpha !== propsB.$alpha || propsA.$dimensions.width !== propsB.$dimensions.width || propsA.$dimensions.height !== propsB.$dimensions.height || propsA.effects.length !== propsB.effects.length) {
                return false;
              }
              var propsEffectsLen = propsA.effects.length;
              var i = 0;
              for (; i < propsEffectsLen; i++) {
                var effectA = propsA.effects[i];
                var effectB = propsB.effects[i];
                if (effectA.type !== effectB.type) {
                  return false;
                }
                for (var key in effectA.props) {
                  if (effectB.props && !effectB.props[key] || effectA.props[key].value !== effectB.props[key].value) {
                    return false;
                  }
                }
              }
              return true;
            }
          }], [{
            key: "createShader",
            value: function createShader(props, effectContructors) {
              //counts duplicate effects
              var effectNameCount = {};
              var methods = {};
              var declareUniforms = '';
              var uniforms = [];
              var uFx = [];
              var effects = props.effects.map(function (effect) {
                var baseClass = effectContructors[effect.type];
                var key = baseClass.getEffectKey(effect.props || {});
                effectNameCount[key] = effectNameCount[key] ? ++effectNameCount[key] : 1;
                var nr = effectNameCount[key];
                if (nr === 1) {
                  uFx.push({
                    key: key,
                    type: effect.type,
                    props: effect.props
                  });
                }
                //initialize new effect class;
                var fxClass = new baseClass({
                  ref: "".concat(key).concat(nr === 1 ? '' : nr),
                  target: key,
                  props: effect.props
                });
                declareUniforms += fxClass.declaredUniforms;
                uniforms.push.apply(uniforms, _toConsumableArray(Object.values(fxClass.uniformInfo)));
                return fxClass;
              });
              //build source
              var effectMethods = '';
              uFx === null || uFx === void 0 || uFx.forEach(function (fx) {
                var _fx$props;
                var fxClass = effectContructors[fx.type];
                var fxProps = fxClass.resolveDefaults((_fx$props = fx.props) !== null && _fx$props !== void 0 ? _fx$props : {});
                var remap = [];
                for (var m in fxClass.methods) {
                  var cm = m;
                  var fxMethod = fxClass.methods[m];
                  if (methods[m] && methods[m] !== fxMethod) {
                    cm = DynamicShader.resolveMethodDuplicate(m, fxMethod, methods);
                  }
                  methods[cm] = fxMethod.replace('function', cm);
                  remap.push({
                    m: m,
                    cm: cm
                  });
                }
                var onShaderMask = fxClass.onShaderMask instanceof Function ? fxClass.onShaderMask(fxProps) : fxClass.onShaderMask;
                var onColorize = fxClass.onColorize instanceof Function ? fxClass.onColorize(fxProps) : fxClass.onColorize;
                var onEffectMask = fxClass.onEffectMask instanceof Function ? fxClass.onEffectMask(fxProps) : fxClass.onEffectMask;
                remap.forEach(function (r) {
                  var m = r.m,
                    cm = r.cm;
                  var reg = new RegExp("\\$".concat(m), 'g');
                  if (onShaderMask) {
                    onShaderMask = onShaderMask.replace(reg, cm);
                  }
                  if (onColorize) {
                    onColorize = onColorize.replace(reg, cm);
                  }
                  if (onEffectMask) {
                    onEffectMask = onEffectMask.replace(reg, cm);
                  }
                });
                var methodParameters = fxClass.getMethodParameters(fxClass.uniforms, fxProps);
                var pm = methodParameters.length > 0 ? ", ".concat(methodParameters) : '';
                if (onShaderMask) {
                  effectMethods += "\n        float fx_".concat(fx.key, "_onShaderMask(float shaderMask ").concat(pm, ") {\n          ").concat(onShaderMask, "\n        }\n        ");
                }
                if (onColorize) {
                  effectMethods += "\n          vec4 fx_".concat(fx.key, "_onColorize(float shaderMask, vec4 maskColor, vec4 shaderColor").concat(pm, ") {\n            ").concat(onColorize, "\n          }\n        ");
                }
                if (onEffectMask) {
                  effectMethods += "\n          vec4 fx_".concat(fx.key, "_onEffectMask(float shaderMask, vec4 maskColor, vec4 shaderColor").concat(pm, ") {\n            ").concat(onEffectMask, "\n          }\n        ");
                }
              });
              var sharedMethods = '';
              for (var m in methods) {
                sharedMethods += methods[m];
              }
              //fill main functions
              var currentMask = "mix(shaderColor, maskColor, clamp(-(lng_DefaultMask), 0.0, 1.0))";
              var drawEffects = "\n\n    ";
              for (var i = 0; i < effects.length; i++) {
                var current = effects[i];
                var pm = current.passParameters.length > 0 ? ", ".concat(current.passParameters) : '';
                var currentClass = effectContructors[current.name];
                if (currentClass.onShaderMask) {
                  drawEffects += "\n        shaderMask = fx_".concat(current.target, "_onShaderMask(shaderMask ").concat(pm, ");\n        ");
                }
                if (currentClass.onColorize) {
                  drawEffects += "\n        maskColor = fx_".concat(current.target, "_onColorize(shaderMask, maskColor, shaderColor").concat(pm, ");\n        ");
                }
                if (currentClass.onEffectMask) {
                  currentMask = "fx_".concat(current.target, "_onEffectMask(shaderMask, maskColor, shaderColor").concat(pm, ")");
                }
                var next = effects[i + 1];
                if (next === undefined || effectContructors[next.name].onEffectMask) {
                  drawEffects += "\n          shaderColor = ".concat(currentMask, ";\n        ");
                }
              }
              return {
                effects: effects,
                uniforms: uniforms,
                fragment: DynamicShader.fragment(declareUniforms, sharedMethods, effectMethods, drawEffects),
                vertex: DynamicShader.vertex()
              };
            }
          }, {
            key: "resolveMethodDuplicate",
            value: function resolveMethodDuplicate(key, effectMethod, methodCollection) {
              var increment = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 0;
              var m = key + (increment > 0 ? increment : '');
              if (methodCollection[m] && methodCollection[m] !== effectMethod) {
                return this.resolveMethodDuplicate(key, effectMethod, methodCollection, ++increment);
              }
              return m;
            }
          }, {
            key: "resolveDefaults",
            value: function resolveDefaults(props, effectContructors) {
              var _props$effects;
              assertTruthy(effectContructors);
              return {
                effects: getResolvedEffect((_props$effects = props.effects) !== null && _props$effects !== void 0 ? _props$effects : [], effectContructors),
                $dimensions: {
                  width: 0,
                  height: 0
                },
                $alpha: 0
              };
            }
          }, {
            key: "makeCacheKey",
            value: function makeCacheKey(props, effectContructors) {
              var _props$effects2;
              var fx = '';
              (_props$effects2 = props.effects) === null || _props$effects2 === void 0 || _props$effects2.forEach(function (effect) {
                var baseClass = effectContructors[effect.type];
                var key = baseClass.getEffectKey(effect.props || {});
                fx += ",".concat(key);
              });
              return "DynamicShader".concat(fx);
            }
          }]);
        }(WebGlCoreShader);
        /*
         * If not stated otherwise in this file or this component's LICENSE file the
         * following copyright and licenses apply:
         *
         * Copyright 2023 Comcast Cable Communications Management, LLC.
         *
         * Licensed under the Apache License, Version 2.0 (the License);
         * you may not use this file except in compliance with the License.
         * You may obtain a copy of the License at
         *
         * http://www.apache.org/licenses/LICENSE-2.0
         *
         * Unless required by applicable law or agreed to in writing, software
         * distributed under the License is distributed on an "AS IS" BASIS,
         * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
         * See the License for the specific language governing permissions and
         * limitations under the License.
         */
        /**
         * Similar to the {@link DefaultShader} but cuts out 4 rounded rectangle corners
         * as defined by the specified corner {@link RoundedRectangleProps.radius}
         */
        _defineProperty(DynamicShader, "z$__type__Props", void 0);
        _defineProperty(DynamicShader, "vertex", function () {
          return "\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision mediump float;\n    # endif\n\n    attribute vec2 a_textureCoordinate;\n    attribute vec2 a_position;\n    attribute vec4 a_color;\n    attribute float a_textureIndex;\n\n    uniform vec2 u_resolution;\n    uniform float u_pixelRatio;\n\n    varying vec4 v_color;\n    varying vec2 v_textureCoordinate;\n    varying float v_textureIndex;\n\n    void main(){\n      vec2 normalized = a_position * u_pixelRatio / u_resolution;\n      vec2 zero_two = normalized * 2.0;\n      vec2 clip_space = zero_two - 1.0;\n\n      // pass to fragment\n      v_color = a_color;\n      v_textureCoordinate = a_textureCoordinate;\n      v_textureIndex = a_textureIndex;\n\n      // flip y\n      gl_Position = vec4(clip_space * vec2(1.0, -1.0), 0, 1);\n    }\n  ";
        });
        _defineProperty(DynamicShader, "fragment", function (uniforms, methods, effectMethods, drawEffects) {
          return "\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision mediump float;\n    # endif\n\n    #define PI 3.14159265359\n\n    uniform vec2 u_resolution;\n    uniform vec2 u_dimensions;\n    uniform float u_alpha;\n    uniform float u_radius;\n    uniform sampler2D u_texture;\n    uniform float u_pixelRatio;\n\n    ".concat(uniforms, "\n\n    varying vec4 v_color;\n    varying vec2 v_textureCoordinate;\n\n    ").concat(methods, "\n\n    ").concat(effectMethods, "\n\n    void main() {\n      vec2 p = v_textureCoordinate.xy * u_dimensions - u_dimensions * 0.5;\n      vec2 d = abs(p) - (u_dimensions) * 0.5;\n      float lng_DefaultMask = min(max(d.x, d.y), 0.0) + length(max(d, 0.0));\n\n      vec4 shaderColor = vec4(0.0);\n      float shaderMask = lng_DefaultMask;\n\n      vec4 maskColor = texture2D(u_texture, v_textureCoordinate) * v_color;\n\n      shaderColor = mix(shaderColor, maskColor, clamp(-(lng_DefaultMask + 0.5), 0.0, 1.0));\n\n      ").concat(drawEffects, "\n\n      gl_FragColor = shaderColor * u_alpha;\n    }\n  ");
        });
        var RoundedRectangle = /*#__PURE__*/function (_WebGlCoreShader5) {
          function RoundedRectangle(renderer) {
            _classCallCheck(this, RoundedRectangle);
            return _callSuper(this, RoundedRectangle, [{
              renderer: renderer,
              attributes: ['a_position', 'a_textureCoordinate', 'a_color'],
              uniforms: [{
                name: 'u_resolution',
                uniform: 'uniform2fv'
              }, {
                name: 'u_pixelRatio',
                uniform: 'uniform1f'
              }, {
                name: 'u_texture',
                uniform: 'uniform2f'
              }, {
                name: 'u_dimensions',
                uniform: 'uniform2fv'
              }, {
                name: 'u_radius',
                uniform: 'uniform1f'
              }]
            }]);
          }
          _inherits(RoundedRectangle, _WebGlCoreShader5);
          return _createClass(RoundedRectangle, [{
            key: "bindTextures",
            value: function bindTextures(textures) {
              var glw = this.glw;
              glw.activeTexture(0);
              glw.bindTexture(textures[0].ctxTexture);
            }
          }, {
            key: "bindProps",
            value: function bindProps(props) {
              var radiusFactor = Math.min(props.$dimensions.width, props.$dimensions.height) / (2.0 * props.radius);
              this.glw.uniform1f(this.getUniformLocation('u_radius'), props.radius * Math.min(radiusFactor, 1));
            }
          }, {
            key: "canBatchShaderProps",
            value: function canBatchShaderProps(propsA, propsB) {
              return propsA.radius === propsB.radius && propsA.$dimensions.width === propsB.$dimensions.width && propsA.$dimensions.height === propsB.$dimensions.height;
            }
          }], [{
            key: "resolveDefaults",
            value: function resolveDefaults(props) {
              return {
                radius: props.radius || 10,
                $dimensions: {
                  width: 0,
                  height: 0
                }
              };
            }
          }]);
        }(WebGlCoreShader);
        /*
         * If not stated otherwise in this file or this component's LICENSE file the
         * following copyright and licenses apply:
         *
         * Copyright 2023 Comcast Cable Communications Management, LLC.
         *
         * Licensed under the Apache License, Version 2.0 (the License);
         * you may not use this file except in compliance with the License.
         * You may obtain a copy of the License at
         *
         * http://www.apache.org/licenses/LICENSE-2.0
         *
         * Unless required by applicable law or agreed to in writing, software
         * distributed under the License is distributed on an "AS IS" BASIS,
         * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
         * See the License for the specific language governing permissions and
         * limitations under the License.
         */
        _defineProperty(RoundedRectangle, "z$__type__Props", void 0);
        _defineProperty(RoundedRectangle, "shaderSources", {
          vertex: "\n      # ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n      # else\n      precision mediump float;\n      # endif\n\n      attribute vec2 a_position;\n      attribute vec2 a_textureCoordinate;\n      attribute vec4 a_color;\n      attribute float a_textureIndex;\n      attribute float a_depth;\n\n      uniform vec2 u_resolution;\n      uniform float u_pixelRatio;\n\n      varying vec4 v_color;\n      varying vec2 v_textureCoordinate;\n\n      void main() {\n        vec2 normalized = a_position * u_pixelRatio / u_resolution;\n        vec2 zero_two = normalized * 2.0;\n        vec2 clip_space = zero_two - 1.0;\n\n        // pass to fragment\n        v_color = a_color;\n        v_textureCoordinate = a_textureCoordinate;\n\n        // flip y\n        gl_Position = vec4(clip_space * vec2(1.0, -1.0), 0, 1);\n      }\n    ",
          fragment: "\n      # ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n      # else\n      precision mediump float;\n      # endif\n\n      uniform vec2 u_resolution;\n      uniform vec2 u_dimensions;\n      uniform float u_radius;\n      uniform sampler2D u_texture;\n\n      varying vec4 v_color;\n      varying vec2 v_textureCoordinate;\n\n      float boxDist(vec2 p, vec2 size, float radius){\n        size -= vec2(radius);\n        vec2 d = abs(p) - size;\n        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0)) - radius;\n      }\n\n      float fillMask(float dist) {\n        return clamp(-dist, 0.0, 1.0);\n      }\n\n      void main() {\n        vec4 color = texture2D(u_texture, v_textureCoordinate) * v_color;\n        vec2 halfDimensions = u_dimensions * 0.5;\n\n        float d = boxDist(v_textureCoordinate.xy * u_dimensions - halfDimensions, halfDimensions + 0.5, u_radius);\n        gl_FragColor = mix(vec4(0.0), color, fillMask(d));\n      }\n    "
        });
        var IDENTITY_MATRIX_3x3 = new Float32Array([1, 0, 0, 0, 1, 0, 0, 0, 1]);
        /**
         * SdfShader supports multi-channel and single-channel signed distance field textures.
         *
         * @remarks
         * This Shader is used by the {@link SdfTextRenderer}. Do not use thie Shader
         * directly. Instead create a Text Node and assign a SDF font family to it.
         *
         * @internalRemarks
         * The only thing this shader does to support multi-channel SDFs is to
         * add a median function to the fragment shader. If this one function call
         * ends up being a performance bottleneck we can always look at ways to
         * remove it.
         */
        var SdfShader = /*#__PURE__*/function (_WebGlCoreShader6) {
          function SdfShader(renderer) {
            _classCallCheck(this, SdfShader);
            return _callSuper(this, SdfShader, [{
              renderer: renderer,
              attributes: ['a_position', 'a_textureCoordinate'],
              uniforms: [{
                name: 'u_resolution',
                uniform: 'uniform2fv'
              }, {
                name: 'u_transform',
                uniform: 'uniformMatrix3fv'
              }, {
                name: 'u_scrollY',
                uniform: 'uniform1f'
              }, {
                name: 'u_pixelRatio',
                uniform: 'uniform1f'
              }, {
                name: 'u_texture',
                uniform: 'uniform2f'
              }, {
                name: 'u_color',
                uniform: 'uniform4fv'
              }, {
                name: 'u_size',
                uniform: 'uniform1f'
              }, {
                name: 'u_distanceRange',
                uniform: 'uniform1f'
              }, {
                name: 'u_debug',
                uniform: 'uniform1i'
              }]
            }]);
          }
          _inherits(SdfShader, _WebGlCoreShader6);
          return _createClass(SdfShader, [{
            key: "bindTextures",
            value: function bindTextures(textures) {
              var glw = this.glw;
              glw.activeTexture(0);
              glw.bindTexture(textures[0].ctxTexture);
            }
          }, {
            key: "bindProps",
            value: function bindProps(props) {
              var resolvedProps = SdfShader.resolveDefaults(props);
              for (var key in resolvedProps) {
                if (key === 'transform') {
                  this.glw.uniformMatrix3fv(this.getUniformLocation('u_transform'), resolvedProps[key]);
                } else if (key === 'scrollY') {
                  this.glw.uniform1f(this.getUniformLocation('u_scrollY'), resolvedProps[key]);
                } else if (key === 'color') {
                  var components = getNormalizedRgbaComponents(resolvedProps.color);
                  this.glw.uniform4fv(this.getUniformLocation('u_color'), components);
                } else if (key === 'size') {
                  this.glw.uniform1f(this.getUniformLocation('u_size'), resolvedProps[key]);
                } else if (key === 'distanceRange') {
                  this.glw.uniform1f(this.getUniformLocation('u_distanceRange'), resolvedProps[key]);
                } else if (key === 'debug') {
                  this.glw.uniform1i(this.getUniformLocation('u_debug'), resolvedProps[key] ? 1 : 0);
                }
              }
            }
          }], [{
            key: "resolveDefaults",
            value: function resolveDefaults() {
              var _props$transform, _props$scrollY, _props$color, _props$size, _props$distanceRange, _props$debug;
              var props = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
              return {
                transform: (_props$transform = props.transform) !== null && _props$transform !== void 0 ? _props$transform : IDENTITY_MATRIX_3x3,
                scrollY: (_props$scrollY = props.scrollY) !== null && _props$scrollY !== void 0 ? _props$scrollY : 0,
                color: (_props$color = props.color) !== null && _props$color !== void 0 ? _props$color : 0xffffffff,
                size: (_props$size = props.size) !== null && _props$size !== void 0 ? _props$size : 16,
                distanceRange: (_props$distanceRange = props.distanceRange) !== null && _props$distanceRange !== void 0 ? _props$distanceRange : 1.0,
                debug: (_props$debug = props.debug) !== null && _props$debug !== void 0 ? _props$debug : false
              };
            }
          }]);
        }(WebGlCoreShader);
        /*
         * If not stated otherwise in this file or this component's LICENSE file the
         * following copyright and licenses apply:
         *
         * Copyright 2023 Comcast Cable Communications Management, LLC.
         *
         * Licensed under the Apache License, Version 2.0 (the License);
         * you may not use this file except in compliance with the License.
         * You may obtain a copy of the License at
         *
         * http://www.apache.org/licenses/LICENSE-2.0
         *
         * Unless required by applicable law or agreed to in writing, software
         * distributed under the License is distributed on an "AS IS" BASIS,
         * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
         * See the License for the specific language governing permissions and
         * limitations under the License.
         */
        _defineProperty(SdfShader, "z$__type__Props", void 0);
        _defineProperty(SdfShader, "shaderSources", {
          vertex: "\n      # ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n      # else\n      precision mediump float;\n      # endif\n      // an attribute is an input (in) to a vertex shader.\n      // It will receive data from a buffer\n      attribute vec2 a_position;\n      attribute vec2 a_textureCoordinate;\n\n      uniform vec2 u_resolution;\n      uniform mat3 u_transform;\n      uniform float u_scrollY;\n      uniform float u_pixelRatio;\n      uniform float u_size;\n\n      varying vec2 v_texcoord;\n\n      void main() {\n        vec2 scrolledPosition = a_position * u_size - vec2(0, u_scrollY);\n        vec2 transformedPosition = (u_transform * vec3(scrolledPosition, 1)).xy;\n\n        // Calculate screen space with pixel ratio\n        vec2 screenSpace = (transformedPosition * u_pixelRatio / u_resolution * 2.0 - 1.0) * vec2(1, -1);\n\n        gl_Position = vec4(screenSpace, 0.0, 1.0);\n        v_texcoord = a_textureCoordinate;\n\n      }\n    ",
          fragment: "\n      # ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n      # else\n      precision mediump float;\n      # endif\n      uniform vec4 u_color;\n      uniform sampler2D u_texture;\n      uniform float u_distanceRange;\n      uniform float u_pixelRatio;\n      uniform int u_debug;\n\n      varying vec2 v_texcoord;\n\n      float median(float r, float g, float b) {\n          return max(min(r, g), min(max(r, g), b));\n      }\n\n      void main() {\n          vec3 sample = texture2D(u_texture, v_texcoord).rgb;\n          if (u_debug == 1) {\n            gl_FragColor = vec4(sample.r, sample.g, sample.b, 1.0);\n            return;\n          }\n          float scaledDistRange = u_distanceRange * u_pixelRatio;\n          float sigDist = scaledDistRange * (median(sample.r, sample.g, sample.b) - 0.5);\n          float opacity = clamp(sigDist + 0.5, 0.0, 1.0) * u_color.a;\n\n          // Build the final color.\n          // IMPORTANT: We must premultiply the color by the alpha value before returning it.\n          gl_FragColor = vec4(u_color.r * opacity, u_color.g * opacity, u_color.b * opacity, opacity);\n      }\n    "
        });
        var updateShaderEffectColor = function updateShaderEffectColor(values) {
          if (values.programValue === undefined) {
            values.programValue = new Float32Array(4);
          }
          var rgba = values.value;
          var floatArray = values.programValue;
          floatArray[0] = (rgba >>> 24) / 255;
          floatArray[1] = (rgba >>> 16 & 0xff) / 255;
          floatArray[2] = (rgba >>> 8 & 0xff) / 255;
          floatArray[3] = (rgba & 0xff) / 255;
        };
        var updateFloat32ArrayLength2 = function updateFloat32ArrayLength2(values) {
          var validatedValue = values.validatedValue || values.value;
          if (values.programValue instanceof Float32Array) {
            var floatArray = values.programValue;
            floatArray[0] = validatedValue[0];
            floatArray[1] = validatedValue[1];
          } else {
            values.programValue = new Float32Array(validatedValue);
          }
        };
        var updateFloat32ArrayLength4 = function updateFloat32ArrayLength4(values) {
          var validatedValue = values.validatedValue || values.value;
          if (values.programValue instanceof Float32Array) {
            var floatArray = values.programValue;
            floatArray[0] = validatedValue[0];
            floatArray[1] = validatedValue[1];
            floatArray[2] = validatedValue[2];
            floatArray[3] = validatedValue[3];
          } else {
            values.programValue = new Float32Array(validatedValue);
          }
        };
        var updateFloat32ArrayLengthN = function updateFloat32ArrayLengthN(values) {
          var validatedValue = values.validatedValue || values.value;
          if (values.programValue instanceof Float32Array) {
            var len = validatedValue.length;
            var programValue = values.programValue;
            for (var i = 0; i < len; i++) {
              programValue[i] = validatedValue[i];
            }
          } else {
            values.programValue = new Float32Array(validatedValue);
          }
        };
        var validateArrayLength4 = function validateArrayLength4(value) {
          var isArray = Array.isArray(value);
          if (!isArray) {
            return [value, value, value, value];
          } else if (isArray && value.length === 4) {
            return value;
          } else if (isArray && value.length === 2) {
            return [value[0], value[1], value[0], value[1]];
          } else if (isArray && value.length === 3) {
            return [value[0], value[1], value[2], value[0]];
          }
          return [value[0], value[0], value[0], value[0]];
        };
        var updateWebSafeRadius = function updateWebSafeRadius(values, shaderProps) {
          if (values.programValue === undefined) {
            values.programValue = new Float32Array(4);
          }
          var programValue = values.programValue;
          var validatedValue = values.validatedValue || values.value;
          if (shaderProps === undefined && values.$dimensions === undefined) {
            programValue[0] = validatedValue[0];
            programValue[1] = validatedValue[1];
            programValue[2] = validatedValue[2];
            programValue[3] = validatedValue[3];
            return;
          }
          var storedDimensions = values.$dimensions;
          if (shaderProps !== undefined) {
            var $dimensions = shaderProps.$dimensions;
            if (storedDimensions !== undefined && (storedDimensions.width === $dimensions.width || storedDimensions.height === $dimensions.height)) {
              return;
            }
            if (storedDimensions === undefined) {
              storedDimensions = {
                width: $dimensions === null || $dimensions === void 0 ? void 0 : $dimensions.width,
                height: $dimensions === null || $dimensions === void 0 ? void 0 : $dimensions.height
              };
              values.$dimensions = storedDimensions;
            }
          }
          var _storedDimensions = storedDimensions,
            width = _storedDimensions.width,
            height = _storedDimensions.height;
          var _validatedValue = _slicedToArray(validatedValue, 4),
            r0 = _validatedValue[0],
            r1 = _validatedValue[1],
            r2 = _validatedValue[2],
            r3 = _validatedValue[3];
          var factor = Math.min(Math.min(Math.min(width / Math.max(width, r0 + r1), width / Math.max(width, r2 + r3)), Math.min(height / Math.max(height, r0 + r2), height / Math.max(height, r1 + r3))), 1);
          programValue[0] = r0 * factor;
          programValue[1] = r1 * factor;
          programValue[2] = r2 * factor;
          programValue[3] = r3 * factor;
        };

        /*
         * If not stated otherwise in this file or this component's LICENSE file the
         * following copyright and licenses apply:
         *
         * Copyright 2023 Comcast Cable Communications Management, LLC.
         *
         * Licensed under the Apache License, Version 2.0 (the License);
         * you may not use this file except in compliance with the License.
         * You may obtain a copy of the License at
         *
         * http://www.apache.org/licenses/LICENSE-2.0
         *
         * Unless required by applicable law or agreed to in writing, software
         * distributed under the License is distributed on an "AS IS" BASIS,
         * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
         * See the License for the specific language governing permissions and
         * limitations under the License.
         */
        /**
         * Masks the current maskcolor with rounded corners similar to {@link RoundedRectangle}
         */
        var RadiusEffect = /*#__PURE__*/function (_ShaderEffect2) {
          function RadiusEffect() {
            var _this22;
            _classCallCheck(this, RadiusEffect);
            for (var _len = arguments.length, args = new Array(_len), _key5 = 0; _key5 < _len; _key5++) {
              args[_key5] = arguments[_key5];
            }
            _this22 = _callSuper(this, RadiusEffect, [].concat(args));
            _defineProperty(_this22, "name", 'radius');
            return _this22;
          }
          _inherits(RadiusEffect, _ShaderEffect2);
          return _createClass(RadiusEffect, null, [{
            key: "getEffectKey",
            value: function getEffectKey() {
              return "radius";
            }
          }, {
            key: "resolveDefaults",
            value: function resolveDefaults(props) {
              var _props$radius;
              return {
                radius: (_props$radius = props.radius) !== null && _props$radius !== void 0 ? _props$radius : 10
              };
            }
          }]);
        }(ShaderEffect);
        /*
         * If not stated otherwise in this file or this component's LICENSE file the
         * following copyright and licenses apply:
         *
         * Copyright 2023 Comcast Cable Communications Management, LLC.
         *
         * Licensed under the Apache License, Version 2.0 (the License);
         * you may not use this file except in compliance with the License.
         * You may obtain a copy of the License at
         *
         * http://www.apache.org/licenses/LICENSE-2.0
         *
         * Unless required by applicable law or agreed to in writing, software
         * distributed under the License is distributed on an "AS IS" BASIS,
         * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
         * See the License for the specific language governing permissions and
         * limitations under the License.
         */
        /**
         * The BorderEffect renders a border along all edges of an element
         */
        _defineProperty(RadiusEffect, "z$__type__Props", void 0);
        _defineProperty(RadiusEffect, "uniforms", {
          radius: {
            value: 0,
            method: 'uniform4fv',
            type: 'vec4',
            updateOnBind: true,
            validator: validateArrayLength4,
            updateProgramValue: updateWebSafeRadius
          }
        });
        _defineProperty(RadiusEffect, "methods", {
          fillMask: "\n      float function(float dist) {\n        return clamp(-dist, 0.0, 1.0);\n      }\n    ",
          boxDist: "\n      float function(vec2 p, vec2 size, float radius) {\n        size -= vec2(radius);\n        vec2 d = abs(p) - size;\n        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0)) - radius;\n      }\n    "
        });
        _defineProperty(RadiusEffect, "onShaderMask", "\n  vec2 halfDimensions = u_dimensions * 0.5;\n  float r = radius[0] * step(v_textureCoordinate.x, 0.5) * step(v_textureCoordinate.y, 0.5);\n  r = r + radius[1] * step(0.5, v_textureCoordinate.x) * step(v_textureCoordinate.y, 0.5);\n  r = r + radius[2] * step(0.5, v_textureCoordinate.x) * step(0.5, v_textureCoordinate.y);\n  r = r + radius[3] * step(v_textureCoordinate.x, 0.5) * step(0.5, v_textureCoordinate.y);\n  return $boxDist(v_textureCoordinate.xy * u_dimensions - halfDimensions, halfDimensions, r);\n  ");
        _defineProperty(RadiusEffect, "onEffectMask", "\n  return mix(vec4(0.0), maskColor, $fillMask(shaderMask));\n  ");
        var BorderEffect = /*#__PURE__*/function (_ShaderEffect3) {
          function BorderEffect() {
            var _this23;
            _classCallCheck(this, BorderEffect);
            for (var _len2 = arguments.length, args = new Array(_len2), _key6 = 0; _key6 < _len2; _key6++) {
              args[_key6] = arguments[_key6];
            }
            _this23 = _callSuper(this, BorderEffect, [].concat(args));
            _defineProperty(_this23, "name", 'border');
            return _this23;
          }
          _inherits(BorderEffect, _ShaderEffect3);
          return _createClass(BorderEffect, null, [{
            key: "getEffectKey",
            value: function getEffectKey() {
              return "border";
            }
          }, {
            key: "resolveDefaults",
            value: function resolveDefaults(props) {
              var _props$width3, _props$color2;
              return {
                width: (_props$width3 = props.width) !== null && _props$width3 !== void 0 ? _props$width3 : 10,
                color: (_props$color2 = props.color) !== null && _props$color2 !== void 0 ? _props$color2 : 0xffffffff
              };
            }
          }]);
        }(ShaderEffect);
        /*
         * If not stated otherwise in this file or this component's LICENSE file the
         * following copyright and licenses apply:
         *
         * Copyright 2023 Comcast Cable Communications Management, LLC.
         *
         * Licensed under the Apache License, Version 2.0 (the License);
         * you may not use this file except in compliance with the License.
         * You may obtain a copy of the License at
         *
         * http://www.apache.org/licenses/LICENSE-2.0
         *
         * Unless required by applicable law or agreed to in writing, software
         * distributed under the License is distributed on an "AS IS" BASIS,
         * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
         * See the License for the specific language governing permissions and
         * limitations under the License.
         */
        /**
         * Linear Gradient effect over a effect mask
         */
        _defineProperty(BorderEffect, "z$__type__Props", void 0);
        _defineProperty(BorderEffect, "uniforms", {
          width: {
            value: 0,
            method: 'uniform1f',
            type: 'float'
          },
          color: {
            value: 0xffffffff,
            updateProgramValue: updateShaderEffectColor,
            method: 'uniform4fv',
            type: 'vec4'
          }
        });
        _defineProperty(BorderEffect, "onEffectMask", "\n  float intR = shaderMask + 1.0;\n  float mask = clamp(intR + width, 0.0, 1.0) - clamp(intR, 0.0, 1.0);\n  return mix(shaderColor, mix(shaderColor, maskColor, maskColor.a), mask);\n  ");
        _defineProperty(BorderEffect, "onColorize", "\n    return color;\n  ");
        var LinearGradientEffect = /*#__PURE__*/function (_ShaderEffect4) {
          function LinearGradientEffect() {
            var _this24;
            _classCallCheck(this, LinearGradientEffect);
            for (var _len3 = arguments.length, args = new Array(_len3), _key7 = 0; _key7 < _len3; _key7++) {
              args[_key7] = arguments[_key7];
            }
            _this24 = _callSuper(this, LinearGradientEffect, [].concat(args));
            _defineProperty(_this24, "name", 'linearGradient');
            return _this24;
          }
          _inherits(LinearGradientEffect, _ShaderEffect4);
          return _createClass(LinearGradientEffect, null, [{
            key: "getEffectKey",
            value: function getEffectKey(props) {
              if (props.colors.value) {
                return "linearGradient".concat(props.colors.value.length);
              }
              return "linearGradient".concat(props.colors.length);
            }
          }, {
            key: "resolveDefaults",
            value: function resolveDefaults(props) {
              var _props$colors, _props$angle;
              var colors = (_props$colors = props.colors) !== null && _props$colors !== void 0 ? _props$colors : [0xff000000, 0xffffffff];
              var stops = props.stops || [];
              if (stops.length === 0 || stops.length !== colors.length) {
                var colorsL = colors.length;
                var i = 0;
                var tmp = stops;
                for (; i < colorsL; i++) {
                  if (stops[i]) {
                    tmp[i] = stops[i];
                    if (stops[i - 1] === undefined && tmp[i - 2] !== undefined) {
                      tmp[i - 1] = tmp[i - 2] + (stops[i] - tmp[i - 2]) / 2;
                    }
                  } else {
                    tmp[i] = i * (1 / (colors.length - 1));
                  }
                }
                stops = tmp;
              }
              return {
                colors: colors,
                stops: stops,
                angle: (_props$angle = props.angle) !== null && _props$angle !== void 0 ? _props$angle : 0
              };
            }
          }]);
        }(ShaderEffect);
        /*
         * If not stated otherwise in this file or this component's LICENSE file the
         * following copyright and licenses apply:
         *
         * Copyright 2023 Comcast Cable Communications Management, LLC.
         *
         * Licensed under the Apache License, Version 2.0 (the License);
         * you may not use this file except in compliance with the License.
         * You may obtain a copy of the License at
         *
         * http://www.apache.org/licenses/LICENSE-2.0
         *
         * Unless required by applicable law or agreed to in writing, software
         * distributed under the License is distributed on an "AS IS" BASIS,
         * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
         * See the License for the specific language governing permissions and
         * limitations under the License.
         */
        /**
         * Grayscale effect grayscales the color values of the current mask color
         */
        _LinearGradientEffect = LinearGradientEffect;
        _defineProperty(LinearGradientEffect, "z$__type__Props", void 0);
        _defineProperty(LinearGradientEffect, "uniforms", {
          angle: {
            value: 0,
            method: 'uniform1f',
            type: 'float'
          },
          colors: {
            value: 0xffffffff,
            validator: function validator(rgbas) {
              return rgbas.reduce(function (acc, val) {
                return acc.concat(getNormalizedRgbaComponents(val));
              }, []);
            },
            updateProgramValue: updateFloat32ArrayLengthN,
            size: function size(props) {
              return props.colors.length;
            },
            method: 'uniform4fv',
            type: 'vec4'
          },
          stops: {
            value: [],
            size: function size(props) {
              return props.colors.length;
            },
            method: 'uniform1fv',
            type: 'float'
          }
        });
        _defineProperty(LinearGradientEffect, "methods", {
          fromLinear: "\n      vec4 function(vec4 linearRGB) {\n        vec4 higher = vec4(1.055)*pow(linearRGB, vec4(1.0/2.4)) - vec4(0.055);\n        vec4 lower = linearRGB * vec4(12.92);\n        return mix(higher, lower, 1.0);\n      }\n    ",
          toLinear: "\n      vec4 function(vec4 sRGB) {\n        vec4 higher = pow((sRGB + vec4(0.055))/vec4(1.055), vec4(2.4));\n        vec4 lower = sRGB/vec4(12.92);\n        return mix(higher, lower, 1.0);\n      }\n    ",
          calcPoint: "\n      vec2 function(float d, float angle) {\n        return d * vec2(cos(angle), sin(angle)) + (u_dimensions * 0.5);\n      }\n    "
        });
        _defineProperty(LinearGradientEffect, "ColorLoop", function (amount) {
          var loop = '';
          for (var i = 2; i < amount; i++) {
            loop += "colorOut = mix(colorOut, colors[".concat(i, "], clamp((dist - stops[").concat(i - 1, "]) / (stops[").concat(i, "] - stops[").concat(i - 1, "]), 0.0, 1.0));");
          }
          return loop;
        });
        _defineProperty(LinearGradientEffect, "onColorize", function (props) {
          var colors = props.colors.length || 1;
          return "\n      float a = angle - (PI / 180.0 * 90.0);\n      float lineDist = abs(u_dimensions.x * cos(a)) + abs(u_dimensions.y * sin(a));\n      vec2 f = $calcPoint(lineDist * 0.5, a);\n      vec2 t = $calcPoint(lineDist * 0.5, a + PI);\n      vec2 gradVec = t - f;\n      float dist = dot(v_textureCoordinate.xy * u_dimensions - f, gradVec) / dot(gradVec, gradVec);\n\n      float stopCalc = (dist - stops[0]) / (stops[1] - stops[0]);\n      vec4 colorOut = $fromLinear(mix($toLinear(colors[0]), $toLinear(colors[1]), stopCalc));\n      ".concat(_LinearGradientEffect.ColorLoop(colors), "\n      return mix(maskColor, colorOut, clamp(colorOut.a, 0.0, 1.0));\n    ");
        });
        var GrayscaleEffect = /*#__PURE__*/function (_ShaderEffect5) {
          function GrayscaleEffect() {
            var _this25;
            _classCallCheck(this, GrayscaleEffect);
            for (var _len4 = arguments.length, args = new Array(_len4), _key8 = 0; _key8 < _len4; _key8++) {
              args[_key8] = arguments[_key8];
            }
            _this25 = _callSuper(this, GrayscaleEffect, [].concat(args));
            _defineProperty(_this25, "name", 'grayscale');
            return _this25;
          }
          _inherits(GrayscaleEffect, _ShaderEffect5);
          return _createClass(GrayscaleEffect, null, [{
            key: "getEffectKey",
            value: function getEffectKey() {
              return "grayscale";
            }
          }, {
            key: "resolveDefaults",
            value: function resolveDefaults(props) {
              var _props$amount;
              return {
                amount: (_props$amount = props.amount) !== null && _props$amount !== void 0 ? _props$amount : 1
              };
            }
          }]);
        }(ShaderEffect);
        /*
         * If not stated otherwise in this file or this component's LICENSE file the
         * following copyright and licenses apply:
         *
         * Copyright 2023 Comcast Cable Communications Management, LLC.
         *
         * Licensed under the Apache License, Version 2.0 (the License);
         * you may not use this file except in compliance with the License.
         * You may obtain a copy of the License at
         *
         * http://www.apache.org/licenses/LICENSE-2.0
         *
         * Unless required by applicable law or agreed to in writing, software
         * distributed under the License is distributed on an "AS IS" BASIS,
         * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
         * See the License for the specific language governing permissions and
         * limitations under the License.
         */
        /**
         * The BorderBottomEffect renders a border on the right side of an element
         */
        _defineProperty(GrayscaleEffect, "uniforms", {
          amount: {
            value: 1,
            method: 'uniform1f',
            type: 'float'
          }
        });
        _defineProperty(GrayscaleEffect, "onColorize", "\n    float grayness = 0.2 * maskColor.r + 0.6 * maskColor.g + 0.2 * maskColor.b;\n    return vec4(amount * vec3(grayness) + (1.0 - amount) * maskColor.rgb, maskColor.a);\n  ");
        var BorderRightEffect = /*#__PURE__*/function (_ShaderEffect6) {
          function BorderRightEffect() {
            var _this26;
            _classCallCheck(this, BorderRightEffect);
            for (var _len5 = arguments.length, args = new Array(_len5), _key9 = 0; _key9 < _len5; _key9++) {
              args[_key9] = arguments[_key9];
            }
            _this26 = _callSuper(this, BorderRightEffect, [].concat(args));
            _defineProperty(_this26, "name", 'borderRight');
            return _this26;
          }
          _inherits(BorderRightEffect, _ShaderEffect6);
          return _createClass(BorderRightEffect, null, [{
            key: "getEffectKey",
            value: function getEffectKey() {
              return "borderRight";
            }
          }, {
            key: "resolveDefaults",
            value: function resolveDefaults(props) {
              var _props$width4, _props$color3;
              return {
                width: (_props$width4 = props.width) !== null && _props$width4 !== void 0 ? _props$width4 : 10,
                color: (_props$color3 = props.color) !== null && _props$color3 !== void 0 ? _props$color3 : 0xffffffff
              };
            }
          }]);
        }(ShaderEffect);
        /*
         * If not stated otherwise in this file or this component's LICENSE file the
         * following copyright and licenses apply:
         *
         * Copyright 2023 Comcast Cable Communications Management, LLC.
         *
         * Licensed under the Apache License, Version 2.0 (the License);
         * you may not use this file except in compliance with the License.
         * You may obtain a copy of the License at
         *
         * http://www.apache.org/licenses/LICENSE-2.0
         *
         * Unless required by applicable law or agreed to in writing, software
         * distributed under the License is distributed on an "AS IS" BASIS,
         * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
         * See the License for the specific language governing permissions and
         * limitations under the License.
         */
        /**
         * The BorderBottomEffect renders a border on the top side of an element
         */
        _defineProperty(BorderRightEffect, "z$__type__Props", void 0);
        _defineProperty(BorderRightEffect, "uniforms", {
          width: {
            value: 0,
            method: 'uniform1f',
            type: 'float'
          },
          color: {
            value: 0xffffffff,
            updateProgramValue: updateShaderEffectColor,
            method: 'uniform4fv',
            type: 'vec4'
          }
        });
        _defineProperty(BorderRightEffect, "methods", {
          fillMask: "\n      float function(float dist) {\n        return clamp(-dist, 0.0, 1.0);\n      }\n    ",
          rectDist: "\n      float function(vec2 p, vec2 size) {\n        vec2 d = abs(p) - size;\n        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0));\n      }\n    "
        });
        _defineProperty(BorderRightEffect, "onEffectMask", "\n  vec2 pos = vec2(u_dimensions.x - width * 0.5, 0.0);\n  float mask = $rectDist(v_textureCoordinate.xy * u_dimensions - pos, vec2(width*0.5, u_dimensions.y));\n  return mix(shaderColor, maskColor, $fillMask(mask));\n  ");
        _defineProperty(BorderRightEffect, "onColorize", "\n    return color;\n  ");
        var BorderTopEffect = /*#__PURE__*/function (_ShaderEffect7) {
          function BorderTopEffect() {
            var _this27;
            _classCallCheck(this, BorderTopEffect);
            for (var _len6 = arguments.length, args = new Array(_len6), _key0 = 0; _key0 < _len6; _key0++) {
              args[_key0] = arguments[_key0];
            }
            _this27 = _callSuper(this, BorderTopEffect, [].concat(args));
            _defineProperty(_this27, "name", 'borderTop');
            return _this27;
          }
          _inherits(BorderTopEffect, _ShaderEffect7);
          return _createClass(BorderTopEffect, null, [{
            key: "getEffectKey",
            value: function getEffectKey() {
              return "borderTop";
            }
          }, {
            key: "resolveDefaults",
            value: function resolveDefaults(props) {
              var _props$width5, _props$color4;
              return {
                width: (_props$width5 = props.width) !== null && _props$width5 !== void 0 ? _props$width5 : 10,
                color: (_props$color4 = props.color) !== null && _props$color4 !== void 0 ? _props$color4 : 0xffffffff
              };
            }
          }]);
        }(ShaderEffect);
        /*
         * If not stated otherwise in this file or this component's LICENSE file the
         * following copyright and licenses apply:
         *
         * Copyright 2023 Comcast Cable Communications Management, LLC.
         *
         * Licensed under the Apache License, Version 2.0 (the License);
         * you may not use this file except in compliance with the License.
         * You may obtain a copy of the License at
         *
         * http://www.apache.org/licenses/LICENSE-2.0
         *
         * Unless required by applicable law or agreed to in writing, software
         * distributed under the License is distributed on an "AS IS" BASIS,
         * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
         * See the License for the specific language governing permissions and
         * limitations under the License.
         */
        /**
         * The BorderBottomEffect renders a border on the bottom side of an element
         */
        _defineProperty(BorderTopEffect, "z$__type__Props", void 0);
        _defineProperty(BorderTopEffect, "uniforms", {
          width: {
            value: 0,
            method: 'uniform1f',
            type: 'float'
          },
          color: {
            value: 0xffffffff,
            updateProgramValue: updateShaderEffectColor,
            method: 'uniform4fv',
            type: 'vec4'
          }
        });
        _defineProperty(BorderTopEffect, "methods", {
          fillMask: "\n      float function(float dist) {\n        return clamp(-dist, 0.0, 1.0);\n      }\n    ",
          rectDist: "\n      float function(vec2 p, vec2 size) {\n        vec2 d = abs(p) - size;\n        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0));\n      }\n    "
        });
        _defineProperty(BorderTopEffect, "onEffectMask", "\n  vec2 pos = vec2(0.0, width * 0.5);\n  float mask = $rectDist(v_textureCoordinate.xy * u_dimensions - pos, vec2(u_dimensions.x, width*0.5));\n  return mix(shaderColor, maskColor, $fillMask(mask));\n  ");
        _defineProperty(BorderTopEffect, "onColorize", "\n    return color;\n  ");
        var BorderBottomEffect = /*#__PURE__*/function (_ShaderEffect8) {
          function BorderBottomEffect() {
            var _this28;
            _classCallCheck(this, BorderBottomEffect);
            for (var _len7 = arguments.length, args = new Array(_len7), _key1 = 0; _key1 < _len7; _key1++) {
              args[_key1] = arguments[_key1];
            }
            _this28 = _callSuper(this, BorderBottomEffect, [].concat(args));
            _defineProperty(_this28, "name", 'borderBottom');
            return _this28;
          }
          _inherits(BorderBottomEffect, _ShaderEffect8);
          return _createClass(BorderBottomEffect, null, [{
            key: "getEffectKey",
            value: function getEffectKey() {
              return "borderBottom";
            }
          }, {
            key: "resolveDefaults",
            value: function resolveDefaults(props) {
              var _props$width6, _props$color5;
              return {
                width: (_props$width6 = props.width) !== null && _props$width6 !== void 0 ? _props$width6 : 10,
                color: (_props$color5 = props.color) !== null && _props$color5 !== void 0 ? _props$color5 : 0xffffffff
              };
            }
          }]);
        }(ShaderEffect);
        /*
         * If not stated otherwise in this file or this component's LICENSE file the
         * following copyright and licenses apply:
         *
         * Copyright 2023 Comcast Cable Communications Management, LLC.
         *
         * Licensed under the Apache License, Version 2.0 (the License);
         * you may not use this file except in compliance with the License.
         * You may obtain a copy of the License at
         *
         * http://www.apache.org/licenses/LICENSE-2.0
         *
         * Unless required by applicable law or agreed to in writing, software
         * distributed under the License is distributed on an "AS IS" BASIS,
         * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
         * See the License for the specific language governing permissions and
         * limitations under the License.
         */
        /**
         * The BorderBottomEffect renders a border on the left of an element
         */
        _defineProperty(BorderBottomEffect, "z$__type__Props", void 0);
        _defineProperty(BorderBottomEffect, "uniforms", {
          width: {
            value: 0,
            method: 'uniform1f',
            type: 'float'
          },
          color: {
            value: 0xffffffff,
            updateProgramValue: updateShaderEffectColor,
            method: 'uniform4fv',
            type: 'vec4'
          }
        });
        _defineProperty(BorderBottomEffect, "methods", {
          fillMask: "\n      float function(float dist) {\n        return clamp(-dist, 0.0, 1.0);\n      }\n    ",
          rectDist: "\n      float function(vec2 p, vec2 size) {\n        vec2 d = abs(p) - size;\n        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0));\n      }\n    "
        });
        _defineProperty(BorderBottomEffect, "onEffectMask", "\n  vec2 pos = vec2(0.0, u_dimensions.y - width * 0.5);\n  float mask = $rectDist(v_textureCoordinate.xy * u_dimensions - pos, vec2(u_dimensions.x, width*0.5));\n  return mix(shaderColor, maskColor, $fillMask(mask));\n  ");
        _defineProperty(BorderBottomEffect, "onColorize", "\n    return color;\n  ");
        var BorderLeftEffect = /*#__PURE__*/function (_ShaderEffect9) {
          function BorderLeftEffect() {
            var _this29;
            _classCallCheck(this, BorderLeftEffect);
            for (var _len8 = arguments.length, args = new Array(_len8), _key10 = 0; _key10 < _len8; _key10++) {
              args[_key10] = arguments[_key10];
            }
            _this29 = _callSuper(this, BorderLeftEffect, [].concat(args));
            _defineProperty(_this29, "name", 'borderLeft');
            return _this29;
          }
          _inherits(BorderLeftEffect, _ShaderEffect9);
          return _createClass(BorderLeftEffect, null, [{
            key: "getEffectKey",
            value: function getEffectKey() {
              return "borderLeft";
            }
          }, {
            key: "resolveDefaults",
            value: function resolveDefaults(props) {
              var _props$width7, _props$color6;
              return {
                width: (_props$width7 = props.width) !== null && _props$width7 !== void 0 ? _props$width7 : 10,
                color: (_props$color6 = props.color) !== null && _props$color6 !== void 0 ? _props$color6 : 0xffffffff
              };
            }
          }]);
        }(ShaderEffect);
        /**
         * Renders a Glitch effect using the incoming texture
         */
        _defineProperty(BorderLeftEffect, "z$__type__Props", void 0);
        _defineProperty(BorderLeftEffect, "uniforms", {
          width: {
            value: 0,
            method: 'uniform1f',
            type: 'float'
          },
          color: {
            value: 0xffffffff,
            updateProgramValue: updateShaderEffectColor,
            method: 'uniform4fv',
            type: 'vec4'
          }
        });
        _defineProperty(BorderLeftEffect, "methods", {
          fillMask: "\n      float function(float dist) {\n        return clamp(-dist, 0.0, 1.0);\n      }\n    ",
          rectDist: "\n      float function(vec2 p, vec2 size) {\n        vec2 d = abs(p) - size;\n        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0));\n      }\n    "
        });
        _defineProperty(BorderLeftEffect, "onEffectMask", "\n  vec2 pos = vec2(width * 0.5, 0.0);\n  float mask = $rectDist(v_textureCoordinate.xy * u_dimensions - pos, vec2(width*0.5, u_dimensions.y));\n  return mix(shaderColor, maskColor, $fillMask(mask));\n  ");
        _defineProperty(BorderLeftEffect, "onColorize", "\n    return color;\n  ");
        var GlitchEffect = /*#__PURE__*/function (_ShaderEffect0) {
          function GlitchEffect() {
            var _this30;
            _classCallCheck(this, GlitchEffect);
            for (var _len9 = arguments.length, args = new Array(_len9), _key11 = 0; _key11 < _len9; _key11++) {
              args[_key11] = arguments[_key11];
            }
            _this30 = _callSuper(this, GlitchEffect, [].concat(args));
            _defineProperty(_this30, "name", 'glitch');
            return _this30;
          }
          _inherits(GlitchEffect, _ShaderEffect0);
          return _createClass(GlitchEffect, null, [{
            key: "getEffectKey",
            value: function getEffectKey(props) {
              return "glitch";
            }
          }, {
            key: "resolveDefaults",
            value: function resolveDefaults(props) {
              var _props$amplitude, _props$narrowness, _props$blockiness, _props$minimizer, _props$time;
              return {
                amplitude: (_props$amplitude = props.amplitude) !== null && _props$amplitude !== void 0 ? _props$amplitude : 0.2,
                narrowness: (_props$narrowness = props.narrowness) !== null && _props$narrowness !== void 0 ? _props$narrowness : 4.0,
                blockiness: (_props$blockiness = props.blockiness) !== null && _props$blockiness !== void 0 ? _props$blockiness : 2.0,
                minimizer: (_props$minimizer = props.minimizer) !== null && _props$minimizer !== void 0 ? _props$minimizer : 8.0,
                time: (_props$time = props.time) !== null && _props$time !== void 0 ? _props$time : Date.now()
              };
            }
          }]);
        }(ShaderEffect);
        /*
         * If not stated otherwise in this file or this component's LICENSE file the
         * following copyright and licenses apply:
         *
         * Copyright 2023 Comcast Cable Communications Management, LLC.
         *
         * Licensed under the Apache License, Version 2.0 (the License);
         * you may not use this file except in compliance with the License.
         * You may obtain a copy of the License at
         *
         * http://www.apache.org/licenses/LICENSE-2.0
         *
         * Unless required by applicable law or agreed to in writing, software
         * distributed under the License is distributed on an "AS IS" BASIS,
         * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
         * See the License for the specific language governing permissions and
         * limitations under the License.
         */
        _defineProperty(GlitchEffect, "z$__type__Props", void 0);
        _defineProperty(GlitchEffect, "uniforms", {
          amplitude: {
            value: 0,
            method: 'uniform1f',
            type: 'float'
          },
          narrowness: {
            value: 0,
            method: 'uniform1f',
            type: 'float'
          },
          blockiness: {
            value: 0,
            method: 'uniform1f',
            type: 'float'
          },
          minimizer: {
            value: 0,
            method: 'uniform1f',
            type: 'float'
          },
          time: {
            value: 0,
            method: 'uniform1f',
            updateOnBind: true,
            updateProgramValue: function updateProgramValue(values) {
              var value = values.value = (Date.now() - values.value) % 1000;
              values.programValue = value;
            },
            type: 'float'
          }
        });
        _defineProperty(GlitchEffect, "methods", {
          rand: "\n      float function(vec2 p, float time) {\n        float t = floor(time * 20.) / 10.;\n        return fract(sin(dot(p, vec2(t * 12.9898, t * 78.233))) * 43758.5453);\n      }\n    ",
          noise: "\n      float function(vec2 uv, float blockiness, float time) {\n        vec2 lv = fract(uv);\n        vec2 id = floor(uv);\n\n        float n1 = rand(id, time);\n        float n2 = rand(id+vec2(1,0), time);\n        float n3 = rand(id+vec2(0,1), time);\n        float n4 = rand(id+vec2(1,1), time);\n        vec2 u = smoothstep(0.0, 1.0 + blockiness, lv);\n        return mix(mix(n1, n2, u.x), mix(n3, n4, u.x), u.y);\n      }\n    ",
          fbm: "\n      float function(vec2 uv, int count, float blockiness, float complexity, float time) {\n        float val = 0.0;\n        float amp = 0.5;\n        const int MAX_ITERATIONS = 10;\n\n        for(int i = 0; i < MAX_ITERATIONS; i++) {\n          if(i >= count) {break;}\n          val += amp * noise(uv, blockiness, time);\n          amp *= 0.5;\n          uv *= complexity;\n        }\n        return val;\n      }\n    "
        });
        _defineProperty(GlitchEffect, "onColorize", "\n    vec2 uv = v_textureCoordinate.xy;\n    float aspect = u_dimensions.x / u_dimensions.y;\n    vec2 a = vec2(uv.x * aspect , uv.y);\n    vec2 uv2 = vec2(a.x / u_dimensions.x, exp(a.y));\n\n    float shift = amplitude * pow($fbm(uv2, 4, blockiness, narrowness, time), minimizer);\n    float colR = texture2D(u_texture, vec2(uv.x + shift, uv.y)).r * (1. - shift);\n    float colG = texture2D(u_texture, vec2(uv.x - shift, uv.y)).g * (1. - shift);\n    float colB = texture2D(u_texture, vec2(uv.x - shift, uv.y)).b * (1. - shift);\n\n    vec3 f = vec3(colR, colG, colB);\n    return vec4(f, texture2D(u_texture, vec2(uv.x - shift, uv.y)).a);\n  ");
        var FadeOutEffect = /*#__PURE__*/function (_ShaderEffect1) {
          function FadeOutEffect() {
            var _this31;
            _classCallCheck(this, FadeOutEffect);
            for (var _len0 = arguments.length, args = new Array(_len0), _key12 = 0; _key12 < _len0; _key12++) {
              args[_key12] = arguments[_key12];
            }
            _this31 = _callSuper(this, FadeOutEffect, [].concat(args));
            _defineProperty(_this31, "name", 'fadeOut');
            return _this31;
          }
          _inherits(FadeOutEffect, _ShaderEffect1);
          return _createClass(FadeOutEffect, null, [{
            key: "getEffectKey",
            value: function getEffectKey() {
              return "fadeOut";
            }
          }, {
            key: "resolveDefaults",
            value: function resolveDefaults(props) {
              var _props$fade;
              return {
                fade: (_props$fade = props.fade) !== null && _props$fade !== void 0 ? _props$fade : 10
              };
            }
          }]);
        }(ShaderEffect);
        /*
         * If not stated otherwise in this file or this component's LICENSE file the
         * following copyright and licenses apply:
         *
         * Copyright 2023 Comcast Cable Communications Management, LLC.
         *
         * Licensed under the Apache License, Version 2.0 (the License);
         * you may not use this file except in compliance with the License.
         * You may obtain a copy of the License at
         *
         * http://www.apache.org/licenses/LICENSE-2.0
         *
         * Unless required by applicable law or agreed to in writing, software
         * distributed under the License is distributed on an "AS IS" BASIS,
         * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
         * See the License for the specific language governing permissions and
         * limitations under the License.
         */
        _defineProperty(FadeOutEffect, "z$__type__Props", void 0);
        _defineProperty(FadeOutEffect, "uniforms", {
          fade: {
            value: 0,
            method: 'uniform4fv',
            type: 'vec4',
            validator: validateArrayLength4,
            updateProgramValue: updateFloat32ArrayLength4
          }
        });
        _defineProperty(FadeOutEffect, "onColorize", "\n  vec2 point = v_textureCoordinate.xy * u_dimensions.xy;\n  vec2 pos1;\n  vec2 pos2;\n  vec2 d;\n  float c;\n  vec4 result = maskColor;\n\n\n  if(fade[0] > 0.0) {\n    pos1 = vec2(point.x, point.y);\n    pos2 = vec2(point.x, point.y + fade[0]);\n    d = pos2 - pos1;\n    c = dot(pos1, d) / dot(d, d);\n    result = mix(vec4(0.0), result, smoothstep(0.0, 1.0, clamp(c, 0.0, 1.0)));\n  }\n\n  if(fade[1] > 0.0) {\n    pos1 = vec2(point.x - u_dimensions.x - fade[1], v_textureCoordinate.y);\n    pos2 = vec2(point.x - u_dimensions.x, v_textureCoordinate.y);\n    d = pos1 - pos2;\n    c = dot(pos2, d) / dot(d, d);\n    result = mix(vec4(0.0), result, smoothstep(0.0, 1.0, clamp(c, 0.0, 1.0)));\n  }\n\n  if(fade[2] > 0.0) {\n    pos1 = vec2(v_textureCoordinate.x, point.y - u_dimensions.y - fade[2]);\n    pos2 = vec2(v_textureCoordinate.x, point.y - u_dimensions.y);\n    d = pos1 - pos2;\n    c = dot(pos2, d) / dot(d, d);\n    result = mix(vec4(0.0), result, smoothstep(0.0, 1.0, clamp(c, 0.0, 1.0)));\n  }\n\n  if(fade[3] > 0.0) {\n    pos1 = vec2(point.x, point.y);\n    pos2 = vec2(point.x + fade[3], point.y);\n    d = pos2 - pos1;\n    c = dot(pos1, d) / dot(d, d);\n    result = mix(vec4(0.0), result, smoothstep(0.0, 1.0, clamp(c, 0.0, 1.0)));\n  }\n\n  return result;\n  ");
        var RadialGradientEffect = /*#__PURE__*/function (_ShaderEffect10) {
          function RadialGradientEffect() {
            var _this32;
            _classCallCheck(this, RadialGradientEffect);
            for (var _len1 = arguments.length, args = new Array(_len1), _key13 = 0; _key13 < _len1; _key13++) {
              args[_key13] = arguments[_key13];
            }
            _this32 = _callSuper(this, RadialGradientEffect, [].concat(args));
            _defineProperty(_this32, "name", 'radialGradient');
            return _this32;
          }
          _inherits(RadialGradientEffect, _ShaderEffect10);
          return _createClass(RadialGradientEffect, null, [{
            key: "getEffectKey",
            value: function getEffectKey(props) {
              if (props.colors.value) {
                return "radialGradient".concat(props.colors.value.length);
              }
              return "radialGradient".concat(props.colors.length);
            }
          }, {
            key: "resolveDefaults",
            value: function resolveDefaults(props) {
              var _props$colors2, _props$width8, _ref8, _props$height3, _props$pivot;
              var colors = (_props$colors2 = props.colors) !== null && _props$colors2 !== void 0 ? _props$colors2 : [0xff000000, 0xffffffff];
              var stops = props.stops || [];
              if (stops.length === 0 || stops.length !== colors.length) {
                var colorsL = colors.length;
                var i = 0;
                var tmp = stops;
                for (; i < colorsL; i++) {
                  if (stops[i]) {
                    tmp[i] = stops[i];
                    if (stops[i - 1] === undefined && tmp[i - 2] !== undefined) {
                      tmp[i - 1] = tmp[i - 2] + (stops[i] - tmp[i - 2]) / 2;
                    }
                  } else {
                    tmp[i] = i * (1 / (colors.length - 1));
                  }
                }
                stops = tmp;
              }
              return {
                colors: colors,
                stops: stops,
                width: (_props$width8 = props.width) !== null && _props$width8 !== void 0 ? _props$width8 : 0,
                height: (_ref8 = (_props$height3 = props.height) !== null && _props$height3 !== void 0 ? _props$height3 : props.width) !== null && _ref8 !== void 0 ? _ref8 : 0,
                pivot: (_props$pivot = props.pivot) !== null && _props$pivot !== void 0 ? _props$pivot : [0.5, 0.5]
              };
            }
          }]);
        }(ShaderEffect);
        /*
         * If not stated otherwise in this file or this component's LICENSE file the
         * following copyright and licenses apply:
         *
         * Copyright 2023 Comcast Cable Communications Management, LLC.
         *
         * Licensed under the Apache License, Version 2.0 (the License);
         * you may not use this file except in compliance with the License.
         * You may obtain a copy of the License at
         *
         * http://www.apache.org/licenses/LICENSE-2.0
         *
         * Unless required by applicable law or agreed to in writing, software
         * distributed under the License is distributed on an "AS IS" BASIS,
         * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
         * See the License for the specific language governing permissions and
         * limitations under the License.
         */
        /**
         * The RadialProgressEffect renders a border along all edges of an element
         */
        _RadialGradientEffect = RadialGradientEffect;
        _defineProperty(RadialGradientEffect, "z$__type__Props", void 0);
        _defineProperty(RadialGradientEffect, "uniforms", {
          width: {
            value: 0,
            method: 'uniform1f',
            type: 'float'
          },
          height: {
            value: 0,
            method: 'uniform1f',
            type: 'float'
          },
          pivot: {
            value: [0.5, 0.5],
            updateProgramValue: updateFloat32ArrayLength2,
            method: 'uniform2fv',
            type: 'vec2'
          },
          colors: {
            value: 0xffffffff,
            validator: function validator(rgbas) {
              return rgbas.reduce(function (acc, val) {
                return acc.concat(getNormalizedRgbaComponents(val));
              }, []);
            },
            updateProgramValue: updateFloat32ArrayLengthN,
            size: function size(props) {
              return props.colors.length;
            },
            method: 'uniform4fv',
            type: 'vec4'
          },
          stops: {
            value: [],
            size: function size(props) {
              return props.colors.length;
            },
            method: 'uniform1fv',
            type: 'float'
          }
        });
        _defineProperty(RadialGradientEffect, "ColorLoop", function (amount) {
          var loop = '';
          for (var i = 2; i < amount; i++) {
            loop += "colorOut = mix(colorOut, colors[".concat(i, "], clamp((dist - stops[").concat(i - 1, "]) / (stops[").concat(i, "] - stops[").concat(i - 1, "]), 0.0, 1.0));");
          }
          return loop;
        });
        _defineProperty(RadialGradientEffect, "onColorize", function (props) {
          var colors = props.colors.length || 1;
          return "\n      vec2 point = v_textureCoordinate.xy * u_dimensions;\n      vec2 projection = vec2(pivot.x * u_dimensions.x, pivot.y * u_dimensions.y);\n\n      float dist = length((point - projection) / vec2(width, height));\n\n      float stopCalc = (dist - stops[0]) / (stops[1] - stops[0]);\n      vec4 colorOut = mix(colors[0], colors[1], stopCalc);\n      ".concat(_RadialGradientEffect.ColorLoop(colors), "\n      return mix(maskColor, colorOut, clamp(colorOut.a, 0.0, 1.0));\n    ");
        });
        var RadialProgressEffect = /*#__PURE__*/function (_ShaderEffect11) {
          function RadialProgressEffect() {
            var _this33;
            _classCallCheck(this, RadialProgressEffect);
            for (var _len10 = arguments.length, args = new Array(_len10), _key14 = 0; _key14 < _len10; _key14++) {
              args[_key14] = arguments[_key14];
            }
            _this33 = _callSuper(this, RadialProgressEffect, [].concat(args));
            _defineProperty(_this33, "name", 'radialProgress');
            return _this33;
          }
          _inherits(RadialProgressEffect, _ShaderEffect11);
          return _createClass(RadialProgressEffect, null, [{
            key: "getEffectKey",
            value: function getEffectKey() {
              return "radialProgress";
            }
          }, {
            key: "resolveDefaults",
            value: function resolveDefaults(props) {
              var _props$width9, _props$progress, _props$offset, _props$range, _props$rounded, _props$radius2, _props$color7;
              return {
                width: (_props$width9 = props.width) !== null && _props$width9 !== void 0 ? _props$width9 : 10,
                progress: (_props$progress = props.progress) !== null && _props$progress !== void 0 ? _props$progress : 0.5,
                offset: (_props$offset = props.offset) !== null && _props$offset !== void 0 ? _props$offset : 0,
                range: (_props$range = props.range) !== null && _props$range !== void 0 ? _props$range : Math.PI * 2,
                rounded: (_props$rounded = props.rounded) !== null && _props$rounded !== void 0 ? _props$rounded : false,
                radius: (_props$radius2 = props.radius) !== null && _props$radius2 !== void 0 ? _props$radius2 : 1,
                color: (_props$color7 = props.color) !== null && _props$color7 !== void 0 ? _props$color7 : 0xffffffff
              };
            }
          }]);
        }(ShaderEffect);
        /**
         * Masks the current maskcolor a holepunch effect with rounded corners similar to {@link RoundedRectangle}
         */
        _defineProperty(RadialProgressEffect, "z$__type__Props", void 0);
        _defineProperty(RadialProgressEffect, "uniforms", {
          width: {
            value: 0,
            method: 'uniform1f',
            type: 'float'
          },
          progress: {
            value: 0.5,
            method: 'uniform1f',
            type: 'float'
          },
          offset: {
            value: 0,
            method: 'uniform1f',
            type: 'float'
          },
          range: {
            value: 0,
            method: 'uniform1f',
            type: 'float'
          },
          rounded: {
            value: 0,
            method: 'uniform1f',
            type: 'float',
            validator: function validator(value) {
              return value ? 1 : 0;
            }
          },
          radius: {
            value: 1,
            method: 'uniform1f',
            type: 'float'
          },
          color: {
            value: 0xffffffff,
            updateProgramValue: updateShaderEffectColor,
            method: 'uniform4fv',
            type: 'vec4'
          }
        });
        _defineProperty(RadialProgressEffect, "methods", {
          rotateUV: "\n    vec2 function(vec2 uv, float d) {\n      float s = sin(d);\n      float c = cos(d);\n      mat2 rotMatrix = mat2(c, -s, s, c);\n      return uv * rotMatrix;\n    }\n    ",
          drawDot: "\n    float function(vec2 uv, vec2 p, float r) {\n      uv += p;\n      float circle = length(uv) - r;\n      return clamp(-circle, 0.0, 1.0);\n    }\n    "
        });
        _defineProperty(RadialProgressEffect, "onEffectMask", "\n    float outerRadius = radius * u_dimensions.y * 0.5;\n\n    float endAngle = range * progress - 0.0005;\n\n    vec2 uv = v_textureCoordinate.xy * u_dimensions.xy - u_dimensions * 0.5;\n\n    uv = $rotateUV(uv, -(offset));\n    float linewidth = width * u_pixelRatio;\n    float circle = length(uv) - (outerRadius - linewidth) ;\n    circle = abs(circle) - linewidth;\n    circle = clamp(-circle, 0.0, 1.0);\n\n    float angle = (atan(uv.x, -uv.y) / 3.14159265359 * 0.5);\n    float p = endAngle / (PI * 2.);\n\n    circle *= step(fract(angle), fract(p));\n\n    circle = rounded < 1. ? circle : max(circle, $drawDot(uv, vec2(0, outerRadius - linewidth), linewidth));\n    circle = rounded < 1. ? circle : max(circle, $drawDot($rotateUV(uv, -(endAngle)), vec2(0, outerRadius - linewidth), linewidth));\n\n    return mix(shaderColor, maskColor, circle);\n  ");
        _defineProperty(RadialProgressEffect, "onColorize", "\n    return color;\n  ");
        var HolePunchEffect = /*#__PURE__*/function (_ShaderEffect12) {
          function HolePunchEffect() {
            var _this34;
            _classCallCheck(this, HolePunchEffect);
            for (var _len11 = arguments.length, args = new Array(_len11), _key15 = 0; _key15 < _len11; _key15++) {
              args[_key15] = arguments[_key15];
            }
            _this34 = _callSuper(this, HolePunchEffect, [].concat(args));
            _defineProperty(_this34, "name", 'holePunch');
            return _this34;
          }
          _inherits(HolePunchEffect, _ShaderEffect12);
          return _createClass(HolePunchEffect, null, [{
            key: "getEffectKey",
            value: function getEffectKey() {
              return "holePunch";
            }
          }, {
            key: "resolveDefaults",
            value: function resolveDefaults(props) {
              var _props$radius3;
              return {
                x: props.x || 0,
                y: props.y || 0,
                width: props.width || 50,
                height: props.height || 50,
                radius: (_props$radius3 = props.radius) !== null && _props$radius3 !== void 0 ? _props$radius3 : 0
              };
            }
          }]);
        }(ShaderEffect);
        /*
         * If not stated otherwise in this file or this component's LICENSE file the
         * following copyright and licenses apply:
         *
         * Copyright 2023 Comcast Cable Communications Management, LLC.
         *
         * Licensed under the Apache License, Version 2.0 (the License);
         * you may not use this file except in compliance with the License.
         * You may obtain a copy of the License at
         *
         * http://www.apache.org/licenses/LICENSE-2.0
         *
         * Unless required by applicable law or agreed to in writing, software
         * distributed under the License is distributed on an "AS IS" BASIS,
         * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
         * See the License for the specific language governing permissions and
         * limitations under the License.
         */
        _defineProperty(HolePunchEffect, "z$__type__Props", void 0);
        _defineProperty(HolePunchEffect, "uniforms", {
          x: {
            value: 0,
            method: 'uniform1f',
            type: 'float'
          },
          y: {
            value: 0,
            method: 'uniform1f',
            type: 'float'
          },
          width: {
            value: 0,
            method: 'uniform1f',
            type: 'float'
          },
          height: {
            value: 0,
            method: 'uniform1f',
            type: 'float'
          },
          radius: {
            value: 0,
            method: 'uniform4fv',
            type: 'vec4',
            updateOnBind: true,
            validator: validateArrayLength4,
            updateProgramValue: updateWebSafeRadius
          }
        });
        _defineProperty(HolePunchEffect, "methods", {
          fillMask: "\n      float function(float dist) {\n        return clamp(-dist, 0.0, 1.0);\n      }\n    ",
          boxDist: "\n      float function(vec2 p, vec2 size, float radius) {\n        size -= vec2(radius);\n        vec2 d = abs(p) - size;\n        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0)) - radius;\n      }\n    "
        });
        _defineProperty(HolePunchEffect, "onShaderMask", "\n  vec2 halfDimensions = u_dimensions * 0.5;\n  vec2 size = vec2(width, height) * 0.5;\n  vec2 basePos = v_textureCoordinate.xy * u_dimensions.xy - vec2(x, y);\n  vec2 pos = basePos - size;\n  float r = radius[0] * step(pos.x, 0.5) * step(pos.y, 0.5);\n  r = r + radius[1] * step(0.5, pos.x) * step(pos.y, 0.5);\n  r = r + radius[2] * step(0.5, pos.x) * step(0.5, pos.y);\n  r = r + radius[3] * step(pos.x, 0.5) * step(0.5, pos.y);\n  return $boxDist(pos, size, r);\n  ");
        _defineProperty(HolePunchEffect, "onEffectMask", "\n  return mix(maskColor, vec4(0.0), $fillMask(shaderMask));\n  ");
        var ROUNDED_RECTANGLE_SHADER_TYPE = 'RoundedRectangle';
        var UnsupportedShader = /*#__PURE__*/function (_CoreShader2) {
          function UnsupportedShader(shType) {
            var _this35;
            _classCallCheck(this, UnsupportedShader);
            _this35 = _callSuper(this, UnsupportedShader);
            _defineProperty(_this35, "shType", void 0);
            _this35.shType = shType;
            // if (shType !== ROUNDED_RECTANGLE_SHADER_TYPE) {
            //   console.warn('Unsupported shader:', shType);
            // }
            return _this35;
          }
          _inherits(UnsupportedShader, _CoreShader2);
          return _createClass(UnsupportedShader, [{
            key: "bindRenderOp",
            value: function bindRenderOp() {
              // noop
            }
          }, {
            key: "bindProps",
            value: function bindProps() {
              // noop
            }
          }, {
            key: "attach",
            value: function attach() {
              // noop
            }
          }, {
            key: "detach",
            value: function detach() {
              // noop
            }
          }]);
        }(CoreShader);
        /**
         * Shader Controller Class
         *
         * @remarks
         * This class is used to control shader props.
         */
        var ShaderController = /*#__PURE__*/function () {
          function ShaderController(type, shader, props, stage) {
            var _this36 = this;
            _classCallCheck(this, ShaderController);
            _defineProperty(this, "type", void 0);
            _defineProperty(this, "shader", void 0);
            _defineProperty(this, "resolvedProps", void 0);
            _defineProperty(this, "props", void 0);
            this.type = type;
            this.shader = shader;
            this.resolvedProps = props;
            var keys = Object.keys(props);
            var l = keys.length;
            var definedProps = {};
            var _loop2 = function _loop2() {
              var name = keys[i];
              Object.defineProperty(definedProps, name, {
                get: function get() {
                  return _this36.resolvedProps[name];
                },
                set: function set(value) {
                  _this36.resolvedProps[name] = value;
                  stage.requestRender();
                }
              });
            };
            for (var i = 0; i < l; i++) {
              _loop2();
            }
            this.props = definedProps;
          }
          return _createClass(ShaderController, [{
            key: "getResolvedProps",
            value: function getResolvedProps() {
              return this.resolvedProps;
            }
          }]);
        }();
        var DynamicShaderController = /*#__PURE__*/function () {
          function DynamicShaderController(shader, props, shManager) {
            var _this37 = this;
            _classCallCheck(this, DynamicShaderController);
            _defineProperty(this, "shader", void 0);
            _defineProperty(this, "resolvedProps", void 0);
            _defineProperty(this, "props", void 0);
            _defineProperty(this, "type", void 0);
            this.shader = shader;
            this.type = 'DynamicShader';
            this.resolvedProps = props;
            var effectConstructors = shManager.getRegisteredEffects();
            var definedProps = {};
            var effects = props.effects;
            var effectsLength = effects.length;
            var _loop3 = function _loop3(i) {
              var _effects$i2 = effects[i],
                effectName = _effects$i2.name,
                effectProps = _effects$i2.props,
                effectType = _effects$i2.type;
              if (effectName === undefined) {
                return 1; // continue
              }
              var definedEffectProps = {};
              var propEntries = Object.keys(effectProps);
              var propEntriesLength = propEntries.length;
              var _loop4 = function _loop4() {
                var propName = propEntries[j];
                Object.defineProperty(definedEffectProps, propName, {
                  get: function get() {
                    return _this37.resolvedProps.effects[i].props[propName].value;
                  },
                  set: function set(value) {
                    var target = _this37.resolvedProps.effects[i].props[propName];
                    target.value = value;
                    if (target.hasValidator) {
                      var _effectConstructors$e;
                      value = target.validatedValue = (_effectConstructors$e = effectConstructors[effectType].uniforms[propName]) === null || _effectConstructors$e === void 0 ? void 0 : _effectConstructors$e.validator(value, effectProps);
                    }
                    if (target.hasProgramValueUpdater) {
                      var _effectConstructors$e2;
                      (_effectConstructors$e2 = effectConstructors[effectType].uniforms[propName]) === null || _effectConstructors$e2 === void 0 || _effectConstructors$e2.updateProgramValue(target);
                    } else {
                      target.programValue = value;
                    }
                    shManager.renderer.stage.requestRender();
                  }
                });
              };
              for (var j = 0; j < propEntriesLength; j++) {
                _loop4();
              }
              Object.defineProperty(definedProps, effectName, {
                get: function get() {
                  return definedEffectProps;
                }
              });
            };
            for (var i = 0; i < effectsLength; i++) {
              if (_loop3(i)) continue;
            }
            this.props = definedProps;
          }
          return _createClass(DynamicShaderController, [{
            key: "getResolvedProps",
            value: function getResolvedProps() {
              return this.resolvedProps;
            }
          }]);
        }();
        var CoreShaderManager = /*#__PURE__*/function () {
          function CoreShaderManager() {
            _classCallCheck(this, CoreShaderManager);
            _defineProperty(this, "shCache", new Map());
            _defineProperty(this, "shConstructors", {});
            _defineProperty(this, "attachedShader", null);
            _defineProperty(this, "effectConstructors", {});
            _defineProperty(this, "renderer", void 0);
            this.registerShaderType('DefaultShader', DefaultShader);
            this.registerShaderType('DefaultShaderBatched', DefaultShaderBatched);
            this.registerShaderType('RoundedRectangle', RoundedRectangle);
            this.registerShaderType('DynamicShader', DynamicShader);
            this.registerShaderType('SdfShader', SdfShader);
            this.registerEffectType('border', BorderEffect);
            this.registerEffectType('borderBottom', BorderBottomEffect);
            this.registerEffectType('borderLeft', BorderLeftEffect);
            this.registerEffectType('borderRight', BorderRightEffect);
            this.registerEffectType('borderTop', BorderTopEffect);
            this.registerEffectType('fadeOut', FadeOutEffect);
            this.registerEffectType('linearGradient', LinearGradientEffect);
            this.registerEffectType('radialGradient', RadialGradientEffect);
            this.registerEffectType('grayscale', GrayscaleEffect);
            this.registerEffectType('glitch', GlitchEffect);
            this.registerEffectType('radius', RadiusEffect);
            this.registerEffectType('radialProgress', RadialProgressEffect);
            this.registerEffectType('holePunch', HolePunchEffect);
          }
          return _createClass(CoreShaderManager, [{
            key: "registerShaderType",
            value: function registerShaderType(shType, shClass) {
              this.shConstructors[shType] = shClass;
            }
          }, {
            key: "registerEffectType",
            value: function registerEffectType(effectType, effectClass) {
              this.effectConstructors[effectType] = effectClass;
            }
          }, {
            key: "getRegisteredEffects",
            value: function getRegisteredEffects() {
              return this.effectConstructors;
            }
          }, {
            key: "getRegisteredShaders",
            value: function getRegisteredShaders() {
              return this.shConstructors;
            }
            /**
             * Loads a shader (if not already loaded) and returns a controller for it.
             *
             * @param shType
             * @param props
             * @returns
             */
          }, {
            key: "loadShader",
            value: function loadShader(shType, props) {
              if (!this.renderer) {
                throw new Error("Renderer is not been defined");
              }
              var ShaderClass = this.shConstructors[shType];
              if (!ShaderClass) {
                throw new Error("Shader type \"".concat(shType, "\" is not registered"));
              }
              if (this.renderer.mode === 'canvas' && ShaderClass.prototype instanceof WebGlCoreShader) {
                return this._createShaderCtr(shType, new UnsupportedShader(shType), props);
              }
              if (shType === 'DynamicShader') {
                return this.loadDynamicShader(props);
              }
              var resolvedProps = ShaderClass.resolveDefaults(props);
              var cacheKey = ShaderClass.makeCacheKey(resolvedProps) || ShaderClass.name;
              if (cacheKey && this.shCache.has(cacheKey)) {
                return this._createShaderCtr(shType, this.shCache.get(cacheKey), resolvedProps);
              }
              // @ts-expect-error ShaderClass WILL accept a Renderer
              var shader = new ShaderClass(this.renderer, props);
              if (cacheKey) {
                this.shCache.set(cacheKey, shader);
              }
              return this._createShaderCtr(shType, shader, resolvedProps);
            }
          }, {
            key: "loadDynamicShader",
            value: function loadDynamicShader(props) {
              if (!this.renderer) {
                throw new Error("Renderer is not been defined");
              }
              var resolvedProps = DynamicShader.resolveDefaults(props, this.effectConstructors);
              var cacheKey = DynamicShader.makeCacheKey(resolvedProps, this.effectConstructors);
              if (cacheKey && this.shCache.has(cacheKey)) {
                return this._createDynShaderCtr(this.shCache.get(cacheKey), resolvedProps);
              }
              var shader = new DynamicShader(this.renderer, props, this.effectConstructors);
              if (cacheKey) {
                this.shCache.set(cacheKey, shader);
              }
              return this._createDynShaderCtr(shader, resolvedProps);
            }
          }, {
            key: "_createShaderCtr",
            value: function _createShaderCtr(type, shader, props) {
              return new ShaderController(type, shader, props, this.renderer.stage);
            }
          }, {
            key: "_createDynShaderCtr",
            value: function _createDynShaderCtr(shader, props) {
              shader.bindUniformMethods(props);
              return new DynamicShaderController(shader, props, this);
            }
          }, {
            key: "useShader",
            value: function useShader(shader) {
              if (this.attachedShader === shader) {
                return;
              }
              if (this.attachedShader) {
                this.attachedShader.detach();
              }
              shader.attach();
              this.attachedShader = shader;
            }
          }]);
        }();
        /*
         * If not stated otherwise in this file or this component's LICENSE file the
         * following copyright and licenses apply:
         *
         * Copyright 2023 Comcast Cable Communications Management, LLC.
         *
         * Licensed under the Apache License, Version 2.0 (the License);
         * you may not use this file except in compliance with the License.
         * You may obtain a copy of the License at
         *
         * http://www.apache.org/licenses/LICENSE-2.0
         *
         * Unless required by applicable law or agreed to in writing, software
         * distributed under the License is distributed on an "AS IS" BASIS,
         * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
         * See the License for the specific language governing permissions and
         * limitations under the License.
         */
        var trPropSetterDefaults = {
          x: function x(state, value) {
            state.props.x = value;
          },
          y: function y(state, value) {
            state.props.y = value;
          },
          width: function width(state, value) {
            state.props.width = value;
          },
          height: function height(state, value) {
            state.props.height = value;
          },
          color: function color(state, value) {
            state.props.color = value;
          },
          zIndex: function zIndex(state, value) {
            state.props.zIndex = value;
          },
          fontFamily: function fontFamily(state, value) {
            state.props.fontFamily = value;
          },
          fontWeight: function fontWeight(state, value) {
            state.props.fontWeight = value;
          },
          fontStyle: function fontStyle(state, value) {
            state.props.fontStyle = value;
          },
          fontStretch: function fontStretch(state, value) {
            state.props.fontStretch = value;
          },
          fontSize: function fontSize(state, value) {
            state.props.fontSize = value;
          },
          text: function text(state, value) {
            state.props.text = value;
          },
          textAlign: function textAlign(state, value) {
            state.props.textAlign = value;
          },
          contain: function contain(state, value) {
            state.props.contain = value;
          },
          offsetY: function offsetY(state, value) {
            state.props.offsetY = value;
          },
          scrollable: function scrollable(state, value) {
            state.props.scrollable = value;
          },
          scrollY: function scrollY(state, value) {
            state.props.scrollY = value;
          },
          letterSpacing: function letterSpacing(state, value) {
            state.props.letterSpacing = value;
          },
          lineHeight: function lineHeight(state, value) {
            state.props.lineHeight = value;
          },
          maxLines: function maxLines(state, value) {
            state.props.maxLines = value;
          },
          textBaseline: function textBaseline(state, value) {
            state.props.textBaseline = value;
          },
          verticalAlign: function verticalAlign(state, value) {
            state.props.verticalAlign = value;
          },
          overflowSuffix: function overflowSuffix(state, value) {
            state.props.overflowSuffix = value;
          },
          debug: function debug(state, value) {
            state.props.debug = value;
          }
        };
        var TextRenderer = /*#__PURE__*/function () {
          function TextRenderer(stage) {
            var _this38 = this;
            _classCallCheck(this, TextRenderer);
            _defineProperty(this, "stage", void 0);
            _defineProperty(this, "set", void 0);
            this.stage = stage;
            var propSetters = _objectSpread(_objectSpread({}, trPropSetterDefaults), this.getPropertySetters());
            // For each prop setter add a wrapper method that checks if the prop is
            // different before calling the setter
            var propSet = {};
            Object.keys(propSetters).forEach(function (key) {
              Object.defineProperty(propSet, key, {
                value: function value(state, _value) {
                  // Check if the current prop value is different before calling the setter
                  if (state.props[key] !== _value) {
                    propSetters[key](state, _value);
                    // Assume any prop change will require a render
                    // This ensures that renders are triggered appropriately even with RAF paused
                    _this38.stage.requestRender();
                  }
                },
                writable: false,
                // Prevents property from being changed
                configurable: false // Prevents property from being deleted
              });
            });
            this.set = propSet;
          }
          return _createClass(TextRenderer, [{
            key: "setStatus",
            value: function setStatus(state, status, error) {
              // Don't emit the same status twice
              if (state.status === status) {
                return;
              }
              state.status = status;
              state.emitter.emit(status, error);
            }
            /**
             * Allows the CoreTextNode to communicate changes to the isRenderable state of
             * the itself.
             *
             * @param state
             * @param renderable
             */
          }, {
            key: "setIsRenderable",
            value: function setIsRenderable(state, renderable) {
              state.isRenderable = renderable;
            }
            /**
             * Destroy/Clean up the state object
             *
             * @remarks
             * Opposite of createState(). Frees any event listeners / resources held by
             * the state that may not reliably get garbage collected.
             *
             * @param state
             */
          }, {
            key: "destroyState",
            value: function destroyState(state) {
              this.setStatus(state, 'destroyed');
              state.emitter.removeAllListeners();
            }
            /**
             * Schedule a state update via queueMicrotask
             *
             * @remarks
             * This method is used to schedule a state update via queueMicrotask. This
             * method should be called whenever a state update is needed, and it will
             * ensure that the state is only updated once per microtask.
             * @param state
             * @returns
             */
          }, {
            key: "scheduleUpdateState",
            value: function scheduleUpdateState(state) {
              var _this39 = this;
              if (state.updateScheduled) {
                return;
              }
              state.updateScheduled = true;
              queueMicrotask(function () {
                // If the state has been destroyed, don't update it
                if (state.status === 'destroyed') {
                  return;
                }
                state.updateScheduled = false;
                _this39.updateState(state);
              });
            }
          }]);
        }();
        /*
         * If not stated otherwise in this file or this component's LICENSE file the
         * following copyright and licenses apply:
         *
         * Copyright 2023 Comcast Cable Communications Management, LLC.
         *
         * Licensed under the Apache License, Version 2.0 (the License);
         * you may not use this file except in compliance with the License.
         * You may obtain a copy of the License at
         *
         * http://www.apache.org/licenses/LICENSE-2.0
         *
         * Unless required by applicable law or agreed to in writing, software
         * distributed under the License is distributed on an "AS IS" BASIS,
         * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
         * See the License for the specific language governing permissions and
         * limitations under the License.
         */
        /**
         * Class that keeps track of the invocations of Context methods when
         * the `enableContextSpy` renderer option is enabled.
         */
        var ContextSpy = /*#__PURE__*/function () {
          function ContextSpy() {
            _classCallCheck(this, ContextSpy);
            _defineProperty(this, "data", {});
          }
          return _createClass(ContextSpy, [{
            key: "reset",
            value: function reset() {
              this.data = {};
            }
          }, {
            key: "increment",
            value: function increment(name) {
              if (!this.data[name]) {
                this.data[name] = 0;
              }
              this.data[name]++;
            }
          }, {
            key: "getData",
            value: function getData() {
              return _objectSpread({}, this.data);
            }
          }]);
        }();
        /*
         * If not stated otherwise in this file or this component's LICENSE file the
         * following copyright and licenses apply:
         *
         * Copyright 2024 Comcast Cable Communications Management, LLC.
         *
         * Licensed under the Apache License, Version 2.0 (the License);
         * you may not use this file except in compliance with the License.
         * You may obtain a copy of the License at
         *
         * http://www.apache.org/licenses/LICENSE-2.0
         *
         * Unless required by applicable law or agreed to in writing, software
         * distributed under the License is distributed on an "AS IS" BASIS,
         * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
         * See the License for the specific language governing permissions and
         * limitations under the License.
         */
        /**
         * LRU (Least Recently Used) style memory manager for textures
         *
         * @remarks
         * This class is responsible for managing the memory usage of textures
         * in the Renderer. It keeps track of the memory used by each texture
         * and triggers a cleanup when the memory usage exceeds a critical
         * threshold (`criticalThreshold`).
         *
         * The cleanup process will free up non-renderable textures until the
         * memory usage is below a target threshold (`targetThresholdLevel`).
         *
         * The memory manager's clean up process will also be triggered when the
         * scene is idle for a certain amount of time (`cleanupInterval`).
         */
        var TextureMemoryManager = /*#__PURE__*/function () {
          function TextureMemoryManager(stage, settings) {
            var _this40 = this;
            _classCallCheck(this, TextureMemoryManager);
            _defineProperty(this, "stage", void 0);
            _defineProperty(this, "memUsed", 0);
            _defineProperty(this, "loadedTextures", []);
            _defineProperty(this, "criticalThreshold", void 0);
            _defineProperty(this, "targetThreshold", void 0);
            _defineProperty(this, "cleanupInterval", void 0);
            _defineProperty(this, "debugLogging", void 0);
            _defineProperty(this, "lastCleanupTime", 0);
            _defineProperty(this, "baselineMemoryAllocation", void 0);
            _defineProperty(this, "hasWarnedAboveCritical", false);
            _defineProperty(this, "criticalCleanupRequested", false);
            _defineProperty(this, "doNotExceedCriticalThreshold", void 0);
            /**
             * The current frame time in milliseconds
             *
             * @remarks
             * This is used to determine when to perform Idle Texture Cleanups.
             *
             * Set by stage via `updateFrameTime` method.
             */
            _defineProperty(this, "frameTime", 0);
            this.stage = stage;
            var criticalThreshold = settings.criticalThreshold,
              doNotExceedCriticalThreshold = settings.doNotExceedCriticalThreshold;
            this.doNotExceedCriticalThreshold = doNotExceedCriticalThreshold || false;
            this.criticalThreshold = Math.round(criticalThreshold);
            var targetFraction = Math.max(0, Math.min(1, settings.targetThresholdLevel));
            this.cleanupInterval = settings.cleanupInterval;
            this.debugLogging = settings.debugLogging;
            this.baselineMemoryAllocation = Math.round(settings.baselineMemoryAllocation);
            this.targetThreshold = Math.max(Math.round(criticalThreshold * targetFraction), this.baselineMemoryAllocation);
            this.memUsed = Math.round(settings.baselineMemoryAllocation);
            if (settings.debugLogging) {
              var lastMemUse = 0;
              setInterval(function () {
                if (lastMemUse !== _this40.memUsed) {
                  lastMemUse = _this40.memUsed;
                  console.log("[TextureMemoryManager] Memory used: ".concat(bytesToMb$1(_this40.memUsed), " mb / ").concat(bytesToMb$1(_this40.criticalThreshold), " mb (").concat((_this40.memUsed / _this40.criticalThreshold * 100).toFixed(1), "%)"));
                }
              }, 1000);
            }
            // If the threshold is 0, we disable the memory manager by replacing the
            // setTextureMemUse method with a no-op function.
            if (criticalThreshold === 0) {
              this.setTextureMemUse = function () {};
            }
          }
          /**
           * Set the memory usage of a texture
           *
           * @param texture - The texture to set memory usage for
           * @param byteSize - The size of the texture in bytes
           */
          return _createClass(TextureMemoryManager, [{
            key: "setTextureMemUse",
            value: function setTextureMemUse(texture, byteSize) {
              // Update global memory counter by subtracting old value
              this.memUsed -= texture.memUsed;
              if (byteSize === 0) {
                // PERFORMANCE: Mark for deletion, slot will be reused later
                var index = this.loadedTextures.indexOf(texture);
                if (index !== -1) {
                  this.loadedTextures[index] = null;
                }
                texture.memUsed = 0;
                return;
              } else {
                // Update texture memory and add to tracking if not already present
                texture.memUsed = byteSize;
                this.memUsed += byteSize;
                if (this.loadedTextures.indexOf(texture) === -1) {
                  // PERFORMANCE: Reuse empty slots before appending
                  var emptyIndex = this.loadedTextures.indexOf(null);
                  if (emptyIndex !== -1) {
                    this.loadedTextures[emptyIndex] = texture;
                  } else {
                    this.loadedTextures.push(texture);
                  }
                }
              }
              if (this.memUsed > this.criticalThreshold) {
                this.criticalCleanupRequested = true;
              }
            }
          }, {
            key: "checkCleanup",
            value: function checkCleanup() {
              return this.criticalCleanupRequested || this.memUsed > this.targetThreshold && this.frameTime - this.lastCleanupTime >= this.cleanupInterval;
            }
          }, {
            key: "checkCriticalCleanup",
            value: function checkCriticalCleanup() {
              return this.memUsed > this.criticalThreshold;
            }
            /**
             * Destroy a texture and null out its array position
             *
             * @param texture - The texture to destroy
             */
          }, {
            key: "destroyTexture",
            value: function destroyTexture(texture) {
              if (this.debugLogging === true) {
                console.log("[TextureMemoryManager] Destroying texture. State: ".concat(texture.state));
              }
              // PERFORMANCE: Null out array position, slot will be reused later
              var index = this.loadedTextures.indexOf(texture);
              if (index !== -1) {
                this.loadedTextures[index] = null;
              }
              // Destroy texture and update memory counters
              var txManager = this.stage.txManager;
              txManager.removeTextureFromCache(texture);
              texture.destroy();
              // Update memory counters
              this.memUsed -= texture.memUsed;
              texture.memUsed = 0;
            }
          }, {
            key: "cleanup",
            value: function cleanup() {
              var critical = this.criticalCleanupRequested;
              this.lastCleanupTime = this.frameTime;
              if (critical === true) {
                this.stage.queueFrameEvent('criticalCleanup', {
                  memUsed: this.memUsed,
                  criticalThreshold: this.criticalThreshold
                });
              }
              if (this.debugLogging === true) {
                console.log("[TextureMemoryManager] Cleaning up textures. Critical: ".concat(critical, "."));
              }
              // Free non-renderable textures until we reach the target threshold
              var memTarget = critical ? this.criticalThreshold : this.targetThreshold;
              // PERFORMANCE: Zero-overhead cleanup with null marking
              // Skip null entries, mark cleaned textures as null for later defrag
              var currentMemUsed = this.memUsed;
              for (var i = 0; i < this.loadedTextures.length; i++) {
                // Early exit: target memory reached
                if (currentMemUsed < memTarget) {
                  break;
                }
                var texture = this.loadedTextures[i];
                if (!texture) continue; // Skip null entries from previous deletions
                // Fast type check for cleanable textures
                var isCleanableType = texture.type === TextureType.image || texture.type === TextureType.noise || texture.type === TextureType.renderToTexture;
                // Immediate cleanup if eligible
                if (isCleanableType && texture.canBeCleanedUp() === true) {
                  // Get memory before destroying
                  var textureMemory = texture.memUsed;
                  // Destroy texture (which will null out the array position)
                  this.destroyTexture(texture);
                  currentMemUsed -= textureMemory;
                }
              }
              if (this.memUsed >= this.criticalThreshold) {
                this.stage.queueFrameEvent('criticalCleanupFailed', {
                  memUsed: this.memUsed,
                  criticalThreshold: this.criticalThreshold
                });
                // Only emit the warning once per over-threshold period
                if (!this.hasWarnedAboveCritical && (this.debugLogging === true || isProductionEnvironment() === false)) {
                  console.warn("[TextureMemoryManager] Memory usage above critical threshold after cleanup: ".concat(this.memUsed));
                  this.hasWarnedAboveCritical = true;
                }
              } else {
                this.criticalCleanupRequested = false;
                this.hasWarnedAboveCritical = false;
              }
            }
            /**
             * Get the current texture memory usage information
             *
             * @remarks
             * This method is for debugging purposes and returns information about the
             * current memory usage of the textures in the Renderer.
             */
          }, {
            key: "getMemoryInfo",
            value: function getMemoryInfo() {
              var renderableTexturesLoaded = 0;
              var renderableMemUsed = this.baselineMemoryAllocation;
              var _iterator0 = _createForOfIteratorHelper(this.loadedTextures),
                _step0;
              try {
                for (_iterator0.s(); !(_step0 = _iterator0.n()).done;) {
                  var texture = _step0.value;
                  if (texture && texture.renderable) {
                    renderableTexturesLoaded += 1;
                    renderableMemUsed += texture.memUsed;
                  }
                }
                // Count non-null entries for accurate loaded texture count
              } catch (err) {
                _iterator0.e(err);
              } finally {
                _iterator0.f();
              }
              var actualLoadedTextures = this.loadedTextures.filter(function (t) {
                return t !== null;
              }).length;
              return {
                criticalThreshold: this.criticalThreshold,
                targetThreshold: this.targetThreshold,
                renderableMemUsed: renderableMemUsed,
                memUsed: this.memUsed,
                renderableTexturesLoaded: renderableTexturesLoaded,
                loadedTextures: actualLoadedTextures,
                baselineMemoryAllocation: this.baselineMemoryAllocation
              };
            }
          }]);
        }();
        /*
         * If not stated otherwise in this file or this component's LICENSE file the
         * following copyright and licenses apply:
         *
         * Copyright 2023 Comcast Cable Communications Management, LLC.
         *
         * Licensed under the Apache License, Version 2.0 (the License);
         * you may not use this file except in compliance with the License.
         * You may obtain a copy of the License at
         *
         * http://www.apache.org/licenses/LICENSE-2.0
         *
         * Unless required by applicable law or agreed to in writing, software
         * distributed under the License is distributed on an "AS IS" BASIS,
         * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
         * See the License for the specific language governing permissions and
         * limitations under the License.
         */
        var CoreContextTexture = /*#__PURE__*/function () {
          function CoreContextTexture(memManager, textureSource) {
            _classCallCheck(this, CoreContextTexture);
            _defineProperty(this, "textureSource", void 0);
            _defineProperty(this, "memManager", void 0);
            _defineProperty(this, "state", 'freed');
            this.memManager = memManager;
            this.textureSource = textureSource;
          }
          return _createClass(CoreContextTexture, [{
            key: "setTextureMemUse",
            value: function setTextureMemUse(byteSize) {
              this.memManager.setTextureMemUse(this.textureSource, byteSize);
            }
          }, {
            key: "renderable",
            get: function get() {
              return this.textureSource.renderable;
            }
          }]);
        }();
        /*
         * If not stated otherwise in this file or this component's LICENSE file the
         * following copyright and licenses apply:
         *
         * Copyright 2023 Comcast Cable Communications Management, LLC.
         *
         * Licensed under the Apache License, Version 2.0 (the License);
         * you may not use this file except in compliance with the License.
         * You may obtain a copy of the License at
         *
         * http://www.apache.org/licenses/LICENSE-2.0
         *
         * Unless required by applicable law or agreed to in writing, software
         * distributed under the License is distributed on an "AS IS" BASIS,
         * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
         * See the License for the specific language governing permissions and
         * limitations under the License.
         */
        var CoreRenderer = /*#__PURE__*/_createClass(function CoreRenderer(options) {
          _classCallCheck(this, CoreRenderer);
          _defineProperty(this, "options", void 0);
          _defineProperty(this, "mode", void 0);
          _defineProperty(this, "stage", void 0);
          //// Core Managers
          _defineProperty(this, "txManager", void 0);
          _defineProperty(this, "txMemManager", void 0);
          _defineProperty(this, "shManager", void 0);
          _defineProperty(this, "rttNodes", []);
          this.options = options;
          this.stage = options.stage;
          this.txManager = options.txManager;
          this.txMemManager = options.txMemManager;
          this.shManager = options.shManager;
        });
        /*
         * If not stated otherwise in this file or this component's LICENSE file the
         * following copyright and licenses apply:
         *
         * Copyright 2023 Comcast Cable Communications Management, LLC.
         *
         * Licensed under the Apache License, Version 2.0 (the License);
         * you may not use this file except in compliance with the License.
         * You may obtain a copy of the License at
         *
         * http://www.apache.org/licenses/LICENSE-2.0
         *
         * Unless required by applicable law or agreed to in writing, software
         * distributed under the License is distributed on an "AS IS" BASIS,
         * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
         * See the License for the specific language governing permissions and
         * limitations under the License.
         */
        /**
         * An CoreNode in the Renderer scene graph that renders text.
         *
         * @remarks
         * A Text Node is the second graphical building block of the Renderer scene
         * graph. It renders text using a specific text renderer that is automatically
         * chosen based on the font requested and what type of fonts are installed
         * into an app.
         *
         * The text renderer can be overridden by setting the `textRendererOverride`
         *
         * The `texture` and `shader` properties are managed by loaded text renderer and
         * should not be set directly.
         *
         * For non-text rendering, see {@link CoreNode}.
         */
        var CoreTextNode = /*#__PURE__*/function (_CoreNode2) {
          function CoreTextNode(stage, props, textRenderer) {
            var _this41;
            _classCallCheck(this, CoreTextNode);
            _this41 = _callSuper(this, CoreTextNode, [stage, props]);
            _defineProperty(_this41, "textRenderer", void 0);
            _defineProperty(_this41, "trState", void 0);
            _defineProperty(_this41, "_textRendererOverride", null);
            _defineProperty(_this41, "onTextLoaded", function () {
              var _this42 = _this41,
                contain = _this42.contain;
              var setWidth = _this41.trState.props.width;
              var setHeight = _this41.trState.props.height;
              var calcWidth = _this41.trState.textW || 0;
              var calcHeight = _this41.trState.textH || 0;
              if (contain === 'both') {
                _this41.props.width = setWidth;
                _this41.props.height = setHeight;
              } else if (contain === 'width') {
                _this41.props.width = setWidth;
                _this41.props.height = calcHeight;
              } else if (contain === 'none') {
                _this41.props.width = calcWidth;
                _this41.props.height = calcHeight;
              }
              _this41.updateLocalTransform();
              // Incase the RAF loop has been stopped already before text was loaded,
              // we request a render so it can be drawn.
              _this41.stage.requestRender();
              _this41.emit('loaded', {
                type: 'text',
                dimensions: {
                  width: _this41.trState.textW || 0,
                  height: _this41.trState.textH || 0
                }
              });
            });
            _defineProperty(_this41, "onTextFailed", function (target, error) {
              _this41.emit('failed', {
                type: 'text',
                error: error
              });
            });
            _this41._textRendererOverride = props.textRendererOverride;
            _this41.textRenderer = textRenderer;
            var textRendererState = _this41.createState({
              x: 0,
              y: 0,
              width: props.width,
              height: props.height,
              textAlign: props.textAlign,
              color: props.color,
              zIndex: props.zIndex,
              contain: props.contain,
              scrollable: props.scrollable,
              scrollY: props.scrollY,
              offsetY: props.offsetY,
              letterSpacing: props.letterSpacing,
              debug: props.debug,
              fontFamily: props.fontFamily,
              fontSize: props.fontSize,
              fontStretch: props.fontStretch,
              fontStyle: props.fontStyle,
              fontWeight: props.fontWeight,
              text: props.text,
              lineHeight: props.lineHeight,
              maxLines: props.maxLines,
              textBaseline: props.textBaseline,
              verticalAlign: props.verticalAlign,
              overflowSuffix: props.overflowSuffix
            });
            _this41.trState = textRendererState;
            return _this41;
          }
          _inherits(CoreTextNode, _CoreNode2);
          return _createClass(CoreTextNode, [{
            key: "width",
            get: function get() {
              return this.props.width;
            },
            set: function set(value) {
              this.props.width = value;
              this.textRenderer.set.width(this.trState, value);
              // If not containing, we must update the local transform to account for the
              // new width
              if (this.contain === 'none') {
                this.setUpdateType(UpdateType.Local);
              }
            }
          }, {
            key: "height",
            get: function get() {
              return this.props.height;
            },
            set: function set(value) {
              this.props.height = value;
              this.textRenderer.set.height(this.trState, value);
              // If not containing in the horizontal direction, we must update the local
              // transform to account for the new height
              if (this.contain !== 'both') {
                this.setUpdateType(UpdateType.Local);
              }
            }
          }, {
            key: "color",
            get: function get() {
              return this.trState.props.color;
            },
            set: function set(value) {
              this.textRenderer.set.color(this.trState, value);
            }
          }, {
            key: "text",
            get: function get() {
              return this.trState.props.text;
            },
            set: function set(value) {
              this.textRenderer.set.text(this.trState, value);
            }
          }, {
            key: "textRendererOverride",
            get: function get() {
              return this._textRendererOverride;
            },
            set: function set(value) {
              this._textRendererOverride = value;
              this.textRenderer.destroyState(this.trState);
              var textRenderer = this.stage.resolveTextRenderer(this.trState.props, this._textRendererOverride);
              if (!textRenderer) {
                console.warn('Text Renderer not found for font', this.trState.props.fontFamily);
                return;
              }
              this.textRenderer = textRenderer;
              this.trState = this.createState(this.trState.props);
            }
          }, {
            key: "fontSize",
            get: function get() {
              return this.trState.props.fontSize;
            },
            set: function set(value) {
              this.textRenderer.set.fontSize(this.trState, value);
            }
          }, {
            key: "fontFamily",
            get: function get() {
              return this.trState.props.fontFamily;
            },
            set: function set(value) {
              this.textRenderer.set.fontFamily(this.trState, value);
            }
          }, {
            key: "fontStretch",
            get: function get() {
              return this.trState.props.fontStretch;
            },
            set: function set(value) {
              this.textRenderer.set.fontStretch(this.trState, value);
            }
          }, {
            key: "fontStyle",
            get: function get() {
              return this.trState.props.fontStyle;
            },
            set: function set(value) {
              this.textRenderer.set.fontStyle(this.trState, value);
            }
          }, {
            key: "fontWeight",
            get: function get() {
              return this.trState.props.fontWeight;
            },
            set: function set(value) {
              this.textRenderer.set.fontWeight(this.trState, value);
            }
          }, {
            key: "textAlign",
            get: function get() {
              return this.trState.props.textAlign;
            },
            set: function set(value) {
              this.textRenderer.set.textAlign(this.trState, value);
            }
          }, {
            key: "contain",
            get: function get() {
              return this.trState.props.contain;
            },
            set: function set(value) {
              this.textRenderer.set.contain(this.trState, value);
            }
          }, {
            key: "scrollable",
            get: function get() {
              return this.trState.props.scrollable;
            },
            set: function set(value) {
              this.textRenderer.set.scrollable(this.trState, value);
            }
          }, {
            key: "scrollY",
            get: function get() {
              return this.trState.props.scrollY;
            },
            set: function set(value) {
              this.textRenderer.set.scrollY(this.trState, value);
            }
          }, {
            key: "offsetY",
            get: function get() {
              return this.trState.props.offsetY;
            },
            set: function set(value) {
              this.textRenderer.set.offsetY(this.trState, value);
            }
          }, {
            key: "letterSpacing",
            get: function get() {
              return this.trState.props.letterSpacing;
            },
            set: function set(value) {
              this.textRenderer.set.letterSpacing(this.trState, value);
            }
          }, {
            key: "lineHeight",
            get: function get() {
              return this.trState.props.lineHeight;
            },
            set: function set(value) {
              this.textRenderer.set.lineHeight(this.trState, value);
            }
          }, {
            key: "maxLines",
            get: function get() {
              return this.trState.props.maxLines;
            },
            set: function set(value) {
              this.textRenderer.set.maxLines(this.trState, value);
            }
          }, {
            key: "textBaseline",
            get: function get() {
              return this.trState.props.textBaseline;
            },
            set: function set(value) {
              this.textRenderer.set.textBaseline(this.trState, value);
            }
          }, {
            key: "verticalAlign",
            get: function get() {
              return this.trState.props.verticalAlign;
            },
            set: function set(value) {
              this.textRenderer.set.verticalAlign(this.trState, value);
            }
          }, {
            key: "overflowSuffix",
            get: function get() {
              return this.trState.props.overflowSuffix;
            },
            set: function set(value) {
              this.textRenderer.set.overflowSuffix(this.trState, value);
            }
          }, {
            key: "debug",
            get: function get() {
              return this.trState.props.debug;
            },
            set: function set(value) {
              this.textRenderer.set.debug(this.trState, value);
            }
          }, {
            key: "update",
            value: function update(delta, parentClippingRect) {
              _superPropGet(CoreTextNode, "update", this, 3)([delta, parentClippingRect]);
              assertTruthy(this.globalTransform);
              // globalTransform is updated in super.update(delta)
              this.textRenderer.set.x(this.trState, this.globalTransform.tx);
              this.textRenderer.set.y(this.trState, this.globalTransform.ty);
            }
          }, {
            key: "checkBasicRenderability",
            value: function checkBasicRenderability() {
              if (this.worldAlpha === 0 || this.isOutOfBounds() === true) {
                return false;
              }
              if (this.trState && this.trState.props.text !== '') {
                return true;
              }
              return false;
            }
          }, {
            key: "setRenderable",
            value: function setRenderable(isRenderable) {
              _superPropGet(CoreTextNode, "setRenderable", this, 3)([isRenderable]);
              this.textRenderer.setIsRenderable(this.trState, isRenderable);
            }
          }, {
            key: "renderQuads",
            value: function renderQuads(renderer) {
              var _this$props$parent4;
              assertTruthy(this.globalTransform);
              // If the text renderer does not support rendering quads, fallback to the
              // default renderQuads method
              if (!this.textRenderer.renderQuads) {
                _superPropGet(CoreTextNode, "renderQuads", this, 3)([renderer]);
                return;
              }
              // If the text renderer does support rendering quads, use it...
              // Prevent quad rendering if parent has a render texture
              // and this node is not the render texture
              if (this.parentHasRenderTexture) {
                if (!renderer.renderToTextureActive) {
                  return;
                }
                // Prevent quad rendering if parent render texture is not the active render texture
                if (this.parentRenderTexture !== renderer.activeRttNode) {
                  return;
                }
              }
              if (this.parentHasRenderTexture && (_this$props$parent4 = this.props.parent) !== null && _this$props$parent4 !== void 0 && _this$props$parent4.rtt) {
                this.globalTransform = Matrix3d.identity();
                if (this.localTransform) {
                  this.globalTransform.multiply(this.localTransform);
                }
              }
              assertTruthy(this.globalTransform);
              this.textRenderer.renderQuads(this.trState, this.globalTransform, this.clippingRect, this.worldAlpha, this.parentHasRenderTexture, this.framebufferDimensions);
            }
            /**
             * Destroy the node and cleanup all resources
             */
          }, {
            key: "destroy",
            value: function destroy() {
              _superPropGet(CoreTextNode, "destroy", this, 3)([]);
              this.textRenderer.destroyState(this.trState);
            }
            /**
             * Resolve a text renderer and a new state based on the current text renderer props provided
             * @param props
             * @returns
             */
          }, {
            key: "createState",
            value: function createState(props) {
              var textRendererState = this.textRenderer.createState(props, this);
              textRendererState.emitter.on('loaded', this.onTextLoaded);
              textRendererState.emitter.on('failed', this.onTextFailed);
              this.textRenderer.scheduleUpdateState(textRendererState);
              return textRendererState;
            }
          }]);
        }(CoreNode);
        function santizeCustomDataMap(d) {
          var validTypes = {
            boolean: true,
            string: true,
            number: true,
            undefined: true
          };
          var keys = Object.keys(d);
          for (var i = 0; i < keys.length; i++) {
            var key = keys[i];
            if (!key) {
              continue;
            }
            var value = d[key];
            var valueType = _typeof(value);
            // Typescript doesn't understand the above const valueType \_()_/
            // eslint-disable-next-line @typescript-eslint/ban-ts-comment
            // @ts-ignore-next-line
            if (valueType === 'string' && value.length > 2048) {
              console.warn("Custom Data value for ".concat(key, " is too long, it will be truncated to 2048 characters"));
              // same here, see above comment, this can only be a string at this point
              // eslint-disable-next-line @typescript-eslint/ban-ts-comment
              // @ts-ignore-next-line
              // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment, @typescript-eslint/no-unsafe-call
              d[key] = value.substring(0, 2048);
            }
            if (!validTypes[valueType]) {
              console.warn("Custom Data value for ".concat(key, " is not a boolean, string, or number, it will be ignored"));
              delete d[key];
            }
          }
          return d;
        }

        /*
         * If not stated otherwise in this file or this component's LICENSE file the
         * following copyright and licenses apply:
         *
         * Copyright 2023 Comcast Cable Communications Management, LLC.
         *
         * Licensed under the Apache License, Version 2.0 (the License);
         * you may not use this file except in compliance with the License.
         * You may obtain a copy of the License at
         *
         * http://www.apache.org/licenses/LICENSE-2.0
         *
         * Unless required by applicable law or agreed to in writing, software
         * distributed under the License is distributed on an "AS IS" BASIS,
         * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
         * See the License for the specific language governing permissions and
         * limitations under the License.
         */
        var bufferMemory = 2e6;
        var Stage = /*#__PURE__*/function () {
          /**
           * Stage constructor
           */
          function Stage(options) {
            var _this43 = this;
            _classCallCheck(this, Stage);
            _defineProperty(this, "options", void 0);
            /// Module Instances
            _defineProperty(this, "animationManager", void 0);
            _defineProperty(this, "txManager", void 0);
            _defineProperty(this, "txMemManager", void 0);
            _defineProperty(this, "fontManager", void 0);
            _defineProperty(this, "textRenderers", void 0);
            _defineProperty(this, "shManager", void 0);
            _defineProperty(this, "renderer", void 0);
            _defineProperty(this, "root", void 0);
            _defineProperty(this, "interactiveNodes", new Set());
            _defineProperty(this, "boundsMargin", void 0);
            _defineProperty(this, "defShaderCtr", void 0);
            _defineProperty(this, "strictBound", void 0);
            _defineProperty(this, "preloadBound", void 0);
            _defineProperty(this, "strictBounds", void 0);
            _defineProperty(this, "defaultTexture", null);
            /**
             * Target frame time in milliseconds (calculated from targetFPS)
             *
             * @remarks
             * This is pre-calculated to avoid recalculating on every frame.
             * - 0 means no throttling (use display refresh rate)
             * - >0 means throttle to this frame time (1000 / targetFPS)
             */
            _defineProperty(this, "targetFrameTime", 0);
            /**
             * Renderer Event Bus for the Stage to emit events onto
             *
             * @remarks
             * In reality this is just the RendererMain instance, which is an EventEmitter.
             * this allows us to directly emit events from the Stage to RendererMain
             * without having to set up forwarding handlers.
             */
            _defineProperty(this, "eventBus", void 0);
            /// State
            _defineProperty(this, "deltaTime", 0);
            _defineProperty(this, "lastFrameTime", 0);
            _defineProperty(this, "currentFrameTime", 0);
            _defineProperty(this, "fpsNumFrames", 0);
            _defineProperty(this, "fpsElapsedTime", 0);
            _defineProperty(this, "numQuadsRendered", 0);
            _defineProperty(this, "renderRequested", false);
            _defineProperty(this, "frameEventQueue", []);
            _defineProperty(this, "fontResolveMap", {});
            /// Debug data
            _defineProperty(this, "contextSpy", null);
            this.options = options;
            var canvas = options.canvas,
              clearColor = options.clearColor,
              appWidth = options.appWidth,
              appHeight = options.appHeight,
              boundsMargin = options.boundsMargin,
              enableContextSpy = options.enableContextSpy,
              forceWebGL2 = options.forceWebGL2,
              numImageWorkers = options.numImageWorkers,
              textureMemory = options.textureMemory,
              renderEngine = options.renderEngine,
              fontEngines = options.fontEngines,
              createImageBitmapSupport = options.createImageBitmapSupport,
              maxRetryCount = options.maxRetryCount;
            this.eventBus = options.eventBus;
            // Calculate target frame time from targetFPS option
            this.targetFrameTime = options.targetFPS > 0 ? 1000 / options.targetFPS : 0;
            this.txManager = new CoreTextureManager(this, {
              numImageWorkers: numImageWorkers,
              createImageBitmapSupport: createImageBitmapSupport,
              maxRetryCount: maxRetryCount
            });
            // Wait for the Texture Manager to initialize
            // once it does, request a render
            this.txManager.on('initialized', function () {
              _this43.requestRender();
            });
            this.txMemManager = new TextureMemoryManager(this, textureMemory);
            this.shManager = new CoreShaderManager();
            this.animationManager = new AnimationManager();
            this.contextSpy = enableContextSpy ? new ContextSpy() : null;
            this.strictBounds = options.strictBounds;
            var bm = [0, 0, 0, 0];
            if (boundsMargin) {
              bm = Array.isArray(boundsMargin) ? boundsMargin : [boundsMargin, boundsMargin, boundsMargin, boundsMargin];
            }
            this.boundsMargin = bm;
            // precalculate our viewport bounds
            this.strictBound = createBound(0, 0, appWidth, appHeight);
            this.preloadBound = createPreloadBounds(this.strictBound, bm);
            var rendererOptions = {
              stage: this,
              canvas: canvas,
              pixelRatio: options.devicePhysicalPixelRatio * options.deviceLogicalPixelRatio,
              clearColor: clearColor !== null && clearColor !== void 0 ? clearColor : 0xff000000,
              bufferMemory: bufferMemory,
              txManager: this.txManager,
              txMemManager: this.txMemManager,
              shManager: this.shManager,
              contextSpy: this.contextSpy,
              forceWebGL2: forceWebGL2
            };
            this.renderer = new renderEngine(rendererOptions);
            var renderMode = this.renderer.mode || 'webgl';
            this.createDefaultTexture();
            this.defShaderCtr = this.renderer.getDefShaderCtr();
            setPremultiplyMode(renderMode);
            // Must do this after renderer is created
            this.txManager.renderer = this.renderer;
            // Create text renderers
            this.textRenderers = {};
            fontEngines.forEach(function (fontEngineConstructor) {
              var fontEngineInstance = new fontEngineConstructor(_this43);
              var className = fontEngineInstance.type;
              if (className === 'sdf' && renderMode === 'canvas') {
                console.warn('SdfTextRenderer is not compatible with Canvas renderer. Skipping...');
                return;
              }
              if (fontEngineInstance instanceof TextRenderer) {
                if (className === 'canvas') {
                  _this43.textRenderers['canvas'] = fontEngineInstance;
                } else if (className === 'sdf') {
                  _this43.textRenderers['sdf'] = fontEngineInstance;
                }
              }
            });
            if (Object.keys(this.textRenderers).length === 0) {
              console.warn('No text renderers available. Your text will not render.');
            }
            this.fontManager = new TrFontManager(this.textRenderers);
            // create root node
            var rootNode = new CoreNode(this, {
              x: 0,
              y: 0,
              width: appWidth,
              height: appHeight,
              alpha: 1,
              autosize: false,
              boundsMargin: null,
              clipping: false,
              color: 0x00000000,
              colorTop: 0x00000000,
              colorBottom: 0x00000000,
              colorLeft: 0x00000000,
              colorRight: 0x00000000,
              colorTl: 0x00000000,
              colorTr: 0x00000000,
              colorBl: 0x00000000,
              colorBr: 0x00000000,
              zIndex: 0,
              zIndexLocked: 0,
              scaleX: 1,
              scaleY: 1,
              mountX: 0,
              mountY: 0,
              mount: 0,
              pivot: 0.5,
              pivotX: 0.5,
              pivotY: 0.5,
              rotation: 0,
              parent: null,
              texture: null,
              textureOptions: {},
              shader: this.defShaderCtr,
              rtt: false,
              src: null,
              scale: 1,
              preventCleanup: false,
              strictBounds: this.strictBounds
            });
            this.root = rootNode;
            // execute platform start loop
            {
              startLoop(this);
            }
          }
          return _createClass(Stage, [{
            key: "setClearColor",
            value: function setClearColor(color) {
              this.renderer.updateClearColor(color);
              this.renderRequested = true;
            }
            /**
             * Update the target frame time based on the current targetFPS setting
             *
             * @remarks
             * This should be called whenever the targetFPS option is changed
             * to ensure targetFrameTime stays in sync.
             * targetFPS of 0 means no throttling (targetFrameTime = 0)
             * targetFPS > 0 means throttle to 1000/targetFPS milliseconds
             */
          }, {
            key: "updateTargetFrameTime",
            value: function updateTargetFrameTime() {
              this.targetFrameTime = this.options.targetFPS > 0 ? 1000 / this.options.targetFPS : 0;
            }
          }, {
            key: "updateFrameTime",
            value: function updateFrameTime() {
              var newFrameTime = getTimeStamp();
              this.lastFrameTime = this.currentFrameTime;
              this.currentFrameTime = newFrameTime;
              this.deltaTime = !this.lastFrameTime ? 100 / 6 : newFrameTime - this.lastFrameTime;
              this.txManager.frameTime = newFrameTime;
              this.txMemManager.frameTime = newFrameTime;
              // This event is emitted at the beginning of the frame (before any updates
              // or rendering), so no need to to use `stage.queueFrameEvent` here.
              this.eventBus.emit('frameTick', {
                time: this.currentFrameTime,
                delta: this.deltaTime
              });
            }
            /**
             * Create default PixelTexture
             */
          }, {
            key: "createDefaultTexture",
            value: function createDefaultTexture() {
              var _this44 = this;
              this.defaultTexture = this.txManager.createTexture('ColorTexture', {
                color: 0xffffffff
              });
              assertTruthy(this.defaultTexture instanceof ColorTexture);
              this.txManager.loadTexture(this.defaultTexture, true);
              // Mark the default texture as ALWAYS renderable
              // This prevents it from ever being cleaned up.
              // Fixes https://github.com/lightning-js/renderer/issues/262
              this.defaultTexture.setRenderableOwner('stage', true);
              // When the default texture is loaded, request a render in case the
              // RAF is paused. Fixes: https://github.com/lightning-js/renderer/issues/123
              this.defaultTexture.once('loaded', function () {
                _this44.requestRender();
              });
            }
            /**
             * Update animations
             */
          }, {
            key: "updateAnimations",
            value: function updateAnimations() {
              var animationManager = this.animationManager;
              if (!this.root) {
                return;
              }
              // step animation
              animationManager.update(this.deltaTime);
            }
            /**
             * Check if the scene has updates
             */
          }, {
            key: "hasSceneUpdates",
            value: function hasSceneUpdates() {
              return !!this.root.updateType || this.renderRequested || this.txManager.hasUpdates();
            }
            /**
             * Start a new frame draw
             */
          }, {
            key: "drawFrame",
            value: function drawFrame() {
              var renderer = this.renderer,
                renderRequested = this.renderRequested;
              assertTruthy(renderer);
              // Update tree if needed
              if (this.root.updateType !== 0) {
                this.root.update(this.deltaTime, this.root.clippingRect);
              }
              // Process some textures asynchronously but don't block the frame
              // Use a background task to prevent frame drops
              this.txManager.processSome(this.options.textureProcessingTimeLimit).catch(function (err) {
                console.error('Error processing textures:', err);
              });
              // Reset render operations and clear the canvas
              renderer.reset();
              // If we have RTT nodes draw them first
              // So we can use them as textures in the main scene
              if (renderer.rttNodes.length > 0) {
                renderer.renderRTTNodes();
              }
              // Fill quads buffer
              this.addQuads(this.root);
              // Perform render pass
              renderer === null || renderer === void 0 || renderer.render();
              this.calculateFps();
              this.calculateQuads();
              // Reset renderRequested flag if it was set
              if (renderRequested) {
                this.renderRequested = false;
              }
              // Check if we need to cleanup textures
              if (this.txMemManager.criticalCleanupRequested === true) {
                this.txMemManager.cleanup();
              }
            }
            /**
             * Queue an event to be emitted after the current/next frame is rendered
             *
             * @remarks
             * When we are operating in the context of the render loop, we may want to
             * emit events that are related to the current frame. However, we generally do
             * NOT want to emit events directly in the middle of the render loop, since
             * this could enable event handlers to modify the scene graph and cause
             * unexpected behavior. Instead, we queue up events to be emitted and then
             * flush the queue after the frame has been rendered.
             *
             * @param name
             * @param data
             */
          }, {
            key: "queueFrameEvent",
            value: function queueFrameEvent(name, data) {
              this.frameEventQueue.push([name, data]);
            }
            /**
             * Emit all queued frame events
             *
             * @remarks
             * This method should be called after the frame has been rendered to emit
             * all events that were queued during the frame.
             *
             * See {@link queueFrameEvent} for more information.
             */
          }, {
            key: "flushFrameEvents",
            value: function flushFrameEvents() {
              var _iterator1 = _createForOfIteratorHelper(this.frameEventQueue),
                _step1;
              try {
                for (_iterator1.s(); !(_step1 = _iterator1.n()).done;) {
                  var _step1$value = _slicedToArray(_step1.value, 2),
                    name = _step1$value[0],
                    data = _step1$value[1];
                  this.eventBus.emit(name, data);
                }
              } catch (err) {
                _iterator1.e(err);
              } finally {
                _iterator1.f();
              }
              this.frameEventQueue = [];
            }
          }, {
            key: "calculateFps",
            value: function calculateFps() {
              // If there's an FPS update interval, emit the FPS update event
              // when the specified interval has elapsed.
              var fpsUpdateInterval = this.options.fpsUpdateInterval;
              if (fpsUpdateInterval) {
                this.fpsNumFrames++;
                this.fpsElapsedTime += this.deltaTime;
                if (this.fpsElapsedTime >= fpsUpdateInterval) {
                  var _this$contextSpy$getD, _this$contextSpy, _this$contextSpy2;
                  var _fps = Math.round(this.fpsNumFrames * 1000 / this.fpsElapsedTime);
                  this.fpsNumFrames = 0;
                  this.fpsElapsedTime = 0;
                  this.queueFrameEvent('fpsUpdate', {
                    fps: _fps,
                    contextSpyData: (_this$contextSpy$getD = (_this$contextSpy = this.contextSpy) === null || _this$contextSpy === void 0 ? void 0 : _this$contextSpy.getData()) !== null && _this$contextSpy$getD !== void 0 ? _this$contextSpy$getD : null
                  });
                  (_this$contextSpy2 = this.contextSpy) === null || _this$contextSpy2 === void 0 || _this$contextSpy2.reset();
                }
              }
            }
          }, {
            key: "calculateQuads",
            value: function calculateQuads() {
              var quads = this.renderer.getQuadCount();
              if (quads && quads !== this.numQuadsRendered) {
                this.numQuadsRendered = quads;
                this.queueFrameEvent('quadsUpdate', {
                  quads: quads
                });
              }
            }
          }, {
            key: "addQuads",
            value: function addQuads(node) {
              assertTruthy(this.renderer);
              // If the node is renderable and has a loaded texture, render it
              if (node.isRenderable === true) {
                node.renderQuads(this.renderer);
              }
              for (var i = 0; i < node.children.length; i++) {
                var child = node.children[i];
                if (child === undefined) {
                  continue;
                }
                if (child.worldAlpha === 0 || child.strictBounds === true && child.renderState === CoreNodeRenderState.OutOfBounds) {
                  continue;
                }
                this.addQuads(child);
              }
            }
            /**
             * Request a render pass without forcing an update
             */
          }, {
            key: "requestRender",
            value: function requestRender() {
              this.renderRequested = true;
            }
            /**
             * Find all nodes at a given point
             * @param data
             */
          }, {
            key: "findNodesAtPoint",
            value: function findNodesAtPoint(data) {
              var x = data.x / this.options.deviceLogicalPixelRatio;
              var y = data.y / this.options.deviceLogicalPixelRatio;
              var nodes = [];
              var _iterator10 = _createForOfIteratorHelper(this.interactiveNodes),
                _step10;
              try {
                for (_iterator10.s(); !(_step10 = _iterator10.n()).done;) {
                  var node = _step10.value;
                  if (node.isRenderable === false) {
                    continue;
                  }
                  if (pointInBound(x, y, node.renderBound) === true) {
                    nodes.push(node);
                  }
                }
              } catch (err) {
                _iterator10.e(err);
              } finally {
                _iterator10.f();
              }
              return nodes;
            }
            /**
             * Find the top node at a given point
             * @param data
             * @returns
             */
          }, {
            key: "getNodeFromPosition",
            value: function getNodeFromPosition(data) {
              var nodes = this.findNodesAtPoint(data);
              if (nodes.length === 0) {
                return null;
              }
              var topNode = nodes[0];
              for (var i = 0; i < nodes.length; i++) {
                if (nodes[i].zIndex > topNode.zIndex) {
                  topNode = nodes[i];
                }
              }
              return topNode || null;
            }
            /**
             * Given a font name, and possible renderer override, return the best compatible text renderer.
             *
             * @remarks
             * Will try to return a canvas renderer if no other suitable renderer can be resolved.
             *
             * @param fontFamily
             * @param textRendererOverride
             * @returns
             */
          }, {
            key: "resolveTextRenderer",
            value: function resolveTextRenderer(trProps) {
              var textRendererOverride = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;
              var fontCacheString = "".concat(trProps.fontFamily).concat(trProps.fontStyle).concat(trProps.fontWeight).concat(trProps.fontStretch).concat(textRendererOverride ? textRendererOverride : '');
              // check our resolve cache first
              if (this.fontResolveMap[fontCacheString] !== undefined) {
                return this.fontResolveMap[fontCacheString];
              }
              // Resolve the text renderer
              var rendererId = textRendererOverride;
              var overrideFallback = false;
              // Check if the override is valid (if one is provided)
              if (rendererId) {
                var possibleRenderer = this.textRenderers[rendererId];
                if (!possibleRenderer) {
                  console.warn("Text renderer override '".concat(rendererId, "' not found."));
                  rendererId = null;
                  overrideFallback = true;
                } else if (!possibleRenderer.canRenderFont(trProps)) {
                  console.warn("Cannot use override text renderer '".concat(rendererId, "' for font"), trProps);
                  rendererId = null;
                  overrideFallback = true;
                }
              }
              if (!rendererId) {
                // Iterate through the text renderers and find the first one that can render the font
                for (var _i = 0, _Object$entries = Object.entries(this.textRenderers); _i < _Object$entries.length; _i++) {
                  var _Object$entries$_i = _slicedToArray(_Object$entries[_i], 2),
                    trId = _Object$entries$_i[0],
                    tr = _Object$entries$_i[1];
                  if (tr.canRenderFont(trProps)) {
                    rendererId = trId;
                    break;
                  }
                }
                if (!rendererId && this.textRenderers.canvas !== undefined) {
                  // If no renderer can be found, use the canvas renderer
                  rendererId = 'canvas';
                }
              }
              if (overrideFallback) {
                console.warn("Falling back to text renderer ".concat(String(rendererId)));
              }
              if (!rendererId) {
                // silently fail if no renderer can be found, the error is already created
                // at the constructor level
                return null;
              }
              // By now we are guaranteed to have a valid rendererId (at least Canvas);
              var resolvedTextRenderer = this.textRenderers[rendererId];
              assertTruthy(resolvedTextRenderer, 'resolvedTextRenderer undefined');
              // cache the resolved renderer for future use with these trProps
              this.fontResolveMap[fontCacheString] = resolvedTextRenderer;
              // Need to explicitly cast to TextRenderer because TS doesn't like
              // the covariant state argument in the setter method map
              return resolvedTextRenderer;
            }
            /**
             * Create a shader controller instance
             *
             * @param type
             * @param props
             * @returns
             */
          }, {
            key: "createShaderCtr",
            value: function createShaderCtr(type, props) {
              return this.shManager.loadShader(type, props);
            }
          }, {
            key: "createNode",
            value: function createNode(props) {
              var resolvedProps = this.resolveNodeDefaults(props);
              return new CoreNode(this, resolvedProps);
            }
          }, {
            key: "createTextNode",
            value: function createTextNode(props) {
              var _props$fontSize, _props$text, _props$textRendererOv, _props$fontFamily, _props$fontStyle, _props$fontWeight, _props$fontStretch, _props$textAlign, _props$contain, _props$scrollable, _props$scrollY2, _props$offsetY, _props$letterSpacing, _props$maxLines, _props$textBaseline, _props$verticalAlign, _props$overflowSuffix, _props$debug2;
              var fontSize = (_props$fontSize = props.fontSize) !== null && _props$fontSize !== void 0 ? _props$fontSize : 16;
              var resolvedProps = _objectSpread(_objectSpread({}, this.resolveNodeDefaults(props)), {}, {
                text: (_props$text = props.text) !== null && _props$text !== void 0 ? _props$text : '',
                textRendererOverride: (_props$textRendererOv = props.textRendererOverride) !== null && _props$textRendererOv !== void 0 ? _props$textRendererOv : null,
                fontSize: fontSize,
                fontFamily: (_props$fontFamily = props.fontFamily) !== null && _props$fontFamily !== void 0 ? _props$fontFamily : 'sans-serif',
                fontStyle: (_props$fontStyle = props.fontStyle) !== null && _props$fontStyle !== void 0 ? _props$fontStyle : 'normal',
                fontWeight: (_props$fontWeight = props.fontWeight) !== null && _props$fontWeight !== void 0 ? _props$fontWeight : 'normal',
                fontStretch: (_props$fontStretch = props.fontStretch) !== null && _props$fontStretch !== void 0 ? _props$fontStretch : 'normal',
                textAlign: (_props$textAlign = props.textAlign) !== null && _props$textAlign !== void 0 ? _props$textAlign : 'left',
                contain: (_props$contain = props.contain) !== null && _props$contain !== void 0 ? _props$contain : 'none',
                scrollable: (_props$scrollable = props.scrollable) !== null && _props$scrollable !== void 0 ? _props$scrollable : false,
                scrollY: (_props$scrollY2 = props.scrollY) !== null && _props$scrollY2 !== void 0 ? _props$scrollY2 : 0,
                offsetY: (_props$offsetY = props.offsetY) !== null && _props$offsetY !== void 0 ? _props$offsetY : 0,
                letterSpacing: (_props$letterSpacing = props.letterSpacing) !== null && _props$letterSpacing !== void 0 ? _props$letterSpacing : 0,
                lineHeight: props.lineHeight,
                // `undefined` is a valid value
                maxLines: (_props$maxLines = props.maxLines) !== null && _props$maxLines !== void 0 ? _props$maxLines : 0,
                textBaseline: (_props$textBaseline = props.textBaseline) !== null && _props$textBaseline !== void 0 ? _props$textBaseline : 'alphabetic',
                verticalAlign: (_props$verticalAlign = props.verticalAlign) !== null && _props$verticalAlign !== void 0 ? _props$verticalAlign : 'middle',
                overflowSuffix: (_props$overflowSuffix = props.overflowSuffix) !== null && _props$overflowSuffix !== void 0 ? _props$overflowSuffix : '...',
                debug: (_props$debug2 = props.debug) !== null && _props$debug2 !== void 0 ? _props$debug2 : {},
                shaderProps: null
              });
              var resolvedTextRenderer = this.resolveTextRenderer(resolvedProps, props.textRendererOverride);
              if (!resolvedTextRenderer) {
                throw new Error("No compatible text renderer found for ".concat(resolvedProps.fontFamily));
              }
              return new CoreTextNode(this, resolvedProps, resolvedTextRenderer);
            }
          }, {
            key: "setBoundsMargin",
            value: function setBoundsMargin(value) {
              this.boundsMargin = Array.isArray(value) ? value : [value, value, value, value];
              this.root.setUpdateType(UpdateType.RenderBounds);
            }
            /**
             * Resolves the default property values for a Node
             *
             * @remarks
             * This method is used internally by the RendererMain to resolve the default
             * property values for a Node. It is exposed publicly so that it can be used
             * by Core Driver implementations.
             *
             * @param props
             * @returns
             */
          }, {
            key: "resolveNodeDefaults",
            value: function resolveNodeDefaults(props) {
              var _props$color8, _ref9, _ref0, _props$colorTl, _ref1, _ref10, _props$colorTr, _ref11, _ref12, _props$colorBl, _ref13, _ref14, _props$colorBr, _props$x, _props$y, _props$width0, _props$height4, _props$alpha, _props$autosize, _props$boundsMargin, _props$clipping, _props$colorTop, _props$colorBottom, _props$colorLeft, _props$colorRight, _props$zIndex, _props$zIndexLocked, _props$parent3, _props$texture, _props$textureOptions, _props$shader, _props$src2, _props$scale, _ref15, _props$scaleX, _ref16, _props$scaleY, _props$mount, _ref17, _props$mountX, _ref18, _props$mountY, _props$pivot2, _ref19, _props$pivotX, _ref20, _props$pivotY, _props$rotation, _props$rtt, _props$preventCleanup, _props$interactive, _props$strictBounds;
              var color = (_props$color8 = props.color) !== null && _props$color8 !== void 0 ? _props$color8 : 0xffffffff;
              var colorTl = (_ref9 = (_ref0 = (_props$colorTl = props.colorTl) !== null && _props$colorTl !== void 0 ? _props$colorTl : props.colorTop) !== null && _ref0 !== void 0 ? _ref0 : props.colorLeft) !== null && _ref9 !== void 0 ? _ref9 : color;
              var colorTr = (_ref1 = (_ref10 = (_props$colorTr = props.colorTr) !== null && _props$colorTr !== void 0 ? _props$colorTr : props.colorTop) !== null && _ref10 !== void 0 ? _ref10 : props.colorRight) !== null && _ref1 !== void 0 ? _ref1 : color;
              var colorBl = (_ref11 = (_ref12 = (_props$colorBl = props.colorBl) !== null && _props$colorBl !== void 0 ? _props$colorBl : props.colorBottom) !== null && _ref12 !== void 0 ? _ref12 : props.colorLeft) !== null && _ref11 !== void 0 ? _ref11 : color;
              var colorBr = (_ref13 = (_ref14 = (_props$colorBr = props.colorBr) !== null && _props$colorBr !== void 0 ? _props$colorBr : props.colorBottom) !== null && _ref14 !== void 0 ? _ref14 : props.colorRight) !== null && _ref13 !== void 0 ? _ref13 : color;
              var data = {};
              if (this.options.inspector === true) {
                var _props$data;
                data = santizeCustomDataMap((_props$data = props.data) !== null && _props$data !== void 0 ? _props$data : {});
              }
              return {
                x: (_props$x = props.x) !== null && _props$x !== void 0 ? _props$x : 0,
                y: (_props$y = props.y) !== null && _props$y !== void 0 ? _props$y : 0,
                width: (_props$width0 = props.width) !== null && _props$width0 !== void 0 ? _props$width0 : 0,
                height: (_props$height4 = props.height) !== null && _props$height4 !== void 0 ? _props$height4 : 0,
                alpha: (_props$alpha = props.alpha) !== null && _props$alpha !== void 0 ? _props$alpha : 1,
                autosize: (_props$autosize = props.autosize) !== null && _props$autosize !== void 0 ? _props$autosize : false,
                boundsMargin: (_props$boundsMargin = props.boundsMargin) !== null && _props$boundsMargin !== void 0 ? _props$boundsMargin : null,
                clipping: (_props$clipping = props.clipping) !== null && _props$clipping !== void 0 ? _props$clipping : false,
                color: color,
                colorTop: (_props$colorTop = props.colorTop) !== null && _props$colorTop !== void 0 ? _props$colorTop : color,
                colorBottom: (_props$colorBottom = props.colorBottom) !== null && _props$colorBottom !== void 0 ? _props$colorBottom : color,
                colorLeft: (_props$colorLeft = props.colorLeft) !== null && _props$colorLeft !== void 0 ? _props$colorLeft : color,
                colorRight: (_props$colorRight = props.colorRight) !== null && _props$colorRight !== void 0 ? _props$colorRight : color,
                colorBl: colorBl,
                colorBr: colorBr,
                colorTl: colorTl,
                colorTr: colorTr,
                zIndex: (_props$zIndex = props.zIndex) !== null && _props$zIndex !== void 0 ? _props$zIndex : 0,
                zIndexLocked: (_props$zIndexLocked = props.zIndexLocked) !== null && _props$zIndexLocked !== void 0 ? _props$zIndexLocked : 0,
                parent: (_props$parent3 = props.parent) !== null && _props$parent3 !== void 0 ? _props$parent3 : null,
                texture: (_props$texture = props.texture) !== null && _props$texture !== void 0 ? _props$texture : null,
                textureOptions: (_props$textureOptions = props.textureOptions) !== null && _props$textureOptions !== void 0 ? _props$textureOptions : {},
                shader: (_props$shader = props.shader) !== null && _props$shader !== void 0 ? _props$shader : this.defShaderCtr,
                // Since setting the `src` will trigger a texture load, we need to set it after
                // we set the texture. Otherwise, problems happen.
                src: (_props$src2 = props.src) !== null && _props$src2 !== void 0 ? _props$src2 : null,
                srcHeight: props.srcHeight,
                srcWidth: props.srcWidth,
                srcX: props.srcX,
                srcY: props.srcY,
                scale: (_props$scale = props.scale) !== null && _props$scale !== void 0 ? _props$scale : null,
                scaleX: (_ref15 = (_props$scaleX = props.scaleX) !== null && _props$scaleX !== void 0 ? _props$scaleX : props.scale) !== null && _ref15 !== void 0 ? _ref15 : 1,
                scaleY: (_ref16 = (_props$scaleY = props.scaleY) !== null && _props$scaleY !== void 0 ? _props$scaleY : props.scale) !== null && _ref16 !== void 0 ? _ref16 : 1,
                mount: (_props$mount = props.mount) !== null && _props$mount !== void 0 ? _props$mount : 0,
                mountX: (_ref17 = (_props$mountX = props.mountX) !== null && _props$mountX !== void 0 ? _props$mountX : props.mount) !== null && _ref17 !== void 0 ? _ref17 : 0,
                mountY: (_ref18 = (_props$mountY = props.mountY) !== null && _props$mountY !== void 0 ? _props$mountY : props.mount) !== null && _ref18 !== void 0 ? _ref18 : 0,
                pivot: (_props$pivot2 = props.pivot) !== null && _props$pivot2 !== void 0 ? _props$pivot2 : 0.5,
                pivotX: (_ref19 = (_props$pivotX = props.pivotX) !== null && _props$pivotX !== void 0 ? _props$pivotX : props.pivot) !== null && _ref19 !== void 0 ? _ref19 : 0.5,
                pivotY: (_ref20 = (_props$pivotY = props.pivotY) !== null && _props$pivotY !== void 0 ? _props$pivotY : props.pivot) !== null && _ref20 !== void 0 ? _ref20 : 0.5,
                rotation: (_props$rotation = props.rotation) !== null && _props$rotation !== void 0 ? _props$rotation : 0,
                rtt: (_props$rtt = props.rtt) !== null && _props$rtt !== void 0 ? _props$rtt : false,
                data: data,
                preventCleanup: (_props$preventCleanup = props.preventCleanup) !== null && _props$preventCleanup !== void 0 ? _props$preventCleanup : false,
                imageType: props.imageType,
                interactive: (_props$interactive = props.interactive) !== null && _props$interactive !== void 0 ? _props$interactive : false,
                strictBounds: (_props$strictBounds = props.strictBounds) !== null && _props$strictBounds !== void 0 ? _props$strictBounds : this.strictBounds
              };
            }
            /**
             * Cleanup Unused Textures
             *
             * @remarks
             * This method is used to cleanup unused textures that are no longer in use.
             */
          }, {
            key: "cleanup",
            value: function cleanup() {
              this.txMemManager.cleanup();
            }
          }]);
        }();
        /*
         * If not stated otherwise in this file or this component's LICENSE file the
         * following copyright and licenses apply:
         *
         * Copyright 2023 Comcast Cable Communications Management, LLC.
         *
         * Licensed under the Apache License, Version 2.0 (the License);
         * you may not use this file except in compliance with the License.
         * You may obtain a copy of the License at
         *
         * http://www.apache.org/licenses/LICENSE-2.0
         *
         * Unless required by applicable law or agreed to in writing, software
         * distributed under the License is distributed on an "AS IS" BASIS,
         * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
         * See the License for the specific language governing permissions and
         * limitations under the License.
         */
        /**
         * The Renderer Main API
         *
         * @remarks
         * This is the primary class used to configure and operate the Renderer.
         *
         * It is used to create and destroy Nodes, as well as Texture and Shader
         * references.
         *
         * Example:
         * ```ts
         * import { RendererMain, MainCoreDriver } from '@lightningjs/renderer';
         *
         * // Initialize the Renderer
         * const renderer = new RendererMain(
         *   {
         *     appWidth: 1920,
         *     appHeight: 1080
         *   },
         *   'app',
         *   new MainCoreDriver(),
         * );
         * ```
         *
         * ## Events
         * - `fpsUpdate`
         *   - Emitted every `fpsUpdateInterval` milliseconds with the current FPS
         * - `frameTick`
         *   - Emitted every frame tick
         * - `quadsUpdate`
         *  - Emitted when number of quads rendered is updated
         * - `idle`
         *   - Emitted when the renderer is idle (no changes to the scene
         *     graph/animations running)
         * - `criticalCleanup`
         *  - Emitted when the Texture Memory Manager Cleanup process is triggered
         *  - Payload: { memUsed: number, criticalThreshold: number }
         *    - `memUsed` - The amount of memory (in bytes) used by textures before the
         *       cleanup process
         *    - `criticalThreshold` - The critical threshold (in bytes)
         * - `criticalCleanupFailed`
         *   - Emitted when the Texture Memory Manager Cleanup process is unable to free
         *     up enough texture memory to reach below the critical threshold.
         *     This can happen when there is not enough non-renderable textures to
         *     free up.
         *   - Payload (object with keys):
         *     - `memUsed` - The amount of memory (in bytes) used by textures after
         *       the cleanup process
         *     - `criticalThreshold` - The critical threshold (in bytes)
         */
        var RendererMain = /*#__PURE__*/function (_EventEmitter7) {
          /**
           * Constructs a new Renderer instance
           *
           * @param settings Renderer settings
           * @param target Element ID or HTMLElement to insert the canvas into
           * @param driver Core Driver to use
           */
          function RendererMain(settings, target) {
            var _settings$textureMemo, _settings$textureMemo2, _settings$textureMemo3, _settings$textureMemo4, _settings$textureMemo5, _settings$textureMemo6, _settings$clearColor, _settings$enableConte, _settings$forceWebGL, _settings$inspector, _settings$quadBufferS, _settings$strictBound, _settings$maxRetryCou;
            var _this45;
            _classCallCheck(this, RendererMain);
            _this45 = _callSuper(this, RendererMain);
            _defineProperty(_this45, "root", void 0);
            _defineProperty(_this45, "canvas", void 0);
            _defineProperty(_this45, "settings", void 0);
            _defineProperty(_this45, "stage", void 0);
            _defineProperty(_this45, "inspector", null);
            var resolvedTxSettings = {
              criticalThreshold: ((_settings$textureMemo = settings.textureMemory) === null || _settings$textureMemo === void 0 ? void 0 : _settings$textureMemo.criticalThreshold) || 124e6,
              targetThresholdLevel: ((_settings$textureMemo2 = settings.textureMemory) === null || _settings$textureMemo2 === void 0 ? void 0 : _settings$textureMemo2.targetThresholdLevel) || 0.5,
              cleanupInterval: ((_settings$textureMemo3 = settings.textureMemory) === null || _settings$textureMemo3 === void 0 ? void 0 : _settings$textureMemo3.cleanupInterval) || 5000,
              debugLogging: ((_settings$textureMemo4 = settings.textureMemory) === null || _settings$textureMemo4 === void 0 ? void 0 : _settings$textureMemo4.debugLogging) || false,
              baselineMemoryAllocation: ((_settings$textureMemo5 = settings.textureMemory) === null || _settings$textureMemo5 === void 0 ? void 0 : _settings$textureMemo5.baselineMemoryAllocation) || 26e6,
              doNotExceedCriticalThreshold: ((_settings$textureMemo6 = settings.textureMemory) === null || _settings$textureMemo6 === void 0 ? void 0 : _settings$textureMemo6.doNotExceedCriticalThreshold) || false
            };
            var resolvedSettings = {
              appWidth: settings.appWidth || 1920,
              appHeight: settings.appHeight || 1080,
              textureMemory: resolvedTxSettings,
              boundsMargin: settings.boundsMargin || 0,
              deviceLogicalPixelRatio: settings.deviceLogicalPixelRatio || 1,
              devicePhysicalPixelRatio: settings.devicePhysicalPixelRatio || window.devicePixelRatio,
              clearColor: (_settings$clearColor = settings.clearColor) !== null && _settings$clearColor !== void 0 ? _settings$clearColor : 0x00000000,
              fpsUpdateInterval: settings.fpsUpdateInterval || 0,
              targetFPS: settings.targetFPS || 0,
              numImageWorkers: settings.numImageWorkers !== undefined ? settings.numImageWorkers : 2,
              enableContextSpy: (_settings$enableConte = settings.enableContextSpy) !== null && _settings$enableConte !== void 0 ? _settings$enableConte : false,
              forceWebGL2: (_settings$forceWebGL = settings.forceWebGL2) !== null && _settings$forceWebGL !== void 0 ? _settings$forceWebGL : false,
              inspector: (_settings$inspector = settings.inspector) !== null && _settings$inspector !== void 0 ? _settings$inspector : false,
              renderEngine: settings.renderEngine,
              quadBufferSize: (_settings$quadBufferS = settings.quadBufferSize) !== null && _settings$quadBufferS !== void 0 ? _settings$quadBufferS : 4 * 1024 * 1024,
              fontEngines: settings.fontEngines,
              strictBounds: (_settings$strictBound = settings.strictBounds) !== null && _settings$strictBound !== void 0 ? _settings$strictBound : true,
              textureProcessingTimeLimit: settings.textureProcessingTimeLimit || 42,
              canvas: settings.canvas || document.createElement('canvas'),
              createImageBitmapSupport: settings.createImageBitmapSupport || 'full',
              maxRetryCount: (_settings$maxRetryCou = settings.maxRetryCount) !== null && _settings$maxRetryCou !== void 0 ? _settings$maxRetryCou : 5
            };
            _this45.settings = resolvedSettings;
            var appWidth = resolvedSettings.appWidth,
              appHeight = resolvedSettings.appHeight,
              deviceLogicalPixelRatio = resolvedSettings.deviceLogicalPixelRatio,
              devicePhysicalPixelRatio = resolvedSettings.devicePhysicalPixelRatio,
              inspector = resolvedSettings.inspector,
              canvas = resolvedSettings.canvas;
            var deviceLogicalWidth = appWidth * deviceLogicalPixelRatio;
            var deviceLogicalHeight = appHeight * deviceLogicalPixelRatio;
            _this45.canvas = canvas;
            canvas.width = deviceLogicalWidth * devicePhysicalPixelRatio;
            canvas.height = deviceLogicalHeight * devicePhysicalPixelRatio;
            canvas.style.width = "".concat(deviceLogicalWidth, "px");
            canvas.style.height = "".concat(deviceLogicalHeight, "px");
            // Initialize the stage
            _this45.stage = new Stage({
              appWidth: _this45.settings.appWidth,
              appHeight: _this45.settings.appHeight,
              boundsMargin: _this45.settings.boundsMargin,
              clearColor: _this45.settings.clearColor,
              canvas: _this45.canvas,
              deviceLogicalPixelRatio: _this45.settings.deviceLogicalPixelRatio,
              devicePhysicalPixelRatio: _this45.settings.devicePhysicalPixelRatio,
              enableContextSpy: _this45.settings.enableContextSpy,
              forceWebGL2: _this45.settings.forceWebGL2,
              fpsUpdateInterval: _this45.settings.fpsUpdateInterval,
              targetFPS: _this45.settings.targetFPS,
              numImageWorkers: _this45.settings.numImageWorkers,
              renderEngine: _this45.settings.renderEngine,
              textureMemory: resolvedTxSettings,
              eventBus: _this45,
              quadBufferSize: _this45.settings.quadBufferSize,
              fontEngines: _this45.settings.fontEngines,
              inspector: _this45.settings.inspector !== null,
              strictBounds: _this45.settings.strictBounds,
              textureProcessingTimeLimit: _this45.settings.textureProcessingTimeLimit,
              createImageBitmapSupport: _this45.settings.createImageBitmapSupport,
              maxRetryCount: _this45.settings.maxRetryCount
            });
            // Extract the root node
            _this45.root = _this45.stage.root;
            // Get the target element and attach the canvas to it
            var targetEl;
            if (typeof target === 'string') {
              targetEl = document.getElementById(target);
            } else {
              targetEl = target;
            }
            if (!targetEl) {
              throw new Error('Could not find target element');
            }
            targetEl.appendChild(canvas);
            // Initialize inspector (if enabled)
            if (inspector && !isProductionEnvironment()) {
              _this45.inspector = new inspector(canvas, resolvedSettings);
            }
            return _this45;
          }
          /**
           * Create a new scene graph node
           *
           * @remarks
           * A node is the main graphical building block of the Renderer scene graph. It
           * can be a container for other nodes, or it can be a leaf node that renders a
           * solid color, gradient, image, or specific texture, using a specific shader.
           *
           * To create a text node, see {@link createTextNode}.
           *
           * See {@link CoreNode} for more details.
           *
           * @param props
           * @returns
           */
          _inherits(RendererMain, _EventEmitter7);
          return _createClass(RendererMain, [{
            key: "createNode",
            value: function createNode(props) {
              var node = this.stage.createNode(props);
              if (this.inspector) {
                return this.inspector.createNode(node);
              }
              // FIXME onDestroy event? node.once('beforeDestroy'
              // FIXME onCreate event?
              return node;
            }
            /**
             * Create a new scene graph text node
             *
             * @remarks
             * A text node is the second graphical building block of the Renderer scene
             * graph. It renders text using a specific text renderer that is automatically
             * chosen based on the font requested and what type of fonts are installed
             * into an app.
             *
             * See {@link ITextNode} for more details.
             *
             * @param props
             * @returns
             */
          }, {
            key: "createTextNode",
            value: function createTextNode(props) {
              var textNode = this.stage.createTextNode(props);
              if (this.inspector) {
                return this.inspector.createTextNode(textNode);
              }
              return textNode;
            }
            /**
             * Destroy a node
             *
             * @remarks
             * This method destroys a node
             *
             * @param node
             * @returns
             */
          }, {
            key: "destroyNode",
            value: function destroyNode(node) {
              if (this.inspector) {
                this.inspector.destroyNode(node.id);
              }
              return node.destroy();
            }
            /**
             * Create a new texture reference
             *
             * @remarks
             * This method creates a new reference to a texture. The texture is not
             * loaded until it is used on a node.
             *
             * It can be assigned to a node's `texture` property, or it can be used
             * when creating a SubTexture.
             *
             * @param textureType
             * @param props
             * @param options
             * @returns
             */
          }, {
            key: "createTexture",
            value: function createTexture(textureType, props) {
              return this.stage.txManager.createTexture(textureType, props);
            }
            /**
             * Create a new shader controller for a shader type
             *
             * @remarks
             * This method creates a new Shader Controller for a specific shader type.
             *
             * If the shader has not been loaded yet, it will be loaded. Otherwise, the
             * existing shader will be reused.
             *
             * It can be assigned to a Node's `shader` property.
             *
             * @param shaderType
             * @param props
             * @returns
             */
          }, {
            key: "createShader",
            value: function createShader(shaderType, props) {
              return this.stage.shManager.loadShader(shaderType, props);
            }
            /**
             * Create a new Dynamic Shader controller
             *
             * @remarks
             * A Dynamic Shader is a shader that can be composed of an array of mulitple
             * effects. Each effect can be animated or changed after creation (provided
             * the effect is given a name).
             *
             * Example:
             * ```ts
             * renderer.createNode({
             *   shader: renderer.createDynamicShader([
             *     renderer.createEffect('radius', {
             *       radius: 0
             *     }, 'effect1'),
             *     renderer.createEffect('border', {
             *       color: 0xff00ffff,
             *       width: 10,
             *     }, 'effect2'),
             *   ]),
             * });
             * ```
             *
             * @param effects
             * @returns
             */
          }, {
            key: "createDynamicShader",
            value: function createDynamicShader(effects) {
              return this.stage.shManager.loadDynamicShader({
                effects: effects
              });
            }
            /**
             * Create an effect to be used in a Dynamic Shader
             *
             * @remark
             * The {name} parameter is optional but required if you want to animate the effect
             * or change the effect's properties after creation.
             *
             * See {@link createDynamicShader} for an example.
             *
             * @param type
             * @param props
             * @param name
             * @returns
             */
          }, {
            key: "createEffect",
            value: function createEffect(type, props, name) {
              return {
                name: name,
                type: type,
                props: props
              };
            }
            /**
             * Get a Node by its ID
             *
             * @param id
             * @returns
             */
          }, {
            key: "getNodeById",
            value: function getNodeById(id) {
              var _this$stage;
              var root = (_this$stage = this.stage) === null || _this$stage === void 0 ? void 0 : _this$stage.root;
              if (!root) {
                return null;
              }
              var _findNode = function findNode(node) {
                if (node.id === id) {
                  return node;
                }
                var _iterator11 = _createForOfIteratorHelper(node.children),
                  _step11;
                try {
                  for (_iterator11.s(); !(_step11 = _iterator11.n()).done;) {
                    var child = _step11.value;
                    var found = _findNode(child);
                    if (found) {
                      return found;
                    }
                  }
                } catch (err) {
                  _iterator11.e(err);
                } finally {
                  _iterator11.f();
                }
                return null;
              };
              return _findNode(root);
            }
          }, {
            key: "toggleFreeze",
            value: function toggleFreeze() {
              throw new Error('Not implemented');
            }
          }, {
            key: "advanceFrame",
            value: function advanceFrame() {
              throw new Error('Not implemented');
            }
          }, {
            key: "getBufferInfo",
            value: function getBufferInfo() {
              return this.stage.renderer.getBufferInfo();
            }
            /**
             * Re-render the current frame without advancing any running animations.
             *
             * @remarks
             * Any state changes will be reflected in the re-rendered frame. Useful for
             * debugging.
             *
             * May not do anything if the render loop is running on a separate worker.
             */
          }, {
            key: "rerender",
            value: function rerender() {
              this.stage.requestRender();
            }
            /**
             * Cleanup textures that are not being used
             *
             * @remarks
             * This can be used to free up GFX memory used by textures that are no longer
             * being displayed.
             *
             * This routine is also called automatically when the memory used by textures
             * exceeds the critical threshold on frame generation **OR** when the renderer
             * is idle and the memory used by textures exceeds the target threshold.
             *
             * **NOTE**: This is a heavy operation and should be used sparingly.
             * **NOTE2**: This will not cleanup textures that are currently being displayed.
             * **NOTE3**: This will not cleanup textures that are marked as `preventCleanup`.
             * **NOTE4**: This has nothing to do with the garbage collection of JavaScript.
             */
          }, {
            key: "cleanup",
            value: function cleanup() {
              this.stage.cleanup();
            }
            /**
             * Sets the clear color for the stage.
             *
             * @param color - The color to set as the clear color.
             */
          }, {
            key: "setClearColor",
            value: function setClearColor(color) {
              this.stage.setClearColor(color);
            }
            /**
             * Gets the target FPS for the global render loop
             *
             * @returns The current target FPS (0 means no throttling)
             *
             * @remarks
             * This controls the maximum frame rate of the entire rendering system.
             * When 0, the system runs at display refresh rate.
             */
          }, {
            key: "targetFPS",
            get: function get() {
              return this.stage.options.targetFPS;
            }
            /**
             * Sets the target FPS for the global render loop
             *
             * @param fps - The target FPS to set for the global render loop.
             *              Set to 0 or a negative value to disable throttling.
             *
             * @remarks
             * This setting affects the entire rendering system immediately.
             * All animations, rendering, and frame updates will be throttled
             * to this target FPS. Provides global performance control.
             *
             * @example
             * ```typescript
             * // Set global target to 30fps for better performance
             * renderer.targetFPS = 30;
             *
             * // Disable global throttling (use display refresh rate)
             * renderer.targetFPS = 0;
             * ```
             */,
            set: function set(fps) {
              this.stage.options.targetFPS = fps > 0 ? fps : 0;
              this.stage.updateTargetFrameTime();
            }
          }]);
        }(EventEmitter);
        /*
         * If not stated otherwise in this file or this component's LICENSE file the
         * following copyright and licenses apply:
         *
         * Copyright 2023 Comcast Cable Communications Management, LLC.
         *
         * Licensed under the Apache License, Version 2.0 (the License);
         * you may not use this file except in compliance with the License.
         * You may obtain a copy of the License at
         *
         * http://www.apache.org/licenses/LICENSE-2.0
         *
         * Unless required by applicable law or agreed to in writing, software
         * distributed under the License is distributed on an "AS IS" BASIS,
         * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
         * See the License for the specific language governing permissions and
         * limitations under the License.
         */
        var TrFontFace = /*#__PURE__*/function (_EventEmitter8) {
          function TrFontFace(options) {
            var _this46;
            _classCallCheck(this, TrFontFace);
            _this46 = _callSuper(this, TrFontFace);
            _defineProperty(_this46, "fontFamily", void 0);
            _defineProperty(_this46, "descriptors", void 0);
            _defineProperty(_this46, "loaded", false);
            _defineProperty(_this46, "metrics", null);
            var fontFamily = options.fontFamily,
              descriptors = options.descriptors,
              metrics = options.metrics;
            if (metrics) {
              // Normalize metrics to be in the range of 0 to 1
              _this46.metrics = {
                ascender: metrics.ascender / metrics.unitsPerEm,
                descender: metrics.descender / metrics.unitsPerEm,
                lineGap: metrics.lineGap / metrics.unitsPerEm
              };
            }
            _this46.fontFamily = fontFamily;
            _this46.descriptors = _objectSpread({
              style: 'normal',
              weight: 'normal',
              stretch: 'normal'
            }, descriptors);
            return _this46;
          }
          /**
           * Convert a TrFontFaceDescriptors to a FontFaceDescriptors which differ slightly
           *
           * @param descriptors
           * @returns
           */
          _inherits(TrFontFace, _EventEmitter8);
          return _createClass(TrFontFace, null, [{
            key: "convertToCssFontFaceDescriptors",
            value: function convertToCssFontFaceDescriptors(descriptors) {
              return {
                style: descriptors.style,
                weight: typeof descriptors.weight === 'number' ? "".concat(descriptors.weight) : descriptors.weight,
                stretch: descriptors.stretch,
                unicodeRange: descriptors.unicodeRange,
                featureSettings: descriptors.featureSettings,
                display: descriptors.display
              };
            }
          }]);
        }(EventEmitter);
        /*
         * If not stated otherwise in this file or this component's LICENSE file the
         * following copyright and licenses apply:
         *
         * Copyright 2023 Comcast Cable Communications Management, LLC.
         *
         * Licensed under the Apache License, Version 2.0 (the License);
         * you may not use this file except in compliance with the License.
         * You may obtain a copy of the License at
         *
         * http://www.apache.org/licenses/LICENSE-2.0
         *
         * Unless required by applicable law or agreed to in writing, software
         * distributed under the License is distributed on an "AS IS" BASIS,
         * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
         * See the License for the specific language governing permissions and
         * limitations under the License.
         */
        var WebTrFontFace = /*#__PURE__*/function (_TrFontFace2) {
          function WebTrFontFace(options) {
            var _this47;
            _classCallCheck(this, WebTrFontFace);
            _this47 = _callSuper(this, WebTrFontFace, [options]);
            _defineProperty(_this47, "fontFace", void 0);
            _defineProperty(_this47, "fontUrl", void 0);
            var fontFamily = options.fontFamily,
              fontUrl = options.fontUrl;
            // Filter out parentheses from fontUrl
            var fontUrlWithoutParentheses = fontUrl.replace(/\(|\)/g, '');
            // Defaults for descriptors resolved in the super constructor
            var determinedDescriptors = _this47.descriptors;
            // Convert TrFontFaceDescriptors to CSS FontFaceDescriptors
            var cssDescriptors = {
              style: determinedDescriptors.style,
              weight: typeof determinedDescriptors.weight === 'number' ? "".concat(determinedDescriptors.weight) : determinedDescriptors.weight,
              stretch: determinedDescriptors.stretch,
              unicodeRange: determinedDescriptors.unicodeRange,
              featureSettings: determinedDescriptors.featureSettings,
              display: determinedDescriptors.display
            };
            for (var k in cssDescriptors) {
              var key = k;
              if (cssDescriptors[key] === undefined) {
                delete cssDescriptors[key];
              }
            }
            var fontFace = new FontFace(fontFamily, "url(".concat(fontUrlWithoutParentheses, ")"), cssDescriptors);
            if (fontUrlWithoutParentheses.length > 0) {
              fontFace.load().then(function () {
                _this47.loaded = true;
                _this47.emit('loaded');
              }).catch(console.error);
            } else {
              // Default font
              _this47.loaded = true;
              _this47.emit('loaded');
            }
            _this47.fontFace = fontFace;
            _this47.fontUrl = fontUrl;
            return _this47;
          }
          _inherits(WebTrFontFace, _TrFontFace2);
          return _createClass(WebTrFontFace);
        }(TrFontFace);
        /*
         * If not stated otherwise in this file or this component's LICENSE file the
         * following copyright and licenses apply:
         *
         * Copyright 2023 Comcast Cable Communications Management, LLC.
         *
         * Licensed under the Apache License, Version 2.0 (the License);
         * you may not use this file except in compliance with the License.
         * You may obtain a copy of the License at
         *
         * http://www.apache.org/licenses/LICENSE-2.0
         *
         * Unless required by applicable law or agreed to in writing, software
         * distributed under the License is distributed on an "AS IS" BASIS,
         * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
         * See the License for the specific language governing permissions and
         * limitations under the License.
         */
        var CoreRenderOp = /*#__PURE__*/_createClass(function CoreRenderOp() {
          _classCallCheck(this, CoreRenderOp);
        });
        /*
         * If not stated otherwise in this file or this component's LICENSE file the
         * following copyright and licenses apply:
         *
         * Copyright 2023 Comcast Cable Communications Management, LLC.
         *
         * Licensed under the Apache License, Version 2.0 (the License);
         * you may not use this file except in compliance with the License.
         * You may obtain a copy of the License at
         *
         * http://www.apache.org/licenses/LICENSE-2.0
         *
         * Unless required by applicable law or agreed to in writing, software
         * distributed under the License is distributed on an "AS IS" BASIS,
         * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
         * See the License for the specific language governing permissions and
         * limitations under the License.
         */
        /**
         * Can render multiple quads with multiple textures (up to vertex shader texture limit)
         *
         */
        var WebGlCoreRenderOp = /*#__PURE__*/function (_CoreRenderOp) {
          function WebGlCoreRenderOp(glw, options, buffers, shader, shaderProps, alpha, clippingRect, dimensions, bufferIdx, zIndex, renderToTexture, parentHasRenderTexture, framebufferDimensions) {
            var _this48;
            _classCallCheck(this, WebGlCoreRenderOp);
            _this48 = _callSuper(this, WebGlCoreRenderOp);
            _defineProperty(_this48, "glw", void 0);
            _defineProperty(_this48, "options", void 0);
            _defineProperty(_this48, "buffers", void 0);
            _defineProperty(_this48, "shader", void 0);
            _defineProperty(_this48, "shaderProps", void 0);
            _defineProperty(_this48, "alpha", void 0);
            _defineProperty(_this48, "clippingRect", void 0);
            _defineProperty(_this48, "dimensions", void 0);
            _defineProperty(_this48, "bufferIdx", void 0);
            _defineProperty(_this48, "zIndex", void 0);
            _defineProperty(_this48, "renderToTexture", void 0);
            _defineProperty(_this48, "parentHasRenderTexture", void 0);
            _defineProperty(_this48, "framebufferDimensions", void 0);
            _defineProperty(_this48, "length", 0);
            _defineProperty(_this48, "numQuads", 0);
            _defineProperty(_this48, "textures", []);
            _defineProperty(_this48, "maxTextures", void 0);
            _this48.glw = glw;
            _this48.options = options;
            _this48.buffers = buffers;
            _this48.shader = shader;
            _this48.shaderProps = shaderProps;
            _this48.alpha = alpha;
            _this48.clippingRect = clippingRect;
            _this48.dimensions = dimensions;
            _this48.bufferIdx = bufferIdx;
            _this48.zIndex = zIndex;
            _this48.renderToTexture = renderToTexture;
            _this48.parentHasRenderTexture = parentHasRenderTexture;
            _this48.framebufferDimensions = framebufferDimensions;
            _this48.maxTextures = shader.supportsIndexedTextures ? glw.getParameter(glw.MAX_VERTEX_TEXTURE_IMAGE_UNITS) : 1;
            return _this48;
          }
          _inherits(WebGlCoreRenderOp, _CoreRenderOp);
          return _createClass(WebGlCoreRenderOp, [{
            key: "addTexture",
            value: function addTexture(texture) {
              var textures = this.textures,
                maxTextures = this.maxTextures;
              var existingIdx = -1;
              var texturesLength = textures.length;
              for (var i = 0; i < texturesLength; i++) {
                var t = textures[i];
                if (t === texture) {
                  existingIdx = i;
                  break;
                }
              }
              if (existingIdx !== -1) {
                return existingIdx;
              }
              if (texturesLength >= maxTextures) {
                return 0xffffffff;
              }
              this.textures.push(texture);
              return texturesLength;
            }
          }, {
            key: "draw",
            value: function draw() {
              var glw = this.glw,
                shader = this.shader,
                shaderProps = this.shaderProps,
                options = this.options;
              var shManager = options.shManager;
              shManager.useShader(shader);
              shader.bindRenderOp(this, shaderProps);
              // TODO: Reduce calculations required
              var quadIdx = this.bufferIdx / 24 * 6 * 2;
              // Clipping
              if (this.clippingRect.valid) {
                var _this$clippingRect = this.clippingRect,
                  x = _this$clippingRect.x,
                  y = _this$clippingRect.y,
                  width = _this$clippingRect.width,
                  height = _this$clippingRect.height;
                var pixelRatio = this.parentHasRenderTexture ? 1 : options.pixelRatio;
                var canvasHeight = options.canvas.height;
                var clipX = Math.round(x * pixelRatio);
                var clipWidth = Math.round(width * pixelRatio);
                var clipHeight = Math.round(height * pixelRatio);
                var clipY = Math.round(canvasHeight - clipHeight - y * pixelRatio);
                // if parent has render texture, we need to adjust the scissor rect
                // to be relative to the parent's framebuffer
                if (this.parentHasRenderTexture) {
                  clipY = this.framebufferDimensions ? this.framebufferDimensions.height - this.dimensions.height : 0;
                }
                glw.setScissorTest(true);
                glw.scissor(clipX, clipY, clipWidth, clipHeight);
              } else {
                glw.setScissorTest(false);
              }
              glw.drawElements(glw.TRIANGLES, 6 * this.numQuads, glw.UNSIGNED_SHORT, quadIdx);
            }
          }]);
        }(CoreRenderOp);
        /*
         * If not stated otherwise in this file or this component's LICENSE file the
         * following copyright and licenses apply:
         *
         * Copyright 2023 Comcast Cable Communications Management, LLC.
         *
         * Licensed under the Apache License, Version 2.0 (the License);
         * you may not use this file except in compliance with the License.
         * You may obtain a copy of the License at
         *
         * http://www.apache.org/licenses/LICENSE-2.0
         *
         * Unless required by applicable law or agreed to in writing, software
         * distributed under the License is distributed on an "AS IS" BASIS,
         * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
         * See the License for the specific language governing permissions and
         * limitations under the License.
         */
        /**
         * Get device specific webgl parameters
         * @param glw
         */
        function getWebGlParameters(glw) {
          var params = {
            MAX_RENDERBUFFER_SIZE: 0,
            MAX_TEXTURE_SIZE: 0,
            // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment, @typescript-eslint/no-explicit-any
            MAX_VIEWPORT_DIMS: 0,
            // Code below will replace this with an Int32Array
            MAX_VERTEX_TEXTURE_IMAGE_UNITS: 0,
            MAX_TEXTURE_IMAGE_UNITS: 0,
            MAX_COMBINED_TEXTURE_IMAGE_UNITS: 0,
            MAX_VERTEX_ATTRIBS: 0,
            MAX_VARYING_VECTORS: 0,
            MAX_VERTEX_UNIFORM_VECTORS: 0,
            MAX_FRAGMENT_UNIFORM_VECTORS: 0
          };
          // Map over all parameters and get them
          var keys = Object.keys(params);
          keys.forEach(function (key) {
            // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment
            params[key] = glw.getParameter(glw[key]);
          });
          return params;
        }
        /**
         * Get device webgl extensions
         * @param glw
         */
        function getWebGlExtensions(glw) {
          var extensions = {
            ANGLE_instanced_arrays: null,
            WEBGL_compressed_texture_s3tc: null,
            WEBGL_compressed_texture_astc: null,
            WEBGL_compressed_texture_etc: null,
            WEBGL_compressed_texture_etc1: null,
            WEBGL_compressed_texture_pvrtc: null,
            WEBKIT_WEBGL_compressed_texture_pvrtc: null,
            WEBGL_compressed_texture_s3tc_srgb: null,
            OES_vertex_array_object: null
          };
          // Map over all extensions and get them
          var keys = Object.keys(extensions);
          keys.forEach(function (key) {
            // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment
            extensions[key] = glw.getExtension(key);
          });
          return extensions;
        }
        /**
         * Allocate big memory chunk that we
         * can re-use to draw quads
         *
         * @param glw
         * @param size
         */
        function createIndexBuffer(glw, size) {
          var maxQuads = ~~(size / 80);
          var indices = new Uint16Array(maxQuads * 6);
          for (var i = 0, j = 0; i < maxQuads; i += 6, j += 4) {
            indices[i] = j;
            indices[i + 1] = j + 1;
            indices[i + 2] = j + 2;
            indices[i + 3] = j + 2;
            indices[i + 4] = j + 1;
            indices[i + 5] = j + 3;
          }
          var buffer = glw.createBuffer();
          glw.elementArrayBufferData(buffer, indices, glw.STATIC_DRAW);
        }
        /**
         * Checks if an object is of type HTMLImageElement.
         * This is used because we cant check for HTMLImageElement directly when the
         * renderer is running in a seperate web worker context.
         *
         * @param obj
         * @returns
         */
        function isHTMLImageElement(obj) {
          return obj !== null && (_typeof(obj) === 'object' && obj.constructor && obj.constructor.name === 'HTMLImageElement' || typeof HTMLImageElement !== 'undefined' && obj instanceof HTMLImageElement);
        }

        /*
         * If not stated otherwise in this file or this component's LICENSE file the
         * following copyright and licenses apply:
         *
         * Copyright 2023 Comcast Cable Communications Management, LLC.
         *
         * Licensed under the Apache License, Version 2.0 (the License);
         * you may not use this file except in compliance with the License.
         * You may obtain a copy of the License at
         *
         * http://www.apache.org/licenses/LICENSE-2.0
         *
         * Unless required by applicable law or agreed to in writing, software
         * distributed under the License is distributed on an "AS IS" BASIS,
         * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
         * See the License for the specific language governing permissions and
         * limitations under the License.
         */
        var TRANSPARENT_TEXTURE_DATA = new Uint8Array([0, 0, 0, 0]);
        /**
         * A wrapper around a WebGLTexture that handles loading the texture data
         * from a Texture source and uploading it to the GPU as well as freeing
         * the uploaded texture.
         *
         * @remarks
         * When accessing the ctxTexture property, the texture will be loaded if
         * it hasn't been already. ctxTexture will always return a valid WebGLTexture
         * and trigger the loading/uploading of the texture's data if it hasn't been
         * loaded yet.
         */
        var WebGlCoreCtxTexture = /*#__PURE__*/function (_CoreContextTexture2) {
          function WebGlCoreCtxTexture(glw, memManager, textureSource) {
            var _this49;
            _classCallCheck(this, WebGlCoreCtxTexture);
            _this49 = _callSuper(this, WebGlCoreCtxTexture, [memManager, textureSource]);
            _defineProperty(_this49, "glw", void 0);
            _defineProperty(_this49, "_nativeCtxTexture", null);
            _defineProperty(_this49, "_w", 0);
            _defineProperty(_this49, "_h", 0);
            _this49.glw = glw;
            return _this49;
          }
          /**
           * GL error check with direct state marking
           * Uses cached error result to minimize function calls
           */
          _inherits(WebGlCoreCtxTexture, _CoreContextTexture2);
          return _createClass(WebGlCoreCtxTexture, [{
            key: "checkGLError",
            value: function checkGLError() {
              // Skip if already failed to prevent double-processing
              if (this.state === 'failed') {
                return true;
              }
              var error = this.glw.getError();
              if (error !== 0) {
                this.state = 'failed';
                this.textureSource.setState('failed', new Error("WebGL Error: ".concat(error)));
                return true;
              }
              return false;
            }
          }, {
            key: "ctxTexture",
            get: function get() {
              if (this.state === 'freed') {
                this.load();
                return null;
              }
              assertTruthy(this._nativeCtxTexture);
              return this._nativeCtxTexture;
            }
          }, {
            key: "w",
            get: function get() {
              return this._w;
            }
          }, {
            key: "h",
            get: function get() {
              return this._h;
            }
            /**
             * Load the texture data from the Texture source and upload it to the GPU
             *
             * @remarks
             * This method is called automatically when accessing the ctxTexture property
             * if the texture hasn't been loaded yet. But it can also be called manually
             * to force the texture to be pre-loaded prior to accessing the ctxTexture
             * property.
             */
          }, {
            key: "load",
            value: (function () {
              var _load = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee14() {
                var _yield$this$onLoadReq, width, height, _t10;
                return _regenerator().w(function (_context14) {
                  while (1) switch (_context14.p = _context14.n) {
                    case 0:
                      if (!(this.state === 'loading' || this.state === 'loaded')) {
                        _context14.n = 1;
                        break;
                      }
                      return _context14.a(2, Promise.resolve());
                    case 1:
                      this.state = 'loading';
                      this.textureSource.setState('loading');
                      // Await the native texture creation to ensure GPU buffer is fully allocated
                      this._nativeCtxTexture = this.createNativeCtxTexture();
                      if (!(this._nativeCtxTexture === null)) {
                        _context14.n = 2;
                        break;
                      }
                      this.state = 'failed';
                      this.textureSource.setState('failed', new Error('WebGL Texture creation failed'));
                      return _context14.a(2);
                    case 2:
                      _context14.p = 2;
                      _context14.n = 3;
                      return this.onLoadRequest();
                    case 3:
                      _yield$this$onLoadReq = _context14.v;
                      width = _yield$this$onLoadReq.width;
                      height = _yield$this$onLoadReq.height;
                      if (!(this.state === 'freed')) {
                        _context14.n = 4;
                        break;
                      }
                      return _context14.a(2);
                    case 4:
                      this.state = 'loaded';
                      this._w = width;
                      this._h = height;
                      // Update the texture source's width and height so that it can be used
                      // for rendering.
                      this.textureSource.setState('loaded', {
                        width: width,
                        height: height
                      });
                      this.textureSource.freeTextureData();
                      _context14.n = 7;
                      break;
                    case 5:
                      _context14.p = 5;
                      _t10 = _context14.v;
                      if (!(this.state === 'freed')) {
                        _context14.n = 6;
                        break;
                      }
                      return _context14.a(2);
                    case 6:
                      // Ensure texture is marked as failed
                      this.state = 'failed';
                      this.textureSource.setState('failed');
                    case 7:
                      return _context14.a(2);
                  }
                }, _callee14, this, [[2, 5]]);
              }));
              function load() {
                return _load.apply(this, arguments);
              }
              return load;
            }()
            /**
             * Called when the texture data needs to be loaded and uploaded to a texture
             */
            )
          }, {
            key: "onLoadRequest",
            value: (function () {
              var _onLoadRequest = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee15() {
                var glw, textureData, width, height, tdata, format, formatBytes, memoryPadding, _mipmaps$, mipmaps, _tdata$width, _width, _tdata$height, _height, type, glInternalFormat, view;
                return _regenerator().w(function (_context15) {
                  while (1) switch (_context15.n) {
                    case 0:
                      glw = this.glw;
                      textureData = this.textureSource.textureData; // Early return if texture is already failed
                      if (!(this.state === 'failed')) {
                        _context15.n = 1;
                        break;
                      }
                      return _context15.a(2, {
                        width: 0,
                        height: 0
                      });
                    case 1:
                      if (!(textureData === null || this._nativeCtxTexture === null)) {
                        _context15.n = 2;
                        break;
                      }
                      this.state = 'failed';
                      this.textureSource.setState('failed', new Error('No texture data available'));
                      return _context15.a(2, {
                        width: 0,
                        height: 0
                      });
                    case 2:
                      // Set to a 1x1 transparent texture
                      glw.texImage2D(0, glw.RGBA, 1, 1, 0, glw.RGBA, glw.UNSIGNED_BYTE, null);
                      this.setTextureMemUse(TRANSPARENT_TEXTURE_DATA.byteLength);
                      width = 0;
                      height = 0;
                      glw.activeTexture(0);
                      // High-performance error check - single call, direct state marking
                      if (!(this.checkGLError() === true)) {
                        _context15.n = 3;
                        break;
                      }
                      return _context15.a(2, {
                        width: 0,
                        height: 0
                      });
                    case 3:
                      tdata = textureData.data;
                      format = glw.RGBA;
                      formatBytes = 4;
                      memoryPadding = 1.1; // Add padding to account for GPU Padding
                      // If textureData is null, the texture is empty (0, 0) and we don't need to
                      // upload any data to the GPU.
                      if (!(typeof ImageBitmap !== 'undefined' && tdata instanceof ImageBitmap || tdata instanceof ImageData ||
                      // not using typeof HTMLImageElement due to web worker
                      isHTMLImageElement(tdata))) {
                        _context15.n = 5;
                        break;
                      }
                      width = tdata.width;
                      height = tdata.height;
                      glw.bindTexture(this._nativeCtxTexture);
                      glw.pixelStorei(glw.UNPACK_PREMULTIPLY_ALPHA_WEBGL, !!textureData.premultiplyAlpha);
                      glw.texImage2D(0, format, format, glw.UNSIGNED_BYTE, tdata);
                      // Check for errors after image upload operations
                      if (!(this.checkGLError() === true)) {
                        _context15.n = 4;
                        break;
                      }
                      return _context15.a(2, {
                        width: 0,
                        height: 0
                      });
                    case 4:
                      this.setTextureMemUse(height * width * formatBytes * memoryPadding);
                      _context15.n = 10;
                      break;
                    case 5:
                      if (!(tdata && 'mipmaps' in tdata && tdata.mipmaps)) {
                        _context15.n = 7;
                        break;
                      }
                      mipmaps = tdata.mipmaps, _tdata$width = tdata.width, _width = _tdata$width === void 0 ? 0 : _tdata$width, _tdata$height = tdata.height, _height = _tdata$height === void 0 ? 0 : _tdata$height, type = tdata.type, glInternalFormat = tdata.glInternalFormat;
                      view = type === 'ktx' ? new DataView((_mipmaps$ = mipmaps[0]) !== null && _mipmaps$ !== void 0 ? _mipmaps$ : new ArrayBuffer(0)) : mipmaps[0];
                      glw.bindTexture(this._nativeCtxTexture);
                      glw.compressedTexImage2D(0, glInternalFormat, _width, _height, 0, view);
                      glw.texParameteri(glw.TEXTURE_WRAP_S, glw.CLAMP_TO_EDGE);
                      glw.texParameteri(glw.TEXTURE_WRAP_T, glw.CLAMP_TO_EDGE);
                      glw.texParameteri(glw.TEXTURE_MAG_FILTER, glw.LINEAR);
                      glw.texParameteri(glw.TEXTURE_MIN_FILTER, glw.LINEAR);
                      // Check for errors after compressed texture operations
                      if (!(this.checkGLError() === true)) {
                        _context15.n = 6;
                        break;
                      }
                      return _context15.a(2, {
                        width: 0,
                        height: 0
                      });
                    case 6:
                      this.setTextureMemUse(view.byteLength);
                      _context15.n = 10;
                      break;
                    case 7:
                      if (!(tdata && tdata instanceof Uint8Array)) {
                        _context15.n = 9;
                        break;
                      }
                      // Color Texture
                      width = 1;
                      height = 1;
                      glw.bindTexture(this._nativeCtxTexture);
                      glw.pixelStorei(glw.UNPACK_PREMULTIPLY_ALPHA_WEBGL, !!textureData.premultiplyAlpha);
                      glw.texImage2D(0, format, width, height, 0, format, glw.UNSIGNED_BYTE, tdata);
                      // Check for errors after color texture operations
                      if (!(this.checkGLError() === true)) {
                        _context15.n = 8;
                        break;
                      }
                      return _context15.a(2, {
                        width: 0,
                        height: 0
                      });
                    case 8:
                      this.setTextureMemUse(width * height * formatBytes);
                      _context15.n = 10;
                      break;
                    case 9:
                      console.error("WebGlCoreCtxTexture.onLoadRequest: Unexpected textureData returned", textureData);
                      this.state = 'failed';
                      this.textureSource.setState('failed', new Error('Unexpected texture data'));
                      return _context15.a(2, {
                        width: 0,
                        height: 0
                      });
                    case 10:
                      return _context15.a(2, {
                        width: width,
                        height: height
                      });
                  }
                }, _callee15, this);
              }));
              function onLoadRequest() {
                return _onLoadRequest.apply(this, arguments);
              }
              return onLoadRequest;
            }()
            /**
             * Free the WebGLTexture from the GPU
             *
             * @returns
             */
            )
          }, {
            key: "free",
            value: function free() {
              if (this.state === 'freed') {
                return;
              }
              this.state = 'freed';
              this.textureSource.setState('freed');
              this.release();
            }
            /**
             * Release the WebGLTexture from the GPU without changing state
             */
          }, {
            key: "release",
            value: function release() {
              this._w = 0;
              this._h = 0;
              if (this._nativeCtxTexture !== null) {
                this.glw.deleteTexture(this._nativeCtxTexture);
                this.setTextureMemUse(0);
                this._nativeCtxTexture = null;
              }
              // if the texture still has source data, free it
              this.textureSource.freeTextureData();
            }
            /**
             * Create native context texture asynchronously
             *
             * @remarks
             * When this method resolves, the returned texture will be bound to the GL context state
             * and fully ready for use. This ensures proper GPU resource allocation timing.
             *
             * @returns Promise that resolves to the native WebGL texture or null on failure
             */
          }, {
            key: "createNativeCtxTexture",
            value: function createNativeCtxTexture() {
              var glw = this.glw;
              var nativeTexture = glw.createTexture();
              if (!nativeTexture) {
                return null;
              }
              // On initial load request, create a 1x1 transparent texture to use until
              // the texture data is finally loaded.
              glw.activeTexture(0);
              glw.bindTexture(nativeTexture);
              // linear texture filtering
              glw.texParameteri(glw.TEXTURE_MAG_FILTER, glw.LINEAR);
              glw.texParameteri(glw.TEXTURE_MIN_FILTER, glw.LINEAR);
              // texture wrapping method
              glw.texParameteri(glw.TEXTURE_WRAP_S, glw.CLAMP_TO_EDGE);
              glw.texParameteri(glw.TEXTURE_WRAP_T, glw.CLAMP_TO_EDGE);
              var error = glw.getError();
              if (error !== 0) {
                return null;
              }
              return nativeTexture;
            }
          }]);
        }(CoreContextTexture);
        /*
         * If not stated otherwise in this file or this component's LICENSE file the
         * following copyright and licenses apply:
         *
         * Copyright 2023 Comcast Cable Communications Management, LLC.
         *
         * Licensed under the Apache License, Version 2.0 (the License);
         * you may not use this file except in compliance with the License.
         * You may obtain a copy of the License at
         *
         * http://www.apache.org/licenses/LICENSE-2.0
         *
         * Unless required by applicable law or agreed to in writing, software
         * distributed under the License is distributed on an "AS IS" BASIS,
         * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
         * See the License for the specific language governing permissions and
         * limitations under the License.
         */
        var WebGlCoreCtxSubTexture = /*#__PURE__*/function (_WebGlCoreCtxTexture2) {
          function WebGlCoreCtxSubTexture(glw, memManager, textureSource) {
            _classCallCheck(this, WebGlCoreCtxSubTexture);
            return _callSuper(this, WebGlCoreCtxSubTexture, [glw, memManager, textureSource]);
          }
          _inherits(WebGlCoreCtxSubTexture, _WebGlCoreCtxTexture2);
          return _createClass(WebGlCoreCtxSubTexture, [{
            key: "onLoadRequest",
            value: function () {
              var _onLoadRequest2 = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee16() {
                var _props$data2, _props$data3;
                var props;
                return _regenerator().w(function (_context16) {
                  while (1) switch (_context16.n) {
                    case 0:
                      props = this.textureSource.textureData;
                      assertTruthy(props, 'SubTexture must have texture data');
                      if (!(props.data instanceof Uint8Array)) {
                        _context16.n = 1;
                        break;
                      }
                      return _context16.a(2, {
                        width: 1,
                        height: 1
                      });
                    case 1:
                      return _context16.a(2, {
                        width: ((_props$data2 = props.data) === null || _props$data2 === void 0 ? void 0 : _props$data2.width) || 0,
                        height: ((_props$data3 = props.data) === null || _props$data3 === void 0 ? void 0 : _props$data3.height) || 0
                      });
                  }
                }, _callee16, this);
              }));
              function onLoadRequest() {
                return _onLoadRequest2.apply(this, arguments);
              }
              return onLoadRequest;
            }()
          }]);
        }(WebGlCoreCtxTexture);
        /*
         * If not stated otherwise in this file or this component's LICENSE file the
         * following copyright and licenses apply:
         *
         * Copyright 2023 Comcast Cable Communications Management, LLC.
         *
         * Licensed under the Apache License, Version 2.0 (the License);
         * you may not use this file except in compliance with the License.
         * You may obtain a copy of the License at
         *
         * http://www.apache.org/licenses/LICENSE-2.0
         *
         * Unless required by applicable law or agreed to in writing, software
         * distributed under the License is distributed on an "AS IS" BASIS,
         * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
         * See the License for the specific language governing permissions and
         * limitations under the License.
         */
        /**
         * Represents a collection of WebGL Buffers along with their associated
         * vertex attribute formats.
         */
        var BufferCollection = /*#__PURE__*/function () {
          function BufferCollection(config) {
            _classCallCheck(this, BufferCollection);
            _defineProperty(this, "config", void 0);
            this.config = config;
          }
          /**
           * Get the WebGLBuffer associated with the given attribute name if it exists.
           *
           * @param attributeName
           * @returns
           */
          return _createClass(BufferCollection, [{
            key: "getBuffer",
            value: function getBuffer(attributeName) {
              var _this$config$find;
              return (_this$config$find = this.config.find(function (item) {
                return item.attributes[attributeName];
              })) === null || _this$config$find === void 0 ? void 0 : _this$config$find.buffer;
            }
            /**
             * Get the AttributeInfo associated with the given attribute name if it exists.
             *
             * @param attributeName
             * @returns
             */
          }, {
            key: "getAttributeInfo",
            value: function getAttributeInfo(attributeName) {
              var _this$config$find2;
              return (_this$config$find2 = this.config.find(function (item) {
                return item.attributes[attributeName];
              })) === null || _this$config$find2 === void 0 ? void 0 : _this$config$find2.attributes[attributeName];
            }
          }]);
        }();
        /*
         * If not stated otherwise in this file or this component's LICENSE file the
         * following copyright and licenses apply:
         *
         * Copyright 2023 Comcast Cable Communications Management, LLC.
         *
         * Licensed under the Apache License, Version 2.0 (the License);
         * you may not use this file except in compliance with the License.
         * You may obtain a copy of the License at
         *
         * http://www.apache.org/licenses/LICENSE-2.0
         *
         * Unless required by applicable law or agreed to in writing, software
         * distributed under the License is distributed on an "AS IS" BASIS,
         * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
         * See the License for the specific language governing permissions and
         * limitations under the License.
         */
        /**
         * Generic WebGL Utility Functions
         *
         * @remarks
         * Nothing here should be coupled to Renderer logic / types.
         *
         * @param gl
         * @returns
         */
        function _isWebGl(gl) {
          return self.WebGL2RenderingContext && gl instanceof self.WebGL2RenderingContext;
        }

        /* eslint-disable @typescript-eslint/no-unsafe-return */
        /* eslint-disable @typescript-eslint/no-explicit-any */
        /* eslint-disable @typescript-eslint/no-unsafe-argument */
        /**
         * Optimized WebGL Context Wrapper
         *
         * @remarks
         * This class contains the subset of the WebGLRenderingContext & WebGL2RenderingContext
         * API that is used by the renderer. Select high volume WebGL methods include
         * caching optimizations to avoid making WebGL calls if the state is already set
         * to the desired value.
         *
         * While most methods contained are direct passthroughs to the WebGL context,
         * some methods combine multiple WebGL calls into one for convenience, modify
         * arguments to be more convenient, or are replaced by more specific methods.
         *
         * Not all methods are optimized. Only methods that are called frequently
         * and/or have a high cost are optimized.
         *
         * A subset of GLenum constants are also exposed as properties on this class
         * for convenience.
         */
        var WebGlContextWrapper = /*#__PURE__*/function () {
          //#endregion WebGL Enums
          function WebGlContextWrapper(gl) {
            var _this50 = this;
            _classCallCheck(this, WebGlContextWrapper);
            _defineProperty(this, "gl", void 0);
            //#region Cached WebGL State
            _defineProperty(this, "activeTextureUnit", 0);
            _defineProperty(this, "texture2dUnits", void 0);
            _defineProperty(this, "texture2dParams", new WeakMap());
            _defineProperty(this, "scissorEnabled", void 0);
            _defineProperty(this, "scissorX", void 0);
            _defineProperty(this, "scissorY", void 0);
            _defineProperty(this, "scissorWidth", void 0);
            _defineProperty(this, "scissorHeight", void 0);
            _defineProperty(this, "blendEnabled", void 0);
            _defineProperty(this, "blendSrcRgb", void 0);
            _defineProperty(this, "blendDstRgb", void 0);
            _defineProperty(this, "blendSrcAlpha", void 0);
            _defineProperty(this, "blendDstAlpha", void 0);
            _defineProperty(this, "boundArrayBuffer", void 0);
            _defineProperty(this, "boundElementArrayBuffer", void 0);
            _defineProperty(this, "curProgram", void 0);
            //#endregion Cached WebGL State
            //#region Canvas
            _defineProperty(this, "canvas", void 0);
            //#endregion Canvas
            //#region WebGL Enums
            _defineProperty(this, "MAX_RENDERBUFFER_SIZE", void 0);
            _defineProperty(this, "MAX_TEXTURE_SIZE", void 0);
            _defineProperty(this, "MAX_VIEWPORT_DIMS", void 0);
            _defineProperty(this, "MAX_VERTEX_TEXTURE_IMAGE_UNITS", void 0);
            _defineProperty(this, "MAX_TEXTURE_IMAGE_UNITS", void 0);
            _defineProperty(this, "MAX_COMBINED_TEXTURE_IMAGE_UNITS", void 0);
            _defineProperty(this, "MAX_VERTEX_ATTRIBS", void 0);
            _defineProperty(this, "MAX_VARYING_VECTORS", void 0);
            _defineProperty(this, "MAX_VERTEX_UNIFORM_VECTORS", void 0);
            _defineProperty(this, "MAX_FRAGMENT_UNIFORM_VECTORS", void 0);
            _defineProperty(this, "TEXTURE_MAG_FILTER", void 0);
            _defineProperty(this, "TEXTURE_MIN_FILTER", void 0);
            _defineProperty(this, "TEXTURE_WRAP_S", void 0);
            _defineProperty(this, "TEXTURE_WRAP_T", void 0);
            _defineProperty(this, "LINEAR", void 0);
            _defineProperty(this, "CLAMP_TO_EDGE", void 0);
            _defineProperty(this, "RGB", void 0);
            _defineProperty(this, "RGBA", void 0);
            _defineProperty(this, "UNSIGNED_BYTE", void 0);
            _defineProperty(this, "UNPACK_PREMULTIPLY_ALPHA_WEBGL", void 0);
            _defineProperty(this, "UNPACK_FLIP_Y_WEBGL", void 0);
            _defineProperty(this, "FLOAT", void 0);
            _defineProperty(this, "TRIANGLES", void 0);
            _defineProperty(this, "UNSIGNED_SHORT", void 0);
            _defineProperty(this, "ONE", void 0);
            _defineProperty(this, "ONE_MINUS_SRC_ALPHA", void 0);
            _defineProperty(this, "VERTEX_SHADER", void 0);
            _defineProperty(this, "FRAGMENT_SHADER", void 0);
            _defineProperty(this, "STATIC_DRAW", void 0);
            _defineProperty(this, "COMPILE_STATUS", void 0);
            _defineProperty(this, "LINK_STATUS", void 0);
            _defineProperty(this, "DYNAMIC_DRAW", void 0);
            _defineProperty(this, "COLOR_ATTACHMENT0", void 0);
            _defineProperty(this, "INVALID_ENUM", void 0);
            _defineProperty(this, "INVALID_OPERATION", void 0);
            this.gl = gl;
            // The following code extracts the current state of the WebGL context
            // to our local JavaScript cached version of it. This is so we can
            // avoid making WebGL calls if we don't need to.
            // We could assume that the WebGL context is in a default state, but
            // in the future we may want to support restoring a broken WebGL context
            // and this will help with that.
            this.activeTextureUnit = gl.getParameter(gl.ACTIVE_TEXTURE) - gl.TEXTURE0;
            var maxTextureUnits = gl.getParameter(gl.MAX_TEXTURE_IMAGE_UNITS);
            // save current texture units
            this.texture2dUnits = new Array(maxTextureUnits).fill(undefined).map(function (_, i) {
              _this50.activeTexture(i);
              return gl.getParameter(gl.TEXTURE_BINDING_2D);
            });
            // restore active texture unit
            this.activeTexture(this.activeTextureUnit);
            this.scissorEnabled = gl.isEnabled(gl.SCISSOR_TEST);
            var scissorBox = gl.getParameter(gl.SCISSOR_BOX);
            this.scissorX = scissorBox[0];
            this.scissorY = scissorBox[1];
            this.scissorWidth = scissorBox[2];
            this.scissorHeight = scissorBox[3];
            this.blendEnabled = gl.isEnabled(gl.BLEND);
            this.blendSrcRgb = gl.getParameter(gl.BLEND_SRC_RGB);
            this.blendDstRgb = gl.getParameter(gl.BLEND_DST_RGB);
            this.blendSrcAlpha = gl.getParameter(gl.BLEND_SRC_ALPHA);
            this.blendDstAlpha = gl.getParameter(gl.BLEND_DST_ALPHA);
            this.boundArrayBuffer = gl.getParameter(gl.ARRAY_BUFFER_BINDING);
            this.boundElementArrayBuffer = gl.getParameter(gl.ELEMENT_ARRAY_BUFFER_BINDING);
            this.curProgram = gl.getParameter(gl.CURRENT_PROGRAM);
            this.canvas = gl.canvas;
            // Extract GLenums
            this.MAX_RENDERBUFFER_SIZE = gl.MAX_RENDERBUFFER_SIZE;
            this.MAX_TEXTURE_SIZE = gl.MAX_TEXTURE_SIZE;
            this.MAX_VIEWPORT_DIMS = gl.MAX_VIEWPORT_DIMS;
            this.MAX_VERTEX_TEXTURE_IMAGE_UNITS = gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS;
            this.MAX_TEXTURE_IMAGE_UNITS = gl.MAX_TEXTURE_IMAGE_UNITS;
            this.MAX_COMBINED_TEXTURE_IMAGE_UNITS = gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS;
            this.MAX_VERTEX_ATTRIBS = gl.MAX_VERTEX_ATTRIBS;
            this.MAX_VARYING_VECTORS = gl.MAX_VARYING_VECTORS;
            this.MAX_VERTEX_UNIFORM_VECTORS = gl.MAX_VERTEX_UNIFORM_VECTORS;
            this.MAX_FRAGMENT_UNIFORM_VECTORS = gl.MAX_FRAGMENT_UNIFORM_VECTORS;
            this.TEXTURE_MAG_FILTER = gl.TEXTURE_MAG_FILTER;
            this.TEXTURE_MIN_FILTER = gl.TEXTURE_MIN_FILTER;
            this.TEXTURE_WRAP_S = gl.TEXTURE_WRAP_S;
            this.TEXTURE_WRAP_T = gl.TEXTURE_WRAP_T;
            this.LINEAR = gl.LINEAR;
            this.CLAMP_TO_EDGE = gl.CLAMP_TO_EDGE;
            this.RGB = gl.RGB;
            this.RGBA = gl.RGBA;
            this.UNSIGNED_BYTE = gl.UNSIGNED_BYTE;
            this.UNPACK_PREMULTIPLY_ALPHA_WEBGL = gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL;
            this.UNPACK_FLIP_Y_WEBGL = gl.UNPACK_FLIP_Y_WEBGL;
            this.FLOAT = gl.FLOAT;
            this.TRIANGLES = gl.TRIANGLES;
            this.UNSIGNED_SHORT = gl.UNSIGNED_SHORT;
            this.ONE = gl.ONE;
            this.ONE_MINUS_SRC_ALPHA = gl.ONE_MINUS_SRC_ALPHA;
            this.MAX_VERTEX_TEXTURE_IMAGE_UNITS = gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS;
            this.TRIANGLES = gl.TRIANGLES;
            this.UNSIGNED_SHORT = gl.UNSIGNED_SHORT;
            this.VERTEX_SHADER = gl.VERTEX_SHADER;
            this.FRAGMENT_SHADER = gl.FRAGMENT_SHADER;
            this.STATIC_DRAW = gl.STATIC_DRAW;
            this.COMPILE_STATUS = gl.COMPILE_STATUS;
            this.LINK_STATUS = gl.LINK_STATUS;
            this.DYNAMIC_DRAW = gl.DYNAMIC_DRAW;
            this.COLOR_ATTACHMENT0 = gl.COLOR_ATTACHMENT0;
            this.INVALID_ENUM = gl.INVALID_ENUM;
            this.INVALID_OPERATION = gl.INVALID_OPERATION;
          }
          /**
           * Returns true if the WebGL context is WebGL2
           *
           * @returns
           */
          return _createClass(WebGlContextWrapper, [{
            key: "isWebGl2",
            value: function isWebGl2() {
              return _isWebGl(this.gl);
            }
            /**
             * ```
             * gl.activeTexture(textureUnit + gl.TEXTURE0);
             * ```
             *
             * @remarks
             * **WebGL Difference**: `textureUnit` is based from 0, not `gl.TEXTURE0`.
             *
             * @param textureUnit
             */
          }, {
            key: "activeTexture",
            value: function activeTexture(textureUnit) {
              var gl = this.gl;
              if (this.activeTextureUnit !== textureUnit) {
                gl.activeTexture(textureUnit + gl.TEXTURE0);
                this.activeTextureUnit = textureUnit;
              }
            }
            /**
             * ```
             * gl.bindTexture(gl.TEXTURE_2D, texture);
             * ```
             * @remarks
             * **WebGL Difference**: Bind target is always `gl.TEXTURE_2D`
             *
             * @param texture
             */
          }, {
            key: "bindTexture",
            value: function bindTexture(texture) {
              var gl = this.gl,
                activeTextureUnit = this.activeTextureUnit,
                texture2dUnits = this.texture2dUnits;
              if (texture2dUnits[activeTextureUnit] === texture) {
                return;
              }
              texture2dUnits[activeTextureUnit] = texture;
              gl.bindTexture(this.gl.TEXTURE_2D, texture);
            }
          }, {
            key: "_getActiveTexture",
            value: function _getActiveTexture() {
              var activeTextureUnit = this.activeTextureUnit,
                texture2dUnits = this.texture2dUnits;
              return texture2dUnits[activeTextureUnit];
            }
            /**
             * ```
             * gl.texParameteri(gl.TEXTURE_2D, pname, param);
             * ```
             * @remarks
             * **WebGL Difference**: Bind target is always `gl.TEXTURE_2D`
             *
             * @param pname
             * @param param
             * @returns
             */
          }, {
            key: "texParameteri",
            value: function texParameteri(pname, param) {
              var gl = this.gl,
                texture2dParams = this.texture2dParams;
              var activeTexture = this._getActiveTexture();
              if (!activeTexture) {
                throw new Error('No active texture');
              }
              var textureParams = texture2dParams.get(activeTexture);
              if (!textureParams) {
                textureParams = {};
                texture2dParams.set(activeTexture, textureParams);
              }
              if (textureParams[pname] === param) {
                return;
              }
              textureParams[pname] = param;
              gl.texParameteri(gl.TEXTURE_2D, pname, param);
            }
          }, {
            key: "texImage2D",
            value: function texImage2D(level, internalFormat, widthOrFormat, heightOrType, borderOrSource, format, type, pixels) {
              var gl = this.gl;
              if (format) {
                gl.texImage2D(gl.TEXTURE_2D, level, internalFormat, widthOrFormat, heightOrType, borderOrSource, format, type, pixels);
              } else {
                gl.texImage2D(gl.TEXTURE_2D, level, internalFormat, widthOrFormat, heightOrType, borderOrSource);
              }
            }
            /**
             * ```
             * gl.compressedTexImage2D(gl.TEXTURE_2D, level, internalFormat, width, height, border, data);
             * ```
             *
             * @remarks
             * **WebGL Difference**: Bind target is always `gl.TEXTURE_2D`
             */
          }, {
            key: "compressedTexImage2D",
            value: function compressedTexImage2D(level, internalformat, width, height, border, data) {
              var gl = this.gl;
              gl.compressedTexImage2D(gl.TEXTURE_2D, level, internalformat, width, height, border, data);
            }
            /**
             * ```
             * gl.pixelStorei(pname, param);
             * ```
             *
             * @param pname
             * @param param
             */
          }, {
            key: "pixelStorei",
            value: function pixelStorei(pname, param) {
              var gl = this.gl;
              gl.pixelStorei(pname, param);
            }
            /**
             * ```
             * gl.generateMipmap(gl.TEXTURE_2D);
             * ```
             *
             * @remarks
             * **WebGL Difference**: Bind target is always `gl.TEXTURE_2D`
             */
          }, {
            key: "generateMipmap",
            value: function generateMipmap() {
              var gl = this.gl;
              gl.generateMipmap(gl.TEXTURE_2D);
            }
            /**
             * ```
             * gl.createTexture();
             * ```
             *
             * @returns
             */
          }, {
            key: "createTexture",
            value: function createTexture() {
              var gl = this.gl;
              return gl.createTexture();
            }
            /**
             * ```
             * gl.deleteTexture(texture);
             * ```
             *
             * @param texture
             */
          }, {
            key: "deleteTexture",
            value: function deleteTexture(texture) {
              var gl = this.gl;
              if (texture) {
                this.texture2dParams.delete(texture);
              }
              gl.deleteTexture(texture);
            }
            /**
             * ```
             * gl.deleteFramebuffer(framebuffer);
             *
             * @param framebuffer
             */
          }, {
            key: "deleteFramebuffer",
            value: function deleteFramebuffer(framebuffer) {
              this.gl.deleteFramebuffer(framebuffer);
            }
            /**
             * ```
             * gl.viewport(x, y, width, height);
             * ```
             */
          }, {
            key: "viewport",
            value: function viewport(x, y, width, height) {
              var gl = this.gl;
              gl.viewport(x, y, width, height);
            }
            /**
             * ```
             * gl.clearColor(red, green, blue, alpha);
             * ```
             *
             * @param red
             * @param green
             * @param blue
             * @param alpha
             */
          }, {
            key: "clearColor",
            value: function clearColor(red, green, blue, alpha) {
              var gl = this.gl;
              gl.clearColor(red, green, blue, alpha);
            }
            /**
             * ```
             * gl["enable"|"disable"](gl.SCISSOR_TEST);
             * ```
             * @param enable
             */
          }, {
            key: "setScissorTest",
            value: function setScissorTest(enable) {
              var gl = this.gl,
                scissorEnabled = this.scissorEnabled;
              if (enable === scissorEnabled) {
                return;
              }
              if (enable) {
                gl.enable(gl.SCISSOR_TEST);
              } else {
                gl.disable(gl.SCISSOR_TEST);
              }
              this.scissorEnabled = enable;
            }
            /**
             * ```
             * gl.scissor(x, y, width, height);
             * ```
             *
             * @param x
             * @param y
             * @param width
             * @param height
             */
          }, {
            key: "scissor",
            value: function scissor(x, y, width, height) {
              var gl = this.gl,
                scissorX = this.scissorX,
                scissorY = this.scissorY,
                scissorWidth = this.scissorWidth,
                scissorHeight = this.scissorHeight;
              if (x !== scissorX || y !== scissorY || width !== scissorWidth || height !== scissorHeight) {
                gl.scissor(x, y, width, height);
                this.scissorX = x;
                this.scissorY = y;
                this.scissorWidth = width;
                this.scissorHeight = height;
              }
            }
            /**
             * ```
             * gl["enable"|"disable"](gl.BLEND);
             * ```
             *
             * @param blend
             * @returns
             */
          }, {
            key: "setBlend",
            value: function setBlend(blend) {
              var gl = this.gl,
                blendEnabled = this.blendEnabled;
              if (blend === blendEnabled) {
                return;
              }
              if (blend) {
                gl.enable(gl.BLEND);
              } else {
                gl.disable(gl.BLEND);
              }
              this.blendEnabled = blend;
            }
            /**
             * ```
             * gl.blendFunc(src, dst);
             * ```
             *
             * @param src
             * @param dst
             */
          }, {
            key: "blendFunc",
            value: function blendFunc(src, dst) {
              var gl = this.gl,
                blendSrcRgb = this.blendSrcRgb,
                blendDstRgb = this.blendDstRgb,
                blendSrcAlpha = this.blendSrcAlpha,
                blendDstAlpha = this.blendDstAlpha;
              if (src !== blendSrcRgb || dst !== blendDstRgb || src !== blendSrcAlpha || dst !== blendDstAlpha) {
                gl.blendFunc(src, dst);
                this.blendSrcRgb = src;
                this.blendDstRgb = dst;
                this.blendSrcAlpha = src;
                this.blendDstAlpha = dst;
              }
            }
            /**
             * ```
             * gl.createBuffer();
             * ```
             *
             * @returns
             */
          }, {
            key: "createBuffer",
            value: function createBuffer() {
              var gl = this.gl;
              return gl.createBuffer();
            }
            /**
             * ```
             * gl.createFramebuffer();
             * ```
             * @returns
             */
          }, {
            key: "createFramebuffer",
            value: function createFramebuffer() {
              var gl = this.gl;
              return gl.createFramebuffer();
            }
            /**
             * ```
             * gl.bindFramebuffer(gl.FRAMEBUFFER, framebuffer);
             * ```
             *
             * @param framebuffer
             */
          }, {
            key: "bindFramebuffer",
            value: function bindFramebuffer(framebuffer) {
              var gl = this.gl;
              gl.bindFramebuffer(gl.FRAMEBUFFER, framebuffer);
            }
            /**
             * ```
             * gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, texture, 0);
             * ```
             * @remarks
             * **WebGL Difference**: Bind target is always `gl.FRAMEBUFFER` and textarget is always `gl.TEXTURE_2D`
             */
          }, {
            key: "framebufferTexture2D",
            value: function framebufferTexture2D(attachment, texture, level) {
              var gl = this.gl;
              gl.framebufferTexture2D(gl.FRAMEBUFFER, attachment, gl.TEXTURE_2D, texture, level);
            }
            /**
             * ```
             * gl.clear(gl.COLOR_BUFFER_BIT);
             * ```
             *
             * @remarks
             * **WebGL Difference**: Clear mask is always `gl.COLOR_BUFFER_BIT`
             */
          }, {
            key: "clear",
            value: function clear() {
              var gl = this.gl;
              gl.clear(gl.COLOR_BUFFER_BIT);
            }
            /**
             * ```
             * gl.bindBuffer(gl.ARRAY_BUFFER, buffer);
             * gl.bufferData(gl.ARRAY_BUFFER, data, usage);
             * ```
             *
             * @remarks
             * **WebGL Combo**: `gl.bindBuffer` and `gl.bufferData` are combined into one function.
             *
             * @param buffer
             * @param data
             * @param usage
             */
          }, {
            key: "arrayBufferData",
            value: function arrayBufferData(buffer, data, usage) {
              var gl = this.gl,
                boundArrayBuffer = this.boundArrayBuffer;
              if (boundArrayBuffer !== buffer) {
                gl.bindBuffer(gl.ARRAY_BUFFER, buffer);
                this.boundArrayBuffer = buffer;
              }
              gl.bufferData(gl.ARRAY_BUFFER, data, usage);
            }
            /**
             * ```
             * gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, buffer);
             * gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, data, usage);
             * ```
             * @remarks
             * **WebGL Combo**: `gl.bindBuffer` and `gl.bufferData` are combined into one function.
             *
             * @param buffer
             * @param data
             * @param usage
             */
          }, {
            key: "elementArrayBufferData",
            value: function elementArrayBufferData(buffer, data, usage) {
              var gl = this.gl,
                boundElementArrayBuffer = this.boundElementArrayBuffer;
              if (boundElementArrayBuffer !== buffer) {
                gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, buffer);
                this.boundElementArrayBuffer = buffer;
              }
              gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, data, usage);
            }
            /**
             * ```
             * gl.bindBuffer(gl.ARRAY_BUFFER, buffer);
             * gl.vertexAttribPointer(index, size, type, normalized, stride, offset);
             * ```
             *
             * @remarks
             * **WebGL Combo**: `gl.bindBuffer` and `gl.vertexAttribPointer` are combined into one function.
             *
             * @param buffer
             * @param index
             * @param size
             * @param type
             * @param normalized
             * @param stride
             * @param offset
             */
          }, {
            key: "vertexAttribPointer",
            value: function vertexAttribPointer(buffer, index, size, type, normalized, stride, offset) {
              var gl = this.gl,
                boundArrayBuffer = this.boundArrayBuffer;
              if (boundArrayBuffer !== buffer) {
                gl.bindBuffer(gl.ARRAY_BUFFER, buffer);
                this.boundArrayBuffer = buffer;
              }
              gl.vertexAttribPointer(index, size, type, normalized, stride, offset);
            }
            /**
             * ```
             * gl.useProgram(program);
             * ```
             *
             * @param program
             * @returns
             */
          }, {
            key: "useProgram",
            value: function useProgram(program) {
              var gl = this.gl,
                curProgram = this.curProgram;
              if (curProgram === program) {
                return;
              }
              gl.useProgram(program);
              this.curProgram = program;
            }
            /**
             * Sets the value of a single float uniform variable.
             *
             * @param location - The location of the uniform variable.
             * @param v0 - The value to set.
             */
          }, {
            key: "uniform1f",
            value: function uniform1f(location, v0) {
              var gl = this.gl;
              gl.uniform1f(location, v0);
            }
            /**
             * Sets the value of a float array uniform variable.
             *
             * @param location - The location of the uniform variable.
             * @param value - The array of values to set.
             */
          }, {
            key: "uniform1fv",
            value: function uniform1fv(location, value) {
              var gl = this.gl;
              gl.uniform1fv(location, value);
            }
            /**
             * Sets the value of a single integer uniform variable.
             *
             * @param location - The location of the uniform variable.
             * @param v0 - The value to set.
             */
          }, {
            key: "uniform1i",
            value: function uniform1i(location, v0) {
              var gl = this.gl;
              gl.uniform1i(location, v0);
            }
            /**
             * Sets the value of an integer array uniform variable.
             *
             * @param location - The location of the uniform variable.
             * @param value - The array of values to set.
             */
          }, {
            key: "uniform1iv",
            value: function uniform1iv(location, value) {
              var gl = this.gl;
              gl.uniform1iv(location, value);
            }
            /**
             * Sets the value of a vec2 uniform variable.
             *
             * @param location - The location of the uniform variable.
             * @param v0 - The first component of the vector.
             * @param v1 - The second component of the vector.
             */
          }, {
            key: "uniform2f",
            value: function uniform2f(location, v0, v1) {
              var gl = this.gl;
              gl.uniform2f(location, v0, v1);
            }
            /**
             * Sets the value of a vec2 array uniform variable.
             *
             * @param location - The location of the uniform variable.
             * @param value - The array of vec2 values to set.
             */
          }, {
            key: "uniform2fv",
            value: function uniform2fv(location, value) {
              var gl = this.gl;
              gl.uniform2fv(location, value);
            }
            /**
             * Sets the value of a ivec2 uniform variable.
             *
             * @param location - The location of the uniform variable.
             * @param v0 - The first component of the vector.
             * @param v1 - The second component of the vector.
             */
          }, {
            key: "uniform2i",
            value: function uniform2i(location, v0, v1) {
              var gl = this.gl;
              gl.uniform2i(location, v0, v1);
            }
            /**
             * Sets the value of an ivec2 array uniform variable.
             *
             * @param location - The location of the uniform variable.
             * @param value - The array of ivec2 values to set.
             */
          }, {
            key: "uniform2iv",
            value: function uniform2iv(location, value) {
              var gl = this.gl;
              gl.uniform2iv(location, value);
            }
            /**
             * Sets the value of a vec3 uniform variable.
             *
             * @param location - The location of the uniform variable.
             * @param v0 - The first component of the vector.
             * @param v1 - The second component of the vector.
             * @param v2 - The third component of the vector.
             */
          }, {
            key: "uniform3f",
            value: function uniform3f(location, v0, v1, v2) {
              var gl = this.gl;
              gl.uniform3f(location, v0, v1, v2);
            }
            /**
             * Sets the value of a vec3 array uniform variable.
             *
             * @param location - The location of the uniform variable.
             * @param value - The array of vec3 values to set.
             */
          }, {
            key: "uniform3fv",
            value: function uniform3fv(location, value) {
              var gl = this.gl;
              gl.uniform3fv(location, value);
            }
            /**
             * Sets the value of a ivec3 uniform variable.
             *
             * @param location - The location of the uniform variable.
             * @param v0 - The first component of the vector.
             * @param v1 - The second component of the vector.
             * @param v2 - The third component of the vector.
             */
          }, {
            key: "uniform3i",
            value: function uniform3i(location, v0, v1, v2) {
              var gl = this.gl;
              gl.uniform3i(location, v0, v1, v2);
            }
            /**
             * Sets the value of an ivec3 array uniform variable.
             *
             * @param location - The location of the uniform variable.
             * @param value - The array of ivec3 values to set.
             */
          }, {
            key: "uniform3iv",
            value: function uniform3iv(location, value) {
              var gl = this.gl;
              gl.uniform3iv(location, value);
            }
            /**
             * Sets the value of a vec4 uniform variable.
             *
             * @param location - The location of the uniform variable.
             * @param v0 - The first component of the vector.
             * @param v1 - The second component of the vector.
             * @param v2 - The third component of the vector.
             * @param v3 - The fourth component of the vector.
             */
          }, {
            key: "uniform4f",
            value: function uniform4f(location, v0, v1, v2, v3) {
              var gl = this.gl;
              gl.uniform4f(location, v0, v1, v2, v3);
            }
            /**
             * Sets the value of a vec4 array uniform variable.
             *
             * @param location - The location of the uniform variable.
             * @param value - The array of vec4 values to set.
             */
          }, {
            key: "uniform4fv",
            value: function uniform4fv(location, value) {
              var gl = this.gl;
              gl.uniform4fv(location, value);
            }
            /**
             * Sets the value of a ivec4 uniform variable.
             *
             * @param location - The location of the uniform variable.
             * @param v0 - The first component of the vector.
             * @param v1 - The second component of the vector.
             * @param v2 - The third component of the vector.
             * @param v3 - The fourth component of the vector.
             */
          }, {
            key: "uniform4i",
            value: function uniform4i(location, v0, v1, v2, v3) {
              var gl = this.gl;
              gl.uniform4i(location, v0, v1, v2, v3);
            }
            /**
             * Sets the value of an ivec4 array uniform variable.
             *
             * @param location - The location of the uniform variable.
             * @param value - The array of ivec4 values to set.
             */
          }, {
            key: "uniform4iv",
            value: function uniform4iv(location, value) {
              var gl = this.gl;
              gl.uniform4iv(location, value);
            }
            /**
             * Sets the value of a mat2 uniform variable.
             *
             * @param location - The location of the uniform variable.
             * @param transpose - Whether to transpose the matrix.
             * @param value - The array of mat2 values to set.
             */
          }, {
            key: "uniformMatrix2fv",
            value: function uniformMatrix2fv(location, value) {
              var gl = this.gl;
              gl.uniformMatrix2fv(location, false, value);
            }
            /**
             * Sets the value of a mat2 uniform variable.
             * @param location - The location of the uniform variable.
             * @param value - The array of mat2 values to set.
             */
          }, {
            key: "uniformMatrix3fv",
            value: function uniformMatrix3fv(location, value) {
              var gl = this.gl;
              gl.uniformMatrix3fv(location, false, value);
            }
            /**
             * Sets the value of a mat4 uniform variable.
             * @param location - The location of the uniform variable.
             * @param value - The array of mat4 values to set.
             */
          }, {
            key: "uniformMatrix4fv",
            value: function uniformMatrix4fv(location, value) {
              var gl = this.gl;
              gl.uniformMatrix4fv(location, false, value);
            }
            /**
             * ```
             * gl.getParameter(pname);
             * ```
             *
             * @param pname
             * @returns
             */
          }, {
            key: "getParameter",
            value: function getParameter(pname) {
              var gl = this.gl;
              return gl.getParameter(pname);
            }
            /**
             * ```
             * gl.drawElements(mode, count, type, offset);
             * ```
             *
             * @param mode
             * @param count
             * @param type
             * @param offset
             */
          }, {
            key: "drawElements",
            value: function drawElements(mode, count, type, offset) {
              var gl = this.gl;
              gl.drawElements(mode, count, type, offset);
            }
            /**
             * ```
             * gl.drawArrays(mode, first, count);
             * ```
             *
             * @param name
             * @returns
             */
          }, {
            key: "getExtension",
            value: function getExtension(name) {
              var gl = this.gl;
              return gl.getExtension(name);
            }
            /**
             * ```
             * gl.getError(type);
             * ```
             *
             * @returns
             */
          }, {
            key: "getError",
            value: function getError() {
              var gl = this.gl;
              return gl.getError();
            }
            /**
             * ```
             * gl.createVertexArray();
             * ```
             *
             * @returns
             */
          }, {
            key: "createVertexArray",
            value: function createVertexArray() {
              var gl = this.gl;
              assertTruthy(gl instanceof WebGL2RenderingContext);
              return gl.createVertexArray();
            }
            /**
             * ```
             * gl.bindVertexArray(vertexArray);
             * ```
             *
             * @param vertexArray
             */
          }, {
            key: "bindVertexArray",
            value: function bindVertexArray(vertexArray) {
              var gl = this.gl;
              assertTruthy(gl instanceof WebGL2RenderingContext);
              gl.bindVertexArray(vertexArray);
            }
            /**
             * ```
             * gl.getAttribLocation(program, name);
             * ```
             *
             * @param program
             * @param name
             * @returns
             */
          }, {
            key: "getAttribLocation",
            value: function getAttribLocation(program, name) {
              var gl = this.gl;
              return gl.getAttribLocation(program, name);
            }
            /**
             * ```
             * gl.getUniformLocation(program, name);
             * ```
             *
             * @param program
             * @param name
             * @returns
             */
          }, {
            key: "getUniformLocation",
            value: function getUniformLocation(program, name) {
              var gl = this.gl;
              return gl.getUniformLocation(program, name);
            }
            /**
             * ```
             * gl.enableVertexAttribArray(index);
             * ```
             *
             * @param index
             */
          }, {
            key: "enableVertexAttribArray",
            value: function enableVertexAttribArray(index) {
              var gl = this.gl;
              gl.enableVertexAttribArray(index);
            }
            /**
             * ```
             * gl.disableVertexAttribArray(index);
             * ```
             *
             * @param index
             */
          }, {
            key: "disableVertexAttribArray",
            value: function disableVertexAttribArray(index) {
              var gl = this.gl;
              gl.disableVertexAttribArray(index);
            }
            /**
             * ```
             * gl.createShader(type);
             * ```
             *
             * @param type
             * @returns
             */
          }, {
            key: "createShader",
            value: function createShader(type) {
              var gl = this.gl;
              return gl.createShader(type);
            }
            /**
             * ```
             * gl.compileShader(shader);
             * ```
             *
             * @param shader
             * @returns
             */
          }, {
            key: "compileShader",
            value: function compileShader(shader) {
              var gl = this.gl;
              gl.compileShader(shader);
            }
            /**
             * ```
             * gl.attachShader(program, shader);
             * ```
             *
             * @param program
             * @param shader
             */
          }, {
            key: "attachShader",
            value: function attachShader(program, shader) {
              var gl = this.gl;
              gl.attachShader(program, shader);
            }
            /**
             * ```
             * gl.linkProgram(program);
             * ```
             *
             * @param program
             */
          }, {
            key: "linkProgram",
            value: function linkProgram(program) {
              var gl = this.gl;
              gl.linkProgram(program);
            }
            /**
             * ```
             * gl.deleteProgram(shader);
             * ```
             *
             * @param shader
             */
          }, {
            key: "deleteProgram",
            value: function deleteProgram(shader) {
              var gl = this.gl;
              gl.deleteProgram(shader);
            }
            /**
             * ```
             * gl.getShaderParameter(shader, pname);
             * ```
             *
             * @param shader
             * @param pname
             */
          }, {
            key: "getShaderParameter",
            value: function getShaderParameter(shader, pname) {
              var gl = this.gl;
              return gl.getShaderParameter(shader, pname);
            }
            /**
             * ```
             * gl.getShaderInfoLog(shader);
             * ```
             *
             * @param shader
             */
          }, {
            key: "getShaderInfoLog",
            value: function getShaderInfoLog(shader) {
              var gl = this.gl;
              return gl.getShaderInfoLog(shader);
            }
            /**
             * ```
             * gl.createProgram();
             * ```
             *
             * @returns
             */
          }, {
            key: "createProgram",
            value: function createProgram() {
              var gl = this.gl;
              return gl.createProgram();
            }
            /**
             * ```
             * gl.getProgramParameter(program, pname);
             * ```
             *
             * @param program
             * @param pname
             * @returns
             */
          }, {
            key: "getProgramParameter",
            value: function getProgramParameter(program, pname) {
              var gl = this.gl;
              return gl.getProgramParameter(program, pname);
            }
            /**
             * ```
             * gl.getProgramInfoLog(program);
             * ```
             *
             * @param program
             * @returns
             */
          }, {
            key: "getProgramInfoLog",
            value: function getProgramInfoLog(program) {
              var gl = this.gl;
              return gl.getProgramInfoLog(program);
            }
            /**
             * ```
             * gl.shaderSource(shader, source);
             * ```
             *
             * @param shader
             * @param source
             */
          }, {
            key: "shaderSource",
            value: function shaderSource(shader, source) {
              var gl = this.gl;
              gl.shaderSource(shader, source);
            }
            /**
             * ```
             * gl.deleteShader(shader);
             * ```
             *
             * @param shader
             */
          }, {
            key: "deleteShader",
            value: function deleteShader(shader) {
              var gl = this.gl;
              gl.deleteShader(shader);
            }
            /**
             * Check for WebGL errors and return error information
             * @param operation Description of the operation for error reporting
             * @returns Object with error information or null if no error
             */
          }, {
            key: "checkError",
            value: function checkError(operation) {
              var error = this.getError();
              if (error !== 0) {
                // 0 is GL_NO_ERROR
                var errorName = 'UNKNOWN_ERROR';
                switch (error) {
                  case this.INVALID_ENUM:
                    errorName = 'INVALID_ENUM';
                    break;
                  case 0x0501:
                    // GL_INVALID_VALUE
                    errorName = 'INVALID_VALUE';
                    break;
                  case this.INVALID_OPERATION:
                    errorName = 'INVALID_OPERATION';
                    break;
                  case 0x0505:
                    // GL_OUT_OF_MEMORY
                    errorName = 'OUT_OF_MEMORY';
                    break;
                  case 0x9242:
                    // GL_CONTEXT_LOST_WEBGL
                    errorName = 'CONTEXT_LOST_WEBGL';
                    break;
                }
                var message = "WebGL ".concat(errorName, " (0x").concat(error.toString(16), ") during ").concat(operation);
                return {
                  error: error,
                  errorName: errorName,
                  message: message
                };
              }
              return null;
            }
          }]);
        }();
        /*
         * If not stated otherwise in this file or this component's LICENSE file the
         * following copyright and licenses apply:
         *
         * Copyright 2024 Comcast Cable Communications Management, LLC.
         *
         * Licensed under the Apache License, Version 2.0 (the License);
         * you may not use this file except in compliance with the License.
         * You may obtain a copy of the License at
         *
         * http://www.apache.org/licenses/LICENSE-2.0
         *
         * Unless required by applicable law or agreed to in writing, software
         * distributed under the License is distributed on an "AS IS" BASIS,
         * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
         * See the License for the specific language governing permissions and
         * limitations under the License.
         */
        var WebGlCoreCtxRenderTexture = /*#__PURE__*/function (_WebGlCoreCtxTexture3) {
          function WebGlCoreCtxRenderTexture(glw, memManager, textureSource) {
            var _this51;
            _classCallCheck(this, WebGlCoreCtxRenderTexture);
            _this51 = _callSuper(this, WebGlCoreCtxRenderTexture, [glw, memManager, textureSource]);
            _defineProperty(_this51, "framebuffer", null);
            return _this51;
          }
          _inherits(WebGlCoreCtxRenderTexture, _WebGlCoreCtxTexture3);
          return _createClass(WebGlCoreCtxRenderTexture, [{
            key: "onLoadRequest",
            value: function () {
              var _onLoadRequest3 = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee17() {
                var glw, nativeTexture, _this$textureSource, width, height;
                return _regenerator().w(function (_context17) {
                  while (1) switch (_context17.n) {
                    case 0:
                      glw = this.glw;
                      nativeTexture = this._nativeCtxTexture = this.createNativeCtxTexture();
                      if (nativeTexture) {
                        _context17.n = 1;
                        break;
                      }
                      throw new Error('Failed to create native texture for RenderTexture');
                    case 1:
                      _this$textureSource = this.textureSource, width = _this$textureSource.width, height = _this$textureSource.height; // Create Framebuffer object
                      this.framebuffer = glw.createFramebuffer();
                      // Set the dimensions of the render texture
                      glw.texImage2D(0, glw.RGBA, width, height, 0, glw.RGBA, glw.UNSIGNED_BYTE, null);
                      // Update the texture memory manager
                      this.setTextureMemUse(width * height * 4);
                      // Bind the framebuffer
                      glw.bindFramebuffer(this.framebuffer);
                      // Attach the texture to the framebuffer
                      glw.framebufferTexture2D(glw.COLOR_ATTACHMENT0, nativeTexture, 0);
                      // Unbind the framebuffer
                      glw.bindFramebuffer(null);
                      return _context17.a(2, {
                        width: width,
                        height: height
                      });
                  }
                }, _callee17, this);
              }));
              function onLoadRequest() {
                return _onLoadRequest3.apply(this, arguments);
              }
              return onLoadRequest;
            }()
          }, {
            key: "free",
            value: function free() {
              _superPropGet(WebGlCoreCtxRenderTexture, "free", this, 3)([]);
              // Delete the framebuffer
              this.glw.deleteFramebuffer(this.framebuffer);
              this.framebuffer = null;
            }
          }]);
        }(WebGlCoreCtxTexture);
        /*
         * If not stated otherwise in this file or this component's LICENSE file the
         * following copyright and licenses apply:
         *
         * Copyright 2023 Comcast Cable Communications Management, LLC.
         *
         * Licensed under the Apache License, Version 2.0 (the License);
         * you may not use this file except in compliance with the License.
         * You may obtain a copy of the License at
         *
         * http://www.apache.org/licenses/LICENSE-2.0
         *
         * Unless required by applicable law or agreed to in writing, software
         * distributed under the License is distributed on an "AS IS" BASIS,
         * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
         * See the License for the specific language governing permissions and
         * limitations under the License.
         */
        var WORDS_PER_QUAD = 24;
        var WebGlCoreRenderer = /*#__PURE__*/function (_CoreRenderer2) {
          function WebGlCoreRenderer(options) {
            var _this52;
            _classCallCheck(this, WebGlCoreRenderer);
            _this52 = _callSuper(this, WebGlCoreRenderer, [options]);
            //// WebGL Native Context and Data
            _defineProperty(_this52, "glw", void 0);
            _defineProperty(_this52, "system", void 0);
            //// Persistent data
            _defineProperty(_this52, "quadBuffer", void 0);
            _defineProperty(_this52, "fQuadBuffer", void 0);
            _defineProperty(_this52, "uiQuadBuffer", void 0);
            _defineProperty(_this52, "renderOps", []);
            //// Render Op / Buffer Filling State
            _defineProperty(_this52, "curBufferIdx", 0);
            _defineProperty(_this52, "curRenderOp", null);
            _defineProperty(_this52, "rttNodes", []);
            _defineProperty(_this52, "activeRttNode", null);
            //// Default Shader
            _defineProperty(_this52, "defShaderCtrl", void 0);
            _defineProperty(_this52, "defaultShader", void 0);
            _defineProperty(_this52, "quadBufferCollection", void 0);
            _defineProperty(_this52, "clearColor", {
              raw: 0x00000000,
              normalized: [0, 0, 0, 0]
            });
            /**
             * White pixel texture used by default when no texture is specified.
             */
            _defineProperty(_this52, "quadBufferUsage", 0);
            _defineProperty(_this52, "numQuadsRendered", 0);
            /**
             * Whether the renderer is currently rendering to a texture.
             */
            _defineProperty(_this52, "renderToTextureActive", false);
            _this52.quadBuffer = new ArrayBuffer(_this52.stage.options.quadBufferSize);
            _this52.fQuadBuffer = new Float32Array(_this52.quadBuffer);
            _this52.uiQuadBuffer = new Uint32Array(_this52.quadBuffer);
            _this52.mode = 'webgl';
            var canvas = options.canvas,
              clearColor = options.clearColor,
              bufferMemory = options.bufferMemory;
            var gl = createWebGLContext(canvas, options.forceWebGL2, options.contextSpy);
            var glw = _this52.glw = new WebGlContextWrapper(gl);
            glw.viewport(0, 0, canvas.width, canvas.height);
            _this52.updateClearColor(clearColor);
            glw.setBlend(true);
            glw.blendFunc(glw.ONE, glw.ONE_MINUS_SRC_ALPHA);
            createIndexBuffer(glw, bufferMemory);
            _this52.system = {
              parameters: getWebGlParameters(_this52.glw),
              extensions: getWebGlExtensions(_this52.glw)
            };
            _this52.shManager.renderer = _this52;
            _this52.defShaderCtrl = _this52.shManager.loadShader('DefaultShader');
            _this52.defaultShader = _this52.defShaderCtrl.shader;
            var quadBuffer = glw.createBuffer();
            assertTruthy(quadBuffer);
            var stride = 6 * Float32Array.BYTES_PER_ELEMENT;
            _this52.quadBufferCollection = new BufferCollection([{
              buffer: quadBuffer,
              attributes: {
                a_position: {
                  name: 'a_position',
                  size: 2,
                  // 2 components per iteration
                  type: glw.FLOAT,
                  // the data is 32bit floats
                  normalized: false,
                  // don't normalize the data
                  stride: stride,
                  // 0 = move forward size * sizeof(type) each iteration to get the next position
                  offset: 0 // start at the beginning of the buffer
                },
                a_textureCoordinate: {
                  name: 'a_textureCoordinate',
                  size: 2,
                  type: glw.FLOAT,
                  normalized: false,
                  stride: stride,
                  offset: 2 * Float32Array.BYTES_PER_ELEMENT
                },
                a_color: {
                  name: 'a_color',
                  size: 4,
                  type: glw.UNSIGNED_BYTE,
                  normalized: true,
                  stride: stride,
                  offset: 4 * Float32Array.BYTES_PER_ELEMENT
                },
                a_textureIndex: {
                  name: 'a_textureIndex',
                  size: 1,
                  type: glw.FLOAT,
                  normalized: false,
                  stride: stride,
                  offset: 5 * Float32Array.BYTES_PER_ELEMENT
                }
              }
            }]);
            return _this52;
          }
          _inherits(WebGlCoreRenderer, _CoreRenderer2);
          return _createClass(WebGlCoreRenderer, [{
            key: "reset",
            value: function reset() {
              var glw = this.glw;
              this.curBufferIdx = 0;
              this.curRenderOp = null;
              this.renderOps.length = 0;
              glw.setScissorTest(false);
              glw.clear();
            }
          }, {
            key: "getShaderManager",
            value: function getShaderManager() {
              return this.shManager;
            }
          }, {
            key: "createCtxTexture",
            value: function createCtxTexture(textureSource) {
              if (textureSource instanceof SubTexture) {
                return new WebGlCoreCtxSubTexture(this.glw, this.txMemManager, textureSource);
              } else if (textureSource instanceof RenderTexture) {
                return new WebGlCoreCtxRenderTexture(this.glw, this.txMemManager, textureSource);
              }
              return new WebGlCoreCtxTexture(this.glw, this.txMemManager, textureSource);
            }
            /**
             * This function adds a quad (a rectangle composed of two triangles) to the WebGL rendering pipeline.
             *
             * It takes a set of options that define the quad's properties, such as its dimensions, colors, texture, shader, and transformation matrix.
             * The function first updates the shader properties with the current dimensions if necessary, then sets the default texture if none is provided.
             * It then checks if a new render operation is needed, based on the current shader and clipping rectangle.
             * If a new render operation is needed, it creates one and updates the current render operation.
             * The function then adjusts the texture coordinates based on the texture options and adds the texture to the texture manager.
             *
             * Finally, it calculates the vertices for the quad, taking into account any transformations, and adds them to the quad buffer.
             * The function updates the length and number of quads in the current render operation, and updates the current buffer index.
             */
          }, {
            key: "addQuad",
            value: function addQuad(params) {
              var fQuadBuffer = this.fQuadBuffer,
                uiQuadBuffer = this.uiQuadBuffer;
              var texture = params.texture;
              assertTruthy(texture !== null, 'Texture is required');
              /**
               * If the shader props contain any automatic properties, update it with the
               * current dimensions and or alpha that will be used to render the quad.
               */
              if (params.shaderProps !== null) {
                if (hasOwn(params.shaderProps, '$dimensions') == true) {
                  var dimensions = params.shaderProps.$dimensions;
                  dimensions.width = params.width;
                  dimensions.height = params.height;
                }
                if (hasOwn(params.shaderProps, '$alpha') === true) {
                  params.shaderProps.$alpha = params.alpha;
                }
              }
              var bufferIdx = this.curBufferIdx,
                curRenderOp = this.curRenderOp;
              var targetDims = {
                width: -1,
                height: -1
              };
              targetDims.width = params.width;
              targetDims.height = params.height;
              var targetShader = params.shader || this.defaultShader;
              assertTruthy(targetShader.getUniformLocation !== undefined, 'Invalid WebGL shader');
              if (this.reuseRenderOp(params) === false) {
                this.newRenderOp(targetShader, params.shaderProps, params.alpha, targetDims, params.clippingRect, bufferIdx, params.rtt, params.parentHasRenderTexture, params.framebufferDimensions);
                curRenderOp = this.curRenderOp;
                assertTruthy(curRenderOp);
              }
              var texCoordX1 = 0;
              var texCoordY1 = 0;
              var texCoordX2 = 1;
              var texCoordY2 = 1;
              if (texture.type === TextureType.subTexture) {
                var _texture$props = texture.props,
                  tx = _texture$props.x,
                  ty = _texture$props.y,
                  tw = _texture$props.width,
                  th = _texture$props.height;
                var _ref21 = texture.parentTexture.dimensions || {
                    width: 0,
                    height: 0
                  },
                  _ref21$width = _ref21.width,
                  parentW = _ref21$width === void 0 ? 0 : _ref21$width,
                  _ref21$height = _ref21.height,
                  parentH = _ref21$height === void 0 ? 0 : _ref21$height;
                texCoordX1 = tx / parentW;
                texCoordX2 = texCoordX1 + tw / parentW;
                texCoordY1 = ty / parentH;
                texCoordY2 = texCoordY1 + th / parentH;
                texture = texture.parentTexture;
              }
              if (texture.type === TextureType.image && params.textureOptions !== null && params.textureOptions.resizeMode !== undefined && texture.dimensions !== null) {
                var resizeMode = params.textureOptions.resizeMode;
                var _texture$dimensions2 = texture.dimensions,
                  _tw = _texture$dimensions2.width,
                  _th = _texture$dimensions2.height;
                if (resizeMode.type === 'cover') {
                  var scaleX = params.width / _tw;
                  var scaleY = params.height / _th;
                  var scale = Math.max(scaleX, scaleY);
                  var precision = 1 / scale;
                  // Determine based on width
                  if (scale && scaleX && scaleX < scale) {
                    var _resizeMode$clipX;
                    var desiredSize = precision * params.width;
                    texCoordX1 = (1 - desiredSize / _tw) * ((_resizeMode$clipX = resizeMode.clipX) !== null && _resizeMode$clipX !== void 0 ? _resizeMode$clipX : 0.5);
                    texCoordX2 = texCoordX1 + desiredSize / _tw;
                  }
                  // Determine based on height
                  if (scale && scaleY && scaleY < scale) {
                    var _resizeMode$clipY;
                    var _desiredSize = precision * params.height;
                    texCoordY1 = (1 - _desiredSize / _th) * ((_resizeMode$clipY = resizeMode.clipY) !== null && _resizeMode$clipY !== void 0 ? _resizeMode$clipY : 0.5);
                    texCoordY2 = texCoordY1 + _desiredSize / _th;
                  }
                }
              }
              // Flip texture coordinates if dictated by texture options
              var flipY = 0;
              if (params.textureOptions !== null) {
                if (params.textureOptions.flipX === true) {
                  var _ref22 = [texCoordX2, texCoordX1];
                  texCoordX1 = _ref22[0];
                  texCoordX2 = _ref22[1];
                }
                // convert to integer for bitwise operation below
                flipY = +(params.textureOptions.flipY || false);
              }
              // Eitherone should be true
              if (flipY ^ +(texture.type === TextureType.renderToTexture)) {
                var _ref23 = [texCoordY2, texCoordY1];
                texCoordY1 = _ref23[0];
                texCoordY2 = _ref23[1];
              }
              var ctxTexture = texture.ctxTexture;
              if (ctxTexture === undefined) {
                var _this$stage$defaultTe;
                ctxTexture = (_this$stage$defaultTe = this.stage.defaultTexture) === null || _this$stage$defaultTe === void 0 ? void 0 : _this$stage$defaultTe.ctxTexture;
                console.warn('WebGL Renderer: Texture does not have a ctxTexture, using default texture instead');
              }
              var textureIdx = this.addTexture(ctxTexture, bufferIdx);
              assertTruthy(this.curRenderOp !== null);
              if (params.renderCoords) {
                // Upper-Left
                fQuadBuffer[bufferIdx++] = params.renderCoords.x1; // vertexX
                fQuadBuffer[bufferIdx++] = params.renderCoords.y1; // vertexY
                fQuadBuffer[bufferIdx++] = texCoordX1; // texCoordX
                fQuadBuffer[bufferIdx++] = texCoordY1; // texCoordY
                uiQuadBuffer[bufferIdx++] = params.colorTl; // color
                fQuadBuffer[bufferIdx++] = textureIdx; // texIndex
                // Upper-Right
                fQuadBuffer[bufferIdx++] = params.renderCoords.x2;
                fQuadBuffer[bufferIdx++] = params.renderCoords.y2;
                fQuadBuffer[bufferIdx++] = texCoordX2;
                fQuadBuffer[bufferIdx++] = texCoordY1;
                uiQuadBuffer[bufferIdx++] = params.colorTr;
                fQuadBuffer[bufferIdx++] = textureIdx;
                // Lower-Left
                fQuadBuffer[bufferIdx++] = params.renderCoords.x4;
                fQuadBuffer[bufferIdx++] = params.renderCoords.y4;
                fQuadBuffer[bufferIdx++] = texCoordX1;
                fQuadBuffer[bufferIdx++] = texCoordY2;
                uiQuadBuffer[bufferIdx++] = params.colorBl;
                fQuadBuffer[bufferIdx++] = textureIdx;
                // Lower-Right
                fQuadBuffer[bufferIdx++] = params.renderCoords.x3;
                fQuadBuffer[bufferIdx++] = params.renderCoords.y3;
                fQuadBuffer[bufferIdx++] = texCoordX2;
                fQuadBuffer[bufferIdx++] = texCoordY2;
                uiQuadBuffer[bufferIdx++] = params.colorBr;
                fQuadBuffer[bufferIdx++] = textureIdx;
              } else if (params.tb !== 0 || params.tc !== 0) {
                // Upper-Left
                fQuadBuffer[bufferIdx++] = params.tx; // vertexX
                fQuadBuffer[bufferIdx++] = params.ty; // vertexY
                fQuadBuffer[bufferIdx++] = texCoordX1; // texCoordX
                fQuadBuffer[bufferIdx++] = texCoordY1; // texCoordY
                uiQuadBuffer[bufferIdx++] = params.colorTl; // color
                fQuadBuffer[bufferIdx++] = textureIdx; // texIndex
                // Upper-Right
                fQuadBuffer[bufferIdx++] = params.tx + params.width * params.ta;
                fQuadBuffer[bufferIdx++] = params.ty + params.width * params.tc;
                fQuadBuffer[bufferIdx++] = texCoordX2;
                fQuadBuffer[bufferIdx++] = texCoordY1;
                uiQuadBuffer[bufferIdx++] = params.colorTr;
                fQuadBuffer[bufferIdx++] = textureIdx;
                // Lower-Left
                fQuadBuffer[bufferIdx++] = params.tx + params.height * params.tb;
                fQuadBuffer[bufferIdx++] = params.ty + params.height * params.td;
                fQuadBuffer[bufferIdx++] = texCoordX1;
                fQuadBuffer[bufferIdx++] = texCoordY2;
                uiQuadBuffer[bufferIdx++] = params.colorBl;
                fQuadBuffer[bufferIdx++] = textureIdx;
                // Lower-Right
                fQuadBuffer[bufferIdx++] = params.tx + params.width * params.ta + params.height * params.tb;
                fQuadBuffer[bufferIdx++] = params.ty + params.width * params.tc + params.height * params.td;
                fQuadBuffer[bufferIdx++] = texCoordX2;
                fQuadBuffer[bufferIdx++] = texCoordY2;
                uiQuadBuffer[bufferIdx++] = params.colorBr;
                fQuadBuffer[bufferIdx++] = textureIdx;
              } else {
                // Calculate the right corner of the quad
                // multiplied by the scale
                var rightCornerX = params.tx + params.width * params.ta;
                var rightCornerY = params.ty + params.height * params.td;
                // Upper-Left
                fQuadBuffer[bufferIdx++] = params.tx; // vertexX
                fQuadBuffer[bufferIdx++] = params.ty; // vertexY
                fQuadBuffer[bufferIdx++] = texCoordX1; // texCoordX
                fQuadBuffer[bufferIdx++] = texCoordY1; // texCoordY
                uiQuadBuffer[bufferIdx++] = params.colorTl; // color
                fQuadBuffer[bufferIdx++] = textureIdx; // texIndex
                // Upper-Right
                fQuadBuffer[bufferIdx++] = rightCornerX;
                fQuadBuffer[bufferIdx++] = params.ty;
                fQuadBuffer[bufferIdx++] = texCoordX2;
                fQuadBuffer[bufferIdx++] = texCoordY1;
                uiQuadBuffer[bufferIdx++] = params.colorTr;
                fQuadBuffer[bufferIdx++] = textureIdx;
                // Lower-Left
                fQuadBuffer[bufferIdx++] = params.tx;
                fQuadBuffer[bufferIdx++] = rightCornerY;
                fQuadBuffer[bufferIdx++] = texCoordX1;
                fQuadBuffer[bufferIdx++] = texCoordY2;
                uiQuadBuffer[bufferIdx++] = params.colorBl;
                fQuadBuffer[bufferIdx++] = textureIdx;
                // Lower-Right
                fQuadBuffer[bufferIdx++] = rightCornerX;
                fQuadBuffer[bufferIdx++] = rightCornerY;
                fQuadBuffer[bufferIdx++] = texCoordX2;
                fQuadBuffer[bufferIdx++] = texCoordY2;
                uiQuadBuffer[bufferIdx++] = params.colorBr;
                fQuadBuffer[bufferIdx++] = textureIdx;
              }
              // Update the length of the current render op
              this.curRenderOp.length += WORDS_PER_QUAD;
              this.curRenderOp.numQuads++;
              this.curBufferIdx = bufferIdx;
            }
            /**
             * Replace the existing RenderOp with a new one that uses the specified Shader
             * and starts at the specified buffer index.
             *
             * @param shader
             * @param bufferIdx
             */
          }, {
            key: "newRenderOp",
            value: function newRenderOp(shader, shaderProps, alpha, dimensions, clippingRect, bufferIdx, renderToTexture, parentHasRenderTexture, framebufferDimensions) {
              var curRenderOp = new WebGlCoreRenderOp(this.glw, this.options, this.quadBufferCollection, shader, shaderProps, alpha, clippingRect, dimensions, bufferIdx, 0,
              // Z-Index is only used for explictly added Render Ops
              renderToTexture, parentHasRenderTexture, framebufferDimensions);
              this.curRenderOp = curRenderOp;
              this.renderOps.push(curRenderOp);
            }
            /**
             * Add a texture to the current RenderOp. If the texture cannot be added to the
             * current RenderOp, a new RenderOp will be created and the texture will be added
             * to that one.
             *
             * If the texture cannot be added to the new RenderOp, an error will be thrown.
             *
             * @param texture
             * @param bufferIdx
             * @param recursive
             * @returns Assigned Texture Index of the texture in the render op
             */
          }, {
            key: "addTexture",
            value: function addTexture(texture, bufferIdx, recursive) {
              var curRenderOp = this.curRenderOp;
              assertTruthy(curRenderOp);
              var textureIdx = curRenderOp.addTexture(texture);
              // TODO: Refactor to be more DRY
              if (textureIdx === 0xffffffff) {
                if (recursive) {
                  throw new Error('Unable to add texture to render op');
                }
                this.newRenderOp(curRenderOp.shader, curRenderOp.shaderProps, curRenderOp.alpha, curRenderOp.dimensions, curRenderOp.clippingRect, bufferIdx);
                return this.addTexture(texture, bufferIdx, true);
              }
              return textureIdx;
            }
            /**
             * Test if the current Render operation can be reused for the specified parameters.
             * @param params
             * @returns
             */
          }, {
            key: "reuseRenderOp",
            value: function reuseRenderOp(params) {
              var _this$curRenderOp;
              var shader = params.shader,
                shaderProps = params.shaderProps,
                parentHasRenderTexture = params.parentHasRenderTexture,
                rtt = params.rtt,
                clippingRect = params.clippingRect;
              var targetShader = shader || this.defaultShader;
              // Switching shader program will require a new render operation
              if (((_this$curRenderOp = this.curRenderOp) === null || _this$curRenderOp === void 0 ? void 0 : _this$curRenderOp.shader) !== targetShader) {
                return false;
              }
              // Switching clipping rect will require a new render operation
              if (compareRect(this.curRenderOp.clippingRect, clippingRect) === false) {
                return false;
              }
              // Force new render operation if rendering to texture
              // @todo: This needs to be improved, render operations could also be reused
              // for rendering to texture
              if (parentHasRenderTexture !== undefined || rtt !== undefined) {
                return false;
              }
              // Check if the shader can batch the shader properties
              if (this.curRenderOp.shader !== this.defaultShader && (shaderProps === null || this.curRenderOp.shader.canBatchShaderProps(this.curRenderOp.shaderProps, shaderProps) === false)) {
                return false;
              }
              // Render operation can be reused
              return true;
            }
            /**
             * add RenderOp to the render pipeline
             */
          }, {
            key: "addRenderOp",
            value: function addRenderOp(renderable) {
              this.renderOps.push(renderable);
              this.curRenderOp = null;
            }
            /**
             * Render the current set of RenderOps to render to the specified surface.
             *
             * TODO: 'screen' is the only supported surface at the moment.
             *
             * @param surface
             */
          }, {
            key: "render",
            value: function render() {
              var surface = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'screen';
              var glw = this.glw,
                quadBuffer = this.quadBuffer;
              var arr = new Float32Array(quadBuffer, 0, this.curBufferIdx);
              var buffer = this.quadBufferCollection.getBuffer('a_position') || null;
              glw.arrayBufferData(buffer, arr, glw.STATIC_DRAW);
              for (var i = 0, length = this.renderOps.length; i < length; i++) {
                // eslint-disable-next-line @typescript-eslint/no-non-null-assertion
                this.renderOps[i].draw();
              }
              this.quadBufferUsage = this.curBufferIdx * arr.BYTES_PER_ELEMENT;
              // Calculate the size of each quad in bytes (4 vertices per quad) times the size of each vertex in bytes
              var QUAD_SIZE_IN_BYTES = 4 * (6 * arr.BYTES_PER_ELEMENT); // 6 attributes per vertex
              this.numQuadsRendered = this.quadBufferUsage / QUAD_SIZE_IN_BYTES;
            }
          }, {
            key: "getQuadCount",
            value: function getQuadCount() {
              return this.numQuadsRendered;
            }
          }, {
            key: "renderToTexture",
            value: function renderToTexture(node) {
              for (var i = 0; i < this.rttNodes.length; i++) {
                if (this.rttNodes[i] === node) {
                  return;
                }
              }
              this.insertRTTNodeInOrder(node);
            }
            /**
             * Inserts an RTT node into `this.rttNodes` while maintaining the correct rendering order based on hierarchy.
             *
             * Rendering order for RTT nodes is critical when nested RTT nodes exist in a parent-child relationship.
             * Specifically:
             *  - Child RTT nodes must be rendered before their RTT-enabled parents to ensure proper texture composition.
             *  - If an RTT node is added and it has existing RTT children, it should be rendered after those children.
             *
             * This function addresses both cases by:
             * 1. **Checking Upwards**: It traverses the node's hierarchy upwards to identify any RTT parent
             *    already in `rttNodes`. If an RTT parent is found, the new node is placed before this parent.
             * 2. **Checking Downwards**: It traverses the nodes children recursively to find any RTT-enabled
             *    children that are already in `rttNodes`. If such children are found, the new node is inserted
             *    after the last (highest index) RTT child node.
             *
             * The final calculated insertion index ensures the new node is positioned in `rttNodes` to respect
             * both parent-before-child and child-before-parent rendering rules, preserving the correct order
             * for the WebGL renderer.
             *
             * @param node - The RTT-enabled CoreNode to be added to `rttNodes` in the appropriate hierarchical position.
             */
          }, {
            key: "insertRTTNodeInOrder",
            value: function insertRTTNodeInOrder(node) {
              var insertIndex = this.rttNodes.length; // Default to the end of the array
              // 1. Traverse upwards to ensure the node is placed before its RTT parent (if any).
              var currentNode = node;
              while (currentNode) {
                if (!currentNode.parent) {
                  break;
                }
                var parentIndex = this.rttNodes.indexOf(currentNode.parent);
                if (parentIndex !== -1) {
                  // Found an RTT parent in the list; set insertIndex to place node before the parent
                  insertIndex = parentIndex;
                  break;
                }
                currentNode = currentNode.parent;
              }
              // 2. Traverse downwards to ensure the node is placed after any RTT children.
              // Look through each child recursively to see if any are already in rttNodes.
              var maxChildIndex = this.findMaxChildRTTIndex(node);
              if (maxChildIndex !== -1) {
                // Adjust insertIndex to be after the last child RTT node
                insertIndex = Math.max(insertIndex, maxChildIndex + 1);
              }
              // 3. Insert the node at the calculated position
              this.rttNodes.splice(insertIndex, 0, node);
            }
            // Helper function to find the highest index of any RTT children of a node within rttNodes
          }, {
            key: "findMaxChildRTTIndex",
            value: function findMaxChildRTTIndex(node) {
              var _this53 = this;
              var maxIndex = -1;
              var _traverseChildren = function traverseChildren(currentNode) {
                var currentIndex = _this53.rttNodes.indexOf(currentNode);
                if (currentIndex !== -1) {
                  maxIndex = Math.max(maxIndex, currentIndex);
                }
                // Recursively check all children of the current node
                var _iterator12 = _createForOfIteratorHelper(currentNode.children),
                  _step12;
                try {
                  for (_iterator12.s(); !(_step12 = _iterator12.n()).done;) {
                    var child = _step12.value;
                    _traverseChildren(child);
                  }
                } catch (err) {
                  _iterator12.e(err);
                } finally {
                  _iterator12.f();
                }
              };
              // Start traversal directly with the provided node
              _traverseChildren(node);
              return maxIndex;
            }
          }, {
            key: "renderRTTNodes",
            value: function renderRTTNodes() {
              var glw = this.glw;
              var txManager = this.stage.txManager;
              // Render all associated RTT nodes to their textures
              for (var i = 0; i < this.rttNodes.length; i++) {
                var node = this.rttNodes[i];
                // Skip nodes that don't have RTT updates
                if (node === undefined || node.hasRTTupdates === false) {
                  continue;
                }
                // Skip nodes that are not visible
                if (node.worldAlpha === 0 || node.strictBounds === true && node.renderState === CoreNodeRenderState.OutOfBounds) {
                  continue;
                }
                // Skip nodes that do not have a loaded texture
                if (node.texture === null || node.texture.state !== 'loaded') {
                  continue;
                }
                // Set the active RTT node to the current node
                // So we can prevent rendering children of nested RTT nodes
                this.activeRttNode = node;
                assertTruthy(node.texture, 'RTT node missing texture');
                var ctxTexture = node.texture.ctxTexture;
                assertTruthy(ctxTexture instanceof WebGlCoreCtxRenderTexture);
                this.renderToTextureActive = true;
                // Bind the the texture's framebuffer
                glw.bindFramebuffer(ctxTexture.framebuffer);
                glw.viewport(0, 0, ctxTexture.w, ctxTexture.h);
                // Set the clear color to transparent
                glw.clearColor(0, 0, 0, 0);
                glw.clear();
                // Render all associated quads to the texture
                for (var _i2 = 0; _i2 < node.children.length; _i2++) {
                  var child = node.children[_i2];
                  if (child === undefined) {
                    continue;
                  }
                  this.stage.addQuads(child);
                  child.hasRTTupdates = false;
                }
                // Render all associated quads to the texture
                this.render();
                // Reset render operations
                this.renderOps.length = 0;
                node.hasRTTupdates = false;
              }
              var clearColor = this.clearColor.normalized;
              // Restore the default clear color
              glw.clearColor(clearColor[0], clearColor[1], clearColor[2], clearColor[3]);
              // Bind the default framebuffer
              glw.bindFramebuffer(null);
              glw.viewport(0, 0, this.glw.canvas.width, this.glw.canvas.height);
              this.renderToTextureActive = false;
            }
          }, {
            key: "removeRTTNode",
            value: function removeRTTNode(node) {
              var index = this.rttNodes.indexOf(node);
              if (index === -1) {
                return;
              }
              this.rttNodes.splice(index, 1);
            }
          }, {
            key: "getBufferInfo",
            value: function getBufferInfo() {
              var bufferInfo = {
                totalAvailable: this.stage.options.quadBufferSize,
                totalUsed: this.quadBufferUsage
              };
              return bufferInfo;
            }
          }, {
            key: "getDefShaderCtr",
            value: function getDefShaderCtr() {
              return this.defShaderCtrl;
            }
            /**
             * Updates the WebGL context's clear color and clears the color buffer.
             *
             * @param color - The color to set as the clear color, represented as a 32-bit integer.
             */
          }, {
            key: "updateClearColor",
            value: function updateClearColor(color) {
              if (this.clearColor.raw === color) {
                return;
              }
              var glw = this.glw;
              var normalizedColor = getNormalizedRgbaComponents(color);
              glw.clearColor(normalizedColor[0], normalizedColor[1], normalizedColor[2], normalizedColor[3]);
              this.clearColor = {
                raw: color,
                normalized: normalizedColor
              };
              glw.clear();
            }
          }]);
        }(CoreRenderer);
        /*
         * If not stated otherwise in this file or this component's LICENSE file the
         * following copyright and licenses apply:
         *
         * Copyright 2023 Comcast Cable Communications Management, LLC.
         *
         * Licensed under the Apache License, Version 2.0 (the License);
         * you may not use this file except in compliance with the License.
         * You may obtain a copy of the License at
         *
         * http://www.apache.org/licenses/LICENSE-2.0
         *
         * Unless required by applicable law or agreed to in writing, software
         * distributed under the License is distributed on an "AS IS" BASIS,
         * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
         * See the License for the specific language governing permissions and
         * limitations under the License.
         */
        var SpecialCodepoints = {
          LINE_FEED: 0x0a
        };

        /*
         * If not stated otherwise in this file or this component's LICENSE file the
         * following copyright and licenses apply:
         *
         * Copyright 2023 Comcast Cable Communications Management, LLC.
         *
         * Licensed under the Apache License, Version 2.0 (the License);
         * you may not use this file except in compliance with the License.
         * You may obtain a copy of the License at
         *
         * http://www.apache.org/licenses/LICENSE-2.0
         *
         * Unless required by applicable law or agreed to in writing, software
         * distributed under the License is distributed on an "AS IS" BASIS,
         * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
         * See the License for the specific language governing permissions and
         * limitations under the License.
         */
        var FontShaper = /*#__PURE__*/_createClass(function FontShaper() {
          _classCallCheck(this, FontShaper);
        });
        /*
         * If not stated otherwise in this file or this component's LICENSE file the
         * following copyright and licenses apply:
         *
         * Copyright 2023 Comcast Cable Communications Management, LLC.
         *
         * Licensed under the Apache License, Version 2.0 (the License);
         * you may not use this file except in compliance with the License.
         * You may obtain a copy of the License at
         *
         * http://www.apache.org/licenses/LICENSE-2.0
         *
         * Unless required by applicable law or agreed to in writing, software
         * distributed under the License is distributed on an "AS IS" BASIS,
         * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
         * See the License for the specific language governing permissions and
         * limitations under the License.
         */
        var SdfFontShaper = /*#__PURE__*/function (_FontShaper) {
          function SdfFontShaper(data, glyphMap) {
            var _this54;
            _classCallCheck(this, SdfFontShaper);
            _this54 = _callSuper(this, SdfFontShaper);
            _defineProperty(_this54, "data", void 0);
            _defineProperty(_this54, "glyphMap", void 0);
            _defineProperty(_this54, "kernings", void 0);
            _this54.data = data;
            _this54.glyphMap = glyphMap;
            var kernings = _this54.kernings = {};
            data.kernings.forEach(function (kerning) {
              var second = kerning.second;
              var firsts = kernings[second] = kernings[second] || {};
              firsts[kerning.first] = kerning.amount;
            });
            _this54.kernings = kernings;
            return _this54;
          }
          _inherits(SdfFontShaper, _FontShaper);
          return _createClass(SdfFontShaper, [{
            key: "shapeText",
            value: /*#__PURE__*/_regenerator().m(function shapeText(props, codepoints) {
              var codepointResult, lastGlyphId, codepoint, glyph, _this$kernings$glyph$, kerning;
              return _regenerator().w(function (_context18) {
                while (1) switch (_context18.n) {
                  case 0:
                    lastGlyphId = undefined;
                  case 1:
                    if (!((codepointResult = codepoints.peek()) && !codepointResult.done)) {
                      _context18.n = 5;
                      break;
                    }
                    codepoint = codepointResult.value;
                    glyph = this.glyphMap.get(codepoint);
                    codepoints.next();
                    if (!(glyph !== undefined)) {
                      _context18.n = 3;
                      break;
                    }
                    // We found a glyph for this codepoint
                    // Yield the mapped glyph info
                    /**
                     * Kerning includes any possible additional letter spacing
                     */
                    kerning = lastGlyphId !== undefined ? (((_this$kernings$glyph$ = this.kernings[glyph.id]) === null || _this$kernings$glyph$ === void 0 ? void 0 : _this$kernings$glyph$[lastGlyphId]) || 0) + props.letterSpacing : 0;
                    lastGlyphId = glyph.id;
                    _context18.n = 2;
                    return {
                      mapped: true,
                      glyphId: glyph.id,
                      codepoint: codepoint,
                      cluster: codepoints.lastIndex,
                      xAdvance: glyph.xadvance + kerning,
                      yAdvance: 0,
                      xOffset: glyph.xoffset + kerning,
                      yOffset: glyph.yoffset,
                      xBearing: 0,
                      yBearing: 0,
                      width: glyph.width,
                      height: glyph.height
                    };
                  case 2:
                    _context18.n = 4;
                    break;
                  case 3:
                    // We didn't find a glyph for this codepoint
                    // Yield the unmapped codepoint info
                    // If this codepoint is a linebreak, we should reset the last glyph id
                    // so that the next glyph will not be kerned with the last glyph of the
                    // previous line.
                    if (codepoint === SpecialCodepoints.LINE_FEED) {
                      lastGlyphId = undefined;
                    }
                    _context18.n = 4;
                    return {
                      mapped: false,
                      codepoint: codepoint,
                      cluster: codepoints.lastIndex
                    };
                  case 4:
                    _context18.n = 1;
                    break;
                  case 5:
                    return _context18.a(2);
                }
              }, shapeText, this);
            })
          }]);
        }(FontShaper);
        /*
         * If not stated otherwise in this file or this component's LICENSE file the
         * following copyright and licenses apply:
         *
         * Copyright 2023 Comcast Cable Communications Management, LLC.
         *
         * Licensed under the Apache License, Version 2.0 (the License);
         * you may not use this file except in compliance with the License.
         * You may obtain a copy of the License at
         *
         * http://www.apache.org/licenses/LICENSE-2.0
         *
         * Unless required by applicable law or agreed to in writing, software
         * distributed under the License is distributed on an "AS IS" BASIS,
         * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
         * See the License for the specific language governing permissions and
         * limitations under the License.
         */
        // import type { Renderer } from '../../../Renderer';
        var SdfTrFontFace = /*#__PURE__*/function (_TrFontFace3) {
          function SdfTrFontFace(type, options) {
            var _this55;
            _classCallCheck(this, SdfTrFontFace);
            _this55 = _callSuper(this, SdfTrFontFace, [options]);
            _defineProperty(_this55, "type", void 0);
            _defineProperty(_this55, "texture", void 0);
            /**
             * Height of the tallest character in the font including the whitespace above it
             * in SDF/vertex units.
             */
            _defineProperty(_this55, "maxCharHeight", 0);
            _defineProperty(_this55, "shaper", void 0);
            _defineProperty(_this55, "glyphMap", new Map());
            _defineProperty(_this55, "data", void 0);
            var atlasUrl = options.atlasUrl,
              atlasDataUrl = options.atlasDataUrl,
              stage = options.stage;
            _this55.type = type;
            var renderer = stage.renderer;
            assertTruthy(renderer instanceof WebGlCoreRenderer, 'SDF Font Faces can only be used with the WebGL Renderer');
            // Load image
            _this55.texture = stage.txManager.createTexture('ImageTexture', {
              src: atlasUrl,
              // IMPORTANT: The SDF shader requires the alpha channel to NOT be
              // premultiplied on the atlas texture. If it is premultiplied, the
              // rendering of SDF glyphs (especially single-channel SDF fonts) will
              // be very jagged.
              premultiplyAlpha: false
            });
            // Load the texture
            stage.txManager.loadTexture(_this55.texture, true);
            // FIXME This is a stop-gap solution to avoid Font Face textures to be cleaned up
            // Ideally we do want to clean up the textures if they're not being used to save as much memory as possible
            // However, we need to make sure that the font face is reloaded if the texture is cleaned up and needed again
            // and make sure the SdfFontRenderer is properly guarded against textures being reloaded
            // for now this will do the trick and the increase on memory is not that big
            _this55.texture.preventCleanup = true;
            _this55.texture.on('loaded', function () {
              _this55.checkLoaded();
              // Make sure we mark the stage for a re-render (in case the font's texture was freed and reloaded)
              stage.requestRender();
            });
            // Set this.data to the fetched data from dataUrl
            fetchJson(atlasDataUrl).then(function (response) {
              _this55.data = JSON.parse(response);
              assertTruthy(_this55.data);
              // Add all the glyphs to the glyph map
              var maxCharHeight = 0;
              _this55.data.chars.forEach(function (glyph) {
                _this55.glyphMap.set(glyph.id, glyph);
                var charHeight = glyph.yoffset + glyph.height;
                if (charHeight > maxCharHeight) {
                  maxCharHeight = charHeight;
                }
              });
              _this55.maxCharHeight = maxCharHeight;
              // We know `data` is defined here, because we just set it
              _this55.shaper = new SdfFontShaper(_this55.data, _this55.glyphMap);
              // If the metrics aren't provided explicitly in the font face options,
              // Gather them from the metrics added by the msdf-generator tool ()
              // If they are missing then we throw an error.
              if (!_this55.metrics) {
                var _this55$data;
                if ((_this55$data = _this55.data) !== null && _this55$data !== void 0 && _this55$data.lightningMetrics) {
                  var _this55$data$lightnin = _this55.data.lightningMetrics,
                    ascender = _this55$data$lightnin.ascender,
                    descender = _this55$data$lightnin.descender,
                    lineGap = _this55$data$lightnin.lineGap,
                    unitsPerEm = _this55$data$lightnin.unitsPerEm;
                  _this55.metrics = {
                    ascender: ascender / unitsPerEm,
                    descender: descender / unitsPerEm,
                    lineGap: lineGap / unitsPerEm
                  };
                } else {
                  throw new Error("Font metrics not found in ".concat(_this55.type, " font ").concat(_this55.fontFamily, ". ") + 'Make sure you are using the latest version of the Lightning ' + '3 `msdf-generator` tool to generate your SDF fonts.');
                }
              }
              _this55.checkLoaded();
            }).catch(console.error);
            return _this55;
          }
          _inherits(SdfTrFontFace, _TrFontFace3);
          return _createClass(SdfTrFontFace, [{
            key: "getAtlasEntry",
            value: function getAtlasEntry(glyphId) {
              var glyph = this.glyphMap.get(glyphId);
              if (glyph === undefined) {
                throw new Error("Glyph ".concat(glyphId, " not found in font ").concat(this.fontFamily));
              }
              return {
                x: glyph.x,
                y: glyph.y,
                width: glyph.width,
                height: glyph.height
              };
            }
          }, {
            key: "checkLoaded",
            value: function checkLoaded() {
              if (this.loaded) return;
              if (this.texture.state === 'loaded' && this.data) {
                this.loaded = true;
                this.emit('loaded');
              }
            }
          }]);
        }(TrFontFace);
        var __vite_import_meta_env__ = {
          "LEGACY": true
        };
        var SHADERS_ENABLED = !!(__vite_import_meta_env__ && undefined !== "true");
        var Config = exports("a8", {
          debug: false,
          focusDebug: false,
          keyDebug: false,
          animationsEnabled: true,
          animationSettings: {
            duration: 250,
            easing: "ease-in-out"
          },
          fontSettings: {
            fontFamily: "Ubuntu",
            fontSize: 100
          },
          setActiveElement: function setActiveElement() {},
          focusStateKey: "$focus",
          lockStyles: true
        });
        var renderer$1;
        function startLightningRenderer(options) {
          var rootId = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : "app";
          renderer$1 = new RendererMain(options, rootId);
          return renderer$1;
        }
        function loadFonts(fonts) {
          var _iterator13 = _createForOfIteratorHelper(fonts),
            _step13;
          try {
            for (_iterator13.s(); !(_step13 = _iterator13.n()).done;) {
              var font = _step13.value;
              if (renderer$1.stage.renderer.mode === "webgl" && "type" in font && (font.type === "msdf" || font.type === "ssdf")) {
                renderer$1.stage.fontManager.addFontFace(new SdfTrFontFace(font.type, _objectSpread(_objectSpread({}, font), {}, {
                  stage: renderer$1.stage
                })));
              } else if ("fontUrl" in font) {
                renderer$1.stage.fontManager.addFontFace(new WebTrFontFace(font));
              }
            }
          } catch (err) {
            _iterator13.e(err);
          } finally {
            _iterator13.f();
          }
        }
        var NodeType = {
          Element: "element",
          TextNode: "textNode",
          Text: "text"
        };
        function log(msg, node) {}
        var isFunc = function isFunc(obj) {
          return obj instanceof Function;
        };
        var isFunction = function isFunction(obj) {
          return typeof obj === "function";
        };
        function isArray(item) {
          return Array.isArray(item);
        }
        function isString(item) {
          return typeof item === "string";
        }
        function isNumber(item) {
          return typeof item === "number";
        }
        function isInteger(item) {
          return Number.isInteger(item);
        }
        function isINode(node) {
          return "destroy" in node && typeof node.destroy === "function";
        }
        function isElementNode(node) {
          return node instanceof ElementNode;
        }
        function isElementText(node) {
          return node._type === NodeType.TextNode;
        }
        function isTextNode(node) {
          return node._type === NodeType.Text;
        }
        function keyExists(obj, keys) {
          var _iterator14 = _createForOfIteratorHelper(keys),
            _step14;
          try {
            for (_iterator14.s(); !(_step14 = _iterator14.n()).done;) {
              var key = _step14.value;
              if (key in obj) {
                return true;
              }
            }
          } catch (err) {
            _iterator14.e(err);
          } finally {
            _iterator14.f();
          }
          return false;
        }
        function isFocused(el) {
          var _el$states;
          return el === null || el === void 0 || (_el$states = el.states) === null || _el$states === void 0 ? void 0 : _el$states.has(Config.focusStateKey);
        }
        var States = /*#__PURE__*/function (_Array) {
          function States(callback) {
            var _this56;
            var initialState = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
            _classCallCheck(this, States);
            if (isArray(initialState)) {
              _this56 = _callSuper(this, States, _toConsumableArray(initialState));
            } else if (isString(initialState)) {
              _this56 = _callSuper(this, States, [initialState]);
            } else {
              _this56 = _callSuper(this, States, _toConsumableArray(Object.entries(initialState).filter(function (_ref24) {
                var _ref25 = _slicedToArray(_ref24, 2),
                  _key = _ref25[0],
                  value = _ref25[1];
                return value;
              }).map(function (_ref26) {
                var _ref27 = _slicedToArray(_ref26, 1),
                  key = _ref27[0];
                return key;
              })));
            }
            _this56.onChange = callback;
            return _possibleConstructorReturn(_this56, _assertThisInitialized(_this56));
          }
          _inherits(States, _Array);
          return _createClass(States, [{
            key: "has",
            value: function has(state) {
              return this.indexOf(state) >= 0 || this.indexOf("$".concat(state)) >= 0;
            }
          }, {
            key: "is",
            value: function is(state) {
              return this.indexOf(state) >= 0;
            }
          }, {
            key: "add",
            value: function add(state) {
              if (this.has(state)) {
                return;
              }
              this.push(state);
              this.onChange();
            }
          }, {
            key: "toggle",
            value: function toggle(state, force) {
              if (force === true) {
                this.add(state);
              } else if (force === false) {
                this.remove(state);
              } else {
                if (this.has(state)) {
                  this.remove(state);
                } else {
                  this.add(state);
                }
              }
            }
          }, {
            key: "merge",
            value: function merge(newStates) {
              if (isArray(newStates)) {
                this.length = 0;
                this.push.apply(this, _toConsumableArray(newStates));
              } else if (isString(newStates)) {
                this.length = 0;
                this.push(newStates);
              } else {
                for (var state in newStates) {
                  var value = newStates[state];
                  if (value) {
                    if (!this.has(state)) {
                      this.push(state);
                    }
                  } else {
                    var stateIndexToRemove = this.indexOf(state);
                    if (stateIndexToRemove >= 0) {
                      this.splice(stateIndexToRemove, 1);
                    }
                  }
                }
              }
              return this;
            }
          }, {
            key: "remove",
            value: function remove(state) {
              var stateIndexToRemove = this.indexOf(state);
              if (stateIndexToRemove >= 0) {
                this.splice(stateIndexToRemove, 1);
                this.onChange();
              }
            }
          }]);
        }(/*#__PURE__*/_wrapNativeSuper(Array));
        function calculateFlex(node) {
          var direction = node.flexDirection || "row";
          var isRow = direction === "row";
          var dimension = isRow ? "width" : "height";
          var crossDimension = isRow ? "height" : "width";
          var marginOne = isRow ? "marginLeft" : "marginTop";
          var crossMarginOne = isRow ? "marginTop" : "marginLeft";
          var marginTwo = isRow ? "marginRight" : "marginBottom";
          var crossMarginTwo = isRow ? "marginBottom" : "marginRight";
          var processedChildren = [];
          var hasOrder = false;
          var totalFlexGrow = 0;
          for (var i = 0; i < node.children.length; i++) {
            var c = node.children[i];
            if (isElementText(c) && c.text && !(c.width || c.height)) {
              return false;
            }
            if (isTextNode(c) || c.flexItem === false) {
              continue;
            }
            var flexOrder = c.flexOrder;
            if (flexOrder !== void 0) {
              hasOrder = true;
            }
            var flexGrow = c.flexGrow;
            var isGrowItem = flexGrow !== void 0 && flexGrow >= 0;
            if (isGrowItem) {
              totalFlexGrow += flexGrow;
            }
            var mainSize = c[dimension] || 0;
            var currentMarginStart = c[marginOne] || 0;
            var currentMarginEnd = c[marginTwo] || 0;
            processedChildren.push({
              node: c,
              mainSize: mainSize,
              marginStart: currentMarginStart,
              marginEnd: currentMarginEnd,
              totalMainSizeOnAxis: mainSize + currentMarginStart + currentMarginEnd,
              isGrowItem: isGrowItem,
              flexGrowValue: isGrowItem ? flexGrow : 0,
              flexOrder: flexOrder || 0,
              crossSize: c[crossDimension] || 0,
              crossMarginStart: c[crossMarginOne] || 0,
              crossMarginEnd: c[crossMarginTwo] || 0
            });
          }
          if (hasOrder) {
            processedChildren.sort(function (a, b) {
              return a.flexOrder - b.flexOrder;
            });
          } else if (node.direction === "rtl") {
            processedChildren.reverse();
          }
          var numProcessedChildren = processedChildren.length;
          if (numProcessedChildren === 0) {
            return false;
          }
          var prop = isRow ? "x" : "y";
          var crossProp = isRow ? "y" : "x";
          var containerSize = node[dimension] || 0;
          var containerCrossSize = node[crossDimension] || 0;
          var gap = node.gap || 0;
          var justify = node.justifyContent || "flexStart";
          var containerUpdated = false;
          if (totalFlexGrow > 0 && numProcessedChildren > 1) {
            node.flexBoundary = node.flexBoundary || "fixed";
            var sumOfFlexBaseSizesWithMargins = 0;
            var _iterator15 = _createForOfIteratorHelper(processedChildren),
              _step15;
            try {
              for (_iterator15.s(); !(_step15 = _iterator15.n()).done;) {
                var _pc2 = _step15.value;
                sumOfFlexBaseSizesWithMargins += _pc2.mainSize + _pc2.marginStart + _pc2.marginEnd;
              }
            } catch (err) {
              _iterator15.e(err);
            } finally {
              _iterator15.f();
            }
            var totalGapSpace = numProcessedChildren > 0 ? gap * (numProcessedChildren - 1) : 0;
            var availableSpace = containerSize - sumOfFlexBaseSizesWithMargins - totalGapSpace;
            if (availableSpace > 0) {
              var _iterator16 = _createForOfIteratorHelper(processedChildren),
                _step16;
              try {
                for (_iterator16.s(); !(_step16 = _iterator16.n()).done;) {
                  var pc = _step16.value;
                  if (pc.isGrowItem && pc.flexGrowValue > 0) {
                    var shareOfSpace = pc.flexGrowValue / totalFlexGrow * availableSpace;
                    var newMainSize = pc.mainSize + shareOfSpace;
                    pc.node[dimension] = newMainSize;
                    pc.mainSize = newMainSize;
                    pc.totalMainSizeOnAxis = newMainSize + pc.marginStart + pc.marginEnd;
                  }
                }
              } catch (err) {
                _iterator16.e(err);
              } finally {
                _iterator16.f();
              }
              node._containsFlexGrow = node._containsFlexGrow ? null : true;
            } else if (node._containsFlexGrow) {
              node._containsFlexGrow = null;
            } else {
              console.warn("No available space for flex-grow items to expand, or items overflow.");
            }
          }
          var totalItemSize = 0;
          if (justify === "center" || justify === "spaceBetween" || justify === "spaceEvenly" || justify === "spaceAround") {
            var _iterator17 = _createForOfIteratorHelper(processedChildren),
              _step17;
            try {
              for (_iterator17.s(); !(_step17 = _iterator17.n()).done;) {
                var _pc3 = _step17.value;
                totalItemSize += _pc3.totalMainSizeOnAxis;
              }
            } catch (err) {
              _iterator17.e(err);
            } finally {
              _iterator17.f();
            }
          }
          var align = node.alignItems || (node.flexWrap ? "flexStart" : void 0);
          var doCrossAlign = containerCrossSize ? function (pc) {
            var crossCurrentPos = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;
            var alignSelf = pc.node.alignSelf || align;
            if (!alignSelf) {
              return;
            }
            if (alignSelf === "flexStart") {
              pc.node[crossProp] = crossCurrentPos + pc.crossMarginStart;
            } else if (alignSelf === "center") {
              pc.node[crossProp] = crossCurrentPos + (containerCrossSize - pc.crossSize) / 2 + pc.crossMarginStart;
            } else if (alignSelf === "flexEnd") {
              pc.node[crossProp] = crossCurrentPos + containerCrossSize - pc.crossSize - pc.crossMarginEnd;
            }
          } : function (_pc) {
            var _crossCurrentPos = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;
          };
          if (isRow && node._calcHeight && !node.flexCrossBoundary) {
            var maxHeight = processedChildren.reduce(function (max, pc) {
              return Math.max(max, pc.crossSize);
            }, 0);
            var newHeight = maxHeight || node.height;
            if (newHeight !== node.height) {
              containerUpdated = true;
              node.height = containerCrossSize = newHeight;
            }
          }
          var currentPos = node.padding || 0;
          if (justify === "flexStart") {
            if (node.flexWrap === "wrap") {
              var _processedChildren$, _node$columnGap, _node$rowGap;
              var crossCurrentPos = 0;
              var childCrossSize = ((_processedChildren$ = processedChildren[0]) === null || _processedChildren$ === void 0 ? void 0 : _processedChildren$.crossSize) || containerCrossSize;
              var crossGap = isRow ? (_node$columnGap = node.columnGap) !== null && _node$columnGap !== void 0 ? _node$columnGap : gap : (_node$rowGap = node.rowGap) !== null && _node$rowGap !== void 0 ? _node$rowGap : gap;
              var _iterator18 = _createForOfIteratorHelper(processedChildren),
                _step18;
              try {
                for (_iterator18.s(); !(_step18 = _iterator18.n()).done;) {
                  var _pc4 = _step18.value;
                  if (currentPos + _pc4.totalMainSizeOnAxis > containerSize && currentPos > (node.padding || 0)) {
                    currentPos = node.padding || 0;
                    crossCurrentPos += childCrossSize + crossGap;
                  }
                  _pc4.node[prop] = currentPos + _pc4.marginStart;
                  currentPos += _pc4.totalMainSizeOnAxis + gap;
                  doCrossAlign(_pc4, crossCurrentPos);
                }
              } catch (err) {
                _iterator18.e(err);
              } finally {
                _iterator18.f();
              }
              var finalCrossSize = crossCurrentPos + childCrossSize;
              if (node[crossDimension] !== finalCrossSize) {
                node["preFlex".concat(crossDimension)] = node[crossDimension];
                node[crossDimension] = finalCrossSize;
                containerUpdated = true;
              }
            } else {
              var _iterator19 = _createForOfIteratorHelper(processedChildren),
                _step19;
              try {
                for (_iterator19.s(); !(_step19 = _iterator19.n()).done;) {
                  var _pc5 = _step19.value;
                  _pc5.node[prop] = currentPos + _pc5.marginStart;
                  currentPos += _pc5.totalMainSizeOnAxis + gap;
                  doCrossAlign(_pc5);
                }
              } catch (err) {
                _iterator19.e(err);
              } finally {
                _iterator19.f();
              }
            }
            if (node.flexBoundary !== "fixed" && node.flexWrap !== "wrap") {
              var calculatedSize = currentPos - gap + (node.padding || 0);
              if (calculatedSize !== containerSize) {
                node["preFlex".concat(dimension)] = containerSize;
                node[dimension] = calculatedSize;
                return true;
              }
            }
          } else if (justify === "flexEnd") {
            currentPos = containerSize - (node.padding || 0);
            for (var _i3 = numProcessedChildren - 1; _i3 >= 0; _i3--) {
              var _pc6 = processedChildren[_i3];
              _pc6.node[prop] = currentPos - _pc6.mainSize - _pc6.marginEnd;
              currentPos -= _pc6.totalMainSizeOnAxis + gap;
              doCrossAlign(_pc6);
            }
          } else if (justify === "center") {
            currentPos = (containerSize - (totalItemSize + gap * (numProcessedChildren - 1))) / 2 + (node.padding || 0);
            var _iterator20 = _createForOfIteratorHelper(processedChildren),
              _step20;
            try {
              for (_iterator20.s(); !(_step20 = _iterator20.n()).done;) {
                var _pc7 = _step20.value;
                _pc7.node[prop] = currentPos + _pc7.marginStart;
                currentPos += _pc7.totalMainSizeOnAxis + gap;
                doCrossAlign(_pc7);
              }
            } catch (err) {
              _iterator20.e(err);
            } finally {
              _iterator20.f();
            }
          } else if (justify === "spaceBetween") {
            var spaceBetween = numProcessedChildren > 1 ? (containerSize - totalItemSize - (node.padding || 0) * 2) / (numProcessedChildren - 1) : 0;
            currentPos = node.padding || 0;
            var _iterator21 = _createForOfIteratorHelper(processedChildren),
              _step21;
            try {
              for (_iterator21.s(); !(_step21 = _iterator21.n()).done;) {
                var _pc8 = _step21.value;
                _pc8.node[prop] = currentPos + _pc8.marginStart;
                currentPos += _pc8.totalMainSizeOnAxis + spaceBetween;
                doCrossAlign(_pc8);
              }
            } catch (err) {
              _iterator21.e(err);
            } finally {
              _iterator21.f();
            }
          } else if (justify === "spaceAround") {
            var spaceAround = numProcessedChildren > 0 ? (containerSize - totalItemSize - (node.padding || 0) * 2) / numProcessedChildren : 0;
            currentPos = (node.padding || 0) + spaceAround / 2;
            var _iterator22 = _createForOfIteratorHelper(processedChildren),
              _step22;
            try {
              for (_iterator22.s(); !(_step22 = _iterator22.n()).done;) {
                var _pc9 = _step22.value;
                _pc9.node[prop] = currentPos + _pc9.marginStart;
                currentPos += _pc9.totalMainSizeOnAxis + spaceAround;
                doCrossAlign(_pc9);
              }
            } catch (err) {
              _iterator22.e(err);
            } finally {
              _iterator22.f();
            }
          } else if (justify === "spaceEvenly") {
            var spaceEvenly = (containerSize - totalItemSize - (node.padding || 0) * 2) / (numProcessedChildren + 1);
            currentPos = spaceEvenly + (node.padding || 0);
            var _iterator23 = _createForOfIteratorHelper(processedChildren),
              _step23;
            try {
              for (_iterator23.s(); !(_step23 = _iterator23.n()).done;) {
                var _pc0 = _step23.value;
                _pc0.node[prop] = currentPos + _pc0.marginStart;
                currentPos += _pc0.totalMainSizeOnAxis + spaceEvenly;
                doCrossAlign(_pc0);
              }
            } catch (err) {
              _iterator23.e(err);
            } finally {
              _iterator23.f();
            }
          }
          return containerUpdated;
        }
        var keyMapEntries = {
          ArrowLeft: "Left",
          ArrowRight: "Right",
          ArrowUp: "Up",
          ArrowDown: "Down",
          Enter: "Enter",
          l: "Last",
          " ": "Space",
          Backspace: "Back",
          Escape: "Escape"
        };
        var keyHoldMapEntries = {
          // Enter: 'EnterHold',
        };
        var flattenKeyMap = function flattenKeyMap(keyMap, targetMap) {
          var _loop5 = function _loop5() {
            var _Object$entries2$_i = _slicedToArray(_Object$entries2[_i4], 2),
              key = _Object$entries2$_i[0],
              value = _Object$entries2$_i[1];
            if (Array.isArray(value)) {
              value.forEach(function (v) {
                targetMap[v] = key;
              });
            } else if (value === null) {
              delete targetMap[key];
            } else {
              targetMap[value] = key;
            }
          };
          for (var _i4 = 0, _Object$entries2 = Object.entries(keyMap); _i4 < _Object$entries2.length; _i4++) {
            _loop5();
          }
        };
        var needFocusDebugStyles = true;
        var addFocusDebug = function addFocusDebug(prevFocusPath, newFocusPath) {
          if (needFocusDebugStyles) {
            var style = document.createElement("style");
            style.type = "text/css";
            style.innerHTML = "\n      [data-focus=\"3\"] {\n        border: 2px solid rgba(255, 33, 33, 0.2);\n        border-radius: 5px;\n        transition: border-color 0.3s ease;\n      }\n\n      [data-focus=\"2\"] {\n        border: 2px solid rgba(255, 33, 33, 0.4);\n        border-radius: 5px;\n        transition: border-color 0.3s ease;\n      }\n\n      [data-focus=\"1\"] {\n        border: 4px solid rgba(255, 33, 33, 0.9);\n        border-radius: 5px;\n        transition: border-color 0.5s ease;\n      }\n    ";
            document.head.appendChild(style);
            needFocusDebugStyles = false;
          }
          prevFocusPath.forEach(function (elm) {
            elm.data = _objectSpread(_objectSpread({}, elm.data), {}, {
              focus: void 0
            });
          });
          newFocusPath.forEach(function (elm, i) {
            elm.data = _objectSpread(_objectSpread({}, elm.data), {}, {
              focus: i + 1
            });
          });
        };
        var activeElement$1;
        var setActiveElement$1 = function setActiveElement$1(elm) {
          updateFocusPath(elm, activeElement$1);
          activeElement$1 = elm;
          Config.setActiveElement(elm);
        };
        var focusPath$1 = [];
        var updateFocusPath = function updateFocusPath(currentFocusedElm, prevFocusedElm) {
          var current = currentFocusedElm;
          var fp = [];
          while (current) {
            if (!current.states.has(Config.focusStateKey) || current === currentFocusedElm) {
              var _current$onFocus, _current$onFocusChang;
              current.states.add(Config.focusStateKey);
              (_current$onFocus = current.onFocus) === null || _current$onFocus === void 0 || _current$onFocus.call(current, currentFocusedElm, prevFocusedElm);
              (_current$onFocusChang = current.onFocusChanged) === null || _current$onFocusChang === void 0 || _current$onFocusChang.call(current, true, currentFocusedElm, prevFocusedElm);
            }
            fp.push(current);
            current = current.parent;
          }
          focusPath$1.forEach(function (elm) {
            if (!fp.includes(elm)) {
              var _elm$onBlur, _elm$onFocusChanged;
              elm.states.remove(Config.focusStateKey);
              (_elm$onBlur = elm.onBlur) === null || _elm$onBlur === void 0 || _elm$onBlur.call(elm, currentFocusedElm, prevFocusedElm);
              (_elm$onFocusChanged = elm.onFocusChanged) === null || _elm$onFocusChanged === void 0 || _elm$onFocusChanged.call(elm, false, currentFocusedElm, prevFocusedElm);
            }
          });
          if (Config.focusDebug) {
            addFocusDebug(focusPath$1, fp);
          }
          focusPath$1 = fp;
          return fp;
        };
        var lastGlobalKeyPressTime = 0;
        var lastInputKey;
        var propagateKeyPress = function propagateKeyPress(e, mappedEvent) {
          var isHold = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;
          var isUp = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;
          var currentTime = performance.now();
          var key = e.key || e.keyCode;
          var sameKey = lastInputKey === key;
          lastInputKey = key;
          if (!isUp && Config.throttleInput) {
            if (sameKey && currentTime - lastGlobalKeyPressTime < Config.throttleInput) {
              return false;
            }
            lastGlobalKeyPressTime = currentTime;
          }
          var finalFocusElm;
          var numItems = focusPath$1.length;
          var captureEvent = "onCapture".concat(mappedEvent || e.key) + isUp ? "Release" : "";
          var captureKey = isUp ? "onCaptureKeyRelease" : "onCaptureKey";
          for (var i = numItems - 1; i >= 0; i--) {
            var elm = focusPath$1[i];
            if (elm.throttleInput) {
              if (sameKey && elm._lastAnyKeyPressTime !== void 0 && currentTime - elm._lastAnyKeyPressTime < elm.throttleInput) {
                return true;
              }
            }
            var captureHandler = elm[captureEvent] || elm[captureKey];
            if (isFunction(captureHandler) && captureHandler.call(elm, e, elm, finalFocusElm, mappedEvent) === true) {
              elm._lastAnyKeyPressTime = currentTime;
              return true;
            }
          }
          var eventHandlerKey;
          var releaseEventHandlerKey;
          var fallbackHandlerKey;
          if (mappedEvent) {
            eventHandlerKey = "on".concat(mappedEvent);
            releaseEventHandlerKey = "on".concat(mappedEvent, "Release");
          }
          if (!isUp) {
            fallbackHandlerKey = isHold ? "onKeyHold" : "onKeyPress";
          }
          for (var _i5 = 0; _i5 < numItems; _i5++) {
            var _elm = focusPath$1[_i5];
            if (!finalFocusElm) {
              finalFocusElm = _elm;
            }
            if (_elm.throttleInput) {
              if (sameKey && _elm._lastAnyKeyPressTime !== void 0 && currentTime - _elm._lastAnyKeyPressTime < _elm.throttleInput) {
                return true;
              }
            }
            var handled = false;
            if (isUp && releaseEventHandlerKey) {
              var eventHandler = _elm[releaseEventHandlerKey];
              if (isFunction(eventHandler)) {
                if (eventHandler.call(_elm, e, _elm, finalFocusElm) === true) handled = true;
              }
            } else if (!isUp && eventHandlerKey) {
              var _eventHandler = _elm[eventHandlerKey];
              if (isFunction(_eventHandler)) {
                if (_eventHandler.call(_elm, e, _elm, finalFocusElm) === true) handled = true;
              }
            }
            if (!handled && fallbackHandlerKey) {
              var fallbackHandler = _elm[fallbackHandlerKey];
              if (isFunction(fallbackHandler)) {
                if (fallbackHandler.call(_elm, e, mappedEvent, _elm, finalFocusElm) === true) handled = true;
              }
            }
            if (handled) {
              _elm._lastAnyKeyPressTime = currentTime;
              return true;
            }
          }
          return false;
        };
        var DEFAULT_KEY_HOLD_THRESHOLD = 500;
        var keyHoldTimeouts = {};
        var handleKeyEvents = function handleKeyEvents(delay, keydown, keyup) {
          if (keydown) {
            var key = keydown.key || keydown.keyCode;
            var mappedKeyHoldEvent = keyHoldMapEntries[keydown.key] || keyHoldMapEntries[keydown.keyCode];
            var mappedKeyEvent = keyMapEntries[keydown.key] || keyMapEntries[keydown.keyCode];
            if (mappedKeyHoldEvent) {
              if (!keyHoldTimeouts[key]) {
                keyHoldTimeouts[key] = window.setTimeout(function () {
                  keyHoldTimeouts[key] = true;
                  propagateKeyPress(keydown, mappedKeyHoldEvent, true);
                }, delay);
              }
              return;
            }
            propagateKeyPress(keydown, mappedKeyEvent, false);
          } else if (keyup) {
            var _key16 = keyup.key || keyup.keyCode;
            var _mappedKeyEvent = keyMapEntries[keyup.key] || keyMapEntries[keyup.keyCode];
            if (keyHoldTimeouts[_key16] === true) {
              delete keyHoldTimeouts[_key16];
            } else if (keyHoldTimeouts[_key16]) {
              clearTimeout(keyHoldTimeouts[_key16]);
              delete keyHoldTimeouts[_key16];
              propagateKeyPress(keyup, _mappedKeyEvent, false);
            }
            propagateKeyPress(keyup, _mappedKeyEvent, false, true);
          }
        };
        var useFocusManager$1 = function useFocusManager$1() {
          var _ref28 = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},
            userKeyMap = _ref28.userKeyMap,
            keyHoldOptions = _ref28.keyHoldOptions,
            _ref28$ownerContext = _ref28.ownerContext,
            ownerContext = _ref28$ownerContext === void 0 ? function (cb) {
              cb();
            } : _ref28$ownerContext;
          if (userKeyMap) {
            flattenKeyMap(userKeyMap, keyMapEntries);
          }
          if (keyHoldOptions !== null && keyHoldOptions !== void 0 && keyHoldOptions.userKeyHoldMap) {
            flattenKeyMap(keyHoldOptions.userKeyHoldMap, keyHoldMapEntries);
          }
          var delay = (keyHoldOptions === null || keyHoldOptions === void 0 ? void 0 : keyHoldOptions.holdThreshold) || DEFAULT_KEY_HOLD_THRESHOLD;
          var runKeyEvent = handleKeyEvents.bind(null, delay);
          var keyPressHandler = function keyPressHandler(event) {
            return ownerContext(function () {
              runKeyEvent(event, void 0);
            });
          };
          var keyUpHandler = function keyUpHandler(event) {
            return ownerContext(function () {
              runKeyEvent(void 0, event);
            });
          };
          document.addEventListener("keyup", keyUpHandler);
          document.addEventListener("keydown", keyPressHandler);
          return {
            cleanup: function cleanup() {
              document.removeEventListener("keydown", keyPressHandler);
              document.removeEventListener("keyup", keyUpHandler);
              for (var _i6 = 0, _Object$entries3 = Object.entries(keyHoldTimeouts); _i6 < _Object$entries3.length; _i6++) {
                var _Object$entries3$_i = _slicedToArray(_Object$entries3[_i6], 2),
                  _ = _Object$entries3$_i[0],
                  timeout = _Object$entries3$_i[1];
                if (timeout && timeout !== true) clearTimeout(timeout);
              }
            },
            focusPath: function focusPath() {
              return focusPath$1;
            }
          };
        };
        function mergeColorProgress(rgba1, rgba2, p) {
          var r1 = Math.trunc(rgba1 >>> 24);
          var g1 = Math.trunc(rgba1 >>> 16 & 255);
          var b1 = Math.trunc(rgba1 >>> 8 & 255);
          var a1 = Math.trunc(rgba1 & 255);
          var r2 = Math.trunc(rgba2 >>> 24);
          var g2 = Math.trunc(rgba2 >>> 16 & 255);
          var b2 = Math.trunc(rgba2 >>> 8 & 255);
          var a2 = Math.trunc(rgba2 & 255);
          var r = Math.round(r2 * p + r1 * (1 - p));
          var g = Math.round(g2 * p + g1 * (1 - p));
          var b = Math.round(b2 * p + b1 * (1 - p));
          var a = Math.round(a2 * p + a1 * (1 - p));
          return (r << 24 | g << 16 | b << 8 | a) >>> 0;
        }
        var getTimingBezier = function getTimingBezier(a, b, c, d) {
          var xc = 3 * a;
          var xb = 3 * (c - a) - xc;
          var xa = 1 - xc - xb;
          var yc = 3 * b;
          var yb = 3 * (d - b) - yc;
          var ya = 1 - yc - yb;
          return function (time) {
            if (time >= 1) {
              return 1;
            }
            if (time <= 0) {
              return 0;
            }
            var t = 0.5,
              cbx,
              cbxd,
              dx;
            for (var it = 0; it < 20; it++) {
              cbx = t * (t * (t * xa + xb) + xc);
              dx = time - cbx;
              if (dx > -1e-8 && dx < 1e-8) {
                return t * (t * (t * ya + yb) + yc);
              }
              cbxd = t * (t * (3 * xa) + 2 * xb) + xc;
              if (cbxd > 1e-10 && cbxd < 1e-10) {
                break;
              }
              t += dx / cbxd;
            }
            var minT = 0;
            var maxT = 1;
            for (var _it2 = 0; _it2 < 20; _it2++) {
              t = 0.5 * (minT + maxT);
              cbx = t * (t * (t * xa + xb) + xc);
              dx = time - cbx;
              if (dx > -1e-8 && dx < 1e-8) {
                return t * (t * (t * ya + yb) + yc);
              }
              if (dx < 0) {
                maxT = t;
              } else {
                minT = t;
              }
            }
          };
        };
        var timingMapping = {};
        var timingLookup = {
          ease: [0.25, 0.1, 0.25, 1],
          "ease-in": [0.42, 0, 1, 1],
          "ease-out": [0, 0, 0.58, 1],
          "ease-in-out": [0.42, 0, 0.58, 1],
          "ease-in-sine": [0.12, 0, 0.39, 0],
          "ease-out-sine": [0.12, 0, 0.39, 0],
          "ease-in-out-sine": [0.37, 0, 0.63, 1],
          "ease-in-cubic": [0.32, 0, 0.67, 0],
          "ease-out-cubic": [0.33, 1, 0.68, 1],
          "ease-in-out-cubic": [0.65, 0, 0.35, 1],
          "ease-in-circ": [0.55, 0, 1, 0.45],
          "ease-out-circ": [0, 0.55, 0.45, 1],
          "ease-in-out-circ": [0.85, 0, 0.15, 1],
          "ease-in-back": [0.36, 0, 0.66, -0.56],
          "ease-out-back": [0.34, 1.56, 0.64, 1],
          "ease-in-out-back": [0.68, -0.6, 0.32, 1.6]
        };
        var defaultTiming = function defaultTiming(t) {
          return t;
        };
        var parseCubicBezier = function parseCubicBezier(str) {
          var regex = /-?\d*\.?\d+/g;
          var match = str.match(regex);
          if (match) {
            var _match2 = _slicedToArray(match, 4),
              num1 = _match2[0],
              num2 = _match2[1],
              num3 = _match2[2],
              num4 = _match2[3];
            var a = parseFloat(num1 || "0.42");
            var b = parseFloat(num2 || "0");
            var c = parseFloat(num3 || "1");
            var d = parseFloat(num4 || "1");
            var timing = getTimingBezier(a, b, c, d);
            timingMapping[str] = timing;
            return timing;
          }
          console.warn("Unknown cubic-bezier timing: " + str);
          return defaultTiming;
        };
        var getTimingFunction = function getTimingFunction(str) {
          if (str === "linear") {
            return defaultTiming;
          }
          if (timingMapping[str] !== void 0) {
            return timingMapping[str] || defaultTiming;
          }
          if (str === "step-start") {
            return function () {
              return 1;
            };
          }
          if (str === "step-end") {
            return function (time) {
              return time === 1 ? 1 : 0;
            };
          }
          var lookup = timingLookup[str];
          if (lookup !== void 0) {
            var _lookup2 = _slicedToArray(lookup, 4),
              a = _lookup2[0],
              b = _lookup2[1],
              c = _lookup2[2],
              d = _lookup2[3];
            var timing = getTimingBezier(a, b, c, d);
            timingMapping[str] = timing;
            return timing;
          }
          if (str.startsWith("cubic-bezier")) {
            return parseCubicBezier(str);
          }
          console.warn("Unknown timing function: " + str);
          return defaultTiming;
        };
        var SimpleAnimation = /*#__PURE__*/function () {
          function SimpleAnimation() {
            _classCallCheck(this, SimpleAnimation);
            this.nodeConfigs = [];
            this.isRegistered = false;
          }
          return _createClass(SimpleAnimation, [{
            key: "register",
            value: function register(stage) {
              if (this.isRegistered) {
                return;
              }
              this.isRegistered = true;
              this.stage = stage;
              stage.animationManager.registerAnimation(this);
            }
            /**
             * Adds a node and its animation properties to this animation instance.
             * The animation's start values for the specified properties are captured
             * from the node's current state when this method is called.
             *
             * @param node - The CoreNode to animate.
             * @param props - The properties to animate and their target values. Only number properties are supported.
             * @param settings - Animation settings for this specific node animation.
             */
          }, {
            key: "add",
            value: function add(node, key, value, settings) {
              var _settings$duration2, _settings$delay2;
              var existingConfig = this.nodeConfigs.find(function (config) {
                return config.node === node && config.propName === key;
              });
              var duration = (_settings$duration2 = settings.duration) !== null && _settings$duration2 !== void 0 ? _settings$duration2 : 0;
              var delay = (_settings$delay2 = settings.delay) !== null && _settings$delay2 !== void 0 ? _settings$delay2 : 0;
              var easing = settings.easing || "linear";
              var timingFunction = getTimingFunction(easing);
              var targetValue = value;
              var startValue = node[key];
              if (existingConfig) {
                existingConfig.duration = duration;
                existingConfig.delay = delay;
                existingConfig.easing = easing;
                existingConfig.timingFunction = timingFunction;
                existingConfig.targetValue = targetValue;
                existingConfig.startValue = startValue;
                existingConfig.progress = 0;
                existingConfig.delayFor = delay;
              } else {
                this.nodeConfigs.push({
                  node: node,
                  duration: duration,
                  delay: delay,
                  easing: easing,
                  progress: 0,
                  delayFor: delay,
                  timingFunction: timingFunction,
                  propName: key,
                  startValue: startValue,
                  targetValue: targetValue
                });
              }
            }
          }, {
            key: "update",
            value: function update(dt) {
              for (var i = this.nodeConfigs.length - 1; i >= 0; i--) {
                var nodeConfig = this.nodeConfigs[i];
                var node = nodeConfig.node,
                  duration = nodeConfig.duration,
                  timingFunction = nodeConfig.timingFunction,
                  propName = nodeConfig.propName,
                  startValue = nodeConfig.startValue,
                  targetValue = nodeConfig.targetValue;
                var remainingDt = dt;
                if (nodeConfig.delayFor > 0) {
                  nodeConfig.delayFor -= remainingDt;
                  if (nodeConfig.delayFor >= 0) {
                    continue;
                  } else {
                    remainingDt = -nodeConfig.delayFor;
                    nodeConfig.delayFor = 0;
                  }
                }
                if (duration > 0) {
                  nodeConfig.progress += remainingDt / duration;
                  nodeConfig.progress = Math.max(0, Math.min(1, nodeConfig.progress));
                } else if (duration === 0 && nodeConfig.delayFor <= 0) {
                  nodeConfig.progress = 1;
                }
                var easedProgress = timingFunction(nodeConfig.progress) || nodeConfig.progress;
                var interpolatedValue = void 0;
                if (nodeConfig.progress === 1) {
                  interpolatedValue = targetValue;
                } else {
                  if (propName.includes("color")) {
                    interpolatedValue = mergeColorProgress(startValue, targetValue, easedProgress);
                  } else {
                    interpolatedValue = startValue + (targetValue - startValue) * easedProgress;
                  }
                }
                node.lng[propName] = interpolatedValue;
                if (nodeConfig.progress === 1) {
                  this.nodeConfigs.splice(i, 1);
                }
                if (this.nodeConfigs.length === 0) {
                  var _this$stage2;
                  (_this$stage2 = this.stage) === null || _this$stage2 === void 0 || _this$stage2.animationManager.unregisterAnimation(this);
                  this.isRegistered = false;
                }
              }
            }
          }]);
        }();
        var simpleAnimation = new SimpleAnimation();
        var layoutRunQueued = false;
        var layoutQueue = /* @__PURE__ */new Set();
        function runLayout() {
          layoutRunQueued = false;
          var queue = _toConsumableArray(layoutQueue);
          layoutQueue.clear();
          for (var i = queue.length - 1; i >= 0; i--) {
            var node = queue[i];
            node.updateLayout();
          }
        }
        function addToLayoutQueue(node) {
          layoutQueue.add(node);
          if (!layoutRunQueued) {
            layoutRunQueued = true;
            queueMicrotask(runLayout);
          }
        }
        function convertEffectsToShader(node, styleEffects) {
          var effects = [];
          for (var type in styleEffects) {
            var props = styleEffects[type];
            if (type === "rounded") {
              type = "radius";
            }
            if (_typeof(props) === "object") {
              effects.push(renderer$1.createEffect(type, props, type));
            }
          }
          return renderer$1.createShader("DynamicShader", {
            effects: effects
          });
        }
        function borderAccessor() {
          var direction = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : "";
          return {
            set: function set(value) {
              if (isNumber(value)) {
                value = {
                  width: value,
                  color: 255
                };
              }
              this.effects = this.effects ? _objectSpread(_objectSpread({}, this.effects || {}), _defineProperty({}, "border".concat(direction), value)) : _defineProperty({}, "border".concat(direction), value);
            },
            get: function get() {
              var _this$effects;
              return (_this$effects = this.effects) === null || _this$effects === void 0 ? void 0 : _this$effects["border".concat(direction)];
            }
          };
        }
        var LightningRendererNumberProps = ["alpha", "color", "colorTop", "colorRight", "colorLeft", "colorBottom", "colorTl", "colorTr", "colorBl", "colorBr", "height", "fontSize", "lineHeight", "mount", "mountX", "mountY", "pivot", "pivotX", "pivotY", "rotation", "scale", "scaleX", "scaleY", "width", "worldX", "worldY", "x", "y", "zIndex", "zIndexLocked"];
        var LightningRendererNonAnimatingProps = ["absX", "absY", "autosize", "clipping", "contain", "data", "destroyed", "fontFamily", "fontStretch", "fontStyle", "fontWeight", "imageType", "letterSpacing", "maxLines", "offsetY", "overflowSuffix", "preventCleanup", "rtt", "scrollable", "scrollY", "srcHeight", "srcWidth", "srcX", "srcY", "strictBounds", "text", "textAlign", "textBaseline", "textOverflow", "texture", "textureOptions", "verticalAlign", "wordWrap"];
        var ElementNode = /*#__PURE__*/function (_Object) {
          function ElementNode(name) {
            var _this57;
            _classCallCheck(this, ElementNode);
            _this57 = _callSuper(this, ElementNode);
            _this57._type = name === "text" ? NodeType.TextNode : NodeType.Element;
            _this57.rendered = false;
            _this57.lng = {};
            _this57.children = [];
            return _this57;
          }
          _inherits(ElementNode, _Object);
          return _createClass(ElementNode, [{
            key: "effects",
            get: function get() {
              return this._effects;
            },
            set: function set(v) {
              this._effects = v;
              if (SHADERS_ENABLED && this.rendered) {
                this.lng.shader = convertEffectsToShader(this, v);
              }
            }
          }, {
            key: "id",
            get: function get() {
              return this._id;
            },
            set: function set(id) {
              var _Config$rendererOptio;
              this._id = id;
              if ((_Config$rendererOptio = Config.rendererOptions) !== null && _Config$rendererOptio !== void 0 && _Config$rendererOptio.inspector) {
                this.data = _objectSpread(_objectSpread({}, this.data), {}, {
                  testId: id
                });
              }
            }
          }, {
            key: "parent",
            get: function get() {
              return this._parent;
            },
            set: function set(p) {
              this._parent = p;
              if (this.rendered && p !== null && p !== void 0 && p.rendered) {
                var _p$lng;
                this.lng.parent = (_p$lng = p.lng) !== null && _p$lng !== void 0 ? _p$lng : null;
              }
            }
          }, {
            key: "insertChild",
            value: function insertChild(node, beforeNode) {
              if (node.parent) {
                node.parent.removeChild(node);
                if (!this.rendered) {
                  this._hasRenderedChildren = true;
                }
              }
              node.parent = this;
              if (beforeNode) {
                this.removeChild(node);
                var index = this.children.indexOf(beforeNode);
                if (index >= 0) {
                  this.children.splice(index, 0, node);
                  return;
                }
              }
              this.children.push(node);
            }
          }, {
            key: "removeChild",
            value: function removeChild(node) {
              var nodeIndexToRemove = this.children.indexOf(node);
              if (nodeIndexToRemove >= 0) {
                var _node$onRemove;
                this.children.splice(nodeIndexToRemove, 1);
                (_node$onRemove = node.onRemove) === null || _node$onRemove === void 0 || _node$onRemove.call(node, node);
              }
            }
          }, {
            key: "selectedNode",
            get: function get() {
              var selectedIndex = this.selected || 0;
              for (var i = selectedIndex; i < this.children.length; i++) {
                var element = this.children[i];
                if (isElementNode(element)) {
                  this.selected = i;
                  return element;
                }
              }
              return void 0;
            }
          }, {
            key: "shader",
            set: function set(shaderProps) {
              var _renderer$;
              this.lng.shader = isArray(shaderProps) ? (_renderer$ = renderer$1).createShader.apply(_renderer$, _toConsumableArray(shaderProps)) : shaderProps;
            }
          }, {
            key: "_sendToLightningAnimatable",
            value: function _sendToLightningAnimatable(name, value) {
              var _this58 = this;
              if (this.transition && this.rendered && Config.animationsEnabled && (this.transition === true || this.transition[name])) {
                var animationSettings = this.transition === true || this.transition[name] === true ? void 0 : this.transition[name];
                if (Config.simpleAnimationsEnabled) {
                  simpleAnimation.add(this, name, value, animationSettings || this.animationSettings);
                  simpleAnimation.register(renderer$1.stage);
                  return;
                } else {
                  var animationController = this.animate(_defineProperty({}, name, value), animationSettings);
                  if (this.onAnimation) {
                    var animationEvents = Object.keys(this.onAnimation);
                    var _loop6 = function _loop6() {
                      var event = _animationEvents[_i7];
                      var handler = _this58.onAnimation[event];
                      animationController.on(event, function (controller, props) {
                        handler.call(_this58, controller, name, value, props);
                      });
                    };
                    for (var _i7 = 0, _animationEvents = animationEvents; _i7 < _animationEvents.length; _i7++) {
                      _loop6();
                    }
                  }
                  return animationController.start();
                }
              }
              this.lng[name] = value;
            }
          }, {
            key: "animate",
            value: function animate(props, animationSettings) {
              return this.lng.animate(props, animationSettings || this.animationSettings || {});
            }
          }, {
            key: "chain",
            value: function chain(props, animationSettings) {
              if (this._animationRunning) {
                this._animationQueue = [];
                this._animationRunning = false;
              }
              if (animationSettings) {
                this._animationQueueSettings = animationSettings;
              } else if (!this._animationQueueSettings) {
                this._animationQueueSettings = animationSettings || this.animationSettings;
              }
              animationSettings = animationSettings || this._animationQueueSettings;
              this._animationQueue = this._animationQueue || [];
              this._animationQueue.push({
                props: props,
                animationSettings: animationSettings
              });
              return this;
            }
          }, {
            key: "start",
            value: function () {
              var _start = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee18() {
                var animation;
                return _regenerator().w(function (_context19) {
                  while (1) switch (_context19.n) {
                    case 0:
                      animation = this._animationQueue.shift();
                    case 1:
                      if (!animation) {
                        _context19.n = 3;
                        break;
                      }
                      this._animationRunning = true;
                      _context19.n = 2;
                      return this.animate(animation.props, animation.animationSettings).start().waitUntilStopped();
                    case 2:
                      animation = this._animationQueue.shift();
                      _context19.n = 1;
                      break;
                    case 3:
                      this._animationRunning = false;
                      this._animationQueueSettings = void 0;
                    case 4:
                      return _context19.a(2);
                  }
                }, _callee18, this);
              }));
              function start() {
                return _start.apply(this, arguments);
              }
              return start;
            }()
          }, {
            key: "emit",
            value: function emit(event) {
              var current = this;
              var capitalizedEvent = "on".concat(event.charAt(0).toUpperCase()).concat(event.slice(1));
              for (var _len12 = arguments.length, args = new Array(_len12 > 1 ? _len12 - 1 : 0), _key17 = 1; _key17 < _len12; _key17++) {
                args[_key17 - 1] = arguments[_key17];
              }
              while (current) {
                var handler = current[capitalizedEvent];
                if (isFunction(handler)) {
                  if (handler.call.apply(handler, [current, this].concat(args)) === true) {
                    return true;
                  }
                }
                current = current.parent;
              }
              return false;
            }
          }, {
            key: "setFocus",
            value: function setFocus() {
              var _this59 = this;
              if (this.rendered) {
                if (this.forwardFocus !== void 0) {
                  if (isFunc(this.forwardFocus)) {
                    if (this.forwardFocus.call(this, this) !== false) {
                      return;
                    }
                  } else {
                    var focusedIndex = typeof this.forwardFocus === "number" ? this.forwardFocus : null;
                    var nodes = this.children;
                    if (focusedIndex !== null && focusedIndex < nodes.length) {
                      var child = nodes[focusedIndex];
                      isElementNode(child) && child.setFocus();
                      return;
                    }
                  }
                }
                queueMicrotask(function () {
                  return setActiveElement$1(_this59);
                });
              } else {
                this._autofocus = true;
              }
            }
          }, {
            key: "_layoutOnLoad",
            value: function _layoutOnLoad() {
              var _this60 = this;
              this.lng.on("loaded", function () {
                _this60.parent.updateLayout();
              });
            }
          }, {
            key: "getText",
            value: function getText() {
              var result = "";
              for (var i = 0; i < this.children.length; i++) {
                result += this.children[i].text;
              }
              return result;
            }
          }, {
            key: "destroy",
            value: function destroy() {
              var _this61 = this;
              if (this.onDestroy) {
                var destroyPromise = this.onDestroy(this);
                if (destroyPromise instanceof Promise) {
                  destroyPromise.then(function () {
                    return _this61._destroy();
                  });
                } else {
                  this._destroy();
                }
              } else {
                this._destroy();
              }
            }
          }, {
            key: "_destroy",
            value: function _destroy() {
              if (isINode(this.lng)) {
                var _this$parent2;
                this.lng.destroy();
                if ((_this$parent2 = this.parent) !== null && _this$parent2 !== void 0 && _this$parent2.requiresLayout()) {
                  this.parent.updateLayout();
                }
              }
            }
          }, {
            key: "style",
            get: function get() {
              return this._style;
            },
            set: function set(style) {
              if (Config.lockStyles && this._style) {
                return;
              }
              if (!style) {
                return;
              }
              this._style = style;
              for (var key in this._style) {
                if (this[key] === void 0) {
                  this[key] = this._style[key];
                }
              }
            }
          }, {
            key: "hasChildren",
            get: function get() {
              return this.children.length > 0;
            }
          }, {
            key: "src",
            get: function get() {
              return this.lng.src;
            },
            set: function set(src) {
              if (typeof src === "string") {
                this.lng.src = src;
                if (!this.color && this.rendered) {
                  this.color = 4294967295;
                }
              } else {
                this.color = 0;
              }
            }
          }, {
            key: "getChildById",
            value: function getChildById(id) {
              return this.children.find(function (c) {
                return c.id === id;
              });
            }
          }, {
            key: "searchChildrenById",
            value: function searchChildrenById(id) {
              for (var i = 0; i < this.children.length; i++) {
                var child = this.children[i];
                if (isElementNode(child)) {
                  if (child.id === id) {
                    return child;
                  }
                  var found = child.searchChildrenById(id);
                  if (found) {
                    return found;
                  }
                }
              }
            }
          }, {
            key: "states",
            get: function get() {
              this._states = this._states || new States(this._stateChanged.bind(this));
              return this._states;
            },
            set: function set(states) {
              this._states = this._states ? this._states.merge(states) : new States(this._stateChanged.bind(this), states);
              if (this.rendered) {
                this._stateChanged();
              }
            }
          }, {
            key: "animationSettings",
            get: function get() {
              return this._animationSettings || Config.animationSettings;
            },
            set: function set(animationSettings) {
              this._animationSettings = animationSettings;
            }
          }, {
            key: "hidden",
            get: function get() {
              return this.alpha === 0;
            }
            /**
             * Sets the autofocus state of the element.
             * When set to a truthy value, the element will automatically gain focus.
             * You can also set it to a signal to recalculate
             *
             * @param val - A value to determine if the element should autofocus.
             *              A truthy value enables autofocus, otherwise disables it.
             */,
            set: function set(val) {
              this.alpha = val ? 0 : 1;
            }
          }, {
            key: "autofocus",
            get: function get() {
              return this._autofocus;
            },
            set: function set(val) {
              var _this62 = this;
              this._autofocus = val;
              val && queueMicrotask(function () {
                return _this62.setFocus();
              });
            }
          }, {
            key: "requiresLayout",
            value: function requiresLayout() {
              return this.display === "flex" || this.onLayout;
            }
          }, {
            key: "updateLayoutOn",
            get: function get() {
              return null;
            },
            set: function set(v) {
              this.updateLayout();
            }
          }, {
            key: "updateLayout",
            value: function updateLayout() {
              var _this63 = this;
              if (this.hasChildren) {
                if (this.display === "flex" && this.flexGrow && this.width === 0) {
                  return;
                }
                var flexChanged = this.display === "flex" && calculateFlex(this);
                layoutQueue.delete(this);
                var onLayoutChanged = isFunc(this.onLayout) && this.onLayout.call(this, this);
                if ((flexChanged || onLayoutChanged) && this.parent) {
                  addToLayoutQueue(this.parent);
                }
                if (this._containsFlexGrow === true) {
                  this.children.forEach(function (c) {
                    if (c.display === "flex" && isElementNode(c)) {
                      calculateFlex(c);
                      isFunc(c.onLayout) && c.onLayout.call(c, c);
                      addToLayoutQueue(_this63);
                    }
                  });
                }
              }
            }
          }, {
            key: "_stateChanged",
            value: function _stateChanged() {
              var _this64 = this;
              if (this.forwardStates) {
                var states2 = this.states.slice();
                this.children.forEach(function (c) {
                  c.states = states2;
                });
              }
              var states = this.states;
              if (this._undoStyles || keyExists(this, states)) {
                var stylesToUndo;
                if (this._undoStyles && this._undoStyles.length) {
                  stylesToUndo = {};
                  this._undoStyles.forEach(function (styleKey) {
                    stylesToUndo[styleKey] = _this64.style[styleKey];
                  });
                }
                var numStates = states.length;
                if (numStates === 0) {
                  Object.assign(this, stylesToUndo);
                  this._undoStyles = [];
                  return;
                }
                var newStyles;
                if (numStates === 1) {
                  newStyles = this[states[0]];
                  newStyles = stylesToUndo ? _objectSpread(_objectSpread({}, stylesToUndo), newStyles) : newStyles;
                } else {
                  newStyles = states.reduce(function (acc, state) {
                    var styles = _this64[state];
                    return styles ? _objectSpread(_objectSpread({}, acc), styles) : acc;
                  }, stylesToUndo || {});
                }
                if (newStyles) {
                  this._undoStyles = Object.keys(newStyles);
                  if (newStyles.transition !== void 0) {
                    this.transition = newStyles.transition;
                  }
                  Object.assign(this, newStyles);
                } else {
                  this._undoStyles = [];
                }
              }
            }
          }, {
            key: "render",
            value: function render(topNode) {
              var _this$onCreate, _this$onRender2, _node$lng;
              var node = this;
              var parent = this.parent;
              if (!parent) {
                console.warn("Parent not set - no node created for: ", this);
                return;
              }
              if (!parent.rendered) {
                console.warn("Parent not rendered yet: ", this);
                return;
              }
              if (parent.requiresLayout()) {
                layoutQueue.add(parent);
              }
              if (this.rendered) {
                var _this$onRender;
                (_this$onRender = this.onRender) === null || _this$onRender === void 0 || _this$onRender.call(this, this);
                return;
              }
              if (this._states) {
                this._stateChanged();
              }
              var props = node.lng;
              var parentWidth = parent.width || 0;
              var parentHeight = parent.height || 0;
              props.x = props.x || 0;
              props.y = props.y || 0;
              props.parent = parent.lng;
              if (this.right || this.right === 0) {
                props.x = parentWidth - this.right;
                props.mountX = 1;
              }
              if (this.bottom || this.bottom === 0) {
                props.y = parentHeight - this.bottom;
                props.mountY = 1;
              }
              if (this.center) {
                this.centerX = this.centerY = true;
              }
              if (this.centerX) {
                props.x += parentWidth / 2;
                props.mountX = 0.5;
              }
              if (this.centerY) {
                props.y += parentHeight / 2;
                props.mountY = 0.5;
              }
              if (isElementText(node)) {
                var textProps = props;
                if (Config.fontSettings) {
                  for (var key in Config.fontSettings) {
                    if (textProps[key] === void 0) {
                      textProps[key] = Config.fontSettings[key];
                    }
                  }
                }
                textProps.text = textProps.text || node.getText();
                if (textProps.textAlign && !textProps.contain) {
                  console.warn("Text align requires contain: ", node.getText());
                }
                if (textProps.contain) {
                  if (!textProps.width) {
                    textProps.width = parentWidth - textProps.x - (textProps.marginRight || 0);
                  }
                  if (textProps.contain === "both" && !textProps.height && !textProps.maxLines) {
                    textProps.height = parentHeight - textProps.y - (textProps.marginBottom || 0);
                  } else if (textProps.maxLines === 1) {
                    textProps.height = textProps.height || textProps.lineHeight || textProps.fontSize;
                  }
                }
                if (SHADERS_ENABLED && node._effects) {
                  props.shader = convertEffectsToShader(node, node._effects);
                }
                node.lng = renderer$1.createTextNode(props);
                if (parent.requiresLayout()) {
                  if (!props.width || !props.height) {
                    node._layoutOnLoad();
                  }
                }
              } else {
                if (!props.texture) {
                  if (isNaN(props.width)) {
                    props.width = node.flexGrow ? 0 : parentWidth - props.x;
                    node._calcWidth = true;
                  }
                  if (isNaN(props.height)) {
                    props.height = parentHeight - props.y;
                    node._calcHeight = true;
                  }
                  if (props.rtt && !props.color) {
                    props.color = 4294967295;
                  }
                  if (!props.color && !props.src) {
                    props.color = 0;
                  }
                }
                if (SHADERS_ENABLED && node._effects) {
                  props.shader = convertEffectsToShader(node, node._effects);
                }
                node.lng = renderer$1.createNode(props);
                if (node._hasRenderedChildren) {
                  node._hasRenderedChildren = false;
                  var _iterator24 = _createForOfIteratorHelper(node.children),
                    _step24;
                  try {
                    for (_iterator24.s(); !(_step24 = _iterator24.n()).done;) {
                      var child = _step24.value;
                      if (isElementNode(child) && isINode(child.lng)) {
                        child.lng.parent = node.lng;
                      }
                    }
                  } catch (err) {
                    _iterator24.e(err);
                  } finally {
                    _iterator24.f();
                  }
                }
              }
              node.rendered = true;
              if (node.autosize && parent.requiresLayout()) {
                node._layoutOnLoad();
              }
              (_this$onCreate = this.onCreate) === null || _this$onCreate === void 0 || _this$onCreate.call(this, this);
              (_this$onRender2 = this.onRender) === null || _this$onRender2 === void 0 || _this$onRender2.call(this, this);
              if (node.onEvent) {
                var _loop7 = function _loop7() {
                  var _Object$entries4$_i = _slicedToArray(_Object$entries4[_i8], 2),
                    name = _Object$entries4$_i[0],
                    handler = _Object$entries4$_i[1];
                  node.lng.on(name, function (_inode, data) {
                    return handler.call(node, node, data);
                  });
                };
                for (var _i8 = 0, _Object$entries4 = Object.entries(node.onEvent); _i8 < _Object$entries4.length; _i8++) {
                  _loop7();
                }
              }
              if ((_node$lng = node.lng) !== null && _node$lng !== void 0 && _node$lng.div) {
                node.lng.div.element = node;
              }
              if (node._type === NodeType.Element) {
                var numChildren = node.children.length;
                for (var i = 0; i < numChildren; i++) {
                  var c = node.children[i];
                  if (isElementNode(c)) {
                    c.render();
                  }
                }
              }
              if (topNode && !layoutRunQueued) {
                layoutRunQueued = true;
                queueMicrotask(runLayout);
              }
              node._autofocus && node.setFocus();
            }
          }]);
        }(/*#__PURE__*/_wrapNativeSuper(Object));
        exports("E", ElementNode);
        var _loop8 = function _loop8() {
          var key = _LightningRendererNum[_i9];
          Object.defineProperty(ElementNode.prototype, key, {
            get: function get() {
              return this.lng[key];
            },
            set: function set(v) {
              this._sendToLightningAnimatable(key, v);
            }
          });
        };
        for (var _i9 = 0, _LightningRendererNum = LightningRendererNumberProps; _i9 < _LightningRendererNum.length; _i9++) {
          _loop8();
        }
        var _loop9 = function _loop9() {
          var key = _LightningRendererNon[_i0];
          Object.defineProperty(ElementNode.prototype, key, {
            get: function get() {
              return this.lng[key];
            },
            set: function set(v) {
              this.lng[key] = v;
            }
          });
        };
        for (var _i0 = 0, _LightningRendererNon = LightningRendererNonAnimatingProps; _i0 < _LightningRendererNon.length; _i0++) {
          _loop9();
        }
        function createEffectAccessor(key) {
          return {
            set: function set(value) {
              this.effects = this.effects ? _objectSpread(_objectSpread({}, this.effects), {}, _defineProperty({}, key, value)) : _defineProperty({}, key, value);
            },
            get: function get() {
              var _this$effects2;
              return (_this$effects2 = this.effects) === null || _this$effects2 === void 0 ? void 0 : _this$effects2[key];
            }
          };
        }
        Object.defineProperties(ElementNode.prototype, {
          border: borderAccessor(),
          borderLeft: borderAccessor("Left"),
          borderRight: borderAccessor("Right"),
          borderTop: borderAccessor("Top"),
          borderBottom: borderAccessor("Bottom"),
          linearGradient: createEffectAccessor("linearGradient"),
          radialGradient: createEffectAccessor("radialGradient"),
          radialProgress: createEffectAccessor("radialProgressGradient"),
          rounded: {
            set: function set(radius) {
              this.effects = this.effects ? _objectSpread(_objectSpread({}, this.effects), {}, {
                radius: {
                  radius: radius
                }
              }) : {
                radius: {
                  radius: radius
                }
              };
            },
            get: function get() {
              var _this$effects3;
              return (_this$effects3 = this.effects) === null || _this$effects3 === void 0 || (_this$effects3 = _this$effects3.radius) === null || _this$effects3 === void 0 ? void 0 : _this$effects3.radius;
            }
          },
          borderRadius: {
            set: function set(radius) {
              this.effects = this.effects ? _objectSpread(_objectSpread({}, this.effects), {}, {
                radius: {
                  radius: radius
                }
              }) : {
                radius: {
                  radius: radius
                }
              };
            },
            get: function get() {
              var _this$effects4;
              return (_this$effects4 = this.effects) === null || _this$effects4 === void 0 || (_this$effects4 = _this$effects4.radius) === null || _this$effects4 === void 0 ? void 0 : _this$effects4.radius;
            }
          }
        });
        var sharedConfig = {
          context: undefined,
          registry: undefined,
          effects: undefined,
          done: false,
          getContextId: function getContextId() {
            return _getContextId(this.context.count);
          },
          getNextContextId: function getNextContextId() {
            return _getContextId(this.context.count++);
          }
        };
        function _getContextId(count) {
          var num = String(count),
            len = num.length - 1;
          return sharedConfig.context.id + (len ? String.fromCharCode(96 + len) : "") + num;
        }
        function setHydrateContext(context) {
          sharedConfig.context = context;
        }
        var IS_DEV = false;
        var equalFn = function equalFn(a, b) {
          return a === b;
        };
        var $PROXY = Symbol("solid-proxy");
        var SUPPORTS_PROXY$1 = typeof Proxy === "function";
        var $TRACK = Symbol("solid-track");
        var signalOptions = {
          equals: equalFn
        };
        var runEffects = runQueue;
        var STALE = 1;
        var PENDING = 2;
        var UNOWNED = {
          owned: null,
          cleanups: null,
          context: null,
          owner: null
        };
        var NO_INIT = {};
        var Owner = null;
        var Transition = null;
        var ExternalSourceConfig = null;
        var Listener = null;
        var Updates = null;
        var Effects = null;
        var ExecCount = 0;
        function createRoot(fn, detachedOwner) {
          var listener = Listener,
            owner = Owner,
            unowned = fn.length === 0,
            current = detachedOwner === undefined ? owner : detachedOwner,
            root = unowned ? UNOWNED : {
              owned: null,
              cleanups: null,
              context: current ? current.context : null,
              owner: current
            },
            updateFn = unowned ? fn : function () {
              return fn(function () {
                return untrack(function () {
                  return cleanNode(root);
                });
              });
            };
          Owner = root;
          Listener = null;
          try {
            return runUpdates(updateFn, true);
          } finally {
            Listener = listener;
            Owner = owner;
          }
        }
        function createSignal(value, options) {
          options = options ? Object.assign({}, signalOptions, options) : signalOptions;
          var s = {
            value: value,
            observers: null,
            observerSlots: null,
            comparator: options.equals || undefined
          };
          var setter = function setter(value) {
            if (typeof value === "function") {
              if (Transition && Transition.running && Transition.sources.has(s)) value = value(s.tValue);else value = value(s.value);
            }
            return writeSignal(s, value);
          };
          return [readSignal.bind(s), setter];
        }
        function createComputed(fn, value, options) {
          var c = createComputation(fn, value, true, STALE);
          updateComputation(c);
        }
        function createRenderEffect(fn, value, options) {
          var c = createComputation(fn, value, false, STALE);
          updateComputation(c);
        }
        function createEffect(fn, value, options) {
          runEffects = runUserEffects;
          var c = createComputation(fn, value, false, STALE),
            s = SuspenseContext && useContext(SuspenseContext);
          if (s) c.suspense = s;
          c.user = true;
          Effects ? Effects.push(c) : updateComputation(c);
        }
        function createMemo(fn, value, options) {
          options = options ? Object.assign({}, signalOptions, options) : signalOptions;
          var c = createComputation(fn, value, true, 0);
          c.observers = null;
          c.observerSlots = null;
          c.comparator = options.equals || undefined;
          updateComputation(c);
          return readSignal.bind(c);
        }
        function isPromise(v) {
          return v && _typeof(v) === "object" && "then" in v;
        }
        function createResource(pSource, pFetcher, pOptions) {
          var source;
          var fetcher;
          var options;
          if (typeof pFetcher === "function") {
            source = pSource;
            fetcher = pFetcher;
            options = {};
          } else {
            source = true;
            fetcher = pSource;
            options = pFetcher || {};
          }
          var pr = null,
            initP = NO_INIT,
            id = null,
            loadedUnderTransition = false,
            scheduled = false,
            resolved = "initialValue" in options,
            dynamic = typeof source === "function" && createMemo(source);
          var contexts = new Set(),
            _ref31 = (options.storage || createSignal)(options.initialValue),
            _ref32 = _slicedToArray(_ref31, 2),
            value = _ref32[0],
            setValue = _ref32[1],
            _createSignal = createSignal(undefined),
            _createSignal2 = _slicedToArray(_createSignal, 2),
            error = _createSignal2[0],
            setError = _createSignal2[1],
            _createSignal3 = createSignal(undefined, {
              equals: false
            }),
            _createSignal4 = _slicedToArray(_createSignal3, 2),
            track = _createSignal4[0],
            trigger = _createSignal4[1],
            _createSignal5 = createSignal(resolved ? "ready" : "unresolved"),
            _createSignal6 = _slicedToArray(_createSignal5, 2),
            state = _createSignal6[0],
            setState = _createSignal6[1];
          if (sharedConfig.context) {
            id = sharedConfig.getNextContextId();
            if (options.ssrLoadFrom === "initial") initP = options.initialValue;else if (sharedConfig.load && sharedConfig.has(id)) initP = sharedConfig.load(id);
          }
          function loadEnd(p, v, error, key) {
            if (pr === p) {
              pr = null;
              key !== undefined && (resolved = true);
              if ((p === initP || v === initP) && options.onHydrated) queueMicrotask(function () {
                return options.onHydrated(key, {
                  value: v
                });
              });
              initP = NO_INIT;
              if (Transition && p && loadedUnderTransition) {
                Transition.promises.delete(p);
                loadedUnderTransition = false;
                runUpdates(function () {
                  Transition.running = true;
                  completeLoad(v, error);
                }, false);
              } else completeLoad(v, error);
            }
            return v;
          }
          function completeLoad(v, err) {
            runUpdates(function () {
              if (err === undefined) setValue(function () {
                return v;
              });
              setState(err !== undefined ? "errored" : resolved ? "ready" : "unresolved");
              setError(err);
              var _iterator25 = _createForOfIteratorHelper(contexts.keys()),
                _step25;
              try {
                for (_iterator25.s(); !(_step25 = _iterator25.n()).done;) {
                  var c = _step25.value;
                  c.decrement();
                }
              } catch (err) {
                _iterator25.e(err);
              } finally {
                _iterator25.f();
              }
              contexts.clear();
            }, false);
          }
          function read() {
            var c = SuspenseContext && useContext(SuspenseContext),
              v = value(),
              err = error();
            if (err !== undefined && !pr) throw err;
            if (Listener && !Listener.user && c) {
              createComputed(function () {
                track();
                if (pr) {
                  if (c.resolved && Transition && loadedUnderTransition) Transition.promises.add(pr);else if (!contexts.has(c)) {
                    c.increment();
                    contexts.add(c);
                  }
                }
              });
            }
            return v;
          }
          function load() {
            var refetching = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : true;
            if (refetching !== false && scheduled) return;
            scheduled = false;
            var lookup = dynamic ? dynamic() : source;
            loadedUnderTransition = Transition && Transition.running;
            if (lookup == null || lookup === false) {
              loadEnd(pr, untrack(value));
              return;
            }
            if (Transition && pr) Transition.promises.delete(pr);
            var error;
            var p = initP !== NO_INIT ? initP : untrack(function () {
              try {
                return fetcher(lookup, {
                  value: value(),
                  refetching: refetching
                });
              } catch (fetcherError) {
                error = fetcherError;
              }
            });
            if (error !== undefined) {
              loadEnd(pr, undefined, castError(error), lookup);
              return;
            } else if (!isPromise(p)) {
              loadEnd(pr, p, undefined, lookup);
              return p;
            }
            pr = p;
            if ("v" in p) {
              if (p.s === 1) loadEnd(pr, p.v, undefined, lookup);else loadEnd(pr, undefined, castError(p.v), lookup);
              return p;
            }
            scheduled = true;
            queueMicrotask(function () {
              return scheduled = false;
            });
            runUpdates(function () {
              setState(resolved ? "refreshing" : "pending");
              trigger();
            }, false);
            return p.then(function (v) {
              return loadEnd(p, v, undefined, lookup);
            }, function (e) {
              return loadEnd(p, undefined, castError(e), lookup);
            });
          }
          Object.defineProperties(read, {
            state: {
              get: function get() {
                return state();
              }
            },
            error: {
              get: function get() {
                return error();
              }
            },
            loading: {
              get: function get() {
                var s = state();
                return s === "pending" || s === "refreshing";
              }
            },
            latest: {
              get: function get() {
                if (!resolved) return read();
                var err = error();
                if (err && !pr) throw err;
                return value();
              }
            }
          });
          var owner = Owner;
          if (dynamic) createComputed(function () {
            return owner = Owner, load(false);
          });else load(false);
          return [read, {
            refetch: function refetch(info) {
              return runWithOwner(owner, function () {
                return load(info);
              });
            },
            mutate: setValue
          }];
        }
        function createSelector(source) {
          var fn = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : equalFn;
          var options = arguments.length > 2 ? arguments[2] : undefined;
          var subs = new Map();
          var node = createComputation(function (p) {
            var v = source();
            var _iterator26 = _createForOfIteratorHelper(subs.entries()),
              _step26;
            try {
              for (_iterator26.s(); !(_step26 = _iterator26.n()).done;) {
                var _step26$value = _slicedToArray(_step26.value, 2),
                  key = _step26$value[0],
                  val = _step26$value[1];
                if (fn(key, v) !== fn(key, p)) {
                  var _iterator27 = _createForOfIteratorHelper(val.values()),
                    _step27;
                  try {
                    for (_iterator27.s(); !(_step27 = _iterator27.n()).done;) {
                      var c = _step27.value;
                      c.state = STALE;
                      if (c.pure) Updates.push(c);else Effects.push(c);
                    }
                  } catch (err) {
                    _iterator27.e(err);
                  } finally {
                    _iterator27.f();
                  }
                }
              }
            } catch (err) {
              _iterator26.e(err);
            } finally {
              _iterator26.f();
            }
            return v;
          }, undefined, true, STALE);
          updateComputation(node);
          return function (key) {
            var listener = Listener;
            if (listener) {
              var l;
              if (l = subs.get(key)) l.add(listener);else subs.set(key, l = new Set([listener]));
              onCleanup(function () {
                l.delete(listener);
                !l.size && subs.delete(key);
              });
            }
            return fn(key, Transition && Transition.running && Transition.sources.has(node) ? node.tValue : node.value);
          };
        }
        function batch(fn) {
          return runUpdates(fn, false);
        }
        function untrack(fn) {
          if (Listener === null) return fn();
          var listener = Listener;
          Listener = null;
          try {
            if (ExternalSourceConfig) ;
            return fn();
          } finally {
            Listener = listener;
          }
        }
        function on(deps, fn, options) {
          var isArray = Array.isArray(deps);
          var prevInput;
          var defer = options && options.defer;
          return function (prevValue) {
            var input;
            if (isArray) {
              input = Array(deps.length);
              for (var i = 0; i < deps.length; i++) input[i] = deps[i]();
            } else input = deps();
            if (defer) {
              defer = false;
              return prevValue;
            }
            var result = untrack(function () {
              return fn(input, prevInput, prevValue);
            });
            prevInput = input;
            return result;
          };
        }
        function onMount(fn) {
          createEffect(function () {
            return untrack(fn);
          });
        }
        function onCleanup(fn) {
          if (Owner === null) ;else if (Owner.cleanups === null) Owner.cleanups = [fn];else Owner.cleanups.push(fn);
          return fn;
        }
        function getOwner() {
          return Owner;
        }
        function runWithOwner(o, fn) {
          var prev = Owner;
          var prevListener = Listener;
          Owner = o;
          Listener = null;
          try {
            return runUpdates(fn, true);
          } catch (err) {
            handleError(err);
          } finally {
            Owner = prev;
            Listener = prevListener;
          }
        }
        function startTransition(fn) {
          if (Transition && Transition.running) {
            fn();
            return Transition.done;
          }
          var l = Listener;
          var o = Owner;
          return Promise.resolve().then(function () {
            Listener = l;
            Owner = o;
            var t;
            if (SuspenseContext) {
              t = Transition || (Transition = {
                sources: new Set(),
                effects: [],
                promises: new Set(),
                disposed: new Set(),
                queue: new Set(),
                running: true
              });
              t.done || (t.done = new Promise(function (res) {
                return t.resolve = res;
              }));
              t.running = true;
            }
            runUpdates(fn, false);
            Listener = Owner = null;
            return t ? t.done : undefined;
          });
        }
        var _createSignal7 = /*@__PURE__*/createSignal(false),
          _createSignal8 = _slicedToArray(_createSignal7, 2),
          transPending = _createSignal8[0],
          setTransPending = _createSignal8[1];
        function resumeEffects(e) {
          Effects.push.apply(Effects, e);
          e.length = 0;
        }
        function createContext(defaultValue, options) {
          var id = Symbol("context");
          return {
            id: id,
            Provider: createProvider(id),
            defaultValue: defaultValue
          };
        }
        function useContext(context) {
          var value;
          return Owner && Owner.context && (value = Owner.context[context.id]) !== undefined ? value : context.defaultValue;
        }
        function children(fn) {
          var children = createMemo(fn);
          var memo = createMemo(function () {
            return resolveChildren(children());
          });
          memo.toArray = function () {
            var c = memo();
            return Array.isArray(c) ? c : c != null ? [c] : [];
          };
          return memo;
        }
        var SuspenseContext;
        function getSuspenseContext() {
          return SuspenseContext || (SuspenseContext = createContext());
        }
        function readSignal() {
          var _this65 = this;
          var runningTransition = Transition && Transition.running;
          if (this.sources && (runningTransition ? this.tState : this.state)) {
            if ((runningTransition ? this.tState : this.state) === STALE) updateComputation(this);else {
              var updates = Updates;
              Updates = null;
              runUpdates(function () {
                return lookUpstream(_this65);
              }, false);
              Updates = updates;
            }
          }
          if (Listener) {
            var sSlot = this.observers ? this.observers.length : 0;
            if (!Listener.sources) {
              Listener.sources = [this];
              Listener.sourceSlots = [sSlot];
            } else {
              Listener.sources.push(this);
              Listener.sourceSlots.push(sSlot);
            }
            if (!this.observers) {
              this.observers = [Listener];
              this.observerSlots = [Listener.sources.length - 1];
            } else {
              this.observers.push(Listener);
              this.observerSlots.push(Listener.sources.length - 1);
            }
          }
          if (runningTransition && Transition.sources.has(this)) return this.tValue;
          return this.value;
        }
        function writeSignal(node, value, isComp) {
          var current = Transition && Transition.running && Transition.sources.has(node) ? node.tValue : node.value;
          if (!node.comparator || !node.comparator(current, value)) {
            if (Transition) {
              var TransitionRunning = Transition.running;
              if (TransitionRunning || !isComp && Transition.sources.has(node)) {
                Transition.sources.add(node);
                node.tValue = value;
              }
              if (!TransitionRunning) node.value = value;
            } else node.value = value;
            if (node.observers && node.observers.length) {
              runUpdates(function () {
                for (var i = 0; i < node.observers.length; i += 1) {
                  var o = node.observers[i];
                  var _TransitionRunning = Transition && Transition.running;
                  if (_TransitionRunning && Transition.disposed.has(o)) continue;
                  if (_TransitionRunning ? !o.tState : !o.state) {
                    if (o.pure) Updates.push(o);else Effects.push(o);
                    if (o.observers) markDownstream(o);
                  }
                  if (!_TransitionRunning) o.state = STALE;else o.tState = STALE;
                }
                if (Updates.length > 10e5) {
                  Updates = [];
                  if (IS_DEV) ;
                  throw new Error();
                }
              }, false);
            }
          }
          return value;
        }
        function updateComputation(node) {
          if (!node.fn) return;
          cleanNode(node);
          var time = ExecCount;
          runComputation(node, Transition && Transition.running && Transition.sources.has(node) ? node.tValue : node.value, time);
          if (Transition && !Transition.running && Transition.sources.has(node)) {
            queueMicrotask(function () {
              runUpdates(function () {
                Transition && (Transition.running = true);
                Listener = Owner = node;
                runComputation(node, node.tValue, time);
                Listener = Owner = null;
              }, false);
            });
          }
        }
        function runComputation(node, value, time) {
          var nextValue;
          var owner = Owner,
            listener = Listener;
          Listener = Owner = node;
          try {
            nextValue = node.fn(value);
          } catch (err) {
            if (node.pure) {
              if (Transition && Transition.running) {
                node.tState = STALE;
                node.tOwned && node.tOwned.forEach(cleanNode);
                node.tOwned = undefined;
              } else {
                node.state = STALE;
                node.owned && node.owned.forEach(cleanNode);
                node.owned = null;
              }
            }
            node.updatedAt = time + 1;
            return handleError(err);
          } finally {
            Listener = listener;
            Owner = owner;
          }
          if (!node.updatedAt || node.updatedAt <= time) {
            if (node.updatedAt != null && "observers" in node) {
              writeSignal(node, nextValue, true);
            } else if (Transition && Transition.running && node.pure) {
              Transition.sources.add(node);
              node.tValue = nextValue;
            } else node.value = nextValue;
            node.updatedAt = time;
          }
        }
        function createComputation(fn, init, pure) {
          var state = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : STALE;
          var options = arguments.length > 4 ? arguments[4] : undefined;
          var c = {
            fn: fn,
            state: state,
            updatedAt: null,
            owned: null,
            sources: null,
            sourceSlots: null,
            cleanups: null,
            value: init,
            owner: Owner,
            context: Owner ? Owner.context : null,
            pure: pure
          };
          if (Transition && Transition.running) {
            c.state = 0;
            c.tState = state;
          }
          if (Owner === null) ;else if (Owner !== UNOWNED) {
            if (Transition && Transition.running && Owner.pure) {
              if (!Owner.tOwned) Owner.tOwned = [c];else Owner.tOwned.push(c);
            } else {
              if (!Owner.owned) Owner.owned = [c];else Owner.owned.push(c);
            }
          }
          return c;
        }
        function runTop(node) {
          var runningTransition = Transition && Transition.running;
          if ((runningTransition ? node.tState : node.state) === 0) return;
          if ((runningTransition ? node.tState : node.state) === PENDING) return lookUpstream(node);
          if (node.suspense && untrack(node.suspense.inFallback)) return node.suspense.effects.push(node);
          var ancestors = [node];
          while ((node = node.owner) && (!node.updatedAt || node.updatedAt < ExecCount)) {
            if (runningTransition && Transition.disposed.has(node)) return;
            if (runningTransition ? node.tState : node.state) ancestors.push(node);
          }
          for (var i = ancestors.length - 1; i >= 0; i--) {
            node = ancestors[i];
            if (runningTransition) {
              var top = node,
                prev = ancestors[i + 1];
              while ((top = top.owner) && top !== prev) {
                if (Transition.disposed.has(top)) return;
              }
            }
            if ((runningTransition ? node.tState : node.state) === STALE) {
              updateComputation(node);
            } else if ((runningTransition ? node.tState : node.state) === PENDING) {
              var updates = Updates;
              Updates = null;
              runUpdates(function () {
                return lookUpstream(node, ancestors[0]);
              }, false);
              Updates = updates;
            }
          }
        }
        function runUpdates(fn, init) {
          if (Updates) return fn();
          var wait = false;
          if (!init) Updates = [];
          if (Effects) wait = true;else Effects = [];
          ExecCount++;
          try {
            var res = fn();
            completeUpdates(wait);
            return res;
          } catch (err) {
            if (!wait) Effects = null;
            Updates = null;
            handleError(err);
          }
        }
        function completeUpdates(wait) {
          if (Updates) {
            runQueue(Updates);
            Updates = null;
          }
          if (wait) return;
          var res;
          if (Transition) {
            if (!Transition.promises.size && !Transition.queue.size) {
              var sources = Transition.sources;
              var disposed = Transition.disposed;
              Effects.push.apply(Effects, Transition.effects);
              res = Transition.resolve;
              var _iterator28 = _createForOfIteratorHelper(Effects),
                _step28;
              try {
                for (_iterator28.s(); !(_step28 = _iterator28.n()).done;) {
                  var _e = _step28.value;
                  "tState" in _e && (_e.state = _e.tState);
                  delete _e.tState;
                }
              } catch (err) {
                _iterator28.e(err);
              } finally {
                _iterator28.f();
              }
              Transition = null;
              runUpdates(function () {
                var _iterator29 = _createForOfIteratorHelper(disposed),
                  _step29;
                try {
                  for (_iterator29.s(); !(_step29 = _iterator29.n()).done;) {
                    var d = _step29.value;
                    cleanNode(d);
                  }
                } catch (err) {
                  _iterator29.e(err);
                } finally {
                  _iterator29.f();
                }
                var _iterator30 = _createForOfIteratorHelper(sources),
                  _step30;
                try {
                  for (_iterator30.s(); !(_step30 = _iterator30.n()).done;) {
                    var v = _step30.value;
                    v.value = v.tValue;
                    if (v.owned) {
                      for (var i = 0, len = v.owned.length; i < len; i++) cleanNode(v.owned[i]);
                    }
                    if (v.tOwned) v.owned = v.tOwned;
                    delete v.tValue;
                    delete v.tOwned;
                    v.tState = 0;
                  }
                } catch (err) {
                  _iterator30.e(err);
                } finally {
                  _iterator30.f();
                }
                setTransPending(false);
              }, false);
            } else if (Transition.running) {
              Transition.running = false;
              Transition.effects.push.apply(Transition.effects, Effects);
              Effects = null;
              setTransPending(true);
              return;
            }
          }
          var e = Effects;
          Effects = null;
          if (e.length) runUpdates(function () {
            return runEffects(e);
          }, false);
          if (res) res();
        }
        function runQueue(queue) {
          for (var i = 0; i < queue.length; i++) runTop(queue[i]);
        }
        function runUserEffects(queue) {
          var i,
            userLength = 0;
          for (i = 0; i < queue.length; i++) {
            var e = queue[i];
            if (!e.user) runTop(e);else queue[userLength++] = e;
          }
          if (sharedConfig.context) {
            if (sharedConfig.count) {
              var _sharedConfig$effects;
              sharedConfig.effects || (sharedConfig.effects = []);
              (_sharedConfig$effects = sharedConfig.effects).push.apply(_sharedConfig$effects, _toConsumableArray(queue.slice(0, userLength)));
              return;
            }
            setHydrateContext();
          }
          if (sharedConfig.effects && (sharedConfig.done || !sharedConfig.count)) {
            queue = [].concat(_toConsumableArray(sharedConfig.effects), _toConsumableArray(queue));
            userLength += sharedConfig.effects.length;
            delete sharedConfig.effects;
          }
          for (i = 0; i < userLength; i++) runTop(queue[i]);
        }
        function lookUpstream(node, ignore) {
          var runningTransition = Transition && Transition.running;
          if (runningTransition) node.tState = 0;else node.state = 0;
          for (var i = 0; i < node.sources.length; i += 1) {
            var source = node.sources[i];
            if (source.sources) {
              var state = runningTransition ? source.tState : source.state;
              if (state === STALE) {
                if (source !== ignore && (!source.updatedAt || source.updatedAt < ExecCount)) runTop(source);
              } else if (state === PENDING) lookUpstream(source, ignore);
            }
          }
        }
        function markDownstream(node) {
          var runningTransition = Transition && Transition.running;
          for (var i = 0; i < node.observers.length; i += 1) {
            var o = node.observers[i];
            if (runningTransition ? !o.tState : !o.state) {
              if (runningTransition) o.tState = PENDING;else o.state = PENDING;
              if (o.pure) Updates.push(o);else Effects.push(o);
              o.observers && markDownstream(o);
            }
          }
        }
        function cleanNode(node) {
          var i;
          if (node.sources) {
            while (node.sources.length) {
              var source = node.sources.pop(),
                index = node.sourceSlots.pop(),
                obs = source.observers;
              if (obs && obs.length) {
                var n = obs.pop(),
                  s = source.observerSlots.pop();
                if (index < obs.length) {
                  n.sourceSlots[s] = index;
                  obs[index] = n;
                  source.observerSlots[index] = s;
                }
              }
            }
          }
          if (node.tOwned) {
            for (i = node.tOwned.length - 1; i >= 0; i--) cleanNode(node.tOwned[i]);
            delete node.tOwned;
          }
          if (Transition && Transition.running && node.pure) {
            reset(node, true);
          } else if (node.owned) {
            for (i = node.owned.length - 1; i >= 0; i--) cleanNode(node.owned[i]);
            node.owned = null;
          }
          if (node.cleanups) {
            for (i = node.cleanups.length - 1; i >= 0; i--) node.cleanups[i]();
            node.cleanups = null;
          }
          if (Transition && Transition.running) node.tState = 0;else node.state = 0;
        }
        function reset(node, top) {
          if (!top) {
            node.tState = 0;
            Transition.disposed.add(node);
          }
          if (node.owned) {
            for (var i = 0; i < node.owned.length; i++) reset(node.owned[i]);
          }
        }
        function castError(err) {
          if (err instanceof Error) return err;
          return new Error(typeof err === "string" ? err : "Unknown error", {
            cause: err
          });
        }
        function handleError(err) {
          var owner = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : Owner;
          var error = castError(err);
          throw error;
        }
        function resolveChildren(children) {
          if (typeof children === "function" && !children.length) return resolveChildren(children());
          if (Array.isArray(children)) {
            var results = [];
            for (var i = 0; i < children.length; i++) {
              var result = resolveChildren(children[i]);
              Array.isArray(result) ? results.push.apply(results, result) : results.push(result);
            }
            return results;
          }
          return children;
        }
        function createProvider(id, options) {
          return function provider(props) {
            var res;
            createRenderEffect(function () {
              return res = untrack(function () {
                Owner.context = _objectSpread(_objectSpread({}, Owner.context), {}, _defineProperty({}, id, props.value));
                return children(function () {
                  return props.children;
                });
              });
            }, undefined);
            return res;
          };
        }
        var FALLBACK = Symbol("fallback");
        function dispose(d) {
          for (var i = 0; i < d.length; i++) d[i]();
        }
        function mapArray(list, mapFn) {
          var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};
          var items = [],
            mapped = [],
            disposers = [],
            len = 0,
            indexes = mapFn.length > 1 ? [] : null;
          onCleanup(function () {
            return dispose(disposers);
          });
          return function () {
            var newItems = list() || [],
              newLen = newItems.length,
              i,
              j;
            newItems[$TRACK];
            return untrack(function () {
              var newIndices, newIndicesNext, temp, tempdisposers, tempIndexes, start, end, newEnd, item;
              if (newLen === 0) {
                if (len !== 0) {
                  dispose(disposers);
                  disposers = [];
                  items = [];
                  mapped = [];
                  len = 0;
                  indexes && (indexes = []);
                }
                if (options.fallback) {
                  items = [FALLBACK];
                  mapped[0] = createRoot(function (disposer) {
                    disposers[0] = disposer;
                    return options.fallback();
                  });
                  len = 1;
                }
              } else if (len === 0) {
                mapped = new Array(newLen);
                for (j = 0; j < newLen; j++) {
                  items[j] = newItems[j];
                  mapped[j] = createRoot(mapper);
                }
                len = newLen;
              } else {
                temp = new Array(newLen);
                tempdisposers = new Array(newLen);
                indexes && (tempIndexes = new Array(newLen));
                for (start = 0, end = Math.min(len, newLen); start < end && items[start] === newItems[start]; start++);
                for (end = len - 1, newEnd = newLen - 1; end >= start && newEnd >= start && items[end] === newItems[newEnd]; end--, newEnd--) {
                  temp[newEnd] = mapped[end];
                  tempdisposers[newEnd] = disposers[end];
                  indexes && (tempIndexes[newEnd] = indexes[end]);
                }
                newIndices = new Map();
                newIndicesNext = new Array(newEnd + 1);
                for (j = newEnd; j >= start; j--) {
                  item = newItems[j];
                  i = newIndices.get(item);
                  newIndicesNext[j] = i === undefined ? -1 : i;
                  newIndices.set(item, j);
                }
                for (i = start; i <= end; i++) {
                  item = items[i];
                  j = newIndices.get(item);
                  if (j !== undefined && j !== -1) {
                    temp[j] = mapped[i];
                    tempdisposers[j] = disposers[i];
                    indexes && (tempIndexes[j] = indexes[i]);
                    j = newIndicesNext[j];
                    newIndices.set(item, j);
                  } else disposers[i]();
                }
                for (j = start; j < newLen; j++) {
                  if (j in temp) {
                    mapped[j] = temp[j];
                    disposers[j] = tempdisposers[j];
                    if (indexes) {
                      indexes[j] = tempIndexes[j];
                      indexes[j](j);
                    }
                  } else mapped[j] = createRoot(mapper);
                }
                mapped = mapped.slice(0, len = newLen);
                items = newItems.slice(0);
              }
              return mapped;
            });
            function mapper(disposer) {
              disposers[j] = disposer;
              if (indexes) {
                var _createSignal9 = createSignal(j),
                  _createSignal0 = _slicedToArray(_createSignal9, 2),
                  s = _createSignal0[0],
                  set = _createSignal0[1];
                indexes[j] = set;
                return mapFn(newItems[j], s);
              }
              return mapFn(newItems[j]);
            }
          };
        }
        function indexArray(list, mapFn) {
          var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};
          var items = [],
            mapped = [],
            disposers = [],
            signals = [],
            len = 0,
            i;
          onCleanup(function () {
            return dispose(disposers);
          });
          return function () {
            var newItems = list() || [],
              newLen = newItems.length;
            newItems[$TRACK];
            return untrack(function () {
              if (newLen === 0) {
                if (len !== 0) {
                  dispose(disposers);
                  disposers = [];
                  items = [];
                  mapped = [];
                  len = 0;
                  signals = [];
                }
                if (options.fallback) {
                  items = [FALLBACK];
                  mapped[0] = createRoot(function (disposer) {
                    disposers[0] = disposer;
                    return options.fallback();
                  });
                  len = 1;
                }
                return mapped;
              }
              if (items[0] === FALLBACK) {
                disposers[0]();
                disposers = [];
                items = [];
                mapped = [];
                len = 0;
              }
              for (i = 0; i < newLen; i++) {
                if (i < items.length && items[i] !== newItems[i]) {
                  signals[i](function () {
                    return newItems[i];
                  });
                } else if (i >= items.length) {
                  mapped[i] = createRoot(mapper);
                }
              }
              for (; i < items.length; i++) {
                disposers[i]();
              }
              len = signals.length = disposers.length = newLen;
              items = newItems.slice(0);
              return mapped = mapped.slice(0, len);
            });
            function mapper(disposer) {
              disposers[i] = disposer;
              var _createSignal1 = createSignal(newItems[i]),
                _createSignal10 = _slicedToArray(_createSignal1, 2),
                s = _createSignal10[0],
                set = _createSignal10[1];
              signals[i] = set;
              return mapFn(s, i);
            }
          };
        }
        function createComponent$1(Comp, props) {
          return untrack(function () {
            return Comp(props || {});
          });
        }
        function trueFn() {
          return true;
        }
        var propTraps = {
          get: function get(_, property, receiver) {
            if (property === $PROXY) return receiver;
            return _.get(property);
          },
          has: function has(_, property) {
            if (property === $PROXY) return true;
            return _.has(property);
          },
          set: trueFn,
          deleteProperty: trueFn,
          getOwnPropertyDescriptor: function getOwnPropertyDescriptor(_, property) {
            return {
              configurable: true,
              enumerable: true,
              get: function get() {
                return _.get(property);
              },
              set: trueFn,
              deleteProperty: trueFn
            };
          },
          ownKeys: function ownKeys(_) {
            return _.keys();
          }
        };
        function resolveSource(s) {
          return !(s = typeof s === "function" ? s() : s) ? {} : s;
        }
        function resolveSources() {
          for (var i = 0, length = this.length; i < length; ++i) {
            var v = this[i]();
            if (v !== undefined) return v;
          }
        }
        function mergeProps$1() {
          for (var _len13 = arguments.length, sources = new Array(_len13), _key18 = 0; _key18 < _len13; _key18++) {
            sources[_key18] = arguments[_key18];
          }
          var proxy = false;
          for (var i = 0; i < sources.length; i++) {
            var s = sources[i];
            proxy = proxy || !!s && $PROXY in s;
            sources[i] = typeof s === "function" ? (proxy = true, createMemo(s)) : s;
          }
          if (SUPPORTS_PROXY$1 && proxy) {
            return new Proxy({
              get: function get(property) {
                for (var _i1 = sources.length - 1; _i1 >= 0; _i1--) {
                  var v = resolveSource(sources[_i1])[property];
                  if (v !== undefined) return v;
                }
              },
              has: function has(property) {
                for (var _i10 = sources.length - 1; _i10 >= 0; _i10--) {
                  if (property in resolveSource(sources[_i10])) return true;
                }
                return false;
              },
              keys: function keys() {
                var keys = [];
                for (var _i11 = 0; _i11 < sources.length; _i11++) keys.push.apply(keys, _toConsumableArray(Object.keys(resolveSource(sources[_i11]))));
                return _toConsumableArray(new Set(keys));
              }
            }, propTraps);
          }
          var sourcesMap = {};
          var defined = Object.create(null);
          for (var _i12 = sources.length - 1; _i12 >= 0; _i12--) {
            var source = sources[_i12];
            if (!source) continue;
            var sourceKeys = Object.getOwnPropertyNames(source);
            var _loop0 = function _loop0() {
              var key = sourceKeys[_i13];
              if (key === "__proto__" || key === "constructor") return 1; // continue
              var desc = Object.getOwnPropertyDescriptor(source, key);
              if (!defined[key]) {
                defined[key] = desc.get ? {
                  enumerable: true,
                  configurable: true,
                  get: resolveSources.bind(sourcesMap[key] = [desc.get.bind(source)])
                } : desc.value !== undefined ? desc : undefined;
              } else {
                var _sources = sourcesMap[key];
                if (_sources) {
                  if (desc.get) _sources.push(desc.get.bind(source));else if (desc.value !== undefined) _sources.push(function () {
                    return desc.value;
                  });
                }
              }
            };
            for (var _i13 = sourceKeys.length - 1; _i13 >= 0; _i13--) {
              if (_loop0()) continue;
            }
          }
          var target = {};
          var definedKeys = Object.keys(defined);
          for (var _i14 = definedKeys.length - 1; _i14 >= 0; _i14--) {
            var key = definedKeys[_i14],
              desc = defined[key];
            if (desc && desc.get) Object.defineProperty(target, key, desc);else target[key] = desc ? desc.value : undefined;
          }
          return target;
        }
        function splitProps(props) {
          for (var _len14 = arguments.length, keys = new Array(_len14 > 1 ? _len14 - 1 : 0), _key19 = 1; _key19 < _len14; _key19++) {
            keys[_key19 - 1] = arguments[_key19];
          }
          if (SUPPORTS_PROXY$1 && $PROXY in props) {
            var blocked = new Set(keys.length > 1 ? keys.flat() : keys[0]);
            var res = keys.map(function (k) {
              return new Proxy({
                get: function get(property) {
                  return k.includes(property) ? props[property] : undefined;
                },
                has: function has(property) {
                  return k.includes(property) && property in props;
                },
                keys: function keys() {
                  return k.filter(function (property) {
                    return property in props;
                  });
                }
              }, propTraps);
            });
            res.push(new Proxy({
              get: function get(property) {
                return blocked.has(property) ? undefined : props[property];
              },
              has: function has(property) {
                return blocked.has(property) ? false : property in props;
              },
              keys: function keys() {
                return Object.keys(props).filter(function (k) {
                  return !blocked.has(k);
                });
              }
            }, propTraps));
            return res;
          }
          var otherObject = {};
          var objects = keys.map(function () {
            return {};
          });
          var _iterator31 = _createForOfIteratorHelper(Object.getOwnPropertyNames(props)),
            _step31;
          try {
            for (_iterator31.s(); !(_step31 = _iterator31.n()).done;) {
              var propName = _step31.value;
              var desc = Object.getOwnPropertyDescriptor(props, propName);
              var isDefaultDesc = !desc.get && !desc.set && desc.enumerable && desc.writable && desc.configurable;
              var _blocked = false;
              var objectIndex = 0;
              var _iterator32 = _createForOfIteratorHelper(keys),
                _step32;
              try {
                for (_iterator32.s(); !(_step32 = _iterator32.n()).done;) {
                  var k = _step32.value;
                  if (k.includes(propName)) {
                    _blocked = true;
                    isDefaultDesc ? objects[objectIndex][propName] = desc.value : Object.defineProperty(objects[objectIndex], propName, desc);
                  }
                  ++objectIndex;
                }
              } catch (err) {
                _iterator32.e(err);
              } finally {
                _iterator32.f();
              }
              if (!_blocked) {
                isDefaultDesc ? otherObject[propName] = desc.value : Object.defineProperty(otherObject, propName, desc);
              }
            }
          } catch (err) {
            _iterator31.e(err);
          } finally {
            _iterator31.f();
          }
          return [].concat(_toConsumableArray(objects), [otherObject]);
        }
        function lazy(fn) {
          var comp;
          var p;
          var wrap = function wrap(props) {
            var ctx = sharedConfig.context;
            if (ctx) {
              var _createSignal11 = createSignal(),
                _createSignal12 = _slicedToArray(_createSignal11, 2),
                s = _createSignal12[0],
                set = _createSignal12[1];
              sharedConfig.count || (sharedConfig.count = 0);
              sharedConfig.count++;
              (p || (p = fn())).then(function (mod) {
                !sharedConfig.done && setHydrateContext(ctx);
                sharedConfig.count--;
                set(function () {
                  return mod.default;
                });
                setHydrateContext();
              });
              comp = s;
            } else if (!comp) {
              var _createResource = createResource(function () {
                  return (p || (p = fn())).then(function (mod) {
                    return mod.default;
                  });
                }),
                _createResource2 = _slicedToArray(_createResource, 1),
                _s = _createResource2[0];
              comp = _s;
            }
            var Comp;
            return createMemo(function () {
              return (Comp = comp()) ? untrack(function () {
                if (IS_DEV) ;
                if (!ctx || sharedConfig.done) return Comp(props);
                var c = sharedConfig.context;
                setHydrateContext(ctx);
                var r = Comp(props);
                setHydrateContext(c);
                return r;
              }) : "";
            });
          };
          wrap.preload = function () {
            return p || ((p = fn()).then(function (mod) {
              return comp = function comp() {
                return mod.default;
              };
            }), p);
          };
          return wrap;
        }
        var narrowedError = function narrowedError(name) {
          return "Stale read from <".concat(name, ">.");
        };
        function For(props) {
          var fallback = "fallback" in props && {
            fallback: function fallback() {
              return props.fallback;
            }
          };
          return createMemo(mapArray(function () {
            return props.each;
          }, props.children, fallback || undefined));
        }
        function Index(props) {
          var fallback = "fallback" in props && {
            fallback: function fallback() {
              return props.fallback;
            }
          };
          return createMemo(indexArray(function () {
            return props.each;
          }, props.children, fallback || undefined));
        }
        function Show(props) {
          var keyed = props.keyed;
          var conditionValue = createMemo(function () {
            return props.when;
          }, undefined, undefined);
          var condition = keyed ? conditionValue : createMemo(conditionValue, undefined, {
            equals: function equals(a, b) {
              return !a === !b;
            }
          });
          return createMemo(function () {
            var c = condition();
            if (c) {
              var child = props.children;
              var fn = typeof child === "function" && child.length > 0;
              return fn ? untrack(function () {
                return child(keyed ? c : function () {
                  if (!untrack(condition)) throw narrowedError("Show");
                  return conditionValue();
                });
              }) : child;
            }
            return props.fallback;
          }, undefined, undefined);
        }
        function Switch(props) {
          var chs = children(function () {
            return props.children;
          });
          var switchFunc = createMemo(function () {
            var ch = chs();
            var mps = Array.isArray(ch) ? ch : [ch];
            var func = function func() {
              return undefined;
            };
            var _loop1 = function _loop1() {
              var index = i;
              var mp = mps[i];
              var prevFunc = func;
              var conditionValue = createMemo(function () {
                return prevFunc() ? undefined : mp.when;
              }, undefined, undefined);
              var condition = mp.keyed ? conditionValue : createMemo(conditionValue, undefined, {
                equals: function equals(a, b) {
                  return !a === !b;
                }
              });
              func = function func() {
                return prevFunc() || (condition() ? [index, conditionValue, mp] : undefined);
              };
            };
            for (var i = 0; i < mps.length; i++) {
              _loop1();
            }
            return func;
          });
          return createMemo(function () {
            var sel = switchFunc()();
            if (!sel) return props.fallback;
            var _sel = _slicedToArray(sel, 3),
              index = _sel[0],
              conditionValue = _sel[1],
              mp = _sel[2];
            var child = mp.children;
            var fn = typeof child === "function" && child.length > 0;
            return fn ? untrack(function () {
              return child(mp.keyed ? conditionValue() : function () {
                var _untrack;
                if (((_untrack = untrack(switchFunc)()) === null || _untrack === void 0 ? void 0 : _untrack[0]) !== index) throw narrowedError("Match");
                return conditionValue();
              });
            }) : child;
          }, undefined, undefined);
        }
        function Match(props) {
          return props;
        }
        var SuspenseListContext = /* #__PURE__ */createContext();
        function Suspense(props) {
          var counter = 0,
            show,
            ctx,
            p,
            flicker,
            error;
          var _createSignal13 = createSignal(false),
            _createSignal14 = _slicedToArray(_createSignal13, 2),
            inFallback = _createSignal14[0],
            setFallback = _createSignal14[1],
            SuspenseContext = getSuspenseContext(),
            store = {
              increment: function increment() {
                if (++counter === 1) setFallback(true);
              },
              decrement: function decrement() {
                if (--counter === 0) setFallback(false);
              },
              inFallback: inFallback,
              effects: [],
              resolved: false
            },
            owner = getOwner();
          if (sharedConfig.context && sharedConfig.load) {
            var key = sharedConfig.getContextId();
            var ref = sharedConfig.load(key);
            if (ref) {
              if (_typeof(ref) !== "object" || ref.s !== 1) p = ref;else sharedConfig.gather(key);
            }
            if (p && p !== "$$f") {
              var _createSignal15 = createSignal(undefined, {
                  equals: false
                }),
                _createSignal16 = _slicedToArray(_createSignal15, 2),
                s = _createSignal16[0],
                set = _createSignal16[1];
              flicker = s;
              p.then(function () {
                if (sharedConfig.done) return set();
                sharedConfig.gather(key);
                setHydrateContext(ctx);
                set();
                setHydrateContext();
              }, function (err) {
                error = err;
                set();
              });
            }
          }
          var listContext = useContext(SuspenseListContext);
          if (listContext) show = listContext.register(store.inFallback);
          var dispose;
          onCleanup(function () {
            return dispose && dispose();
          });
          return createComponent$1(SuspenseContext.Provider, {
            value: store,
            get children() {
              return createMemo(function () {
                if (error) throw error;
                ctx = sharedConfig.context;
                if (flicker) {
                  flicker();
                  return flicker = undefined;
                }
                if (ctx && p === "$$f") setHydrateContext();
                var rendered = createMemo(function () {
                  return props.children;
                });
                return createMemo(function (prev) {
                  var inFallback = store.inFallback(),
                    _ref33 = show ? show() : {},
                    _ref33$showContent = _ref33.showContent,
                    showContent = _ref33$showContent === void 0 ? true : _ref33$showContent,
                    _ref33$showFallback = _ref33.showFallback,
                    showFallback = _ref33$showFallback === void 0 ? true : _ref33$showFallback;
                  if ((!inFallback || p && p !== "$$f") && showContent) {
                    store.resolved = true;
                    dispose && dispose();
                    dispose = ctx = p = undefined;
                    resumeEffects(store.effects);
                    return rendered();
                  }
                  if (!showFallback) return;
                  if (dispose) return prev;
                  return createRoot(function (disposer) {
                    dispose = disposer;
                    if (ctx) {
                      setHydrateContext({
                        id: ctx.id + "F",
                        count: 0
                      });
                      ctx = undefined;
                    }
                    return props.fallback;
                  }, owner);
                });
              });
            }
          });
        }
        var _createSignal17 = createSignal(void 0),
          _createSignal18 = _slicedToArray(_createSignal17, 2),
          activeElement = _createSignal18[0],
          setActiveElement = _createSignal18[1];
        exports("r", activeElement);
        function hexColor() {
          var color = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : "";
          if (isInteger(color)) {
            return color;
          }
          if (typeof color === "string") {
            if (color.startsWith("#")) {
              return Number(color.replace("#", "0x") + (color.length === 7 ? "ff" : ""));
            }
            if (color.startsWith("0x")) {
              return Number(color);
            }
            return Number("0x" + (color.length === 6 ? color + "ff" : color));
          }
          return 0;
        }
        function combineStyles(style1, style2) {
          if (!style1) {
            return style2;
          }
          if (!style2) {
            return style1;
          }
          return _objectSpread(_objectSpread({}, style2), style1);
        }
        var clamp = function clamp(value, min, max) {
          return min < max ? Math.min(Math.max(value, min), max) : Math.min(Math.max(value, max), min);
        };
        function mod(n, m) {
          if (m === 0) return 0;
          return (n % m + m) % m;
        }
        var memo$1 = function memo$1(fn) {
          return createMemo(function () {
            return fn();
          });
        };
        function createRenderer$1(_ref34) {
          var createElement = _ref34.createElement,
            createTextNode = _ref34.createTextNode,
            isTextNode = _ref34.isTextNode,
            replaceText = _ref34.replaceText,
            insertNode = _ref34.insertNode,
            removeNode = _ref34.removeNode,
            setProperty = _ref34.setProperty,
            getParentNode = _ref34.getParentNode,
            getFirstChild = _ref34.getFirstChild,
            getNextSibling = _ref34.getNextSibling;
          function insert(parent, accessor, marker, initial) {
            if (marker !== undefined && !initial) initial = [];
            if (typeof accessor !== "function") return insertExpression(parent, accessor, initial, marker);
            createRenderEffect(function (current) {
              return insertExpression(parent, accessor(), current, marker);
            }, initial);
          }
          function insertExpression(parent, value, current, marker, unwrapArray) {
            while (typeof current === "function") current = current();
            if (value === current) return current;
            var t = _typeof(value),
              multi = marker !== undefined;
            if (t === "string" || t === "number") {
              if (t === "number") value = value.toString();
              if (multi) {
                var node = current[0];
                if (node && isTextNode(node)) {
                  replaceText(node, value);
                } else node = createTextNode(value);
                current = cleanChildren(parent, current, marker, node);
              } else {
                if (current !== "" && typeof current === "string") {
                  replaceText(getFirstChild(parent), current = value);
                } else {
                  cleanChildren(parent, current, marker, createTextNode(value));
                  current = value;
                }
              }
            } else if (value == null || t === "boolean") {
              current = cleanChildren(parent, current, marker);
            } else if (t === "function") {
              createRenderEffect(function () {
                var v = value();
                while (typeof v === "function") v = v();
                current = insertExpression(parent, v, current, marker);
              });
              return function () {
                return current;
              };
            } else if (Array.isArray(value)) {
              var array = [];
              if (normalizeIncomingArray(array, value, unwrapArray)) {
                createRenderEffect(function () {
                  return current = insertExpression(parent, array, current, marker, true);
                });
                return function () {
                  return current;
                };
              }
              if (array.length === 0) {
                var replacement = cleanChildren(parent, current, marker);
                if (multi) return current = replacement;
              } else {
                if (Array.isArray(current)) {
                  if (current.length === 0) {
                    appendNodes(parent, array, marker);
                  } else reconcileArrays(parent, current, array);
                } else if (current == null || current === "") {
                  appendNodes(parent, array);
                } else {
                  reconcileArrays(parent, multi && current || [getFirstChild(parent)], array);
                }
              }
              current = array;
            } else {
              if (Array.isArray(current)) {
                if (multi) return current = cleanChildren(parent, current, marker, value);
                cleanChildren(parent, current, null, value);
              } else if (current == null || current === "" || !getFirstChild(parent)) {
                insertNode(parent, value);
              } else replaceNode(parent, value, getFirstChild(parent));
              current = value;
            }
            return current;
          }
          function normalizeIncomingArray(normalized, array, unwrap) {
            var dynamic = false;
            for (var i = 0, len = array.length; i < len; i++) {
              var item = array[i],
                t = void 0;
              if (item == null || item === true || item === false) ;else if (Array.isArray(item)) {
                dynamic = normalizeIncomingArray(normalized, item) || dynamic;
              } else if ((t = _typeof(item)) === "string" || t === "number") {
                normalized.push(createTextNode(item));
              } else if (t === "function") {
                if (unwrap) {
                  while (typeof item === "function") item = item();
                  dynamic = normalizeIncomingArray(normalized, Array.isArray(item) ? item : [item]) || dynamic;
                } else {
                  normalized.push(item);
                  dynamic = true;
                }
              } else normalized.push(item);
            }
            return dynamic;
          }
          function reconcileArrays(parentNode, a, b) {
            var bLength = b.length,
              aEnd = a.length,
              bEnd = bLength,
              aStart = 0,
              bStart = 0,
              after = getNextSibling(a[aEnd - 1]),
              map = null;
            while (aStart < aEnd || bStart < bEnd) {
              if (a[aStart] === b[bStart]) {
                aStart++;
                bStart++;
                continue;
              }
              while (a[aEnd - 1] === b[bEnd - 1]) {
                aEnd--;
                bEnd--;
              }
              if (aEnd === aStart) {
                var node = bEnd < bLength ? bStart ? getNextSibling(b[bStart - 1]) : b[bEnd - bStart] : after;
                while (bStart < bEnd) insertNode(parentNode, b[bStart++], node);
              } else if (bEnd === bStart) {
                while (aStart < aEnd) {
                  if (!map || !map.has(a[aStart])) removeNode(parentNode, a[aStart]);
                  aStart++;
                }
              } else if (a[aStart] === b[bEnd - 1] && b[bStart] === a[aEnd - 1]) {
                var _node = getNextSibling(a[--aEnd]);
                insertNode(parentNode, b[bStart++], getNextSibling(a[aStart++]));
                insertNode(parentNode, b[--bEnd], _node);
                a[aEnd] = b[bEnd];
              } else {
                if (!map) {
                  map = new Map();
                  var i = bStart;
                  while (i < bEnd) map.set(b[i], i++);
                }
                var index = map.get(a[aStart]);
                if (index != null) {
                  if (bStart < index && index < bEnd) {
                    var _i15 = aStart,
                      sequence = 1,
                      t = void 0;
                    while (++_i15 < aEnd && _i15 < bEnd) {
                      if ((t = map.get(a[_i15])) == null || t !== index + sequence) break;
                      sequence++;
                    }
                    if (sequence > index - bStart) {
                      var _node2 = a[aStart];
                      while (bStart < index) insertNode(parentNode, b[bStart++], _node2);
                    } else replaceNode(parentNode, b[bStart++], a[aStart++]);
                  } else aStart++;
                } else removeNode(parentNode, a[aStart++]);
              }
            }
          }
          function cleanChildren(parent, current, marker, replacement) {
            if (marker === undefined) {
              var removed;
              while (removed = getFirstChild(parent)) removeNode(parent, removed);
              replacement && insertNode(parent, replacement);
              return "";
            }
            var node = replacement || createTextNode("");
            if (current.length) {
              var inserted = false;
              for (var i = current.length - 1; i >= 0; i--) {
                var el = current[i];
                if (node !== el) {
                  var isParent = getParentNode(el) === parent;
                  if (!inserted && !i) isParent ? replaceNode(parent, node, el) : insertNode(parent, node, marker);else isParent && removeNode(parent, el);
                } else inserted = true;
              }
            } else insertNode(parent, node, marker);
            return [node];
          }
          function appendNodes(parent, array, marker) {
            for (var i = 0, len = array.length; i < len; i++) insertNode(parent, array[i], marker);
          }
          function replaceNode(parent, newNode, oldNode) {
            insertNode(parent, newNode, oldNode);
            removeNode(parent, oldNode);
          }
          function spreadExpression(node, props) {
            var prevProps = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};
            var skipChildren = arguments.length > 3 ? arguments[3] : undefined;
            props || (props = {});
            if (!skipChildren) {
              createRenderEffect(function () {
                return prevProps.children = insertExpression(node, props.children, prevProps.children);
              });
            }
            createRenderEffect(function () {
              return props.ref && props.ref(node);
            });
            createRenderEffect(function () {
              for (var prop in props) {
                if (prop === "children" || prop === "ref") continue;
                var value = props[prop];
                if (value === prevProps[prop]) continue;
                setProperty(node, prop, value, prevProps[prop]);
                prevProps[prop] = value;
              }
            });
            return prevProps;
          }
          return {
            render: function render(code, element) {
              var disposer;
              createRoot(function (dispose) {
                disposer = dispose;
                insert(element, code());
              });
              return disposer;
            },
            insert: insert,
            spread: function spread(node, accessor, skipChildren) {
              if (typeof accessor === "function") {
                createRenderEffect(function (current) {
                  return spreadExpression(node, accessor(), current, skipChildren);
                });
              } else spreadExpression(node, accessor, undefined, skipChildren);
            },
            createElement: createElement,
            createTextNode: createTextNode,
            insertNode: insertNode,
            setProp: function setProp(node, name, value, prev) {
              setProperty(node, name, value, prev);
              return value;
            },
            mergeProps: mergeProps$1,
            effect: createRenderEffect,
            memo: memo$1,
            createComponent: createComponent$1,
            use: function use(fn, element, arg) {
              return untrack(function () {
                return fn(element, arg);
              });
            }
          };
        }
        function createRenderer$2(options) {
          var renderer = createRenderer$1(options);
          renderer.mergeProps = mergeProps$1;
          return renderer;
        }
        Object.defineProperty(ElementNode.prototype, "preserve", {
          get: function get() {
            return this._queueDelete === 0;
          },
          set: function set(v) {
            this._queueDelete = v ? 0 : void 0;
          }
        });
        var elementDeleteQueue = [];
        function flushDeleteQueue() {
          var _iterator33 = _createForOfIteratorHelper(elementDeleteQueue),
            _step33;
          try {
            for (_iterator33.s(); !(_step33 = _iterator33.n()).done;) {
              var el = _step33.value;
              if (Number(el._queueDelete) < 0) {
                el.destroy();
              }
              el._queueDelete = void 0;
            }
          } catch (err) {
            _iterator33.e(err);
          } finally {
            _iterator33.f();
          }
          elementDeleteQueue.length = 0;
        }
        function pushDeleteQueue(node, n) {
          if (node._queueDelete === void 0) {
            node._queueDelete = n;
            if (elementDeleteQueue.push(node) === 1) {
              queueMicrotask(flushDeleteQueue);
            }
          } else {
            node._queueDelete += n;
          }
        }
        var nodeOpts = {
          createElement: function createElement(name) {
            return new ElementNode(name);
          },
          createTextNode: function createTextNode(text) {
            return {
              _type: NodeType.Text,
              text: text
            };
          },
          replaceText: function replaceText(node, value) {
            log("Replace Text: ", node, value);
            node.text = value;
            var parent = node.parent;
            assertTruthy(parent);
            parent.text = parent.getText();
          },
          setProperty: function setProperty(node, name) {
            var value = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;
            node[name] = value;
          },
          insertNode: function insertNode(parent, node, anchor) {
            log("INSERT: ", parent, node, anchor);
            var prevParent = node.parent;
            parent.insertChild(node, anchor);
            if (node instanceof ElementNode) {
              node.parent.rendered && node.render(true);
              if (prevParent !== void 0) {
                pushDeleteQueue(node, 1);
              }
            } else if (isElementText(parent)) {
              parent.text = parent.getText();
            }
          },
          isTextNode: function isTextNode(node) {
            return isElementText(node);
          },
          removeNode: function removeNode(parent, node) {
            log("REMOVE: ", parent, node);
            parent.removeChild(node);
            if (node instanceof ElementNode) {
              pushDeleteQueue(node, -1);
            } else if (isElementText(parent)) {
              parent.text = parent.getText();
            }
          },
          getParentNode: function getParentNode(node) {
            return node.parent;
          },
          getFirstChild: function getFirstChild(node) {
            return node.children[0];
          },
          getNextSibling: function getNextSibling(node) {
            var children = node.parent.children || [];
            var index = children.indexOf(node) + 1;
            if (index < children.length) {
              return children[index];
            }
            return void 0;
          }
        };
        var solidRenderer = createRenderer$2(nodeOpts);
        var renderer;
        var rootNode = nodeOpts.createElement("App");
        var render$1 = function render$1(code) {
          return solidRenderer.render(code, rootNode);
        };
        function createRenderer(rendererOptions, node) {
          var options = Config.rendererOptions;
          renderer = startLightningRenderer(options, "app");
          Config.setActiveElement = setActiveElement;
          rootNode.lng = renderer.root;
          rootNode.rendered = true;
          renderer.on("idle", function () {
            tasksEnabled = true;
            processTasks();
          });
          return {
            renderer: renderer,
            rootNode: rootNode,
            render: render$1
          };
        }
        var effect = solidRenderer.effect,
          memo = solidRenderer.memo,
          createComponent = solidRenderer.createComponent,
          createElement = solidRenderer.createElement,
          createTextNode = solidRenderer.createTextNode,
          insertNode = solidRenderer.insertNode,
          insert = solidRenderer.insert,
          spread = solidRenderer.spread,
          setProp = solidRenderer.setProp,
          mergeProps = solidRenderer.mergeProps,
          use = solidRenderer.use;
        exports({
          a7: effect,
          z: memo,
          h: createComponent,
          k: createElement,
          aa: createTextNode,
          a5: insertNode,
          p: insert,
          n: spread,
          a4: setProp,
          m: mergeProps,
          u: use
        });
        var taskQueue = [];
        var tasksEnabled = false;
        createRoot(function () {
          createRenderEffect(function () {
            activeElement();
            tasksEnabled = false;
          });
        });
        function scheduleTask(callback) {
          var priority = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : "low";
          if (priority === "high") {
            taskQueue.unshift(callback);
          } else {
            taskQueue.push(callback);
          }
          processTasks();
        }
        function processTasks() {
          if (tasksEnabled && taskQueue.length) {
            setTimeout(function () {
              var task = taskQueue.shift();
              if (task) {
                task();
                processTasks();
              }
            }, Config.taskDelay || 50);
          }
        }
        function Dynamic(props) {
          var _splitProps = splitProps(props, ["component"]),
            _splitProps2 = _slicedToArray(_splitProps, 2),
            p = _splitProps2[0],
            others = _splitProps2[1];
          var cached = createMemo(function () {
            return p.component;
          });
          return createMemo(function () {
            var component = cached();
            switch (_typeof(component)) {
              case "function":
                return untrack(function () {
                  return component(others);
                });
              case "string":
                {
                  var el = createElement(component);
                  spread(el, others);
                  return el;
                }
            }
          });
        }
        var View = exports("V", function (props) {
          var el = createElement("node");
          spread(el, props, false);
          return el;
        });
        var Text$1 = exports("T", function (props) {
          var el = createElement("text");
          spread(el, props, false);
          return el;
        });

        /*
         * If not stated otherwise in this file or this component's LICENSE file the
         * following copyright and licenses apply:
         *
         * Copyright 2023 Comcast Cable Communications Management, LLC.
         *
         * Licensed under the Apache License, Version 2.0 (the License);
         * you may not use this file except in compliance with the License.
         * You may obtain a copy of the License at
         *
         * http://www.apache.org/licenses/LICENSE-2.0
         *
         * Unless required by applicable law or agreed to in writing, software
         * distributed under the License is distributed on an "AS IS" BASIS,
         * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
         * See the License for the specific language governing permissions and
         * limitations under the License.
         */
        /**
         * Number of floating point numbers that represent a single glyph in the SDF vertex buffer.
         *
         * @remarks
         * The vertex buffer contains:
         *  - 6 vertex positions
         *  - 6 texture coordinates
         *  - = 12 positions/coordinates per glyph
         *
         * Each vertex position and texture coordinate consist of 2 floating point numbers (x/y).
         * So there are 12 * 2 = 24 floating point numbers that make up a single glyph.
         */
        var FLOATS_PER_GLYPH = 24;

        /*
         * If not stated otherwise in this file or this component's LICENSE file the
         * following copyright and licenses apply:
         *
         * Copyright 2023 Comcast Cable Communications Management, LLC.
         *
         * Licensed under the Apache License, Version 2.0 (the License);
         * you may not use this file except in compliance with the License.
         * You may obtain a copy of the License at
         *
         * http://www.apache.org/licenses/LICENSE-2.0
         *
         * Unless required by applicable law or agreed to in writing, software
         * distributed under the License is distributed on an "AS IS" BASIS,
         * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
         * See the License for the specific language governing permissions and
         * limitations under the License.
         */
        /**
         * Gets the start conditions for the layout loop.
         *
         * @remarks
         * Returns `undefined` if the layout loop should not be run.
         *
         * @param fontSize
         * @param fontSizeRatio
         * @param sdfLineHeight
         * @param renderWindow
         * @param lineCache
         * @param textH
         * @returns
         */
        function getStartConditions(sdfFontSize, sdfLineHeight, fontFace, verticalAlign, offsetY, fontSizeRatio, renderWindow, lineCache, textH) {
          // State variables
          var startLineIndex = Math.min(Math.max(renderWindow.firstLineIdx, 0), lineCache.length);
          var sdfStartX = 0;
          var metrics = fontFace.metrics;
          assertTruthy(metrics, 'Font metrics not loaded');
          assertTruthy(fontFace.data, 'Font data not loaded');
          /**
           * Bare line height is the distance between the ascender and descender of the font.
           * without the line gap metric.
           */
          var sdfBareLineHeight = (metrics.ascender - metrics.descender) * sdfFontSize;
          var sdfVerticalAlignYOffset = 0;
          if (verticalAlign === 'middle') {
            sdfVerticalAlignYOffset = (sdfLineHeight - sdfBareLineHeight) / 2;
          } else if (verticalAlign === 'bottom') {
            sdfVerticalAlignYOffset = sdfLineHeight - sdfBareLineHeight;
          }
          var sdfOffsetY = offsetY / fontSizeRatio;
          /**
           * This is the position from the top of the text drawing line to where the
           * baseline of the text will be according to the encoded positioning data for
           * each glyph in the SDF data. This also happens to be the ascender value
           * that is encoded into the font data.
           */
          var sdfEncodedAscender = fontFace.data.common.base;
          /**
           * This is the ascender that is configured and overridable in the font face.
           */
          var sdfConfiguredAscender = metrics.ascender * sdfFontSize;
          /**
           * If the configured ascender is different from the SDF data's encoded
           * ascender, the offset of the text will be adjusted by the difference.
           */
          var sdfAscenderAdjOffset = sdfConfiguredAscender - sdfEncodedAscender;
          var sdfStartY = sdfOffsetY + sdfAscenderAdjOffset + startLineIndex * sdfLineHeight + sdfVerticalAlignYOffset; // TODO: Figure out what determines the initial y offset of text.
          // Don't attempt to render anything if we know we're starting past the established end of the text
          if (textH && sdfStartY >= textH / fontSizeRatio) {
            return;
          }
          return {
            sdfX: sdfStartX,
            sdfY: sdfStartY,
            lineIndex: startLineIndex
          };
        }

        /*
         * If not stated otherwise in this file or this component's LICENSE file the
         * following copyright and licenses apply:
         *
         * Copyright 2023 Comcast Cable Communications Management, LLC.
         *
         * Licensed under the Apache License, Version 2.0 (the License);
         * you may not use this file except in compliance with the License.
         * You may obtain a copy of the License at
         *
         * http://www.apache.org/licenses/LICENSE-2.0
         *
         * Unless required by applicable law or agreed to in writing, software
         * distributed under the License is distributed on an "AS IS" BASIS,
         * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
         * See the License for the specific language governing permissions and
         * limitations under the License.
         */
        /**
         * A wrapper Generator class that makes a generator peekable.
         */
        // eslint-disable-next-line @typescript-eslint/no-explicit-any
        var PeekableIterator = /*#__PURE__*/function () {
          function PeekableIterator(iterator) {
            var indexBase = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;
            _classCallCheck(this, PeekableIterator);
            _defineProperty(this, "iterator", void 0);
            _defineProperty(this, "peekBuffer", []);
            _defineProperty(this, "_lastIndex", void 0);
            this.iterator = iterator;
            this.iterator = iterator;
            this._lastIndex = indexBase - 1;
            this.peekBuffer = [];
          }
          return _createClass(PeekableIterator, [{
            key: "next",
            value: function next() {
              var nextResult = this.peekBuffer.length > 0 ?
              // eslint-disable-next-line @typescript-eslint/no-non-null-assertion
              this.peekBuffer.pop() : this.iterator.next();
              if (nextResult.done) {
                this._lastIndex = -1;
              } else {
                this._lastIndex++;
              }
              return nextResult;
            }
          }, {
            key: "peek",
            value: function peek() {
              if (this.peekBuffer.length > 0) {
                // We know that the buffer is not empty, so we can safely use the
                // non-null assertion operator
                // eslint-disable-next-line @typescript-eslint/no-non-null-assertion
                return this.peekBuffer[0];
              }
              var result = this.iterator.next();
              this.peekBuffer.push(result);
              return result;
            }
          }, {
            key: "lastIndex",
            get: function get() {
              return this._lastIndex;
            }
          }]);
        }();
        /*
         * If not stated otherwise in this file or this component's LICENSE file the
         * following copyright and licenses apply:
         *
         * Copyright 2023 Comcast Cable Communications Management, LLC.
         *
         * Licensed under the Apache License, Version 2.0 (the License);
         * you may not use this file except in compliance with the License.
         * You may obtain a copy of the License at
         *
         * http://www.apache.org/licenses/LICENSE-2.0
         *
         * Unless required by applicable law or agreed to in writing, software
         * distributed under the License is distributed on an "AS IS" BASIS,
         * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
         * See the License for the specific language governing permissions and
         * limitations under the License.
         */
        // Reversible Generator Wrapper Class
        /**
         * Generator function that yields each Unicode code point in the given string.
         */
        function getUnicodeCodepoints(text) {
          var start = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;
          return /*#__PURE__*/_regenerator().m(function _callee19() {
            var i, codePoint;
            return _regenerator().w(function (_context20) {
              while (1) switch (_context20.n) {
                case 0:
                  i = start;
                case 1:
                  if (!(i < text.length)) {
                    _context20.n = 4;
                    break;
                  }
                  codePoint = text.codePointAt(i);
                  if (!(codePoint === undefined)) {
                    _context20.n = 2;
                    break;
                  }
                  throw new Error('Invalid Unicode code point');
                case 2:
                  _context20.n = 3;
                  return codePoint;
                case 3:
                  i += codePoint <= 0xffff ? 1 : 2;
                  _context20.n = 1;
                  break;
                case 4:
                  return _context20.a(2);
              }
            }, _callee19);
          })();
        }

        /*
         * If not stated otherwise in this file or this component's LICENSE file the
         * following copyright and licenses apply:
         *
         * Copyright 2023 Comcast Cable Communications Management, LLC.
         *
         * Licensed under the Apache License, Version 2.0 (the License);
         * you may not use this file except in compliance with the License.
         * You may obtain a copy of the License at
         *
         * http://www.apache.org/licenses/LICENSE-2.0
         *
         * Unless required by applicable law or agreed to in writing, software
         * distributed under the License is distributed on an "AS IS" BASIS,
         * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
         * See the License for the specific language governing permissions and
         * limitations under the License.
         */
        /**
         * Measures a single-line of text width ignoring any unmapped glyphs including line breaks
         *
         * @param text
         * @param shaperProps
         * @param shaper
         * @returns
         */
        function measureText(text, shaperProps, shaper) {
          var glyphs = shaper.shapeText(shaperProps, new PeekableIterator(getUnicodeCodepoints(text, 0), 0));
          var width = 0;
          var _iterator34 = _createForOfIteratorHelper(glyphs),
            _step34;
          try {
            for (_iterator34.s(); !(_step34 = _iterator34.n()).done;) {
              var glyph = _step34.value;
              if (glyph.mapped && glyph.codepoint !== 8203) {
                // Skip ZWSP (\u200B)
                width += glyph.xAdvance;
              }
            }
          } catch (err) {
            _iterator34.e(err);
          } finally {
            _iterator34.f();
          }
          return width;
        }

        /*
         * If not stated otherwise in this file or this component's LICENSE file the
         * following copyright and licenses apply:
         *
         * Copyright 2023 Comcast Cable Communications Management, LLC.
         *
         * Licensed under the Apache License, Version 2.0 (the License);
         * you may not use this file except in compliance with the License.
         * You may obtain a copy of the License at
         *
         * http://www.apache.org/licenses/LICENSE-2.0
         *
         * Unless required by applicable law or agreed to in writing, software
         * distributed under the License is distributed on an "AS IS" BASIS,
         * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
         * See the License for the specific language governing permissions and
         * limitations under the License.
         */
        function layoutText(curLineIndex, startX, startY, text, textAlign, width, height, fontSize, lineHeight, letterSpacing,
        /**
         * Mutated
         */
        vertexBuffer, contain,
        /**
         * Mutated
         */
        lineCache, rwSdf, trFontFace, forceFullLayoutCalc, scrollable, overflowSuffix, maxLines) {
          assertTruthy(trFontFace, 'Font face must be loaded');
          assertTruthy(trFontFace.loaded, 'Font face must be loaded');
          assertTruthy(trFontFace.data, 'Font face must be loaded');
          assertTruthy(trFontFace.shaper, 'Font face must be loaded');
          // Regardless of fontSize (or other scaling properties), we layout the vertices of each glyph
          // using the fixed coordinate space determined by font size used to produce the atlas.
          // Scaling for display is handled by shader uniforms inexpensively.
          // So we have:
          //  - vertex space: the space in which the vertices of each glyph are laid out
          //  - screen space: the screen pixel space
          // Input properties such as x, y, w, fontSize, letterSpacing, etc. are all expressed in screen space.
          // We convert these to the vertex space by dividing them the `fontSizeRatio` factor.
          /**
           * See above
           */
          var fontSizeRatio = fontSize / trFontFace.data.info.size;
          /**
           * `lineHeight` in vertex coordinates
           */
          var vertexLineHeight = lineHeight / fontSizeRatio;
          /**
           * `w` in vertex coordinates
           */
          var vertexW = width / fontSizeRatio;
          /**
           * `letterSpacing` in vertex coordinates
           */
          var vertexLSpacing = letterSpacing / fontSizeRatio;
          var startingLineCacheEntry = lineCache[curLineIndex];
          var startingCodepointIndex = (startingLineCacheEntry === null || startingLineCacheEntry === void 0 ? void 0 : startingLineCacheEntry.codepointIndex) || 0;
          var startingMaxX = (startingLineCacheEntry === null || startingLineCacheEntry === void 0 ? void 0 : startingLineCacheEntry.maxX) || 0;
          var startingMaxY = (startingLineCacheEntry === null || startingLineCacheEntry === void 0 ? void 0 : startingLineCacheEntry.maxY) || 0;
          var maxX = startingMaxX;
          var maxY = startingMaxY;
          var curX = startX;
          var curY = startY;
          var bufferOffset = 0;
          /**
           * Buffer offset to last word boundry. This is -1 when we aren't in a word boundry.
           */
          var lastWord = {
            codepointIndex: -1,
            bufferOffset: -1,
            xStart: -1
          };
          var shaper = trFontFace.shaper;
          var shaperProps = {
            letterSpacing: vertexLSpacing
          };
          // HACK: The space is used as a word boundary. When a text ends with a space, we need to
          // add an extra space to ensure the space is included in the line width calculation.
          if (text.endsWith(' ')) {
            text += ' ';
          }
          // Get glyphs
          var glyphs = shaper.shapeText(shaperProps, new PeekableIterator(getUnicodeCodepoints(text, startingCodepointIndex), startingCodepointIndex));
          var glyphResult;
          var curLineBufferStart = -1;
          var bufferLineInfos = [];
          var vertexTruncateHeight = height / fontSizeRatio;
          var overflowSuffVertexWidth = measureText(overflowSuffix, shaperProps, shaper);
          // Line-by-line layout
          var moreLines = true;
          while (moreLines) {
            var nextLineWillFit = (maxLines === 0 || curLineIndex + 1 < maxLines) && (contain !== 'both' || scrollable || curY + vertexLineHeight + trFontFace.maxCharHeight <= vertexTruncateHeight);
            var lineVertexW = nextLineWillFit ? vertexW : vertexW - overflowSuffVertexWidth;
            /**
             * Vertex X position to the beginning of the last word boundary. This becomes -1 when we start traversing a word.
             */
            var xStartLastWordBoundary = 0;
            var lineIsBelowWindowTop = curY + trFontFace.maxCharHeight >= rwSdf.y1;
            var lineIsAboveWindowBottom = curY <= rwSdf.y2;
            var lineIsWithinWindow = lineIsBelowWindowTop && lineIsAboveWindowBottom;
            // Layout glyphs in this line
            // Any break statements in this while loop will trigger a line break
            while ((glyphResult = glyphs.next()) && !glyphResult.done) {
              var glyph = glyphResult.value;
              if (curLineIndex === lineCache.length) {
                lineCache.push({
                  codepointIndex: glyph.cluster,
                  maxY: maxY,
                  maxX: maxX
                });
              } else if (curLineIndex > lineCache.length) {
                throw new Error('Unexpected lineCache length');
              }
              // If we encounter a word boundary (white space or newline) we invalidate
              // the lastWord and set the xStartLastWordBoundary if we haven't already.
              if (glyph.codepoint === 32 || glyph.codepoint === 10 || glyph.codepoint === 8203) {
                if (lastWord.codepointIndex !== -1) {
                  lastWord.codepointIndex = -1;
                  xStartLastWordBoundary = curX;
                }
              } else if (lastWord.codepointIndex === -1) {
                lastWord.codepointIndex = glyph.cluster;
                lastWord.bufferOffset = bufferOffset;
                lastWord.xStart = xStartLastWordBoundary;
              }
              if (glyph.mapped) {
                // Mapped glyph
                var charEndX = curX + glyph.xOffset + glyph.width;
                // Word wrap check
                if (
                // We are containing the text
                contain !== 'none' &&
                // The current glyph reaches outside the contained width
                charEndX >= lineVertexW &&
                // There is a last word that we can break to the next line
                lastWord.codepointIndex !== -1 &&
                // Prevents infinite loop when a single word is longer than the width
                lastWord.xStart > 0) {
                  // The current word is about to go off the edge of the container width
                  // Reinitialize the iterator starting at the last word
                  // and proceeding to the next line
                  if (nextLineWillFit) {
                    glyphs = shaper.shapeText(shaperProps, new PeekableIterator(getUnicodeCodepoints(text, lastWord.codepointIndex), lastWord.codepointIndex));
                    bufferOffset = lastWord.bufferOffset;
                    break;
                  } else {
                    glyphs = shaper.shapeText(shaperProps, new PeekableIterator(getUnicodeCodepoints(overflowSuffix, 0), 0));
                    curX = lastWord.xStart;
                    bufferOffset = lastWord.bufferOffset;
                    // HACK: For the rest of the line when inserting the overflow suffix,
                    // set contain = 'none' to prevent an infinite loop.
                    contain = 'none';
                  }
                } else {
                  // This glyph fits, so we can add it to the buffer
                  var quadX = curX + glyph.xOffset;
                  var quadY = curY + glyph.yOffset;
                  // Only add to buffer for rendering if the line is within the render window
                  if (lineIsWithinWindow) {
                    if (curLineBufferStart === -1) {
                      curLineBufferStart = bufferOffset;
                    }
                    var atlasEntry = trFontFace.getAtlasEntry(glyph.glyphId);
                    // Add texture coordinates
                    var u = atlasEntry.x / trFontFace.data.common.scaleW;
                    var v = atlasEntry.y / trFontFace.data.common.scaleH;
                    var uvWidth = atlasEntry.width / trFontFace.data.common.scaleW;
                    var uvHeight = atlasEntry.height / trFontFace.data.common.scaleH;
                    // TODO: (Performance) We can optimize this by using ELEMENT_ARRAY_BUFFER
                    // eliminating the need to duplicate vertices
                    // Top-left
                    vertexBuffer[bufferOffset++] = quadX;
                    vertexBuffer[bufferOffset++] = quadY;
                    vertexBuffer[bufferOffset++] = u;
                    vertexBuffer[bufferOffset++] = v;
                    // Top-right
                    vertexBuffer[bufferOffset++] = quadX + glyph.width;
                    vertexBuffer[bufferOffset++] = quadY;
                    vertexBuffer[bufferOffset++] = u + uvWidth;
                    vertexBuffer[bufferOffset++] = v;
                    // Bottom-left
                    vertexBuffer[bufferOffset++] = quadX;
                    vertexBuffer[bufferOffset++] = quadY + glyph.height;
                    vertexBuffer[bufferOffset++] = u;
                    vertexBuffer[bufferOffset++] = v + uvHeight;
                    // Bottom-right
                    vertexBuffer[bufferOffset++] = quadX + glyph.width;
                    vertexBuffer[bufferOffset++] = quadY + glyph.height;
                    vertexBuffer[bufferOffset++] = u + uvWidth;
                    vertexBuffer[bufferOffset++] = v + uvHeight;
                  }
                  maxY = Math.max(maxY, quadY + glyph.height);
                  maxX = Math.max(maxX, quadX + glyph.width);
                  curX += glyph.xAdvance;
                }
              } else {
                // Unmapped character
                // Handle newlines
                if (glyph.codepoint === 10) {
                  if (nextLineWillFit) {
                    // The whole line fit, so we can break to the next line
                    break;
                  } else {
                    // The whole line won't fit, so we need to add the overflow suffix
                    glyphs = shaper.shapeText(shaperProps, new PeekableIterator(getUnicodeCodepoints(overflowSuffix, 0), 0));
                    // HACK: For the rest of the line when inserting the overflow suffix,
                    // set contain = 'none' to prevent an infinite loop.
                    contain = 'none';
                  }
                }
              }
            }
            // Prepare for the next line...
            if (curLineBufferStart !== -1) {
              bufferLineInfos.push({
                bufferStart: curLineBufferStart,
                bufferEnd: bufferOffset
              });
              curLineBufferStart = -1;
            }
            curX = 0;
            curY += vertexLineHeight;
            curLineIndex++;
            lastWord.codepointIndex = -1;
            xStartLastWordBoundary = 0;
            // Figure out if there are any more lines to render...
            if (!forceFullLayoutCalc && contain === 'both' && curY > rwSdf.y2) {
              // Stop layout calculation early (for performance purposes) if:
              // - We're not forcing a full layout calculation (for width/height calculation)
              // - ...and we're containing the text vertically+horizontally (contain === 'both')
              // - ...and we have a render window
              // - ...and the next line is below the bottom of the render window
              moreLines = false;
            } else if (glyphResult && glyphResult.done) {
              // If we've reached the end of the text, we know we're done
              moreLines = false;
            } else if (!nextLineWillFit) {
              // If we're contained vertically+horizontally (contain === 'both')
              // but not scrollable and the next line won't fit, we're done.
              moreLines = false;
            }
          }
          // Use textAlign to determine if we need to adjust the x position of the text
          // in the buffer line by line
          if (textAlign === 'center') {
            var vertexTextW = contain === 'none' ? maxX : vertexW;
            for (var i = 0; i < bufferLineInfos.length; i++) {
              var line = bufferLineInfos[i];
              // - 4 = the x position of a rightmost vertex
              var lineWidth =
              // eslint-disable-next-line @typescript-eslint/no-non-null-assertion
              vertexBuffer[line.bufferEnd - 4] - vertexBuffer[line.bufferStart];
              var xOffset = (vertexTextW - lineWidth) / 2;
              for (var j = line.bufferStart; j < line.bufferEnd; j += 4) {
                // eslint-disable-next-line @typescript-eslint/no-non-null-assertion
                vertexBuffer[j] += xOffset;
              }
            }
          } else if (textAlign === 'right') {
            var _vertexTextW = contain === 'none' ? maxX : vertexW;
            for (var _i16 = 0; _i16 < bufferLineInfos.length; _i16++) {
              var _line = bufferLineInfos[_i16];
              var _lineWidth = _line.bufferEnd === _line.bufferStart ? 0 :
              // eslint-disable-next-line @typescript-eslint/no-non-null-assertion
              vertexBuffer[_line.bufferEnd - 4] - vertexBuffer[_line.bufferStart];
              var _xOffset = _vertexTextW - _lineWidth;
              for (var _j = _line.bufferStart; _j < _line.bufferEnd; _j += 4) {
                // eslint-disable-next-line @typescript-eslint/no-non-null-assertion
                vertexBuffer[_j] += _xOffset;
              }
            }
          }
          assertTruthy(glyphResult);
          return {
            bufferNumFloats: bufferOffset,
            bufferNumQuads: bufferOffset / 16,
            layoutNumCharacters: glyphResult.done ? text.length - startingCodepointIndex : glyphResult.value.cluster - startingCodepointIndex + 1,
            fullyProcessed: !!glyphResult.done,
            maxX: maxX,
            maxY: maxY,
            numLines: lineCache.length
          };
        }

        /*
         * If not stated otherwise in this file or this component's LICENSE file the
         * following copyright and licenses apply:
         *
         * Copyright 2023 Comcast Cable Communications Management, LLC.
         *
         * Licensed under the Apache License, Version 2.0 (the License);
         * you may not use this file except in compliance with the License.
         * You may obtain a copy of the License at
         *
         * http://www.apache.org/licenses/LICENSE-2.0
         *
         * Unless required by applicable law or agreed to in writing, software
         * distributed under the License is distributed on an "AS IS" BASIS,
         * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
         * See the License for the specific language governing permissions and
         * limitations under the License.
         */
        /**
         * Round up to the nearest multiple of the given number.
         *
         * @param value
         * @param multiple
         * @returns
         */
        function roundUpToMultiple(value, multiple) {
          return Math.ceil(value / multiple) * multiple;
        }
        /**
         * Round down to the nearest multiple of the given number.
         *
         * @param value
         * @param multiple
         * @returns
         */
        function roundDownToMultiple(value, multiple) {
          return Math.floor(value / multiple) * multiple;
        }

        /*
         * If not stated otherwise in this file or this component's LICENSE file the
         * following copyright and licenses apply:
         *
         * Copyright 2023 Comcast Cable Communications Management, LLC.
         *
         * Licensed under the Apache License, Version 2.0 (the License);
         * you may not use this file except in compliance with the License.
         * You may obtain a copy of the License at
         *
         * http://www.apache.org/licenses/LICENSE-2.0
         *
         * Unless required by applicable law or agreed to in writing, software
         * distributed under the License is distributed on an "AS IS" BASIS,
         * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
         * See the License for the specific language governing permissions and
         * limitations under the License.
         */
        /**
         * Create a render window from the given parameters.
         *
         * @remarks
         * The render window is a rectangle that defines the area of the text that
         * should be rendered. It is used to skip rendering parts of the text that
         * are outside of the render window. The render window is relative to the
         * text's top left corner of the overrall text.
         *
         * @param x The x coordinate of the text element's top left corner relative to the screen.
         * @param y The y coordinate of the text element's top left corner relative to the screen.
         * @param scrollY The amount of pixels to scroll the text vertically.
         * @param lineHeight The number of extra lines to render above and below the visible window.
         * @param visibleWindow The visible window of the text element relative to the screen
         * @returns
         */
        function setRenderWindow(outRenderWindow, x, y, scrollY, lineHeight, bufferMargin, visibleWindow, fontSizeRatio) {
          var screen = outRenderWindow.screen,
            sdf = outRenderWindow.sdf;
          if (!isBoundPositive(visibleWindow)) {
            screen.x1 = 0;
            screen.y1 = 0;
            screen.x2 = 0;
            screen.y2 = 0;
            sdf.x1 = 0;
            sdf.y1 = 0;
            sdf.x2 = 0;
            sdf.y2 = 0;
            outRenderWindow.numLines = 0;
            outRenderWindow.firstLineIdx = 0;
          } else {
            var x1 = visibleWindow.x1 - x;
            var x2 = x1 + (visibleWindow.x2 - visibleWindow.x1);
            var y1Base = visibleWindow.y1 - y + scrollY;
            var y1 = roundDownToMultiple(y1Base - bufferMargin, lineHeight || 1);
            var y2 = roundUpToMultiple(y1Base + (visibleWindow.y2 - visibleWindow.y1) + bufferMargin, lineHeight || 1);
            screen.x1 = x1;
            screen.y1 = y1;
            screen.x2 = x2;
            screen.y2 = y2;
            sdf.x1 = x1 / fontSizeRatio;
            sdf.y1 = y1 / fontSizeRatio;
            sdf.x2 = x2 / fontSizeRatio;
            sdf.y2 = y2 / fontSizeRatio;
            outRenderWindow.numLines = Math.ceil((y2 - y1) / lineHeight);
            outRenderWindow.firstLineIdx = lineHeight ? Math.floor(y1 / lineHeight) : 0;
          }
          outRenderWindow.valid = true;
        }

        /**
         * Calculate the default line height given normalized font metrics
         *
         * @remarks
         * This method may be used for both the WebTrFontFace and SdfTrFontFace font types.
         *
         * @param metrics
         * @param fontSize
         * @returns
         */
        function calcDefaultLineHeight(metrics, fontSize) {
          return fontSize * (metrics.ascender - metrics.descender + metrics.lineGap);
        }

        /*
         * If not stated otherwise in this file or this component's LICENSE file the
         * following copyright and licenses apply:
         *
         * Copyright 2023 Comcast Cable Communications Management, LLC.
         *
         * Licensed under the Apache License, Version 2.0 (the License);
         * you may not use this file except in compliance with the License.
         * You may obtain a copy of the License at
         *
         * http://www.apache.org/licenses/LICENSE-2.0
         *
         * Unless required by applicable law or agreed to in writing, software
         * distributed under the License is distributed on an "AS IS" BASIS,
         * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
         * See the License for the specific language governing permissions and
         * limitations under the License.
         */
        /**
         * Ephemeral rect object used for calculations
         */
        var tmpRect = {
          x: 0,
          y: 0,
          width: 0,
          height: 0
        };
        /**
         * Singleton class for rendering text using signed distance fields.
         *
         * @remarks
         * SdfTextRenderer supports both single-channel and multi-channel signed distance fields.
         */
        var SdfTextRenderer = /*#__PURE__*/function (_TextRenderer2) {
          function SdfTextRenderer(stage) {
            var _this66;
            _classCallCheck(this, SdfTextRenderer);
            _this66 = _callSuper(this, SdfTextRenderer, [stage]);
            /**
             * Map of font family names to a set of font faces.
             */
            _defineProperty(_this66, "ssdfFontFamilies", {});
            _defineProperty(_this66, "msdfFontFamilies", {});
            _defineProperty(_this66, "fontFamilyArray", [_this66.ssdfFontFamilies, _this66.msdfFontFamilies]);
            _defineProperty(_this66, "sdfShader", void 0);
            _defineProperty(_this66, "rendererBounds", void 0);
            _defineProperty(_this66, "type", 'sdf');
            _this66.sdfShader = _this66.stage.shManager.loadShader('SdfShader', {
              transform: new Float32Array(),
              color: 0,
              size: 0,
              scrollY: 0,
              distanceRange: 0,
              debug: false
            }).shader;
            _this66.rendererBounds = {
              x1: 0,
              y1: 0,
              x2: _this66.stage.options.appWidth,
              y2: _this66.stage.options.appHeight
            };
            return _this66;
          }
          //#region Overrides
          _inherits(SdfTextRenderer, _TextRenderer2);
          return _createClass(SdfTextRenderer, [{
            key: "getPropertySetters",
            value: function getPropertySetters() {
              var _this67 = this;
              return {
                fontFamily: function fontFamily(state, value) {
                  state.props.fontFamily = value;
                  _this67.releaseFontFace(state);
                  _this67.invalidateLayoutCache(state);
                },
                fontWeight: function fontWeight(state, value) {
                  state.props.fontWeight = value;
                  _this67.releaseFontFace(state);
                  _this67.invalidateLayoutCache(state);
                },
                fontStyle: function fontStyle(state, value) {
                  state.props.fontStyle = value;
                  _this67.releaseFontFace(state);
                  _this67.invalidateLayoutCache(state);
                },
                fontStretch: function fontStretch(state, value) {
                  state.props.fontStretch = value;
                  _this67.releaseFontFace(state);
                  _this67.invalidateLayoutCache(state);
                },
                fontSize: function fontSize(state, value) {
                  state.props.fontSize = value;
                  _this67.invalidateLayoutCache(state);
                },
                text: function text(state, value) {
                  state.props.text = value;
                  _this67.invalidateLayoutCache(state);
                },
                textAlign: function textAlign(state, value) {
                  state.props.textAlign = value;
                  _this67.invalidateLayoutCache(state);
                },
                color: function color(state, value) {
                  state.props.color = value;
                },
                x: function x(state, value) {
                  state.props.x = value;
                  if (state.elementBounds.valid) {
                    _this67.setElementBoundsX(state);
                    // Only schedule an update if the text is not already rendered
                    // (renderWindow is invalid) and the element possibly overlaps the screen
                    // This is to avoid unnecessary updates when we know text is off-screen
                    if (!state.renderWindow.valid && boundsOverlap(state.elementBounds, _this67.rendererBounds)) {
                      _this67.scheduleUpdateState(state);
                    }
                  }
                },
                y: function y(state, value) {
                  state.props.y = value;
                  if (state.elementBounds.valid) {
                    _this67.setElementBoundsY(state);
                    // See x() for explanation
                    if (!state.renderWindow.valid && boundsOverlap(state.elementBounds, _this67.rendererBounds)) {
                      _this67.scheduleUpdateState(state);
                    }
                  }
                },
                contain: function contain(state, value) {
                  state.props.contain = value;
                  _this67.invalidateLayoutCache(state);
                },
                width: function width(state, value) {
                  state.props.width = value;
                  // Only invalidate layout cache if we're containing in the horizontal direction
                  if (state.props.contain !== 'none') {
                    _this67.invalidateLayoutCache(state);
                  }
                },
                height: function height(state, value) {
                  state.props.height = value;
                  // Only invalidate layout cache if we're containing in the vertical direction
                  if (state.props.contain === 'both') {
                    _this67.invalidateLayoutCache(state);
                  }
                },
                offsetY: function offsetY(state, value) {
                  state.props.offsetY = value;
                  _this67.invalidateLayoutCache(state);
                },
                scrollable: function scrollable(state, value) {
                  state.props.scrollable = value;
                  _this67.invalidateLayoutCache(state);
                },
                scrollY: function scrollY(state, value) {
                  state.props.scrollY = value;
                  // Scrolling doesn't need to invalidate any caches, but it does need to
                  // schedule an update
                  _this67.scheduleUpdateState(state);
                },
                letterSpacing: function letterSpacing(state, value) {
                  state.props.letterSpacing = value;
                  _this67.invalidateLayoutCache(state);
                },
                lineHeight: function lineHeight(state, value) {
                  state.props.lineHeight = value;
                  state.resLineHeight = undefined;
                  _this67.invalidateLayoutCache(state);
                },
                maxLines: function maxLines(state, value) {
                  state.props.maxLines = value;
                  _this67.invalidateLayoutCache(state);
                },
                textBaseline: function textBaseline(state, value) {
                  state.props.textBaseline = value;
                  _this67.invalidateLayoutCache(state);
                },
                verticalAlign: function verticalAlign(state, value) {
                  state.props.verticalAlign = value;
                  _this67.invalidateLayoutCache(state);
                },
                overflowSuffix: function overflowSuffix(state, value) {
                  state.props.overflowSuffix = value;
                  _this67.invalidateLayoutCache(state);
                },
                debug: function debug(state, value) {
                  state.props.debug = value;
                }
              };
            }
          }, {
            key: "canRenderFont",
            value: function canRenderFont(props) {
              // TODO: Support matching on font stretch, weight and style (if/when needed)
              // For now we just match on the font family name
              // '$$SDF_FAILURE_TEST$$' is used to test the 'failure' event coming from text
              var fontFamily = props.fontFamily;
              return fontFamily in this.ssdfFontFamilies || fontFamily in this.msdfFontFamilies || fontFamily === '$$SDF_FAILURE_TEST$$';
            }
          }, {
            key: "isFontFaceSupported",
            value: function isFontFaceSupported(fontFace) {
              return fontFace instanceof SdfTrFontFace;
            }
          }, {
            key: "addFontFace",
            value: function addFontFace(fontFace) {
              // Make sure the font face is an SDF font face (it should have already passed
              // the `isFontFaceSupported` check)
              assertTruthy(fontFace instanceof SdfTrFontFace);
              var familyName = fontFace.fontFamily;
              var fontFamiles = fontFace.type === 'ssdf' ? this.ssdfFontFamilies : fontFace.type === 'msdf' ? this.msdfFontFamilies : undefined;
              if (!fontFamiles) {
                console.warn("Invalid font face type: ".concat(fontFace.type));
                return;
              }
              var faceSet = fontFamiles[familyName];
              if (!faceSet) {
                faceSet = new Set();
                fontFamiles[familyName] = faceSet;
              }
              faceSet.add(fontFace);
            }
          }, {
            key: "createState",
            value: function createState(props) {
              return {
                props: props,
                status: 'initialState',
                updateScheduled: false,
                emitter: new EventEmitter(),
                lineCache: [],
                forceFullLayoutCalc: false,
                renderWindow: {
                  screen: {
                    x1: 0,
                    y1: 0,
                    x2: 0,
                    y2: 0
                  },
                  sdf: {
                    x1: 0,
                    y1: 0,
                    x2: 0,
                    y2: 0
                  },
                  firstLineIdx: 0,
                  numLines: 0,
                  valid: false
                },
                elementBounds: {
                  x1: 0,
                  y1: 0,
                  x2: 0,
                  y2: 0,
                  valid: false
                },
                clippingRect: {
                  x: 0,
                  y: 0,
                  width: 0,
                  height: 0,
                  valid: false
                },
                bufferNumFloats: 0,
                bufferNumQuads: 0,
                vertexBuffer: undefined,
                webGlBuffers: null,
                bufferUploaded: false,
                textH: undefined,
                textW: undefined,
                distanceRange: 0,
                trFontFace: undefined,
                isRenderable: false,
                resLineHeight: undefined,
                debugData: {
                  updateCount: 0,
                  layoutCount: 0,
                  lastLayoutNumCharacters: 0,
                  layoutSum: 0,
                  drawSum: 0,
                  drawCount: 0,
                  bufferSize: 0
                }
              };
            }
          }, {
            key: "updateState",
            value: function updateState(state) {
              var _this68 = this;
              var trFontFace = state.trFontFace;
              var textH = state.textH,
                lineCache = state.lineCache,
                debugData = state.debugData,
                forceFullLayoutCalc = state.forceFullLayoutCalc;
              debugData.updateCount++;
              // On the first update call we need to set the status to loading
              if (state.status === 'initialState') {
                this.setStatus(state, 'loading');
              }
              // Resolve font face if we haven't yet
              if (trFontFace === undefined) {
                trFontFace = this.resolveFontFace(state.props);
                state.trFontFace = trFontFace;
                if (trFontFace === undefined) {
                  var msg = "SdfTextRenderer: Could not resolve font face for family: '".concat(state.props.fontFamily, "'");
                  console.error(msg);
                  this.setStatus(state, 'failed', new Error(msg));
                  return;
                }
                trFontFace.texture.setRenderableOwner(state.props.fontFamily, true);
              }
              // If the font hasn't been loaded yet, stop here.
              // Listen for the 'loaded' event and forward fontLoaded event
              if (trFontFace.loaded === false) {
                trFontFace.once('loaded', function () {
                  _this68.scheduleUpdateState(state);
                });
                return;
              }
              // If the font is loaded then so should the data
              assertTruthy(trFontFace.data, 'Font face data should be loaded');
              assertTruthy(trFontFace.metrics, 'Font face metrics should be loaded');
              var _state$props = state.props,
                text = _state$props.text,
                fontSize = _state$props.fontSize,
                x = _state$props.x,
                y = _state$props.y,
                contain = _state$props.contain,
                width = _state$props.width,
                height = _state$props.height,
                verticalAlign = _state$props.verticalAlign,
                scrollable = _state$props.scrollable,
                overflowSuffix = _state$props.overflowSuffix,
                maxLines = _state$props.maxLines;
              // scrollY only has an effect when contain === 'both' and scrollable === true
              var scrollY = contain === 'both' && scrollable ? state.props.scrollY : 0;
              var renderWindow = state.renderWindow;
              /**
               * The font size of the SDF font face (the basis for SDF space units)
               */
              var sdfFontSize = trFontFace.data.info.size;
              /**
               * Divide screen space units by this to get the SDF space units
               * Mulitple SDF space units by this to get screen space units
               */
              var fontSizeRatio = fontSize / sdfFontSize;
              // If not already resolved, resolve the line height and store it in the state
              var resLineHeight = state.resLineHeight;
              if (resLineHeight === undefined) {
                var lineHeight = state.props.lineHeight;
                // If lineHeight is undefined, use the maxCharHeight from the font face
                if (lineHeight === undefined) {
                  resLineHeight = calcDefaultLineHeight(trFontFace.metrics, fontSize);
                } else {
                  resLineHeight = lineHeight;
                }
                state.resLineHeight = resLineHeight;
              }
              // Needed in renderWindow calculation
              var sdfLineHeight = resLineHeight / fontSizeRatio;
              state.distanceRange = fontSizeRatio * trFontFace.data.distanceField.distanceRange;
              // Allocate buffers if needed
              var neededLength = text.length * FLOATS_PER_GLYPH;
              var vertexBuffer = state.vertexBuffer;
              if (!vertexBuffer || vertexBuffer.length < neededLength) {
                vertexBuffer = new Float32Array(neededLength * 2);
              }
              var elementBounds = state.elementBounds;
              if (!elementBounds.valid) {
                this.setElementBoundsX(state);
                this.setElementBoundsY(state);
                elementBounds.valid = true;
              }
              // Return early if we're still viewing inside the established render window
              // No need to re-render what we've already rendered
              // (Only if there's an established renderWindow and we're not suppressing early exit)
              if (!forceFullLayoutCalc && renderWindow.valid) {
                var rwScreen = renderWindow.screen;
                if (x + rwScreen.x1 <= elementBounds.x1 && x + rwScreen.x2 >= elementBounds.x2 && y - scrollY + rwScreen.y1 <= elementBounds.y1 && y - scrollY + rwScreen.y2 >= elementBounds.y2) {
                  this.setStatus(state, 'loaded');
                  return;
                }
                // Otherwise invalidate the renderWindow so it can be redone
                renderWindow.valid = false;
                this.setStatus(state, 'loading');
              }
              var _state$props2 = state.props,
                offsetY = _state$props2.offsetY,
                textAlign = _state$props2.textAlign;
              // Create a new renderWindow if needed
              if (!renderWindow.valid) {
                var isPossiblyOnScreen = boundsOverlap(elementBounds, this.rendererBounds);
                if (!isPossiblyOnScreen) {
                  // If the element is not possibly on screen, we can skip the layout and rendering completely
                  return;
                }
                setRenderWindow(renderWindow, x, y, scrollY, resLineHeight, contain === 'both' ? elementBounds.y2 - elementBounds.y1 : 0, elementBounds, fontSizeRatio);
                // console.log('newRenderWindow', renderWindow);
              }
              var start = getStartConditions(sdfFontSize, sdfLineHeight, trFontFace, verticalAlign, offsetY, fontSizeRatio, renderWindow, lineCache, textH);
              if (!start) {
                // Nothing to render, return early, but still mark as loaded (since the text is just scrolled
                // out of view)
                this.setStatus(state, 'loaded');
                return;
              }
              var letterSpacing = state.props.letterSpacing;
              var out2 = layoutText(start.lineIndex, start.sdfX, start.sdfY, text, textAlign, width, height, fontSize, resLineHeight, letterSpacing, vertexBuffer, contain, lineCache, renderWindow.sdf, trFontFace, forceFullLayoutCalc, scrollable, overflowSuffix, maxLines);
              state.bufferUploaded = false;
              state.bufferNumFloats = out2.bufferNumFloats;
              state.bufferNumQuads = out2.bufferNumQuads;
              state.vertexBuffer = vertexBuffer;
              state.renderWindow = renderWindow;
              debugData.lastLayoutNumCharacters = out2.layoutNumCharacters;
              debugData.bufferSize = vertexBuffer.byteLength;
              // If we didn't exit early, we know we have completely computed w/h
              if (out2.fullyProcessed) {
                state.textW = out2.maxX * fontSizeRatio;
                state.textH = out2.numLines * sdfLineHeight * fontSizeRatio;
              }
              // if (state.props.debug.printLayoutTime) {
              //   debugData.layoutSum += performance.now() - updateStartTime;
              //   debugData.layoutCount++;
              // }
              this.setStatus(state, 'loaded');
            }
          }, {
            key: "renderQuads",
            value: function renderQuads(state, transform, clippingRect, alpha, parentHasRenderTexture, framebufferDimensions) {
              var _trFontFace$data, _state$trFontFace;
              if (!state.vertexBuffer) {
                // Nothing to draw
                return;
              }
              var renderer = this.stage.renderer;
              assertTruthy(renderer instanceof WebGlCoreRenderer);
              var _state$props3 = state.props,
                fontSize = _state$props3.fontSize,
                color = _state$props3.color,
                contain = _state$props3.contain,
                scrollable = _state$props3.scrollable,
                zIndex = _state$props3.zIndex,
                debug = _state$props3.debug;
              // scrollY only has an effect when contain === 'both' and scrollable === true
              var scrollY = contain === 'both' && scrollable ? state.props.scrollY : 0;
              var _state$textW = state.textW,
                textW = _state$textW === void 0 ? 0 : _state$textW,
                _state$textH = state.textH,
                textH = _state$textH === void 0 ? 0 : _state$textH,
                distanceRange = state.distanceRange,
                vertexBuffer = state.vertexBuffer,
                bufferUploaded = state.bufferUploaded,
                trFontFace = state.trFontFace,
                elementBounds = state.elementBounds;
              var webGlBuffers = state.webGlBuffers;
              if (!webGlBuffers) {
                var glw = renderer.glw;
                var stride = 4 * Float32Array.BYTES_PER_ELEMENT;
                var webGlBuffer = glw.createBuffer();
                assertTruthy(webGlBuffer);
                state.webGlBuffers = new BufferCollection([{
                  buffer: webGlBuffer,
                  attributes: {
                    a_position: {
                      name: 'a_position',
                      size: 2,
                      // 2 components per iteration
                      type: glw.FLOAT,
                      // the data is 32bit floats
                      normalized: false,
                      // don't normalize the data
                      stride: stride,
                      // 0 = move forward size * sizeof(type) each iteration to get the next position
                      offset: 0 // start at the beginning of the buffer
                    },
                    a_textureCoordinate: {
                      name: 'a_textureCoordinate',
                      size: 2,
                      type: glw.FLOAT,
                      normalized: false,
                      stride: stride,
                      offset: 2 * Float32Array.BYTES_PER_ELEMENT
                    }
                  }
                }]);
                state.bufferUploaded = false;
                assertTruthy(state.webGlBuffers);
                webGlBuffers = state.webGlBuffers;
              }
              if (!bufferUploaded) {
                var _webGlBuffers$getBuff, _webGlBuffers;
                var _glw = renderer.glw;
                var buffer = (_webGlBuffers$getBuff = (_webGlBuffers = webGlBuffers) === null || _webGlBuffers === void 0 ? void 0 : _webGlBuffers.getBuffer('a_textureCoordinate')) !== null && _webGlBuffers$getBuff !== void 0 ? _webGlBuffers$getBuff : null;
                _glw.arrayBufferData(buffer, vertexBuffer, _glw.STATIC_DRAW);
                state.bufferUploaded = true;
              }
              assertTruthy(trFontFace);
              if (scrollable && contain === 'both') {
                assertTruthy(elementBounds.valid);
                var elementRect = convertBoundToRect(elementBounds, tmpRect);
                if (clippingRect.valid) {
                  state.clippingRect.valid = true;
                  clippingRect = intersectRect(clippingRect, elementRect, state.clippingRect);
                } else {
                  state.clippingRect.valid = true;
                  clippingRect = copyRect(elementRect, state.clippingRect);
                }
              }
              var renderOp = new WebGlCoreRenderOp(renderer.glw, renderer.options, webGlBuffers, this.sdfShader, {
                transform: transform.getFloatArr(),
                // IMPORTANT: The SDF Shader expects the color NOT to be premultiplied
                // for the best blending results. Which is why we use `mergeColorAlpha`
                // instead of `mergeColorAlphaPremultiplied` here.
                color: mergeColorAlpha(color, alpha),
                size: fontSize / (((_trFontFace$data = trFontFace.data) === null || _trFontFace$data === void 0 ? void 0 : _trFontFace$data.info.size) || 0),
                scrollY: scrollY,
                distanceRange: distanceRange,
                debug: debug.sdfShaderDebug
              }, alpha, clippingRect, {
                height: textH,
                width: textW
              }, 0, zIndex, false, parentHasRenderTexture, framebufferDimensions);
              var texture = (_state$trFontFace = state.trFontFace) === null || _state$trFontFace === void 0 ? void 0 : _state$trFontFace.texture;
              assertTruthy(texture);
              var ctxTexture = texture.ctxTexture;
              renderOp.addTexture(ctxTexture);
              renderOp.length = state.bufferNumFloats;
              renderOp.numQuads = state.bufferNumQuads;
              renderer.addRenderOp(renderOp);
              // if (!debug.disableScissor) {
              //   renderer.enableScissor(
              //     visibleRect.x,
              //     visibleRect.y,
              //     visibleRect.w,
              //     visibleRect.h,
              //   );
              // }
              // Draw the arrays
              // gl.drawArrays(
              //   gl.TRIANGLES, // Primitive type
              //   0,
              //   bufferNumVertices, // Number of verticies
              // );
              // renderer.disableScissor();
              // if (debug.showElementRect) {
              //   this.renderer.drawBorder(
              //     Colors.Blue,
              //     elementRect.x,
              //     elementRect.y,
              //     elementRect.w,
              //     elementRect.h,
              //   );
              // }
              // if (debug.showVisibleRect) {
              //   this.renderer.drawBorder(
              //     Colors.Green,
              //     visibleRect.x,
              //     visibleRect.y,
              //     visibleRect.w,
              //     visibleRect.h,
              //   );
              // }
              // if (debug.showRenderWindow && renderWindow) {
              //   this.renderer.drawBorder(
              //     Colors.Red,
              //     x + renderWindow.x1,
              //     y + renderWindow.y1 - scrollY,
              //     x + renderWindow.x2 - (x + renderWindow.x1),
              //     y + renderWindow.y2 - scrollY - (y + renderWindow.y1 - scrollY),
              //   );
              // }
              // if (debug.printLayoutTime) {
              //   debugData.drawSum += performance.now() - drawStartTime;
              //   debugData.drawCount++;
              // }
            }
          }, {
            key: "setIsRenderable",
            value: function setIsRenderable(state, renderable) {
              var _state$trFontFace2;
              _superPropGet(SdfTextRenderer, "setIsRenderable", this, 3)([state, renderable]);
              (_state$trFontFace2 = state.trFontFace) === null || _state$trFontFace2 === void 0 || _state$trFontFace2.texture.setRenderableOwner(state.props.fontFamily, renderable);
            }
          }, {
            key: "destroyState",
            value: function destroyState(state) {
              var _state$trFontFace3;
              _superPropGet(SdfTextRenderer, "destroyState", this, 3)([state]);
              // If there's a Font Face assigned we must free the owner relation to its texture
              (_state$trFontFace3 = state.trFontFace) === null || _state$trFontFace3 === void 0 || _state$trFontFace3.texture.setRenderableOwner(state.props.fontFamily, false);
            }
            //#endregion Overrides
          }, {
            key: "resolveFontFace",
            value: function resolveFontFace(props) {
              return this.stage.fontManager.resolveFontFace(this.fontFamilyArray, props, 'sdf');
            }
            /**
             * Release the loaded SDF font face
             *
             * @param state
             */
          }, {
            key: "releaseFontFace",
            value: function releaseFontFace(state) {
              state.resLineHeight = undefined;
              if (state.trFontFace) {
                state.trFontFace.texture.setRenderableOwner(state.props.fontFamily, false);
                state.trFontFace = undefined;
              }
            }
            /**
             * Invalidate the layout cache stored in the state. This will cause the text
             * to be re-layed out on the next update.
             *
             * @remarks
             * This also invalidates the visible window cache.
             *
             * @param state
             */
          }, {
            key: "invalidateLayoutCache",
            value: function invalidateLayoutCache(state) {
              state.renderWindow.valid = false;
              state.elementBounds.valid = false;
              state.textH = undefined;
              state.textW = undefined;
              state.lineCache = [];
              this.setStatus(state, 'loading');
              this.scheduleUpdateState(state);
            }
          }, {
            key: "setElementBoundsX",
            value: function setElementBoundsX(state) {
              var _state$props4 = state.props,
                x = _state$props4.x,
                contain = _state$props4.contain,
                width = _state$props4.width;
              var elementBounds = state.elementBounds;
              elementBounds.x1 = x;
              elementBounds.x2 = contain !== 'none' ? x + width : Infinity;
            }
          }, {
            key: "setElementBoundsY",
            value: function setElementBoundsY(state) {
              var _state$props5 = state.props,
                y = _state$props5.y,
                contain = _state$props5.contain,
                height = _state$props5.height;
              var elementBounds = state.elementBounds;
              elementBounds.y1 = y;
              elementBounds.y2 = contain === 'both' ? y + height : Infinity;
            }
          }]);
        }(TextRenderer);
        /*
         * If not stated otherwise in this file or this component's LICENSE file the
         * following copyright and licenses apply:
         *
         * Copyright 2023 Comcast Cable Communications Management, LLC.
         *
         * Licensed under the Apache License, Version 2.0 (the License);
         * you may not use this file except in compliance with the License.
         * You may obtain a copy of the License at
         *
         * http://www.apache.org/licenses/LICENSE-2.0
         *
         * Unless required by applicable law or agreed to in writing, software
         * distributed under the License is distributed on an "AS IS" BASIS,
         * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
         * See the License for the specific language governing permissions and
         * limitations under the License.
         */
        /**
         * Returns CSS font setting string for use in canvas context.
         *
         * @param fontFace
         * @param fontStyle
         * @param fontSize
         * @param precision
         * @param defaultFontFace
         * @returns
         */
        /**
         * Returns true if the given character is a zero-width space.
         *
         * @param space
         */
        function isZeroWidthSpace(space) {
          return space === '' || space === "\u200B";
        }
        /**
         * Get the font metrics for a font face.
         *
         * @remarks
         * This function will attempt to grab the explicitly defined metrics from the
         * font face first. If the font face does not have metrics defined, it will
         * attempt to calculate the metrics using the browser's measureText method.
         *
         * If the browser does not support the font metrics API, it will use some
         * default values.
         *
         * @param context
         * @param fontFace
         * @param fontSize
         * @returns
         */
        function getWebFontMetrics(context, fontFace, fontSize) {
          if (fontFace.metrics) {
            return fontFace.metrics;
          }
          // If the font face doesn't have metrics defined, we fallback to using the
          // browser's measureText method to calculate take a best guess at the font
          // actual font's metrics.
          // - fontBoundingBox[Ascent|Descent] is the best estimate but only supported
          //   in Chrome 87+ (2020), Firefox 116+ (2023), and Safari 11.1+ (2018).
          //   - It is an estimate as it can vary between browsers.
          // - actualBoundingBox[Ascent|Descent] is less accurate and supported in
          //   Chrome 77+ (2019), Firefox 74+ (2020), and Safari 11.1+ (2018).
          // - If neither are supported, we'll use some default values which will
          //   get text on the screen but likely not be great.
          // NOTE: It's been decided not to rely on fontBoundingBox[Ascent|Descent]
          // as it's browser support is limited and it also tends to produce higher than
          // expected values. It is instead HIGHLY RECOMMENDED that developers provide
          // explicit metrics in the font face definition.
          var browserMetrics = context.measureText('ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz');
          console.warn("Font metrics not provided for Canvas Web font ".concat(fontFace.fontFamily, ". ") + 'Using fallback values. It is HIGHLY recommended you use the latest ' + 'version of the Lightning 3 `msdf-generator` tool to extract the default ' + 'metrics for the font and provide them in the Canvas Web font definition.');
          var metrics;
          if (browserMetrics.actualBoundingBoxDescent && browserMetrics.actualBoundingBoxAscent) {
            metrics = {
              ascender: browserMetrics.actualBoundingBoxAscent / fontSize,
              descender: -browserMetrics.actualBoundingBoxDescent / fontSize,
              lineGap: 0.2
            };
          } else {
            // If the browser doesn't support the font metrics API, we'll use some
            // default values.
            metrics = {
              ascender: 0.8,
              descender: -0.2,
              lineGap: 0.2
            };
          }
          // Save the calculated metrics to the font face for future use.
          fontFace.metrics = metrics;
          return metrics;
        }

        /*
         * If not stated otherwise in this file or this component's LICENSE file the
         * following copyright and licenses apply:
         *
         * Copyright 2023 Comcast Cable Communications Management, LLC.
         *
         * Licensed under the Apache License, Version 2.0 (the License);
         * you may not use this file except in compliance with the License.
         * You may obtain a copy of the License at
         *
         * http://www.apache.org/licenses/LICENSE-2.0
         *
         * Unless required by applicable law or agreed to in writing, software
         * distributed under the License is distributed on an "AS IS" BASIS,
         * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
         * See the License for the specific language governing permissions and
         * limitations under the License.
         */
        /* eslint-disable @typescript-eslint/no-non-null-assertion */
        var MAX_TEXTURE_DIMENSION = 2048;
        /**
         * Calculate height for the canvas
         *
         * @param textBaseline
         * @param fontSize
         * @param lineHeight
         * @param numLines
         * @param offsetY
         * @returns
         */
        function calcHeight(textBaseline, fontSize, lineHeight, numLines, offsetY) {
          var baselineOffset = textBaseline !== 'bottom' ? 0.5 * fontSize : 0;
          return lineHeight * (numLines - 1) + baselineOffset + Math.max(lineHeight, fontSize) + (offsetY || 0);
        }
        var LightningTextTextureRenderer = /*#__PURE__*/function () {
          function LightningTextTextureRenderer(canvas, context) {
            _classCallCheck(this, LightningTextTextureRenderer);
            _defineProperty(this, "_canvas", void 0);
            _defineProperty(this, "_context", void 0);
            _defineProperty(this, "_settings", void 0);
            this._canvas = canvas;
            this._context = context;
            this._settings = this.mergeDefaults({});
          }
          return _createClass(LightningTextTextureRenderer, [{
            key: "settings",
            get: function get() {
              return this._settings;
            },
            set: function set(v) {
              this._settings = this.mergeDefaults(v);
            }
          }, {
            key: "getPrecision",
            value: function getPrecision() {
              return this._settings.precision;
            }
          }, {
            key: "setFontProperties",
            value: function setFontProperties() {
              this._context.font = this._getFontSetting();
              this._context.textBaseline = this._settings.textBaseline;
            }
          }, {
            key: "_getFontSetting",
            value: function _getFontSetting() {
              var ff = [this._settings.fontFamily];
              var ffs = [];
              for (var i = 0, n = ff.length; i < n; i++) {
                if (ff[i] === 'serif' || ff[i] === 'sans-serif') {
                  ffs.push(ff[i]);
                } else {
                  ffs.push("\"".concat(ff[i], "\""));
                }
              }
              return "".concat(this._settings.fontStyle, " ").concat(this._settings.fontSize * this.getPrecision(), "px ").concat(ffs.join(','));
            }
          }, {
            key: "_load",
            value: function _load() {
              var _this69 = this;
              if (document.fonts) {
                var fontSetting = this._getFontSetting();
                try {
                  if (!document.fonts.check(fontSetting, this._settings.text)) {
                    // Use a promise that waits for loading.
                    return document.fonts.load(fontSetting, this._settings.text).catch(function (err) {
                      // Just load the fallback font.
                      console.warn('[Lightning] Font load error', err, fontSetting);
                    }).then(function () {
                      if (!document.fonts.check(fontSetting, _this69._settings.text)) {
                        console.warn('[Lightning] Font not found', fontSetting);
                      }
                    });
                  }
                } catch (e) {
                  console.warn("[Lightning] Can't check font loading for " + fontSetting);
                }
              }
            }
          }, {
            key: "calculateRenderInfo",
            value: function calculateRenderInfo() {
              var renderInfo = {};
              var precision = this.getPrecision();
              var paddingLeft = this._settings.paddingLeft * precision;
              var paddingRight = this._settings.paddingRight * precision;
              var fontSize = this._settings.fontSize * precision;
              var offsetY = this._settings.offsetY === null ? null : this._settings.offsetY * precision;
              var w = this._settings.w * precision;
              var h = this._settings.h * precision;
              var wordWrapWidth = this._settings.wordWrapWidth * precision;
              var cutSx = this._settings.cutSx * precision;
              var cutEx = this._settings.cutEx * precision;
              var cutSy = this._settings.cutSy * precision;
              var cutEy = this._settings.cutEy * precision;
              var letterSpacing = (this._settings.letterSpacing || 0) * precision;
              var textIndent = this._settings.textIndent * precision;
              var trFontFace = this._settings.trFontFace;
              // Set font properties.
              this.setFontProperties();
              assertTruthy(trFontFace);
              var metrics = getWebFontMetrics(this._context, trFontFace, fontSize);
              var defLineHeight = calcDefaultLineHeight(metrics, fontSize) * precision;
              var lineHeight = this._settings.lineHeight !== null ? this._settings.lineHeight * precision : defLineHeight;
              var maxHeight = this._settings.maxHeight;
              var containedMaxLines = maxHeight !== null && lineHeight > 0 ? Math.floor(maxHeight / lineHeight) : 0;
              var setMaxLines = this._settings.maxLines;
              var calcMaxLines = containedMaxLines > 0 && setMaxLines > 0 ? Math.min(containedMaxLines, setMaxLines) : Math.max(containedMaxLines, setMaxLines);
              // Total width.
              var width = w || 2048 / this.getPrecision();
              // Inner width.
              var innerWidth = width - paddingLeft;
              if (innerWidth < 10) {
                width += 10 - innerWidth;
                innerWidth = 10;
              }
              if (!wordWrapWidth) {
                wordWrapWidth = innerWidth;
              }
              // Text overflow
              if (this._settings.textOverflow && !this._settings.wordWrap) {
                var suffix;
                switch (this._settings.textOverflow) {
                  case 'clip':
                    suffix = '';
                    break;
                  case 'ellipsis':
                    suffix = this._settings.overflowSuffix;
                    break;
                  default:
                    suffix = this._settings.textOverflow;
                }
                this._settings.text = this.wrapWord(this._settings.text, wordWrapWidth - textIndent, suffix);
              }
              // word wrap
              // preserve original text
              var linesInfo;
              if (this._settings.wordWrap) {
                linesInfo = this.wrapText(this._settings.text, wordWrapWidth, letterSpacing, textIndent);
              } else {
                linesInfo = {
                  l: this._settings.text.split(/(?:\r\n|\r|\n)/),
                  n: []
                };
                var n = linesInfo.l.length;
                for (var i = 0; i < n - 1; i++) {
                  linesInfo.n.push(i);
                }
              }
              var lines = linesInfo.l;
              if (calcMaxLines && lines.length > calcMaxLines) {
                var usedLines = lines.slice(0, calcMaxLines);
                var otherLines = null;
                if (this._settings.overflowSuffix) {
                  // Wrap again with max lines suffix enabled.
                  var _w = this._settings.overflowSuffix ? this.measureText(this._settings.overflowSuffix) : 0;
                  var al = this.wrapText(usedLines[usedLines.length - 1], wordWrapWidth - _w, letterSpacing, textIndent);
                  usedLines[usedLines.length - 1] = "".concat(al.l[0]).concat(this._settings.overflowSuffix);
                  otherLines = [al.l.length > 1 ? al.l[1] : ''];
                } else {
                  otherLines = [''];
                }
                // Re-assemble the remaining text.
                var _i17;
                var _n = lines.length;
                var j = 0;
                var m = linesInfo.n.length;
                for (_i17 = calcMaxLines; _i17 < _n; _i17++) {
                  otherLines[j] += "".concat(otherLines[j] ? ' ' : '').concat(lines[_i17]);
                  if (_i17 + 1 < m && linesInfo.n[_i17 + 1]) {
                    j++;
                  }
                }
                renderInfo.remainingText = otherLines.join('\n');
                renderInfo.moreTextLines = true;
                lines = usedLines;
              } else {
                renderInfo.moreTextLines = false;
                renderInfo.remainingText = '';
              }
              // calculate text width
              var maxLineWidth = 0;
              var lineWidths = [];
              for (var _i18 = 0; _i18 < lines.length; _i18++) {
                var lineWidth = this.measureText(lines[_i18], letterSpacing) + (_i18 === 0 ? textIndent : 0);
                lineWidths.push(lineWidth);
                maxLineWidth = Math.max(maxLineWidth, lineWidth);
              }
              renderInfo.lineWidths = lineWidths;
              if (!w) {
                // Auto-set width to max text length.
                width = maxLineWidth + paddingLeft + paddingRight;
                innerWidth = maxLineWidth;
              }
              // If word wrap is enabled the width needs to be the width of the text.
              if (this._settings.wordWrap && w > maxLineWidth && this._settings.textAlign === 'left' && lines.length === 1) {
                width = maxLineWidth + paddingLeft + paddingRight;
              }
              var height;
              if (h) {
                height = h;
              } else {
                height = calcHeight(this._settings.textBaseline, fontSize, lineHeight, lines.length, offsetY);
              }
              if (offsetY === null) {
                offsetY = fontSize;
              }
              renderInfo.w = width;
              renderInfo.h = height;
              renderInfo.lines = lines;
              renderInfo.precision = precision;
              if (!width) {
                // To prevent canvas errors.
                width = 1;
              }
              if (!height) {
                // To prevent canvas errors.
                height = 1;
              }
              if (cutSx || cutEx) {
                width = Math.min(width, cutEx - cutSx);
              }
              if (cutSy || cutEy) {
                height = Math.min(height, cutEy - cutSy);
              }
              renderInfo.width = width;
              renderInfo.innerWidth = innerWidth;
              renderInfo.height = height;
              renderInfo.fontSize = fontSize;
              renderInfo.cutSx = cutSx;
              renderInfo.cutSy = cutSy;
              renderInfo.cutEx = cutEx;
              renderInfo.cutEy = cutEy;
              renderInfo.lineHeight = lineHeight;
              renderInfo.defLineHeight = defLineHeight;
              renderInfo.lineWidths = lineWidths;
              renderInfo.offsetY = offsetY;
              renderInfo.paddingLeft = paddingLeft;
              renderInfo.paddingRight = paddingRight;
              renderInfo.letterSpacing = letterSpacing;
              renderInfo.textIndent = textIndent;
              renderInfo.metrics = metrics;
              return renderInfo;
            }
          }, {
            key: "draw",
            value: function draw(renderInfo, linesOverride) {
              var precision = this.getPrecision();
              // Allow lines to be overriden for partial rendering.
              var lines = (linesOverride === null || linesOverride === void 0 ? void 0 : linesOverride.lines) || renderInfo.lines;
              var lineWidths = (linesOverride === null || linesOverride === void 0 ? void 0 : linesOverride.lineWidths) || renderInfo.lineWidths;
              var height = linesOverride ? calcHeight(this._settings.textBaseline, renderInfo.fontSize, renderInfo.lineHeight, linesOverride.lines.length, this._settings.offsetY === null ? null : this._settings.offsetY * precision) : renderInfo.height;
              // Add extra margin to prevent issue with clipped text when scaling.
              this._canvas.width = Math.min(Math.ceil(renderInfo.width + this._settings.textRenderIssueMargin), MAX_TEXTURE_DIMENSION);
              this._canvas.height = Math.min(Math.ceil(height), MAX_TEXTURE_DIMENSION);
              // Canvas context has been reset.
              this.setFontProperties();
              if (renderInfo.fontSize >= 128) {
                // WpeWebKit bug: must force compositing because cairo-traps-compositor will not work with text first.
                this._context.globalAlpha = 0.01;
                this._context.fillRect(0, 0, 0.01, 0.01);
                this._context.globalAlpha = 1.0;
              }
              if (renderInfo.cutSx || renderInfo.cutSy) {
                this._context.translate(-renderInfo.cutSx, -renderInfo.cutSy);
              }
              var linePositionX;
              var linePositionY;
              var drawLines = [];
              var metrics = renderInfo.metrics;
              /**
               * Ascender (in pixels)
               */
              var ascenderPx = metrics ? metrics.ascender * renderInfo.fontSize : renderInfo.fontSize;
              /**
               * Bare line height is the distance between the ascender and descender of the font.
               * without the line gap metric.
               */
              var bareLineHeightPx = (metrics.ascender - metrics.descender) * renderInfo.fontSize;
              // Draw lines line by line.
              for (var i = 0, n = lines.length; i < n; i++) {
                linePositionX = i === 0 ? renderInfo.textIndent : 0;
                // By default, text is aligned to top
                linePositionY = i * renderInfo.lineHeight + ascenderPx;
                if (this._settings.verticalAlign == 'middle') {
                  linePositionY += (renderInfo.lineHeight - bareLineHeightPx) / 2;
                } else if (this._settings.verticalAlign == 'bottom') {
                  linePositionY += renderInfo.lineHeight - bareLineHeightPx;
                }
                if (this._settings.textAlign === 'right') {
                  linePositionX += renderInfo.innerWidth - lineWidths[i];
                } else if (this._settings.textAlign === 'center') {
                  linePositionX += (renderInfo.innerWidth - lineWidths[i]) / 2;
                }
                linePositionX += renderInfo.paddingLeft;
                drawLines.push({
                  text: lines[i],
                  x: linePositionX,
                  y: linePositionY,
                  w: lineWidths[i]
                });
              }
              // Highlight.
              if (this._settings.highlight) {
                var color = this._settings.highlightColor;
                var hlHeight = this._settings.highlightHeight * precision || renderInfo.fontSize * 1.5;
                var offset = this._settings.highlightOffset * precision;
                var hlPaddingLeft = this._settings.highlightPaddingLeft !== null ? this._settings.highlightPaddingLeft * precision : renderInfo.paddingLeft;
                var hlPaddingRight = this._settings.highlightPaddingRight !== null ? this._settings.highlightPaddingRight * precision : renderInfo.paddingRight;
                this._context.fillStyle = getRgbaString(color);
                for (var _i19 = 0; _i19 < drawLines.length; _i19++) {
                  var drawLine = drawLines[_i19];
                  this._context.fillRect(drawLine.x - hlPaddingLeft, drawLine.y - renderInfo.offsetY + offset, drawLine.w + hlPaddingRight + hlPaddingLeft, hlHeight);
                }
              }
              // Text shadow.
              var prevShadowSettings = null;
              if (this._settings.shadow) {
                prevShadowSettings = [this._context.shadowColor, this._context.shadowOffsetX, this._context.shadowOffsetY, this._context.shadowBlur];
                this._context.shadowColor = getRgbaString(this._settings.shadowColor);
                this._context.shadowOffsetX = this._settings.shadowOffsetX * precision;
                this._context.shadowOffsetY = this._settings.shadowOffsetY * precision;
                this._context.shadowBlur = this._settings.shadowBlur * precision;
              }
              this._context.fillStyle = getRgbaString(this._settings.textColor);
              for (var _i20 = 0, _n2 = drawLines.length; _i20 < _n2; _i20++) {
                var _drawLine = drawLines[_i20];
                if (renderInfo.letterSpacing === 0) {
                  this._context.fillText(_drawLine.text, _drawLine.x, _drawLine.y);
                } else {
                  var textSplit = _drawLine.text.split('');
                  var x = _drawLine.x;
                  for (var _i21 = 0, j = textSplit.length; _i21 < j; _i21++) {
                    this._context.fillText(textSplit[_i21], x, _drawLine.y);
                    x += this.measureText(textSplit[_i21], renderInfo.letterSpacing);
                  }
                }
              }
              if (prevShadowSettings) {
                this._context.shadowColor = prevShadowSettings[0];
                this._context.shadowOffsetX = prevShadowSettings[1];
                this._context.shadowOffsetY = prevShadowSettings[2];
                this._context.shadowBlur = prevShadowSettings[3];
              }
              if (renderInfo.cutSx || renderInfo.cutSy) {
                this._context.translate(renderInfo.cutSx, renderInfo.cutSy);
              }
            }
          }, {
            key: "wrapWord",
            value: function wrapWord(word, wordWrapWidth, suffix) {
              var suffixWidth = this._context.measureText(suffix).width;
              var wordLen = word.length;
              var wordWidth = this._context.measureText(word).width;
              /* If word fits wrapWidth, do nothing */
              if (wordWidth <= wordWrapWidth) {
                return word;
              }
              /* Make initial guess for text cuttoff */
              var cutoffIndex = Math.floor(wordWrapWidth * wordLen / wordWidth);
              var truncWordWidth = this._context.measureText(word.substring(0, cutoffIndex)).width + suffixWidth;
              /* In case guess was overestimated, shrink it letter by letter. */
              if (truncWordWidth > wordWrapWidth) {
                while (cutoffIndex > 0) {
                  truncWordWidth = this._context.measureText(word.substring(0, cutoffIndex)).width + suffixWidth;
                  if (truncWordWidth > wordWrapWidth) {
                    cutoffIndex -= 1;
                  } else {
                    break;
                  }
                }
                /* In case guess was underestimated, extend it letter by letter. */
              } else {
                while (cutoffIndex < wordLen) {
                  truncWordWidth = this._context.measureText(word.substring(0, cutoffIndex)).width + suffixWidth;
                  if (truncWordWidth < wordWrapWidth) {
                    cutoffIndex += 1;
                  } else {
                    // Finally, when bound is crossed, retract last letter.
                    cutoffIndex -= 1;
                    break;
                  }
                }
              }
              /* If wrapWidth is too short to even contain suffix alone, return empty string */
              return word.substring(0, cutoffIndex) + (wordWrapWidth >= suffixWidth ? suffix : '');
            }
            /**
             * Applies newlines to a string to have it optimally fit into the horizontal
             * bounds set by the Text object's wordWrapWidth property.
             */
          }, {
            key: "wrapText",
            value: function wrapText(text, wordWrapWidth, letterSpacing) {
              var indent = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 0;
              var spaceRegex = / |\u200B/g; // ZWSP and spaces
              var lines = text.split(/\r?\n/g);
              var allLines = [];
              var realNewlines = [];
              for (var i = 0; i < lines.length; i++) {
                var resultLines = [];
                var result = '';
                var spaceLeft = wordWrapWidth - indent;
                // Split the line into words, considering ZWSP
                var words = lines[i].split(spaceRegex);
                var spaces = lines[i].match(spaceRegex) || [];
                for (var j = 0; j < words.length; j++) {
                  var space = spaces[j - 1] || '';
                  var word = words[j];
                  var wordWidth = this.measureText(word, letterSpacing);
                  var wordWidthWithSpace = isZeroWidthSpace(space) ? wordWidth : wordWidth + this.measureText(space, letterSpacing);
                  if (j === 0 || wordWidthWithSpace > spaceLeft) {
                    if (j > 0) {
                      resultLines.push(result);
                      result = '';
                    }
                    result += word;
                    spaceLeft = wordWrapWidth - wordWidth - (j === 0 ? indent : 0);
                  } else {
                    spaceLeft -= wordWidthWithSpace;
                    result += space + word;
                  }
                }
                resultLines.push(result);
                result = '';
                allLines = allLines.concat(resultLines);
                if (i < lines.length - 1) {
                  realNewlines.push(allLines.length);
                }
              }
              return {
                l: allLines,
                n: realNewlines
              };
            }
          }, {
            key: "measureText",
            value: function measureText(word) {
              var _this70 = this;
              var space = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;
              if (!space) {
                return this._context.measureText(word).width;
              }
              // Split word into characters, but skip ZWSP in the width calculation
              return word.split('').reduce(function (acc, char) {
                // Check if the character is a zero-width space and skip it
                if (isZeroWidthSpace(char)) {
                  return acc;
                }
                return acc + _this70._context.measureText(char).width + space;
              }, 0);
            }
          }, {
            key: "mergeDefaults",
            value: function mergeDefaults(settings) {
              return _objectSpread({
                text: '',
                w: 0,
                h: 0,
                fontStyle: 'normal',
                fontSize: 40,
                fontFamily: null,
                trFontFace: null,
                wordWrap: true,
                wordWrapWidth: 0,
                wordBreak: false,
                textOverflow: '',
                lineHeight: null,
                textBaseline: 'alphabetic',
                textAlign: 'left',
                verticalAlign: 'top',
                offsetY: null,
                maxLines: 0,
                maxHeight: null,
                overflowSuffix: '...',
                textColor: [1.0, 1.0, 1.0, 1.0],
                paddingLeft: 0,
                paddingRight: 0,
                shadow: false,
                shadowColor: [0.0, 0.0, 0.0, 1.0],
                shadowOffsetX: 0,
                shadowOffsetY: 0,
                shadowBlur: 5,
                highlight: false,
                highlightHeight: 0,
                highlightColor: [0.0, 0.0, 0.0, 1.0],
                highlightOffset: 0,
                highlightPaddingLeft: 0,
                highlightPaddingRight: 0,
                letterSpacing: 0,
                textIndent: 0,
                cutSx: 0,
                cutEx: 0,
                cutSy: 0,
                cutEy: 0,
                advancedRenderer: false,
                fontBaselineRatio: 0,
                precision: 1,
                textRenderIssueMargin: 0
              }, settings);
            }
          }]);
        }();
        /*
         * If not stated otherwise in this file or this component's LICENSE file the
         * following copyright and licenses apply:
         *
         * Copyright 2023 Comcast Cable Communications Management, LLC.
         *
         * Licensed under the Apache License, Version 2.0 (the License);
         * you may not use this file except in compliance with the License.
         * You may obtain a copy of the License at
         *
         * http://www.apache.org/licenses/LICENSE-2.0
         *
         * Unless required by applicable law or agreed to in writing, software
         * distributed under the License is distributed on an "AS IS" BASIS,
         * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
         * See the License for the specific language governing permissions and
         * limitations under the License.
         */
        var resolvedGlobal = typeof self === 'undefined' ? globalThis : self;
        /**
         * Global font set regardless of if run in the main thread or a web worker
         */
        var globalFontSet = ((_resolvedGlobal$docum = resolvedGlobal.document) === null || _resolvedGlobal$docum === void 0 ? void 0 : _resolvedGlobal$docum.fonts) || resolvedGlobal.fonts;
        function getFontCssString(props) {
          var fontFamily = props.fontFamily,
            fontStyle = props.fontStyle,
            fontWeight = props.fontWeight,
            fontStretch = props.fontStretch,
            fontSize = props.fontSize;
          return [fontStyle, fontWeight, fontStretch, "".concat(fontSize, "px"), fontFamily].join(' ');
        }
        var CanvasTextRenderer = /*#__PURE__*/function (_TextRenderer3) {
          function CanvasTextRenderer(stage) {
            var _this71;
            _classCallCheck(this, CanvasTextRenderer);
            _this71 = _callSuper(this, CanvasTextRenderer, [stage]);
            _defineProperty(_this71, "canvas", void 0);
            _defineProperty(_this71, "context", void 0);
            /**
             * Font family map used to store web font faces that were added to the
             * canvas text renderer.
             */
            _defineProperty(_this71, "fontFamilies", {});
            _defineProperty(_this71, "fontFamilyArray", [_this71.fontFamilies]);
            _defineProperty(_this71, "type", 'canvas');
            _defineProperty(_this71, "loadFont", function (state) {
              var cssString = getFontCssString(state.props);
              var trFontFace = _this71.stage.fontManager.resolveFontFace(_this71.fontFamilyArray, state.props, 'canvas');
              assertTruthy(trFontFace, "Could not resolve font face for ".concat(cssString));
              state.fontInfo = {
                fontFace: trFontFace,
                cssString: cssString,
                // TODO: For efficiency we would use this here but it's not reliable on WPE -> document.fonts.check(cssString),
                loaded: false
              };
              // If font is not loaded, set up a handler to update the font info when the font loads
              if (!state.fontInfo.loaded) {
                globalFontSet.load(cssString).then(_this71.onFontLoaded.bind(_this71, state, cssString)).catch(_this71.onFontLoadError.bind(_this71, state, cssString));
                return;
              }
            });
            if (typeof OffscreenCanvas !== 'undefined') {
              _this71.canvas = new OffscreenCanvas(0, 0);
            } else {
              _this71.canvas = document.createElement('canvas');
            }
            var context = _this71.canvas.getContext('2d', {
              willReadFrequently: true
            });
            if (!context) {
              // A browser may appear to support OffscreenCanvas but not actually support the Canvas '2d' context
              // Here we try getting the context again after falling back to an HTMLCanvasElement.
              // See: https://github.com/lightning-js/renderer/issues/26#issuecomment-1750438486
              _this71.canvas = document.createElement('canvas');
              context = _this71.canvas.getContext('2d', {
                willReadFrequently: true
              });
            }
            assertTruthy(context);
            _this71.context = context;
            // Install the default 'san-serif' font face
            _this71.addFontFace(new WebTrFontFace({
              fontFamily: 'sans-serif',
              descriptors: {},
              fontUrl: ''
            }));
            return _this71;
          }
          //#region Overrides
          _inherits(CanvasTextRenderer, _TextRenderer3);
          return _createClass(CanvasTextRenderer, [{
            key: "getPropertySetters",
            value: function getPropertySetters() {
              var _this72 = this;
              return {
                fontFamily: function fontFamily(state, value) {
                  state.props.fontFamily = value;
                  state.fontInfo = undefined;
                  _this72.invalidateLayoutCache(state);
                },
                fontWeight: function fontWeight(state, value) {
                  state.props.fontWeight = value;
                  state.fontInfo = undefined;
                  _this72.invalidateLayoutCache(state);
                },
                fontStyle: function fontStyle(state, value) {
                  state.props.fontStyle = value;
                  state.fontInfo = undefined;
                  _this72.invalidateLayoutCache(state);
                },
                fontStretch: function fontStretch(state, value) {
                  state.props.fontStretch = value;
                  state.fontInfo = undefined;
                  _this72.invalidateLayoutCache(state);
                },
                fontSize: function fontSize(state, value) {
                  state.props.fontSize = value;
                  state.fontInfo = undefined;
                  _this72.invalidateLayoutCache(state);
                },
                text: function text(state, value) {
                  state.props.text = value;
                  _this72.invalidateLayoutCache(state);
                },
                textAlign: function textAlign(state, value) {
                  state.props.textAlign = value;
                  _this72.invalidateLayoutCache(state);
                },
                color: function color(state, value) {
                  state.props.color = value;
                  _this72.invalidateLayoutCache(state);
                },
                x: function x(state, value) {
                  state.props.x = value;
                },
                y: function y(state, value) {
                  state.props.y = value;
                },
                contain: function contain(state, value) {
                  state.props.contain = value;
                  _this72.invalidateLayoutCache(state);
                },
                width: function width(state, value) {
                  state.props.width = value;
                  // Only invalidate layout cache if we're containing in the horizontal direction
                  if (state.props.contain !== 'none') {
                    _this72.invalidateLayoutCache(state);
                  }
                },
                height: function height(state, value) {
                  state.props.height = value;
                  // Only invalidate layout cache if we're containing in the vertical direction
                  if (state.props.contain === 'both') {
                    _this72.invalidateLayoutCache(state);
                  }
                },
                offsetY: function offsetY(state, value) {
                  state.props.offsetY = value;
                  _this72.invalidateLayoutCache(state);
                },
                scrollY: function scrollY(state, value) {
                  state.props.scrollY = value;
                },
                letterSpacing: function letterSpacing(state, value) {
                  state.props.letterSpacing = value;
                  _this72.invalidateLayoutCache(state);
                },
                lineHeight: function lineHeight(state, value) {
                  state.props.lineHeight = value;
                  _this72.invalidateLayoutCache(state);
                },
                maxLines: function maxLines(state, value) {
                  state.props.maxLines = value;
                  _this72.invalidateLayoutCache(state);
                },
                textBaseline: function textBaseline(state, value) {
                  state.props.textBaseline = value;
                  _this72.invalidateLayoutCache(state);
                },
                verticalAlign: function verticalAlign(state, value) {
                  state.props.verticalAlign = value;
                  _this72.invalidateLayoutCache(state);
                },
                overflowSuffix: function overflowSuffix(state, value) {
                  state.props.overflowSuffix = value;
                  _this72.invalidateLayoutCache(state);
                }
              };
            }
            // eslint-disable-next-line @typescript-eslint/no-unused-vars
          }, {
            key: "canRenderFont",
            value: function canRenderFont(props) {
              // The canvas renderer can render any font because it automatically
              // falls back to system fonts. The CanvasTextRenderer should be
              // checked last if other renderers are preferred.
              return true;
            }
          }, {
            key: "isFontFaceSupported",
            value: function isFontFaceSupported(fontFace) {
              return fontFace instanceof WebTrFontFace;
            }
          }, {
            key: "addFontFace",
            value: function addFontFace(fontFace) {
              // Make sure the font face is an Canvas font face (it should have already passed
              // the `isFontFaceSupported` check)
              assertTruthy(fontFace instanceof WebTrFontFace);
              var fontFamily = fontFace.fontFamily;
              // Add the font face to the document
              // Except for the 'sans-serif' font family, which the Renderer provides
              // as a special default fallback.
              if (fontFamily !== 'sans-serif') {
                // @ts-expect-error `add()` method should be available from a FontFaceSet
                // eslint-disable-next-line @typescript-eslint/no-unsafe-call
                globalFontSet.add(fontFace.fontFace);
              }
              var faceSet = this.fontFamilies[fontFamily];
              if (!faceSet) {
                faceSet = new Set();
                this.fontFamilies[fontFamily] = faceSet;
              }
              faceSet.add(fontFace);
            }
          }, {
            key: "createState",
            value: function createState(props, node) {
              return {
                node: node,
                props: props,
                status: 'initialState',
                updateScheduled: false,
                emitter: new EventEmitter(),
                textureNode: undefined,
                lightning2TextRenderer: new LightningTextTextureRenderer(this.canvas, this.context),
                renderInfo: undefined,
                forceFullLayoutCalc: false,
                textW: 0,
                textH: 0,
                fontInfo: undefined,
                isRenderable: false,
                debugData: {
                  updateCount: 0,
                  layoutCount: 0,
                  drawCount: 0,
                  lastLayoutNumCharacters: 0,
                  layoutSum: 0,
                  drawSum: 0,
                  bufferSize: 0
                }
              };
            }
          }, {
            key: "updateState",
            value: function updateState(state) {
              // On the first update call we need to set the status to loading
              if (state.status === 'initialState') {
                this.setStatus(state, 'loading');
                // check if we're on screen
                // if (this.isValidOnScreen(state) === true) {
                //   this.setStatus(state, 'loading');
                // }
              }
              if (state.status === 'loaded') {
                // If we're loaded, we don't need to do anything
                return;
              }
              // If fontInfo is invalid, we need to establish it
              if (!state.fontInfo) {
                return this.loadFont(state);
              }
              // If we're waiting for a font face to load, don't render anything
              if (!state.fontInfo.loaded) {
                return;
              }
              if (!state.renderInfo) {
                state.renderInfo = this.calculateRenderInfo(state);
                state.textH = state.renderInfo.lineHeight * state.renderInfo.lines.length;
                state.textW = state.renderInfo.width;
                this.renderSingleCanvasPage(state);
              }
              // handle scrollable text !!!
              // if (state.isScrollable === true) {
              //   return this.renderScrollableCanvasPages(state);
              // }
              // handle single page text
            }
          }, {
            key: "renderSingleCanvasPage",
            value: function renderSingleCanvasPage(state) {
              assertTruthy(state.renderInfo);
              var node = state.node;
              var texture = this.stage.txManager.createTexture('ImageTexture', {
                premultiplyAlpha: true,
                src: function (lightning2TextRenderer, renderInfo) {
                  // load the canvas texture
                  assertTruthy(renderInfo);
                  lightning2TextRenderer.draw(renderInfo, {
                    lines: renderInfo.lines,
                    lineWidths: renderInfo.lineWidths
                  });
                  if (this.canvas.width === 0 || this.canvas.height === 0) {
                    return null;
                  }
                  return this.context.getImageData(0, 0, this.canvas.width, this.canvas.height);
                }.bind(this, state.lightning2TextRenderer, state.renderInfo)
              });
              if (state.textureNode) {
                // Use the existing texture node
                state.textureNode.texture = texture;
                // Update the alpha
                state.textureNode.alpha = getNormalizedAlphaComponent(state.props.color);
              } else {
                // Create a new texture node
                var textureNode = this.stage.createNode({
                  parent: node,
                  texture: texture,
                  autosize: true,
                  // The alpha channel of the color is ignored when rasterizing the text
                  // texture so we need to pass it directly to the texture node.
                  alpha: getNormalizedAlphaComponent(state.props.color)
                });
                state.textureNode = textureNode;
              }
              this.setStatus(state, 'loaded');
            }
          }, {
            key: "calculateRenderInfo",
            value: function calculateRenderInfo(state) {
              var _state$fontInfo, _state$props$lineHeig;
              state.lightning2TextRenderer.settings = {
                text: state.props.text,
                textAlign: state.props.textAlign,
                fontFamily: state.props.fontFamily,
                trFontFace: (_state$fontInfo = state.fontInfo) === null || _state$fontInfo === void 0 ? void 0 : _state$fontInfo.fontFace,
                fontSize: state.props.fontSize,
                fontStyle: [state.props.fontStretch, state.props.fontStyle, state.props.fontWeight].join(' '),
                textColor: getNormalizedRgbaComponents(state.props.color),
                offsetY: state.props.offsetY,
                wordWrap: state.props.contain !== 'none',
                wordWrapWidth: state.props.contain === 'none' ? undefined : state.props.width,
                letterSpacing: state.props.letterSpacing,
                lineHeight: (_state$props$lineHeig = state.props.lineHeight) !== null && _state$props$lineHeig !== void 0 ? _state$props$lineHeig : null,
                maxLines: state.props.maxLines,
                maxHeight: state.props.contain === 'both' ? state.props.height - state.props.offsetY : null,
                textBaseline: state.props.textBaseline,
                verticalAlign: state.props.verticalAlign,
                overflowSuffix: state.props.overflowSuffix,
                w: state.props.contain !== 'none' ? state.props.width : undefined
              };
              state.renderInfo = state.lightning2TextRenderer.calculateRenderInfo();
              return state.renderInfo;
            }
          }, {
            key: "renderQuads",
            value: function renderQuads() {
              // Do nothing. The renderer will render the child node(s) that were created
              // in the state update.
              return;
            }
          }, {
            key: "destroyState",
            value: function destroyState(state) {
              if (state.status === 'destroyed') {
                return;
              }
              _superPropGet(CanvasTextRenderer, "destroyState", this, 3)([state]);
              if (state.textureNode) {
                state.textureNode.destroy();
                delete state.textureNode;
              }
              delete state.renderInfo;
            }
            //#endregion Overrides
            /**
             * Invalidate the layout cache stored in the state. This will cause the text
             * to be re-rendered on the next update.
             *
             * @remarks
             * This also invalidates the visible window cache.
             *
             * @param state
             */
          }, {
            key: "invalidateLayoutCache",
            value: function invalidateLayoutCache(state) {
              state.renderInfo = undefined;
              this.setStatus(state, 'loading');
              this.scheduleUpdateState(state);
            }
          }, {
            key: "onFontLoaded",
            value: function onFontLoaded(state, cssString) {
              var _state$fontInfo2;
              if (cssString !== ((_state$fontInfo2 = state.fontInfo) === null || _state$fontInfo2 === void 0 ? void 0 : _state$fontInfo2.cssString) || !state.fontInfo) {
                return;
              }
              state.fontInfo.loaded = true;
              this.scheduleUpdateState(state);
            }
          }, {
            key: "onFontLoadError",
            value: function onFontLoadError(state, cssString, error) {
              var _state$fontInfo3;
              if (cssString !== ((_state$fontInfo3 = state.fontInfo) === null || _state$fontInfo3 === void 0 ? void 0 : _state$fontInfo3.cssString) || !state.fontInfo) {
                return;
              }
              // Font didn't actually load, but we'll log the error and mark it as loaded
              // because the browser can still render with a fallback font.
              state.fontInfo.loaded = true;
              console.error("CanvasTextRenderer: Error loading font '".concat(state.fontInfo.cssString, "'"), error);
              this.scheduleUpdateState(state);
            }
          }]);
        }(TextRenderer);
        /*
         * If not stated otherwise in this file or this component's LICENSE file the
         * following copyright and licenses apply:
         *
         * Copyright 2023 Comcast Cable Communications Management, LLC.
         *
         * Licensed under the Apache License, Version 2.0 (the License);
         * you may not use this file except in compliance with the License.
         * You may obtain a copy of the License at
         *
         * http://www.apache.org/licenses/LICENSE-2.0
         *
         * Unless required by applicable law or agreed to in writing, software
         * distributed under the License is distributed on an "AS IS" BASIS,
         * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
         * See the License for the specific language governing permissions and
         * limitations under the License.
         */
        var WHITE = {
          isWhite: true,
          a: 1,
          r: 0xff,
          g: 0xff,
          b: 0xff
        };
        /**
         * Extract color components
         */
        function parseColor(abgr) {
          if (abgr === 0xffffffff) {
            return WHITE;
          }
          var a = (abgr >>> 24 & 0xff) / 255;
          var b = abgr >>> 16 & 0xff & 0xff;
          var g = abgr >>> 8 & 0xff & 0xff;
          var r = abgr & 0xff & 0xff;
          return {
            isWhite: false,
            a: a,
            r: r,
            g: g,
            b: b
          };
        }
        /**
         * Extract color components
         */
        function parseColorRgba(rgba) {
          if (rgba === 0xffffffff) {
            return WHITE;
          }
          var r = rgba >>> 24 & 0xff;
          var g = rgba >>> 16 & 0xff & 0xff;
          var b = rgba >>> 8 & 0xff & 0xff;
          var a = (rgba & 0xff & 0xff) / 255;
          return {
            isWhite: false,
            r: r,
            g: g,
            b: b,
            a: a
          };
        }
        /**
         * Format a parsed color into a rgba CSS color
         */
        function formatRgba(_ref35) {
          var a = _ref35.a,
            r = _ref35.r,
            g = _ref35.g,
            b = _ref35.b;
          return "rgba(".concat(r, ",").concat(g, ",").concat(b, ",").concat(a, ")");
        }

        /*
         * If not stated otherwise in this file or this component's LICENSE file the
         * following copyright and licenses apply:
         *
         * Copyright 2023 Comcast Cable Communications Management, LLC.
         *
         * Licensed under the Apache License, Version 2.0 (the License);
         * you may not use this file except in compliance with the License.
         * You may obtain a copy of the License at
         *
         * http://www.apache.org/licenses/LICENSE-2.0
         *
         * Unless required by applicable law or agreed to in writing, software
         * distributed under the License is distributed on an "AS IS" BASIS,
         * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
         * See the License for the specific language governing permissions and
         * limitations under the License.
         */
        var CanvasCoreTexture = /*#__PURE__*/function (_CoreContextTexture3) {
          function CanvasCoreTexture() {
            var _this73;
            _classCallCheck(this, CanvasCoreTexture);
            for (var _len15 = arguments.length, args = new Array(_len15), _key20 = 0; _key20 < _len15; _key20++) {
              args[_key20] = arguments[_key20];
            }
            _this73 = _callSuper(this, CanvasCoreTexture, [].concat(args));
            _defineProperty(_this73, "image", void 0);
            _defineProperty(_this73, "tintCache", void 0);
            return _this73;
          }
          _inherits(CanvasCoreTexture, _CoreContextTexture3);
          return _createClass(CanvasCoreTexture, [{
            key: "load",
            value: function () {
              var _load2 = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee20() {
                var size, _t11;
                return _regenerator().w(function (_context21) {
                  while (1) switch (_context21.p = _context21.n) {
                    case 0:
                      this.textureSource.setState('loading');
                      _context21.p = 1;
                      _context21.n = 2;
                      return this.onLoadRequest();
                    case 2:
                      size = _context21.v;
                      this.textureSource.setState('loaded', size);
                      this.updateMemSize();
                      _context21.n = 4;
                      break;
                    case 3:
                      _context21.p = 3;
                      _t11 = _context21.v;
                      this.textureSource.setState('failed', _t11);
                      throw _t11;
                    case 4:
                      return _context21.a(2);
                  }
                }, _callee20, this, [[1, 3]]);
              }));
              function load() {
                return _load2.apply(this, arguments);
              }
              return load;
            }()
          }, {
            key: "release",
            value: function release() {
              this.image = undefined;
              this.tintCache = undefined;
            }
          }, {
            key: "free",
            value: function free() {
              this.release();
              this.textureSource.setState('freed');
              this.setTextureMemUse(0);
              this.textureSource.freeTextureData();
            }
          }, {
            key: "updateMemSize",
            value: function updateMemSize() {
              // Counting memory usage for:
              // - main image
              // - tinted image
              var mult = this.tintCache ? 8 : 4;
              if (this.textureSource.dimensions) {
                var _this$textureSource$d = this.textureSource.dimensions,
                  width = _this$textureSource$d.width,
                  height = _this$textureSource$d.height;
                this.setTextureMemUse(width * height * mult);
              }
            }
          }, {
            key: "hasImage",
            value: function hasImage() {
              return this.image !== undefined;
            }
          }, {
            key: "getImage",
            value: function getImage(color) {
              var _this$tintCache;
              var image = this.image;
              assertTruthy(image, 'Attempt to get unloaded image texture');
              if (color.isWhite) {
                if (this.tintCache) {
                  this.tintCache = undefined;
                  this.updateMemSize();
                }
                return image;
              }
              var key = formatRgba(color);
              if (((_this$tintCache = this.tintCache) === null || _this$tintCache === void 0 ? void 0 : _this$tintCache.key) === key) {
                return this.tintCache.image;
              }
              var tintedImage = this.tintTexture(image, key);
              this.tintCache = {
                key: key,
                image: tintedImage
              };
              this.updateMemSize();
              return tintedImage;
            }
          }, {
            key: "tintTexture",
            value: function tintTexture(source, color) {
              var width = source.width,
                height = source.height;
              var canvas = document.createElement('canvas');
              canvas.width = width;
              canvas.height = height;
              var ctx = canvas.getContext('2d');
              if (ctx) {
                // fill with target color
                ctx.fillStyle = color;
                ctx.globalCompositeOperation = 'copy';
                ctx.fillRect(0, 0, width, height);
                // multiply with image, resulting in non-transparent tinted image
                ctx.globalCompositeOperation = 'multiply';
                ctx.drawImage(source, 0, 0, width, height, 0, 0, width, height);
                // apply original image alpha
                ctx.globalCompositeOperation = 'destination-in';
                ctx.drawImage(source, 0, 0, width, height, 0, 0, width, height);
              }
              return canvas;
            }
          }, {
            key: "onLoadRequest",
            value: function () {
              var _onLoadRequest4 = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee21() {
                var _this$textureSource2;
                var data, canvas, ctx;
                return _regenerator().w(function (_context22) {
                  while (1) switch (_context22.n) {
                    case 0:
                      assertTruthy((_this$textureSource2 = this.textureSource) === null || _this$textureSource2 === void 0 || (_this$textureSource2 = _this$textureSource2.textureData) === null || _this$textureSource2 === void 0 ? void 0 : _this$textureSource2.data, 'Texture data is null');
                      data = this.textureSource.textureData.data; // TODO: canvas from text renderer should be able to provide the canvas directly
                      // instead of having to re-draw it into a new canvas...
                      if (!(data instanceof ImageData)) {
                        _context22.n = 1;
                        break;
                      }
                      canvas = document.createElement('canvas');
                      canvas.width = data.width;
                      canvas.height = data.height;
                      ctx = canvas.getContext('2d');
                      if (ctx) ctx.putImageData(data, 0, 0);
                      this.image = canvas;
                      return _context22.a(2, {
                        width: data.width,
                        height: data.height
                      });
                    case 1:
                      if (!(typeof ImageBitmap !== 'undefined' && data instanceof ImageBitmap || data instanceof HTMLImageElement)) {
                        _context22.n = 2;
                        break;
                      }
                      this.image = data;
                      return _context22.a(2, {
                        width: data.width,
                        height: data.height
                      });
                    case 2:
                      return _context22.a(2, {
                        width: 0,
                        height: 0
                      });
                  }
                }, _callee21, this);
              }));
              function onLoadRequest() {
                return _onLoadRequest4.apply(this, arguments);
              }
              return onLoadRequest;
            }()
          }]);
        }(CoreContextTexture);
        /*
         * If not stated otherwise in this file or this component's LICENSE file the
         * following copyright and licenses apply:
         *
         * Copyright 2023 Comcast Cable Communications Management, LLC.
         *
         * Licensed under the Apache License, Version 2.0 (the License);
         * you may not use this file except in compliance with the License.
         * You may obtain a copy of the License at
         *
         * http://www.apache.org/licenses/LICENSE-2.0
         *
         * Unless required by applicable law or agreed to in writing, software
         * distributed under the License is distributed on an "AS IS" BASIS,
         * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
         * See the License for the specific language governing permissions and
         * limitations under the License.
         */
        /**
         * Extract `RoundedRectangle` shader radius to apply as a clipping
         */
        function getRadius(quad) {
          if (quad.shader instanceof UnsupportedShader) {
            var shType = quad.shader.shType;
            if (shType === ROUNDED_RECTANGLE_SHADER_TYPE) {
              var _quad$shaderProps$rad, _quad$shaderProps;
              return (_quad$shaderProps$rad = (_quad$shaderProps = quad.shaderProps) === null || _quad$shaderProps === void 0 ? void 0 : _quad$shaderProps.radius) !== null && _quad$shaderProps$rad !== void 0 ? _quad$shaderProps$rad : 0;
            } else if (shType === 'DynamicShader') {
              var _quad$shaderProps2;
              var effects = (_quad$shaderProps2 = quad.shaderProps) === null || _quad$shaderProps2 === void 0 ? void 0 : _quad$shaderProps2.effects;
              if (effects) {
                var _effect4 = effects.find(function (effect) {
                  var _effect$props;
                  return effect.type === 'radius' && (effect === null || effect === void 0 || (_effect$props = effect.props) === null || _effect$props === void 0 ? void 0 : _effect$props.radius);
                });
                return _effect4 && _effect4.type === 'radius' && _effect4.props.radius || 0;
              }
            }
          }
          return 0;
        }
        /**
         * Extract `RoundedRectangle` shader radius to apply as a clipping */
        function getBorder(quad) {
          var direction = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '';
          if (quad.shader instanceof UnsupportedShader) {
            var shType = quad.shader.shType;
            if (shType === 'DynamicShader') {
              var _quad$shaderProps3;
              var effects = (_quad$shaderProps3 = quad.shaderProps) === null || _quad$shaderProps3 === void 0 ? void 0 : _quad$shaderProps3.effects;
              if (effects && effects.length) {
                var _effect5 = effects.find(function (effect) {
                  return effect.type === "border".concat(direction) && effect.props && effect.props.width;
                });
                return _effect5 && _effect5.props;
              }
            }
          }
          return undefined;
        }
        function roundRect(x, y, width, height, radius) {
          var context = Object.getPrototypeOf(this);
          if (!context.roundRect) {
            var fixOverlappingCorners = function fixOverlappingCorners(radii) {
              var maxRadius = Math.min(width / 2, height / 2);
              var totalHorizontal = radii.topLeft + radii.topRight + radii.bottomRight + radii.bottomLeft;
              if (totalHorizontal > width || totalHorizontal > height) {
                var scale = maxRadius / Math.max(radii.topLeft, radii.topRight, radii.bottomRight, radii.bottomLeft);
                radii.topLeft *= scale;
                radii.topRight *= scale;
                radii.bottomRight *= scale;
                radii.bottomLeft *= scale;
              }
            };
            var radii = typeof radius === 'number' ? {
              topLeft: radius,
              topRight: radius,
              bottomRight: radius,
              bottomLeft: radius
            } : _objectSpread({
              topLeft: 0,
              topRight: 0,
              bottomRight: 0,
              bottomLeft: 0
            }, radius);
            fixOverlappingCorners(radii);
            this.moveTo(x + radii.topLeft, y);
            this.lineTo(x + width - radii.topRight, y);
            this.ellipse(x + width - radii.topRight, y + radii.topRight, radii.topRight, radii.topRight, 0, 1.5 * Math.PI, 2 * Math.PI);
            this.lineTo(x + width, y + height - radii.bottomRight);
            this.ellipse(x + width - radii.bottomRight, y + height - radii.bottomRight, radii.bottomRight, radii.bottomRight, 0, 0, 0.5 * Math.PI);
            this.lineTo(x + radii.bottomLeft, y + height);
            this.ellipse(x + radii.bottomLeft, y + height - radii.bottomLeft, radii.bottomLeft, radii.bottomLeft, 0, 0.5 * Math.PI, Math.PI);
            this.lineTo(x, y + radii.topLeft);
            this.ellipse(x + radii.topLeft, y + radii.topLeft, radii.topLeft, radii.topLeft, 0, Math.PI, 1.5 * Math.PI);
          } else {
            this.roundRect(x, y, width, height, radius);
          }
        }
        function strokeLine(ctx, x, y, width, height) {
          var lineWidth = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : 0;
          var color = arguments.length > 6 ? arguments[6] : undefined;
          var direction = arguments.length > 7 ? arguments[7] : undefined;
          if (!lineWidth) {
            return;
          }
          var sx,
            sy = 0;
          var ex,
            ey = 0;
          switch (direction) {
            case 'Top':
              sx = x;
              sy = y;
              ex = width + x;
              ey = y;
              break;
            case 'Right':
              sx = x + width;
              sy = y;
              ex = x + width;
              ey = y + height;
              break;
            case 'Bottom':
              sx = x;
              sy = y + height;
              ex = x + width;
              ey = y + height;
              break;
            case 'Left':
              sx = x;
              sy = y;
              ex = x;
              ey = y + height;
              break;
          }
          ctx.beginPath();
          ctx.lineWidth = lineWidth;
          ctx.strokeStyle = formatRgba(parseColorRgba(color !== null && color !== void 0 ? color : 0));
          ctx.moveTo(sx, sy);
          ctx.lineTo(ex, ey);
          ctx.stroke();
        }

        /*
         * If not stated otherwise in this file or this component's LICENSE file the
         * following copyright and licenses apply:
         *
         * Copyright 2023 Comcast Cable Communications Management, LLC.
         *
         * Licensed under the Apache License, Version 2.0 (the License);
         * you may not use this file except in compliance with the License.
         * You may obtain a copy of the License at
         *
         * http://www.apache.org/licenses/LICENSE-2.0
         *
         * Unless required by applicable law or agreed to in writing, software
         * distributed under the License is distributed on an "AS IS" BASIS,
         * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
         * See the License for the specific language governing permissions and
         * limitations under the License.
         */
        var CanvasCoreRenderer = /*#__PURE__*/function (_CoreRenderer3) {
          function CanvasCoreRenderer(options) {
            var _this74;
            _classCallCheck(this, CanvasCoreRenderer);
            _this74 = _callSuper(this, CanvasCoreRenderer, [options]);
            _defineProperty(_this74, "context", void 0);
            _defineProperty(_this74, "canvas", void 0);
            _defineProperty(_this74, "pixelRatio", void 0);
            _defineProperty(_this74, "clearColor", void 0);
            _defineProperty(_this74, "renderToTextureActive", false);
            _defineProperty(_this74, "activeRttNode", null);
            _defineProperty(_this74, "defShaderCtr", void 0);
            _this74.mode = 'canvas';
            _this74.shManager.renderer = _this74;
            var canvas = options.canvas,
              pixelRatio = options.pixelRatio,
              clearColor = options.clearColor;
            _this74.canvas = canvas;
            _this74.context = canvas.getContext('2d');
            _this74.pixelRatio = pixelRatio;
            _this74.clearColor = clearColor ? getRgbaComponents(clearColor) : undefined;
            // Stub for default shader controller since the canvas renderer does not
            // (really) support the concept of a shader (yet)
            _this74.defShaderCtr = {
              type: 'DefaultShader',
              props: {},
              shader: new UnsupportedShader('DefaultShader'),
              getResolvedProps: function getResolvedProps() {
                return function () {
                  return {};
                };
              }
            };
            return _this74;
          }
          _inherits(CanvasCoreRenderer, _CoreRenderer3);
          return _createClass(CanvasCoreRenderer, [{
            key: "reset",
            value: function reset() {
              this.canvas.width = this.canvas.width; // quick reset canvas
              var ctx = this.context;
              if (this.clearColor) {
                var _this$clearColor = _slicedToArray(this.clearColor, 4),
                  r = _this$clearColor[0],
                  g = _this$clearColor[1],
                  b = _this$clearColor[2],
                  a = _this$clearColor[3];
                ctx.fillStyle = "rgba(".concat(r, ", ").concat(g, ", ").concat(b, ", ").concat(a / 255, ")");
                ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
              }
              ctx.scale(this.pixelRatio, this.pixelRatio);
            }
          }, {
            key: "render",
            value: function render() {
              // noop
            }
          }, {
            key: "addQuad",
            value: function addQuad(quad) {
              var _texture2;
              var ctx = this.context;
              var tx = quad.tx,
                ty = quad.ty,
                width = quad.width,
                height = quad.height,
                alpha = quad.alpha,
                colorTl = quad.colorTl,
                colorTr = quad.colorTr,
                colorBr = quad.colorBr,
                ta = quad.ta,
                tb = quad.tb,
                tc = quad.tc,
                td = quad.td,
                clippingRect = quad.clippingRect;
              var texture = quad.texture;
              var ctxTexture = undefined;
              var frame;
              var textureType = (_texture2 = texture) === null || _texture2 === void 0 ? void 0 : _texture2.type;
              assertTruthy(textureType, 'Texture type is not defined');
              // The Canvas2D renderer only supports image and color textures and subTexture images
              if (textureType !== TextureType.image && textureType !== TextureType.color && textureType !== TextureType.subTexture && textureType !== TextureType.noise) {
                return;
              }
              if (texture) {
                if (texture instanceof SubTexture) {
                  frame = texture.props;
                  texture = texture.parentTexture;
                }
                ctxTexture = texture.ctxTexture;
                if (texture.state === 'freed') {
                  return;
                }
                if (texture.state !== 'loaded') {
                  return;
                }
              }
              var color = parseColor(colorTl);
              var hasTransform = ta !== 1;
              var hasClipping = clippingRect.width !== 0 && clippingRect.height !== 0;
              var hasGradient = colorTl !== colorTr || colorTl !== colorBr;
              var hasQuadShader = Boolean(quad.shader);
              var radius = hasQuadShader ? getRadius(quad) : 0;
              var border = hasQuadShader ? getBorder(quad) : undefined;
              if (hasTransform || hasClipping || radius) {
                ctx.save();
              }
              if (hasClipping) {
                var path = new Path2D();
                var x = clippingRect.x,
                  y = clippingRect.y,
                  _width2 = clippingRect.width,
                  _height2 = clippingRect.height;
                path.rect(x, y, _width2, _height2);
                ctx.clip(path);
              }
              if (hasTransform) {
                // Quad transform:
                // | ta tb tx |
                // | tc td ty |
                // | 0  0  1  |
                // C2D transform:
                // | a  c  e  |
                // | b  d  f  |
                // | 0  0  1  |
                var scale = this.pixelRatio;
                ctx.setTransform(ta, tc, tb, td, tx * scale, ty * scale);
                ctx.scale(scale, scale);
                ctx.translate(-tx, -ty);
              }
              if (radius) {
                var _path = new Path2D();
                roundRect.call(_path, tx, ty, width, height, radius);
                ctx.clip(_path);
              }
              if ((textureType === TextureType.image || textureType === TextureType.subTexture || textureType === TextureType.noise) && ctxTexture) {
                var _color$a;
                var image = ctxTexture.getImage(color);
                ctx.globalAlpha = (_color$a = color.a) !== null && _color$a !== void 0 ? _color$a : alpha;
                if (frame) {
                  ctx.drawImage(image, frame.x, frame.y, frame.width, frame.height, tx, ty, width, height);
                } else {
                  try {
                    ctx.drawImage(image, tx, ty, width, height);
                    // eslint-disable-next-line @typescript-eslint/no-unused-vars
                  } catch (error) {
                    // noop
                  }
                }
                ctx.globalAlpha = 1;
              } else if (textureType === TextureType.color && hasGradient) {
                var endX = tx;
                var endY = ty;
                var endColor;
                if (colorTl === colorTr) {
                  // vertical
                  endX = tx;
                  endY = ty + height;
                  endColor = parseColor(colorBr);
                } else {
                  // horizontal
                  endX = tx + width;
                  endY = ty;
                  endColor = parseColor(colorTr);
                }
                var gradient = ctx.createLinearGradient(tx, ty, endX, endY);
                gradient.addColorStop(0, formatRgba(color));
                gradient.addColorStop(1, formatRgba(endColor));
                ctx.fillStyle = gradient;
                ctx.fillRect(tx, ty, width, height);
              } else if (textureType === TextureType.color) {
                ctx.fillStyle = formatRgba(color);
                ctx.fillRect(tx, ty, width, height);
              }
              if (border && border.width) {
                var _border$color;
                var borderWidth = border.width;
                var borderInnerWidth = border.width / 2;
                var borderColor = formatRgba(parseColorRgba((_border$color = border.color) !== null && _border$color !== void 0 ? _border$color : 0));
                ctx.beginPath();
                ctx.lineWidth = borderWidth;
                ctx.strokeStyle = borderColor;
                ctx.globalAlpha = alpha;
                if (radius) {
                  roundRect.call(ctx, tx + borderInnerWidth, ty + borderInnerWidth, width - borderWidth, height - borderWidth, radius);
                  ctx.stroke();
                } else {
                  ctx.strokeRect(tx + borderInnerWidth, ty + borderInnerWidth, width - borderWidth, height - borderWidth);
                }
                ctx.globalAlpha = 1;
              } else if (hasQuadShader) {
                var borderTop = getBorder(quad, 'Top');
                var borderRight = getBorder(quad, 'Right');
                var borderBottom = getBorder(quad, 'Bottom');
                var borderLeft = getBorder(quad, 'Left');
                if (borderTop) {
                  strokeLine(ctx, tx, ty, width, height, borderTop.width, borderTop.color, 'Top');
                }
                if (borderRight) {
                  strokeLine(ctx, tx, ty, width, height, borderRight.width, borderRight.color, 'Right');
                }
                if (borderBottom) {
                  strokeLine(ctx, tx, ty, width, height, borderBottom.width, borderBottom.color, 'Bottom');
                }
                if (borderLeft) {
                  strokeLine(ctx, tx, ty, width, height, borderLeft.width, borderLeft.color, 'Left');
                }
              }
              if (hasTransform || hasClipping || radius) {
                ctx.restore();
              }
            }
          }, {
            key: "createCtxTexture",
            value: function createCtxTexture(textureSource) {
              return new CanvasCoreTexture(this.txMemManager, textureSource);
            }
          }, {
            key: "getShaderManager",
            value: function getShaderManager() {
              return this.shManager;
            }
          }, {
            key: "getDefShaderCtr",
            value: function getDefShaderCtr() {
              return this.defShaderCtr;
            }
          }, {
            key: "renderRTTNodes",
            value: function renderRTTNodes() {
              // noop
            }
          }, {
            key: "removeRTTNode",
            value: function removeRTTNode(node) {
              // noop
            }
          }, {
            key: "renderToTexture",
            value: function renderToTexture(node) {
              // noop
            }
          }, {
            key: "getBufferInfo",
            value: function getBufferInfo() {
              return null;
            }
          }, {
            key: "getQuadCount",
            value: function getQuadCount() {
              return null;
            }
            /**
             * Updates the clear color of the canvas renderer.
             *
             * @param color - The color to set as the clear color.
             */
          }, {
            key: "updateClearColor",
            value: function updateClearColor(color) {
              this.clearColor = color ? getRgbaComponents(color) : undefined;
            }
          }]);
        }(CoreRenderer);
        var _createSignal19 = createSignal([]),
          _createSignal20 = _slicedToArray(_createSignal19, 2),
          focusPath = _createSignal20[0],
          setFocusPath = _createSignal20[1];
        var useFocusManager = function useFocusManager(userKeyMap, keyHoldOptions) {
          var owner = getOwner();
          var ownerContext = runWithOwner.bind(void 0, owner);
          Config.setActiveElement = function (activeElm) {
            return ownerContext(function () {
              return setActiveElement(activeElm);
            });
          };
          var _useFocusManager$ = useFocusManager$1({
              userKeyMap: userKeyMap,
              keyHoldOptions: keyHoldOptions,
              ownerContext: ownerContext
            }),
            cleanup = _useFocusManager$.cleanup,
            focusPathCore = _useFocusManager$.focusPath;
          createEffect(on(activeElement, function () {
            setFocusPath(_toConsumableArray(focusPathCore()));
          }, {
            defer: true
          }));
          onCleanup(cleanup);
        };
        function flattenStrings() {
          var series = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];
          var flattenedSeries = [];
          var i;
          for (i = 0; i < series.length; i++) {
            var s = series[i];
            if (typeof s === "string" && !s.includes("PAUSE-")) {
              flattenedSeries.push(series[i]);
            } else {
              break;
            }
          }
          return [flattenedSeries.join(",\b ")].concat(series.slice(i));
        }
        function delay(pause) {
          return new Promise(function (resolve) {
            setTimeout(resolve, pause);
          });
        }
        function speak(phrase, utterances) {
          var lang = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : "en-US";
          var voiceName = arguments.length > 3 ? arguments[3] : undefined;
          var synth = window.speechSynthesis;
          return new Promise(function (resolve, reject) {
            var selectedVoice;
            if (voiceName) {
              var availableVoices = synth.getVoices();
              selectedVoice = availableVoices.find(function (v) {
                return v.name === voiceName;
              }) || availableVoices[0];
            }
            var utterance = new SpeechSynthesisUtterance(phrase);
            utterance.lang = lang;
            if (selectedVoice) {
              utterance.voice = selectedVoice;
            }
            utterance.onend = function () {
              resolve();
            };
            utterance.onerror = function (e) {
              reject(e);
            };
            utterances.push(utterance);
            synth.speak(utterance);
          });
        }
        function speakSeries(series, lang, voice) {
          var root = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : true;
          var synth = window.speechSynthesis;
          var remainingPhrases = flattenStrings(Array.isArray(series) ? series : [series]);
          var nestedSeriesResults = [];
          var utterances = [];
          var active = true;
          var seriesChain = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee22() {
            var phrase, pause, totalRetries, retriesLeft, _totalRetries, _retriesLeft, text, objectLang, objectVoice, seriesResult, _seriesResult, _t12, _t13;
            return _regenerator().w(function (_context23) {
              while (1) switch (_context23.p = _context23.n) {
                case 0:
                  _context23.p = 0;
                case 1:
                  if (!(active && remainingPhrases.length)) {
                    _context23.n = 34;
                    break;
                  }
                  _context23.n = 2;
                  return Promise.resolve(remainingPhrases.shift());
                case 2:
                  phrase = _context23.v;
                  if (active) {
                    _context23.n = 3;
                    break;
                  }
                  return _context23.a(3, 34);
                case 3:
                  if (!(typeof phrase === "string" && phrase.includes("PAUSE-"))) {
                    _context23.n = 5;
                    break;
                  }
                  pause = Number(phrase.split("PAUSE-")[1]) * 1e3;
                  if (isNaN(pause)) {
                    _context23.n = 4;
                    break;
                  }
                  _context23.n = 4;
                  return delay(pause);
                case 4:
                  _context23.n = 33;
                  break;
                case 5:
                  if (!(typeof phrase === "string")) {
                    _context23.n = 18;
                    break;
                  }
                  if (phrase) {
                    _context23.n = 6;
                    break;
                  }
                  return _context23.a(3, 1);
                case 6:
                  totalRetries = 3;
                  retriesLeft = totalRetries;
                case 7:
                  if (!(active && retriesLeft > 0)) {
                    _context23.n = 17;
                    break;
                  }
                  _context23.p = 8;
                  _context23.n = 9;
                  return speak(phrase, utterances, lang, voice);
                case 9:
                  retriesLeft = 0;
                  _context23.n = 16;
                  break;
                case 10:
                  _context23.p = 10;
                  _t12 = _context23.v;
                  if (!(_t12 instanceof SpeechSynthesisErrorEvent)) {
                    _context23.n = 15;
                    break;
                  }
                  if (!(_t12.error === "network")) {
                    _context23.n = 12;
                    break;
                  }
                  retriesLeft--;
                  console.warn("Speech synthesis network error. Retries left: ".concat(retriesLeft));
                  _context23.n = 11;
                  return delay(500 * (totalRetries - retriesLeft));
                case 11:
                  _context23.n = 14;
                  break;
                case 12:
                  if (!(_t12.error === "canceled" || _t12.error === "interrupted")) {
                    _context23.n = 13;
                    break;
                  }
                  retriesLeft = 0;
                  _context23.n = 14;
                  break;
                case 13:
                  throw new Error("SpeechSynthesisErrorEvent: ".concat(_t12.error));
                case 14:
                  _context23.n = 16;
                  break;
                case 15:
                  throw _t12;
                case 16:
                  _context23.n = 7;
                  break;
                case 17:
                  _context23.n = 33;
                  break;
                case 18:
                  if (!(phrase instanceof SpeechSynthesisUtterance)) {
                    _context23.n = 30;
                    break;
                  }
                  _totalRetries = 3;
                  _retriesLeft = _totalRetries;
                  text = phrase.text;
                  objectLang = phrase === null || phrase === void 0 ? void 0 : phrase.lang;
                  objectVoice = phrase === null || phrase === void 0 ? void 0 : phrase.voice;
                case 19:
                  if (!(active && _retriesLeft > 0)) {
                    _context23.n = 29;
                    break;
                  }
                  _context23.p = 20;
                  _context23.n = 21;
                  return speak(text, utterances, objectLang, objectVoice === null || objectVoice === void 0 ? void 0 : objectVoice.name);
                case 21:
                  _retriesLeft = 0;
                  _context23.n = 28;
                  break;
                case 22:
                  _context23.p = 22;
                  _t13 = _context23.v;
                  if (!(_t13 instanceof SpeechSynthesisErrorEvent)) {
                    _context23.n = 27;
                    break;
                  }
                  if (!(_t13.error === "network")) {
                    _context23.n = 24;
                    break;
                  }
                  _retriesLeft--;
                  console.warn("Speech synthesis network error. Retries left: ".concat(_retriesLeft));
                  _context23.n = 23;
                  return delay(500 * (_totalRetries - _retriesLeft));
                case 23:
                  _context23.n = 26;
                  break;
                case 24:
                  if (!(_t13.error === "canceled" || _t13.error === "interrupted")) {
                    _context23.n = 25;
                    break;
                  }
                  _retriesLeft = 0;
                  _context23.n = 26;
                  break;
                case 25:
                  throw new Error("SpeechSynthesisErrorEvent: ".concat(_t13.error));
                case 26:
                  _context23.n = 28;
                  break;
                case 27:
                  throw _t13;
                case 28:
                  _context23.n = 19;
                  break;
                case 29:
                  _context23.n = 33;
                  break;
                case 30:
                  if (!(typeof phrase === "function")) {
                    _context23.n = 32;
                    break;
                  }
                  seriesResult = speakSeries(phrase(), lang, voice, false);
                  nestedSeriesResults.push(seriesResult);
                  _context23.n = 31;
                  return seriesResult.series;
                case 31:
                  _context23.n = 33;
                  break;
                case 32:
                  if (!Array.isArray(phrase)) {
                    _context23.n = 33;
                    break;
                  }
                  _seriesResult = speakSeries(phrase, lang, voice, false);
                  nestedSeriesResults.push(_seriesResult);
                  _context23.n = 33;
                  return _seriesResult.series;
                case 33:
                  _context23.n = 1;
                  break;
                case 34:
                  _context23.p = 34;
                  active = false;
                  return _context23.f(34);
                case 35:
                  return _context23.a(2);
              }
            }, _callee22, null, [[20, 22], [8, 10], [0,, 34, 35]]);
          }))();
          return {
            series: seriesChain,
            get active() {
              return active;
            },
            append: function append(toSpeak) {
              remainingPhrases.push(toSpeak);
            },
            cancel: function cancel() {
              if (!active) {
                return;
              }
              if (root) {
                synth.cancel();
              }
              nestedSeriesResults.forEach(function (nestedSeriesResult) {
                nestedSeriesResult.cancel();
              });
              active = false;
            }
          };
        }
        var currentSeries;
        function SpeechEngine(toSpeak) {
          var lang = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : "en-US";
          var voice = arguments.length > 2 ? arguments[2] : undefined;
          currentSeries && currentSeries.cancel();
          currentSeries = speakSeries(toSpeak, lang, voice);
          return currentSeries;
        }
        var voidFn = function voidFn() {
          return undefined;
        };
        var isServer = false;

        /**
         * Creates a callback that is debounced and cancellable. The debounced callback is called on **trailing** edge.
         *
         * The timeout will be automatically cleared on root dispose.
         *
         * @param callback The callback to debounce
         * @param wait The duration to debounce in milliseconds
         * @returns The debounced function
         *
         * @see https://github.com/solidjs-community/solid-primitives/tree/main/packages/scheduled#debounce
         *
         * @example
         * ```ts
         * const fn = debounce((message: string) => console.log(message), 250);
         * fn('Hello!');
         * fn.clear() // clears a timeout in progress
         * ```
         */
        var debounce = exports("q", function (callback, wait) {
          var timeoutId;
          var clear = function clear() {
            return clearTimeout(timeoutId);
          };
          if (getOwner()) onCleanup(clear);
          var debounced = function debounced() {
            for (var _len16 = arguments.length, args = new Array(_len16), _key21 = 0; _key21 < _len16; _key21++) {
              args[_key21] = arguments[_key21];
            }
            if (timeoutId !== undefined) clear();
            timeoutId = setTimeout(function () {
              return callback.apply(void 0, args);
            }, wait);
          };
          return Object.assign(debounced, {
            clear: clear
          });
        });
        var resetFocusPathTimer;
        var prevFocusPath = [];
        var currentlySpeaking;
        var voiceOutDisabled = false;
        var fiveMinutes = 3e5;
        function debounceWithFlush(callback, time) {
          var trigger = debounce(callback, time);
          var scopedValue;
          var debounced = function debounced(newValue) {
            scopedValue = newValue;
            trigger(newValue);
          };
          debounced.flush = function () {
            trigger.clear();
            callback(scopedValue);
          };
          debounced.clear = trigger.clear;
          return debounced;
        }
        function getElmName(elm) {
          return elm.id || elm.name;
        }
        function onFocusChangeCore() {
          var focusPath2 = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];
          if (!Announcer.onFocusChange || !Announcer.enabled) {
            return;
          }
          var loaded = focusPath2.every(function (elm) {
            return !elm.loading;
          });
          var focusDiff = focusPath2.filter(function (elm) {
            return !prevFocusPath.includes(elm);
          });
          resetFocusPathTimer();
          if (!loaded && Announcer.onFocusChange) {
            Announcer.onFocusChange([]);
            return;
          }
          prevFocusPath = focusPath2.slice(0);
          var toAnnounceText = [];
          var toAnnounce = focusDiff.reverse().reduce(function (acc, elm) {
            if (elm.announce) {
              acc.push([getElmName(elm), "Announce", elm.announce]);
              toAnnounceText.push(elm.announce);
            } else if (elm.title) {
              acc.push([getElmName(elm), "Title", elm.title]);
              toAnnounceText.push(elm.title);
            } else {
              acc.push([getElmName(elm), "No Announce", ""]);
            }
            return acc;
          }, []);
          focusDiff.reverse().reduce(function (acc, elm) {
            if (elm.announceContext) {
              acc.push([getElmName(elm), "Context", elm.announceContext]);
              toAnnounceText.push(elm.announceContext);
            } else {
              acc.push([getElmName(elm), "No Context", ""]);
            }
            return acc;
          }, toAnnounce);
          if (Announcer.debug) {
            console.table(toAnnounce);
          }
          if (toAnnounceText.length) {
            return Announcer.speak(toAnnounceText.reduce(function (acc, val) {
              return acc.concat(val);
            }, []));
          }
        }
        function textToSpeech(toSpeak, lang, voice) {
          if (voiceOutDisabled) {
            return;
          }
          return currentlySpeaking = SpeechEngine(toSpeak, lang, voice);
        }
        var Announcer = exports("A", {
          debug: false,
          enabled: true,
          lang: "en-US",
          cancel: function cancel() {
            currentlySpeaking && currentlySpeaking.cancel();
          },
          clearPrevFocus: function clearPrevFocus() {
            var depth = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;
            prevFocusPath = prevFocusPath.slice(0, depth);
            resetFocusPathTimer();
          },
          speak: function speak(text) {
            var _ref37 = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},
              _ref37$append = _ref37.append,
              append = _ref37$append === void 0 ? false : _ref37$append,
              _ref37$notification = _ref37.notification,
              notification = _ref37$notification === void 0 ? false : _ref37$notification;
            if (Announcer.onFocusChange && Announcer.enabled) {
              if (append && currentlySpeaking && currentlySpeaking.active) {
                currentlySpeaking.append(text);
              } else {
                Announcer.cancel();
                textToSpeech(text, Announcer.lang, Announcer.voice);
              }
              if (notification) {
                var _currentlySpeaking;
                voiceOutDisabled = true;
                (_currentlySpeaking = currentlySpeaking) === null || _currentlySpeaking === void 0 || _currentlySpeaking.series.finally(function () {
                  voiceOutDisabled = false;
                  Announcer.refresh();
                }).catch(console.error);
              }
            }
            return currentlySpeaking;
          },
          refresh: function refresh() {
            var depth = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;
            Announcer.clearPrevFocus(depth);
            Announcer.onFocusChange && Announcer.onFocusChange(untrack(function () {
              return focusPath();
            }));
          },
          setupTimers: function setupTimers() {
            var _ref38 = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},
              _ref38$focusDebounce = _ref38.focusDebounce,
              focusDebounce = _ref38$focusDebounce === void 0 ? 400 : _ref38$focusDebounce,
              _ref38$focusChangeTim = _ref38.focusChangeTimeout,
              focusChangeTimeout = _ref38$focusChangeTim === void 0 ? fiveMinutes : _ref38$focusChangeTim;
            Announcer.onFocusChange = debounceWithFlush(onFocusChangeCore, focusDebounce);
            resetFocusPathTimer = debounceWithFlush(function () {
              prevFocusPath = [];
            }, focusChangeTimeout);
          }
        });
        var doOnce = false;
        var useAnnouncer = function useAnnouncer(options) {
          if (doOnce) {
            return Announcer;
          }
          doOnce = true;
          Announcer.setupTimers(options);
          createEffect(on(focusPath, Announcer.onFocusChange, {
            defer: true
          }));
          return Announcer;
        };
        function createLazy(component, props, keyHandler) {
          var _createSignal21 = createSignal(props.sync ? props.upCount : 0),
            _createSignal22 = _slicedToArray(_createSignal21, 2),
            offset = _createSignal22[0],
            setOffset = _createSignal22[1];
          var timeoutId = null;
          var viewRef;
          var buffer = createMemo(function () {
            var _props$style;
            if (typeof props.buffer === "number") {
              return props.buffer;
            }
            var scroll = props.scroll || ((_props$style = props.style) === null || _props$style === void 0 ? void 0 : _props$style.scroll);
            if (!scroll || scroll === "auto" || scroll === "always") return props.upCount + 1;
            if (scroll === "center") return Math.ceil(props.upCount / 2) + 1;
            return 2;
          });
          createRenderEffect(function () {
            return setOffset(function (offset2) {
              return Math.max(offset2, (props.selected || 0) + buffer());
            });
          });
          if (!props.sync || props.eagerLoad) {
            createEffect(function () {
              if (props.each) {
                var _loadItems = function loadItems() {
                  var count = untrack(offset);
                  if (count < props.upCount) {
                    setOffset(count + 1);
                    timeoutId = setTimeout(_loadItems, 16);
                    count++;
                  } else if (props.eagerLoad) {
                    var maxOffset = props.each ? props.each.length : 0;
                    if (count >= maxOffset) return;
                    setOffset(function (prev) {
                      return Math.min(prev + 1, maxOffset);
                    });
                    scheduleTask(_loadItems);
                  }
                };
                _loadItems();
              }
            });
          }
          var items = createMemo(function () {
            return Array.isArray(props.each) ? props.each.slice(0, offset()) : [];
          });
          function lazyScrollToIndex(index) {
            setOffset(Math.max(index, 0) + buffer());
            queueMicrotask(function () {
              return viewRef.scrollToIndex(index);
            });
          }
          var updateOffset = function updateOffset(_event, container) {
            var _props$delay;
            var maxOffset = props.each ? props.each.length : 0;
            var selected = container.selected || 0;
            var numChildren = container.children.length;
            if (offset() >= maxOffset || selected < numChildren - buffer()) return;
            if (!props.delay) {
              setOffset(function (prev) {
                return Math.min(prev + 1, maxOffset);
              });
              return;
            }
            if (timeoutId) {
              clearTimeout(timeoutId);
              setOffset(function (prev) {
                return Math.min(prev + 1, maxOffset);
              });
            }
            timeoutId = setTimeout(function () {
              setOffset(function (prev) {
                return Math.min(prev + 1, maxOffset);
              });
              timeoutId = null;
            }, (_props$delay = props.delay) !== null && _props$delay !== void 0 ? _props$delay : 0);
          };
          var handler = keyHandler(updateOffset);
          return createComponent(Dynamic, mergeProps(props, {
            component: component
          }, handler, {
            lazyScrollToIndex: lazyScrollToIndex,
            ref: function ref(r$) {
              var _ref$ = chainRefs(function (el) {
                viewRef = el;
              }, props.ref);
              typeof _ref$ === "function" && _ref$(r$);
            },
            get children() {
              return createComponent(Index, {
                get each() {
                  return items();
                },
                get children() {
                  return props.children;
                }
              });
            }
          }));
        }
        function LazyRow(props) {
          return createLazy(Row, props, function (updateOffset) {
            return {
              onRight: updateOffset
            };
          });
        }
        function LazyColumn(props) {
          return createLazy(Column, props, function (updateOffset) {
            return {
              onDown: updateOffset
            };
          });
        }
        var Image$1 = function Image$1(props) {
          var _createSignal23 = createSignal(null),
            _createSignal24 = _slicedToArray(_createSignal23, 2),
            texture = _createSignal24[0],
            setTexture = _createSignal24[1];
          var _createSignal25 = createSignal(props.placeholder || null),
            _createSignal26 = _slicedToArray(_createSignal25, 2),
            src = _createSignal26[0],
            setSrc = _createSignal26[1];
          createRenderEffect(function () {
            var srcTexture = renderer$1.createTexture("ImageTexture", props);
            if (props.fallback) {
              srcTexture.once("failed", function () {
                if (props.fallback === props.placeholder) {
                  return;
                }
                setSrc(props.fallback);
              });
            }
            srcTexture.getTextureData().then(function (resp) {
              if (resp.data) setTexture(srcTexture);
            });
          });
          return function () {
            var _el$ = createElement("view");
            spread(_el$, mergeProps(props, {
              get src() {
                return src();
              },
              get color() {
                return props.color || 4294967295;
              },
              get texture() {
                return texture();
              }
            }), false);
            return _el$;
          }();
        };
        function createBeforeLeave() {
          var listeners = new Set();
          function subscribe(listener) {
            listeners.add(listener);
            return function () {
              return listeners.delete(listener);
            };
          }
          var ignore = false;
          function confirm(to, options) {
            if (ignore) return !(ignore = false);
            var e = {
              to: to,
              options: options,
              defaultPrevented: false,
              preventDefault: function preventDefault() {
                return e.defaultPrevented = true;
              }
            };
            var _iterator35 = _createForOfIteratorHelper(listeners),
              _step35;
            try {
              var _loop10 = function _loop10() {
                var l = _step35.value;
                l.listener(_objectSpread(_objectSpread({}, e), {}, {
                  from: l.location,
                  retry: function retry(force) {
                    force && (ignore = true);
                    l.navigate(to, _objectSpread(_objectSpread({}, options), {}, {
                      resolve: false
                    }));
                  }
                }));
              };
              for (_iterator35.s(); !(_step35 = _iterator35.n()).done;) {
                _loop10();
              }
            } catch (err) {
              _iterator35.e(err);
            } finally {
              _iterator35.f();
            }
            return !e.defaultPrevented;
          }
          return {
            subscribe: subscribe,
            confirm: confirm
          };
        }
        // The following supports browser initiated blocking (eg back/forward)
        var depth;
        function saveCurrentDepth() {
          if (!window.history.state || window.history.state._depth == null) {
            window.history.replaceState(_objectSpread(_objectSpread({}, window.history.state), {}, {
              _depth: window.history.length - 1
            }), "");
          }
          depth = window.history.state._depth;
        }
        {
          saveCurrentDepth();
        }
        function keepDepth(state) {
          return _objectSpread(_objectSpread({}, state), {}, {
            _depth: window.history.state && window.history.state._depth
          });
        }
        function notifyIfNotBlocked(notify, block) {
          var ignore = false;
          return function () {
            var prevDepth = depth;
            saveCurrentDepth();
            var delta = prevDepth == null ? null : depth - prevDepth;
            if (ignore) {
              ignore = false;
              return;
            }
            if (delta && block(delta)) {
              ignore = true;
              window.history.go(-delta);
            } else {
              notify();
            }
          };
        }
        var hasSchemeRegex = /^(?:[a-z0-9]+:)?\/\//i;
        var trimPathRegex = /^\/+|(\/)\/+$/g;
        var mockBase = "http://sr";
        function normalizePath(path) {
          var omitSlash = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;
          var s = path.replace(trimPathRegex, "$1");
          return s ? omitSlash || /^[?#]/.test(s) ? s : "/" + s : "";
        }
        function _resolvePath(base, path, from) {
          if (hasSchemeRegex.test(path)) {
            return undefined;
          }
          var basePath = normalizePath(base);
          var fromPath = from && normalizePath(from);
          var result = "";
          if (!fromPath || path.startsWith("/")) {
            result = basePath;
          } else if (fromPath.toLowerCase().indexOf(basePath.toLowerCase()) !== 0) {
            result = basePath + fromPath;
          } else {
            result = fromPath;
          }
          return (result || "/") + normalizePath(path, !result);
        }
        function invariant(value, message) {
          if (value == null) {
            throw new Error(message);
          }
          return value;
        }
        function joinPaths(from, to) {
          return normalizePath(from).replace(/\/*(\*.*)?$/g, "") + normalizePath(to);
        }
        function extractSearchParams(url) {
          var params = {};
          url.searchParams.forEach(function (value, key) {
            if (key in params) {
              if (Array.isArray(params[key])) params[key].push(value);else params[key] = [params[key], value];
            } else params[key] = value;
          });
          return params;
        }
        function createMatcher(path, partial, matchFilters) {
          var _path$split = path.split("/*", 2),
            _path$split2 = _slicedToArray(_path$split, 2),
            pattern = _path$split2[0],
            splat = _path$split2[1];
          var segments = pattern.split("/").filter(Boolean);
          var len = segments.length;
          return function (location) {
            var locSegments = location.split("/").filter(Boolean);
            var lenDiff = locSegments.length - len;
            if (lenDiff < 0 || lenDiff > 0 && splat === undefined && !partial) {
              return null;
            }
            var match = {
              path: len ? "" : "/",
              params: {}
            };
            var matchFilter = function matchFilter(s) {
              return matchFilters === undefined ? undefined : matchFilters[s];
            };
            for (var i = 0; i < len; i++) {
              var segment = segments[i];
              var dynamic = segment[0] === ":";
              var locSegment = dynamic ? locSegments[i] : locSegments[i].toLowerCase();
              var key = dynamic ? segment.slice(1) : segment.toLowerCase();
              if (dynamic && matchSegment(locSegment, matchFilter(key))) {
                match.params[key] = locSegment;
              } else if (dynamic || !matchSegment(locSegment, key)) {
                return null;
              }
              match.path += "/".concat(locSegment);
            }
            if (splat) {
              var remainder = lenDiff ? locSegments.slice(-lenDiff).join("/") : "";
              if (matchSegment(remainder, matchFilter(splat))) {
                match.params[splat] = remainder;
              } else {
                return null;
              }
            }
            return match;
          };
        }
        function matchSegment(input, filter) {
          var isEqual = function isEqual(s) {
            return s === input;
          };
          if (filter === undefined) {
            return true;
          } else if (typeof filter === "string") {
            return isEqual(filter);
          } else if (typeof filter === "function") {
            return filter(input);
          } else if (Array.isArray(filter)) {
            return filter.some(isEqual);
          } else if (filter instanceof RegExp) {
            return filter.test(input);
          }
          return false;
        }
        function scoreRoute(route) {
          var _route$pattern$split = route.pattern.split("/*", 2),
            _route$pattern$split2 = _slicedToArray(_route$pattern$split, 2),
            pattern = _route$pattern$split2[0],
            splat = _route$pattern$split2[1];
          var segments = pattern.split("/").filter(Boolean);
          return segments.reduce(function (score, segment) {
            return score + (segment.startsWith(":") ? 2 : 3);
          }, segments.length - (splat === undefined ? 0 : 1));
        }
        function createMemoObject(fn) {
          var map = new Map();
          var owner = getOwner();
          return new Proxy({}, {
            get: function get(_, property) {
              if (!map.has(property)) {
                runWithOwner(owner, function () {
                  return map.set(property, createMemo(function () {
                    return fn()[property];
                  }));
                });
              }
              return map.get(property)();
            },
            getOwnPropertyDescriptor: function getOwnPropertyDescriptor() {
              return {
                enumerable: true,
                configurable: true
              };
            },
            ownKeys: function ownKeys() {
              return Reflect.ownKeys(fn());
            }
          });
        }
        function expandOptionals(pattern) {
          var match = /(\/?\:[^\/]+)\?/.exec(pattern);
          if (!match) return [pattern];
          var prefix = pattern.slice(0, match.index);
          var suffix = pattern.slice(match.index + match[0].length);
          var prefixes = [prefix, prefix += match[1]];
          // This section handles adjacent optional params. We don't actually want all permuations since
          // that will lead to equivalent routes which have the same number of params. For example
          // `/:a?/:b?/:c`? only has the unique expansion: `/`, `/:a`, `/:a/:b`, `/:a/:b/:c` and we can
          // discard `/:b`, `/:c`, `/:b/:c` by building them up in order and not recursing. This also helps
          // ensure predictability where earlier params have precidence.
          while (match = /^(\/\:[^\/]+)\?/.exec(suffix)) {
            prefixes.push(prefix += match[1]);
            suffix = suffix.slice(match[0].length);
          }
          return expandOptionals(suffix).reduce(function (results, expansion) {
            return [].concat(_toConsumableArray(results), _toConsumableArray(prefixes.map(function (p) {
              return p + expansion;
            })));
          }, []);
        }
        var MAX_REDIRECTS = 100;
        var RouterContextObj = createContext();
        var RouteContextObj = createContext();
        var useRouter = function useRouter() {
          return invariant(useContext(RouterContextObj), "<A> and 'use' router primitives can be only used inside a Route.");
        };
        /**
         * Retrieves method to do navigation. The method accepts a path to navigate to and an optional object with the following options:
         *
         * - resolve (*boolean*, default `true`): resolve the path against the current route
         * - replace (*boolean*, default `false`): replace the history entry
         * - scroll (*boolean*, default `true`): scroll to top after navigation
         * - state (*any*, default `undefined`): pass custom state to `location.state`
         *
         * **Note**: The state is serialized using the structured clone algorithm which does not support all object types.
         *
         * @example
         * ```js
         * const navigate = useNavigate();
         *
         * if (unauthorized) {
         *   navigate("/login", { replace: true });
         * }
         * ```
         */
        var useNavigate = exports("w", function () {
          return useRouter().navigatorFactory();
        });
        /**
         * Retrieves reactive `location` object useful for getting things like `pathname`.
         *
         * @example
         * ```js
         * const location = useLocation();
         *
         * const pathname = createMemo(() => parsePath(location.pathname));
         * ```
         */
        var useLocation = function useLocation() {
          return useRouter().location;
        };
        /**
         * usePreloadRoute returns a function that can be used to preload a route manual.
         * This is what happens automatically with link hovering and similar focus based behavior, but it is available here as an API.
         *
         * @example
         * ```js
         * const preload = usePreloadRoute();
         *
         * preload(`/users/settings`, { preloadData: true });
         * ```
         */
        var usePreloadRoute = function usePreloadRoute() {
          var pre = useRouter().preloadRoute;
          return function (url) {
            var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
            return pre(url instanceof URL ? url : new URL(url, mockBase), options.preloadData);
          };
        };
        /**
         * `useMatch` takes an accessor that returns the path and creates a `Memo` that returns match information if the current path matches the provided path.
         * Useful for determining if a given path matches the current route.
         *
         * @example
         * ```js
         * const match = useMatch(() => props.href);
         *
         * return <div classList={{ active: Boolean(match()) }} />;
         * ```
         */
        var useMatch = function useMatch(path, matchFilters) {
          var location = useLocation();
          var matchers = createMemo(function () {
            return expandOptionals(path()).map(function (path) {
              return createMatcher(path, undefined, matchFilters);
            });
          });
          return createMemo(function () {
            var _iterator36 = _createForOfIteratorHelper(matchers()),
              _step36;
            try {
              for (_iterator36.s(); !(_step36 = _iterator36.n()).done;) {
                var matcher = _step36.value;
                var match = matcher(location.pathname);
                if (match) return match;
              }
            } catch (err) {
              _iterator36.e(err);
            } finally {
              _iterator36.f();
            }
          });
        };
        /**
         * Retrieves a reactive, store-like object containing the current route path parameters as defined in the Route.
         *
         * @example
         * ```js
         * const params = useParams();
         *
         * // fetch user based on the id path parameter
         * const [user] = createResource(() => params.id, fetchUser);
         * ```
         */
        var useParams = exports("_", function () {
          return useRouter().params;
        });
        function createRoutes(routeDef) {
          var base = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : "";
          var component = routeDef.component,
            preload = routeDef.preload,
            load = routeDef.load,
            children = routeDef.children,
            info = routeDef.info;
          var isLeaf = !children || Array.isArray(children) && !children.length;
          var shared = {
            key: routeDef,
            component: component,
            preload: preload || load,
            info: info
          };
          return asArray(routeDef.path).reduce(function (acc, originalPath) {
            var _iterator37 = _createForOfIteratorHelper(expandOptionals(originalPath)),
              _step37;
            try {
              for (_iterator37.s(); !(_step37 = _iterator37.n()).done;) {
                var expandedPath = _step37.value;
                var path = joinPaths(base, expandedPath);
                var pattern = isLeaf ? path : path.split("/*", 1)[0];
                pattern = pattern.split("/").map(function (s) {
                  return s.startsWith(":") || s.startsWith("*") ? s : encodeURIComponent(s);
                }).join("/");
                acc.push(_objectSpread(_objectSpread({}, shared), {}, {
                  originalPath: originalPath,
                  pattern: pattern,
                  matcher: createMatcher(pattern, !isLeaf, routeDef.matchFilters)
                }));
              }
            } catch (err) {
              _iterator37.e(err);
            } finally {
              _iterator37.f();
            }
            return acc;
          }, []);
        }
        function createBranch(routes) {
          var index = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;
          return {
            routes: routes,
            score: scoreRoute(routes[routes.length - 1]) * 10000 - index,
            matcher: function matcher(location) {
              var matches = [];
              for (var i = routes.length - 1; i >= 0; i--) {
                var route = routes[i];
                var match = route.matcher(location);
                if (!match) {
                  return null;
                }
                matches.unshift(_objectSpread(_objectSpread({}, match), {}, {
                  route: route
                }));
              }
              return matches;
            }
          };
        }
        function asArray(value) {
          return Array.isArray(value) ? value : [value];
        }
        function createBranches(routeDef) {
          var base = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : "";
          var stack = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : [];
          var branches = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : [];
          var routeDefs = asArray(routeDef);
          for (var i = 0, len = routeDefs.length; i < len; i++) {
            var def = routeDefs[i];
            if (def && _typeof(def) === "object") {
              if (!def.hasOwnProperty("path")) def.path = "";
              var routes = createRoutes(def, base);
              var _iterator38 = _createForOfIteratorHelper(routes),
                _step38;
              try {
                for (_iterator38.s(); !(_step38 = _iterator38.n()).done;) {
                  var route = _step38.value;
                  stack.push(route);
                  var isEmptyArray = Array.isArray(def.children) && def.children.length === 0;
                  if (def.children && !isEmptyArray) {
                    createBranches(def.children, route.pattern, stack, branches);
                  } else {
                    var branch = createBranch(_toConsumableArray(stack), branches.length);
                    branches.push(branch);
                  }
                  stack.pop();
                }
              } catch (err) {
                _iterator38.e(err);
              } finally {
                _iterator38.f();
              }
            }
          }
          // Stack will be empty on final return
          return stack.length ? branches : branches.sort(function (a, b) {
            return b.score - a.score;
          });
        }
        function getRouteMatches(branches, location) {
          for (var i = 0, len = branches.length; i < len; i++) {
            var match = branches[i].matcher(location);
            if (match) {
              return match;
            }
          }
          return [];
        }
        function createLocation(path, state, queryWrapper) {
          var origin = new URL(mockBase);
          var url = createMemo(function (prev) {
            var path_ = path();
            try {
              return new URL(path_, origin);
            } catch (err) {
              console.error("Invalid path ".concat(path_));
              return prev;
            }
          }, origin, {
            equals: function equals(a, b) {
              return a.href === b.href;
            }
          });
          var pathname = createMemo(function () {
            return url().pathname;
          });
          var search = createMemo(function () {
            return url().search;
          }, true);
          var hash = createMemo(function () {
            return url().hash;
          });
          var key = function key() {
            return "";
          };
          var queryFn = on(search, function () {
            return extractSearchParams(url());
          });
          return {
            get pathname() {
              return pathname();
            },
            get search() {
              return search();
            },
            get hash() {
              return hash();
            },
            get state() {
              return state();
            },
            get key() {
              return key();
            },
            query: queryWrapper ? queryWrapper(queryFn) : createMemoObject(queryFn)
          };
        }
        var intent;
        function getIntent() {
          return intent;
        }
        function setInPreloadFn(value) {}
        function createRouterContext(integration, branches, getContext) {
          var options = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {};
          var _integration$signal = _slicedToArray(integration.signal, 2),
            source = _integration$signal[0],
            setSource = _integration$signal[1],
            _integration$utils = integration.utils,
            utils = _integration$utils === void 0 ? {} : _integration$utils;
          var parsePath = utils.parsePath || function (p) {
            return p;
          };
          var renderPath = utils.renderPath || function (p) {
            return p;
          };
          var beforeLeave = utils.beforeLeave || createBeforeLeave();
          var basePath = _resolvePath("", options.base || "");
          if (basePath === undefined) {
            throw new Error("".concat(basePath, " is not a valid base path"));
          } else if (basePath && !source().value) {
            setSource({
              value: basePath,
              replace: true,
              scroll: false
            });
          }
          var _createSignal27 = createSignal(false),
            _createSignal28 = _slicedToArray(_createSignal27, 2),
            isRouting = _createSignal28[0],
            setIsRouting = _createSignal28[1];
          // Keep track of last target, so that last call to transition wins
          var lastTransitionTarget;
          // Transition the location to a new value
          var transition = function transition(newIntent, newTarget) {
            if (newTarget.value === reference() && newTarget.state === state()) return;
            if (lastTransitionTarget === undefined) setIsRouting(true);
            intent = newIntent;
            lastTransitionTarget = newTarget;
            startTransition(function () {
              if (lastTransitionTarget !== newTarget) return;
              setReference(lastTransitionTarget.value);
              setState(lastTransitionTarget.state);
              submissions[1](function (subs) {
                return subs.filter(function (s) {
                  return s.pending;
                });
              });
            }).finally(function () {
              if (lastTransitionTarget !== newTarget) return;
              // Batch, in order for isRouting and final source update to happen together
              batch(function () {
                intent = undefined;
                if (newIntent === "navigate") navigateEnd(lastTransitionTarget);
                setIsRouting(false);
                lastTransitionTarget = undefined;
              });
            });
          };
          var _createSignal29 = createSignal(source().value),
            _createSignal30 = _slicedToArray(_createSignal29, 2),
            reference = _createSignal30[0],
            setReference = _createSignal30[1];
          var _createSignal31 = createSignal(source().state),
            _createSignal32 = _slicedToArray(_createSignal31, 2),
            state = _createSignal32[0],
            setState = _createSignal32[1];
          var location = createLocation(reference, state, utils.queryWrapper);
          var referrers = [];
          var submissions = createSignal([]);
          var matches = createMemo(function () {
            if (typeof options.transformUrl === "function") {
              return getRouteMatches(branches(), options.transformUrl(location.pathname));
            }
            return getRouteMatches(branches(), location.pathname);
          });
          var buildParams = function buildParams() {
            var m = matches();
            var params = {};
            for (var i = 0; i < m.length; i++) {
              Object.assign(params, m[i].params);
            }
            return params;
          };
          var params = utils.paramsWrapper ? utils.paramsWrapper(buildParams, branches) : createMemoObject(buildParams);
          var baseRoute = {
            pattern: basePath,
            path: function path() {
              return basePath;
            },
            outlet: function outlet() {
              return null;
            },
            resolvePath: function resolvePath(to) {
              return _resolvePath(basePath, to);
            }
          };
          // Create a native transition, when source updates
          createRenderEffect(on(source, function (source) {
            return transition("native", source);
          }, {
            defer: true
          }));
          return {
            base: baseRoute,
            location: location,
            params: params,
            isRouting: isRouting,
            renderPath: renderPath,
            parsePath: parsePath,
            navigatorFactory: navigatorFactory,
            matches: matches,
            beforeLeave: beforeLeave,
            preloadRoute: preloadRoute,
            singleFlight: options.singleFlight === undefined ? true : options.singleFlight,
            submissions: submissions
          };
          function navigateFromRoute(route, to, options) {
            // Untrack in case someone navigates in an effect - don't want to track `reference` or route paths
            untrack(function () {
              if (typeof to === "number") {
                if (!to) {
                  // A delta of 0 means stay at the current location, so it is ignored
                } else if (utils.go) {
                  utils.go(to);
                } else {
                  console.warn("Router integration does not support relative routing");
                }
                return;
              }
              var queryOnly = !to || to[0] === "?";
              var _replace$resolve$scro = _objectSpread({
                  replace: false,
                  resolve: !queryOnly,
                  scroll: true
                }, options),
                replace = _replace$resolve$scro.replace,
                resolve = _replace$resolve$scro.resolve,
                scroll = _replace$resolve$scro.scroll,
                nextState = _replace$resolve$scro.state;
              var resolvedTo = resolve ? route.resolvePath(to) : _resolvePath(queryOnly && location.pathname || "", to);
              if (resolvedTo === undefined) {
                throw new Error("Path '".concat(to, "' is not a routable path"));
              } else if (referrers.length >= MAX_REDIRECTS) {
                throw new Error("Too many redirects");
              }
              var current = reference();
              if (resolvedTo !== current || nextState !== state()) {
                if (isServer) ;else if (beforeLeave.confirm(resolvedTo, options)) {
                  referrers.push({
                    value: current,
                    replace: replace,
                    scroll: scroll,
                    state: state()
                  });
                  transition("navigate", {
                    value: resolvedTo,
                    state: nextState
                  });
                }
              }
            });
          }
          function navigatorFactory(route) {
            // Workaround for vite issue (https://github.com/vitejs/vite/issues/3803)
            route = route || useContext(RouteContextObj) || baseRoute;
            return function (to, options) {
              return navigateFromRoute(route, to, options);
            };
          }
          function navigateEnd(next) {
            var first = referrers[0];
            if (first) {
              setSource(_objectSpread(_objectSpread({}, next), {}, {
                replace: first.replace,
                scroll: first.scroll
              }));
              referrers.length = 0;
            }
          }
          function preloadRoute(url, preloadData) {
            var matches = getRouteMatches(branches(), url.pathname);
            var prevIntent = intent;
            intent = "preload";
            var _loop11 = function _loop11() {
              var _matches$match = matches[match],
                route = _matches$match.route,
                params = _matches$match.params;
              route.component && route.component.preload && route.component.preload();
              var preload = route.preload;
              preloadData && preload && runWithOwner(getContext(), function () {
                return preload({
                  params: params,
                  location: {
                    pathname: url.pathname,
                    search: url.search,
                    hash: url.hash,
                    query: extractSearchParams(url),
                    state: null,
                    key: ""
                  },
                  intent: "preload"
                });
              });
            };
            for (var match in matches) {
              _loop11();
            }
            intent = prevIntent;
          }
        }
        function createRouteContext(router, parent, _outlet, match) {
          var base = router.base,
            location = router.location,
            params = router.params;
          var _match$route = match().route,
            pattern = _match$route.pattern,
            component = _match$route.component,
            preload = _match$route.preload;
          var path = createMemo(function () {
            return match().path;
          });
          component && component.preload && component.preload();
          var data = preload ? preload({
            params: params,
            location: location,
            intent: intent || "initial"
          }) : undefined;
          var route = {
            parent: parent,
            pattern: pattern,
            path: path,
            outlet: function outlet() {
              return component ? createComponent$1(component, {
                params: params,
                location: location,
                data: data,
                get children() {
                  return _outlet();
                }
              }) : _outlet();
            },
            resolvePath: function resolvePath(to) {
              return _resolvePath(base.path(), to, path());
            }
          };
          return route;
        }
        var createRouterComponent = function createRouterComponent(router) {
          return function (props) {
            var base = props.base;
            var routeDefs = children(function () {
              return props.children;
            });
            var branches = createMemo(function () {
              return createBranches(routeDefs(), props.base || "");
            });
            var context;
            var routerState = createRouterContext(router, branches, function () {
              return context;
            }, {
              base: base,
              singleFlight: props.singleFlight,
              transformUrl: props.transformUrl
            });
            router.create && router.create(routerState);
            return createComponent(RouterContextObj.Provider, {
              value: routerState,
              get children() {
                return createComponent(Root, {
                  routerState: routerState,
                  get root() {
                    return props.root;
                  },
                  get preload() {
                    return props.rootPreload || props.rootLoad;
                  },
                  get children() {
                    return [memo(function () {
                      return (context = getOwner()) && null;
                    }), createComponent(Routes, {
                      routerState: routerState,
                      get branches() {
                        return branches();
                      }
                    })];
                  }
                });
              }
            });
          };
        };
        function Root(props) {
          var location = props.routerState.location;
          var params = props.routerState.params;
          var data = createMemo(function () {
            return props.preload && untrack(function () {
              setInPreloadFn(true);
              props.preload({
                params: params,
                location: location,
                intent: getIntent() || "initial"
              });
              setInPreloadFn(false);
            });
          });
          return createComponent(Show, {
            get when() {
              return props.root;
            },
            keyed: true,
            get fallback() {
              return props.children;
            },
            children: function children(Root2) {
              return createComponent(Root2, {
                params: params,
                location: location,
                get data() {
                  return data();
                },
                get children() {
                  return props.children;
                }
              });
            }
          });
        }
        function Routes(props) {
          var disposers = [];
          var root;
          var routeStates = createMemo(on(props.routerState.matches, function (nextMatches, prevMatches, prev) {
            var equal = prevMatches && nextMatches.length === prevMatches.length;
            var next = [];
            var _loop12 = function _loop12(i) {
              var prevMatch = prevMatches && prevMatches[i];
              var nextMatch = nextMatches[i];
              if (prev && prevMatch && nextMatch.route.key === prevMatch.route.key) {
                next[i] = prev[i];
              } else {
                equal = false;
                if (disposers[i]) {
                  disposers[i]();
                }
                createRoot(function (dispose) {
                  disposers[i] = dispose;
                  next[i] = createRouteContext(props.routerState, next[i - 1] || props.routerState.base, createOutlet(function () {
                    return routeStates()[i + 1];
                  }), function () {
                    return props.routerState.matches()[i];
                  });
                });
              }
            };
            for (var i = 0, len = nextMatches.length; i < len; i++) {
              _loop12(i);
            }
            disposers.splice(nextMatches.length).forEach(function (dispose) {
              return dispose();
            });
            if (prev && equal) {
              return prev;
            }
            root = next[0];
            return next;
          }));
          return createOutlet(function () {
            return routeStates() && root;
          })();
        }
        var createOutlet = function createOutlet(child) {
          return function () {
            return createComponent(Show, {
              get when() {
                return child();
              },
              keyed: true,
              children: function children(child2) {
                return createComponent(RouteContextObj.Provider, {
                  value: child2,
                  get children() {
                    return child2.outlet();
                  }
                });
              }
            });
          };
        };
        var Route = function Route(props) {
          var childRoutes = children(function () {
            return props.children;
          });
          return mergeProps$1(props, {
            get children() {
              return childRoutes();
            }
          });
        };
        function intercept(_ref39, get, set) {
          var _ref40 = _slicedToArray(_ref39, 2),
            value = _ref40[0],
            setValue = _ref40[1];
          return [value, set ? function (v) {
            return setValue(set(v));
          } : setValue];
        }
        function createRouter(config) {
          var ignore = false;
          var wrap = function wrap(value) {
            return typeof value === "string" ? {
              value: value
            } : value;
          };
          var signal = intercept(createSignal(wrap(config.get()), {
            equals: function equals(a, b) {
              return a.value === b.value && a.state === b.state;
            }
          }), undefined, function (next) {
            !ignore && config.set(next);
            if (sharedConfig.registry && !sharedConfig.done) sharedConfig.done = true;
            return next;
          });
          config.init && onCleanup(config.init(function () {
            var value = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : config.get();
            ignore = true;
            signal[1](wrap(value));
            ignore = false;
          }));
          return createRouterComponent({
            signal: signal,
            create: config.create,
            utils: config.utils
          });
        }
        function Navigate(props) {
          var navigate = useNavigate();
          var location = useLocation();
          var href = props.href,
            state = props.state;
          var path = typeof href === "function" ? href({
            navigate: navigate,
            location: location
          }) : href;
          navigate(path, {
            replace: true,
            state: state
          });
          return null;
        }
        function hashParser(str) {
          var to = str.replace(/^.*?#/, "");
          if (!to.startsWith("/")) {
            var _window$location$hash = window.location.hash.split("#", 2),
              _window$location$hash2 = _slicedToArray(_window$location$hash, 2),
              _window$location$hash3 = _window$location$hash2[1],
              path = _window$location$hash3 === void 0 ? "/" : _window$location$hash3;
            return "".concat(path, "#").concat(to);
          }
          return to;
        }
        function bindEvent(target, type, handler) {
          target.addEventListener(type, handler);
          return function () {
            return target.removeEventListener(type, handler);
          };
        }
        function HashRouter(props) {
          var getSource = function getSource() {
            return window.location.hash.slice(1);
          };
          var beforeLeave = createBeforeLeave();
          return createRouter({
            get: getSource,
            set: function set(_ref41) {
              var value = _ref41.value,
                replace = _ref41.replace,
                state = _ref41.state;
              if (replace) {
                window.history.replaceState(keepDepth(state), "", "#" + value);
              } else {
                window.history.pushState(state, "", "#" + value);
              }
              saveCurrentDepth();
            },
            init: function init(notify) {
              return bindEvent(window, "hashchange", notifyIfNotBlocked(notify, function (delta) {
                return !beforeLeave.confirm(delta && delta < 0 ? delta : getSource());
              }));
            },
            utils: {
              go: function go(delta) {
                return window.history.go(delta);
              },
              renderPath: function renderPath(path) {
                return "#".concat(path);
              },
              parsePath: hashParser,
              beforeLeave: beforeLeave,
              queryWrapper: props.forceProxy || !SUPPORTS_PROXY ? function (getQuery) {
                return createMemoWithoutProxy(getQuery, props.queryParams);
              } : void 0,
              paramsWrapper: props.forceProxy || !SUPPORTS_PROXY ? function (buildParams, branches) {
                return createMemoWithoutProxy(buildParams, collectDynamicParams(branches()));
              } : void 0
            }
          })(props);
        }
        var SUPPORTS_PROXY = typeof Proxy === "function";
        function createMemoWithoutProxy(fn, allKeys) {
          var map = /* @__PURE__ */new Map();
          var owner = getOwner();
          var target = {};
          var handler = function handler(property) {
            if (!map.has(property)) {
              runWithOwner(owner, function () {
                return map.set(property, createMemo(function () {
                  return fn()[property];
                }));
              });
            }
            return map.get(property)();
          };
          var keys = allKeys ? allKeys : Object.keys(fn());
          keys.forEach(function (key) {
            Object.defineProperty(target, key, {
              get: function get() {
                return handler(key);
              },
              enumerable: true,
              configurable: true
            });
          });
          return target;
        }
        var collectDynamicParams = function collectDynamicParams(branches) {
          var dynamicParams = [];
          branches.forEach(function (branch) {
            branch.routes.forEach(function (route) {
              if (route.pattern) {
                var matches = route.pattern.match(/:(\w+)/g);
                if (matches) {
                  matches.forEach(function (param) {
                    var p = param.slice(1);
                    if (!dynamicParams.includes(p)) dynamicParams.push(p);
                  });
                }
              }
            });
          });
          return dynamicParams;
        };
        function idxInArray(idx, arr) {
          return idx >= 0 && idx < arr.length;
        }
        function findFirstFocusableChildIdx(el) {
          var from = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;
          var delta = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 1;
          for (var i = from;; i += delta) {
            var _el$children$i;
            if (!idxInArray(i, el.children)) {
              if (el.wrap) {
                i = (i + el.children.length) % el.children.length;
              } else break;
            }
            if (!((_el$children$i = el.children[i]) !== null && _el$children$i !== void 0 && _el$children$i.skipFocus)) {
              return i;
            }
          }
          return -1;
        }
        function selectChild(el, index) {
          var _el$onSelectedChanged;
          var child = el.children[index];
          if (child == null || child.skipFocus) {
            el.selected = -1;
            return false;
          }
          var lastSelected = el.selected;
          el.selected = index;
          if (!isFocused(child)) {
            child.setFocus();
          }
          (_el$onSelectedChanged = el.onSelectedChanged) === null || _el$onSelectedChanged === void 0 || _el$onSelectedChanged.call(el, index, el, child, lastSelected);
          return true;
        }
        var navigableForwardFocus = function navigableForwardFocus() {
          var navigable = this;
          var selected = navigable.selected;
          selected = idxInArray(selected, this.children) ? selected : 0;
          selected = findFirstFocusableChildIdx(navigable, selected);
          navigable.selected = selected;
          return selectChild(navigable, selected);
        };
        function handleNavigation(direction) {
          return function () {
            return moveSelection(this, direction === "up" || direction === "left" ? -1 : 1);
          };
        }
        var navigableHandleNavigation = function navigableHandleNavigation(e) {
          return moveSelection(this, e.key === "ArrowUp" || e.key === "ArrowLeft" ? -1 : 1);
        };
        function moveSelection(el, delta) {
          var selected = findFirstFocusableChildIdx(el, el.selected + delta, delta);
          if (selected === -1) {
            if (!idxInArray(el.selected, el.children) || el.children[el.selected].skipFocus || isFocused(el.children[el.selected])) {
              return false;
            }
            selected = el.selected;
          }
          var active = el.children[selected];
          if (el.plinko) {
            var lastSelectedChild = el.children[el.selected];
            assertTruthy(lastSelectedChild instanceof ElementNode);
            var num = lastSelectedChild.selected || 0;
            active.selected = num < active.children.length ? num : active.children.length - 1;
          }
          return selectChild(el, selected);
        }
        var InViewPort = 8;
        var isNotShown = function isNotShown(node) {
          return node.lng.renderState !== InViewPort;
        };
        function withScrolling(isRow) {
          var dimension = isRow ? "width" : "height";
          var axis = isRow ? "x" : "y";
          return function (selected, component, selectedElement, lastSelected) {
            var _componentRef$_target, _componentRef$offset2, _selectedElement$axis, _selectedElement$dime, _ref42, _selectedElement$scal, _selectedElement$styl, _componentRef$dimensi;
            var componentRef = component;
            if (typeof selected !== "number") {
              componentRef = selected;
              selected = componentRef.selected || 0;
            }
            if (!componentRef || componentRef.scroll === "none" || selected === lastSelected || !componentRef.children.length) return;
            if (componentRef._initialPosition === void 0) {
              componentRef._initialPosition = componentRef[axis];
            }
            var lng = componentRef.lng;
            var screenSize = isRow ? lng.stage.root.width : lng.stage.root.height;
            var isIncrementing = lastSelected === void 0 || lastSelected - 1 !== selected;
            if (componentRef._screenOffset === void 0) {
              var _componentRef$offset;
              if (componentRef.parent.clipping) {
                var p = componentRef.parent;
                componentRef.endOffset = screenSize - ((isRow ? p.absX : p.absY) || 0) - p[dimension];
              }
              componentRef._screenOffset = (_componentRef$offset = componentRef.offset) !== null && _componentRef$offset !== void 0 ? _componentRef$offset : (isRow ? lng.absX : lng.absY) - componentRef[axis];
            }
            var screenOffset = componentRef._screenOffset;
            var gap = componentRef.gap || 0;
            var scroll = componentRef.scroll || (lastSelected === void 0 ? componentRef.scrollIndex ? "center" : "always" : "auto");
            var targetPosition = (_componentRef$_target = componentRef._targetPosition) !== null && _componentRef$_target !== void 0 ? _componentRef$_target : componentRef[axis];
            var rootPosition = isIncrementing ? Math.min(targetPosition, componentRef[axis]) : Math.max(targetPosition, componentRef[axis]);
            componentRef.offset = (_componentRef$offset2 = componentRef.offset) !== null && _componentRef$offset2 !== void 0 ? _componentRef$offset2 : rootPosition;
            var offset = componentRef.offset;
            selectedElement = selectedElement || componentRef.children[selected];
            if (!selectedElement) {
              return;
            }
            var selectedPosition = (_selectedElement$axis = selectedElement[axis]) !== null && _selectedElement$axis !== void 0 ? _selectedElement$axis : 0;
            var selectedSize = (_selectedElement$dime = selectedElement[dimension]) !== null && _selectedElement$dime !== void 0 ? _selectedElement$dime : 0;
            var selectedScale = (_ref42 = (_selectedElement$scal = selectedElement.scale) !== null && _selectedElement$scal !== void 0 ? _selectedElement$scal : (_selectedElement$styl = selectedElement.style) === null || _selectedElement$styl === void 0 || (_selectedElement$styl = _selectedElement$styl.focus) === null || _selectedElement$styl === void 0 ? void 0 : _selectedElement$styl.scale) !== null && _ref42 !== void 0 ? _ref42 : 1;
            var selectedSizeScaled = selectedSize * selectedScale;
            var containerSize = (_componentRef$dimensi = componentRef[dimension]) !== null && _componentRef$dimensi !== void 0 ? _componentRef$dimensi : 0;
            var maxOffset = Math.min(screenSize - containerSize - screenOffset - (componentRef.endOffset || 2 * gap), offset);
            var nextIndex = isIncrementing ? selected + 1 : selected - 1;
            var nextElement = componentRef.children[nextIndex] || null;
            var nextPosition = rootPosition;
            if (selectedElement.centerScroll) {
              nextPosition = -selectedPosition + (screenSize - selectedSizeScaled) / 2;
            } else if (scroll === "always") {
              nextPosition = -selectedPosition + offset;
            } else if (scroll === "center") {
              var centerPosition = -selectedPosition + (screenSize - selectedSizeScaled) / 2 - screenOffset;
              nextPosition = Math.min(Math.max(centerPosition, maxOffset), offset);
            } else if (!nextElement) {
              nextPosition = isIncrementing ? maxOffset : offset;
            } else if (scroll === "auto") {
              if (componentRef.scrollIndex && componentRef.scrollIndex > 0) {
                var totalItems = componentRef.children.length;
                var nearEndIndex = totalItems - componentRef.scrollIndex;
                if (isIncrementing && componentRef.selected >= componentRef.scrollIndex) {
                  nextPosition = rootPosition - selectedSize - gap;
                } else if (!isIncrementing && componentRef.selected < nearEndIndex) {
                  nextPosition = rootPosition + selectedSize + gap;
                }
              } else if (isIncrementing) {
                nextPosition = rootPosition - selectedSize - gap;
              } else {
                nextPosition = rootPosition + selectedSize + gap;
              }
            } else if (isIncrementing && isNotShown(nextElement)) {
              nextPosition = rootPosition - selectedSize - gap;
            } else if (isNotShown(nextElement)) {
              nextPosition = -selectedPosition + offset;
            }
            nextPosition = isIncrementing && scroll !== "always" ? Math.max(nextPosition, maxOffset) : Math.min(nextPosition, offset);
            if (componentRef[axis] !== nextPosition) {
              if (componentRef.onScrolled) {
                var isInitial = nextPosition === componentRef._initialPosition;
                componentRef.onScrolled(componentRef, nextPosition, isInitial);
              }
              componentRef[axis] = nextPosition;
              componentRef._targetPosition = nextPosition;
            }
          };
        }
        var scrollRow = /* @__PURE__ */withScrolling(true);
        var scrollColumn = /* @__PURE__ */withScrolling(false);
        function chainFunctions() {
          for (var _len17 = arguments.length, fns = new Array(_len17), _key22 = 0; _key22 < _len17; _key22++) {
            fns[_key22] = arguments[_key22];
          }
          var onlyFunctions = fns.filter(function (func) {
            return typeof func === "function";
          });
          if (onlyFunctions.length === 0) {
            return void 0;
          }
          if (onlyFunctions.length === 1) {
            return onlyFunctions[0];
          }
          return function () {
            var result;
            for (var _len18 = arguments.length, innerArgs = new Array(_len18), _key23 = 0; _key23 < _len18; _key23++) {
              innerArgs[_key23] = arguments[_key23];
            }
            var _iterator39 = _createForOfIteratorHelper(onlyFunctions),
              _step39;
            try {
              for (_iterator39.s(); !(_step39 = _iterator39.n()).done;) {
                var func = _step39.value;
                result = func.apply(this, innerArgs);
                if (result === true) {
                  return result;
                }
              }
            } catch (err) {
              _iterator39.e(err);
            } finally {
              _iterator39.f();
            }
            return result;
          };
        }
        var chainRefs = exports("l", chainFunctions);
        var ColumnStyles = {
          display: "flex",
          flexDirection: "column",
          gap: 30,
          transition: {
            y: {
              duration: 250,
              easing: "ease-in-out"
            }
          }
        };
        function scrollToIndex$1(index) {
          var _this$children$index;
          this.selected = index;
          scrollColumn(index, this);
          (_this$children$index = this.children[index]) === null || _this$children$index === void 0 || _this$children$index.setFocus();
        }
        var onUp = handleNavigation("up");
        var onDown = handleNavigation("down");
        var Column = exports("C", function (props) {
          return function () {
            var _el$ = createElement("view");
            spread(_el$, mergeProps(props, {
              "onUp": chainFunctions(props.onUp, onUp),
              "onDown": chainFunctions(props.onDown, onDown),
              get selected() {
                return props.selected || 0;
              },
              "scrollToIndex": scrollToIndex$1,
              "forwardFocus": navigableForwardFocus,
              "onLayout": props.selected ? chainFunctions(props.onLayout, scrollColumn) : props.onLayout,
              "onSelectedChanged": chainFunctions(props.onSelectedChanged, props.scroll !== "none" ? scrollColumn : void 0),
              "style": combineStyles(props.style, ColumnStyles)
            }), false);
            return _el$;
          }();
        });
        var RowStyles = {
          display: "flex",
          gap: 30,
          transition: {
            x: {
              duration: 250,
              easing: "ease-in-out"
            }
          }
        };
        function scrollToIndex(index) {
          var _this$children$index2;
          this.selected = index;
          scrollRow(index, this);
          (_this$children$index2 = this.children[index]) === null || _this$children$index2 === void 0 || _this$children$index2.setFocus();
        }
        var onLeft = handleNavigation("left");
        var onRight = handleNavigation("right");
        var Row = exports("R", function (props) {
          return function () {
            var _el$ = createElement("view");
            spread(_el$, mergeProps(props, {
              get selected() {
                return props.selected || 0;
              },
              "onLeft": chainFunctions(props.onLeft, onLeft),
              "onRight": chainFunctions(props.onRight, onRight),
              "forwardFocus": navigableForwardFocus,
              "scrollToIndex": scrollToIndex,
              "onLayout": props.selected ? chainFunctions(props.onLayout, scrollRow) : props.onLayout,
              "onSelectedChanged": chainFunctions(props.onSelectedChanged, props.scroll !== "none" ? scrollRow : void 0),
              "style": combineStyles(props.style, RowStyles)
            }), false);
            return _el$;
          }();
        });
        var fpsStyle = {
          color: 255,
          height: 180,
          width: 330,
          x: 1900,
          y: 6,
          mountX: 1,
          alpha: 0.8,
          zIndex: 100
        };
        var fpsLabel = {
          x: 10,
          fontSize: 20,
          textColor: 4143380223
        };
        var fpsValue = {
          fontSize: 22,
          textColor: 4143380223
        };
        var _createSignal33 = createSignal(0),
          _createSignal34 = _slicedToArray(_createSignal33, 2),
          fps = _createSignal34[0],
          setFps = _createSignal34[1];
        var _createSignal35 = createSignal(0),
          _createSignal36 = _slicedToArray(_createSignal35, 2),
          avgFps = _createSignal36[0],
          setAvgFps = _createSignal36[1];
        var _createSignal37 = createSignal(99),
          _createSignal38 = _slicedToArray(_createSignal37, 2),
          minFps = _createSignal38[0],
          setMinFps = _createSignal38[1];
        var _createSignal39 = createSignal(0),
          _createSignal40 = _slicedToArray(_createSignal39, 2),
          maxFps = _createSignal40[0],
          setMaxFps = _createSignal40[1];
        var _createSignal41 = createSignal(""),
          _createSignal42 = _slicedToArray(_createSignal41, 2),
          criticalThresholdSignal = _createSignal42[0],
          setCriticalThresholdSignal = _createSignal42[1];
        var _createSignal43 = createSignal(""),
          _createSignal44 = _slicedToArray(_createSignal43, 2),
          targetThresholdSignal = _createSignal44[0],
          setTargetThresholdSignal = _createSignal44[1];
        var _createSignal45 = createSignal(""),
          _createSignal46 = _slicedToArray(_createSignal45, 2),
          renderableMemUsedSignal = _createSignal46[0],
          setRenderableMemUsedSignal = _createSignal46[1];
        var _createSignal47 = createSignal(""),
          _createSignal48 = _slicedToArray(_createSignal47, 2),
          memUsedSignal = _createSignal48[0],
          setMemUsedSignal = _createSignal48[1];
        var _createSignal49 = createSignal(0),
          _createSignal50 = _slicedToArray(_createSignal49, 2),
          renderableTexturesLoadedSignal = _createSignal50[0],
          setRenderableTexturesLoadedSignal = _createSignal50[1];
        var _createSignal51 = createSignal(0),
          _createSignal52 = _slicedToArray(_createSignal51, 2),
          loadedTexturesSignal = _createSignal52[0],
          setLoadedTexturesSignal = _createSignal52[1];
        var count = 0;
        var totalFps = 0;
        var infoFontSize = 14;
        function bytesToMb(bytes) {
          return (bytes / 1024 / 1024).toFixed(2) + " Mb";
        }
        var calcFps = function calcFps(fps2) {
          if (!fps2) return;
          setFps(fps2);
          setMinFps(function (prev) {
            return Math.min(fps2, prev);
          });
          setMaxFps(function (prev) {
            return Math.max(fps2, prev);
          });
          totalFps += fps2;
          count++;
          setAvgFps(Math.round(totalFps / count));
        };
        function updateMemoryInfo(stage) {
          var memInfo = stage.txMemManager.getMemoryInfo();
          setCriticalThresholdSignal(bytesToMb(memInfo.criticalThreshold));
          setTargetThresholdSignal(bytesToMb(memInfo.targetThreshold));
          setRenderableMemUsedSignal(bytesToMb(memInfo.renderableMemUsed));
          setMemUsedSignal(bytesToMb(memInfo.memUsed));
          setRenderableTexturesLoadedSignal(memInfo.renderableTexturesLoaded);
          setLoadedTexturesSignal(memInfo.loadedTextures);
        }
        var frameCount = 0;
        function setupFPS(root) {
          root.renderer.on("fpsUpdate", function (target, fpsData) {
            var fps2 = typeof fpsData === "number" ? fpsData : fpsData.fps;
            if (fps2 > 5) {
              calcFps(fps2);
              if (frameCount % 10 === 0) {
                updateMemoryInfo(target.stage);
                frameCount = 0;
              }
              frameCount++;
            }
          });
        }
        var FPSCounter = function FPSCounter(props) {
          return function () {
            var _el$ = createElement("view"),
              _el$2 = createElement("view"),
              _el$3 = createElement("text"),
              _el$5 = createElement("text"),
              _el$6 = createElement("view"),
              _el$7 = createElement("text"),
              _el$9 = createElement("text"),
              _el$0 = createElement("view"),
              _el$1 = createElement("text"),
              _el$11 = createElement("text"),
              _el$12 = createElement("view"),
              _el$13 = createElement("text"),
              _el$15 = createElement("text"),
              _el$16 = createElement("view"),
              _el$17 = createElement("view"),
              _el$18 = createElement("text"),
              _el$20 = createElement("text"),
              _el$21 = createElement("view"),
              _el$22 = createElement("text"),
              _el$24 = createElement("text"),
              _el$25 = createElement("view"),
              _el$26 = createElement("text"),
              _el$28 = createElement("text"),
              _el$29 = createElement("view"),
              _el$30 = createElement("text"),
              _el$32 = createElement("text"),
              _el$33 = createElement("view"),
              _el$34 = createElement("text"),
              _el$36 = createElement("text"),
              _el$37 = createElement("view"),
              _el$38 = createElement("text"),
              _el$40 = createElement("text");
            insertNode(_el$, _el$2);
            insertNode(_el$, _el$6);
            insertNode(_el$, _el$0);
            insertNode(_el$, _el$12);
            insertNode(_el$, _el$16);
            spread(_el$, mergeProps(props, {
              "style": fpsStyle
            }), true);
            insertNode(_el$2, _el$3);
            insertNode(_el$2, _el$5);
            setProp(_el$2, "y", 6);
            insertNode(_el$3, createTextNode("FPS:"));
            setProp(_el$3, "style", fpsLabel);
            setProp(_el$5, "style", fpsValue);
            setProp(_el$5, "x", 90);
            insert(_el$5, function () {
              return fps().toString();
            });
            insertNode(_el$6, _el$7);
            insertNode(_el$6, _el$9);
            setProp(_el$6, "y", 6);
            setProp(_el$6, "x", 160);
            insertNode(_el$7, createTextNode("AVG:"));
            setProp(_el$7, "style", fpsLabel);
            setProp(_el$9, "style", fpsValue);
            setProp(_el$9, "x", 100);
            insert(_el$9, function () {
              return avgFps().toString();
            });
            insertNode(_el$0, _el$1);
            insertNode(_el$0, _el$11);
            setProp(_el$0, "x", 0);
            setProp(_el$0, "y", 26);
            insertNode(_el$1, createTextNode("MIN:"));
            setProp(_el$1, "style", fpsLabel);
            setProp(_el$11, "style", fpsValue);
            setProp(_el$11, "x", 90);
            insert(_el$11, function () {
              return minFps().toString();
            });
            insertNode(_el$12, _el$13);
            insertNode(_el$12, _el$15);
            setProp(_el$12, "x", 160);
            setProp(_el$12, "y", 26);
            insertNode(_el$13, createTextNode("MAX:"));
            setProp(_el$13, "style", fpsLabel);
            setProp(_el$15, "style", fpsValue);
            setProp(_el$15, "x", 100);
            insert(_el$15, function () {
              return maxFps().toString();
            });
            insertNode(_el$16, _el$17);
            insertNode(_el$16, _el$21);
            insertNode(_el$16, _el$25);
            insertNode(_el$16, _el$29);
            insertNode(_el$16, _el$33);
            insertNode(_el$16, _el$37);
            setProp(_el$16, "display", "flex");
            setProp(_el$16, "flexDirection", "column");
            setProp(_el$16, "y", 58);
            setProp(_el$16, "gap", 4);
            insertNode(_el$17, _el$18);
            insertNode(_el$17, _el$20);
            setProp(_el$17, "height", infoFontSize);
            insertNode(_el$18, createTextNode("criticalThreshold:"));
            setProp(_el$18, "fontSize", infoFontSize);
            setProp(_el$18, "style", fpsLabel);
            setProp(_el$20, "fontSize", infoFontSize);
            setProp(_el$20, "style", fpsLabel);
            setProp(_el$20, "x", 230);
            insert(_el$20, criticalThresholdSignal);
            insertNode(_el$21, _el$22);
            insertNode(_el$21, _el$24);
            setProp(_el$21, "height", infoFontSize);
            insertNode(_el$22, createTextNode("targetThreshold:"));
            setProp(_el$22, "fontSize", infoFontSize);
            setProp(_el$22, "style", fpsLabel);
            setProp(_el$24, "fontSize", infoFontSize);
            setProp(_el$24, "style", fpsLabel);
            setProp(_el$24, "x", 230);
            insert(_el$24, targetThresholdSignal);
            insertNode(_el$25, _el$26);
            insertNode(_el$25, _el$28);
            setProp(_el$25, "height", infoFontSize);
            insertNode(_el$26, createTextNode("renderableMemUsed:"));
            setProp(_el$26, "fontSize", infoFontSize);
            setProp(_el$26, "style", fpsLabel);
            setProp(_el$28, "fontSize", infoFontSize);
            setProp(_el$28, "style", fpsLabel);
            setProp(_el$28, "x", 230);
            insert(_el$28, renderableMemUsedSignal);
            insertNode(_el$29, _el$30);
            insertNode(_el$29, _el$32);
            setProp(_el$29, "height", infoFontSize);
            insertNode(_el$30, createTextNode("memUsed:"));
            setProp(_el$30, "fontSize", infoFontSize);
            setProp(_el$30, "style", fpsLabel);
            setProp(_el$32, "fontSize", infoFontSize);
            setProp(_el$32, "style", fpsLabel);
            setProp(_el$32, "x", 230);
            insert(_el$32, memUsedSignal);
            insertNode(_el$33, _el$34);
            insertNode(_el$33, _el$36);
            setProp(_el$33, "height", infoFontSize);
            insertNode(_el$34, createTextNode("renderableTexturesLoaded:"));
            setProp(_el$34, "fontSize", infoFontSize);
            setProp(_el$34, "style", fpsLabel);
            setProp(_el$36, "fontSize", infoFontSize);
            setProp(_el$36, "style", fpsLabel);
            setProp(_el$36, "x", 230);
            insert(_el$36, function () {
              return renderableTexturesLoadedSignal().toString();
            });
            insertNode(_el$37, _el$38);
            insertNode(_el$37, _el$40);
            setProp(_el$37, "height", infoFontSize);
            insertNode(_el$38, createTextNode("loadedTextures:"));
            setProp(_el$38, "fontSize", infoFontSize);
            setProp(_el$38, "style", fpsLabel);
            setProp(_el$40, "fontSize", infoFontSize);
            setProp(_el$40, "style", fpsLabel);
            setProp(_el$40, "x", 230);
            insert(_el$40, function () {
              return loadedTexturesSignal().toString();
            });
            return _el$;
          }();
        };
        var SAFETY_MARGIN = 10;
        function MarqueeText(props) {
          var speed = createMemo(function () {
            return props.speed || 200;
          });
          var delay = createMemo(function () {
            var _props$delay2;
            return (_props$delay2 = props.delay) !== null && _props$delay2 !== void 0 ? _props$delay2 : 1e3;
          });
          var scrollGap = createMemo(function () {
            var _props$scrollGap;
            return (_props$scrollGap = props.scrollGap) !== null && _props$scrollGap !== void 0 ? _props$scrollGap : props.clipWidth * 0.5;
          });
          var _createSignal53 = createSignal(0),
            _createSignal54 = _slicedToArray(_createSignal53, 2),
            textWidth = _createSignal54[0],
            setTextWidth = _createSignal54[1];
          var isTextOverflowing = createMemo(function () {
            return textWidth() > props.clipWidth - SAFETY_MARGIN;
          });
          var shouldScroll = createMemo(function () {
            return props.marquee && isTextOverflowing();
          });
          var wasFocusedBefore = createMemo(function (p) {
            return p || props.marquee;
          }, false);
          createEffect(function () {
            if (shouldScroll()) {
              var options = {
                duration: (textWidth() + scrollGap()) / speed() * 1e3,
                delay: delay(),
                loop: true,
                easing: props.easing
              };
              text1.lng.x = 0;
              text2.lng.x = textWidth() + scrollGap();
              var a1 = text1.lng.animate({
                x: -textWidth() - scrollGap()
              }, options).start();
              var a2 = text2.lng.animate({
                x: 0
              }, options).start();
              onCleanup(function () {
                a1.stop();
                a2.stop();
              });
            }
          });
          var events = {
            loaded: function loaded(el) {
              setTextWidth(el.width);
            }
          };
          var text1;
          var text2;
          return [memo(function () {
            return memo(function () {
              return !!wasFocusedBefore();
            })() && [function () {
              var _el$2 = createElement("text");
              var _ref$ = text1;
              typeof _ref$ === "function" ? use(_ref$, _el$2) : text1 = _el$2;
              spread(_el$2, mergeProps(props, {
                get hidden() {
                  return !shouldScroll();
                },
                "rtt": true,
                "maxLines": 1,
                "onEvent": events
              }), false);
              return _el$2;
            }(), function () {
              var _el$3 = createElement("text");
              var _ref$2 = text2;
              typeof _ref$2 === "function" ? use(_ref$2, _el$3) : text2 = _el$3;
              spread(_el$3, mergeProps(props, {
                get hidden() {
                  return !shouldScroll();
                },
                "rtt": true,
                "maxLines": 1
              }), false);
              return _el$3;
            }()];
          }), function () {
            var _el$ = createElement("text");
            spread(_el$, mergeProps(props, {
              "maxLines": 1,
              get hidden() {
                return shouldScroll();
              },
              "contain": "width"
            }), false);
            return _el$;
          }()];
        }
        function Marquee(props) {
          var _createSignal55 = createSignal(props.width || 0),
            _createSignal56 = _slicedToArray(_createSignal55, 2),
            clipWidth = _createSignal56[0],
            setClipWidth = _createSignal56[1];
          var clipHeight = createMemo(function () {
            var _props$textProps, _props$textProps2;
            return props.height || ((_props$textProps = props.textProps) === null || _props$textProps === void 0 ? void 0 : _props$textProps.lineHeight) || (((_props$textProps2 = props.textProps) === null || _props$textProps2 === void 0 ? void 0 : _props$textProps2.fontSize) || 16) * 1.5;
          });
          return function () {
            var _el$4 = createElement("view");
            spread(_el$4, mergeProps(props, {
              get height() {
                return clipHeight();
              },
              "onLayout": chainFunctions(props.onLayout, function (e) {
                return setClipWidth(e.width);
              }),
              get clipping() {
                return props.marquee;
              }
            }), true);
            insert(_el$4, createComponent(MarqueeText, mergeProps(function () {
              return props.textProps;
            }, {
              get marquee() {
                return props.marquee;
              },
              get clipWidth() {
                return clipWidth();
              },
              get speed() {
                return props.speed;
              },
              get delay() {
                return props.delay;
              },
              get scrollGap() {
                return props.scrollGap;
              },
              get easing() {
                return props.easing;
              },
              get children() {
                return props.children;
              }
            })));
            return _el$4;
          }();
        }
        var FocusStackContext = createContext(void 0);
        function FocusStackProvider(props) {
          var _createSignal57 = createSignal([]),
            _createSignal58 = _slicedToArray(_createSignal57, 2),
            _focusStack = _createSignal58[0],
            setFocusStack = _createSignal58[1];
          function storeFocus(element, prevElement) {
            var elm = prevElement || element;
            if (elm) {
              setFocusStack(function (stack) {
                return [].concat(_toConsumableArray(stack), [elm]);
              });
            }
          }
          function restoreFocus() {
            var wasFocused = false;
            setFocusStack(function (stack) {
              var prevElement = stack.pop();
              if (prevElement && typeof prevElement.setFocus === "function") {
                prevElement.setFocus();
                wasFocused = true;
              }
              return _toConsumableArray(stack);
            });
            return wasFocused;
          }
          function clearFocusStack() {
            setFocusStack([]);
          }
          return createComponent(FocusStackContext.Provider, {
            value: {
              storeFocus: storeFocus,
              restoreFocus: restoreFocus,
              clearFocusStack: clearFocusStack
            },
            get children() {
              return props.children;
            }
          });
        }
        function useFocusStack() {
          var autoClear = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : true;
          var context = useContext(FocusStackContext);
          if (!context) {
            throw new Error("useFocusStack must be used within a FocusStackProvider");
          }
          if (autoClear) {
            onCleanup(function () {
              setTimeout(function () {
                return context.clearFocusStack();
              }, 5);
            });
          }
          return context;
        }
        var keepAliveElements = /* @__PURE__ */new Map();
        var storeKeepAlive = function storeKeepAlive(element) {
          if (keepAliveElements.has(element.id)) {
            console.warn("[KeepAlive] Element with id \"".concat(element.id, "\" already in cache. Recreating."));
            return element;
          }
          keepAliveElements.set(element.id, element);
          return element;
        };
        function wrapChildren(props) {
          var onRemove = props.onRemove || function (elm) {
            elm.alpha = 0;
          };
          var onRender = props.onRender || function (elm) {
            elm.alpha = 1;
          };
          var transition = props.transition || {
            alpha: true
          };
          return function () {
            var _el$ = createElement("view");
            setProp(_el$, "preserve", true);
            setProp(_el$, "onRemove", onRemove);
            setProp(_el$, "onRender", onRender);
            setProp(_el$, "forwardFocus", 0);
            setProp(_el$, "transition", transition);
            spread(_el$, props, false);
            return _el$;
          }();
        }
        var KeepAlive = function KeepAlive(props) {
          var _props$shouldDispose;
          var existing = keepAliveElements.get(props.id);
          if (existing && (_props$shouldDispose = props.shouldDispose) !== null && _props$shouldDispose !== void 0 && _props$shouldDispose.call(props, props.id)) {
            existing.dispose();
            keepAliveElements.delete(props.id);
            existing = void 0;
          }
          if (!existing) {
            return createRoot(function (dispose) {
              var children = wrapChildren(props);
              storeKeepAlive({
                id: props.id,
                owner: getOwner(),
                children: children,
                dispose: dispose
              });
              return children;
            });
          } else if (existing && !existing.children) {
            existing.children = runWithOwner(existing.owner, function () {
              return wrapChildren(props);
            });
          }
          return existing.children;
        };
        var KeepAliveRoute = function KeepAliveRoute(props) {
          var key = props.id || props.path;
          var preload = props.preload ? function (preloadProps) {
            var _props$shouldDispose2;
            var existing = keepAliveElements.get(key);
            if (existing && (_props$shouldDispose2 = props.shouldDispose) !== null && _props$shouldDispose2 !== void 0 && _props$shouldDispose2.call(props, key)) {
              existing.dispose();
              keepAliveElements.delete(key);
              existing = void 0;
            }
            if (!existing) {
              return createRoot(function (dispose) {
                storeKeepAlive({
                  id: key,
                  owner: getOwner(),
                  dispose: dispose,
                  children: null
                });
                return props.preload(preloadProps);
              });
            } else if (existing.children) {
              var _existing$children;
              (_existing$children = existing.children) === null || _existing$children === void 0 || _existing$children.setFocus();
            }
          } : void 0;
          return createComponent(Route, mergeProps(props, {
            preload: preload,
            component: function component(childProps) {
              return createComponent(KeepAlive, {
                id: key,
                get onRemove() {
                  return props.onRemove;
                },
                get onRender() {
                  return props.onRender;
                },
                get transition() {
                  return props.transition;
                },
                get children() {
                  return props.component(childProps);
                }
              });
            }
          }));
        };
        function disposeList(list) {
          for (var i = 0; i < list.length; i++) {
            var _list$i;
            (_list$i = list[i]) === null || _list$i === void 0 || _list$i.disposer();
          }
        }
        /**
         * Reactively transforms an array with a callback function - underlying helper for the `<List>` unkeyed control flow.
         *
         * Alternative to `mapArray` or `indexArray` that provides reactive value and index for array elements.
         */
        function listArray(list, mapFn) {
          var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};
          var items = [];
          var mapped = [],
            unusedItems,
            i,
            j,
            item,
            oldValue,
            oldIndex,
            newValue,
            fallback,
            fallbackDisposer;
          onCleanup(function () {
            var _fallbackDisposer;
            (_fallbackDisposer = fallbackDisposer) === null || _fallbackDisposer === void 0 || _fallbackDisposer();
            fallbackDisposer = undefined;
            disposeList(items);
          });
          return function () {
            var newItems = list() || [];
            newItems[$TRACK]; // top level tracking
            return untrack(function () {
              if (newItems.length > 0 && fallbackDisposer) {
                fallbackDisposer();
                fallbackDisposer = undefined;
                fallback = undefined;
              }
              var temp = new Array(newItems.length); // new mapped array
              unusedItems = items.length;
              // 1) no change when values & indexes match
              for (j = unusedItems - 1; j >= 0; --j) {
                item = items[j];
                oldIndex = item.index;
                if (oldIndex < newItems.length && newItems[oldIndex] === item.value) {
                  temp[oldIndex] = mapped[oldIndex];
                  if (--unusedItems !== j) {
                    items[j] = items[unusedItems];
                    items[unusedItems] = item;
                  }
                }
              }
              // #2 prepare values matcher
              var matcher = new Map();
              var matchedItems = new Uint8Array(unusedItems);
              for (j = unusedItems - 1; j >= 0; --j) {
                var _matcher$get$push, _matcher$get;
                oldValue = items[j].value;
                (_matcher$get$push = (_matcher$get = matcher.get(oldValue)) === null || _matcher$get === void 0 ? void 0 : _matcher$get.push(j)) !== null && _matcher$get$push !== void 0 ? _matcher$get$push : matcher.set(oldValue, [j]);
              }
              // 2) change indexes when values match
              for (i = 0; i < newItems.length; ++i) {
                var _matcher$get$pop, _matcher$get2;
                if (i in temp) continue;
                newValue = newItems[i];
                j = (_matcher$get$pop = (_matcher$get2 = matcher.get(newValue)) === null || _matcher$get2 === void 0 ? void 0 : _matcher$get2.pop()) !== null && _matcher$get$pop !== void 0 ? _matcher$get$pop : -1;
                if (j >= 0) {
                  var _item$indexSetter, _item;
                  item = items[j];
                  oldIndex = item.index;
                  temp[i] = mapped[oldIndex];
                  item.index = i;
                  (_item$indexSetter = (_item = item).indexSetter) === null || _item$indexSetter === void 0 || _item$indexSetter.call(_item, i);
                  matchedItems[j] = 1;
                }
              }
              // #2 reduce unusedItems for matched items
              for (j = matchedItems.length - 1; j >= 0; --j) {
                if (matchedItems[j] && --unusedItems !== j) {
                  item = items[j];
                  items[j] = items[unusedItems];
                  items[unusedItems] = item;
                }
              }
              // 3) change values when indexes match
              for (j = unusedItems - 1; j >= 0; --j) {
                item = items[j];
                oldIndex = item.index;
                if (!(oldIndex in temp) && oldIndex < newItems.length) {
                  var _item$valueSetter, _item2;
                  temp[oldIndex] = mapped[oldIndex];
                  newValue = newItems[oldIndex];
                  item.value = newValue;
                  (_item$valueSetter = (_item2 = item).valueSetter) === null || _item$valueSetter === void 0 || _item$valueSetter.call(_item2, newValueGetter);
                  if (--unusedItems !== j) {
                    items[j] = items[unusedItems];
                    items[unusedItems] = item;
                  }
                }
              }
              // 4) change value & index when none matched
              // 5) create new if no unused items left
              for (i = 0; i < newItems.length; ++i) {
                if (i in temp) continue;
                newValue = newItems[i];
                if (unusedItems > 0) {
                  item = items[--unusedItems];
                  temp[i] = mapped[item.index];
                  batch(changeBoth);
                } else {
                  temp[i] = createRoot(mapper);
                }
              }
              // 6) delete any old unused items left
              disposeList(items.splice(0, unusedItems));
              if (newItems.length === 0 && options.fallback) {
                if (!fallbackDisposer) {
                  fallback = [createRoot(function (d) {
                    fallbackDisposer = d;
                    return options.fallback();
                  })];
                }
                return fallback;
              }
              return mapped = temp;
            });
          };
          function newValueGetter() {
            return newValue;
          }
          function changeBoth() {
            var _item$indexSetter2, _item3, _item$valueSetter2, _item4;
            item.index = i;
            (_item$indexSetter2 = (_item3 = item).indexSetter) === null || _item$indexSetter2 === void 0 || _item$indexSetter2.call(_item3, i);
            item.value = newValue;
            (_item$valueSetter2 = (_item4 = item).valueSetter) === null || _item$valueSetter2 === void 0 || _item$valueSetter2.call(_item4, newValueGetter);
          }
          function mapper(disposer) {
            var t = {
              value: newValue,
              index: i,
              disposer: disposer
            };
            items.push(t);
            // signal created when used
            var _sV = function sV() {
                var _createSignal59 = createSignal(t.value);
                var _createSignal60 = _slicedToArray(_createSignal59, 2);
                _sV = _createSignal60[0];
                t.valueSetter = _createSignal60[1];
                return _sV();
              },
              _sI = function sI() {
                var _createSignal61 = createSignal(t.index);
                var _createSignal62 = _slicedToArray(_createSignal61, 2);
                _sI = _createSignal62[0];
                t.indexSetter = _createSignal62[1];
                return _sI();
              };
            return mapFn(function () {
              return _sV();
            }, function () {
              return _sI();
            });
          }
        }
        /**
         * Iteration over a list creating elements from its items.
         * It avoids recreating elements, instead reorders existing elements whenever possible and / or changes reactive value.
         *
         * To be used if you have a list with changing indexes and values.
         * ```typescript
         * <List each={items} fallback={<div>No items</div>}>
         *   {(item, index) => <div data-index={index()}>{item()}</div>}
         * </List>
         * ```
         */
        function List(props) {
          var fallback = "fallback" in props && {
            fallback: function fallback() {
              return props.fallback;
            }
          };
          return createMemo(listArray(function () {
            return props.each;
          }, props.children, fallback || undefined));
        }
        var columnScroll = withScrolling(false);
        var rowStyles = {
          display: "flex",
          flexWrap: "wrap",
          transition: {
            y: true
          }
        };
        function VirtualGrid(props) {
          var _props$selected;
          var bufferSize = function bufferSize() {
            var _props$buffer;
            return (_props$buffer = props.buffer) !== null && _props$buffer !== void 0 ? _props$buffer : 2;
          };
          var _createSignal63 = createSignal((_props$selected = props.selected) !== null && _props$selected !== void 0 ? _props$selected : 0),
            _createSignal64 = _slicedToArray(_createSignal63, 2),
            cursor = _createSignal64[0],
            setCursor = _createSignal64[1];
          var items = createMemo(function () {
            return props.each || [];
          });
          var itemsPerRow = function itemsPerRow() {
            return props.columns;
          };
          var numberOfRows = function numberOfRows() {
            var _props$rows;
            return (_props$rows = props.rows) !== null && _props$rows !== void 0 ? _props$rows : 1;
          };
          var totalVisibleItems = function totalVisibleItems() {
            return itemsPerRow() * numberOfRows();
          };
          var start = createMemo(function () {
            var perRow = itemsPerRow();
            var newRowIndex = Math.floor(cursor() / perRow);
            var rawStart = newRowIndex * perRow - bufferSize() * perRow;
            return Math.max(0, rawStart);
          });
          var end = createMemo(function () {
            var perRow = itemsPerRow();
            var newRowIndex = Math.floor(cursor() / perRow);
            var rawEnd = (newRowIndex + bufferSize()) * perRow + totalVisibleItems();
            return Math.min(items().length, rawEnd);
          });
          var _createSignal65 = createSignal(items().slice(start(), end())),
            _createSignal66 = _slicedToArray(_createSignal65, 2),
            slice = _createSignal66[0],
            setSlice = _createSignal66[1];
          var viewRef;
          function onVerticalNav(dir) {
            return function () {
              var perRow = itemsPerRow();
              var currentRowIndex = Math.floor(cursor() / perRow);
              var maxRows = Math.floor(items().length / perRow);
              if (currentRowIndex === 0 && dir === -1 || currentRowIndex === maxRows && dir === 1) return;
              var selected = this.selected || 0;
              var offset = dir * perRow;
              var newIndex = clamp(selected + offset, 0, items().length - 1);
              var lastIdx = selected;
              this.selected = newIndex;
              var active = this.children[this.selected];
              if (active instanceof ElementNode) {
                active.setFocus();
                chainedOnSelectedChanged.call(this, this.selected, this, active, lastIdx);
                return true;
              }
            };
          }
          var onUp = onVerticalNav(-1);
          var onDown = onVerticalNav(1);
          var onSelectedChanged = function onSelectedChanged(_idx, elm, active, _lastIdx) {
            var _this75 = this;
            var idx = _idx;
            var lastIdx = _lastIdx;
            var perRow = itemsPerRow();
            var newRowIndex = Math.floor(idx / perRow);
            var prevRowIndex = Math.floor((lastIdx || 0) / perRow);
            var prevStart = start();
            setCursor(prevStart + idx);
            if (newRowIndex === prevRowIndex) return;
            setSlice(items().slice(start(), end()));
            var idxCorrection = prevStart - start();
            if (lastIdx) lastIdx += idxCorrection;
            idx += idxCorrection;
            this.selected += idxCorrection;
            if (props.onEndReachedThreshold !== void 0 && cursor() >= items().length - props.onEndReachedThreshold) {
              var _props$onEndReached;
              (_props$onEndReached = props.onEndReached) === null || _props$onEndReached === void 0 || _props$onEndReached.call(props);
            }
            queueMicrotask(function () {
              var prevRowY = _this75.y + active.y;
              _this75.updateLayout();
              _this75.lng.y = prevRowY - active.y;
              columnScroll(idx, elm, active, lastIdx);
            });
          };
          var chainedOnSelectedChanged = chainFunctions(props.onSelectedChanged, onSelectedChanged);
          var cachedSelected;
          var updateSelected = function updateSelected(_ref43) {
            var _ref44 = _slicedToArray(_ref43, 2),
              selected = _ref44[0],
              _items = _ref44[1];
            if (!viewRef || selected == null) return;
            if (cachedSelected !== void 0) {
              selected = cachedSelected;
              cachedSelected = void 0;
            }
            if (selected >= items().length && props.onEndReached) {
              var _props$onEndReached2;
              (_props$onEndReached2 = props.onEndReached) === null || _props$onEndReached2 === void 0 || _props$onEndReached2.call(props);
              cachedSelected = selected;
              return;
            }
            var item = items()[selected];
            var active = viewRef.children.find(function (x) {
              return x.item === item;
            });
            var lastSelected = viewRef.selected;
            if (active instanceof ElementNode) {
              viewRef.selected = viewRef.children.indexOf(active);
              active.setFocus();
              chainedOnSelectedChanged.call(viewRef, viewRef.selected, viewRef, active, lastSelected);
            } else {
              setCursor(selected);
              setSlice(items().slice(start(), end()));
              queueMicrotask(function () {
                viewRef.updateLayout();
                active = viewRef.children.find(function (x) {
                  return x.item === item;
                });
                if (active instanceof ElementNode) {
                  viewRef.selected = viewRef.children.indexOf(active);
                  active.setFocus();
                  chainedOnSelectedChanged.call(viewRef, viewRef.selected, viewRef, active, lastSelected);
                }
              });
            }
          };
          var scrollToIndex = function scrollToIndex(index) {
            untrack(function () {
              return updateSelected([index]);
            });
          };
          createEffect(on([function () {
            return props.selected;
          }, items], updateSelected));
          createEffect(on(items, function () {
            if (!viewRef) return;
            if (cachedSelected !== void 0) {
              updateSelected([cachedSelected]);
              return;
            }
            setSlice(items().slice(start(), end()));
          }, {
            defer: true
          }));
          return function () {
            var _el$ = createElement("view");
            var _ref$ = chainRefs(function (el) {
              viewRef = el;
            }, props.ref);
            typeof _ref$ === "function" && use(_ref$, _el$);
            spread(_el$, mergeProps(props, {
              get scroll() {
                return props.scroll || "always";
              },
              get selected() {
                return props.selected || 0;
              },
              get cursor() {
                return cursor();
              },
              "onLeft": chainFunctions(props.onLeft, navigableHandleNavigation),
              "onRight": chainFunctions(props.onRight, navigableHandleNavigation),
              "onUp": chainFunctions(props.onUp, onUp),
              "onDown": chainFunctions(props.onDown, onDown),
              "forwardFocus": navigableForwardFocus,
              "onCreate": props.selected ? chainFunctions(props.onCreate, columnScroll) : props.onCreate,
              "scrollToIndex": scrollToIndex,
              "onSelectedChanged": chainedOnSelectedChanged,
              "style": combineStyles(props.style, rowStyles)
            }), true);
            insert(_el$, createComponent(List, {
              get each() {
                return slice();
              },
              get children() {
                return props.children;
              }
            }));
            return _el$;
          }();
        }
        function createVirtual(component, props, keyHandlers) {
          var _props$selected2;
          var isRow = component === Row;
          var axis = isRow ? "x" : "y";
          var _createSignal67 = createSignal((_props$selected2 = props.selected) !== null && _props$selected2 !== void 0 ? _props$selected2 : 0),
            _createSignal68 = _slicedToArray(_createSignal67, 2),
            cursor = _createSignal68[0],
            setCursor = _createSignal68[1];
          var bufferSize = createMemo(function () {
            return props.bufferSize || 2;
          });
          var scrollIndex = createMemo(function () {
            return props.scrollIndex || 0;
          });
          var items = createMemo(function () {
            return props.each || [];
          });
          var itemCount = createMemo(function () {
            return items().length;
          });
          var scrollType = createMemo(function () {
            return props.scroll || "auto";
          });
          var selected = function selected() {
            if (props.wrap) {
              return Math.max(bufferSize(), scrollIndex());
            }
            return props.selected || 0;
          };
          var cachedScaledSize;
          var targetPosition;
          var cachedAnimationController;
          var uniformSize = createMemo(function () {
            return props.uniformSize !== false;
          });
          var _createSignal69 = createSignal({
              start: 0,
              slice: [],
              selected: 0,
              delta: 0,
              shiftBy: 0,
              atStart: true
            }),
            _createSignal70 = _slicedToArray(_createSignal69, 2),
            slice = _createSignal70[0],
            setSlice = _createSignal70[1];
          function normalizeDeltaForWindow(delta, windowLen) {
            if (!windowLen) return 0;
            var half = windowLen / 2;
            if (delta > half) return delta - windowLen;
            if (delta < -half) return delta + windowLen;
            return delta;
          }
          function computeSize() {
            var selected2 = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;
            if (uniformSize() && cachedScaledSize) {
              return cachedScaledSize;
            } else if (viewRef) {
              var gap = viewRef.gap || 0;
              var dimension = isRow ? "width" : "height";
              var prevSelectedChild = viewRef.children[selected2];
              if (prevSelectedChild instanceof ElementNode) {
                var _prevSelectedChild$st, _ref45, _focusStyle$scale;
                var itemSize = prevSelectedChild[dimension] || 0;
                var focusStyle = (_prevSelectedChild$st = prevSelectedChild.style) === null || _prevSelectedChild$st === void 0 ? void 0 : _prevSelectedChild$st.focus;
                var scale = (_ref45 = (_focusStyle$scale = focusStyle === null || focusStyle === void 0 ? void 0 : focusStyle.scale) !== null && _focusStyle$scale !== void 0 ? _focusStyle$scale : prevSelectedChild.scale) !== null && _ref45 !== void 0 ? _ref45 : 1;
                var scaledSize = itemSize * (props.factorScale ? scale : 1) + gap;
                cachedScaledSize = scaledSize;
                return scaledSize;
              }
            }
            return 0;
          }
          function computeSlice(c, delta, prev) {
            var total = itemCount();
            if (total === 0) return {
              start: 0,
              slice: [],
              selected: 0,
              delta: delta,
              shiftBy: 0,
              atStart: true
            };
            var length = props.displaySize + bufferSize();
            var start = prev.start;
            var selected2 = prev.selected;
            var atStart = prev.atStart;
            var shiftBy = -delta;
            switch (scrollType()) {
              case "always":
                if (props.wrap) {
                  start = mod(c - 1, total);
                  selected2 = 1;
                } else {
                  start = clamp(c - bufferSize(), 0, Math.max(0, total - props.displaySize - bufferSize()));
                  if (delta === 0 && c > 3) {
                    shiftBy = c < 3 ? -c : -2;
                    selected2 = 2;
                  } else {
                    selected2 = c < bufferSize() ? c : c >= total - props.displaySize ? c - (total - props.displaySize) + bufferSize() : bufferSize();
                  }
                }
                break;
              case "auto":
                if (props.wrap) {
                  if (delta === 0) {
                    selected2 = scrollIndex() || 1;
                    start = mod(c - (scrollIndex() || 1), total);
                  } else {
                    start = mod(c - (prev.selected || 1), total);
                  }
                } else {
                  if (delta < 0) {
                    if (prev.start > 0 && prev.selected >= props.displaySize) {
                      start = prev.start;
                      selected2 = prev.selected - 1;
                    } else if (prev.start > 0) {
                      start = prev.start - 1;
                      selected2 = prev.selected;
                    } else if (prev.start === 0 && !prev.atStart) {
                      start = 0;
                      selected2 = prev.selected - 1;
                      atStart = true;
                    } else if (selected2 >= props.displaySize - 1) {
                      start = 0;
                      selected2 = prev.selected - 1;
                    } else {
                      start = 0;
                      selected2 = prev.selected - 1;
                      shiftBy = 0;
                    }
                  } else if (delta > 0) {
                    if (prev.selected < scrollIndex()) {
                      start = prev.start;
                      selected2 = prev.selected + 1;
                      shiftBy = 0;
                    } else if (prev.selected === scrollIndex() || atStart) {
                      start = prev.start;
                      selected2 = prev.selected + 1;
                      atStart = false;
                    } else if (prev.start === 0 && prev.selected === 0) {
                      start = 0;
                      selected2 = 1;
                      atStart = false;
                    } else if (prev.start >= total - props.displaySize) {
                      start = prev.start;
                      selected2 = c - start;
                      shiftBy = 0;
                    } else {
                      start = prev.start + 1;
                      selected2 = Math.max(prev.selected, scrollIndex() + 1);
                    }
                  } else {
                    if (c > 0) {
                      start = Math.min(c - (scrollIndex() || 1), total - props.displaySize - bufferSize());
                      selected2 = Math.max(scrollIndex() || 1, c - start);
                      shiftBy = total - c < 3 ? c - total : -1;
                      atStart = false;
                    } else {
                      start = prev.start;
                      selected2 = prev.selected;
                    }
                  }
                }
                break;
              case "edge":
                var startScrolling = Math.max(1, props.displaySize + (atStart ? -1 : 0));
                if (props.wrap) {
                  if (delta > 0) {
                    if (prev.selected < startScrolling) {
                      selected2 = prev.selected + 1;
                      shiftBy = 0;
                    } else if (prev.selected === startScrolling && atStart) {
                      selected2 = prev.selected + 1;
                      atStart = false;
                    } else {
                      start = mod(prev.start + 1, total);
                      selected2 = prev.selected;
                    }
                  } else if (delta < 0) {
                    if (prev.selected > 1) {
                      selected2 = prev.selected - 1;
                      shiftBy = 0;
                    } else {
                      start = mod(prev.start - 1, total);
                      selected2 = 1;
                    }
                  } else {
                    start = mod(c - 1, total);
                    selected2 = 1;
                    shiftBy = -1;
                    atStart = false;
                  }
                } else {
                  if (delta === 0 && c > 0) {
                    selected2 = c > startScrolling ? startScrolling : c;
                    start = Math.max(0, c - startScrolling + 1);
                    shiftBy = c > startScrolling ? -1 : 0;
                    atStart = c < startScrolling;
                  } else if (delta > 0) {
                    if (prev.selected < startScrolling) {
                      selected2 = prev.selected + 1;
                      shiftBy = 0;
                    } else if (prev.selected === startScrolling && atStart) {
                      selected2 = prev.selected + 1;
                      atStart = false;
                    } else {
                      start = prev.start + 1;
                      selected2 = prev.selected;
                      atStart = false;
                    }
                  } else if (delta < 0) {
                    if (prev.selected > 1) {
                      selected2 = prev.selected - 1;
                      shiftBy = 0;
                    } else if (c > 1) {
                      start = Math.max(0, c - 1);
                      selected2 = 1;
                    } else if (c === 1) {
                      start = 0;
                      selected2 = 1;
                    } else {
                      start = 0;
                      selected2 = 0;
                      shiftBy = atStart ? 0 : shiftBy;
                      atStart = true;
                    }
                  }
                }
                break;
              case "none":
              default:
                start = 0;
                selected2 = c;
                shiftBy = 0;
                break;
            }
            var newSlice = prev.slice;
            if (start !== prev.start || newSlice.length === 0) {
              newSlice = props.wrap ? Array.from({
                length: length
              }, function (_, i) {
                return items()[mod(start + i, total)];
              }) : items().slice(start, start + length);
            }
            var state = {
              start: start,
              slice: newSlice,
              selected: selected2,
              delta: delta,
              shiftBy: shiftBy,
              atStart: atStart
            };
            if (props.debugInfo) {
              console.log("[Virtual]", {
                cursor: c,
                delta: delta,
                start: start,
                selected: selected2,
                shiftBy: shiftBy,
                slice: state.slice
              });
            }
            return state;
          }
          var viewRef;
          function scrollToIndex(index) {
            untrack(function () {
              if (itemCount() === 0) return;
              lastNavTime = performance.now();
              if (originalPosition !== void 0) {
                viewRef.lng[axis] = originalPosition;
                targetPosition = originalPosition;
              }
              updateSelected([clamp(index, 0, itemCount() - 1)]);
            });
          }
          var lastNavTime = 0;
          function getAdaptiveDuration() {
            var duration = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 250;
            var now = performance.now();
            var delta = now - lastNavTime;
            lastNavTime = now;
            if (delta < duration) return delta;
            return duration;
          }
          var originalPosition;
          var onSelectedChanged = function onSelectedChanged(_idx, elm, _active, _lastIdx) {
            var _elm$children$length,
              _elm$children,
              _this76 = this;
            var idx = _idx;
            var lastIdx = _lastIdx || 0;
            var active = _active;
            var noChange = idx === lastIdx;
            var total = itemCount();
            originalPosition = originalPosition !== null && originalPosition !== void 0 ? originalPosition : elm[axis];
            if (props.onSelectedChanged) {
              props.onSelectedChanged.call(this, idx, this, active, lastIdx);
            }
            if (noChange) return;
            var rawDelta = idx - (lastIdx !== null && lastIdx !== void 0 ? lastIdx : 0);
            var windowLen = (_elm$children$length = elm === null || elm === void 0 || (_elm$children = elm.children) === null || _elm$children === void 0 ? void 0 : _elm$children.length) !== null && _elm$children$length !== void 0 ? _elm$children$length : props.displaySize + bufferSize();
            var delta = props.wrap ? normalizeDeltaForWindow(rawDelta, windowLen) : rawDelta;
            setCursor(function (c) {
              var next = c + delta;
              return props.wrap ? mod(next, total) : clamp(next, 0, total - 1);
            });
            var newState = computeSlice(cursor(), delta, slice());
            setSlice(newState);
            elm.selected = newState.selected;
            if (props.onEndReachedThreshold !== void 0 && cursor() >= itemCount() - props.onEndReachedThreshold) {
              var _props$onEndReached3;
              (_props$onEndReached3 = props.onEndReached) === null || _props$onEndReached3 === void 0 || _props$onEndReached3.call(props);
            }
            if (newState.shiftBy === 0) return;
            var prevChildPos = (targetPosition !== null && targetPosition !== void 0 ? targetPosition : this[axis]) + active[axis];
            queueMicrotask(function () {
              elm.updateLayout();
              var childSize = computeSize(slice().selected);
              if (cachedAnimationController && cachedAnimationController.state === "running") {
                cachedAnimationController.stop();
              }
              if (Config.animationsEnabled) {
                var _this76$animationSett;
                _this76.lng[axis] = prevChildPos - active[axis];
                var offset = _this76.lng[axis] + childSize * slice().shiftBy;
                targetPosition = offset;
                cachedAnimationController = _this76.animate(_defineProperty({}, axis, offset), _objectSpread(_objectSpread({}, _this76.animationSettings), {}, {
                  duration: getAdaptiveDuration((_this76$animationSett = _this76.animationSettings) === null || _this76$animationSett === void 0 ? void 0 : _this76$animationSett.duration)
                })).start();
              } else {
                _this76.lng[axis] = _this76.lng[axis] + childSize * slice().shiftBy;
              }
            });
          };
          var updateSelected = function updateSelected(_ref46) {
            var _ref47 = _slicedToArray(_ref46, 2),
              sel = _ref47[0],
              _items = _ref47[1];
            if (!viewRef || sel === void 0 || itemCount() === 0) return;
            var item = items()[sel];
            setCursor(sel);
            var newState = computeSlice(cursor(), 0, slice());
            setSlice(newState);
            queueMicrotask(function () {
              var _viewRef$children$act;
              viewRef.updateLayout();
              var activeIndex = viewRef.children.findIndex(function (x) {
                return x.item === item;
              });
              if (activeIndex === -1) return;
              viewRef.selected = activeIndex;
              (_viewRef$children$act = viewRef.children[activeIndex]) === null || _viewRef$children$act === void 0 || _viewRef$children$act.setFocus();
            });
          };
          var doOnce = false;
          createEffect(on([function () {
            return props.wrap;
          }, items], function () {
            if (!viewRef || itemCount() === 0 || !props.wrap || doOnce) return;
            doOnce = true;
            queueMicrotask(function () {
              var childSize = computeSize(slice().selected);
              viewRef.lng[axis] = (viewRef.lng[axis] || 0) + childSize * -1;
              originalPosition = viewRef.lng[axis];
              targetPosition = viewRef.lng[axis];
            });
          }));
          createEffect(on([function () {
            return props.selected;
          }, items], updateSelected));
          createEffect(on(items, function () {
            if (!viewRef || itemCount() === 0) return;
            if (cursor() >= itemCount()) {
              setCursor(itemCount() - 1);
            }
            var newState = computeSlice(cursor(), 0, slice());
            setSlice(newState);
            viewRef.selected = newState.selected;
          }));
          return function () {
            var _el$ = createElement("view");
            var _ref$ = chainRefs(function (el) {
              viewRef = el;
            }, props.ref);
            typeof _ref$ === "function" && use(_ref$, _el$);
            spread(_el$, mergeProps(props, keyHandlers, {
              get selected() {
                return selected();
              },
              get cursor() {
                return cursor();
              },
              "forwardFocus": navigableForwardFocus,
              "scrollToIndex": scrollToIndex,
              "onSelectedChanged": onSelectedChanged,
              "style": combineStyles(props.style, component === Row ? {
                display: "flex",
                gap: 30,
                transition: {
                  x: {
                    duration: 250,
                    easing: "ease-out"
                  }
                }
              } : {
                display: "flex",
                flexDirection: "column",
                gap: 30,
                transition: {
                  y: {
                    duration: 250,
                    easing: "ease-out"
                  }
                }
              })
            }), true);
            insert(_el$, createComponent(List, {
              get each() {
                return slice().slice;
              },
              get children() {
                return props.children;
              }
            }));
            return _el$;
          }();
        }
        function VirtualRow(props) {
          return createVirtual(Row, props, {
            onLeft: chainFunctions(props.onLeft, handleNavigation("left")),
            onRight: chainFunctions(props.onRight, handleNavigation("right"))
          });
        }
        function createSpriteMap(src, subTextures) {
          var spriteMapTexture = renderer$1.createTexture("ImageTexture", {
            src: src
          });
          return subTextures.reduce(function (acc, t) {
            var x = t.x,
              y = t.y,
              width = t.width,
              height = t.height;
            acc[t.name] = renderer$1.createTexture("SubTexture", {
              texture: spriteMapTexture,
              x: x,
              y: y,
              width: width,
              height: height
            });
            return acc;
          }, {});
        }
        var App = function App(props) {
          useFocusManager({
            Announcer: ["a"],
            Menu: ["m"],
            Escape: ["Escape", 27],
            Backspace: ["Backspace", 8],
            Back: ["b"],
            Left: ["ArrowLeft", 37],
            Right: ["ArrowRight", 39],
            Up: ["ArrowUp", 38],
            Down: ["ArrowDown", 40],
            Enter: ["Enter", 13]
          }, {
            userKeyHoldMap: {
              EnterHold: ["Enter", 13],
              BackHold: ["b", 66]
            },
            holdThreshold: 1e3
          });
          return props.children;
        };
        var theme = exports("t", {
          layout: {
            gutterX: 20,
            marginX: 150,
            screenW: 1920
          },
          typography: {
            display2: {
              fontFamily: "Arial",
              fontSize: 50,
              lineHeight: 60,
              fontWeight: 500,
              verticalAlign: "middle",
              textBaseline: "bottom"
            },
            body1: {
              fontFamily: "Arial",
              fontSize: 25,
              fontWeight: 300,
              lineHeight: 40,
              verticalAlign: "middle",
              textBaseline: "bottom"
            },
            body2: {
              fontFamily: "Arial",
              fontSize: 22,
              fontWeight: 300,
              lineHeight: 32,
              verticalAlign: "middle",
              textBaseline: "bottom"
            }
          },
          color: {
            materialBrand: 13311
          }
        });
        var params = new URLSearchParams(window.location.search);
        var roundPoster = params.get("roundPoster") !== "false";
        var styles$1 = exports("Q", {
          itemsContainer: {
            width: theme.layout.screenW,
            height: 800,
            y: 560,
            x: 0,
            zIndex: 2
          },
          Thumbnail: {
            width: 185,
            height: 278,
            scale: 1,
            zIndex: 2,
            transition: {
              scale: {
                duration: 250,
                easing: "linear"
              },
              border: {
                duration: 250,
                easing: "linear"
              }
            },
            borderRadius: roundPoster ? 16 : 0,
            border: {
              width: 0,
              color: 0
            },
            $focus: {
              scale: 1.1,
              border: {
                color: 0x2C4F7CE8,
                width: 8
              }
            }
          },
          RowTitle: {
            height: 60,
            width: 300,
            marginBottom: -40,
            fontSize: 36,
            color: 0xF0F0F0FF,
            zIndex: 2
          },
          Row: {
            display: "flex",
            justifyContent: "spaceBetween",
            height: 300
          },
          Column: {
            display: "flex",
            flexDirection: "column",
            justifyContent: "flexStart",
            flexBoundary: "contain",
            gap: 64,
            width: theme.layout.screenW - 2 * theme.layout.marginX,
            x: theme.layout.marginX + theme.layout.gutterX,
            y: 48,
            transition: {
              y: {
                duration: 250,
                easing: "ease-in-out"
              }
            },
            zIndex: 2
          },
          peopleBio: _objectSpread(_objectSpread({}, theme.typography.body1), {}, {
            fontFamily: "Roboto",
            fontWeight: "normal",
            contain: "both",
            width: 780,
            height: 340
          })
        });
        var Button$1 = {
          width: 300,
          height: 90,
          color: 0x323232CC,
          $focus: {
            color: 0xFFFFFFFF
          }
        };
        ({
          width: Button$1.width + 8
        });
        var ButtonText = {
          fontSize: 26,
          lineHeight: Button$1.height,
          contain: "width",
          textAlign: "center",
          height: Button$1.height,
          width: Button$1.width,
          color: 0xFFFFFFFF,
          $focus: {
            color: 0x000000FF
          }
        };
        var buttonStyles = {
          container: Button$1,
          text: ButtonText
        };
        var MaterialButton = {
          width: 386,
          height: 136
        };
        var MaterialButtonText = exports("U", {
          fontSize: 32,
          contain: "width",
          textAlign: "center",
          mountY: -0.35,
          color: 0xFFFFFFFF,
          height: MaterialButton.height,
          width: MaterialButton.width,
          // lineHeight: MaterialButton.height, // TODO: Add back when lineHeight is supported
          $focus: {
            fontSize: 40
          },
          $disabled: {
            color: 0x909090FF
          }
        });
        function Thumbnail(props) {
          return createComponent(Image$1, mergeProps(props, {
            id: "thumbnail",
            get src() {
              return props.item.src;
            },
            placeholder: "./assets/fallback.png",
            get item() {
              return props.item;
            },
            get announce() {
              return [props.item.title, "PAUSE-1", props.item.overview];
            },
            get style() {
              return styles$1.Thumbnail;
            }
          }));
        }
        function TileRow(props) {
          return createComponent(Row, mergeProps(props, {
            get style() {
              return styles$1.Row;
            },
            get children() {
              return createComponent(Index, {
                get each() {
                  return props.items;
                },
                children: function children(item, index) {
                  return createComponent(Thumbnail, {
                    get item() {
                      return item();
                    },
                    get announceContext() {
                      return "".concat(index + 1, " of ").concat(props.items.length);
                    }
                  });
                }
              });
            }
          }));
        }
        function Button(props) {
          return createComponent(View, mergeProps(props, {
            get announce() {
              return [props.children, "button"];
            },
            forwardStates: true,
            get style() {
              return buttonStyles.container;
            },
            get children() {
              return createComponent(Text$1, {
                get style() {
                  return buttonStyles.text;
                },
                get children() {
                  return props.children || props.title;
                }
              });
            }
          }));
        }
        function AssetPanel(props) {
          var panelRef, actionRef;
          createEffect(function () {
            if (props.open) {
              panelRef.animate({
                x: 1470
              }, {
                duration: 400,
                easing: "ease-in-out"
              }).start();
              actionRef.setFocus();
            } else if (panelRef.rendered) {
              panelRef.animate({
                x: 1920
              }, {
                duration: 400,
                easing: "ease-in-out"
              }).start();
            }
          });
          return createComponent(View, mergeProps(props, {
            x: 1920,
            ref: function ref(r$) {
              var _ref$ = panelRef;
              typeof _ref$ === "function" ? _ref$(r$) : panelRef = r$;
            },
            color: 0x000000FF,
            width: 450,
            height: 1080,
            zIndex: 5,
            get children() {
              return [createComponent(Text$1, {
                x: 75,
                y: 50,
                fontSize: 32,
                get children() {
                  var _props$item;
                  return (_props$item = props.item) === null || _props$item === void 0 ? void 0 : _props$item.title;
                }
              }), createComponent(Column, {
                ref: function ref(r$) {
                  var _ref$2 = actionRef;
                  typeof _ref$2 === "function" ? _ref$2(r$) : actionRef = r$;
                },
                get onLeft() {
                  return props.close;
                },
                get onBack() {
                  return props.close;
                },
                x: 75,
                y: 200,
                get children() {
                  return [createComponent(Button, {
                    get onEnter() {
                      return props.close;
                    },
                    children: "Record"
                  }), createComponent(Button, {
                    get onEnter() {
                      return props.close;
                    },
                    children: "Watch"
                  }), createComponent(Button, {
                    get onEnter() {
                      return props.close;
                    },
                    children: "Close"
                  })];
                }
              })];
            }
          }));
        }
        var heroTransition = {
          duration: 300,
          easing: "cubic-bezier(0.20, 1.00, 0.80, 1.00)"
        };
        var titleRowStyles = {
          fontFamily: "Raleway",
          fontSize: 24,
          height: 32,
          lineHeight: 32
        };
        function TitleRow(props) {
          return createComponent(View, {
            get height() {
              return props.height;
            },
            forwardFocus: 1,
            marginTop: 30,
            get children() {
              return [createComponent(Text$1, {
                skipFocus: true,
                style: titleRowStyles,
                get children() {
                  return props.title;
                }
              }), createComponent(VirtualRow, {
                gap: 20,
                displaySize: 8,
                bufferSize: 3,
                get each() {
                  return props.items;
                },
                y: 50,
                get scroll() {
                  return props.scroll;
                },
                get wrap() {
                  return props.wrap;
                },
                debugInfo: true,
                children: function children(item, index) {
                  return createComponent(Dynamic, {
                    get component() {
                      return typeToComponent[props.row.type];
                    },
                    get index() {
                      return index();
                    },
                    get item() {
                      return item();
                    }
                  });
                }
              })];
            }
          });
        }
        var posterStyles = {
          width: 185,
          height: 278,
          scale: 1,
          zIndex: 2,
          color: 0xB0B0B0FF,
          //borderRadius: 8,
          transition: {
            scale: {
              duration: 200,
              easing: "linear"
            }
          },
          $focus: {
            scale: 1.1,
            color: 0xFFFFFFFF
          }
        };
        function Poster(props) {
          return createComponent(View, mergeProps({
            get src() {
              var _props$item2;
              return (_props$item2 = props.item) === null || _props$item2 === void 0 ? void 0 : _props$item2.src;
            },
            get title() {
              var _props$item3;
              return (_props$item3 = props.item) === null || _props$item3 === void 0 ? void 0 : _props$item3.shortTitle;
            },
            get backdrop() {
              var _props$item4;
              return (_props$item4 = props.item) === null || _props$item4 === void 0 ? void 0 : _props$item4.backdrop;
            }
          }, props, {
            onFail: function onFail(node) {
              return node.src = "failback.png";
            },
            style: posterStyles
          }));
        }
        var posterTitleStyles = {
          fontFamily: "Raleway",
          fontSize: 22,
          lineHeight: 22,
          height: 22,
          x: 10,
          y: 278,
          contain: "width",
          width: 185,
          maxLines: 2,
          alpha: 0,
          $focus: {
            alpha: 1,
            y: 288
          },
          transition: {
            y: heroTransition,
            alpha: heroTransition
          }
        };
        function PosterTitle(props) {
          return createComponent(View, mergeProps({
            get src() {
              var _props$item5;
              return (_props$item5 = props.item) === null || _props$item5 === void 0 ? void 0 : _props$item5.src;
            },
            get backdrop() {
              var _props$item6;
              return (_props$item6 = props.item) === null || _props$item6 === void 0 ? void 0 : _props$item6.backdrop;
            }
          }, props, {
            onFail: function onFail(node) {
              return node.src = "failback.png";
            },
            style: posterStyles,
            forwardStates: true,
            get children() {
              return createComponent(Text$1, {
                style: posterTitleStyles,
                get children() {
                  var _props$item7;
                  return (_props$item7 = props.item) === null || _props$item7 === void 0 ? void 0 : _props$item7.title;
                }
              });
            }
          }));
        }
        var heroStyles = {
          width: 1280,
          height: 720,
          scale: 1,
          zIndex: 2,
          colorTop: 0xFFFFFFFF,
          colorBottom: 0x000000FF,
          //borderRadius: 8,
          transition: {
            scale: heroTransition
          },
          $focus: {
            scale: 1.05
          }
        };
        var heroTextStyles = {
          fontFamily: "Raleway",
          contain: "width"
        };
        function Hero(props) {
          var _createSignal71 = createSignal(false),
            _createSignal72 = _slicedToArray(_createSignal71, 2),
            hasFocus = _createSignal72[0],
            setHasFocus = _createSignal72[1];
          return createComponent(View, mergeProps(props, {
            get src() {
              return props.item.backdrop;
            },
            style: heroStyles,
            onFocusChanged: setHasFocus,
            forwardStates: true,
            get children() {
              return createComponent(View, {
                transition: {
                  alpha: heroTransition
                },
                get alpha() {
                  return hasFocus() ? 1 : 0;
                },
                get children() {
                  return [createComponent(View, {
                    width: 185,
                    height: 278,
                    x: 54,
                    y: 220,
                    get src() {
                      return props.item.src;
                    }
                  }), createComponent(Text$1, {
                    y: 520,
                    x: 54,
                    fontSize: 64,
                    width: 1e3,
                    maxLines: 1,
                    style: heroTextStyles,
                    get children() {
                      return props.item.title;
                    }
                  }), createComponent(Text$1, {
                    y: 620,
                    x: 60,
                    fontSize: 21,
                    width: 1e3,
                    maxLines: 2,
                    lineHeight: 36,
                    color: 0xCCCCCCFF,
                    style: heroTextStyles,
                    get children() {
                      return props.item.overview;
                    }
                  })];
                }
              });
            }
          }));
        }
        var typeToComponent = {
          Poster: Poster,
          Hero: Hero,
          PosterTitle: PosterTitle
        };
        var BlockStyle = {
          alpha: 0.85,
          border: {
            width: 0,
            color: 0x000000FF
          },
          $focus: {
            border: {
              width: 4,
              color: 0xFFFFFFFF
            },
            alpha: 1
          }
        };
        function Block(props) {
          return createComponent(View, mergeProps(props, {
            width: 100,
            height: 100,
            style: BlockStyle,
            get color() {
              return props.color || 0xE0E0E0FF;
            }
          }));
        }
        var _createSignal73 = createSignal(""),
          _createSignal74 = _slicedToArray(_createSignal73, 2),
          globalBackground = _createSignal74[0],
          setGlobalBackground = _createSignal74[1];
        exports("s", setGlobalBackground);
        function createInfiniteScroll(fetcher) {
          var _createSignal75 = createSignal([]),
            _createSignal76 = _slicedToArray(_createSignal75, 2),
            pages = _createSignal76[0],
            setPages = _createSignal76[1];
          var _createSignal77 = createSignal(1),
            _createSignal78 = _slicedToArray(_createSignal77, 2),
            page = _createSignal78[0],
            setPage = _createSignal78[1];
          var _createSignal79 = createSignal(false),
            _createSignal80 = _slicedToArray(_createSignal79, 2),
            end = _createSignal80[0],
            setEnd = _createSignal80[1];
          var _createResource3 = createResource(page, fetcher),
            _createResource4 = _slicedToArray(_createResource3, 1),
            contents = _createResource4[0];
          createComputed(function () {
            var content = contents();
            if (!content) return;
            batch(function () {
              if (content.length === 0) setEnd(true);
              setPages(function (p) {
                return [].concat(_toConsumableArray(p), _toConsumableArray(content));
              });
            });
          });
          return {
            pages: pages,
            page: page,
            setPage: setPage,
            setPages: setPages,
            end: end,
            setEnd: setEnd
          };
        }
        var blockWidth = 900;
        var ContentBlockStyle = {
          display: "flex",
          flexDirection: "column",
          flexBoundary: "fixed",
          width: blockWidth,
          height: 220,
          gap: 16
        };
        var HeadlineStyles = _objectSpread(_objectSpread({}, theme.typography.display2), {}, {
          fontFamily: "Roboto",
          fontWeight: 700,
          maxLines: 1,
          width: blockWidth
        });
        var Headline = function Headline(props) {
          return createComponent(Marquee, mergeProps(props, {
            textProps: HeadlineStyles
          }));
        };
        var DescriptionStyles = _objectSpread(_objectSpread({}, theme.typography.body1), {}, {
          fontFamily: "Roboto",
          fontWeight: 400,
          lineHeight: 32,
          width: blockWidth,
          maxLines: 3,
          contain: "width"
        });
        var BadgeStyle = {
          fontSize: 16,
          lineHeight: 20,
          marginLeft: 13,
          marginRight: 13
        };
        var Description = function Description(props) {
          return createComponent(Text$1, mergeProps(props, {
            style: DescriptionStyles,
            get children() {
              return props.children;
            }
          }));
        };
        var Badge = function Badge(props) {
          return createComponent(View, mergeProps(props, {
            style: {
              color: "0x00000099",
              borderRadius: 8,
              border: {
                width: 2,
                color: "0xffffffff"
              },
              display: "flex",
              height: 36
            },
            get children() {
              return createComponent(Text$1, {
                lineHeight: 36,
                style: BadgeStyle,
                get children() {
                  return props.children;
                }
              });
            }
          }));
        };
        var MetaTextStyle = _objectSpread(_objectSpread({}, theme.typography.body2), {}, {
          fontFamily: "Roboto",
          fontWeight: 400
        });
        var Metadata = function Metadata(props) {
          return createComponent(View, {
            style: {
              display: "flex",
              flexDirection: "row",
              gap: 18,
              width: blockWidth,
              height: 48
            },
            get children() {
              return [createComponent(View, {
                y: -4,
                src: "./assets/stars.png",
                width: 188,
                height: 31
              }), createComponent(View, {
                y: -4,
                flexItem: false,
                clipping: true,
                get width() {
                  return 188 * props.voteAverage / 10;
                },
                height: 31,
                get children() {
                  return createComponent(View, {
                    src: "./assets/stars-full.png",
                    width: 188,
                    height: 31
                  });
                }
              }), createComponent(Text$1, {
                style: MetaTextStyle,
                get children() {
                  return [memo(function () {
                    return props.voteCount;
                  }), " reviews"];
                }
              }), createComponent(Text$1, {
                style: MetaTextStyle,
                get children() {
                  return props.metaText;
                }
              }), createComponent(For, {
                get each() {
                  return props.badges;
                },
                children: function children(item) {
                  return createComponent(Badge, {
                    y: -5,
                    children: item
                  });
                }
              })];
            }
          });
        };
        var ContentBlock = exports("v", function (props) {
          return createComponent(View, mergeProps({
            id: "contentBlock",
            style: ContentBlockStyle
          }, props, {
            get children() {
              return [createComponent(Headline, {
                get marquee() {
                  return props.marquee;
                },
                get children() {
                  return props.content.title;
                }
              }), createComponent(Description, {
                get children() {
                  return props.content.description;
                }
              }), createComponent(Show, {
                get when() {
                  return props.content.voteCount;
                },
                get children() {
                  return createComponent(Metadata, {
                    get metaText() {
                      return props.content.metaText;
                    },
                    get badges() {
                      return props.content.badges;
                    },
                    get voteCount() {
                      return props.content.voteCount;
                    },
                    get voteAverage() {
                      return props.content.voteAverage;
                    }
                  });
                }
              })];
            }
          }));
        });
        var Browse = function Browse(props) {
          usePreloadRoute();
          var _createSignal81 = createSignal({}),
            _createSignal82 = _slicedToArray(_createSignal81, 2),
            heroContent = _createSignal82[0],
            setHeroContent = _createSignal82[1];
          var navigate = useNavigate();
          var firstRun = true;
          var vgRef;
          onCleanup(function () {
            console.log("cleanup");
          });
          var provider = createMemo(function () {
            return createInfiniteScroll(props.data());
          });
          var delayedBackgrounds = debounce(function (img) {
            return setGlobalBackground(img);
          }, 800);
          var delayedHero = debounce(function (content) {
            return setHeroContent(content || {});
          }, 600);
          function updateContentBlock(_index, _col, elm) {
            if (!elm) return;
            var item = elm.item || {};
            if (firstRun) {
              if (item.backdrop) {
                setGlobalBackground(item.backdrop);
              }
              if (item.heroContent) {
                setHeroContent(item.heroContent);
              }
              firstRun = false;
              return;
            }
            if (item.href) ;
            if (item.backdrop) {
              delayedBackgrounds(item.backdrop);
            }
            if (item.heroContent) {
              delayedHero(item.heroContent);
            }
          }
          function onEndReached() {
            provider().setPage(function (p) {
              return p + 1;
            });
          }
          function onEnter() {
            var _entity$item;
            this.display = "flex";
            var entity = this.children.find(function (c) {
              return c.states.has("focus");
            });
            assertTruthy(entity && ((_entity$item = entity.item) === null || _entity$item === void 0 ? void 0 : _entity$item.href));
            navigate(entity.item.href);
            return true;
          }
          return createComponent(Show, {
            get when() {
              return provider().pages().length;
            },
            get children() {
              return [createComponent(ContentBlock, {
                y: 360,
                x: 162,
                get content() {
                  return heroContent();
                },
                forwardFocus: function forwardFocus() {
                  return vgRef.setFocus();
                }
              }), createComponent(View, {
                clipping: true,
                get style() {
                  return styles$1.itemsContainer;
                },
                get children() {
                  return createComponent(VirtualGrid, {
                    y: 24,
                    x: 160,
                    id: "BrowseGrid",
                    ref: function ref(r$) {
                      var _ref$ = vgRef;
                      typeof _ref$ === "function" ? _ref$(r$) : vgRef = r$;
                    },
                    scroll: "always",
                    get announce() {
                      return "All Trending ".concat(props.params.filter);
                    },
                    onEnter: onEnter,
                    columns: 7,
                    gap: 50,
                    rows: 2,
                    buffer: 2,
                    onSelectedChanged: updateContentBlock,
                    onEndReached: onEndReached,
                    onEndReachedThreshold: 18,
                    width: 1620,
                    autofocus: true,
                    get each() {
                      return provider().pages();
                    },
                    children: function children(item) {
                      return createComponent(Thumbnail, {
                        get item() {
                          return item();
                        }
                      });
                    }
                  });
                }
              })];
            }
          });
        };
        var TMDB = function TMDB(props) {
          var _createSignal83 = createSignal({}),
            _createSignal84 = _slicedToArray(_createSignal83, 2),
            heroContent = _createSignal84[0],
            setHeroContent = _createSignal84[1];
          var _createSignal85 = createSignal(false),
            _createSignal86 = _slicedToArray(_createSignal85, 2),
            openPanel = _createSignal86[0],
            setOpenPanel = _createSignal86[1];
          var _useFocusStack = useFocusStack(),
            storeFocus = _useFocusStack.storeFocus,
            restoreFocus = _useFocusStack.restoreFocus;
          var contentBlock,
            solidLogo,
            firstRun = true;
          var delayedBackgrounds = debounce(setGlobalBackground, 800);
          var delayedHero = debounce(function (content) {
            return setHeroContent(content || {});
          }, 600);
          createEffect(on(activeElement, function (elm) {
            if (!elm) return;
            var item = elm.item || {};
            if (firstRun) {
              item.backdrop && setGlobalBackground(item.backdrop);
              item.heroContent && setHeroContent(item.heroContent);
              firstRun = false;
            } else {
              item.backdrop && delayedBackgrounds(item.backdrop);
              item.heroContent && delayedHero(item.heroContent);
            }
          }, {
            defer: true
          }));
          function onRowChanged(selectedIndex, column, row, lastIndex) {
            if (selectedIndex === lastIndex) return;
            var values = selectedIndex === 0 ? {
              y: 300,
              alpha: 1
            } : {
              y: 200,
              alpha: 0
            };
            contentBlock.animate(values, {
              duration: 300,
              easing: "ease-in-out"
            }).start();
            var values2 = selectedIndex === 0 ? {
              y: 80,
              alpha: 1
            } : {
              y: 0,
              alpha: 0
            };
            solidLogo.animate(values2, {
              duration: 300,
              easing: "ease-in-out"
            }).start();
          }
          return createComponent(View, {
            forwardFocus: 2,
            get children() {
              return [createComponent(View, {
                ref: function ref(r$) {
                  var _ref$ = solidLogo;
                  typeof _ref$ === "function" ? _ref$(r$) : solidLogo = r$;
                },
                width: 300,
                height: 150,
                x: 162,
                y: 80,
                zIndex: 105,
                get children() {
                  return [createComponent(Text$1, {
                    x: 80,
                    fontSize: 28,
                    color: 4143380121,
                    children: "Built With:"
                  }), createComponent(View, {
                    y: 32,
                    src: "./assets/solidWord.png",
                    width: 280,
                    height: 52
                  }), createComponent(View, {
                    x: 0,
                    y: 110,
                    src: "./assets/tmdb.png",
                    width: 80,
                    height: 41
                  }), createComponent(Text$1, {
                    x: 90,
                    y: 110,
                    contain: "width",
                    width: 160,
                    fontSize: 12,
                    color: 4143380121,
                    children: "This product uses the TMDB API but is not endorsed or certified by TMDB."
                  })];
                }
              }), createComponent(ContentBlock, {
                ref: function ref(r$) {
                  var _ref$2 = contentBlock;
                  typeof _ref$2 === "function" ? _ref$2(r$) : contentBlock = r$;
                },
                y: 300,
                x: 162,
                get content() {
                  return heroContent();
                }
              }), createComponent(LazyColumn, {
                y: 500,
                upCount: 3,
                get each() {
                  return props.data.rows;
                },
                id: "BrowseColumn",
                onSelectedChanged: onRowChanged,
                onEnter: function onEnter() {
                  return setOpenPanel(true);
                },
                get autofocus() {
                  return props.data.rows[0].items();
                },
                gap: 40,
                transition: {
                  y: {
                    duration: 300,
                    easing: "ease-in-out"
                  }
                },
                get style() {
                  return styles$1.Column;
                },
                children: function children(row) {
                  return row().type === "Hero" ? createComponent(VirtualRow, {
                    gap: 80,
                    displaySize: 3,
                    bufferSize: 1,
                    scroll: "center",
                    centerScroll: true,
                    get each() {
                      return row().items();
                    },
                    y: 50,
                    get height() {
                      return row().height;
                    },
                    children: function children(item) {
                      return createComponent(Hero, {
                        get item() {
                          return item();
                        }
                      });
                    }
                  }) : createComponent(TitleRow, {
                    get row() {
                      return row();
                    },
                    get title() {
                      return row().title;
                    },
                    get height() {
                      return row().height;
                    },
                    get items() {
                      return row().items();
                    }
                  });
                }
              }), createComponent(AssetPanel, {
                onFocus: storeFocus,
                close: function close() {
                  setOpenPanel(false);
                  restoreFocus();
                  return true;
                },
                get open() {
                  return openPanel();
                },
                get item() {
                  return heroContent();
                }
              })];
            }
          });
        };
        var Destroy = function Destroy(props) {
          var _createSignal87 = createSignal(),
            _createSignal88 = _slicedToArray(_createSignal87, 2),
            heroContent = _createSignal88[0],
            setHeroContent = _createSignal88[1];
          var _createSignal89 = createSignal(0),
            _createSignal90 = _slicedToArray(_createSignal89, 2),
            heroIndex = _createSignal90[0],
            setHeroIndex = _createSignal90[1];
          onMount(function () {
            return setGlobalBackground(0x333333FF);
          });
          createEffect(on([props.data.heroRow.items, heroIndex], function (_ref48) {
            var _ref49 = _slicedToArray(_ref48, 2),
              heros = _ref49[0],
              index = _ref49[1];
            if (heros) setHeroContent(heros[index]);
            if (heros && index < heros.length - 1) {
              var img = new Image();
              img.crossOrigin = "anonymous";
              img.src = heros[index + 1].backdrop;
            }
          }));
          function onDown() {
            if (heroIndex() >= 19) return false;
            setHeroIndex(function (p) {
              return p + 1;
            });
          }
          function onUp() {
            if (heroIndex() === 0) return false;
            setHeroIndex(function (p) {
              return p - 1;
            });
            return true;
          }
          function animateOut(node) {
            return node.animate({
              y: 200,
              alpha: 0
            }, {
              duration: 500,
              easing: "ease-in-out"
            }).start().waitUntilStopped();
          }
          function animateIn(node) {
            node.alpha = 0;
            node.y = -100;
            return node.animate({
              y: 0,
              alpha: 1
            }, {
              duration: 500,
              easing: "ease-in-out"
            }).start().waitUntilStopped();
          }
          return createComponent(View, {
            x: 300,
            y: 200,
            onDown: onDown,
            onUp: onUp,
            get children() {
              return [createComponent(View, {
                src: "assets/up.svg",
                width: 350,
                height: 200,
                x: 450,
                y: -200,
                get rotation() {
                  return Math.PI;
                }
              }), createComponent(Show, {
                get when() {
                  return heroContent();
                },
                keyed: true,
                get children() {
                  return createComponent(Hero, {
                    id: "Hero",
                    autofocus: true,
                    onDestroy: animateOut,
                    onCreate: animateIn,
                    get item() {
                      return heroContent();
                    },
                    get title() {
                      return heroContent().title;
                    }
                  });
                }
              })];
            }
          });
        };
        var API_KEY_V4 = "eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiIyZDE4YjEwMTA0YjdiZTlkNjFiMWYwYjVlMGEwNzM2OCIsInN1YiI6IjYwZTVjMTdlNGNhNjc2MDA3NTA4Njc3MSIsInNjb3BlcyI6WyJhcGlfcmVhZCJdLCJ2ZXJzaW9uIjoxfQ.D_nqH9kd-bhhWzeVsTDPYhHnsUaNAuyAa6YATmKHqsA";
        var API_BASE = "https://api.themoviedb.org/3";
        var tmdbConfig;
        var baseImageUrl;
        var urlParams$1 = new URLSearchParams(window.location.search);
        var basePosterSize = urlParams$1.get("posterSize") || "w185";
        var defaultFetchParams = {
          headers: {
            "Content-Type": "application/json",
            Authorization: "Bearer " + API_KEY_V4
          }
        };
        function getImageUrl(path) {
          var posterSize = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : basePosterSize;
          return baseImageUrl + posterSize + path;
        }
        function get(path) {
          var params = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
          if (tmdbConfig) {
            return _get(path, params);
          } else {
            return loadConfig().then(function () {
              return _get(path, params);
            });
          }
        }
        function _get(path) {
          var params = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
          return fetch(API_BASE + path, _objectSpread(_objectSpread({}, defaultFetchParams), params)).then(function (r) {
            return r.json();
          });
        }
        function loadConfig() {
          return _get("/configuration").then(function (data) {
            var _data$images;
            tmdbConfig = data;
            baseImageUrl = (_data$images = data.images) === null || _data$images === void 0 ? void 0 : _data$images.secure_base_url;
            return data;
          });
        }
        var api = exports("X", {
          get: get,
          loadConfig: loadConfig
        });
        function truncateString(str, maxLength) {
          if (str.length > maxLength) {
            return str.substring(0, maxLength - 3) + "...";
          }
          return str;
        }
        function convertItemsToTiles() {
          var items = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];
          return items.map(function (item, i) {
            return {
              src: getImageUrl(item.poster_path || item.profile_path),
              tileSrc: getImageUrl(item.backdrop_path || item.profile_path, "w300"),
              backdrop: getImageUrl(item.backdrop_path, "w1280"),
              href: "/entity/".concat(item.media_type || "people", "/").concat(item.id),
              shortTitle: truncateString(item.title || item.name, 30),
              title: item.title || item.name,
              overview: item.overview,
              absIndex: i,
              item: item,
              entityInfo: {
                type: item.media_type || "people",
                id: item.id
              },
              heroContent: {
                title: item.title || item.name,
                description: item.overview
              }
            };
          });
        }
        var handleResults = function handleResults(response) {
          return response.then(function (_ref50) {
            var results = _ref50.results;
            var filteredItems = results.filter(function (r) {
              return !r.adult;
            });
            return convertItemsToTiles(filteredItems);
          });
        };
        var fetchPopular = function fetchPopular(type) {
          return handleResults(api.get("/".concat(type, "/popular")));
        };
        var genreListCache;
        var fetchGenreMovies = function fetchGenreMovies(genres) {
          var genreList = genreListCache || (genreListCache = api.get("/genre/movie/list"));
          var targetGenre = Array.isArray(genres) ? genres : [genres];
          return genreList.then(function (_ref51) {
            var genres2 = _ref51.genres;
            var targetGenreIds = [];
            genres2.forEach(function (item) {
              if (targetGenre.includes(item.name)) targetGenreIds.push(item.id);
            });
            return handleResults(api.get("/discover/movie?with_genres=".concat(targetGenreIds.join())));
          });
        };
        function destroyData() {
          var heroRow = {
            title: "Best Adventure and Action movies",
            items: createResource(function () {
              return fetchGenreMovies(["adventure", "action"]);
            })[0],
            type: "Hero",
            height: 800
          };
          return {
            heroRow: heroRow
          };
        }
        function tmdbData() {
          var rows = [];
          var popularMovies = createResource(function () {
            return fetchPopular("movie");
          });
          rows.push({
            title: "Popular Movies",
            items: popularMovies[0],
            setItems: popularMovies[1].mutate,
            type: "Poster",
            height: 328
          });
          rows.push({
            title: "Best Western movies",
            items: createResource(function () {
              return fetchGenreMovies(["Western"]);
            })[0],
            type: "Hero",
            height: 720
          });
          rows.push({
            title: "Best Comedy movies",
            items: createResource(function () {
              return fetchGenreMovies(["Comedy"]);
            })[0],
            type: "PosterTitle",
            height: 400
          });
          rows.push({
            title: "Popular TV shows",
            items: createResource(function () {
              return fetchPopular("tv");
            })[0],
            type: "PosterTitle",
            height: 400
          });
          var heroRow = {
            title: "Best Adventure and Action movies",
            items: createResource(function () {
              return fetchGenreMovies(["adventure", "action"]);
            })[0],
            type: "Hero",
            height: 720
          };
          rows.push(heroRow);
          rows.push({
            title: "Best Animations",
            items: createResource(function () {
              return fetchGenreMovies("Animation");
            })[0],
            type: "PosterTitle",
            height: 400
          });
          rows.push({
            title: "Best TV Movie Movies",
            items: createResource(function () {
              return fetchGenreMovies("TV Movie");
            })[0],
            type: "PosterTitle",
            height: 400
          });
          rows.push({
            title: "Best Science Fiction movies",
            items: createResource(function () {
              return fetchGenreMovies("Science Fiction");
            })[0],
            type: "Hero",
            height: 720
          });
          rows.push({
            title: "Best War Movies",
            items: createResource(function () {
              return fetchGenreMovies("War");
            })[0],
            type: "PosterTitle",
            height: 400
          });
          return {
            rows: rows
          };
        }
        var NotFound = function NotFound() {
          return function () {
            var _el$ = createElement("node");
            setProp(_el$, "style", {
              width: 1920,
              height: 1080,
              color: 868483072
            });
            return _el$;
          }();
        };
        var basePath$1 = "/solid-demo-app/";
        var fonts = [{
          type: "msdf",
          fontFamily: "Roboto",
          descriptors: {
            weight: 700
          },
          atlasDataUrl: basePath$1 + "fonts/Roboto-Bold.msdf.json",
          atlasUrl: basePath$1 + "fonts/Roboto-Bold.msdf.png"
        }, {
          type: "msdf",
          fontFamily: "Roboto",
          descriptors: {
            weight: 400
          },
          atlasDataUrl: basePath$1 + "fonts/Roboto-Regular.msdf.json",
          atlasUrl: basePath$1 + "fonts/Roboto-Regular.msdf.png"
        }, {
          type: "msdf",
          fontFamily: "Arial",
          descriptors: {
            weight: 500
          },
          atlasDataUrl: basePath$1 + "fonts/Roboto-Regular.msdf.json",
          atlasUrl: basePath$1 + "fonts/Roboto-Regular.msdf.png"
        }, {
          type: "msdf",
          fontFamily: "Raleway",
          descriptors: {
            weight: 800
          },
          atlasDataUrl: basePath$1 + "fonts/Raleway-ExtraBold.msdf.json",
          atlasUrl: basePath$1 + "fonts/Raleway-ExtraBold.msdf.png"
        }, {
          fontFamily: "Roboto",
          fontUrl: basePath$1 + "fonts/Roboto-Regular.ttf"
        }];
        var cache = /* @__PURE__ */new Map();
        function browseProvider(filter) {
          return function (pageIndex) {
            var url = "/trending/".concat(filter, "/week?page=").concat(pageIndex);
            if (cache.has(url)) {
              return cache.get(url);
            }
            var result = api.get(url).then(function (trending) {
              var results = trending.results.filter(function (r) {
                return !r.adult;
              });
              var tiles = convertItemsToTiles(results);
              return tiles;
            });
            cache.set(url, result);
            return result;
          };
        }
        function browsePreload(props) {
          var lastFilter = null;
          return createMemo(function (p) {
            var params = props.params;
            if (p && (!params.filter || lastFilter === params.filter)) {
              return p;
            }
            var provider = browseProvider(params.filter || "all");
            provider(1);
            lastFilter = params.filter || lastFilter;
            return provider;
          });
        }
        function minutesToHMM(minutes) {
          var hours = Math.floor(minutes / 60);
          var remainingMinutes = minutes % 60;
          return hours + "h " + (remainingMinutes < 10 ? "0" : "") + remainingMinutes + "min";
        }
        function formatDate(dateString) {
          var parts = dateString.split("-");
          return parts[1] + "/" + parts[2] + "/" + parts[0];
        }
        function justYear(dateString) {
          var parts = (dateString === null || dateString === void 0 ? void 0 : dateString.split("-")) || [];
          return parts[0] || "";
        }
        function ensureItems(items, minCount) {
          var remainingCount = minCount - items.length;
          if (remainingCount > 0) {
            return items.concat(Array(remainingCount).fill({}));
          }
          return items;
        }
        function getRecommendations(_ref52) {
          var type = _ref52.type,
            id = _ref52.id;
          return api.get("/".concat(type, "/").concat(id, "/recommendations")).then(function (_ref53) {
            var results = _ref53.results;
            if (results.length) {
              return ensureItems(convertItemsToTiles(results.slice(0, 7)), 7);
            }
            return api.get("/trending/".concat(type, "/week?page=1")).then(function (_ref54) {
              var results = _ref54.results;
              return ensureItems(convertItemsToTiles(results.slice(0, 7)), 7);
            });
          });
        }
        function getCredits(_ref55) {
          var type = _ref55.type,
            id = _ref55.id;
          return api.get("/".concat(type, "/").concat(id, "/credits")).then(function (_ref56) {
            var cast = _ref56.cast;
            return ensureItems(convertItemsToTiles(cast.slice(0, 7)), 7);
          });
        }
        function getInfo(_ref57) {
          var type = _ref57.type,
            id = _ref57.id;
          var rt = type === "movie" ? {
            rtCrit: 86,
            rtFan: 92
          } : {};
          return api.get("/".concat(type, "/").concat(id)).then(function (data) {
            return _objectSpread({
              backgroundImage: getImageUrl(data.backdrop_path, "w1280"),
              heroContent: {
                title: data.title || data.name,
                description: data.overview,
                badges: ["HD", "CC"],
                voteAverage: data.vote_average,
                voteCount: data.vote_count,
                metaText: type === "movie" ? minutesToHMM(data.runtime) + "   " + formatDate(data.release_date) : "".concat(justYear(data.first_air_date), " - ").concat(justYear(data.last_air_date)),
                reviews: rt
              }
            }, data);
          });
        }
        function entityPreload(_ref58) {
          var params = _ref58.params,
            intent = _ref58.intent;
          var _createResource5 = createResource(function () {
              return _objectSpread({}, params);
            }, getInfo),
            _createResource6 = _slicedToArray(_createResource5, 1),
            entity = _createResource6[0];
          if (intent === "preload") {
            return;
          }
          var _createResource7 = createResource(function () {
              return _objectSpread({}, params);
            }, getCredits),
            _createResource8 = _slicedToArray(_createResource7, 1),
            credits = _createResource8[0];
          var _createResource9 = createResource(function () {
              return _objectSpread({}, params);
            }, getRecommendations),
            _createResource0 = _slicedToArray(_createResource9, 1),
            recommendations = _createResource0[0];
          return {
            entity: entity,
            credits: credits,
            recommendations: recommendations
          };
        }
        var commonjsGlobal = typeof globalThis !== 'undefined' ? globalThis : typeof window !== 'undefined' ? window : typeof global !== 'undefined' ? global : typeof self !== 'undefined' ? self : {};
        function getDefaultExportFromCjs(x) {
          return x && x.__esModule && Object.prototype.hasOwnProperty.call(x, 'default') ? x['default'] : x;
        }
        var shakaPlayer_compiled = {};

        /*
         @license
         Shaka Player
         Copyright 2016 Google LLC
         SPDX-License-Identifier: Apache-2.0
        */

        var hasRequiredShakaPlayer_compiled;
        function requireShakaPlayer_compiled() {
          if (hasRequiredShakaPlayer_compiled) return shakaPlayer_compiled;
          hasRequiredShakaPlayer_compiled = 1;
          (function (exports) {
            (function () {
              var innerGlobal = typeof window != "undefined" ? window : commonjsGlobal;
              var exportTo = {};
              (function (window, global, module) {
                /*
                Copyright The Closure Library Authors.
                SPDX-License-Identifier: Apache-2.0
                */
                var p,
                  aa = typeof Object.create == "function" ? Object.create : function (a) {
                    function b() {}
                    b.prototype = a;
                    return new b();
                  },
                  ba = typeof Object.defineProperties == "function" ? Object.defineProperty : function (a, b, c) {
                    if (a == Array.prototype || a == Object.prototype) return a;
                    a[b] = c.value;
                    return a;
                  };
                function ca(a) {
                  a = ["object" == (typeof globalThis === "undefined" ? "undefined" : _typeof(globalThis)) && globalThis, a, "object" == _typeof(window) && window, "object" == (typeof self === "undefined" ? "undefined" : _typeof(self)) && self, "object" == _typeof(global) && global];
                  for (var b = 0; b < a.length; ++b) {
                    var c = a[b];
                    if (c && c.Math == Math) return c;
                  }
                  throw Error("Cannot find global object");
                }
                var da = ca(this);
                function ea(a, b) {
                  if (b) a: {
                    var c = da;
                    a = a.split(".");
                    for (var d = 0; d < a.length - 1; d++) {
                      var e = a[d];
                      if (!(e in c)) break a;
                      c = c[e];
                    }
                    a = a[a.length - 1];
                    d = c[a];
                    b = b(d);
                    b != d && b != null && ba(c, a, {
                      configurable: true,
                      writable: true,
                      value: b
                    });
                  }
                }
                var fa;
                if (typeof Object.setPrototypeOf == "function") fa = Object.setPrototypeOf;else {
                  var ha;
                  a: {
                    var ia = {
                        a: true
                      },
                      ja = {};
                    try {
                      ja.__proto__ = ia;
                      ha = ja.a;
                      break a;
                    } catch (a) {}
                    ha = false;
                  }
                  fa = ha ? function (a, b) {
                    a.__proto__ = b;
                    if (a.__proto__ !== b) throw new TypeError(a + " is not extensible");
                    return a;
                  } : null;
                }
                var ka = fa;
                function la(a, b) {
                  a.prototype = aa(b.prototype);
                  a.prototype.constructor = a;
                  if (ka) ka(a, b);else for (var c in b) if (c != "prototype") if (Object.defineProperties) {
                    var d = Object.getOwnPropertyDescriptor(b, c);
                    d && Object.defineProperty(a, c, d);
                  } else a[c] = b[c];
                  a.Em = b.prototype;
                }
                function ma(a) {
                  var b = 0;
                  return function () {
                    return b < a.length ? {
                      done: false,
                      value: a[b++]
                    } : {
                      done: true
                    };
                  };
                }
                function t(a) {
                  var b = typeof Symbol != "undefined" && Symbol.iterator && a[Symbol.iterator];
                  if (b) return b.call(a);
                  if (typeof a.length == "number") return {
                    next: ma(a)
                  };
                  throw Error(String(a) + " is not an iterable or ArrayLike");
                }
                function x(a) {
                  if (!(a instanceof Array)) {
                    a = t(a);
                    for (var b, c = []; !(b = a.next()).done;) c.push(b.value);
                    a = c;
                  }
                  return a;
                }
                ea("Symbol", function (a) {
                  function b(f) {
                    if (this instanceof b) throw new TypeError("Symbol is not a constructor");
                    return new c(d + (f || "") + "_" + e++, f);
                  }
                  function c(f, g) {
                    this.g = f;
                    ba(this, "description", {
                      configurable: true,
                      writable: true,
                      value: g
                    });
                  }
                  if (a) return a;
                  c.prototype.toString = function () {
                    return this.g;
                  };
                  var d = "jscomp_symbol_" + (Math.random() * 1E9 >>> 0) + "_",
                    e = 0;
                  return b;
                });
                ea("Symbol.iterator", function (a) {
                  if (a) return a;
                  a = Symbol("Symbol.iterator");
                  for (var b = "Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "), c = 0; c < b.length; c++) {
                    var d = da[b[c]];
                    typeof d === "function" && typeof d.prototype[a] != "function" && ba(d.prototype, a, {
                      configurable: true,
                      writable: true,
                      value: function value() {
                        return na(ma(this));
                      }
                    });
                  }
                  return a;
                });
                function na(a) {
                  a = {
                    next: a
                  };
                  a[Symbol.iterator] = function () {
                    return this;
                  };
                  return a;
                }
                function qa() {
                  this.o = false;
                  this.l = null;
                  this.h = void 0;
                  this.g = 1;
                  this.j = this.m = 0;
                  this.B = this.i = null;
                }
                function ra(a) {
                  if (a.o) throw new TypeError("Generator is already running");
                  a.o = true;
                }
                qa.prototype.u = function (a) {
                  this.h = a;
                };
                function sa(a, b) {
                  a.i = {
                    Wh: b,
                    li: true
                  };
                  a.g = a.m || a.j;
                }
                qa.prototype.return = function (a) {
                  this.i = {
                    return: a
                  };
                  this.g = this.j;
                };
                function F(a, b, c) {
                  a.g = c;
                  return {
                    value: b
                  };
                }
                qa.prototype.A = function (a) {
                  this.g = a;
                };
                function G(a) {
                  a.g = 0;
                }
                function ua(a, b, c) {
                  a.m = b;
                  c != void 0 && (a.j = c);
                }
                function va(a, b) {
                  a.m = 0;
                  a.j = b || 0;
                }
                function xa(a, b, c) {
                  a.g = b;
                  a.m = c || 0;
                }
                function ya(a, b) {
                  a.m = b || 0;
                  b = a.i.Wh;
                  a.i = null;
                  return b;
                }
                function Aa(a) {
                  a.B = [a.i];
                  a.m = 0;
                  a.j = 0;
                }
                function Da(a, b) {
                  var c = a.B.splice(0)[0];
                  (c = a.i = a.i || c) ? c.li ? a.g = a.m || a.j : c.A != void 0 && a.j < c.A ? (a.g = c.A, a.i = null) : a.g = a.j : a.g = b;
                }
                function Ga(a) {
                  this.g = new qa();
                  this.h = a;
                }
                function Ia(a, b) {
                  ra(a.g);
                  var c = a.g.l;
                  if (c) return Ja(a, "return" in c ? c["return"] : function (d) {
                    return {
                      value: d,
                      done: true
                    };
                  }, b, a.g.return);
                  a.g.return(b);
                  return Ka(a);
                }
                function Ja(a, b, c, d) {
                  try {
                    var e = b.call(a.g.l, c);
                    if (!(e instanceof Object)) throw new TypeError("Iterator result " + e + " is not an object");
                    if (!e.done) return a.g.o = !1, e;
                    var f = e.value;
                  } catch (g) {
                    return a.g.l = null, sa(a.g, g), Ka(a);
                  }
                  a.g.l = null;
                  d.call(a.g, f);
                  return Ka(a);
                }
                function Ka(a) {
                  for (; a.g.g;) try {
                    var b = a.h(a.g);
                    if (b) return a.g.o = !1, {
                      value: b.value,
                      done: !1
                    };
                  } catch (c) {
                    a.g.h = void 0, sa(a.g, c);
                  }
                  a.g.o = false;
                  if (a.g.i) {
                    b = a.g.i;
                    a.g.i = null;
                    if (b.li) throw b.Wh;
                    return {
                      value: b.return,
                      done: true
                    };
                  }
                  return {
                    value: void 0,
                    done: true
                  };
                }
                function La(a) {
                  this.next = function (b) {
                    ra(a.g);
                    a.g.l ? b = Ja(a, a.g.l.next, b, a.g.u) : (a.g.u(b), b = Ka(a));
                    return b;
                  };
                  this.throw = function (b) {
                    ra(a.g);
                    a.g.l ? b = Ja(a, a.g.l["throw"], b, a.g.u) : (sa(a.g, b), b = Ka(a));
                    return b;
                  };
                  this.return = function (b) {
                    return Ia(a, b);
                  };
                  this[Symbol.iterator] = function () {
                    return this;
                  };
                }
                function Ma(a) {
                  function b(d) {
                    return a.next(d);
                  }
                  function c(d) {
                    return a.throw(d);
                  }
                  return new Promise(function (d, e) {
                    function f(g) {
                      g.done ? d(g.value) : Promise.resolve(g.value).then(b, c).then(f, e);
                    }
                    f(a.next());
                  });
                }
                function P(a) {
                  return Ma(new La(new Ga(a)));
                }
                function Oa() {
                  for (var a = Number(this), b = [], c = a; c < arguments.length; c++) b[c - a] = arguments[c];
                  return b;
                }
                ea("Promise", function (a) {
                  function b(g) {
                    this.h = 0;
                    this.i = void 0;
                    this.g = [];
                    this.o = false;
                    var h = this.j();
                    try {
                      g(h.resolve, h.reject);
                    } catch (k) {
                      h.reject(k);
                    }
                  }
                  function c() {
                    this.g = null;
                  }
                  function d(g) {
                    return g instanceof b ? g : new b(function (h) {
                      h(g);
                    });
                  }
                  if (a) return a;
                  c.prototype.h = function (g) {
                    if (this.g == null) {
                      this.g = [];
                      var h = this;
                      this.i(function () {
                        h.l();
                      });
                    }
                    this.g.push(g);
                  };
                  var e = da.setTimeout;
                  c.prototype.i = function (g) {
                    e(g, 0);
                  };
                  c.prototype.l = function () {
                    for (; this.g && this.g.length;) {
                      var g = this.g;
                      this.g = [];
                      for (var h = 0; h < g.length; ++h) {
                        var k = g[h];
                        g[h] = null;
                        try {
                          k();
                        } catch (l) {
                          this.j(l);
                        }
                      }
                    }
                    this.g = null;
                  };
                  c.prototype.j = function (g) {
                    this.i(function () {
                      throw g;
                    });
                  };
                  b.prototype.j = function () {
                    function g(l) {
                      return function (m) {
                        k || (k = true, l.call(h, m));
                      };
                    }
                    var h = this,
                      k = false;
                    return {
                      resolve: g(this.G),
                      reject: g(this.l)
                    };
                  };
                  b.prototype.G = function (g) {
                    if (g === this) this.l(new TypeError("A Promise cannot resolve to itself"));else if (g instanceof b) this.I(g);else {
                      a: switch (_typeof(g)) {
                        case "object":
                          var h = g != null;
                          break a;
                        case "function":
                          h = true;
                          break a;
                        default:
                          h = false;
                      }
                      h ? this.F(g) : this.m(g);
                    }
                  };
                  b.prototype.F = function (g) {
                    var h = void 0;
                    try {
                      h = g.then;
                    } catch (k) {
                      this.l(k);
                      return;
                    }
                    typeof h == "function" ? this.J(h, g) : this.m(g);
                  };
                  b.prototype.l = function (g) {
                    this.u(2, g);
                  };
                  b.prototype.m = function (g) {
                    this.u(1, g);
                  };
                  b.prototype.u = function (g, h) {
                    if (this.h != 0) throw Error("Cannot settle(" + g + ", " + h + "): Promise already settled in state" + this.h);
                    this.h = g;
                    this.i = h;
                    this.h === 2 && this.H();
                    this.B();
                  };
                  b.prototype.H = function () {
                    var g = this;
                    e(function () {
                      if (g.C()) {
                        var h = da.console;
                        typeof h !== "undefined" && h.error(g.i);
                      }
                    }, 1);
                  };
                  b.prototype.C = function () {
                    if (this.o) return false;
                    var g = da.CustomEvent,
                      h = da.Event,
                      k = da.dispatchEvent;
                    if (typeof k === "undefined") return true;
                    typeof g === "function" ? g = new g("unhandledrejection", {
                      cancelable: true
                    }) : typeof h === "function" ? g = new h("unhandledrejection", {
                      cancelable: true
                    }) : (g = da.document.createEvent("CustomEvent"), g.initCustomEvent("unhandledrejection", false, true, g));
                    g.promise = this;
                    g.reason = this.i;
                    return k(g);
                  };
                  b.prototype.B = function () {
                    if (this.g != null) {
                      for (var g = 0; g < this.g.length; ++g) f.h(this.g[g]);
                      this.g = null;
                    }
                  };
                  var f = new c();
                  b.prototype.I = function (g) {
                    var h = this.j();
                    g.Qe(h.resolve, h.reject);
                  };
                  b.prototype.J = function (g, h) {
                    var k = this.j();
                    try {
                      g.call(h, k.resolve, k.reject);
                    } catch (l) {
                      k.reject(l);
                    }
                  };
                  b.prototype.then = function (g, h) {
                    function k(q, r) {
                      return typeof q == "function" ? function (u) {
                        try {
                          l(q(u));
                        } catch (v) {
                          m(v);
                        }
                      } : r;
                    }
                    var l,
                      m,
                      n = new b(function (q, r) {
                        l = q;
                        m = r;
                      });
                    this.Qe(k(g, l), k(h, m));
                    return n;
                  };
                  b.prototype.catch = function (g) {
                    return this.then(void 0, g);
                  };
                  b.prototype.Qe = function (g, h) {
                    function k() {
                      switch (l.h) {
                        case 1:
                          g(l.i);
                          break;
                        case 2:
                          h(l.i);
                          break;
                        default:
                          throw Error("Unexpected state: " + l.h);
                      }
                    }
                    var l = this;
                    this.g == null ? f.h(k) : this.g.push(k);
                    this.o = true;
                  };
                  b.resolve = d;
                  b.reject = function (g) {
                    return new b(function (h, k) {
                      k(g);
                    });
                  };
                  b.race = function (g) {
                    return new b(function (h, k) {
                      for (var l = t(g), m = l.next(); !m.done; m = l.next()) d(m.value).Qe(h, k);
                    });
                  };
                  b.all = function (g) {
                    var h = t(g),
                      k = h.next();
                    return k.done ? d([]) : new b(function (l, m) {
                      function n(u) {
                        return function (v) {
                          q[u] = v;
                          r--;
                          r == 0 && l(q);
                        };
                      }
                      var q = [],
                        r = 0;
                      do q.push(void 0), r++, d(k.value).Qe(n(q.length - 1), m), k = h.next(); while (!k.done);
                    });
                  };
                  return b;
                });
                function Pa(a, b) {
                  return Object.prototype.hasOwnProperty.call(a, b);
                }
                ea("WeakMap", function (a) {
                  function b(k) {
                    this.g = (h += Math.random() + 1).toString();
                    if (k) {
                      k = t(k);
                      for (var l; !(l = k.next()).done;) l = l.value, this.set(l[0], l[1]);
                    }
                  }
                  function c() {}
                  function d(k) {
                    var l = _typeof(k);
                    return l === "object" && k !== null || l === "function";
                  }
                  function e(k) {
                    if (!Pa(k, g)) {
                      var l = new c();
                      ba(k, g, {
                        value: l
                      });
                    }
                  }
                  function f(k) {
                    var l = Object[k];
                    l && (Object[k] = function (m) {
                      if (m instanceof c) return m;
                      Object.isExtensible(m) && e(m);
                      return l(m);
                    });
                  }
                  if (function () {
                    if (!a || !Object.seal) return false;
                    try {
                      var k = Object.seal({}),
                        l = Object.seal({}),
                        m = new a([[k, 2], [l, 3]]);
                      if (m.get(k) != 2 || m.get(l) != 3) return !1;
                      m.delete(k);
                      m.set(l, 4);
                      return !m.has(k) && m.get(l) == 4;
                    } catch (n) {
                      return false;
                    }
                  }()) return a;
                  var g = "$jscomp_hidden_" + Math.random();
                  f("freeze");
                  f("preventExtensions");
                  f("seal");
                  var h = 0;
                  b.prototype.set = function (k, l) {
                    if (!d(k)) throw Error("Invalid WeakMap key");
                    e(k);
                    if (!Pa(k, g)) throw Error("WeakMap key fail: " + k);
                    k[g][this.g] = l;
                    return this;
                  };
                  b.prototype.get = function (k) {
                    return d(k) && Pa(k, g) ? k[g][this.g] : void 0;
                  };
                  b.prototype.has = function (k) {
                    return d(k) && Pa(k, g) && Pa(k[g], this.g);
                  };
                  b.prototype.delete = function (k) {
                    return d(k) && Pa(k, g) && Pa(k[g], this.g) ? delete k[g][this.g] : false;
                  };
                  return b;
                });
                ea("Map", function (a) {
                  function b() {
                    var h = {};
                    return h.wc = h.next = h.head = h;
                  }
                  function c(h, k) {
                    var l = h[1];
                    return na(function () {
                      if (l) {
                        for (; l.head != h[1];) l = l.wc;
                        for (; l.next != l.head;) return l = l.next, {
                          done: false,
                          value: k(l)
                        };
                        l = null;
                      }
                      return {
                        done: true,
                        value: void 0
                      };
                    });
                  }
                  function d(h, k) {
                    var l = k && _typeof(k);
                    l == "object" || l == "function" ? f.has(k) ? l = f.get(k) : (l = "" + ++g, f.set(k, l)) : l = "p_" + k;
                    var m = h[0][l];
                    if (m && Pa(h[0], l)) for (h = 0; h < m.length; h++) {
                      var n = m[h];
                      if (k !== k && n.key !== n.key || k === n.key) return {
                        id: l,
                        list: m,
                        index: h,
                        entry: n
                      };
                    }
                    return {
                      id: l,
                      list: m,
                      index: -1,
                      entry: void 0
                    };
                  }
                  function e(h) {
                    this[0] = {};
                    this[1] = b();
                    this.size = 0;
                    if (h) {
                      h = t(h);
                      for (var k; !(k = h.next()).done;) k = k.value, this.set(k[0], k[1]);
                    }
                  }
                  if (function () {
                    if (!a || typeof a != "function" || !a.prototype.entries || typeof Object.seal != "function") return false;
                    try {
                      var h = Object.seal({
                          x: 4
                        }),
                        k = new a(t([[h, "s"]]));
                      if (k.get(h) != "s" || k.size != 1 || k.get({
                        x: 4
                      }) || k.set({
                        x: 4
                      }, "t") != k || k.size != 2) return !1;
                      var l = k.entries(),
                        m = l.next();
                      if (m.done || m.value[0] != h || m.value[1] != "s") return !1;
                      m = l.next();
                      return m.done || m.value[0].x != 4 || m.value[1] != "t" || !l.next().done ? !1 : !0;
                    } catch (n) {
                      return false;
                    }
                  }()) return a;
                  var f = new WeakMap();
                  e.prototype.set = function (h, k) {
                    h = h === 0 ? 0 : h;
                    var l = d(this, h);
                    l.list || (l.list = this[0][l.id] = []);
                    l.entry ? l.entry.value = k : (l.entry = {
                      next: this[1],
                      wc: this[1].wc,
                      head: this[1],
                      key: h,
                      value: k
                    }, l.list.push(l.entry), this[1].wc.next = l.entry, this[1].wc = l.entry, this.size++);
                    return this;
                  };
                  e.prototype.delete = function (h) {
                    h = d(this, h);
                    return h.entry && h.list ? (h.list.splice(h.index, 1), h.list.length || delete this[0][h.id], h.entry.wc.next = h.entry.next, h.entry.next.wc = h.entry.wc, h.entry.head = null, this.size--, true) : false;
                  };
                  e.prototype.clear = function () {
                    this[0] = {};
                    this[1] = this[1].wc = b();
                    this.size = 0;
                  };
                  e.prototype.has = function (h) {
                    return !!d(this, h).entry;
                  };
                  e.prototype.get = function (h) {
                    return (h = d(this, h).entry) && h.value;
                  };
                  e.prototype.entries = function () {
                    return c(this, function (h) {
                      return [h.key, h.value];
                    });
                  };
                  e.prototype.keys = function () {
                    return c(this, function (h) {
                      return h.key;
                    });
                  };
                  e.prototype.values = function () {
                    return c(this, function (h) {
                      return h.value;
                    });
                  };
                  e.prototype.forEach = function (h, k) {
                    for (var l = this.entries(), m; !(m = l.next()).done;) m = m.value, h.call(k, m[1], m[0], this);
                  };
                  e.prototype[Symbol.iterator] = e.prototype.entries;
                  var g = 0;
                  return e;
                });
                ea("Set", function (a) {
                  function b(c) {
                    this.g = new Map();
                    if (c) {
                      c = t(c);
                      for (var d; !(d = c.next()).done;) this.add(d.value);
                    }
                    this.size = this.g.size;
                  }
                  if (function () {
                    if (!a || typeof a != "function" || !a.prototype.entries || typeof Object.seal != "function") return false;
                    try {
                      var c = Object.seal({
                          x: 4
                        }),
                        d = new a(t([c]));
                      if (!d.has(c) || d.size != 1 || d.add(c) != d || d.size != 1 || d.add({
                        x: 4
                      }) != d || d.size != 2) return !1;
                      var e = d.entries(),
                        f = e.next();
                      if (f.done || f.value[0] != c || f.value[1] != c) return !1;
                      f = e.next();
                      return f.done || f.value[0] == c || f.value[0].x != 4 || f.value[1] != f.value[0] ? !1 : e.next().done;
                    } catch (g) {
                      return false;
                    }
                  }()) return a;
                  b.prototype.add = function (c) {
                    c = c === 0 ? 0 : c;
                    this.g.set(c, c);
                    this.size = this.g.size;
                    return this;
                  };
                  b.prototype.delete = function (c) {
                    c = this.g.delete(c);
                    this.size = this.g.size;
                    return c;
                  };
                  b.prototype.clear = function () {
                    this.g.clear();
                    this.size = 0;
                  };
                  b.prototype.has = function (c) {
                    return this.g.has(c);
                  };
                  b.prototype.entries = function () {
                    return this.g.entries();
                  };
                  b.prototype.values = function () {
                    return this.g.values();
                  };
                  b.prototype.keys = b.prototype.values;
                  b.prototype[Symbol.iterator] = b.prototype.values;
                  b.prototype.forEach = function (c, d) {
                    var e = this;
                    this.g.forEach(function (f) {
                      return c.call(d, f, f, e);
                    });
                  };
                  return b;
                });
                function Qa(a, b, c) {
                  a instanceof String && (a = String(a));
                  for (var d = a.length, e = 0; e < d; e++) {
                    var f = a[e];
                    if (b.call(c, f, e, a)) return {
                      gi: e,
                      v: f
                    };
                  }
                  return {
                    gi: -1,
                    v: void 0
                  };
                }
                ea("Array.prototype.findIndex", function (a) {
                  return a ? a : function (b, c) {
                    return Qa(this, b, c).gi;
                  };
                });
                function Ra(a, b) {
                  a instanceof String && (a += "");
                  var c = 0,
                    d = false,
                    e = {
                      next: function next() {
                        if (!d && c < a.length) {
                          var f = c++;
                          return {
                            value: b(f, a[f]),
                            done: false
                          };
                        }
                        d = true;
                        return {
                          done: true,
                          value: void 0
                        };
                      }
                    };
                  e[Symbol.iterator] = function () {
                    return e;
                  };
                  return e;
                }
                ea("Array.prototype.values", function (a) {
                  return a ? a : function () {
                    return Ra(this, function (b, c) {
                      return c;
                    });
                  };
                });
                ea("Array.from", function (a) {
                  return a ? a : function (b, c, d) {
                    c = c != null ? c : function (h) {
                      return h;
                    };
                    var e = [],
                      f = typeof Symbol != "undefined" && Symbol.iterator && b[Symbol.iterator];
                    if (typeof f == "function") {
                      b = f.call(b);
                      for (var g = 0; !(f = b.next()).done;) e.push(c.call(d, f.value, g++));
                    } else for (f = b.length, g = 0; g < f; g++) e.push(c.call(d, b[g], g));
                    return e;
                  };
                });
                ea("Array.prototype.keys", function (a) {
                  return a ? a : function () {
                    return Ra(this, function (b) {
                      return b;
                    });
                  };
                });
                ea("Object.is", function (a) {
                  return a ? a : function (b, c) {
                    return b === c ? b !== 0 || 1 / b === 1 / c : b !== b && c !== c;
                  };
                });
                ea("Array.prototype.includes", function (a) {
                  return a ? a : function (b, c) {
                    var d = this;
                    d instanceof String && (d = String(d));
                    var e = d.length;
                    c = c || 0;
                    for (c < 0 && (c = Math.max(c + e, 0)); c < e; c++) {
                      var f = d[c];
                      if (f === b || Object.is(f, b)) return true;
                    }
                    return false;
                  };
                });
                function Sa(a, b, c) {
                  if (a == null) throw new TypeError("The 'this' value for String.prototype." + c + " must not be null or undefined");
                  if (b instanceof RegExp) throw new TypeError("First argument to String.prototype." + c + " must not be a regular expression");
                  return a + "";
                }
                ea("String.prototype.includes", function (a) {
                  return a ? a : function (b, c) {
                    return Sa(this, b, "includes").indexOf(b, c || 0) !== -1;
                  };
                });
                ea("String.fromCodePoint", function (a) {
                  return a ? a : function (b) {
                    for (var c = "", d = 0; d < arguments.length; d++) {
                      var e = Number(arguments[d]);
                      if (e < 0 || e > 1114111 || e !== Math.floor(e)) throw new RangeError("invalid_code_point " + e);
                      e <= 65535 ? c += String.fromCharCode(e) : (e -= 65536, c += String.fromCharCode(e >>> 10 & 1023 | 55296), c += String.fromCharCode(e & 1023 | 56320));
                    }
                    return c;
                  };
                });
                ea("WeakSet", function (a) {
                  function b(c) {
                    this.g = new WeakMap();
                    if (c) {
                      c = t(c);
                      for (var d; !(d = c.next()).done;) this.add(d.value);
                    }
                  }
                  if (function () {
                    if (!a || !Object.seal) return false;
                    try {
                      var c = Object.seal({}),
                        d = Object.seal({}),
                        e = new a([c]);
                      if (!e.has(c) || e.has(d)) return !1;
                      e.delete(c);
                      e.add(d);
                      return !e.has(c) && e.has(d);
                    } catch (f) {
                      return false;
                    }
                  }()) return a;
                  b.prototype.add = function (c) {
                    this.g.set(c, true);
                    return this;
                  };
                  b.prototype.has = function (c) {
                    return this.g.has(c);
                  };
                  b.prototype.delete = function (c) {
                    return this.g.delete(c);
                  };
                  return b;
                });
                ea("Array.prototype.find", function (a) {
                  return a ? a : function (b, c) {
                    return Qa(this, b, c).v;
                  };
                });
                ea("String.prototype.startsWith", function (a) {
                  return a ? a : function (b, c) {
                    var d = Sa(this, b, "startsWith"),
                      e = d.length,
                      f = b.length;
                    c = Math.max(0, Math.min(c | 0, d.length));
                    for (var g = 0; g < f && c < e;) if (d[c++] != b[g++]) return false;
                    return g >= f;
                  };
                });
                ea("Object.entries", function (a) {
                  return a ? a : function (b) {
                    var c = [],
                      d;
                    for (d in b) Pa(b, d) && c.push([d, b[d]]);
                    return c;
                  };
                });
                var Ta = typeof Object.assign == "function" ? Object.assign : function (a, b) {
                  for (var c = 1; c < arguments.length; c++) {
                    var d = arguments[c];
                    if (d) for (var e in d) Pa(d, e) && (a[e] = d[e]);
                  }
                  return a;
                };
                ea("Object.assign", function (a) {
                  return a || Ta;
                });
                ea("Promise.prototype.finally", function (a) {
                  return a ? a : function (b) {
                    return this.then(function (c) {
                      return Promise.resolve(b()).then(function () {
                        return c;
                      });
                    }, function (c) {
                      return Promise.resolve(b()).then(function () {
                        throw c;
                      });
                    });
                  };
                });
                ea("Array.prototype.entries", function (a) {
                  return a ? a : function () {
                    return Ra(this, function (b, c) {
                      return [b, c];
                    });
                  };
                });
                ea("Number.isNaN", function (a) {
                  return a ? a : function (b) {
                    return typeof b === "number" && isNaN(b);
                  };
                });
                ea("String.prototype.repeat", function (a) {
                  return a ? a : function (b) {
                    var c = Sa(this, null, "repeat");
                    if (b < 0 || b > 1342177279) throw new RangeError("Invalid count value");
                    b |= 0;
                    for (var d = ""; b;) if (b & 1 && (d += c), b >>>= 1) c += c;
                    return d;
                  };
                });
                ea("Number.EPSILON", function () {
                  return 2.220446049250313E-16;
                });
                ea("Number.MAX_SAFE_INTEGER", function () {
                  return 9007199254740991;
                });
                ea("Number.isFinite", function (a) {
                  return a ? a : function (b) {
                    return typeof b !== "number" ? false : !isNaN(b) && b !== Infinity && b !== -Infinity;
                  };
                });
                ea("Object.values", function (a) {
                  return a ? a : function (b) {
                    var c = [],
                      d;
                    for (d in b) Pa(b, d) && c.push(b[d]);
                    return c;
                  };
                });
                ea("Math.log2", function (a) {
                  return a ? a : function (b) {
                    return Math.log(b) / Math.LN2;
                  };
                });
                ea("String.prototype.endsWith", function (a) {
                  return a ? a : function (b, c) {
                    var d = Sa(this, b, "endsWith");
                    c === void 0 && (c = d.length);
                    c = Math.max(0, Math.min(c | 0, d.length));
                    for (var e = b.length; e > 0 && c > 0;) if (d[--c] != b[--e]) return false;
                    return e <= 0;
                  };
                });
                ea("Math.trunc", function (a) {
                  return a ? a : function (b) {
                    b = Number(b);
                    if (isNaN(b) || b === Infinity || b === -Infinity || b === 0) return b;
                    var c = Math.floor(Math.abs(b));
                    return b < 0 ? -c : c;
                  };
                });
                var Ua = this || self;
                function S(a, b) {
                  a = a.split(".");
                  var c = Ua;
                  a[0] in c || typeof c.execScript == "undefined" || c.execScript("var " + a[0]);
                  for (var d; a.length && (d = a.shift());) a.length || b === void 0 ? c[d] && c[d] !== Object.prototype[d] ? c = c[d] : c = c[d] = {} : c[d] = b;
                }
                function Va(a) {
                  this.g = Math.exp(Math.log(.5) / a);
                  this.i = this.h = 0;
                }
                Va.prototype.sample = function (a, b) {
                  var c = Math.pow(this.g, a);
                  b = b * (1 - c) + c * this.h;
                  isNaN(b) || (this.h = b, this.i += a);
                };
                function Wa(a) {
                  return a.h / (1 - Math.pow(a.g, a.i));
                }
                function Xa() {
                  this.h = new Va(2);
                  this.j = new Va(5);
                  this.g = 0;
                  this.i = 128E3;
                  this.l = 16E3;
                }
                Xa.prototype.configure = function (a) {
                  this.i = a.minTotalBytes;
                  this.l = a.minBytes;
                  this.h.g = Math.exp(Math.log(.5) / a.fastHalfLife);
                  this.j.g = Math.exp(Math.log(.5) / a.slowHalfLife);
                };
                Xa.prototype.sample = function (a, b) {
                  if (!(b < this.l)) {
                    var c = 8E3 * b / a;
                    a /= 1E3;
                    this.g += b;
                    this.h.sample(a, c);
                    this.j.sample(a, c);
                  }
                };
                Xa.prototype.getBandwidthEstimate = function (a) {
                  return this.g < this.i ? a : Math.min(Wa(this.h), Wa(this.j));
                };
                function Ya() {}
                function $a() {}
                function ab() {}
                function cb(a) {
                  var b = Oa.apply(1, arguments);
                  db.has(a) || (db.add(a), ab.apply(Ya, x(b)));
                }
                function eb() {}
                function fb() {}
                function gb() {}
                var db = new Set();
                window.console && (new Map().set(1, function () {
                  return console.error.apply(console, x(Oa.apply(0, arguments)));
                }).set(2, function () {
                  return console.warn.apply(console, x(Oa.apply(0, arguments)));
                }).set(3, function () {
                  return console.info.apply(console, x(Oa.apply(0, arguments)));
                }).set(4, function () {
                  return console.log.apply(console, x(Oa.apply(0, arguments)));
                }).set(5, function () {
                  return console.debug.apply(console, x(Oa.apply(0, arguments)));
                }).set(6, function () {
                  return console.debug.apply(console, x(Oa.apply(0, arguments)));
                }), ab = function ab() {
                  return console.warn.apply(console, x(Oa.apply(0, arguments)));
                }, $a = function $a() {
                  console.error.apply(console, x(Oa.apply(0, arguments)));
                });
                function hb(a, b) {
                  return typeof a === "number" && typeof b === "number" && isNaN(a) && isNaN(b) ? true : a === b;
                }
                function jb(a, b) {
                  b = a.indexOf(b);
                  b > -1 && a.splice(b, 1);
                }
                function kb(a, b, c) {
                  c || (c = hb);
                  if (a.length != b.length) return false;
                  b = b.slice();
                  a = t(a);
                  for (var d = a.next(), e = {}; !d.done; e = {
                    ni: void 0
                  }, d = a.next()) {
                    e.ni = d.value;
                    d = b.findIndex(function (f) {
                      return function (g) {
                        return c(f.ni, g);
                      };
                    }(e));
                    if (d == -1) return false;
                    b[d] = b[b.length - 1];
                    b.pop();
                  }
                  return b.length == 0;
                }
                function lb(a, b, c) {
                  if (a === b) return true;
                  if (!a || !b) return a == b;
                  c || (c = hb);
                  if (a.length != b.length) return false;
                  for (var d = 0; d < a.length; d++) if (!c(a[d], b[d])) return false;
                  return true;
                }
                function mb() {
                  this.g = new Map();
                }
                p = mb.prototype;
                p.push = function (a, b) {
                  this.g.has(a) ? this.g.get(a).push(b) : this.g.set(a, [b]);
                };
                p.get = function (a) {
                  return this.g.has(a) ? this.g.get(a).slice() : null;
                };
                p.remove = function (a, b) {
                  if (this.g.has(a)) {
                    var c = this.g.get(a).filter(function (d) {
                      return d != b;
                    });
                    this.g.set(a, c);
                    c.length || this.g.delete(a);
                  }
                };
                p.forEach = function (a) {
                  this.g.forEach(function (b, c) {
                    a(c, b);
                  });
                };
                p.size = function () {
                  return this.g.size;
                };
                p.keys = function () {
                  return Array.from(this.g.keys());
                };
                function nb() {
                  this.g = new mb();
                }
                p = nb.prototype;
                p.release = function () {
                  this.Pa();
                  this.g = null;
                };
                p.D = function (a, b, c, d) {
                  this.g && (a = new ob(a, b, c, d), this.g.push(b, a));
                };
                p.Ba = function (a, b, c, d) {
                  function e(g) {
                    f.Ma(a, b, e);
                    c(g);
                  }
                  var f = this;
                  this.D(a, b, e, d);
                };
                p.Ma = function (a, b, c) {
                  if (this.g) {
                    var d = this.g.get(b) || [];
                    d = t(d);
                    for (var e = d.next(); !e.done; e = d.next()) e = e.value, e.target != a || c != e.listener && c || (e.Ma(), this.g.remove(b, e));
                  }
                };
                p.Pa = function () {
                  if (this.g) {
                    for (var a = [], b = t(this.g.g.values()), c = b.next(); !c.done; c = b.next()) a.push.apply(a, x(c.value));
                    a = t(a);
                    for (b = a.next(); !b.done; b = a.next()) b.value.Ma();
                    this.g.g.clear();
                  }
                };
                S("shaka.util.EventManager", nb);
                nb.prototype.removeAll = nb.prototype.Pa;
                nb.prototype.unlisten = nb.prototype.Ma;
                nb.prototype.listenOnce = nb.prototype.Ba;
                nb.prototype.listen = nb.prototype.D;
                nb.prototype.release = nb.prototype.release;
                function ob(a, b, c, d) {
                  this.target = a;
                  this.type = b;
                  this.listener = c;
                  this.g = pb(a, d);
                  this.target.addEventListener(b, c, this.g);
                }
                ob.prototype.Ma = function () {
                  this.target.removeEventListener(this.type, this.listener, this.g);
                  this.listener = this.target = null;
                  this.g = false;
                };
                function pb(a, b) {
                  if (b == void 0) return false;
                  if (typeof b == "boolean") return b;
                  var c = new Set(["passive", "capture"]);
                  Object.keys(b).filter(function (d) {
                    return !c.has(d);
                  });
                  return qb(a) ? b : b.capture || false;
                }
                function qb(a) {
                  var b = rb;
                  if (b == void 0) {
                    b = false;
                    try {
                      var c = {},
                        d = {
                          get: function get() {
                            b = !0;
                            return !1;
                          }
                        };
                      Object.defineProperty(c, "passive", d);
                      Object.defineProperty(c, "capture", d);
                      d = function d() {};
                      a.addEventListener("test", d, c);
                      a.removeEventListener("test", d, c);
                    } catch (e) {
                      b = false;
                    }
                    rb = b;
                  }
                  return b || false;
                }
                var rb = void 0;
                S("shaka.config.AutoShowText", {
                  NEVER: 0,
                  ALWAYS: 1,
                  IF_PREFERRED_TEXT_LANGUAGE: 2,
                  IF_SUBTITLES_MAY_BE_NEEDED: 3
                });
                function sb(a) {
                  this.h = a;
                  this.g = void 0;
                }
                sb.prototype.value = function () {
                  this.g === void 0 && (this.g = this.h());
                  return this.g;
                }; /*
                   @license
                   Shaka Player
                   Copyright 2025 Google LLC
                   SPDX-License-Identifier: Apache-2.0
                   */
                function tb() {
                  return ub.value();
                }
                var vb = null,
                  wb = null,
                  ub = new sb(function () {
                    var a = void 0;
                    vb && (a = vb());
                    !a && wb && (a = wb());
                    return a;
                  });
                function xb(a, b) {
                  this.g = a;
                  this.h = b;
                }
                xb.prototype.toString = function () {
                  return "v" + this.g + "." + this.h;
                };
                function yb(a, b) {
                  var c = new xb(5, 0),
                    d = zb,
                    e = d.g,
                    f = c.h - e.h;
                  ((c.g - e.g || f) > 0 ? d.i : d.h)(d.g, c, a, b);
                }
                function Ab(a, b, c, d) {
                  ab([c, "has been deprecated and will be removed in", b, ". We are currently at version", a, ". Additional information:", d].join(" "));
                }
                function Bb(a, b, c, d) {
                  $a([c, "has been deprecated and has been removed in", b, ". We are now at version", a, ". Additional information:", d].join(" "));
                }
                var zb = null; /*
                               @license
                               Copyright 2008 The Closure Library Authors
                               SPDX-License-Identifier: Apache-2.0
                               */
                var Cb = RegExp("^(?:([^:/?#.]+):)?(?://(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#(.*))?$"); /*
                                                                                                                                                   @license
                                                                                                                                                   Copyright 2006 The Closure Library Authors
                                                                                                                                                   SPDX-License-Identifier: Apache-2.0
                                                                                                                                                   */
                function Db(a) {
                  var b;
                  a instanceof Db ? (Eb(this, a.bc), this.hd = a.hd, Fb(this, a.Db), Gb(this, a.Cd), this.Sb = a.Sb, Hb(this, a.g.clone()), this.Rc = a.Rc) : a && (b = String(a).match(Cb)) ? (Eb(this, b[1] || "", true), this.hd = Ib(b[2] || ""), Fb(this, b[3] || "", true), Gb(this, b[4]), this.Sb = Ib(b[5] || "", true), Hb(this, b[6] || "", true), this.Rc = Ib(b[7] || "")) : this.g = new Jb(null);
                }
                p = Db.prototype;
                p.bc = "";
                p.hd = "";
                p.Db = "";
                p.Cd = null;
                p.Sb = "";
                p.Rc = "";
                p.toString = function () {
                  var a = [],
                    b = this.bc;
                  b && a.push(Kb(b, Lb, true), ":");
                  if (b = this.Db) {
                    a.push("//");
                    var c = this.hd;
                    c && a.push(Kb(c, Lb, true), "@");
                    a.push(encodeURIComponent(b).replace(/%25([0-9a-fA-F]{2})/g, "%$1"));
                    b = this.Cd;
                    b != null && a.push(":", String(b));
                  }
                  if (b = this.Sb) this.Db && b.charAt(0) != "/" && a.push("/"), a.push(Kb(b, b.charAt(0) == "/" ? Mb : Nb, true));
                  (b = this.g.toString()) && a.push("?", b);
                  (b = this.Rc) && a.push("#", Kb(b, Ob));
                  return a.join("");
                };
                p.resolve = function (a) {
                  var b = this.clone();
                  b.bc === "data" && (b = new Db());
                  var c = !!a.bc;
                  c ? Eb(b, a.bc) : c = !!a.hd;
                  c ? b.hd = a.hd : c = !!a.Db;
                  c ? Fb(b, a.Db) : c = a.Cd != null;
                  var d = a.Sb;
                  if (c) Gb(b, a.Cd);else if (c = !!a.Sb) {
                    if (d.charAt(0) != "/") if (this.Db && !this.Sb) d = "/" + d;else {
                      var e = b.Sb.lastIndexOf("/");
                      e != -1 && (d = b.Sb.substr(0, e + 1) + d);
                    }
                    if (d == ".." || d == ".") d = "";else if (d.indexOf("./") != -1 || d.indexOf("/.") != -1) {
                      e = d.lastIndexOf("/", 0) == 0;
                      d = d.split("/");
                      for (var f = [], g = 0; g < d.length;) {
                        var h = d[g++];
                        h == "." ? e && g == d.length && f.push("") : h == ".." ? ((f.length > 1 || f.length == 1 && f[0] != "") && f.pop(), e && g == d.length && f.push("")) : (f.push(h), e = true);
                      }
                      d = f.join("/");
                    }
                  }
                  c ? b.Sb = d : c = a.g.toString() !== "";
                  c ? Hb(b, a.g.clone()) : c = !!a.Rc;
                  c && (b.Rc = a.Rc);
                  return b;
                };
                p.clone = function () {
                  return new Db(this);
                };
                function Eb(a, b, c) {
                  a.bc = c ? Ib(b, true) : b;
                  a.bc && (a.bc = a.bc.replace(/:$/, ""));
                }
                function Fb(a, b, c) {
                  a.Db = c ? Ib(b, true) : b;
                }
                function Gb(a, b) {
                  if (b) {
                    b = Number(b);
                    if (isNaN(b) || b < 0) throw Error("Bad port number " + b);
                    a.Cd = b;
                  } else a.Cd = null;
                }
                function Hb(a, b, c) {
                  b instanceof Jb ? a.g = b : (c || (b = Kb(b, Pb)), a.g = new Jb(b));
                }
                function Ib(a, b) {
                  return a ? b ? decodeURI(a) : decodeURIComponent(a) : "";
                }
                function Kb(a, b, c) {
                  return a != null ? (a = encodeURI(a).replace(b, Qb), c && (a = a.replace(/%25([0-9a-fA-F]{2})/g, "%$1")), a) : null;
                }
                function Qb(a) {
                  a = a.charCodeAt(0);
                  return "%" + (a >> 4 & 15).toString(16) + (a & 15).toString(16);
                }
                var Lb = /[#\/\?@]/g,
                  Nb = /[#\?:]/g,
                  Mb = /[#\?]/g,
                  Pb = /[#\?@]/g,
                  Ob = /#/g;
                function Jb(a) {
                  this.g = a || null;
                }
                function Rb(a) {
                  if (!a.eb && (a.eb = new Map(), a.Sd = 0, a.g)) for (var b = a.g.split("&"), c = 0; c < b.length; c++) {
                    var d = b[c].indexOf("="),
                      e = null;
                    if (d >= 0) {
                      var f = b[c].substring(0, d);
                      e = b[c].substring(d + 1);
                    } else f = b[c];
                    f = decodeURIComponent(f);
                    e = e || "";
                    a.add(f, decodeURIComponent(e));
                  }
                }
                p = Jb.prototype;
                p.eb = null;
                p.Sd = null;
                function Sb(a) {
                  Rb(a);
                  return a.Sd;
                }
                p.add = function (a, b) {
                  Rb(this);
                  this.g = null;
                  var c = this.eb.has(a) ? this.eb.get(a) : null;
                  c || this.eb.set(a, c = []);
                  c.push(b);
                  this.Sd++;
                  return this;
                };
                p.set = function (a, b) {
                  Rb(this);
                  this.g = null;
                  this.eb.has(a) ? this.eb.set(a, [b]) : this.add(a, b);
                  return this;
                };
                p.get = function (a) {
                  Rb(this);
                  return this.eb.get(a) || [];
                };
                p.toString = function () {
                  if (this.g) return this.g;
                  if (!this.eb || !this.eb.size) return "";
                  for (var a = [], b = t(this.eb.keys()), c = b.next(); !c.done; c = b.next()) {
                    var d = c.value;
                    c = encodeURIComponent(d);
                    d = this.eb.get(d);
                    for (var e = 0; e < d.length; e++) {
                      var f = c;
                      d[e] !== "" && (f += "=" + encodeURIComponent(d[e]));
                      a.push(f);
                    }
                  }
                  return this.g = a.join("&");
                };
                p.clone = function () {
                  var a = new Jb();
                  a.g = this.g;
                  if (this.eb) {
                    for (var b = new Map(), c = t(this.eb), d = c.next(); !d.done; d = c.next()) {
                      var e = t(d.value);
                      d = e.next().value;
                      e = e.next().value;
                      b.set(d, e.concat());
                    }
                    a.eb = b;
                    a.Sd = this.Sd;
                  }
                  return a;
                };
                function Tb() {}
                function Ub(a, b) {
                  if (!a && !b) return true;
                  if (!a || !b || a.byteLength != b.byteLength) return false;
                  if ((ArrayBuffer.isView(a) ? a.buffer : a) == (ArrayBuffer.isView(b) ? b.buffer : b) && (a.byteOffset || 0) == (b.byteOffset || 0)) return true;
                  var c = Vb(a);
                  b = Vb(b);
                  for (var d = 0; d < a.byteLength; d++) if (c[d] != b[d]) return false;
                  return true;
                }
                function Wb(a) {
                  return ArrayBuffer.isView(a) ? a.byteOffset == 0 && a.byteLength == a.buffer.byteLength ? a.buffer : new Uint8Array(a).buffer : a;
                }
                function Vb(a, b, c) {
                  c = c === void 0 ? Infinity : c;
                  return Yb(a, b === void 0 ? 0 : b, c, Uint8Array);
                }
                function $b(a, b, c) {
                  c = c === void 0 ? Infinity : c;
                  return Yb(a, b === void 0 ? 0 : b, c, Uint16Array);
                }
                function ac(a, b, c) {
                  c = c === void 0 ? Infinity : c;
                  return Yb(a, b === void 0 ? 0 : b, c, DataView);
                }
                function Yb(a, b, c, d) {
                  var e = ArrayBuffer.isView(a) ? a.buffer : a,
                    f = 1;
                  "BYTES_PER_ELEMENT" in d && (f = d.BYTES_PER_ELEMENT);
                  var g = ((a.byteOffset || 0) + a.byteLength) / f;
                  a = Math.floor(Math.max(0, Math.min(((a.byteOffset || 0) + b) / f, g)));
                  return new d(e, a, Math.floor(Math.min(a + Math.max(c, 0), g)) - a);
                }
                S("shaka.util.BufferUtils", Tb);
                Tb.toDataView = ac;
                Tb.toUint16 = $b;
                Tb.toUint8 = Vb;
                Tb.toArrayBuffer = Wb;
                Tb.equal = Ub;
                function U(a, b, c) {
                  var d = Oa.apply(3, arguments);
                  this.severity = a;
                  this.category = b;
                  this.code = c;
                  this.data = d;
                  this.handled = false;
                  this.message = "Shaka Error " + this.code;
                  try {
                    throw Error(this.message || "Shaka Error");
                  } catch (e) {
                    this.stack = e.stack;
                  }
                }
                U.prototype.toString = function () {
                  return "shaka.util.Error " + JSON.stringify(this, null, "  ");
                };
                S("shaka.util.Error", U);
                U.Severity = {
                  RECOVERABLE: 1,
                  CRITICAL: 2
                };
                U.Category = {
                  NETWORK: 1,
                  TEXT: 2,
                  MEDIA: 3,
                  MANIFEST: 4,
                  STREAMING: 5,
                  DRM: 6,
                  PLAYER: 7,
                  CAST: 8,
                  STORAGE: 9,
                  ADS: 10
                };
                U.Code = {
                  UNSUPPORTED_SCHEME: 1E3,
                  BAD_HTTP_STATUS: 1001,
                  HTTP_ERROR: 1002,
                  TIMEOUT: 1003,
                  MALFORMED_DATA_URI: 1004,
                  REQUEST_FILTER_ERROR: 1006,
                  RESPONSE_FILTER_ERROR: 1007,
                  MALFORMED_TEST_URI: 1008,
                  UNEXPECTED_TEST_REQUEST: 1009,
                  ATTEMPTS_EXHAUSTED: 1010,
                  SEGMENT_MISSING: 1011,
                  INVALID_TEXT_HEADER: 2E3,
                  INVALID_TEXT_CUE: 2001,
                  UNABLE_TO_DETECT_ENCODING: 2003,
                  BAD_ENCODING: 2004,
                  INVALID_XML: 2005,
                  INVALID_MP4_TTML: 2007,
                  INVALID_MP4_VTT: 2008,
                  UNABLE_TO_EXTRACT_CUE_START_TIME: 2009,
                  INVALID_MP4_CEA: 2010,
                  TEXT_COULD_NOT_GUESS_MIME_TYPE: 2011,
                  CANNOT_ADD_EXTERNAL_TEXT_TO_SRC_EQUALS: 2012,
                  TEXT_ONLY_WEBVTT_SRC_EQUALS: 2013,
                  MISSING_TEXT_PLUGIN: 2014,
                  UNSUPPORTED_EXTERNAL_THUMBNAILS_URI: 2017,
                  BUFFER_READ_OUT_OF_BOUNDS: 3E3,
                  JS_INTEGER_OVERFLOW: 3001,
                  EBML_OVERFLOW: 3002,
                  EBML_BAD_FLOATING_POINT_SIZE: 3003,
                  MP4_SIDX_WRONG_BOX_TYPE: 3004,
                  MP4_SIDX_INVALID_TIMESCALE: 3005,
                  MP4_SIDX_TYPE_NOT_SUPPORTED: 3006,
                  WEBM_CUES_ELEMENT_MISSING: 3007,
                  WEBM_EBML_HEADER_ELEMENT_MISSING: 3008,
                  WEBM_SEGMENT_ELEMENT_MISSING: 3009,
                  WEBM_INFO_ELEMENT_MISSING: 3010,
                  WEBM_DURATION_ELEMENT_MISSING: 3011,
                  WEBM_CUE_TRACK_POSITIONS_ELEMENT_MISSING: 3012,
                  WEBM_CUE_TIME_ELEMENT_MISSING: 3013,
                  MEDIA_SOURCE_OPERATION_FAILED: 3014,
                  MEDIA_SOURCE_OPERATION_THREW: 3015,
                  VIDEO_ERROR: 3016,
                  QUOTA_EXCEEDED_ERROR: 3017,
                  TRANSMUXING_FAILED: 3018,
                  CONTENT_TRANSFORMATION_FAILED: 3019,
                  MSS_MISSING_DATA_FOR_TRANSMUXING: 3020,
                  MSS_TRANSMUXING_FAILED: 3022,
                  TRANSMUXING_NO_VIDEO_DATA: 3023,
                  STREAMING_NOT_ALLOWED: 3024,
                  UNABLE_TO_GUESS_MANIFEST_TYPE: 4E3,
                  DASH_INVALID_XML: 4001,
                  DASH_NO_SEGMENT_INFO: 4002,
                  DASH_EMPTY_ADAPTATION_SET: 4003,
                  DASH_EMPTY_PERIOD: 4004,
                  DASH_WEBM_MISSING_INIT: 4005,
                  DASH_UNSUPPORTED_CONTAINER: 4006,
                  DASH_PSSH_BAD_ENCODING: 4007,
                  DASH_NO_COMMON_KEY_SYSTEM: 4008,
                  DASH_MULTIPLE_KEY_IDS_NOT_SUPPORTED: 4009,
                  DASH_CONFLICTING_KEY_IDS: 4010,
                  RESTRICTIONS_CANNOT_BE_MET: 4012,
                  HLS_PLAYLIST_HEADER_MISSING: 4015,
                  INVALID_HLS_TAG: 4016,
                  HLS_INVALID_PLAYLIST_HIERARCHY: 4017,
                  DASH_DUPLICATE_REPRESENTATION_ID: 4018,
                  HLS_MULTIPLE_MEDIA_INIT_SECTIONS_FOUND: 4020,
                  HLS_REQUIRED_ATTRIBUTE_MISSING: 4023,
                  HLS_REQUIRED_TAG_MISSING: 4024,
                  HLS_COULD_NOT_GUESS_CODECS: 4025,
                  HLS_KEYFORMATS_NOT_SUPPORTED: 4026,
                  DASH_UNSUPPORTED_XLINK_ACTUATE: 4027,
                  DASH_XLINK_DEPTH_LIMIT: 4028,
                  CONTENT_UNSUPPORTED_BY_BROWSER: 4032,
                  CANNOT_ADD_EXTERNAL_TEXT_TO_LIVE_STREAM: 4033,
                  NO_VARIANTS: 4036,
                  PERIOD_FLATTENING_FAILED: 4037,
                  INCONSISTENT_DRM_ACROSS_PERIODS: 4038,
                  HLS_VARIABLE_NOT_FOUND: 4039,
                  HLS_MSE_ENCRYPTED_MP2T_NOT_SUPPORTED: 4040,
                  HLS_MSE_ENCRYPTED_LEGACY_APPLE_MEDIA_KEYS_NOT_SUPPORTED: 4041,
                  NO_WEB_CRYPTO_API: 4042,
                  CANNOT_ADD_EXTERNAL_THUMBNAILS_TO_LIVE_STREAM: 4045,
                  MSS_INVALID_XML: 4046,
                  MSS_LIVE_CONTENT_NOT_SUPPORTED: 4047,
                  AES_128_INVALID_IV_LENGTH: 4048,
                  AES_128_INVALID_KEY_LENGTH: 4049,
                  DASH_CONFLICTING_AES_128: 4050,
                  DASH_UNSUPPORTED_AES_128: 4051,
                  DASH_INVALID_PATCH: 4052,
                  HLS_EMPTY_MEDIA_PLAYLIST: 4053,
                  DASH_MSE_ENCRYPTED_LEGACY_APPLE_MEDIA_KEYS_NOT_SUPPORTED: 4054,
                  CANNOT_ADD_EXTERNAL_CHAPTERS_TO_LIVE_STREAM: 4055,
                  STREAMING_ENGINE_STARTUP_INVALID_STATE: 5006,
                  NO_RECOGNIZED_KEY_SYSTEMS: 6E3,
                  REQUESTED_KEY_SYSTEM_CONFIG_UNAVAILABLE: 6001,
                  FAILED_TO_CREATE_CDM: 6002,
                  FAILED_TO_ATTACH_TO_VIDEO: 6003,
                  INVALID_SERVER_CERTIFICATE: 6004,
                  FAILED_TO_CREATE_SESSION: 6005,
                  FAILED_TO_GENERATE_LICENSE_REQUEST: 6006,
                  LICENSE_REQUEST_FAILED: 6007,
                  LICENSE_RESPONSE_REJECTED: 6008,
                  ENCRYPTED_CONTENT_WITHOUT_DRM_INFO: 6010,
                  NO_LICENSE_SERVER_GIVEN: 6012,
                  OFFLINE_SESSION_REMOVED: 6013,
                  EXPIRED: 6014,
                  SERVER_CERTIFICATE_REQUIRED: 6015,
                  INIT_DATA_TRANSFORM_ERROR: 6016,
                  SERVER_CERTIFICATE_REQUEST_FAILED: 6017,
                  MIN_HDCP_VERSION_NOT_MATCH: 6018,
                  ERROR_CHECKING_HDCP_VERSION: 6019,
                  MISSING_EME_SUPPORT: 6020,
                  LOAD_INTERRUPTED: 7E3,
                  OPERATION_ABORTED: 7001,
                  NO_VIDEO_ELEMENT: 7002,
                  OBJECT_DESTROYED: 7003,
                  CONTENT_NOT_LOADED: 7004,
                  SRC_EQUALS_PRELOAD_NOT_SUPPORTED: 7005,
                  PRELOAD_DESTROYED: 7006,
                  QUEUE_INDEX_OUT_OF_BOUNDS: 7007,
                  CAST_API_UNAVAILABLE: 8E3,
                  NO_CAST_RECEIVERS: 8001,
                  ALREADY_CASTING: 8002,
                  UNEXPECTED_CAST_ERROR: 8003,
                  CAST_CANCELED_BY_USER: 8004,
                  CAST_CONNECTION_TIMED_OUT: 8005,
                  CAST_RECEIVER_APP_UNAVAILABLE: 8006,
                  STORAGE_NOT_SUPPORTED: 9E3,
                  INDEXED_DB_ERROR: 9001,
                  DEPRECATED_OPERATION_ABORTED: 9002,
                  REQUESTED_ITEM_NOT_FOUND: 9003,
                  MALFORMED_OFFLINE_URI: 9004,
                  CANNOT_STORE_LIVE_OFFLINE: 9005,
                  NO_INIT_DATA_FOR_OFFLINE: 9007,
                  LOCAL_PLAYER_INSTANCE_REQUIRED: 9008,
                  NEW_KEY_OPERATION_NOT_SUPPORTED: 9011,
                  KEY_NOT_FOUND: 9012,
                  MISSING_STORAGE_CELL: 9013,
                  STORAGE_LIMIT_REACHED: 9014,
                  DOWNLOAD_SIZE_CALLBACK_ERROR: 9015,
                  MODIFY_OPERATION_NOT_SUPPORTED: 9016,
                  INDEXED_DB_INIT_TIMED_OUT: 9017,
                  CS_IMA_SDK_MISSING: 1E4,
                  CS_AD_MANAGER_NOT_INITIALIZED: 10001,
                  SS_IMA_SDK_MISSING: 10002,
                  SS_AD_MANAGER_NOT_INITIALIZED: 10003,
                  CURRENT_DAI_REQUEST_NOT_FINISHED: 10004,
                  MT_AD_MANAGER_NOT_INITIALIZED: 10005,
                  INTERSTITIAL_AD_MANAGER_NOT_INITIALIZED: 10006,
                  VAST_INVALID_XML: 10007
                };
                function cc() {}
                function dc(a) {
                  if (!a) return "";
                  a = Vb(a);
                  a[0] == 239 && a[1] == 187 && a[2] == 191 && (a = a.subarray(3));
                  if (window.TextDecoder && !tb().rh()) return a = new TextDecoder().decode(a), a.includes("\uFFFD") && $a('Decoded string contains an "unknown character" codepoint.  That probably means the UTF8 encoding was incorrect!'), a;
                  for (var b = "", c = 0; c < a.length; ++c) {
                    var d = 65533;
                    (a[c] & 128) == 0 ? d = a[c] : a.length >= c + 2 && (a[c] & 224) == 192 && (a[c + 1] & 192) == 128 ? (d = (a[c] & 31) << 6 | a[c + 1] & 63, c += 1) : a.length >= c + 3 && (a[c] & 240) == 224 && (a[c + 1] & 192) == 128 && (a[c + 2] & 192) == 128 ? (d = (a[c] & 15) << 12 | (a[c + 1] & 63) << 6 | a[c + 2] & 63, c += 2) : a.length >= c + 4 && (a[c] & 241) == 240 && (a[c + 1] & 192) == 128 && (a[c + 2] & 192) == 128 && (a[c + 3] & 192) == 128 && (d = (a[c] & 7) << 18 | (a[c + 1] & 63) << 12 | (a[c + 2] & 63) << 6 | a[c + 3] & 63, c += 3);
                    if (d <= 65535) b += String.fromCharCode(d);else {
                      d -= 65536;
                      var e = d & 1023;
                      b += String.fromCharCode(55296 + (d >> 10));
                      b += String.fromCharCode(56320 + e);
                    }
                  }
                  return b;
                }
                function ec(a, b, c) {
                  if (!a) return "";
                  if (!c && a.byteLength % 2 != 0) throw new U(2, 2, 2004);
                  c = Math.floor(a.byteLength / 2);
                  var d = new Uint16Array(c);
                  a = ac(a);
                  for (var e = 0; e < c; e++) d[e] = a.getUint16(e * 2, b);
                  return fc(d);
                }
                function hc(a) {
                  function b(d) {
                    return c.byteLength <= d || c[d] >= 9 && c[d] <= 126;
                  }
                  if (!a) return "";
                  var c = Vb(a);
                  if (c[0] == 239 && c[1] == 187 && c[2] == 191) return dc(c);
                  if (c[0] == 254 && c[1] == 255) return ec(c.subarray(2), false);
                  if (c[0] == 255 && c[1] == 254) return ec(c.subarray(2), true);
                  if (c[0] == 0 && c[2] == 0) return ec(a, false);
                  if (c[1] == 0 && c[3] == 0) return ec(a, true);
                  if (b(0) && b(1) && b(2) && b(3)) return dc(a);
                  throw new U(2, 2, 2003);
                }
                function ic(a) {
                  if (window.TextEncoder && !tb().rh()) {
                    var b = new TextEncoder();
                    return Wb(b.encode(a));
                  }
                  a = encodeURIComponent(a);
                  a = unescape(a);
                  b = new Uint8Array(a.length);
                  for (var c = 0; c < a.length; c++) b[c] = a[c].charCodeAt(0);
                  return Wb(b);
                }
                function jc(a, b) {
                  for (var c = new ArrayBuffer(a.length * 2), d = new DataView(c), e = 0; e < a.length; ++e) d.setUint16(e * 2, a.charCodeAt(e), b);
                  return c;
                }
                function fc(a) {
                  return kc.value()(a);
                }
                function lc(a) {
                  var b = {
                      "&amp;": "&",
                      "&lt;": "<",
                      "&gt;": ">",
                      "&quot;": '"',
                      "&apos;": "'",
                      "&nbsp;": "\xA0",
                      "&lrm;": "\u200E",
                      "&rlm;": "\u200F"
                    },
                    c = /&(?:amp|lt|gt|quot|apos|nbsp|lrm|rlm|#[xX]?[0-9a-fA-F]+);/g,
                    d = RegExp(c.source);
                  return a && d.test(a) ? a.replace(c, function (e) {
                    return e[1] == "#" ? (e = e[2] == "x" || e[2] == "X" ? parseInt(e.substring(3), 16) : parseInt(e.substring(2), 10), e >= 0 && e <= 1114111 ? String.fromCodePoint(e) : "") : b[e] || "'";
                  }) : a || "";
                }
                S("shaka.util.StringUtils", cc);
                cc.resetFromCharCode = function () {
                  kc.g = void 0;
                };
                cc.toUTF16 = jc;
                cc.toUTF8 = ic;
                cc.fromBytesAutoDetect = hc;
                cc.fromUTF16 = ec;
                cc.fromUTF8 = dc;
                var kc = new sb(function () {
                  function a(c) {
                    try {
                      var d = new Uint8Array(c);
                      return String.fromCharCode.apply(null, d).length > 0;
                    } catch (e) {
                      return false;
                    }
                  }
                  for (var b = {
                    Oc: 65536
                  }; b.Oc > 0; b = {
                    Oc: b.Oc
                  }, b.Oc /= 2) if (a(b.Oc)) return function (c) {
                    return function (d) {
                      for (var e = "", f = 0; f < d.length; f += c.Oc) e += String.fromCharCode.apply(null, d.subarray(f, f + c.Oc));
                      return e;
                    };
                  }(b);
                  return null;
                });
                function mc() {}
                function nc(a) {
                  a = fc(Vb(a));
                  return btoa(a);
                }
                function oc(a, b) {
                  b = b == void 0 ? true : b;
                  a = nc(a).replace(/\+/g, "-").replace(/\//g, "_");
                  return b ? a : a.replace(/[=]*$/, "");
                }
                function pc(a) {
                  a = window.atob(a.replace(/-/g, "+").replace(/_/g, "/"));
                  for (var b = new Uint8Array(a.length), c = 0; c < a.length; ++c) b[c] = a.charCodeAt(c);
                  return b;
                }
                function qc(a) {
                  for (var b = a.length / 2, c = new Uint8Array(b), d = 0; d < b; d++) c[d] = window.parseInt(a.substr(d * 2, 2), 16);
                  return c;
                }
                function rc(a) {
                  var b = Vb(a);
                  a = "";
                  b = t(b);
                  for (var c = b.next(); !c.done; c = b.next()) c = c.value, c = c.toString(16), c.length == 1 && (c = "0" + c), a += c;
                  return a;
                }
                function tc() {
                  for (var a = Oa.apply(0, arguments), b = 0, c = 0; c < a.length; ++c) b += a[c].byteLength;
                  b = new Uint8Array(b);
                  for (var d = c = 0; d < a.length; ++d) {
                    var e = a[d];
                    ArrayBuffer.isView(e) && e.BYTES_PER_ELEMENT === 1 ? b.set(e, c) : b.set(Vb(e), c);
                    c += e.byteLength;
                  }
                  return b;
                }
                S("shaka.util.Uint8ArrayUtils", mc);
                mc.concat = tc;
                mc.toHex = rc;
                mc.fromHex = qc;
                mc.fromBase64 = pc;
                mc.toBase64 = oc;
                mc.toStandardBase64 = nc;
                function uc(a, b, c) {
                  c = c === void 0 ? "" : c;
                  if (b.length == 0) return a;
                  if (a.length == 1 && b.length == 1) {
                    var d = new Db(a[0]);
                    b = new Db(b[0]);
                    b = d.resolve(b);
                    c && Hb(b, c);
                    return [b.toString()];
                  }
                  b = b.map(function (h) {
                    return new Db(h);
                  });
                  d = [];
                  a = t(a);
                  for (var e = a.next(); !e.done; e = a.next()) {
                    e = new Db(e.value);
                    for (var f = t(b), g = f.next(); !g.done; g = f.next()) g = e.resolve(g.value), c && Hb(g, c), d.push(g.toString());
                  }
                  return d;
                }
                function vc(a, b, c, d) {
                  a = {
                    keySystem: a,
                    encryptionScheme: b,
                    licenseServerUri: "",
                    distinctiveIdentifierRequired: false,
                    persistentStateRequired: false,
                    audioRobustness: "",
                    videoRobustness: "",
                    serverCertificate: null,
                    serverCertificateUri: "",
                    sessionType: "",
                    initData: c || [],
                    keyIds: new Set()
                  };
                  d && (a.keySystemUris = new Set([d]));
                  return a;
                }
                function wc(a, b) {
                  b = b === void 0 ? "cenc" : b;
                  var c = [],
                    d = [],
                    e = [];
                  a.forEach(function (g, h) {
                    var k = h;
                    k.length != 22 && (k = oc(qc(h), false));
                    var l = g;
                    l.length != 22 && (l = oc(qc(g), false));
                    g = {
                      kty: "oct",
                      kid: k,
                      k: l
                    };
                    c.push(g);
                    d.push(g.kid);
                    e.push(h);
                  });
                  a = JSON.stringify({
                    keys: c
                  });
                  var f = JSON.stringify({
                    kids: d
                  });
                  f = [{
                    initData: Vb(ic(f)),
                    initDataType: "keyids"
                  }];
                  return {
                    keySystem: "org.w3.clearkey",
                    encryptionScheme: b,
                    licenseServerUri: "data:application/json;base64," + window.btoa(a),
                    distinctiveIdentifierRequired: false,
                    persistentStateRequired: false,
                    audioRobustness: "",
                    videoRobustness: "",
                    serverCertificate: null,
                    serverCertificateUri: "",
                    sessionType: "",
                    initData: f,
                    keyIds: new Set(e)
                  };
                }
                function xc(a, b) {
                  if (b.length == 1) return b[0];
                  a = yc(a, b);
                  if (a != null) return a;
                  throw new U(2, 4, 4025, b);
                }
                function yc(a, b) {
                  var c = zc.get(a);
                  c = t(c);
                  for (var d = c.next(); !d.done; d = c.next()) {
                    d = d.value;
                    for (var e = t(b), f = e.next(); !f.done; f = e.next()) if (f = f.value, d.test(f.trim())) return f.trim();
                  }
                  return a == Ac ? "" : null;
                }
                function Bc(a, b) {
                  var c = [];
                  a = zc.get(a);
                  a = t(a);
                  for (var d = a.next(); !d.done; d = a.next()) {
                    d = d.value;
                    for (var e = t(b), f = e.next(); !f.done; f = e.next()) f = f.value, d.test(f.trim()) && c.push(f.trim());
                  }
                  return c;
                }
                var Ac = "text",
                  Cc = {
                    Aa: "video",
                    ka: "audio",
                    Na: Ac,
                    Uf: "image",
                    ll: "application"
                  },
                  Dc = 1 / 15,
                  zc = new Map().set("audio", [/^vorbis$/, /^Opus$/, /^opus$/, /^fLaC$/, /^flac$/, /^mp4a/, /^[ae]c-3$/, /^ac-4/, /^dts[cex]$/, /^iamf/, /^mhm[12]/, /^ac3$/, /^eac3$/, /^apac$/]).set("video", [/^avc/, /^hev/, /^hvc/, /^vvc/, /^vvi/, /^vp0?[89]/, /^av01/, /^dvh/, /^dva/, /^dav/]).set("text", [/^vtt$/, /^wvtt/, /^stpp/]);
                function Ec(a, b, c, d) {
                  this.g = null;
                  this.l = a;
                  this.i = b;
                  this.m = c;
                  this.o = d;
                  this.j = false;
                  a: {
                    typeof libDPIModule === "undefined" && ab("Could not find LCEVC Library dependencies on this page");
                    if (typeof LCEVCdec !== "undefined") this.h = LCEVCdec;else if (typeof LcevcDil !== "undefined") this.h = LcevcDil, this.j = true, yb("LcevcDil", "lcevc_dil.js is deprecated, please use lcevc_dec.js instead");else {
                      ab("Could not find LCEVC Library on this page");
                      a = false;
                      break a;
                    }
                    typeof this.h.SupportObject === "undefined" ? (ab("Could not find LCEVC Library on this page"), a = false) : (this.h.SupportObject.SupportStatus || ab(this.h.SupportObject.SupportError), a = typeof this.h !== "undefined" && typeof libDPIModule !== "undefined" && this.i instanceof HTMLCanvasElement && this.h.SupportObject.SupportStatus);
                  }
                  a && !this.g && this.h.SupportObject.webGLSupport(this.i) && (this.i.classList.remove("shaka-hidden"), this.g = this.j ? new this.h.LcevcDil(this.l, this.i, this.m) : new this.h.LCEVCdec(this.l, this.i, this.m));
                }
                function Fc(a, b, c, d) {
                  d.type !== "video" || a.o && !d.baseOriginalId || a.g && a.g.appendBuffer(b, "video", d.id, -c, !a.o);
                }
                function Gc(a) {
                  a.g && a.i.classList.add("shaka-hidden");
                }
                Ec.prototype.release = function () {
                  this.g && (this.g.close(), this.g = null);
                };
                function Hc(a) {
                  return a && typeof LCEVCdec !== "undefined" ? a.codecs == "lvc1" : false;
                }
                S("shaka.lcevc.Dec", Ec);
                Ec.prototype.release = Ec.prototype.release;
                function Ic(a) {
                  if (Jc.has(a)) return Jc.get(a);
                  var b = window.ManagedMediaSource || window.MediaSource;
                  return b ? (b = b.isTypeSupported(a), Jc.set(a, b), b) : false;
                }
                function Kc() {
                  var a = window.ManagedSourceBuffer || window.SourceBuffer;
                  return !!a && !!a.prototype && !!a.prototype.changeType;
                }
                function Lc() {
                  var a = window.ManagedMediaSource || window.MediaSource;
                  return a && a.prototype ? !!a.prototype.setLiveSeekableRange && !!a.prototype.clearLiveSeekableRange : false;
                }
                var Jc = new Map();
                function Mc() {}
                Mc.prototype.extract = function () {};
                Mc.prototype.decode = function () {
                  return [];
                };
                Mc.prototype.clear = function () {};
                Mc.prototype.getStreams = function () {
                  return [];
                };
                function Nc() {}
                Nc.prototype.init = function () {};
                Nc.prototype.parse = function () {
                  return [];
                };
                function Oc() {}
                p = Oc.prototype;
                p.init = function () {};
                p.xf = function () {};
                p.Nd = function () {};
                p.remove = function () {};
                p.Vf = function () {};
                S("shaka.media.IClosedCaptionParser", Oc);
                function Pc(a) {
                  this.h = new Map();
                  this.i = 0;
                  this.j = new Nc();
                  if (a = Qc(a.toLowerCase())) this.j = a();
                  this.g = new Mc();
                  if (a = Rc) this.g = a(), this.h.set(this.i, this.g);
                }
                p = Pc.prototype;
                p.init = function (a, b, c) {
                  b = b === void 0 ? false : b;
                  c = c === void 0 ? -1 : c;
                  if (c != -1 && this.i != c) {
                    b = c;
                    var d = this.h.get(b);
                    this.h.set(this.i, this.g);
                    if (d) this.g = d;else {
                      if (d = Rc) this.g = d();
                      this.h.set(b, this.g);
                    }
                  } else b || this.Nd();
                  this.j.init(a);
                  c != -1 && (this.i = c);
                };
                p.xf = function (a) {
                  a = this.j.parse(a);
                  a = t(a);
                  for (var b = a.next(); !b.done; b = a.next()) {
                    b = b.value;
                    var c = Vb(b.packet);
                    c.length > 0 && this.g.extract(c, b.pts);
                  }
                  return this.g.decode();
                };
                p.Nd = function () {
                  this.g.clear();
                };
                p.remove = function (a) {
                  a = a === void 0 ? [] : a;
                  a = new Set(a);
                  for (var b = t(this.h.keys()), c = b.next(); !c.done; c = b.next()) if (c = c.value, !a.has(c)) {
                    var d = this.h.get(c);
                    d && d.clear();
                    this.h.delete(c);
                  }
                };
                p.Vf = function () {
                  return this.g.getStreams();
                };
                function Sc(a, b) {
                  Tc.set(a, b);
                }
                function Qc(a) {
                  return Tc.get(a);
                }
                S("shaka.media.ClosedCaptionParser", Pc);
                Pc.findDecoder = function () {
                  return Rc;
                };
                Pc.unregisterDecoder = function () {
                  Rc = null;
                };
                Pc.registerDecoder = function (a) {
                  Rc = a;
                };
                Pc.findParser = Qc;
                Pc.unregisterParser = function (a) {
                  Tc.delete(a);
                };
                Pc.registerParser = Sc;
                var Tc = new Map(),
                  Rc = null;
                function Uc() {
                  this.id = "";
                  this.regionAnchorY = this.regionAnchorX = this.viewportAnchorY = this.viewportAnchorX = 0;
                  this.height = this.width = 100;
                  this.viewportAnchorUnits = this.widthUnits = this.heightUnits = Vc;
                  this.scroll = Xc;
                }
                S("shaka.text.CueRegion", Uc);
                var Vc = 1;
                Uc.units = {
                  PX: 0,
                  PERCENTAGE: Vc,
                  LINES: 2
                };
                var Xc = "";
                Uc.scrollMode = {
                  NONE: Xc,
                  UP: "up"
                };
                function Yc(a) {
                  this.h = a || "";
                  this.g = 0;
                }
                function Zc(a) {
                  $c(a, /[ \t]+/gm);
                }
                function $c(a, b) {
                  b.lastIndex = a.g;
                  b = b.exec(a.h);
                  b = b == null ? null : {
                    position: b.index,
                    length: b[0].length,
                    results: b
                  };
                  if (a.g == a.h.length || b == null || b.position != a.g) return null;
                  a.g += b.length;
                  return b.results;
                }
                function ad(a) {
                  return a.g == a.h.length ? null : (a = $c(a, /[^ \t\n]*/gm)) ? a[0] : null;
                }
                function bd(a) {
                  a = $c(a, cd);
                  if (a == null) return null;
                  var b = Number(a[2]),
                    c = Number(a[3]);
                  return b > 59 || c > 59 ? null : (Number(a[6]) || 0) / 1E3 + c + b * 60 + (Number(a[1]) || 0) * 3600;
                }
                function ed(a) {
                  return a ? bd(new Yc(a)) : null;
                }
                var cd = /(?:(\d{1,}):)?(\d{2}):(\d{2})((\.(\d{1,3})))?/g;
                function fd() {}
                function gd(a) {
                  function b(d) {
                    switch (_typeof(d)) {
                      case "undefined":
                      case "boolean":
                      case "number":
                      case "string":
                      case "symbol":
                      case "function":
                        return d;
                      default:
                        if (!d || ArrayBuffer.isView(d)) return d;
                        if (c.has(d)) return null;
                        var e = Array.isArray(d);
                        if (d.constructor != Object && !e) return null;
                        c.add(d);
                        var f = e ? [] : {},
                          g;
                        for (g in d) f[g] = b(d[g]);
                        e && (f.length = d.length);
                        return f;
                    }
                  }
                  var c = new WeakSet();
                  return b(a);
                }
                function hd(a) {
                  var b = {},
                    c;
                  for (c in a) b[c] = a[c];
                  return b;
                }
                function id(a) {
                  if (Array.isArray(a)) {
                    for (var b = [], c = 0; c < a.length; c++) {
                      var d = c.toString(),
                        e = a[c];
                      e !== void 0 && (e = id(e)) && b.push(d + ":" + e);
                    }
                    a = "[" + b.join(",") + "]";
                  } else if (typeof a == "function") a = "";else if (a instanceof Object) {
                    c = Object.keys(a);
                    c.sort();
                    b = [];
                    c = t(c);
                    for (d = c.next(); !d.done; d = c.next()) e = d.value, d = JSON.stringify(e), e = a[e], e !== void 0 && (e = id(e)) && b.push(d + ":" + e);
                    a = "{" + b.join(",") + "}";
                  } else a = JSON.stringify(a);
                  return a;
                }
                S("shaka.util.ObjectUtils", fd);
                fd.alphabeticalKeyOrderStringify = id;
                fd.shallowCloneObject = hd;
                fd.cloneObject = gd; /*
                                     @license
                                     tXml
                                     Copyright 2015 Tobias Nickel
                                     SPDX-License-Identifier: MIT
                                     */
                function jd(a, b) {
                  var c = c === void 0 ? false : c;
                  a = hc(a);
                  return kd(a, b, c);
                }
                function kd(a, b, c) {
                  a = ld(a, c === void 0 ? false : c);
                  return !b && a.length ? a[0] : (a = a.find(function (d) {
                    return b.split(",").includes(d.tagName);
                  })) ? a : null;
                }
                function nd(a) {
                  return pd.has(a) ? pd.get(a) : "";
                }
                function ld(a, b) {
                  function c(f, g) {
                    g = g === void 0 ? false : g;
                    for (var h = []; a[e];) if (a.charCodeAt(e) == 60) {
                      if (a.charCodeAt(e + 1) === 47) {
                        g = e + 2;
                        e = a.indexOf(">", e);
                        g = a.substring(g, e);
                        var k = g.indexOf(f);
                        if (k == -1) {
                          var l = f.indexOf(".");
                          l > 0 && (k = g.indexOf(f.substring(0, l)));
                        }
                        if (k == -1) throw f = a.substring(0, e).split("\n"), Error("Unexpected close tag\nLine: " + (f.length - 1) + "\nColumn: " + (f[f.length - 1].length + 1) + "\nChar: " + a[e]);
                        e + 1 && (e += 1);
                        break;
                      } else if (a.charCodeAt(e + 1) === 33) {
                        if (a.charCodeAt(e + 2) == 45) {
                          for (; e !== -1 && (a.charCodeAt(e) !== 62 || a.charCodeAt(e - 1) != 45 || a.charCodeAt(e - 2) != 45 || e == -1);) e = a.indexOf(">", e + 1);
                          e === -1 && (e = a.length);
                        } else if (a.charCodeAt(e + 2) === 91 && a.charCodeAt(e + 8) === 91 && a.substr(e + 3, 5).toLowerCase() === "cdata") {
                          k = a.indexOf("]]\x3e", e);
                          k == -1 ? (h.push(a.substr(e + 9)), e = a.length) : (h.push(a.substring(e + 9, k)), e = k + 3);
                          continue;
                        }
                        e++;
                        continue;
                      }
                      a: {
                        l = g;
                        e++;
                        var m = d(),
                          n = {};
                        for (k = []; a.charCodeAt(e) !== 62 && a[e];) {
                          var q = a.charCodeAt(e);
                          if (q > 64 && q < 91 || q > 96 && q < 123) {
                            q = d();
                            for (var r = a.charCodeAt(e); r && r !== 39 && r !== 34 && !(r > 64 && r < 91 || r > 96 && r < 123) && r !== 62;) e++, r = a.charCodeAt(e);
                            var u = e + 1;
                            e = a.indexOf(a[e], u);
                            u = a.slice(u, e);
                            if (r === 39 || r === 34) {
                              if (e === -1) {
                                l = {
                                  tagName: m,
                                  attributes: n,
                                  children: k,
                                  parent: null
                                };
                                if (b) for (m = 0; m < k.length; m++) typeof k[m] !== "string" && (k[m].parent = l);
                                k = l;
                                break a;
                              }
                            } else u = null, e--;
                            if (q.startsWith("xmlns:")) {
                              r = u;
                              var v = q.split(":")[1];
                              pd.set(r, v);
                              qd.set(v, r);
                            }
                            m === "tt" && q === "xml:space" && u === "preserve" && (l = true);
                            n[q] = u;
                          }
                          e++;
                        }
                        a.charCodeAt(e - 1) !== 47 ? (e++, k = c(m, l)) : e++;
                        l = {
                          tagName: m,
                          attributes: n,
                          children: k,
                          parent: null
                        };
                        m = k.length;
                        for (n = 0; n < m; n++) q = k[n], typeof q !== "string" ? b && (q.parent = l) : n == m - 1 && q == "\n" && k.pop();
                        k = l;
                      }
                      h.push(k);
                      if (typeof k === "string") break;
                      k.tagName[0] === "?" && k.children && (h.push.apply(h, x(k.children)), k.children = []);
                    } else k = e, e = a.indexOf("<", e) - 1, e === -2 && (e = a.length), k = a.slice(k, e + 1), g ? k.length > 0 && h.push(k) : h.length && k.length == 1 && k[0] == "\n" ? h.push(k) : k.trim().length > 0 && h.push(k), e++;
                    return h;
                  }
                  function d() {
                    for (var f = e; "\r\n\t>/= ".indexOf(a[e]) === -1 && a[e];) e++;
                    return a.slice(f, e);
                  }
                  var e = 0;
                  return c("");
                }
                function rd(a) {
                  return typeof a === "string";
                }
                function sd(a) {
                  var b = [];
                  if (!a.children) return [];
                  a = t(a.children);
                  for (var c = a.next(); !c.done; c = a.next()) c = c.value, typeof c !== "string" && b.push(c);
                  return b;
                }
                function td(a, b) {
                  var c = [];
                  if (!a.children) return [];
                  a = t(a.children);
                  for (var d = a.next(); !d.done; d = a.next()) d = d.value, d.tagName === b && c.push(d);
                  return c;
                }
                function ud(a) {
                  if (typeof a === "string") return lc(a);
                  a = a.children.reduce(function (b, c) {
                    return typeof c === "string" ? b + c : b;
                  }, "");
                  return a === "" ? null : lc(a);
                }
                function vd(a) {
                  if (!Array.from(a.children).every(function (b) {
                    return typeof b === "string";
                  })) return null;
                  (a = ud(a)) && (a = a.trim());
                  return a;
                }
                function wd(a, b, c) {
                  c = c === void 0 ? [] : c;
                  a.tagName === b && c.push(a);
                  if (a.children) {
                    a = t(a.children);
                    for (var d = a.next(); !d.done; d = a.next()) wd(d.value, b, c);
                  }
                  return c;
                }
                function xd(a, b) {
                  a = td(a, b);
                  return a.length != 1 ? null : a[0];
                }
                function yd(a, b, c) {
                  a = zd(a, b, c);
                  return a.length != 1 ? null : a[0];
                }
                function Ad(a, b, c, d) {
                  d = d === void 0 ? null : d;
                  var e = null;
                  a = a.attributes[b];
                  a != null && (e = c(a));
                  return e == null ? d : e;
                }
                function Bd(a, b, c) {
                  b = nd(b);
                  return a.attributes[b + ":" + c] || null;
                }
                function zd(a, b, c) {
                  var d = nd(b);
                  b = [];
                  if (a.children) for (c = d ? d + ":" + c : c, a = t(a.children), d = a.next(); !d.done; d = a.next()) (d = d.value) && d.tagName === c && b.push(d);
                  return b;
                }
                function Cd(a, b, c) {
                  b = t(b);
                  for (var d = b.next(); !d.done; d = b.next()) if (d = Bd(a, d.value, c)) return d;
                  return null;
                }
                function Dd(a) {
                  if (!a) return null;
                  /^\d+-\d+-\d+T\d+:\d+:\d+(\.\d+)?$/.test(a) && (a += "Z");
                  a = Date.parse(a);
                  return isNaN(a) ? null : a / 1E3;
                }
                function Ed(a) {
                  if (!a) return null;
                  a = RegExp("^P(?:([0-9]*)Y)?(?:([0-9]*)M)?(?:([0-9]*)D)?(?:T(?:([0-9]*)H)?(?:([0-9]*)M)?(?:([0-9.]*)S)?)?$", "i").exec(a);
                  if (!a) return null;
                  a = 31536E3 * Number(a[1] || null) + 2592E3 * Number(a[2] || null) + 86400 * Number(a[3] || null) + 3600 * Number(a[4] || null) + 60 * Number(a[5] || null) + Number(a[6] || null);
                  return isFinite(a) ? a : null;
                }
                function Fd(a) {
                  var b = /([0-9]+)-([0-9]+)/.exec(a);
                  if (!b) return null;
                  a = Number(b[1]);
                  if (!isFinite(a)) return null;
                  b = Number(b[2]);
                  return isFinite(b) ? {
                    start: a,
                    end: b
                  } : null;
                }
                function Gd(a) {
                  a = Number(a);
                  return a % 1 === 0 ? a : null;
                }
                function Hd(a) {
                  a = Number(a);
                  return a % 1 === 0 && a > 0 ? a : null;
                }
                function Id(a) {
                  a = Number(a);
                  return a % 1 === 0 && a >= 0 ? a : null;
                }
                function Jd(a) {
                  a = Number(a);
                  return isNaN(a) ? null : a;
                }
                function Kd(a) {
                  return a ? a.toLowerCase() === "true" : false;
                }
                function Ld(a) {
                  var b;
                  var c = (b = a.match(/^(\d+)\/(\d+)$/)) ? Number(b[1]) / Number(b[2]) : Number(a);
                  return isNaN(c) ? null : c;
                }
                function Md(a) {
                  var b = [];
                  a = lc(a).split(/\/+(?=(?:[^'"]*['"][^'"]*['"])*[^'"]*$)/);
                  a = t(a);
                  for (var c = a.next(); !c.done; c = a.next()) {
                    c = c.value;
                    var d = c.match(/^([\w]+)/);
                    if (d) {
                      var e = c.match(/(@id='(.*?)')/),
                        f = c.match(/(@t='(\d+)')/),
                        g = c.match(/(@n='(\d+)')/),
                        h = c.match(/\[(\d+)\]/);
                      b.push({
                        name: d[0],
                        id: e ? e[0].match(/'(.*?)'/)[0].replace(/'/gm, "") : null,
                        t: f ? Number(f[0].match(/'(.*?)'/)[0].replace(/'/gm, "")) : null,
                        n: g ? Number(g[0].match(/'(.*?)'/)[0].replace(/'/gm, "")) : null,
                        position: h ? Number(h[1]) - 1 : null,
                        Cc: c.split("/@")[1] || null
                      });
                    } else c.startsWith("@") && b.length && (b[b.length - 1].Cc = c.slice(1));
                  }
                  return b;
                }
                function Nd(a, b) {
                  var c = Md(b.attributes.sel || "");
                  if (c.length) {
                    var d = c[c.length - 1],
                      e = b.attributes.pos || null;
                    c = d.position;
                    c == null && (d.t !== null && (c = Od(a, "t", d.t)), d.n !== null && (c = Od(a, "n", d.n)));
                    c === null ? c = e === "prepend" ? 0 : a.length : e === "prepend" ? --c : e === "after" && ++c;
                    e = b.tagName;
                    (d = d.Cc) && a[c] ? Pd(a[c], e, d, vd(b) || "") : (e !== "remove" && e !== "replace" || a.splice(c, 1), e !== "add" && e !== "replace" || a.splice.apply(a, [c, 0].concat(x(b.children))));
                  }
                }
                function Od(a, b, c) {
                  var d = 0;
                  a = t(a);
                  for (var e = a.next(); !e.done; e = a.next()) {
                    if (Number(e.value.attributes[b]) === c) return d;
                    d++;
                  }
                  return null;
                }
                function Pd(a, b, c, d) {
                  if (b === "remove") delete a.attributes[c];else if (b === "add" || b === "replace") a.attributes[c] = d;
                }
                function Rd(a) {
                  var b = "",
                    c = a.tagName.split(":");
                  c.length > 0 && (b = c[0], b = qd.has(b) ? qd.get(b) : "");
                  b = document.createElementNS(b, a.tagName);
                  for (var d in a.attributes) b.setAttribute(d, a.attributes[d]);
                  a = t(a.children);
                  for (d = a.next(); !d.done; d = a.next()) d = d.value, c = void 0, typeof d == "string" ? c = new Text(d) : c = Rd(d), b.appendChild(c);
                  return b;
                }
                function Sd(a) {
                  if (!a) return null;
                  var b = {
                    tagName: a.tagName,
                    attributes: hd(a.attributes),
                    children: [],
                    parent: null
                  };
                  a = t(a.children);
                  for (var c = a.next(); !c.done; c = a.next()) c = c.value, typeof c === "string" ? b.children.push(c) : (c = Sd(c), c.parent = b, b.children.push(c));
                  return b;
                }
                var pd = new Map(),
                  qd = new Map();
                function Td(a, b, c) {
                  this.startTime = a;
                  this.endTime = b;
                  this.payload = c;
                  this.region = new Uc();
                  this.position = null;
                  this.positionAlign = Ud;
                  this.size = 0;
                  this.textAlign = Vd;
                  this.direction = Wd;
                  this.writingMode = Xd;
                  this.lineInterpretation = Yd;
                  this.line = null;
                  this.lineHeight = "";
                  this.lineAlign = Zd;
                  this.displayAlign = $d;
                  this.fontSize = this.border = this.backgroundImage = this.backgroundColor = this.color = "";
                  this.fontWeight = ae;
                  this.fontStyle = be;
                  this.linePadding = this.letterSpacing = this.fontFamily = "";
                  this.opacity = 1;
                  this.textCombineUpright = "";
                  this.textDecoration = [];
                  this.textStrokeWidth = this.textStrokeColor = this.textShadow = "";
                  this.wrapLine = true;
                  this.id = "";
                  this.nestedCues = [];
                  this.lineBreak = this.isContainer = false;
                  this.rubyTag = null;
                  this.cellResolution = {
                    columns: 32,
                    rows: 15
                  };
                }
                function ce(a, b) {
                  a = new Td(a, b, "");
                  a.lineBreak = true;
                  return a;
                }
                Td.prototype.clone = function () {
                  var a = new Td(0, 0, ""),
                    b;
                  for (b in this) a[b] = this[b], Array.isArray(a[b]) && (a[b] = a[b].slice());
                  return a;
                };
                function de(a, b) {
                  if (a.payload != b.payload || !(Math.abs(a.startTime - b.startTime) < .001 && Math.abs(a.endTime - b.endTime) < .001)) return false;
                  for (var c in a) if (c != "startTime" && c != "endTime" && c != "payload") if (c == "nestedCues") {
                    if (!lb(a.nestedCues, b.nestedCues, de)) return false;
                  } else if (c == "region" || c == "cellResolution") for (var d in a[c]) {
                    if (a[c][d] != b[c][d]) return false;
                  } else if (Array.isArray(a[c])) {
                    if (!lb(a[c], b[c])) return false;
                  } else if (a[c] != b[c]) return false;
                  return true;
                }
                function ee(a, b) {
                  b = b === void 0 ? new Map() : b;
                  var c = a.payload;
                  if (c.includes("<")) {
                    b.size === 0 && fe(b);
                    var d = c;
                    c = [];
                    for (var e = -1, f = 0; f < d.length; f++) d[f] === "<" ? e = f + 1 : d[f] === ">" && e > 0 && (e = d.substr(e, f - e), e.match(ge) && c.push(e), e = -1);
                    c = t(c);
                    for (f = c.next(); !f.done; f = c.next()) f = f.value, d = d.replace("<" + f + ">", '<div time="' + f + '">'), d += "</div>";
                    a: {
                      f = d;
                      e = [];
                      var g = -1;
                      c = "";
                      d = false;
                      for (var h = 0; h < f.length; h++) if (f[h] === "/") {
                        var k = f.indexOf(">", h);
                        if (k === -1) {
                          c = f;
                          break a;
                        }
                        if ((k = f.substring(h + 1, k)) && k == "v") {
                          d = true;
                          var l = null;
                          e.length && (l = e[e.length - 1]);
                          if (l) {
                            if (l === k) c += "/" + k + ">";else {
                              if (!l.startsWith("v")) {
                                c += f[h];
                                continue;
                              }
                              c += "/" + l + ">";
                            }
                            h += k.length + 1;
                          } else c += f[h];
                        } else c += f[h];
                      } else f[h] === "<" ? (g = h + 1, f[g] != "v" && (g = -1)) : f[h] === ">" && g > 0 && (e.push(f.substr(g, h - g)), g = -1), c += f[h];
                      f = t(e);
                      for (e = f.next(); !e.done; e = f.next()) e = e.value, g = e.replace(" ", ".voice-"), c = c.replace("<" + e + ">", "<" + g + ">"), c = c.replace("</" + e + ">", "</" + g + ">"), d || (c += "</" + g + ">");
                    }
                    c = he(c);
                    a.payload = "";
                    d = "<span>" + c.replace(/\n/g, "<br />") + "</span>";
                    try {
                      var m = kd(d, "span");
                    } catch (n) {}
                    if (m) {
                      if (m = m.children, m.length != 1 || m[0].tagName) for (m = t(m), c = m.next(); !c.done; c = m.next()) ie(c.value, a, b);else a.payload = lc(c);
                    } else a.payload = lc(c);
                  } else a.payload = lc(c);
                }
                function fe(a) {
                  for (var b = t(Object.entries(je)), c = b.next(); !c.done; c = b.next()) {
                    var d = t(c.value);
                    c = d.next().value;
                    d = d.next().value;
                    var e = new Td(0, 0, "");
                    e.color = d;
                    a.set("." + c, e);
                  }
                  b = t(Object.entries(le));
                  for (c = b.next(); !c.done; c = b.next()) d = t(c.value), c = d.next().value, d = d.next().value, e = new Td(0, 0, ""), e.backgroundColor = d, a.set("." + c, e);
                }
                function he(a) {
                  var b = {
                      "< ": "",
                      " >": " &gt;"
                    },
                    c = /(< +>|<\s|\s>)/g,
                    d = RegExp(c.source);
                  return a && d.test(a) ? a.replace(c, function (e) {
                    return b[e] || "";
                  }) : a || "";
                }
                function ie(a, b, c) {
                  var d = b.clone();
                  d.nestedCues = [];
                  d.payload = "";
                  d.rubyTag = "";
                  d.line = null;
                  d.region = new Uc();
                  d.position = null;
                  d.size = 0;
                  d.textAlign = Vd;
                  if (a.tagName) for (var e = t(a.tagName.split(/(?=[ .])+/g)), f = e.next(); !f.done; f = e.next()) {
                    var g = f = f.value;
                    if (g.startsWith(".voice-")) {
                      var h = g.split("-").pop();
                      g = 'v[voice="' + h + '"]';
                      c.has(g) || (g = "v[voice=" + h + "]");
                    }
                    c.has(g) && (h = d, g = c.get(g)) && (h.backgroundColor = oe(g.backgroundColor, h.backgroundColor), h.color = oe(g.color, h.color), h.fontFamily = oe(g.fontFamily, h.fontFamily), h.fontSize = oe(g.fontSize, h.fontSize), h.textShadow = oe(g.textShadow, h.textShadow), h.fontWeight = g.fontWeight, h.fontStyle = g.fontStyle, h.opacity = g.opacity, h.rubyTag = g.rubyTag, h.textCombineUpright = g.textCombineUpright, h.wrapLine = g.wrapLine);
                    switch (f) {
                      case "br":
                        d = ce(d.startTime, d.endTime);
                        b.nestedCues.push(d);
                        return;
                      case "b":
                        d.fontWeight = pe;
                        break;
                      case "i":
                        d.fontStyle = qe;
                        break;
                      case "u":
                        d.textDecoration.push(re);
                        break;
                      case "font":
                        if (f = a.attributes.color) d.color = f;
                        break;
                      case "div":
                        f = a.attributes.time;
                        if (!f) break;
                        if (f = ed(f)) d.startTime = f;
                        break;
                      case "ruby":
                      case "rp":
                      case "rt":
                        d.rubyTag = f;
                    }
                  }
                  e = a.children;
                  if (rd(a) || e.length == 1 && rd(e[0])) for (c = ud(a).split("\n"), a = true, c = t(c), e = c.next(); !e.done; e = c.next()) e = e.value, a || (a = ce(d.startTime, d.endTime), b.nestedCues.push(a)), e.length > 0 && (a = d.clone(), a.payload = lc(e), b.nestedCues.push(a)), a = false;else for (b.nestedCues.push(d), b = t(e), a = b.next(); !a.done; a = b.next()) ie(a.value, d, c);
                }
                function oe(a, b) {
                  return a && a.length > 0 ? a : b;
                }
                S("shaka.text.Cue", Td);
                Td.parseCuePayload = ee;
                Td.equal = de;
                Td.prototype.clone = Td.prototype.clone;
                var Ud = "auto";
                Td.positionAlign = {
                  LEFT: "line-left",
                  RIGHT: "line-right",
                  CENTER: "center",
                  AUTO: Ud
                };
                var Vd = "center",
                  se = {
                    LEFT: "left",
                    RIGHT: "right",
                    CENTER: Vd,
                    START: "start",
                    END: "end"
                  };
                Td.textAlign = se;
                var $d = "after",
                  te = {
                    BEFORE: "before",
                    CENTER: "center",
                    AFTER: $d
                  };
                Td.displayAlign = te;
                var Wd = "ltr";
                Td.direction = {
                  HORIZONTAL_LEFT_TO_RIGHT: Wd,
                  HORIZONTAL_RIGHT_TO_LEFT: "rtl"
                };
                var Xd = "horizontal-tb";
                Td.writingMode = {
                  HORIZONTAL_TOP_TO_BOTTOM: Xd,
                  VERTICAL_LEFT_TO_RIGHT: "vertical-lr",
                  VERTICAL_RIGHT_TO_LEFT: "vertical-rl"
                };
                var Yd = 0;
                Td.lineInterpretation = {
                  LINE_NUMBER: Yd,
                  PERCENTAGE: 1
                };
                var Zd = "start",
                  ue = {
                    CENTER: "center",
                    START: Zd,
                    END: "end"
                  };
                Td.lineAlign = ue;
                var je = {
                  white: "white",
                  lime: "lime",
                  cyan: "cyan",
                  red: "red",
                  yellow: "yellow",
                  magenta: "magenta",
                  blue: "blue",
                  black: "black"
                };
                Td.defaultTextColor = je;
                var le = {
                  bg_white: "white",
                  bg_lime: "lime",
                  bg_cyan: "cyan",
                  bg_red: "red",
                  bg_yellow: "yellow",
                  bg_magenta: "magenta",
                  bg_blue: "blue",
                  bg_black: "black"
                };
                Td.defaultTextBackgroundColor = le;
                var ae = 400,
                  pe = 700;
                Td.fontWeight = {
                  NORMAL: ae,
                  BOLD: pe
                };
                var be = "normal",
                  qe = "italic",
                  ve = {
                    NORMAL: be,
                    ITALIC: qe,
                    OBLIQUE: "oblique"
                  };
                Td.fontStyle = ve;
                var re = "underline";
                Td.textDecoration = {
                  UNDERLINE: re,
                  LINE_THROUGH: "lineThrough",
                  OVERLINE: "overline"
                };
                var ge = /(?:(\d{1,}):)?(\d{2}):(\d{2})\.(\d{2,3})/g;
                function we() {}
                we.prototype.destroy = function () {};
                function xe(a, b, c) {
                  ye.set(a.toLowerCase().split(";")[0] + "-" + c, {
                    priority: c,
                    yf: b
                  });
                }
                function ze(a, b) {
                  for (var c = a.toLowerCase().split(";")[0], d = t([Ae, Be, Ce, De]), e = d.next(); !e.done; e = d.next()) if (e = ye.get(c + "-" + e.value)) {
                    var f = e.yf(),
                      g = f.isSupported(a, b);
                    f.destroy();
                    if (g) return e.yf;
                  }
                  return null;
                }
                S("shaka.transmuxer.TransmuxerEngine", we);
                we.findTransmuxer = ze;
                we.unregisterTransmuxer = function (a, b) {
                  ye.delete(a.toLowerCase().split(";")[0] + "-" + b);
                };
                we.registerTransmuxer = xe;
                we.prototype.destroy = we.prototype.destroy;
                var ye = new Map(),
                  De = 1,
                  Ce = 2,
                  Be = 3,
                  Ae = 4;
                we.PluginPriority = {
                  FALLBACK: De,
                  PREFERRED_SECONDARY: Ce,
                  PREFERRED: Be,
                  APPLICATION: Ae
                };
                function Ee() {}
                function Fe(a, b) {
                  var c = a;
                  b && !Ge.includes(a) && (c += '; codecs="' + b + '"');
                  return c;
                }
                function He(a, b) {
                  b && (a += '; codecs="' + b + '"');
                  return a;
                }
                function Ie(a, b, c) {
                  var d = Fe(a, b);
                  b = He(a, b);
                  ze(b) ? (a = ze(b)) ? (a = a(), c = a.convertCodecs(c, b), a.destroy()) : c = b : c = a != "video/mp2t" && c == "audio" ? d.replace("video", "audio") : d;
                  return c;
                }
                function Je(a) {
                  return a.split(";")[0].split("/")[1];
                }
                function Ke(a) {
                  var b = Le(a);
                  a = b[0].toLowerCase();
                  b = b[1].toLowerCase();
                  switch (true) {
                    case a === "mp4a" && b === "69":
                    case a === "mp4a" && b === "6b":
                    case a === "mp4a" && b === "40.34":
                      return "mp3";
                    case a === "mp4a" && b === "66":
                    case a === "mp4a" && b === "67":
                    case a === "mp4a" && b === "68":
                    case a === "mp4a" && b === "40.2":
                    case a === "mp4a" && b === "40.02":
                    case a === "mp4a" && b === "40.5":
                    case a === "mp4a" && b === "40.05":
                    case a === "mp4a" && b === "40.29":
                    case a === "mp4a" && b === "40.42":
                      return "aac";
                    case a === "mp4a" && b === "a5":
                    case a === "ac3":
                    case a === "ac-3":
                      return "ac-3";
                    case a === "mp4a" && b === "a6":
                    case a === "eac3":
                    case a === "ec-3":
                      return "ec-3";
                    case a === "ac-4":
                      return "ac-4";
                    case a === "mp4a" && b === "b2":
                      return "dtsx";
                    case a === "mp4a" && b === "a9":
                      return "dtsc";
                    case a === "vp09":
                    case a === "vp9":
                      return "vp9";
                    case a === "avc1":
                    case a === "avc3":
                      return "avc";
                    case a === "hvc1":
                    case a === "hev1":
                      return "hevc";
                    case a === "vvc1":
                    case a === "vvi1":
                      return "vvc";
                    case a === "dvh1":
                    case a === "dvhe":
                      return b && b.startsWith("05") ? "dovi-p5" : "dovi-hevc";
                    case a === "dvav":
                    case a === "dva1":
                      return "dovi-avc";
                    case a === "dav1":
                      return "dovi-av1";
                    case a === "dvc1":
                    case a === "dvi1":
                      return "dovi-vvc";
                    case a === "lvc1":
                      return "lcevc";
                  }
                  return a;
                }
                function Me(a) {
                  var b = [];
                  a = t(a.split(","));
                  for (var c = a.next(); !c.done; c = a.next()) c = Le(c.value), b.push(c[0]);
                  return b.sort().join(",");
                }
                function Ne(a) {
                  return a.split(";")[0];
                }
                function Oe(a) {
                  a = a.split(/ *; */);
                  a.shift();
                  return (a = a.find(function (b) {
                    return b.startsWith("codecs=");
                  })) ? a.split("=")[1].replace(/^"|"$/g, "") : "";
                }
                function Pe(a) {
                  return a === "application/x-mpegurl" || a === "application/vnd.apple.mpegurl";
                }
                function Le(a) {
                  a = a.split(".");
                  var b = a[0];
                  a.shift();
                  return [b, a.join(".")];
                }
                S("shaka.util.MimeUtils", Ee);
                Ee.getFullTypeWithAllCodecs = He;
                Ee.getFullType = Fe;
                new Map().set("codecs", "codecs").set("frameRate", "framerate").set("bandwidth", "bitrate").set("width", "width").set("height", "height").set("channelsCount", "channels");
                var Ge = ["audio/aac", "audio/ac3", "audio/ec3", "audio/mpeg"];
                function Qe(a) {
                  this.i = null;
                  this.l = a;
                  this.C = false;
                  this.m = this.u = 0;
                  this.o = Infinity;
                  this.h = this.g = null;
                  this.F = "";
                  this.B = function () {};
                  this.j = new Map();
                }
                function Re(a, b) {
                  Te.set(a, b);
                }
                function Ue(a) {
                  return Te.get(a);
                }
                function Ve(a) {
                  return Te.has(a) ? true : a == "application/cea-608" || a == "application/cea-708" ? !!Rc : false;
                }
                Qe.prototype.destroy = function () {
                  this.l = this.i = null;
                  this.j.clear();
                  return Promise.resolve();
                };
                function We(a, b, c, d, e) {
                  var f, g, h, k, l, m, n;
                  return P(function (q) {
                    if (q.g == 1) return F(q, Promise.resolve(), 2);
                    if (!a.i || !a.l) return q.return();
                    if (c == null || d == null) return a.i.parseInit(Vb(b)), q.return();
                    f = a.C ? c : a.u;
                    g = {
                      periodStart: a.u,
                      segmentStart: c,
                      segmentEnd: d,
                      vttOffset: f
                    };
                    h = a.i.parseMedia(Vb(b), g, e, []);
                    k = t(h);
                    for (l = k.next(); !l.done; l = k.next()) m = l.value, a.B(m, e || null, g);
                    n = h.filter(function (r) {
                      return r.startTime >= a.m && r.startTime < a.o;
                    });
                    a.l.append(n);
                    a.g == null && (a.g = Math.max(c, a.m));
                    a.h = Math.min(d, a.o);
                    G(q);
                  });
                }
                Qe.prototype.remove = function (a, b, c) {
                  c = c === void 0 ? false : c;
                  var d = this;
                  return P(function (e) {
                    if (e.g == 1) return F(e, Promise.resolve(), 2);
                    if (a >= b) return e.return();
                    c && Xe(d, a, b);
                    d.l && d.l.remove(a, b) && d.g != null && (b <= d.g || a >= d.h || (a <= d.g && b >= d.h ? d.g = d.h = null : a <= d.g && b < d.h ? d.g = b : a > d.g && b >= d.h && (d.h = a)), Ye(d));
                    G(e);
                  });
                };
                function Ze(a, b, c) {
                  a.m = b;
                  a.o = c;
                }
                function $e(a, b, c) {
                  a.F = b;
                  if (b = a.j.get(b)) b = b.filter(function (d) {
                    return d.endTime <= c;
                  }), b.length && a.l.append(b);
                }
                function af(a, b, c) {
                  b.startTime += c;
                  b.endTime += c;
                  b = t(b.nestedCues);
                  for (var d = b.next(); !d.done; d = b.next()) af(a, d.value, c);
                }
                function bf(a, b, c) {
                  var d = new Map();
                  b = t(b);
                  for (var e = b.next(); !e.done; e = b.next()) {
                    var f = e.value;
                    e = f.stream;
                    f = f.cue;
                    d.has(e) || d.set(e, []);
                    af(a, f, c);
                    f.startTime >= a.m && f.startTime < a.o && (d.get(e).push(f), e == a.F && a.l.append([f]));
                  }
                  c = t(d.keys());
                  for (b = c.next(); !b.done; b = c.next()) for (b = b.value, a.j.has(b) || a.j.set(b, []), e = t(d.get(b)), f = e.next(); !f.done; f = e.next()) f = f.value, a.j.get(b).push(f);
                  Ye(a);
                }
                function Xe(a, b, c) {
                  for (var d = t(a.j.keys()), e = d.next(); !e.done; e = d.next()) {
                    e = e.value;
                    var f = a.j.get(e);
                    f = f.filter(function (g) {
                      return g.startTime < b || g.endTime >= c;
                    });
                    a.j.set(e, f);
                  }
                }
                function Ye(a) {
                  for (var b = Infinity, c = -Infinity, d = t(a.j.values()), e = d.next(); !e.done; e = d.next()) {
                    e = t(e.value);
                    for (var f = e.next(); !f.done; f = e.next()) f = f.value, b = Math.min(b, f.startTime), c = Math.max(c, f.endTime);
                  }
                  b !== Infinity && c !== -Infinity && (a.g = a.g == null ? Math.max(b, a.m) : Math.min(a.g, Math.max(b, a.m)), a.h = Math.max(a.h, Math.min(c, a.o)));
                }
                S("shaka.text.TextEngine", Qe);
                Qe.prototype.destroy = Qe.prototype.destroy;
                Qe.findParser = Ue;
                Qe.unregisterParser = function (a) {
                  Te.delete(a);
                };
                Qe.registerParser = Re;
                var Te = new Map();
                function cf(a) {
                  this.h = a;
                  this.g = null;
                }
                cf.prototype.ia = function (a) {
                  var b = this;
                  this.stop();
                  var c = true,
                    d = null;
                  this.g = function () {
                    window.clearTimeout(d);
                    c = false;
                  };
                  d = window.setTimeout(function () {
                    c && b.h();
                  }, a * 1E3);
                  return this;
                };
                cf.prototype.stop = function () {
                  this.g && (this.g(), this.g = null);
                };
                function df(a) {
                  this.h = a;
                  this.g = null;
                }
                df.prototype.Jb = function () {
                  this.stop();
                  this.h();
                  return this;
                };
                df.prototype.ia = function (a) {
                  var b = this;
                  this.stop();
                  this.g = new cf(function () {
                    b.h();
                  }).ia(a);
                  return this;
                };
                df.prototype.Ea = function (a) {
                  var b = this;
                  this.stop();
                  this.g = new cf(function () {
                    b.g.ia(a);
                    b.h();
                  }).ia(a);
                  return this;
                };
                df.prototype.stop = function () {
                  this.g && (this.g.stop(), this.g = null);
                };
                S("shaka.util.Timer", df);
                df.prototype.stop = df.prototype.stop;
                df.prototype.tickEvery = df.prototype.Ea;
                df.prototype.tickAfter = df.prototype.ia;
                df.prototype.tickNow = df.prototype.Jb;
                function ef(a, b) {
                  return a.concat(b);
                }
                function ff() {}
                function gf(a) {
                  return a != null;
                }
                function hf(a, b) {
                  return Promise.race([b, new Promise(function (c, d) {
                    new df(d).ia(a);
                  })]);
                }
                function jf() {}
                function kf(a, b) {
                  a = lf(a);
                  b = lf(b);
                  return a.split("-")[0] == b.split("-")[0];
                }
                function mf(a, b) {
                  a = lf(a);
                  b = lf(b);
                  a = a.split("-");
                  b = b.split("-");
                  return a[0] == b[0] && a.length == 1 && b.length == 2;
                }
                function nf(a, b) {
                  a = lf(a);
                  b = lf(b);
                  a = a.split("-");
                  b = b.split("-");
                  return a.length == 2 && b.length == 2 && a[0] == b[0];
                }
                function lf(a) {
                  a = t(a.split("-x-"));
                  var b = a.next().value;
                  b = b === void 0 ? "" : b;
                  a = a.next().value;
                  a = a === void 0 ? "" : a;
                  var c = t(b.split("-"));
                  b = c.next().value;
                  b = b === void 0 ? "" : b;
                  c = c.next().value;
                  c = c === void 0 ? "" : c;
                  a = a ? "x-" + a : "";
                  b = b.toLowerCase();
                  b = of.get(b) || b;
                  c = c.toUpperCase();
                  return (c ? b + "-" + c : b) + (a ? "-" + a : "");
                }
                function pf(a, b) {
                  a = lf(a);
                  b = lf(b);
                  return b == a ? 4 : mf(b, a) ? 3 : nf(b, a) ? 2 : mf(a, b) ? 1 : 0;
                }
                function qf(a) {
                  var b = a.indexOf("-");
                  a = b >= 0 ? a.substring(0, b) : a;
                  a = a.toLowerCase();
                  return a = of.get(a) || a;
                }
                function rf(a) {
                  return a.language ? lf(a.language) : a.audio && a.audio.language ? lf(a.audio.language) : a.video && a.video.language ? lf(a.video.language) : "und";
                }
                function sf(a, b) {
                  a = lf(a);
                  var c = new Set();
                  b = t(b);
                  for (var d = b.next(); !d.done; d = b.next()) c.add(lf(d.value));
                  b = t(c);
                  for (d = b.next(); !d.done; d = b.next()) if (d = d.value, d == a) return d;
                  b = t(c);
                  for (d = b.next(); !d.done; d = b.next()) if (d = d.value, mf(d, a)) return d;
                  b = t(c);
                  for (d = b.next(); !d.done; d = b.next()) if (d = d.value, nf(d, a)) return d;
                  c = t(c);
                  for (b = c.next(); !b.done; b = c.next()) if (b = b.value, mf(a, b)) return b;
                  return null;
                }
                S("shaka.util.LanguageUtils", jf);
                jf.findClosestLocale = sf;
                jf.getLocaleForVariant = rf;
                jf.getLocaleForText = function (a) {
                  return lf(a.language || "und");
                };
                jf.getBase = qf;
                jf.relatedness = pf;
                jf.areSiblings = function (a, b) {
                  var c = qf(a),
                    d = qf(b);
                  return a != c && b != d && c == d;
                };
                jf.normalize = lf;
                jf.isSiblingOf = nf;
                jf.isParentOf = mf;
                jf.areLanguageCompatible = kf;
                jf.areLocaleCompatible = function (a, b) {
                  a = lf(a);
                  b = lf(b);
                  return a == b;
                };
                var of = new Map([["aar", "aa"], ["abk", "ab"], ["afr", "af"], ["aka", "ak"], ["alb", "sq"], ["amh", "am"], ["ara", "ar"], ["arg", "an"], ["arm", "hy"], ["asm", "as"], ["ava", "av"], ["ave", "ae"], ["aym", "ay"], ["aze", "az"], ["bak", "ba"], ["bam", "bm"], ["baq", "eu"], ["bel", "be"], ["ben", "bn"], ["bih", "bh"], ["bis", "bi"], ["bod", "bo"], ["bos", "bs"], ["bre", "br"], ["bul", "bg"], ["bur", "my"], ["cat", "ca"], ["ces", "cs"], ["cha", "ch"], ["che", "ce"], ["chi", "zh"], ["chu", "cu"], ["chv", "cv"], ["cor", "kw"], ["cos", "co"], ["cre", "cr"], ["cym", "cy"], ["cze", "cs"], ["dan", "da"], ["deu", "de"], ["div", "dv"], ["dut", "nl"], ["dzo", "dz"], ["ell", "el"], ["eng", "en"], ["epo", "eo"], ["est", "et"], ["eus", "eu"], ["ewe", "ee"], ["fao", "fo"], ["fas", "fa"], ["fij", "fj"], ["fin", "fi"], ["fra", "fr"], ["fre", "fr"], ["fry", "fy"], ["ful", "ff"], ["geo", "ka"], ["ger", "de"], ["gla", "gd"], ["gle", "ga"], ["glg", "gl"], ["glv", "gv"], ["gre", "el"], ["grn", "gn"], ["guj", "gu"], ["hat", "ht"], ["hau", "ha"], ["heb", "he"], ["her", "hz"], ["hin", "hi"], ["hmo", "ho"], ["hrv", "hr"], ["hun", "hu"], ["hye", "hy"], ["ibo", "ig"], ["ice", "is"], ["ido", "io"], ["iii", "ii"], ["iku", "iu"], ["ile", "ie"], ["ina", "ia"], ["ind", "id"], ["ipk", "ik"], ["isl", "is"], ["ita", "it"], ["jav", "jv"], ["jpn", "ja"], ["kal", "kl"], ["kan", "kn"], ["kas", "ks"], ["kat", "ka"], ["kau", "kr"], ["kaz", "kk"], ["khm", "km"], ["kik", "ki"], ["kin", "rw"], ["kir", "ky"], ["kom", "kv"], ["kon", "kg"], ["kor", "ko"], ["kua", "kj"], ["kur", "ku"], ["lao", "lo"], ["lat", "la"], ["lav", "lv"], ["lim", "li"], ["lin", "ln"], ["lit", "lt"], ["ltz", "lb"], ["lub", "lu"], ["lug", "lg"], ["mac", "mk"], ["mah", "mh"], ["mal", "ml"], ["mao", "mi"], ["mar", "mr"], ["may", "ms"], ["mkd", "mk"], ["mlg", "mg"], ["mlt", "mt"], ["mon", "mn"], ["mri", "mi"], ["msa", "ms"], ["mya", "my"], ["nau", "na"], ["nav", "nv"], ["nbl", "nr"], ["nde", "nd"], ["ndo", "ng"], ["nep", "ne"], ["nld", "nl"], ["nno", "nn"], ["nob", "nb"], ["nor", "no"], ["nya", "ny"], ["oci", "oc"], ["oji", "oj"], ["ori", "or"], ["orm", "om"], ["oss", "os"], ["pan", "pa"], ["per", "fa"], ["pli", "pi"], ["pol", "pl"], ["por", "pt"], ["pus", "ps"], ["que", "qu"], ["roh", "rm"], ["ron", "ro"], ["rum", "ro"], ["run", "rn"], ["rus", "ru"], ["sag", "sg"], ["san", "sa"], ["sin", "si"], ["slk", "sk"], ["slo", "sk"], ["slv", "sl"], ["sme", "se"], ["smo", "sm"], ["sna", "sn"], ["snd", "sd"], ["som", "so"], ["sot", "st"], ["spa", "es"], ["sqi", "sq"], ["srd", "sc"], ["srp", "sr"], ["ssw", "ss"], ["sun", "su"], ["swa", "sw"], ["swe", "sv"], ["tah", "ty"], ["tam", "ta"], ["tat", "tt"], ["tel", "te"], ["tgk", "tg"], ["tgl", "tl"], ["tha", "th"], ["tib", "bo"], ["tir", "ti"], ["ton", "to"], ["tsn", "tn"], ["tso", "ts"], ["tuk", "tk"], ["tur", "tr"], ["twi", "tw"], ["uig", "ug"], ["ukr", "uk"], ["urd", "ur"], ["uzb", "uz"], ["ven", "ve"], ["vie", "vi"], ["vol", "vo"], ["wel", "cy"], ["wln", "wa"], ["wol", "wo"], ["xho", "xh"], ["yid", "yi"], ["yor", "yo"], ["zha", "za"], ["zho", "zh"], ["zul", "zu"]]);
                function tf() {}
                function uf(a, b, c, d, e) {
                  function f(z) {
                    var y = String(z.width || "") + String(z.height || "") + String(Math.round(z.frameRate || 0)) + (z.hdr || "") + z.fastSwitching;
                    z.dependencyStream && (y += z.dependencyStream.baseOriginalId || "");
                    z.roles && (y += z.roles.sort().join("_"));
                    return y;
                  }
                  function g(z) {
                    var y = z.language + (z.channelsCount || 0) + (z.audioSamplingRate || 0) + z.roles.join(",") + z.label + z.groupId + z.fastSwitching;
                    z.dependencyStream && (y += z.dependencyStream.baseOriginalId || "");
                    return y;
                  }
                  if (e.length) {
                    var h = a.textStreams;
                    e = t(e);
                    for (var k = e.next(), l = {}; !k.done; l = {
                      Bh: void 0
                    }, k = e.next()) if (l.Bh = k.value, k = h.filter(function (z) {
                      return function (y) {
                        return y.codecs.startsWith(z.Bh) || y.mimeType.startsWith(z.Bh) ? true : false;
                      };
                    }(l)), k.length) {
                      h = k;
                      break;
                    }
                    a.textStreams = h;
                  }
                  h = a.variants;
                  if (b.length || c.length) h = vf(h, b, c);
                  if (d.length) {
                    b = new mb();
                    c = t(h);
                    for (h = c.next(); !h.done; h = c.next()) h = h.value, b.push(String(h.video.width || 0), h);
                    var m = [];
                    b.forEach(function (z, y) {
                      z = 0;
                      var B = [];
                      y = t(y);
                      for (var D = y.next(), I = {}; !D.done; I = {
                        Tf: void 0
                      }, D = y.next()) I.Tf = D.value, D = d.filter(function (C) {
                        return function (A) {
                          return C.Tf.decodingInfos[0][A];
                        };
                      }(I)).length, D > z ? (z = D, B = [I.Tf]) : D == z && B.push(I.Tf);
                      m.push.apply(m, x(B));
                    });
                    h = m;
                  }
                  c = new Set();
                  b = new Set();
                  h = t(h);
                  for (e = h.next(); !e.done; e = h.next()) e = e.value, e.audio && c.add(e.audio), e.video && b.add(e.video);
                  h = Array.from(c).sort(function (z, y) {
                    return z.bandwidth - y.bandwidth;
                  });
                  var n = [];
                  c = new Map();
                  h = t(h);
                  for (e = h.next(); !e.done; e = h.next()) {
                    e = e.value;
                    k = g(e);
                    l = c.get(k) || [];
                    if (l.length) {
                      var q = l[l.length - 1],
                        r = Ke(q.codecs),
                        u = Ke(e.codecs);
                      r != u || e.bandwidth && q.bandwidth && !(e.bandwidth > q.bandwidth) || (l.push(e), n.push(e.id));
                    } else l.push(e), n.push(e.id);
                    c.set(k, l);
                  }
                  var v = {
                    vp8: 1,
                    avc: 1,
                    "dovi-avc": .95,
                    vp9: .9,
                    vp09: .9,
                    hevc: .85,
                    "dovi-hevc": .8,
                    "dovi-p5": .75,
                    av01: .7,
                    "dovi-av1": .65,
                    vvc: .6
                  };
                  h = Array.from(b).sort(function (z, y) {
                    if (!z.bandwidth || !y.bandwidth || z.bandwidth == y.bandwidth) {
                      if (z.codecs && y.codecs && z.codecs != y.codecs && z.width == y.width) {
                        var B = Ke(z.codecs),
                          D = Ke(y.codecs);
                        if (B != D) return (v[B] || 1) - (v[D] || 1);
                      }
                      return z.width - y.width;
                    }
                    return z.bandwidth - y.bandwidth;
                  });
                  b = Kc();
                  var w = [];
                  c = new Map();
                  h = t(h);
                  for (e = h.next(); !e.done; e = h.next()) {
                    e = e.value;
                    k = f(e);
                    l = c.get(k) || [];
                    if (l.length) {
                      q = l[l.length - 1];
                      if (!b && (r = Ke(q.codecs), u = Ke(e.codecs), r !== u)) continue;
                      r = Ke(q.codecs);
                      u = Ke(e.codecs);
                      r != u || e.bandwidth && q.bandwidth && !(e.bandwidth > q.bandwidth) || (l.push(e), w.push(e.id));
                    } else l.push(e), w.push(e.id);
                    c.set(k, l);
                  }
                  a.variants = a.variants.filter(function (z) {
                    var y = z.audio;
                    z = z.video;
                    return y && !n.includes(y.id) || z && !w.includes(z.id) ? false : true;
                  });
                }
                function vf(a, b, c) {
                  b = t(b);
                  for (var d = b.next(), e = {}; !d.done; e = {
                    videoCodec: void 0
                  }, d = b.next()) if (e.videoCodec = d.value, d = a.filter(function (f) {
                    return function (g) {
                      return g.video && g.video.codecs.startsWith(f.videoCodec);
                    };
                  }(e)), d.length) {
                    a = d;
                    break;
                  }
                  c = t(c);
                  b = c.next();
                  for (d = {}; !b.done; d = {
                    audioCodec: void 0
                  }, b = c.next()) if (d.audioCodec = b.value, b = a.filter(function (f) {
                    return function (g) {
                      return g.audio && g.audio.codecs.startsWith(f.audioCodec);
                    };
                  }(d)), b.length) {
                    a = b;
                    break;
                  }
                  return a;
                }
                function wf(a, b, c) {
                  a.variants = a.variants.filter(function (d) {
                    return xf(d, b, c);
                  });
                }
                function xf(a, b, c) {
                  function d(h, k, l) {
                    return h >= k && h <= l;
                  }
                  var e = a.video;
                  if (e && e.width && e.height) {
                    var f = e.width,
                      g = e.height;
                    g > f && (g = t([g, f]), f = g.next().value, g = g.next().value);
                    if (!d(f, b.minWidth, Math.min(b.maxWidth, c.width)) || !d(g, b.minHeight, Math.min(b.maxHeight, c.height)) || !d(e.width * e.height, b.minPixels, b.maxPixels)) return false;
                  }
                  return a && a.video && a.video.frameRate && !d(a.video.frameRate, b.minFrameRate, b.maxFrameRate) || a && a.audio && a.audio.channelsCount && !d(a.audio.channelsCount, b.minChannelsCount, b.maxChannelsCount) || !d(a.bandwidth, b.minBandwidth, b.maxBandwidth) ? false : true;
                }
                function yf(a, b, c, d) {
                  c = c === void 0 ? [] : c;
                  d = d === void 0 ? {} : d;
                  return P(function (e) {
                    if (e.g == 1) return F(e, zf(a, b, b.offlineSessionIds.length > 0, c, d), 2);
                    Af(b);
                    return F(e, Bf(b), 0);
                  });
                }
                function zf(a, b, c, d, e) {
                  var f, g;
                  return P(function (h) {
                    if (h.g == 1) return tb().Vi() && Cf(b.variants), F(h, Df(b.variants, c, false, d), 2);
                    f = null;
                    a && (g = a.g) && (f = g.keySystem);
                    b.variants = b.variants.filter(function (k) {
                      var l = Ef(k, f, e);
                      if (!l) {
                        var m = [];
                        k.audio && m.push(Ff(k.audio));
                        k.video && m.push(Ff(k.video));
                      }
                      return l;
                    });
                    G(h);
                  });
                }
                function Cf(a) {
                  var b = new Map().set("dvav", "avc3").set("dva1", "avc1").set("dvhe", "hev1").set("dvh1", "hvc1").set("dvc1", "vvc1").set("dvi1", "vvi1"),
                    c = new Set();
                  a = t(a);
                  for (var d = a.next(); !d.done; d = a.next()) d = d.value, d.video && c.add(d.video);
                  c = t(c);
                  for (a = c.next(); !a.done; a = c.next()) {
                    a = a.value;
                    d = t(b);
                    for (var e = d.next(); !e.done; e = d.next()) {
                      var f = t(e.value);
                      e = f.next().value;
                      f = f.next().value;
                      if (a.codecs.includes(e)) {
                        a.codecs = a.codecs.replace(e, f);
                        break;
                      }
                    }
                  }
                }
                function Ef(a, b, c) {
                  if (!a.decodingInfos.some(function (k) {
                    return !k.supported || b && (k = k.keySystemAccess) && (c[k.keySystem] || k.keySystem) != b ? false : true;
                  })) return false;
                  var d = tb(),
                    e = d.Nb() === "Xbox";
                  d = d.Ua() === "MOBILE" && d.Ha() === "GECKO";
                  var f = a.video,
                    g = f && f.width || 0,
                    h = f && f.height || 0;
                  if (e && f && (g > 1920 || h > 1080) && (f.codecs.includes("avc1.") || f.codecs.includes("avc3.")) || (e = f && f.dependencyStream) && !Hc(e)) return false;
                  a = a.audio;
                  return d && a && a.encrypted && a.codecs.toLowerCase().includes("opus") || a && a.dependencyStream ? false : true;
                }
                function Gf(a, b) {
                  var c, d, e, f, g, h, k;
                  return P(function (l) {
                    if (l.g == 1) {
                      c = function c(m, n) {
                        if (m) {
                          var q = hd(m);
                          q.supported = m.supported && n.supported;
                          q.powerEfficient = m.powerEfficient && n.powerEfficient;
                          q.smooth = m.smooth && n.smooth;
                          n.keySystemAccess && !q.keySystemAccess && (q.keySystemAccess = n.keySystemAccess);
                          return q;
                        }
                        return n;
                      };
                      d = null;
                      e = [];
                      f = t(b);
                      g = f.next();
                      for (h = {}; !g.done; h = {
                        cache: void 0,
                        Pe: void 0
                      }, g = f.next()) k = g.value, h.Pe = id(k), h.cache = Hf, h.cache.has(h.Pe) ? d = c(d, h.cache.get(h.Pe)) : e.push(If(k).then(function (m) {
                        return function (n) {
                          var q = null;
                          n = t(n || []);
                          for (var r = n.next(); !r.done; r = n.next()) q = c(q, r.value);
                          q && (m.cache.set(m.Pe, q), d = c(d, q));
                        };
                      }(h)));
                      return F(l, Promise.all(e), 2);
                    }
                    d && a.decodingInfos.push(d);
                    G(l);
                  });
                }
                function If(a) {
                  var b = [""];
                  a.video && (b = Oe(a.video.contentType).split(","));
                  var c = [""];
                  a.audio && (c = Oe(a.audio.contentType).split(","));
                  var d = [];
                  b = t(b);
                  for (var e = b.next(); !e.done; e = b.next()) {
                    e = e.value;
                    for (var f = t(c), g = f.next(), h = {}; !g.done; h = {
                      Qc: void 0
                    }, g = f.next()) g = g.value, h.Qc = gd(a), a.video && (h.Qc.video.contentType = Fe(Ne(h.Qc.video.contentType), e)), a.audio && (h.Qc.audio.contentType = Fe(Ne(h.Qc.audio.contentType), g)), d.push(new Promise(function (k) {
                      return function (l, m) {
                        (tb().Ua() == "MOBILE" ? hf(5, navigator.mediaCapabilities.decodingInfo(k.Qc)) : navigator.mediaCapabilities.decodingInfo(k.Qc)).then(function (n) {
                          l(n);
                        }).catch(m);
                      };
                    }(h)));
                  }
                  return Promise.all(d).catch(function () {
                    JSON.stringify(a);
                    return null;
                  });
                }
                function Df(a, b, c, d) {
                  var f, g, h, k, l, m, n, q, r, u, v, w, z, y, B, D, I, C;
                  return P(function (A) {
                    switch (A.g) {
                      case 1:
                        if (a.some(function (E) {
                          return E.decodingInfos.length;
                        })) return A.return();
                        f = t(d);
                        g = f.next();
                        h = {};
                      case 2:
                        if (g.done) {
                          A.A(4);
                          break;
                        }
                        h.Di = g.value;
                        k = false;
                        l = t(a);
                        m = l.next();
                      case 5:
                        if (m.done) {
                          A.A(7);
                          break;
                        }
                        n = m.value;
                        q = Jf(n, b, c).filter(function (E) {
                          return function (J) {
                            J = J[0];
                            return (J.keySystemConfiguration && J.keySystemConfiguration.keySystem) === E.Di;
                          };
                        }(h));
                        r = t(q);
                        u = r.next();
                      case 8:
                        if (u.done) {
                          A.A(10);
                          break;
                        }
                        v = u.value;
                        return F(A, Gf(n, v), 9);
                      case 9:
                        u = r.next();
                        A.A(8);
                        break;
                      case 10:
                        n.decodingInfos.some(function (E) {
                          return E.supported;
                        }) && (k = true);
                        m = l.next();
                        A.A(5);
                        break;
                      case 7:
                        if (k) return A.return();
                        h = {
                          Di: void 0
                        };
                        g = f.next();
                        A.A(2);
                        break;
                      case 4:
                        w = t(a), z = w.next();
                      case 12:
                        if (z.done) {
                          A.A(0);
                          break;
                        }
                        y = z.value;
                        B = Jf(y, b, c).filter(function (E) {
                          E = E[0];
                          E = E.keySystemConfiguration && E.keySystemConfiguration.keySystem;
                          return !E || !d.includes(E);
                        });
                        D = t(B);
                        I = D.next();
                      case 15:
                        if (I.done) {
                          z = w.next();
                          A.A(12);
                          break;
                        }
                        C = I.value;
                        return F(A, Gf(y, C), 16);
                      case 16:
                        I = D.next(), A.A(15);
                    }
                  });
                }
                function Jf(a, b, c) {
                  var d = a.audio,
                    e = a.video,
                    f = [],
                    g = [];
                  if (e) for (var h = t(e.fullMimeTypes), k = h.next(); !k.done; k = h.next()) {
                    k = k.value;
                    var l = Oe(k);
                    if (l.includes(",") && !d) {
                      var m = l.split(","),
                        n = Ne(k);
                      l = xc("video", m);
                      m = xc("audio", m);
                      m = Kf(m, n);
                      n = Ie(n, m, "audio");
                      g.push({
                        contentType: n,
                        channels: 2,
                        bitrate: a.bandwidth || 1,
                        samplerate: 1,
                        spatialRendering: false
                      });
                    }
                    l = Lf(l);
                    k = {
                      contentType: Ie(Ne(k), l, "video"),
                      width: e.width || 64,
                      height: e.height || 64,
                      bitrate: e.bandwidth || a.bandwidth || 1,
                      framerate: e.frameRate || 30
                    };
                    if (e.hdr) switch (e.hdr) {
                      case "PQ":
                        k.transferFunction = "pq";
                        break;
                      case "HLG":
                        k.transferFunction = "hlg";
                    }
                    e.colorGamut && (k.colorGamut = e.colorGamut);
                    f.push(k);
                  }
                  if (d) for (h = t(d.fullMimeTypes), k = h.next(); !k.done; k = h.next()) l = k.value, k = Ne(l), l = Kf(Oe(l), k), k = Ie(k, l, "audio"), g.push({
                    contentType: k,
                    channels: d.channelsCount || 2,
                    bitrate: d.bandwidth || a.bandwidth || 1,
                    samplerate: d.audioSamplingRate || 1,
                    spatialRendering: d.spatialAudio
                  });
                  h = [];
                  f.length == 0 && f.push(null);
                  g.length == 0 && g.push(null);
                  f = t(f);
                  for (k = f.next(); !k.done; k = f.next()) for (k = k.value, l = t(g), n = l.next(); !n.done; n = l.next()) n = n.value, m = {
                    type: c ? "file" : "media-source"
                  }, k && (m.video = k), n && (m.audio = n), h.push(m);
                  g = (a.video ? a.video.drmInfos : []).concat(a.audio ? a.audio.drmInfos : []);
                  if (!g.length) return [h];
                  a = [];
                  c = new Map();
                  g = t(g);
                  for (f = g.next(); !f.done; f = g.next()) f = f.value, c.get(f.keySystem) || c.set(f.keySystem, []), c.get(f.keySystem).push(f);
                  g = b ? "required" : "optional";
                  b = b ? ["persistent-license"] : ["temporary"];
                  f = t(c.keys());
                  for (k = f.next(); !k.done; k = f.next()) {
                    k = k.value;
                    n = c.get(k);
                    l = new Map();
                    n = t(n);
                    for (m = n.next(); !m.done; m = n.next()) {
                      m = m.value;
                      var q = m.videoRobustness + "," + m.audioRobustness;
                      l.get(q) || l.set(q, []);
                      l.get(q).push(m);
                    }
                    l = t(l.values());
                    for (n = l.next(); !n.done; n = l.next()) {
                      n = n.value;
                      m = [];
                      q = t(h);
                      for (var r = q.next(); !r.done; r = q.next()) {
                        r = Object.assign({}, r.value);
                        for (var u = {
                            keySystem: k,
                            initDataType: "cenc",
                            persistentState: g,
                            distinctiveIdentifier: "optional",
                            sessionTypes: b
                          }, v = t(n), w = v.next(); !w.done; w = v.next()) {
                          w = w.value;
                          if (w.initData && w.initData.length) {
                            for (var z = new Set(), y = t(w.initData), B = y.next(); !B.done; B = y.next()) z.add(B.value.initDataType);
                            u.initDataType = w.initData[0].initDataType;
                          }
                          w.distinctiveIdentifierRequired && (u.distinctiveIdentifier = "required");
                          w.persistentStateRequired && (u.persistentState = "required");
                          w.sessionType && (u.sessionTypes = [w.sessionType]);
                          d && (u.audio ? (w.encryptionScheme && (u.audio.encryptionScheme = u.audio.encryptionScheme || w.encryptionScheme), u.audio.robustness = u.audio.robustness || w.audioRobustness) : (u.audio = {
                            robustness: w.audioRobustness
                          }, w.encryptionScheme && (u.audio.encryptionScheme = w.encryptionScheme)), u.audio.robustness == "" && delete u.audio.robustness);
                          e && (u.video ? (w.encryptionScheme && (u.video.encryptionScheme = u.video.encryptionScheme || w.encryptionScheme), u.video.robustness = u.video.robustness || w.videoRobustness) : (u.video = {
                            robustness: w.videoRobustness
                          }, w.encryptionScheme && (u.video.encryptionScheme = w.encryptionScheme)), u.video.robustness == "" && delete u.video.robustness);
                        }
                        r.keySystemConfiguration = u;
                        m.push(r);
                      }
                      a.push(m);
                    }
                  }
                  return a;
                }
                function Kf(a, b) {
                  var c = tb();
                  return a.toLowerCase() == "flac" ? c.Ha() != "WEBKIT" ? "flac" : "fLaC" : a.toLowerCase() === "opus" ? c.Ha() != "WEBKIT" ? "opus" : Je(b) == "mp4" ? "Opus" : "opus" : a.toLowerCase() == "ac-3" && c.oe() ? "ec-3" : a;
                }
                function Lf(a) {
                  if (a.includes("avc1")) {
                    var b = a.split(".");
                    if (b.length == 3) return a = b.shift() + ".", a += parseInt(b.shift(), 10).toString(16), a += ("000" + parseInt(b.shift(), 10).toString(16)).slice(-4);
                  } else if (a == "vp9") return "vp09.00.41.08";
                  return a;
                }
                function Af(a) {
                  a.textStreams = a.textStreams.filter(function (b) {
                    b = Fe(b.mimeType, b.codecs);
                    return Ve(b);
                  });
                }
                function Bf(a) {
                  var b, c, d, e, f, g, h;
                  return P(function (l) {
                    switch (l.g) {
                      case 1:
                        b = [], c = t(a.imageStreams), d = c.next();
                      case 2:
                        if (d.done) {
                          l.A(4);
                          break;
                        }
                        e = d.value;
                        f = e.mimeType;
                        f == "application/mp4" && e.codecs == "mjpg" && (f = "image/jpg");
                        if (Mf.has(f)) {
                          l.A(5);
                          break;
                        }
                        g = Nf.get(f);
                        if (!g) {
                          Mf.set(f, false);
                          l.A(5);
                          break;
                        }
                        return F(l, Of(g), 7);
                      case 7:
                        h = l.h, Mf.set(f, h);
                      case 5:
                        Mf.get(f) && b.push(e);
                        d = c.next();
                        l.A(2);
                        break;
                      case 4:
                        a.imageStreams = b, G(l);
                    }
                  });
                }
                function Of(a) {
                  return new Promise(function (b) {
                    var c = new Image();
                    c.src = a;
                    "decode" in c ? c.decode().then(function () {
                      b(true);
                    }).catch(function () {
                      b(false);
                    }) : c.onload = c.onerror = function () {
                      b(c.height === 2);
                    };
                  });
                }
                function Pf(a) {
                  var b = a.audio,
                    c = a.video,
                    d = b ? b.mimeType : null,
                    e = c ? c.mimeType : null,
                    f = b ? b.codecs : null,
                    g = c ? c.codecs : null,
                    h = b ? b.groupId : null,
                    k = [];
                  c && k.push(c.mimeType);
                  b && k.push(b.mimeType);
                  k = k[0] || null;
                  var l = [];
                  b && l.push(b.kind);
                  c && l.push(c.kind);
                  l = l[0] || null;
                  var m = new Set();
                  if (b) for (var n = t(b.roles), q = n.next(); !q.done; q = n.next()) m.add(q.value);
                  if (c) for (n = t(c.roles), q = n.next(); !q.done; q = n.next()) m.add(q.value);
                  a = {
                    id: a.id,
                    active: false,
                    type: "variant",
                    bandwidth: a.bandwidth,
                    language: a.language,
                    label: null,
                    videoLabel: null,
                    kind: l,
                    width: null,
                    height: null,
                    frameRate: null,
                    pixelAspectRatio: null,
                    hdr: null,
                    colorGamut: null,
                    videoLayout: null,
                    mimeType: k,
                    audioMimeType: d,
                    videoMimeType: e,
                    codecs: "",
                    audioCodec: f,
                    videoCodec: g,
                    primary: a.primary,
                    roles: Array.from(m),
                    audioRoles: null,
                    videoRoles: null,
                    forced: false,
                    videoId: null,
                    audioId: null,
                    audioGroupId: h,
                    channelsCount: null,
                    audioSamplingRate: null,
                    spatialAudio: false,
                    tilesLayout: null,
                    audioBandwidth: null,
                    videoBandwidth: null,
                    originalVideoId: null,
                    originalAudioId: null,
                    originalTextId: null,
                    originalImageId: null,
                    accessibilityPurpose: null,
                    originalLanguage: null
                  };
                  if (c) {
                    a.videoId = c.id;
                    a.originalVideoId = c.originalId;
                    a.width = c.width || null;
                    a.height = c.height || null;
                    a.frameRate = c.frameRate || null;
                    a.pixelAspectRatio = c.pixelAspectRatio || null;
                    a.videoBandwidth = c.bandwidth || null;
                    a.hdr = c.hdr || null;
                    a.colorGamut = c.colorGamut || null;
                    a.videoLayout = c.videoLayout || null;
                    a.videoRoles = c.roles;
                    a.videoLabel = c.label;
                    if (d = c.dependencyStream) a.width = d.width || a.width, a.height = d.height || a.height, a.videoCodec = d.codecs || a.videoCodec, a.videoBandwidth && d.bandwidth && (a.videoBandwidth += d.bandwidth);
                    if (g.includes(",")) {
                      a.channelsCount = c.channelsCount;
                      a.audioSamplingRate = c.audioSamplingRate;
                      a.spatialAudio = c.spatialAudio;
                      a.originalLanguage = c.originalLanguage;
                      a.audioMimeType = e;
                      e = g.split(",");
                      try {
                        a.videoCodec = xc("video", e), a.audioCodec = xc("audio", e);
                      } catch (r) {}
                    }
                  }
                  b && (a.audioId = b.id, a.originalAudioId = b.originalId, a.channelsCount = b.channelsCount, a.audioSamplingRate = b.audioSamplingRate, a.audioBandwidth = b.bandwidth || null, a.spatialAudio = b.spatialAudio, a.label = b.label, a.audioRoles = b.roles, a.accessibilityPurpose = b.accessibilityPurpose, a.originalLanguage = b.originalLanguage, e = b.dependencyStream) && (a.audioCodec = e.codecs || a.audioCodec, a.audioBandwidth && e.bandwidth && (a.audioBandwidth += e.bandwidth));
                  c && !a.videoBandwidth && (b ? a.audioBandwidth && (a.videoBandwidth = a.bandwidth - a.audioBandwidth) : a.videoBandwidth = a.bandwidth);
                  b && !a.audioBandwidth && (c ? a.videoBandwidth && (a.audioBandwidth = a.bandwidth - a.videoBandwidth) : a.audioBandwidth = a.bandwidth);
                  b = [];
                  a.videoCodec && b.push(a.videoCodec);
                  a.audioCodec && b.push(a.audioCodec);
                  a.codecs = b.join(", ");
                  return a;
                }
                function Qf(a) {
                  return {
                    id: a.id,
                    active: false,
                    type: Ac,
                    bandwidth: a.bandwidth || 0,
                    language: a.language,
                    label: a.label,
                    kind: a.kind || null,
                    mimeType: a.mimeType,
                    codecs: a.codecs || null,
                    primary: a.primary,
                    roles: a.roles,
                    accessibilityPurpose: a.accessibilityPurpose,
                    forced: a.forced,
                    originalTextId: a.originalId,
                    originalLanguage: a.originalLanguage
                  };
                }
                function Rf(a) {
                  var b = a.width || null,
                    c = a.height || null,
                    d = null;
                  a.segmentIndex && (d = Uf(a.segmentIndex));
                  var e = a.tilesLayout;
                  d && (e = d.tilesLayout || e);
                  e && b != null && (b /= Number(e.split("x")[0]));
                  e && c != null && (c /= Number(e.split("x")[1]));
                  return {
                    id: a.id,
                    type: "image",
                    bandwidth: a.bandwidth || 0,
                    width: b,
                    height: c,
                    mimeType: a.mimeType,
                    codecs: a.codecs || null,
                    tilesLayout: e || null,
                    originalImageId: a.originalId
                  };
                }
                function Vf(a) {
                  a.__shaka_id || (a.__shaka_id = Wf++);
                  return a.__shaka_id;
                }
                function Xf(a) {
                  var b = {
                    id: Vf(a),
                    active: a.mode != "disabled",
                    type: Ac,
                    bandwidth: 0,
                    language: lf(a.language || "und"),
                    label: a.label,
                    kind: a.kind,
                    mimeType: null,
                    codecs: null,
                    primary: false,
                    roles: [],
                    accessibilityPurpose: null,
                    forced: a.kind == "forced",
                    originalTextId: a.id,
                    originalLanguage: a.language
                  };
                  a.kind == "captions" && (b.mimeType = "unknown");
                  a.kind == "subtitles" && (b.mimeType = "text/vtt");
                  a.kind && (b.roles = [a.kind]);
                  return b;
                }
                function Yf(a, b) {
                  var c = a ? a.language : null;
                  c = {
                    id: Vf(a || b),
                    active: a ? a.enabled : b.selected,
                    type: "variant",
                    bandwidth: 0,
                    language: lf(c || "und"),
                    label: a ? a.label : null,
                    videoLabel: null,
                    kind: a ? a.kind : null,
                    width: null,
                    height: null,
                    frameRate: null,
                    pixelAspectRatio: null,
                    hdr: null,
                    colorGamut: null,
                    videoLayout: null,
                    mimeType: null,
                    audioMimeType: null,
                    videoMimeType: null,
                    codecs: null,
                    audioCodec: null,
                    videoCodec: null,
                    primary: a ? a.kind == "main" : false,
                    roles: [],
                    forced: false,
                    audioRoles: null,
                    videoRoles: null,
                    videoId: null,
                    audioId: null,
                    audioGroupId: null,
                    channelsCount: null,
                    audioSamplingRate: null,
                    spatialAudio: false,
                    tilesLayout: null,
                    audioBandwidth: null,
                    videoBandwidth: null,
                    originalVideoId: b ? b.id : null,
                    originalAudioId: a ? a.id : null,
                    originalTextId: null,
                    originalImageId: null,
                    accessibilityPurpose: null,
                    originalLanguage: c
                  };
                  a && a.kind && (c.roles = [a.kind], c.audioRoles = [a.kind]);
                  a && a.configuration && (a.configuration.codec && (c.audioCodec = a.configuration.codec, c.codecs = c.audioCodec), a.configuration.bitrate && (c.audioBandwidth = a.configuration.bitrate, c.bandwidth += c.audioBandwidth), a.configuration.sampleRate && (c.audioSamplingRate = a.configuration.sampleRate), a.configuration.numberOfChannels && (c.channelsCount = a.configuration.numberOfChannels));
                  if (b && b.configuration && (b.configuration.codec && (c.videoCodec = b.configuration.codec, c.codecs = c.codecs ? c.codecs + ("," + c.videoCodec) : c.videoCodec), b.configuration.bitrate && (c.videoBandwidth = b.configuration.bitrate, c.bandwidth += c.videoBandwidth), b.configuration.framerate && (c.frameRate = b.configuration.framerate), b.configuration.width && (c.width = b.configuration.width), b.configuration.height && (c.height = b.configuration.height), b.configuration.colorSpace && b.configuration.colorSpace.transfer)) switch (b.configuration.colorSpace.transfer) {
                    case "pq":
                      c.hdr = "PQ";
                      break;
                    case "hlg":
                      c.hdr = "HLG";
                      break;
                    case "bt709":
                      c.hdr = "SDR";
                  }
                  return c;
                }
                function Zf(a) {
                  return a.allowedByApplication && a.allowedByKeySystem && a.disabledUntilTime == 0;
                }
                function dg(a) {
                  return a.filter(function (b) {
                    return Zf(b);
                  });
                }
                function eg(a, b, c, d) {
                  var e = a,
                    f = a.filter(function (k) {
                      return k.primary;
                    });
                  f.length && (e = f);
                  var g = e.length ? e[0].language : "";
                  e = e.filter(function (k) {
                    return k.language == g;
                  });
                  if (b) {
                    var h = sf(lf(b), a.map(function (k) {
                      return k.language;
                    }));
                    h && (e = a.filter(function (k) {
                      return lf(k.language) == h;
                    }));
                  }
                  e = e.filter(function (k) {
                    return k.forced == d;
                  });
                  if (c) {
                    if (a = fg(e, c), a.length) return a;
                  } else if (a = e.filter(function (k) {
                    return k.roles.length == 0;
                  }), a.length) return a;
                  a = e.map(function (k) {
                    return k.roles;
                  }).reduce(ef, []);
                  return a.length ? fg(e, a[0]) : e;
                }
                function fg(a, b) {
                  return a.filter(function (c) {
                    return c.roles.includes(b);
                  });
                }
                function gg(a) {
                  var b = [];
                  a.audio && b.push(a.audio);
                  a.video && b.push(a.video);
                  return b;
                }
                function hg(a, b) {
                  b.length && (b = b.filter(function (c) {
                    return Ke(a.codecs) == Ke(c.codecs);
                  }).sort(function (c, d) {
                    return c.bandwidth && d.bandwidth && c.bandwidth != d.bandwidth ? c.bandwidth - d.bandwidth : (c.width || 0) - (d.width || 0);
                  }), a.trickModeVideo = b[0], b.length > 1 && (b = b.find(function (c) {
                    return a.width == c.width && a.height == c.height;
                  }))) && (a.trickModeVideo = b);
                }
                function Ff(a) {
                  return a.type == "audio" ? "type=audio codecs=" + a.codecs + " bandwidth=" + a.bandwidth + " channelsCount=" + a.channelsCount + " audioSamplingRate=" + a.audioSamplingRate : a.type == "video" ? "type=video codecs=" + a.codecs + " bandwidth=" + a.bandwidth + " frameRate=" + a.frameRate + " width=" + a.width + " height=" + a.height : "unexpected stream type";
                }
                function ig(a, b, c) {
                  if (c.autoShowText == 0) return false;
                  if (c.autoShowText == 1) return true;
                  var d = lf(c.preferredTextLanguage);
                  b = lf(b.language);
                  if (c.autoShowText == 2) return kf(b, d);
                  if (c.autoShowText == 3) {
                    if (!a) return false;
                    a = lf(a.language);
                    return kf(b, d) && !kf(a, b);
                  }
                  ab("Invalid autoShowText setting!");
                  return false;
                }
                function jg(a) {
                  var b = {
                    id: 0,
                    language: "und",
                    disabledUntilTime: 0,
                    primary: false,
                    audio: null,
                    video: null,
                    bandwidth: 100,
                    allowedByApplication: true,
                    allowedByKeySystem: true,
                    decodingInfos: []
                  };
                  a = t(a);
                  for (var c = a.next(); !c.done; c = a.next()) {
                    c = c.value;
                    var d = {
                      id: 0,
                      originalId: null,
                      groupId: null,
                      createSegmentIndex: function createSegmentIndex() {
                        return Promise.resolve();
                      },
                      segmentIndex: null,
                      mimeType: c ? Ne(c) : "",
                      codecs: c ? Oe(c) : "",
                      encrypted: true,
                      drmInfos: [],
                      keyIds: new Set(),
                      language: "und",
                      originalLanguage: null,
                      label: null,
                      type: "video",
                      primary: false,
                      trickModeVideo: null,
                      dependencyStream: null,
                      emsgSchemeIdUris: null,
                      roles: [],
                      forced: false,
                      channelsCount: null,
                      audioSamplingRate: null,
                      spatialAudio: false,
                      closedCaptions: null,
                      accessibilityPurpose: null,
                      external: false,
                      fastSwitching: false,
                      fullMimeTypes: new Set(),
                      isAudioMuxedInVideo: false,
                      baseOriginalId: null
                    };
                    d.fullMimeTypes.add(Fe(d.mimeType, d.codecs));
                    c.startsWith("audio/") ? (d.type = "audio", b.audio = d) : b.video = d;
                  }
                  return b;
                }
                S("shaka.util.StreamUtils", tf);
                tf.meetsRestrictions = xf;
                var Hf = new Map(),
                  Wf = 0,
                  Mf = new Map().set("image/svg+xml", true).set("image/png", true).set("image/jpeg", true).set("image/jpg", true),
                  Nf = new Map().set("image/webp", "data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA").set("image/avif", "data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A=");
                function kg() {
                  var a = this;
                  this.H = null;
                  this.B = false;
                  this.u = new Xa();
                  this.j = new nb();
                  navigator.connection && navigator.connection.addEventListener && this.j.D(navigator.connection, "change", function () {
                    if (a.B && a.g.useNetworkInformation) {
                      a.u = new Xa();
                      a.g && a.u.configure(a.g.advanced);
                      var b = a.chooseVariant();
                      b && navigator.onLine && a.H(b, a.g.clearBufferSwitch, a.g.safeMarginSwitch);
                    }
                  });
                  this.l = [];
                  this.I = 1;
                  this.J = false;
                  this.h = this.o = this.g = this.C = null;
                  this.m = new df(function () {
                    if (a.B && (a.g.restrictToElementSize || a.g.restrictToScreenSize)) {
                      var b = a.chooseVariant();
                      b && a.H(b, a.g.clearBufferSwitch, a.g.safeMarginSwitch);
                    }
                  });
                  this.F = window;
                  "documentPictureInPicture" in window && this.j.D(window.documentPictureInPicture, "enter", function () {
                    a.F = window.documentPictureInPicture.window;
                    a.m && a.m.Jb();
                    a.j.Ba(a.F, "pagehide", function () {
                      a.F = window;
                      a.m && a.m.Jb();
                    });
                  });
                  this.G = this.i = null;
                }
                p = kg.prototype;
                p.stop = function () {
                  this.H = null;
                  this.B = false;
                  this.l = [];
                  this.I = 1;
                  this.o = this.C = null;
                  this.h && (this.h.disconnect(), this.h = null);
                  this.m && this.m.stop();
                  this.G = this.i = null;
                };
                p.release = function () {
                  this.stop();
                  this.j.release();
                  this.m = null;
                };
                p.init = function (a) {
                  this.H = a;
                };
                p.chooseVariant = function (a) {
                  a = a === void 0 ? false : a;
                  var b = Infinity,
                    c = Infinity;
                  this.g.restrictToScreenSize && (c = this.g.ignoreDevicePixelRatio ? 1 : this.F.devicePixelRatio, b = this.F.screen.height * c, c *= this.F.screen.width);
                  if (this.h && this.g.restrictToElementSize) {
                    var d = this.g.ignoreDevicePixelRatio ? 1 : this.F.devicePixelRatio,
                      e = this.o.clientHeight,
                      f = this.o.clientWidth;
                    this.i && document.pictureInPictureElement && document.pictureInPictureElement == this.o && (e = this.i.height, f = this.i.width);
                    b = Math.min(b, e * d);
                    c = Math.min(c, f * d);
                  }
                  e = this.l.filter(function (l) {
                    return l && !(l.audio && l.audio.fastSwitching || l.video && l.video.fastSwitching);
                  });
                  e.length || (e = this.l);
                  d = e;
                  a && e.length != this.l.length && (d = this.l.filter(function (l) {
                    return l && (l.audio && l.audio.fastSwitching || l.video && l.video.fastSwitching ? true : false);
                  }));
                  a = lg(this, this.g.restrictions, d, Infinity, Infinity);
                  if (b != Infinity || c != Infinity) {
                    a = mg(a);
                    a = t(a);
                    for (e = a.next(); !e.done; e = a.next()) if (e = e.value, e.height >= b && e.width >= c) {
                      b = e.height;
                      c = e.width;
                      break;
                    }
                    a = lg(this, this.g.restrictions, d, b, c);
                  }
                  b = this.getBandwidthEstimate();
                  d.length && !a.length && (a = lg(this, null, d, Infinity, Infinity), a = [a[0]]);
                  c = a[0] || null;
                  for (d = 0; d < a.length; d++) {
                    e = a[d];
                    var g = isNaN(this.I) ? 1 : Math.abs(this.I);
                    f = g * e.bandwidth / this.g.bandwidthDowngradeTarget;
                    for (var h = {
                        bandwidth: Infinity
                      }, k = d + 1; k < a.length; k++) if (e.bandwidth != a[k].bandwidth) {
                      h = a[k];
                      break;
                    }
                    g = g * h.bandwidth / this.g.bandwidthUpgradeTarget;
                    c && e && b >= f && b <= g && (c.bandwidth != e.bandwidth || c.bandwidth == e.bandwidth && c.video && e.video && (c.video.width < e.video.width || c.video.height < e.video.height)) && (c = e);
                  }
                  this.C = Date.now();
                  return c;
                };
                p.enable = function () {
                  this.B = true;
                  this.l.length && this.trySuggestStreams();
                };
                p.disable = function () {
                  this.B = false;
                };
                p.segmentDownloaded = function (a, b, c, d) {
                  var e = a;
                  this.g.removeLatencyFromFirstPacketTime && d && d.packetNumber === 1 && d.timeToFirstByte && (e = a - d.timeToFirstByte);
                  e >= this.g.cacheLoadThreshold && this.u.sample(e, b);
                  c && this.C != null && this.B && ng(this);
                };
                p.trySuggestStreams = function () {
                  this.B && (this.C = Date.now(), ng(this, true));
                };
                p.getBandwidthEstimate = function () {
                  var a = this.g.defaultBandwidthEstimate;
                  navigator.connection && navigator.connection.downlink && this.g.useNetworkInformation && (a = navigator.connection.downlink * 1E6);
                  if (navigator.connection && navigator.connection.downlink && this.g.useNetworkInformation && this.g.preferNetworkInformationBandwidth) return a;
                  a = this.u.getBandwidthEstimate(a);
                  return this.G ? this.G.getBandwidthEstimate(a) : a;
                };
                p.setVariants = function (a) {
                  if (kb(a, this.l)) return false;
                  this.l = a;
                  return true;
                };
                p.playbackRateChanged = function (a) {
                  this.I = a;
                };
                p.setMediaElement = function (a) {
                  function b() {
                    c.m.ia(og);
                  }
                  var c = this;
                  this.o = a;
                  this.h && (this.h.disconnect(), this.h = null);
                  this.o && "ResizeObserver" in window && (this.h = new ResizeObserver(b), this.h.observe(this.o));
                  this.j.D(a, "enterpictureinpicture", function (d) {
                    d.pictureInPictureWindow && (c.i = d.pictureInPictureWindow, c.j.D(c.i, "resize", b));
                  });
                  this.j.D(a, "leavepictureinpicture", function () {
                    c.i && c.j.Ma(c.i, "resize", b);
                    c.i = null;
                  });
                };
                p.setCmsdManager = function (a) {
                  this.G = a;
                };
                p.configure = function (a) {
                  this.g = a;
                  this.u && this.g && this.u.configure(this.g.advanced);
                };
                function ng(a, b) {
                  if (b === void 0 || !b) {
                    if (!a.J) {
                      b = a.u;
                      if (!(b.g >= b.i)) return;
                      a.J = true;
                      a.C -= (a.g.switchInterval - a.g.minTimeToSwitch) * 1E3;
                    }
                    if (Date.now() - a.C < a.g.switchInterval * 1E3) return;
                  }
                  b = a.chooseVariant();
                  a.getBandwidthEstimate();
                  b && a.H(b, a.g.clearBufferSwitch, a.g.safeMarginSwitch);
                }
                function lg(a, b, c, d, e) {
                  if (a.G) {
                    var f = a.G.bi();
                    f && (c = c.filter(function (g) {
                      return g.bandwidth && f ? g.bandwidth <= f : true;
                    }));
                  }
                  b && (c = c.filter(function (g) {
                    return xf(g, b, {
                      width: e,
                      height: d
                    });
                  }));
                  return c.sort(function (g, h) {
                    return g.bandwidth - h.bandwidth;
                  });
                }
                function mg(a) {
                  var b = [];
                  a = t(a);
                  for (var c = a.next(); !c.done; c = a.next()) (c = c.value) && (c = c.video) && c.height && c.width && b.push({
                    height: c.height,
                    width: c.width
                  });
                  return b.sort(function (d, e) {
                    return d.width - e.width;
                  });
                }
                S("shaka.abr.SimpleAbrManager", kg);
                kg.prototype.configure = kg.prototype.configure;
                kg.prototype.setCmsdManager = kg.prototype.setCmsdManager;
                kg.prototype.setMediaElement = kg.prototype.setMediaElement;
                kg.prototype.playbackRateChanged = kg.prototype.playbackRateChanged;
                kg.prototype.setVariants = kg.prototype.setVariants;
                kg.prototype.getBandwidthEstimate = kg.prototype.getBandwidthEstimate;
                kg.prototype.trySuggestStreams = kg.prototype.trySuggestStreams;
                kg.prototype.segmentDownloaded = kg.prototype.segmentDownloaded;
                kg.prototype.disable = kg.prototype.disable;
                kg.prototype.enable = kg.prototype.enable;
                kg.prototype.chooseVariant = kg.prototype.chooseVariant;
                kg.prototype.init = kg.prototype.init;
                kg.prototype.release = kg.prototype.release;
                kg.prototype.stop = kg.prototype.stop;
                var og = 1;
                function pg(a, b) {
                  if (a === b || !a.length || !b.length) return true;
                  a = t(a);
                  for (var c = a.next(); !c.done; c = a.next()) {
                    c = c.value;
                    if (qg(c)) return true;
                    for (var d = t(b), e = d.next(); !e.done; e = d.next()) if (e = e.value, c.keySystem === e.keySystem || qg(e)) return true;
                  }
                  return false;
                }
                function rg(a, b) {
                  if (!a.length) return b;
                  if (!b.length) return a;
                  var c = [];
                  a = t(a);
                  for (var d = a.next(); !d.done; d = a.next()) {
                    d = d.value;
                    for (var e = t(b), f = e.next(); !f.done; f = e.next()) if (f = f.value, d.keySystem == f.keySystem) {
                      e = new Map();
                      for (var g = t((d.initData || []).concat(f.initData || [])), h = g.next(); !h.done; h = g.next()) h = h.value, e.set(h.keyId, h);
                      e = Array.from(e.values());
                      g = d.keyIds && f.keyIds ? new Set([].concat(x(d.keyIds), x(f.keyIds))) : d.keyIds || f.keyIds;
                      c.push({
                        keySystem: d.keySystem,
                        licenseServerUri: d.licenseServerUri || f.licenseServerUri,
                        distinctiveIdentifierRequired: d.distinctiveIdentifierRequired || f.distinctiveIdentifierRequired,
                        persistentStateRequired: d.persistentStateRequired || f.persistentStateRequired,
                        videoRobustness: d.videoRobustness || f.videoRobustness,
                        audioRobustness: d.audioRobustness || f.audioRobustness,
                        serverCertificate: d.serverCertificate || f.serverCertificate,
                        serverCertificateUri: d.serverCertificateUri || f.serverCertificateUri,
                        initData: e,
                        keyIds: g
                      });
                      break;
                    } else qg(d) ? c.push(d) : qg(f) && c.push(f);
                  }
                  return c;
                }
                function sg(a) {
                  return a ? !!a.match(/^com\.(microsoft|chromecast)\.playready/) : false;
                }
                function tg(a) {
                  return a ? !!a.match(/^com\.apple\.fps/) : false;
                }
                function qg(a) {
                  return (a = a.licenseServerUri) ? a.startsWith("data:application/json;base64,") : false;
                }
                var ug = new sb(function () {
                    return Wb(new Uint8Array([0]));
                  }),
                  vg = new Map();
                function wg(a, b) {
                  var c = xg();
                  this.l = a.maxAttempts == null ? c.maxAttempts : a.maxAttempts;
                  this.j = a.baseDelay == null ? c.baseDelay : a.baseDelay;
                  this.o = a.fuzzFactor == null ? c.fuzzFactor : a.fuzzFactor;
                  this.m = a.backoffFactor == null ? c.backoffFactor : a.backoffFactor;
                  this.g = 0;
                  this.h = this.j;
                  if (this.i = b === void 0 ? false : b) this.g = 1;
                }
                function yg(a) {
                  var b, c;
                  return P(function (d) {
                    if (d.g == 1) {
                      if (a.g >= a.l) if (a.i) a.g = 1, a.h = a.j;else throw new U(2, 7, 1010);
                      b = a.g;
                      a.g++;
                      if (b == 0) return d.return();
                      c = a.h * (1 + (Math.random() * 2 - 1) * a.o);
                      return F(d, new Promise(function (e) {
                        new df(e).ia(c / 1E3);
                      }), 2);
                    }
                    a.h *= a.m;
                    G(d);
                  });
                }
                function xg() {
                  return {
                    maxAttempts: 2,
                    baseDelay: 1E3,
                    backoffFactor: 2,
                    fuzzFactor: .5,
                    timeout: 3E4,
                    stallTimeout: 5E3,
                    connectionTimeout: 1E4
                  };
                }
                function zg() {
                  var a,
                    b,
                    c = new Promise(function (d, e) {
                      a = d;
                      b = e;
                    });
                  c.resolve = a;
                  c.reject = b;
                  return c;
                }
                zg.prototype.resolve = function () {};
                zg.prototype.reject = function () {};
                function Ag(a, b) {
                  this.promise = a;
                  this.i = b;
                  this.g = null;
                }
                function Bg(a) {
                  return new Ag(Promise.reject(a), function () {
                    return Promise.resolve();
                  });
                }
                function Cg() {
                  var a = Promise.reject(new U(2, 7, 7001));
                  a.catch(function () {});
                  return new Ag(a, function () {
                    return Promise.resolve();
                  });
                }
                function Dg(a) {
                  return new Ag(Promise.resolve(a), function () {
                    return Promise.resolve();
                  });
                }
                function Eg(a) {
                  return new Ag(a, function () {
                    return a.catch(function () {});
                  });
                }
                Ag.prototype.abort = function () {
                  this.g || (this.g = this.i());
                  return this.g;
                };
                function Fg(a) {
                  return new Ag(Promise.all(a.map(function (b) {
                    return b.promise;
                  })), function () {
                    return Promise.all(a.map(function (b) {
                      return b.abort();
                    }));
                  });
                }
                Ag.prototype.finally = function (a) {
                  this.promise.then(function () {
                    return a(true);
                  }, function () {
                    return a(false);
                  });
                  return this;
                };
                Ag.prototype.Xa = function (a, b) {
                  function c(h) {
                    return function (k) {
                      if (e.g && h) f.reject(g);else {
                        var l = h ? a : b;
                        l ? d = Gg(l, k, f) : (h ? f.resolve : f.reject)(k);
                      }
                    };
                  }
                  function d() {
                    f.reject(g);
                    return e.abort();
                  }
                  var e = this,
                    f = new zg();
                  f.catch(function () {});
                  var g = new U(2, 7, 7001);
                  this.promise.then(c(true), c(false));
                  return new Ag(f, function () {
                    return d();
                  });
                };
                function Gg(a, b, c) {
                  try {
                    var d = a(b);
                    if (d && d.promise && d.abort) return c.resolve(d.promise), function () {
                      return d.abort();
                    };
                    c.resolve(d);
                    return function () {
                      return Promise.resolve(d).then(function () {}, function () {});
                    };
                  } catch (e) {
                    return c.reject(e), function () {
                      return Promise.resolve();
                    };
                  }
                }
                da.Object.defineProperties(Ag.prototype, {
                  aborted: {
                    configurable: true,
                    enumerable: true,
                    get: function get() {
                      return this.g !== null;
                    }
                  }
                });
                S("shaka.util.AbortableOperation", Ag);
                Ag.prototype.chain = Ag.prototype.Xa;
                Ag.prototype["finally"] = Ag.prototype.finally;
                Ag.all = Fg;
                Ag.prototype.abort = Ag.prototype.abort;
                Ag.notAbortable = Eg;
                Ag.completed = Dg;
                Ag.aborted = Cg;
                Ag.failed = Bg;
                function V(a, b) {
                  if (b) if (b instanceof Map) for (var c = t(b.keys()), d = c.next(); !d.done; d = c.next()) d = d.value, Object.defineProperty(this, d, {
                    value: b.get(d),
                    writable: true,
                    enumerable: true
                  });else for (c in b) Object.defineProperty(this, c, {
                    value: b[c],
                    writable: true,
                    enumerable: true
                  });
                  this.defaultPrevented = this.cancelable = this.bubbles = false;
                  this.timeStamp = window.performance && window.performance.now ? window.performance.now() : Date.now();
                  this.type = a;
                  this.isTrusted = false;
                  this.target = this.currentTarget = null;
                  this.g = false;
                }
                function Hg(a) {
                  var b = new V(a.type),
                    c;
                  for (c in a) Object.defineProperty(b, c, {
                    value: a[c],
                    writable: true,
                    enumerable: true
                  });
                  return b;
                }
                V.prototype.preventDefault = function () {
                  this.cancelable && (this.defaultPrevented = true);
                };
                V.prototype.stopImmediatePropagation = function () {
                  this.g = true;
                };
                V.prototype.stopPropagation = function () {};
                S("shaka.util.FakeEvent", V);
                var Ig = {
                  ql: "abrstatuschanged",
                  rl: "adaptation",
                  ul: "audiotrackchanged",
                  vl: "audiotrackschanged",
                  wl: "boundarycrossed",
                  xl: "buffering",
                  yl: "canupdatestarttime",
                  zl: "complete",
                  Al: "currentitemchanged",
                  Bl: "downloadcompleted",
                  Cl: "downloadfailed",
                  Dl: "downloadheadersreceived",
                  El: "drmsessionupdate",
                  Fl: "emsg",
                  Ll: "itemsinserted",
                  Ml: "itemsremoved",
                  am: "prft",
                  Error: "error",
                  Gl: "expirationupdated",
                  Hl: "firstquartile",
                  Il: "gapjumped",
                  Nl: "keystatuschanged",
                  Ql: "loaded",
                  Rl: "loading",
                  Tl: "manifestparsed",
                  Ul: "manifestupdated",
                  Vl: "mediaqualitychanged",
                  Wl: "mediasourcerecovered",
                  Xl: "metadataadded",
                  Metadata: "metadata",
                  Yl: "midpoint",
                  Zl: "nospatialvideoinfo",
                  $l: "onstatechange",
                  bm: "ratechange",
                  gm: "segmentappended",
                  hm: "sessiondata",
                  im: "spatialvideoinfo",
                  jm: "stalldetected",
                  lm: "started",
                  nm: "statechanged",
                  om: "streaming",
                  pm: "textchanged",
                  qm: "texttrackvisibility",
                  rm: "thirdquartile",
                  sm: "timelineregionadded",
                  tm: "timelineregionenter",
                  um: "timelineregionexit",
                  vm: "trackschanged",
                  xm: "unloading",
                  zm: "variantchanged"
                };
                function Jg() {
                  this.ab = new mb();
                  this.Fe = this;
                }
                Jg.prototype.addEventListener = function (a, b) {
                  this.ab && this.ab.push(a, b);
                };
                Jg.prototype.removeEventListener = function (a, b) {
                  this.ab && this.ab.remove(a, b);
                };
                Jg.prototype.dispatchEvent = function (a) {
                  if (!this.ab) return true;
                  var b = this.ab.get(a.type) || [],
                    c = this.ab.get("All");
                  c && (b = b.concat(c));
                  b = t(b);
                  for (c = b.next(); !c.done; c = b.next()) {
                    c = c.value;
                    a.target = this.Fe;
                    a.currentTarget = this.Fe;
                    try {
                      c.handleEvent ? c.handleEvent(a) : c.call(this, a);
                    } catch (d) {}
                    if (a.g) break;
                  }
                  return a.defaultPrevented;
                };
                Jg.prototype.release = function () {
                  this.ab = null;
                };
                function Kg() {
                  this.g = [];
                }
                function Lg(a, b) {
                  a.g.push(b.finally(function () {
                    jb(a.g, b);
                  }));
                }
                Kg.prototype.destroy = function () {
                  for (var a = [], b = t(this.g), c = b.next(); !c.done; c = b.next()) c = c.value, c.promise.catch(function () {}), a.push(c.abort());
                  this.g = [];
                  return Promise.all(a);
                };
                function Mg(a, b, c, d, e, f, g) {
                  Jg.call(this);
                  this.i = null;
                  this.j = false;
                  this.u = new Kg();
                  this.g = new Set();
                  this.h = new Set();
                  this.o = a || null;
                  this.m = b || null;
                  this.B = c || null;
                  this.C = d || null;
                  this.F = e || null;
                  this.H = f || null;
                  this.G = g || null;
                  this.l = new Map();
                }
                la(Mg, Jg);
                p = Mg.prototype;
                p.configure = function (a) {
                  this.i = a;
                };
                function Ng(a, b, c, d) {
                  d = d === void 0 ? false : d;
                  c = c || Og;
                  var e = Pg.get(a);
                  (!e || c >= e.priority) && Pg.set(a, {
                    priority: c,
                    yf: b,
                    Ek: d
                  });
                }
                function Qg(a, b) {
                  for (var c = t(a.g), d = c.next(); !d.done; d = c.next()) b.g.add(d.value);
                  a = t(a.h);
                  for (c = a.next(); !c.done; c = a.next()) b.h.add(c.value);
                }
                p.Hk = function (a) {
                  this.g.add(a);
                };
                p.fl = function (a) {
                  this.g.delete(a);
                };
                p.pj = function () {
                  this.g.clear();
                };
                p.Ik = function (a) {
                  this.h.add(a);
                };
                p.hl = function (a) {
                  this.h.delete(a);
                };
                p.qj = function () {
                  this.h.clear();
                };
                p.Qh = function () {
                  this.l.clear();
                };
                function Rg(a, b, c) {
                  return {
                    uris: a,
                    method: "GET",
                    body: null,
                    headers: {},
                    allowCrossSiteCredentials: false,
                    retryParameters: b,
                    licenseRequestType: null,
                    sessionId: null,
                    drmInfo: null,
                    initData: null,
                    initDataType: null,
                    streamDataCallback: c === void 0 ? null : c
                  };
                }
                p.destroy = function () {
                  this.j = true;
                  this.g.clear();
                  this.h.clear();
                  this.l.clear();
                  Jg.prototype.release.call(this);
                  return this.u.destroy();
                };
                p.request = function (a, b, c) {
                  var d = this,
                    e = new Sg();
                  if (this.j) {
                    var f = Promise.reject(new U(2, 7, 7001));
                    f.catch(function () {});
                    return new Tg(f, function () {
                      return Promise.resolve();
                    }, e);
                  }
                  b.method = b.method || "GET";
                  b.headers = b.headers || {};
                  b.retryParameters = b.retryParameters ? gd(b.retryParameters) : xg();
                  b.uris = gd(b.uris);
                  f = Ug(this, a, b, c);
                  var g = f.Xa(function () {
                      return Vg(d, a, b, c, new wg(b.retryParameters, false), 0, null, e);
                    }),
                    h = g.Xa(function (q) {
                      return Wg(d, a, q, c);
                    }),
                    k = Date.now(),
                    l = 0;
                  f.promise.then(function () {
                    l = Date.now() - k;
                  }, function () {});
                  var m = 0;
                  g.promise.then(function () {
                    m = Date.now();
                  }, function () {});
                  var n = h.Xa(function (q) {
                    var r = Date.now() - m,
                      u = q.response;
                    u.timeMs += l;
                    u.timeMs += r;
                    q.fk || !d.o || u.fromCache || b.method == "HEAD" || a != Xg || d.o(u.timeMs, u.data.byteLength, Yg(c), b, c);
                    d.G && d.G(a, u, c);
                    return u;
                  }, function (q) {
                    q && (q.severity = 2);
                    throw q;
                  });
                  f = new Tg(n.promise, function () {
                    return n.abort();
                  }, e);
                  Lg(this.u, f);
                  return f;
                };
                function Ug(a, b, c, d) {
                  function e(h) {
                    f = f.Xa(function () {
                      c.body && (c.body = Wb(c.body));
                      return h(b, c, d);
                    });
                  }
                  var f = Dg(void 0);
                  a.F && e(a.F);
                  a = t(a.g);
                  for (var g = a.next(); !g.done; g = a.next()) e(g.value);
                  return f.Xa(void 0, function (h) {
                    if (h instanceof U && h.code == 7001) throw h;
                    throw new U(2, 1, 1006, h);
                  });
                }
                function Vg(a, b, c, d, e, f, g, h) {
                  a.i.forceHTTP && (c.uris[f] = c.uris[f].replace("https://", "http://"));
                  a.i.forceHTTPS && (c.uris[f] = c.uris[f].replace("http://", "https://"));
                  f > 0 && a.H && a.H(b, d, c.uris[f], c.uris[f - 1]);
                  var k = new Db(c.uris[f]),
                    l = k.bc,
                    m = false;
                  l || (l = location.protocol, l = l.slice(0, -1), Eb(k, l), c.uris[f] = k.toString());
                  l = l.toLowerCase();
                  var n = (l = Pg.get(l)) ? l.yf : null;
                  if (!n) return Bg(new U(2, 1, 1E3, k));
                  var q = l.Ek;
                  (k = a.l.get(k.Db)) && (c.headers["common-access-token"] = k);
                  var r = null,
                    u = null,
                    v = false,
                    w = false,
                    z;
                  return Eg(yg(e)).Xa(function () {
                    if (a.j) return Cg();
                    z = Date.now();
                    var y = 0;
                    c.requestStartTime = Date.now();
                    var B = n(c.uris[f], c, b, function (C, A, E) {
                      r && r.stop();
                      u && u.ia(I / 1E3);
                      a.o && b == Xg && (y++, c.packetNumber = y, a.o(C, A, Yg(d), c, d), m = true, h.g = E);
                    }, function (C) {
                      w = true;
                      c.timeToFirstByte = Date.now() - c.requestStartTime;
                      a.m && a.m(C, c, b);
                    }, {
                      minBytesForProgressEvents: a.i.minBytesForProgressEvents
                    });
                    if (!q) return B;
                    var D = c.retryParameters.connectionTimeout;
                    D && (r = new df(function () {
                      v = true;
                      B.abort();
                    }), r.ia(D / 1E3));
                    var I = c.retryParameters.stallTimeout;
                    I && (u = new df(function () {
                      v = true;
                      B.abort();
                    }));
                    return B;
                  }).Xa(function (y) {
                    r && r.stop();
                    u && u.stop();
                    y.timeMs == void 0 && (y.timeMs = Date.now() - z);
                    var B = y.headers["common-access-token"];
                    if (B) {
                      var D = new Db(y.uri);
                      a.l.set(D.Db, B);
                    }
                    B = {
                      response: y,
                      fk: m
                    };
                    !w && a.m && a.m(y.headers, c, b);
                    a.B && a.B(c, y);
                    return B;
                  }, function (y) {
                    r && r.stop();
                    u && u.stop();
                    if (a.C) {
                      var B = null,
                        D = 0;
                      y instanceof U && (B = y, y.code == 1001 && (D = y.data[1]));
                      a.C(c, B, D, v);
                    }
                    if (a.j) return Cg();
                    v && (y = new U(1, 1, 1003, c.uris[f], b));
                    if (y instanceof U) {
                      if (y.code == 7001) throw y;
                      if (y.code == 1010) throw g;
                      if (y.severity == 1) {
                        B = new Map().set("error", y);
                        B = new V("retry", B);
                        B.cancelable = true;
                        a.dispatchEvent(B);
                        if (B.defaultPrevented) throw y;
                        f = (f + 1) % c.uris.length;
                        return Vg(a, b, c, d, e, f, y, h);
                      }
                    }
                    throw y;
                  });
                }
                function Wg(a, b, c, d) {
                  var e = Dg(void 0);
                  a = t(a.h);
                  for (var f = a.next(), g = {}; !f.done; g = {
                    Ki: void 0
                  }, f = a.next()) g.Ki = f.value, e = e.Xa(function (h) {
                    return function () {
                      var k = c.response;
                      k.data && (k.data = Wb(k.data));
                      return (0, h.Ki)(b, k, d);
                    };
                  }(g));
                  return e.Xa(function () {
                    return c;
                  }, function (h) {
                    var k = 2;
                    if (h instanceof U) {
                      if (h.code == 7001) throw h;
                      k = h.severity;
                    }
                    throw new U(k, 1, 1007, h);
                  });
                }
                function Yg(a) {
                  if (a) {
                    var b = a.segment;
                    a = a.stream;
                    if (b && a && a.fastSwitching && b.Xc) return false;
                  }
                  return true;
                }
                S("shaka.net.NetworkingEngine", Mg);
                Mg.prototype.request = Mg.prototype.request;
                Mg.prototype.destroy = Mg.prototype.destroy;
                Mg.makeRequest = Rg;
                Mg.defaultRetryParameters = function () {
                  return xg();
                };
                Mg.prototype.clearCommonAccessTokenMap = Mg.prototype.Qh;
                Mg.prototype.clearAllResponseFilters = Mg.prototype.qj;
                Mg.prototype.unregisterResponseFilter = Mg.prototype.hl;
                Mg.prototype.registerResponseFilter = Mg.prototype.Ik;
                Mg.prototype.clearAllRequestFilters = Mg.prototype.pj;
                Mg.prototype.unregisterRequestFilter = Mg.prototype.fl;
                Mg.prototype.registerRequestFilter = Mg.prototype.Hk;
                Mg.unregisterScheme = function (a) {
                  Pg.delete(a);
                };
                Mg.registerScheme = Ng;
                Mg.prototype.configure = Mg.prototype.configure;
                function Sg() {
                  this.g = 0;
                }
                Mg.NumBytesRemainingClass = Sg;
                function Tg(a, b, c) {
                  Ag.call(this, a, b);
                  this.h = c;
                }
                la(Tg, Ag);
                Mg.PendingRequest = Tg;
                var Xg = 1;
                Mg.RequestType = {
                  MANIFEST: 0,
                  SEGMENT: Xg,
                  LICENSE: 2,
                  APP: 3,
                  TIMING: 4,
                  SERVER_CERTIFICATE: 5,
                  KEY: 6,
                  ADS: 7,
                  CONTENT_STEERING: 8,
                  CMCD: 9
                };
                Mg.AdvancedRequestType = {
                  INIT_SEGMENT: 0,
                  MEDIA_SEGMENT: 1,
                  MEDIA_PLAYLIST: 2,
                  MASTER_PLAYLIST: 3,
                  MPD: 4,
                  MSS: 5,
                  MPD_PATCH: 6,
                  MEDIATAILOR_SESSION_INFO: 7,
                  MEDIATAILOR_TRACKING_INFO: 8,
                  MEDIATAILOR_STATIC_RESOURCE: 9,
                  MEDIATAILOR_TRACKING_EVENT: 10,
                  INTERSTITIAL_ASSET_LIST: 11,
                  INTERSTITIAL_AD_URL: 12
                };
                var Og = 3;
                Mg.PluginPriority = {
                  FALLBACK: 1,
                  PREFERRED: 2,
                  APPLICATION: Og
                };
                var Pg = new Map();
                function Zg(a) {
                  this.g = false;
                  this.h = new zg();
                  this.i = a;
                }
                Zg.prototype.destroy = function () {
                  var a = this;
                  if (this.g) return this.h;
                  this.g = true;
                  return this.i().then(function () {
                    a.h.resolve();
                  }, function () {
                    a.h.resolve();
                  });
                };
                function $g(a, b) {
                  if (a.g) {
                    if (b instanceof U && b.code == 7003) throw b;
                    throw new U(2, 7, 7003, b);
                  }
                }
                function ah(a, b) {
                  var c = [];
                  a = t(a);
                  for (var d = a.next(); !d.done; d = a.next()) c.push(b(d.value));
                  return c;
                }
                function bh(a, b) {
                  a = t(a);
                  for (var c = a.next(); !c.done; c = a.next()) if (!b(c.value)) return false;
                  return true;
                }
                function ch(a) {
                  for (var b = new Map(), c = t(Object.keys(a)), d = c.next(); !d.done; d = c.next()) d = d.value, b.set(d, a[d]);
                  return b;
                }
                function dh(a) {
                  var b = {};
                  a.forEach(function (c, d) {
                    b[d] = c;
                  });
                  return b;
                }
                function eh(a, b) {
                  this.h = ac(a);
                  this.i = b == fh;
                  this.g = 0;
                }
                p = eh.prototype;
                p.Ia = function () {
                  return this.g < this.h.byteLength;
                };
                p.Oa = function () {
                  return this.g;
                };
                p.getLength = function () {
                  return this.h.byteLength;
                };
                p.Y = function () {
                  try {
                    var a = this.h.getUint8(this.g);
                    this.g += 1;
                    return a;
                  } catch (b) {
                    throw gh();
                  }
                };
                p.Ca = function () {
                  try {
                    var a = this.h.getUint16(this.g, this.i);
                    this.g += 2;
                    return a;
                  } catch (b) {
                    throw gh();
                  }
                };
                p.U = function () {
                  try {
                    var a = this.h.getUint32(this.g, this.i);
                    this.g += 4;
                    return a;
                  } catch (b) {
                    throw gh();
                  }
                };
                p.Zg = function () {
                  try {
                    var a = this.h.getInt32(this.g, this.i);
                    this.g += 4;
                    return a;
                  } catch (b) {
                    throw gh();
                  }
                };
                p.Dd = function () {
                  try {
                    if (this.i) {
                      var a = this.h.getUint32(this.g, !0);
                      var b = this.h.getUint32(this.g + 4, !0);
                    } else b = this.h.getUint32(this.g, !1), a = this.h.getUint32(this.g + 4, !1);
                  } catch (c) {
                    throw gh();
                  }
                  if (b > 2097151) throw new U(2, 3, 3001);
                  this.g += 8;
                  return b * 4294967296 + a;
                };
                p.Tb = function (a, b) {
                  if (this.g + a > this.h.byteLength) throw gh();
                  var c = Vb(this.h, this.g, a);
                  this.g += a;
                  return b ? new Uint8Array(c) : c;
                };
                p.skip = function (a) {
                  if (this.g + a > this.h.byteLength) throw gh();
                  this.g += a;
                };
                p.Li = function (a) {
                  if (this.g < a) throw gh();
                  this.g -= a;
                };
                p.seek = function (a) {
                  if (a < 0 || a > this.h.byteLength) throw gh();
                  this.g = a;
                };
                p.Yc = function () {
                  for (var a = this.g; this.Ia() && this.h.getUint8(this.g) != 0;) this.g += 1;
                  a = Vb(this.h, a, this.g - a);
                  this.g += 1;
                  return dc(a);
                };
                function gh() {
                  return new U(2, 3, 3E3);
                }
                S("shaka.util.DataViewReader", eh);
                eh.prototype.readTerminatedString = eh.prototype.Yc;
                eh.prototype.seek = eh.prototype.seek;
                eh.prototype.rewind = eh.prototype.Li;
                eh.prototype.skip = eh.prototype.skip;
                eh.prototype.readBytes = eh.prototype.Tb;
                eh.prototype.readUint64 = eh.prototype.Dd;
                eh.prototype.readInt32 = eh.prototype.Zg;
                eh.prototype.readUint32 = eh.prototype.U;
                eh.prototype.readUint16 = eh.prototype.Ca;
                eh.prototype.readUint8 = eh.prototype.Y;
                eh.prototype.getLength = eh.prototype.getLength;
                eh.prototype.getPosition = eh.prototype.Oa;
                eh.prototype.hasMoreData = eh.prototype.Ia;
                var fh = 1;
                eh.Endianness = {
                  BIG_ENDIAN: 0,
                  LITTLE_ENDIAN: fh
                };
                function hh() {
                  this.i = new Map();
                  this.h = new Map();
                  this.g = false;
                }
                p = hh.prototype;
                p.box = function (a, b) {
                  a = ih(a);
                  this.i.set(a, jh);
                  this.h.set(a, b);
                  return this;
                };
                p.S = function (a, b) {
                  a = ih(a);
                  this.i.set(a, kh);
                  this.h.set(a, b);
                  return this;
                };
                p.stop = function () {
                  this.g = true;
                };
                p.parse = function (a, b, c) {
                  a = new eh(a, 0);
                  for (this.g = false; a.Ia() && !this.g;) this.zd(0, a, b, c);
                };
                p.zd = function (a, b, c, d) {
                  var e = b.Oa();
                  if (d && e + 8 > b.getLength()) this.g = true;else {
                    var f = b.U(),
                      g = b.U(),
                      h = lh(g),
                      k = false;
                    switch (f) {
                      case 0:
                        f = b.getLength() - e;
                        break;
                      case 1:
                        if (d && b.Oa() + 8 > b.getLength()) {
                          this.g = true;
                          return;
                        }
                        f = b.Dd();
                        k = true;
                    }
                    var l = this.h.get(g);
                    if (l) {
                      var m = null,
                        n = null;
                      if (this.i.get(g) == kh) {
                        if (d && b.Oa() + 4 > b.getLength()) {
                          this.g = true;
                          return;
                        }
                        n = b.U();
                        m = n >>> 24;
                        n &= 16777215;
                      }
                      g = e + f;
                      c && g > b.getLength() && (g = b.getLength());
                      d && g > b.getLength() ? this.g = true : (g -= b.Oa(), b = g > 0 ? b.Tb(g, false) : new Uint8Array(0), b = new eh(b, 0), l({
                        name: h,
                        parser: this,
                        partialOkay: c || false,
                        stopOnPartial: d || false,
                        version: m,
                        flags: n,
                        reader: b,
                        size: f,
                        start: e + a,
                        has64BitSize: k
                      }));
                    } else b.skip(Math.min(e + f - b.Oa(), b.getLength() - b.Oa()));
                  }
                };
                function mh(a) {
                  for (var b = nh(a); a.reader.Ia() && !a.parser.g;) a.parser.zd(a.start + b, a.reader, a.partialOkay, a.stopOnPartial);
                }
                function oh(a) {
                  for (var b = nh(a), c = a.reader.U(), d = 0; d < c && (a.parser.zd(a.start + b, a.reader, a.partialOkay, a.stopOnPartial), !a.parser.g); d++);
                }
                function ph(a) {
                  var b = nh(a);
                  for (a.reader.skip(78); a.reader.Ia() && !a.parser.g;) a.parser.zd(a.start + b, a.reader, a.partialOkay, a.stopOnPartial);
                }
                function rh(a) {
                  var b = nh(a);
                  a.reader.skip(8);
                  var c = a.reader.Ca();
                  a.reader.skip(6);
                  c == 2 ? a.reader.skip(48) : a.reader.skip(12);
                  for (c == 1 && a.reader.skip(16); a.reader.Ia() && !a.parser.g;) a.parser.zd(a.start + b, a.reader, a.partialOkay, a.stopOnPartial);
                }
                function sh(a, b) {
                  return function (c) {
                    a(c.reader.Tb(c.reader.getLength() - c.reader.Oa(), b));
                  };
                }
                function ih(a) {
                  var b = 0;
                  a = t(a);
                  for (var c = a.next(); !c.done; c = a.next()) b = b << 8 | c.value.charCodeAt(0);
                  return b;
                }
                function lh(a) {
                  return String.fromCharCode(a >> 24 & 255, a >> 16 & 255, a >> 8 & 255, a & 255);
                }
                function nh(a) {
                  return 8 + (a.has64BitSize ? 8 : 0) + (a.flags != null ? 4 : 0);
                }
                S("shaka.util.Mp4Parser", hh);
                hh.headerSize = nh;
                hh.typeToString = lh;
                hh.allData = sh;
                hh.audioSampleEntry = rh;
                hh.visualSampleEntry = ph;
                hh.sampleDescription = oh;
                hh.children = mh;
                hh.prototype.parseNext = hh.prototype.zd;
                hh.prototype.parse = hh.prototype.parse;
                hh.prototype.stop = hh.prototype.stop;
                hh.prototype.fullBox = hh.prototype.S;
                hh.prototype.box = hh.prototype.box;
                var jh = 0,
                  kh = 1;
                function th(a) {
                  var b = this;
                  this.g = [];
                  this.h = [];
                  this.data = [];
                  new hh().box("moov", mh).box("moof", mh).S("pssh", function (c) {
                    if (!(c.version > 1)) {
                      var d = Vb(c.reader.h, -12, c.size);
                      b.data.push(d);
                      d = c.reader.Tb(16, false);
                      b.g.push(rc(d));
                      if (c.version > 0) {
                        d = c.reader.U();
                        for (var e = 0; e < d; e++) {
                          var f = c.reader.Tb(16, false);
                          f = rc(f);
                          b.h.push(f);
                        }
                      }
                    }
                  }).parse(a);
                }
                function uh(a, b, c, d) {
                  var e = a.length,
                    f = 12 + b.length + 4 + e;
                  d > 0 && (f += 4 + 16 * c.size);
                  var g = new Uint8Array(f),
                    h = ac(g),
                    k = 0;
                  h.setUint32(k, f);
                  k += 4;
                  h.setUint32(k, 1886614376);
                  k += 4;
                  d < 1 ? h.setUint32(k, 0) : h.setUint32(k, 16777216);
                  k += 4;
                  g.set(b, k);
                  k += b.length;
                  if (d > 0) for (h.setUint32(k, c.size), k += 4, b = t(c), c = b.next(); !c.done; c = b.next()) c = qc(c.value), g.set(c, k), k += c.length;
                  h.setUint32(k, e);
                  g.set(a, k + 4);
                  return g;
                }
                function vh(a) {
                  var b = this;
                  this.F = a;
                  this.j = this.B = null;
                  this.qa = this.T = false;
                  this.J = 0;
                  this.g = null;
                  this.o = new nb();
                  this.i = new Map();
                  this.X = [];
                  this.C = new Map();
                  this.K = false;
                  this.m = new zg();
                  this.h = null;
                  this.u = function (c) {
                    c.severity == 2 && b.m.reject(c);
                    a.onError(c);
                  };
                  this.aa = new Map();
                  this.ma = new Map();
                  this.M = new df(function () {
                    return wh(b);
                  });
                  this.R = false;
                  this.N = [];
                  this.$ = false;
                  this.G = new df(function () {
                    xh(b);
                  });
                  this.m.catch(function () {});
                  this.l = new Zg(function () {
                    return yh(b);
                  });
                  this.O = false;
                  this.H = this.I = null;
                  this.V = function () {
                    return false;
                  };
                }
                p = vh.prototype;
                p.destroy = function () {
                  return this.l.destroy();
                };
                function yh(a) {
                  return P(function (b) {
                    switch (b.g) {
                      case 1:
                        return a.o.release(), a.o = null, a.m.reject(), a.G.stop(), a.G = null, a.M.stop(), a.M = null, F(b, zh(a), 2);
                      case 2:
                        if (!a.j) {
                          b.A(3);
                          break;
                        }
                        ua(b, 4);
                        return F(b, a.j.setMediaKeys(null), 6);
                      case 6:
                        xa(b, 5);
                        break;
                      case 4:
                        ya(b);
                      case 5:
                        a.j = null;
                      case 3:
                        a.g = null, a.B = null, a.C = new Map(), a.h = null, a.u = function () {}, a.F = null, a.O = false, a.I = null, G(b);
                    }
                  });
                }
                p.configure = function (a, b) {
                  this.h = a;
                  b && (this.V = b);
                  this.G && this.T && this.g && this.G.Ea(this.h.updateExpirationTime);
                };
                function Ah(a, b, c) {
                  a.qa = true;
                  a.C = new Map();
                  a.R = c;
                  return Bh(a, b, false);
                }
                function Fh(a, b, c, d) {
                  d = d === void 0 ? true : d;
                  a.C = new Map();
                  c = t(c);
                  for (var e = c.next(); !e.done; e = c.next()) a.C.set(e.value, {
                    initData: null,
                    initDataType: null
                  });
                  c = t(a.h.persistentSessionsMetadata);
                  for (e = c.next(); !e.done; e = c.next()) e = e.value, a.C.set(e.sessionId, {
                    initData: e.initData,
                    initDataType: e.initDataType
                  });
                  a.R = a.C.size > 0;
                  return Bh(a, b, d);
                }
                function Gh(a, b, c, d, e, f) {
                  var g, h, k, l, m;
                  return P(function (n) {
                    if (n.g == 1) return g = [], f.length && g.push(f[0].contentType), e.length && g.push(e[0].contentType), h = function h(q) {
                      q = vc(b, q, null);
                      q.licenseServerUri = c;
                      q.serverCertificate = d;
                      q.persistentStateRequired = true;
                      q.sessionType = "persistent-license";
                      return q;
                    }, k = jg(g), k.video && (l = h(f[0].encryptionScheme || ""), k.video.drmInfos.push(l)), k.audio && (m = h(e[0].encryptionScheme || ""), k.audio.drmInfos.push(m)), F(n, Df([k], true, a.O, []), 2);
                    $g(a.l);
                    return n.return(Hh(a, [k]));
                  });
                }
                function Bh(a, b, c) {
                  var d, e, f, g, h, k, l, m, n, q, r, u, v, w, z, y, B, D;
                  return P(function (I) {
                    if (I.g == 1) {
                      Ih(a.h.clearKeys, b);
                      d = b.some(function (C) {
                        return C.video && C.video.drmInfos.length || C.audio && C.audio.drmInfos.length ? true : false;
                      });
                      e = ch(a.h.servers);
                      f = ch(a.h.advanced || {});
                      !d && c && Jh(b, e);
                      g = new WeakSet();
                      h = t(b);
                      for (k = h.next(); !k.done; k = h.next()) for (l = k.value, m = Kh(l), n = t(m), q = n.next(); !q.done; q = n.next()) r = q.value, g.has(r) || (g.add(r), Lh(r, e, f, a.h.keySystemsMapping));
                      u = function u(C, A) {
                        var E = [];
                        C = t(C);
                        for (var J = C.next(); !J.done; J = C.next()) {
                          J = J.value;
                          var H = J[A] || f.has(J.keySystem) && f.get(J.keySystem)[A] || "",
                            K;
                          if (K = H == "") K = (K = J.keySystem) ? !!K.match(/^com\.widevine\.alpha/) : false;
                          K && (A == "audioRobustness" ? H = [a.h.defaultAudioRobustnessForWidevine] : A == "videoRobustness" && (H = [a.h.defaultVideoRobustnessForWidevine]));
                          if (typeof H === "string") E.push(J);else if (Array.isArray(H)) for (H.length === 0 && (H = [""]), H = t(H), K = H.next(); !K.done; K = H.next()) {
                            var L = {};
                            E.push(Object.assign({}, J, (L[A] = K.value, L)));
                          }
                        }
                        return E;
                      };
                      v = new WeakSet();
                      w = t(b);
                      for (z = w.next(); !z.done; z = w.next()) y = z.value, y.video && !v.has(y.video) && (y.video.drmInfos = u(y.video.drmInfos, "videoRobustness"), y.video.drmInfos = u(y.video.drmInfos, "audioRobustness"), v.add(y.video)), y.audio && !v.has(y.audio) && (y.audio.drmInfos = u(y.audio.drmInfos, "videoRobustness"), y.audio.drmInfos = u(y.audio.drmInfos, "audioRobustness"), v.add(y.audio));
                      return F(I, Df(b, a.R, a.O, a.h.preferredKeySystems), 2);
                    }
                    $g(a.l);
                    B = d || e.size > 0;
                    if (!B) return a.T = true, I.return(Promise.resolve());
                    D = Hh(a, b);
                    return I.return(d ? D : D.catch(function () {}));
                  });
                }
                function Mh(a) {
                  var b;
                  return P(function (c) {
                    switch (c.g) {
                      case 1:
                        if (a.j.mediaKeys) return c.return();
                        if (!a.I) {
                          c.A(2);
                          break;
                        }
                        return F(c, a.I, 3);
                      case 3:
                        return $g(a.l), c.return();
                      case 2:
                        return ua(c, 4), a.I = a.j.setMediaKeys(a.B), F(c, a.I, 6);
                      case 6:
                        xa(c, 5);
                        break;
                      case 4:
                        b = ya(c), a.u(new U(2, 6, 6003, b.message));
                      case 5:
                        $g(a.l), G(c);
                    }
                  });
                }
                function Nh(a, b) {
                  return P(function (c) {
                    if (c.g == 1) return F(c, Mh(a), 2);
                    _Oh(a, b.initDataType, Vb(b.initData));
                    G(c);
                  });
                }
                p.fc = function (a) {
                  var b = this,
                    c,
                    d;
                  return P(function (e) {
                    if (e.g == 1) {
                      if (b.j === a) return e.return();
                      if (!b.B) return b.o.Ba(a, "encrypted", function () {
                        b.u(new U(2, 6, 6010));
                      }), e.return();
                      b.j = a;
                      b.h.delayLicenseRequestUntilPlayed && b.o.Ba(b.j, "play", function () {
                        for (var f = t(b.N), g = f.next(); !g.done; g = f.next()) Ph(b, g.value);
                        b.$ = true;
                        b.N = [];
                      });
                      b.j.remote ? (b.o.D(b.j.remote, "connect", function () {
                        return zh(b);
                      }), b.o.D(b.j.remote, "connecting", function () {
                        return zh(b);
                      }), b.o.D(b.j.remote, "disconnect", function () {
                        return zh(b);
                      })) : "webkitCurrentPlaybackTargetIsWireless" in b.j && b.o.D(b.j, "webkitcurrentplaybacktargetiswirelesschanged", function () {
                        return zh(b);
                      });
                      b.H = b.g ? b.g.initData.find(function (f) {
                        return f.initData.length > 0;
                      }) || null : null;
                      c = b.g.keySystem;
                      return (d = tb().Rg(c)) || !b.H && b.g.keySystem === "com.apple.fps" && !b.C.size ? e.A(2) : F(e, Mh(b), 2);
                    }
                    Qh(b).catch(function () {});
                    !d && (b.H || b.C.size || b.h.parseInbandPsshEnabled) || b.o.D(b.j, "encrypted", function (f) {
                      return Nh(b, f);
                    });
                    G(e);
                  });
                };
                function Rh(a) {
                  var b, c, d, e, f;
                  return P(function (g) {
                    switch (g.g) {
                      case 1:
                        if (!a.B || !a.g) return g.return();
                        if (!a.g.serverCertificateUri || a.g.serverCertificate && a.g.serverCertificate.length) {
                          g.A(2);
                          break;
                        }
                        b = Rg([a.g.serverCertificateUri], a.h.retryParameters);
                        ua(g, 3);
                        c = a.F.tc.request(5, b, {
                          isPreload: a.V()
                        });
                        return F(g, c.promise, 5);
                      case 5:
                        d = g.h;
                        a.g.serverCertificate = Vb(d.data);
                        xa(g, 4);
                        break;
                      case 3:
                        throw e = ya(g), new U(2, 6, 6017, e);
                      case 4:
                        if (a.l.g) return g.return();
                      case 2:
                        if (!a.g.serverCertificate || !a.g.serverCertificate.length) return g.return();
                        ua(g, 6);
                        return F(g, a.B.setServerCertificate(a.g.serverCertificate), 8);
                      case 8:
                        xa(g, 0);
                        break;
                      case 6:
                        throw f = ya(g), new U(2, 6, 6004, f.message);
                    }
                  });
                }
                function Sh(a, b) {
                  var c, d, e;
                  return P(function (f) {
                    if (f.g == 1) return F(f, Th(a, b, {
                      initData: null,
                      initDataType: null
                    }), 2);
                    if (f.g != 3) {
                      c = f.h;
                      if (!c) return f.return();
                      d = [];
                      if (e = a.i.get(c)) e.Kb = new zg(), d.push(e.Kb);
                      d.push(c.remove());
                      return F(f, Promise.all(d), 3);
                    }
                    a.i.delete(c);
                    G(f);
                  });
                }
                function Qh(a) {
                  var b, c, d, e, f;
                  return P(function (g) {
                    if (g.g == 1) {
                      if (!a.C.size) return g.A(2);
                      a.C.forEach(function (h, k) {
                        Th(a, k, h);
                      });
                      return F(g, a.m, 3);
                    }
                    if (g.g != 2) {
                      b = a.g && a.g.keyIds || new Set([]);
                      if (b.size > 0 && Uh(a)) return g.return(a.m);
                      a.K = false;
                      a.m = new zg();
                      a.m.catch(function () {});
                    }
                    c = (a.g ? a.g.initData : []) || [];
                    d = t(c);
                    for (e = d.next(); !e.done; e = d.next()) f = e.value, _Oh(a, f.initDataType, f.initData);
                    Vh(a) && a.m.resolve();
                    return g.return(a.m);
                  });
                }
                function _Oh(a, b, c) {
                  if (c.length) {
                    if (a.h.ignoreDuplicateInitData) {
                      var d = a.i.values();
                      d = t(d);
                      for (var e = d.next(); !e.done; e = d.next()) if (Ub(c, e.value.initData)) return;
                      var f = false;
                      a.C.forEach(function (g) {
                        !f && Ub(c, g.initData) && (f = true);
                      });
                      if (f) return;
                    }
                    a.K = true;
                    a.i.size > 0 && Vh(a) && (a.m.resolve(), a.K = false, a.m = new zg(), a.m.catch(function () {}));
                    Wh(a, b, c, a.g.sessionType);
                  }
                }
                function Xh(a) {
                  a = a.i.keys();
                  a = ah(a, function (b) {
                    return b.sessionId;
                  });
                  return Array.from(a);
                }
                p.Gg = function () {
                  var a = this,
                    b = this.i.keys();
                  b = ah(b, function (c) {
                    var d = a.i.get(c);
                    return {
                      sessionId: c.sessionId,
                      sessionType: d.type,
                      initData: d.initData,
                      initDataType: d.initDataType
                    };
                  });
                  return Array.from(b);
                };
                p.Wd = function () {
                  var a = Infinity,
                    b = this.i.keys();
                  b = t(b);
                  for (var c = b.next(); !c.done; c = b.next()) c = c.value, isNaN(c.expiration) || (a = Math.min(a, c.expiration));
                  return a;
                };
                function Yh(a) {
                  return a.J ? a.J : NaN;
                }
                p.Xe = function () {
                  return dh(this.ma);
                };
                function Hh(a, b) {
                  var c, d, e, f, g, h, k;
                  return P(function (l) {
                    switch (l.g) {
                      case 1:
                        c = new Map();
                        d = Zh(a, b, c);
                        if (!d) {
                          if (!navigator.requestMediaKeySystemAccess) throw new U(2, 6, 6020);
                          throw new U(2, 6, 6001);
                        }
                        $g(a.l);
                        ua(l, 2);
                        d.getConfiguration();
                        var m = e = a.h.keySystemsMapping[d.keySystem] || d.keySystem,
                          n = c.get(e),
                          q = [],
                          r = [],
                          u = [],
                          v = [],
                          w = [],
                          z = new Set(),
                          y = new Set();
                        $h(n, q, r, v, u, w, z, y);
                        var B = a.R ? "persistent-license" : "temporary";
                        m = {
                          keySystem: m,
                          encryptionScheme: q[0],
                          licenseServerUri: r[0],
                          distinctiveIdentifierRequired: n[0].distinctiveIdentifierRequired,
                          persistentStateRequired: n[0].persistentStateRequired,
                          sessionType: n[0].sessionType || B,
                          audioRobustness: n[0].audioRobustness || "",
                          videoRobustness: n[0].videoRobustness || "",
                          serverCertificate: v[0],
                          serverCertificateUri: u[0],
                          initData: w,
                          keyIds: z
                        };
                        y.size > 0 && (m.keySystemUris = y);
                        n = t(n);
                        for (y = n.next(); !y.done; y = n.next()) y = y.value, y.distinctiveIdentifierRequired && (m.distinctiveIdentifierRequired = y.distinctiveIdentifierRequired), y.persistentStateRequired && (m.persistentStateRequired = y.persistentStateRequired);
                        a.g = m;
                        if (!a.g.licenseServerUri) throw new U(2, 6, 6012, a.g.keySystem);
                        return F(l, d.createMediaKeys(), 4);
                      case 4:
                        f = l.h;
                        $g(a.l);
                        a.B = f;
                        if (!(a.h.minHdcpVersion != "" && "getStatusForPolicy" in a.B)) {
                          l.A(5);
                          break;
                        }
                        ua(l, 6);
                        return F(l, a.B.getStatusForPolicy({
                          minHdcpVersion: a.h.minHdcpVersion
                        }), 8);
                      case 8:
                        g = l.h;
                        if (g != "usable") throw new U(2, 6, 6018);
                        $g(a.l);
                        xa(l, 5, 2);
                        break;
                      case 6:
                        h = ya(l, 2);
                        if (h instanceof U) throw h;
                        throw new U(2, 6, 6019, h.message);
                      case 5:
                        return a.T = true, a.G.Ea(a.h.updateExpirationTime), F(l, Rh(a), 9);
                      case 9:
                        $g(a.l);
                        xa(l, 0);
                        break;
                      case 2:
                        k = ya(l);
                        $g(a.l, k);
                        a.g = null;
                        if (k instanceof U) throw k;
                        throw new U(2, 6, 6002, k.message);
                    }
                  });
                }
                function Zh(a, b, c) {
                  for (var d = t(b), e = d.next(); !e.done; e = d.next()) {
                    e = t(Kh(e.value));
                    for (var f = e.next(); !f.done; f = e.next()) f = f.value, c.has(f.keySystem) || c.set(f.keySystem, []), c.get(f.keySystem).push(f);
                  }
                  if (c.size == 1 && c.has("")) throw new U(2, 6, 6E3);
                  d = a.h.preferredKeySystems;
                  d.length || (e = ch(a.h.servers), e.size == 1 && (d = Array.from(e.keys())));
                  e = t(d);
                  var g = e.next();
                  for (f = {}; !g.done; f = {
                    Ei: void 0
                  }, g = e.next()) {
                    f.Ei = g.value;
                    g = t(b);
                    for (var h = g.next(); !h.done; h = g.next()) if (h = h.value.decodingInfos.find(function (n) {
                      return function (q) {
                        return q.supported && q.keySystemAccess != null && q.keySystemAccess.keySystem == n.Ei;
                      };
                    }(f))) return h.keySystemAccess;
                  }
                  e = t([true, false]);
                  for (f = e.next(); !f.done; f = e.next()) for (f = f.value, g = t(b), h = g.next(); !h.done; h = g.next()) {
                    h = t(h.value.decodingInfos);
                    for (var k = h.next(); !k.done; k = h.next()) if (k = k.value, k.supported && k.keySystemAccess) {
                      var l = k.keySystemAccess.keySystem;
                      if (!d.includes(l)) {
                        var m = c.get(l);
                        !m && a.h.keySystemsMapping[l] && (m = c.get(a.h.keySystemsMapping[l]));
                        l = t(m);
                        for (m = l.next(); !m.done; m = l.next()) if (!!m.value.licenseServerUri == f) return k.keySystemAccess;
                      }
                    }
                  }
                  return null;
                }
                function ai(a) {
                  Vh(a) && a.m.resolve();
                }
                function bi(a, b) {
                  new df(function () {
                    b.loaded = true;
                    ai(a);
                  }).ia(ci);
                }
                function Th(a, b, c) {
                  var d, e, f, g, h, k, l;
                  return P(function (m) {
                    switch (m.g) {
                      case 1:
                        try {
                          d = a.B.createSession("persistent-license");
                        } catch (n) {
                          return e = new U(2, 6, 6005, n.message), a.u(e), m.return(Promise.reject(e));
                        }
                        a.o.D(d, "message", function (n) {
                          a.j && a.h.delayLicenseRequestUntilPlayed && a.j.paused && !a.$ ? a.N.push(n) : Ph(a, n);
                        });
                        a.o.D(d, "keystatuseschange", function (n) {
                          return di(a, n);
                        });
                        f = {
                          initData: c.initData,
                          initDataType: c.initDataType,
                          loaded: false,
                          Ug: Infinity,
                          Kb: null,
                          type: "persistent-license"
                        };
                        a.i.set(d, f);
                        ua(m, 2);
                        return F(m, d.load(b), 4);
                      case 4:
                        return g = m.h, $g(a.l), g || (a.i.delete(d), h = a.h.persistentSessionOnlinePlayback ? 1 : 2, a.u(new U(h, 6, 6013)), f.loaded = true), bi(a, f), ai(a), m.return(d);
                      case 2:
                        k = ya(m), $g(a.l, k), a.i.delete(d), l = a.h.persistentSessionOnlinePlayback ? 1 : 2, a.u(new U(l, 6, 6005, k.message)), f.loaded = true, ai(a);
                      case 3:
                        return m.return(Promise.resolve());
                    }
                  });
                }
                function Wh(a, b, c, d) {
                  try {
                    var e = a.B.createSession(d);
                  } catch (f) {
                    a.u(new U(2, 6, 6005, f.message));
                    return;
                  }
                  a.o.D(e, "message", function (f) {
                    a.j && a.h.delayLicenseRequestUntilPlayed && a.j.paused && !a.$ ? a.N.push(f) : Ph(a, f);
                  });
                  a.o.D(e, "keystatuseschange", function (f) {
                    return di(a, f);
                  });
                  a.i.set(e, {
                    initData: c,
                    initDataType: b,
                    loaded: false,
                    Ug: Infinity,
                    Kb: null,
                    type: d
                  });
                  try {
                    c = a.h.initDataTransform(c, b, a.g);
                  } catch (f) {
                    b = f;
                    f instanceof U || (b = new U(2, 6, 6016, f));
                    a.u(b);
                    return;
                  }
                  a.h.logLicenseExchange && oc(c);
                  e.generateRequest(b, c).catch(function (f) {
                    if (!a.l.g) {
                      a.i.delete(e);
                      var g = f.errorCode;
                      if (g && g.systemCode) {
                        var h = g.systemCode;
                        h < 0 && (h += 4294967296);
                        h = "0x" + h.toString(16);
                      }
                      a.u(new U(2, 6, 6006, f.message, f, h));
                    }
                  });
                }
                function ei(a) {
                  return P(function (b) {
                    return b.g == 1 ? a.K ? F(b, a.m, 3) : b.A(0) : F(b, Promise.all(a.X.map(function (c) {
                      return c.promise;
                    })), 0);
                  });
                }
                function Ph(a, b) {
                  var c, d, e, f, g, h, k, l, m, n, q, r, u, v, w, z;
                  P(function (y) {
                    switch (y.g) {
                      case 1:
                        c = b.target;
                        a.h.logLicenseExchange && oc(b.message);
                        d = a.i.get(c);
                        e = a.g.licenseServerUri;
                        f = a.h.advanced[a.g.keySystem];
                        b.messageType == "individualization-request" && f && f.individualizationServer && (e = f.individualizationServer);
                        g = Rg([e], a.h.retryParameters);
                        g.body = b.message;
                        g.method = "POST";
                        g.licenseRequestType = b.messageType;
                        g.sessionId = c.sessionId;
                        g.drmInfo = a.g;
                        d && (g.initData = d.initData, g.initDataType = d.initDataType);
                        if (f && f.headers) for (h in f.headers) g.headers[h] = f.headers[h];
                        if (a.g.keySystem === "org.w3.clearkey") {
                          var B = g,
                            D = a.g;
                          try {
                            var I = hc(B.body);
                            if (I) {
                              var C = JSON.parse(I);
                              C.type || (C.type = D.sessionType, B.body = ic(JSON.stringify(C)));
                            }
                          } catch (A) {}
                        }
                        if (sg(a.g.keySystem)) if (B = ec(g.body, true, true), B.includes("PlayReadyKeyMessage")) {
                          B = kd(B, "PlayReadyKeyMessage");
                          D = wd(B, "HttpHeader");
                          D = t(D);
                          for (I = D.next(); !I.done; I = D.next()) C = I.value, I = wd(C, "name")[0], C = wd(C, "value")[0], g.headers[ud(I)] = ud(C);
                          B = wd(B, "Challenge")[0];
                          g.body = pc(ud(B));
                        } else g.headers["Content-Type"] = "text/xml; charset=utf-8";
                        k = Date.now();
                        ua(y, 2);
                        m = a.F.tc.request(2, g, {
                          isPreload: a.V()
                        });
                        a.X.push(m);
                        return F(y, m.promise, 4);
                      case 4:
                        l = y.h;
                        jb(a.X, m);
                        xa(y, 3);
                        break;
                      case 2:
                        n = ya(y);
                        if (a.l.g) return y.return();
                        q = {
                          sessionId: c.sessionId,
                          sessionType: d.type,
                          initData: d.initData,
                          initDataType: d.initDataType
                        };
                        r = new U(2, 6, 6007, n, q);
                        a.i.size == 1 ? (a.u(r), d && d.Kb && d.Kb.reject(r)) : (d && d.Kb && d.Kb.reject(r), a.i.delete(c), Vh(a) && (a.m.resolve(), a.M.ia(.1)));
                        return y.return();
                      case 3:
                        if (a.l.g) return y.return();
                        a.J += (Date.now() - k) / 1E3;
                        a.h.logLicenseExchange && oc(l.data);
                        ua(y, 5);
                        return F(y, c.update(l.data), 7);
                      case 7:
                        xa(y, 6);
                        break;
                      case 5:
                        return v = (u = ya(y)) && u.message || String(u), w = new U(2, 6, 6008, v), a.u(w), d && d.Kb && d.Kb.reject(w), y.return();
                      case 6:
                        if (a.l.g) return y.return();
                        z = new V("drmsessionupdate");
                        a.F.onEvent(z);
                        d && (d.Kb && d.Kb.resolve(), bi(a, d));
                        G(y);
                    }
                  });
                }
                function di(a, b) {
                  b = b.target;
                  var c = a.i.get(b),
                    d = false;
                  b.keyStatuses.forEach(function (f, g) {
                    if (typeof g == "string") {
                      var h = g;
                      g = f;
                      f = h;
                    }
                    h = tb();
                    if (sg(a.g.keySystem) && g.byteLength == 16 && h.gh()) {
                      h = ac(g);
                      var k = h.getUint32(0, true),
                        l = h.getUint16(4, true),
                        m = h.getUint16(6, true);
                      h.setUint32(0, k, false);
                      h.setUint16(4, l, false);
                      h.setUint16(6, m, false);
                    }
                    f != "status-pending" && (c.loaded = true);
                    f == "expired" && (d = true);
                    g = rc(g).slice(0, 32);
                    a.aa.set(g, f);
                  });
                  var e = b.expiration - Date.now();
                  (e < 0 || d && e < 1E3) && c && !c.Kb && (a.i.delete(b), fi(b));
                  Vh(a) && (a.m.resolve(), a.M.ia(gi));
                }
                function wh(a) {
                  var b = a.aa,
                    c = a.ma;
                  c.clear();
                  b.forEach(function (d, e) {
                    return c.set(e, d);
                  });
                  b = Array.from(c.values());
                  b.length && b.every(function (d) {
                    return d == "expired";
                  }) && a.u(new U(2, 6, 6014));
                  a.F.vf(dh(c));
                }
                function hi() {
                  var a, b, c, d, e, f, g, h, k, l, m, n, q, r, u, v, w, z, y, B, D, I, C, A, E, J, H, K, L, O, Q, N;
                  return P(function (M) {
                    if (M.g == 1) {
                      a = "org.w3.clearkey com.widevine.alpha com.widevine.alpha.experiment com.microsoft.playready com.microsoft.playready.hardware com.microsoft.playready.recommendation com.microsoft.playready.recommendation.3000 com.microsoft.playready.recommendation.3000.clearlead com.chromecast.playready com.apple.fps.1_0 com.apple.fps com.huawei.wiseplay".split(" ");
                      if (!(window.MediaKeys && window.navigator && window.navigator.requestMediaKeySystemAccess && window.MediaKeySystemAccess && window.MediaKeySystemAccess.prototype.getConfiguration)) {
                        b = {};
                        c = t(a);
                        for (d = c.next(); !d.done; d = c.next()) e = d.value, b[e] = null;
                        return M.return(b);
                      }
                      f = "1.0 1.1 1.2 1.3 1.4 2.0 2.1 2.2 2.3".split(" ");
                      g = ["SW_SECURE_CRYPTO", "SW_SECURE_DECODE", "HW_SECURE_CRYPTO", "HW_SECURE_DECODE", "HW_SECURE_ALL"];
                      h = ["150", "2000", "3000"];
                      k = {
                        "com.widevine.alpha": g,
                        "com.widevine.alpha.experiment": g,
                        "com.microsoft.playready.recommendation": h
                      };
                      l = [{
                        contentType: 'video/mp4; codecs="avc1.42E01E"'
                      }, {
                        contentType: 'video/webm; codecs="vp8"'
                      }];
                      m = [{
                        contentType: 'audio/mp4; codecs="mp4a.40.2"'
                      }, {
                        contentType: 'audio/webm; codecs="opus"'
                      }];
                      n = {
                        videoCapabilities: l,
                        audioCapabilities: m,
                        initDataTypes: ["cenc", "sinf", "skd", "keyids"]
                      };
                      q = [null, "cenc", "cbcs"];
                      r = new Map();
                      u = tb();
                      v = function v(R, T, pa) {
                        var Y, Ha, Ba, Ca, za, oa, wa, Fa, Ea, ta, Za, bb, ib;
                        return P(function (Na) {
                          switch (Na.g) {
                            case 1:
                              return ua(Na, 2), F(Na, T.createMediaKeys(), 5);
                            case 5:
                              Y = Na.h;
                            case 4:
                              xa(Na, 3);
                              break;
                            case 2:
                              return ya(Na), Na.return();
                            case 3:
                              Ba = (Ha = T.getConfiguration().sessionTypes) ? Ha.includes("persistent-license") : false;
                              u.ui() && (Ba = false);
                              Ca = T.getConfiguration().videoCapabilities;
                              za = T.getConfiguration().audioCapabilities;
                              oa = {
                                persistentState: Ba,
                                encryptionSchemes: [],
                                videoRobustnessLevels: [],
                                audioRobustnessLevels: [],
                                minHdcpVersions: []
                              };
                              r.get(R) ? oa = r.get(R) : r.set(R, oa);
                              (wa = Ca[0].encryptionScheme) && !oa.encryptionSchemes.includes(wa) && oa.encryptionSchemes.push(wa);
                              (Fa = Ca[0].robustness) && !oa.videoRobustnessLevels.includes(Fa) && oa.videoRobustnessLevels.push(Fa);
                              (Ea = za[0].robustness) && !oa.audioRobustnessLevels.includes(Ea) && oa.audioRobustnessLevels.push(Ea);
                              if (!(pa && "getStatusForPolicy" in Y)) {
                                Na.A(0);
                                break;
                              }
                              ta = t(f);
                              Za = ta.next();
                            case 7:
                              if (Za.done) {
                                Na.A(0);
                                break;
                              }
                              bb = Za.value;
                              if (oa.minHdcpVersions.includes(bb)) {
                                Na.A(8);
                                break;
                              }
                              return F(Na, Y.getStatusForPolicy({
                                minHdcpVersion: bb
                              }), 10);
                            case 10:
                              if (ib = Na.h, ib == "usable") oa.minHdcpVersions.includes(bb) || oa.minHdcpVersions.push(bb);else {
                                Na.A(0);
                                break;
                              }
                            case 8:
                              Za = ta.next(), Na.A(7);
                          }
                        });
                      };
                      w = function w(R, T, pa, Y, Ha) {
                        Ha = Ha === void 0 ? false : Ha;
                        var Ba, Ca, za, oa, wa, Fa, Ea, ta, Za, bb, ib;
                        return P(function (Na) {
                          switch (Na.g) {
                            case 1:
                              ua(Na, 2);
                              Ba = gd(n);
                              Ca = t(Ba.videoCapabilities);
                              for (za = Ca.next(); !za.done; za = Ca.next()) oa = za.value, oa.encryptionScheme = T, oa.robustness = pa;
                              wa = t(Ba.audioCapabilities);
                              for (Fa = wa.next(); !Fa.done; Fa = wa.next()) Ea = Fa.value, Ea.encryptionScheme = T, Ea.robustness = Y;
                              ta = gd(Ba);
                              ta.persistentState = "required";
                              ta.sessionTypes = ["persistent-license"];
                              Za = [ta, Ba];
                              ib = tb();
                              return ib.Ua() == "MOBILE" ? F(Na, hf(5, navigator.requestMediaKeySystemAccess(R, Za)), 7) : F(Na, navigator.requestMediaKeySystemAccess(R, Za), 6);
                            case 6:
                              bb = Na.h;
                              Na.A(5);
                              break;
                            case 7:
                              bb = Na.h;
                            case 5:
                              return F(Na, v(R, bb, Ha), 8);
                            case 8:
                              xa(Na, 0);
                              break;
                            case 2:
                              ya(Na), G(Na);
                          }
                        });
                      };
                      z = t(a);
                      for (y = z.next(); !y.done; y = z.next()) B = y.value, r.set(B, null);
                      D = function D(R) {
                        return tb().Ha() === "WEBKIT" && R === "org.w3.clearkey" ? false : true;
                      };
                      I = [];
                      C = t(a);
                      for (A = C.next(); !A.done; A = C.next()) if (E = A.value, D(E)) {
                        J = true;
                        H = t(q);
                        for (K = H.next(); !K.done; K = H.next()) L = K.value, I.push(w(E, L, "", "", J)), J = false;
                        O = t(k[E] || []);
                        for (Q = O.next(); !Q.done; Q = O.next()) N = Q.value, I.push(w(E, null, N, "")), I.push(w(E, null, "", N));
                      }
                      return F(M, Promise.all(I), 2);
                    }
                    return M.return(dh(r));
                  });
                }
                function fi(a) {
                  return P(function (b) {
                    if (b.g == 1) return ua(b, 2), F(b, hf(ii, Promise.all([a.close().catch(function () {}), a.closed])), 4);
                    if (b.g != 2) return xa(b, 0);
                    ya(b);
                    G(b);
                  });
                }
                function zh(a) {
                  var b;
                  return P(function (c) {
                    b = Array.from(a.i.entries());
                    a.i.clear();
                    return F(c, Promise.all(b.map(function (d) {
                      d = t(d);
                      var e = d.next().value;
                      var f = d.next().value;
                      return P(function (g) {
                        if (g.g == 1) return ua(g, 2), a.qa || a.C.has(e.sessionId) || f.type !== "persistent-license" || a.h.persistentSessionOnlinePlayback ? F(g, fi(e), 5) : F(g, e.remove(), 5);
                        if (g.g != 2) return xa(g, 0);
                        ya(g);
                        G(g);
                      });
                    })), 0);
                  });
                }
                function Kh(a) {
                  return (a.video ? a.video.drmInfos : []).concat(a.audio ? a.audio.drmInfos : []);
                }
                function xh(a) {
                  a.i.forEach(function (b, c) {
                    var d = b.Ug,
                      e = c.expiration;
                    isNaN(e) && (e = Infinity);
                    e != d && (a.F.onExpirationUpdated(c.sessionId, e), b.Ug = e);
                  });
                }
                function Vh(a) {
                  a = a.i.values();
                  return bh(a, function (b) {
                    return b.loaded;
                  });
                }
                function Uh(a) {
                  for (var b = t(a.g && a.g.keyIds || new Set([])), c = b.next(); !c.done; c = b.next()) if (a.aa.get(c.value) !== "usable") return false;
                  return true;
                }
                function Jh(a, b) {
                  var c = [];
                  b.forEach(function (d, e) {
                    c.push({
                      keySystem: e,
                      licenseServerUri: d,
                      distinctiveIdentifierRequired: false,
                      persistentStateRequired: false,
                      audioRobustness: "",
                      videoRobustness: "",
                      serverCertificate: null,
                      serverCertificateUri: "",
                      initData: [],
                      keyIds: new Set()
                    });
                  });
                  a = t(a);
                  for (b = a.next(); !b.done; b = a.next()) b = b.value, b.video && (b.video.drmInfos = c), b.audio && (b.audio.drmInfos = c);
                }
                function $h(a, b, c, d, e, f, g, h) {
                  var k = [];
                  a = t(a);
                  for (var l = a.next(), m = {}; !l.done; m = {
                    Ka: void 0
                  }, l = a.next()) {
                    m.Ka = l.value;
                    b.includes(m.Ka.encryptionScheme) || b.push(m.Ka.encryptionScheme);
                    m.Ka.keySystem == "org.w3.clearkey" && m.Ka.licenseServerUri.startsWith("data:application/json;base64,") ? k.includes(m.Ka.licenseServerUri) || k.push(m.Ka.licenseServerUri) : c.includes(m.Ka.licenseServerUri) || c.push(m.Ka.licenseServerUri);
                    e.includes(m.Ka.serverCertificateUri) || e.push(m.Ka.serverCertificateUri);
                    m.Ka.serverCertificate && (d.some(function (r) {
                      return function (u) {
                        return Ub(u, r.Ka.serverCertificate);
                      };
                    }(m)) || d.push(m.Ka.serverCertificate));
                    if (m.Ka.initData) {
                      l = t(m.Ka.initData);
                      for (var n = l.next(), q = {}; !n.done; q = {
                        Lg: void 0
                      }, n = l.next()) q.Lg = n.value, f.some(function (r) {
                        return function (u) {
                          var v = r.Lg;
                          return u.keyId && u.keyId == v.keyId ? true : u.initDataType == v.initDataType && Ub(u.initData, v.initData);
                        };
                      }(q)) || f.push(q.Lg);
                    }
                    if (m.Ka.keyIds) for (l = t(m.Ka.keyIds), n = l.next(); !n.done; n = l.next()) g.add(n.value);
                    if (m.Ka.keySystemUris && h) for (m = t(m.Ka.keySystemUris), l = m.next(); !l.done; l = m.next()) h.add(l.value);
                  }
                  if (k.length == 1) c.push(k[0]);else if (k.length > 0) {
                    b = [];
                    k = t(k);
                    for (d = k.next(); !d.done; d = k.next()) d = window.atob(d.value.split("data:application/json;base64,").pop()), d = JSON.parse(d), b.push.apply(b, x(d.keys));
                    k = JSON.stringify({
                      keys: b
                    });
                    c.push("data:application/json;base64," + window.btoa(k));
                  }
                }
                function Lh(a, b, c, d) {
                  var e = a.keySystem;
                  if (e && (e != "org.w3.clearkey" || !a.licenseServerUri)) {
                    b.size && b.get(e) && (b = b.get(e), a.licenseServerUri = b);
                    a.keyIds || (a.keyIds = new Set());
                    if (c = c.get(e)) a.distinctiveIdentifierRequired || (a.distinctiveIdentifierRequired = c.distinctiveIdentifierRequired), a.persistentStateRequired || (a.persistentStateRequired = c.persistentStateRequired), a.serverCertificate || (a.serverCertificate = c.serverCertificate), c.sessionType && (a.sessionType = c.sessionType), a.serverCertificateUri || (a.serverCertificateUri = c.serverCertificateUri);
                    d[e] && (a.keySystem = d[e]);
                    window.cast && window.cast.__platform__ && e == "com.microsoft.playready" && (a.keySystem = "com.chromecast.playready");
                  }
                }
                function Ih(a, b) {
                  a = ch(a);
                  if (a.size != 0) {
                    a = wc(a);
                    b = t(b);
                    for (var c = b.next(); !c.done; c = b.next()) c = c.value, c.video && (c.video.drmInfos = [a]), c.audio && (c.audio.drmInfos = [a]);
                  }
                }
                var ii = 1,
                  ci = 5,
                  gi = .5;
                function ji() {
                  this.g = ki;
                  this.i = new Map().set(ki, 2).set(li, 1);
                  this.h = 0;
                }
                function mi(a, b) {
                  var c = a.g !== b;
                  a.g = b;
                  c && b === ki && (a.h = Date.now());
                  return c;
                }
                var li = 0,
                  ki = 1; /*
                          @license
                          Shaka Player
                          Copyright 2023 Google LLC
                          SPDX-License-Identifier: Apache-2.0
                          */
                function ni(a, b, c) {
                  this.g = a;
                  this.i = b;
                  this.h = c;
                }
                function oi(a, b) {
                  return P(function (c) {
                    if (c.g == 1) return F(c, yf(a.h, b, a.g.drm.preferredKeySystems, a.g.drm.keySystemsMapping), 2);
                    a.g.streaming.dontChooseCodecs || uf(b, a.g.preferredVideoCodecs, a.g.preferredAudioCodecs, a.g.preferredDecodingAttributes, a.g.preferredTextFormats);
                    if (!b.variants.some(Zf)) throw new U(2, 4, 4032);
                    return c.return(pi(a, b));
                  });
                }
                function qi(a, b) {
                  var c = a.g.restrictions;
                  a = a.i;
                  var d = false;
                  b = t(b.variants);
                  for (var e = b.next(); !e.done; e = b.next()) {
                    e = e.value;
                    var f = e.allowedByApplication;
                    e.allowedByApplication = xf(e, c, a);
                    f != e.allowedByApplication && (d = true);
                  }
                  return d;
                }
                function pi(a, b) {
                  var c = qi(a, b);
                  if (b) {
                    var d = a.h ? a.h.g : null;
                    if (d && a.h.B) {
                      for (var e = new Set(), f = t(b.variants), g = f.next(); !g.done; g = f.next()) g = g.value, g.audio && e.add(g.audio), g.video && e.add(g.video);
                      e = t(e);
                      for (f = e.next(); !f.done; f = e.next()) ri(a, d.keySystem, f.value);
                    }
                    si(a, b);
                  }
                  return c;
                }
                function ri(a, b, c) {
                  c = t(c.drmInfos);
                  for (var d = c.next(); !d.done; d = c.next()) if (d = d.value, d.keySystem == b) {
                    d = t(d.initData || []);
                    for (var e = d.next(); !e.done; e = d.next()) e = e.value, _Oh(a.h, e.initDataType, e.initData);
                  }
                }
                function si(a, b) {
                  a = a.h ? a.h.Xe() : {};
                  var c = Object.keys(a);
                  c = c.length && c[0] == "00";
                  var d = false,
                    e = false,
                    f = new Set(),
                    g = new Set(),
                    h = new Set();
                  b = t(b.variants);
                  for (var k = b.next(); !k.done; k = b.next()) k = k.value, k.audio && h.add(k.audio), k.video && h.add(k.video), k.allowedByApplication ? k.allowedByKeySystem && (d = true) : e = true;
                  h = t(h);
                  for (b = h.next(); !b.done; b = h.next()) if (b = b.value, b.keyIds.size) for (b = t(b.keyIds), k = b.next(); !k.done; k = b.next()) {
                    k = k.value;
                    var l = a[c ? "00" : k];
                    l ? ti.includes(l) && g.add(l) : f.add(k);
                  }
                  if (!d) throw a = {
                    hasAppRestrictions: e,
                    missingKeys: Array.from(f),
                    restrictedKeyStatuses: Array.from(g)
                  }, new U(2, 4, 4012, a);
                }
                var ti = ["output-restricted", "internal-error"];
                function ui() {}
                function vi(a, b) {
                  wi.set(a, b);
                }
                function xi() {
                  var a = {};
                  tb();
                  if (yi()) for (var b = t(wi.keys()), c = b.next(); !c.done; c = b.next()) a[c.value] = true;
                  b = t(["application/dash+xml", "application/x-mpegurl", "application/vnd.apple.mpegurl", "application/vnd.ms-sstr+xml"]);
                  for (c = b.next(); !c.done; c = b.next()) c = c.value, a[c] = yi() ? wi.has(c) : zi().canPlayType(c) != "";
                  return a;
                }
                function Ai(a, b) {
                  if (b) {
                    var c = wi.get(b.toLowerCase());
                    if (c) return c;
                  }
                  throw new U(2, 4, 4E3, a, b);
                }
                S("shaka.media.ManifestParser", ui);
                ui.unregisterParserByMime = function (a) {
                  wi.delete(a);
                };
                ui.registerParserByMime = vi;
                ui.registerParserByExtension = function () {
                  yb("ManifestParser.registerParserByExtension", "Please use an ManifestParser with registerParserByMime function.");
                };
                ui.AccessibilityPurpose = {
                  ym: "visually impaired",
                  Jl: "hard of hearing",
                  fm: "spoken subtitles"
                };
                var wi = new Map();
                S("shaka.config.CodecSwitchingStrategy", {
                  RELOAD: "reload",
                  SMOOTH: "smooth"
                });
                function Bi(a, b) {
                  var c = null,
                    d = null,
                    e = null,
                    f = null,
                    g = a.U();
                  b & 1 && (e = a.Dd());
                  b & 2 && (f = a.U());
                  b & 8 && (c = a.U());
                  b & 16 && (d = a.U());
                  return {
                    trackId: g,
                    Td: c,
                    Ud: d,
                    lj: e,
                    Mi: f
                  };
                }
                function Ci(a, b) {
                  return b == 1 ? (b = a.U(), a = a.U(), {
                    baseMediaDecodeTime: b * 4294967296 + a
                  }) : {
                    baseMediaDecodeTime: a.U()
                  };
                }
                function Di(a, b) {
                  b == 1 ? (a.skip(8), a.skip(8)) : (a.skip(4), a.skip(4));
                  b = a.U();
                  a.skip(4);
                  a = a.Ca();
                  return {
                    timescale: b,
                    language: String.fromCharCode((a >> 10) + 96) + String.fromCharCode(((a & 960) >> 5) + 96) + String.fromCharCode((a & 31) + 96)
                  };
                }
                function Ei(a, b, c) {
                  var d = a.U(),
                    e = [],
                    f = null;
                  c & 1 && (f = a.Zg());
                  c & 4 && a.skip(4);
                  for (var g = 0; g < d; g++) {
                    var h = {
                      ih: null,
                      sampleSize: null,
                      Cf: null
                    };
                    c & 256 && (h.ih = a.U());
                    c & 512 && (h.sampleSize = a.U());
                    c & 1024 && a.skip(4);
                    c & 2048 && (h.Cf = b == 0 ? a.U() : a.Zg());
                    e.push(h);
                  }
                  return {
                    Dm: d,
                    hh: e,
                    mg: f
                  };
                }
                function Fi(a) {
                  a.skip(6);
                  a.skip(2);
                  a.skip(8);
                  var b = a.Ca();
                  a.skip(2);
                  a.skip(2);
                  a.skip(2);
                  a = a.Ca() + a.Ca() / 65536;
                  return {
                    channelCount: b,
                    sampleRate: a
                  };
                }
                function Gi(a) {
                  a = a.U();
                  return {
                    codec: lh(a)
                  };
                }
                function Hi(a) {
                  var b = null,
                    c = null,
                    d = a.Tb(4, false);
                  var e = String.fromCharCode(d[0]);
                  e += String.fromCharCode(d[1]);
                  e += String.fromCharCode(d[2]);
                  e += String.fromCharCode(d[3]);
                  if (e === "nclx") {
                    switch (a.Ca()) {
                      case 1:
                      case 5:
                      case 6:
                      case 7:
                        b = "srgb";
                        break;
                      case 9:
                        b = "rec2020";
                        break;
                      case 11:
                      case 12:
                        b = "p3";
                    }
                    d = a.Ca();
                    a.Ca();
                    switch (d) {
                      case 1:
                      case 6:
                      case 13:
                      case 14:
                      case 15:
                        c = "SDR";
                        break;
                      case 16:
                        c = "PQ";
                        break;
                      case 18:
                        c = "HLG";
                    }
                  }
                  return {
                    colorGamut: b,
                    ve: c
                  };
                }
                function Ii(a, b) {
                  b = b === void 0 ? false : b;
                  a = a.toString(16).toUpperCase();
                  return b ? a : ("0" + a).slice(-2);
                }
                function Ji(a) {
                  return (a < 10 ? "0" : "") + a;
                }
                function Ki(a) {
                  this.g = a;
                }
                function Li(a) {
                  for (var b = [], c = t(a.g), d = c.next(); !d.done; d = c.next()) {
                    var e = b,
                      f = e.push;
                    var g = d.value;
                    d = Mi;
                    var h = g.id + 1;
                    var k = g.stream.width || 0,
                      l = g.stream.height || 0;
                    g.type == "audio" && (l = k = 0);
                    var m = g.duration * g.timescale,
                      n = Math.floor(m / (Ni + 1));
                    m = Math.floor(m % (Ni + 1));
                    h = new Uint8Array([1, 0, 0, 7, 0, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 3].concat(x(Oi(h, 4)), [0, 0, 0, 0], x(Oi(n, 4)), x(Oi(m, 4)), [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 64, 0, 0, 0], x(Oi(k, 2)), [0, 0], x(Oi(l, 2)), [0, 0]));
                    h = Mi("tkhd", h);
                    k = Mi;
                    n = g.duration * g.timescale;
                    l = Math.floor(n / (Ni + 1));
                    n = Math.floor(n % (Ni + 1));
                    m = g.stream.language;
                    m = m.charCodeAt(0) - 96 << 10 | m.charCodeAt(1) - 96 << 5 | m.charCodeAt(2) - 96;
                    l = new Uint8Array([1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 3].concat(x(Oi(g.timescale, 4)), x(Oi(l, 4)), x(Oi(n, 4)), x(Oi(m, 2)), [0, 0]));
                    l = Mi("mdhd", l);
                    n = g;
                    m = new Uint8Array([]);
                    switch (n.type) {
                      case "video":
                        m = Pi.value();
                        break;
                      case "audio":
                        m = Qi.value();
                    }
                    n = Mi("hdlr", m);
                    a: {
                      switch (g.type) {
                        case "video":
                          g = Mi("minf", Mi("vmhd", Ri.value()), Si.value(), Ti(g));
                          break a;
                        case "audio":
                          g = Mi("minf", Mi("smhd", Ui.value()), Si.value(), Ti(g));
                          break a;
                      }
                      g = new Uint8Array([]);
                    }
                    g = k("mdia", l, n, g);
                    d = d("trak", h, g);
                    f.call(e, d);
                  }
                  b = tc.apply(mc, x(b));
                  f = a.g[0];
                  c = Mi;
                  d = f.duration * f.timescale;
                  e = Math.floor(d / (Ni + 1));
                  d = Math.floor(d % (Ni + 1));
                  e = new Uint8Array([1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 3].concat(x(Oi(f.timescale, 4)), x(Oi(e, 4)), x(Oi(d, 4)), [0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 64, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 255]));
                  e = Mi("mvhd", e);
                  d = [];
                  a = t(a.g);
                  for (k = a.next(); !k.done; k = a.next()) g = d, h = g.push, k = new Uint8Array([0, 0, 0, 0].concat(x(Oi(k.value.id + 1, 4)), [0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0])), k = Mi("trex", k), h.call(g, k);
                  a = tc.apply(mc, x(d));
                  a = Mi("mvex", a);
                  d = [];
                  if (f.encrypted) {
                    f = t(f.stream.drmInfos);
                    for (g = f.next(); !g.done; g = f.next()) if (g = g.value, g.initData) for (g = t(g.initData), h = g.next(); !h.done; h = g.next()) d.push(h.value.initData);
                    f = tc.apply(mc, x(d));
                  } else f = new Uint8Array([]);
                  a = c("moov", e, b, a, f);
                  b = Vi.value();
                  c = new Uint8Array(b.byteLength + a.byteLength);
                  c.set(b);
                  c.set(a, b.byteLength);
                  return c;
                }
                function Ti(a) {
                  var b = Mi,
                    c = "aac";
                  a.codecs.includes("mp3") ? c = "mp3" : a.codecs.includes("ac-3") ? c = tb().oe() ? "ec-3" : "ac-3" : a.codecs.includes("ec-3") ? c = "ec-3" : a.codecs.includes("opus") && (c = "opus");
                  var d = new Uint8Array([]);
                  switch (a.type) {
                    case "video":
                      if (a.codecs.includes("avc1")) {
                        c = a.stream.width || 0;
                        d = a.stream.height || 0;
                        if (a.Ra.byteLength > 0) var e = Mi("avcC", a.Ra);else {
                          e = Mi;
                          for (var f = 7, g = [], h = [], k = 0, l = 0, m = 0, n = 0; n < a.Bb.length; n++) {
                            var q = Wi(a.Bb[n]);
                            switch (q[0] & 31) {
                              case 7:
                                g.push(q);
                                f += q.length + 2;
                                break;
                              case 8:
                                h.push(q), f += q.length + 2;
                            }
                          }
                          g.length > 0 && (k = g[0][1], m = g[0][2], l = g[0][3]);
                          f = new Uint8Array(f);
                          n = 0;
                          f[n++] = 1;
                          f[n++] = k;
                          f[n++] = m;
                          f[n++] = l;
                          f[n++] = 255;
                          f[n++] = 224 | g.length;
                          for (k = 0; k < g.length; k++) f[n++] = (g[k].length & 65280) >> 8, f[n++] = g[k].length & 255, f.set(g[k], n), n += g[k].length;
                          f[n++] = h.length;
                          for (g = 0; g < h.length; g++) f[n++] = (h[g].length & 65280) >> 8, f[n++] = h[g].length & 255, f.set(h[g], n), n += h[g].length;
                          e = e("avcC", f);
                        }
                        c = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0].concat(x(Oi(c, 2)), x(Oi(d, 2)), [0, 72, 0, 0, 0, 72, 0, 0, 0, 0, 0, 0, 0, 1, 19, 118, 105, 100, 101, 111, 106, 115, 45, 99, 111, 110, 116, 114, 105, 98, 45, 104, 108, 115, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 24, 17, 17]));
                        d = "avc1";
                        h = Xi(a);
                        g = new Uint8Array([]);
                        a.encrypted && (g = Yi(a.stream, a.codecs), d = "encv");
                        d = Mi(d, c, e, h, g);
                      } else a.codecs.includes("hvc1") && (d = a.stream.width || 0, e = a.stream.height || 0, c = new Uint8Array([]), a.Ra.byteLength > 0 && (c = Mi("hvcC", a.Ra)), d = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0].concat(x(Oi(d, 2)), x(Oi(e, 2)), [0, 72, 0, 0, 0, 72, 0, 0, 0, 0, 0, 0, 0, 1, 19, 118, 105, 100, 101, 111, 106, 115, 45, 99, 111, 110, 116, 114, 105, 98, 45, 104, 108, 115, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 24, 17, 17])), e = "hvc1", h = Xi(a), g = new Uint8Array([]), a.encrypted && (g = Yi(a.stream, a.codecs), e = "encv"), d = Mi(e, d, c, h, g));
                      break;
                    case "audio":
                      if (c == "mp3") a = Mi(".mp3", Zi(a));else if (c == "ac-3") c = Mi("dac3", a.Ga), d = "ac-3", e = new Uint8Array([]), a.encrypted && (e = Yi(a.stream, a.codecs), d = "enca"), a = Mi(d, Zi(a), c, e);else if (c == "ec-3") c = Mi("dec3", a.Ga), d = "ec-3", e = new Uint8Array([]), a.encrypted && (e = Yi(a.stream, a.codecs), d = "enca"), a = Mi(d, Zi(a), c, e);else if (c == "opus") c = Mi("dOps", a.Ga), d = "Opus", e = new Uint8Array([]), a.encrypted && (e = Yi(a.stream, a.codecs), d = "enca"), a = Mi(d, Zi(a), c, e);else {
                        if (a.Ga.byteLength > 0) c = Mi("esds", a.Ga);else {
                          c = Mi;
                          d = a.id + 1;
                          e = a.stream.channelsCount || 2;
                          g = a.stream.audioSamplingRate || 44100;
                          k = xc("audio", a.codecs.split(","));
                          l = {
                            96E3: 0,
                            88200: 1,
                            64E3: 2,
                            48E3: 3,
                            44100: 4,
                            32E3: 5,
                            24E3: 6,
                            22050: 7,
                            16E3: 8,
                            12E3: 9,
                            11025: 10,
                            8E3: 11,
                            7350: 12
                          };
                          h = l[g];
                          if (k === "mp4a.40.5" || k === "mp4a.40.29") h = l[g * 2];
                          g = parseInt(k.split(".").pop(), 10);
                          d = new Uint8Array([0, 0, 0, 0, 3, 25].concat(x(Oi(d, 2)), [0, 4, 17, 64, 21, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 5, 2, g << 3 | h >>> 1, h << 7 | e << 3, 6, 1, 2]));
                          c = c("esds", d);
                        }
                        d = "mp4a";
                        e = new Uint8Array([]);
                        a.encrypted && (e = Yi(a.stream, a.codecs), d = "enca");
                        a = Mi(d, Zi(a), c, e);
                      }
                      d = a;
                  }
                  a = Mi("stsd", $i.value(), d);
                  return b("stbl", a, Mi("stts", aj.value()), Mi("stsc", bj.value()), Mi("stsz", cj.value()), Mi("stco", dj.value()));
                }
                function Xi(a) {
                  if (!a.Za && !a.$a) return new Uint8Array([]);
                  var b = a.$a;
                  a = new Uint8Array([].concat(x(Oi(a.Za, 4)), x(Oi(b, 4))));
                  return Mi("pasp", a);
                }
                function Zi(a) {
                  return new Uint8Array([0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, a.stream.channelsCount || 2, 0, 16, 0, 0, 0, 0].concat(x(Oi(a.stream.audioSamplingRate || 44100, 2)), [0, 0]));
                }
                function Yi(a, b) {
                  var c = Mi;
                  b = new Uint8Array([].concat(x(Oi(ej(b.split(".")[0]), 4))));
                  b = Mi("frma", b);
                  var d = "cenc";
                  var e = a.drmInfos[0];
                  e && e.encryptionScheme && (d = e.encryptionScheme);
                  d = new Uint8Array([0, 0, 0, 0].concat(x(Oi(ej(d), 4)), [0, 1, 0, 0]));
                  d = Mi("schm", d);
                  e = Mi;
                  var f = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]);
                  a = t(a.drmInfos);
                  for (var g = a.next(); !g.done; g = a.next()) if ((g = g.value) && g.keyIds && g.keyIds.size) {
                    g = t(g.keyIds);
                    for (var h = g.next(); !h.done; h = g.next()) f = Wi(h.value);
                  }
                  a = new Uint8Array([0, 0, 0, 0, 0, 0, 1, 8]);
                  f = Mi("tenc", a, f);
                  return c("sinf", b, d, e("schi", f));
                }
                function fj(a) {
                  var b = [];
                  a = t(a.g);
                  for (var c = a.next(); !c.done; c = a.next()) {
                    c = c.value;
                    var d = b.push,
                      e = d.apply;
                    var f = Mi;
                    var g = new Uint8Array([0, 0, 0, 0].concat(x(Oi(c.data ? c.data.sequenceNumber : 0, 4))));
                    g = Mi("mfhd", g);
                    var h;
                    var k = c.data ? c.data.zb : [];
                    var l = new Uint8Array(4 + k.length);
                    for (h = 0; h < k.length; h++) {
                      var m = k[h].flags;
                      l[h + 4] = m.hb << 4 | m.mb << 2 | m.jb;
                    }
                    k = Mi("sdtp", l);
                    var n = k.length + 32 + 20 + 8 + 16 + 8 + 8;
                    l = Mi;
                    h = new Uint8Array([0, 0, 0, 58].concat(x(Oi(c.id + 1, 4)), [0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]));
                    h = Mi("tfhd", h);
                    m = c.data ? c.data.baseMediaDecodeTime : 0;
                    var q = Math.floor(m % (Ni + 1));
                    m = new Uint8Array([1, 0, 0, 0].concat(x(Oi(Math.floor(m / (Ni + 1)), 4)), x(Oi(q, 4))));
                    m = Mi("tfdt", m);
                    var r = n;
                    n = c.data ? c.data.zb : [];
                    q = n.length;
                    var u = 12 + 16 * q,
                      v = new Uint8Array(u);
                    r += 8 + u;
                    v.set([c.type === "video" ? 1 : 0, 0, 15, 1].concat(x(Oi(q, 4)), x(Oi(r, 4))), 0);
                    for (r = 0; r < q; r++) {
                      var w = n[r];
                      u = Oi(w.duration, 4);
                      var z = Oi(w.size, 4),
                        y = w.flags;
                      w = Oi(w.sb, 4);
                      v.set([].concat(x(u), x(z), [y.xb << 2 | y.hb, y.mb << 6 | y.jb << 4 | y.yb, y.gb & 61440, y.gb & 15], x(w)), 12 + 16 * r);
                    }
                    n = Mi("trun", v);
                    k = l("traf", h, m, n, k);
                    f = f("moof", g, k);
                    e.call(d, b, [f, gj(c)]);
                  }
                  return tc.apply(mc, x(b));
                }
                function gj(a) {
                  a = (a.data ? a.data.zb : []).map(function (b) {
                    return b.data;
                  });
                  a = tc.apply(mc, x(a));
                  return Mi("mdat", a);
                }
                function Oi(a, b) {
                  var c = [];
                  for (--b; b >= 0; b--) c.push(a >> 8 * b & 255);
                  return c;
                }
                function Wi(a) {
                  for (var b = new Uint8Array(a.length / 2), c = 0; c < a.length / 2; c += 1) b[c] = parseInt(String(a[c * 2] + a[c * 2 + 1]), 16);
                  return b;
                }
                function ej(a) {
                  for (var b = 0, c = 0; c < a.length; c += 1) b |= a.charCodeAt(c) << (a.length - c - 1) * 8;
                  return b;
                }
                function Mi(a) {
                  var b = Oa.apply(1, arguments),
                    c = hj.get(a);
                  c || (c = [a.charCodeAt(0), a.charCodeAt(1), a.charCodeAt(2), a.charCodeAt(3)], hj.set(a, c));
                  for (var d = 8, e = b.length - 1; e >= 0; e--) d += b[e].byteLength;
                  e = new Uint8Array(d);
                  e[0] = d >> 24 & 255;
                  e[1] = d >> 16 & 255;
                  e[2] = d >> 8 & 255;
                  e[3] = d & 255;
                  e.set(c, 4);
                  c = 0;
                  for (d = 8; c < b.length; c++) e.set(b[c], d), d += b[c].byteLength;
                  return e;
                }
                var Ni = 4294967295,
                  hj = new Map(),
                  Pi = new sb(function () {
                    return new Uint8Array([0, 0, 0, 0, 0, 0, 0, 0, 118, 105, 100, 101, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 86, 105, 100, 101, 111, 72, 97, 110, 100, 108, 101, 114, 0]);
                  }),
                  Qi = new sb(function () {
                    return new Uint8Array([0, 0, 0, 0, 0, 0, 0, 0, 115, 111, 117, 110, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 83, 111, 117, 110, 100, 72, 97, 110, 100, 108, 101, 114, 0]);
                  }),
                  aj = new sb(function () {
                    return new Uint8Array([0, 0, 0, 0, 0, 0, 0, 0]);
                  }),
                  bj = new sb(function () {
                    return new Uint8Array([0, 0, 0, 0, 0, 0, 0, 0]);
                  }),
                  dj = new sb(function () {
                    return new Uint8Array([0, 0, 0, 0, 0, 0, 0, 0]);
                  }),
                  cj = new sb(function () {
                    return new Uint8Array([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]);
                  }),
                  Ri = new sb(function () {
                    return new Uint8Array([0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0]);
                  }),
                  Ui = new sb(function () {
                    return new Uint8Array([0, 0, 0, 0, 0, 0, 0, 0]);
                  }),
                  $i = new sb(function () {
                    return new Uint8Array([0, 0, 0, 0, 0, 0, 0, 1]);
                  }),
                  Vi = new sb(function () {
                    var a = new Uint8Array([105, 115, 111, 109]),
                      b = new Uint8Array([97, 118, 99, 49]),
                      c = new Uint8Array([0, 0, 0, 1]);
                    return Mi("ftyp", a, c, a, b);
                  }),
                  Si = new sb(function () {
                    var a = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 12, 117, 114, 108, 32, 0, 0, 0, 1]);
                    a = Mi("dref", a);
                    return Mi("dinf", a);
                  });
                function ij(a) {
                  a = Vb(a);
                  var b = null;
                  new hh().box("moov", mh).box("trak", mh).box("mdia", mh).box("minf", mh).box("stbl", mh).S("stsd", oh).box("enca", function (c) {
                    b = c.reader.h;
                    return rh(c);
                  }).box("sinf", mh).box("frma", function (c) {
                    c.parser.stop();
                    Gi(c.reader).codec === "ec-3" && b && b.getUint16(16) !== 2 && b.setUint16(16, 2);
                  }).parse(a);
                  return a;
                }
                function jj(a, b, c) {
                  function d(r) {
                    n.push({
                      box: r,
                      xi: 1701733217
                    });
                  }
                  function e(r) {
                    n.push({
                      box: r,
                      xi: 1701733238
                    });
                  }
                  function f(r) {
                    k = true;
                    r.parser.stop();
                  }
                  function g(r) {
                    m.push(r);
                    mh(r);
                  }
                  var h = b = Vb(b),
                    k = false,
                    l,
                    m = [],
                    n = [];
                  new hh().box("moov", g).box("trak", g).box("mdia", g).box("minf", g).box("stbl", g).S("stsd", function (r) {
                    l = r;
                    m.push(r);
                    oh(r);
                  }).S("encv", f).S("enca", f).S("dvav", e).S("dva1", e).S("dvh1", e).S("dvhe", e).S("dvc1", e).S("dvi1", e).S("hev1", e).S("hvc1", e).S("avc1", e).S("avc3", e).S("ac-3", d).S("ec-3", d).S("ac-4", d).S("Opus", d).S("fLaC", d).S("mp4a", d).parse(b);
                  if (k) return b;
                  if (n.length == 0 || !l) throw gb(rc(b)), new U(2, 3, 3019, c);
                  n.reverse();
                  c = t(n);
                  for (var q = c.next(); !q.done; q = c.next()) q = q.value, h = kj(a, h, l, q.box, m, q.xi);
                  return tb().Hi() ? (a = new Uint8Array(b.byteLength + h.byteLength), a.set(h), a.set(b, h.byteLength), a) : h;
                }
                function lj(a) {
                  a = Vb(a);
                  var b = [];
                  new hh().box("mdat", function (g) {
                    b.push(g);
                  }).parse(a);
                  for (var c = [], d = 0; d < b.length; d++) {
                    var e = b[d - 1],
                      f = b[d];
                    c.push(mj(a.subarray(e ? e.start + e.size : 0, f.start + f.size)));
                  }
                  return tc.apply(mc, x(c));
                }
                function mj(a) {
                  function b(n) {
                    g.push(n);
                    mh(n);
                  }
                  var c,
                    d,
                    e,
                    f,
                    g = [];
                  new hh().box("moof", b).box("traf", b).S("tfhd", function (n) {
                    c = n;
                    e = Bi(n.reader, n.flags);
                  }).S("trun", function (n) {
                    d = n;
                    f = Ei(n.reader, n.version, n.flags);
                  }).parse(a);
                  if (e && e.Mi !== 2) {
                    var h = c.start + nh(c) + 4 + (e.lj !== null ? 8 : 0),
                      k = ac(a);
                    if (e.Mi !== null) k.setUint32(h, 2);else {
                      nj(a, c.start, c.size + 4);
                      var l = k.getUint32(c.start + 8);
                      k.setUint32(c.start + 8, l | 2);
                      f && f.mg !== null && k.setInt32(d.start + nh(d) + 4, f.mg + 4);
                      l = a.subarray(0, h);
                      k = a.subarray(h);
                      a = new Uint8Array(a.byteLength + 4);
                      a.set(l);
                      l = [];
                      for (var m = 3; m >= 0; m--) l.push(2 >> 8 * m & 255);
                      a.set(new Uint8Array(l), h);
                      a.set(k, h + 4);
                      h = t(g);
                      for (k = h.next(); !k.done; k = h.next()) k = k.value, nj(a, k.start, k.size + 4);
                    }
                  }
                  return a;
                }
                function kj(a, b, c, d, e, f) {
                  var g = Yi(a, d.name),
                    h = b.subarray(d.start, d.start + d.size);
                  a = new Uint8Array(d.size + g.byteLength);
                  a.set(h, 0);
                  ac(a).setUint32(4, f);
                  a.set(g, d.size);
                  nj(a, 0, a.byteLength);
                  f = new Uint8Array(b.byteLength + a.byteLength);
                  d = tb().df() ? d.start : d.start + d.size;
                  g = b.subarray(d);
                  f.set(b.subarray(0, d));
                  f.set(a, d);
                  f.set(g, d + a.byteLength);
                  b = t(e);
                  for (e = b.next(); !e.done; e = b.next()) e = e.value, nj(f, e.start, e.size + a.byteLength);
                  a = ac(f, c.start);
                  c = nh(c);
                  b = a.getUint32(c);
                  a.setUint32(c, b + 1);
                  return f;
                }
                function nj(a, b, c) {
                  a = ac(a, b);
                  b = a.getUint32(0);
                  b != 0 && (b == 1 ? (a.setUint32(8, c >> 32), a.setUint32(12, c & 4294967295)) : a.setUint32(0, c));
                }
                function oj(a) {
                  function b(e) {
                    d.push({
                      start: e.start,
                      size: e.size
                    });
                    mh(e);
                  }
                  var c = Vb(a),
                    d = [];
                  new hh().box("moov", b).box("trak", b).box("mdia", b).box("minf", b).box("stbl", b).box("stsd", function (e) {
                    d.push({
                      start: e.start,
                      size: e.size
                    });
                    for (var f = ac(c, e.start), g = 0; g < e.size - 3; g++) {
                      var h = f.getUint32(g);
                      h == 1633889587 ? f.setUint32(g, 1700998451) : h == 1684103987 && f.setUint32(g, 1684366131);
                    }
                  }).parse(c);
                  return c;
                }
                function pj(a, b, c, d, e, f, g, h) {
                  this.P = a;
                  this.startByte = b;
                  this.endByte = c;
                  this.xd = d === void 0 ? null : d;
                  this.timescale = e === void 0 ? null : e;
                  this.h = f === void 0 ? null : f;
                  this.aesKey = g === void 0 ? null : g;
                  this.g = this.mimeType = this.codecs = null;
                  this.encrypted = h === void 0 ? false : h;
                }
                pj.prototype.Ic = function () {
                  return this.startByte;
                };
                pj.prototype.Gc = function () {
                  return this.endByte;
                };
                pj.prototype.pe = function (a) {
                  this.h = a;
                };
                pj.prototype.Yb = function () {
                  return this.h;
                };
                function qj(a, b) {
                  return a === b ? true : a && b ? a.Ic() == b.Ic() && a.Gc() == b.Gc() && lb(a.P().sort(), b.P().sort()) && Ub(a.Yb(), b.Yb()) : a == b;
                }
                S("shaka.media.InitSegmentReference", pj);
                pj.prototype.getEndByte = pj.prototype.Gc;
                pj.prototype.getStartByte = pj.prototype.Ic;
                function rj(a, b, c, d, e, f, g, h, k, l, m, n, q, r, u, v) {
                  l = l === void 0 ? [] : l;
                  r = r === void 0 ? sj : r;
                  this.startTime = a;
                  this.j = this.endTime = b;
                  this.C = c;
                  this.startByte = d;
                  this.endByte = e;
                  this.ba = f;
                  this.timestampOffset = g;
                  this.appendWindowStart = h;
                  this.appendWindowEnd = k;
                  this.g = l;
                  this.tilesLayout = m === void 0 ? "" : m;
                  this.B = n === void 0 ? null : n;
                  this.h = q === void 0 ? null : q;
                  this.status = r;
                  this.preload = false;
                  this.l = true;
                  this.o = false;
                  this.aesKey = u === void 0 ? null : u;
                  this.thumbnailSprite = null;
                  this.i = -1;
                  this.m = v === void 0 ? false : v;
                  this.ee = this.Xc = false;
                  a = t(this.g);
                  for (b = a.next(); !b.done; b = a.next()) b.value.si();
                  this.m && this.g.length && this.g[this.g.length - 1].ri();
                  this.u = this.bandwidth = this.mimeType = this.codecs = null;
                  this.F = false;
                }
                p = rj.prototype;
                p.P = function () {
                  return this.C();
                };
                p.getStartTime = function () {
                  return this.startTime;
                };
                p.Ej = function () {
                  return this.endTime;
                };
                p.Ic = function () {
                  return this.startByte;
                };
                p.Gc = function () {
                  return this.endByte;
                };
                function tj(a) {
                  if (a.endByte) return a.endByte + 1 - a.startByte;
                  if (a.bandwidth) {
                    var b = a.bandwidth * (a.endTime - a.startTime);
                    if (!isNaN(b) && b > 0) return b;
                  }
                  if (a.g.length > 0 && a.m) for (a = t(a.g), a = a.next(); !a.done; a = a.next()) {
                    tj(a.value);
                    break;
                  }
                  return null;
                }
                p.$j = function () {
                  return this.tilesLayout;
                };
                p.Zj = function () {
                  return this.B;
                };
                p.Jc = function () {
                  return this.status;
                };
                p.wk = function () {
                  this.status = uj;
                };
                p.Qg = function () {
                  this.preload = true;
                };
                p.isPreload = function () {
                  return this.preload;
                };
                p.wd = function () {
                  this.l = false;
                };
                p.kk = function () {
                  return this.l;
                };
                p.si = function () {
                  this.Xc = true;
                };
                p.nk = function () {
                  return this.Xc;
                };
                p.ri = function () {
                  this.ee = true;
                };
                p.lk = function () {
                  return this.ee;
                };
                p.pi = function () {
                  this.o = true;
                };
                p.gk = function () {
                  return this.o;
                };
                p.If = function (a) {
                  this.thumbnailSprite = a;
                };
                p.Xj = function () {
                  return this.thumbnailSprite;
                };
                p.offset = function (a) {
                  this.startTime += a;
                  this.endTime += a;
                  this.j += a;
                  for (var b = t(this.g), c = b.next(); !c.done; c = b.next()) c = c.value, c.startTime += a, c.endTime += a, c.j += a;
                };
                p.yh = function (a) {
                  this.h == null ? $a("Sync attempted without sync time!") : (a = this.h - a - this.startTime, Math.abs(a) >= .001 && this.offset(a));
                };
                p.pe = function (a, b) {
                  this.u = a;
                  this.F = b === void 0 ? false : b;
                };
                p.Yb = function (a) {
                  var b = this.u;
                  (a === void 0 || a) && this.F && (this.u = null);
                  return b;
                };
                function vj(a, b) {
                  a.ba = b;
                  a = t(a.g);
                  for (var c = a.next(); !c.done; c = a.next()) vj(c.value, b);
                }
                S("shaka.media.SegmentReference", rj);
                rj.prototype.getSegmentData = rj.prototype.Yb;
                rj.prototype.setSegmentData = rj.prototype.pe;
                rj.prototype.syncAgainst = rj.prototype.yh;
                rj.prototype.offset = rj.prototype.offset;
                rj.prototype.getThumbnailSprite = rj.prototype.Xj;
                rj.prototype.setThumbnailSprite = rj.prototype.If;
                rj.prototype.hasByterangeOptimization = rj.prototype.gk;
                rj.prototype.markAsByterangeOptimization = rj.prototype.pi;
                rj.prototype.isLastPartial = rj.prototype.lk;
                rj.prototype.markAsLastPartial = rj.prototype.ri;
                rj.prototype.isPartial = rj.prototype.nk;
                rj.prototype.markAsPartial = rj.prototype.si;
                rj.prototype.isIndependent = rj.prototype.kk;
                rj.prototype.markAsNonIndependent = rj.prototype.wd;
                rj.prototype.isPreload = rj.prototype.isPreload;
                rj.prototype.markAsPreload = rj.prototype.Qg;
                rj.prototype.markAsUnavailable = rj.prototype.wk;
                rj.prototype.getStatus = rj.prototype.Jc;
                rj.prototype.getTileDuration = rj.prototype.Zj;
                rj.prototype.getTilesLayout = rj.prototype.$j;
                rj.prototype.getEndByte = rj.prototype.Gc;
                rj.prototype.getStartByte = rj.prototype.Ic;
                rj.prototype.getEndTime = rj.prototype.Ej;
                rj.prototype.getStartTime = rj.prototype.getStartTime;
                rj.prototype.getUris = rj.prototype.P;
                var sj = 0,
                  uj = 1;
                rj.Status = {
                  ol: sj,
                  wm: uj,
                  Sl: 2
                };
                function wj(a) {
                  return a.length == 1 && a.end(0) - a.start(0) < 1E-4;
                }
                function xj(a) {
                  return !a || wj(a) ? null : a.length == 1 && a.start(0) < 0 ? 0 : a.length ? a.start(0) : null;
                }
                function yj(a) {
                  return !a || wj(a) ? null : a.length ? a.end(a.length - 1) : null;
                }
                function zj(a, b) {
                  return !a || !a.length || wj(a) || b > a.end(a.length - 1) ? false : b >= a.start(0);
                }
                function Aj(a, b) {
                  if (!a || !a.length || wj(a)) return 0;
                  var c = 0;
                  a = t(Bj(a));
                  for (var d = a.next(); !d.done; d = a.next()) {
                    var e = d.value;
                    d = e.start;
                    e = e.end;
                    e > b && (c += e - Math.max(d, b));
                  }
                  return c;
                }
                function Cj(a, b, c) {
                  if (!a || !a.length || wj(a)) return null;
                  a = Bj(a).findIndex(function (d, e, f) {
                    return d.start > b && (e == 0 || f[e - 1].end - b <= c);
                  });
                  return a >= 0 ? a : null;
                }
                function Bj(a) {
                  if (!a) return [];
                  for (var b = [], c = 0; c < a.length; c++) b.push({
                    start: a.start(c),
                    end: a.end(c)
                  });
                  return b;
                }
                function Dj() {}
                function Ej(a, b) {
                  var c = document.createElement("source");
                  c.src = a;
                  c.type = b === void 0 ? "" : b;
                  return c;
                }
                function Fj(a) {
                  for (var b = false, c = a.getElementsByTagName("source"), d = c.length - 1; d >= 0; --d) a.removeChild(c[d]), b = true;
                  a.src && (a.removeAttribute("src"), b = true);
                  return b;
                }
                function Gj(a) {
                  for (; a.firstChild;) a.removeChild(a.firstChild);
                }
                function zi() {
                  if (Hj) return Hj;
                  Ij || (Ij = new df(function () {
                    Hj = null;
                  }));
                  (Hj = document.getElementsByTagName("video")[0] || document.getElementsByTagName("audio")[0]) || (Hj = document.createElement("video"));
                  Ij.ia(1);
                  return Hj;
                }
                function Jj(a, b) {
                  var c, d, e, f, g;
                  return P(function (h) {
                    if (h.g == 1) return "fonts" in document && "FontFace" in window ? F(h, document.fonts.ready, 2) : h.return();
                    if (!("entries" in document.fonts)) return h.return();
                    c = function c(k) {
                      k = k.entries();
                      for (var l = [], m = k.next(); m.done === false;) l.push(m.value), m = k.next();
                      return l;
                    };
                    d = t(c(document.fonts));
                    for (e = d.next(); !e.done; e = d.next()) if (f = e.value, f.family === a && f.display === "swap") return h.return();
                    g = new FontFace(a, "url(" + b + ")", {
                      display: "swap"
                    });
                    document.fonts.add(g);
                    G(h);
                  });
                }
                S("shaka.util.Dom", Dj);
                Dj.removeAllChildren = Gj;
                Dj.clearSourceFromVideo = Fj;
                var Ij = null,
                  Hj = null; /*
                             @license
                             Shaka Player
                             Copyright 2022 Google LLC
                             SPDX-License-Identifier: Apache-2.0
                             */
                function Lj() {}
                function Mj(a, b) {
                  return b + 10 <= a.length && a[b] === 73 && a[b + 1] === 68 && a[b + 2] === 51 && a[b + 3] < 255 && a[b + 4] < 255 && a[b + 6] < 128 && a[b + 7] < 128 && a[b + 8] < 128 && a[b + 9] < 128 ? true : false;
                }
                function Nj(a, b) {
                  return b + 10 <= a.length && a[b] === 51 && a[b + 1] === 68 && a[b + 2] === 73 && a[b + 3] < 255 && a[b + 4] < 255 && a[b + 6] < 128 && a[b + 7] < 128 && a[b + 8] < 128 && a[b + 9] < 128 ? true : false;
                }
                function Oj(a, b) {
                  var c = (a[b] & 127) << 21;
                  c |= (a[b + 1] & 127) << 14;
                  c |= (a[b + 2] & 127) << 7;
                  return c |= a[b + 3] & 127;
                }
                function Pj(a) {
                  var b = {
                    key: a.type,
                    description: "",
                    data: "",
                    mimeType: null,
                    pictureType: null
                  };
                  if (a.type === "APIC") {
                    if (a.size < 2 || a.data[0] !== 3) return null;
                    var c = a.data.subarray(1).indexOf(0);
                    if (c === -1) return null;
                    var d = dc(Vb(a.data, 1, c)),
                      e = a.data[2 + c],
                      f = a.data.subarray(3 + c).indexOf(0);
                    if (f === -1) return null;
                    var g = dc(Vb(a.data, 3 + c, f)),
                      h;
                    d === "--\x3e" ? h = dc(Vb(a.data, 4 + c + f)) : h = Wb(a.data.subarray(4 + c + f));
                    b.mimeType = d;
                    b.pictureType = e;
                    b.description = g;
                    b.data = h;
                    return b;
                  }
                  if (a.type === "TXXX") {
                    if (a.size < 2 || a.data[0] !== 3) return null;
                    d = a.data.subarray(1).indexOf(0);
                    if (d === -1) return null;
                    c = dc(Vb(a.data, 1, d));
                    a = dc(Vb(a.data, 2 + d)).replace(/\0*$/, "");
                    b.description = c;
                    b.data = a;
                    return b;
                  }
                  if (a.type === "WXXX") {
                    if (a.size < 2 || a.data[0] !== 3) return null;
                    d = a.data.subarray(1).indexOf(0);
                    if (d === -1) return null;
                    c = dc(Vb(a.data, 1, d));
                    a = dc(Vb(a.data, 2 + d)).replace(/\0*$/, "");
                    b.description = c;
                    b.data = a;
                    return b;
                  }
                  if (a.type === "PRIV") {
                    if (a.size < 2) return null;
                    c = a.data.indexOf(0);
                    if (c === -1) return null;
                    c = dc(Vb(a.data, 0, c));
                    b.description = c;
                    c == "com.apple.streaming.transportStreamTimestamp" ? (c = a.data.subarray(c.length + 1), a = c[3] & 1, c = (c[4] << 23) + (c[5] << 15) + (c[6] << 7) + c[7], c /= 45, a && (c += 4.772185884E7), b.data = c) : (a = Wb(a.data.subarray(c.length + 1)), b.data = a);
                    return b;
                  }
                  if (a.type[0] === "T") {
                    if (a.size < 2 || a.data[0] !== 3) return null;
                    a = dc(a.data.subarray(1)).replace(/\0*$/, "");
                    b.data = a;
                    return b;
                  }
                  return a.type[0] === "W" ? (a = dc(a.data).replace(/\0*$/, ""), b.data = a, b) : a.data ? (b.data = Wb(a.data), b) : null;
                }
                function Qj(a) {
                  for (var b = 0, c = []; Mj(a, b);) {
                    var d = Oj(a, b + 6);
                    a[b + 5] >> 6 & 1 && (b += 10);
                    b += 10;
                    for (d = b + d; b + 10 < d;) {
                      var e = a.subarray(b),
                        f = Oj(e, 4);
                      e = {
                        type: String.fromCharCode(e[0], e[1], e[2], e[3]),
                        size: f,
                        data: e.subarray(10, 10 + f)
                      };
                      (f = Pj(e)) && c.push(f);
                      b += e.size + 10;
                    }
                    Nj(a, b) && (b += 10);
                  }
                  return c;
                }
                function Rj(a, b) {
                  for (var c = b = b === void 0 ? 0 : b, d = 0; Mj(a, b);) a[b + 5] >> 6 & 1 && (d += 10), d += 10, d += Oj(a, b + 6), Nj(a, b + 10) && (d += 10), b += d;
                  return d > 0 ? a.subarray(c, c + d) : new Uint8Array([]);
                }
                S("shaka.util.Id3Utils", Lj);
                Lj.getID3Data = Rj;
                Lj.getID3Frames = Qj;
                function Sj(a) {
                  return new Date(Date.UTC(1900, 0, 1, 0, 0, 0, 0) + a).getTime();
                }
                function Tj(a, b) {
                  this.j = a;
                  if (b === void 0 ? 0 : b) {
                    b = new Uint8Array(a.byteLength);
                    for (var c = 0, d = 0; d < a.byteLength; d++) d >= 2 && a[d] == 3 && a[d - 1] == 0 && a[d - 2] == 0 || (b[c] = a[d], c++);
                    this.j = Vb(b, 0, c);
                  }
                  this.i = this.j.byteLength;
                  this.g = this.h = 0;
                }
                function Uj(a) {
                  var b = a.j.byteLength - a.i,
                    c = new Uint8Array(4),
                    d = Math.min(4, a.i);
                  d !== 0 && (c.set(a.j.subarray(b, b + d)), a.h = new eh(c, 0).U(), a.g = d * 8, a.i -= d);
                }
                function Vj(a, b) {
                  if (a.g <= b) {
                    b -= a.g;
                    var c = Math.floor(b / 8);
                    b -= c * 8;
                    a.g -= c;
                    Uj(a);
                  }
                  a.h <<= b;
                  a.g -= b;
                }
                function Wj(a, b) {
                  var c = Math.min(a.g, b),
                    d = a.h >>> 32 - c;
                  a.g -= c;
                  a.g > 0 ? a.h <<= c : a.i > 0 && Uj(a);
                  c = b - c;
                  return c > 0 ? d << c | Wj(a, c) : d;
                }
                function Xj(a) {
                  var b;
                  for (b = 0; b < a.g; ++b) if ((a.h & 2147483648 >>> b) !== 0) return a.h <<= b, a.g -= b, b;
                  Uj(a);
                  return b + Xj(a);
                }
                function Yj(a) {
                  Vj(a, 1 + Xj(a));
                }
                function W(a) {
                  var b = Xj(a);
                  return Wj(a, b + 1) - 1;
                }
                function Zj(a) {
                  a = W(a);
                  return 1 & a ? 1 + a >>> 1 : -1 * (a >>> 1);
                }
                function ak(a) {
                  return Wj(a, 1) === 1;
                }
                function bk(a) {
                  return Wj(a, 8);
                }
                function ck(a, b) {
                  for (var c = 8, d = 8, e = 0; e < b; e++) d !== 0 && (d = Zj(a), d = (c + d + 256) % 256), c = d === 0 ? c : d;
                }
                function dk(a) {
                  bk(a);
                  W(a);
                  return W(a);
                }
                S("shaka.util.ExpGolomb", Tj);
                function ek() {
                  this.I = null;
                  this.J = false;
                  this.m = this.K = null;
                  this.j = [];
                  this.g = [];
                  this.C = this.F = null;
                  this.i = [];
                  this.h = [];
                  this.G = null;
                  this.l = [];
                  this.B = this.H = this.o = this.u = null;
                }
                p = ek.prototype;
                p.clearData = function () {
                  this.j = [];
                  this.g = [];
                  this.i = [];
                  this.h = [];
                  this.l = [];
                };
                p.Gf = function (a) {
                  this.B != null && this.B != a && (this.o = this.u = null);
                  this.B = a;
                };
                p.parse = function (a) {
                  if (a.length < 564) return this;
                  for (var b = Math.max(0, fk(a)), c = a.length - (a.length + b) % 188, d = false, e = b; e < c; e += 188) if (a[e] == 71) {
                    var f = !!(a[e + 1] & 64),
                      g = ((a[e + 1] & 31) << 8) + a[e + 2];
                    if ((a[e + 3] & 48) >> 4 > 1) {
                      var h = e + 5 + a[e + 4];
                      if (h == e + 188) continue;
                    } else h = e + 4;
                    switch (g) {
                      case 0:
                        f && (h += a[h] + 1);
                        this.I = (a[h + 10] & 31) << 8 | a[h + 11];
                        break;
                      case 17:
                      case 8191:
                        break;
                      case this.I:
                        f && (h += a[h] + 1);
                        f = a;
                        g = {
                          audio: -1,
                          video: -1,
                          bf: -1,
                          audioCodec: "",
                          videoCodec: ""
                        };
                        var k = h + 3 + ((f[h + 1] & 15) << 8 | f[h + 2]) - 4;
                        for (h += 12 + ((f[h + 10] & 15) << 8 | f[h + 11]); h < k;) {
                          var l = (f[h + 1] & 31) << 8 | f[h + 2],
                            m = (f[h + 3] & 15) << 8 | f[h + 4];
                          switch (f[h]) {
                            case 6:
                              if (m > 0) for (var n = h + 5, q = m; q > 2;) {
                                var r = f[n + 1] + 2;
                                switch (f[n]) {
                                  case 5:
                                    var u = fc(f.subarray(n + 2, n + r));
                                    g.audio == -1 && u === "Opus" ? (g.audio = l, g.audioCodec = "opus") : g.video == -1 && u === "AV01" && (g.video = l, g.videoCodec = "av1");
                                    break;
                                  case 106:
                                    g.audio == -1 && (g.audio = l, g.audioCodec = "ac3");
                                    break;
                                  case 122:
                                    g.audio == -1 && (g.audio = l, g.audioCodec = "ec3");
                                    break;
                                  case 124:
                                    g.audio == -1 && (g.audio = l, g.audioCodec = "aac");
                                    break;
                                  case 127:
                                    g.audioCodec == "opus" && (u = null, f[n + 2] === 128 && (u = f[n + 3]), u != null && (this.H = {
                                      channelCount: (u & 15) === 0 ? 2 : u & 15,
                                      oj: u,
                                      sampleRate: 48E3
                                    }));
                                }
                                n += r;
                                q -= r;
                              }
                              break;
                            case 15:
                              g.audio == -1 && (g.audio = l, g.audioCodec = "aac");
                              break;
                            case 17:
                              g.audio == -1 && (g.audio = l, g.audioCodec = "aac-loas");
                              break;
                            case 21:
                              g.bf == -1 && (g.bf = l);
                              break;
                            case 27:
                              g.video == -1 && (g.video = l, g.videoCodec = "avc");
                              break;
                            case 3:
                            case 4:
                              g.audio == -1 && (g.audio = l, g.audioCodec = "mp3");
                              break;
                            case 36:
                              g.video == -1 && (g.video = l, g.videoCodec = "hvc");
                              break;
                            case 129:
                              g.audio == -1 && (g.audio = l, g.audioCodec = "ac3");
                              break;
                            case 132:
                            case 135:
                              g.audio == -1 && (g.audio = l, g.audioCodec = "ec3");
                          }
                          h += m + 5;
                        }
                        f = g;
                        f.video != -1 && (this.K = f.video, this.m = f.videoCodec);
                        f.audio != -1 && (this.F = f.audio, this.C = f.audioCodec);
                        f.bf != -1 && (this.G = f.bf);
                        d && !this.J && (d = false, e = b - 188);
                        this.J = true;
                        break;
                      case this.K:
                        h = a.subarray(h, e + 188);
                        f ? this.j.push([h]) : this.j.length && this.j[this.j.length - 1] && this.j[this.j.length - 1].push(h);
                        break;
                      case this.F:
                        h = a.subarray(h, e + 188);
                        f ? this.i.push([h]) : this.i.length && this.i[this.i.length - 1] && this.i[this.i.length - 1].push(h);
                        break;
                      case this.G:
                        h = a.subarray(h, e + 188);
                        f ? this.l.push([h]) : this.l.length && this.l[this.l.length - 1] && this.l[this.l.length - 1].push(h);
                        break;
                      default:
                        d = true;
                    }
                  }
                  return this;
                };
                function gk(a, b) {
                  if ((b[0] << 16 | b[1] << 8 | b[2]) !== 1) return null;
                  var c = {
                    data: new Uint8Array(0),
                    packetLength: b[4] << 8 | b[5],
                    pts: null,
                    dts: null,
                    nalus: []
                  };
                  if (c.packetLength && c.packetLength > b.byteLength - 6) return null;
                  var d = b[7];
                  if (d & 192) {
                    var e = (b[9] & 14) * 536870912 + (b[10] & 255) * 4194304 + (b[11] & 254) * 16384 + (b[12] & 255) * 128 + (b[13] & 254) / 2;
                    a.u == null && (a.u = e);
                    c.pts = hk(e, a.u);
                    a.u = c.pts;
                    c.dts = c.pts;
                    d & 64 && (d = (b[14] & 14) * 536870912 + (b[15] & 255) * 4194304 + (b[16] & 254) * 16384 + (b[17] & 255) * 128 + (b[18] & 254) / 2, a.o == null && (a.o = d), c.dts = c.pts != e ? hk(d, a.o) : d);
                    a.o = c.dts;
                  }
                  a = b[8] + 9;
                  if (b.byteLength <= a) return null;
                  c.data = b.subarray(a);
                  return c;
                }
                p.Dk = function (a) {
                  yb("TsParser.parseAvcNalus", "Please use parseNalus function instead.");
                  return this.Wg(a, {
                    ge: null,
                    state: null
                  });
                };
                p.Wg = function (a, b) {
                  var c = a.pts ? a.pts / 9E4 : null;
                  a = a.data;
                  var d = a.byteLength,
                    e = 1;
                  this.m == "hvc" && (e = 2);
                  var f = b.state || 0,
                    g = f,
                    h = 0,
                    k = [],
                    l = -1,
                    m = 0;
                  f == -1 && (l = 0, m = this.m == "hvc" ? a[0] >> 1 & 63 : a[0] & 31, f = 0, h = 1);
                  for (; h < d;) {
                    var n = a[h++];
                    if (f) {
                      if (f === 1) f = n ? 0 : 2;else if (n) {
                        if (n == 1) {
                          n = h - f - 1;
                          if (l >= 0) k.push({
                            data: a.subarray(l + e, n),
                            fullData: a.subarray(l, n),
                            type: m,
                            time: c,
                            state: null
                          });else if (f = k.length ? k[k.length - 1] : b.ge) g && h <= 4 - g && f.state && (f.data = f.data.subarray(0, f.data.byteLength - g), f.fullData = f.fullData.subarray(0, f.fullData.byteLength - g)), n > 0 && (n = a.subarray(0, n), f.data = tc(f.data, n), f.fullData = tc(f.fullData, n), f.state = 0);
                          h < d ? (m = this.m == "hvc" ? a[h] >> 1 & 63 : a[h] & 31, l = h, f = 0) : f = -1;
                        } else f = 0;
                      } else f = 3;
                    } else f = n ? 0 : 1;
                  }
                  l >= 0 && f >= 0 && k.push({
                    data: a.subarray(l + e, d),
                    fullData: a.subarray(l, d),
                    type: m,
                    time: c,
                    state: f
                  });
                  !k.length && b.ge && (c = k.length ? k[k.length - 1] : b.ge) && (c.data = tc(c.data, a), c.fullData = tc(c.fullData, a));
                  b.state = f;
                  return k;
                };
                p.getMetadata = function () {
                  for (var a = [], b = t(this.l), c = b.next(); !c.done; c = b.next()) c = tc.apply(mc, x(c.value)), (c = gk(this, c)) && a.push({
                    cueTime: c.pts ? c.pts / 9E4 : null,
                    data: c.data,
                    frames: Qj(c.data),
                    dts: c.dts,
                    pts: c.pts
                  });
                  return a;
                };
                p.ub = function () {
                  if (this.i.length && !this.h.length) for (var a = t(this.i), b = a.next(); !b.done; b = a.next()) {
                    var c = tc.apply(mc, x(b.value)),
                      d = gk(this, c);
                    b = this.h.length ? this.h[this.h.length - 1] : null;
                    d && d.pts != null && d.dts != null && (!b || b.pts != d.pts && b.dts != d.dts) ? this.h.push(d) : this.h.length && (c = d ? d.data : c) && (b = this.h.pop(), b.data = tc(b.data, c), this.h.push(b));
                  }
                  return this.h;
                };
                p.ud = function (a) {
                  a = a === void 0 ? true : a;
                  if (this.j.length && !this.g.length) {
                    for (var b = t(this.j), c = b.next(); !c.done; c = b.next()) {
                      var d = tc.apply(mc, x(c.value)),
                        e = gk(this, d);
                      c = this.g.length ? this.g[this.g.length - 1] : null;
                      e && e.pts != null && e.dts != null && (!c || c.pts != e.pts && c.dts != e.dts) ? this.g.push(e) : this.g.length && (d = e ? e.data : d) && (c = this.g.pop(), c.data = tc(c.data, d), this.g.push(c));
                    }
                    if (a) {
                      b = {
                        ge: null,
                        state: null
                      };
                      c = [];
                      d = t(this.g);
                      for (e = d.next(); !e.done; e = d.next()) e = e.value, e.nalus = this.Wg(e, b), e.nalus.length && (c.push(e), b.ge = e.nalus[e.nalus.length - 1]);
                      this.g = c;
                    }
                  }
                  return a ? this.g : (a = this.g, this.g = [], a);
                };
                p.getStartTime = function (a) {
                  if (a == "audio") {
                    a = null;
                    var b = this.ub();
                    b.length && (a = b[0], a = Math.min(a.dts, a.pts) / 9E4);
                    return a;
                  }
                  return a == "video" ? (a = null, b = this.ud(false), b.length && (a = b[0], a = Math.min(a.dts, a.pts) / 9E4), a) : null;
                };
                p.Vd = function () {
                  return {
                    audio: this.C,
                    video: this.m
                  };
                };
                p.$e = function () {
                  for (var a = [], b = t(this.ud()), c = b.next(); !c.done; c = b.next()) a.push.apply(a, x(c.value.nalus));
                  return a;
                };
                p.dk = function () {
                  yb("TsParser.getVideoResolution", "Please use getVideoInfo function instead.");
                  var a = this.Jg();
                  return {
                    height: a.height,
                    width: a.width
                  };
                };
                p.Jg = function () {
                  return this.m == "hvc" ? ik(this) : jk(this);
                };
                function kk(a) {
                  var b = a.ud();
                  return b.length > 1 && (a = b[0].pts, b = b[1].pts, !isNaN(b - a)) ? String(Math.abs(1 / (b - a) * 9E4)) : null;
                }
                function jk(a) {
                  var b = {
                      height: null,
                      width: null,
                      codec: null,
                      frameRate: null
                    },
                    c = a.$e();
                  if (!c.length) return b;
                  c = c.find(function (r) {
                    return r.type == 7;
                  });
                  if (!c) return b;
                  c = new Tj(c.data);
                  var d = bk(c),
                    e = bk(c),
                    f = bk(c);
                  Yj(c);
                  if (lk.includes(d)) {
                    var g = W(c);
                    g === 3 && Vj(c, 1);
                    Yj(c);
                    Yj(c);
                    Vj(c, 1);
                    if (ak(c)) {
                      g = g !== 3 ? 8 : 12;
                      for (var h = 0; h < g; h++) ak(c) && (h < 6 ? ck(c, 16) : ck(c, 64));
                    }
                  }
                  Yj(c);
                  g = W(c);
                  if (g === 0) W(c);else if (g === 1) for (Vj(c, 1), Yj(c), Yj(c), g = W(c), h = 0; h < g; h++) Yj(c);
                  Yj(c);
                  Vj(c, 1);
                  g = W(c);
                  h = W(c);
                  var k = Wj(c, 1);
                  k === 0 && Vj(c, 1);
                  Vj(c, 1);
                  var l = 0,
                    m = 0,
                    n = 0,
                    q = 0;
                  ak(c) && (l = W(c), m = W(c), n = W(c), q = W(c));
                  b.height = String((2 - k) * (h + 1) * 16 - n * 2 - q * 2);
                  b.width = String((g + 1) * 16 - l * 2 - m * 2);
                  b.codec = "avc1." + ("0" + d.toString(16).toUpperCase()).slice(-2) + ("0" + e.toString(16).toUpperCase()).slice(-2) + ("0" + f.toString(16).toUpperCase()).slice(-2);
                  b.frameRate = kk(a);
                  return b;
                }
                function ik(a) {
                  var b = {
                      height: null,
                      width: null,
                      codec: null,
                      frameRate: null
                    },
                    c = a.$e();
                  if (!c.length) return b;
                  c = c.find(function (I) {
                    return I.type == 33;
                  });
                  if (!c) return b;
                  var d = new Tj(c.fullData, true);
                  bk(d);
                  bk(d);
                  Wj(d, 4);
                  var e = Wj(d, 3);
                  ak(d);
                  var f = Wj(d, 2),
                    g = Wj(d, 1),
                    h = Wj(d, 5),
                    k = Wj(d, 32);
                  c = bk(d);
                  for (var l = bk(d), m = bk(d), n = bk(d), q = bk(d), r = bk(d), u = bk(d), v = [], w = [], z = 0; z < e; z++) v.push(ak(d)), w.push(ak(d));
                  if (e > 0) for (z = e; z < 8; z++) Wj(d, 2);
                  for (z = 0; z < e; z++) v[z] && Wj(d, 88), w[z] && bk(d);
                  W(d);
                  e = W(d);
                  e == 3 && Wj(d, 1);
                  v = W(d);
                  w = W(d);
                  var y = z = 0,
                    B = 0,
                    D = 0;
                  ak(d) && (z += W(d), y += W(d), B += W(d), D += W(d));
                  b.width = String(v - (z + y) * (e === 1 || e === 2 ? 2 : 1));
                  b.height = String(w - (B + D) * (e === 1 ? 2 : 1));
                  d = function (I) {
                    for (var C = 0, A = 0; A < 32; A++) C |= (I >> A & 1) << 31 - A;
                    return C >>> 0;
                  }(k);
                  g = g == 1 ? "H" : "L";
                  f = "hvc1" + ("." + ["", "A", "B", "C"][f] + h);
                  f += "." + d.toString(16).toUpperCase();
                  f += "." + g + u;
                  r && (f += "." + r.toString(16).toUpperCase());
                  q && (f += "." + q.toString(16).toUpperCase());
                  n && (f += "." + n.toString(16).toUpperCase());
                  m && (f += "." + m.toString(16).toUpperCase());
                  l && (f += "." + l.toString(16).toUpperCase());
                  c && (f += "." + c.toString(16).toUpperCase());
                  b.codec = f;
                  b.frameRate = kk(a);
                  return b;
                }
                function hk(a, b) {
                  var c = 1;
                  for (a > b && (c = -1); Math.abs(b - a) > 4294967296;) a += c * 8589934592;
                  return a;
                }
                function mk(a) {
                  return fk(a) < 0 ? false : true;
                }
                function fk(a) {
                  for (var b = Math.min(1E3, a.length - 564), c = 0; c < b;) {
                    if (a[c] == 71 && a[c + 188] == 71 && a[c + 376] == 71) return c;
                    c++;
                  }
                  return -1;
                }
                S("shaka.util.TsParser", ek);
                ek.syncOffset = fk;
                ek.probe = mk;
                ek.prototype.getVideoInfo = ek.prototype.Jg;
                ek.prototype.getVideoResolution = ek.prototype.dk;
                ek.prototype.getVideoNalus = ek.prototype.$e;
                ek.prototype.getCodecs = ek.prototype.Vd;
                ek.prototype.getStartTime = ek.prototype.getStartTime;
                ek.prototype.getVideoData = ek.prototype.ud;
                ek.prototype.getAudioData = ek.prototype.ub;
                ek.prototype.getMetadata = ek.prototype.getMetadata;
                ek.prototype.parseNalus = ek.prototype.Wg;
                ek.prototype.parseAvcNalus = ek.prototype.Dk;
                ek.prototype.parse = ek.prototype.parse;
                ek.prototype.setDiscontinuitySequence = ek.prototype.Gf;
                ek.prototype.clearData = ek.prototype.clearData;
                ek.Timescale = 9E4;
                var lk = [100, 110, 122, 244, 44, 83, 86, 118, 128, 138, 139, 134];
                function nk(a, b, c, d, e) {
                  var f = this;
                  this.g = a;
                  this.O = c;
                  this.B = d;
                  this.aa = b;
                  this.l = new Map();
                  this.G = new Map();
                  this.Sa = new Map();
                  this.h = null;
                  this.Fa = false;
                  this.C = e || null;
                  this.o = new Map();
                  this.u = new nb();
                  this.j = new Map();
                  this.J = null;
                  this.M = new zg();
                  this.Da = "";
                  this.ob = false;
                  this.ya = true;
                  this.N = false;
                  this.F = this.R = null;
                  this.i = ok(this, this.M);
                  this.ab = this.H = false;
                  this.K = new Zg(function () {
                    return pk(f);
                  });
                  this.I = false;
                  this.X = "UNKNOWN";
                  this.ib = this.kb = false;
                  this.Ta = new zg();
                  this.m = false;
                  this.xa = null;
                  this.$ = new Map();
                  this.qa = this.T = this.va = this.V = null;
                  this.ma = new zg();
                  this.g.remote && (this.N = this.g.remote.state != "disconnected", this.u.D(this.g.remote, "connect", function () {
                    f.N = f.g.remote.state != "disconnected";
                  }), this.u.D(this.g.remote, "connecting", function () {
                    f.N = f.g.remote.state != "disconnected";
                  }), this.u.D(this.g.remote, "disconnect", function () {
                    f.N = f.g.remote.state != "disconnected";
                  }));
                }
                function ok(a, b) {
                  a.ya = true;
                  if (window.ManagedMediaSource) {
                    a.F || (a.g.disableRemotePlayback = true);
                    var c = new ManagedMediaSource();
                    a.u.D(c, "startstreaming", function () {
                      a.ya = true;
                    });
                    a.u.D(c, "endstreaming", function () {
                      a.ya = false;
                    });
                  } else c = new MediaSource();
                  a.u.Ba(c, "sourceopen", function () {
                    URL.revokeObjectURL(a.Da);
                    b.resolve();
                  });
                  a.u.Ba(a.g, "playing", function () {
                    a.ob = true;
                  });
                  a.Da = qk(c);
                  a.B.useSourceElements ? (a.g.removeAttribute("src"), a.R && a.g.removeChild(a.R), a.F && a.g.removeChild(a.F), a.R = Ej(a.Da), a.g.appendChild(a.R), a.F && a.g.appendChild(a.F), a.g.load()) : a.g.src = a.Da;
                  return c;
                }
                function rk(a, b, c) {
                  a.g && window.ManagedMediaSource && a.i && a.B.useSourceElements && (a.F && a.g.removeChild(a.F), a.F = Ej(b, c), a.g.appendChild(a.F), a.g.disableRemotePlayback = false);
                }
                function sk() {
                  var a = 'video/mp4; codecs="avc1.42E01E",video/mp4; codecs="avc3.42E01E",video/mp4; codecs="hev1.1.6.L93.90",video/mp4; codecs="hvc1.1.6.L93.90",video/mp4; codecs="hev1.2.4.L153.B0"; eotf="smpte2084",video/mp4; codecs="hvc1.2.4.L153.B0"; eotf="smpte2084",video/mp4; codecs="hvc1.2.20000000.L153.B0",video/mp4; codecs="hvc1.2.4.L120.b0",video/mp4; codecs="hvc1.2.4.L123.b0",video/mp4; codecs="vp9",video/mp4; codecs="vp09.00.10.08",video/mp4; codecs="av01.0.01M.08",video/mp4; codecs="dvh1.05.01",video/mp4; codecs="dvh1.08.01",video/mp4; codecs="dav1.10.01",video/mp4; codecs="dvh1.20.01",audio/mp4; codecs="mp4a.40.2",audio/mp4; codecs="ac-3",audio/mp4; codecs="ec-3",audio/mp4; codecs="ac-4.02.01.01",audio/mp4; codecs="opus",audio/mp4; codecs="flac",audio/mp4; codecs="dtsc",audio/mp4; codecs="dtse",audio/mp4; codecs="dtsx",audio/mp4; codecs="apac.31.00",video/webm; codecs="vp8",video/webm; codecs="vp9",video/webm; codecs="vp09.00.10.08",audio/webm; codecs="vorbis",audio/webm; codecs="opus",video/mp2t; codecs="avc1.42E01E",video/mp2t; codecs="avc3.42E01E",video/mp2t; codecs="hvc1.1.6.L93.90",video/mp2t; codecs="mp4a.40.2",video/mp2t; codecs="ac-3",video/mp2t; codecs="ec-3",text/vtt,application/mp4; codecs="wvtt",application/ttml+xml,application/mp4; codecs="stpp"'.split(",").concat(x(Ge)),
                    b = {};
                  tb();
                  a = t(a);
                  for (var c = a.next(); !c.done; c = a.next()) {
                    c = c.value;
                    if (Ve(c)) b[c] = true;else if (yi()) {
                      var d = Ne(c),
                        e = Kf(Oe(c), d);
                      d = Fe(d, e);
                      b[c] = Ic(d) || (ze(d) ? true : false);
                    } else b[c] = zi().canPlayType(c) != "";
                    d = c.split(";")[0];
                    b[d] = b[d] || b[c];
                  }
                  return b;
                }
                p = nk.prototype;
                p.destroy = function () {
                  return this.K.destroy();
                };
                function pk(a) {
                  var b, c, d, e, f, g, h, k, l, m, n, q, r, u, v;
                  return P(function (w) {
                    if (w.g == 1) {
                      b = [];
                      c = t(a.o);
                      for (d = c.next(); !d.done; d = c.next()) for (e = d.value, f = t(e), g = f.next().value, h = f.next().value, k = h[0], l = g, a.o.set(l, h.slice(0, 1)), k && b.push(k.p.catch(ff)), m = t(h.slice(1)), n = m.next(); !n.done; n = m.next()) q = n.value, q.p.reject(new U(2, 7, 7003, void 0));
                      a.h && b.push(a.h.destroy());
                      return F(w, Promise.all(b), 2);
                    }
                    r = t(a.j.values());
                    for (u = r.next(); !u.done; u = r.next()) v = u.value, v.destroy();
                    a.u && (a.u.release(), a.u = null);
                    a.g && a.F && a.g.removeChild(a.F);
                    a.g && a.R && (a.g.removeChild(a.R), a.g.load(), a.g.disableRemotePlayback = false);
                    a.g = null;
                    a.R = null;
                    a.F = null;
                    a.B = null;
                    a.i = null;
                    a.h = null;
                    a.aa = null;
                    a.l.clear();
                    a.Sa.clear();
                    a.j.clear();
                    a.J = null;
                    a.o.clear();
                    a.C = null;
                    a.$.clear();
                    a.O = null;
                    G(w);
                  });
                }
                p.init = function (a, b, c, d) {
                  b = b === void 0 ? false : b;
                  c = c === void 0 ? "UNKNOWN" : c;
                  d = d === void 0 ? false : d;
                  var e = this,
                    f,
                    g,
                    h,
                    k,
                    l,
                    m;
                  return P(function (n) {
                    if (n.g == 1) return f = Cc, F(n, e.M, 2);
                    if (n.g != 3) {
                      if (!tk(e) && !Ck(e)) return n.A(3);
                      $a("Expected MediaSource to be open during init(); reopening the media source.");
                      e.M = new zg();
                      e.i = ok(e, e.M);
                      return F(n, e.M, 3);
                    }
                    e.I = b;
                    e.X = c;
                    e.kb = d;
                    e.ib = !e.I && e.X == "HLS" && !e.kb;
                    e.$.clear();
                    e.V = null;
                    e.va = null;
                    e.T = null;
                    e.qa = null;
                    e.ma = new zg();
                    g = t(a.keys());
                    for (h = g.next(); !h.done; h = g.next()) k = h.value, l = a.get(k), Dk(e, k, l, l.codecs), e.m ? (e.o.set(f.ka, []), e.o.set(f.Aa, [])) : e.o.set(k, []);
                    (m = a.get(f.ka)) && m.isAudioMuxedInVideo && (e.m = true);
                    G(n);
                  });
                };
                function Dk(a, b, c, d) {
                  b == "audio" && d && (d = Kf(d, c.mimeType));
                  var e = Fe(c.mimeType, d);
                  if (b == Ac) Ek(a, e, a.I, c.external);else {
                    var f = a.B.forceTransmux;
                    if (!Ic(e) || !a.I && Ge.includes(e)) f = true;
                    var g = He(c.mimeType, d);
                    if (f) {
                      f = yc("audio", (d || "").split(","));
                      d = yc("video", (d || "").split(","));
                      if (f && d) {
                        a.m = true;
                        Dk(a, "audio", c, f);
                        Dk(a, "video", c, d);
                        return;
                      }
                      if (d = ze(g)) e = d(), a.j.set(b, e), e = e.convertCodecs(b, g);
                    }
                    g = e + a.B.addExtraFeaturesToSourceBuffer(e);
                    $g(a.K);
                    try {
                      var h = a.i.addSourceBuffer(g);
                    } catch (k) {
                      throw new U(2, 3, 3015, k, "The mediaSource_ status was " + a.i.readyState + " expected 'open'", null);
                    }
                    a.I && (h.mode = Fk);
                    a.u.D(h, "error", function () {
                      var k = a.o.get(b)[0];
                      k.p.reject(new U(2, 3, 3014, a.g.error ? a.g.error.code : 0, k.uri));
                    });
                    a.u.D(h, "updateend", function () {
                      return Gk(a, b);
                    });
                    a.l.set(b, h);
                    a.G.set(b, e);
                    a.Sa.set(b, !!c.drmInfos.length);
                  }
                }
                p.configure = function (a) {
                  this.B = a;
                  this.h && (this.h.B = a.modifyCueCallback);
                };
                function Hk(a) {
                  return a.ya && !a.N && !a.H;
                }
                function Ek(a, b, c, d) {
                  a.h || (a.h = new Qe(a.aa), a.h && (a.h.B = a.B.modifyCueCallback));
                  var e = a.h;
                  d = d || a.Fa;
                  a = a.X;
                  b == "application/cea-608" || b == "application/cea-708" ? e.i = null : (e.i = Te.get(b)(), e.i.setSequenceMode ? e.i.setSequenceMode(c) : yb("Text parsers w/ setSequenceMode", 'Text parsers should have a "setSequenceMode" method!'), e.i.setManifestType ? e.i.setManifestType(a) : yb("Text parsers w/ setManifestType", 'Text parsers should have a "setManifestType" method!'), e.C = d);
                }
                function tk(a) {
                  return a.H ? false : a.i ? a.i.readyState == "ended" : true;
                }
                function Ck(a) {
                  return a.H ? false : a.i ? a.i.readyState == "closed" : true;
                }
                function Ik(a, b) {
                  return a.l.size ? b == Ac ? a.h.g : xj(Jk(a, b)) : null;
                }
                function Kk(a, b) {
                  return a.l.size ? b == Ac ? a.h.h : yj(Jk(a, b)) : null;
                }
                function Lk(a, b, c) {
                  if (b == Ac) return a = a.h, a.h == null || a.h < c ? 0 : a.h - Math.max(c, a.g);
                  a = Jk(a, b);
                  return Aj(a, c);
                }
                p.Fc = function () {
                  var a = {
                    total: this.H ? [] : Bj(this.g.buffered),
                    audio: Bj(Jk(this, "audio")),
                    video: Bj(Jk(this, "video")),
                    text: []
                  };
                  if (this.h) {
                    var b = this.h.g,
                      c = this.h.h;
                    b != null && c != null && a.text.push({
                      start: b,
                      end: c
                    });
                  }
                  return a;
                };
                function Jk(a, b) {
                  if (a.H || a.N) return null;
                  try {
                    return a.l.get(b).buffered;
                  } catch (c) {
                    return a.l.has(b), null;
                  }
                }
                function Mk(a, b, c, d, e, f, g) {
                  g = g === void 0 ? false : g;
                  var h = null,
                    k = [],
                    l = Vb(c);
                  if (Ge.includes(f)) c = Qj(l), c.length && d && ((g = c.find(function (u) {
                    return u.description === "com.apple.streaming.transportStreamTimestamp";
                  })) && typeof g.data == "number" && (h = Math.round(g.data) / 1E3), a.O.onMetadata([{
                    cueTime: d.startTime,
                    data: l,
                    frames: c,
                    dts: d.startTime,
                    pts: d.startTime
                  }], 0, d.endTime));else if (f.includes("/mp4") && d && d.ba) {
                    l = new hh();
                    var m = e.emsgSchemeIdUris != null && e.emsgSchemeIdUris.length > 0 || a.B.dispatchAllEmsgBoxes;
                    m && l.S("emsg", function (u) {
                      var v = e.emsgSchemeIdUris;
                      if (u.version === 0) {
                        var w = u.reader.Yc();
                        var z = u.reader.Yc();
                        var y = u.reader.U();
                        var B = u.reader.U();
                        var D = u.reader.U();
                        var I = u.reader.U();
                        var C = d.startTime + B / y;
                      } else y = u.reader.U(), C = u.reader.Dd() / y + d.timestampOffset, B = C - d.startTime, D = u.reader.U(), I = u.reader.U(), w = u.reader.Yc(), z = u.reader.Yc();
                      u = u.reader.Tb(u.reader.getLength() - u.reader.Oa(), true);
                      if (v && v.includes(w) || a.B.dispatchAllEmsgBoxes) if (w == "urn:mpeg:dash:event:2012") a.O.Ck();else if (v = C + D / y, a.O.Ak({
                        startTime: C,
                        endTime: v,
                        schemeIdUri: w,
                        value: z,
                        timescale: y,
                        presentationTimeDelta: B,
                        eventDuration: D,
                        id: I,
                        messageData: u
                      }), w == "https://aomedia.org/emsg/ID3" || w == "https://developer.apple.com/streaming/emsg-id3") if (y = Qj(u), y.length) a.O.onMetadata([{
                        cueTime: C,
                        data: u,
                        frames: y,
                        dts: C,
                        pts: C
                      }], 0, v);
                    });
                    var n = d.ba.timescale;
                    b = n && !isNaN(n);
                    var q = 0,
                      r = false;
                    b && l.S("prft", function (u) {
                      var v = u.reader,
                        w = u.version;
                      v.U();
                      u = v.U();
                      var z = v.U();
                      u = u * 1E3 + z / 4294967296 * 1E3;
                      w === 0 ? v = v.U() : (w = v.U(), v = v.U(), v = w * 4294967296 + v);
                      u = Sj(u);
                      v = new Map().set("detail", {
                        wallClockTime: u,
                        programStartDate: new Date(u - v / n * 1E3)
                      });
                      v = new V("prft", v);
                      a.O.onEvent(v);
                    }).box("moof", mh).box("traf", mh).S("tfdt", function (u) {
                      r || (q = Ci(u.reader, u.version).baseMediaDecodeTime / n, r = true, m || u.parser.stop());
                    });
                    (m || b) && l.parse(c, false, g);
                    r && d.timestampOffset == 0 && (h = q);
                  } else f.includes("/mp4") || f.includes("/webm") || !mk(l) || (a.$.has(b) || a.$.set(b, new ek()), k = a.$.get(b), k.clearData(), k.Gf(d.i), k.parse(l), l = k.getStartTime(b), l != null && (h = l), k = k.getMetadata());
                  return {
                    timestamp: h,
                    metadata: k
                  };
                }
                function Nk(a, b, c, d, e, f, g, h, k, l, m) {
                  g = g === void 0 ? false : g;
                  h = h === void 0 ? false : h;
                  k = k === void 0 ? false : k;
                  l = l === void 0 ? false : l;
                  var n, q, r, u, v, w, z, y, B, D, I, C, A, J, H, K, L, O, Q, N;
                  return P(function (M) {
                    switch (M.g) {
                      case 1:
                        n = Cc;
                        if (b != n.Na) {
                          M.A(2);
                          break;
                        }
                        if (a.X != "HLS") {
                          M.A(3);
                          break;
                        }
                        return F(M, a.Ta, 4);
                      case 4:
                        q = M.h, a.h.u = q;
                      case 3:
                        return F(M, We(a.h, c, d ? d.startTime : null, d ? d.endTime : null, d ? d.P()[0] : null), 5);
                      case 5:
                        return M.return();
                      case 2:
                        if (l || !a.m) {
                          M.A(6);
                          break;
                        }
                        return F(M, Nk(a, n.ka, c, d, e, f, g, h, k, true), 7);
                      case 7:
                        return F(M, Nk(a, n.Aa, c, d, e, f, g, h, k, true), 8);
                      case 8:
                        return M.return();
                      case 6:
                        if (!a.l.has(b)) return M.return();
                        r = a.l.get(b).timestampOffset;
                        u = a.G.get(b);
                        a.j.has(b) && (u = a.j.get(b).getOriginalMimeType());
                        if (d && (v = Mk(a, b, c, d, e, u, k), w = v.timestamp, z = v.metadata, w != null && (a.V == null && b == n.Aa && (a.V = w, a.va = d.startTime, a.T != null && (y = 0, a.va == a.qa && (y = a.V - a.T), a.ma.resolve(y))), a.T == null && b == n.ka && (a.T = w, a.qa = d.startTime, a.V != null && (B = 0, a.va == a.qa && (B = a.V - a.T), a.ma.resolve(B))), D = w, I = Ge, !a.I && I.includes(a.G.get(b)) && (D = 0), C = d.startTime - D, A = Math.abs(r - C), (A >= .001 || g || h) && (!k || C > 0 || !r) && (r = C, a.ib && (Ok(a, b, function () {
                          return Pk(a, b);
                        }, null), Ok(a, b, function () {
                          return Qk(a, b, r);
                        }, null))), (b == n.Aa || !a.l.has(n.Aa)) && a.Ta.resolve(r)), z.length)) a.O.onMetadata(z, r, d ? d.endTime : null);
                        f && b == n.Aa && (a.h || Ek(a, "application/cea-608", a.I, false), a.J || (J = u.split(";", 1)[0], a.J = new Pc(J)), d ? (H = a.J.xf(c), H.length && bf(a.h, H, r)) : a.J.init(c, h, m));
                        if (!a.j.has(b)) {
                          M.A(9);
                          break;
                        }
                        return F(M, a.j.get(b).transmux(c, e, d, a.i.duration, b), 10);
                      case 10:
                        K = M.h, ArrayBuffer.isView(K) ? c = K : (L = K, L.init != null && (O = L.init, Ok(a, b, function () {
                          a.C && Fc(a.C, O, r, e);
                          a.l.get(b).appendBuffer(O);
                        }, d ? d.P()[0] : null)), c = L.data);
                      case 9:
                        c = Rk(a, e, c, d, b);
                        if (!d || !a.I || b == n.Na) {
                          M.A(11);
                          break;
                        }
                        if (!g && !h) {
                          M.A(11);
                          break;
                        }
                        Q = d.startTime;
                        if (a.X != "HLS" || a.m || b != n.ka || !a.l.has(n.Aa)) {
                          M.A(13);
                          break;
                        }
                        return F(M, a.ma, 14);
                      case 14:
                        N = M.h, Math.abs(N) > .15 && (Q -= N);
                      case 13:
                        Ok(a, b, function () {
                          return Pk(a, b);
                        }, null), Ok(a, b, function () {
                          return Qk(a, b, Q);
                        }, null);
                      case 11:
                        return F(M, Ok(a, b, function () {
                          var R = c;
                          a.C && Fc(a.C, R, r, e);
                          a.l.get(b).appendBuffer(R);
                        }, d ? d.P()[0] : null), 15);
                      case 15:
                        G(M);
                    }
                  });
                }
                function Sk(a, b) {
                  var c = Kk(a, "video") || 0;
                  $e(a.h, b, c);
                }
                function Tk(a) {
                  a.h && $e(a.h, "", 0);
                }
                p.remove = function (a, b, c, d) {
                  var e = this,
                    f,
                    g;
                  return P(function (h) {
                    return h.g == 1 ? (f = Cc, a == f.Aa && e.J && (e.J.remove(d), g = e.h.g || 0, e.h.remove(g, c, true)), a == f.Na ? F(h, e.h.remove(b, c), 0) : c > b ? F(h, Ok(e, a, function () {
                      return Uk(e, a, b, c);
                    }, null), 5) : h.A(0)) : e.m ? F(h, Ok(e, f.ka, function () {
                      return Uk(e, f.ka, b, c);
                    }, null), 0) : h.A(0);
                  });
                };
                function Vk(a, b) {
                  var c;
                  return P(function (d) {
                    return d.g == 1 ? (c = Cc, b == c.Na ? a.h ? F(d, a.h.remove(0, Infinity), 0) : d.return() : b === c.Aa && a.J && a.h ? F(d, a.h.remove(0, Infinity, true), 4) : d.A(4)) : d.g != 6 ? F(d, Ok(a, b, function () {
                      return Uk(a, b, 0, a.i.duration);
                    }, null), 6) : a.m ? F(d, Ok(a, c.ka, function () {
                      return Uk(a, c.ka, 0, a.i.duration);
                    }, null), 0) : d.A(0);
                  });
                }
                p.flush = function (a) {
                  var b = this,
                    c;
                  return P(function (d) {
                    return d.g == 1 ? (c = Cc, a == c.Na ? d.return() : F(d, Ok(b, a, function () {
                      b.g.currentTime -= .001;
                      Gk(b, a);
                    }, null), 2)) : b.m ? F(d, Ok(b, c.ka, function () {
                      var e = c.ka;
                      b.g.currentTime -= .001;
                      Gk(b, e);
                    }, null), 0) : d.A(0);
                  });
                };
                function Wk(a, b, c, d, e, f, g, h, k) {
                  var l, m, n;
                  return P(function (q) {
                    if (q.g == 1) {
                      l = Cc;
                      if (b == l.Na) return f || (a.h.u = c), Ze(a.h, d, e), q.return();
                      m = [];
                      return F(q, Xk(a, b, g, h, k), 2);
                    }
                    n = q.h;
                    n || (m.push(Ok(a, b, function () {
                      return Pk(a, b);
                    }, null)), a.m && m.push(Ok(a, l.ka, function () {
                      return Pk(a, l.ka);
                    }, null)));
                    f || (m.push(Ok(a, b, function () {
                      return Qk(a, b, c);
                    }, null)), a.m && m.push(Ok(a, l.ka, function () {
                      return Qk(a, l.ka, c);
                    }, null)));
                    if (d != 0 || e != Infinity) m.push(Ok(a, b, function () {
                      return Yk(a, b, d, e);
                    }, null)), a.m && m.push(Ok(a, l.ka, function () {
                      return Yk(a, l.ka, d, e);
                    }, null));
                    return m.length ? F(q, Promise.all(m), 0) : q.A(0);
                  });
                }
                function Zk(a, b, c) {
                  var d, e;
                  return P(function (f) {
                    if (f.g == 1) {
                      d = Cc;
                      if (b == d.Na) return f.return();
                      b == d.Aa && (a.Ta = new zg());
                      if (!a.I || (e = Kk(a, b)) && Math.abs(e - c) < .15) return f.return();
                      Ok(a, b, function () {
                        return Pk(a, b);
                      }, null);
                      a.m && Ok(a, d.ka, function () {
                        return Pk(a, d.ka);
                      }, null);
                      return F(f, Ok(a, b, function () {
                        return Qk(a, b, c);
                      }, null), 2);
                    }
                    return a.m ? F(f, Ok(a, d.ka, function () {
                      return Qk(a, d.ka, c);
                    }, null), 0) : f.A(0);
                  });
                }
                p.endOfStream = function (a) {
                  var b = this;
                  return P(function (c) {
                    return F(c, $k(b, function () {
                      tk(b) || Ck(b) || (a ? b.i.endOfStream(a) : b.i.endOfStream());
                    }), 0);
                  });
                };
                p.Ab = function (a) {
                  var b = this;
                  return P(function (c) {
                    return F(c, $k(b, function () {
                      if (b.B.durationReductionEmitsUpdateEnd && a < b.i.duration) for (var d = t(b.l.keys()), e = d.next(); !e.done; e = d.next()) {
                        e = e.value;
                        var f = {
                          start: function start() {},
                          p: new zg(),
                          uri: null
                        };
                        b.o.get(e).unshift(f);
                      }
                      b.i.duration = a;
                      b.xa = a;
                    }), 0);
                  });
                };
                p.getDuration = function () {
                  return this.i.duration;
                };
                function al(a, b, c) {
                  P(function (d) {
                    return a.K.g || a.g.error || a.N || a.H || tk(a) || Ck(a) ? d.return() : F(d, $k(a, function () {
                      tk(a) || Ck(a) || a.i.setLiveSeekableRange(b, c);
                    }), 0);
                  });
                }
                function bl(a) {
                  P(function (b) {
                    return a.K.g || a.g.error || a.N || a.H || tk(a) || Ck(a) ? b.return() : F(b, $k(a, function () {
                      tk(a) || Ck(a) || a.i.clearLiveSeekableRange();
                    }), 0);
                  });
                }
                function Uk(a, b, c, d) {
                  if (d <= c) Gk(a, b);else {
                    if (a.C) {
                      var e = a.C;
                      b === "video" && e.g && e.g.flushBuffer(c, d);
                    }
                    a.l.get(b).remove(c, d);
                  }
                }
                function Pk(a, b) {
                  var c = a.l.get(b),
                    d = c.appendWindowStart,
                    e = c.appendWindowEnd;
                  c.abort();
                  c.appendWindowStart = d;
                  c.appendWindowEnd = e;
                  Gk(a, b);
                }
                function Qk(a, b, c) {
                  c < 0 && (c += .001);
                  a.l.get(b).timestampOffset = c;
                  Gk(a, b);
                }
                function Yk(a, b, c, d) {
                  var e = a.l.get(b);
                  if (e.appendWindowEnd !== d || e.appendWindowStart !== c) e.appendWindowStart = 0, e.appendWindowEnd = d, e.appendWindowStart = c;
                  Gk(a, b);
                }
                function Gk(a, b) {
                  if (a.H || a.K.g) {
                    var c = a.o.get(b);
                    c && c.length && ((c = c[0]) && c.p && c.p.resolve(), a.o.set(b, []));
                  } else if (c = a.o.get(b)[0]) c.p.resolve(), cl(a, b);
                }
                function Ok(a, b, c, d) {
                  $g(a.K);
                  c = {
                    start: c,
                    p: new zg(),
                    uri: d
                  };
                  a.o.get(b).push(c);
                  a.o.get(b).length == 1 && dl(a, b);
                  return c.p;
                }
                function $k(a, b) {
                  var c, d, e, f, g, h, k, l, m, n, q, r, u;
                  return P(function (v) {
                    switch (v.g) {
                      case 1:
                        $g(a.K);
                        c = [];
                        d = Array.from(a.l.keys());
                        e = t(d);
                        f = e.next();
                        for (g = {}; !f.done; g = {
                          ready: void 0
                        }, f = e.next()) h = f.value, g.ready = new zg(), k = {
                          start: function (w) {
                            return function () {
                              return w.ready.resolve();
                            };
                          }(g),
                          p: g.ready,
                          uri: null
                        }, l = a.o.get(h), l.push(k), c.push(g.ready), l.length == 1 && k.start();
                        ua(v, 2);
                        return F(v, Promise.all(c), 4);
                      case 4:
                        xa(v, 3);
                        break;
                      case 2:
                        throw m = ya(v), m;
                      case 3:
                        return ua(v, 5, 6), F(v, b(), 6);
                      case 6:
                        Aa(v);
                        n = t(d);
                        for (q = n.next(); !q.done; q = n.next()) r = q.value, cl(a, r);
                        Da(v, 0);
                        break;
                      case 5:
                        throw u = ya(v), new U(2, 3, 3015, u, a.g.error || "No error in the media element", null);
                    }
                  });
                }
                function cl(a, b) {
                  a.o.get(b).shift();
                  dl(a, b);
                }
                function dl(a, b) {
                  var c = a.o.get(b)[0];
                  if (c) try {
                    c.start();
                  } catch (d) {
                    d.name == "QuotaExceededError" ? c.p.reject(new U(2, 3, 3017, b)) : Hk(a) ? c.p.reject(new U(2, 3, 3015, d, a.g.error || "No error in the media element", c.uri)) : c.p.reject(new U(2, 3, 3024, b)), cl(a, b);
                  }
                }
                function el(a, b) {
                  a.aa = b;
                  a.h && (a.h.l = b);
                }
                function Rk(a, b, c, d, e) {
                  if (Je(a.G.get(e)) != "mp4") return c;
                  var f = d === null,
                    g = a.Sa.get(e),
                    h = a.O.Jj(),
                    k = false;
                  d && d.ba && (k = d.ba.encrypted);
                  d = d ? d.P()[0] : null;
                  var l = tb();
                  a.B.correctEc3Enca && f && e === "audio" && (c = ij(c));
                  a.B.insertFakeEncryptionInInit && g && l.Ed(h, e) && (f ? c = jj(b, c, d) : !k && l.Ii(e) && (c = lj(c)));
                  f && l.oe() && (c = oj(c));
                  return c;
                }
                function fl(a, b, c, d) {
                  return Ok(a, b, function () {
                    if (b !== Ac) {
                      a.G.get(b);
                      if (Kc()) {
                        a.j.has(b) && (a.j.get(b).destroy(), a.j.delete(b));
                        d && a.j.set(b, d);
                        var e = c + a.B.addExtraFeaturesToSourceBuffer(c);
                        a.l.get(b).changeType(e);
                        a.G.set(b, c);
                      }
                      Gk(a, b);
                    }
                  }, null);
                }
                function gl(a, b) {
                  var c, d, e, f, g, h, k, l, m, n, q, r, u, v, _w2, z, y, B, D, I;
                  return P(function (C) {
                    if (C.g == 1) {
                      if (a.H || a.N) return C.return();
                      c = Cc;
                      a.H = true;
                      a.m = false;
                      d = a.g.currentTime;
                      e = a.g.autoplay;
                      a.g.paused || (a.ab = true);
                      a.ob && (a.g.autoplay = false);
                      va(C, 2);
                      a.u.Pa();
                      f = t(a.j.values());
                      for (g = f.next(); !g.done; g = f.next()) h = g.value, h.destroy();
                      k = t(a.l.values());
                      for (l = k.next(); !l.done; l = k.next()) {
                        m = l.value;
                        try {
                          a.i.removeSourceBuffer(m);
                        } catch (A) {}
                      }
                      a.j.clear();
                      a.l.clear();
                      n = a.i.duration;
                      a.M = new zg();
                      a.i = ok(a, a.M);
                      return F(C, a.M, 4);
                    }
                    if (C.g != 2) {
                      !isNaN(n) && n ? a.i.duration = n : !isNaN(a.xa) && a.xa && (a.i.duration = a.xa);
                      q = new zg();
                      r = a.i.sourceBuffers;
                      u = b.size;
                      v = 0;
                      _w2 = function w() {
                        v++;
                        v === u && (q.resolve(), a.u.Ma(r, "addsourcebuffer", _w2));
                      };
                      a.u.D(r, "addsourcebuffer", _w2);
                      z = t(b.keys());
                      for (y = z.next(); !y.done; y = z.next()) B = y.value, D = b.get(B), Dk(a, B, D, D.codecs);
                      (I = b.get(c.ka)) && I.isAudioMuxedInVideo && (a.m = true);
                      a.m && !a.o.has(c.ka) && a.o.set(c.ka, []);
                      a.g.currentTime = d;
                      return F(C, q, 2);
                    }
                    Aa(C);
                    a.H = false;
                    $g(a.K);
                    a.u.Ba(a.g, "canplaythrough", function () {
                      a.K.g || (a.g.autoplay = e, a.ab && (a.ab = false, a.g.play()));
                    });
                    return Da(C, 0);
                  });
                }
                function hl(a, b) {
                  return $k(a, function () {
                    return gl(a, b);
                  });
                }
                function il(a, b, c, d) {
                  var e = false,
                    f = yc("audio", (d || "").split(",")),
                    g = yc("video", (d || "").split(",")),
                    h = g;
                  b == "audio" && (h = f);
                  h || (h = d);
                  d = Fe(c, h);
                  var k = Ne(a.G.get(b)),
                    l = a.B.forceTransmux;
                  !Ic(d) || !a.I && Ge.includes(d) ? l = true : l || c == k || (l = !tb().Jf() && Ge.includes(c));
                  if (l && (a = He(c, h), c = ze(a))) {
                    var m = c();
                    f && g && (e = true);
                    d = m.convertCodecs(b, a);
                  }
                  b = Ke(Oe(d));
                  return {
                    dc: m,
                    cl: e,
                    Nh: Ne(d),
                    codec: b,
                    mimeType: d
                  };
                }
                function jl(a, b, c, d, e) {
                  if (b == Ac) return {
                    type: kl,
                    rf: c,
                    dc: null
                  };
                  var f = Ke(Oe(a.G.get(b))),
                    g = Ne(a.G.get(b)),
                    h = il(a, b, c, d),
                    k = h.dc,
                    l = h.cl,
                    m = h.Nh,
                    n = h.codec;
                  h = h.mimeType;
                  var q = true;
                  l && a.G.has("audio") && (c = il(a, "audio", c, d), d = Ke(Oe(a.G.get("audio"))), q = Ne(a.G.get("audio")), q = d == c.codec && q == c.Nh, c.dc && c.dc.destroy());
                  if (f === n && g === m && q) return {
                    type: kl,
                    rf: h,
                    dc: k
                  };
                  f = true;
                  if (a.m && !e.has("audio") || l && k && !a.j.has(b)) f = false;
                  if (f && a.B.codecSwitchingStrategy === "smooth" && Kc()) return {
                    type: ll,
                    rf: h,
                    dc: k
                  };
                  k && k.destroy();
                  return {
                    type: ml,
                    rf: h,
                    dc: null
                  };
                }
                function Xk(a, b, c, d, e) {
                  var f, g, h, k, l, m;
                  return P(function (n) {
                    if (n.g == 1) {
                      f = Cc;
                      g = jl(a, b, c, d, e);
                      h = g.type;
                      k = g.dc;
                      l = g.rf;
                      if (m = e.get(f.ka)) a.m = m.isAudioMuxedInVideo;
                      if (h == kl) return a.j.has(b) && !k ? (a.j.get(b).destroy(), a.j.delete(b)) : !a.j.has(b) && k ? a.j.set(b, k) : k && (a.j.has(b) && a.j.get(b).transmux !== k.transmux ? (a.j.get(b).destroy(), a.j.set(b, k)) : k.destroy()), n.return(false);
                      if (h == ll) return F(n, fl(a, b, l, k), 3);
                      if (h != ml) return n.A(3);
                      k && k.destroy();
                      return F(n, hl(a, e), 3);
                    }
                    return n.return(true);
                  });
                }
                function nl(a, b, c, d, e) {
                  a = jl(a, b, c, d, e);
                  a.dc && a.dc.destroy();
                  return a.type == ml;
                }
                var qk = window.URL.createObjectURL,
                  Fk = "sequence",
                  kl = "none",
                  ml = "reset",
                  ll = "changeType";
                function ol(a, b, c) {
                  this.i = a;
                  this.F = b;
                  this.u = this.l = Infinity;
                  this.h = 1;
                  this.g = this.j = null;
                  this.B = 0;
                  this.C = true;
                  this.J = false;
                  this.I = 0;
                  this.G = c === void 0 ? true : c;
                  this.H = 0;
                  this.o = false;
                  this.m = a;
                }
                p = ol.prototype;
                p.getDuration = function () {
                  return this.l;
                };
                p.Mj = function () {
                  return this.h;
                };
                p.Ri = function (a) {
                  this.i = a;
                };
                p.Ab = function (a) {
                  this.l = a;
                };
                p.Sj = function () {
                  return this.i;
                };
                p.Qi = function (a) {
                  this.B = a;
                };
                p.cd = function (a) {
                  a && !this.C && (this.J = true);
                  this.C = a;
                };
                p.Hf = function (a) {
                  this.u = a;
                };
                p.Ze = function () {
                  return this.u;
                };
                p.nh = function (a) {
                  this.F = a;
                };
                p.Dj = function () {
                  return this.F;
                };
                p.Bi = function (a, b) {
                  if (a.length != 0) {
                    var c = (Date.now() + this.B) / 1E3;
                    a = a.filter(function (e) {
                      return e.start + b < c;
                    });
                    if (a.length != 0) {
                      var d = a[a.length - 1].end + b;
                      this.tf(a[0].start + b);
                      this.h = a.reduce(function (e, f) {
                        return Math.max(e, f.end - f.start);
                      }, this.h);
                      this.g = Math.max(this.g, d);
                      this.i != null && this.G && !this.o && (this.i = c - this.g - this.h);
                    }
                  }
                };
                p.ie = function (a) {
                  if (a.length != 0) {
                    var b = a[0].startTime,
                      c = a[0].endTime,
                      d = (Date.now() + this.B) / 1E3;
                    a = t(a);
                    for (var e = a.next(); !e.done; e = a.next()) e = e.value, d < e.startTime || (b = Math.min(b, e.startTime), c = Math.max(c, e.endTime), this.h = Math.max(this.h, e.endTime - e.startTime));
                    this.tf(b);
                    this.g = Math.max(this.g, c);
                    this.i != null && this.G && !this.o && (this.i = d - this.g - this.h);
                  }
                };
                p.Ai = function (a, b) {
                  this.tf(a);
                  b == Infinity || this.W() || (this.g = Math.max(this.g, b));
                };
                p.Nj = function () {
                  return this.g;
                };
                p.lf = function () {
                  this.o = true;
                };
                p.pk = function () {
                  return this.o;
                };
                p.oh = function (a) {
                  this.m = a;
                };
                p.Ij = function () {
                  return this.m;
                };
                p.tf = function (a) {
                  this.j == null ? this.j = a : this.J || (this.j = Math.min(this.j, a));
                };
                p.Sg = function (a) {
                  this.h = Math.max(this.h, a);
                };
                p.offset = function (a) {
                  this.j != null && (this.j += a);
                  this.g != null && (this.g += a);
                };
                p.W = function () {
                  return this.l == Infinity && !this.C;
                };
                p.Vc = function () {
                  return this.l != Infinity && !this.C;
                };
                p.Hb = function () {
                  return Math.max(this.I, this.Hc() - this.u);
                };
                p.Ti = function (a) {
                  this.I = a;
                };
                p.Hc = function () {
                  return this.W() || this.Vc() ? Math.min(Math.max(0, (Date.now() + this.B) / 1E3 - this.h - this.i) + this.H, this.l) : this.g ? Math.min(this.g, this.l) : this.l;
                };
                p.Xd = function (a) {
                  var b = Math.max(this.j, this.I);
                  return this.u == Infinity ? Math.ceil(b * 1E3) / 1E3 : Math.max(b, Math.min(this.Hc() - this.u + a, this.Gb()));
                };
                p.Xb = function () {
                  return this.Xd(0);
                };
                p.Gb = function () {
                  return Math.max(0, this.Hc() - (this.W() || this.Vc() ? this.F : 0));
                };
                p.fj = function () {
                  return this.i == null || this.g != null && this.G ? false : true;
                };
                p.Pi = function (a) {
                  this.H = a;
                };
                p.yj = function () {
                  return this.H;
                };
                S("shaka.media.PresentationTimeline", ol);
                ol.prototype.getAvailabilityTimeOffset = ol.prototype.yj;
                ol.prototype.setAvailabilityTimeOffset = ol.prototype.Pi;
                ol.prototype.usingPresentationStartTime = ol.prototype.fj;
                ol.prototype.getSeekRangeEnd = ol.prototype.Gb;
                ol.prototype.getSeekRangeStart = ol.prototype.Xb;
                ol.prototype.getSafeSeekRangeStart = ol.prototype.Xd;
                ol.prototype.getSegmentAvailabilityEnd = ol.prototype.Hc;
                ol.prototype.setUserSeekStart = ol.prototype.Ti;
                ol.prototype.getSegmentAvailabilityStart = ol.prototype.Hb;
                ol.prototype.isInProgress = ol.prototype.Vc;
                ol.prototype.isLive = ol.prototype.W;
                ol.prototype.offset = ol.prototype.offset;
                ol.prototype.notifyMaxSegmentDuration = ol.prototype.Sg;
                ol.prototype.notifyMinSegmentStartTime = ol.prototype.tf;
                ol.prototype.getInitialProgramDateTime = ol.prototype.Ij;
                ol.prototype.setInitialProgramDateTime = ol.prototype.oh;
                ol.prototype.isStartTimeLocked = ol.prototype.pk;
                ol.prototype.lockStartTime = ol.prototype.lf;
                ol.prototype.getMaxSegmentEndTime = ol.prototype.Nj;
                ol.prototype.notifyPeriodDuration = ol.prototype.Ai;
                ol.prototype.notifySegments = ol.prototype.ie;
                ol.prototype.notifyTimeRange = ol.prototype.Bi;
                ol.prototype.getDelay = ol.prototype.Dj;
                ol.prototype.setDelay = ol.prototype.nh;
                ol.prototype.getSegmentAvailabilityDuration = ol.prototype.Ze;
                ol.prototype.setSegmentAvailabilityDuration = ol.prototype.Hf;
                ol.prototype.setStatic = ol.prototype.cd;
                ol.prototype.setClockOffset = ol.prototype.Qi;
                ol.prototype.getPresentationStartTime = ol.prototype.Sj;
                ol.prototype.setDuration = ol.prototype.Ab;
                ol.prototype.setPresentationStartTime = ol.prototype.Ri;
                ol.prototype.getMaxSegmentDuration = ol.prototype.Mj;
                ol.prototype.getDuration = ol.prototype.getDuration;
                function pl(a, b, c, d) {
                  var e = this;
                  this.u = d;
                  this.g = a;
                  this.F = b;
                  this.h = c;
                  this.j = new nb();
                  this.m = false;
                  this.l = 0;
                  this.C = false;
                  this.H = this.G = 0;
                  this.o = ql(this);
                  this.B = false;
                  this.j.D(a, "waiting", function () {
                    return rl(e);
                  });
                  this.i = new df(function () {
                    rl(e);
                  }).Ea(this.h.gapJumpTimerTime);
                }
                pl.prototype.release = function () {
                  this.j && (this.j.release(), this.j = null);
                  this.i != null && (this.i.stop(), this.i = null);
                  this.o && (this.o.release(), this.o = null);
                  this.g = this.F = this.u = null;
                };
                pl.prototype.wf = function () {
                  this.B = true;
                  this.i && this.i.Ea(this.h.gapJumpTimerTime);
                  rl(this);
                };
                function rl(a) {
                  if (a.g.readyState != 0) {
                    if (a.g.seeking) {
                      if (!a.m) return;
                    } else a.m = false;
                    if (!a.g.paused || a.g.currentTime == a.l && (a.g.autoplay || a.g.currentTime != a.l)) {
                      var b;
                      if (!(b = !a.o)) {
                        b = a.o;
                        var c = b.h,
                          d = sl(c),
                          e = c.g.currentTime,
                          f = Date.now() / 1E3;
                        if (b.g != e || b.m != d) b.l = f, b.g = e, b.m = d, b.i = false;
                        e = f - b.l;
                        if (d = e >= b.o && d && !b.i) b.j && b.j(b.g, e), b.i = true, b.g = c.g.currentTime;
                        b = !d;
                      }
                      b && (b = a.g.currentTime, c = a.g.buffered, d = Cj(c, b, a.h.gapDetectionThreshold), d == null || d == 0 && !a.B || (e = c.start(d), (f = a.h.gapPadding) && (e = Math.ceil((e + f) * 100) / 100), e >= a.F.Gb() || e - b < .001 || (d != 0 && c.end(d - 1), tl(a, e), b == a.l && (a.l = e), a.G++, a.u(new V("gapjumped")))));
                    }
                  }
                }
                function tl(a, b) {
                  a.C = true;
                  a.j.Ba(a.g, "seeked", function () {
                    a.C = false;
                  });
                  a.g.currentTime = b;
                }
                function ql(a) {
                  if (!a.h.stallEnabled) return null;
                  var b = a.h.stallThreshold,
                    c = a.h.stallSkip;
                  return new ul(new vl(a.g), b, function () {
                    var d;
                    return P(function (e) {
                      if (e.g == 1) return d = Bj(a.g.buffered), d.length ? c ? (a.g.currentTime += c, e.A(2)) : F(e, a.g.play(), 3) : e.return();
                      if (e.g != 2) {
                        if (!a.g) return e.return();
                        a.g.pause();
                        a.g.play();
                      }
                      a.H++;
                      a.u(new V("stalldetected"));
                      G(e);
                    });
                  });
                }
                function ul(a, b, c) {
                  this.h = a;
                  this.m = sl(a);
                  this.g = a.g.currentTime;
                  this.l = Date.now() / 1E3;
                  this.i = false;
                  this.o = b;
                  this.j = c;
                }
                ul.prototype.release = function () {
                  this.h && this.h.release();
                  this.j = this.h = null;
                };
                function vl(a) {
                  var b = this;
                  this.g = a;
                  this.h = new nb();
                  this.i = false;
                  this.h.D(this.g, "audiofocuspaused", function () {
                    b.i = true;
                  });
                  this.h.D(this.g, "audiofocusgranted", function () {
                    b.i = false;
                  });
                  this.h.D(this.g, "audiofocuslost", function () {
                    b.i = true;
                  });
                }
                function sl(a) {
                  if (a.g.paused || a.g.playbackRate == 0 || a.i || a.g.buffered.length == 0) var b = false;else a: {
                    b = a.g.currentTime;
                    a = t(Bj(a.g.buffered));
                    for (var c = a.next(); !c.done; c = a.next()) if (c = c.value, !(b < c.start - .1 || b > c.end - .5)) {
                      b = true;
                      break a;
                    }
                    b = false;
                  }
                  return b;
                }
                vl.prototype.release = function () {
                  this.h && this.h.release();
                  this.h = null;
                };
                function wl(a, b, c, d) {
                  b == HTMLMediaElement.HAVE_NOTHING || a.readyState >= b ? d() : (b = xl.value().get(b), c.Ba(a, b, d));
                }
                var xl = new sb(function () {
                  return new Map([[HTMLMediaElement.HAVE_METADATA, "loadedmetadata"], [HTMLMediaElement.HAVE_CURRENT_DATA, "loadeddata"], [HTMLMediaElement.HAVE_FUTURE_DATA, "canplay"], [HTMLMediaElement.HAVE_ENOUGH_DATA, "canplaythrough"]]);
                });
                function yl(a, b, c, d) {
                  var e = this;
                  this.g = a;
                  this.m = b;
                  this.u = c;
                  this.l = null;
                  this.j = function () {
                    e.l == null && (e.l = d());
                    return e.l;
                  };
                  this.o = false;
                  this.h = new nb();
                  this.i = new zl(a);
                  wl(this.g, HTMLMediaElement.HAVE_METADATA, this.h, function () {
                    Al(e, e.j());
                  });
                }
                yl.prototype.release = function () {
                  this.h && (this.h.release(), this.h = null);
                  this.i != null && (this.i.release(), this.i = null);
                  this.m = function () {};
                  this.g = null;
                };
                function Bl(a) {
                  return a.o ? a.g.currentTime : a.j();
                }
                function Cl(a, b) {
                  a.g.readyState > 0 ? Dl(a.i, b) : wl(a.g, HTMLMediaElement.HAVE_METADATA, a.h, function () {
                    Al(a, a.j());
                  });
                }
                function Al(a, b) {
                  Math.abs(a.g.currentTime - b) < .001 ? El(a) : (a.h.Ba(a.g, "seeking", function () {
                    El(a);
                  }), Dl(a.i, a.g.currentTime && a.g.currentTime != 0 ? a.g.currentTime : b));
                }
                function El(a) {
                  a.o = true;
                  a.h.D(a.g, "seeking", function () {
                    return a.m();
                  });
                  a.u(a.g.currentTime);
                }
                function zl(a) {
                  var b = this;
                  this.g = a;
                  this.m = 10;
                  this.j = this.l = this.i = 0;
                  this.h = new df(function () {
                    b.i <= 0 ? b.h.stop() : b.g.currentTime != b.l || b.g.currentTime === b.j ? b.h.stop() : (b.g.currentTime = b.j, b.i--);
                  });
                }
                zl.prototype.release = function () {
                  this.h && (this.h.stop(), this.h = null);
                  this.g = null;
                };
                function Dl(a, b) {
                  a.l = a.g.currentTime;
                  a.j = b;
                  a.i = a.m;
                  a.g.currentTime = b;
                  a.h.Ea(.1);
                }
                function Fl(a) {
                  this.g = a;
                  this.i = false;
                  this.h = null;
                  this.j = new nb();
                }
                p = Fl.prototype;
                p.ready = function () {
                  function a() {
                    if (b.h == null || b.h == 0 && b.g.duration != Infinity) b.i = true;else {
                      var c = b.g.currentTime,
                        d = null;
                      if (typeof b.h === "number") d = b.h;else if (b.h instanceof Date) {
                        var e = Gl(b);
                        e !== null && (d = b.h.getTime() / 1E3 - e, d = Hl(b, d));
                      }
                      d == null ? b.i = true : (d < 0 && (d = Math.max(0, c + d)), c != d ? (b.j.Ba(b.g, "seeking", function () {
                        b.i = true;
                      }), b.g.currentTime = d) : b.i = true);
                    }
                  }
                  var b = this;
                  wl(this.g, HTMLMediaElement.HAVE_FUTURE_DATA, this.j, function () {
                    a();
                  });
                };
                p.release = function () {
                  this.j && (this.j.release(), this.j = null);
                  this.g = null;
                };
                p.Wf = function (a) {
                  this.h = this.i ? this.h : a;
                };
                p.He = function () {
                  var a = this.i ? this.g.currentTime : this.h;
                  a instanceof Date && (a = a.getTime() / 1E3 - (Gl(this) || 0), a = Hl(this, a));
                  return a || 0;
                };
                p.Ih = function () {
                  return 0;
                };
                p.Gh = function () {
                  return 0;
                };
                p.Hh = function () {
                  return false;
                };
                p.zi = function () {};
                p.ki = function () {
                  var a = yj(this.g.buffered);
                  return a != null && a >= this.g.duration - 1;
                };
                function Gl(a) {
                  return a.g.getStartDate && (a = a.g.getStartDate().getTime(), !isNaN(a)) ? a / 1E3 : null;
                }
                function Hl(a, b) {
                  a = a.g.seekable;
                  a.length > 0 && (b = Math.max(a.start(0), b), b = Math.min(a.end(a.length - 1), b));
                  return b;
                }
                function Il(a, b, c, d, e, f) {
                  var g = this;
                  this.h = a;
                  this.g = b.presentationTimeline;
                  this.l = c;
                  this.u = e;
                  this.o = null;
                  this.i = new pl(a, b.presentationTimeline, c, f);
                  this.j = new yl(a, function () {
                    a: {
                      var h = g.i;
                      h.m = true;
                      h.B = false;
                      h.i && h.i.Ea(h.h.gapJumpTimerTime);
                      rl(h);
                      var k = Bl(g.j);
                      h = Jl(g, k);
                      if (!Lc() && Math.abs(h - k) > .001) {
                        k = false;
                        var l = tb().Ni();
                        if (l) {
                          var m = Date.now() / 1E3;
                          if (!g.o || g.o < m - l) g.o = m, k = true;
                        } else k = true;
                        if (k) {
                          Cl(g.j, h);
                          h = void 0;
                          break a;
                        }
                      }
                      g.u();
                      h = void 0;
                    }
                    return h;
                  }, function (h) {
                    var k = g.i;
                    k.g.seeking && !k.m && (k.m = true, k.l = h);
                    k.i && k.i.Ea(k.h.gapJumpTimerTime);
                    rl(k);
                  }, function () {
                    return Kl(g, d);
                  });
                  this.m = new df(function () {
                    if (g.h.readyState != 0 && !g.h.paused) {
                      var h = Bl(g.j),
                        k = g.g.Xb(),
                        l = g.g.Gb();
                      l - k < 3 && (k = l - 3);
                      h < k && (h = Jl(g, h), g.h.currentTime = h);
                    }
                  });
                }
                p = Il.prototype;
                p.ready = function () {
                  this.m.Ea(.25);
                };
                p.release = function () {
                  this.j && (this.j.release(), this.j = null);
                  this.i && (this.i.release(), this.i = null);
                  this.m && (this.m.stop(), this.m = null);
                  this.h = this.j = this.g = this.l = null;
                  this.u = function () {};
                };
                p.Wf = function (a) {
                  Cl(this.j, Kl(this, a));
                };
                p.He = function () {
                  var a = Bl(this.j);
                  return this.h.readyState > 0 && !this.h.paused ? Ll(this, a) : a;
                };
                p.Ih = function () {
                  return this.i.H;
                };
                p.Gh = function () {
                  return this.i.G;
                };
                p.Hh = function () {
                  return this.i.C;
                };
                function Kl(a, b) {
                  b == null ? b = a.g.getDuration() < Infinity ? a.g.Xb() : a.g.Gb() : b instanceof Date ? b = b.getTime() / 1E3 - (a.g.m || a.g.i) : b < 0 && (b = a.g.Gb() + b);
                  return Ml(a, Ll(a, b));
                }
                p.zi = function () {
                  this.i.wf();
                };
                p.ki = function () {
                  if (this.g.W()) {
                    var a = this.g.Hc(),
                      b = yj(this.h.buffered);
                    if (b != null && b >= a) return true;
                  }
                  return false;
                };
                function Ml(a, b) {
                  var c = a.g.getDuration();
                  return b >= c ? c - a.l.durationBackoff : b;
                }
                function Jl(a, b) {
                  var c = a.l.rebufferingGoal,
                    d = a.l.safeSeekOffset,
                    e = a.g.Xb(),
                    f = a.g.Gb(),
                    g = a.g.getDuration();
                  f - e < 3 && (e = f - 3);
                  var h = a.g.Xd(c),
                    k = a.g.Xd(d);
                  c = a.g.Xd(c + d);
                  return b >= g ? Ml(a, b) : b > f ? f - a.l.safeSeekEndOffset : b < e ? a.g.W() && a.l.returnToEndOfLiveWindowWhenOutside ? f - a.l.safeSeekEndOffset : zj(a.h.buffered, k) ? k : c : b >= h || zj(a.h.buffered, b) ? b : c;
                }
                function Ll(a, b) {
                  var c = a.g.Xb();
                  if (b < c) return c;
                  a = a.g.Gb();
                  return b > a ? a : b;
                }
                function Nl(a) {
                  this.g = a;
                  this.m = null;
                  this.i = 0;
                  this.o = false;
                }
                p = Nl.prototype;
                p.getNumReferences = function () {
                  return this.g.length;
                };
                p.getNumEvicted = function () {
                  return this.i;
                };
                p.release = function () {
                  this.o || (this.g = [], this.m && this.m.stop(), this.m = null);
                };
                p.xk = function () {
                  this.o = true;
                };
                p.Fb = function (a) {
                  for (var b = t(this.g), c = b.next(); !c.done; c = b.next()) a(c.value);
                };
                function Uf(a) {
                  return a.g[0] || null;
                }
                p.find = function (a) {
                  for (var b = this.g.length - 1, c = b; c >= 0; --c) {
                    var d = this.g[c],
                      e = c < b ? this.g[c + 1].startTime : d.endTime;
                    if (a >= d.startTime && a < e) return c + this.i;
                  }
                  return this.g.length && a < this.g[0].startTime ? this.i : null;
                };
                p.get = function (a) {
                  if (this.g.length == 0) return null;
                  a -= this.i;
                  return a < 0 || a >= this.g.length ? null : this.g[a];
                };
                p.offset = function (a) {
                  if (!this.o) for (var b = t(this.g), c = b.next(); !c.done; c = b.next()) c.value.offset(a);
                };
                p.nf = function (a) {
                  if (!this.o && a.length) {
                    var b = Math.round(a[0].startTime * 1E3) / 1E3;
                    this.g = this.g.filter(function (c) {
                      return Math.round(c.startTime * 1E3) / 1E3 < b;
                    });
                    this.g.push.apply(this.g, x(a));
                  }
                };
                p.fe = function (a, b) {
                  var c = this;
                  a = a.filter(function (d) {
                    return d.endTime > b && (c.g.length == 0 || d.endTime > c.g[0].startTime);
                  });
                  this.nf(a);
                  this.Ya(b);
                };
                p.Ya = function (a) {
                  if (!this.o) {
                    var b = this.g.length;
                    this.g = this.g.filter(function (c) {
                      return c.endTime > a;
                    });
                    this.i += b - this.g.length;
                  }
                };
                p.pd = function (a, b, c) {
                  c = c === void 0 ? false : c;
                  if (!this.o) {
                    for (; this.g.length;) if (this.g[this.g.length - 1].startTime >= b) this.g.pop();else break;
                    for (; this.g.length;) if (this.g[0].endTime <= a) this.g.shift(), c || this.i++;else break;
                    this.g.length != 0 && (a = this.g[this.g.length - 1], b = new rj(a.startTime, b, a.C, a.startByte, a.endByte, a.ba, a.timestampOffset, a.appendWindowStart, a.appendWindowEnd, a.g, a.tilesLayout, a.B, a.h, a.status, a.aesKey), b.mimeType = a.mimeType, b.codecs = a.codecs, b.i = a.i, this.g[this.g.length - 1] = b);
                  }
                };
                p.Nf = function (a, b) {
                  var c = this;
                  this.o || (this.m && this.m.stop(), this.m = new df(function () {
                    var d = b();
                    d ? c.g.push.apply(c.g, x(d)) : (c.m.stop(), c.m = null);
                  }), this.m.Ea(a));
                };
                Nl.prototype[Symbol.iterator] = function () {
                  return this.Vb(0);
                };
                Nl.prototype.Vb = function (a, b, c) {
                  b = b === void 0 ? false : b;
                  c = c === void 0 ? false : c;
                  var d = this.find(a);
                  if (d == null) return null;
                  var e = this.get(d);
                  c ? d++ : d--;
                  var f = -1;
                  if (e && e.g.length > 0) for (var g = e.g.length - 1; g >= 0; --g) {
                    var h = e.g[g];
                    if (a >= h.startTime && a < h.endTime) {
                      if (!b) {
                        for (; g && !h.l;) g--, h = e.g[g];
                        if (!h.l) return $a("No independent partial segment found!"), null;
                      }
                      c ? d-- : d++;
                      f = g - 1;
                      break;
                    }
                  }
                  return new Ol(this, d, f, c);
                };
                Nl.prototype.Te = function () {
                  return -1;
                };
                function Pl(a, b, c) {
                  a = new rj(a, a + b, function () {
                    return c;
                  }, 0, null, null, a, a, a + b);
                  return new Nl([a]);
                }
                S("shaka.media.SegmentIndex", Nl);
                Nl.forSingleSegment = Pl;
                Nl.prototype.getIteratorForTime = Nl.prototype.Vb;
                Nl.prototype.updateEvery = Nl.prototype.Nf;
                Nl.prototype.fit = Nl.prototype.pd;
                Nl.prototype.evict = Nl.prototype.Ya;
                Nl.prototype.mergeAndEvict = Nl.prototype.fe;
                Nl.prototype.offset = Nl.prototype.offset;
                Nl.prototype.get = Nl.prototype.get;
                Nl.prototype.find = Nl.prototype.find;
                Nl.prototype.markImmutable = Nl.prototype.xk;
                Nl.prototype.release = Nl.prototype.release;
                Nl.prototype.getNumEvicted = Nl.prototype.getNumEvicted;
                Nl.prototype.getNumReferences = Nl.prototype.getNumReferences;
                function Ol(a, b, c, d) {
                  this.i = a;
                  this.h = b;
                  this.g = c;
                  this.reverse = d;
                }
                p = Ol.prototype;
                p.Id = function (a) {
                  this.reverse = a;
                };
                p.tj = function () {
                  return this.h;
                };
                p.current = function () {
                  var a = this.i.get(this.h);
                  a && a.g.length > 0 && a.m && this.g >= a.g.length && (this.h++, this.g = 0, a = this.i.get(this.h));
                  return a && a.g.length > 0 ? a.g[this.g] : a;
                };
                p.next = function () {
                  var a = this.i.get(this.h);
                  this.reverse ? a && a.g.length > 0 ? (this.g--, this.g < 0 && (this.h--, this.g = (a = this.i.get(this.h)) && a.g.length > 0 ? a.g.length - 1 : 0)) : (this.h--, this.g = 0) : a && a.g.length > 0 ? (this.g++, a.m && this.g == a.g.length && (this.h++, this.g = 0)) : (this.h++, this.g = 0);
                  a = this.current();
                  return {
                    value: a,
                    done: !a
                  };
                };
                p.eh = function () {
                  var a = this.current();
                  if (a && a.Xc && !a.l && (a = this.i.get(this.h)) && a.g.length > 0) for (var b = a.g[this.g]; b.l && !(this.g <= 0);) this.g--, b = a.g[this.g];
                };
                S("shaka.media.SegmentIterator", Ol);
                Ol.prototype.resetToLastIndependent = Ol.prototype.eh;
                Ol.prototype.next = Ol.prototype.next;
                Ol.prototype.current = Ol.prototype.current;
                Ol.prototype.currentPosition = Ol.prototype.tj;
                Ol.prototype.setReverse = Ol.prototype.Id;
                function Ql() {
                  Nl.call(this, []);
                  this.h = [];
                }
                la(Ql, Nl);
                p = Ql.prototype;
                p.clone = function () {
                  var a = new Ql();
                  a.h = this.h.slice();
                  a.i = this.i;
                  return a;
                };
                p.release = function () {
                  this.h = [];
                };
                p.Fb = function (a) {
                  for (var b = t(this.h), c = b.next(); !c.done; c = b.next()) c.value.Fb(a);
                };
                function Rl(a, b) {
                  a = t(a.h);
                  for (var c = a.next(); !c.done; c = a.next()) b(c.value);
                }
                p.find = function (a) {
                  for (var b = this.i, c = t(this.h), d = c.next(); !d.done; d = c.next()) {
                    d = d.value;
                    var e = d.find(a);
                    if (e != null) return e + b;
                    b += d.getNumEvicted() + d.getNumReferences();
                  }
                  return null;
                };
                function Sl(a, b) {
                  a = t(a.h);
                  for (var c = a.next(); !c.done; c = a.next()) if (c = c.value, c.find(b) != null) return c.Te();
                  return -1;
                }
                p.get = function (a) {
                  for (var b = this.i, c = t(this.h), d = c.next(); !d.done; d = c.next()) {
                    d = d.value;
                    var e = d.get(a - b);
                    if (e) return e;
                    e = d.getNumReferences();
                    b += d.getNumEvicted() + e;
                  }
                  return null;
                };
                p.offset = function () {};
                p.nf = function () {};
                p.Ya = function (a) {
                  if (this.h.length) {
                    var b = this.h[0];
                    b.Ya(a);
                    b.getNumReferences() == 0 && (this.h.shift(), this.i += b.getNumEvicted(), b.release(), this.Ya(a));
                  }
                };
                p.fe = function () {};
                p.pd = function () {};
                p.Nf = function () {};
                S("shaka.media.MetaSegmentIndex", Ql);
                Ql.prototype.updateEvery = Ql.prototype.Nf;
                Ql.prototype.fit = Ql.prototype.pd;
                Ql.prototype.mergeAndEvict = Ql.prototype.fe;
                Ql.prototype.evict = Ql.prototype.Ya;
                Ql.prototype.merge = Ql.prototype.nf;
                Ql.prototype.offset = Ql.prototype.offset;
                Ql.prototype.get = Ql.prototype.get;
                Ql.prototype.find = Ql.prototype.find;
                Ql.prototype.forEachTopLevelReference = Ql.prototype.Fb;
                Ql.prototype.release = Ql.prototype.release;
                function Tl(a) {
                  var b = this;
                  this.g = a;
                  this.j = false;
                  this.i = this.g.Ye();
                  this.h = new df(function () {
                    b.g.wi(b.i * .25);
                  });
                }
                Tl.prototype.release = function () {
                  this.set(this.Tc());
                  this.h && (this.h.stop(), this.h = null);
                  this.g = null;
                };
                Tl.prototype.set = function (a) {
                  this.i = a;
                  Ul(this);
                };
                Tl.prototype.Tc = function () {
                  return this.g.Tc();
                };
                function Ul(a) {
                  a.h.stop();
                  var b = a.j ? 0 : a.i;
                  if (b >= 0) try {
                    a.g.Ye() != b && a.g.ph(b);
                    return;
                  } catch (c) {}
                  a.h.Ea(.25);
                  a.g.Ye() != 0 && a.g.ph(0);
                }
                function Vl(a) {
                  var b = this;
                  this.j = a;
                  this.h = new nb();
                  this.g = new Set();
                  this.i = new df(function () {
                    Wl(b, false);
                  }).Jb();
                  a.paused || this.i.Ea(.25);
                  this.h.D(a, "playing", function () {
                    b.i.Jb().Ea(.25);
                  });
                  this.h.D(a, "pause", function () {
                    b.i.stop();
                  });
                }
                Vl.prototype.release = function () {
                  this.h && (this.h.release(), this.h = null);
                  this.i.stop();
                  for (var a = t(this.g), b = a.next(); !b.done; b = a.next()) b.value.release();
                  this.g.clear();
                };
                function Wl(a, b) {
                  var c = a.j.currentTime;
                  a = t(a.g);
                  for (var d = a.next(); !d.done; d = a.next()) d.value.j(c, b);
                }
                function Xl(a) {
                  Jg.call(this);
                  this.g = new Map();
                  this.h = a;
                }
                la(Xl, Jg);
                Xl.prototype.release = function () {
                  this.g.clear();
                  Jg.prototype.release.call(this);
                };
                function Yl(a, b) {
                  var c = a.g.get(b);
                  c || (c = {
                    me: [],
                    lg: null,
                    contentType: b
                  }, a.g.set(b, c));
                  return c;
                }
                function Zl(a, b, c) {
                  var d = Yl(a, b.contentType);
                  $l(a, d);
                  a = {
                    xd: b,
                    position: c
                  };
                  d = d.me;
                  b = d.findIndex(function (e) {
                    return e.position >= c;
                  });
                  b >= 0 ? d.splice(b, d[b].position == c ? 1 : 0, a) : d.push(a);
                }
                Xl.prototype.j = function (a) {
                  for (var b = t(this.g.values()), c = b.next(); !c.done; c = b.next()) {
                    c = c.value;
                    var d = c.lg;
                    a: {
                      var e = c.me;
                      for (var f = e.length - 1; f >= 0; f--) {
                        var g = e[f];
                        if (g.position <= a) {
                          e = g.xd;
                          break a;
                        }
                      }
                      e = null;
                    }
                    f = e && !(d === e || d && e && d.bandwidth == e.bandwidth && d.audioSamplingRate == e.audioSamplingRate && d.codecs == e.codecs && d.contentType == e.contentType && d.frameRate == e.frameRate && d.height == e.height && d.mimeType == e.mimeType && d.channelsCount == e.channelsCount && d.pixelAspectRatio == e.pixelAspectRatio && d.width == e.width);
                    g = e && d && e.label && d.label && d.label !== e.label;
                    var h = e && d && e.language && d.language && d.language !== e.language;
                    d = e && d && e.roles && d.roles && !lb(d.roles, e.roles);
                    (g || h || d) && am(this, a, e.contentType) && (c.lg = e, d = new V("audiotrackchange", new Map([["quality", e], ["position", a]])), this.dispatchEvent(d));
                    f && am(this, a, e.contentType) && (c.lg = e, JSON.stringify(e), c = new V("qualitychange", new Map([["quality", e], ["position", a]])), this.dispatchEvent(c));
                  }
                };
                function am(a, b, c) {
                  return (a = a.h()[c]) && a.length > 0 && (c = a[a.length - 1].end, b >= a[0].start && b < c) ? true : false;
                }
                function $l(a, b) {
                  if ((a = a.h()[b.contentType]) && a.length > 0) {
                    var c = a[0].start,
                      d = a[a.length - 1].end,
                      e = b.me;
                    b.me = e.filter(function (f, g) {
                      return f.position <= c && g + 1 < e.length && e[g + 1].position <= c || f.position >= d ? false : true;
                    });
                  } else b.me = [];
                }
                function bm(a) {
                  var b = {
                    bandwidth: a.bandwidth || 0,
                    audioSamplingRate: null,
                    codecs: a.codecs,
                    contentType: a.type,
                    frameRate: null,
                    height: null,
                    mimeType: a.mimeType,
                    channelsCount: null,
                    pixelAspectRatio: null,
                    width: null,
                    label: null,
                    roles: a.roles,
                    language: null
                  };
                  a.type == "video" && (b.frameRate = a.frameRate || null, b.height = a.height || null, b.pixelAspectRatio = a.pixelAspectRatio || null, b.width = a.width || null);
                  a.type == "audio" && (b.audioSamplingRate = a.audioSamplingRate, b.channelsCount = a.channelsCount, b.label = a.label || null, b.language = a.language);
                  return b;
                }
                function cm(a) {
                  Jg.call(this);
                  this.h = new Map();
                  this.i = a;
                  this.g = null;
                }
                la(cm, Jg);
                cm.prototype.release = function () {
                  this.h.clear();
                  this.g && (this.g.stop(), this.g = null);
                  Jg.prototype.release.call(this);
                };
                function dm(a, b) {
                  var c = b.schemeIdUri + "_" + b.id + "_" + (b.startTime.toFixed(1) + "_" + b.endTime.toFixed(1));
                  a.h.has(c) || (a.h.set(c, b), b = new V("regionadd", new Map([["region", b]])), a.dispatchEvent(b), em(a));
                }
                function em(a) {
                  a.g || (a.g = new df(function () {
                    for (var b = a.i(), c = t(a.h), d = c.next(); !d.done; d = c.next()) {
                      var e = t(d.value);
                      d = e.next().value;
                      e = e.next().value;
                      e.endTime < b.start && (a.h.delete(d), d = new V("regionremove", new Map([["region", e]])), a.dispatchEvent(d));
                    }
                    !a.h.size && a.g && (a.g.stop(), a.g = null);
                  }).Ea(2));
                }
                function fm(a, b, c, d, e) {
                  function f(g, h) {
                    return h.fastSwitching && g.Xc && g.ee ? false : true;
                  }
                  this.m = a;
                  this.i = b;
                  this.l = c;
                  this.g = new Map();
                  this.j = new Map();
                  this.h = null;
                  this.o = d;
                  this.u = e || f;
                }
                function gm(a, b) {
                  a.l = b;
                  a = t(a.g.values());
                  for (var c = a.next(); !c.done; c = a.next()) c.value.g = b;
                }
                function hm(a, b, c) {
                  c = c === void 0 ? false : c;
                  if (!a.i.segmentIndex) return Promise.resolve();
                  a.h || (a.h = a.i.segmentIndex.Vb(b, true, a.o));
                  if (!a.h) return Promise.resolve();
                  c && a.h.next();
                  for (b = []; a.g.size < a.m;) {
                    c = a.h.next().value;
                    if (!c) break;
                    var d = true;
                    c.isPreload() && c.endByte != null && (d = false);
                    c.Jc() == 2 && (d = false);
                    c.Yb(false) && (d = false);
                    d && c.ba && b.push(im(a, c.ba));
                    d && !a.g.has(c) && (d = new jm(a.l), b.push(km(d, c, a.i)), a.g.set(c, d));
                    if (!a.u(c, a.i)) break;
                  }
                  lm(a);
                  return Promise.all(b);
                }
                function im(a, b) {
                  if (!a.i.segmentIndex || b.Yb() || Array.from(a.j.keys()).some(function (e) {
                    return qj(e, b);
                  })) return Promise.resolve();
                  var c = new jm(a.l),
                    d = km(c, b, a.i);
                  a.j.set(b, c);
                  return d;
                }
                function mm(a, b) {
                  b = t(b.keys());
                  for (var c = b.next(); !c.done; c = b.next()) (c = c.value) && nm(a, c);
                }
                function om(a) {
                  mm(a, a.g);
                  mm(a, a.j);
                  a.h = null;
                }
                fm.prototype.Ya = function (a, b) {
                  b = b === void 0 ? false : b;
                  for (var c = t(this.g.keys()), d = c.next(); !d.done; d = c.next()) d = d.value, a > d.endTime && nm(this, d);
                  b && lm(this);
                };
                fm.prototype.Id = function (a) {
                  this.o = a;
                  this.h && this.h.Id(a);
                };
                function lm(a) {
                  if (a.g.size) for (var b = Array.from(a.g.keys()), c = t(a.j.keys()), d = c.next(), e = {}; !d.done; e = {
                    Mg: void 0
                  }, d = c.next()) e.Mg = d.value, b.some(function (f) {
                    return function (g) {
                      return qj(g.ba, f.Mg);
                    };
                  }(e)) || nm(a, e.Mg);
                }
                function pm(a, b) {
                  a.m = b;
                  for (var c = Array.from(a.g.keys()); c.length > b;) {
                    var d = c.pop();
                    d && nm(a, d);
                  }
                  lm(a);
                }
                function qm(a, b) {
                  b && b !== a.i && (om(a), a.i = b);
                }
                function nm(a, b) {
                  var c = a.g;
                  b instanceof pj && (c = a.j);
                  a = c.get(b);
                  c.delete(b);
                  a && a.abort();
                }
                function jm(a) {
                  this.g = a;
                  this.je = this.wh = null;
                }
                function km(a, b, c) {
                  var d = new Uint8Array(0);
                  a.je = a.g(b, c, function (e) {
                    return P(function (f) {
                      if (f.g == 1) return d.byteLength > 0 ? d = tc(d, e) : d = e, a.wh ? F(f, a.wh(d), 3) : f.A(0);
                      d = new Uint8Array(0);
                      G(f);
                    });
                  });
                  return a.je.promise.catch(function (e) {
                    return e instanceof U && e.code == 7001 ? Promise.resolve() : Promise.reject(e);
                  });
                }
                jm.prototype.abort = function () {
                  this.je && this.je.abort();
                };
                S("shaka.config.CrossBoundaryStrategy", {
                  KEEP: "keep",
                  RESET: "reset",
                  RESET_TO_ENCRYPTED: "reset_to_encrypted",
                  RESET_ON_ENCRYPTION_CHANGE: "RESET_ON_ENCRYPTION_CHANGE"
                });
                function rm(a) {
                  var b = Ne(a),
                    c = b.split("/")[0];
                  a = Oe(a);
                  return {
                    type: c,
                    mimeType: b,
                    codecs: a,
                    language: null,
                    height: null,
                    width: null,
                    channelCount: null,
                    sampleRate: null,
                    closedCaptions: new Map(),
                    ve: null,
                    colorGamut: null,
                    frameRate: null
                  };
                }
                function sm(a, b, c) {
                  function d(A) {
                    z = A.name;
                    var E = A.reader;
                    E.skip(24);
                    var J = E.Ca(),
                      H = E.Ca();
                    E.skip(50);
                    q = String(J);
                    n = String(H);
                    A.reader.Ia() && mh(A);
                  }
                  function e(A) {
                    var E = Fi(A.reader);
                    r = E.channelCount;
                    u = E.sampleRate;
                    f(A.name);
                  }
                  function f(A) {
                    A = A.toLowerCase();
                    switch (A) {
                      case "avc1":
                      case "avc3":
                        h.push(A + ".42E01E");
                        l = true;
                        break;
                      case "hev1":
                      case "hvc1":
                        h.push(A + ".1.6.L93.90");
                        l = true;
                        break;
                      case "dvh1":
                      case "dvhe":
                        h.push(A + ".05.04");
                        l = true;
                        break;
                      case "vp09":
                        h.push(A + ".00.10.08");
                        l = true;
                        break;
                      case "av01":
                        h.push(A + ".0.01M.08");
                        l = true;
                        break;
                      case "mp4a":
                        g.push("mp4a.40.2");
                        k = true;
                        break;
                      case "ac-3":
                      case "ec-3":
                      case "ac-4":
                      case "opus":
                      case "flac":
                        g.push(A);
                        k = true;
                        break;
                      case "apac":
                        g.push("apac.31.00"), k = true;
                    }
                  }
                  var g = [],
                    h = [],
                    k = false,
                    l = false,
                    m = null,
                    n = null,
                    q = null,
                    r = null,
                    u = null,
                    v = null,
                    w = null,
                    z;
                  new hh().box("moov", mh).box("trak", mh).box("mdia", mh).S("mdhd", function (A) {
                    m = Di(A.reader, A.version).language;
                  }).box("minf", mh).box("stbl", mh).S("stsd", oh).box("mp4a", function (A) {
                    var E = Fi(A.reader);
                    r = E.channelCount;
                    u = E.sampleRate;
                    A.reader.Ia() ? mh(A) : f(A.name);
                  }).box("esds", function (A) {
                    A = A.reader;
                    for (var E = "mp4a", J, H; A.Ia();) {
                      J = A.Y();
                      for (var K = A.Y(); K & 128;) K = A.Y();
                      if (J == 3) A.Ca(), K = A.Y(), K & 128 && A.Ca(), K & 64 && A.skip(A.Y()), K & 32 && A.Ca();else if (J == 4) H = A.Y(), A.skip(12);else if (J == 5) break;
                    }
                    H && (E += "." + Ii(H), J == 5 && A.Ia() && (J = A.Y(), H = (J & 248) >> 3, H === 31 && A.Ia() && (H = 32 + ((J & 7) << 3) + ((A.Y() & 224) >> 5)), E += "." + H));
                    g.push(E);
                    k = true;
                  }).box("ac-3", e).box("ec-3", e).box("ac-4", e).box("Opus", e).box("fLaC", e).box("apac", e).box("avc1", d).box("avc3", d).box("hev1", d).box("hvc1", d).box("dva1", d).box("dvav", d).box("dvh1", d).box("dvhe", d).box("vp09", d).box("av01", d).box("avcC", function (A) {
                    var E = z || "";
                    switch (z) {
                      case "dvav":
                        E = "avc3";
                        break;
                      case "dva1":
                        E = "avc1";
                    }
                    A = A.reader;
                    A.skip(1);
                    A = E + "." + Ii(A.Y()) + Ii(A.Y()) + Ii(A.Y());
                    h.push(A);
                    l = true;
                  }).box("hvcC", function (A) {
                    var E = z || "";
                    switch (z) {
                      case "dvh1":
                        E = "hvc1";
                        break;
                      case "dvhe":
                        E = "hev1";
                    }
                    var J = A.reader;
                    J.skip(1);
                    A = J.Y();
                    var H = ["", "A", "B", "C"][A >> 6],
                      K = A & 31,
                      L = J.U(),
                      O = (A & 32) >> 5 ? "H" : "L";
                    A = [J.Y(), J.Y(), J.Y(), J.Y(), J.Y(), J.Y()];
                    J = J.Y();
                    for (var Q = 0, N = 0; N < 32; N++) {
                      Q |= L & 1;
                      if (N == 31) break;
                      Q <<= 1;
                      L >>= 1;
                    }
                    E = E + ("." + H + K) + ("." + Ii(Q, true));
                    E += "." + O + J;
                    H = "";
                    for (K = A.length; K--;) if ((O = A[K]) || H) H = "." + O.toString(16).toUpperCase() + H;
                    E += H;
                    h.push(E);
                    l = true;
                  }).box("dvcC", function (A) {
                    var E = z || "";
                    switch (z) {
                      case "hvc1":
                        E = "dvh1";
                        break;
                      case "hev1":
                        E = "dvhe";
                        break;
                      case "avc1":
                        E = "dva1";
                        break;
                      case "avc3":
                        E = "dvav";
                        break;
                      case "av01":
                        E = "dav1";
                    }
                    var J = A.reader;
                    J.skip(2);
                    A = J.Y();
                    J = J.Y();
                    h.push(E + "." + Ji(A >> 1 & 127) + "." + Ji(A << 5 & 32 | J >> 3 & 31));
                    l = true;
                  }).box("dvvC", function (A) {
                    var E = z || "";
                    switch (z) {
                      case "hvc1":
                        E = "dvh1";
                        break;
                      case "hev1":
                        E = "dvhe";
                        break;
                      case "avc1":
                        E = "dva1";
                        break;
                      case "avc3":
                        E = "dvav";
                        break;
                      case "av01":
                        E = "dav1";
                    }
                    var J = A.reader;
                    J.skip(2);
                    A = J.Y();
                    J = J.Y();
                    h.push(E + "." + Ji(A >> 1 & 127) + "." + Ji(A << 5 & 32 | J >> 3 & 31));
                    l = true;
                  }).S("vpcC", function (A) {
                    var E = z || "",
                      J = A.reader;
                    A = J.Y();
                    var H = J.Y();
                    J = J.Y() >> 4 & 15;
                    h.push(E + "." + Ji(A) + "." + Ji(H) + "." + Ji(J));
                    l = true;
                  }).box("av1C", function (A) {
                    var E = z || "";
                    switch (z) {
                      case "dav1":
                        E = "av01";
                    }
                    var J = A.reader;
                    J.skip(1);
                    A = J.Y();
                    J = J.Y();
                    var H = A >>> 5,
                      K = (J & 64) >> 6;
                    h.push(E + "." + H + "." + Ji(A & 31) + (J >>> 7 ? "H" : "M") + "." + Ji(H === 2 && K ? (J & 32) >> 5 ? 12 : 10 : K ? 10 : 8) + "." + ((J & 16) >> 4) + "." + ((J & 8) >> 3) + ((J & 4) >> 2) + (J & 3) + "." + Ji(1) + "." + Ji(1) + "." + Ji(1) + ".0");
                    l = true;
                  }).box("enca", rh).box("encv", ph).box("sinf", mh).box("frma", function (A) {
                    A = Gi(A.reader).codec;
                    f(A);
                  }).box("colr", function (A) {
                    h = h.map(function (H) {
                      if (H.startsWith("av01.")) {
                        var K = A.reader,
                          L = K.Oa(),
                          O = K.Tb(4, false);
                        var Q = String.fromCharCode(O[0]);
                        Q += String.fromCharCode(O[1]);
                        Q += String.fromCharCode(O[2]);
                        Q += String.fromCharCode(O[3]);
                        if (Q === "nclx") {
                          O = K.Ca();
                          Q = K.Ca();
                          var N = K.Ca(),
                            M = K.Y() >> 7,
                            R = H.split(".");
                          R.length == 10 && (R[6] = Ji(O), R[7] = Ji(Q), R[8] = Ji(N), R[9] = String(M), H = R.join("."));
                        }
                        K.seek(L);
                      }
                      return H;
                    });
                    var E = Hi(A.reader),
                      J = E.colorGamut;
                    v = E.ve;
                    w = J;
                  }).parse(a || b, true, true);
                  if (!g.length && !h.length) return null;
                  var y = k && !l,
                    B = new Map();
                  if (l && !c) {
                    c = new Pc("video/mp4");
                    a && c.init(a);
                    try {
                      c.xf(b);
                      for (var D = t(c.Vf()), I = D.next(); !I.done; I = D.next()) {
                        var C = I.value;
                        B.set(C, C);
                      }
                    } catch (A) {}
                    c.Nd();
                  }
                  return {
                    type: y ? "audio" : "video",
                    mimeType: y ? "audio/mp4" : "video/mp4",
                    codecs: tm(g.concat(h)).join(", "),
                    language: m,
                    height: n,
                    width: q,
                    channelCount: r,
                    sampleRate: u,
                    closedCaptions: B,
                    ve: v,
                    colorGamut: w,
                    frameRate: null
                  };
                }
                function tm(a) {
                  var b = new Set(),
                    c = [];
                  a = t(a);
                  for (var d = a.next(); !d.done; d = a.next()) {
                    d = d.value;
                    var e = Me(d);
                    b.has(e) || (c.push(d), b.add(e));
                  }
                  b = Bc("audio", c);
                  d = Bc("video", c);
                  a = Bc(Ac, c);
                  d = um(d);
                  b = b.concat(d).concat(a);
                  return c.length && !b.length ? c : b;
                }
                function um(a) {
                  if (a.length <= 1) return a;
                  var b = a.find(function (c) {
                    return c.startsWith("dvav.") || c.startsWith("dva1.") || c.startsWith("dvh1.") || c.startsWith("dvhe.") || c.startsWith("dav1.") || c.startsWith("dvc1.") || c.startsWith("dvi1.");
                  });
                  return b ? Ic('video/mp4; codecs="' + b + '"') ? [b] : a.filter(function (c) {
                    return c != b;
                  }) : a;
                }
                function vm(a) {
                  var b = null;
                  new hh().box("moov", mh).box("trak", mh).box("mdia", mh).box("minf", mh).box("stbl", mh).S("stsd", oh).box("encv", ph).box("enca", rh).box("sinf", mh).box("schi", mh).S("tenc", function (c) {
                    c = c.reader;
                    c.Y();
                    c.Y();
                    c.Y();
                    c.Y();
                    c = c.Tb(16, false);
                    b = rc(c);
                  }).parse(a, true);
                  return b;
                }
                function wm(a, b, c) {
                  var d, e, f, g, h;
                  return P(function (k) {
                    if (k.g == 1) return d = b, d.cryptoKey ? k.A(2) : F(k, d.fetchKey(), 3);
                    e = d.iv;
                    if (!e) for (e = Vb(new ArrayBuffer(16)), f = d.firstMediaSequenceNumber + c, g = e.byteLength - 1; g >= 0; g--) e[g] = f & 255, f >>= 8;
                    b.blockCipherMode == "CBC" ? h = {
                      name: "AES-CBC",
                      iv: e
                    } : h = {
                      name: "AES-CTR",
                      counter: e,
                      length: 64
                    };
                    return k.return(window.crypto.subtle.decrypt(h, d.cryptoKey, a));
                  });
                }
                function xm(a, b, c, d, e) {
                  a = Rg(a, d, e);
                  if (b != 0 || c != null) a.headers.Range = c ? "bytes=" + b + "-" + c : "bytes=" + b + "-";
                  return a;
                }
                function ym(a, b) {
                  var c = this;
                  this.g = b;
                  this.j = a;
                  this.i = null;
                  this.M = new Map();
                  this.C = 1;
                  this.B = this.o = null;
                  this.V = 0;
                  this.h = new Map();
                  this.N = false;
                  this.X = null;
                  this.F = false;
                  this.l = new Zg(function () {
                    return zm(c);
                  });
                  this.R = Date.now() / 1E3;
                  this.m = new Map();
                  this.T = {
                    projection: null,
                    hfov: null
                  };
                  this.aa = 0;
                  this.$ = Infinity;
                  this.H = null;
                  this.O = [];
                  this.u = new df(function () {
                    if (c.j && c.g) {
                      if (c.j.presentationTimeline.W()) {
                        var d = c.j.presentationTimeline.Xb(),
                          e = c.j.presentationTimeline.Gb();
                        e - d > 1 ? al(c.g.Z, d, e) : bl(c.g.Z);
                      } else bl(c.g.Z), c.u && c.u.stop();
                    } else c.u && c.u.stop();
                  });
                  this.I = null;
                  this.J = false;
                  this.K = new df(function () {
                    var d = c.g.video;
                    !d.ended && c.I && (c.J = true, d.currentTime = c.I, c.I = null);
                  });
                  this.G = new nb();
                }
                p = ym.prototype;
                p.destroy = function () {
                  return this.l.destroy();
                };
                function zm(a) {
                  var b, c, d, e, f, g, h;
                  return P(function (k) {
                    if (k.g == 1) {
                      a.u && a.u.stop();
                      a.u = null;
                      a.K && a.K.stop();
                      a.K = null;
                      a.G && (a.G.release(), a.G = null);
                      b = [];
                      c = t(a.h.values());
                      for (d = c.next(); !d.done; d = c.next()) e = d.value, Am(e), b.push(Bm(e)), e.ha && (om(e.ha), e.ha = null);
                      f = t(a.m.values());
                      for (g = f.next(); !g.done; g = f.next()) h = g.value, om(h);
                      return F(k, Promise.all(b), 2);
                    }
                    a.h.clear();
                    a.m.clear();
                    a.g = null;
                    a.j = null;
                    a.i = null;
                    a.I = null;
                    G(k);
                  });
                }
                p.configure = function (a) {
                  this.i = a;
                  this.X = new wg({
                    maxAttempts: Math.max(a.retryParameters.maxAttempts, 2),
                    baseDelay: a.retryParameters.baseDelay,
                    backoffFactor: a.retryParameters.backoffFactor,
                    fuzzFactor: a.retryParameters.fuzzFactor
                  }, true);
                  if (a.disableAudioPrefetch) {
                    var b = this.h.get("audio");
                    b && b.ha && (om(b.ha), b.ha = null);
                    b = t(this.m.keys());
                    for (var c = b.next(); !c.done; c = b.next()) c = c.value, om(this.m.get(c)), this.m.delete(c);
                  }
                  a.disableTextPrefetch && (b = this.h.get(Ac)) && b.ha && (om(b.ha), b.ha = null);
                  a.disableVideoPrefetch && (b = this.h.get("video")) && b.ha && (om(b.ha), b.ha = null);
                  b = t(this.h.keys());
                  for (c = b.next(); !c.done; c = b.next()) c = this.h.get(c.value), c.ha ? (pm(c.ha, a.segmentPrefetchLimit), a.segmentPrefetchLimit > 0 || (om(c.ha), c.ha = null)) : a.segmentPrefetchLimit > 0 && (c.ha = Cm(this, c.stream));
                  a.disableAudioPrefetch || Dm(this);
                };
                function Em(a, b, c) {
                  a.j.presentationTimeline.W() || (a.aa = b, a.$ = c);
                }
                p.start = function (a) {
                  var b = this;
                  return P(function (c) {
                    if (c.g == 1) return F(c, Fm(b, a || new Map()), 2);
                    $g(b.l);
                    b.N = true;
                    G(c);
                  });
                };
                function Gm(a, b) {
                  var c, d, e, f, g, k;
                  P(function (l) {
                    switch (l.g) {
                      case 1:
                        return c = Cc, a.V++, d = a.V, ua(l, 2), F(l, Vk(a.g.Z, c.Na), 4);
                      case 4:
                        xa(l, 3);
                        break;
                      case 2:
                        if (e = ya(l), a.g) a.g.onError(e);
                      case 3:
                        f = Fe(b.mimeType, b.codecs), Ek(a.g.Z, f, a.j.sequenceMode, b.external), g = a.g.Z.aa, (g.isTextVisible() || a.i.alwaysStreamText) && a.V == d && (k = Hm(a, b), a.h.set(c.Na, k), Im(a, k, 0)), G(l);
                    }
                  });
                }
                function Jm(a) {
                  var b = a.h.get(Ac);
                  b && (Am(b), Bm(b).catch(function () {}), a.H = a.h.get(Ac), a.h.delete(Ac), b.stream && b.stream.closeSegmentIndex && b.stream.closeSegmentIndex());
                  a.B = null;
                }
                function Km(a, b) {
                  for (var c = a.g.Ob() < 0, d = t(a.h.values()), e = d.next(); !e.done; e = d.next()) e = e.value, e.ua && e.ua.Id(c), e.ha && e.ha.Id(c);
                  d = t(a.m.values());
                  for (e = d.next(); !e.done; e = d.next()) e.value.Id(c);
                  if (c = a.h.get("video")) if (d = c.stream) if (b) (b = d.trickModeVideo) && !c.Mc && (Lm(a, b, false, 0, false), c.Mc = d);else if (b = c.Mc) c.Mc = null, Lm(a, b, true, 0, false);
                }
                function Mm(a, b, c, d, e, f) {
                  c = c === void 0 ? false : c;
                  d = d === void 0 ? 0 : d;
                  e = e === void 0 ? false : e;
                  f = f === void 0 ? false : f;
                  a.o = b;
                  a.N && (b.video && Lm(a, b.video, c, d, e, f), b.audio && Lm(a, b.audio, c, d, e, f));
                }
                function Nm(a, b) {
                  P(function (c) {
                    if (c.g == 1) return a.H = null, a.B = b, a.N ? b.segmentIndex ? c.A(2) : F(c, b.createSegmentIndex(), 2) : c.return();
                    Lm(a, b, true, 0, false);
                    G(c);
                  });
                }
                function Om(a) {
                  var b = a.h.get(Ac);
                  b && Lm(a, b.stream, true, 0, true);
                }
                function Pm(a, b) {
                  for (var c = t(a.M.entries()), d = c.next(); !d.done; d = c.next()) {
                    var e = t(d.value);
                    d = e.next().value;
                    e = e.next().value;
                    d.includes(b.type) && (e(), a.M.delete(d));
                  }
                }
                function Lm(a, b, c, d, e, f) {
                  var g = a.h.get(b.type);
                  g || b.type != Ac ? g && (g.Mc && (b.trickModeVideo ? (g.Mc = b, b = b.trickModeVideo) : g.Mc = null), g.stream != b || e) && (a.m.has(b) ? g.ha = a.m.get(b) : g.ha && qm(g.ha, b), b.type == Ac && g.stream != b && (e = Fe(b.mimeType, b.codecs), Ek(a.g.Z, e, a.j.sequenceMode, b.external)), !a.m.has(g.stream) && g.stream.closeSegmentIndex && (g.Ja ? (e = "(" + g.type + ":" + g.stream.id + ")", a.M.has(e) || a.M.set(e, g.stream.closeSegmentIndex)) : g.stream.closeSegmentIndex()), e = g.stream.isAudioMuxedInVideo != b.isAudioMuxedInVideo, g.stream = b, g.ua = null, g.cg = !!f, b.dependencyStream ? g.Ec = Hm(a, b.dependencyStream) : g.Ec = null, Qm(a), e && (g.pb = null, g.qc = null, g.nc = null, b.isAudioMuxedInVideo && (b = null, g.type === "video" ? b = a.h.get("audio") : g.type === "audio" && (b = a.h.get("video")), b && (Bm(b).catch(function () {}), b.pb = null, b.qc = null, b.nc = null, Rm(a, b), Sm(a, b).catch(function (h) {
                    if (a.g) a.g.onError(h);
                  })))), c ? g.Ub ? g.Kd = true : g.Ja ? (g.ec = true, g.ld = d, g.Kd = true) : (Am(g), Tm(a, g, true, d).catch(function (h) {
                    if (a.g) a.g.onError(h);
                  })) : g.Ja || g.qb || Im(a, g, 0), Sm(a, g).catch(function (h) {
                    if (a.g) a.g.onError(h);
                  })) : Gm(a, b);
                }
                function Sm(a, b) {
                  var c, d, e;
                  return P(function (f) {
                    if (f.g == 1) {
                      if (!b.Va) return f.return();
                      c = b.stream;
                      d = b.Va;
                      return c.segmentIndex ? f.A(2) : F(f, c.createSegmentIndex(), 2);
                    }
                    if (f.g != 4) return e = c.dependencyStream, !e || e.segmentIndex ? f.A(4) : F(f, e.createSegmentIndex(), 4);
                    if (b.Va != d || b.stream != c) return f.return();
                    var g = a.g.lc();
                    var h = Kk(a.g.Z, b.type),
                      k = b.stream.segmentIndex.find(b.La ? b.La.endTime : g),
                      l = k == null ? null : b.stream.segmentIndex.get(k);
                    k = l ? tj(l) : null;
                    l && !k && (k = (l.endTime - l.getStartTime()) * (b.stream.bandwidth || a.o.bandwidth) / 8);
                    k ? ((l = l.ba) && (k += (l.endByte ? l.endByte + 1 - l.startByte : null) || 0), l = a.g.getBandwidthEstimate(), g = k * 8 / l < (h || 0) - g - a.i.rebufferingGoal || b.Va.h.g > k ? true : false) : g = true;
                    g && b.Va.abort();
                    G(f);
                  });
                }
                p.bd = function () {
                  if (this.g) {
                    for (var a = this.g.lc(), b = t(this.h.keys()), c = b.next(); !c.done; c = b.next()) {
                      var d = c.value;
                      c = this.h.get(d);
                      var e;
                      if (e = !this.J) e = this.g.Z, d == Ac ? (e = e.h, e = e.g == null || e.h == null ? false : a >= e.g && a < e.h) : (e = Jk(e, d), e = zj(e, a)), e = !e;
                      if (e) {
                        this.R = 0;
                        c.ha && (c.ha.h = null);
                        if (c.type === "audio") {
                          e = t(this.m.values());
                          for (var f = e.next(); !f.done; f = e.next()) f.value.h = null;
                        }
                        c.ua = null;
                        (Kk(this.g.Z, d) != null || c.Ja) && Rm(this, c);
                        c.Va && (c.Va.abort(), c.Va = null);
                        d === Ac && (d = this.g.Z, d.J && d.J.Nd());
                        c.bd = true;
                      }
                      !this.J || c.Ub || c.Ja || c.qb || Im(this, c, 0);
                    }
                    Um(this) && Vm(this);
                  }
                };
                function Rm(a, b) {
                  b.Ub || b.ec || (b.Ja ? (b.ec = true, b.ld = 0) : Ik(a.g.Z, b.type) == null ? b.qb == null && Im(a, b, 0) : (Am(b), Tm(a, b, false, 0).catch(function (c) {
                    if (a.g) a.g.onError(c);
                  })));
                }
                function Fm(a, b) {
                  var c, d, e, f, g, h, k, l;
                  return P(function (m) {
                    if (m.g == 1) {
                      if (!a.o) throw new U(2, 5, 5006);
                      c = Wm(a, true);
                      d = a.g.Z;
                      return F(m, d.init(c, a.j.sequenceMode, a.j.type, a.j.ignoreManifestTimestampsInSegmentsMode), 2);
                    }
                    $g(a.l);
                    a.updateDuration();
                    e = t(c.keys());
                    for (f = e.next(); !f.done; f = e.next()) g = f.value, h = c.get(g), a.h.has(g) || (k = Hm(a, h), b.has(h.id) && (l = b.get(h.id), gm(l, function (n, q, r) {
                      return Xm(n, q, r || null, a.i.retryParameters, a.g.tc);
                    }), k.ha = l), a.h.set(g, k), Im(a, k, 0));
                    Qm(a);
                    G(m);
                  });
                }
                function Hm(a, b) {
                  var c = {
                    stream: b,
                    type: b.type,
                    ua: null,
                    ha: Cm(a, b),
                    La: null,
                    pb: null,
                    kf: null,
                    qc: null,
                    nc: null,
                    hf: null,
                    jf: null,
                    Mc: null,
                    endOfStream: false,
                    Ja: false,
                    qb: null,
                    ec: false,
                    ld: 0,
                    Kd: false,
                    Ub: false,
                    bd: true,
                    cg: false,
                    ah: false,
                    Zd: false,
                    Va: null,
                    Ec: null
                  };
                  b.dependencyStream && (c.Ec = Hm(a, b.dependencyStream));
                  return c;
                }
                function Cm(a, b) {
                  if (b.type === "video" && a.i.disableVideoPrefetch || b.type === "audio" && a.i.disableAudioPrefetch || b.type === Ac && (b.mimeType == "application/cea-608" || b.mimeType == "application/cea-708") || b.type === Ac && a.i.disableTextPrefetch) return null;
                  if (a.m.has(b)) return a.m.get(b);
                  var c = a.h.get(b.type);
                  return (c = c && c.ha) && b === c.i ? c : a.i.segmentPrefetchLimit > 0 ? new fm(a.i.segmentPrefetchLimit, b, function (d, e, f) {
                    return Xm(d, e, f || null, a.i.retryParameters, a.g.tc);
                  }, a.g.Ob() < 0, a.g.$k) : null;
                }
                function Dm(a) {
                  for (var b = a.i.segmentPrefetchLimit, c = a.i.prefetchAudioLanguages, d = t(a.j.variants), e = d.next(), f = {}; !e.done; f = {
                    Mb: void 0
                  }, e = d.next()) if (f.Mb = e.value, f.Mb.audio) if (a.m.has(f.Mb.audio)) {
                    if (e = a.m.get(f.Mb.audio), pm(e, b), !(b > 0 && c.some(function (h) {
                      return function (k) {
                        return kf(h.Mb.audio.language, k);
                      };
                    }(f)))) {
                      var g = a.h.get(f.Mb.audio.type);
                      e !== (g && g.ha) && om(e);
                      a.m.delete(f.Mb.audio);
                    }
                  } else b <= 0 || !c.some(function (h) {
                    return function (k) {
                      return kf(h.Mb.audio.language, k);
                    };
                  }(f)) || !(e = Cm(a, f.Mb.audio)) || (f.Mb.audio.segmentIndex || f.Mb.audio.createSegmentIndex(), a.m.set(f.Mb.audio, e));
                }
                p.updateDuration = function () {
                  var a = Lc(),
                    b = this.j.presentationTimeline.getDuration();
                  b < Infinity ? (a && (this.u && this.u.stop(), bl(this.g.Z)), this.g.Z.Ab(b)) : a ? (this.u && this.u.Ea(.5), this.g.Z.Ab(Infinity)) : this.g.Z.Ab(4294967296);
                };
                function Ym(a, b) {
                  var c, d, e, f, g, h, k, l, m;
                  return P(function (n) {
                    switch (n.g) {
                      case 1:
                        $g(a.l);
                        c = Cc;
                        if (b.Ja || b.qb == null || b.Ub) return n.return();
                        b.qb = null;
                        if (!b.ec) {
                          n.A(2);
                          break;
                        }
                        return F(n, Tm(a, b, b.Kd, b.ld), 3);
                      case 3:
                        return n.return();
                      case 2:
                        Pm(a, b);
                        if (b.stream.segmentIndex) {
                          n.A(4);
                          break;
                        }
                        d = b.stream;
                        ua(n, 5);
                        return F(n, b.stream.createSegmentIndex(), 7);
                      case 7:
                        xa(n, 6);
                        break;
                      case 5:
                        return e = ya(n), F(n, Zm(a, b, e), 8);
                      case 8:
                        return n.return();
                      case 6:
                        if (d != b.stream) return d.closeSegmentIndex && d.closeSegmentIndex(), b.Ja || b.qb || Im(a, b, 0), n.return();
                      case 4:
                        if (!b.Ec) {
                          n.A(9);
                          break;
                        }
                        if (b.Ec.stream.segmentIndex) {
                          n.A(9);
                          break;
                        }
                        ua(n, 11);
                        return F(n, b.Ec.stream.createSegmentIndex(), 13);
                      case 13:
                        xa(n, 9);
                        break;
                      case 11:
                        ya(n);
                      case 9:
                        ua(n, 14);
                        f = $m(a, b);
                        f != null && (Im(a, b, f), b.Zd = false);
                        xa(n, 15);
                        break;
                      case 14:
                        return g = ya(n), F(n, Zm(a, b, g), 16);
                      case 16:
                        return n.return();
                      case 15:
                        if (b.type === c.Na) return n.return();
                        h = [];
                        b.stream && !b.stream.isAudioMuxedInVideo && h.push(b);
                        k = b.type === c.ka ? c.Aa : c.ka;
                        (l = a.h.get(k)) && l.stream && !l.stream.isAudioMuxedInVideo && h.push(l);
                        if (!a.N || !h.every(function (q) {
                          return q.endOfStream;
                        })) {
                          n.A(0);
                          break;
                        }
                        return F(n, a.g.Z.endOfStream(), 18);
                      case 18:
                        $g(a.l), m = a.g.Z.getDuration(), m != 0 && m < a.j.presentationTimeline.getDuration() && a.j.presentationTimeline.Ab(m), G(n);
                    }
                  });
                }
                function $m(a, b) {
                  if (an(b)) return Sk(a.g.Z, b.stream.originalId || ""), null;
                  b.type == Ac && Tk(a.g.Z);
                  if (b.stream.isAudioMuxedInVideo && b.type == "audio") return null;
                  if (b.type != Ac && Ck(a.g.Z)) return bn(a, true), null;
                  var c = a.i.updateIntervalSeconds / Math.max(1, Math.abs(a.g.Ob()));
                  if (!Hk(a.g.Z) && b.type != Ac) return c / 2;
                  var d = a.g.lc();
                  if (b.type === "audio") for (var e = t(a.m.keys()), f = e.next(); !f.done; f = e.next()) f = a.m.get(f.value), f.Ya(d, true), hm(f, d);
                  e = b.La ? b.La.endTime : d;
                  var g = Lk(a.g.Z, b.type, d);
                  f = Math.max(1, Math.max(a.i.rebufferingGoal, a.i.bufferingGoal) * a.C);
                  var h = a.j.presentationTimeline.getDuration() - e,
                    k = Kk(a.g.Z, b.type);
                  if (h < 1E-6 && k) return b.endOfStream = true, b.type == "video" && (a = a.h.get(Ac)) && an(a) && (a.endOfStream = true), null;
                  b.endOfStream = false;
                  if (g >= f) return c / 2;
                  h = !b.ua;
                  k = cn(a, b, d, k);
                  if (!k) return c;
                  g = b.pb;
                  var l = k.ba;
                  g && l && qj(l, g) && (g.g = l.g);
                  g = false;
                  h && b.cg && (g = true, b.cg = false);
                  h = Infinity;
                  l = Array.from(a.h.values());
                  l = t(l);
                  for (var m = l.next(); !m.done; m = l.next()) m = m.value, an(m) || m.ua && !m.ua.current() || (h = Math.min(h, m.La ? m.La.endTime : d));
                  if (e >= h + a.j.presentationTimeline.h) return c;
                  b.ha && b.ua && !a.m.has(b.stream) && (b.ha.Ya(k.startTime + .001), hm(b.ha, k.startTime).catch(function () {}));
                  if (Um(a) && dn(a, b, k)) return null;
                  en(a, b, d, k, g).catch(function () {});
                  b.Ec && fn(a, b.Ec, d, f);
                  return null;
                }
                function cn(a, b, c, d) {
                  if (b.ua) return (c = b.ua.current()) && b.La && Math.abs(b.La.startTime - c.startTime) < .001 && (c = b.ua.next().value), c;
                  if (b.La || d) return c = b.La ? b.La.endTime : d, a = a.g.Ob() < 0, b.stream.segmentIndex && (b.ua = b.stream.segmentIndex.Vb(c, false, a)), b.ua && b.ua.next().value;
                  d = a.j.sequenceMode || Um(a) ? 0 : a.i.inaccurateManifestTolerance;
                  var e = Math.max(c - d, 0);
                  a = a.g.Ob() < 0;
                  var f = null;
                  d && (b.stream.segmentIndex && (b.ua = b.stream.segmentIndex.Vb(e, false, a)), f = b.ua && b.ua.next().value);
                  f || (b.stream.segmentIndex && (b.ua = b.stream.segmentIndex.Vb(c, false, a)), f = b.ua && b.ua.next().value);
                  return f;
                }
                function en(a, b, c, d, e) {
                  var f, g, h, k, l, n, q, r, u, v, w, z, y, B, D, I, C;
                  return P(function (A) {
                    switch (A.g) {
                      case 1:
                        f = Cc;
                        g = b.stream;
                        h = b.ua;
                        b.Ja = true;
                        ua(A, 2);
                        if (d.Jc() == 2) throw new U(1, 1, 1011);
                        return F(A, gn(a, b, d, e), 4);
                      case 4:
                        $g(a.l);
                        if (a.F) return A.return();
                        k = g.mimeType == "video/mp4" || g.mimeType == "audio/mp4";
                        l = window.ReadableStream;
                        if (a.i.lowLatencyMode && a.j.isLowLatency && l && k && (a.j.type != "HLS" || d.o)) return r = new Uint8Array(0), v = u = false, z = function z(E) {
                          var J, H, K;
                          return P(function (O) {
                            switch (O.g) {
                              case 1:
                                if (u) return O.return();
                                v = true;
                                $g(a.l);
                                if (a.F) return O.return();
                                ua(O, 2);
                                r = tc(r, E);
                                J = false;
                                H = 0;
                                new hh().box("mdat", function (Q) {
                                  H = Q.size + Q.start;
                                  J = true;
                                }).parse(r, false, true);
                                if (!J) {
                                  O.A(4);
                                  break;
                                }
                                K = r.subarray(0, H);
                                r = r.subarray(H);
                                return F(O, hn(a, b, c, g, d, K, true, e), 5);
                              case 5:
                                b.ha && b.ua && hm(b.ha, d.startTime, true);
                              case 4:
                                xa(O, 0);
                                break;
                              case 2:
                                w = ya(O), G(O);
                            }
                          });
                        }, F(A, jn(a, b, d, z), 9);
                        n = jn(a, b, d);
                        return F(A, n, 7);
                      case 7:
                        q = A.h;
                        $g(a.l);
                        if (a.F) return A.return();
                        $g(a.l);
                        return b.ec ? (b.Ja = false, Im(a, b, 0), A.return()) : F(A, hn(a, b, c, g, d, q, false, e), 6);
                      case 9:
                        y = A.h;
                        if (w) throw w;
                        if (v) {
                          A.A(10);
                          break;
                        }
                        u = true;
                        $g(a.l);
                        return a.F ? A.return() : b.ec ? (b.Ja = false, Im(a, b, 0), A.return()) : F(A, hn(a, b, c, g, d, y, false, e), 10);
                      case 10:
                        b.ha && b.ua && hm(b.ha, d.startTime, true);
                      case 6:
                        $g(a.l);
                        if (a.F) return A.return();
                        b.La = d;
                        h.next();
                        b.Ja = false;
                        b.ah = false;
                        B = a.g.Z.Fc();
                        D = B[b.type];
                        fb(JSON.stringify(D));
                        b.ec || (I = null, b.type === f.Aa ? I = a.h.get(f.ka) : b.type === f.ka && (I = a.h.get(f.Aa)), I && I.type == f.ka ? a.g.wf(d, b.stream, I.stream.isAudioMuxedInVideo) : a.g.wf(d, b.stream, b.stream.codecs.includes(",")));
                        Am(b);
                        Im(a, b, 0);
                        xa(A, 0);
                        break;
                      case 2:
                        C = ya(A);
                        $g(a.l, C);
                        if (a.F) return A.return();
                        b.Ja = false;
                        if (C.code == 7001) b.Ja = false, Am(b), Im(a, b, 0), A.A(0);else if (b.type == f.Na && a.i.ignoreTextStreamFailures) a.h.delete(f.Na), A.A(0);else {
                          if (C.code == 3017) return F(A, kn(a, b, C), 0);
                          b.Zd = true;
                          C.category == 1 && b.ha && nm(b.ha, d);
                          C.severity = 2;
                          return F(A, Zm(a, b, C), 0);
                        }
                    }
                  });
                }
                function fn(a, b, c, d) {
                  var e, f, g, h, k, l, m, n, q, r, u;
                  return P(function (v) {
                    switch (v.g) {
                      case 1:
                        e = b.stream;
                        for (h = (g = (f = e.segmentIndex) && f.Vb(c)) && g.next().value; h && a.O.includes(h.startTime);) h = g && g.next().value;
                        if (!h) {
                          v.A(0);
                          break;
                        }
                        k = h.ba;
                        if (!k || qj(k, b.pb)) {
                          v.A(3);
                          break;
                        }
                        b.pb = k;
                        ua(v, 4);
                        return F(v, jn(a, b, k), 6);
                      case 6:
                        l = v.h;
                        var w = a.g.Z;
                        w.C && Fc(w.C, l, 0, e);
                        a.O = [];
                        xa(v, 3);
                        break;
                      case 4:
                        throw m = ya(v), b.pb = null, m;
                      case 3:
                        if (b.La && b.La == h) {
                          v.A(0);
                          break;
                        }
                        b.La = h;
                        ua(v, 8);
                        return F(v, jn(a, b, h), 10);
                      case 10:
                        n = v.h;
                        w = a.g.Z;
                        w.C && Fc(w.C, n, 0, e);
                        a.O.push(h.startTime);
                        xa(v, 9);
                        break;
                      case 8:
                        throw q = ya(v), b.La = null, q;
                      case 9:
                        r = Math.max.apply(Math, [0].concat(x(a.O)));
                        u = a.g.lc();
                        if (u + d > r) return F(v, fn(a, b, h.startTime, d), 0);
                        v.A(0);
                    }
                  });
                }
                function kn(a, b, c) {
                  var d, f, h, k, l, m, n;
                  return P(function (q) {
                    switch (q.g) {
                      case 1:
                        d = Array.from(a.h.values());
                        if (d.some(function (r) {
                          return r != b && r.ah;
                        })) {
                          q.A(2);
                          break;
                        }
                        if (a.i.avoidEvictionOnQuotaExceededError) {
                          f = ln(a, c);
                          if (a.g.disableStream(b.stream, f)) return q.return();
                          Im(a, b, 4);
                          return q.return();
                        }
                        h = Math.round(100 * a.C);
                        if (h > 20) {
                          a.C -= .2;
                          q.A(3);
                          break;
                        }
                        if (h > 4) {
                          a.C -= .04;
                          q.A(3);
                          break;
                        }
                        k = ln(a, c);
                        l = a.g.disableStream(b.stream, k);
                        if (!l) {
                          b.Zd = true;
                          a.F = true;
                          a.g.onError(c);
                          q.A(5);
                          break;
                        }
                        a.C = 1;
                        m = a.g.lc();
                        return F(q, mn(a, b, m), 5);
                      case 5:
                        return q.return();
                      case 3:
                        return b.ah = true, n = a.g.lc(), F(q, mn(a, b, n), 2);
                      case 2:
                        Im(a, b, 4), G(q);
                    }
                  });
                }
                function gn(a, b, c, d) {
                  var e, f, g, h, k, l, m, n, q, r, u, v, w, z, y, B;
                  return P(function (D) {
                    switch (D.g) {
                      case 1:
                        e = Cc;
                        f = b.La == null;
                        g = [];
                        h = Math.max(0, Math.max(c.appendWindowStart, a.aa) - .1);
                        k = Math.min(c.appendWindowEnd, a.$) + .1;
                        l = c.codecs || b.stream.codecs;
                        m = Me(l);
                        n = Ne(c.mimeType || b.stream.mimeType);
                        q = c.timestampOffset;
                        if (q == b.kf && h == b.qc && k == b.nc && m == b.hf && n == b.jf) {
                          D.A(2);
                          break;
                        }
                        r = b.hf && b.jf && nl(a.g.Z, b.type, n, l, Wm(a));
                        if (!r) {
                          D.A(3);
                          break;
                        }
                        u = null;
                        b.type === e.Aa ? u = a.h.get(e.ka) : b.type === e.ka && (u = a.h.get(e.Aa));
                        if (!u) {
                          D.A(3);
                          break;
                        }
                        return F(D, Bm(u).catch(function () {}), 5);
                      case 5:
                        u.pb = null, u.qc = null, u.nc = null, Rm(a, u);
                      case 3:
                        return F(D, nn(a, b, q, h, k, c, m, n), 2);
                      case 2:
                        return qj(c.ba, b.pb) || (b.pb = c.ba, c.l && c.ba && (v = jn(a, b, c.ba), w = function w() {
                          var I, C, A, E, J, H, K, L, O, Q, N;
                          return P(function (M) {
                            switch (M.g) {
                              case 1:
                                return ua(M, 2), F(M, v, 4);
                              case 4:
                                return I = M.h, $g(a.l), C = null, A = new Map(), E = {
                                  projection: null,
                                  hfov: null
                                }, b.stream && (J = b.stream.videoLayout) && (H = J.split("/"), H.includes("PROJ-RECT") ? E.projection = "rect" : H.includes("PROJ-EQUI") ? E.projection = "equi" : H.includes("PROJ-HEQU") ? E.projection = "hequ" : H.includes("PROJ-PRIM") ? E.projection = "prim" : H.includes("PROJ-AIV") && (E.projection = "hequ")), K = new hh(), K.box("moov", mh).box("trak", mh).box("mdia", mh).S("mdhd", function (R) {
                                  C = Di(R.reader, R.version).timescale;
                                }).box("hdlr", function (R) {
                                  R = R.reader;
                                  R.skip(8);
                                  switch (R.Yc()) {
                                    case "soun":
                                      A.set(e.ka, C);
                                      break;
                                    case "vide":
                                      A.set(e.Aa, C);
                                  }
                                  C = null;
                                }), b.type !== e.Aa || E.projection || K.box("minf", mh).box("stbl", mh).S("stsd", oh).box("encv", ph).box("avc1", ph).box("avc3", ph).box("hev1", ph).box("hvc1", ph).box("dvav", ph).box("dva1", ph).box("dvh1", ph).box("dvhe", ph).box("dvc1", ph).box("dvi1", ph).box("vexu", mh).box("proj", mh).S("prji", function (R) {
                                  R = R.reader.Yc();
                                  E.projection = R;
                                }).box("hfov", function (R) {
                                  R = R.reader.U() / 1E3;
                                  E.hfov = R;
                                }), K.parse(I, true, true), b.type === e.Aa && on(a, E), A.has(b.type) ? c.ba.timescale = A.get(b.type) : C != null && (c.ba.timescale = C), L = b.stream.segmentIndex, L instanceof Ql && (O = Sl(L, c.startTime)), Q = b.stream.closedCaptions && b.stream.closedCaptions.size > 0, F(M, a.g.Oh(b.type, I), 5);
                              case 5:
                                return F(M, Nk(a.g.Z, b.type, I, null, b.stream, Q, b.bd, d, false, false, O), 6);
                              case 6:
                                xa(M, 0);
                                break;
                              case 2:
                                throw N = ya(M), b.pb = null, N;
                            }
                          });
                        }, z = c.startTime, f && (y = Kk(a.g.Z, b.type), y != null && (z = y)), a.g.Bk(z, c.ba), g.push(w()))), B = b.La ? b.La.i : -1, c.i != B && g.push(Zk(a.g.Z, b.type, c.startTime)), F(D, Promise.all(g), 0);
                    }
                  });
                }
                function nn(a, b, c, d, e, f, g, h) {
                  var k, l, m, n, q;
                  return P(function (r) {
                    switch (r.g) {
                      case 1:
                        k = Cc;
                        l = Wm(a);
                        ua(r, 2);
                        b.qc = d;
                        b.nc = e;
                        g && (b.hf = g);
                        h && (b.jf = h);
                        b.kf = c;
                        m = a.j.sequenceMode || a.j.type == "HLS";
                        n = null;
                        b.type === k.Aa ? n = a.h.get(k.ka) : b.type === k.ka && (n = a.h.get(k.Aa));
                        if (!(n && n.stream && n.stream.isAudioMuxedInVideo)) {
                          r.A(4);
                          break;
                        }
                        return F(r, Wk(a.g.Z, n.type, c, d, e, m, n.stream.mimeType, n.stream.codecs, l), 4);
                      case 4:
                        return F(r, Wk(a.g.Z, b.type, c, d, e, m, f.mimeType || b.stream.mimeType, f.codecs || b.stream.codecs, l), 6);
                      case 6:
                        xa(r, 0);
                        break;
                      case 2:
                        throw q = ya(r), b.qc = null, b.nc = null, b.hf = null, b.jf = null, b.kf = null, q;
                    }
                  });
                }
                function hn(a, b, c, d, e, f, g, h) {
                  g = g === void 0 ? false : g;
                  h = h === void 0 ? false : h;
                  var k, l, m, q;
                  return P(function (r) {
                    switch (r.g) {
                      case 1:
                        return k = d.closedCaptions && d.closedCaptions.size > 0, a.i.shouldFixTimestampOffset && (l = d.mimeType == "video/mp4" || d.mimeType == "audio/mp4", m = null, e.ba && (m = e.ba.timescale), l && m && d.type === "video" && a.j.type == "DASH" && new hh().box("moof", mh).box("traf", mh).S("tfdt", function (u) {
                          var v, w, z, y, B, D;
                          return P(function (I) {
                            v = Ci(u.reader, u.version);
                            w = v.baseMediaDecodeTime;
                            if (!w) return I.return();
                            z = -w / m;
                            y = Number(b.kf) || 0;
                            if (!(y < z)) return I.A(0);
                            B = b.qc;
                            D = b.nc;
                            return F(I, nn(a, b, z, B, D, e), 0);
                          });
                        }).parse(f, false, g)), F(r, mn(a, b, c), 2);
                      case 2:
                        return $g(a.l), q = b.bd, b.bd = false, F(r, a.g.Oh(b.type, f), 3);
                      case 3:
                        return F(r, Nk(a.g.Z, b.type, f, e, d, k, q, h, g), 4);
                      case 4:
                        $g(a.l), G(r);
                    }
                  });
                }
                function mn(a, b, c) {
                  var d, e, f, g, h, k, l, m, n;
                  return P(function (q) {
                    if (q.g == 1) {
                      d = b.stream.segmentIndex;
                      d instanceof Ql && (d.Ya(a.j.presentationTimeline.Hb()), e = [], Rl(d, function (r) {
                        e.push(r.Te());
                      }));
                      f = Math.max(a.i.bufferBehind * a.C, a.j.presentationTimeline.h);
                      g = Ik(a.g.Z, b.type);
                      if (g == null) return a.H == b && (a.H = null), q.return();
                      h = c - g;
                      k = a.i.evictionGoal;
                      l = a.j.presentationTimeline.Xb();
                      m = a.j.presentationTimeline.Gb();
                      n = h - f;
                      m - l > k && (n = Math.max(h - f, l - k - g));
                      return n <= k ? q.return() : F(q, a.g.Z.remove(b.type, g, g + n, e), 2);
                    }
                    if (q.g != 4) return $g(a.l), a.H ? F(q, mn(a, a.H, c), 4) : q.A(0);
                    $g(a.l);
                    G(q);
                  });
                }
                function an(a) {
                  return a && a.type == Ac && (a.stream.mimeType == "application/cea-608" || a.stream.mimeType == "application/cea-708");
                }
                function jn(a, b, c, d) {
                  var e, f, g, h, k;
                  return P(function (l) {
                    switch (l.g) {
                      case 1:
                        if (e = c.Yb()) return l.return(e);
                        f = null;
                        if (b.ha) {
                          var m = b.ha,
                            n = m.g;
                          c instanceof pj && (n = m.j);
                          n.has(c) ? (m = n.get(c), d && (m.wh = d), f = m.je) : f = null;
                        }
                        f || (f = Xm(c, b.stream, d || null, a.i.retryParameters, a.g.tc));
                        g = 0;
                        b.ua && (g = b.ua.h);
                        b.Va = f;
                        return F(l, f.promise, 2);
                      case 2:
                        h = l.h;
                        b.Va = null;
                        k = h.data;
                        if (!c.aesKey) {
                          l.A(3);
                          break;
                        }
                        return F(l, wm(k, c.aesKey, g), 4);
                      case 4:
                        k = l.h;
                      case 3:
                        return l.return(k);
                    }
                  });
                }
                function Xm(a, b, c, d, e, f) {
                  f = f === void 0 ? false : f;
                  var g = a instanceof rj ? a : void 0,
                    h = g ? 1 : 0;
                  a = xm(a.P(), a.startByte, a.endByte, d, c);
                  a.contentType = b.type;
                  return e.request(Xg, a, {
                    type: h,
                    stream: b,
                    segment: g,
                    isPreload: f
                  });
                }
                function Tm(a, b, c, d) {
                  var e, f;
                  return P(function (g) {
                    if (g.g == 1) return b.ec = false, b.Kd = false, b.ld = 0, b.Ub = true, b.La = null, b.ua = null, b.ha && !a.m.has(b.stream) && om(b.ha), d ? (e = a.g.lc(), f = a.g.Z.getDuration(), F(g, a.g.Z.remove(b.type, e + d, f), 3)) : F(g, Vk(a.g.Z, b.type), 4);
                    if (g.g != 3) return $g(a.l), c ? F(g, a.g.Z.flush(b.type), 3) : g.A(3);
                    $g(a.l);
                    b.Ub = false;
                    b.endOfStream = false;
                    b.Ja || b.qb || Im(a, b, 0);
                    G(g);
                  });
                }
                function Im(a, b, c) {
                  var d = b.type;
                  if (d != Ac || a.h.has(d)) b.qb = new cf(function () {
                    var e;
                    return P(function (f) {
                      if (f.g == 1) return ua(f, 2), F(f, Ym(a, b), 4);
                      if (f.g != 2) return xa(f, 0);
                      e = ya(f);
                      if (a.g) a.g.onError(e);
                      G(f);
                    });
                  }).ia(c);
                }
                function Am(a) {
                  a.qb != null && (a.qb.stop(), a.qb = null);
                }
                function Bm(a) {
                  return P(function (b) {
                    return a.Va ? F(b, a.Va.abort(), 0) : b.A(0);
                  });
                }
                function Zm(a, b, c) {
                  var d;
                  return P(function (e) {
                    if (e.g == 1) return c.code == 3024 ? (b.Ja = false, Am(b), Im(a, b, 0), e.return()) : F(e, yg(a.X), 2);
                    $g(a.l);
                    if (c.category === 1 && c.code != 1003) {
                      if (b.Mc) return Km(a, false), e.return();
                      d = ln(a, c);
                      c.handled = a.g.disableStream(b.stream, d);
                      c.handled && (c.severity = 1);
                    }
                    if (!c.handled || c.code != 1011) a.g.onError(c);
                    c.handled || a.i.failureCallback(c);
                    G(e);
                  });
                }
                function ln(a, b) {
                  return a.i.maxDisabledTime === 0 && b.code == 1011 ? 1 : a.i.maxDisabledTime;
                }
                function bn(a, b) {
                  b = b === void 0 ? false : b;
                  var c, d, e, f, g, h;
                  return P(function (k) {
                    if (k.g == 1) {
                      c = Date.now() / 1E3;
                      d = a.i.minTimeBetweenRecoveries;
                      if (!b) {
                        if (!a.i.allowMediaSourceRecoveries || c - a.R < d) return k.return(false);
                        a.R = c;
                      }
                      e = Cc;
                      if (f = a.h.get(e.ka)) Am(f), f.Va && (f.Va.abort(), f.Va = null), f.pb = null, f.qc = null, f.nc = null, f.Ja = false, f.ec = false, f.ld = 0, f.Kd = false, f.Ub = false, f.ua && f.ua.eh();
                      if (g = a.h.get(e.Aa)) Am(g), g.Va && (g.Va.abort(), g.Va = null), g.pb = null, g.qc = null, g.nc = null, g.Ja = false, g.ec = false, g.ld = 0, g.Kd = false, g.Ub = false, g.ua && g.ua.eh();
                      h = a.g.video.paused;
                      return F(k, hl(a.g.Z, Wm(a)), 2);
                    }
                    !g || g.Ub || g.Ja || g.qb || Im(a, g, 0);
                    !f || f.Ub || f.Ja || f.qb || Im(a, f, 0);
                    h || a.g.video.play();
                    return k.return(true);
                  });
                }
                function on(a, b) {
                  if (a.T.projection != b.projection || a.T.hfov != b.hfov) {
                    if (b.projection != null || b.hfov != null) {
                      var c = new Map().set("detail", b);
                      c = new V("spatialvideoinfo", c);
                    } else c = new V("nospatialvideoinfo");
                    c.cancelable = true;
                    a.g.onEvent(c);
                    a.T = b;
                  }
                }
                function Um(a) {
                  if (a.i.crossBoundaryStrategy !== "keep") return true;
                  var b = tb();
                  if (!Kc() || !b.Pc()) {
                    b = t(a.h.keys());
                    for (var c = b.next(); !c.done; c = b.next()) if (c = a.h.get(c.value), c.type !== Cc.Na && (c = c.stream) && c.fullMimeTypes && c.fullMimeTypes.size > 1) return true;
                  } else if (!b.Jf()) for (b = t(a.h.keys()), c = b.next(); !c.done; c = b.next()) if (c = a.h.get(c.value), c.type !== Cc.Na && (c = c.stream) && c.fullMimeTypes && c.fullMimeTypes.size > 1) {
                    a = new Set();
                    b = t(c.fullMimeTypes);
                    for (c = b.next(); !c.done; c = b.next()) a.add(Je(c.value));
                    return a.size > 1;
                  }
                  return false;
                }
                function Qm(a) {
                  a.G.Pa();
                  Um(a) && (a.G.D(a.g.video, "waiting", function () {
                    return Vm(a);
                  }), a.G.D(a.g.video, "timeupdate", function () {
                    return Vm(a);
                  }));
                }
                function Vm(a) {
                  if (Um(a)) {
                    a.K.stop();
                    var b = a.g.lc(),
                      c = a.h.get("video") || a.h.get("audio");
                    c && (c = c.pb) && c.g !== null && (b = c.g - b, b < 0 || b > 1 || (a.I = c.g + .1, a.K.ia(b)));
                  }
                }
                function dn(a, b, c) {
                  if (b.type === Ac) return false;
                  var d = b.pb;
                  if (!d) return false;
                  var e = c.ba;
                  c = d.g !== e.g;
                  a.i.crossBoundaryStrategy === "reset_to_encrypted" && (d.encrypted || e.encrypted || (c = false), d.encrypted && (a.i.crossBoundaryStrategy = "keep"));
                  a.i.crossBoundaryStrategy === "RESET_ON_ENCRYPTION_CHANGE" && d.encrypted == e.encrypted && (c = false);
                  if (a.i.crossBoundaryStrategy === "keep" && d.mimeType && e.mimeType) {
                    var f = Ke(Oe(d.mimeType)),
                      g = Ke(Oe(d.mimeType));
                    d.mimeType == e.mimeType && f == g && (c = false);
                  }
                  c && (a.J || b.bd) && (a.J = false, bn(a, true).then(function () {
                    var h = new Map().set("oldEncrypted", d.encrypted).set("newEncrypted", e.encrypted);
                    a.g.onEvent(new V("boundarycrossed", h));
                  }));
                  return c;
                }
                function Wm(a, b) {
                  function c(f) {
                    if (f.fullMimeTypes && f.fullMimeTypes.size > 1 && a.h.has(f.type)) {
                      var g = a.h.get(f.type),
                        h = Kk(a.g.Z, g.type),
                        k = a.g.lc();
                      (g = cn(a, g, k, h)) && g.codecs && g.mimeType && (f.codecs = g.codecs, f.mimeType = g.mimeType);
                    }
                  }
                  b = b === void 0 ? false : b;
                  var d = new Map(),
                    e = a.o.audio;
                  e && (c(e), d.set("audio", e));
                  if (e = a.o.video) c(e), d.set("video", e);
                  b && a.B && d.set(Ac, a.B);
                  return d;
                }
                function pn() {}
                function qn(a, b, c, d, e) {
                  var f = e in d;
                  var g = f ? c.constructor == Object && Object.keys(d).length == 0 : c.constructor == Object && Object.keys(c).length == 0;
                  var h = f || g,
                    k = true,
                    l;
                  for (l in b) {
                    var m = e + "." + l,
                      n = f ? d[e] : c[l];
                    h || l in c ? b[l] === void 0 ? n === void 0 || h ? delete a[l] : a[l] = gd(n) : g ? a[l] = b[l] : n.constructor == Object && b[l] && b[l].constructor == Object ? (a[l] || (a[l] = gd(n)), m = qn(a[l], b[l], n, d, m), k = k && m) : _typeof(b[l]) != _typeof(n) || b[l] == null || typeof b[l] != "function" && b[l].constructor != n.constructor ? ($a("Invalid config, wrong type for " + m), k = false) : typeof c[l] == "function" && c[l].length != b[l].length ? (ab("Unexpected number of arguments for " + m), a[l] = b[l]) : a[l] = Array.isArray(a[l]) ? b[l].slice() : b[l] : ($a("Invalid config, unrecognized key " + m), k = false);
                  }
                  return k;
                }
                function rn(a, b) {
                  for (var c = {}, d = c, e = 0, f = 0;;) {
                    e = a.indexOf(".", e);
                    if (e < 0) break;
                    if (e == 0 || a[e - 1] != "\\") f = a.substring(f, e).replace(/\\\./g, "."), d[f] = {}, d = d[f], f = e + 1;
                    e += 1;
                  }
                  d[a.substring(f).replace(/\\\./g, ".")] = b;
                  return c;
                }
                function sn(a, b) {
                  return a && b;
                }
                function tn(a, b) {
                  function c(f) {
                    for (var g = t(Object.keys(f)), h = g.next(); !h.done; h = g.next()) if (h = h.value, !(f[h] instanceof HTMLElement)) if (e(f[h]) && Object.keys(f[h]).length === 0) delete f[h];else {
                      var k = f[h];
                      Array.isArray(k) && k.length === 0 ? delete f[h] : typeof f[h] == "function" ? delete f[h] : e(f[h]) && (c(f[h]), Object.keys(f[h]).length === 0 && delete f[h]);
                    }
                  }
                  function d(f, g) {
                    return Object.keys(f).reduce(function (h, k) {
                      var l = f[k];
                      if (g.hasOwnProperty(k)) {
                        if (l instanceof HTMLElement && g[k] instanceof HTMLElement) l.isEqualNode(g[k]) || (h[k] = l);else if (e(l) && e(g[k])) {
                          if (l = d(l, g[k]), Object.keys(l).length > 0 || !e(l)) h[k] = l;
                        } else Array.isArray(l) && Array.isArray(g[k]) ? kb(l, g[k]) || (h[k] = l) : Number.isNaN(l) && Number.isNaN(g[k]) || l !== g[k] && (h[k] = l);
                      } else h[k] = l;
                      return h;
                    }, {});
                  }
                  function e(f) {
                    return f && _typeof(f) === "object" && !Array.isArray(f);
                  }
                  a = d(a, b);
                  c(a);
                  return a;
                }
                S("shaka.util.ConfigUtils", pn);
                pn.getDifferenceFromConfigObjects = tn;
                pn.convertToConfigObject = rn;
                pn.mergeConfigObjects = qn;
                S("shaka.config.RepeatMode", {
                  OFF: 0,
                  ALL: 1,
                  SINGLE: 2
                });
                function un() {}
                function vn(a) {
                  a = hc(a);
                  return new Db(a).Db;
                }
                function wn(a, b, c) {
                  function d(h) {
                    ac(f).setUint32(g, h.byteLength, true);
                    g += 4;
                    f.set(Vb(h), g);
                    g += h.byteLength;
                  }
                  if (!c || !c.byteLength) throw new U(2, 6, 6015);
                  var e;
                  typeof b == "string" ? e = jc(b, true) : e = b;
                  a = hc(a);
                  a = jc(a, true);
                  var f = new Uint8Array(12 + a.byteLength + e.byteLength + c.byteLength),
                    g = 0;
                  d(a);
                  d(e);
                  d(c);
                  return f;
                }
                function xn(a, b, c) {
                  if (b !== "skd") return a;
                  b = c.serverCertificate;
                  c = hc(a).split("skd://").pop();
                  return wn(a, c, b);
                }
                function yn(a, b) {
                  a === 2 && (a = b.drmInfo) && tg(a.keySystem) && (b.headers["Content-Type"] = "application/octet-stream");
                }
                S("shaka.drm.FairPlay", un);
                un.commonFairPlayResponse = function (a, b) {
                  if (a === 2 && (a = b.originalRequest.drmInfo) && tg(a.keySystem)) {
                    try {
                      var c = dc(b.data);
                    } catch (e) {
                      return;
                    }
                    a = false;
                    c = c.trim();
                    c.substr(0, 5) === "<ckc>" && c.substr(-6) === "</ckc>" && (c = c.slice(5, -6), a = true);
                    if (!a) try {
                      var d = JSON.parse(c);
                      d.ckc && (c = d.ckc, a = !0);
                      d.CkcMessage && (c = d.CkcMessage, a = !0);
                      d.License && (c = d.License, a = !0);
                    } catch (e) {}
                    a && (b.data = Wb(pc(c)));
                  }
                };
                un.muxFairPlayRequest = function (a, b) {
                  yn(a, b);
                };
                un.expressplayFairPlayRequest = function (a, b) {
                  if (a === 2) {
                    var c = b.drmInfo;
                    c && tg(c.keySystem) && yn(a, b);
                  }
                };
                un.conaxFairPlayRequest = function (a, b) {
                  yn(a, b);
                };
                un.ezdrmFairPlayRequest = function (a, b) {
                  yn(a, b);
                };
                un.verimatrixFairPlayRequest = function (a, b) {
                  a === 2 && (a = b.drmInfo) && tg(a.keySystem) && (a = Vb(b.body), a = oc(a), b.headers["Content-Type"] = "application/x-www-form-urlencoded", b.body = ic("spc=" + a));
                };
                un.muxInitDataTransform = function (a, b, c) {
                  return xn(a, b, c);
                };
                un.expressplayInitDataTransform = function (a, b, c) {
                  return xn(a, b, c);
                };
                un.conaxInitDataTransform = function (a, b, c) {
                  if (b !== "skd") return a;
                  b = c.serverCertificate;
                  c = hc(a).split("skd://").pop().split("?").shift();
                  c = window.atob(c);
                  var d = new ArrayBuffer(c.length * 2);
                  d = $b(d);
                  for (var e = 0, f = c.length; e < f; e++) d[e] = c.charCodeAt(e);
                  return wn(a, d, b);
                };
                un.ezdrmInitDataTransform = function (a, b, c) {
                  if (b !== "skd") return a;
                  b = c.serverCertificate;
                  c = hc(a).split(";").pop();
                  return wn(a, c, b);
                };
                un.verimatrixInitDataTransform = function (a, b, c) {
                  return xn(a, b, c);
                };
                un.initDataTransform = wn;
                un.defaultGetContentId = vn;
                un.isFairPlaySupported = function () {
                  var a;
                  return P(function (b) {
                    if (b.g == 1) return a = {
                      initDataTypes: ["cenc", "sinf", "skd"],
                      videoCapabilities: [{
                        contentType: 'video/mp4; codecs="avc1.42E01E"'
                      }]
                    }, ua(b, 2), F(b, navigator.requestMediaKeySystemAccess("com.apple.fps", [a]), 4);
                    if (b.g != 2) return b.return(true);
                    ya(b);
                    return b.return(false);
                  });
                };
                function zn(a, b, c) {
                  c = c === void 0 ? true : c;
                  this.h = a;
                  this.g = new Set([a]);
                  b = b || [];
                  a = t(b);
                  for (b = a.next(); !b.done; b = a.next()) this.add(b.value, c);
                }
                zn.prototype.add = function (a, b) {
                  var c = this.h;
                  b = b === void 0 ? true : b;
                  var d;
                  if (!(d = !!c.audio != !!a.audio || !!c.video != !!a.video || c.language != a.language) && (d = c.audio && a.audio)) {
                    d = c.audio;
                    var e = a.audio;
                    d = !(!((!d.channelsCount || !e.channelsCount || d.channelsCount > 2 || e.channelsCount > 2) && d.channelsCount != e.channelsCount || d.spatialAudio !== e.spatialAudio || b && !An(d, e)) && kb(d.roles, e.roles) && d.groupId === e.groupId);
                  }
                  !d && (d = c.video && a.video) && (c = c.video, d = a.video, d = !((!b || An(c, d)) && kb(c.roles, d.roles)));
                  return d ? false : (this.g.add(a), true);
                };
                zn.prototype.values = function () {
                  return this.g.values();
                };
                function An(a, b) {
                  if (a.mimeType != b.mimeType) return false;
                  a = a.codecs.split(",").map(function (c) {
                    return Me(c);
                  });
                  b = b.codecs.split(",").map(function (c) {
                    return Me(c);
                  });
                  return kb(a, b);
                }
                S("shaka.media.AdaptationSet", zn);
                function Bn() {
                  this.h = this.g = null;
                }
                Bn.prototype.configure = function (a) {
                  this.g = a;
                };
                Bn.prototype.getConfiguration = function () {
                  return this.g;
                };
                Bn.prototype.create = function (a) {
                  var b;
                  if (this.g.language) {
                    var c = Cn(a, this.g.language);
                    c.length && (b = c);
                  }
                  b || (b = a.filter(function (f) {
                    return f.primary;
                  }), b = b.length ? b : a);
                  a = Dn(b, this.g.role);
                  a.length && (b = a);
                  a = En(b, this.g.videoRole);
                  a.length && (b = a);
                  this.g.videoLayout && (a = Fn(b, this.g.videoLayout), a.length && (b = a));
                  this.g.hdrLevel && (a = Gn(b, this.g.hdrLevel), a.length && (b = a));
                  var d = [this.g.channelCount, this.g.preferredAudioChannelCount];
                  a = d.filter(function (f, g) {
                    return f && d.indexOf(f) === g;
                  });
                  if (a.length) for (a = t(a), c = a.next(); !c.done; c = a.next()) if (c = Hn(b, c.value), c.length) {
                    b = c;
                    break;
                  }
                  this.g.audioLabel && (a = In(b, this.g.audioLabel), a.length && (b = a));
                  this.g.videoLabel && (a = Jn(b, this.g.videoLabel), a.length && (b = a));
                  a = Kn(b, this.g.spatialAudio);
                  a.length && (b = a);
                  var e = [this.g.audioCodec, this.g.activeAudioCodec].concat(x(this.g.preferredAudioCodecs));
                  a = e.filter(function (f, g) {
                    return f && e.indexOf(f) === g;
                  });
                  if (a.length) for (a = t(a), c = a.next(); !c.done; c = a.next()) if (c = Ln(b, c.value), c.length) {
                    b = c;
                    break;
                  }
                  return this.h = new zn(b[0], b, !(this.g.codecSwitchingStrategy == "smooth" && Kc()));
                };
                Bn.prototype.getLastAdaptationSet = function () {
                  return this.h;
                };
                function Cn(a, b) {
                  b = lf(b);
                  var c = sf(b, a.map(function (d) {
                    return rf(d);
                  }));
                  return c ? a.filter(function (d) {
                    return c == rf(d);
                  }) : [];
                }
                function Dn(a, b) {
                  return a.filter(function (c) {
                    return c.audio ? b ? c.audio.roles.includes(b) : c.audio.roles.length == 0 : false;
                  });
                }
                function En(a, b) {
                  return a.filter(function (c) {
                    return c.video ? b ? c.video.roles.includes(b) : c.video.roles.length == 0 : false;
                  });
                }
                function In(a, b) {
                  return a.filter(function (c) {
                    return c.audio && c.audio.label ? c.audio.label.toLowerCase() == b.toLowerCase() : false;
                  });
                }
                function Jn(a, b) {
                  return a.filter(function (c) {
                    return c.video && c.video.label ? c.video.label.toLowerCase() == b.toLowerCase() : false;
                  });
                }
                function Hn(a, b) {
                  return a.filter(function (c) {
                    return c.audio && c.audio.channelsCount && c.audio.channelsCount > b ? false : true;
                  }).sort(function (c, d) {
                    return c.audio || d.audio ? c.audio ? d.audio ? (d.audio.channelsCount || 0) - (c.audio.channelsCount || 0) : 1 : -1 : 0;
                  });
                }
                function Gn(a, b) {
                  if (b == "AUTO") {
                    var c = a.some(function (d) {
                      return d.video && d.video.hdr && d.video.hdr == "HLG" ? true : false;
                    });
                    b = tb().sd(c);
                  }
                  return a.filter(function (d) {
                    return d.video && d.video.hdr && d.video.hdr != b ? false : true;
                  });
                }
                function Fn(a, b) {
                  return a.filter(function (c) {
                    return c.video && c.video.videoLayout && c.video.videoLayout != b ? false : true;
                  });
                }
                function Kn(a, b) {
                  return a.filter(function (c) {
                    return c.audio && c.audio.spatialAudio != b ? false : true;
                  });
                }
                function Ln(a, b) {
                  return a.filter(function (c) {
                    return c.audio && c.audio.codecs != b ? false : true;
                  });
                }
                function Mn() {}
                function Nn() {
                  var a = Infinity,
                    b = tb();
                  navigator.connection && navigator.connection.saveData && (a = 360);
                  var c = {
                      retryParameters: xg(),
                      servers: {},
                      clearKeys: {},
                      advanced: {},
                      delayLicenseRequestUntilPlayed: false,
                      persistentSessionOnlinePlayback: false,
                      persistentSessionsMetadata: [],
                      initDataTransform: function initDataTransform(h, k, l) {
                        "apple" === window.shakaMediaKeysPolyfill && k == "skd" && (k = l.serverCertificate, l = vn(h), h = wn(h, l, k));
                        return h;
                      },
                      logLicenseExchange: false,
                      updateExpirationTime: 1,
                      preferredKeySystems: [],
                      keySystemsMapping: {},
                      parseInbandPsshEnabled: false,
                      minHdcpVersion: "",
                      ignoreDuplicateInitData: true,
                      defaultAudioRobustnessForWidevine: "SW_SECURE_CRYPTO",
                      defaultVideoRobustnessForWidevine: "SW_SECURE_DECODE"
                    },
                    d = "reload";
                  Kc() && b.Pc() && (d = "smooth");
                  var e = {
                      retryParameters: xg(),
                      availabilityWindowOverride: NaN,
                      disableAudio: false,
                      disableVideo: false,
                      disableText: false,
                      disableThumbnails: false,
                      disableIFrames: false,
                      defaultPresentationDelay: 0,
                      segmentRelativeVttTiming: false,
                      raiseFatalErrorOnManifestUpdateRequestFailure: false,
                      continueLoadingWhenPaused: true,
                      ignoreSupplementalCodecs: false,
                      updatePeriod: -1,
                      ignoreDrmInfo: false,
                      enableAudioGroups: true,
                      dash: {
                        clockSyncUri: "",
                        disableXlinkProcessing: true,
                        xlinkFailGracefully: false,
                        ignoreMinBufferTime: false,
                        autoCorrectDrift: true,
                        initialSegmentLimit: 1E3,
                        ignoreSuggestedPresentationDelay: false,
                        ignoreEmptyAdaptationSet: false,
                        ignoreMaxSegmentDuration: false,
                        keySystemsByURI: {
                          "urn:uuid:1077efec-c0b2-4d02-ace3-3c1e52e2fb4b": "org.w3.clearkey",
                          "urn:uuid:e2719d58-a985-b3c9-781a-b030af78d30e": "org.w3.clearkey",
                          "urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed": "com.widevine.alpha",
                          "urn:uuid:9a04f079-9840-4286-ab92-e65be0885f95": "com.microsoft.playready",
                          "urn:uuid:79f0049a-4098-8642-ab92-e65be0885f95": "com.microsoft.playready",
                          "urn:uuid:94ce86fb-07ff-4f43-adb8-93d2fa968ca2": "com.apple.fps",
                          "urn:uuid:3d5e6d35-9b9a-41e8-b843-dd3c6e72c42c": "com.huawei.wiseplay"
                        },
                        manifestPreprocessor: On,
                        manifestPreprocessorTXml: Pn,
                        sequenceMode: false,
                        useStreamOnceInPeriodFlattening: false,
                        enableFastSwitching: true
                      },
                      hls: {
                        ignoreTextStreamFailures: false,
                        ignoreImageStreamFailures: false,
                        defaultAudioCodec: "mp4a.40.2",
                        defaultVideoCodec: "avc1.42E01E",
                        ignoreManifestProgramDateTime: false,
                        ignoreManifestProgramDateTimeForTypes: [],
                        mediaPlaylistFullMimeType: 'video/mp2t; codecs="avc1.42E01E, mp4a.40.2"',
                        liveSegmentsDelay: 3,
                        sequenceMode: b.fd(),
                        ignoreManifestTimestampsInSegmentsMode: false,
                        disableCodecGuessing: false,
                        disableClosedCaptionsDetection: false,
                        allowLowLatencyByteRangeOptimization: true,
                        allowRangeRequestsToGuessMimeType: false
                      },
                      mss: {
                        manifestPreprocessor: On,
                        manifestPreprocessorTXml: Pn,
                        sequenceMode: false,
                        keySystemsBySystemId: {
                          "9a04f079-9840-4286-ab92-e65be0885f95": "com.microsoft.playready",
                          "79f0049a-4098-8642-ab92-e65be0885f95": "com.microsoft.playready"
                        }
                      }
                    },
                    f = {
                      trackSelectionCallback: function trackSelectionCallback(h) {
                        return P(function (k) {
                          return k.return(h);
                        });
                      },
                      downloadSizeCallback: function downloadSizeCallback(h) {
                        var k;
                        return P(function (l) {
                          if (l.g == 1) return navigator.storage && navigator.storage.estimate ? F(l, navigator.storage.estimate(), 3) : l.return(true);
                          k = l.h;
                          return l.return(k.usage + h < k.quota * .95);
                        });
                      },
                      progressCallback: function progressCallback(h, k) {
                        return sn([h, k]);
                      },
                      usePersistentLicense: true,
                      numberOfParallelDownloads: 5
                    },
                    g = {
                      drm: c,
                      manifest: e,
                      streaming: {
                        retryParameters: xg(),
                        failureCallback: function failureCallback(h) {
                          return sn([h]);
                        },
                        rebufferingGoal: 0,
                        bufferingGoal: 10,
                        bufferBehind: 30,
                        evictionGoal: 1,
                        ignoreTextStreamFailures: false,
                        alwaysStreamText: false,
                        startAtSegmentBoundary: false,
                        gapDetectionThreshold: .5,
                        gapPadding: 0,
                        gapJumpTimerTime: .25,
                        durationBackoff: 1,
                        safeSeekOffset: 5,
                        safeSeekEndOffset: 0,
                        stallEnabled: true,
                        stallThreshold: 1,
                        stallSkip: .1,
                        useNativeHlsForFairPlay: true,
                        inaccurateManifestTolerance: 2,
                        lowLatencyMode: true,
                        preferNativeDash: false,
                        preferNativeHls: false,
                        updateIntervalSeconds: 1,
                        observeQualityChanges: false,
                        maxDisabledTime: 30,
                        segmentPrefetchLimit: 1,
                        prefetchAudioLanguages: [],
                        disableAudioPrefetch: false,
                        disableTextPrefetch: false,
                        disableVideoPrefetch: false,
                        liveSync: {
                          enabled: false,
                          targetLatency: .5,
                          targetLatencyTolerance: .5,
                          maxPlaybackRate: 1.1,
                          minPlaybackRate: .95,
                          panicMode: false,
                          panicThreshold: 60,
                          dynamicTargetLatency: {
                            enabled: false,
                            stabilityThreshold: 60,
                            rebufferIncrement: .5,
                            maxAttempts: 10,
                            maxLatency: 4,
                            minLatency: 1
                          }
                        },
                        allowMediaSourceRecoveries: true,
                        minTimeBetweenRecoveries: 5,
                        vodDynamicPlaybackRate: false,
                        vodDynamicPlaybackRateLowBufferRate: .95,
                        vodDynamicPlaybackRateBufferRatio: .5,
                        preloadNextUrlWindow: 30,
                        loadTimeout: 30,
                        clearDecodingCache: false,
                        dontChooseCodecs: false,
                        shouldFixTimestampOffset: false,
                        avoidEvictionOnQuotaExceededError: false,
                        crossBoundaryStrategy: "keep",
                        returnToEndOfLiveWindowWhenOutside: false
                      },
                      networking: {
                        forceHTTP: false,
                        forceHTTPS: false,
                        minBytesForProgressEvents: 16E3
                      },
                      mediaSource: {
                        codecSwitchingStrategy: d,
                        addExtraFeaturesToSourceBuffer: function addExtraFeaturesToSourceBuffer(h) {
                          return sn([h], "");
                        },
                        forceTransmux: false,
                        insertFakeEncryptionInInit: true,
                        correctEc3Enca: false,
                        modifyCueCallback: function modifyCueCallback(h, k) {
                          return sn([h, k]);
                        },
                        dispatchAllEmsgBoxes: false,
                        useSourceElements: true,
                        durationReductionEmitsUpdateEnd: true
                      },
                      offline: f,
                      abrFactory: function abrFactory() {
                        return new kg();
                      },
                      adaptationSetCriteriaFactory: function adaptationSetCriteriaFactory() {
                        return new (Function.prototype.bind.apply(Bn, [null].concat(x(Oa.apply(0, arguments)))))();
                      },
                      abr: {
                        enabled: true,
                        useNetworkInformation: true,
                        defaultBandwidthEstimate: 1E6,
                        switchInterval: 8,
                        bandwidthUpgradeTarget: .85,
                        bandwidthDowngradeTarget: .95,
                        restrictions: {
                          minWidth: 0,
                          maxWidth: Infinity,
                          minHeight: 0,
                          maxHeight: a,
                          minPixels: 0,
                          maxPixels: Infinity,
                          minFrameRate: 0,
                          maxFrameRate: Infinity,
                          minBandwidth: 0,
                          maxBandwidth: Infinity,
                          minChannelsCount: 0,
                          maxChannelsCount: Infinity
                        },
                        advanced: {
                          minTotalBytes: 128E3,
                          minBytes: 16E3,
                          fastHalfLife: 2,
                          slowHalfLife: 5
                        },
                        restrictToElementSize: false,
                        restrictToScreenSize: false,
                        ignoreDevicePixelRatio: false,
                        clearBufferSwitch: false,
                        safeMarginSwitch: 0,
                        cacheLoadThreshold: 5,
                        minTimeToSwitch: 0,
                        preferNetworkInformationBandwidth: false,
                        removeLatencyFromFirstPacketTime: true
                      },
                      autoShowText: 3,
                      preferredAudioLanguage: "",
                      preferredAudioLabel: "",
                      preferredTextLanguage: "",
                      preferredAudioRole: "",
                      preferredVideoRole: "",
                      preferredTextRole: "",
                      preferredAudioChannelCount: 2,
                      preferredVideoHdrLevel: "AUTO",
                      preferredVideoLayout: "",
                      preferredVideoLabel: "",
                      preferredVideoCodecs: [],
                      preferredAudioCodecs: [],
                      preferredTextFormats: [],
                      preferForcedSubs: false,
                      preferSpatialAudio: false,
                      preferredDecodingAttributes: [],
                      restrictions: {
                        minWidth: 0,
                        maxWidth: Infinity,
                        minHeight: 0,
                        maxHeight: Infinity,
                        minPixels: 0,
                        maxPixels: Infinity,
                        minFrameRate: 0,
                        maxFrameRate: Infinity,
                        minBandwidth: 0,
                        maxBandwidth: Infinity,
                        minChannelsCount: 0,
                        maxChannelsCount: Infinity
                      },
                      playRangeStart: 0,
                      playRangeEnd: Infinity,
                      textDisplayer: {
                        captionsUpdatePeriod: .25,
                        fontScaleFactor: 1
                      },
                      textDisplayFactory: function textDisplayFactory() {
                        return null;
                      },
                      cmcd: {
                        enabled: false,
                        sessionId: "",
                        contentId: "",
                        rtpSafetyFactor: 5,
                        useHeaders: false,
                        includeKeys: [],
                        version: 1,
                        targets: []
                      },
                      cmsd: {
                        enabled: true,
                        applyMaximumSuggestedBitrate: true,
                        estimatedThroughputWeightRatio: .5
                      },
                      lcevc: {
                        enabled: false,
                        dynamicPerformanceScaling: true,
                        logLevel: 0,
                        drawLogo: false,
                        poster: true
                      },
                      ads: {
                        customPlayheadTracker: false,
                        skipPlayDetection: false,
                        supportsMultipleMediaElements: true,
                        disableHLSInterstitial: false,
                        disableDASHInterstitial: false,
                        allowPreloadOnDomElements: true,
                        allowStartInMiddleOfInterstitial: true
                      },
                      ignoreHardwareResolution: false,
                      queue: {
                        preloadNextUrlWindow: Infinity,
                        preloadPrevItem: true,
                        repeatMode: 0
                      }
                    };
                  f.trackSelectionCallback = function (h) {
                    return P(function (k) {
                      return k.return(Qn(h, g.preferredAudioLanguage, g.preferredVideoHdrLevel));
                    });
                  };
                  return b.Wa(g);
                }
                function Rn() {
                  return {
                    streaming: {
                      inaccurateManifestTolerance: 0,
                      segmentPrefetchLimit: 2,
                      updateIntervalSeconds: .1,
                      maxDisabledTime: 1,
                      retryParameters: {
                        baseDelay: 100
                      }
                    },
                    manifest: {
                      dash: {
                        autoCorrectDrift: false
                      },
                      retryParameters: {
                        baseDelay: 100
                      }
                    },
                    drm: {
                      retryParameters: {
                        baseDelay: 100
                      }
                    }
                  };
                }
                function Sn(a, b, c) {
                  var d = {
                    ".drm.keySystemsMapping": "",
                    ".drm.servers": "",
                    ".drm.clearKeys": "",
                    ".drm.advanced": {
                      distinctiveIdentifierRequired: false,
                      persistentStateRequired: false,
                      videoRobustness: [],
                      audioRobustness: [],
                      sessionType: "",
                      serverCertificate: new Uint8Array(0),
                      serverCertificateUri: "",
                      individualizationServer: "",
                      headers: {}
                    }
                  };
                  return qn(a, b, c || Nn(), d, "");
                }
                function Qn(a, b, c) {
                  var d = c;
                  d == "AUTO" && (c = a.some(function (h) {
                    return h.hdr && h.hdr == "HLG" ? true : false;
                  }), d = tb().sd(c));
                  var e = a.filter(function (h) {
                    return h.type != "variant" || h.hdr && h.hdr != d ? false : true;
                  });
                  c = [];
                  var f = sf(b, e.map(function (h) {
                    return h.language;
                  }));
                  f && (c = e.filter(function (h) {
                    return lf(h.language) == f;
                  }));
                  c.length == 0 && (c = e.filter(function (h) {
                    return h.primary;
                  }));
                  c.length == 0 && (e.map(function (h) {
                    return h.language;
                  }), c = e);
                  var g = c.filter(function (h) {
                    return h.height && h.height <= 480;
                  });
                  g.length && (g.sort(function (h, k) {
                    return k.height - h.height;
                  }), c = g.filter(function (h) {
                    return h.height == g[0].height;
                  }));
                  b = [];
                  c.length && (e = Math.floor(c.length / 2), c.sort(function (h, k) {
                    return h.bandwidth - k.bandwidth;
                  }), b.push(c[e]));
                  a = t(a);
                  for (c = a.next(); !c.done; c = a.next()) c = c.value, c.type != Ac && c.type != "image" || b.push(c);
                  return b;
                }
                function On(a) {
                  return sn([a], a);
                }
                function Pn(a) {
                  return sn([a], a);
                }
                S("shaka.util.PlayerConfiguration", Mn);
                Mn.mergeConfigObjects = Sn;
                Mn.createDefaultForLL = Rn;
                Mn.createDefault = Nn;
                function Tn() {
                  this.g = null;
                  this.h = [];
                }
                function Un(a, b) {
                  var c = 0;
                  a.g && a.g.state == b && (c += a.g.duration);
                  a = t(a.h);
                  for (var d = a.next(); !d.done; d = a.next()) d = d.value, c += d.state == b ? d.duration : 0;
                  return c;
                }
                function Vn(a) {
                  function b(f) {
                    return {
                      timestamp: f.timestamp,
                      state: f.state,
                      duration: f.duration
                    };
                  }
                  for (var c = [], d = t(a.h), e = d.next(); !e.done; e = d.next()) c.push(b(e.value));
                  a.g && c.push(b(a.g));
                  return c;
                }
                function Wn() {
                  this.i = this.h = null;
                  this.g = [];
                }
                function Xn(a, b, c) {
                  a.i != b && (a.i = b, a.g.push({
                    timestamp: Date.now() / 1E3,
                    id: b.id,
                    type: "text",
                    fromAdaptation: c,
                    bandwidth: null
                  }));
                }
                function Yn() {
                  this.C = this.X = NaN;
                  this.l = "";
                  this.j = this.oi = this.u = this.B = this.K = this.F = this.o = this.m = this.J = this.G = this.i = this.T = this.V = this.N = this.O = this.R = NaN;
                  this.M = 0;
                  this.H = this.I = NaN;
                  this.g = new Tn();
                  this.h = new Wn();
                }
                function Zn(a, b, c) {
                  a.R = b;
                  a.O = c;
                }
                function $n(a, b, c) {
                  a.X = b;
                  a.C = c;
                }
                function ao(a, b) {
                  a.i = isNaN(a.i) ? b : Math.max(a.i, b);
                }
                function bo(a, b) {
                  a.j = isNaN(a.j) ? b : a.j + b;
                }
                function co(a) {
                  var b = a.X,
                    c = a.C,
                    d = a.l,
                    e = a.B,
                    f = a.O,
                    g = a.R,
                    h = a.N,
                    k = a.V,
                    l = a.T,
                    m = a.u,
                    n = a.i,
                    q = a.G,
                    r = a.J,
                    u = a.m,
                    v = Un(a.g, "playing"),
                    w = Un(a.g, "paused"),
                    z = Un(a.g, "buffering"),
                    y = a.o,
                    B = a.F,
                    D = a.K,
                    I = a.oi,
                    C = a.j,
                    A = a.M,
                    E = a.I,
                    J = a.H,
                    H = Vn(a.g),
                    K = [];
                  a = t(a.h.g);
                  for (var L = a.next(); !L.done; L = a.next()) L = L.value, K.push({
                    timestamp: L.timestamp,
                    id: L.id,
                    type: L.type,
                    fromAdaptation: L.fromAdaptation,
                    bandwidth: L.bandwidth
                  });
                  return {
                    width: b,
                    height: c,
                    currentCodecs: d,
                    streamBandwidth: e,
                    decodedFrames: f,
                    droppedFrames: g,
                    corruptedFrames: h,
                    stallsDetected: k,
                    gapsJumped: l,
                    estimatedBandwidth: m,
                    completionPercent: n,
                    loadLatency: q,
                    manifestTimeSeconds: r,
                    drmTimeSeconds: u,
                    playTime: v,
                    pauseTime: w,
                    bufferingTime: z,
                    licenseTime: y,
                    liveLatency: B,
                    maxSegmentDuration: D,
                    manifestSizeBytes: I,
                    bytesDownloaded: C,
                    nonFatalErrorCount: A,
                    manifestPeriodCount: E,
                    manifestGapCount: J,
                    stateHistory: H,
                    switchHistory: K
                  };
                }
                function eo(a, b, c, d) {
                  Jg.call(this);
                  this.N = a;
                  this.V = b;
                  this.Da = d.networkingEngine;
                  this.m = c;
                  this.C = null;
                  this.ya = 0;
                  this.Sa = d.md;
                  this.G = d.tk;
                  this.Ta = d.vk;
                  this.g = d.config;
                  this.l = this.H = this.h = null;
                  this.qa = false;
                  this.I = d.Gk;
                  this.va = false;
                  this.i = null;
                  this.aa = false;
                  this.u = null;
                  this.M = new Map();
                  this.xa = false;
                  this.Fa = d.Fk;
                  this.X = new Yn();
                  this.ma = new zg();
                  this.B = new zg();
                  this.O = null;
                  this.j = false;
                  this.$ = d.jj;
                  this.T = this.o = null;
                  this.R = false;
                  this.K = [];
                  this.J = [];
                  this.F = true;
                }
                la(eo, Jg);
                function fo(a, b, c) {
                  (a = b ? a.J : a.K) ? a.push(c) : c();
                }
                function go(a) {
                  if (a.J) for (var b = t(a.J), c = b.next(); !c.done; c = b.next()) c = c.value, c();
                  a.J = null;
                }
                function ho(a, b) {
                  a.O = b;
                  a.R = true;
                  if (a.K) {
                    b = t(a.K);
                    for (var c = b.next(); !c.done; c = b.next()) c = c.value, c();
                  }
                  a.K = null;
                }
                p = eo.prototype;
                p.getStartTime = function () {
                  return this.m;
                };
                p.rd = function () {
                  return this.N;
                };
                p.Hg = function () {
                  return this.h;
                };
                function io(a) {
                  a.va = true;
                  return a.I;
                }
                p.getStats = function () {
                  return this.X;
                };
                function jo(a) {
                  a.aa = true;
                  return a.i;
                }
                p.Rj = function () {
                  return this.o ? Pf(this.o) : null;
                };
                p.Qj = function () {
                  return this.T ? Qf(this.T) : null;
                };
                function ko(a) {
                  a.xa = true;
                  return a.M;
                }
                p.start = function () {
                  var a = this;
                  (function () {
                    var b;
                    return P(function (c) {
                      switch (c.g) {
                        case 1:
                          return F(c, Promise.resolve(), 2);
                        case 2:
                          return ua(c, 3), F(c, lo(a), 5);
                        case 5:
                          mo(a);
                          if ("webkit" === window.shakaMediaKeysPolyfill) {
                            c.A(6);
                            break;
                          }
                          return F(c, no(a), 7);
                        case 7:
                          mo(a);
                        case 6:
                          if (!a.$) {
                            c.A(8);
                            break;
                          }
                          return F(c, oo(a), 9);
                        case 9:
                          mo(a);
                        case 8:
                          if (!a.$ || !a.i) {
                            c.A(10);
                            break;
                          }
                          return F(c, ei(a.i), 11);
                        case 11:
                          mo(a);
                        case 10:
                          a.B.resolve();
                          xa(c, 0);
                          break;
                        case 3:
                          b = ya(c), b instanceof U && (b.code == 7001 || b.code == 7003) || a.B.reject(b), G(c);
                      }
                    });
                  })();
                };
                p.dispatchEvent = function (a) {
                  return this.O ? this.O.dispatchEvent(a) : Jg.prototype.dispatchEvent.call(this, a);
                };
                p.onError = function (a) {
                  a.severity === 2 && (this.B.reject(a), this.destroy());
                  var b = new Map().set("detail", a);
                  b = new V("error", b);
                  this.dispatchEvent(b);
                  b.defaultPrevented && (a.handled = true);
                };
                function mo(a) {
                  if (a.j) throw new U(2, 7, 7003);
                }
                function po(a, b) {
                  a.dispatchEvent(new V("onstatechange", new Map().set("state", b)));
                }
                function lo(a) {
                  var b, c, d, e, f, g;
                  return P(function (h) {
                    switch (h.g) {
                      case 1:
                        po(a, "manifest-parser");
                        a.l || (a.H = Ai(a.N, a.V), a.l = a.H(), a.l.configure(a.g.manifest, function () {
                          return a.F;
                        }));
                        b = Date.now() / 1E3;
                        po(a, "manifest");
                        if (a.h) {
                          h.A(2);
                          break;
                        }
                        return F(h, a.l.start(a.N, a.Ta), 3);
                      case 3:
                        return a.h = h.h, qo(a.h), F(h, ro(a), 2);
                      case 2:
                        return a.ma.resolve(), c = new V("manifestparsed", void 0), F(h, Promise.resolve(), 5);
                      case 5:
                        a.dispatchEvent(c);
                        if (a.h.variants.length == 0) throw new U(2, 4, 4036);
                        qo(a.h);
                        d = qi(a.G, a.h);
                        if (!d) {
                          h.A(6);
                          break;
                        }
                        e = new V("trackschanged", void 0);
                        return F(h, Promise.resolve(), 7);
                      case 7:
                        mo(a), a.dispatchEvent(e);
                      case 6:
                        f = Date.now() / 1E3, g = f - b, a.X.J = g, G(h);
                    }
                  });
                }
                function no(a, b) {
                  var c, d, e, f;
                  return P(function (g) {
                    switch (g.g) {
                      case 1:
                        if (!a.h || a.i) return g.return();
                        po(a, "drm-engine");
                        a.ya = Date.now() / 1E3;
                        a.i = a.Sa();
                        a.G.h = a.i;
                        a.i.configure(a.g.drm, function () {
                          return a.F;
                        });
                        c = dg(a.h.variants);
                        d = true;
                        a.h && a.h.presentationTimeline && (d = a.h.presentationTimeline.W());
                        return F(g, Fh(a.i, c, a.h.offlineSessionIds, d), 2);
                      case 2:
                        mo(a);
                        if (!b) {
                          g.A(3);
                          break;
                        }
                        return F(g, a.i.fc(b), 4);
                      case 4:
                        mo(a);
                      case 3:
                        return F(g, oi(a.G, a.h), 5);
                      case 5:
                        e = g.h;
                        if (!e) {
                          g.A(0);
                          break;
                        }
                        f = new V("trackschanged", void 0);
                        return F(g, Promise.resolve(), 7);
                      case 7:
                        a.dispatchEvent(f), G(g);
                    }
                  });
                }
                p.configure = function (a, b) {
                  a = rn(a, b);
                  Sn(this.g, a);
                };
                p.getConfiguration = function () {
                  return gd(this.g);
                };
                function ro(a) {
                  var b, c, d, e, f;
                  return P(function (g) {
                    a.C || (a.C = a.g.adaptationSetCriteriaFactory(), a.C.configure({
                      language: a.g.preferredAudioLanguage,
                      role: a.g.preferredAudioRole,
                      videoRole: a.g.preferredVideoRole,
                      channelCount: a.g.preferredAudioChannelCount,
                      hdrLevel: a.g.preferredVideoHdrLevel,
                      spatialAudio: a.g.preferSpatialAudio,
                      videoLayout: a.g.preferredVideoLayout,
                      audioLabel: a.g.preferredAudioLabel,
                      videoLabel: a.g.preferredVideoLabel,
                      codecSwitchingStrategy: a.g.mediaSource.codecSwitchingStrategy,
                      audioCodec: "",
                      activeAudioCodec: "",
                      activeAudioChannelCount: 0,
                      preferredAudioCodecs: a.g.preferredAudioCodecs,
                      preferredAudioChannelCount: a.g.preferredAudioChannelCount
                    }));
                    if (a.h.variants.length != 1 && a.h.type != "HLS") return g.A(0);
                    b = so(a);
                    if (!b) return g.A(0);
                    c = [];
                    d = t([b.video, b.audio]);
                    for (e = d.next(); !e.done; e = d.next()) (f = e.value) && !f.segmentIndex && c.push(f.createSegmentIndex());
                    return c.length > 0 ? F(g, Promise.all(c), 0) : g.A(0);
                  });
                }
                function oo(a) {
                  var b, c, d, e, f;
                  return P(function (g) {
                    !a.o && (b = so(a)) && (a.o = b);
                    if (!a.o) return g.A(0);
                    c = a.h.presentationTimeline.W();
                    d = [];
                    e = a.o;
                    e.video && d.push(Ho(a, e.video, c));
                    e.audio && d.push(Ho(a, e.audio, c));
                    (f = eg(a.h.textStreams, a.g.preferredTextLanguage, a.g.preferredTextRole, a.g.preferForcedSubs)[0] || null) && ig(e.audio, f, a.g) && (d.push(Ho(a, f, c)), a.T = f);
                    return F(g, Promise.all(d), 0);
                  });
                }
                function so(a) {
                  if (!a.u) {
                    var b = a.g.abrFactory;
                    a.u = b();
                    a.u.configure(a.g.abr);
                  }
                  b = dg(a.h.variants);
                  b = a.C.create(b);
                  a.u.setVariants(Array.from(b.values()));
                  return a.u.chooseVariant(true);
                }
                function Ho(a, b, c) {
                  var d, e, f, g, h;
                  return P(function (k) {
                    if (k.g == 1) return d = a.g.streaming.segmentPrefetchLimit || 2, e = new fm(d, b, function (l, m, n) {
                      return Xm(l, m, n || null, a.g.streaming.retryParameters, a.Da, a.F);
                    }, false), a.M.set(b.id, e), b.segmentIndex ? k.A(2) : F(k, b.createSegmentIndex(), 2);
                    f = typeof a.m === "number" ? a.m : 0;
                    g = b.segmentIndex.Vb(f);
                    h = null;
                    g && (h = g.current(), h || (h = g.next().value));
                    h || (h = Uf(b.segmentIndex));
                    return h ? c ? h.ba ? F(k, im(e, h.ba), 0) : k.A(0) : F(k, hm(e, h.startTime), 0) : k.A(0);
                  });
                }
                p.kl = function () {
                  return this.B;
                };
                p.destroy = function () {
                  var a = this,
                    b,
                    c,
                    d;
                  return P(function (e) {
                    if (e.g == 1) return a.j = true, !a.l || a.qa ? e.A(2) : F(e, a.l.stop(), 2);
                    if (e.g != 4) return a.u && a.u.release(), a.I && !a.va && a.I.release(), !a.i || a.aa ? e.A(4) : F(e, a.i.destroy(), 4);
                    if (a.M.size > 0 && !a.xa) for (b = t(a.M.values()), c = b.next(); !c.done; c = b.next()) d = c.value, om(d);
                    G(e);
                  });
                };
                function qo(a) {
                  function b(c) {
                    return c.video && c.audio || c.video && c.video.codecs.includes(",");
                  }
                  a.variants.some(b) && (a.variants = a.variants.filter(b));
                }
                S("shaka.media.PreloadManager", eo);
                eo.prototype.destroy = eo.prototype.destroy;
                eo.prototype.waitForFinish = eo.prototype.kl;
                eo.prototype.getPrefetchedTextTrack = eo.prototype.Qj;
                eo.prototype.getPrefetchedVariantTrack = eo.prototype.Rj;
                function Io(a, b) {
                  Jg.call(this);
                  var c = this;
                  this.i = a;
                  this.l = b;
                  this.g = new Map();
                  this.m = [{
                    kd: null,
                    jd: Jo,
                    Uc: function Uc(d, e) {
                      return Ko(c, "enter", d, e);
                    }
                  }, {
                    kd: Lo,
                    jd: Jo,
                    Uc: function Uc(d, e) {
                      return Ko(c, "enter", d, e);
                    }
                  }, {
                    kd: Mo,
                    jd: Jo,
                    Uc: function Uc(d, e) {
                      return Ko(c, "enter", d, e);
                    }
                  }, {
                    kd: Jo,
                    jd: Lo,
                    Uc: function Uc(d, e) {
                      return Ko(c, "exit", d, e);
                    }
                  }, {
                    kd: Jo,
                    jd: Mo,
                    Uc: function Uc(d, e) {
                      return Ko(c, "exit", d, e);
                    }
                  }, {
                    kd: Lo,
                    jd: Mo,
                    Uc: function Uc(d, e) {
                      e ? Ko(c, "skip", d, e) : (Ko(c, "enter", d, e), Ko(c, "exit", d, e));
                    }
                  }, {
                    kd: Mo,
                    jd: Lo,
                    Uc: function Uc(d, e) {
                      return Ko(c, "skip", d, e);
                    }
                  }];
                  this.h = new nb();
                  this.h.D(this.i, "regionremove", function (d) {
                    c.g.delete(d.region);
                  });
                }
                la(Io, Jg);
                Io.prototype.release = function () {
                  this.i = null;
                  this.g.clear();
                  this.h.release();
                  this.h = null;
                  Jg.prototype.release.call(this);
                };
                Io.prototype.j = function (a, b) {
                  if (!this.l || a != 0) {
                    this.l = false;
                    for (var c = t(this.i.h.values()), d = c.next(); !d.done; d = c.next()) {
                      d = d.value;
                      var e = this.g.get(d),
                        f = a < d.startTime ? Lo : a > d.endTime ? Mo : Jo;
                      this.g.set(d, f);
                      for (var g = t(this.m), h = g.next(); !h.done; h = g.next()) h = h.value, h.kd == e && h.jd == f && h.Uc(d, b);
                    }
                  }
                };
                function Ko(a, b, c, d) {
                  b = new V(b, new Map([["region", c], ["seeking", d]]));
                  a.dispatchEvent(b);
                }
                var Lo = 1,
                  Jo = 2,
                  Mo = 3;
                function No(a, b, c) {
                  var d, e, f, g, h, k, l;
                  return P(function (m) {
                    switch (m.g) {
                      case 1:
                        d = Oo(a);
                        if (e = Po.get(d)) return m.return(e);
                        f = 0;
                        g = Rg([a], c);
                        ua(m, 2);
                        g.method = "HEAD";
                        return F(m, b.request(f, g).promise, 4);
                      case 4:
                        h = m.h;
                        e = h.headers["content-type"];
                        xa(m, 3);
                        break;
                      case 2:
                        k = ya(m);
                        if (!k || k.code != 1002 && k.code != 1001) {
                          m.A(3);
                          break;
                        }
                        g.method = "GET";
                        return F(m, b.request(f, g).promise, 6);
                      case 6:
                        l = m.h, e = l.headers["content-type"];
                      case 3:
                        return m.return(e ? e.toLowerCase().split(";").shift() : "");
                    }
                  });
                }
                function Oo(a) {
                  a = new Db(a).Sb.split("/").pop().split(".");
                  return a.length == 1 ? "" : a.pop().toLowerCase();
                }
                var Po = new Map().set("mp4", "video/mp4").set("m4v", "video/mp4").set("m4a", "audio/mp4").set("webm", "video/webm").set("weba", "audio/webm").set("mkv", "video/webm").set("ts", "video/mp2t").set("ogv", "video/ogg").set("ogg", "audio/ogg").set("mpg", "video/mpeg").set("mpeg", "video/mpeg").set("mov", "video/quicktime").set("m3u8", "application/x-mpegurl").set("mpd", "application/dash+xml").set("ism", "application/vnd.ms-sstr+xml").set("mp3", "audio/mpeg").set("aac", "audio/aac").set("flac", "audio/flac").set("wav", "audio/wav").set("sbv", "text/x-subviewer").set("srt", "text/srt").set("vtt", "text/vtt").set("webvtt", "text/vtt").set("ttml", "application/ttml+xml").set("lrc", "application/x-subtitle-lrc").set("ssa", "text/x-ssa").set("ass", "text/x-ssa").set("jpeg", "image/jpeg").set("jpg", "image/jpeg").set("png", "image/png").set("svg", "image/svg+xml").set("webp", "image/webp").set("avif", "image/avif").set("html", "text/html").set("htm", "text/html"); /*
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         @license
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         Copyright 2013 Ali Al Dallal
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         Licensed under the MIT license.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         Permission is hereby granted, free of charge, to any person obtaining a copy
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         of this software and associated documentation files (the "Software"), to deal
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         in the Software without restriction, including without limitation the rights
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         copies of the Software, and to permit persons to whom the Software is
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         furnished to do so, subject to the following conditions:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         The above copyright notice and this permission notice shall be included in
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         all copies or substantial portions of the Software.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         SOFTWARE.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         */
                for (var Qo = {
                    ach: "Lwo",
                    ady: "\u0410\u0434\u044B\u0433\u044D\u0431\u0437\u044D",
                    af: "Afrikaans",
                    "af-NA": "Afrikaans (Namibia)",
                    "af-ZA": "Afrikaans (South Africa)",
                    ak: "T\u0255\u0265i",
                    ar: "\u0627\u0644\u0639\u0631\u0628\u064A\u0629",
                    "ar-AR": "\u0627\u0644\u0639\u0631\u0628\u064A\u0629",
                    "ar-MA": "\u0627\u0644\u0639\u0631\u0628\u064A\u0629",
                    "ar-SA": "\u0627\u0644\u0639\u0631\u0628\u064A\u0629 (\u0627\u0644\u0633\u0639\u0648\u062F\u064A\u0629)",
                    "ay-BO": "Aymar aru",
                    az: "Az\u0259rbaycan dili",
                    "az-AZ": "Az\u0259rbaycan dili",
                    "be-BY": "\u0411\u0435\u043B\u0430\u0440\u0443\u0441\u043A\u0430\u044F",
                    bg: "\u0411\u044A\u043B\u0433\u0430\u0440\u0441\u043A\u0438",
                    "bg-BG": "\u0411\u044A\u043B\u0433\u0430\u0440\u0441\u043A\u0438",
                    bn: "\u09AC\u09BE\u0982\u09B2\u09BE",
                    "bn-IN": "\u09AC\u09BE\u0982\u09B2\u09BE (\u09AD\u09BE\u09B0\u09A4)",
                    "bn-BD": "\u09AC\u09BE\u0982\u09B2\u09BE(\u09AC\u09BE\u0982\u09B2\u09BE\u09A6\u09C7\u09B6)",
                    "bs-BA": "Bosanski",
                    ca: "Catal\xE0",
                    "ca-ES": "Catal\xE0",
                    cak: "Maya Kaqchikel",
                    "ck-US": "\u13E3\u13B3\u13A9 (tsalagi)",
                    cs: "\u010Ce\u0161tina",
                    "cs-CZ": "\u010Ce\u0161tina",
                    cy: "Cymraeg",
                    "cy-GB": "Cymraeg",
                    da: "Dansk",
                    "da-DK": "Dansk",
                    de: "Deutsch",
                    "de-AT": "Deutsch (\xD6sterreich)",
                    "de-DE": "Deutsch (Deutschland)",
                    "de-CH": "Deutsch (Schweiz)",
                    dsb: "Dolnoserb\u0161\u0107ina",
                    el: "\u0395\u03BB\u03BB\u03B7\u03BD\u03B9\u03BA\u03AC",
                    "el-GR": "\u0395\u03BB\u03BB\u03B7\u03BD\u03B9\u03BA\u03AC",
                    en: "English",
                    "en-GB": "English (UK)",
                    "en-AU": "English (Australia)",
                    "en-CA": "English (Canada)",
                    "en-IE": "English (Ireland)",
                    "en-IN": "English (India)",
                    "en-PI": "English (Pirate)",
                    "en-UD": "English (Upside Down)",
                    "en-US": "English (US)",
                    "en-ZA": "English (South Africa)",
                    "en@pirate": "English (Pirate)",
                    eo: "Esperanto",
                    "eo-EO": "Esperanto",
                    es: "Espa\xF1ol",
                    "es-AR": "Espa\xF1ol (Argentine)",
                    "es-419": "Espa\xF1ol (Latinoam\xE9rica)",
                    "es-CL": "Espa\xF1ol (Chile)",
                    "es-CO": "Espa\xF1ol (Colombia)",
                    "es-EC": "Espa\xF1ol (Ecuador)",
                    "es-ES": "Espa\xF1ol (Espa\xF1a)",
                    "es-LA": "Espa\xF1ol (Latinoam\xE9rica)",
                    "es-NI": "Espa\xF1ol (Nicaragua)",
                    "es-MX": "Espa\xF1ol (M\xE9xico)",
                    "es-US": "Espa\xF1ol (Estados Unidos)",
                    "es-VE": "Espa\xF1ol (Venezuela)",
                    et: "eesti keel",
                    "et-EE": "Eesti (Estonia)",
                    eu: "Euskara",
                    "eu-ES": "Euskara",
                    fa: "\u0641\u0627\u0631\u0633\u06CC",
                    "fa-IR": "\u0641\u0627\u0631\u0633\u06CC",
                    "fb-LT": "Leet Speak",
                    ff: "Fulah",
                    fi: "Suomi",
                    "fi-FI": "Suomi",
                    "fo-FO": "F\xF8royskt",
                    fr: "Fran\xE7ais",
                    "fr-CA": "Fran\xE7ais (Canada)",
                    "fr-FR": "Fran\xE7ais (France)",
                    "fr-BE": "Fran\xE7ais (Belgique)",
                    "fr-CH": "Fran\xE7ais (Suisse)",
                    "fy-NL": "Frysk",
                    ga: "Gaeilge",
                    "ga-IE": "Gaeilge (Gaelic)",
                    gl: "Galego",
                    "gl-ES": "Galego",
                    "gn-PY": "Ava\xF1e'\u1EBD",
                    "gu-IN": "\u0A97\u0AC1\u0A9C\u0AB0\u0ABE\u0AA4\u0AC0",
                    "gx-GR": "\u1F19\u03BB\u03BB\u03B7\u03BD\u03B9\u03BA\u03AE \u1F00\u03C1\u03C7\u03B1\u03AF\u03B1",
                    he: "\u05E2\u05D1\u05E8\u05D9\u05EA\u200F",
                    "he-IL": "\u05E2\u05D1\u05E8\u05D9\u05EA\u200F",
                    hi: "\u0939\u093F\u0928\u094D\u0926\u0940",
                    "hi-IN": "\u0939\u093F\u0928\u094D\u0926\u0940",
                    hr: "Hrvatski",
                    "hr-HR": "Hrvatski",
                    hsb: "Hornjoserb\u0161\u0107ina",
                    ht: "Krey\xF2l",
                    hu: "Magyar",
                    "hu-HU": "Magyar",
                    "hy-AM": "\u0540\u0561\u0575\u0565\u0580\u0565\u0576",
                    id: "Bahasa Indonesia",
                    "id-ID": "Bahasa Indonesia",
                    is: "\xCDslenska",
                    "is-IS": "\xCDslenska (Iceland)",
                    it: "Italiano",
                    "it-IT": "Italiano",
                    ja: "\u65E5\u672C\u8A9E",
                    "ja-JP": "\u65E5\u672C\u8A9E",
                    "jv-ID": "Basa Jawa",
                    "ka-GE": "\u10E5\u10D0\u10E0\u10D7\u10E3\u10DA\u10D8",
                    "kk-KZ": "\u049A\u0430\u0437\u0430\u049B\u0448\u0430",
                    km: "\u1797\u17B6\u179F\u17B6\u1781\u17D2\u1798\u17C2\u179A",
                    "km-KH": "\u1797\u17B6\u179F\u17B6\u1781\u17D2\u1798\u17C2\u179A",
                    kab: "Taqbaylit",
                    kn: "\u0C95\u0CA8\u0CCD\u0CA8\u0CA1",
                    "kn-IN": "\u0C95\u0CA8\u0CCD\u0CA8\u0CA1 (India)",
                    ko: "\uD55C\uAD6D\uC5B4",
                    "ko-KR": "\uD55C\uAD6D\uC5B4 (\u97E9\u56FD)",
                    ku: "Kurd\xEE",
                    "ku-TR": "Kurd\xEE",
                    la: "Latin",
                    "la-VA": "Latin",
                    lb: "L\xEBtzebuergesch",
                    "li-NL": "L\xE8mb\xF6rgs",
                    lt: "Lietuvi\u0173",
                    "lt-LT": "Lietuvi\u0173",
                    lv: "Latvie\u0161u",
                    "lv-LV": "Latvie\u0161u",
                    mai: "\u092E\u0948\u0925\u093F\u0932\u0940, \u09AE\u09C8\u09A5\u09BF\u09B2\u09C0",
                    "mg-MG": "Malagasy",
                    mk: "\u041C\u0430\u043A\u0435\u0434\u043E\u043D\u0441\u043A\u0438",
                    "mk-MK": "\u041C\u0430\u043A\u0435\u0434\u043E\u043D\u0441\u043A\u0438 (\u041C\u0430\u043A\u0435\u0434\u043E\u043D\u0441\u043A\u0438)",
                    ml: "\u0D2E\u0D32\u0D2F\u0D3E\u0D33\u0D02",
                    "ml-IN": "\u0D2E\u0D32\u0D2F\u0D3E\u0D33\u0D02",
                    "mn-MN": "\u041C\u043E\u043D\u0433\u043E\u043B",
                    mr: "\u092E\u0930\u093E\u0920\u0940",
                    "mr-IN": "\u092E\u0930\u093E\u0920\u0940",
                    ms: "Bahasa Melayu",
                    "ms-MY": "Bahasa Melayu",
                    mt: "Malti",
                    "mt-MT": "Malti",
                    my: "\u1017\u1019\u102C\u1005\u1000\u102C",
                    nb: "Norsk (bokm\xE5l)",
                    "nb-NO": "Norsk (bokm\xE5l)",
                    ne: "\u0928\u0947\u092A\u093E\u0932\u0940",
                    "ne-NP": "\u0928\u0947\u092A\u093E\u0932\u0940",
                    nl: "Nederlands",
                    "nl-BE": "Nederlands (Belgi\xEB)",
                    "nl-NL": "Nederlands (Nederland)",
                    "nn-NO": "Norsk (nynorsk)",
                    no: "Norsk",
                    oc: "Occitan",
                    "or-IN": "\u0B13\u0B21\u0B3C\u0B3F\u0B06",
                    pa: "\u0A2A\u0A70\u0A1C\u0A3E\u0A2C\u0A40",
                    "pa-IN": "\u0A2A\u0A70\u0A1C\u0A3E\u0A2C\u0A40 (\u0A2D\u0A3E\u0A30\u0A24 \u0A28\u0A42\u0A70)",
                    pl: "Polski",
                    "pl-PL": "Polski",
                    "ps-AF": "\u067E\u069A\u062A\u0648",
                    pt: "Portugu\xEAs",
                    "pt-BR": "Portugu\xEAs (Brasil)",
                    "pt-PT": "Portugu\xEAs (Portugal)",
                    "qu-PE": "Qhichwa",
                    "rm-CH": "Rumantsch",
                    ro: "Rom\xE2n\u0103",
                    "ro-RO": "Rom\xE2n\u0103",
                    ru: "\u0420\u0443\u0441\u0441\u043A\u0438\u0439",
                    "ru-RU": "\u0420\u0443\u0441\u0441\u043A\u0438\u0439",
                    "sa-IN": "\u0938\u0902\u0938\u094D\u0915\u0943\u0924\u092E\u094D",
                    "se-NO": "Davvis\xE1megiella",
                    "si-LK": "\u0DB4\u0DC5\u0DCF\u0DAD",
                    sk: "Sloven\u010Dina",
                    "sk-SK": "Sloven\u010Dina (Slovakia)",
                    sl: "Sloven\u0161\u010Dina",
                    "sl-SI": "Sloven\u0161\u010Dina",
                    "so-SO": "Soomaaliga",
                    sq: "Shqip",
                    "sq-AL": "Shqip",
                    sr: "\u0421\u0440\u043F\u0441\u043A\u0438",
                    "sr-RS": "\u0421\u0440\u043F\u0441\u043A\u0438 (Serbia)",
                    su: "Basa Sunda",
                    sv: "Svenska",
                    "sv-SE": "Svenska",
                    sw: "Kiswahili",
                    "sw-KE": "Kiswahili",
                    ta: "\u0BA4\u0BAE\u0BBF\u0BB4\u0BCD",
                    "ta-IN": "\u0BA4\u0BAE\u0BBF\u0BB4\u0BCD",
                    te: "\u0C24\u0C46\u0C32\u0C41\u0C17\u0C41",
                    "te-IN": "\u0C24\u0C46\u0C32\u0C41\u0C17\u0C41",
                    tg: "\u0437\u0430\u0431\u043E\u0301\u043D\u0438 \u0442\u043E\u04B7\u0438\u043A\u04E3\u0301",
                    "tg-TJ": "\u0442\u043E\u04B7\u0438\u043A\u04E3",
                    th: "\u0E20\u0E32\u0E29\u0E32\u0E44\u0E17\u0E22",
                    "th-TH": "\u0E20\u0E32\u0E29\u0E32\u0E44\u0E17\u0E22 (\u0E1B\u0E23\u0E30\u0E40\u0E17\u0E28\u0E44\u0E17\u0E22)",
                    tl: "Filipino",
                    "tl-PH": "Filipino",
                    tlh: "tlhIngan-Hol",
                    tr: "T\xFCrk\xE7e",
                    "tr-TR": "T\xFCrk\xE7e",
                    "tt-RU": "\u0442\u0430\u0442\u0430\u0440\u0447\u0430",
                    uk: "\u0423\u043A\u0440\u0430\u0457\u043D\u0441\u044C\u043A\u0430",
                    "uk-UA": "\u0423\u043A\u0440\u0430\u0457\u043D\u0441\u044C\u043A\u0430",
                    ur: "\u0627\u0631\u062F\u0648",
                    "ur-PK": "\u0627\u0631\u062F\u0648",
                    uz: "O'zbek",
                    "uz-UZ": "O'zbek",
                    vi: "Ti\u1EBFng Vi\u1EC7t",
                    "vi-VN": "Ti\u1EBFng Vi\u1EC7t",
                    "xh-ZA": "isiXhosa",
                    yi: "\u05D9\u05D9\u05B4\u05D3\u05D9\u05E9",
                    "yi-DE": "\u05D9\u05D9\u05B4\u05D3\u05D9\u05E9 (German)",
                    zh: "\u4E2D\u6587",
                    "zh-HANS": "\u4E2D\u6587\u7B80\u4F53",
                    "zh-HANT": "\u4E2D\u6587\u7E41\u9AD4",
                    "zh-CN": "\u4E2D\u6587\uFF08\u4E2D\u56FD\uFF09",
                    "zh-HK": "\u4E2D\u6587\uFF08\u9999\u6E2F\uFF09",
                    "zh-SG": "\u4E2D\u6587\uFF08\u65B0\u52A0\u5761\uFF09",
                    "zh-TW": "\u4E2D\u6587\uFF08\u53F0\u7063\uFF09",
                    "zu-ZA": "isiZulu"
                  }, Ro = t(Object.keys(Qo)), So = Ro.next(); !So.done; So = Ro.next()) {
                  var To = So.value;
                  Qo[To.toLowerCase()] = Qo[To];
                }
                function Uo(a, b) {
                  if (a.lineBreak) return "\n";
                  if (a.nestedCues.length) return a.nestedCues.map(function (g) {
                    return Uo(g, a);
                  }).join("");
                  if (!a.payload) return a.payload;
                  var c = [],
                    d = a.fontWeight >= pe,
                    e = a.fontStyle == qe,
                    f = a.textDecoration.includes(re);
                  d && c.push(["b"]);
                  e && c.push(["i"]);
                  f && c.push(["u"]);
                  e = a.color;
                  e == "" && b && (e = b.color);
                  d = "";
                  (e = Vo(e)) && (d += "." + e);
                  e = a.backgroundColor;
                  e == "" && b && (e = b.backgroundColor);
                  (b = Vo(e)) && (d += ".bg_" + b);
                  d && c.push(["c", d]);
                  return c.reduceRight(function (g, h) {
                    var k = t(h);
                    h = k.next().value;
                    k = k.next().value;
                    return "<" + h + (k === void 0 ? "" : k) + ">" + g + "</" + h + ">";
                  }, a.payload);
                }
                function Vo(a) {
                  a = a.toLowerCase();
                  var b = a.replace(/\s/g, "").match(/^rgba?\((\d+),(\d+),(\d+),?([^,\s)]+)?/i);
                  b ? a = "#" + (parseInt(b[1], 10) | 256).toString(16).slice(1) + (parseInt(b[2], 10) | 256).toString(16).slice(1) + (parseInt(b[3], 10) | 256).toString(16).slice(1) : a.startsWith("#") && a.length > 7 && (a = a.slice(0, 7));
                  switch (a) {
                    case "white":
                    case "#fff":
                    case "#ffffff":
                      return "white";
                    case "lime":
                    case "#0f0":
                    case "#00ff00":
                      return "lime";
                    case "cyan":
                    case "#0ff":
                    case "#00ffff":
                      return "cyan";
                    case "red":
                    case "#f00":
                    case "#ff0000":
                      return "red";
                    case "yellow":
                    case "#ff0":
                    case "#ffff00":
                      return "yellow";
                    case "magenta":
                    case "#f0f":
                    case "#ff00ff":
                      return "magenta";
                    case "blue":
                    case "#00f":
                    case "#0000ff":
                      return "blue";
                    case "black":
                    case "#000":
                    case "#000000":
                      return "black";
                  }
                  return null;
                }
                function Wo(a, b) {
                  var c = [];
                  a = t(Xo(a));
                  for (var d = a.next(); !d.done; d = a.next()) if (d = d.value, d.isContainer) c.push.apply(c, x(Wo(d.nestedCues, d)));else {
                    var e = d.clone();
                    e.nestedCues = [];
                    e.payload = Uo(d, b);
                    c.push(e);
                  }
                  return c;
                }
                function Xo(a) {
                  var b = [];
                  a = t(a);
                  for (var c = a.next(), d = {}; !c.done; d = {
                    ig: void 0
                  }, c = a.next()) d.ig = c.value, b.some(function (e) {
                    return function (f) {
                      return de(e.ig, f);
                    };
                  }(d)) || b.push(d.ig);
                  return b;
                }
                function Yo(a) {
                  function b(d) {
                    for (var e = 5381, f = d.length; f;) e = e * 33 ^ d.charCodeAt(--f);
                    return (e >>> 0).toString();
                  }
                  if (a.startTime >= a.endTime) return null;
                  var c = new VTTCue(a.startTime, a.endTime, a.payload);
                  c.id = b(a.startTime.toString()) + b(a.endTime.toString()) + b(a.payload);
                  c.lineAlign = a.lineAlign;
                  c.positionAlign = a.positionAlign;
                  a.size && (c.size = a.size);
                  try {
                    c.align = a.textAlign;
                  } catch (d) {}
                  a.textAlign == "center" && c.align != "center" && (c.align = "middle");
                  a.writingMode == "vertical-lr" ? c.vertical = "lr" : a.writingMode == "vertical-rl" && (c.vertical = "rl");
                  a.lineInterpretation == 1 && (c.snapToLines = false);
                  a.line != null && (c.line = a.line);
                  a.position != null && (c.position = a.position);
                  return c;
                }
                function Zo(a, b) {
                  var c = Wo(b),
                    d = [];
                  b = a.cues ? Array.from(a.cues) : [];
                  c = t(c);
                  for (var e = c.next(), f = {}; !e.done; f = {
                    vd: void 0
                  }, e = c.next()) f.vd = e.value, !b.some(function (g) {
                    return function (h) {
                      return h.startTime == g.vd.startTime && h.endTime == g.vd.endTime && h.text == g.vd.payload ? true : false;
                    };
                  }(f)) && f.vd.payload && (e = Yo(f.vd)) && d.push(e);
                  b = d.slice().sort(function (g, h) {
                    return g.startTime != h.startTime ? g.startTime - h.startTime : g.endTime != h.endTime ? g.endTime - h.startTime : "line" in VTTCue.prototype ? d.indexOf(h) - d.indexOf(g) : d.indexOf(g) - d.indexOf(h);
                  });
                  b = t(b);
                  for (c = b.next(); !c.done; c = b.next()) a.addCue(c.value);
                }
                function $o(a, b) {
                  var c = false;
                  a.mode === "disabled" && (c = true, a.mode = "hidden");
                  for (var d = 0; d < a.cues.length;) {
                    var e = a.cues[d];
                    b(e) ? a.removeCue(e) : d++;
                  }
                  c && (a.mode = "disabled");
                }
                function ap(a) {
                  var b = this;
                  this.i = a;
                  this.l = new nb();
                  this.j = null;
                  this.h = new Map();
                  this.g = -1;
                  this.u = false;
                  this.o = null;
                  this.C = function () {
                    b.l.Ma(b.i, "textchanged", b.m);
                    b.l.Ma(b.j.textTracks, "change", b.B);
                    for (var c = t(b.h.values()), d = c.next(); !d.done; d = c.next()) d.value.remove();
                    b.h.clear();
                    b.g = -1;
                    b.j = null;
                  };
                  this.m = function () {
                    var c = new Map(),
                      d = b.i.Kc();
                    d = t(d);
                    for (var e = d.next(); !e.done; e = d.next()) {
                      e = e.value;
                      if (b.h.has(e.id)) {
                        var f = b.h.get(e.id);
                        e.active || f.track.mode === "disabled" || (f.track.mode = "disabled");
                        b.h.delete(e.id);
                      } else {
                        f = b.j.ownerDocument.createElement("track");
                        f.kind = bp(e);
                        var g = f,
                          h = void 0;
                        if (e.label) h = e.label;else if (e.language) if (e.language in Qo) h = Qo[e.language];else {
                          var k = qf(e.language);
                          k in Qo && (h = Qo[k] + " (" + e.language + ")");
                        }
                        h || (h = e.originalTextId, e.language && e.language !== e.originalTextId && (h += " (" + e.language + ")"));
                        g.label = h;
                        e.language in Qo && (f.srclang = e.language);
                        f.src = "data:,WEBVTT";
                        f.track.mode = "disabled";
                        b.j.appendChild(f);
                      }
                      c.set(e.id, f);
                      e.active && (b.g = e.id);
                    }
                    d = t(b.h.values());
                    for (e = d.next(); !e.done; e = d.next()) e.value.remove();
                    b.g > -1 && (c.has(b.g) ? (d = c.get(b.g).track, d.mode === "disabled" && (d.mode = b.u ? "showing" : "hidden")) : b.g = -1);
                    b.h = c;
                  };
                  this.B = function () {
                    if (!b.o) {
                      var c = b.j;
                      b.o = new df(function () {
                        b.o = null;
                        if (b.j === c) {
                          var d = -1,
                            e = false;
                          if (b.h.has(b.g)) {
                            var f = b.h.get(b.g);
                            f.track.mode === "showing" ? (d = b.g, e = true) : f.track.mode === "hidden" && (d = b.g);
                          }
                          if (!e) for (e = t(b.h), f = e.next(); !f.done; f = e.next()) {
                            var g = t(f.value);
                            f = g.next().value;
                            g = g.next().value;
                            if (g.track.mode === "showing") {
                              d = f;
                              break;
                            } else d < 0 && g.track.mode === "hidden" && (d = f);
                          }
                          e = t(b.h);
                          for (f = e.next(); !f.done; f = e.next()) g = t(f.value), f = g.next().value, g = g.next().value, f !== d && g.track.mode !== "disabled" && (g.track.mode = "disabled");
                          b.g !== d && (b.g = d, d > -1 && b.i.kh({
                            id: d
                          }));
                          b.i.qh(d > -1 && b.h.get(d).track.mode === "showing");
                        }
                      }).ia(0);
                    }
                  };
                  this.l.D(a, "loaded", function () {
                    return b.enableTextDisplayer();
                  });
                  this.enableTextDisplayer();
                }
                p = ap.prototype;
                p.configure = function () {};
                p.remove = function (a, b) {
                  if (this.i) this.h.has(this.g) && $o(this.h.get(this.g).track, function (c) {
                    return c.startTime < b && c.endTime > a;
                  });else return false;
                  return true;
                };
                p.append = function (a) {
                  this.h.has(this.g) && Zo(this.h.get(this.g).track, a);
                };
                p.destroy = function () {
                  this.i && (this.j && this.C(), this.i = null);
                  this.l && (this.l.release(), this.l = null);
                  return Promise.resolve();
                };
                p.isTextVisible = function () {
                  return this.u;
                };
                p.setTextVisibility = function (a) {
                  this.u = a;
                  if (this.h.has(this.g)) {
                    var b = this.h.get(this.g).track;
                    b.mode !== "disabled" && (a = a ? "showing" : "hidden", b.mode !== a && (b.mode = a));
                  } else if (this.i && this.i.m === 3) if (b = Array.from(this.i.h.textTracks).filter(function (d) {
                    return ["captions", "subtitles", "forced"].includes(d.kind);
                  }), a) {
                    a = null;
                    b = t(b);
                    for (var c = b.next(); !c.done; c = b.next()) if (c = c.value, c.mode === "showing") {
                      a = null;
                      break;
                    } else a || c.mode !== "hidden" || (a = c);
                    a && (a.mode = "showing");
                  } else for (a = t(b), b = a.next(); !b.done; b = a.next()) b = b.value, b.mode === "showing" && (b.mode = "hidden");
                };
                p.setTextLanguage = function () {};
                p.enableTextDisplayer = function () {
                  !this.j && this.i && this.i.m === 2 && (this.j = this.i.h, this.l.Ba(this.i, "unloading", this.C), this.l.D(this.i, "textchanged", this.m), this.l.D(this.j.textTracks, "change", this.B), this.m());
                };
                function bp(a) {
                  var b = tb();
                  return a.forced && b.Ha() === "WEBKIT" ? "forced" : a.kind === "caption" || a.roles && a.roles.some(function (c) {
                    return c.includes("transcribes-spoken-dialog");
                  }) && a.roles.some(function (c) {
                    return c.includes("describes-music-and-sound");
                  }) ? "captions" : "subtitles";
                }
                S("shaka.text.NativeTextDisplayer", ap);
                ap.prototype.enableTextDisplayer = ap.prototype.enableTextDisplayer;
                ap.prototype.setTextLanguage = ap.prototype.setTextLanguage;
                ap.prototype.setTextVisibility = ap.prototype.setTextVisibility;
                ap.prototype.isTextVisible = ap.prototype.isTextVisible;
                ap.prototype.destroy = ap.prototype.destroy;
                ap.prototype.append = ap.prototype.append;
                ap.prototype.remove = ap.prototype.remove;
                ap.prototype.configure = ap.prototype.configure;
                function cp(a, b) {
                  yb("SimpleTextDisplayer", "Please migrate to NativeTextDisplayer");
                  this.h = a;
                  this.i = b;
                  this.g = null;
                  a = t(Array.from(this.h.textTracks));
                  for (b = a.next(); !b.done; b = a.next()) b = b.value, b.kind !== "metadata" && b.kind !== "chapters" && (b.mode = "disabled", b.label == this.i && (this.g = b));
                  this.g && (this.g.mode = "hidden");
                }
                p = cp.prototype;
                p.configure = function () {};
                p.remove = function (a, b) {
                  if (!this.g) return false;
                  $o(this.g, function (c) {
                    return c.startTime < b && c.endTime > a;
                  });
                  return true;
                };
                p.append = function (a) {
                  this.g && Zo(this.g, a);
                };
                p.destroy = function () {
                  this.g && ($o(this.g, function () {
                    return true;
                  }), this.g.mode = "disabled");
                  this.g = this.h = null;
                  return Promise.resolve();
                };
                p.isTextVisible = function () {
                  return this.g ? this.g.mode == "showing" : false;
                };
                p.setTextVisibility = function (a) {
                  a && !this.g && dp(this);
                  this.g && (this.g.mode = a ? "showing" : "hidden");
                };
                p.setTextLanguage = function () {};
                p.enableTextDisplayer = function () {
                  dp(this);
                };
                function dp(a) {
                  a.h && !a.g && (a.g = a.h.addTextTrack("subtitles", a.i), a.g.mode = "hidden");
                }
                S("shaka.text.SimpleTextDisplayer", cp);
                cp.prototype.enableTextDisplayer = cp.prototype.enableTextDisplayer;
                cp.prototype.setTextLanguage = cp.prototype.setTextLanguage;
                cp.prototype.setTextVisibility = cp.prototype.setTextVisibility;
                cp.prototype.isTextVisible = cp.prototype.isTextVisible;
                cp.prototype.destroy = cp.prototype.destroy;
                cp.prototype.append = cp.prototype.append;
                cp.prototype.remove = cp.prototype.remove;
                cp.prototype.configure = cp.prototype.configure;
                function ep() {}
                p = ep.prototype;
                p.configure = function () {};
                p.remove = function () {};
                p.append = function () {};
                p.destroy = function () {};
                p.isTextVisible = function () {
                  return false;
                };
                p.setTextVisibility = function () {};
                p.setTextLanguage = function () {};
                p.enableTextDisplayer = function () {};
                S("shaka.text.StubTextDisplayer", ep);
                ep.prototype.enableTextDisplayer = ep.prototype.enableTextDisplayer;
                ep.prototype.setTextLanguage = ep.prototype.setTextLanguage;
                ep.prototype.setTextVisibility = ep.prototype.setTextVisibility;
                ep.prototype.isTextVisible = ep.prototype.isTextVisible;
                ep.prototype.destroy = ep.prototype.destroy;
                ep.prototype.append = ep.prototype.append;
                ep.prototype.remove = ep.prototype.remove;
                ep.prototype.configure = ep.prototype.configure;
                function fp(a, b) {
                  var c = this;
                  this.m = false;
                  this.h = [];
                  this.j = a;
                  this.o = b;
                  this.C = this.u = null;
                  this.g = document.createElement("div");
                  this.g.classList.add("shaka-text-container");
                  this.g.style.textAlign = "center";
                  this.g.style.display = "flex";
                  this.g.style.flexDirection = "column";
                  this.g.style.alignItems = "center";
                  this.g.style.justifyContent = "flex-end";
                  this.B = new df(function () {
                    c.j.paused || gp(c);
                  });
                  hp(this);
                  this.l = new Map();
                  this.i = new nb();
                  this.i.D(document, "fullscreenchange", function () {
                    gp(c, true);
                  });
                  this.i.D(this.j, "seeking", function () {
                    gp(c, true);
                  });
                  this.i.D(this.j, "ratechange", function () {
                    hp(c);
                  });
                  this.i.D(this.j, "resize", function () {
                    var d = c.j,
                      e = d.videoWidth;
                    d = d.videoHeight;
                    e && d ? c.u = e / d : c.u = null;
                  });
                  this.F = null;
                  "ResizeObserver" in window && (this.F = new ResizeObserver(function () {
                    gp(c, true);
                  }), this.F.observe(this.g));
                  this.G = new Map();
                }
                p = fp.prototype;
                p.configure = function (a) {
                  this.C = a;
                  hp(this);
                  gp(this, true);
                };
                p.append = function (a) {
                  var b = [].concat(x(this.h));
                  a = t(Xo(a));
                  for (var c = a.next(), d = {}; !c.done; d = {
                    jg: void 0
                  }, c = a.next()) d.jg = c.value, b.some(function (e) {
                    return function (f) {
                      return de(f, e.jg);
                    };
                  }(d)) || this.h.push(d.jg);
                  this.h.length && hp(this);
                  gp(this);
                };
                p.destroy = function () {
                  if (!this.g) return Promise.resolve();
                  this.g.parentElement && this.o.removeChild(this.g);
                  this.g = null;
                  this.m = false;
                  this.h = [];
                  this.B && (this.B.stop(), this.B = null);
                  this.l.clear();
                  this.i && (this.i.release(), this.i = null);
                  this.F && (this.F.disconnect(), this.F = null);
                  return Promise.resolve();
                };
                p.remove = function (a, b) {
                  if (!this.g) return false;
                  var c = this.h.length;
                  this.h = this.h.filter(function (d) {
                    return d.startTime < a || d.endTime >= b;
                  });
                  gp(this, c > this.h.length);
                  this.h.length || hp(this);
                  return true;
                };
                p.isTextVisible = function () {
                  return this.m;
                };
                p.setTextVisibility = function (a) {
                  (this.m = a) ? (this.g.parentElement || this.o.appendChild(this.g), gp(this, true)) : this.g.parentElement && this.o.removeChild(this.g);
                };
                p.setTextLanguage = function (a) {
                  a && a != "und" ? this.g.setAttribute("lang", a) : this.g.setAttribute("lang", "");
                };
                p.enableTextDisplayer = function () {};
                function hp(a) {
                  a.B && (a.h.length ? a.B.Ea((a.C ? a.C.captionsUpdatePeriod : .25) / Math.max(1, Math.abs(a.j.playbackRate))) : a.B.stop());
                }
                function ip(a, b) {
                  for (; b != null;) {
                    if (b == a.g) return true;
                    b = b.parentElement;
                  }
                  return false;
                }
                function jp(a, b, c, d, e) {
                  var f = false,
                    g = [],
                    h = [];
                  b = t(b);
                  for (var k = b.next(); !k.done; k = b.next()) {
                    k = k.value;
                    e.push(k);
                    var l = a.l.get(k),
                      m = k.startTime <= d && k.endTime > d,
                      n = l ? l.hj : null;
                    l && (g.push(l.kg), l.$c && g.push(l.$c), m || (f = true, a.l.delete(k), l = null));
                    m && (h.push(k), l ? ip(a, n) || (f = true) : (kp(a, k, e), l = a.l.get(k), n = l.hj, f = true));
                    k.nestedCues.length > 0 && n && jp(a, k.nestedCues, n, d, e);
                    e.pop();
                  }
                  if (f) {
                    d = t(g);
                    for (e = d.next(); !e.done; e = d.next()) e = e.value, e.parentElement && e.parentElement.removeChild(e);
                    h.sort(function (q, r) {
                      return q.startTime != r.startTime ? q.startTime - r.startTime : q.endTime - r.endTime;
                    });
                    h = t(h);
                    for (d = h.next(); !d.done; d = h.next()) d = a.l.get(d.value), d.$c ? (d.$c.contains(c) && d.$c.removeChild(c), c.appendChild(d.$c), d.$c.appendChild(d.kg)) : c.appendChild(d.kg);
                  }
                }
                function gp(a, b) {
                  if (a.g) {
                    var c = a.j.currentTime;
                    if (!a.m || (b === void 0 ? 0 : b)) {
                      b = t(a.G.values());
                      for (var d = b.next(); !d.done; d = b.next()) Gj(d.value);
                      Gj(a.g);
                      a.l.clear();
                      a.G.clear();
                    }
                    a.m && jp(a, a.h, a.g, c, []);
                  }
                }
                function kp(a, b, c) {
                  var d = c.length > 1,
                    e = d ? "span" : "div";
                  b.lineBreak && (e = "br");
                  b.rubyTag && (e = b.rubyTag);
                  d = !d && b.nestedCues.length > 0;
                  var f = document.createElement(e);
                  e != "br" && lp(a, f, b, c, d);
                  c = null;
                  if (b.region && b.region.id) {
                    var g = b.region,
                      h = a.u === 4 / 3 ? 2.5 : 1.9;
                    c = g.id + "_" + g.width + "x" + g.height + (g.heightUnits == Vc ? "%" : "px") + "-" + g.viewportAnchorX + "x" + g.viewportAnchorY + (g.viewportAnchorUnits == Vc ? "%" : "px");
                    if (a.G.has(c)) c = a.G.get(c);else {
                      e = document.createElement("span");
                      var k = g.heightUnits == Vc ? "%" : "px",
                        l = g.widthUnits == Vc ? "%" : "px",
                        m = g.viewportAnchorUnits == Vc ? "%" : "px";
                      e.id = "shaka-text-region---" + c;
                      e.classList.add("shaka-text-region");
                      e.style.position = "absolute";
                      var n = g.height,
                        q = g.width;
                      g.heightUnits === 2 && (n = g.height * 5.33, k = "%");
                      g.widthUnits === 2 && (q = g.width * h, l = "%");
                      e.style.height = n + k;
                      e.style.width = q + l;
                      g.viewportAnchorUnits === 2 ? (h = g.viewportAnchorY / 75 * 100, k = g.viewportAnchorX / (a.u === 4 / 3 ? 160 : 210) * 100, h -= g.regionAnchorY * n / 100, k -= g.regionAnchorX * q / 100, e.style.top = h + "%", e.style.left = k + "%") : (e.style.top = g.viewportAnchorY - g.regionAnchorY * n / 100 + m, e.style.left = g.viewportAnchorX - g.regionAnchorX * q / 100 + m);
                      g.heightUnits !== 0 && g.widthUnits !== 0 && g.viewportAnchorUnits !== 0 && (g = Math.max(0, Math.min(100 - (parseInt(e.style.width.slice(0, -1), 10) || 0), parseInt(e.style.left.slice(0, -1), 10) || 0)), e.style.top = Math.max(0, Math.min(100 - (parseInt(e.style.height.slice(0, -1), 10) || 0), parseInt(e.style.top.slice(0, -1), 10) || 0)) + "%", e.style.left = g + "%");
                      e.style.display = "flex";
                      e.style.flexDirection = "column";
                      e.style.alignItems = "center";
                      e.style.justifyContent = b.displayAlign == "before" ? "flex-start" : b.displayAlign == "center" ? "center" : "flex-end";
                      a.G.set(c, e);
                      c = e;
                    }
                  }
                  e = f;
                  d && (e = document.createElement("span"), e.classList.add("shaka-text-wrapper"), e.style.backgroundColor = b.backgroundColor, e.style.lineHeight = "normal", f.appendChild(e));
                  a.l.set(b, {
                    kg: f,
                    hj: e,
                    $c: c
                  });
                }
                function mp(a) {
                  var b = a.direction,
                    c = a.positionAlign;
                  a = a.textAlign;
                  return c !== Ud ? c : a === "left" || a === "start" && b === Wd || a === "end" && b === "rtl" ? "line-left" : a === "right" || a === "start" && b === "rtl" || a === "end" && b === Wd ? "line-right" : "center";
                }
                function lp(a, b, c, d, e) {
                  var f = b.style,
                    g = c.nestedCues.length == 0,
                    h = d.length > 1;
                  f.whiteSpace = "pre-wrap";
                  var k = c.payload.replace(/\s+$/g, function (m) {
                    return "\xA0".repeat(m.length);
                  });
                  f.webkitTextStrokeColor = c.textStrokeColor;
                  f.webkitTextStrokeWidth = c.textStrokeWidth;
                  f.color = c.color;
                  f.direction = c.direction;
                  f.opacity = c.opacity;
                  f.paddingLeft = np(c.linePadding, c, a.o);
                  f.paddingRight = np(c.linePadding, c, a.o);
                  f.textCombineUpright = c.textCombineUpright;
                  f.textShadow = c.textShadow;
                  if (c.backgroundImage) f.backgroundImage = "url('" + c.backgroundImage + "')", f.backgroundRepeat = "no-repeat", f.backgroundSize = "contain", f.backgroundPosition = "center", c.backgroundColor && (f.backgroundColor = c.backgroundColor), f.width = "100%", f.height = "100%";else {
                    if (c.nestedCues.length) var l = b;else l = document.createElement("span"), b.appendChild(l);
                    c.border && (l.style.border = c.border);
                    e || ((b = op(d, function (m) {
                      return m.backgroundColor;
                    })) ? l.style.backgroundColor = b : k && (l.style.backgroundColor = "rgba(0, 0, 0, 0.8)"));
                    k && (l.setAttribute("translate", "no"), l.textContent = k);
                  }
                  if (h && !d[d.length - 1].isContainer) f.display = "inline";else {
                    f.display = "flex";
                    f.flexDirection = "column";
                    f.alignItems = "center";
                    if (c.textAlign == "left" || c.textAlign == "start") f.width = "100%", f.alignItems = "start";else if (c.textAlign == "right" || c.textAlign == "end") f.width = "100%", f.alignItems = "end";
                    f.justifyContent = c.displayAlign == "before" ? "flex-start" : c.displayAlign == "center" ? "center" : "flex-end";
                  }
                  g || (f.margin = "0");
                  f.fontFamily = c.fontFamily;
                  f.fontWeight = c.fontWeight.toString();
                  f.fontStyle = c.fontStyle;
                  f.letterSpacing = c.letterSpacing;
                  d = a.C ? a.C.fontScaleFactor : 1;
                  if (d !== 1 || c.fontSize) f.fontSize = np(c.fontSize || "1em", c, a.o, d);
                  d = c.line;
                  d != null && (g = c.lineInterpretation, g == Yd && (g = 1, h = 16, a.u && a.u < 1 && (h = 32), d = d < 0 ? 100 + d / h * 100 : d / h * 100), g == 1 && (f.position = "absolute", c.writingMode == Xd ? (f.width = "100%", c.lineAlign == Zd ? f.top = d + "%" : c.lineAlign == "end" && (f.bottom = 100 - d + "%")) : c.writingMode == "vertical-lr" ? (f.height = "100%", c.lineAlign == Zd ? f.left = d + "%" : c.lineAlign == "end" && (f.right = 100 - d + "%")) : (f.height = "100%", c.lineAlign == Zd ? f.right = d + "%" : c.lineAlign == "end" && (f.left = 100 - d + "%"))));
                  f.lineHeight = c.lineHeight;
                  a = mp(c);
                  a == "line-left" ? (f.cssFloat = "left", c.position !== null && (f.position = "absolute", c.writingMode == Xd ? (f.left = c.position + "%", f.width = "auto") : f.top = c.position + "%")) : a == "line-right" ? (f.cssFloat = "right", c.position !== null && (f.position = "absolute", c.writingMode == Xd ? (f.right = 100 - c.position + "%", f.width = "auto") : f.bottom = c.position + "%")) : c.position !== null && c.position != 50 && (f.position = "absolute", c.writingMode == Xd ? (f.left = c.position + "%", f.width = "auto") : f.top = c.position + "%", c.size && (f.transform = "translateX(-50%)"));
                  f.textAlign = c.textAlign;
                  f.textDecoration = c.textDecoration.join(" ");
                  f.writingMode = c.writingMode;
                  "writingMode" in document.documentElement.style && f.writingMode == c.writingMode || (f.webkitWritingMode = c.writingMode);
                  c.size && (c.writingMode == Xd ? f.width = c.size + "%" : f.height = c.size + "%");
                }
                function np(a, b, c, d) {
                  d = d === void 0 ? 1 : d;
                  var e = (e = new RegExp(/(\d*\.?\d+)([a-z]+|%+)/).exec(a)) ? {
                    value: Number(e[1]),
                    unit: e[2]
                  } : null;
                  if (!e) return a;
                  a = e.unit;
                  d *= e.value;
                  switch (a) {
                    case "%":
                      return d / 100 * c.clientHeight / b.cellResolution.rows + "px";
                    case "c":
                      return c.clientHeight * d / b.cellResolution.rows + "px";
                    default:
                      return d + a;
                  }
                }
                function op(a, b) {
                  for (var c = a.length - 1; c >= 0; c--) {
                    var d = b(a[c]);
                    if (d || d === 0) return d;
                  }
                  return null;
                }
                S("shaka.text.UITextDisplayer", fp);
                fp.prototype.enableTextDisplayer = fp.prototype.enableTextDisplayer;
                fp.prototype.setTextLanguage = fp.prototype.setTextLanguage;
                fp.prototype.setTextVisibility = fp.prototype.setTextVisibility;
                fp.prototype.isTextVisible = fp.prototype.isTextVisible;
                fp.prototype.remove = fp.prototype.remove;
                fp.prototype.destroy = fp.prototype.destroy;
                fp.prototype.append = fp.prototype.append;
                fp.prototype.configure = fp.prototype.configure;
                function pp(a, b) {
                  function c(f) {
                    for (var g = f, h = t(b), k = h.next(); !k.done; k = h.next()) k = k.value, k.end && k.start < f && (g += k.end - k.start);
                    f = Math.floor(g / 3600);
                    h = Math.floor(g / 60 % 60);
                    k = Math.floor(g % 60);
                    g = Math.floor(g * 1E3 % 1E3);
                    return (f < 10 ? "0" : "") + f + ":" + (h < 10 ? "0" : "") + h + ":" + (k < 10 ? "0" : "") + k + "." + (g < 100 ? g < 10 ? "00" : "0" : "") + g;
                  }
                  var d = Wo(a);
                  a = "WEBVTT\n\n";
                  d = t(d);
                  for (var e = d.next(); !e.done; e = d.next()) e = e.value, a += c(e.startTime) + " --\x3e " + c(e.endTime) + function (f) {
                    var g = [];
                    switch (f.textAlign) {
                      case "left":
                        g.push("align:left");
                        break;
                      case "right":
                        g.push("align:right");
                        break;
                      case Vd:
                        g.push("align:middle");
                        break;
                      case "start":
                        g.push("align:start");
                        break;
                      case "end":
                        g.push("align:end");
                    }
                    switch (f.writingMode) {
                      case "vertical-lr":
                        g.push("vertical:lr");
                        break;
                      case "vertical-rl":
                        g.push("vertical:rl");
                    }
                    return g.length ? " " + g.join(" ") : "";
                  }(e) + "\n", a += e.payload + "\n\n";
                  return a;
                }
                S("shaka.text.WebVttGenerator", function () {});
                function qp(a, b) {
                  this.g = b;
                  this.j = a;
                  this.m = new Map();
                  this.l = void 0;
                  this.F = false;
                  this.J = true;
                  this.u = this.I = false;
                  this.C = this.B = void 0;
                  this.H = 0;
                  this.K = {
                    request: false,
                    response: false,
                    event: false
                  };
                  this.o = {};
                  this.i = new nb();
                  this.G = [];
                  this.h = null;
                }
                qp.prototype.setMediaElement = function (a) {
                  this.h = a;
                  rp(this);
                };
                qp.prototype.configure = function (a) {
                  this.g = a;
                  sp(this);
                };
                function tp(a) {
                  a.m.clear();
                  a.F = false;
                  a.J = true;
                  a.I = false;
                  a.u = false;
                  a.B = 0;
                  a.C = 0;
                  a.H = 0;
                  a.K = {
                    request: false,
                    response: false,
                    event: false
                  };
                  up(a);
                  a.o = {};
                  a.h = null;
                  a.i.Pa();
                }
                function vp(a, b) {
                  a.u = b;
                  a.u ? a.l == wp ? a.l = xp : a.l == yp && (a.l = zp) : a.l == xp ? a.l = wp : a.l == zp && (a.l = yp);
                }
                function Ap(a, b) {
                  if (a.g && a.g.enabled && (Bp(a, "ps", {
                    dd: "d"
                  }), a.h && a.h.autoplay)) {
                    var c = a.h.play();
                    c && c.then(function () {
                      a.H = b;
                    }).catch(function () {
                      a.H = 0;
                    });
                  }
                }
                function Cp(a, b, c) {
                  try {
                    if (!a.g.enabled) return b;
                    var d = Dp(a);
                    a: {
                      switch (c.toLowerCase()) {
                        case "audio/mp4":
                        case "audio/webm":
                        case "audio/ogg":
                        case "audio/mpeg":
                        case "audio/aac":
                        case "audio/flac":
                        case "audio/wav":
                          var e = Ep;
                          break a;
                        case "video/webm":
                        case "video/mp4":
                        case "video/mpeg":
                        case "video/mp2t":
                          e = Fp;
                          break a;
                        case "application/x-mpegurl":
                        case "application/vnd.apple.mpegurl":
                        case "application/dash+xml":
                        case "video/vnd.mpeg.dash.mpd":
                        case "application/vnd.ms-sstr+xml":
                          e = Gp;
                          break a;
                      }
                      e = void 0;
                    }
                    d.ot = e;
                    d.su = !0;
                    var f = Hp(d);
                    return Ip(b, f);
                  } catch (g) {
                    return cb("CMCD_SRC_ERROR", "Could not generate src CMCD data.", g), b;
                  }
                }
                function rp(a) {
                  a.i.D(a.h, "playing", function () {
                    a.C || (a.C = Date.now());
                    Bp(a, "ps", {
                      dd: "p"
                    });
                  });
                  a.i.D(a.h, "volumechange", function () {
                    Bp(a, a.h.muted ? "m" : "um");
                  });
                  a.i.D(a.h, "play", function () {
                    a.B || (a.B = Date.now(), Bp(a, "ps", {
                      dd: "s"
                    }));
                  });
                  a.i.D(a.h, "pause", function () {
                    Bp(a, "ps", {
                      dd: "a"
                    });
                  });
                  a.i.D(a.j, "buffering", function () {
                    Bp(a, "ps", {
                      dd: "w"
                    });
                  });
                  a.i.D(a.h, "seeking", function () {
                    return Bp(a, "ps", {
                      dd: "k"
                    });
                  });
                  a.i.D(document, "fullscreenchange", function () {
                    Bp(a, document.fullscreenElement ? "pe" : "pc");
                  });
                  var b = a.h;
                  (b.webkitPresentationMode || b.webkitSupportsFullscreen) && a.i.D(b, "webkitpresentationmodechanged", function () {
                    b.webkitPresentationMode ? Bp(a, b.webkitPresentationMode !== "inline" ? "pe" : "pc") : b.webkitSupportsFullscreen && Bp(a, b.webkitDisplayingFullscreen ? "pe" : "pc");
                  });
                  a.i.D(a.h, "enterpictureinpicture", function () {
                    Bp(a, "pe");
                  });
                  a.i.D(a.h, "leavepictureinpicture", function () {
                    Bp(a, "pc");
                  });
                  "documentPictureInPicture" in window && a.i.D(window.documentPictureInPicture, "enter", function (c) {
                    Bp(a, "pe");
                    a.i.Ba(c.window, "pagehide", function () {
                      Bp(a, "pc");
                    });
                  });
                  a.i.D(document, "visibilitychange", function () {
                    document.hidden ? Bp(a, "b", {
                      bg: true
                    }) : Bp(a, "b");
                  });
                  a.i.D(a.j, "complete", function () {
                    Bp(a, "ps", {
                      dd: "e"
                    });
                  });
                }
                function sp(a) {
                  up(a);
                  var b = Jp(a);
                  b = t(b);
                  for (var c = b.next(); !c.done; c = b.next()) if (c = c.value.timeInterval, c === void 0 && (c = Kp), c >= 1) {
                    var d = new df(function () {
                      return Bp(a, Lp);
                    });
                    d.Ea(c);
                    a.G.push(d);
                  }
                }
                function up(a) {
                  if (a.G) for (var b = t(a.G), c = b.next(); !c.done; c = b.next()) c.value.stop();
                  a.G = [];
                }
                function Jp(a) {
                  return (a = a.g.targets) ? a.filter(function (b) {
                    return b.mode === Mp && b.enabled;
                  }) : [];
                }
                function Np(a) {
                  return (a = a.g.targets) ? a.filter(function (b) {
                    return b.mode === Op && b.enabled === true;
                  }) : [];
                }
                function Dp(a) {
                  a.g.sessionId || (a.g.sessionId = window.crypto.randomUUID());
                  return {
                    v: a.g.version,
                    sf: a.l,
                    sid: a.g.sessionId,
                    cid: a.g.contentId,
                    mtp: a.j.getBandwidthEstimate() / 1E3
                  };
                }
                function Bp(a, b, c) {
                  c = c === void 0 ? {} : c;
                  b = Object.assign({
                    e: b,
                    ts: Date.now()
                  }, c);
                  b = Pp(a, b, Mp);
                  c = a.g.targets;
                  if (!(a.g.version < Qp) && c) {
                    var d = Jp(a);
                    c = Array.from(new Set([].concat(x(Rp), x(Sp))));
                    d = t(d);
                    for (var e = d.next(); !e.done; e = d.next()) {
                      e = e.value;
                      var f = Tp(e.includeKeys || [], c);
                      f.includes(Up) || f.push(Up);
                      f = Vp(b, f);
                      var g = e.events || [],
                        h = f.e,
                        k = f.sta;
                      h && (!Wp.includes(h) || !(h !== "ps" || k && Xp.includes(k)) || g && g.length > 0 && !g.includes(h)) || Yp(a, f, e);
                    }
                  }
                }
                function Zp(a, b, c) {
                  if (a.g.enabled) {
                    c = Pp(a, c, $p);
                    var d = aq({
                      mode: $p,
                      useHeaders: a.g.useHeaders,
                      includeKeys: a.g.includeKeys || []
                    });
                    a.o[d] || (a.o[d] = {
                      request: 1,
                      response: 1
                    });
                    c.sn = a.o[d].request++;
                    d = a.g.includeKeys || [];
                    var e = a.g.version == Qp ? Array.from(new Set([].concat(x(Rp), x(bq)))) : cq;
                    d = Tp(d, e);
                    c = Vp(c, d);
                    dq(a, c, b, a.g.useHeaders);
                  }
                }
                function Yp(a, b, c, d) {
                  var e = xg(),
                    f = c.url;
                  if (c.useHeaders) {
                    b = eq(b);
                    if (!Object.keys(b).length) return;
                    d && Object.assign(d.headers, b);
                    d = Rg([f], e);
                    Object.assign(d.headers, b);
                  } else {
                    b = Hp(b);
                    if (!b) return;
                    f = Ip(f, b);
                    d && (d.uri = f);
                    d = Rg([f], e);
                  }
                  a.j.Wb().request(9, d);
                }
                function dq(a, b, c, d) {
                  if (d) {
                    b = eq(b);
                    if (!Object.keys(b).length) return;
                    Object.assign(c.headers, b);
                  } else {
                    var e = Hp(b);
                    if (!e) return;
                    c.uris = c.uris.map(function (f) {
                      return Ip(f, e);
                    });
                  }
                  Np(a).length > 0 || !a.m.has(c) || a.m.delete(c);
                }
                function Tp(a, b) {
                  if (!a || a.length === 0) return b;
                  for (var c = t(a), d = c.next(); !d.done; d = c.next()) b.includes(d.value);
                  return a = a.filter(function (e) {
                    return b.includes(e);
                  });
                }
                function Vp(a, b) {
                  return Object.keys(a).reduce(function (c, d) {
                    b.includes(d) && (c[d] = a[d]);
                    return c;
                  }, {});
                }
                function fq(a) {
                  if (a.type === 0) return gq;
                  if (a = a.stream) {
                    var b = a.type;
                    if (b == "video") return a.codecs && a.codecs.includes(",") ? Fp : hq;
                    if (b == "audio") return Ep;
                    if (b == "text") return a.mimeType === "application/mp4" ? iq : jq;
                  }
                }
                function aq(a) {
                  var b = Object.keys(a).sort().reduce(function (c, d) {
                    d !== "enabled" && (c[d] = a[d]);
                    return c;
                  }, {});
                  return JSON.stringify(b);
                }
                function kq(a, b) {
                  b = a.j.Fc()[b];
                  if (!b.length) return NaN;
                  var c = a.h ? a.h.currentTime : 0;
                  return (a = b.find(function (d) {
                    return d.start <= c && d.end >= c;
                  })) ? (a.end - c) * 1E3 : NaN;
                }
                function lq(a, b) {
                  b = a.j.Fc()[b];
                  if (!b.length) return 0;
                  var c = a.h ? a.h.currentTime : 0;
                  return (a = b.find(function (d) {
                    return d.start <= c && d.end >= c;
                  })) ? (a.end - c) * 1E3 : 0;
                }
                function mq(a, b) {
                  var c = a.j.mc();
                  if (!c.length) return NaN;
                  a = c[0];
                  c = t(c);
                  for (var d = c.next(); !d.done; d = c.next()) d = d.value, d.type === "variant" && d.bandwidth > a.bandwidth && (a = d);
                  switch (b) {
                    case hq:
                      return a.videoBandwidth || NaN;
                    case Ep:
                      return a.audioBandwidth || NaN;
                    default:
                      return a.bandwidth;
                  }
                }
                function nq(a, b, c) {
                  var d = b.segment,
                    e = 0;
                  d && (e = d.endTime - d.startTime);
                  e = {
                    d: e * 1E3,
                    st: a.j.W() ? oq : pq
                  };
                  e.ot = fq(b);
                  var f = e.ot === hq || e.ot === Ep || e.ot === Fp || e.ot === iq;
                  if (b = b.stream) {
                    var g = a.j.Ob();
                    if (f && (e.bl = kq(a, b.type), e.ot !== iq)) {
                      var h = lq(a, b.type);
                      e.dl = g ? h / Math.abs(g) : h;
                    }
                    b.bandwidth && (e.br = b.bandwidth / 1E3);
                    if (b.segmentIndex && d) {
                      if ((g = b.segmentIndex.Vb(d.endTime, true, g < 0)) && (g = g.next().value) && g != d) {
                        if (c && !lb(d.P(), g.P())) {
                          var k = g.P()[0];
                          h = new URL(k);
                          var l = new URL(c);
                          if (h.origin !== l.origin) c = k;else {
                            c = h.pathname.split("/").slice(1);
                            k = l.pathname.split("/").slice(1, -1);
                            l = Math.min(c.length, k.length);
                            for (var m = 0; m < l && c[m] === k[m]; m++) c.shift(), k.shift();
                            for (; k.length;) k.shift(), c.unshift("..");
                            c = c.join("/") + h.search + h.hash;
                          }
                          e.nor = c;
                        }
                        !g.startByte && !g.endByte || d.startByte == g.startByte && d.endByte == g.endByte || (c = g.startByte + "-", g.endByte && (c += g.endByte), e.nrr = c);
                      }
                      g = a.j.Ob() || 1;
                      c = lq(a, b.type) || 500;
                      d = (b = b.bandwidth) ? b * (d.endTime - d.startTime) / 1E3 / (c / g / 1E3) * a.g.rtpSafetyFactor : NaN;
                      isNaN(d) || (e.rtp = d);
                    }
                  }
                  f && e.ot !== iq && (e.tb = mq(a, e.ot) / 1E3);
                  return e;
                }
                function Pp(a, b, c) {
                  Object.assign(b, Dp(a));
                  b.pr = a.j.Ob();
                  var d = b.ot === hq || b.ot === Fp;
                  a.I && d && (b.bs = true, b.su = true, a.I = false);
                  b.su == null && (b.su = a.J);
                  a.j.W() && (d = qq(a.j), b.ltc = d || void 0);
                  document.hidden && (b.bg = true);
                  d = a.C && a.B ? a.C - (a.H || a.B) : void 0;
                  d == void 0 || a.K[c] || (b.msd = d, a.K[c] = true);
                  return b;
                }
                function Hp(a) {
                  function b(n) {
                    return c(n / 100) * 100;
                  }
                  function c(n) {
                    return Math.round(n);
                  }
                  function d(n) {
                    return !Number.isNaN(n) && n != null && n !== "" && n !== false;
                  }
                  var e = [],
                    f = {
                      br: c,
                      d: c,
                      bl: b,
                      dl: b,
                      mtp: b,
                      nor: function nor(n) {
                        return encodeURIComponent(n);
                      },
                      rtp: b,
                      tb: c,
                      ttfb: c,
                      ttlb: c
                    },
                    g = Object.keys(a || {}).sort();
                  g = t(g);
                  for (var h = g.next(); !h.done; h = g.next()) {
                    h = h.value;
                    var k = a[h];
                    if (d(k) && (h !== "v" || k !== 1) && (h != "pr" || k !== 1)) {
                      var l = f[h];
                      l && (k = l(k));
                      l = _typeof(k);
                      var m = void 0;
                      m = l === "string" && h !== "ot" && h !== "sf" && h !== "st" ? h + "=" + JSON.stringify(k) : l === "boolean" ? h : l === "symbol" ? h + "=" + k.description : h + "=" + k;
                      e.push(m);
                    }
                  }
                  return e.join(",");
                }
                function eq(a) {
                  var b = Object.keys(a),
                    c = {},
                    d = ["Object", "Request", "Session", "Status"],
                    e = [{}, {}, {}, {}],
                    f = {
                      br: 0,
                      d: 0,
                      ot: 0,
                      tb: 0,
                      url: 0,
                      bl: 1,
                      dl: 1,
                      mtp: 1,
                      nor: 1,
                      nrr: 1,
                      su: 1,
                      ltc: 1,
                      ttfb: 1,
                      ttlb: 1,
                      ts: 1,
                      rc: 1,
                      cmsdd: 1,
                      cmsds: 1,
                      sn: 1,
                      cid: 2,
                      pr: 2,
                      sf: 2,
                      sid: 2,
                      st: 2,
                      v: 2,
                      msd: 2,
                      bs: 3,
                      rtp: 3,
                      bg: 3
                    };
                  b = t(b);
                  for (var g = b.next(); !g.done; g = b.next()) g = g.value, e[f[g] != null ? f[g] : 1][g] = a[g];
                  for (a = 0; a < e.length; a++) (f = Hp(e[a])) && (c["CMCD-" + d[a]] = f);
                  return c;
                }
                function Ip(a, b) {
                  if (!b || a.includes("offline:")) return a;
                  a = new Db(a);
                  a.g.set("CMCD", b);
                  return a.toString();
                }
                var Gp = "m",
                  Ep = "a",
                  hq = "v",
                  Fp = "av",
                  gq = "i",
                  jq = "c",
                  iq = "tt",
                  Qp = 2,
                  pq = "v",
                  oq = "l",
                  wp = "d",
                  xp = "ld",
                  yp = "h",
                  zp = "lh";
                S("shaka.util.CmcdManager.StreamingFormat", {
                  DASH: wp,
                  Ol: xp,
                  HLS: yp,
                  Pl: zp,
                  dm: "s",
                  OTHER: "o"
                });
                var cq = "br bl bs cid d dl mtp nor nrr ot pr rtp sf sid st su tb v".split(" "),
                  Rp = "br ab bl tbl bs cdn cid ltc mtp pr sf sid bg sta st ts tpb tb lb tab lab pt ec msd v sn".split(" "),
                  bq = "ab bl tbl bs cdn cid d dl ltc mtp nor ot pr rtp sf sid bg sta st su ts tpb tb lb tab lab pt ec msd v".split(" "),
                  rq = "d dl nor ot rtp rc su ttfb ttfbb ttlb url cmsdd cmsds".split(" "),
                  Sp = ["e", "sta"],
                  Wp = "ps e t c b m um pe pc".split(" "),
                  Xp = "spawkrfeqd".split(""),
                  Kp = 10,
                  Up = "ts",
                  Lp = "t",
                  $p = "request",
                  Op = "response",
                  Mp = "event";
                function sq(a) {
                  this.h = a;
                  this.g = null;
                }
                p = sq.prototype;
                p.configure = function (a) {
                  this.h = a;
                };
                p.bi = function () {
                  return this.h.enabled && this.h.applyMaximumSuggestedBitrate && this.g && this.g.has(tq) ? this.g.get(tq) * 1E3 : null;
                };
                p.$h = function () {
                  return this.h.enabled && this.g && this.g.has(uq) ? this.g.get(uq) * 1E3 : null;
                };
                p.Tj = function () {
                  return this.h.enabled && this.g && this.g.has(vq) ? this.g.get(vq) : null;
                };
                p.Uj = function () {
                  return this.h.enabled && this.g && this.g.has(wq) ? this.g.get(wq) : null;
                };
                p.getBandwidthEstimate = function (a) {
                  var b = this.$h();
                  if (!b) return a;
                  var c = this.h.estimatedThroughputWeightRatio;
                  return c > 0 && c <= 1 ? a * (1 - c) + b * c : a;
                };
                function xq(a) {
                  return a ? a.toLowerCase() === "false" ? false : /^[-0-9]/.test(a) ? parseInt(a, 10) : a.replace(/["]+/g, "") : true;
                }
                S("shaka.util.CmsdManager", sq);
                sq.prototype.getBandwidthEstimate = sq.prototype.getBandwidthEstimate;
                sq.prototype.getRoundTripTime = sq.prototype.Uj;
                sq.prototype.getResponseDelay = sq.prototype.Tj;
                sq.prototype.getEstimatedThroughput = sq.prototype.$h;
                sq.prototype.getMaxBitrate = sq.prototype.bi;
                var uq = "etp",
                  tq = "mb",
                  vq = "rd",
                  wq = "rtt";
                function yq() {
                  this.g = null;
                  this.h = [];
                }
                function zq(a, b) {
                  return P(function (c) {
                    if (c.g == 1) return a.g ? F(c, new Promise(function (d) {
                      return a.h.push(d);
                    }), 2) : c.A(2);
                    a.g = b;
                    G(c);
                  });
                }
                yq.prototype.release = function () {
                  this.h.length > 0 ? this.h.shift()() : this.g = null;
                };
                function X(a, b, c) {
                  b = b === void 0 ? null : b;
                  Jg.call(this);
                  var d = this;
                  this.m = Aq;
                  this.h = null;
                  this.xe = b;
                  this.$ = false;
                  this.Ie = new nb();
                  this.ye = new nb();
                  this.j = new nb();
                  this.ac = new nb();
                  this.yc = new nb();
                  this.G = this.H = this.F = this.N = null;
                  this.Je = 0;
                  this.aa = new yq();
                  this.O = this.Da = this.X = this.i = this.xc = this.I = this.l = this.ue = this.T = this.Kh = this.qa = this.K = this.ib = this.xa = this.we = this.R = this.Fa = this.M = this.ob = null;
                  this.Sa = false;
                  this.Ce = this.o = null;
                  this.Be = 1E9;
                  this.Ge = [];
                  this.uc = new Map();
                  this.kb = [];
                  this.Xf = -1;
                  this.g = Bq(this);
                  this.Zf = Rn();
                  this.V = null;
                  this.Ke = -1;
                  this.Zb = null;
                  this.va = {
                    width: Infinity,
                    height: Infinity
                  };
                  this.Ae = new ni(this.g, this.va, null);
                  this.Ee = [];
                  this.B = null;
                  this.J = this.g.adaptationSetCriteriaFactory();
                  this.J.configure({
                    language: this.g.preferredAudioLanguage,
                    role: this.g.preferredAudioRole,
                    videoRole: this.g.preferredVideoRole,
                    channelCount: 0,
                    hdrLevel: this.g.preferredVideoHdrLevel,
                    spatialAudio: this.g.preferSpatialAudio,
                    videoLayout: this.g.preferredVideoLayout,
                    audioLabel: this.g.preferredAudioLabel,
                    videoLabel: this.g.preferredVideoLabel,
                    codecSwitchingStrategy: this.g.mediaSource.codecSwitchingStrategy,
                    audioCodec: "",
                    activeAudioCodec: "",
                    activeAudioChannelCount: 0,
                    preferredAudioCodecs: this.g.preferredAudioCodecs,
                    preferredAudioChannelCount: this.g.preferredAudioChannelCount
                  });
                  this.Fd = this.g.preferredTextLanguage;
                  this.Md = this.g.preferredTextRole;
                  this.Ld = this.g.preferForcedSubs;
                  this.ze = [];
                  c && c(this);
                  this.K = new qp(this, this.g.cmcd);
                  this.qa = new sq(this.g.cmsd);
                  this.N = Cq(this);
                  this.Jd = this.ma = this.ya = this.C = null;
                  this.ag = false;
                  this.Yf = [];
                  this.$f = new df(function () {
                    return P(function (e) {
                      if (e.g == 1) return d.ma ? F(e, d.fc(d.Jd, true), 3) : e.A(0);
                      if (e.g != 4) return F(e, d.load(d.ma), 4);
                      d.ag ? d.Jd.pause() : d.Jd.play();
                      d.ma = null;
                      d.ag = false;
                      G(e);
                    });
                  });
                  Dq && (this.C = Dq(), this.C.configure(this.g.ads), this.yc.D(this.C, "ad-content-pause-requested", function (e) {
                    var f;
                    return P(function (g) {
                      if (g.g == 1) {
                        d.$f.stop();
                        if (d.ma) return g.A(0);
                        d.Jd = d.h;
                        d.ag = d.be();
                        f = e.saveLivePosition || false;
                        return F(g, d.Uh(true, f), 3);
                      }
                      d.ma = g.h;
                      G(g);
                    });
                  }), this.yc.D(this.C, "ad-content-resume-requested", function (e) {
                    e = e.offset || 0;
                    if (d.ma) {
                      var f = d.ma;
                      f.m && e && (typeof f.m === "number" ? f.m += e : f.m.setTime(f.m.getTime() + e * 1E3));
                    }
                    d.$f.ia(.1);
                  }), this.yc.D(this.C, "ad-content-attach-requested", function () {
                    return P(function (e) {
                      return d.h || !d.Jd ? e.A(0) : F(e, d.fc(d.Jd, true), 0);
                    });
                  }));
                  Eq && (this.ya = Eq(this), this.ya.configure(this.g.queue));
                  this.Ie.D(window, "online", function () {
                    Fq(d);
                    d.fh();
                  });
                  this.De = new df(function () {
                    for (var e = Date.now() / 1E3, f = false, g = true, h = t(d.i.variants), k = h.next(); !k.done; k = h.next()) k = k.value, k.disabledUntilTime > 0 && k.disabledUntilTime <= e && (k.disabledUntilTime = 0, f = true), k.disabledUntilTime > 0 && (g = false);
                    g && d.De.stop();
                    f && Gq(d, false, void 0, false, false);
                  });
                  this.Ta = null;
                  a && (yb("Player w/ mediaElement", "Please migrate from initializing Player with a mediaElement; use the attach method instead."), this.fc(a, true));
                  this.u = null;
                }
                la(X, Jg);
                function Hq(a) {
                  a.T != null && (Gc(a.T), a.T.release(), a.T = null);
                }
                function Iq(a, b, c) {
                  c || b.lcevc.enabled ? (Hq(a), a.T == null && (a.T = new Ec(a.h, a.Kh, b.lcevc, c), a.H && (a.H.C = a.T))) : Hq(a);
                }
                function Jq(a, b) {
                  return new V(a, b);
                }
                p = X.prototype;
                p.destroy = function () {
                  var a = this,
                    b;
                  return P(function (c) {
                    switch (c.g) {
                      case 1:
                        if (a.m == Kq) return c.return();
                        Hq(a);
                        b = a.detach();
                        a.m = Kq;
                        return F(c, b, 2);
                      case 2:
                        return F(c, a.ng(), 3);
                      case 3:
                        a.Ie && (a.Ie.release(), a.Ie = null);
                        a.ye && (a.ye.release(), a.ye = null);
                        a.j && (a.j.release(), a.j = null);
                        a.ac && (a.ac.release(), a.ac = null);
                        a.yc && (a.yc.release(), a.yc = null);
                        a.Ce = null;
                        a.g = null;
                        a.B = null;
                        a.xe = null;
                        a.K = null;
                        a.qa = null;
                        if (!a.N) {
                          c.A(4);
                          break;
                        }
                        return F(c, a.N.destroy(), 5);
                      case 5:
                        a.N = null;
                      case 4:
                        a.o && (a.o.release(), a.o = null), a.ya && (a.ya.destroy(), a.ya = null), Jg.prototype.release.call(a), G(c);
                    }
                  });
                };
                function Lq(a, b) {
                  Mq.set(a, b);
                }
                function Nq(a, b) {
                  a.dispatchEvent(Jq("onstatechange", new Map().set("state", b)));
                }
                p.fc = function (a, b) {
                  b = b === void 0 ? true : b;
                  var c = this,
                    d,
                    e,
                    f;
                  return P(function (g) {
                    switch (g.g) {
                      case 1:
                        if (c.m == Kq) throw new U(2, 7, 7E3);
                        d = c.h && c.h == a;
                        if (!c.h || c.h == a) {
                          g.A(2);
                          break;
                        }
                        return F(g, c.detach(), 2);
                      case 2:
                        return F(g, Oq(c, "attach"), 4);
                      case 4:
                        if (g.h) return g.return();
                        ua(g, 5, 6);
                        d || (Nq(c, "attach"), e = function e() {
                          var h = Pq(c, false);
                          h && Qq(c, h);
                        }, c.ye.D(a, "error", e), c.h = a, c.K && c.K.setMediaElement(a));
                        tb();
                        if (!b || !yi() || c.H) {
                          g.A(6);
                          break;
                        }
                        return F(g, Rq(c), 6);
                      case 6:
                        Aa(g);
                        c.aa.release();
                        Da(g, 0);
                        break;
                      case 5:
                        return f = ya(g), F(g, c.detach(), 10);
                      case 10:
                        throw f;
                    }
                  });
                };
                p.kj = function (a) {
                  this.Kh = a;
                };
                p.detach = function (a) {
                  a = a === void 0 ? false : a;
                  var b = this;
                  return P(function (c) {
                    if (c.g == 1) {
                      if (b.m == Kq) throw new U(2, 7, 7E3);
                      return F(c, b.Bc(false, a), 2);
                    }
                    if (c.g != 3) return F(c, Oq(b, "detach"), 3);
                    if (c.h) return c.return();
                    try {
                      b.h && (b.ye.Pa(), b.h = null), Nq(b, "detach"), b.C && !a && b.C.release();
                    } finally {
                      b.aa.release();
                    }
                    G(c);
                  });
                };
                function Oq(a, b) {
                  var c;
                  return P(function (d) {
                    return d.g == 1 ? (c = ++a.Je, F(d, zq(a.aa, b), 2)) : c != a.Je ? (a.aa.release(), d.return(true)) : d.return(false);
                  });
                }
                p.Bc = function (a, b) {
                  a = a === void 0 ? true : a;
                  b = b === void 0 ? false : b;
                  var c = this,
                    d,
                    e,
                    f,
                    g,
                    h,
                    k,
                    l,
                    m,
                    n,
                    q,
                    r,
                    u,
                    v,
                    w,
                    z,
                    y;
                  return P(function (B) {
                    switch (B.g) {
                      case 1:
                        return c.m != Kq && (c.m = Aq), F(B, Oq(c, "unload"), 2);
                      case 2:
                        if (B.h) return B.return();
                        va(B, 3);
                        c.Sa = false;
                        Nq(c, "unload");
                        Hq(c);
                        d = c.ze.map(function (D) {
                          return D();
                        });
                        c.ze = [];
                        return F(B, Promise.all(d), 5);
                      case 5:
                        c.dispatchEvent(Jq("unloading"));
                        c.we && (c.we.release(), c.we = null);
                        c.xa && (c.xa.release(), c.xa = null);
                        c.ib && (c.ib.release(), c.ib = null);
                        c.h && (c.j.Pa(), c.ac.Pa());
                        c.De.stop();
                        c.ob && (c.ob.release(), c.ob = null);
                        c.Fa && (c.Fa.stop(), c.Fa = null);
                        if (!c.I) {
                          B.A(6);
                          break;
                        }
                        return F(B, c.I.stop(), 7);
                      case 7:
                        c.I = null, c.xc = null;
                      case 6:
                        c.o && c.o.stop();
                        if (!c.l) {
                          B.A(8);
                          break;
                        }
                        return F(B, c.l.destroy(), 9);
                      case 9:
                        c.l = null;
                      case 8:
                        c.M && (c.M.release(), c.M = null);
                        c.G && (c.G.release(), c.G = null);
                        if ("webkit" !== window.shakaMediaKeysPolyfill || !c.F) {
                          B.A(10);
                          break;
                        }
                        return F(B, c.F.destroy(), 11);
                      case 11:
                        c.F = null;
                      case 10:
                        if (!c.H) {
                          B.A(12);
                          break;
                        }
                        return F(B, c.H.destroy(), 13);
                      case 13:
                        c.H = null;
                      case 12:
                        if (c.C && !b) c.C.onAssetUnload();
                        c.ma && !b && (c.ma.destroy(), c.ma = null);
                        b || c.$f.stop();
                        c.K && tp(c.K);
                        c.qa && (c.qa.g = null);
                        if (!c.u) {
                          B.A(14);
                          break;
                        }
                        return F(B, c.u.destroy(), 15);
                      case 15:
                        c.u = null;
                      case 14:
                        c.$ = false;
                        if (c.h) {
                          e = t(c.Yf);
                          for (f = e.next(); !f.done; f = e.next()) g = f.value, g.src.startsWith("blob:") && URL.revokeObjectURL(g.src), g.remove();
                          c.Yf = [];
                          Fj(c.h) && c.h.load();
                        }
                        if (!c.F) {
                          B.A(16);
                          break;
                        }
                        return F(B, c.F.destroy(), 17);
                      case 17:
                        c.F = null;
                      case 16:
                        c.Ta && c.X != c.Ta.rd() && (c.Ta.j || c.Ta.destroy(), c.Ta = null);
                        c.X = null;
                        c.Da = null;
                        c.R = null;
                        if (c.i) {
                          h = t(c.i.variants);
                          for (k = h.next(); !k.done; k = h.next()) for (l = k.value, m = t([l.audio, l.video]), n = m.next(); !n.done; n = m.next()) (q = n.value) && q.segmentIndex && q.segmentIndex.release();
                          r = t(c.i.textStreams);
                          for (u = r.next(); !u.done; u = r.next()) v = u.value, v.segmentIndex && v.segmentIndex.release();
                        }
                        c.g && c.g.streaming.clearDecodingCache && (Hf.clear(), vg.clear());
                        c.i = null;
                        c.B = new Yn();
                        c.Jh = null;
                        c.Zb = null;
                        c.V = null;
                        c.Ke = -1;
                        c.Ge = [];
                        w = t(c.uc.values());
                        for (z = w.next(); !z.done; z = w.next()) y = z.value, y.stop();
                        c.uc.clear();
                        c.kb = [];
                        c.Xf = -1;
                        c.N && c.N.Qh();
                        Sq(c);
                      case 3:
                        Aa(B);
                        c.aa.release();
                        Da(B, 4);
                        break;
                      case 4:
                        tb();
                        if (a && yi() && !c.H && c.h) return F(B, Rq(c), 0);
                        B.A(0);
                    }
                  });
                };
                p.jl = function (a) {
                  this.O = a;
                };
                p.load = function (a, b, c) {
                  b = b === void 0 ? null : b;
                  var d = this,
                    e,
                    f,
                    g,
                    h,
                    k,
                    l,
                    m,
                    n,
                    q,
                    r,
                    u,
                    v,
                    w,
                    z;
                  return P(function (y) {
                    switch (y.g) {
                      case 1:
                        if (d.m == Kq) throw new U(2, 7, 7E3);
                        e = null;
                        f = "";
                        if (a instanceof eo) {
                          if (a.j) throw new U(2, 7, 7006);
                          e = a;
                          f = e.rd() || "";
                        } else f = a || "";
                        return F(y, zq(d.aa, "load"), 2);
                      case 2:
                        d.aa.release();
                        if (!d.h) throw new U(2, 7, 7002);
                        if (!d.X) {
                          y.A(3);
                          break;
                        }
                        d.X = f;
                        return F(y, d.Bc(false), 3);
                      case 3:
                        g = ++d.Je;
                        h = function h() {
                          return P(function (B) {
                            if (B.g == 1) return d.Je == g ? B.A(0) : e ? F(B, e.destroy(), 3) : B.A(3);
                            throw new U(2, 7, 7E3);
                          });
                        };
                        k = function k(B, D) {
                          return P(function (I) {
                            switch (I.g) {
                              case 1:
                                return va(I, 2), F(I, zq(d.aa, D), 4);
                              case 4:
                                return F(I, h(), 5);
                              case 5:
                                return F(I, B(), 6);
                              case 6:
                                return F(I, h(), 7);
                              case 7:
                                e && d.g && (e.g = d.g);
                              case 2:
                                Aa(I), d.aa.release(), Da(I, 0);
                            }
                          });
                        };
                        ua(y, 5, 6);
                        b == null && e && (b = e.getStartTime());
                        d.O = b;
                        d.Sa = false;
                        d.dispatchEvent(Jq("loading"));
                        if (e) {
                          c = e.V;
                          y.A(8);
                          break;
                        }
                        if (c) {
                          y.A(8);
                          break;
                        }
                        return F(y, k(function () {
                          return P(function (B) {
                            if (B.g == 1) return F(B, Tq(d, f), 2);
                            c = B.h;
                            G(B);
                          });
                        }, "guessMimeType_"), 8);
                      case 8:
                        l = !!e;
                        if (e) {
                          ho(e, d);
                          d.B = e.getStats();
                          y.A(11);
                          break;
                        }
                        return F(y, Uq(d, f, b, c, true, d.g), 12);
                      case 12:
                        (e = y.h) ? (e.F = false, ho(e, d), d.B = e.getStats(), e.start(), e.B.catch(function () {})) : d.B = new Yn();
                      case 11:
                        m = !e;
                        n = Date.now() / 1E3;
                        d.B = e ? e.getStats() : new Yn();
                        d.X = f;
                        d.Da = c || null;
                        Sq(d);
                        q = function q() {
                          var B = d.h ? d.h.buffered : null;
                          return {
                            start: xj(B) || 0,
                            end: yj(B) || 0
                          };
                        };
                        d.xa = new cm(q);
                        d.xa.addEventListener("regionadd", function (B) {
                          Vq(d, B.region, "metadataadded");
                        });
                        if (m) return F(y, k(function () {
                          return P(function (B) {
                            return F(B, Wq(d, c), 0);
                          });
                        }, "initializeSrcEqualsDrmInner_"), 23);
                        d.ib = new cm(q);
                        return F(y, k(function () {
                          return P(function (B) {
                            if (B.g == 1) return F(B, Promise.race([e.ma, e.B]), 2);
                            d.xc = e.H;
                            var D = e;
                            D.qa = true;
                            d.I = D.l;
                            d.i = e.Hg();
                            G(B);
                          });
                        }, "waitForFinish"), 15);
                      case 15:
                        if (d.H) {
                          y.A(16);
                          break;
                        }
                        return F(y, k(function () {
                          return P(function (B) {
                            return F(B, Rq(d), 0);
                          });
                        }, "initializeMediaSourceEngineInner_"), 16);
                      case 16:
                        return d.i && d.i.textStreams.length && (d.u.enableTextDisplayer ? d.u.enableTextDisplayer() : yb("Text displayer w/ enableTextDisplayer", 'Text displayer should have a "enableTextDisplayer" method!')), F(y, k(function () {
                          return P(function (B) {
                            return F(B, e.B, 0);
                          });
                        }, "waitForFinish"), 18);
                      case 18:
                        d.g = e.getConfiguration();
                        d.Ae = e.G;
                        d.I && d.I.setMediaElement && d.h && d.I.setMediaElement(d.h);
                        d.we = io(e);
                        d.ue = e.Fa;
                        if (r = e.C) d.J = r;
                        l && d.h && d.h.nodeName === "AUDIO" && (Xq(d), d.configure("manifest.disableVideo", true));
                        if (e.i) {
                          y.A(19);
                          break;
                        }
                        return F(y, k(function () {
                          return P(function (B) {
                            return F(B, no(e, d.h), 0);
                          });
                        }, "drmEngine_.init"), 19);
                      case 19:
                        return d.F = jo(e), F(y, k(function () {
                          return P(function (B) {
                            return F(B, d.F.fc(d.h), 0);
                          });
                        }, "drmEngine_.attach"), 21);
                      case 21:
                        return u = d.g.abrFactory, d.o && d.Ce == u || (d.Ce = u, d.o && d.o.release(), d.o = u(), typeof d.o.setMediaElement != "function" && (yb("AbrManager w/o setMediaElement", "Please use an AbrManager with setMediaElement function."), d.o.setMediaElement = function () {}), typeof d.o.setCmsdManager != "function" && (yb("AbrManager w/o setCmsdManager", "Please use an AbrManager with setCmsdManager function."), d.o.setCmsdManager = function () {}), typeof d.o.trySuggestStreams != "function" && (yb("AbrManager w/o trySuggestStreams", "Please use an AbrManager with trySuggestStreams function."), d.o.trySuggestStreams = function () {}), d.o.configure(d.g.abr)), v = ko(e), w = e.o, F(y, k(function () {
                          return P(function (B) {
                            return F(B, Yq(d, n, w, v), 0);
                          });
                        }, "loadInner_"), 22);
                      case 22:
                        go(e);
                        d.Da && tb().bj() && Pe(d.Da) && rk(d.H, d.X, d.Da);
                        y.A(14);
                        break;
                      case 23:
                        return F(y, k(function () {
                          return P(function (B) {
                            return F(B, Zq(d, n, c), 0);
                          });
                        }, "srcEqualsInner_"), 14);
                      case 14:
                        d.dispatchEvent(Jq("loaded"));
                      case 6:
                        Aa(y);
                        if (!e) {
                          y.A(25);
                          break;
                        }
                        return F(y, e.destroy(), 25);
                      case 25:
                        d.Ta = null;
                        Da(y, 0);
                        break;
                      case 5:
                        z = ya(y);
                        if (!z || z.code == 7E3) {
                          y.A(27);
                          break;
                        }
                        return F(y, d.Bc(false), 27);
                      case 27:
                        throw z;
                    }
                  });
                };
                function Xq(a) {
                  for (var b = t(a.i.variants), c = b.next(); !c.done; c = b.next()) c = c.value, c.video && (c.video.closeSegmentIndex(), c.video = null), c.bandwidth = c.audio && c.audio.bandwidth ? c.audio.bandwidth : 0;
                  a.i.variants = a.i.variants.filter(function (d) {
                    return d.audio;
                  });
                }
                p.ej = function (a, b) {
                  a = a === void 0 ? true : a;
                  b = b === void 0 ? false : b;
                  var c = this,
                    d;
                  return P(function (e) {
                    return e.g == 1 ? F(e, $q(c), 2) : e.g != 3 ? (d = e.h, F(e, c.Bc(a, b), 3)) : e.return(d);
                  });
                };
                p.Uh = function (a, b) {
                  a = a === void 0 ? false : a;
                  b = b === void 0 ? false : b;
                  var c = this,
                    d;
                  return P(function (e) {
                    return e.g == 1 ? F(e, $q(c, b), 2) : e.g != 3 ? (d = e.h, F(e, c.detach(a), 3)) : e.return(d);
                  });
                };
                function $q(a, b) {
                  b = b === void 0 ? false : b;
                  var c, d, e;
                  return P(function (f) {
                    if (f.g == 1) {
                      c = null;
                      if (!(a.i && a.I && a.xc && a.X && a.g)) return f.A(2);
                      d = a.h.currentTime;
                      a.W() && !b && (d = null);
                      return F(f, ar(a, a.X, d, a.Da, a.g, true, false), 3);
                    }
                    if (f.g != 2) {
                      c = f.h;
                      a.Ee.push(c);
                      a.I && a.I.setMediaElement && a.I.setMediaElement(null);
                      if (e = a.l ? a.l.o : null) c.o = e;
                      var g = c,
                        h = a.I,
                        k = a.xc;
                      g.h = a.i;
                      g.l = h;
                      g.H = k;
                      c.C = a.J;
                      c.start();
                      a.i = null;
                      a.I = null;
                      a.xc = null;
                      a.o = null;
                      a.Ce = null;
                    }
                    return f.return(c);
                  });
                }
                p.preload = function (a, b, c, d) {
                  b = b === void 0 ? null : b;
                  var e = this,
                    f,
                    g;
                  return P(function (h) {
                    if (h.g == 1) return f = Bq(e), Sn(f, d || e.g, Bq(e)), F(h, Uq(e, a, b, c, false, f), 2);
                    (g = h.h) ? g.start() : Qq(e, new U(2, 7, 7005));
                    return h.return(g);
                  });
                };
                p.ng = function () {
                  var a = this,
                    b,
                    c,
                    d,
                    e;
                  return P(function (f) {
                    b = [];
                    c = t(a.Ee);
                    for (d = c.next(); !d.done; d = c.next()) e = d.value, e.j || b.push(e.destroy());
                    a.Ee = [];
                    return F(f, Promise.all(b), 0);
                  });
                };
                function Uq(a, b, c, d, e, f) {
                  e = e === void 0 ? false : e;
                  var h, k, l;
                  return P(function (m) {
                    if (m.g == 1) return d ? m.A(2) : F(m, Tq(a, b), 3);
                    m.g != 2 && (d = m.h);
                    if (br(a, d)) return m.return(null);
                    h = f || a.g;
                    k = false;
                    e && a.h && a.h.nodeName === "AUDIO" && (k = true);
                    l = ar(a, b, c, d || null, h, !e, k);
                    l = e ? l.then(function (n) {
                      n.F = false;
                      return n;
                    }) : l.then(function (n) {
                      a.Ee.push(n);
                      return n;
                    });
                    return m.return(l);
                  });
                }
                function ar(a, b, c, d, e, f, g) {
                  f = f === void 0 ? true : f;
                  g = g === void 0 ? false : g;
                  var h, k, l, m, n, q, r, u, v, w, z, y, B, D, I;
                  return P(function (C) {
                    if (C.g == 1) {
                      h = null;
                      k = gd(e);
                      g && (k.manifest.disableVideo = true);
                      l = function l() {
                        return h.R && h.j ? null : h;
                      };
                      m = function m() {
                        return l() ? l().getConfiguration() : a.g;
                      };
                      if (a.va.width != Infinity || a.va.height != Infinity || a.g.ignoreHardwareResolution) return C.A(2);
                      n = tb();
                      return F(C, n.jc(), 3);
                    }
                    C.g != 2 && (q = C.h, a.va.width = q.width, a.va.height = q.height);
                    r = new ni(k, a.va, null);
                    u = {
                      networkingEngine: a.N,
                      filter: function filter(A) {
                        var E, J;
                        return P(function (H) {
                          if (H.g == 1) return F(H, oi(r, A), 2);
                          if (H.g != 4) {
                            E = H.h;
                            if (!E) return H.A(0);
                            J = Jq("trackschanged");
                            return F(H, Promise.resolve(), 4);
                          }
                          h.dispatchEvent(J);
                          G(H);
                        });
                      },
                      makeTextStreamsForClosedCaptions: function makeTextStreamsForClosedCaptions(A) {
                        return cr(a, A);
                      },
                      onTimelineRegionAdded: function onTimelineRegionAdded(A) {
                        dm(h.I, A);
                      },
                      onEvent: function onEvent(A) {
                        return h.dispatchEvent(A);
                      },
                      onError: function onError(A) {
                        return h.onError(A);
                      },
                      isLowLatencyMode: function isLowLatencyMode() {
                        return m().streaming.lowLatencyMode;
                      },
                      updateDuration: function updateDuration() {
                        a.l && h.R && a.l.updateDuration();
                      },
                      newDrmInfo: function newDrmInfo(A) {
                        var E = h.i,
                          J = E ? E.g : null;
                        J && E.B && ri(r, J.keySystem, A);
                      },
                      onManifestUpdated: function onManifestUpdated() {
                        var A = new Map().set("isLive", a.W());
                        h.dispatchEvent(Jq("manifestupdated", A));
                        fo(h, false, function () {
                          if (a.C) a.C.onManifestUpdated(a.W());
                        });
                      },
                      getBandwidthEstimate: function getBandwidthEstimate() {
                        return a.o.getBandwidthEstimate();
                      },
                      onMetadata: function onMetadata(A, E, J, H) {
                        var K = A;
                        if (A == "com.apple.hls.interstitial" || A == "com.apple.hls.overlay") if (K = "com.apple.quicktime.HLS", A = {
                          startTime: E,
                          endTime: J,
                          values: H
                        }, a.C) a.C.onHLSInterstitialMetadata(a, a.h, A);
                        H = t(H);
                        A = H.next();
                        for (var L = {}; !A.done; L = {
                          Yg: void 0
                        }, A = H.next()) L.Yg = A.value, L.Yg.name != "ID" && fo(h, false, function (O) {
                          return function () {
                            dr(a, E, J, K, O.Yg);
                          };
                        }(L));
                      },
                      disableStream: function disableStream(A) {
                        return a.disableStream(A, a.g.streaming.maxDisabledTime);
                      },
                      addFont: function addFont(A, E) {
                        return a.addFont(A, E);
                      }
                    };
                    v = new cm(function () {
                      return a.Qa();
                    });
                    v.addEventListener("regionadd", function (A) {
                      var E = A.region;
                      er(a, "timelineregionadded", E, h);
                      fo(h, false, function () {
                        a.C && (a.C.onDashTimedMetadata(E), a.C.onDASHInterstitialMetadata(a, a.h, E));
                      });
                    });
                    w = null;
                    k.streaming.observeQualityChanges && (w = new Xl(function () {
                      return a.Fc();
                    }), w.addEventListener("qualitychange", function (A) {
                      fr(a, A.quality, A.position);
                    }), w.addEventListener("audiotrackchange", function (A) {
                      fr(a, A.quality, A.position, true);
                    }));
                    z = true;
                    y = {
                      tc: a.N,
                      onError: function onError(A) {
                        return h.onError(A);
                      },
                      vf: function vf(A) {
                        fo(h, true, function () {
                          a.F && gr(a, A);
                        });
                      },
                      onExpirationUpdated: function onExpirationUpdated(A, E) {
                        var J = Jq("expirationupdated");
                        h.dispatchEvent(J);
                        if ((J = h.l) && J.onExpirationUpdated) J.onExpirationUpdated(A, E);
                      },
                      onEvent: function onEvent(A) {
                        h.dispatchEvent(A);
                        A.type == "drmsessionupdate" && z && (z = false, A = Date.now() / 1E3 - h.ya, (a.B || h.getStats()).m = A, a.T && Gc(a.T));
                      }
                    };
                    B = Cq(a, l);
                    Qg(a.N, B);
                    D = function D() {
                      return a.md(y);
                    };
                    I = {
                      config: k,
                      vk: u,
                      Gk: v,
                      Fk: w,
                      md: D,
                      tk: r,
                      networkingEngine: B,
                      jj: f
                    };
                    h = new eo(b, d, c, I);
                    return C.return(h);
                  });
                }
                function Tq(a, b) {
                  var c, d, e, f;
                  return P(function (g) {
                    if (g.g == 1) return c = a.g.manifest.retryParameters, F(g, No(b, a.N, c), 2);
                    d = g.h;
                    d == "application/x-mpegurl" && (e = tb(), e.Ha() === "WEBKIT" && (d = "application/vnd.apple.mpegurl"));
                    d == "video/quicktime" && (f = tb(), f.Ha() === "CHROMIUM" && (d = "video/mp4"));
                    return g.return(d);
                  });
                }
                function br(a, b) {
                  if (!yi(tb())) return true;
                  if (b) {
                    if ((a.h || zi()).canPlayType(b) == "") return false;
                    if (!yi(tb()) || !wi.has(b)) return true;
                    if (Pe(b)) return tb().Ha() === "WEBKIT" && (a.g.drm.servers["com.apple.fps"] || a.g.drm.servers["com.apple.fps.1_0"]) ? a.g.streaming.useNativeHlsForFairPlay : a.g.streaming.preferNativeHls;
                    if (b === "application/dash+xml" || b === "video/vnd.mpeg.dash.mpd") return a.g.streaming.preferNativeDash;
                  }
                  return false;
                }
                function hr(a, b) {
                  var c = a.g.textDisplayFactory;
                  a.Jh !== c || (b === void 0 ? 0 : b) ? (b = a.u, a.u = c(), a.u.configure ? a.u.configure(a.g.textDisplayer) : yb("Text displayer w/ configure", 'Text displayer should have a "configure" method!'), a.u.setTextLanguage || yb("Text displayer w/ setTextLanguage", 'Text displayer should have a "setTextLanguage" method!'), b ? (a.u.setTextVisibility(b.isTextVisible()), b.destroy().catch(function () {})) : a.u.setTextVisibility(a.$), a.H && el(a.H, a.u), a.Jh = c, a.l && Om(a.l)) : a.u && a.u.configure && a.u.configure(a.g.textDisplayer);
                }
                function Rq(a) {
                  var b, c, d;
                  return P(function (e) {
                    if (e.g == 1) return tb(), Nq(a, "media-source"), a.g.mediaSource.useSourceElements && Fj(a.h), hr(a), b = ir(a.h, a.u, {
                      Jj: function Jj() {
                        return a.keySystem();
                      },
                      onMetadata: function onMetadata(f, g, h) {
                        f = t(f);
                        for (var k = f.next(); !k.done; k = f.next()) if (k = k.value, k.data && typeof k.cueTime == "number" && k.frames) {
                          var l = k.cueTime + g,
                            m = h;
                          m && l > m && (m = l);
                          for (var n = t(k.frames), q = n.next(); !q.done; q = n.next()) dr(a, l, m, "org.id3", q.value);
                          if (a.C) a.C.onHlsTimedMetadata(k, l);
                        }
                      },
                      Ak: function Ak(f) {
                        a.ib && dm(a.ib, {
                          schemeIdUri: f.schemeIdUri,
                          startTime: f.startTime,
                          endTime: f.endTime,
                          id: String(f.id),
                          emsg: f
                        });
                      },
                      onEvent: function onEvent(f) {
                        return a.dispatchEvent(f);
                      },
                      Ck: function Ck() {
                        a.I && a.I.update && a.I.update();
                      }
                    }, a.T, a.g.mediaSource), c = a.g.manifest, d = c.segmentRelativeVttTiming, b.Fa = d, F(e, b.M, 2);
                    a.H = b;
                    G(e);
                  });
                }
                function jr(a, b, c) {
                  function d() {
                    return kr(a);
                  }
                  a.j.D(b, "playing", d);
                  a.j.D(b, "pause", d);
                  a.j.D(b, "ended", d);
                  a.j.D(b, "ratechange", function () {
                    var f = a.h.playbackRate;
                    f != 0 && (a.M && (a.M.set(f), a.m == lr && a.o.playbackRateChanged(f), mr(a, f)), f = Jq("ratechange"), a.dispatchEvent(f));
                  });
                  b.remote && (a.j.D(b.remote, "connect", function () {
                    a.l && b.remote.state == "connected" && nr(a);
                    or(a);
                  }), a.j.D(b.remote, "connecting", function () {
                    return or(a);
                  }), a.j.D(b.remote, "disconnect", function () {
                    return P(function (f) {
                      if (f.g == 1) return a.l && b.remote.state == "disconnected" ? F(f, bn(a.l), 3) : f.A(2);
                      f.g != 2 && nr(a);
                      or(a);
                      G(f);
                    });
                  }));
                  b.audioTracks && (a.j.D(b.audioTracks, "addtrack", function () {
                    return or(a);
                  }), a.j.D(b.audioTracks, "removetrack", function () {
                    return or(a);
                  }), a.j.D(b.audioTracks, "change", function () {
                    return or(a);
                  }));
                  b.videoTracks && (a.j.D(b.videoTracks, "addtrack", function () {
                    return or(a);
                  }), a.j.D(b.videoTracks, "removetrack", function () {
                    return or(a);
                  }), a.j.D(b.videoTracks, "change", function () {
                    return or(a);
                  }));
                  (b.webkitPresentationMode || b.webkitSupportsFullscreen) && a.j.D(b, "webkitpresentationmodechanged", function () {
                    a.xe && hr(a, true);
                  });
                  if (b.textTracks) {
                    var e = function e() {
                      a.m === pr && a.u instanceof ap && nr(a);
                      or(a);
                    };
                    a.j.D(b.textTracks, "addtrack", function (f) {
                      if (f.track) switch (f = f.track, f.kind) {
                        case "metadata":
                          qr(a, f);
                          break;
                        case "chapters":
                          rr(a, f);
                          break;
                        default:
                          e();
                      }
                    });
                    a.j.D(b.textTracks, "removetrack", e);
                    a.j.D(b.textTracks, "change", e);
                  }
                  b.preload != "none" && a.j.Ba(b, "loadedmetadata", function () {
                    a.B.G = Date.now() / 1E3 - c;
                  });
                }
                function Yq(a, b, c, d) {
                  var e, f, g, h, k, l, m, n, q, r, u, v, w, z, y, B, D, I, C, A, E, J, H, K, L, O, Q, _N;
                  return P(function (M) {
                    switch (M.g) {
                      case 1:
                        Nq(a, "load");
                        e = a.h;
                        a.M = new Tl({
                          Ye: function Ye() {
                            return e.playbackRate;
                          },
                          Tc: function Tc() {
                            return e.defaultPlaybackRate;
                          },
                          ph: function ph(R) {
                            e.playbackRate = R;
                          },
                          wi: function wi(R) {
                            e.currentTime += R;
                          }
                        });
                        jr(a, e, b);
                        "onchange" in window.screen && a.j.D(window.screen, "change", function () {
                          if (a.J.getConfiguration) {
                            var R = a.J.getConfiguration();
                            R.hdrLevel == "AUTO" ? sr(a) : a.g.preferredVideoHdrLevel == "AUTO" && a.g.abr.enabled && (R.hdrLevel = "AUTO", a.J.configure(R), sr(a));
                          }
                        });
                        f = false;
                        g = t(a.i.variants);
                        for (h = g.next(); !h.done; h = g.next()) k = h.value, (l = k.video && k.video.dependencyStream) && (f = Hc(l));
                        Iq(a, a.g, f);
                        a.Fd = a.g.preferredTextLanguage;
                        a.Md = a.g.preferredTextRole;
                        a.Ld = a.g.preferForcedSubs;
                        tr(a.i.presentationTimeline, a.g.playRangeStart, a.g.playRangeEnd);
                        a.o.init(function (R, T, pa) {
                          a.i && a.l && R != a.l.o && ur(a, R, true, T === void 0 ? false : T, pa === void 0 ? 0 : pa);
                        });
                        a.o.setMediaElement(e);
                        a.o.setCmsdManager(a.qa);
                        a.l = vr(a);
                        a.l.configure(a.g.streaming);
                        a.m = lr;
                        a.dispatchEvent(Jq("streaming"));
                        m = c;
                      case 2:
                        (q = a.l.o) || m || (m = wr(a, true));
                        r = [];
                        n = q || m;
                        u = t([n.video, n.audio]);
                        for (v = u.next(); !v.done; v = u.next()) (w = v.value) && !w.segmentIndex && (r.push(w.createSegmentIndex()), w.dependencyStream && r.push(w.dependencyStream.createSegmentIndex()));
                        if (!(r.length > 0)) {
                          M.A(4);
                          break;
                        }
                        return F(M, Promise.all(r), 4);
                      case 4:
                        if (!n || n.disabledUntilTime != 0) {
                          M.A(2);
                          break;
                        }
                        if (a.I && a.I.onInitialVariantChosen) a.I.onInitialVariantChosen(n);
                        a.i.isLowLatency && (a.g.streaming.lowLatencyMode ? a.configure(a.Zf) : ab("Low-latency live stream detected, but low-latency streaming mode is not enabled in Shaka Player. Set streaming.lowLatencyMode configuration to true, and see https://bit.ly/3clctcj for details."));
                        a.K && (vp(a.K, a.i.isLowLatency && a.g.streaming.lowLatencyMode), Ap(a.K, b * 1E3));
                        tr(a.i.presentationTimeline, a.g.playRangeStart, a.g.playRangeEnd);
                        Em(a.l, a.g.playRangeStart, a.g.playRangeEnd);
                        a.Sa = true;
                        a.dispatchEvent(Jq("canupdatestarttime"));
                        z = function z(R) {
                          a.G = xr(a, R);
                          a.ob = yr(a, R);
                          zr(a, e, false);
                        };
                        a.g.streaming.startAtSegmentBoundary || (y = a.O, y == null && a.i.startTime && (y = a.i.startTime), z(y));
                        if (q) {
                          M.A(7);
                          break;
                        }
                        if (!a.g.streaming.startAtSegmentBoundary) {
                          M.A(8);
                          break;
                        }
                        B = a.i.presentationTimeline;
                        a.O instanceof Date && (I = B.m || B.i, C = a.O.getTime() / 1E3 - I, C != null && (D = C));
                        D == null && (D = typeof a.O === "number" ? a.O : a.h.currentTime);
                        a.O == null && a.i.startTime && (D = a.i.startTime);
                        A = B.Xb();
                        E = B.Gb();
                        D < A ? D = A : D > E && (D = E);
                        return F(M, Ar(m, D), 9);
                      case 9:
                        J = M.h, z(J);
                      case 8:
                        ur(a, m, true, false, 0);
                      case 7:
                        return a.G.ready(), H = a.Kc().find(function (R) {
                          return R.active;
                        }), H || ((K = eg(a.i.textStreams, a.Fd, a.Md, a.Ld)[0] || null) && Xn(a.B.h, K, true), m && (K ? (ig(m.audio, K, a.g) && (a.$ = true), a.$ && a.u.setTextVisibility(true)) : (a.$ = false, a.u.setTextVisibility(false)), Br(a)), K && (a.g.streaming.alwaysStreamText || a.Og()) && (Nm(a.l, K), Cr(a))), F(M, a.l.start(d), 10);
                      case 10:
                        a.g.abr.enabled && (a.o.enable(), Dr(a));
                        or(a);
                        a.i.variants.some(function (R) {
                          return R.primary;
                        });
                        if ((L = a.W()) && (a.g.streaming.liveSync && a.g.streaming.liveSync.enabled || a.i.serviceDescription || a.g.streaming.liveSync.panicMode) || a.g.streaming.vodDynamicPlaybackRate) O = function O() {
                          return Er(a);
                        }, a.j.D(e, "timeupdate", O);
                        L || (Q = function Q() {
                          return Fr(a);
                        }, a.j.D(e, "timeupdate", Q), Fr(a), a.i.nextUrl && (a.g.streaming.preloadNextUrlWindow > 0 && (_N = function N() {
                          var R;
                          return P(function (T) {
                            if (T.g == 1) {
                              R = a.Qa().end - a.h.currentTime;
                              if (isNaN(R) || !(R <= a.g.streaming.preloadNextUrlWindow)) return T.A(0);
                              a.j.Ma(e, "timeupdate", _N);
                              return F(T, a.preload(a.i.nextUrl), 4);
                            }
                            a.Ta = T.h;
                            G(T);
                          });
                        }, a.j.D(e, "timeupdate", _N)), a.j.D(e, "ended", function () {
                          a.load(a.Ta || a.i.nextUrl);
                        })));
                        if (a.C) a.C.onManifestUpdated(L);
                        G(M);
                    }
                  });
                }
                function Wq(a, b) {
                  var c, d, e;
                  return P(function (f) {
                    return f.g == 1 ? (c = Date.now() / 1E3, d = true, a.F = a.md({
                      tc: a.N,
                      onError: function onError(g) {
                        Qq(a, g);
                      },
                      vf: function vf() {},
                      onExpirationUpdated: function onExpirationUpdated() {
                        var g = Jq("expirationupdated");
                        a.dispatchEvent(g);
                      },
                      onEvent: function onEvent(g) {
                        a.dispatchEvent(g);
                        g.type == "drmsessionupdate" && d && (d = false, a.B.m = Date.now() / 1E3 - c);
                      }
                    }), a.F.configure(a.g.drm), e = jg([b]), a.F.O = true, F(f, Fh(a.F, [e], []), 2)) : F(f, a.F.fc(a.h), 0);
                  });
                }
                function Zq(a, b, c) {
                  var d, e, f, g, h, k, l, m, n, q, r, u;
                  return P(function (v) {
                    switch (v.g) {
                      case 1:
                        Nq(a, "src-equals");
                        d = a.h;
                        a.G = new Fl(d);
                        e = false;
                        a.ze.push(function () {
                          e = true;
                        });
                        a.dispatchEvent(Jq("canupdatestarttime"));
                        a.O != null && a.G.Wf(a.O);
                        a.ob = Gr(a, a.O || 0);
                        a.M = new Tl({
                          Ye: function Ye() {
                            return d.playbackRate;
                          },
                          Tc: function Tc() {
                            return d.defaultPlaybackRate;
                          },
                          ph: function ph(w) {
                            d.playbackRate = w;
                          },
                          wi: function wi(w) {
                            d.currentTime += w;
                          }
                        });
                        zr(a, d, true);
                        d.textTracks && (hr(a), f = function f(w) {
                          if (!(a.u instanceof ap)) {
                            var z = Hr(a).find(function (y) {
                              return y.mode !== "disabled";
                            });
                            z && (z.mode = w ? "showing" : "hidden");
                            a.u instanceof cp && (z = Ir(a)) && (z.mode = !w && a.u.isTextVisible() ? "showing" : "hidden");
                          }
                        }, a.j.D(d, "enterpictureinpicture", function () {
                          return f(true);
                        }), a.j.D(d, "leavepictureinpicture", function () {
                          return f(false);
                        }), d.remote ? (a.j.D(d.remote, "connect", function () {
                          return f(false);
                        }), a.j.D(d.remote, "connecting", function () {
                          return f(false);
                        }), a.j.D(d.remote, "disconnect", function () {
                          return f(false);
                        })) : "webkitCurrentPlaybackTargetIsWireless" in d && a.j.D(d, "webkitcurrentplaybacktargetiswirelesschanged", function () {
                          return f(false);
                        }), g = d, (g.webkitPresentationMode || g.webkitSupportsFullscreen) && a.j.D(g, "webkitpresentationmodechanged", function () {
                          g.webkitPresentationMode ? f(g.webkitPresentationMode !== "inline") : g.webkitSupportsFullscreen && f(g.webkitDisplayingFullscreen);
                        }));
                        jr(a, d, b);
                        h = Cp(a.K, a.X, c);
                        !h.includes("#t=") && (a.g.playRangeStart > 0 || isFinite(a.g.playRangeEnd)) && (h += "#t=", a.g.playRangeStart > 0 && (h += a.g.playRangeStart), isFinite(a.g.playRangeEnd) && (h += "," + a.g.playRangeEnd));
                        if (!a.H) {
                          v.A(2);
                          break;
                        }
                        return F(v, a.H.destroy(), 3);
                      case 3:
                        a.H = null;
                      case 2:
                        return Fj(d), d.src = h, k = tb(), k.Ua() == "TV" && d.load(), d.preload != "none" && !d.autoplay && Pe(c) && k.Ha() === "WEBKIT" && d.load(), a.m = pr, a.dispatchEvent(Jq("streaming")), l = function l() {
                          return new Promise(function (w) {
                            var z = new df(w);
                            a.j.D(d.textTracks, "change", function () {
                              return z.ia(.5);
                            });
                            z.ia(.5);
                          });
                        }, m = new zg(), wl(d, HTMLMediaElement.HAVE_METADATA, a.j, function () {
                          return P(function (w) {
                            if (w.g == 1) return a.G.ready(), a.Da && Pe(a.Da) ? F(w, l(), 3) : (m.resolve(), w.A(0));
                            m.resolve();
                            G(w);
                          });
                        }), wl(d, HTMLMediaElement.HAVE_CURRENT_DATA, a.j, function () {
                          var w, z, y, B, D;
                          return P(function (I) {
                            if (I.g == 1) return F(I, l(), 2);
                            if (e) return I.return();
                            Jr(a);
                            w = Hr(a);
                            w.some(function (C) {
                              return C.mode === "showing";
                            }) && (a.$ = true, a.u.setTextVisibility(true));
                            if (!(a.u instanceof ap)) for (w.length && (a.u.enableTextDisplayer ? a.u.enableTextDisplayer() : yb("Text displayer w/ enableTextDisplayer", 'Text displayer should have a "enableTextDisplayer" method')), z = false, y = t(w), B = y.next(); !B.done; B = y.next()) D = B.value, D.mode !== "disabled" && (z ? (D.mode = "disabled", ab("Found more than one enabled text track, disabling it", D)) : (Kr(a, D), z = true));
                            Lr(a);
                            G(I);
                          });
                        }), d.error ? m.reject(Pq(a)) : d.preload == "none" && (ab('With <video preload="none">, the browser will not load anything until play() is called. We are unable to measure load latency in a meaningful way, and we cannot provide track info yet. Please do not use preload="none" with Shaka Player.'), m.resolve()), a.j.Ba(d, "error", function () {
                          m.reject(Pq(a));
                        }), F(v, hf(a.g.streaming.loadTimeout, m), 4);
                      case 4:
                        if ((n = a.W()) && (a.g.streaming.liveSync && a.g.streaming.liveSync.enabled || a.g.streaming.liveSync.panicMode) || a.g.streaming.vodDynamicPlaybackRate) q = function q() {
                          return Er(a);
                        }, a.j.D(d, "timeupdate", q);
                        n || (r = function r() {
                          return Fr(a);
                        }, a.j.D(d, "timeupdate", r), Fr(a));
                        a.C && (a.C.onManifestUpdated(n), n && (u = a.Qa().end, a.j.D(d, "progress", function () {
                          var w = a.Qa().end;
                          u != w && (a.C.onManifestUpdated(a.W()), u = w);
                        })));
                        a.Sa = true;
                        G(v);
                    }
                  });
                }
                function Jr(a) {
                  var b = a.g.preferredAudioLanguage;
                  b != "" && a.Oi(b, a.g.preferredAudioRole);
                }
                function Lr(a) {
                  var b = a.g.preferredTextLanguage;
                  b != "" && a.jh(b, a.g.preferredTextRole, a.g.preferForcedSubs);
                }
                function qr(a, b) {
                  if (b.kind == "metadata") {
                    b.mode = "hidden";
                    a.j.D(b, "cuechange", function () {
                      if (b.activeCues) for (var d = t(b.activeCues), e = d.next(); !e.done; e = d.next()) if (e = e.value, dr(a, e.startTime, e.endTime, e.type, e.value), a.C) a.C.onCueMetadataChange(e.value);
                      if (b.cues) {
                        d = [];
                        e = t(b.cues);
                        for (var f = e.next(), g = {}; !f.done; g = {
                          Dc: void 0
                        }, f = e.next()) g.Dc = f.value, g.Dc.type == "com.apple.quicktime.HLS" && g.Dc.startTime != null && (f = d.find(function (h) {
                          return function (k) {
                            return k.startTime == h.Dc.startTime && k.endTime == h.Dc.endTime;
                          };
                        }(g)), f || (f = {
                          startTime: g.Dc.startTime,
                          endTime: g.Dc.endTime,
                          values: []
                        }, d.push(f)), f.values.push(g.Dc.value));
                        d = t(d);
                        for (e = d.next(); !e.done; e = d.next()) e = e.value, e.values.some(function (h) {
                          return h.key == "X-ASSET-URI" || h.key == "X-ASSET-LIST";
                        }) && a.C && (e.values.push({
                          key: "CUE",
                          description: "",
                          data: e.startTime != 0 || a.W() ? "ONCE" : "ONCE,PRE",
                          mimeType: null,
                          pictureType: null
                        }), a.C.onHLSInterstitialMetadata(a, a.h, e));
                      }
                    });
                    var c = new df(function () {
                      var d = Mr(a);
                      d = t(d);
                      for (var e = d.next(); !e.done; e = d.next()) e.value.mode = "hidden";
                    }).Jb().ia(.5);
                    a.ze.push(function () {
                      c.stop();
                    });
                  }
                }
                function Vq(a, b, c) {
                  b = new Map().set("startTime", b.startTime).set("endTime", b.endTime).set("metadataType", b.schemeIdUri).set("payload", b.payload);
                  a.dispatchEvent(Jq(c, b));
                }
                function dr(a, b, c, d, e) {
                  a.xa && (b = {
                    schemeIdUri: d,
                    startTime: b,
                    endTime: c || Infinity,
                    id: "",
                    payload: e
                  }, b.id = JSON.stringify(b), dm(a.xa, b));
                }
                function rr(a, b) {
                  if (b && b.kind == "chapters") {
                    b.mode = "hidden";
                    var c = new df(function () {
                      b.mode = "hidden";
                    }).Jb().ia(.5);
                    a.ze.push(function () {
                      c.stop();
                    });
                  }
                }
                p.Kk = function () {
                  for (var a = this.aa; a.g;) a.release();
                };
                p.md = function (a) {
                  return new vh(a);
                };
                function Cq(a, b) {
                  function c(f) {
                    b() ? b().dispatchEvent(f) : a.dispatchEvent(f);
                  }
                  function d(f) {
                    b() ? fo(b(), true, f) : f();
                  }
                  b || (b = function b() {
                    return null;
                  });
                  var e = new Mg(function (f, g, h, k, l) {
                    d(function () {
                      a.o && a.o.segmentDownloaded(f, g, h, k, l);
                    });
                  }, function (f, g, h) {
                    g = new Map().set("headers", f).set("request", g).set("requestType", h);
                    c(Jq("downloadheadersreceived", g));
                    d(function () {
                      if (a.qa) {
                        var k = a.qa;
                        if (k.h.enabled) {
                          var l = f["cmsd-static"];
                          if (l) try {
                            var m = new Map(),
                              n = l.split(",");
                            for (l = 0; l < n.length; l++) {
                              var q = n[l].split("=");
                              m.set(q[0], xq(q[1]));
                            }
                          } catch (z) {}
                          if (m = f["cmsd-dynamic"]) {
                            a: {
                              try {
                                var r = new Map(),
                                  u = m.split(";");
                                for (m = 1; m < u.length; m++) {
                                  var v = u[m].split("=");
                                  r.set(v[0], xq(v[1]));
                                }
                                var w = r;
                                break a;
                              } catch (z) {
                                w = null;
                                break a;
                              }
                              w = void 0;
                            }
                            w && (k.g = w);
                          }
                        }
                      }
                    });
                  }, function (f, g) {
                    f = new Map().set("request", f).set("response", g);
                    c(Jq("downloadcompleted", f));
                  }, function (f, g, h, k) {
                    f = new Map().set("request", f).set("error", g).set("httpResponseCode", h).set("aborted", k);
                    c(Jq("downloadfailed", f));
                  }, function (f, g, h) {
                    d(function () {
                      if (a.K) {
                        var k = a.K,
                          l = h;
                        l = l === void 0 ? {} : l;
                        if (k.g.enabled) if (g.method === "HEAD") Zp(k, g, {});else switch (f) {
                          case 0:
                            try {
                              if (k.g.enabled) {
                                if (l.type) {
                                  a: {
                                    switch (l.type) {
                                      case 4:
                                        var m = k.u ? xp : wp;
                                        break a;
                                      case 3:
                                      case 2:
                                        m = k.u ? zp : yp;
                                        break a;
                                      case 5:
                                        m = "s";
                                        break a;
                                    }
                                    m = void 0;
                                  }
                                  k.l = m;
                                }
                                Zp(k, g, {
                                  ot: Gp,
                                  su: !k.F
                                });
                              }
                            } catch (q) {
                              cb("CMCD_MANIFEST_ERROR", "Could not generate manifest CMCD data.", q);
                            }
                            break;
                          case Xg:
                            try {
                              if (k.g.enabled) {
                                var n = nq(k, l, g.uris[0]);
                                n.ts = Date.now();
                                k.m.has(g) && k.m.delete(g);
                                k.m.set(g, n.ts);
                                Zp(k, g, n);
                              }
                            } catch (q) {
                              cb("CMCD_SEGMENT_ERROR", "Could not generate segment CMCD data.", q);
                            }
                            break;
                          case 2:
                          case 5:
                          case 6:
                            Zp(k, g, {
                              ot: "k"
                            });
                            break;
                          case 4:
                            Zp(k, g, {
                              ot: "o"
                            });
                        }
                      }
                    });
                  }, function (f, g, h, k) {
                    (f = b() ? b().l : a.I) && f.banLocation && f.banLocation(k);
                  }, function (f, g, h) {
                    if (g.data) {
                      var k = g.data.byteLength,
                        l = b() ? b().getStats() : a.B;
                      l && (bo(l, k), f === 0 && (l.oi = k));
                      k = a.K;
                      h = h === void 0 ? {} : h;
                      if (Np(k).length !== 0) switch (f) {
                        case Xg:
                          try {
                            var m = nq(k, h, g.uri);
                            g.originalRequest && g.originalRequest.timeToFirstByte != null && (m.ttfb = g.originalRequest.timeToFirstByte);
                            g.timeMs != null && (m.ttlb = g.timeMs);
                            var n = g.originalUri || g.uri;
                            if (n.includes("CMCD=")) try {
                              var q = new URL(n);
                              q.searchParams.delete("CMCD");
                              var r = q.toString();
                            } catch (A) {
                              r = n;
                            } else r = n;
                            m.url = r;
                            k.m.has(g.originalRequest) ? (m.ts = k.m.get(g.originalRequest), k.m.delete(g.originalRequest)) : m.ts || (m.ts = Date.now());
                            var u = Np(k);
                            if (u.length !== 0) {
                              var v = k.g.version == Qp ? Array.from(new Set([].concat(x(Rp), x(rq)))) : cq;
                              m.rc = g.status || 0;
                              var w = Pp(k, m, Op);
                              g.headers && g.headers["CMSD-Static"] && (w.cmsds = btoa(g.headers["CMSD-Static"]));
                              g.headers && g.headers["CMSD-Dynamic"] && (w.cmsdd = btoa(g.headers["CMSD-Dynamic"]));
                              for (var z = t(u), y = z.next(); !y.done; y = z.next()) {
                                var B = y.value,
                                  D = Tp(B.includeKeys || [], v),
                                  I = aq(B);
                                k.o[I] || (k.o[I] = {
                                  request: 1,
                                  response: 1
                                });
                                w.sn = k.o[I].response++;
                                var C = Vp(w, D);
                                Yp(k, C, B, g);
                              }
                            }
                          } catch (A) {
                            cb("CMCD_SEGMENT_ERROR", "Could not generate response segment CMCD data.", A);
                          }
                      }
                    }
                  });
                  e.configure(a.g.networking);
                  return e;
                }
                function xr(a, b) {
                  return new Il(a.h, a.i, a.g.streaming, b, function () {
                    a.ob && Wl(a.ob, !a.G.Hh());
                    a.l && a.l.bd();
                    a.R && Nr(a, "seeking");
                  }, function (c) {
                    return a.dispatchEvent(c);
                  });
                }
                function yr(a, b) {
                  var c = a.W() || typeof b === "number" && b > 0;
                  b = new Io(a.we, c);
                  b.addEventListener("enter", function (f) {
                    er(a, "timelineregionenter", f.region);
                  });
                  b.addEventListener("exit", function (f) {
                    er(a, "timelineregionexit", f.region);
                  });
                  b.addEventListener("skip", function (f) {
                    var g = f.region;
                    f.seeking || (er(a, "timelineregionenter", g), er(a, "timelineregionexit", g));
                  });
                  var d = new Io(a.xa, c);
                  d.addEventListener("enter", function (f) {
                    Vq(a, f.region, "metadata");
                  });
                  c = new Io(a.ib, c);
                  c.addEventListener("enter", function (f) {
                    f = new Map().set("detail", f.region.emsg);
                    a.dispatchEvent(Jq("emsg", f));
                  });
                  var e = new Vl(a.h);
                  e.g.add(b);
                  e.g.add(d);
                  e.g.add(c);
                  a.ue && e.g.add(a.ue);
                  return e;
                }
                function Gr(a, b) {
                  b = new Io(a.xa, b instanceof Date || b > 0);
                  b.addEventListener("enter", function (d) {
                    Vq(a, d.region, "metadata");
                  });
                  var c = new Vl(a.h);
                  c.g.add(b);
                  return c;
                }
                function zr(a, b, c) {
                  a.R = new ji();
                  mi(a.R, li);
                  Or(a);
                  Sq(a);
                  a.Fa = new df(function () {
                    Nr(a);
                  });
                  a.g.streaming.rebufferingGoal && a.Fa.Ea(.25);
                  a.j.D(b, "waiting", function () {
                    return Nr(a, "waiting");
                  });
                  a.j.D(b, "canplaythrough", function () {
                    return Nr(a, "canplaythrough");
                  });
                  a.j.D(b, "playing", function () {
                    return Nr(a, "playing");
                  });
                  a.j.D(b, "seeked", function () {
                    return Nr(a, "seeked");
                  });
                  c && (a.j.D(b, "stalled", function () {
                    return Nr(a, "stalled");
                  }), a.j.D(b, "progress", function () {
                    return Nr(a, "progress");
                  }), a.j.D(b, "timeupdate", function () {
                    return Nr(a, "timeupdate");
                  }));
                }
                function Or(a) {
                  var b = a.g.streaming.rebufferingGoal;
                  a.R.i.set(ki, Math.min(.5, b / 2)).set(li, b);
                }
                function Nr(a, b) {
                  if (a.g.streaming.rebufferingGoal) {
                    b = a.H ? tk(a.H) : false;
                    b = a.be() || b || a.G.ki();
                    var c = Aj(a.h.buffered, a.h.currentTime),
                      d = a.R,
                      e = d.i.get(d.g);
                    mi(d, b || c >= e && c > 0 ? ki : li) && Sq(a);
                  } else if (b) {
                    c = void 0;
                    switch (b) {
                      case "seeking":
                      case "waiting":
                        c = li;
                        break;
                      case "canplaythrough":
                      case "playing":
                      case "seeked":
                        c = ki;
                    }
                    c !== void 0 && mi(a.R, c) && Sq(a);
                  }
                }
                function ir(a, b, c, d, e) {
                  return new nk(a, b, c, e, d);
                }
                function vr(a) {
                  return new ym(a.i, {
                    lc: function lc() {
                      return a.G ? a.G.He() : 0;
                    },
                    getBandwidthEstimate: function getBandwidthEstimate() {
                      return a.o.getBandwidthEstimate();
                    },
                    Ob: function Ob() {
                      return a.Ob();
                    },
                    video: a.h,
                    Z: a.H,
                    tc: a.N,
                    onError: function onError(b) {
                      return Qq(a, b);
                    },
                    onEvent: function onEvent(b) {
                      return a.dispatchEvent(b);
                    },
                    wf: function wf(b, c, d) {
                      var e = b.startTime,
                        f = b.endTime,
                        g = c.type;
                      if (g != Ac) {
                        if (a.G) {
                          a.G.zi();
                          var h = Ik(a.H, g);
                          !a.W() && a.h.paused && !a.h.seeking && h != null && h > 0 && a.G.He() < h && a.G.Wf(h);
                        }
                        Nr(a);
                      }
                      d = new Map().set("start", e).set("end", f).set("contentType", g).set("isMuxed", d);
                      a.dispatchEvent(Jq("segmentappended", d));
                      a.o && c.fastSwitching && b.Xc && b.ee && a.o.trySuggestStreams();
                    },
                    Bk: function Bk(b, c) {
                      (c = c.xd) && a.ue && Zl(a.ue, c, b);
                    },
                    Oh: function Oh(b, c) {
                      var d = a.F;
                      if (d.h.parseInbandPsshEnabled && !d.H && ["audio", "video"].includes(b)) {
                        b = new th(Vb(c));
                        c = 0;
                        for (var e = t(b.data), f = e.next(); !f.done; f = e.next()) c += f.value.length;
                        if (c == 0) d = Promise.resolve();else {
                          c = new Uint8Array(c);
                          e = 0;
                          b = t(b.data);
                          for (f = b.next(); !f.done; f = b.next()) f = f.value, c.set(f, e), e += f.length;
                          _Oh(d, "cenc", c);
                          d = d.m;
                        }
                      } else d = Promise.resolve();
                      return d;
                    },
                    disableStream: function disableStream(b, c) {
                      return a.disableStream(b, c);
                    },
                    $k: function $k(b, c) {
                      return a.g.abr.enabled && c.fastSwitching && b.Xc && b.ee ? false : true;
                    }
                  });
                }
                p.configure = function (a, b) {
                  var c = this.getConfiguration();
                  arguments.length == 2 && typeof a == "string" && (a = rn(a, b));
                  "preferredVariantRole" in a && (yb("preferredVariantRole configuration", "Please Use preferredAudioRole instead."), a.preferredAudioRole = a.preferredVariantRole, delete a.preferredVariantRole);
                  a.streaming && "forceTransmuxTS" in a.streaming && (yb("streaming.forceTransmuxTS configuration", "Please Use mediaSource.forceTransmux instead."), a.mediaSource = a.mediaSource || {}, a.mediaSource.mediaSource = a.streaming.forceTransmuxTS, delete a.streaming.forceTransmuxTS);
                  a.streaming && "forceTransmux" in a.streaming && (yb("streaming.forceTransmux configuration", "Please Use mediaSource.forceTransmux instead."), a.mediaSource = a.mediaSource || {}, a.mediaSource.mediaSource = a.streaming.forceTransmux, delete a.streaming.forceTransmux);
                  if (a.streaming && "useNativeHlsOnSafari" in a.streaming) {
                    yb("streaming.useNativeHlsOnSafari configuration", "Please Use streaming.useNativeHlsForFairPlay or streaming.preferNativeHls instead.");
                    var d = tb();
                    a.streaming.preferNativeHls = a.streaming.useNativeHlsOnSafari && d.Ha() === "WEBKIT";
                    delete a.streaming.useNativeHlsOnSafari;
                  }
                  a.streaming && typeof a.streaming.liveSync == "boolean" && (yb("streaming.liveSync", "Please Use streaming.liveSync.enabled instead."), d = a.streaming.liveSync, a.streaming.liveSync = {}, a.streaming.liveSync.enabled = d);
                  if (a.streaming && !(a.streaming.liveSync && "targetLatency" in a.streaming.liveSync) && ("liveSyncMinLatency" in a.streaming || "liveSyncMaxLatency" in a.streaming)) {
                    d = a.streaming.liveSyncMinLatency || 0;
                    var e = Math.abs((a.streaming.liveSyncMaxLatency || 1) - d) / 2;
                    a.streaming.liveSync = a.streaming.liveSync || {};
                    a.streaming.liveSync.targetLatency = d + e;
                    a.streaming.liveSync.targetLatencyTolerance = e;
                  }
                  a.streaming && "liveSyncMaxLatency" in a.streaming && (yb("streaming.liveSyncMaxLatency", "Please Use streaming.liveSync.targetLatency and streaming.liveSync.targetLatencyTolerance instead. Or, set the values in your DASH manifest"), delete a.streaming.liveSyncMaxLatency);
                  a.streaming && "liveSyncMinLatency" in a.streaming && (yb("streaming.liveSyncMinLatency", "Please Use streaming.liveSync.targetLatency and streaming.liveSync.targetLatencyTolerance instead. Or, set the values in your DASH manifest"), delete a.streaming.liveSyncMinLatency);
                  a.streaming && "liveSyncTargetLatency" in a.streaming && (yb("streaming.liveSyncTargetLatency", "Please Use streaming.liveSync.targetLatency instead."), a.streaming.liveSync = a.streaming.liveSync || {}, a.streaming.liveSync.targetLatency = a.streaming.liveSyncTargetLatency, delete a.streaming.liveSyncTargetLatency);
                  a.streaming && "liveSyncTargetLatencyTolerance" in a.streaming && (yb("streaming.liveSyncTargetLatencyTolerance", "Please Use streaming.liveSync.targetLatencyTolerance instead."), a.streaming.liveSync = a.streaming.liveSync || {}, a.streaming.liveSync.targetLatencyTolerance = a.streaming.liveSyncTargetLatencyTolerance, delete a.streaming.liveSyncTargetLatencyTolerance);
                  a.streaming && "liveSyncPlaybackRate" in a.streaming && (yb("streaming.liveSyncPlaybackRate", "Please Use streaming.liveSync.maxPlaybackRate instead."), a.streaming.liveSync = a.streaming.liveSync || {}, a.streaming.liveSync.maxPlaybackRate = a.streaming.liveSyncPlaybackRate, delete a.streaming.liveSyncPlaybackRate);
                  a.streaming && "liveSyncMinPlaybackRate" in a.streaming && (yb("streaming.liveSyncMinPlaybackRate", "Please Use streaming.liveSync.minPlaybackRate instead."), a.streaming.liveSync = a.streaming.liveSync || {}, a.streaming.liveSync.minPlaybackRate = a.streaming.liveSyncMinPlaybackRate, delete a.streaming.liveSyncMinPlaybackRate);
                  a.streaming && "liveSyncPanicMode" in a.streaming && (yb("streaming.liveSyncPanicMode", "Please Use streaming.liveSync.panicMode instead."), a.streaming.liveSync = a.streaming.liveSync || {}, a.streaming.liveSync.panicMode = a.streaming.liveSyncPanicMode, delete a.streaming.liveSyncPanicMode);
                  a.streaming && "liveSyncPanicThreshold" in a.streaming && (yb("streaming.liveSyncPanicThreshold", "Please Use streaming.liveSync.panicThreshold instead."), a.streaming.liveSync = a.streaming.liveSync || {}, a.streaming.liveSync.panicThreshold = a.streaming.liveSyncPanicThreshold, delete a.streaming.liveSyncPanicThreshold);
                  if (a.mediaSource && "sourceBufferExtraFeatures" in a.mediaSource) {
                    yb("mediaSource.sourceBufferExtraFeatures configuration", "Please Use mediaSource.addExtraFeaturesToSourceBuffer() instead.");
                    var f = a.mediaSource.sourceBufferExtraFeatures;
                    a.mediaSource.addExtraFeaturesToSourceBuffer = function () {
                      return f;
                    };
                    delete a.mediaSource.sourceBufferExtraFeatures;
                  }
                  a.manifest && a.manifest.hls && "useSafariBehaviorForLive" in a.manifest.hls && (yb("manifest.hls.useSafariBehaviorForLive configuration", "Please Use liveSync config to keep on live Edge instead."), delete a.manifest.hls.useSafariBehaviorForLive);
                  a.streaming && "parsePrftBox" in a.streaming && (yb("streaming.parsePrftBox configuration", "Now fired without needing a configuration."), delete a.streaming.parsePrftBox);
                  a.manifest && a.manifest.dash && "enableAudioGroups" in a.manifest.dash && (yb("manifest.dash.enableAudioGroups configuration", "Please Use manifest.enableAudioGroups instead."), a.manifest.enableAudioGroups = a.manifest.dash.enableAudioGroups, delete a.manifest.dash.enableAudioGroups);
                  a.streaming && "dispatchAllEmsgBoxes" in a.streaming && (yb("streaming.dispatchAllEmsgBoxes configuration", "Please Use mediaSource.dispatchAllEmsgBoxes instead."), a.mediaSource = a.mediaSource || {}, a.mediaSource.dispatchAllEmsgBoxes = a.streaming.dispatchAllEmsgBoxes, delete a.streaming.dispatchAllEmsgBoxes);
                  a.streaming && "autoLowLatencyMode" in a.streaming && (yb("streaming.autoLowLatencyMode configuration", "Please Use streaming.lowLatencyMode instead."), a.streaming.lowLatencyMode = a.streaming.autoLowLatencyMode, delete a.streaming.autoLowLatencyMode);
                  a.manifest && a.manifest.dash && "ignoreSupplementalCodecs" in a.manifest.dash && (yb("manifest.dash.ignoreSupplementalCodecs configuration", "Please Use manifest.ignoreSupplementalCodecs instead."), a.manifest.ignoreSupplementalCodecs = a.manifest.dash.ignoreSupplementalCodecs, delete a.manifest.dash.ignoreSupplementalCodecs);
                  a.manifest && a.manifest.hls && "ignoreSupplementalCodecs" in a.manifest.hls && (yb("manifest.hls.ignoreSupplementalCodecs configuration", "Please Use manifest.ignoreSupplementalCodecs instead."), a.manifest.ignoreSupplementalCodecs = a.manifest.hls.ignoreSupplementalCodecs, delete a.manifest.hls.ignoreSupplementalCodecs);
                  a.manifest && a.manifest.dash && "updatePeriod" in a.manifest.dash && (yb("manifest.dash.updatePeriod configuration", "Please Use manifest.updatePeriod instead."), a.manifest.updatePeriod = a.manifest.dash.updatePeriod, delete a.manifest.dash.updatePeriod);
                  a.manifest && a.manifest.hls && "updatePeriod" in a.manifest.hls && (yb("manifest.hls.updatePeriod configuration", "Please Use manifest.updatePeriod instead."), a.manifest.updatePeriod = a.manifest.hls.updatePeriod, delete a.manifest.hls.updatePeriod);
                  a.manifest && a.manifest.dash && "ignoreDrmInfo" in a.manifest.dash && (yb("manifest.dash.ignoreDrmInfo configuration", "Please Use manifest.ignoreDrmInfo instead."), a.manifest.ignoreDrmInfo = a.manifest.dash.ignoreDrmInfo, delete a.manifest.dash.ignoreDrmInfo);
                  if (a.drm && a.drm.advanced) {
                    d = false;
                    for (var g in a.drm.advanced) {
                      var h = a.drm.advanced[g];
                      e = h.videoRobustness;
                      h = h.audioRobustness;
                      "videoRobustness" in a.drm.advanced[g] && !Array.isArray(a.drm.advanced[g].videoRobustness) && (a.drm.advanced[g].videoRobustness = [e], d = true);
                      "audioRobustness" in a.drm.advanced[g] && !Array.isArray(a.drm.advanced[g].audioRobustness) && (a.drm.advanced[g].audioRobustness = [h], d = true);
                    }
                    d && yb("AdvancedDrmConfiguration's videoRobustness and audioRobustness", "These properties are no longer strings but array of strings, please update your usage of these properties.");
                  }
                  a.streaming && "forceHTTP" in a.streaming && (yb("streaming.forceHTTP configuration", "Please Use networking.forceHTTP instead."), a.networking = a.networking || {}, a.networking.forceHTTP = a.streaming.forceHTTP, delete a.streaming.forceHTTP);
                  a.streaming && "forceHTTPS" in a.streaming && (yb("streaming.forceHTTPS configuration", "Please Use networking.forceHTTP instead."), a.networking = a.networking || {}, a.networking.forceHTTPS = a.streaming.forceHTTPS, delete a.streaming.forceHTTPS);
                  a.streaming && "minBytesForProgressEvents" in a.streaming && (yb("streaming.minBytesForProgressEvents configuration", "Please Use networking.minBytesForProgressEvents instead."), a.networking = a.networking || {}, a.networking.minBytesForProgressEvents = a.streaming.minBytesForProgressEvents, delete a.streaming.minBytesForProgressEvents);
                  g = Sn(this.g, a, Bq(this));
                  Pr(this, c);
                  return g;
                };
                p.sj = function (a) {
                  this.Zf = a;
                };
                function Pr(a, b) {
                  a.Ae = new ni(a.g, a.va, a.F);
                  if (a.I) {
                    var c = gd(a.g.manifest);
                    a.h && a.h.nodeName === "AUDIO" && (c.disableVideo = true);
                    a.I.configure(c);
                  }
                  a.F && a.F.configure(a.g.drm);
                  if (a.l) {
                    a.l.configure(a.g.streaming);
                    try {
                      a.m != Kq && pi(a.Ae, a.i) && or(a);
                    } catch (e) {
                      Qq(a, e);
                    }
                    a.o && sr(a);
                    c = a.l.o;
                    !c || c.allowedByApplication && c.allowedByKeySystem || Gq(a);
                  }
                  a.N && a.N.configure(a.g.networking);
                  a.H && (a.H.configure(a.g.mediaSource), a.H.Fa = a.g.manifest.segmentRelativeVttTiming);
                  a.u && hr(a);
                  a.o && (a.o.configure(a.g.abr), a.g.abr.enabled ? a.o.enable() : a.o.disable(), Dr(a));
                  a.R && Or(a);
                  a.Fa && (a.g.streaming.rebufferingGoal ? a.Fa.Ea(.25) : a.Fa.stop());
                  a.i && tr(a.i.presentationTimeline, a.g.playRangeStart, a.g.playRangeEnd);
                  a.C && a.C.configure(a.g.ads);
                  a.K && a.K.configure(a.g.cmcd);
                  a.qa && a.qa.configure(a.g.cmsd);
                  a.ya && a.ya.configure(a.g.queue);
                  if (a.m == lr && a.J.getConfiguration) {
                    c = a.J.getConfiguration();
                    var d = false;
                    b.preferredVideoHdrLevel != a.g.preferredVideoHdrLevel && c.hdrLevel != a.g.preferredVideoHdrLevel && (c.hdrLevel = a.g.preferredVideoHdrLevel, d = true);
                    b.preferredVideoLayout != a.g.preferredVideoLayout && c.videoLayout != a.g.preferredVideoLayout && (c.videoLayout = a.g.preferredVideoLayout, d = true);
                    b.preferSpatialAudio != a.g.preferSpatialAudio && c.spatialAudio != a.g.preferSpatialAudio && (c.spatialAudio = a.g.preferSpatialAudio, d = true);
                    b.preferredVideoRole != a.g.preferredVideoRole && c.videoRole != a.g.preferredVideoRole && (c.videoRole = a.g.preferredVideoRole, d = true);
                    d && (a.J.configure(c), Gq(a));
                  }
                }
                p.getConfiguration = function () {
                  var a = Bq(this);
                  Sn(a, this.g, Bq(this));
                  return a;
                };
                p.Cj = function () {
                  return this.Zf;
                };
                p.ci = function () {
                  var a = Bq(this);
                  Sn(a, this.g, Bq(this));
                  return tn(this.g, Bq(this));
                };
                p.Zh = function () {
                  if (this.h) {
                    var a = this.h.buffered.length;
                    a = a ? this.h.buffered.end(a - 1) : 0;
                    var b = this.getConfiguration().streaming.bufferingGoal;
                    b = Math.min(this.h.currentTime + b, this.Qa().end);
                    if (a >= b) return 1;
                    if (!(a <= this.h.currentTime) && a < b) return (a - this.h.currentTime) / (b - this.h.currentTime);
                  }
                  return 0;
                };
                p.Ji = function () {
                  var a = this.getConfiguration(),
                    b;
                  for (b in this.g) delete this.g[b];
                  Sn(this.g, Bq(this), Bq(this));
                  Pr(this, a);
                };
                p.Kj = function () {
                  return this.m;
                };
                p.ai = function () {
                  return this.i ? this.i.type : null;
                };
                p.Oj = function () {
                  return this.h;
                };
                p.Wb = function () {
                  return this.N;
                };
                p.rd = function () {
                  return this.X;
                };
                p.Yh = function () {
                  return this.C ? this.C : null;
                };
                p.ei = function () {
                  return this.ya ? this.ya : null;
                };
                p.W = function () {
                  return this.i && !this.wa() ? this.i.presentationTimeline.W() : this.h && (this.h.src || this.wa()) ? this.h.duration == Infinity : false;
                };
                p.Vc = function () {
                  return this.i ? this.i.presentationTimeline.Vc() : false;
                };
                p.hk = function () {
                  if (this.i && !this.wa()) {
                    var a = this.i.variants;
                    return a.length ? !a[0].video : false;
                  }
                  return this.h && (this.h.src || this.wa()) ? this.h.videoTracks ? this.h.videoTracks.length == 0 : this.h.videoHeight == 0 : false;
                };
                p.mi = function () {
                  if (this.i && !this.wa()) {
                    var a = this.i.variants;
                    if (!a.length) return false;
                    a = a[0];
                    return a.audio || !a.video ? false : !a.video.codecs.includes(",");
                  }
                  return this.h && (this.h.src || this.wa()) && this.h.audioTracks ? this.h.audioTracks.length == 0 : false;
                };
                p.Qa = function () {
                  if (this.i && !this.wa()) {
                    if (!this.Sa && this.i.type == "HLS") return {
                      start: 0,
                      end: 0
                    };
                    var a = this.i.presentationTimeline;
                    return {
                      start: a.Xb(),
                      end: a.Gb()
                    };
                  }
                  if (this.h && (this.h.src || this.wa()) && (a = this.h.seekable) && a.length) {
                    var b = this.g ? this.g.playRangeStart : 0;
                    b = Math.max(a.start(0), b);
                    var c = this.g ? this.g.playRangeEnd : Infinity;
                    a = Math.min(a.end(a.length - 1), c);
                    return {
                      start: b,
                      end: a
                    };
                  }
                  return {
                    start: 0,
                    end: 0
                  };
                };
                p.ek = function () {
                  this.W() && (this.h.currentTime = this.Qa().end);
                };
                p.ik = function () {
                  return this.Sa;
                };
                p.keySystem = function () {
                  var a = this.drmInfo();
                  return a ? a.keySystem : "";
                };
                p.drmInfo = function () {
                  return this.F ? this.F.g : null;
                };
                p.Wd = function () {
                  return this.F ? this.F.Wd() : Infinity;
                };
                p.Gg = function () {
                  return this.F ? this.F.Gg() : [];
                };
                p.Xe = function () {
                  return this.F ? this.F.Xe() : {};
                };
                p.Ng = function () {
                  return this.R ? this.R.g == li : !!this.X;
                };
                p.Ob = function () {
                  return this.h ? this.M ? this.M.i : 1 : 0;
                };
                p.Fh = function (a) {
                  this.m == lr && this.l && Km(this.l, a);
                };
                p.se = function (a, b) {
                  b = b === void 0 ? true : b;
                  a == 0 ? ab("A trick play rate of 0 is unsupported!") : (this.M.set(a), this.m == lr && (this.o.playbackRateChanged(a), this.Fh(b && a != 1)), mr(this, a));
                };
                p.Pd = function () {
                  var a = this.M.Tc();
                  this.m == pr && this.M.set(a);
                  this.m == lr && (this.M.set(a), this.o.playbackRateChanged(a), this.Fh(false));
                  this.ac.Pa();
                };
                p.mc = function () {
                  if (this.i && !this.wa()) {
                    for (var a = this.l ? this.l.o : null, b = [], c = 0, d = t(this.i.variants), e = d.next(); !e.done; e = d.next()) if (e = e.value, Zf(e)) {
                      var f = Pf(e);
                      f.active = e == a;
                      f.active || c == 1 || a == null || e.video != a.video || e.audio != a.audio || (f.active = true);
                      f.active && c++;
                      b.push(f);
                    }
                    return b;
                  }
                  if (this.h && this.h.audioTracks) {
                    var g = Qr(this);
                    a = Array.from(this.h.audioTracks);
                    return a.length ? a.map(function (h) {
                      return Yf(h, g);
                    }) : g ? [Yf(null, g)] : [];
                  }
                  return [];
                };
                p.Kc = function () {
                  if (this.i) {
                    if (this.wa()) return [];
                    for (var a = this.l ? this.l.B : null, b = [], c = t(this.i.textStreams), d = c.next(); !d.done; d = c.next()) {
                      d = d.value;
                      var e = Qf(d);
                      e.active = d == a;
                      b.push(e);
                    }
                    return b;
                  }
                  return this.h && this.h.src && this.h.textTracks ? Hr(this).map(function (f) {
                    return Xf(f);
                  }) : [];
                };
                p.Hj = function () {
                  var a = this.Ge;
                  this.i && (a = this.i.imageStreams);
                  return a.map(function (b) {
                    return Rf(b);
                  });
                };
                p.vj = function (a) {
                  var b = this,
                    c,
                    d;
                  return P(function (e) {
                    if (e.g == 1) return F(e, Rr(b, a), 2);
                    c = e.h;
                    if (!c) return e.return(null);
                    d = [];
                    c.segmentIndex.Fb(function (f) {
                      var g = Sr(f.tilesLayout || c.tilesLayout);
                      if (g) for (var h = g.rows * g.columns, k = f.j - f.startTime, l = 0; l < h; l++) {
                        var m = Tr(f, c, f.startTime + k * l / h, g);
                        d.push(m);
                      }
                    });
                    c.closeSegmentIndex && c.closeSegmentIndex();
                    return e.return(d);
                  });
                };
                function Sr(a) {
                  return a ? (a = /(\d+)x(\d+)/.exec(a)) ? {
                    columns: parseInt(a[1], 10),
                    rows: parseInt(a[2], 10)
                  } : null : null;
                }
                p.Yj = function (a, b) {
                  var c = this,
                    d,
                    e,
                    f,
                    g,
                    h,
                    k;
                  return P(function (l) {
                    if (l.g == 1) return F(l, Rr(c, a), 2);
                    d = l.h;
                    if (!d) return l.return(null);
                    d.closeSegmentIndex && (c.uc.has(d) || (e = new df(function () {
                      d.closeSegmentIndex();
                      c.uc.delete(d);
                    }), c.uc.set(d, e)), f = c.uc.get(d), f.ia(5));
                    g = d.segmentIndex.find(b);
                    if (g == null) return l.return(null);
                    h = d.segmentIndex.get(g);
                    return (k = Sr(h.tilesLayout || d.tilesLayout)) ? l.return(Tr(h, d, b, k)) : l.return(null);
                  });
                };
                function Rr(a, b) {
                  var c, d;
                  return P(function (e) {
                    if (e.g == 1) {
                      if (a.m != lr && a.m != pr) return e.return(null);
                      c = a.Ge;
                      a.i && (c = a.i.imageStreams);
                      d = c[0];
                      if (!d) return e.return(null);
                      b != null && (d = c.find(function (f) {
                        return f.id == b;
                      }));
                      return d ? d.segmentIndex ? e.A(2) : F(e, d.createSegmentIndex(), 2) : e.return(null);
                    }
                    return e.return(d);
                  });
                }
                function Tr(a, b, c, d) {
                  var e = b.width || 0,
                    f = b.height || 0,
                    g = e / d.columns,
                    h = f / d.rows,
                    k = d.columns * d.rows,
                    l = a.j - a.startTime;
                  l = a.B || l / k;
                  var m = a.startTime,
                    n = 0,
                    q = 0;
                  k > 1 && (q = Math.floor((c - a.startTime) / l), m = a.startTime + q * l, n = q % d.columns * g, q = Math.floor(q / d.columns) * h);
                  d = false;
                  if (c = a.thumbnailSprite) d = true, h = c.height, n = c.positionX, q = c.positionY, g = c.width;
                  return {
                    segment: a,
                    imageHeight: f,
                    imageWidth: e,
                    height: h,
                    positionX: n,
                    positionY: q,
                    startTime: m,
                    duration: l,
                    uris: a.P(),
                    startByte: a.Ic(),
                    endByte: a.Gc(),
                    width: g,
                    sprite: d,
                    mimeType: a.mimeType || b.mimeType,
                    codecs: a.codecs || b.codecs
                  };
                }
                p.kh = function (a) {
                  function b() {
                    var d = c.i.textStreams.find(function (e) {
                      return e.id == a.id;
                    });
                    d && d != c.l.B && (Xn(c.B.h, d, false), Nm(c.l, d), nr(c), Cr(c), c.Fd = d.language);
                  }
                  var c = this;
                  if (this.i && this.G && (b(), !this.wa())) return;
                  (function () {
                    if (c.h && c.h.textTracks) {
                      var d = Hr(c),
                        e = d.find(function (h) {
                          return Vf(h) === a.id;
                        });
                      if (e) {
                        if (c.u instanceof ap) {
                          d = t(d);
                          for (var f = d.next(); !f.done; f = d.next()) {
                            f = f.value;
                            var g = f === e ? c.$ ? "showing" : "hidden" : "disabled";
                            f.mode !== g && (f.mode = g);
                          }
                        } else d = d.find(function (h) {
                          return h.mode !== "disabled";
                        }), d !== e && (d && (d.mode = "disabled", c.j.Ma(d, "cuechange"), c.u.remove(0, Infinity)), e && Kr(c, e));
                        nr(c);
                        Cr(c);
                      }
                    }
                  })();
                };
                function Kr(a, b) {
                  a.j.D(b, "cuechange", function () {
                    a.u.remove(0, Math.max(0, a.h.currentTime - a.g.streaming.bufferBehind));
                    var c = {
                        periodStart: 0,
                        segmentStart: 0,
                        segmentEnd: a.h.duration,
                        vttOffset: 0
                      },
                      d = [],
                      e = Array.from(b.activeCues || []);
                    e = t(e);
                    for (var f = e.next(); !f.done; f = e.next()) {
                      f = f.value;
                      if (f.endTime === Infinity || f.endTime < f.startTime) f = null;else {
                        var g = new Td(f.startTime, f.endTime, f.text);
                        g.line = typeof f.line === "number" ? f.line : null;
                        f.lineAlign && (g.lineAlign = f.lineAlign);
                        g.lineInterpretation = f.snapToLines ? Yd : 1;
                        g.position = typeof f.position === "number" ? f.position : null;
                        f.positionAlign && (g.positionAlign = f.positionAlign);
                        g.size = f.size;
                        g.textAlign = f.align;
                        f.vertical === "lr" ? g.writingMode = "vertical-lr" : f.vertical === "rl" && (g.writingMode = "vertical-rl");
                        f.region && (g.region.id = f.region.id, g.region.height = f.region.lines, g.region.heightUnits = 2, g.region.regionAnchorX = f.region.regionAnchorX, g.region.regionAnchorY = f.region.regionAnchorY, g.region.scroll = f.region.scroll, g.region.viewportAnchorX = f.region.viewportAnchorX, g.region.viewportAnchorY = f.region.viewportAnchorY, g.region.viewportAnchorUnits = Vc, g.region.width = f.region.width, g.region.widthUnits = Vc);
                        ee(g);
                        f = g;
                      }
                      f && ((g = a.g.mediaSource.modifyCueCallback) && g(f, null, c), d.push(f));
                    }
                    a.u.append(d);
                  });
                  b.mode = document.pictureInPictureElement ? "showing" : "hidden";
                }
                p.Ff = function (a, b, c) {
                  function d() {
                    var f = e.i.variants.find(function (h) {
                      return h.id == a.id;
                    });
                    if (f && Zf(f)) {
                      var g = e.l.o;
                      e.g.abr.enabled && (g.video != f.video || g.audio && f.audio && g.audio.language == f.audio.language && g.audio.channelsCount == f.audio.channelsCount && g.audio.label == f.audio.label) && ab("Changing tracks while abr manager is enabled will likely result in the selected track being overridden. Consider disabling abr before calling selectVariantTrack().");
                      e.wa() ? ur(e, f, false, false, 0) : ur(e, f, false, b || false, c || 0);
                      e.J.configure({
                        language: f.language,
                        role: f.audio && f.audio.roles && f.audio.roles[0] || "",
                        videoRole: f.video && f.video.roles && f.video.roles[0] || "",
                        channelCount: f.audio && f.audio.channelsCount ? f.audio.channelsCount : 0,
                        hdrLevel: f.video && f.video.hdr ? f.video.hdr : "",
                        spatialAudio: f.audio && f.audio.spatialAudio ? f.audio.spatialAudio : false,
                        videoLayout: f.video && f.video.videoLayout ? f.video.videoLayout : "",
                        audioLabel: f.audio && f.audio.label ? f.audio.label : "",
                        videoLabel: f.video && f.video.label ? f.video.label : "",
                        codecSwitchingStrategy: e.g.mediaSource.codecSwitchingStrategy,
                        audioCodec: f.audio && f.audio.codecs ? f.audio.codecs : "",
                        activeAudioCodec: g.audio && g.audio.codecs ? g.audio.codecs : "",
                        activeAudioChannelCount: g.audio && g.audio.channelsCount ? g.audio.channelsCount : 0,
                        preferredAudioCodecs: e.g.preferredAudioCodecs,
                        preferredAudioChannelCount: e.g.preferredAudioChannelCount
                      });
                      sr(e);
                    }
                  }
                  var e = this;
                  b = b === void 0 ? false : b;
                  c = c === void 0 ? 0 : c;
                  if (this.i && this.G && (d(), !this.wa())) return;
                  (function () {
                    if (a.originalAudioId && e.h && e.h.audioTracks) {
                      var f = Array.from(e.h.audioTracks);
                      f = t(f);
                      for (var g = f.next(); !g.done; g = f.next()) if (g = g.value, Vf(g) == a.id) {
                        Ur(e, g);
                        break;
                      }
                    }
                  })();
                };
                p.Sk = function (a, b) {
                  function c() {
                    var e = d.J.getConfiguration();
                    e.audioCodec = a.codecs || "";
                    e.audioLabel = a.label || "";
                    e.channelCount = a.channelsCount || 0;
                    e.language = a.language;
                    e.role = a.roles[0] || "";
                    e.spatialAudio = a.spatialAudio;
                    d.J.configure(e);
                    Gq(d, true, b, false, false);
                  }
                  var d = this;
                  b = b === void 0 ? 0 : b;
                  if (this.i && this.G && (c(), !this.wa())) return;
                  (function () {
                    if (d.h && d.h.audioTracks) {
                      var e = lf(a.language),
                        f = Array.from(d.h.audioTracks),
                        g = null;
                      f = t(f);
                      for (var h = f.next(); !h.done; h = f.next()) {
                        h = h.value;
                        var k = h.language || "und";
                        if (h.label == a.label && lf(k) == e && h.kind == a.roles[0]) {
                          g = h;
                          break;
                        }
                      }
                      g && Ur(d, g);
                    }
                  })();
                };
                p.getAudioTracks = function () {
                  if (this.i && !this.wa()) {
                    var a = this.mc();
                    if (!a.length) return [];
                    var b = a.find(function (f) {
                      return f.active;
                    });
                    if (!b) return [];
                    var c = a;
                    this.m != lr || this.wa() || (c = a.filter(function (f) {
                      return f.originalVideoId === b.originalVideoId && (f.audioCodec || Ge.includes(f.audioMimeType || ""));
                    }));
                    if (!c.length) return [];
                    a = new Map();
                    c = t(c);
                    for (var d = c.next(); !d.done; d = c.next()) {
                      d = d.value;
                      var e = d.originalAudioId;
                      e || d.audioId == null || (e = String(d.audioId));
                      !e && d.codecs.includes(",") && d.audioCodec && (e = "muxed-in-video");
                      e && (e += [d.language, d.label, d.channelsCount, d.spatialAudio, d.audioCodec || ""].join("_"), a.set(e, {
                        active: d.active,
                        language: d.language,
                        label: d.label,
                        mimeType: d.audioMimeType,
                        codecs: d.audioCodec,
                        primary: d.primary,
                        roles: d.audioRoles || [],
                        accessibilityPurpose: d.accessibilityPurpose,
                        channelsCount: d.channelsCount,
                        audioSamplingRate: d.audioSamplingRate,
                        spatialAudio: d.spatialAudio,
                        originalLanguage: d.originalLanguage
                      }));
                    }
                    return Array.from(a.values());
                  }
                  return this.h && this.h.audioTracks ? Array.from(this.h.audioTracks).map(function (f) {
                    var g = f.language;
                    g = {
                      active: f.enabled,
                      language: lf(g || "und"),
                      label: f.label,
                      mimeType: null,
                      codecs: null,
                      primary: f.kind == "main",
                      roles: [],
                      accessibilityPurpose: null,
                      channelsCount: null,
                      audioSamplingRate: null,
                      spatialAudio: false,
                      originalLanguage: g
                    };
                    f.kind && g.roles.push(f.kind);
                    f.configuration && (f.configuration.codec && (g.codecs = f.configuration.codec), f.configuration.sampleRate && (g.audioSamplingRate = f.configuration.sampleRate), f.configuration.numberOfChannels && (g.channelsCount = f.configuration.numberOfChannels));
                    return g;
                  }) : [];
                };
                p.Uk = function (a, b, c) {
                  b = b === void 0 ? false : b;
                  c = c === void 0 ? 0 : c;
                  var d = this.mc();
                  if (d.length) {
                    var e = d.find(function (f) {
                      return f.active;
                    });
                    e && (d = d.find(function (f) {
                      return f.audioId === e.audioId && (f.videoBandwidth || f.bandwidth) == a.bandwidth && f.width == a.width && f.height == a.height && f.frameRate == a.frameRate && f.pixelAspectRatio == a.pixelAspectRatio && f.hdr == a.hdr && f.colorGamut == a.colorGamut && f.videoLayout == a.videoLayout && f.videoMimeType == a.mimeType && f.videoCodec == a.codecs && lb(f.videoRoles, a.roles) && f.videoLabel == a.label;
                    })) && !d.active && this.Ff(d, b, c);
                  }
                };
                p.getVideoTracks = function () {
                  if (this.m == pr || this.wa()) return [];
                  var a = this.mc();
                  if (!a.length) return [];
                  var b = a.find(function (f) {
                    return f.active;
                  });
                  if (!b) return [];
                  var c = a;
                  this.mi() || (c = a.filter(function (f) {
                    return f.videoCodec && f.audioGroupId === b.audioGroupId && f.originalAudioId === b.originalAudioId ? f.audioId === b.audioId ? true : f.language === b.language && f.label === b.label && f.channelsCount === b.channelsCount && f.spatialAudio === b.spatialAudio && f.audioMimeType === b.audioMimeType && Ke(f.audioCodec || "") === Ke(b.audioCodec || "") && lb(f.audioRoles, b.audioRoles) : false;
                  }));
                  if (!c.length) return [];
                  a = new Map();
                  c = t(c);
                  for (var d = c.next(); !d.done; d = c.next()) {
                    d = d.value;
                    var e = d.originalVideoId;
                    e || d.videoId == null || (e = String(d.videoId));
                    e && a.set(e, {
                      active: d.active,
                      bandwidth: d.videoBandwidth || d.bandwidth,
                      width: d.width,
                      height: d.height,
                      frameRate: d.frameRate,
                      pixelAspectRatio: d.pixelAspectRatio,
                      hdr: d.hdr,
                      colorGamut: d.colorGamut,
                      videoLayout: d.videoLayout,
                      mimeType: d.videoMimeType,
                      codecs: d.videoCodec,
                      roles: d.videoRoles || [],
                      label: d.videoLabel
                    });
                  }
                  return Array.from(a.values());
                };
                p.xj = function () {
                  return Vr(this.mc());
                };
                p.Wj = function () {
                  return Vr(this.Kc());
                };
                p.wj = function () {
                  return Array.from(Wr(this.mc()));
                };
                p.Vj = function () {
                  return Array.from(Wr(this.Kc()));
                };
                p.Oi = function (a, b, c, d, e, f, g) {
                  function h() {
                    function l(u, v) {
                      return u.video || v.video ? u.video && v.video ? Math.abs((u.video.height || 0) - (v.video.height || 0)) + Math.abs((u.video.width || 0) - (v.video.width || 0)) : Infinity : 0;
                    }
                    var m = k.l.o;
                    k.J = k.g.adaptationSetCriteriaFactory();
                    k.J.configure({
                      language: a,
                      role: b || "",
                      videoRole: m.video && m.video.roles && m.video.roles[0] || "",
                      channelCount: c || 0,
                      hdrLevel: "",
                      spatialAudio: f || false,
                      videoLayout: "",
                      audioLabel: g || "",
                      videoLabel: "",
                      codecSwitchingStrategy: k.g.mediaSource.codecSwitchingStrategy,
                      audioCodec: e || "",
                      activeAudioCodec: m.audio && m.audio.codecs ? m.audio.codecs : "",
                      activeAudioChannelCount: m.audio && m.audio.channelsCount ? m.audio.channelsCount : 0,
                      preferredAudioCodecs: k.g.preferredAudioCodecs,
                      preferredAudioChannelCount: k.g.preferredAudioChannelCount
                    });
                    var n = k.J.create(k.i.variants),
                      q = null;
                    n = t(n.values());
                    for (var r = n.next(); !r.done; r = n.next()) r = r.value, Zf(r) && (!q || l(q, m) > l(r, m)) && (q = r);
                    q != m && (q ? (m = Pf(q), k.Ff(m, true, d || 0)) : Gq(k));
                  }
                  var k = this;
                  c = c === void 0 ? 0 : c;
                  d = d === void 0 ? 0 : d;
                  e = e === void 0 ? "" : e;
                  f = f === void 0 ? false : f;
                  g = g === void 0 ? "" : g;
                  if (this.i && this.G && (h(), !this.wa())) return;
                  (function () {
                    if (k.h && k.h.audioTracks) {
                      var l = eg(k.mc(), a, b || "", false)[0];
                      l && k.Ff(l);
                    }
                  })();
                };
                p.jh = function (a, b, c) {
                  function d() {
                    e.Fd = a;
                    e.Md = b || "";
                    e.Ld = c || false;
                    var f = eg(e.i.textStreams, e.Fd, e.Md, e.Ld)[0] || null;
                    f && f != e.l.B && (Xn(e.B.h, f, false), e.g.streaming.alwaysStreamText || e.Og()) && (Nm(e.l, f), nr(e), Cr(e));
                  }
                  var e = this;
                  c = c === void 0 ? false : c;
                  if (this.i && this.G && (d(), !this.wa())) return;
                  (function () {
                    var f = eg(e.Kc(), a, b || "", c || false)[0];
                    f && e.kh(f);
                  })();
                };
                p.Tk = function (a, b, c) {
                  function d() {
                    for (var f = null, g = t(e.i.variants), h = g.next(); !h.done; h = g.next()) if (h = h.value, h.audio.label == a) {
                      f = h;
                      break;
                    }
                    f != null && (e.J = e.g.adaptationSetCriteriaFactory(), e.J.configure({
                      language: f.language,
                      role: "",
                      videoRole: "",
                      channelCount: 0,
                      hdrLevel: "",
                      spatialAudio: false,
                      videoLayout: "",
                      videoLabel: "",
                      audioLabel: a,
                      codecSwitchingStrategy: e.g.mediaSource.codecSwitchingStrategy,
                      audioCodec: "",
                      activeAudioCodec: "",
                      activeAudioChannelCount: 0,
                      preferredAudioCodecs: e.g.preferredAudioCodecs,
                      preferredAudioChannelCount: e.g.preferredAudioChannelCount
                    }), Gq(e, b, c));
                  }
                  var e = this;
                  b = b === void 0 ? true : b;
                  c = c === void 0 ? 0 : c;
                  if (this.i && this.G && (d(), !this.wa())) return;
                  (function () {
                    if (e.h && e.h.audioTracks) {
                      var f = Array.from(e.h.audioTracks),
                        g = null;
                      f = t(f);
                      for (var h = f.next(); !h.done; h = f.next()) h = h.value, h.label == a && (g = h);
                      g && Ur(e, g);
                    }
                  })();
                };
                p.Og = function () {
                  var a = this.$;
                  return this.u ? this.u.isTextVisible() : a;
                };
                p.Bj = function () {
                  return this.kb.map(function (a) {
                    return Qf(a);
                  });
                };
                p.zj = function (a) {
                  yb("getChapters", "Please use an getChaptersAsync.");
                  if (!this.kb.length) return [];
                  var b = lf(a);
                  a = this.kb.filter(function (f) {
                    return lf(f.language) == b;
                  });
                  if (!a.length) return [];
                  var c = [],
                    d = new Set();
                  a = t(a);
                  for (var e = a.next(); !e.done; e = a.next()) e = e.value, e.segmentIndex && e.segmentIndex.Fb(function (f) {
                    var g = f.P()[0],
                      h = f.startTime + "-" + f.endTime + "-" + g;
                    f = {
                      id: h,
                      title: g,
                      startTime: f.startTime,
                      endTime: f.endTime
                    };
                    d.has(h) || (c.push(f), d.add(h));
                  });
                  return c;
                };
                p.Aj = function (a) {
                  var b = this,
                    c,
                    d,
                    e,
                    f,
                    g,
                    h,
                    k;
                  return P(function (l) {
                    switch (l.g) {
                      case 1:
                        if (!b.kb.length) return l.return([]);
                        c = lf(a);
                        d = b.kb.filter(function (m) {
                          return lf(m.language) == c;
                        });
                        if (!d.length) return l.return([]);
                        e = [];
                        f = new Set();
                        g = t(d);
                        h = g.next();
                      case 2:
                        if (h.done) {
                          l.A(4);
                          break;
                        }
                        k = h.value;
                        if (k.segmentIndex) {
                          l.A(5);
                          break;
                        }
                        return F(l, k.createSegmentIndex(), 5);
                      case 5:
                        k.segmentIndex.Fb(function (m) {
                          var n = m.P()[0],
                            q = m.startTime + "-" + m.endTime + "-" + n;
                          m = {
                            id: q,
                            title: n,
                            startTime: m.startTime,
                            endTime: m.endTime
                          };
                          f.has(q) || (e.push(m), f.add(q));
                        });
                        h = g.next();
                        l.A(2);
                        break;
                      case 4:
                        return l.return(e);
                    }
                  });
                };
                function Hr(a) {
                  return Array.from(a.h.textTracks).filter(function (b) {
                    return b.kind != "metadata" && b.kind != "chapters" && b.label != "Shaka Player TextTrack";
                  });
                }
                function Ir(a) {
                  return Array.from(a.h.textTracks).find(function (b) {
                    return b.label == "Shaka Player TextTrack";
                  });
                }
                function Mr(a) {
                  return Array.from(a.h.textTracks).filter(function (b) {
                    return b.kind == "metadata";
                  });
                }
                p.qh = function (a) {
                  a = !!a;
                  this.$ != a && (this.$ = a, this.m == lr ? (this.u.setTextVisibility(a), this.g.streaming.alwaysStreamText || (a ? this.l.B || (a = eg(this.i.textStreams, this.Fd, this.Md, this.Ld), a.length > 0 && (Nm(this.l, a[0]), nr(this), Cr(this))) : Jm(this.l))) : this.h && this.h.src && this.h.textTracks && this.u.setTextVisibility(a), Br(this));
                };
                p.Pj = function () {
                  if (this.G) var a = this.G.He();else {
                    if (this.O == null) return new Date();
                    if (this.O instanceof Date) return this.O;
                    a = this.O;
                  }
                  if (this.i && !this.wa()) {
                    var b = this.i.presentationTimeline;
                    return new Date(((b.m || b.i) + a) * 1E3);
                  }
                  return this.h && this.h.getStartDate ? (b = this.h.getStartDate(), isNaN(b.getTime()) ? null : new Date(b.getTime() + a * 1E3)) : null;
                };
                p.di = function () {
                  if (this.i && !this.wa()) {
                    var a = this.i.presentationTimeline;
                    a = a.m || a.i;
                    return a === null ? null : new Date(a * 1E3);
                  }
                  return this.h && this.h.getStartDate ? (a = this.h.getStartDate(), isNaN(a.getTime()) ? null : a) : null;
                };
                p.Ze = function () {
                  return this.W() ? this.i ? this.i.presentationTimeline.Ze() : null : null;
                };
                p.Fc = function () {
                  if (this.m == lr) return this.H.Fc();
                  var a = {
                    total: [],
                    audio: [],
                    video: [],
                    text: []
                  };
                  this.m == pr && (a.total = Bj(this.h.buffered));
                  return a;
                };
                function qq(a) {
                  if (!a.h || !a.h.currentTime) return null;
                  var b = a.di();
                  return b ? Math.floor(Date.now() - (b.getTime() + a.h.currentTime * 1E3)) : null;
                }
                p.getBandwidthEstimate = function () {
                  return this.o ? this.o.getBandwidthEstimate() : NaN;
                };
                p.getStats = function () {
                  if (this.m != lr && this.m != pr) return {
                    width: NaN,
                    height: NaN,
                    currentCodecs: "",
                    streamBandwidth: NaN,
                    decodedFrames: NaN,
                    droppedFrames: NaN,
                    corruptedFrames: NaN,
                    stallsDetected: NaN,
                    gapsJumped: NaN,
                    estimatedBandwidth: NaN,
                    completionPercent: NaN,
                    loadLatency: NaN,
                    manifestTimeSeconds: NaN,
                    drmTimeSeconds: NaN,
                    playTime: NaN,
                    pauseTime: NaN,
                    bufferingTime: NaN,
                    licenseTime: NaN,
                    liveLatency: NaN,
                    maxSegmentDuration: NaN,
                    manifestSizeBytes: NaN,
                    bytesDownloaded: NaN,
                    nonFatalErrorCount: NaN,
                    manifestPeriodCount: NaN,
                    manifestGapCount: NaN,
                    switchHistory: [],
                    stateHistory: []
                  };
                  kr(this);
                  var a = this.h,
                    b = a.currentTime / a.duration;
                  isNaN(b) || this.W() || ao(this.B, Math.round(100 * b));
                  this.G && (this.B.T = this.G.Gh(), this.B.V = this.G.Ih());
                  a.getVideoPlaybackQuality && (b = a.getVideoPlaybackQuality(), Zn(this.B, Number(b.droppedVideoFrames), Number(b.totalVideoFrames)), this.B.N = Number(b.corruptedVideoFrames));
                  this.B.o = this.F ? Yh(this.F) : NaN;
                  $n(this.B, a.videoWidth || NaN, a.videoHeight || NaN);
                  this.B.l = "";
                  this.W() && (a = qq(this), a != null && (this.B.F = a / 1E3));
                  b = this.mc().find(function (e) {
                    return e.active;
                  });
                  a = this.Kc().find(function (e) {
                    return e.active;
                  });
                  if (b) {
                    if (b.bandwidth) {
                      var c = this.M ? this.M.i : 1,
                        d = c * b.bandwidth;
                      a && a.bandwidth && (d += c * a.bandwidth);
                      this.B.B = d;
                    }
                    b.width && b.height && $n(this.B, b.width || NaN, b.height || NaN);
                    b = b.codecs;
                    a && (b += "," + (a.codecs || a.mimeType));
                    b && (this.B.l = b);
                  }
                  this.m != lr || this.wa() || (this.i && (this.B.I = this.i.periodCount, this.B.H = this.i.gapCount, this.i.presentationTimeline && (this.B.K = this.i.presentationTimeline.h)), a = this.o.getBandwidthEstimate(), this.B.u = a);
                  this.m == pr && bo(this.B, NaN);
                  return co(this.B);
                };
                p.Od = function (a, b, c, d, e, f, g) {
                  g = g === void 0 ? false : g;
                  var h = this,
                    k,
                    l,
                    m,
                    n,
                    q,
                    r,
                    u,
                    v,
                    w,
                    z,
                    y,
                    B;
                  return P(function (D) {
                    switch (D.g) {
                      case 1:
                        if (h.m != lr && h.m != pr) throw new U(1, 7, 7004);
                        c != "subtitles" && c != "captions" && ab("Using a kind value different of `subtitles` or `captions` can cause unwanted issues.");
                        if (d) {
                          D.A(2);
                          break;
                        }
                        return F(D, Xr(h, a), 3);
                      case 3:
                        d = D.h;
                      case 2:
                        k = [];
                        h.C && (k = h.C.getCuePoints());
                        if (h.m != pr) {
                          D.A(4);
                          break;
                        }
                        l = tb();
                        g && l.Ha() === "WEBKIT" && (c = "forced");
                        return F(D, Yr(h, a, b, c, d, f || "", k), 5);
                      case 5:
                        m = D.h;
                        if (m.track) return or(h), nr(h), D.return(Xf(m.track));
                        throw new U(1, 2, 2012);
                      case 4:
                        n = Cc;
                        q = h.Qa();
                        r = q.end - q.start;
                        h.i && (r = h.i.presentationTimeline.getDuration());
                        if (r == Infinity) throw new U(1, 4, 4033);
                        if (!k.length) {
                          D.A(6);
                          break;
                        }
                        return F(D, Zr(h, a), 7);
                      case 7:
                        u = D.h, v = $r(h, u, d, k), w = new Blob([v], {
                          type: "text/vtt"
                        }), a = qk(w), d = "text/vtt";
                      case 6:
                        z = {
                          id: h.Be++,
                          originalId: null,
                          groupId: null,
                          createSegmentIndex: function createSegmentIndex() {
                            return Promise.resolve();
                          },
                          segmentIndex: Pl(0, r, [a]),
                          mimeType: d || "",
                          codecs: e || "",
                          kind: c,
                          encrypted: false,
                          drmInfos: [],
                          keyIds: new Set(),
                          language: b,
                          originalLanguage: b,
                          label: f || null,
                          type: n.Na,
                          primary: false,
                          trickModeVideo: null,
                          dependencyStream: null,
                          emsgSchemeIdUris: null,
                          roles: [],
                          forced: !!g,
                          channelsCount: null,
                          audioSamplingRate: null,
                          spatialAudio: false,
                          closedCaptions: null,
                          accessibilityPurpose: null,
                          external: true,
                          fastSwitching: false,
                          fullMimeTypes: new Set([Fe(d || "", e || "")]),
                          isAudioMuxedInVideo: false,
                          baseOriginalId: null
                        };
                        y = Fe(z.mimeType, z.codecs);
                        B = Ve(y);
                        if (!B) throw new U(2, 2, 2014, d);
                        h.i.textStreams.push(z);
                        or(h);
                        nr(h);
                        return D.return(Qf(z));
                    }
                  });
                };
                p.Me = function (a, b) {
                  var c = this,
                    d,
                    e,
                    f,
                    g,
                    h,
                    k,
                    l,
                    m,
                    n,
                    q,
                    r,
                    u,
                    v,
                    w,
                    z,
                    y,
                    B,
                    D;
                  return P(function (I) {
                    switch (I.g) {
                      case 1:
                        if (c.m != lr && c.m != pr) throw new U(1, 7, 7004);
                        if (b) {
                          I.A(2);
                          break;
                        }
                        return F(I, Xr(c, a), 3);
                      case 3:
                        b = I.h;
                      case 2:
                        if (b != "text/vtt") throw new U(1, 2, 2017, a);
                        d = Cc;
                        e = c.Qa();
                        f = e.end - e.start;
                        c.i && (f = c.i.presentationTimeline.getDuration());
                        if (f == Infinity) throw new U(1, 4, 4045);
                        return F(I, Zr(c, a), 4);
                      case 4:
                        g = I.h;
                        h = Ue(b);
                        if (!h) throw new U(2, 2, 2014, b);
                        k = h();
                        l = {
                          periodStart: 0,
                          segmentStart: 0,
                          segmentEnd: f,
                          vttOffset: 0
                        };
                        m = Vb(g);
                        n = k.parseMedia(m, l, a, []);
                        q = [];
                        r = t(n);
                        u = r.next();
                        for (v = {}; !u.done; v = {
                          Sf: void 0,
                          nd: void 0
                        }, u = r.next()) v.nd = u.value, v.Sf = null, w = function (C) {
                          return function () {
                            C.Sf == null && (C.Sf = uc([a], [C.nd.payload]));
                            return C.Sf || [];
                          };
                        }(v), z = new rj(v.nd.startTime, v.nd.endTime, w, 0, null, null, 0, 0, Infinity), v.nd.payload.includes("#xywh") && (y = v.nd.payload.split("#xywh=")[1].split(","), y.length === 4 && z.If({
                          height: parseInt(y[3], 10),
                          positionX: parseInt(y[0], 10),
                          positionY: parseInt(y[1], 10),
                          width: parseInt(y[2], 10)
                        })), q.push(z);
                        B = b;
                        if (!q.length) {
                          I.A(5);
                          break;
                        }
                        return F(I, Xr(c, q[0].P()[0]), 6);
                      case 6:
                        B = I.h;
                      case 5:
                        return D = {
                          id: c.Be++,
                          originalId: null,
                          groupId: null,
                          createSegmentIndex: function createSegmentIndex() {
                            return Promise.resolve();
                          },
                          segmentIndex: new Nl(q),
                          mimeType: B || "",
                          codecs: "",
                          kind: "",
                          encrypted: false,
                          drmInfos: [],
                          keyIds: new Set(),
                          language: "und",
                          originalLanguage: null,
                          label: null,
                          type: d.Uf,
                          primary: false,
                          trickModeVideo: null,
                          dependencyStream: null,
                          emsgSchemeIdUris: null,
                          roles: [],
                          forced: false,
                          channelsCount: null,
                          audioSamplingRate: null,
                          spatialAudio: false,
                          closedCaptions: null,
                          tilesLayout: "1x1",
                          accessibilityPurpose: null,
                          external: true,
                          fastSwitching: false,
                          fullMimeTypes: new Set([Fe(B || "", "")]),
                          isAudioMuxedInVideo: false,
                          baseOriginalId: null
                        }, c.m == pr ? c.Ge.push(D) : c.i.imageStreams.push(D), or(c), I.return(Rf(D));
                    }
                  });
                };
                p.Le = function (a, b, c) {
                  var d = this,
                    e,
                    f,
                    g,
                    h,
                    k,
                    l,
                    m,
                    n,
                    q,
                    r,
                    u,
                    v,
                    w,
                    z,
                    y;
                  return P(function (B) {
                    switch (B.g) {
                      case 1:
                        if (d.m != lr && d.m != pr) throw new U(1, 7, 7004);
                        if (c) {
                          B.A(2);
                          break;
                        }
                        return F(B, Xr(d, a), 3);
                      case 3:
                        c = B.h;
                      case 2:
                        e = Cc;
                        f = d.Qa();
                        g = f.end - f.start;
                        d.i && (g = d.i.presentationTimeline.getDuration());
                        if (g == Infinity) throw new U(1, 4, 4055);
                        h = Ue(c);
                        if (!h) throw new U(2, 2, 2014, c);
                        return F(B, Zr(d, a), 4);
                      case 4:
                        k = B.h;
                        l = h();
                        m = {
                          periodStart: 0,
                          segmentStart: 0,
                          segmentEnd: g,
                          vttOffset: 0
                        };
                        n = Vb(k);
                        q = l.parseMedia(n, m, a, []);
                        r = [];
                        u = t(q);
                        v = u.next();
                        for (w = {}; !v.done; w = {
                          Ue: void 0
                        }, v = u.next()) w.Ue = v.value, z = new rj(w.Ue.startTime, w.Ue.endTime, function (D) {
                          return function () {
                            return [D.Ue.payload];
                          };
                        }(w), 0, null, null, 0, 0, Infinity), r.push(z);
                        y = {
                          id: d.Be++,
                          originalId: null,
                          groupId: null,
                          createSegmentIndex: function createSegmentIndex() {
                            return Promise.resolve();
                          },
                          segmentIndex: new Nl(r),
                          mimeType: "text/plain",
                          codecs: "",
                          kind: "",
                          encrypted: false,
                          drmInfos: [],
                          keyIds: new Set(),
                          language: b,
                          originalLanguage: b,
                          label: null,
                          type: e.Na,
                          primary: false,
                          trickModeVideo: null,
                          dependencyStream: null,
                          emsgSchemeIdUris: null,
                          roles: [],
                          forced: false,
                          channelsCount: null,
                          audioSamplingRate: null,
                          spatialAudio: false,
                          closedCaptions: null,
                          accessibilityPurpose: null,
                          external: true,
                          fastSwitching: false,
                          fullMimeTypes: new Set([Fe("text/plain", "")]),
                          isAudioMuxedInVideo: false,
                          baseOriginalId: null
                        };
                        d.kb.push(y);
                        or(d);
                        return B.return(Qf(y));
                    }
                  });
                };
                function Xr(a, b) {
                  var c;
                  return P(function (d) {
                    switch (d.g) {
                      case 1:
                        return ua(d, 2), F(d, No(b, a.N, a.g.streaming.retryParameters), 4);
                      case 4:
                        c = d.h;
                        xa(d, 3);
                        break;
                      case 2:
                        ya(d);
                      case 3:
                        if (c) return d.return(c);
                        throw new U(1, 2, 2011, b);
                    }
                  });
                }
                function Yr(a, b, c, d, e, f, g) {
                  var h, k, l, m;
                  return P(function (n) {
                    if (n.g == 1) return e != "text/vtt" || g.length ? F(n, Zr(a, b), 3) : n.A(2);
                    n.g != 2 && (h = n.h, k = $r(a, h, e, g), l = new Blob([k], {
                      type: "text/vtt"
                    }), b = qk(l), e = "text/vtt");
                    m = document.createElement("track");
                    a: {
                      var q = a.K,
                        r = b;
                      try {
                        if (!q.g.enabled) {
                          var u = r;
                          break a;
                        }
                        var v = Dp(q);
                        v.ot = jq;
                        v.su = !0;
                        var w = Hp(v);
                        u = Ip(r, w);
                        break a;
                      } catch (z) {
                        cb("CMCD_TEXT_TRACK_ERROR", "Could not generate text track CMCD data.", z);
                        u = r;
                        break a;
                      }
                      u = void 0;
                    }
                    m.src = u;
                    m.label = f;
                    m.kind = d;
                    m.srclang = c;
                    a.h.getAttribute("crossorigin") || a.h.setAttribute("crossorigin", "anonymous");
                    a.h.appendChild(m);
                    a.Yf.push(m);
                    return n.return(m);
                  });
                }
                function Zr(a, b) {
                  var c, d, e, f;
                  return P(function (g) {
                    if (g.g == 1) {
                      c = Xg;
                      d = a.g.streaming.retryParameters;
                      e = Rg([b], d);
                      e.method = "GET";
                      var h = a.K;
                      try {
                        h.g.enabled && Zp(h, e, {
                          ot: jq,
                          su: !0
                        });
                      } catch (k) {
                        cb("CMCD_TEXT_ERROR", "Could not generate text CMCD data.", k);
                      }
                      return F(g, a.N.request(c, e).promise, 2);
                    }
                    f = g.h;
                    return g.return(f.data);
                  });
                }
                function $r(a, b, c, d) {
                  var e = Ue(c);
                  if (e) return c = e(), a = {
                    periodStart: 0,
                    segmentStart: 0,
                    segmentEnd: a.h.duration,
                    vttOffset: 0
                  }, b = Vb(b), b = c.parseMedia(b, a, null, []), pp(b, d);
                  throw new U(2, 2, 2014, c);
                }
                p.Zk = function (a, b) {
                  this.va.width = a;
                  this.va.height = b;
                };
                p.fh = function (a) {
                  if (this.m == lr) {
                    var b = this.l;
                    a = a === void 0 ? .1 : a;
                    if (b.l.g) b = false;else if (b.F) b = false;else {
                      for (var c = t(b.h.values()), d = c.next(); !d.done; d = c.next()) d = d.value, !d.Zd || d.Ja || d.qb || (d.Zd = false, Im(b, d, a));
                      b = true;
                    }
                  } else b = false;
                  return b;
                };
                p.Hg = function () {
                  ab("Shaka Player's internal Manifest structure is NOT covered by semantic versioning compatibility guarantees.  It may change at any time!  Please consider filing a feature request for whatever you use getManifest() for.");
                  return this.i;
                };
                p.Lj = function () {
                  return this.xc;
                };
                p.Fj = function () {
                  var a = {
                    video: null,
                    audio: null,
                    text: null
                  };
                  if (this.m != lr) return a;
                  var b = this.l.o,
                    c = this.h.currentTime;
                  b = t([b.video, b.audio, this.l.B]);
                  for (var d = b.next(); !d.done; d = b.next()) if ((d = d.value) && d.segmentIndex) {
                    var e = d.segmentIndex.find(c);
                    e = d.segmentIndex.get(e);
                    e = {
                      codecs: e.codecs || d.codecs,
                      mimeType: e.mimeType || d.mimeType,
                      bandwidth: e.bandwidth || d.bandwidth
                    };
                    d.type == "video" ? (e.width = d.width, e.height = d.height, a.video = e) : d.type == "audio" ? a.audio = e : d.type == Ac && (a.text = e);
                  }
                  return a;
                };
                function Bq(a) {
                  var b = Nn();
                  b.streaming.failureCallback = function (c) {
                    if (a.W()) {
                      var d = null;
                      c.code == 1001 || c.code == 1002 ? (d = 1, a.g.streaming.lowLatencyMode && (d = .1)) : c.code == 1003 && (d = .1);
                      d != null && (c.severity = 1, a.fh(d));
                    }
                  };
                  b.textDisplayFactory = function () {
                    if (a.xe) {
                      var c = a.h;
                      c = c.webkitDisplayingFullscreen || c.webkitPresentationMode && c.webkitPresentationMode != "inline" ? false : true;
                    } else c = false;
                    return c ? new fp(a.h, a.xe) : "track" in document.createElement("track") ? new ap(a) : new ep();
                  };
                  return b;
                }
                p.Ui = function (a) {
                  this.xe = a;
                };
                function cr(a, b) {
                  for (var c = new Set(), d = t(b.textStreams), e = d.next(); !e.done; e = d.next()) e = e.value, e.mimeType != "application/cea-608" && e.mimeType != "application/cea-708" || c.add(e.originalId);
                  d = t(b.variants);
                  for (e = d.next(); !e.done; e = d.next()) if ((e = e.value.video) && e.closedCaptions) for (var f = t(e.closedCaptions.keys()), g = f.next(); !g.done; g = f.next()) if (g = g.value, !c.has(g)) {
                    var h = g.startsWith("CC") ? "application/cea-608" : "application/cea-708",
                      k = new Ql(),
                      l = e.closedCaptions.get(g);
                    h = {
                      id: a.Be++,
                      originalId: g,
                      groupId: null,
                      createSegmentIndex: function createSegmentIndex() {
                        return Promise.resolve();
                      },
                      segmentIndex: k,
                      mimeType: h,
                      codecs: "",
                      kind: "caption",
                      encrypted: false,
                      drmInfos: [],
                      keyIds: new Set(),
                      language: l,
                      originalLanguage: l,
                      label: null,
                      type: Ac,
                      primary: false,
                      trickModeVideo: null,
                      dependencyStream: null,
                      emsgSchemeIdUris: null,
                      roles: e.roles,
                      forced: false,
                      channelsCount: null,
                      audioSamplingRate: null,
                      spatialAudio: false,
                      closedCaptions: null,
                      accessibilityPurpose: null,
                      external: false,
                      fastSwitching: false,
                      fullMimeTypes: new Set([Fe(h, "")]),
                      isAudioMuxedInVideo: false,
                      baseOriginalId: null
                    };
                    b.textStreams.push(h);
                    c.add(g);
                  }
                }
                function Ar(a, b) {
                  var c, d, e, f, g;
                  return P(function (h) {
                    if (h.g == 1) return c = a.audio, d = a.video, e = function e(k, l) {
                      var m, n, q;
                      return P(function (r) {
                        if (r.g == 1) return k ? k.segmentIndex ? r.A(2) : F(r, k.createSegmentIndex(), 2) : r.return(null);
                        n = (m = k.segmentIndex.Vb(l)) ? m.next().value : null;
                        if (!n) return r.return(null);
                        q = n.startTime;
                        return r.return(q);
                      });
                    }, F(h, e(c, b), 2);
                    if (h.g != 3) return f = h.h, F(h, e(d, b), 3);
                    g = h.h;
                    return g != null && f != null ? h.return(Math.max(g, f)) : g != null ? h.return(g) : f != null ? h.return(f) : h.return(b);
                  });
                }
                function Sq(a) {
                  var b = a.Ng();
                  if (a.B && a.R && a.G) {
                    if (a.g.streaming.rebufferingGoal == 0) {
                      var c = a.M;
                      c.j = false;
                      Ul(c);
                    } else c = a.M, c.j = b, Ul(c);
                    a.K && (c = a.K, b || c.F || (c.F = true), c.F && b && (c.I = true, Bp(c, "ps", {
                      dd: "r"
                    })), c.J = b);
                    kr(a);
                    c = a.g.streaming.liveSync.dynamicTargetLatency.maxAttempts;
                    if (a.g.streaming.liveSync.dynamicTargetLatency.enabled && b && a.Ke < c) {
                      c = a.g.streaming.liveSync.dynamicTargetLatency.maxLatency;
                      var d = a.g.streaming.liveSync.targetLatencyTolerance,
                        e = a.g.streaming.liveSync.dynamicTargetLatency.rebufferIncrement;
                      a.V && (a.V = Math.min(a.V + ++a.Ke * e, c - d));
                    }
                  }
                  b = new Map().set("buffering", b);
                  a.dispatchEvent(Jq("buffering", b));
                }
                function mr(a, b) {
                  a.ac.Pa();
                  a.ac.D(a.h, "timeupdate", function () {
                    var c = a.h.currentTime,
                      d = a.Qa(),
                      e = a.W(),
                      f = e ? a.g.streaming.safeSeekOffset : 0;
                    b > 0 ? (!e || b >= 1) && Math.floor(c) >= Math.floor(d.end) && a.Pd() : Math.floor(c) <= Math.floor(d.start + f) && a.Pd();
                  });
                }
                function kr(a) {
                  if (a.B && a.R) {
                    var b = a.B.g,
                      c = "playing";
                    a.R.g == li ? c = "buffering" : a.be() ? c = "ended" : a.h.paused && (c = "paused");
                    var d = c;
                    if (b.g == null) b.g = {
                      timestamp: Date.now() / 1E3,
                      state: d,
                      duration: 0
                    }, b = true;else {
                      var e = Date.now() / 1E3;
                      b.g.duration = e - b.g.timestamp;
                      b.g.state == d ? b = false : (b.h.push(b.g), b.g = {
                        timestamp: e,
                        state: d,
                        duration: 0
                      }, b = true);
                    }
                    b && (c = new Map().set("newstate", c), a.dispatchEvent(Jq("statechanged", c)));
                  }
                }
                function Er(a) {
                  var b = a.h.playbackRate,
                    c = a.W();
                  if (a.g.streaming.vodDynamicPlaybackRate && !c) {
                    var d = a.g.streaming.vodDynamicPlaybackRateLowBufferRate,
                      e = a.Zh();
                    e <= a.g.streaming.vodDynamicPlaybackRateBufferRatio ? b != d && a.se(d, false) : e == 1 && b !== a.M.Tc() && a.Pd();
                  }
                  if (c && (c = a.Qa(), Number.isFinite(c.end) && !(a.h.currentTime < c.start || a.h.paused))) {
                    d = a.g.streaming.liveSync.targetLatencyTolerance;
                    e = a.g.streaming.liveSync.dynamicTargetLatency.enabled;
                    var f = a.g.streaming.liveSync.dynamicTargetLatency.stabilityThreshold;
                    if (a.g.streaming.liveSync && a.g.streaming.liveSync.enabled) {
                      var g = a.g.streaming.liveSync.targetLatency;
                      var h = g + d;
                      var k = Math.max(0, g - d);
                      var l = a.g.streaming.liveSync.maxPlaybackRate;
                      var m = a.g.streaming.liveSync.minPlaybackRate;
                    } else a.i && a.i.serviceDescription && (g = a.i.serviceDescription.targetLatency, a.i.serviceDescription.targetLatency != null ? h = a.i.serviceDescription.targetLatency + d : a.i.serviceDescription.maxLatency != null && (h = a.i.serviceDescription.maxLatency), a.i.serviceDescription.targetLatency != null ? k = Math.max(0, a.i.serviceDescription.targetLatency - d) : a.i.serviceDescription.minLatency != null && (k = a.i.serviceDescription.minLatency), l = a.i.serviceDescription.maxPlaybackRate || a.g.streaming.liveSync.maxPlaybackRate, m = a.i.serviceDescription.minPlaybackRate || a.g.streaming.liveSync.minPlaybackRate);
                    a.V || typeof g !== "number" || (a.V = g);
                    var n = a.g.streaming.liveSync.dynamicTargetLatency.maxAttempts;
                    e && a.Zb && a.V !== null && typeof g === "number" && a.Ke < n && Date.now() - a.Zb > f * 1E3 && (f = a.g.streaming.liveSync.dynamicTargetLatency.minLatency, a.V = Math.max(a.V - (g - f) / 2, f + d), a.Zb = Date.now());
                    e && a.V !== null && (h = a.V + d, k = a.V - d);
                    g = c.end - a.h.currentTime;
                    d = 0;
                    a.m == pr && (e = a.h.buffered, e.length > 0 && (d = e.end(e.length - 1), d = Math.max(l, d - c.end)));
                    c = a.g.streaming.liveSync.panicMode;
                    e = a.g.streaming.liveSync.panicThreshold * 1E3;
                    f = Date.now() - a.R.h;
                    c && !m && (m = a.g.streaming.liveSync.minPlaybackRate);
                    c && m && f <= e ? b != m && a.se(m, false) : h != void 0 && l && g - d > h ? (b != l && a.se(l, false), a.Zb = null) : k != void 0 && m && g - d < k ? (b != m && a.se(m, false), a.Zb = null) : b !== a.M.Tc() && (a.Pd(), a.Zb = Date.now());
                  }
                }
                function Fr(a) {
                  if (a.h) {
                    var b = function b(e, f) {
                        var g = g === void 0 ? Number.EPSILON : g;
                        if (e === f) g = true;else {
                          var h = Math.abs(e - f);
                          g = h <= g ? true : g !== Number.EPSILON ? Math.abs(h - g) <= Number.EPSILON : false;
                        }
                        return (g || f > e) && a.Xf < e ? (a.Xf = e, true) : false;
                      },
                      c = a.Qa();
                    c = c.end - c.start;
                    c = c > 0 ? a.h.currentTime / c : 0;
                    if (!isNaN(c)) {
                      c *= 100;
                      if (b(0, c)) var d = Jq("started");else if (b(25, c)) d = Jq("firstquartile");else if (b(50, c)) d = Jq("midpoint");else if (b(75, c)) d = Jq("thirdquartile");else {
                        if (b(100, c) || c > 100) d = Jq("complete");
                        a.g && a.g.playRangeEnd != Infinity && a.be() && a.h.pause();
                      }
                      d && a.dispatchEvent(d);
                    }
                  }
                }
                function sr(a) {
                  try {
                    si(a.Ae, a.i);
                  } catch (c) {
                    return Qq(a, c), false;
                  }
                  var b = dg(a.i.variants);
                  b = a.J.create(b);
                  a = a.o.setVariants(Array.from(b.values()));
                  return typeof a == "boolean" ? a : true;
                }
                function wr(a, b) {
                  b = b === void 0 ? false : b;
                  if (sr(a)) {
                    if (!a.g.abr.enabled) {
                      var c = a.J;
                      typeof c.getLastAdaptationSet != "function" && (yb("AdaptationSetCriteria w/o getLastAdaptationSet", "Please use an AdaptationSetCriteria with getLastAdaptationSet."), c.getLastAdaptationSet = function () {
                        return null;
                      });
                      if (c = c.getLastAdaptationSet()) if (c = Array.from(c.values()), c.length) {
                        var d = a.l.o;
                        if (d && d.video && (c = c.find(function (e) {
                          return e.video == d.video;
                        }))) return c;
                      }
                    }
                    return a.o.chooseVariant(b);
                  }
                  return null;
                }
                function Gq(a, b, c, d, e) {
                  b = b === void 0 ? true : b;
                  c = c === void 0 ? 0 : c;
                  d = d === void 0 ? false : d;
                  e = e === void 0 ? true : e;
                  var f = wr(a);
                  f && ur(a, f, e, b, c, d);
                }
                function ur(a, b, c, d, e, f) {
                  f = f === void 0 ? false : f;
                  var g = a.l.o;
                  if (b == g) d && Mm(a.l, b, d, e, true);else {
                    var h = a.B.h;
                    h.h != b && (h.h = b, h.g.push({
                      timestamp: Date.now() / 1E3,
                      id: b.id,
                      type: "variant",
                      fromAdaptation: c,
                      bandwidth: b.bandwidth
                    }));
                    Mm(a.l, b, d, e, f, c);
                    d = null;
                    g && (d = Pf(g));
                    g = Pf(b);
                    g.active = true;
                    if (a.T && (e = a.T, b = b.video)) {
                      b.dependencyStream && (b = b.dependencyStream);
                      f = 0;
                      h = -1;
                      switch (b.mimeType) {
                        case "video/webm":
                          f = 1;
                          break;
                        case "video/mp4":
                          f = 2;
                      }
                      switch (a.ai()) {
                        case "DASH":
                          h = 1;
                          break;
                        case "HLS":
                          h = 0;
                      }
                      e.g && (e.g.setLevelSwitching(b.id, true), e.g.setContainerFormat(f), e.j || e.g.setStreamingFormat(h));
                    }
                    c ? (c = new Map().set("oldTrack", d).set("newTrack", g), c = Jq("adaptation", c), as(a, c)) : bs(a, d, g);
                    cs(a, d, g);
                  }
                }
                function Ur(a, b) {
                  var c = Array.from(a.h.audioTracks).find(function (e) {
                    return e.enabled;
                  });
                  b.enabled = true;
                  if (c) {
                    b.id !== c.id && (c.enabled = false);
                    var d = Qr(a);
                    c = Yf(c, d);
                    b = Yf(b, d);
                    bs(a, c, b);
                    cs(a, c, b);
                  }
                }
                function Qr(a) {
                  return a.h && a.h.videoTracks ? Array.from(a.h.videoTracks).find(function (b) {
                    return b.selected;
                  }) : null;
                }
                function or(a) {
                  var b = Jq("trackschanged");
                  as(a, b);
                  ds(a);
                }
                function bs(a, b, c) {
                  b = new Map().set("oldTrack", b).set("newTrack", c);
                  b = Jq("variantchanged", b);
                  as(a, b);
                }
                function cs(a, b, c) {
                  var d = false;
                  b && b.audioId == c.audioId && b.audioGroupId == c.audioGroupId || (d = true);
                  d && ds(a);
                }
                function ds(a) {
                  var b = Jq("audiotrackschanged");
                  as(a, b);
                }
                function nr(a) {
                  var b = Jq("textchanged");
                  as(a, b);
                }
                function Br(a) {
                  var b = Jq("texttrackvisibility");
                  as(a, b);
                }
                function Dr(a) {
                  a.g.abr.enabled || Fq(a);
                  var b = new Map().set("newStatus", a.g.abr.enabled);
                  as(a, Jq("abrstatuschanged", b));
                }
                function Cr(a) {
                  var b = a.Kc().find(function (c) {
                    return c.active;
                  });
                  b && a.u && a.u.setTextLanguage && a.u.setTextLanguage(b.language);
                }
                function Fq(a, b) {
                  b = b === void 0 ? true : b;
                  if (a.m == lr) {
                    a.De.stop();
                    for (var c = t(a.i.variants), d = c.next(); !d.done; d = c.next()) d.value.disabledUntilTime = 0;
                    b && sr(a);
                  }
                }
                p.disableStream = function (a, b) {
                  if (!this.g.abr.enabled || this.m === Kq || !navigator.onLine || b == 0 || !this.i) return false;
                  if (this.i.variants.some(function (h) {
                    var k = h[a.type];
                    return k && k.id !== a.id && !h.disabledUntilTime ? a.type == "audio" ? a.language === k.language : true : false;
                  })) {
                    for (var c = false, d = false, e = t(this.i.variants), f = e.next(); !f.done; f = e.next()) {
                      f = f.value;
                      var g = f[a.type];
                      g && (g.id === a.id ? (f.disabledUntilTime = Date.now() / 1E3 + b, c = true) : g.trickModeVideo && g.trickModeVideo.id == a.id && (d = true));
                    }
                    if (!c && d) return false;
                    this.De.Ea(1);
                    b = this.Fc().video.reduce(function (h, k) {
                      return h + k.end - k.start;
                    }, 0);
                    Gq(this, false, b, true, false);
                    return true;
                  }
                  return false;
                };
                function Qq(a, b) {
                  var c, d, e, f, g;
                  return P(function (h) {
                    switch (h.g) {
                      case 1:
                        if (a.m == Kq) return h.return();
                        b.severity === 1 && a.B.M++;
                        c = true;
                        if (!(a.Sa && a.i && a.l) || b.code != 3016 && b.code != 3014 && b.code != 3015 && b.code != 3024 && b.code != 3018) {
                          h.A(2);
                          break;
                        }
                        d = tb();
                        if (d.Ha() === "WEBKIT" && b.code == 3016) return h.return();
                        ua(h, 3);
                        return F(h, bn(a.l), 5);
                      case 5:
                        e = h.h;
                        c = !e;
                        e && (f = Jq("mediasourcerecovered"), a.dispatchEvent(f));
                        xa(h, 2);
                        break;
                      case 3:
                        ya(h), c = true;
                      case 2:
                        if (!c) return h.return();
                        b.severity === 2 && Fq(a, false);
                        g = Jq("error", new Map().set("detail", b));
                        a.dispatchEvent(g);
                        g.defaultPrevented && (b.handled = true);
                        G(h);
                    }
                  });
                }
                p.addFont = function (a, b) {
                  return Jj(a, b);
                };
                function er(a, b, c, d) {
                  d = d === void 0 ? a : d;
                  a = new Map().set("detail", {
                    schemeIdUri: c.schemeIdUri,
                    value: c.value,
                    startTime: c.startTime,
                    endTime: c.endTime,
                    id: c.id,
                    timescale: c.timescale,
                    eventElement: c.eventElement,
                    eventNode: c.eventNode
                  });
                  d.dispatchEvent(Jq(b, a));
                }
                function fr(a, b, c, d) {
                  d = d === void 0 ? false : d;
                  b = new Map().set("mediaQuality", {
                    bandwidth: b.bandwidth,
                    audioSamplingRate: b.audioSamplingRate,
                    codecs: b.codecs,
                    contentType: b.contentType,
                    frameRate: b.frameRate,
                    height: b.height,
                    mimeType: b.mimeType,
                    channelsCount: b.channelsCount,
                    pixelAspectRatio: b.pixelAspectRatio,
                    width: b.width,
                    label: b.label,
                    roles: b.roles,
                    language: b.language
                  }).set("position", c);
                  a.dispatchEvent(Jq(d ? "audiotrackchanged" : "mediaqualitychanged", b));
                }
                function Pq(a, b) {
                  b = b === void 0 ? true : b;
                  if (!a.h.error) return b ? new U(2, 3, 3016) : null;
                  var c = a.h.error.code;
                  if (!b && c == 1) return null;
                  if (b = a.h.error.msExtendedCode) b < 0 && (b += 4294967296), b = b.toString(16);
                  return new U(2, 3, 3016, c, b, a.h.error.message);
                }
                function gr(a, b) {
                  var c = Jq("keystatuschanged");
                  a.dispatchEvent(c);
                  var d = Object.keys(b);
                  d.length == 1 && d[0] == "" && (d = ["00"], b = {
                    "00": b[""]
                  });
                  var e = d.length == 1 && d[0] == "00";
                  c = false;
                  if (d.length) {
                    d = a.keySystem();
                    for (var f = ch(a.g.drm.clearKeys), g = function g(u, v) {
                        u.allowedByKeySystem = true;
                        v = t(v);
                        for (var w = v.next(); !w.done; w = v.next()) if (w = w.value, (w = b[e ? "00" : w]) || a.F.H) u.allowedByKeySystem = u.allowedByKeySystem && !!w && !ti.includes(w);
                      }, h = t(a.i.variants), k = h.next(); !k.done; k = h.next()) {
                      k = k.value;
                      var l = gg(k);
                      l = t(l);
                      for (var m = l.next(); !m.done; m = l.next()) {
                        m = m.value;
                        var n = k.allowedByKeySystem;
                        if (m.keyIds.size) if (m.drmInfos.length && !f.size && a.i.type == "HLS") for (var q = t(m.drmInfos), r = q.next(); !r.done; r = q.next()) r = r.value, r.keySystem == d && (r.keyIds.size ? g(k, r.keyIds) : g(k, m.keyIds));else g(k, m.keyIds);
                        n != k.allowedByKeySystem && (c = true);
                      }
                    }
                  }
                  if (c && (or(a), !sr(a))) return;
                  (c = a.l.o) && !c.allowedByKeySystem && Gq(a);
                }
                function tr(a, b, c) {
                  b > 0 && (a.W() || a.Ti(b));
                  b = a.getDuration();
                  c < b && (a.W() || a.Ab(c));
                }
                function as(a, b) {
                  P(function (c) {
                    if (c.g == 1) return F(c, Promise.resolve(), 2);
                    a.m != Kq && a.dispatchEvent(b);
                    G(c);
                  });
                }
                function Wr(a) {
                  var b = new Set();
                  a = t(a);
                  for (var c = a.next(); !c.done; c = a.next()) c = c.value, c.language ? b.add(lf(c.language)) : b.add("und");
                  return b;
                }
                function Vr(a) {
                  for (var b = new Map(), c = new Map(), d = 0; d < a.length; d++) {
                    var e = a[d],
                      f = "und",
                      g = [];
                    e.language && (f = lf(e.language));
                    e.type == "variant" ? g = e.audioRoles : g = e.roles;
                    g && g.length || (g = [""]);
                    b.has(f) || b.set(f, new Set());
                    g = t(g);
                    for (var h = g.next(); !h.done; h = g.next()) h = h.value, b.get(f).add(h), e.label && (c.has(f) || c.set(f, new Map()), c.get(f).set(h, e.label));
                  }
                  var k = [];
                  b.forEach(function (l, m) {
                    l = t(l);
                    for (var n = l.next(); !n.done; n = l.next()) {
                      n = n.value;
                      var q = null;
                      c.has(m) && c.get(m).has(n) && (q = c.get(m).get(n));
                      k.push({
                        language: m,
                        role: n,
                        label: q
                      });
                    }
                  });
                  return k;
                }
                p.wa = function () {
                  return this.h && this.h.remote ? this.h.remote.state != "disconnected" : false;
                };
                p.be = function () {
                  return !this.h || this.h.ended ? true : this.Sa && !this.W() && this.h.currentTime >= this.Qa().end;
                };
                S("shaka.Player", X);
                X.prototype.isEnded = X.prototype.be;
                X.prototype.isRemotePlayback = X.prototype.wa;
                X.prototype.addFont = X.prototype.addFont;
                X.prototype.setVideoContainer = X.prototype.Ui;
                X.prototype.getFetchedPlaybackInfo = X.prototype.Fj;
                X.prototype.getManifestParserFactory = X.prototype.Lj;
                X.prototype.getManifest = X.prototype.Hg;
                X.prototype.retryStreaming = X.prototype.fh;
                X.prototype.setMaxHardwareResolution = X.prototype.Zk;
                X.prototype.addChaptersTrack = X.prototype.Le;
                X.prototype.addThumbnailsTrack = X.prototype.Me;
                X.prototype.addTextTrackAsync = X.prototype.Od;
                X.prototype.getStats = X.prototype.getStats;
                X.prototype.getBufferedInfo = X.prototype.Fc;
                X.prototype.getSegmentAvailabilityDuration = X.prototype.Ze;
                X.prototype.getPresentationStartTimeAsDate = X.prototype.di;
                X.prototype.getPlayheadTimeAsDate = X.prototype.Pj;
                X.prototype.setTextTrackVisibility = X.prototype.qh;
                X.prototype.getChaptersAsync = X.prototype.Aj;
                X.prototype.getChapters = X.prototype.zj;
                X.prototype.getChaptersTracks = X.prototype.Bj;
                X.prototype.isTextTrackVisible = X.prototype.Og;
                X.prototype.selectVariantsByLabel = X.prototype.Tk;
                X.prototype.selectTextLanguage = X.prototype.jh;
                X.prototype.selectAudioLanguage = X.prototype.Oi;
                X.prototype.getTextLanguages = X.prototype.Vj;
                X.prototype.getAudioLanguages = X.prototype.wj;
                X.prototype.getTextLanguagesAndRoles = X.prototype.Wj;
                X.prototype.getAudioLanguagesAndRoles = X.prototype.xj;
                X.prototype.getVideoTracks = X.prototype.getVideoTracks;
                X.prototype.selectVideoTrack = X.prototype.Uk;
                X.prototype.getAudioTracks = X.prototype.getAudioTracks;
                X.prototype.selectAudioTrack = X.prototype.Sk;
                X.prototype.selectVariantTrack = X.prototype.Ff;
                X.prototype.selectTextTrack = X.prototype.kh;
                X.prototype.getThumbnails = X.prototype.Yj;
                X.prototype.getAllThumbnails = X.prototype.vj;
                X.prototype.getImageTracks = X.prototype.Hj;
                X.prototype.getTextTracks = X.prototype.Kc;
                X.prototype.getVariantTracks = X.prototype.mc;
                X.prototype.cancelTrickPlay = X.prototype.Pd;
                X.prototype.trickPlay = X.prototype.se;
                X.prototype.useTrickPlayTrackIfAvailable = X.prototype.Fh;
                X.prototype.getPlaybackRate = X.prototype.Ob;
                X.prototype.isBuffering = X.prototype.Ng;
                X.prototype.getKeyStatuses = X.prototype.Xe;
                X.prototype.getActiveSessionsMetadata = X.prototype.Gg;
                X.prototype.getExpiration = X.prototype.Wd;
                X.prototype.drmInfo = X.prototype.drmInfo;
                X.prototype.keySystem = X.prototype.keySystem;
                X.prototype.isFullyLoaded = X.prototype.ik;
                X.prototype.goToLive = X.prototype.ek;
                X.prototype.seekRange = X.prototype.Qa;
                X.prototype.isVideoOnly = X.prototype.mi;
                X.prototype.isAudioOnly = X.prototype.hk;
                X.prototype.isInProgress = X.prototype.Vc;
                X.prototype.isLive = X.prototype.W;
                X.prototype.getQueueManager = X.prototype.ei;
                X.prototype.getAdManager = X.prototype.Yh;
                X.prototype.getAssetUri = X.prototype.rd;
                X.prototype.getNetworkingEngine = X.prototype.Wb;
                X.prototype.getMediaElement = X.prototype.Oj;
                X.prototype.getManifestType = X.prototype.ai;
                X.prototype.getLoadMode = X.prototype.Kj;
                X.prototype.resetConfiguration = X.prototype.Ji;
                X.prototype.getBufferFullness = X.prototype.Zh;
                X.prototype.getNonDefaultConfiguration = X.prototype.ci;
                X.prototype.getConfigurationForLowLatency = X.prototype.Cj;
                X.prototype.getConfiguration = X.prototype.getConfiguration;
                X.prototype.configurationForLowLatency = X.prototype.sj;
                X.prototype.configure = X.prototype.configure;
                X.prototype.releaseAllMutexes = X.prototype.Kk;
                X.prototype.destroyAllPreloads = X.prototype.ng;
                X.prototype.preload = X.prototype.preload;
                X.prototype.detachAndSavePreload = X.prototype.Uh;
                X.prototype.unloadAndSavePreload = X.prototype.ej;
                X.prototype.load = X.prototype.load;
                X.prototype.updateStartTime = X.prototype.jl;
                X.prototype.unload = X.prototype.Bc;
                X.prototype.detach = X.prototype.detach;
                X.prototype.attachCanvas = X.prototype.kj;
                X.prototype.attach = X.prototype.fc;
                X.probeSupport = function (a) {
                  a = a === void 0 ? true : a;
                  var b, c, d, e, f, g, h;
                  return P(function (k) {
                    switch (k.g) {
                      case 1:
                        b = {};
                        if (!a) {
                          k.A(2);
                          break;
                        }
                        return F(k, hi(), 3);
                      case 3:
                        b = k.h;
                      case 2:
                        return c = xi(), d = sk(), e = tb(), F(k, e.jc(), 4);
                      case 4:
                        return f = k.h, g = {
                          manifest: c,
                          media: d,
                          drm: b,
                          hardwareResolution: f
                        }, h = Mq, h.forEach(function (l, m) {
                          g[m] = l();
                        }), k.return(g);
                    }
                  });
                };
                X.isBrowserSupported = function () {
                  window.Promise || ab("A Promise implementation or polyfill is required");
                  if (!(window.Promise && window.Uint8Array && Array.prototype.forEach) || (navigator.userAgent || "").includes("Trident/")) return false;
                  tb();
                  return yi() ? true : zi().canPlayType("application/x-mpegurl") != "";
                };
                X.setQueueManagerFactory = function (a) {
                  Eq = a;
                };
                X.setAdManagerFactory = function (a) {
                  Dq = a;
                };
                X.registerSupportPlugin = Lq;
                X.prototype.destroy = X.prototype.destroy;
                var Kq = 0,
                  Aq = 1,
                  lr = 2,
                  pr = 3;
                X.LoadMode = {
                  DESTROYED: Kq,
                  NOT_LOADED: Aq,
                  MEDIA_SOURCE: lr,
                  SRC_EQUALS: pr
                };
                X.version = "v4.16.5";
                var es = ["4", "16"];
                zb = new function (a) {
                  this.g = a;
                  this.i = Ab;
                  this.h = Bb;
                }(new xb(Number(es[0]), Number(es[1])));
                var Mq = new Map(),
                  Dq = null,
                  Eq = null;
                function fs() {
                  this.g = [];
                  this.i = this.m = this.l = this.j = this.h = 0;
                }
                function gs(a) {
                  return a.g.length ? a.g.reduce(function (b, c) {
                    return b + c;
                  }, 0) / a.g.length : 0;
                }
                function hs(a, b, c) {
                  var d = this;
                  this.g = a;
                  this.h = b;
                  this.m = c;
                  this.i = false;
                  this.j = this.h.getVolume();
                  this.l = new nb();
                  this.l.D(this.h, google.ima.AdEvent.Type.PAUSED, function () {
                    d.i = true;
                  });
                  this.l.D(this.h, google.ima.AdEvent.Type.RESUMED, function () {
                    d.i = false;
                  });
                }
                p = hs.prototype;
                p.needsSkipUI = function () {
                  return false;
                };
                p.isClientRendering = function () {
                  return true;
                };
                p.hasCustomClick = function () {
                  return true;
                };
                p.isUsingAnotherMediaElement = function () {
                  return true;
                };
                p.getDuration = function () {
                  return this.g.getDuration();
                };
                p.getMinSuggestedDuration = function () {
                  return this.g.getMinSuggestedDuration();
                };
                p.getRemainingTime = function () {
                  return this.h.getRemainingTime();
                };
                p.isPaused = function () {
                  return this.i;
                };
                p.isSkippable = function () {
                  return this.g.getSkipTimeOffset() >= 0;
                };
                p.getTimeUntilSkippable = function () {
                  var a = this.g.getSkipTimeOffset();
                  a = this.getRemainingTime() - a;
                  return Math.max(a, 0);
                };
                p.canSkipNow = function () {
                  return this.h.getAdSkippableState();
                };
                p.skip = function () {
                  return this.h.skip();
                };
                p.pause = function () {
                  return this.h.pause();
                };
                p.play = function () {
                  return this.h.resume();
                };
                p.getVolume = function () {
                  return this.h.getVolume();
                };
                p.setVolume = function (a) {
                  this.m.volume = a;
                  return this.h.setVolume(a);
                };
                p.isMuted = function () {
                  return this.h.getVolume() == 0;
                };
                p.isLinear = function () {
                  return this.g.isLinear();
                };
                p.resize = function (a, b) {
                  this.h.resize(a, b);
                };
                p.setMuted = function (a) {
                  (this.m.muted = a) ? (this.j = this.getVolume(), this.h.setVolume(0)) : this.h.setVolume(this.j);
                };
                p.getSequenceLength = function () {
                  var a = this.g.getAdPodInfo();
                  return a == null ? 1 : a.getTotalAds();
                };
                p.getPositionInSequence = function () {
                  var a = this.g.getAdPodInfo();
                  return a == null ? 1 : a.getAdPosition();
                };
                p.getTitle = function () {
                  return this.g.getTitle();
                };
                p.getDescription = function () {
                  return this.g.getDescription();
                };
                p.getVastMediaBitrate = function () {
                  return this.g.getVastMediaBitrate();
                };
                p.getVastMediaHeight = function () {
                  return this.g.getVastMediaHeight();
                };
                p.getVastMediaWidth = function () {
                  return this.g.getVastMediaWidth();
                };
                p.getVastAdId = function () {
                  return "";
                };
                p.getAdId = function () {
                  return this.g.getAdId();
                };
                p.getCreativeAdId = function () {
                  return this.g.getCreativeAdId();
                };
                p.getAdvertiserName = function () {
                  return this.g.getAdvertiserName();
                };
                p.getMediaUrl = function () {
                  return this.g.getMediaUrl();
                };
                p.getTimeOffset = function () {
                  var a = this.g.getAdPodInfo();
                  return a == null ? 0 : a.getTimeOffset();
                };
                p.getPodIndex = function () {
                  var a = this.g.getAdPodInfo();
                  return a == null ? 0 : a.getPodIndex();
                };
                p.release = function () {
                  this.h = this.g = null;
                };
                S("shaka.ads.ClientSideAd", hs);
                hs.prototype.release = hs.prototype.release;
                hs.prototype.getPodIndex = hs.prototype.getPodIndex;
                hs.prototype.getTimeOffset = hs.prototype.getTimeOffset;
                hs.prototype.getMediaUrl = hs.prototype.getMediaUrl;
                hs.prototype.getAdvertiserName = hs.prototype.getAdvertiserName;
                hs.prototype.getCreativeAdId = hs.prototype.getCreativeAdId;
                hs.prototype.getAdId = hs.prototype.getAdId;
                hs.prototype.getVastAdId = hs.prototype.getVastAdId;
                hs.prototype.getVastMediaWidth = hs.prototype.getVastMediaWidth;
                hs.prototype.getVastMediaHeight = hs.prototype.getVastMediaHeight;
                hs.prototype.getVastMediaBitrate = hs.prototype.getVastMediaBitrate;
                hs.prototype.getDescription = hs.prototype.getDescription;
                hs.prototype.getTitle = hs.prototype.getTitle;
                hs.prototype.getPositionInSequence = hs.prototype.getPositionInSequence;
                hs.prototype.getSequenceLength = hs.prototype.getSequenceLength;
                hs.prototype.setMuted = hs.prototype.setMuted;
                hs.prototype.resize = hs.prototype.resize;
                hs.prototype.isLinear = hs.prototype.isLinear;
                hs.prototype.isMuted = hs.prototype.isMuted;
                hs.prototype.setVolume = hs.prototype.setVolume;
                hs.prototype.getVolume = hs.prototype.getVolume;
                hs.prototype.play = hs.prototype.play;
                hs.prototype.pause = hs.prototype.pause;
                hs.prototype.skip = hs.prototype.skip;
                hs.prototype.canSkipNow = hs.prototype.canSkipNow;
                hs.prototype.getTimeUntilSkippable = hs.prototype.getTimeUntilSkippable;
                hs.prototype.isSkippable = hs.prototype.isSkippable;
                hs.prototype.isPaused = hs.prototype.isPaused;
                hs.prototype.getRemainingTime = hs.prototype.getRemainingTime;
                hs.prototype.getMinSuggestedDuration = hs.prototype.getMinSuggestedDuration;
                hs.prototype.getDuration = hs.prototype.getDuration;
                hs.prototype.isUsingAnotherMediaElement = hs.prototype.isUsingAnotherMediaElement;
                hs.prototype.hasCustomClick = hs.prototype.hasCustomClick;
                hs.prototype.isClientRendering = hs.prototype.isClientRendering;
                hs.prototype.needsSkipUI = hs.prototype.needsSkipUI;
                function is() {}
                function js(a, b) {
                  var c = [];
                  a = t(td(a, "Ad"));
                  for (var d = a.next(); !d.done; d = a.next()) if (d = xd(d.value, "InLine")) if (d = xd(d, "Creatives")) {
                    d = t(td(d, "Creative"));
                    for (var e = d.next(); !e.done; e = d.next()) {
                      e = e.value;
                      var f = xd(e, "Linear");
                      f && ks(c, b, f);
                      if (e = xd(e, "NonLinearAds")) {
                        e = td(e, "NonLinear");
                        e = t(e);
                        for (var g = e.next(); !g.done; g = e.next()) a: {
                          f = c;
                          var h = b,
                            k = g.value,
                            l = xd(k, "StaticResource");
                          if (l) g = l.attributes.creativeType;else {
                            l = xd(k, "HTMLResource");
                            if (!l) break a;
                            g = "text/html";
                          }
                          if (l = vd(l)) {
                            g === "text/html" && (l = "data:text/html;charset=UTF-8," + encodeURIComponent(l));
                            var m = Ad(k, "width", Gd) || Ad(k, "expandedWidth", Gd),
                              n = Ad(k, "height", Gd) || Ad(k, "expandedHeight", Gd);
                            if (m || n) {
                              var q = null,
                                r = xd(k, "NonLinearClickThrough");
                              r && (r = vd(r)) && (q = r);
                              r = null;
                              (k = k.attributes.minSuggestedDuration) && (r = ed(k));
                              k = 0;
                              h != null && (k = h);
                              f.push({
                                id: null,
                                groupId: null,
                                startTime: k,
                                endTime: null,
                                uri: l,
                                mimeType: g,
                                isSkippable: false,
                                skipOffset: null,
                                skipFor: null,
                                canJump: false,
                                resumeOffset: 0,
                                playoutLimit: r,
                                once: true,
                                pre: h == null,
                                post: h == Infinity,
                                timelineRange: false,
                                loop: false,
                                overlay: {
                                  viewport: {
                                    x: 0,
                                    y: 0
                                  },
                                  topLeft: {
                                    x: 0,
                                    y: 0
                                  },
                                  size: {
                                    x: m || 0,
                                    y: n || 0
                                  }
                                },
                                displayOnBackground: false,
                                currentVideo: null,
                                background: null,
                                clickThroughUrl: q
                              });
                            }
                          }
                        }
                      }
                    }
                  }
                  return c;
                }
                function ks(a, b, c) {
                  var d = 0;
                  b != null && (d = b);
                  var e = null;
                  c.attributes.skipoffset && (e = ed(c.attributes.skipoffset), isNaN(e) && (e = null));
                  var f = xd(c, "MediaFiles");
                  if (f) {
                    var g = null;
                    (c = xd(c, "VideoClicks")) && (c = xd(c, "ClickThrough")) && (c = vd(c)) && (g = c);
                    f = c = td(f, "MediaFile");
                    c = c.filter(function (k) {
                      return k.attributes.delivery == "streaming";
                    });
                    c.length && (f = c);
                    f = f.sort(function (k, l) {
                      return (parseInt(l.attributes.height, 10) || 0) - (parseInt(k.attributes.height, 10) || 0);
                    });
                    f = t(f);
                    for (c = f.next(); !c.done; c = f.next()) if (c = c.value, !c.attributes.apiFramework) {
                      var h = vd(c);
                      if (h) {
                        a.push({
                          id: null,
                          groupId: null,
                          startTime: d,
                          endTime: null,
                          uri: h,
                          mimeType: c.attributes.type || null,
                          isSkippable: e != null,
                          skipOffset: e,
                          skipFor: null,
                          canJump: false,
                          resumeOffset: 0,
                          playoutLimit: null,
                          once: true,
                          pre: b == null,
                          post: b == Infinity,
                          timelineRange: false,
                          loop: false,
                          overlay: null,
                          displayOnBackground: false,
                          currentVideo: null,
                          background: null,
                          clickThroughUrl: g
                        });
                        break;
                      }
                    }
                  }
                }
                function ls(a) {
                  var b = [];
                  a = t(td(a, "vmap:AdBreak"));
                  for (var c = a.next(); !c.done; c = a.next()) {
                    var d = c.value,
                      e = d.attributes.timeOffset;
                    e && (c = null, e == "start" ? c = null : e == "end" ? c = Infinity : c = ed(e), (d = xd(d, "vmap:AdSource")) && (d = xd(d, "vmap:AdTagURI")) && (d = ud(d)) && b.push({
                      time: c,
                      uri: d
                    }));
                  }
                  return b;
                }
                S("shaka.ads.Utils", is);
                is.ADS_LOADED = "ads-loaded";
                is.AD_STARTED = "ad-started";
                is.AD_FIRST_QUARTILE = "ad-first-quartile";
                is.AD_MIDPOINT = "ad-midpoint";
                is.AD_THIRD_QUARTILE = "ad-third-quartile";
                is.AD_COMPLETE = "ad-complete";
                is.AD_STOPPED = "ad-stopped";
                is.AD_SKIPPED = "ad-skipped";
                is.AD_VOLUME_CHANGED = "ad-volume-changed";
                is.AD_MUTED = "ad-muted";
                is.AD_PAUSED = "ad-paused";
                is.AD_RESUMED = "ad-resumed";
                is.AD_SKIP_STATE_CHANGED = "ad-skip-state-changed";
                is.CUEPOINTS_CHANGED = "ad-cue-points-changed";
                is.IMA_AD_MANAGER_LOADED = "ima-ad-manager-loaded";
                is.IMA_STREAM_MANAGER_LOADED = "ima-stream-manager-loaded";
                is.AD_CLICKED = "ad-clicked";
                is.AD_PROGRESS = "ad-progress";
                is.AD_BUFFERING = "ad-buffering";
                is.AD_IMPRESSION = "ad-impression";
                is.AD_DURATION_CHANGED = "ad-duration-changed";
                is.AD_CLOSED = "ad-closed";
                is.AD_LOADED = "ad-loaded";
                is.ALL_ADS_COMPLETED = "all-ads-completed";
                is.AD_LINEAR_CHANGED = "ad-linear-changed";
                is.AD_METADATA = "ad-metadata";
                is.AD_RECOVERABLE_ERROR = "ad-recoverable-error";
                is.AD_ERROR = "ad-error";
                is.AD_BREAK_READY = "ad-break-ready";
                is.AD_INTERACTION = "ad-interaction";
                is.AD_CONTENT_PAUSE_REQUESTED = "ad-content-pause-requested";
                is.AD_CONTENT_RESUME_REQUESTED = "ad-content-resume-requested";
                is.AD_CONTENT_ATTACH_REQUESTED = "ad-content-attach-requested";
                function ms(a, b, c, d, e) {
                  var f = this;
                  this.u = a;
                  this.i = b;
                  this.G = false;
                  this.B = this.o = null;
                  this.H = NaN;
                  this.l = e;
                  this.j = null;
                  this.h = new nb();
                  google.ima.settings.setLocale(c);
                  google.ima.settings.setDisableCustomPlaybackForIOS10Plus(true);
                  this.F = new google.ima.AdDisplayContainer(this.u, this.i);
                  this.F.initialize();
                  this.m = new google.ima.AdsLoader(this.F);
                  this.m.getSettings().setPlayerType("shaka-player");
                  this.m.getSettings().setPlayerVersion("v4.16.5");
                  this.g = null;
                  this.C = d || new google.ima.AdsRenderingSettings();
                  this.h.D(this.m, google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED, function (g) {
                    ns(f, g);
                  });
                  this.h.D(this.m, google.ima.AdErrorEvent.Type.AD_ERROR, function (g) {
                    os(f, g);
                  });
                  this.h.D(this.i, "ended", function () {
                    f.m.contentComplete();
                  });
                  this.h.Ba(this.i, "play", function () {
                    f.G = true;
                  });
                }
                ms.prototype.configure = function (a) {
                  this.o = a;
                };
                ms.prototype.stop = function () {
                  this.g && this.g.stop();
                  this.u && Gj(this.u);
                };
                ms.prototype.release = function () {
                  this.stop();
                  this.B && this.B.disconnect();
                  this.h && this.h.release();
                  this.g && this.g.destroy();
                  this.m.destroy();
                  this.F.destroy();
                };
                function os(a, b) {
                  b.getError();
                  b = new Map().set("originalEvent", b);
                  a.l(new V("ad-error", b));
                  ps(a, null);
                  a.l(new V("ad-cue-points-changed", new Map().set("cuepoints", [])));
                }
                function ns(a, b) {
                  a.l(new V("ads-loaded", new Map().set("loadTime", Date.now() / 1E3 - a.H)));
                  if (a.o.customPlayheadTracker) {
                    var c = {
                      currentTime: a.i.currentTime
                    };
                    a.g = b.getAdsManager(c, a.C);
                    a.i.muted ? a.g.setVolume(0) : a.g.setVolume(a.i.volume);
                    a.h.D(a.i, "timeupdate", function () {
                      a.i.duration && (c.currentTime = a.i.currentTime);
                    });
                    a.h.D(a.i, "volumechange", function () {
                      a.j && (a.j.setVolume(a.i.volume), a.i.muted && a.j.setMuted(true));
                    });
                  } else a.g = b.getAdsManager(a.i, a.C);
                  a.l(new V("ima-ad-manager-loaded", new Map().set("imaAdManager", a.g)));
                  var d = a.g.getCuePoints();
                  if (d.length) {
                    b = [];
                    d = t(d);
                    for (var e = d.next(); !e.done; e = d.next()) b.push({
                      start: e.value,
                      end: null
                    });
                    a.l(new V("ad-cue-points-changed", new Map().set("cuepoints", b)));
                  }
                  qs(a);
                  try {
                    a.g.init(a.i.offsetWidth, a.i.offsetHeight), a.h.D(a.i, "loadeddata", function () {
                      a.g.resize(a.i.offsetWidth, a.i.offsetHeight);
                    }), "ResizeObserver" in window ? (a.B = new ResizeObserver(function () {
                      a.g.resize(a.i.offsetWidth, a.i.offsetHeight);
                    }), a.B.observe(a.i)) : a.h.D(document, "fullscreenchange", function () {
                      a.g.resize(a.i.offsetWidth, a.i.offsetHeight);
                    }), a.G || a.o.skipPlayDetection ? a.g.start() : a.h.Ba(a.i, "play", function () {
                      a.G = !0;
                      a.g.start();
                    });
                  } catch (f) {
                    ps(a, null);
                  }
                }
                function qs(a) {
                  function b(c, d) {
                    c = new Map().set("originalEvent", c);
                    a.l(new V(d, c));
                  }
                  a.h.D(a.g, google.ima.AdErrorEvent.Type.AD_ERROR, function (c) {
                    os(a, c);
                  });
                  a.h.D(a.g, google.ima.AdEvent.Type.CONTENT_PAUSE_REQUESTED, function (c) {
                    rs(a, c);
                  });
                  a.h.D(a.g, google.ima.AdEvent.Type.STARTED, function (c) {
                    rs(a, c);
                  });
                  a.h.D(a.g, google.ima.AdEvent.Type.FIRST_QUARTILE, function (c) {
                    b(c, "ad-first-quartile");
                  });
                  a.h.D(a.g, google.ima.AdEvent.Type.MIDPOINT, function (c) {
                    b(c, "ad-midpoint");
                  });
                  a.h.D(a.g, google.ima.AdEvent.Type.THIRD_QUARTILE, function (c) {
                    b(c, "ad-third-quartile");
                  });
                  a.h.D(a.g, google.ima.AdEvent.Type.COMPLETE, function (c) {
                    b(c, "ad-complete");
                  });
                  a.h.D(a.g, google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED, function (c) {
                    ps(a, c);
                  });
                  a.h.D(a.g, google.ima.AdEvent.Type.ALL_ADS_COMPLETED, function (c) {
                    ps(a, c);
                  });
                  a.h.D(a.g, google.ima.AdEvent.Type.SKIPPED, function (c) {
                    b(c, "ad-skipped");
                  });
                  a.h.D(a.g, google.ima.AdEvent.Type.VOLUME_CHANGED, function (c) {
                    b(c, "ad-volume-changed");
                  });
                  a.h.D(a.g, google.ima.AdEvent.Type.VOLUME_MUTED, function (c) {
                    b(c, "ad-muted");
                  });
                  a.h.D(a.g, google.ima.AdEvent.Type.PAUSED, function (c) {
                    a.j && (a.j.i = true, b(c, "ad-paused"));
                  });
                  a.h.D(a.g, google.ima.AdEvent.Type.RESUMED, function (c) {
                    a.j && (a.j.i = false, b(c, "ad-resumed"));
                  });
                  a.h.D(a.g, google.ima.AdEvent.Type.SKIPPABLE_STATE_CHANGED, function (c) {
                    a.j && b(c, "ad-skip-state-changed");
                  });
                  a.h.D(a.g, google.ima.AdEvent.Type.CLICK, function (c) {
                    b(c, "ad-clicked");
                  });
                  a.h.D(a.g, google.ima.AdEvent.Type.AD_PROGRESS, function (c) {
                    b(c, "ad-progress");
                  });
                  a.h.D(a.g, google.ima.AdEvent.Type.AD_BUFFERING, function (c) {
                    b(c, "ad-buffering");
                  });
                  a.h.D(a.g, google.ima.AdEvent.Type.IMPRESSION, function (c) {
                    b(c, "ad-impression");
                  });
                  a.h.D(a.g, google.ima.AdEvent.Type.DURATION_CHANGE, function (c) {
                    b(c, "ad-duration-changed");
                  });
                  a.h.D(a.g, google.ima.AdEvent.Type.USER_CLOSE, function (c) {
                    b(c, "ad-closed");
                  });
                  a.h.D(a.g, google.ima.AdEvent.Type.LOADED, function (c) {
                    b(c, "ad-loaded");
                  });
                  a.h.D(a.g, google.ima.AdEvent.Type.ALL_ADS_COMPLETED, function (c) {
                    b(c, "all-ads-completed");
                  });
                  a.h.D(a.g, google.ima.AdEvent.Type.LINEAR_CHANGED, function (c) {
                    b(c, "ad-linear-changed");
                  });
                  a.h.D(a.g, google.ima.AdEvent.Type.AD_METADATA, function (c) {
                    b(c, "ad-metadata");
                  });
                  a.h.D(a.g, google.ima.AdEvent.Type.LOG, function (c) {
                    b(c, "ad-recoverable-error");
                  });
                  a.h.D(a.g, google.ima.AdEvent.Type.AD_BREAK_READY, function (c) {
                    b(c, "ad-break-ready");
                  });
                  a.h.D(a.g, google.ima.AdEvent.Type.INTERACTION, function (c) {
                    b(c, "ad-interaction");
                  });
                }
                function rs(a, b) {
                  var c = b.getAd();
                  c ? (a.j = new hs(c, a.g, a.i), b.type != google.ima.AdEvent.Type.CONTENT_PAUSE_REQUESTED || a.o.supportsMultipleMediaElements || a.l(new V("ad-content-pause-requested")), b = new Map().set("ad", a.j).set("sdkAdObject", c).set("originalEvent", b), a.l(new V("ad-started", b)), a.j.isLinear() && (a.u.setAttribute("ad-active", "true"), a.o.customPlayheadTracker || a.i.pause(), a.i.muted ? (b = a.j, b.j = a.i.volume, b.h.setVolume(0)) : a.j.setVolume(a.i.volume))) : ab("The IMA SDK fired a " + b.type + " event with no associated ad. Unable to play ad!");
                }
                function ps(a, b) {
                  b && b.type == google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED && !a.o.supportsMultipleMediaElements && a.l(new V("ad-content-resume-requested"));
                  a.l(new V("ad-stopped", new Map().set("originalEvent", b)));
                  a.j && a.j.isLinear() && (a.u.removeAttribute("ad-active"), a.o.customPlayheadTracker || a.i.ended || a.i.play());
                }
                function ss(a, b, c, d, e, f) {
                  this.g = a;
                  this.h = b;
                  this.j = (this.i = b.isSkippable) ? b.skipOffset || 0 : b.skipOffset;
                  this.l = b.skipFor;
                  this.B = c;
                  this.o = d;
                  this.m = e;
                  this.u = f;
                  this.C = b.overlay;
                }
                p = ss.prototype;
                p.needsSkipUI = function () {
                  return true;
                };
                p.isClientRendering = function () {
                  return true;
                };
                p.hasCustomClick = function () {
                  return this.h.clickThroughUrl != null;
                };
                p.isUsingAnotherMediaElement = function () {
                  return this.u;
                };
                p.getDuration = function () {
                  var a = this.g.duration;
                  return isNaN(a) ? -1 : a;
                };
                p.getMinSuggestedDuration = function () {
                  return this.getDuration();
                };
                p.getRemainingTime = function () {
                  var a = this.g.duration;
                  return isNaN(a) ? -1 : a - this.g.currentTime;
                };
                p.isPaused = function () {
                  return this.g.paused;
                };
                p.isSkippable = function () {
                  return this.i && this.l != null ? this.getDuration() - this.getRemainingTime() < this.j + this.l : this.i;
                };
                p.getTimeUntilSkippable = function () {
                  if (this.isSkippable()) {
                    var a = this.getRemainingTime() + this.j - this.getDuration();
                    return Math.max(a, 0);
                  }
                  return Math.max(this.getRemainingTime(), 0);
                };
                p.canSkipNow = function () {
                  return this.i && this.getTimeUntilSkippable() == 0;
                };
                p.skip = function () {
                  this.canSkipNow() && this.B();
                };
                p.pause = function () {
                  return this.g.pause();
                };
                p.play = function () {
                  return this.g.play();
                };
                p.getVolume = function () {
                  return this.g.volume;
                };
                p.setVolume = function (a) {
                  this.g.volume = a;
                };
                p.isMuted = function () {
                  return this.g.muted;
                };
                p.isLinear = function () {
                  return this.C == null;
                };
                p.resize = function () {};
                p.setMuted = function (a) {
                  this.g.muted = a;
                };
                p.getSequenceLength = function () {
                  return this.o;
                };
                p.getPositionInSequence = function () {
                  return this.m;
                };
                p.getTitle = function () {
                  return "";
                };
                p.getDescription = function () {
                  return "";
                };
                p.getVastMediaBitrate = function () {
                  return 0;
                };
                p.getVastMediaHeight = function () {
                  return 0;
                };
                p.getVastMediaWidth = function () {
                  return 0;
                };
                p.getVastAdId = function () {
                  return "";
                };
                p.getAdId = function () {
                  return this.h.id || "";
                };
                p.getCreativeAdId = function () {
                  return "";
                };
                p.getAdvertiserName = function () {
                  return "";
                };
                p.getMediaUrl = function () {
                  return this.h.uri;
                };
                p.getTimeOffset = function () {
                  return this.h.pre ? 0 : this.h.post ? -1 : this.h.startTime;
                };
                p.getPodIndex = function () {
                  return 0;
                };
                p.release = function () {
                  this.g = null;
                };
                S("shaka.ads.InterstitialAd", ss);
                ss.prototype.release = ss.prototype.release;
                ss.prototype.getPodIndex = ss.prototype.getPodIndex;
                ss.prototype.getTimeOffset = ss.prototype.getTimeOffset;
                ss.prototype.getMediaUrl = ss.prototype.getMediaUrl;
                ss.prototype.getAdvertiserName = ss.prototype.getAdvertiserName;
                ss.prototype.getCreativeAdId = ss.prototype.getCreativeAdId;
                ss.prototype.getAdId = ss.prototype.getAdId;
                ss.prototype.getVastAdId = ss.prototype.getVastAdId;
                ss.prototype.getVastMediaWidth = ss.prototype.getVastMediaWidth;
                ss.prototype.getVastMediaHeight = ss.prototype.getVastMediaHeight;
                ss.prototype.getVastMediaBitrate = ss.prototype.getVastMediaBitrate;
                ss.prototype.getDescription = ss.prototype.getDescription;
                ss.prototype.getTitle = ss.prototype.getTitle;
                ss.prototype.getPositionInSequence = ss.prototype.getPositionInSequence;
                ss.prototype.getSequenceLength = ss.prototype.getSequenceLength;
                ss.prototype.setMuted = ss.prototype.setMuted;
                ss.prototype.resize = ss.prototype.resize;
                ss.prototype.isLinear = ss.prototype.isLinear;
                ss.prototype.isMuted = ss.prototype.isMuted;
                ss.prototype.setVolume = ss.prototype.setVolume;
                ss.prototype.getVolume = ss.prototype.getVolume;
                ss.prototype.play = ss.prototype.play;
                ss.prototype.pause = ss.prototype.pause;
                ss.prototype.skip = ss.prototype.skip;
                ss.prototype.canSkipNow = ss.prototype.canSkipNow;
                ss.prototype.getTimeUntilSkippable = ss.prototype.getTimeUntilSkippable;
                ss.prototype.isSkippable = ss.prototype.isSkippable;
                ss.prototype.isPaused = ss.prototype.isPaused;
                ss.prototype.getRemainingTime = ss.prototype.getRemainingTime;
                ss.prototype.getMinSuggestedDuration = ss.prototype.getMinSuggestedDuration;
                ss.prototype.getDuration = ss.prototype.getDuration;
                ss.prototype.isUsingAnotherMediaElement = ss.prototype.isUsingAnotherMediaElement;
                ss.prototype.hasCustomClick = ss.prototype.hasCustomClick;
                ss.prototype.isClientRendering = ss.prototype.isClientRendering;
                ss.prototype.needsSkipUI = ss.prototype.needsSkipUI;
                function ts(a, b, c) {
                  this.g = a;
                  this.j = b;
                  this.h = c;
                  this.i = a.overlay == null;
                }
                p = ts.prototype;
                p.needsSkipUI = function () {
                  return true;
                };
                p.isClientRendering = function () {
                  return true;
                };
                p.hasCustomClick = function () {
                  return this.g.clickThroughUrl != null;
                };
                p.isUsingAnotherMediaElement = function () {
                  return false;
                };
                p.getDuration = function () {
                  return -1;
                };
                p.getMinSuggestedDuration = function () {
                  return this.getDuration();
                };
                p.getRemainingTime = function () {
                  return -1;
                };
                p.isPaused = function () {
                  return false;
                };
                p.isSkippable = function () {
                  return false;
                };
                p.getTimeUntilSkippable = function () {
                  return 0;
                };
                p.canSkipNow = function () {
                  return false;
                };
                p.skip = function () {};
                p.pause = function () {};
                p.play = function () {};
                p.getVolume = function () {
                  return 1;
                };
                p.setVolume = function () {};
                p.isMuted = function () {
                  return false;
                };
                p.isLinear = function () {
                  return this.i;
                };
                p.resize = function () {};
                p.setMuted = function () {};
                p.getSequenceLength = function () {
                  return this.j;
                };
                p.getPositionInSequence = function () {
                  return this.h;
                };
                p.getTitle = function () {
                  return "";
                };
                p.getDescription = function () {
                  return "";
                };
                p.getVastMediaBitrate = function () {
                  return 0;
                };
                p.getVastMediaHeight = function () {
                  return 0;
                };
                p.getVastMediaWidth = function () {
                  return 0;
                };
                p.getVastAdId = function () {
                  return "";
                };
                p.getAdId = function () {
                  return this.g.id || "";
                };
                p.getCreativeAdId = function () {
                  return "";
                };
                p.getAdvertiserName = function () {
                  return "";
                };
                p.getMediaUrl = function () {
                  return this.g.uri;
                };
                p.getTimeOffset = function () {
                  return this.g.pre ? 0 : this.g.post ? -1 : this.g.startTime;
                };
                p.getPodIndex = function () {
                  return 0;
                };
                p.release = function () {};
                S("shaka.ads.InterstitialStaticAd", ts);
                ts.prototype.release = ts.prototype.release;
                ts.prototype.getPodIndex = ts.prototype.getPodIndex;
                ts.prototype.getTimeOffset = ts.prototype.getTimeOffset;
                ts.prototype.getMediaUrl = ts.prototype.getMediaUrl;
                ts.prototype.getAdvertiserName = ts.prototype.getAdvertiserName;
                ts.prototype.getCreativeAdId = ts.prototype.getCreativeAdId;
                ts.prototype.getAdId = ts.prototype.getAdId;
                ts.prototype.getVastAdId = ts.prototype.getVastAdId;
                ts.prototype.getVastMediaWidth = ts.prototype.getVastMediaWidth;
                ts.prototype.getVastMediaHeight = ts.prototype.getVastMediaHeight;
                ts.prototype.getVastMediaBitrate = ts.prototype.getVastMediaBitrate;
                ts.prototype.getDescription = ts.prototype.getDescription;
                ts.prototype.getTitle = ts.prototype.getTitle;
                ts.prototype.getPositionInSequence = ts.prototype.getPositionInSequence;
                ts.prototype.getSequenceLength = ts.prototype.getSequenceLength;
                ts.prototype.setMuted = ts.prototype.setMuted;
                ts.prototype.resize = ts.prototype.resize;
                ts.prototype.isLinear = ts.prototype.isLinear;
                ts.prototype.isMuted = ts.prototype.isMuted;
                ts.prototype.setVolume = ts.prototype.setVolume;
                ts.prototype.getVolume = ts.prototype.getVolume;
                ts.prototype.play = ts.prototype.play;
                ts.prototype.pause = ts.prototype.pause;
                ts.prototype.skip = ts.prototype.skip;
                ts.prototype.canSkipNow = ts.prototype.canSkipNow;
                ts.prototype.getTimeUntilSkippable = ts.prototype.getTimeUntilSkippable;
                ts.prototype.isSkippable = ts.prototype.isSkippable;
                ts.prototype.isPaused = ts.prototype.isPaused;
                ts.prototype.getRemainingTime = ts.prototype.getRemainingTime;
                ts.prototype.getMinSuggestedDuration = ts.prototype.getMinSuggestedDuration;
                ts.prototype.getDuration = ts.prototype.getDuration;
                ts.prototype.isUsingAnotherMediaElement = ts.prototype.isUsingAnotherMediaElement;
                ts.prototype.hasCustomClick = ts.prototype.hasCustomClick;
                ts.prototype.isClientRendering = ts.prototype.isClientRendering;
                ts.prototype.needsSkipUI = ts.prototype.needsSkipUI;
                function us(a, b, c, d) {
                  var e = this;
                  this.M = null;
                  this.m = a;
                  this.C = b;
                  this.g = c;
                  this.G = null;
                  this.u = true;
                  this.h = this.g;
                  this.va = d;
                  this.ma = new Set();
                  this.T = new Set();
                  this.H = new Set();
                  this.F = new Map();
                  this.K = new Map();
                  this.i = new X();
                  vs(this);
                  this.I = new nb();
                  this.j = new nb();
                  this.J = false;
                  this.$ = this.o = this.B = this.l = null;
                  this.aa = false;
                  this.O = -1;
                  this.X = function () {
                    if (!e.J && e.l && !e.C.wa()) {
                      e.l = e.g.currentTime;
                      var f = ws(e);
                      f && xs(e, f, 1, 1, Date.now());
                    }
                  };
                  this.V = function () {
                    if (!(e.J || e.l || e.C.wa())) {
                      e.l = e.g.currentTime;
                      var f = ws(e, true);
                      f || (f = ws(e));
                      f && xs(e, f, 1, 1, Date.now());
                    }
                  };
                  this.qa = function () {
                    if (!e.J && e.l && !e.C.wa()) {
                      var f = e.g.currentTime;
                      e.B && !e.B.pre && !e.B.post && f < (e.B.endTime || e.B.startTime) && (e.B = null);
                    }
                  };
                  this.R = new df(this.X);
                  this.N = new df(function () {
                    var f, g, h, k, l, m, n, q, r, u, v;
                    return P(function (w) {
                      switch (w.g) {
                        case 1:
                          if (!e.H.size || e.l == null) {
                            w.A(0);
                            break;
                          }
                          f = e.C.m;
                          if (f == Kq || f == Aq) return w.return();
                          g = false;
                          h = Array.from(e.H);
                          k = e.C.Qa();
                          l = t(h);
                          m = l.next();
                        case 3:
                          if (m.done) {
                            w.A(5);
                            break;
                          }
                          n = m.value;
                          if (n == e.B) {
                            w.A(4);
                            break;
                          }
                          q = n.endTime || n.startTime;
                          if (!(k.start - q >= 1)) {
                            r = n.startTime - e.l;
                            r > 0 && r <= 10 && (!e.F.has(n) && ys(n) && e.F.set(n, e.i.preload(n.uri, null, n.mimeType || void 0)), zs(e, n));
                            w.A(4);
                            break;
                          }
                          if (!e.F.has(n)) {
                            w.A(7);
                            break;
                          }
                          return F(w, e.F.get(n), 8);
                        case 8:
                          (u = w.h) && u.destroy(), e.F.delete(n);
                        case 7:
                          As(e, n), v = n.id || JSON.stringify(n), e.T.has(v) && e.T.delete(v), e.H.delete(n), Bs(e), n.overlay || (g = true);
                        case 4:
                          m = l.next();
                          w.A(3);
                          break;
                        case 5:
                          g && Cs(e), G(w);
                      }
                    });
                  });
                  this.configure(this.C.getConfiguration().ads);
                }
                p = us.prototype;
                p.configure = function (a) {
                  this.M = a;
                  Ds(this);
                };
                function Es(a) {
                  if (!a.aa && a.H.size) {
                    a.I.D(a.g, "playing", a.V);
                    a.I.D(a.g, "timeupdate", a.V);
                    a.I.D(a.g, "seeked", a.qa);
                    a.I.D(a.g, "ended", a.X);
                    if ("requestVideoFrameCallback" in a.g && !Fs()) {
                      var b = a.g,
                        _c = function c() {
                          a.O != -1 && (a.X(), a.O != -1 && (a.O = b.requestVideoFrameCallback(_c)));
                        };
                      a.O = b.requestVideoFrameCallback(_c);
                    } else a.R.Ea(.025);
                    a.N && a.N.Ea(1);
                    a.aa = true;
                  }
                }
                function Bs(a) {
                  a.aa && !a.H.size && (a.I.Ma(a.g, "playing", a.V), a.I.Ma(a.g, "timeupdate", a.V), a.I.Ma(a.g, "seeked", a.qa), a.I.Ma(a.g, "ended", a.X), a.O != -1 && (a.g.cancelVideoFrameCallback(a.O), a.O = -1), a.R && a.R.stop(), a.N && a.N.stop(), a.aa = false);
                }
                function Ds(a) {
                  if (a.m && a.M) {
                    var b = a.M.supportsMultipleMediaElements,
                      c = a.g;
                    c.webkitPresentationMode && c.webkitPresentationMode !== "inline" ? b = false : c.webkitDisplayingFullscreen && (b = false);
                    a.u == b && (a.u = !b, a.u ? (a.h = a.g, a.G && (a.G.parentElement && a.m.removeChild(a.G), a.G = null)) : (a.G || (b = document.createElement(a.g.tagName), b.autoplay = true, b.style.position = "absolute", b.style.top = "0", b.style.left = "0", b.style.width = "100%", b.style.height = "100%", b.style.display = "none", b.setAttribute("playsinline", ""), a.G = b), a.h = a.G));
                  } else a.u = true;
                }
                p.stop = function () {
                  this.j && this.j.Pa();
                  this.ma.clear();
                  this.T.clear();
                  this.H.clear();
                  this.i.ng();
                  if (this.F.size) {
                    var a = Array.from(this.F.values());
                    a = t(a);
                    for (var b = a.next(); !b.done; b = a.next()) (b = b.value) && b.then(function (c) {
                      c && c.destroy();
                    });
                  }
                  this.F.clear();
                  if (this.K.size) for (a = Array.from(this.K.keys()), a = t(a), b = a.next(); !b.done; b = a.next()) As(this, b.value);
                  this.K.clear();
                  this.i.detach();
                  this.J = false;
                  this.B = this.l = null;
                  this.u = true;
                  this.h = this.g;
                  this.G = null;
                  Gs(this);
                  Bs(this);
                  this.m && Gj(this.m);
                  this.o && (this.o.stop(), this.o = null);
                };
                p.release = function () {
                  this.stop();
                  this.I && this.I.release();
                  this.j && this.j.release();
                  this.R && (this.R.stop(), this.R = null);
                  this.N && (this.N.stop(), this.N = null);
                  this.i.destroy();
                };
                p.td = function () {
                  return this.i;
                };
                function Hs(a, b) {
                  var c, d, e;
                  P(function (f) {
                    if (f.g == 1) {
                      c = null;
                      if (d = b.values.find(function (g) {
                        return g.key == "ID";
                      })) c = d.data;
                      if (c) {
                        if (a.ma.has(c)) return f.return();
                        a.ma.add(c);
                      }
                      vs(a);
                      e = [];
                      return b && b.values.find(function (g) {
                        return g.key == "X-OVERLAY-ID";
                      }) ? (e = Is(b), f.A(2)) : F(f, Js(a, b), 3);
                    }
                    f.g != 2 && (e = f.h);
                    e.length ? Ks(a, e) : ab("Unsupported HLS interstitial", b);
                    G(f);
                  });
                }
                function Ls(a, b) {
                  var c = xd(b.eventNode, "OverlayEvent"),
                    d = c.attributes.uri,
                    e = c.attributes.mimeType,
                    f = c.attributes.loop == "true",
                    g = Ad(c, "z", Gd);
                  if (d && g != 0) {
                    var h = null,
                      k = xd(c, "Background");
                    if (k) {
                      var l = k.attributes.uri;
                      l ? h = "center / contain no-repeat url('" + l + "')" : h = vd(k);
                    }
                    k = 1920;
                    l = 1080;
                    var m = xd(c, "Viewport");
                    if (m) {
                      k = Ad(m, "x", Gd);
                      if (k == null) return;
                      l = Ad(m, "y", Gd);
                      if (l == null) return;
                    }
                    var n = {
                        viewport: {
                          x: k,
                          y: l
                        },
                        topLeft: {
                          x: 0,
                          y: 0
                        },
                        size: {
                          x: k,
                          y: l
                        }
                      },
                      q = xd(c, "Overlay");
                    if (m && q) {
                      var r = xd(q, "TopLeft"),
                        u = xd(q, "Size");
                      if (r && u) {
                        q = Ad(r, "x", Gd);
                        if (q == null) return;
                        r = Ad(r, "y", Gd);
                        if (r == null) return;
                        var v = Ad(u, "x", Gd);
                        if (v == null) return;
                        u = Ad(u, "y", Gd);
                        if (u == null) return;
                        n.topLeft.x = q;
                        n.topLeft.y = r;
                        n.size.x = v;
                        n.size.y = u;
                      }
                    }
                    q = null;
                    c = xd(c, "Squeeze");
                    if (m && c && (u = xd(c, "TopLeft"), c = xd(c, "Size"), u && c)) {
                      m = Ad(u, "x", Gd);
                      if (m == null) return;
                      q = Ad(u, "y", Gd);
                      if (q == null) return;
                      u = Ad(c, "x", Gd);
                      if (u == null) return;
                      c = Ad(c, "y", Gd);
                      if (c == null) return;
                      q = {
                        viewport: {
                          x: k,
                          y: l
                        },
                        topLeft: {
                          x: m,
                          y: q
                        },
                        size: {
                          x: u,
                          y: c
                        }
                      };
                    }
                    Ks(a, [{
                      id: b.id,
                      groupId: null,
                      startTime: b.startTime,
                      endTime: b.endTime,
                      uri: d,
                      mimeType: e,
                      isSkippable: false,
                      skipOffset: null,
                      skipFor: null,
                      canJump: true,
                      resumeOffset: null,
                      playoutLimit: null,
                      once: false,
                      pre: false,
                      post: false,
                      timelineRange: true,
                      loop: f,
                      overlay: n,
                      displayOnBackground: g == -1,
                      currentVideo: q,
                      background: h,
                      clickThroughUrl: null
                    }]);
                  }
                }
                p.addAdUrlInterstitial = function (a) {
                  var b = this,
                    c,
                    d,
                    e,
                    f,
                    g,
                    h,
                    k,
                    l,
                    m;
                  return P(function (n) {
                    if (n.g == 1) return c = {
                      type: 12
                    }, F(n, Ms(b, a, c), 2);
                    if (n.g != 3) {
                      d = n.h;
                      e = jd(d, "VAST,vmap:VMAP");
                      if (!e) throw new U(2, 10, 10007);
                      f = [];
                      if (e.tagName == "VAST") return f = js(e, b.l), n.A(3);
                      if (e.tagName != "vmap:VMAP") return n.A(3);
                      g = function g(q) {
                        var r, u;
                        return P(function (v) {
                          if (v.g == 1) return F(v, Ms(b, q.uri, c), 2);
                          r = v.h;
                          u = jd(r, "VAST");
                          if (!u) throw new U(2, 10, 10007);
                          f.push.apply(f, x(js(u, q.time)));
                          G(v);
                        });
                      };
                      h = [];
                      k = t(ls(e));
                      for (l = k.next(); !l.done; l = k.next()) m = l.value, h.push(g(m));
                      return h.length ? F(n, Promise.all(h), 3) : n.A(3);
                    }
                    Ks(b, f);
                    G(n);
                  });
                };
                function Ks(a, b) {
                  var c, d, e, f, g, h, k, l;
                  P(function (m) {
                    switch (m.g) {
                      case 1:
                        c = false, d = t(b), e = d.next();
                      case 2:
                        if (e.done) {
                          m.A(4);
                          break;
                        }
                        f = e.value;
                        if (!f.uri) {
                          ab("Missing URL in interstitial", f);
                          m.A(3);
                          break;
                        }
                        if (f.mimeType) {
                          m.A(5);
                          break;
                        }
                        ua(m, 6);
                        g = a.i.Wb();
                        return F(m, No(f.uri, g, a.C.getConfiguration().streaming.retryParameters), 8);
                      case 8:
                        f.mimeType = m.h;
                        xa(m, 5);
                        break;
                      case 6:
                        ya(m);
                      case 5:
                        h = f.id || JSON.stringify(f);
                        if (a.T.has(h)) {
                          m.A(3);
                          break;
                        }
                        f.loop && !f.overlay && ab("Loop is only supported in overlay interstitials", f);
                        f.overlay || (c = true);
                        a.T.add(h);
                        a.H.add(f);
                        k = false;
                        f.pre && a.l == null ? k = true : f.startTime != 0 || f.canJump ? a.l != null && (l = f.startTime - a.l, l > 0 && l <= 10 && (k = true)) : k = true;
                        k && (!a.F.has(f) && ys(f) && a.F.set(f, a.i.preload(f.uri, null, f.mimeType || void 0)), zs(a, f));
                      case 3:
                        e = d.next();
                        m.A(2);
                        break;
                      case 4:
                        c && Cs(a), Es(a), G(m);
                    }
                  });
                }
                function ws(a, b, c) {
                  b = b === void 0 ? false : b;
                  c = c === void 0 ? null : c;
                  var d = 0,
                    e = null;
                  if (a.H.size && a.l != null) {
                    var f = a.g.ended,
                      g = Array.from(a.H).sort(function (n, q) {
                        return q.startTime - n.startTime;
                      }),
                      h = g;
                    h = b ? g.filter(function (n) {
                      return n.pre;
                    }) : f ? g.filter(function (n) {
                      return n.post;
                    }) : g.filter(function (n) {
                      return !n.pre && !n.post;
                    });
                    g = t(h);
                    for (h = g.next(); !h.done; h = g.next()) {
                      h = h.value;
                      var k = false;
                      if (b) k = h.pre;else if (f) k = h.post;else if (!h.pre && !h.post) {
                        var l = a.l - Math.round(h.startTime * 1E3) / 1E3,
                          m = 1;
                        a.M.allowStartInMiddleOfInterstitial && h.endTime && h.endTime != Infinity && (m = h.endTime - h.startTime);
                        (l > 0 || l == 0 && a.l == 0) && (l <= m || !h.canJump) && (k = c == null && a.B && !a.B.pre && !a.B.post && a.B.startTime >= h.startTime ? false : true);
                      }
                      k && (!a.B || h.startTime >= a.B.startTime) && (d == (c || 0) ? e = h : e && !h.canJump && Math.round(h.startTime * 1E3) / 1E3 - Math.round(e.startTime * 1E3) / 1E3 > .001 && (e = h, d = 0), d++);
                    }
                  }
                  return e;
                }
                function xs(a, b, c, d, e, f) {
                  f = f === void 0 ? 0 : f;
                  a.B = b;
                  Ds(a);
                  a.u || !a.m || a.h.parentElement || a.m.appendChild(a.h);
                  d == 1 && c == 1 && (c = Array.from(a.H).filter(function (g) {
                    return b.pre ? g.pre == b.pre : b.post ? g.post == b.post : Math.abs(g.startTime - b.startTime) < .001;
                  }).length);
                  b.once && (f++, a.H.delete(b), Bs(a), b.overlay || Cs(a));
                  b.mimeType && (b.mimeType.startsWith("image/") || b.mimeType === "text/html") ? b.overlay ? Ns(a, b, c, d, f) : ab("Unsupported interstitial", b) : a.u && b.overlay ? ab("Unsupported interstitial", b) : Os(a, b, c, d, e, f);
                }
                function Ns(a, b, c, d, e) {
                  function f() {
                    a.o && (a.o.stop(), a.o = null);
                    a.m.removeChild(k);
                    Gs(a, b);
                    Ps(a, "ad-stopped");
                    a.j.Pa();
                    var q = ws(a, b.pre, d - e);
                    q ? xs(a, q, c, ++d, Date.now(), e) : a.J = false;
                  }
                  a.J = true;
                  var g = b.overlay,
                    h = b.mimeType == "text/html" ? "iframe" : "img",
                    k = document.createElement(h);
                  k.style.objectFit = "contain";
                  k.style.position = "absolute";
                  k.style.border = "none";
                  Qs(a, b);
                  var l = new ts(b, c, d);
                  Ps(a, "ad-impression");
                  Ps(a, "ad-started", new Map().set("ad", l));
                  h == "iframe" ? k.src = b.uri : (k.src = b.uri, k.onerror = function (q) {
                    Ps(a, "ad-error", new Map().set("originalEvent", q));
                    f();
                  });
                  l = g.viewport;
                  var m = g.topLeft;
                  g = g.size;
                  l.x == 0 && l.y == 0 ? (k.width = b.overlay.size.x, k.height = b.overlay.size.y, k.style.bottom = "10%", k.style.left = "0", k.style.right = "0", k.style.width = "100%", b.overlay.size.y || h != "iframe" || (k.style.height = "auto")) : (k.style.height = g.y / l.y * 100 + "%", k.style.left = m.x / l.x * 100 + "%", k.style.top = m.y / l.y * 100 + "%", k.style.width = g.x / l.x * 100 + "%");
                  a.m.appendChild(k);
                  var n = Date.now();
                  a.o && a.o.stop();
                  a.o = new df(function () {
                    b.playoutLimit && (Date.now() - n) / 1E3 > b.playoutLimit ? (Ps(a, "ad-complete"), f()) : b.endTime && a.g.currentTime > b.endTime ? (Ps(a, "ad-complete"), f()) : a.g.currentTime < b.startTime && (Ps(a, "ad-skipped"), f());
                  });
                  b.playoutLimit && !b.endTime ? a.o.ia(b.playoutLimit) : b.endTime && a.o.Ea(.025);
                  a.j.D(a.g, "seeked", function () {
                    var q = a.g.currentTime;
                    if (q < b.startTime || b.endTime && q > b.endTime) a.o && a.o.stop(), Ps(a, "ad-skipped"), f();
                  });
                  b.clickThroughUrl && a.j.D(k, "click", function () {
                    b.clickThroughUrl && window.open(b.clickThroughUrl, "_blank");
                  });
                }
                function Os(a, b, c, d, e, f) {
                  var g, h, k, l, m, n, q, r, u, v, _w3, z, y, B, D, I, C, A, E, J, H;
                  P(function (K) {
                    switch (K.g) {
                      case 1:
                        g = Date.now();
                        a.J = true;
                        h = false;
                        k = function k() {
                          if (!a.u && !b.overlay && b.resumeOffset == null) if (b.timelineRange && b.endTime && b.endTime != Infinity) a.g.currentTime != b.endTime && (a.g.currentTime = b.endTime);else {
                            var L = Date.now();
                            a.g.currentTime += (L - e) / 1E3;
                            e = L;
                          }
                        };
                        l = function l(L) {
                          var O, Q;
                          return P(function (N) {
                            if (N.g == 1) {
                              k();
                              O = ws(a, b.pre, d - f);
                              if (L && b.groupId) for (; O && O.groupId == b.groupId;) d++, O = ws(a, b.pre, d - f);
                              a.o && (!b.groupId || O && O.groupId != b.groupId) && (a.o.stop(), a.o = null);
                              Gs(a, b);
                              if (O && !O.overlay) return N.A(2);
                              b.post && (a.l = null, a.B = null);
                              return a.u ? F(N, a.i.detach(), 4) : F(N, a.i.Bc(), 4);
                            }
                            N.g != 2 && (a.u && (Q = b.resumeOffset, Q == null && (Q = b.timelineRange && b.endTime && b.endTime != Infinity ? b.endTime - (a.l || 0) : (Date.now() - e) / 1E3), Ps(a, "ad-content-resume-requested", new Map().set("offset", Q))), Ps(a, "ad-stopped"), a.j.Pa(), a.J = false, a.u ? Cs(a) : (a.h.style.display = "none", k(), a.g.ended || a.g.play()));
                            Ds(a);
                            O && (Ps(a, "ad-stopped"), a.j.Pa(), xs(a, O, c, ++d, e, f));
                            G(N);
                          });
                        };
                        m = function m(L) {
                          return P(function (O) {
                            if (h) return O.return();
                            h = true;
                            Ps(a, "ad-error", new Map().set("originalEvent", L));
                            return F(O, l(false), 0);
                          });
                        };
                        n = function n() {
                          return P(function (L) {
                            if (L.g == 1) {
                              if (h) return L.return();
                              h = true;
                              return F(L, l(false), 2);
                            }
                            Ps(a, "ad-complete");
                            G(L);
                          });
                        };
                        a.$ = function () {
                          return P(function (L) {
                            if (h) return L.return();
                            h = true;
                            Ps(a, "ad-skipped");
                            return F(L, l(true), 0);
                          });
                        };
                        q = new ss(a.h, b, a.$, c, d, !a.u);
                        a.u || (q.setMuted(a.g.muted), q.setVolume(a.g.volume));
                        Ps(a, "ad-started", new Map().set("ad", q));
                        (r = q.canSkipNow()) && Ps(a, "ad-skip-state-changed");
                        a.j.Ba(a.i, "error", m);
                        a.j.D(a.h, "timeupdate", function () {
                          if (a.h.duration) {
                            var L = q.canSkipNow();
                            r != L && q.getRemainingTime() > 0 && q.getDuration() > 0 && Ps(a, "ad-skip-state-changed");
                            r = L;
                            !a.u && !b.overlay && b.resumeOffset == null && b.timelineRange && b.endTime && b.endTime != Infinity && a.g.currentTime != b.endTime && a.C.Qa().end >= b.endTime && (a.g.currentTime = b.endTime);
                          }
                        });
                        a.j.Ba(a.i, "firstquartile", function () {
                          k();
                          Ps(a, "ad-first-quartile");
                        });
                        a.j.Ba(a.i, "midpoint", function () {
                          k();
                          Ps(a, "ad-midpoint");
                        });
                        a.j.Ba(a.i, "thirdquartile", function () {
                          k();
                          Ps(a, "ad-third-quartile");
                        });
                        a.j.Ba(a.i, "complete", n);
                        a.j.D(a.h, "play", function () {
                          Ps(a, "ad-resumed");
                        });
                        a.j.D(a.h, "pause", function () {
                          var L = a.i.getConfiguration();
                          a.h.currentTime >= L.playRangeEnd ? n() : Ps(a, "ad-paused");
                        });
                        a.j.D(a.h, "volumechange", function () {
                          a.h.muted ? Ps(a, "ad-muted") : Ps(a, "ad-volume-changed");
                        });
                        b.clickThroughUrl && (u = a.m || a.h, a.j.D(u, "click", function () {
                          b.clickThroughUrl && (q.isPaused() || q.pause(), window.open(b.clickThroughUrl, "_blank"));
                        }));
                        if (!a.u || d != 1) {
                          K.A(2);
                          break;
                        }
                        Ps(a, "ad-content-pause-requested", new Map().set("saveLivePosition", true));
                        v = new zg();
                        _w3 = function w(L) {
                          return P(function (O) {
                            if (O.g == 1) return L.state != "detach" ? O.A(0) : Fs() ? F(O, new Promise(function (Q) {
                              return new df(Q).ia(.1);
                            }), 3) : O.A(3);
                            v.resolve();
                            a.j.Ma(a.C, "onstatechange", _w3);
                            G(O);
                          });
                        };
                        a.j.D(a.C, "onstatechange", _w3);
                        return F(K, v, 2);
                      case 2:
                        return Qs(a, b), a.u || (a.h.style.display = "", b.overlay ? (a.h.loop = b.loop, z = b.overlay.viewport, y = b.overlay.topLeft, B = b.overlay.size, a.h.style.height = B.y / z.y * 100 + "%", a.h.style.left = y.x / z.x * 100 + "%", a.h.style.top = y.y / z.y * 100 + "%", a.h.style.width = B.x / z.x * 100 + "%") : (a.g.pause(), b.resumeOffset != null && b.resumeOffset != 0 && (a.g.currentTime += b.resumeOffset), a.h.loop = false, a.h.style.height = "100%", a.h.style.left = "0", a.h.style.top = "0", a.h.style.width = "100%")), ua(K, 4), vs(a), b.startTime && b.endTime && b.endTime != Infinity && b.startTime != b.endTime && (D = b.endTime - b.startTime, D > 0 && a.i.configure("playRangeEnd", D)), b.playoutLimit && !a.o && (a.o = new df(function () {
                          a.$();
                        }).ia(b.playoutLimit), a.i.configure("playRangeEnd", b.playoutLimit)), F(K, a.i.fc(a.h), 6);
                      case 6:
                        return I = null, a.M.allowStartInMiddleOfInterstitial && a.l != null && (C = a.l - b.startTime, Math.abs(C) > .25 && (I = C)), a.F.has(b) ? F(K, a.F.get(b), 10) : F(K, a.i.load(b.uri, I, b.mimeType || void 0), 8);
                      case 10:
                        return A = K.h, a.F.delete(b), A ? F(K, a.i.load(A), 8) : F(K, a.i.load(b.uri, I, b.mimeType || void 0), 8);
                      case 8:
                        b.overlay && a.g.paused ? a.h.pause() : a.h.play();
                        E = (Date.now() - g) / 1E3;
                        Ps(a, "ads-loaded", new Map().set("loadTime", E));
                        a.u && a.g.play();
                        b.overlay && (b.pre || b.post || a.C.W() && !(b.startTime > 0) || (J = function J() {
                          var L = a.g.currentTime - b.startTime;
                          Math.abs(L - a.h.currentTime) > .1 && (a.h.currentTime = L);
                        }, a.j.Ba(a.h, "playing", J), a.j.D(a.g, "seeking", J)), a.j.D(a.g, "seeked", function () {
                          var L = a.g.currentTime;
                          (L < b.startTime || b.endTime && L > b.endTime) && a.$();
                        }));
                        xa(K, 0);
                        break;
                      case 4:
                        H = ya(K);
                        if (!a.J) return K.return();
                        m(H);
                        G(K);
                    }
                  });
                }
                function Qs(a, b) {
                  b.displayOnBackground && (a.g.style.zIndex = "1");
                  if (b.currentVideo != null) {
                    var c = b.currentVideo;
                    a.g.style.transformOrigin = "top left";
                    var d = true,
                      e = [],
                      f = c.topLeft.x / c.viewport.x * 100;
                    f > 0 && f <= 100 && (e.push("translateX(" + f + "%)"), d = false);
                    f = c.topLeft.y / c.viewport.y * 100;
                    f > 0 && f <= 100 && (e.push("translateY(" + f + "%)"), d = false);
                    f = c.size.x / c.viewport.x;
                    f < 1 && e.push("scaleX(" + f + ")");
                    c = c.size.y / c.viewport.y;
                    f < 1 && e.push("scaleY(" + c + ")");
                    e.length && (a.g.style.transform = e.join(" "));
                    d && (a.g.style.transition = "transform 250ms");
                  }
                  a.m && (b.clickThroughUrl ? (a.m.setAttribute("ad-active", "true"), a.m.style.pointerEvents = "") : a.m.style.pointerEvents = "none", b.background && (a.m.style.background = b.background));
                  a.G && (a.G.style.background = b.overlay ? "" : "rgb(0, 0, 0)");
                }
                function Gs(a, b) {
                  if (!b || b.displayOnBackground) a.g.style.zIndex = "";
                  b && b.currentVideo == null || (a.g.style.transformOrigin = "", a.g.style.transition = "", a.g.style.transform = "");
                  a.m && (a.m.removeAttribute("ad-active"), a.m.style.pointerEvents = "", !b || b.background) && (a.m.style.background = "");
                  a.G && (a.G.style.background = "");
                }
                function Js(a, b) {
                  var c, d, e, f, g, h, k, l, m, n, q, r, u, v, w, z, y, B, D, I, C, A, E, J, H, K, L, O, Q, N, M, R, T, pa, Y, Ha, Ba, Ca, za, oa, wa, Fa;
                  return P(function (Ea) {
                    switch (Ea.g) {
                      case 1:
                        c = [];
                        if (!b) return Ea.return(c);
                        d = b.values.find(function (ta) {
                          return ta.key == "X-ASSET-URI";
                        });
                        e = b.values.find(function (ta) {
                          return ta.key == "X-ASSET-LIST";
                        });
                        if (!d && !e) return Ea.return(c);
                        f = null;
                        if (g = b.values.find(function (ta) {
                          return ta.key == "ID";
                        })) f = g.data;
                        h = f == null ? Math.floor(b.startTime * 10) / 10 : b.startTime;
                        (k = b.endTime) && b.endTime != Infinity && typeof b.endTime == "number" && (k = f == null ? Math.floor(b.endTime * 10) / 10 : b.endTime);
                        l = b.values.find(function (ta) {
                          return ta.key == "X-RESTRICT";
                        });
                        n = m = true;
                        l && l.data && (q = l.data, m = !q.includes("SKIP"), n = !q.includes("JUMP"));
                        r = m ? 0 : null;
                        if (u = b.values.find(function (ta) {
                          return ta.key == "X-ENABLE-SKIP-AFTER";
                        })) v = u.data, r = parseFloat(v), isNaN(r) && (r = m ? 0 : null);
                        w = null;
                        if (z = b.values.find(function (ta) {
                          return ta.key == "X-ENABLE-SKIP-FOR";
                        })) y = z.data, w = parseFloat(y), isNaN(r) && (w = null);
                        B = null;
                        if (D = b.values.find(function (ta) {
                          return ta.key == "X-RESUME-OFFSET";
                        })) I = D.data, B = parseFloat(I), isNaN(B) && (B = null);
                        C = null;
                        if (A = b.values.find(function (ta) {
                          return ta.key == "X-PLAYOUT-LIMIT";
                        })) E = A.data, C = parseFloat(E), isNaN(C) && (C = null);
                        K = H = J = false;
                        if (L = b.values.find(function (ta) {
                          return ta.key == "CUE";
                        })) O = L.data, J = O.includes("ONCE"), H = O.includes("PRE"), K = O.includes("POST");
                        Q = false;
                        (N = b.values.find(function (ta) {
                          return ta.key == "X-TIMELINE-OCCUPIES";
                        })) ? (M = N.data, Q = M.includes("RANGE")) : !D && a.C.W() && (Q = !H && !K);
                        if (d) {
                          R = d.data;
                          if (!R) return Ea.return(c);
                          c.push({
                            id: f,
                            groupId: null,
                            startTime: h,
                            endTime: k,
                            uri: R,
                            mimeType: null,
                            isSkippable: m,
                            skipOffset: r,
                            skipFor: w,
                            canJump: n,
                            resumeOffset: B,
                            playoutLimit: C,
                            once: J,
                            pre: H,
                            post: K,
                            timelineRange: Q,
                            loop: false,
                            overlay: null,
                            displayOnBackground: false,
                            currentVideo: null,
                            background: null,
                            clickThroughUrl: null
                          });
                          Ea.A(2);
                          break;
                        }
                        if (!e) {
                          Ea.A(2);
                          break;
                        }
                        T = e.data;
                        if (!T) return Ea.return(c);
                        ua(Ea, 4);
                        pa = {
                          type: 11
                        };
                        return F(Ea, Ms(a, T, pa), 6);
                      case 6:
                        Y = Ea.h;
                        Ha = dc(Y);
                        Ba = JSON.parse(Ha);
                        if (Ca = Ba["SKIP-CONTROL"]) za = Ca["ENABLE-SKIP-AFTER"], typeof za == "number" && (r = parseFloat(za), isNaN(za) && (r = m ? 0 : null)), oa = Ca["ENABLE-SKIP-FOR"], typeof oa == "number" && (w = parseFloat(oa), isNaN(oa) && (w = null));
                        for (wa = 0; wa < Ba.ASSETS.length; wa++) Fa = Ba.ASSETS[wa], Fa.URI && c.push({
                          id: f + "_shaka_asset_" + wa,
                          groupId: f,
                          startTime: h,
                          endTime: k,
                          uri: Fa.URI,
                          mimeType: null,
                          isSkippable: m,
                          skipOffset: r,
                          skipFor: w,
                          canJump: n,
                          resumeOffset: B,
                          playoutLimit: C,
                          once: J,
                          pre: H,
                          post: K,
                          timelineRange: Q,
                          loop: false,
                          overlay: null,
                          displayOnBackground: false,
                          currentVideo: null,
                          background: null,
                          clickThroughUrl: null
                        });
                        xa(Ea, 2);
                        break;
                      case 4:
                        ya(Ea);
                      case 2:
                        return Ea.return(c);
                    }
                  });
                }
                function Is(a) {
                  var b = [];
                  if (!a) return b;
                  var c = a.values.find(function (w) {
                    return w.key == "X-ASSET-URI";
                  });
                  if (!c) return b;
                  c = c.data;
                  if (!c) return b;
                  var d = null,
                    e = a.values.find(function (w) {
                      return w.key == "X-OVERLAY-ID";
                    });
                  e && (d = e.data);
                  e = d == null ? Math.floor(a.startTime * 10) / 10 : a.startTime;
                  var f = a.endTime;
                  a.endTime && a.endTime != Infinity && typeof a.endTime == "number" && (f = d == null ? Math.floor(a.endTime * 10) / 10 : a.endTime);
                  var g = false,
                    h = false,
                    k = false,
                    l = a.values.find(function (w) {
                      return w.key == "CUE";
                    });
                  l && (k = l.data, g = k.includes("ONCE"), h = k.includes("PRE"), k = k.includes("POST"));
                  l = null;
                  var m = a.values.find(function (w) {
                    return w.key == "X-ASSET-MIMETYPE";
                  });
                  m && (l = m.data);
                  m = false;
                  var n = a.values.find(function (w) {
                    return w.key == "X-LOOP";
                  });
                  n && (m = n.data == "YES");
                  n = 1;
                  var q = a.values.find(function (w) {
                    return w.key == "X-DEPTH";
                  });
                  q && (n = parseFloat(q.data), isNaN(n) && (n = 1));
                  q = null;
                  var r = a.values.find(function (w) {
                    return w.key == "X-BACKGROUND";
                  });
                  r && (q = r.data);
                  r = 1920;
                  var u = 1080,
                    v = a.values.find(function (w) {
                      return w.key == "X-VIEWPORT";
                    });
                  if (v) {
                    u = v.data.split("x");
                    if (u.length != 2) return b;
                    r = parseFloat(u[0]);
                    u = parseFloat(u[1]);
                  }
                  r = {
                    viewport: {
                      x: r,
                      y: u
                    },
                    topLeft: {
                      x: 0,
                      y: 0
                    },
                    size: {
                      x: r,
                      y: u
                    }
                  };
                  if (u = a.values.find(function (w) {
                    return w.key == "X-OVERLAY-POSITION";
                  })) {
                    u = u.data.split("x");
                    if (u.length != 2) return b;
                    r.topLeft.x = parseFloat(u[0]);
                    r.topLeft.y = parseFloat(u[1]);
                  }
                  if (u = a.values.find(function (w) {
                    return w.key == "X-OVERLAY-SIZE";
                  })) {
                    u = u.data.split("x");
                    if (u.length != 2) return b;
                    r.size.x = parseFloat(u[0]);
                    r.size.y = parseFloat(u[1]);
                  }
                  u = null;
                  if (v = a.values.find(function (w) {
                    return w.key == "X-SQUEEZECURRENT";
                  })) if (u = parseFloat(v.data), isNaN(u) && (u = 1), u = {
                    viewport: {
                      x: 1920,
                      y: 1080
                    },
                    topLeft: {
                      x: 0,
                      y: 0
                    },
                    size: {
                      x: 1920 * u,
                      y: 1080 * u
                    }
                  }, a = a.values.find(function (w) {
                    return w.key == "X-SQUEEZECURRENT-POSITION";
                  })) {
                    a = a.data.split("x");
                    if (a.length != 2) return b;
                    u.topLeft.x = parseFloat(a[0]);
                    u.topLeft.y = parseFloat(a[1]);
                  }
                  b.push({
                    id: d,
                    groupId: null,
                    startTime: e,
                    endTime: f,
                    uri: c,
                    mimeType: l,
                    isSkippable: false,
                    skipOffset: null,
                    skipFor: null,
                    canJump: true,
                    resumeOffset: null,
                    playoutLimit: null,
                    once: g,
                    pre: h,
                    post: k,
                    timelineRange: true,
                    loop: m,
                    overlay: r,
                    displayOnBackground: n == -1,
                    currentVideo: u,
                    background: q,
                    clickThroughUrl: null
                  });
                  return b;
                }
                function Cs(a) {
                  for (var b = [], c = t(a.H), d = c.next(), e = {}; !d.done; e = {
                    Ac: void 0
                  }, d = c.next()) d = d.value, d.overlay || (e.Ac = {
                    start: d.startTime,
                    end: null
                  }, d.pre ? (e.Ac.start = 0, e.Ac.end = null) : d.post ? (e.Ac.start = -1, e.Ac.end = null) : d.timelineRange && (e.Ac.end = d.endTime), b.find(function (f) {
                    return function (g) {
                      return f.Ac.start == g.start && f.Ac.end == g.end;
                    };
                  }(e)) || b.push(e.Ac));
                  Ps(a, "ad-cue-points-changed", new Map().set("cuepoints", b));
                }
                function vs(a) {
                  a.i.configure(a.C.ci());
                  a.i.configure("ads.disableHLSInterstitial", true);
                  a.i.configure("ads.disableDASHInterstitial", true);
                  a.i.configure("playRangeEnd", Infinity);
                  Qg(a.C.Wb(), a.i.Wb());
                }
                function Ms(a, b, c) {
                  var d, e, f;
                  return P(function (g) {
                    if (g.g == 1) return d = Rg([b], xg()), e = a.C.Wb().request(7, d, c), F(g, e.promise, 2);
                    f = g.h;
                    return g.return(f.data);
                  });
                }
                function ys(a) {
                  return (a = a.mimeType) ? !a.startsWith("image/") && a !== "text/html" : true;
                }
                function Fs() {
                  var a = tb().Ua();
                  return a == "TV" || a == "CONSOLE" || a == "CAST" ? true : false;
                }
                function zs(a, b) {
                  if (!(a.K.has(b) || a.M && !a.M.allowPreloadOnDomElements)) {
                    var c = function c(f) {
                        var g = document.createElement("link");
                        g.rel = "preload";
                        g.href = f;
                        g.as = "image";
                        document.head.appendChild(g);
                        return g;
                      },
                      d = [];
                    if (b.background) {
                      var e = b.background.match(/url\(('|")?([^'"()]+)('|")\)?/);
                      e && d.push(c(e[2]));
                    }
                    b.mimeType && b.mimeType.startsWith("image/") && d.push(c(b.uri));
                    a.K.set(b, d);
                  }
                }
                function As(a, b) {
                  if (a.K.has(b)) {
                    var c = a.K.get(b);
                    c = t(c);
                    for (var d = c.next(); !d.done; d = c.next()) d = d.value, d.parentNode.removeChild(d);
                    a.K.delete(b);
                  }
                }
                function Ps(a, b, c) {
                  a.va(new V(b, c));
                }
                function Rs(a, b, c, d, e) {
                  this.h = a;
                  this.j = ed(this.h.skipOffset);
                  this.g = e;
                  this.i = b;
                  this.l = c;
                  this.o = d;
                  this.m = false;
                }
                p = Rs.prototype;
                p.needsSkipUI = function () {
                  return true;
                };
                p.isClientRendering = function () {
                  return false;
                };
                p.hasCustomClick = function () {
                  return false;
                };
                p.isUsingAnotherMediaElement = function () {
                  return false;
                };
                p.getDuration = function () {
                  return this.h.durationInSeconds;
                };
                p.getMinSuggestedDuration = function () {
                  return this.getDuration();
                };
                p.getRemainingTime = function () {
                  return this.h.startTimeInSeconds + this.h.durationInSeconds - this.g.currentTime;
                };
                p.isPaused = function () {
                  return this.g.paused;
                };
                p.isSkippable = function () {
                  return typeof this.j == "number" ? true : false;
                };
                p.getTimeUntilSkippable = function () {
                  if (typeof this.j != "number") return this.getRemainingTime();
                  var a = this.getRemainingTime() + this.j - this.getDuration();
                  return Math.max(a, 0);
                };
                p.canSkipNow = function () {
                  return this.getTimeUntilSkippable() == 0;
                };
                p.skip = function () {
                  this.m = true;
                  this.g.currentTime += this.getRemainingTime();
                };
                p.pause = function () {
                  return this.g.pause();
                };
                p.play = function () {
                  return this.g.play();
                };
                p.getVolume = function () {
                  return this.g.volume;
                };
                p.setVolume = function (a) {
                  this.g.volume = a;
                };
                p.isMuted = function () {
                  return this.g.muted;
                };
                p.isLinear = function () {
                  return this.o;
                };
                p.resize = function () {};
                p.setMuted = function (a) {
                  this.g.muted = a;
                };
                p.getSequenceLength = function () {
                  return this.l ? this.l : 1;
                };
                p.getPositionInSequence = function () {
                  return this.i ? this.i : 1;
                };
                p.getTitle = function () {
                  return this.h.adTitle;
                };
                p.getDescription = function () {
                  return "";
                };
                p.getVastMediaBitrate = function () {
                  return 0;
                };
                p.getVastMediaHeight = function () {
                  return 0;
                };
                p.getVastMediaWidth = function () {
                  return 0;
                };
                p.getVastAdId = function () {
                  return this.h.vastAdId || "";
                };
                p.getAdId = function () {
                  return this.h.adId;
                };
                p.getCreativeAdId = function () {
                  return this.h.creativeId;
                };
                p.getAdvertiserName = function () {
                  return "";
                };
                p.getMediaUrl = function () {
                  return null;
                };
                p.getTimeOffset = function () {
                  return 0;
                };
                p.getPodIndex = function () {
                  return 0;
                };
                p.release = function () {
                  this.l = this.i = this.g = this.h = null;
                };
                S("shaka.ads.MediaTailorAd", Rs);
                Rs.prototype.release = Rs.prototype.release;
                Rs.prototype.getPodIndex = Rs.prototype.getPodIndex;
                Rs.prototype.getTimeOffset = Rs.prototype.getTimeOffset;
                Rs.prototype.getMediaUrl = Rs.prototype.getMediaUrl;
                Rs.prototype.getAdvertiserName = Rs.prototype.getAdvertiserName;
                Rs.prototype.getCreativeAdId = Rs.prototype.getCreativeAdId;
                Rs.prototype.getAdId = Rs.prototype.getAdId;
                Rs.prototype.getVastAdId = Rs.prototype.getVastAdId;
                Rs.prototype.getVastMediaWidth = Rs.prototype.getVastMediaWidth;
                Rs.prototype.getVastMediaHeight = Rs.prototype.getVastMediaHeight;
                Rs.prototype.getVastMediaBitrate = Rs.prototype.getVastMediaBitrate;
                Rs.prototype.getDescription = Rs.prototype.getDescription;
                Rs.prototype.getTitle = Rs.prototype.getTitle;
                Rs.prototype.getPositionInSequence = Rs.prototype.getPositionInSequence;
                Rs.prototype.getSequenceLength = Rs.prototype.getSequenceLength;
                Rs.prototype.setMuted = Rs.prototype.setMuted;
                Rs.prototype.resize = Rs.prototype.resize;
                Rs.prototype.isLinear = Rs.prototype.isLinear;
                Rs.prototype.isMuted = Rs.prototype.isMuted;
                Rs.prototype.setVolume = Rs.prototype.setVolume;
                Rs.prototype.getVolume = Rs.prototype.getVolume;
                Rs.prototype.play = Rs.prototype.play;
                Rs.prototype.pause = Rs.prototype.pause;
                Rs.prototype.skip = Rs.prototype.skip;
                Rs.prototype.canSkipNow = Rs.prototype.canSkipNow;
                Rs.prototype.getTimeUntilSkippable = Rs.prototype.getTimeUntilSkippable;
                Rs.prototype.isSkippable = Rs.prototype.isSkippable;
                Rs.prototype.isPaused = Rs.prototype.isPaused;
                Rs.prototype.getRemainingTime = Rs.prototype.getRemainingTime;
                Rs.prototype.getMinSuggestedDuration = Rs.prototype.getMinSuggestedDuration;
                Rs.prototype.getDuration = Rs.prototype.getDuration;
                Rs.prototype.isUsingAnotherMediaElement = Rs.prototype.isUsingAnotherMediaElement;
                Rs.prototype.hasCustomClick = Rs.prototype.hasCustomClick;
                Rs.prototype.isClientRendering = Rs.prototype.isClientRendering;
                Rs.prototype.needsSkipUI = Rs.prototype.needsSkipUI;
                function Ss(a, b, c, d) {
                  this.C = a;
                  this.K = b;
                  this.h = c;
                  this.l = null;
                  this.R = NaN;
                  this.i = d;
                  this.J = false;
                  this.B = null;
                  this.j = [];
                  this.N = [];
                  this.M = this.F = this.g = null;
                  this.G = new Map();
                  this.m = [];
                  this.u = [];
                  this.H = "";
                  this.O = true;
                  this.I = "";
                  this.o = new nb();
                }
                Ss.prototype.stop = function () {
                  for (var a = t(this.m), b = a.next(); !b.done; b = a.next()) b = b.value, this.o.Ma(b.target, b.type, b.listener);
                  Ts(this);
                  this.m = [];
                  this.u = [];
                  this.H = "";
                  this.O = true;
                  this.I = "";
                  this.B = null;
                  this.j = [];
                  this.N = [];
                  this.G.clear();
                };
                Ss.prototype.release = function () {
                  this.stop();
                  this.o && this.o.release();
                };
                Ss.prototype.onManifestUpdated = function (a) {
                  this.J = a;
                  this.H != "" && (Us(this, this.H, this.O), this.O = false);
                };
                Ss.prototype.getCuePoints = function () {
                  for (var a = [], b = t(this.j), c = b.next(); !c.done; c = b.next()) {
                    c = t(c.value.ads);
                    for (var d = c.next(); !d.done; d = c.next()) d = d.value, a.push({
                      start: d.startTimeInSeconds,
                      end: d.startTimeInSeconds + d.durationInSeconds
                    });
                  }
                  return a;
                };
                function Vs(a, b, c) {
                  var d, e, f, g, h, k, l, m, n, q, r, u;
                  P(function (v) {
                    if (v.g == 1) return d = {
                      type: 7
                    }, e = Rg([b], xg()), e.method = "POST", c && (f = JSON.stringify(c), e.body = ic(f)), g = a.K.request(7, e, d), ua(v, 2), F(v, g.promise, 4);
                    if (v.g != 2) {
                      h = v.h;
                      k = dc(h.data);
                      l = JSON.parse(k);
                      if (l.manifestUrl && l.trackingUrl) m = new Db(b), n = new Db(l.trackingUrl), a.H = m.resolve(n).toString(), q = Date.now() / 1E3, r = q - a.R, a.i(new V("ads-loaded", new Map().set("loadTime", r))), u = new Db(l.manifestUrl), a.l.resolve(m.resolve(u).toString()), a.l = null;else throw Error("Insufficient data from MediaTailor.");
                      return xa(v, 0);
                    }
                    ya(v);
                    if (!a.I.length) return a.l.reject("MediaTailor request returned an error and there was no backup asset uri provided."), a.l = null, v.return();
                    a.l.resolve(a.I);
                    a.l = null;
                    G(v);
                  });
                }
                function Us(a, b, c) {
                  var d, e, f, g, h, k, l, m, n, q, r, u, v, w, z, y;
                  P(function (B) {
                    if (B.g == 1) return d = {
                      type: 8
                    }, e = Rg([b], xg()), f = a.K.request(7, e, d), ua(B, 2), F(B, f.promise, 4);
                    if (B.g != 2) {
                      g = B.h;
                      h = [];
                      k = dc(g.data);
                      l = JSON.parse(k);
                      if (l.avails.length > 0) {
                        if (JSON.stringify(a.j) != JSON.stringify(l.avails)) {
                          a.j = l.avails;
                          m = t(a.j);
                          for (n = m.next(); !n.done; n = m.next()) for (q = n.value, r = t(q.nonLinearAdsList), u = r.next(); !u.done; u = r.next()) for (v = u.value, w = t(v.nonLinearAdList), z = w.next(); !z.done; z = w.next()) y = z.value, Ws(a, y);
                          h = a.getCuePoints();
                          a.i(new V("ad-cue-points-changed", new Map().set("cuepoints", h)));
                        }
                      } else a.j.length && a.i(new V("ad-cue-points-changed", new Map().set("cuepoints", h))), Ts(a), a.j = [];
                      c && (a.J || h.length > 0) && Xs(a);
                      return xa(B, 0);
                    }
                    ya(B);
                    G(B);
                  });
                }
                function Ws(a, b) {
                  var c, e, f, g, h, k, l, m;
                  P(function (n) {
                    if (n.g == 1) {
                      if (!b.staticResource) return n.return();
                      c = Ys(b);
                      if (a.G.get(c)) return n.return();
                      e = {
                        type: 9
                      };
                      f = Rg([b.staticResource], xg());
                      g = a.K.request(7, f, e);
                      ua(n, 2);
                      a.G.set(c, []);
                      return F(n, g.promise, 4);
                    }
                    if (n.g != 2) return h = n.h, k = dc(h.data), l = JSON.parse(k), m = l.apps, a.G.set(c, m), xa(n, 0);
                    ya(n);
                    a.G.delete(c);
                    G(n);
                  });
                }
                function Ys(a) {
                  return [a.adId, a.adParameters, a.adSystem, a.adTitle, a.creativeAdId, a.creativeId, a.creativeSequence, a.height, a.width, a.staticResource].join("");
                }
                function Xs(a) {
                  Zs(a);
                  a.J || ($s(a), a.o.D(a.h, "seeked", function () {
                    $s(a);
                  }), a.o.D(a.h, "ended", function () {
                    Ts(a);
                  }));
                  a.o.D(a.h, "timeupdate", function () {
                    Zs(a);
                  });
                }
                function $s(a) {
                  var b = a.h.currentTime;
                  if (b != 0 && a.B == null) {
                    for (var c, d, e = t(a.j), f = e.next(); !f.done; f = e.next()) {
                      f = f.value;
                      for (var g = t(f.ads), h = g.next(); !h.done; h = g.next()) if (h = h.value, !d) h.startTimeInSeconds < b && (d = h, c = f);else if (h.startTimeInSeconds < b && h.startTimeInSeconds > d.startTimeInSeconds + d.durationInSeconds) {
                        d = h;
                        c = f;
                        break;
                      }
                    }
                    c && d && !a.N.includes(d.adId) && (a.B = b, a.h.currentTime = c.startTimeInSeconds);
                  }
                }
                function Zs(a) {
                  if (a.h.duration && (a.g || a.j.length)) {
                    var b = a.h.currentTime,
                      c = false;
                    if (a.g) {
                      c = true;
                      var d = a.F,
                        e = d.startTimeInSeconds + .5 * d.durationInSeconds,
                        f = d.startTimeInSeconds + .75 * d.durationInSeconds;
                      b >= d.startTimeInSeconds + .25 * d.durationInSeconds && !a.u.includes("firstQuartile") ? (a.u.push("firstQuartile"), at(a, "firstQuartile")) : b >= e && !a.u.includes("midpoint") ? (a.u.push("midpoint"), at(a, "midpoint")) : b >= f && !a.u.includes("thirdQuartile") && (a.u.push("thirdQuartile"), at(a, "thirdQuartile"));
                      d = a.g.getRemainingTime();
                      e = a.g.getDuration();
                      a.g.canSkipNow() && d > 0 && e > 0 && at(a, "skipStateChanged");
                      e > 0 && (d <= 0 || d > e) && Ts(a);
                    }
                    if (!a.g || !a.g.isLinear()) {
                      a: for (d = t(a.j), e = d.next(); !e.done; e = d.next()) {
                        e = e.value;
                        if (a.g && a.g.isLinear()) break;
                        for (f = 0; f < e.ads.length; f++) {
                          var g = e.ads[f],
                            h = g.startTimeInSeconds + g.durationInSeconds;
                          if (g.startTimeInSeconds <= b && h > b) {
                            if (a.N.includes(g.adId)) {
                              if (a.h.ended) continue;
                              a.h.currentTime = h;
                              break a;
                            }
                            Ts(a);
                            a.M = e;
                            a.g = new Rs(g, f + 1, e.ads.length, true, a.h);
                            a.F = g;
                            f === 0 && at(a, "breakStart");
                            bt(a);
                            break;
                          }
                        }
                      }
                      if (!a.g) for (d = t(a.j), e = d.next(); !e.done; e = d.next()) {
                        e = e.value;
                        if (a.g) break;
                        for (f = 0; f < e.nonLinearAdsList.length; f++) if (g = e.nonLinearAdsList[f], g.nonLinearAdList.length) {
                          h = e.startTimeInSeconds;
                          var k = a.G.get(Ys(g.nonLinearAdList[0]));
                          if (h <= b && k && k.length) {
                            Ts(a);
                            h = a;
                            k = t(k);
                            for (var l = k.next(); !l.done; l = k.next()) if (l = l.value, l.data.source.length) {
                              var m = document.createElement("img");
                              m.src = l.data.source[0].url;
                              m.style.top = (l.placeholder.top || 0) + "%";
                              m.style.height = 100 - (l.placeholder.top || 0) + "%";
                              m.style.left = (l.placeholder.left || 0) + "%";
                              m.style.maxWidth = 100 - (l.placeholder.left || 0) + "%";
                              m.style.objectFit = "contain";
                              m.style.position = "absolute";
                              h.C.appendChild(m);
                            }
                            a.M = e;
                            a.g = new Rs(g, f + 1, e.ads.length, false, a.h);
                            a.F = g;
                            f === 0 && at(a, "breakStart");
                            bt(a);
                            break;
                          }
                        }
                      }
                      c && !a.g && (b = a.h.currentTime, a.B && a.B > b && (a.h.currentTime = a.B), a.B = null);
                    }
                  }
                }
                function Ts(a) {
                  if (a.g) {
                    for (; a.C.lastChild;) a.C.removeChild(a.C.firstChild);
                    a.J || a.N.push(a.F.adId);
                    var b = a.g.m;
                    (b === void 0 ? 0 : b) ? at(a, "skip") : at(a, "complete");
                    b = t(a.m);
                    for (var c = b.next(); !c.done; c = b.next()) c = c.value, a.o.Ma(c.target, c.type, c.listener);
                    a.m = [];
                    a.u = [];
                    b = a.g.getPositionInSequence();
                    c = a.g.getSequenceLength();
                    b === c && at(a, "breakEnd");
                    a.g = null;
                    a.F = null;
                    a.M = null;
                  }
                }
                function bt(a) {
                  var b = false;
                  a.h.paused ? b = true : (at(a, "impression"), at(a, "start"));
                  a.m.push({
                    target: a.h,
                    type: "volumechange",
                    listener: function listener() {
                      a.h.muted && at(a, "mute");
                    }
                  });
                  a.m.push({
                    target: a.h,
                    type: "volumechange",
                    listener: function listener() {
                      a.h.muted || at(a, "unmute");
                    }
                  });
                  a.m.push({
                    target: a.h,
                    type: "play",
                    listener: function listener() {
                      b ? (at(a, "impression"), at(a, "start"), b = false) : at(a, "resume");
                    }
                  });
                  a.m.push({
                    target: a.h,
                    type: "pause",
                    listener: function listener() {
                      at(a, "pause");
                    }
                  });
                  for (var c = t(a.m), d = c.next(); !d.done; d = c.next()) d = d.value, a.o.D(d.target, d.type, d.listener);
                }
                function at(a, b) {
                  var c = a.F.trackingEvents.find(function (f) {
                    return f.eventType == b;
                  });
                  c || (c = a.M.adBreakTrackingEvents.find(function (f) {
                    return f.eventType == b;
                  }));
                  if (c) {
                    var d = {
                      type: 10
                    };
                    c = t(c.beaconUrls);
                    for (var e = c.next(); !e.done; e = c.next()) (e = e.value) && e != "" && (e = Rg([e], xg()), e.method = "POST", a.K.request(7, e, d));
                  }
                  switch (b) {
                    case "impression":
                      a.i(new V("ad-impression"));
                      break;
                    case "start":
                      a.i(new V("ad-started", new Map().set("ad", a.g)));
                      break;
                    case "mute":
                      a.i(new V("ad-muted"));
                      break;
                    case "unmute":
                      a.i(new V("ad-volume-changed"));
                      break;
                    case "resume":
                      a.i(new V("ad-resumed"));
                      break;
                    case "pause":
                      a.i(new V("ad-paused"));
                      break;
                    case "firstQuartile":
                      a.i(new V("ad-first-quartile"));
                      break;
                    case "midpoint":
                      a.i(new V("ad-midpoint"));
                      break;
                    case "thirdQuartile":
                      a.i(new V("ad-third-quartile"));
                      break;
                    case "complete":
                      a.i(new V("ad-complete"));
                      a.i(new V("ad-stopped"));
                      break;
                    case "skip":
                      a.i(new V("ad-skipped"));
                      a.i(new V("ad-stopped"));
                      break;
                    case "breakStart":
                      a.C.setAttribute("ad-active", "true");
                      break;
                    case "breakEnd":
                      a.C.removeAttribute("ad-active");
                      break;
                    case "skipStateChanged":
                      a.i(new V("ad-skip-state-changed"));
                  }
                }
                function ct(a, b) {
                  this.g = a;
                  this.i = null;
                  this.h = b;
                }
                p = ct.prototype;
                p.needsSkipUI = function () {
                  return true;
                };
                p.isClientRendering = function () {
                  return false;
                };
                p.hasCustomClick = function () {
                  return true;
                };
                p.isUsingAnotherMediaElement = function () {
                  return false;
                };
                p.getDuration = function () {
                  return this.i ? this.i.duration : -1;
                };
                p.getMinSuggestedDuration = function () {
                  return this.getDuration();
                };
                p.getRemainingTime = function () {
                  return this.i ? this.i.duration - this.i.currentTime : -1;
                };
                p.isPaused = function () {
                  return this.h.paused;
                };
                p.isSkippable = function () {
                  return this.g.isSkippable();
                };
                p.getTimeUntilSkippable = function () {
                  var a = this.g.getSkipTimeOffset();
                  a = this.getRemainingTime() - a;
                  return Math.max(a, 0);
                };
                p.canSkipNow = function () {
                  return this.getTimeUntilSkippable() == 0;
                };
                p.skip = function () {
                  this.h.currentTime += this.getRemainingTime();
                };
                p.pause = function () {
                  return this.h.pause();
                };
                p.play = function () {
                  return this.h.play();
                };
                p.getVolume = function () {
                  return this.h.volume;
                };
                p.setVolume = function (a) {
                  this.h.volume = a;
                };
                p.isMuted = function () {
                  return this.h.muted;
                };
                p.isLinear = function () {
                  return true;
                };
                p.resize = function () {};
                p.setMuted = function (a) {
                  this.h.muted = a;
                };
                p.getSequenceLength = function () {
                  var a = this.g.getAdPodInfo();
                  return a == null ? 1 : a.getTotalAds();
                };
                p.getPositionInSequence = function () {
                  var a = this.g.getAdPodInfo();
                  return a == null ? 1 : a.getAdPosition();
                };
                p.getTitle = function () {
                  return this.g.getTitle();
                };
                p.getDescription = function () {
                  return this.g.getDescription();
                };
                p.getVastMediaBitrate = function () {
                  return 0;
                };
                p.getVastMediaHeight = function () {
                  return this.g.getVastMediaHeight();
                };
                p.getVastMediaWidth = function () {
                  return this.g.getVastMediaWidth();
                };
                p.getVastAdId = function () {
                  return "";
                };
                p.getAdId = function () {
                  return this.g.getAdId();
                };
                p.getCreativeAdId = function () {
                  return this.g.getCreativeAdId();
                };
                p.getAdvertiserName = function () {
                  return this.g.getAdvertiserName();
                };
                p.getMediaUrl = function () {
                  return null;
                };
                p.getTimeOffset = function () {
                  var a = this.g.getAdPodInfo();
                  return a == null ? 0 : a.getTimeOffset();
                };
                p.getPodIndex = function () {
                  var a = this.g.getAdPodInfo();
                  return a == null ? 0 : a.getPodIndex();
                };
                p.release = function () {
                  this.h = this.i = this.g = null;
                };
                S("shaka.ads.ServerSideAd", ct);
                ct.prototype.release = ct.prototype.release;
                ct.prototype.getPodIndex = ct.prototype.getPodIndex;
                ct.prototype.getTimeOffset = ct.prototype.getTimeOffset;
                ct.prototype.getMediaUrl = ct.prototype.getMediaUrl;
                ct.prototype.getAdvertiserName = ct.prototype.getAdvertiserName;
                ct.prototype.getCreativeAdId = ct.prototype.getCreativeAdId;
                ct.prototype.getAdId = ct.prototype.getAdId;
                ct.prototype.getVastAdId = ct.prototype.getVastAdId;
                ct.prototype.getVastMediaWidth = ct.prototype.getVastMediaWidth;
                ct.prototype.getVastMediaHeight = ct.prototype.getVastMediaHeight;
                ct.prototype.getVastMediaBitrate = ct.prototype.getVastMediaBitrate;
                ct.prototype.getDescription = ct.prototype.getDescription;
                ct.prototype.getTitle = ct.prototype.getTitle;
                ct.prototype.getPositionInSequence = ct.prototype.getPositionInSequence;
                ct.prototype.getSequenceLength = ct.prototype.getSequenceLength;
                ct.prototype.setMuted = ct.prototype.setMuted;
                ct.prototype.resize = ct.prototype.resize;
                ct.prototype.isLinear = ct.prototype.isLinear;
                ct.prototype.isMuted = ct.prototype.isMuted;
                ct.prototype.setVolume = ct.prototype.setVolume;
                ct.prototype.getVolume = ct.prototype.getVolume;
                ct.prototype.play = ct.prototype.play;
                ct.prototype.pause = ct.prototype.pause;
                ct.prototype.skip = ct.prototype.skip;
                ct.prototype.canSkipNow = ct.prototype.canSkipNow;
                ct.prototype.getTimeUntilSkippable = ct.prototype.getTimeUntilSkippable;
                ct.prototype.isSkippable = ct.prototype.isSkippable;
                ct.prototype.isPaused = ct.prototype.isPaused;
                ct.prototype.getRemainingTime = ct.prototype.getRemainingTime;
                ct.prototype.getMinSuggestedDuration = ct.prototype.getMinSuggestedDuration;
                ct.prototype.getDuration = ct.prototype.getDuration;
                ct.prototype.isUsingAnotherMediaElement = ct.prototype.isUsingAnotherMediaElement;
                ct.prototype.hasCustomClick = ct.prototype.hasCustomClick;
                ct.prototype.isClientRendering = ct.prototype.isClientRendering;
                ct.prototype.needsSkipUI = ct.prototype.needsSkipUI;
                function dt(a, b, c, d) {
                  var e = this;
                  this.u = a;
                  this.l = b;
                  this.j = null;
                  this.G = NaN;
                  this.i = d;
                  this.H = false;
                  this.B = this.m = this.o = null;
                  this.C = "";
                  this.F = [];
                  this.h = new nb();
                  a = new google.ima.dai.api.UiSettings();
                  a.setLocale(c);
                  this.g = new google.ima.dai.api.StreamManager(this.l, this.u, a);
                  this.i(new V("ima-stream-manager-loaded", new Map().set("imaStreamManager", this.g)));
                  this.h.D(this.g, google.ima.dai.api.StreamEvent.Type.LOADED, function (f) {
                    et(e, f);
                  });
                  this.h.D(this.g, google.ima.dai.api.StreamEvent.Type.ERROR, function () {
                    e.C.length ? e.j.resolve(e.C) : e.j.reject("IMA Stream request returned an error and there was no backup asset uri provided.");
                    e.j = null;
                  });
                  this.h.D(this.g, google.ima.dai.api.StreamEvent.Type.AD_BREAK_STARTED, function () {});
                  this.h.D(this.g, google.ima.dai.api.StreamEvent.Type.STARTED, function (f) {
                    f = f.getAd();
                    e.m = new ct(f, e.l);
                    e.B && (e.m.i = e.B);
                    e.i(new V("ad-started", new Map().set("ad", e.m)));
                    e.u.setAttribute("ad-active", "true");
                  });
                  this.h.D(this.g, google.ima.dai.api.StreamEvent.Type.AD_BREAK_ENDED, function () {
                    e.u.removeAttribute("ad-active");
                    var f = e.l.currentTime;
                    e.o && e.o > f && (e.l.currentTime = e.o, e.o = null);
                  });
                  this.h.D(this.g, google.ima.dai.api.StreamEvent.Type.AD_PROGRESS, function (f) {
                    e.B = f.getStreamData().adProgressData;
                    e.m && (e.m.i = e.B);
                  });
                  this.h.D(this.g, google.ima.dai.api.StreamEvent.Type.FIRST_QUARTILE, function () {
                    e.i(new V("ad-first-quartile"));
                  });
                  this.h.D(this.g, google.ima.dai.api.StreamEvent.Type.MIDPOINT, function () {
                    e.i(new V("ad-midpoint"));
                  });
                  this.h.D(this.g, google.ima.dai.api.StreamEvent.Type.THIRD_QUARTILE, function () {
                    e.i(new V("ad-third-quartile"));
                  });
                  this.h.D(this.g, google.ima.dai.api.StreamEvent.Type.COMPLETE, function () {
                    e.i(new V("ad-complete"));
                    e.i(new V("ad-stopped"));
                    e.u.removeAttribute("ad-active");
                    e.m = null;
                  });
                  this.h.D(this.g, google.ima.dai.api.StreamEvent.Type.SKIPPED, function () {
                    e.i(new V("ad-skipped"));
                    e.i(new V("ad-stopped"));
                  });
                  this.h.D(this.g, google.ima.dai.api.StreamEvent.Type.CUEPOINTS_CHANGED, function (f) {
                    var g = f.getStreamData();
                    f = [];
                    g = t(g.cuepoints);
                    for (var h = g.next(); !h.done; h = g.next()) h = h.value, f.push({
                      start: h.start,
                      end: h.end
                    });
                    e.F = f;
                    e.i(new V("ad-cue-points-changed", new Map().set("cuepoints", f)));
                  });
                }
                p = dt.prototype;
                p.configure = function () {};
                p.stop = function () {
                  this.C = "";
                  this.o = null;
                  this.F = [];
                };
                p.release = function () {
                  this.stop();
                  this.h && this.h.release();
                };
                p.onCueMetadataChange = function (a) {
                  if (a.key && a.data) {
                    var b = {};
                    b[a.key] = a.data;
                    this.g.onTimedMetadata(b);
                  }
                };
                p.getCuePoints = function () {
                  return this.F;
                };
                function et(a, b) {
                  a.i(new V("ads-loaded", new Map().set("loadTime", Date.now() / 1E3 - a.G)));
                  b = b.getStreamData().url;
                  a.j.resolve(b);
                  a.j = null;
                  a.H || a.h.D(a.l, "seeked", function () {
                    var c = a.l.currentTime;
                    if (c != 0) {
                      a.g.streamTimeForContentTime(c);
                      var d = a.g.previousCuePointForStreamTime(c);
                      d && !d.played && (a.o = c, a.l.currentTime = d.start);
                    }
                  });
                }
                function Z() {
                  Jg.call(this);
                  this.h = this.i = this.j = this.g = null;
                  this.m = new fs();
                  this.o = navigator.language;
                  this.l = null;
                }
                la(Z, Jg);
                p = Z.prototype;
                p.setLocale = function (a) {
                  this.o = a;
                };
                p.configure = function (a) {
                  this.l = a;
                  this.g && this.g.configure(this.l);
                  this.j && this.j.configure(this.l);
                  this.h && this.h.configure(this.l);
                };
                p.initInterstitial = function (a, b, c) {
                  var d = this;
                  this.g && this.g.release();
                  this.g = new us(a, b, c, function (e) {
                    return ft(d, e);
                  });
                  this.g.configure(this.l);
                };
                p.initClientSide = function (a, b, c) {
                  var d = this;
                  if (!window.google || !google.ima || !google.ima.AdsLoader) throw new U(2, 10, 1E4);
                  this.j && this.j.release();
                  this.j = new ms(a, b, this.o, c, function (e) {
                    return ft(d, e);
                  });
                  this.j.configure(this.l);
                };
                p.release = function () {
                  this.g && (this.g.release(), this.g = null);
                  this.j && (this.j.release(), this.j = null);
                  this.i && (this.i.release(), this.i = null);
                  this.h && (this.h.release(), this.h = null);
                  Jg.prototype.release.call(this);
                };
                p.onAssetUnload = function () {
                  this.g && this.g.stop();
                  this.j && this.j.stop();
                  this.i && this.i.stop();
                  this.h && this.h.stop();
                  this.dispatchEvent(new V("ad-stopped"));
                  this.dispatchEvent(new V("ad-content-attach-requested"));
                  this.m = new fs();
                };
                p.requestClientSideAds = function (a) {
                  if (!this.j) throw new U(1, 10, 10001);
                  var b = this.j;
                  b.g && b.g.destroy();
                  b.m && b.m.contentComplete();
                  b.H = Date.now() / 1E3;
                  b.m.requestAds(a);
                };
                p.updateClientSideAdsRenderingSettings = function (a) {
                  if (!this.j) throw new U(1, 10, 10001);
                  var b = this.j;
                  b.C = a;
                  b.g && b.g.updateAdsRenderingSettings(b.C);
                };
                p.initMediaTailor = function (a, b, c) {
                  var d = this;
                  this.i && this.i.release();
                  this.i = new Ss(a, b, c, function (e) {
                    return ft(d, e);
                  });
                };
                p.requestMediaTailorStream = function (a, b, c) {
                  if (!this.i) throw new U(1, 10, 10005);
                  var d = this.i;
                  c = c === void 0 ? "" : c;
                  d.l ? a = Promise.reject(new U(1, 10, 10004)) : (d.l = new zg(), Vs(d, a, b), d.I = c || "", d.R = Date.now() / 1E3, a = d.l);
                  return a;
                };
                p.addMediaTailorTrackingUrl = function (a) {
                  if (!this.i) throw new U(1, 10, 10005);
                  var b = this.i;
                  b.H = a;
                  b.i(new V("ads-loaded", new Map().set("loadTime", 0)));
                };
                p.initServerSide = function (a, b) {
                  var c = this;
                  if (!window.google || !google.ima || !google.ima.dai) throw new U(2, 10, 10002);
                  this.h && this.h.release();
                  this.h = new dt(a, b, this.o, function (d) {
                    return ft(c, d);
                  });
                  this.h.configure(this.l);
                };
                p.requestServerSideStream = function (a, b) {
                  b = b === void 0 ? "" : b;
                  if (!this.h) throw new U(1, 10, 10003);
                  a.adTagParameters || (a.adTagParameters = {});
                  var c = a.adTagParameters;
                  (c.mpt || c.mpv) && ab('You have attempted to set "mpt" and/or "mpv" parameters of the ad tag. Please note that those parameters are used for Shaka adoption tracking and will be overridden.');
                  a.adTagParameters.mpt = "shaka-player";
                  a.adTagParameters.mpv = "v4.16.5";
                  c = this.h;
                  c.j ? a = Promise.reject(new U(1, 10, 10004)) : (a instanceof google.ima.dai.api.LiveStreamRequest && (c.H = true), c.j = new zg(), c.g.requestStream(a), c.C = b || "", c.G = Date.now() / 1E3, a = c.j);
                  return a;
                };
                p.replaceServerSideAdTagParameters = function (a) {
                  if (!this.h) throw new U(1, 10, 10003);
                  (a.mpt || a.mpv) && ab('You have attempted to set "mpt" and/or "mpv" parameters of the ad tag. Please note that those parameters are used for Shaka adoption tracking and will be overridden.');
                  a.mpt = "Shaka Player";
                  a.mpv = "v4.16.5";
                  this.h.g.replaceAdTagParameters(a);
                };
                p.getServerSideCuePoints = function () {
                  yb("AdManager.getServerSideCuePoints", "Please use getCuePoints function.");
                  return this.getCuePoints();
                };
                p.getCuePoints = function () {
                  var a = [];
                  this.h && (a = a.concat(this.h.getCuePoints()));
                  this.i && (a = a.concat(this.i.getCuePoints()));
                  return a;
                };
                p.getStats = function () {
                  var a = this.m;
                  return {
                    loadTimes: a.g,
                    averageLoadTime: gs(a),
                    started: a.h,
                    overlayAds: a.j,
                    playedCompletely: a.l,
                    skipped: a.m,
                    errors: a.i
                  };
                };
                p.onManifestUpdated = function (a) {
                  if (this.i) this.i.onManifestUpdated(a);
                };
                p.onDashTimedMetadata = function (a) {
                  this.h && a.schemeIdUri == "urn:google:dai:2018" && this.h.g.processMetadata(a.schemeIdUri, a.eventNode ? a.eventNode.attributes.messageData : null, a.startTime);
                };
                p.onHlsTimedMetadata = function (a, b) {
                  this.h && this.h.g.processMetadata("ID3", a.data, b);
                };
                p.onCueMetadataChange = function (a) {
                  if (this.h) this.h.onCueMetadataChange(a);
                };
                p.onHLSInterstitialMetadata = function (a, b, c) {
                  this.l && this.l.disableHLSInterstitial || (this.g || this.initInterstitial(null, a, b), this.g && Hs(this.g, c));
                };
                p.onDASHInterstitialMetadata = function (a, b, c) {
                  if (!this.l || !this.l.disableDASHInterstitial) {
                    var d = c.schemeIdUri;
                    if (d == "urn:mpeg:dash:event:alternativeMPD:insert:2025" || d == "urn:mpeg:dash:event:alternativeMPD:replace:2025") {
                      if (this.g || this.initInterstitial(null, a, b), this.g && (a = this.g, b = c.schemeIdUri == "urn:mpeg:dash:event:alternativeMPD:replace:2025", d = c.schemeIdUri == "urn:mpeg:dash:event:alternativeMPD:insert:2025", b || d)) {
                        for (var e = c.startTime, f = c.endTime, g = null, h = 0, k, l = t(c.eventNode.children), m = l.next(); !m.done; m = l.next()) if (m = m.value, m.tagName == "AlternativeMPD") {
                          if (m = m.attributes.uri) {
                            k = m;
                            break;
                          }
                        } else if (m.tagName == "InsertPresentation" || m.tagName == "ReplacePresentation") {
                          var n = m.attributes.url;
                          if (n) {
                            k = lc(n);
                            (l = Ad(m, "maxDuration", Gd)) && (g = l / c.timescale);
                            (l = Ad(m, "returnOffset", Gd)) && (h = l / c.timescale);
                            b && h && (f = e + h);
                            break;
                          }
                        }
                        k && Ks(a, [{
                          id: c.id,
                          groupId: null,
                          startTime: e,
                          endTime: f,
                          uri: k,
                          mimeType: null,
                          isSkippable: false,
                          skipOffset: null,
                          skipFor: null,
                          canJump: true,
                          resumeOffset: d ? h : null,
                          playoutLimit: g,
                          once: false,
                          pre: false,
                          post: false,
                          timelineRange: b && !d,
                          loop: false,
                          overlay: null,
                          displayOnBackground: false,
                          currentVideo: null,
                          background: null,
                          clickThroughUrl: null
                        }]);
                      }
                    } else (d == "urn:mpeg:dash:event:2012" || d == "urn:scte:dash:scte214-events") && c.eventNode && xd(c.eventNode, "OverlayEvent") && (this.g || this.initInterstitial(null, a, b), this.g && Ls(this.g, c));
                  }
                };
                p.addCustomInterstitial = function (a) {
                  if (!this.g) throw new U(1, 10, 10006);
                  Ks(this.g, [a]);
                };
                p.addAdUrlInterstitial = function (a) {
                  if (!this.g) throw new U(1, 10, 10006);
                  return this.g.addAdUrlInterstitial(a);
                };
                p.getInterstitialPlayer = function () {
                  if (!this.g) throw new U(1, 10, 10006);
                  return this.g.td();
                };
                function ft(a, b) {
                  if (b && b.type) switch (b.type) {
                    case "ads-loaded":
                      a.m.g.push(b.loadTime);
                      break;
                    case "ad-started":
                      a.m.h++;
                      var c = b.ad;
                      c && !c.isLinear() && a.m.j++;
                      break;
                    case "ad-complete":
                      a.m.l++;
                      break;
                    case "ad-skipped":
                      a.m.m++;
                      break;
                    case "ad-error":
                      a.m.i++;
                  }
                  a.dispatchEvent(b);
                }
                S("shaka.ads.AdManager", Z);
                Z.prototype.getInterstitialPlayer = Z.prototype.getInterstitialPlayer;
                Z.prototype.addAdUrlInterstitial = Z.prototype.addAdUrlInterstitial;
                Z.prototype.addCustomInterstitial = Z.prototype.addCustomInterstitial;
                Z.prototype.onDASHInterstitialMetadata = Z.prototype.onDASHInterstitialMetadata;
                Z.prototype.onHLSInterstitialMetadata = Z.prototype.onHLSInterstitialMetadata;
                Z.prototype.onCueMetadataChange = Z.prototype.onCueMetadataChange;
                Z.prototype.onHlsTimedMetadata = Z.prototype.onHlsTimedMetadata;
                Z.prototype.onDashTimedMetadata = Z.prototype.onDashTimedMetadata;
                Z.prototype.onManifestUpdated = Z.prototype.onManifestUpdated;
                Z.prototype.getStats = Z.prototype.getStats;
                Z.prototype.getCuePoints = Z.prototype.getCuePoints;
                Z.prototype.getServerSideCuePoints = Z.prototype.getServerSideCuePoints;
                Z.prototype.replaceServerSideAdTagParameters = Z.prototype.replaceServerSideAdTagParameters;
                Z.prototype.requestServerSideStream = Z.prototype.requestServerSideStream;
                Z.prototype.initServerSide = Z.prototype.initServerSide;
                Z.prototype.addMediaTailorTrackingUrl = Z.prototype.addMediaTailorTrackingUrl;
                Z.prototype.requestMediaTailorStream = Z.prototype.requestMediaTailorStream;
                Z.prototype.initMediaTailor = Z.prototype.initMediaTailor;
                Z.prototype.updateClientSideAdsRenderingSettings = Z.prototype.updateClientSideAdsRenderingSettings;
                Z.prototype.requestClientSideAds = Z.prototype.requestClientSideAds;
                Z.prototype.onAssetUnload = Z.prototype.onAssetUnload;
                Z.prototype.release = Z.prototype.release;
                Z.prototype.initClientSide = Z.prototype.initClientSide;
                Z.prototype.initInterstitial = Z.prototype.initInterstitial;
                Z.prototype.configure = Z.prototype.configure;
                Z.prototype.setLocale = Z.prototype.setLocale;
                Z.ADS_LOADED = "ads-loaded";
                Z.AD_STARTED = "ad-started";
                Z.AD_FIRST_QUARTILE = "ad-first-quartile";
                Z.AD_MIDPOINT = "ad-midpoint";
                Z.AD_THIRD_QUARTILE = "ad-third-quartile";
                Z.AD_COMPLETE = "ad-complete";
                Z.AD_STOPPED = "ad-stopped";
                Z.AD_SKIPPED = "ad-skipped";
                Z.AD_VOLUME_CHANGED = "ad-volume-changed";
                Z.AD_MUTED = "ad-muted";
                Z.AD_PAUSED = "ad-paused";
                Z.AD_RESUMED = "ad-resumed";
                Z.AD_SKIP_STATE_CHANGED = "ad-skip-state-changed";
                Z.CUEPOINTS_CHANGED = "ad-cue-points-changed";
                Z.IMA_AD_MANAGER_LOADED = "ima-ad-manager-loaded";
                Z.IMA_STREAM_MANAGER_LOADED = "ima-stream-manager-loaded";
                Z.AD_CLICKED = "ad-clicked";
                Z.AD_PROGRESS = "ad-progress";
                Z.AD_BUFFERING = "ad-buffering";
                Z.AD_IMPRESSION = "ad-impression";
                Z.AD_DURATION_CHANGED = "ad-duration-changed";
                Z.AD_CLOSED = "ad-closed";
                Z.AD_LOADED = "ad-loaded";
                Z.ALL_ADS_COMPLETED = "all-ads-completed";
                Z.AD_LINEAR_CHANGED = "ad-linear-changed";
                Z.AD_METADATA = "ad-metadata";
                Z.AD_RECOVERABLE_ERROR = "ad-recoverable-error";
                Z.AD_ERROR = "ad-error";
                Z.AD_BREAK_READY = "ad-break-ready";
                Z.AD_INTERACTION = "ad-interaction";
                Z.AD_CONTENT_PAUSE_REQUESTED = "ad-content-pause-requested";
                Z.AD_CONTENT_RESUME_REQUESTED = "ad-content-resume-requested";
                Z.AD_CONTENT_ATTACH_REQUESTED = "ad-content-attach-requested";
                Dq = function Dq() {
                  return new Z();
                };
                function gt(a) {
                  return JSON.stringify(a, function (b, c) {
                    if (typeof c != "function") {
                      if (c instanceof Event || c instanceof V) {
                        var d = {};
                        for (e in c) (b = c[e]) && _typeof(b) == "object" ? e == "detail" && (d[e] = b) : e in Event || (d[e] = b);
                        return d;
                      }
                      if (c instanceof Error) {
                        var e = new Set(["name", "message", "stack"]);
                        for (d in c) e.add(d);
                        d = t(Object.getOwnPropertyNames(c));
                        for (b = d.next(); !b.done; b = d.next()) e.add(b.value);
                        d = {};
                        e = t(e);
                        for (b = e.next(); !b.done; b = e.next()) b = b.value, d[b] = c[b];
                        c = {
                          __type__: "Error",
                          contents: d
                        };
                      } else if (c instanceof TimeRanges) {
                        e = {
                          __type__: "TimeRanges",
                          length: c.length,
                          start: [],
                          end: []
                        };
                        c = t(Bj(c));
                        for (d = c.next(); !d.done; d = c.next()) d = d.value, b = d.end, e.start.push(d.start), e.end.push(b);
                        c = e;
                      } else c = ArrayBuffer.isView(c) && c.BYTES_PER_ELEMENT === 1 ? {
                        __type__: "Uint8Array",
                        entries: Array.from(c)
                      } : typeof c == "number" ? isNaN(c) ? "NaN" : isFinite(c) ? c : c < 0 ? "-Infinity" : "Infinity" : c;
                      return c;
                    }
                  });
                }
                function ht(a) {
                  return JSON.parse(a, function (b, c) {
                    if (c == "NaN") var d = NaN;else if (c == "-Infinity") d = -Infinity;else if (c == "Infinity") d = Infinity;else if (c && _typeof(c) == "object" && c.__type__ == "TimeRanges") d = it(c);else if (c && _typeof(c) == "object" && c.__type__ == "Uint8Array") d = new Uint8Array(c.entries);else if (c && _typeof(c) == "object" && c.__type__ == "Error") {
                      b = c.contents;
                      c = Error(b.message);
                      for (d in b) c[d] = b[d];
                      d = c;
                    } else d = c;
                    return d;
                  });
                }
                function it(a) {
                  return {
                    length: a.length,
                    start: function start(b) {
                      return a.start[b];
                    },
                    end: function end(b) {
                      return a.end[b];
                    }
                  };
                }
                var jt = "ended play playing pause pausing ratechange seeked seeking timeupdate volumechange".split(" "),
                  kt = "buffered currentTime duration ended loop muted paused playbackRate seeking videoHeight videoWidth volume".split(" "),
                  lt = ["loop", "playbackRate"],
                  mt = ["pause", "play"],
                  nt = new Map().set("getAssetUri", 2).set("getAudioLanguages", 4).set("getAudioLanguagesAndRoles", 4).set("getBufferFullness", 1).set("getBufferedInfo", 2).set("getExpiration", 2).set("getKeyStatuses", 2).set("getPlaybackRate", 2).set("getTextLanguages", 4).set("getTextLanguagesAndRoles", 4).set("isAudioOnly", 10).set("isBuffering", 1).set("isInProgress", 1).set("isLive", 10).set("isTextTrackVisible", 1).set("isVideoOnly", 10).set("keySystem", 10).set("seekRange", 1).set("getLoadMode", 10).set("getManifestType", 10).set("isFullyLoaded", 1).set("isEnded", 1).set("getBandwidthEstimate", 1),
                  ot = new Map().set("getConfiguration", 4).set("getConfigurationForLowLatency", 4).set("getStats", 5).set("getAudioTracks", 2).set("getChaptersTracks", 2).set("getImageTracks", 2).set("getVideoTracks", 2).set("getTextTracks", 2).set("getVariantTracks", 2),
                  pt = new Map().set("getPlayheadTimeAsDate", 1).set("getPresentationStartTimeAsDate", 20).set("getSegmentAvailabilityDuration", 20),
                  qt = [["getConfiguration", "configure", "getConfigurationForLowLatency", "configurationForLowLatency"]],
                  rt = [["isTextTrackVisible", "setTextTrackVisibility"]],
                  st = "cancelTrickPlay configure configurationForLowLatency getChapters resetConfiguration retryStreaming selectAudioLanguage selectAudioTrack selectTextLanguage selectTextTrack selectVariantTrack selectVariantsByLabel selectVideoTrack setTextTrackVisibility trickPlay updateStartTime goToLive useTrickPlayTrackIfAvailable".split(" "),
                  tt = "addChaptersTrack addTextTrackAsync addThumbnailsTrack getAllThumbnails getChaptersAsync getThumbnails attach attachCanvas detach load unload".split(" ");
                function ut(a, b, c, d, e, f, g) {
                  var h = this;
                  this.H = a;
                  this.K = g;
                  this.l = new df(b);
                  this.M = c;
                  this.u = false;
                  this.B = d;
                  this.G = e;
                  this.N = f;
                  this.i = this.m = false;
                  this.J = "";
                  this.o = null;
                  this.C = function () {
                    return vt(h);
                  };
                  this.F = function (k, l) {
                    k = ht(l);
                    switch (k.type) {
                      case "event":
                        var m = k.targetName,
                          n = Hg(k.event);
                        h.B(m, n);
                        break;
                      case "update":
                        m = k.update;
                        for (n in m) {
                          k = h.g[n] || {};
                          for (var q in m[n]) k[q] = m[n][q];
                        }
                        h.u && (h.M(), h.u = false);
                        break;
                      case "asyncComplete":
                        if (q = k.id, n = k.error, l = k.res, k = h.h.get(q), h.h.delete(q), k) if (n) {
                          q = new U(n.severity, n.category, n.code);
                          for (m in n) q[m] = n[m];
                          k.reject(q);
                        } else k.resolve(l);
                    }
                  };
                  this.g = {
                    video: {},
                    player: {}
                  };
                  this.I = 0;
                  this.h = new Map();
                  this.j = null;
                  wt.add(this);
                }
                p = ut.prototype;
                p.destroy = function () {
                  wt.delete(this);
                  xt(this);
                  yt && zt(this);
                  this.l && (this.l.stop(), this.l = null);
                  this.G = this.B = null;
                  this.i = this.m = false;
                  this.F = this.C = this.j = this.h = this.g = this.o = null;
                  return Promise.resolve();
                };
                p.wb = function () {
                  return this.i;
                };
                p.$g = function () {
                  return this.J;
                };
                p.init = function () {
                  if (this.H.length) if (window.chrome && chrome.cast && chrome.cast.isAvailable) {
                    this.m = true;
                    this.l.Jb();
                    var a = new chrome.cast.SessionRequest(this.H, [], null, this.K, null);
                    a = new chrome.cast.ApiConfig(a, function (b) {
                      for (var c = t(wt), d = c.next(); !d.done; d = c.next()) {
                        d = d.value;
                        var e = b;
                        d.j = new zg();
                        d.u = true;
                        At(d, e);
                      }
                    }, function (b) {
                      for (var c = t(wt), d = c.next(); !d.done; d = c.next()) d = d.value, Bt = b == "available", d.l.Jb();
                    }, "origin_scoped");
                    chrome.cast.initialize(a, function () {}, function () {});
                    Bt && this.l.ia(Ct);
                    (a = yt) && a.status != chrome.cast.SessionStatus.STOPPED ? (this.j = new zg(), this.u = true, At(this, a)) : yt = null;
                  } else window.__onGCastApiAvailable !== Dt && (Et = window.__onGCastApiAvailable || null, window.__onGCastApiAvailable = Dt);
                };
                p.mh = function (a) {
                  this.o = a;
                  this.i && Ft(this, {
                    type: "appData",
                    appData: this.o
                  });
                };
                p.cast = function () {
                  var a = this;
                  return P(function (b) {
                    if (!a.m) throw new U(1, 8, 8E3);
                    if (!Bt) throw new U(1, 8, 8001);
                    if (a.i) throw new U(1, 8, 8002);
                    a.j = new zg();
                    chrome.cast.requestSession(function (c) {
                      return At(a, c);
                    }, function (c) {
                      return Gt(a, c);
                    });
                    return F(b, a.j, 0);
                  });
                };
                function Ht(a) {
                  a.i && chrome.cast.requestSession(function (b) {
                    return At(a, b);
                  }, function (b) {
                    return Gt(a, b);
                  });
                }
                p.qd = function () {
                  if (this.i) {
                    xt(this);
                    if (yt) {
                      zt(this);
                      try {
                        yt.stop(function () {}, function () {});
                      } catch (a) {}
                      yt = null;
                    }
                    vt(this);
                  }
                };
                p.get = function (a, b) {
                  var c = this;
                  if (a == "video") {
                    if (mt.includes(b)) return function () {
                      return c.Gi.apply(c, [a, b].concat(x(Oa.apply(0, arguments))));
                    };
                  } else if (a == "player") {
                    if (pt.has(b) && !this.get("player", "isLive")()) return function () {};
                    if (st.includes(b)) return function () {
                      return c.Gi.apply(c, [a, b].concat(x(Oa.apply(0, arguments))));
                    };
                    if (tt.includes(b)) return function () {
                      return c.Lk.apply(c, [a, b].concat(x(Oa.apply(0, arguments))));
                    };
                    if (nt.has(b) || ot.has(b)) return function () {
                      return c.g[a][b];
                    };
                  }
                  return this.g[a][b];
                };
                p.set = function (a, b, c) {
                  this.g[a][b] = c;
                  Ft(this, {
                    type: "set",
                    targetName: a,
                    property: b,
                    value: c
                  });
                };
                function At(a, b) {
                  var c = a.N();
                  yt = b;
                  b.addUpdateListener(a.C);
                  b.addMessageListener("urn:x-cast:com.google.shaka.v2", a.F);
                  vt(a);
                  Ft(a, {
                    type: "init",
                    initState: c,
                    appData: a.o
                  });
                  a.j.resolve();
                }
                function Gt(a, b) {
                  var c = 8003;
                  switch (b.code) {
                    case "cancel":
                      c = 8004;
                      break;
                    case "timeout":
                      c = 8005;
                      break;
                    case "receiver_unavailable":
                      c = 8006;
                  }
                  a.j.reject(new U(2, 8, c, b));
                }
                p.Gi = function (a, b) {
                  Ft(this, {
                    type: "call",
                    targetName: a,
                    methodName: b,
                    args: Oa.apply(2, arguments)
                  });
                };
                p.Lk = function (a, b) {
                  var c = Oa.apply(2, arguments),
                    d = new zg(),
                    e = this.I.toString();
                  this.I++;
                  this.h.set(e, d);
                  try {
                    Ft(this, {
                      type: "asyncCall",
                      targetName: a,
                      methodName: b,
                      args: c,
                      id: e
                    });
                  } catch (f) {
                    d.reject(f);
                  }
                  return d;
                };
                function zt(a) {
                  var b = yt;
                  b.removeUpdateListener(a.C);
                  b.removeMessageListener("urn:x-cast:com.google.shaka.v2", a.F);
                }
                function vt(a) {
                  var b = yt ? yt.status == "connected" : false;
                  if (a.i && !b) {
                    a.G();
                    for (var c in a.g) a.g[c] = {};
                    xt(a);
                  }
                  a.i = b;
                  a.J = b ? yt.receiver.friendlyName : "";
                  a.l.Jb();
                }
                function xt(a) {
                  if (a.h) for (var b = t(a.h.keys()), c = b.next(); !c.done; c = b.next()) {
                    c = c.value;
                    var d = a.h.get(c);
                    a.h.delete(c);
                    d.reject(new U(1, 7, 7E3));
                  }
                }
                function Ft(a, b) {
                  b = gt(b);
                  var c = yt;
                  try {
                    c.sendMessage("urn:x-cast:com.google.shaka.v2", b, function () {}, eb);
                  } catch (d) {
                    throw b = new U(2, 8, 8005, d), c = new V("error", new Map().set("detail", b)), a.B("player", c), a.qd(), b;
                  }
                }
                var Ct = .02,
                  Bt = false,
                  yt = null,
                  Et = null,
                  wt = new Set();
                function Dt(a) {
                  Et ? window.__onGCastApiAvailable = Et : delete window.__onGCastApiAvailable;
                  Et = null;
                  if (a) for (var b = t(wt), c = b.next(); !c.done; c = b.next()) c.value.init();
                  typeof window.__onGCastApiAvailable === "function" && window.__onGCastApiAvailable(a);
                }
                function It(a, b, c, d) {
                  d = d === void 0 ? false : d;
                  Jg.call(this);
                  var e = this;
                  this.i = a;
                  this.h = b;
                  this.l = this.o = this.m = this.u = this.j = null;
                  this.I = c;
                  this.H = d;
                  this.F = [];
                  this.C = [];
                  this.B = [];
                  this.G = new Map();
                  this.g = null;
                  window.chrome ? (this.g = new ut(c, function () {
                    return Jt(e);
                  }, function () {
                    return Kt(e);
                  }, function (f, g) {
                    return Lt(e, f, g);
                  }, function () {
                    return Mt(e);
                  }, function () {
                    return Nt(e);
                  }, d), Ot(this)) : (this.j = this.i, this.u = this.h);
                }
                la(It, Jg);
                p = It.prototype;
                p.destroy = function (a) {
                  this.g && (a === void 0 ? 0 : a) && this.g.qd();
                  this.l && (this.l.release(), this.l = null);
                  a = [];
                  this.h && (a.push(this.h.destroy()), this.h = null);
                  this.g && (a.push(this.g.destroy()), this.g = null);
                  this.u = this.j = this.i = null;
                  Jg.prototype.release.call(this);
                  return Promise.all(a);
                };
                p.ck = function () {
                  return this.j;
                };
                p.td = function () {
                  return this.u;
                };
                p.mj = function () {
                  return this.g ? this.g.m && Bt : false;
                };
                p.wb = function () {
                  return this.g ? this.g.wb() : false;
                };
                p.$g = function () {
                  return this.g ? this.g.$g() : "";
                };
                p.cast = function () {
                  var a = this;
                  return P(function (b) {
                    return b.g == 1 ? a.g ? F(b, a.g.cast(), 2) : b.return() : a.h ? F(b, a.h.Bc(), 0) : b.return();
                  });
                };
                p.mh = function (a) {
                  this.g && this.g.mh(a);
                };
                p.al = function () {
                  this.g && Ht(this.g);
                };
                p.qd = function () {
                  this.g && this.g.qd();
                };
                p.nj = function (a, b) {
                  b = b === void 0 ? false : b;
                  var c = this;
                  return P(function (d) {
                    if (d.g == 1) {
                      if (a == c.I && b == c.H) return d.return();
                      c.I = a;
                      c.H = b;
                      if (!c.g) return d.return();
                      c.g.qd();
                      return F(d, c.g.destroy(), 2);
                    }
                    c.g = null;
                    c.g = new ut(a, function () {
                      return Jt(c);
                    }, function () {
                      return Kt(c);
                    }, function (e, f) {
                      return Lt(c, e, f);
                    }, function () {
                      return Mt(c);
                    }, function () {
                      return Nt(c);
                    }, b);
                    c.g.init();
                    G(d);
                  });
                };
                function Ot(a) {
                  a.g.init();
                  a.l = new nb();
                  for (var b = t(jt), c = b.next(); !c.done; c = b.next()) a.l.D(a.i, c.value, function (f) {
                    a.g.wb() || (f = Hg(f), a.m.dispatchEvent(f));
                  });
                  for (var d in Ig) a.l.D(a.h, Ig[d], function (f) {
                    a.g.wb() || a.o.dispatchEvent(f);
                  });
                  a.j = {};
                  b = {};
                  for (var e in a.i) b = {
                    ce: b.ce
                  }, b.ce = e, Object.defineProperty(a.j, b.ce, {
                    configurable: false,
                    enumerable: true,
                    get: function (f) {
                      return function () {
                        return Pt(a, f.ce);
                      };
                    }(b),
                    set: function (f) {
                      return function (g) {
                        var h = f.ce;
                        a.g.wb() ? a.g.set("video", h, g) : a.i[h] = g;
                      };
                    }(b)
                  });
                  a.u = {};
                  Qt(a, function (f) {
                    Object.defineProperty(a.u, f, {
                      configurable: false,
                      enumerable: true,
                      get: function get() {
                        return Rt(a, f);
                      }
                    });
                  });
                  St(a);
                  a.m = new Jg();
                  a.m.Fe = a.j;
                  a.o = new Jg();
                  a.o.Fe = a.u;
                  a.l.D(a.h, "unloading", function () {
                    a.g && a.g.wb() || Tt(a);
                  });
                }
                function St(a) {
                  var b = new Map();
                  Qt(a, function (c, d) {
                    b.has(d) ? (d = b.get(d), c.length < d.length ? a.G.set(c, d) : a.G.set(d, c)) : b.set(d, c);
                  });
                }
                function Qt(a, b) {
                  function c(k) {
                    return k == "constructor" || typeof d[k] != "function" ? false : !e.has(k);
                  }
                  var d = a.h,
                    e = new Set(),
                    f;
                  for (f in d) c(f) && (e.add(f), b(f, d[f]));
                  a = Object.getPrototypeOf(d);
                  for (f = Object.getPrototypeOf({}); a && a != f;) {
                    for (var g = t(Object.getOwnPropertyNames(a)), h = g.next(); !h.done; h = g.next()) h = h.value, c(h) && (e.add(h), b(h, d[h]));
                    a = Object.getPrototypeOf(a);
                  }
                }
                function Nt(a) {
                  var b = {
                    video: {},
                    player: {},
                    playerAfterLoad: {},
                    manifest: a.h.rd(),
                    startTime: null,
                    addThumbnailsTrackCalls: a.F,
                    addTextTrackAsyncCalls: a.C,
                    addChaptersTrackCalls: a.B
                  };
                  a.i.pause();
                  for (var c = t(lt), d = c.next(); !d.done; d = c.next()) d = d.value, b.video[d] = a.i[d];
                  a.i.ended || (b.startTime = a.i.currentTime);
                  c = t(qt);
                  for (d = c.next(); !d.done; d = c.next()) {
                    var e = d.value;
                    d = e[1];
                    e = a.h[e[0]]();
                    b.player[d] = e;
                  }
                  c = t(rt);
                  for (d = c.next(); !d.done; d = c.next()) e = d.value, d = e[1], e = a.h[e[0]](), b.playerAfterLoad[d] = e;
                  return b;
                }
                function Jt(a) {
                  var b = new V("caststatuschanged");
                  a.dispatchEvent(b);
                }
                function Kt(a) {
                  var b = new V(a.j.paused ? "pause" : "play");
                  a.m.dispatchEvent(b);
                }
                function Mt(a) {
                  for (var b = t(qt), c = b.next(); !c.done; c = b.next()) {
                    var d = c.value;
                    c = d[1];
                    d = a.g.get("player", d[0])();
                    a.h[c](d);
                  }
                  var e = a.F,
                    f = a.C,
                    g = a.B;
                  Tt(a);
                  var h = a.g.get("player", "getAssetUri")();
                  d = a.g.get("video", "ended");
                  b = Promise.resolve();
                  var k = a.i.autoplay;
                  c = null;
                  d || (c = a.g.get("video", "currentTime"));
                  var l;
                  (d = a.g.get("player", "getTextTracks")()) && d.length && (l = d.find(function (q) {
                    return q.active;
                  }));
                  var m = a.g.get("player", "isTextTrackVisible")();
                  h && (a.i.autoplay = false, b = a.h.load(h, c));
                  var n = {};
                  c = t(lt);
                  for (d = c.next(); !d.done; d = c.next()) d = d.value, n[d] = a.g.get("video", d);
                  b.then(function () {
                    if (a.i) {
                      for (var q = t(e), r = q.next(); !r.done; r = q.next()) {
                        r = r.value;
                        var u;
                        (u = a.td()).Me.apply(u, x(r));
                      }
                      q = t(f);
                      for (u = q.next(); !u.done; u = q.next()) {
                        u = u.value;
                        var v;
                        (v = a.td()).Od.apply(v, x(u));
                      }
                      v = t(g);
                      for (q = v.next(); !q.done; q = v.next()) {
                        q = q.value;
                        var w;
                        (w = a.td()).Le.apply(w, x(q));
                      }
                      w = t(lt);
                      for (v = w.next(); !v.done; v = w.next()) v = v.value, a.i[v] = n[v];
                      w = t(rt);
                      for (v = w.next(); !v.done; v = w.next()) q = v.value, v = q[1], q = a.g.get("player", q[0])(), a.h[v](q);
                      a.h.qh(m);
                      l && a.h.jh(l.language, l.roles, l.forced);
                      a.i.autoplay = k;
                      h && a.i.play();
                    }
                  }, function (q) {
                    q = new Map().set("detail", q);
                    q = new V("error", q);
                    a.h.dispatchEvent(q);
                  });
                }
                function Pt(a, b) {
                  if (b == "addEventListener") return function (d, e, f) {
                    return a.m.addEventListener(d, e, f);
                  };
                  if (b == "removeEventListener") return function (d, e, f) {
                    return a.m.removeEventListener(d, e, f);
                  };
                  if (a.g.wb() && Object.keys(a.g.g.video).length == 0) {
                    var c = a.i[b];
                    if (typeof c != "function") return c;
                  }
                  return a.g.wb() ? a.g.get("video", b) : (b = a.i[b], typeof b == "function" && (b = b.bind(a.i)), b);
                }
                function Rt(a, b, c) {
                  c = c === void 0 ? false : c;
                  a.G.has(b) && (b = a.G.get(b));
                  if (b == "addEventListener") return function (d, e, f) {
                    return a.o.addEventListener(d, e, f);
                  };
                  if (b == "removeEventListener") return function (d, e, f) {
                    return a.o.removeEventListener(d, e, f);
                  };
                  if (b == "getMediaElement") return function () {
                    return a.j;
                  };
                  if (b == "getSharedConfiguration") return a.g.get("player", "getConfiguration");
                  if (b == "getNetworkingEngine") return function () {
                    return a.h.Wb();
                  };
                  if (b == "getDrmEngine") return function () {
                    return a.h.F;
                  };
                  if (b == "getAdManager") return function () {
                    return a.h.Yh();
                  };
                  if (b == "getQueueManager") return function () {
                    return a.h.ei();
                  };
                  if (b == "setVideoContainer") return function (d) {
                    return a.h.Ui(d);
                  };
                  if (!c) {
                    if (b == "addThumbnailsTrack") return function () {
                      var d = Oa.apply(0, arguments);
                      a.F.push(d);
                      return Rt(a, b, true).apply(null, x(d));
                    };
                    if (b == "addTextTrackAsync") return function () {
                      var d = Oa.apply(0, arguments);
                      a.C.push(d);
                      return Rt(a, b, true).apply(null, x(d));
                    };
                    if (b == "addChaptersTrack") return function () {
                      var d = Oa.apply(0, arguments);
                      a.B.push(d);
                      return Rt(a, b, true).apply(null, x(d));
                    };
                  }
                  if (a.g.wb()) {
                    if (b == "getManifest" || b == "drmInfo") return function () {
                      ab(b + "() does not work while casting!");
                      return null;
                    };
                    if (b == "attach" || b == "detach") return function () {
                      ab(b + "() does not work while casting!");
                      return Promise.resolve();
                    };
                    if (b == "getChapters") return function () {
                      ab(b + "() does not work while casting!");
                      return [];
                    };
                  }
                  return a.g.wb() && Object.keys(a.g.g.video).length == 0 && (nt.has(b) || ot.has(b)) || !a.g.wb() ? a.h[b].bind(a.h) : a.g.get("player", b);
                }
                function Lt(a, b, c) {
                  a.g.wb() && (b == "video" ? a.m.dispatchEvent(c) : b == "player" && (c.type == "unloading" && Tt(a), a.o.dispatchEvent(c)));
                }
                function Tt(a) {
                  a.F = [];
                  a.C = [];
                  a.B = [];
                }
                S("shaka.cast.CastProxy", It);
                It.prototype.changeReceiverId = It.prototype.nj;
                It.prototype.forceDisconnect = It.prototype.qd;
                It.prototype.suggestDisconnect = It.prototype.al;
                It.prototype.setAppData = It.prototype.mh;
                It.prototype.cast = It.prototype.cast;
                It.prototype.receiverName = It.prototype.$g;
                It.prototype.isCasting = It.prototype.wb;
                It.prototype.canCast = It.prototype.mj;
                It.prototype.getPlayer = It.prototype.td;
                It.prototype.getVideo = It.prototype.ck;
                It.prototype.destroy = It.prototype.destroy;
                function Ut(a, b, c, d) {
                  Jg.call(this);
                  var e = this;
                  this.h = a;
                  this.g = b;
                  this.j = new nb();
                  this.I = {
                    video: a,
                    player: b
                  };
                  this.G = c || function () {};
                  this.J = d || function (f) {
                    return f;
                  };
                  this.i = null;
                  this.H = false;
                  this.o = true;
                  this.m = 0;
                  this.C = false;
                  this.B = true;
                  this.u = this.l = null;
                  this.F = new df(function () {
                    Vt(e);
                  });
                  Wt(this);
                }
                la(Ut, Jg);
                p = Ut.prototype;
                p.isConnected = function () {
                  return this.H;
                };
                p.jk = function () {
                  return this.o;
                };
                p.Xk = function (a) {
                  this.i = a;
                };
                p.rj = function () {
                  this.i = null;
                };
                p.Yk = function (a) {
                  this.i || (this.i = {
                    metadataType: cast.receiver.media.MetadataType.GENERIC
                  });
                  this.i.title = a;
                };
                p.Wk = function (a) {
                  this.i || (this.i = {
                    metadataType: cast.receiver.media.MetadataType.GENERIC
                  });
                  this.i.images = [{
                    url: a
                  }];
                };
                p.Vk = function (a) {
                  this.i || (this.i = {});
                  this.i.artist = a;
                  this.i.metadataType = cast.receiver.media.MetadataType.MUSIC_TRACK;
                };
                p.destroy = function () {
                  var a = this,
                    b,
                    c;
                  return P(function (d) {
                    if (d.g == 1) return a.j && (a.j.release(), a.j = null), b = [], a.g && (b.push(a.g.destroy()), a.g = null), a.F && (a.F.stop(), a.F = null), a.h = null, a.I = null, a.G = null, a.H = false, a.o = true, a.l = null, a.u = null, Jg.prototype.release.call(a), F(d, Promise.all(b), 2);
                    c = cast.receiver.CastReceiverManager.getInstance();
                    c.stop();
                    G(d);
                  });
                };
                function Wt(a) {
                  var b = cast.receiver.CastReceiverManager.getInstance();
                  b.onSenderConnected = function () {
                    return Xt(a);
                  };
                  b.onSenderDisconnected = function () {
                    return Xt(a);
                  };
                  b.onSystemVolumeChanged = function () {
                    var e = cast.receiver.CastReceiverManager.getInstance().getSystemVolume();
                    e && Yt(a, {
                      type: "update",
                      update: {
                        video: {
                          volume: e.level,
                          muted: e.muted
                        }
                      }
                    }, a.l);
                    Yt(a, {
                      type: "event",
                      targetName: "video",
                      event: {
                        type: "volumechange"
                      }
                    }, a.l);
                  };
                  a.u = b.getCastMessageBus("urn:x-cast:com.google.cast.media");
                  a.u.onMessage = function (e) {
                    return Zt(a, e);
                  };
                  a.l = b.getCastMessageBus("urn:x-cast:com.google.shaka.v2");
                  a.l.onMessage = function (e) {
                    return $t(a, e);
                  };
                  b.start();
                  b = t(jt);
                  for (var c = b.next(); !c.done; c = b.next()) a.j.D(a.h, c.value, function (e) {
                    return au(a, "video", e);
                  });
                  for (var d in Ig) a.j.D(a.g, Ig[d], function (e) {
                    return au(a, "player", e);
                  });
                  a.j.D(a.h, "loadeddata", function () {
                    a.C = true;
                  });
                  a.j.D(a.g, "loading", function () {
                    a.o = false;
                    bu(a);
                  });
                  a.j.D(a.h, "playing", function () {
                    a.o = false;
                    bu(a);
                  });
                  a.j.D(a.h, "pause", function () {
                    bu(a);
                  });
                  a.j.D(a.g, "unloading", function () {
                    a.o = true;
                    bu(a);
                  });
                  a.j.D(a.h, "ended", function () {
                    new df(function () {
                      a.h && a.h.ended && (a.o = true, bu(a));
                    }).ia(cu);
                  });
                }
                function Xt(a) {
                  a.m = 0;
                  a.B = true;
                  a.H = cast.receiver.CastReceiverManager.getInstance().getSenders().length != 0;
                  bu(a);
                }
                function bu(a) {
                  var b;
                  P(function (c) {
                    if (c.g == 1) return F(c, Promise.resolve(), 2);
                    if (!a.g) return c.return();
                    b = new V("caststatuschanged");
                    a.dispatchEvent(b);
                    du(a) || eu(a);
                    G(c);
                  });
                }
                function fu(a, b, c) {
                  var d, e, f, g, h, k, l, m, n, q, r, u, v, w, z, y, B, D, I;
                  P(function (C) {
                    switch (C.g) {
                      case 1:
                        for (d in b.player) e = b.player[d], a.g[d](e);
                        a.G(c);
                        f = a.h.autoplay;
                        return b.manifest ? (a.h.autoplay = false, ua(C, 5), F(C, a.g.load(b.manifest, b.startTime), 7)) : F(C, Promise.resolve(), 3);
                      case 7:
                        if (b.addThumbnailsTrackCalls) for (g = t(b.addThumbnailsTrackCalls), h = g.next(); !h.done; h = g.next()) k = h.value, a.g.Me.apply(a.g, x(k));
                        if (b.addTextTrackAsyncCalls) for (l = t(b.addTextTrackAsyncCalls), m = l.next(); !m.done; m = l.next()) n = m.value, a.g.Od.apply(a.g, x(n));
                        if (b.addChaptersTrackCalls) for (q = t(b.addChaptersTrackCalls), r = q.next(); !r.done; r = q.next()) u = r.value, a.g.Le.apply(a.g, x(u));
                        xa(C, 3);
                        break;
                      case 5:
                        return v = ya(C), w = new Map().set("detail", v), z = new V("error", w), a.g && a.g.dispatchEvent(z), C.return();
                      case 3:
                        if (!a.g) return C.return();
                        for (y in b.video) B = b.video[y], a.h[y] = B;
                        for (D in b.playerAfterLoad) I = b.playerAfterLoad[D], a.g[D](I);
                        a.h.autoplay = f;
                        b.manifest && (a.h.play(), eu(a));
                        G(C);
                    }
                  });
                }
                function au(a, b, c) {
                  a.g && (Vt(a), Yt(a, {
                    type: "event",
                    targetName: b,
                    event: c
                  }, a.l));
                }
                function Vt(a) {
                  a.F.ia(gu);
                  for (var b = {
                      video: {},
                      player: {}
                    }, c = t(kt), d = c.next(); !d.done; d = c.next()) d = d.value, b.video[d] = a.h[d];
                  a.g.W() && pt.forEach(function (e, f) {
                    a.m % e == 0 && (b.player[f] = a.g[f]());
                  });
                  nt.forEach(function (e, f) {
                    a.m % e == 0 && (b.player[f] = a.g[f]());
                  });
                  if (c = cast.receiver.CastReceiverManager.getInstance().getSystemVolume()) b.video.volume = c.level, b.video.muted = c.muted;
                  Yt(a, {
                    type: "update",
                    update: b
                  }, a.l);
                  ot.forEach(function (e, f) {
                    a.m % e == 0 && (e = {
                      player: {}
                    }, e.player[f] = a.g[f](), Yt(a, {
                      type: "update",
                      update: e
                    }, a.l));
                  });
                  a.C && (a.m += 1);
                  du(a);
                }
                function du(a) {
                  return a.B && (a.h.duration || a.g.W()) ? (hu(a), a.B = false, true) : false;
                }
                function hu(a, b) {
                  var c = {
                    contentId: a.g.rd(),
                    streamType: a.g.W() ? "LIVE" : "BUFFERED",
                    contentType: ""
                  };
                  a.g.W() || (c.duration = a.h.duration);
                  a.i && (c.metadata = a.i);
                  eu(a, b === void 0 ? 0 : b, c);
                }
                function $t(a, b) {
                  var c = ht(b.data);
                  switch (c.type) {
                    case "init":
                      a.m = 0;
                      a.C = false;
                      a.B = true;
                      fu(a, c.initState, c.appData);
                      Vt(a);
                      break;
                    case "appData":
                      a.G(c.appData);
                      break;
                    case "set":
                      var d = c.targetName,
                        e = c.property;
                      c = c.value;
                      if (d == "video") if (b = cast.receiver.CastReceiverManager.getInstance(), e == "volume") {
                        b.setSystemVolumeLevel(c);
                        break;
                      } else if (e == "muted") {
                        b.setSystemVolumeMuted(c);
                        break;
                      }
                      a.I[d][e] = c;
                      break;
                    case "call":
                      d = a.I[c.targetName];
                      d[c.methodName].apply(d, c.args);
                      break;
                    case "asyncCall":
                      d = c.targetName;
                      e = c.methodName;
                      d == "player" && e == "load" && (a.m = 0, a.C = false);
                      var f = c.id,
                        g = b.senderId;
                      b = a.I[d];
                      c = b[e].apply(b, c.args);
                      d == "player" && e == "load" && (c = c.then(function () {
                        a.B = true;
                      }));
                      c.then(function (h) {
                        return iu(a, g, f, null, h);
                      }, function (h) {
                        return iu(a, g, f, h, null);
                      });
                  }
                }
                function Zt(a, b) {
                  var c = ht(b.data);
                  switch (c.type) {
                    case "PLAY":
                      a.h.play();
                      eu(a);
                      break;
                    case "PAUSE":
                      a.h.pause();
                      eu(a);
                      break;
                    case "SEEK":
                      b = c.currentTime;
                      var d = c.resumeState;
                      b != null && (a.h.currentTime = Number(b));
                      d && d == "PLAYBACK_START" ? (a.h.play(), eu(a)) : d && d == "PLAYBACK_PAUSE" && (a.h.pause(), eu(a));
                      break;
                    case "STOP":
                      a.g.Bc().then(function () {
                        a.g && eu(a);
                      });
                      break;
                    case "GET_STATUS":
                      hu(a, Number(c.requestId));
                      break;
                    case "VOLUME":
                      d = c.volume;
                      b = d.level;
                      d = d.muted;
                      var e = a.h.volume,
                        f = a.h.muted;
                      b != null && (a.h.volume = Number(b));
                      d != null && (a.h.muted = d);
                      e == a.h.volume && f == a.h.muted || eu(a);
                      break;
                    case "LOAD":
                      a.m = 0;
                      a.C = false;
                      a.B = false;
                      b = c.media;
                      d = c.currentTime;
                      e = a.J(b.contentId);
                      f = c.autoplay || true;
                      a.G(b.customData);
                      f && (a.h.autoplay = true);
                      a.g.load(e, d).then(function () {
                        a.g && hu(a);
                      }).catch(function (g) {
                        var h = "LOAD_FAILED";
                        g.category == 7 && g.code == 7E3 && (h = "LOAD_CANCELLED");
                        Yt(a, {
                          requestId: Number(c.requestId),
                          type: h
                        }, a.u);
                      });
                      break;
                    default:
                      Yt(a, {
                        requestId: Number(c.requestId),
                        type: "INVALID_REQUEST",
                        reason: "INVALID_COMMAND"
                      }, a.u);
                  }
                }
                function iu(a, b, c, d, e) {
                  a.g && Yt(a, {
                    type: "asyncComplete",
                    id: c,
                    error: d,
                    res: e
                  }, a.l, b);
                }
                function Yt(a, b, c, d) {
                  a.H && (a = gt(b), d ? c.getCastChannel(d).send(a) : c.broadcast(a));
                }
                function eu(a, b, c) {
                  c = c === void 0 ? null : c;
                  var d = {
                    mediaSessionId: 0,
                    playbackRate: a.h.playbackRate,
                    playerState: a.o ? ju : a.g.Ng() ? ku : a.h.paused ? lu : mu,
                    currentTime: a.h.currentTime,
                    supportedMediaCommands: 63,
                    volume: {
                      level: a.h.volume,
                      muted: a.h.muted
                    }
                  };
                  c && (d.media = c);
                  Yt(a, {
                    requestId: b === void 0 ? 0 : b,
                    type: "MEDIA_STATUS",
                    status: [d]
                  }, a.u);
                }
                S("shaka.cast.CastReceiver", Ut);
                Ut.prototype.destroy = Ut.prototype.destroy;
                Ut.prototype.setContentArtist = Ut.prototype.Vk;
                Ut.prototype.setContentImage = Ut.prototype.Wk;
                Ut.prototype.setContentTitle = Ut.prototype.Yk;
                Ut.prototype.clearContentMetadata = Ut.prototype.rj;
                Ut.prototype.setContentMetadata = Ut.prototype.Xk;
                Ut.prototype.isIdle = Ut.prototype.jk;
                Ut.prototype.isConnected = Ut.prototype.isConnected;
                var gu = .5,
                  cu = 5,
                  ju = "IDLE",
                  mu = "PLAYING",
                  ku = "BUFFERING",
                  lu = "PAUSED";
                function nu(a, b, c, d, e) {
                  if (d >= e) return null;
                  for (var f = -1, g = -1, h = 0; h < c.length; h++) if (c[h].some(function (D) {
                    return D != null && D.g.trim() != "";
                  })) {
                    f = h;
                    break;
                  }
                  for (h = c.length - 1; h >= 0; h--) if (c[h].some(function (D) {
                    return D != null && D.g.trim() != "";
                  })) {
                    g = h;
                    break;
                  }
                  if (f === -1 || g === -1) return null;
                  for (var k = h = false, l = "white", m = "black", n = ou(d, e, h, k, l, m); f <= g; f++) {
                    for (var q = c[f], r = -1, u = -1, v = 0; v < q.length; v++) if (q[v] != null && q[v].g.trim() !== "") {
                      r = v;
                      break;
                    }
                    for (v = q.length - 1; v >= 0; v--) if (q[v] != null && q[v].g.trim() !== "") {
                      u = v;
                      break;
                    }
                    if (r === -1 || u === -1) q = pu(d, e), a.nestedCues.push(q);else {
                      for (; r <= u; r++) if (v = q[r]) {
                        var w = v.l,
                          z = v.i,
                          y = v.j,
                          B = v.h;
                        if (w != h || z != k || y != l || B != m) n.payload && a.nestedCues.push(n), n = ou(d, e, w, z, y, B), h = w, k = z, l = y, m = B;
                        n.payload += v.g;
                      } else n.payload += " ";
                      n.payload && a.nestedCues.push(n);
                      f !== g && (n = pu(d, e), a.nestedCues.push(n));
                      n = ou(d, e, h, k, l, m);
                    }
                  }
                  return a.nestedCues.length ? {
                    cue: a,
                    stream: b
                  } : null;
                }
                function ou(a, b, c, d, e, f) {
                  a = new Td(a, b, "");
                  c && a.textDecoration.push(re);
                  d && (a.fontStyle = qe);
                  a.color = e;
                  a.backgroundColor = f;
                  return a;
                }
                function pu(a, b) {
                  a = new Td(a, b, "");
                  a.lineBreak = true;
                  return a;
                }
                function qu(a, b, c, d, e) {
                  this.g = a;
                  this.l = b;
                  this.i = c;
                  this.h = d;
                  this.j = e;
                }
                function ru(a, b) {
                  this.i = [];
                  this.g = 1;
                  this.h = 0;
                  this.F = a;
                  this.C = b;
                  this.j = this.m = false;
                  this.l = "white";
                  this.o = "black";
                  this.u = this.B = null;
                  su(this);
                }
                function tu(a, b, c) {
                  var d = "CC" + ((a.F << 1 | a.C) + 1),
                    e = new Td(b, c, "");
                  e.lineInterpretation = 1;
                  var f = uu.get(a.g);
                  f && (e.line = f);
                  a.u != null && a.B != null && (e.position = 10 + Math.min(70, a.u * 10) + a.B * 2.5);
                  (b = nu(e, d, a.i, b, c)) && a.g + b.cue.nestedCues.length - 3 > 15 && (f = uu.get(a.g + 3 - b.cue.nestedCues.length)) && (e.line = f);
                  return b;
                }
                function su(a) {
                  vu(a, 0, 15);
                  a.g = 1;
                }
                function wu(a, b, c) {
                  if (!(c < 32 || c > 127)) {
                    var d = "";
                    switch (b) {
                      case 0:
                        d = xu.has(c) ? xu.get(c) : String.fromCharCode(c);
                        break;
                      case 1:
                        d = yu.get(c);
                        break;
                      case 2:
                        a.i[a.g].pop();
                        d = zu.get(c);
                        break;
                      case 3:
                        a.i[a.g].pop(), d = Au.get(c);
                    }
                    d && a.i[a.g].push(new qu(d, a.m, a.j, a.o, a.l));
                  }
                }
                function Bu(a, b, c, d) {
                  if (!(c < 0 || b < 0)) if (b >= c) for (--d; d >= 0; d--) a.i[b + d] = a.i[c + d].map(function (f) {
                    return f;
                  });else for (var e = 0; e < d; e++) a.i[b + e] = a.i[c + e].map(function (f) {
                    return f;
                  });
                }
                function vu(a, b, c) {
                  for (var d = 0; d <= c; d++) a.i[b + d] = [];
                }
                var xu = new Map([[39, "\u2019"], [42, "\xE1"], [92, "\xE9"], [92, "\xE9"], [94, "\xED"], [95, "\xF3"], [96, "\xFA"], [123, "\xE7"], [124, "\xF7"], [125, "\xD1"], [126, "\xF1"], [127, "\u2588"]]),
                  yu = new Map([[48, "\xAE"], [49, "\xB0"], [50, "\xBD"], [51, "\xBF"], [52, "\u2122"], [53, "\xA2"], [54, "\xA3"], [55, "\u266A"], [56, "\xE0"], [57, " "], [58, "\xE8"], [59, "\xE2"], [60, "\xEA"], [61, "\xEE"], [62, "\xF4"], [63, "\xFB"]]),
                  zu = new Map([[32, "\xC1"], [33, "\xC9"], [34, "\xD3"], [35, "\xDA"], [36, "\xDC"], [37, "\xFC"], [38, "\u2018"], [39, "\xA1"], [40, "*"], [41, "'"], [42, "\u2500"], [43, "\xA9"], [44, "\u2120"], [45, "\xB7"], [46, "\u201C"], [47, "\u201D"], [48, "\xC0"], [49, "\xC2"], [50, "\xC7"], [51, "\xC8"], [52, "\xCA"], [53, "\xCB"], [54, "\xEB"], [55, "\xCE"], [56, "\xCF"], [57, "\xEF"], [58, "\xD4"], [59, "\xD9"], [60, "\xF9"], [61, "\xDB"], [62, "\xAB"], [63, "\xBB"]]),
                  Au = new Map([[32, "\xC3"], [33, "\xE3"], [34, "\xCD"], [35, "\xCC"], [36, "\xEC"], [37, "\xD2"], [38, "\xF2"], [39, "\xD5"], [40, "\xF5"], [41, "{"], [42, "}"], [43, "\\"], [44, "^"], [45, "_"], [46, "|"], [47, "~"], [48, "\xC4"], [49, "\xE4"], [50, "\xD6"], [51, "\xF6"], [52, "\xDF"], [53, "\xA5"], [54, "\xA4"], [55, "\u2502"], [56, "\xC5"], [57, "\xE5"], [58, "\xD8"], [59, "\xF8"], [60, "\u250C"], [61, "\u2510"], [62, "\u2514"], [63, "\u2518"]]),
                  uu = new Map([[1, 10], [2, 15.33], [3, 20.66], [4, 26], [5, 31.33], [6, 36.66], [7, 42], [8, 47.33], [9, 52.66], [10, 58], [11, 63.33], [12, 68.66], [13, 74], [14, 79.33], [15, 84.66]]);
                function Cu(a, b) {
                  this.h = 0;
                  this.o = new ru(a, b);
                  this.i = new ru(a, b);
                  this.g = this.j = new ru(a, b);
                  this.l = 0;
                  this.m = null;
                }
                function Du(a, b, c) {
                  a.g = a.i;
                  var d = a.g,
                    e = null;
                  a.h !== 3 && a.h !== 4 && (e = tu(d, a.l, c), c = a.i, c.g = c.h > 0 ? c.h : 0, vu(c, 0, 15), c = a.j, c.g = c.h > 0 ? c.h : 0, vu(c, 0, 15), d.g = 15);
                  a.h = 3;
                  d.h = b;
                  return e;
                }
                function Eu(a) {
                  a.h = 1;
                  a.g = a.j;
                  a.g.h = 0;
                }
                function Fu(a) {
                  cb("Cea608DataChannel", "CEA-608 text mode entered, but is unsupported");
                  a.g = a.o;
                  a.h = 4;
                }
                var Gu = "black green blue cyan red yellow magenta black".split(" "),
                  Hu = "white green blue cyan red yellow magenta white_italics".split(" ");
                function Iu(a, b) {
                  this.J = b;
                  this.N = a;
                  this.K = this.l = false;
                  this.m = this.o = this.H = this.M = this.I = 0;
                  this.G = 2;
                  this.i = [];
                  this.g = this.h = this.j = 0;
                  this.F = this.B = false;
                  this.C = "white";
                  this.u = "black";
                  Ju(this);
                }
                function Ju(a) {
                  a.i = [];
                  for (var b = 0; b < 16; b++) a.i.push(Ku());
                }
                function Ku() {
                  for (var a = [], b = 0; b < 42; b++) a.push(null);
                  return a;
                }
                function Lu(a, b) {
                  Mu(a) && (a.i[a.h][a.g] = new qu(b, a.F, a.B, a.u, a.C), a.g++);
                }
                function Mu(a) {
                  var b = a.g < a.m && a.g >= 0;
                  return a.h < a.o && a.h >= 0 && b;
                }
                Iu.prototype.isVisible = function () {
                  return this.l;
                };
                function Nu(a) {
                  for (var b = 0, c = 1; c < 16; c++, b++) a.i[b] = a.i[c];
                  for (c = 0; c < 1; c++, b++) a.i[b] = Ku();
                }
                function Ou(a, b, c) {
                  var d = new Td(a.j, b, "");
                  d.textAlign = a.G === 0 ? "left" : a.G === 1 ? "right" : Vd;
                  var e = d.region;
                  a.J && (e.id += "svc" + a.J);
                  e.id += "win" + a.N;
                  e.height = a.o;
                  e.width = a.m;
                  e.heightUnits = 2;
                  e.widthUnits = 2;
                  e.viewportAnchorX = a.I;
                  e.viewportAnchorY = a.M;
                  e.viewportAnchorUnits = a.K ? Vc : 2;
                  switch (a.H) {
                    case 0:
                      e.regionAnchorX = 0;
                      e.regionAnchorY = 0;
                      break;
                    case 1:
                      e.regionAnchorX = 50;
                      e.regionAnchorY = 0;
                      break;
                    case 2:
                      e.regionAnchorX = 100;
                      e.regionAnchorY = 0;
                      break;
                    case 3:
                      e.regionAnchorX = 0;
                      e.regionAnchorY = 50;
                      break;
                    case 4:
                      e.regionAnchorX = 50;
                      e.regionAnchorY = 50;
                      break;
                    case 5:
                      e.regionAnchorX = 100;
                      e.regionAnchorY = 50;
                      break;
                    case 6:
                      e.regionAnchorX = 0;
                      e.regionAnchorY = 100;
                      break;
                    case 7:
                      e.regionAnchorX = 50;
                      e.regionAnchorY = 100;
                      break;
                    case 8:
                      e.regionAnchorX = 100, e.regionAnchorY = 100;
                  }
                  if (c = nu(d, "svc" + c, a.i, a.j, b)) a.j = b;
                  return c;
                }
                Iu.prototype.display = function () {
                  this.l = true;
                };
                function Pu() {
                  this.i = [];
                  this.h = null;
                  this.g = 0;
                }
                function Qu(a, b) {
                  b.type === 3 ? (a.g = (b.value & 63) * 2 - 1, a.h = []) : a.h && (a.g > 0 && (a.h.push(b), a.g--), a.g === 0 && (a.i.push(new Ru(a.h)), a.h = null, a.g = 0));
                }
                function Ru(a) {
                  this.g = 0;
                  this.h = a;
                }
                Ru.prototype.Ia = function () {
                  return this.g < this.h.length;
                };
                Ru.prototype.Oa = function () {
                  return this.g;
                };
                function Su(a) {
                  if (!a.Ia()) throw new U(2, 2, 3E3);
                  return a.h[a.g++];
                }
                Ru.prototype.skip = function (a) {
                  if (this.g + a > this.h.length) throw new U(2, 2, 3E3);
                  this.g += a;
                };
                Ru.prototype.Li = function (a) {
                  if (this.g - a < 0) throw new U(2, 2, 3E3);
                  this.g -= a;
                };
                function Tu(a) {
                  this.i = a;
                  this.h = [null, null, null, null, null, null, null, null];
                  this.g = null;
                }
                function Uu(a, b, c, d) {
                  if (!a.g) return [];
                  if (c == 24) return c = Su(b).value, d = Su(b).value, c = function (f) {
                    return f.map(function (g) {
                      return ("0" + (g & 255).toString(16)).slice(-2);
                    }).join("");
                  }([c, d]), Lu(a.g, String.fromCharCode(parseInt(c, 16))), [];
                  b = a.g;
                  var e = null;
                  switch (c) {
                    case 8:
                      !Mu(b) || b.g <= 0 && b.h <= 0 || (b.g <= 0 ? (b.g = b.m - 1, b.h--) : b.g--, b.i[b.h][b.g] = null);
                      break;
                    case 13:
                      b.isVisible() && (e = Ou(b, d, a.i));
                      b.h + 1 >= b.o ? Nu(b) : b.h++;
                      b.g = 0;
                      break;
                    case 14:
                      b.isVisible() && (e = Ou(b, d, a.i));
                      b.i[b.h] = Ku();
                      b.g = 0;
                      break;
                    case 12:
                      b.isVisible() && (e = Ou(b, d, a.i)), Ju(b), b.h = 0, b.g = 0;
                  }
                  return e ? [e] : [];
                }
                function Vu(a, b, c, d) {
                  if (c >= 128 && c <= 135) d = c & 7, a.h[d] && (a.g = a.h[d]);else {
                    if (c === 136) {
                      c = Su(b).value;
                      b = [];
                      c = t(Wu(a, c));
                      for (var e = c.next(); !e.done; e = c.next()) {
                        e = a.h[e.value];
                        if (e.isVisible()) {
                          var f = Ou(e, d, a.i);
                          f && b.push(f);
                        }
                        Ju(e);
                      }
                      return b;
                    }
                    if (c === 137) for (b = Su(b).value, b = t(Wu(a, b)), c = b.next(); !c.done; c = b.next()) c = a.h[c.value], c.isVisible() || (c.j = d), c.display();else {
                      if (c === 138) {
                        c = Su(b).value;
                        b = null;
                        c = t(Wu(a, c));
                        for (e = c.next(); !e.done; e = c.next()) e = a.h[e.value], e.isVisible() && (b = Ou(e, d, a.i)), e.l = false;
                        return b ? [b] : [];
                      }
                      if (c === 139) {
                        c = Su(b).value;
                        b = null;
                        c = t(Wu(a, c));
                        for (e = c.next(); !e.done; e = c.next()) e = a.h[e.value], e.isVisible() ? b = Ou(e, d, a.i) : e.j = d, e.l = !e.l;
                        return b ? [b] : [];
                      }
                      if (c === 140) return b = Su(b).value, Xu(a, b, d);
                      if (c === 143) return d = Xu(a, 255, d), Yu(a), d;
                      if (c === 144) b.skip(1), d = Su(b).value, a.g && (a.g.B = (d & 128) > 0, a.g.F = (d & 64) > 0);else if (c === 145) d = Su(b).value, c = Su(b).value, b.skip(1), a.g && (b = Zu((c & 48) >> 4, (c & 12) >> 2, c & 3), a.g.C = Zu((d & 48) >> 4, (d & 12) >> 2, d & 3), a.g.u = b);else if (c === 146) d = Su(b).value, b = Su(b).value, a.g && (a = a.g, a.h = d & 15, a.g = b & 63);else if (c === 151) b.skip(1), b.skip(1), d = Su(b).value, b.skip(1), a.g && (a.g.G = d & 3);else if (c >= 152 && c <= 159) {
                        c = (c & 15) - 8;
                        e = a.h[c] !== null;
                        e || (f = new Iu(c, a.i), f.j = d, a.h[c] = f);
                        d = Su(b).value;
                        f = Su(b).value;
                        var g = Su(b).value,
                          h = Su(b).value,
                          k = Su(b).value;
                        b = Su(b).value;
                        e && (b & 7) === 0 || (b = a.h[c], b.h = 0, b.g = 0, b.F = false, b.B = false, b.C = "white", b.u = "black");
                        b = a.h[c];
                        b.l = (d & 32) > 0;
                        b.M = f & 127;
                        b.I = g;
                        b.H = (h & 240) >> 4;
                        b.K = (f & 128) > 0;
                        b.o = (h & 15) + 1;
                        b.m = (k & 63) + 1;
                        a.g = a.h[c];
                      }
                    }
                  }
                  return [];
                }
                function Wu(a, b) {
                  for (var c = [], d = 0; d < 8; d++) (b & 1) === 1 && a.h[d] && c.push(d), b >>= 1;
                  return c;
                }
                function Xu(a, b, c) {
                  var d = [];
                  b = t(Wu(a, b));
                  for (var e = b.next(); !e.done; e = b.next()) {
                    e = e.value;
                    var f = a.h[e];
                    f.isVisible() && (f = Ou(f, c, a.i)) && d.push(f);
                    a.h[e] = null;
                  }
                  return d;
                }
                function Yu(a) {
                  a.g = null;
                  a.h = [null, null, null, null, null, null, null, null];
                }
                function Zu(a, b, c) {
                  var d = {
                    0: 0,
                    1: 0,
                    2: 1,
                    3: 1
                  };
                  a = d[a];
                  b = d[b];
                  c = d[c];
                  return $u[a << 2 | b << 1 | c];
                }
                var av = new Map([[32, " "], [33, "\xA0"], [37, "\u2026"], [42, "\u0160"], [44, "\u0152"], [48, "\u2588"], [49, "\u2018"], [50, "\u2019"], [51, "\u201C"], [52, "\u201D"], [53, "\u2022"], [57, "\u2122"], [58, "\u0161"], [60, "\u0153"], [61, "\u2120"], [63, "\u0178"], [118, "\u215B"], [119, "\u215C"], [120, "\u215D"], [121, "\u215E"], [122, "\u2502"], [123, "\u2510"], [124, "\u2514"], [125, "\u2500"], [126, "\u2518"], [127, "\u250C"]]),
                  $u = "black blue green cyan red magenta yellow white".split(" ");
                function bv() {
                  this.h = [];
                  this.g = [];
                  this.i = new Pu();
                  this.l = 0;
                  this.m = new Map([["CC1", new Cu(0, 0)], ["CC2", new Cu(0, 1)], ["CC3", new Cu(1, 0)], ["CC4", new Cu(1, 1)]]);
                  this.u = this.o = 0;
                  this.j = new Map();
                  this.C = true;
                  this.B = new Set();
                  cv(this);
                }
                bv.prototype.clear = function () {
                  this.l = 0;
                  this.h = [];
                  this.g = [];
                  var a = this.i;
                  a.i = [];
                  a.h = [];
                  a.g = 0;
                  cv(this);
                  a = t(this.j.values());
                  for (var b = a.next(); !b.done; b = a.next()) Yu(b.value);
                };
                function cv(a) {
                  a.o = 0;
                  a.u = 0;
                  for (var b = t(a.m.values()), c = b.next(); !c.done; c = b.next()) c = c.value, c.h = 0, c.g = c.j, c.m = null, su(c.i), su(c.j), su(c.o);
                  a.C = true;
                }
                bv.prototype.extract = function (a, b) {
                  if (this.C) {
                    for (var c = t(this.m.values()), d = c.next(); !d.done; d = c.next()) d.value.l = b;
                    this.C = false;
                  }
                  a = new eh(a, 0);
                  if (!(a.getLength() < 8) && a.Y() === 181 && a.Ca() === 49 && a.U() === 1195456820 && a.Y() === 3 && (c = a.Y(), (c & 64) !== 0)) for (c &= 31, a.skip(1), d = 0; d < c; d++) {
                    var e = a.Y(),
                      f = (e & 4) >> 2,
                      g = a.Y(),
                      h = a.Y();
                    f && (e &= 3, e === 0 || e === 1 ? this.h.push({
                      pts: b,
                      type: e,
                      Cb: g,
                      hc: h,
                      order: this.h.length
                    }) : (this.g.push({
                      pts: b,
                      type: e,
                      value: g,
                      order: this.g.length
                    }), this.g.push({
                      pts: b,
                      type: 2,
                      value: h,
                      order: this.g.length
                    })));
                  }
                };
                bv.prototype.decode = function () {
                  function a(e, f) {
                    return e.pts - f.pts || e.order - f.order;
                  }
                  var b = [];
                  this.h.sort(a);
                  this.g.sort(a);
                  for (var c = t(this.h), d = c.next(); !d.done; d = c.next()) (d = dv(this, d.value)) && b.push(d);
                  c = t(this.g);
                  for (d = c.next(); !d.done; d = c.next()) Qu(this.i, d.value);
                  c = t(this.i.i);
                  for (d = c.next(); !d.done; d = c.next()) d = ev(this, d.value), b.push.apply(b, x(d));
                  this.i.i = [];
                  this.h = [];
                  this.g = [];
                  return b;
                };
                function dv(a, b) {
                  var c = b.type;
                  if ((b.Cb & 112) === 16) {
                    var d = b.Cb >> 3 & 1;
                    c === 0 ? a.o = d : a.u = d;
                  }
                  d = "CC" + ((c << 1 | (c ? a.u : a.o)) + 1);
                  c = a.m.get(d);
                  if (b.Cb === 255 && b.hc === 255 || !b.Cb && !b.hc || !fv(b.Cb) || !fv(b.hc)) return ++a.l >= 45 && cv(a), null;
                  a.l = 0;
                  b.Cb &= 127;
                  b.hc &= 127;
                  var e = b.Cb;
                  if (e >= 1 && e <= 15 || !b.Cb && !b.hc) return null;
                  e = null;
                  if ((b.Cb & 112) === 16) a: {
                    a.B.add(d), d = b.Cb;
                    a = b.hc;
                    if (c.m === (d << 8 | a)) c.m = null;else if (c.m = d << 8 | a, (d & 240) === 16 && (a & 192) === 64) {
                      b = [11, 11, 1, 2, 3, 4, 12, 13, 14, 15, 5, 6, 7, 8, 9, 10][(d & 7) << 1 | a >> 5 & 1];
                      d = "white";
                      e = false;
                      var f = null;
                      var g = a > 95 ? a - 96 : a - 64;
                      g <= 13 ? d = Hu[Math.floor(g / 2)] : g <= 15 ? e = true : f = Math.floor((g - 16) / 2);
                      a = (a & 1) === 1;
                      c.h !== 4 && (g = c.g, c.h === 3 && b !== g.g && (c = 1 + b - g.h, Bu(g, c, 1 + g.g - g.h, g.h), vu(g, 0, c - 1), vu(g, b + 1, 15 - b)), g.g = b, g.m = a, g.j = e, g.l = d, g.u = f, g.o = "black");
                    } else if ((d & 247) === 17 && (a & 240) === 32) c.g.m = false, c.g.j = false, c.g.l = "white", wu(c.g, 0, 32), d = false, b = Hu[(a & 14) >> 1], b === "white_italics" && (b = "white", d = true), c.g.m = (a & 1) === 1, c.g.j = d, c.g.l = b;else if ((d & 247) === 16 && (a & 240) === 32 || (d & 247) === 23 && (a & 255) === 45) b = "black", (d & 7) === 0 && (b = Gu[(a & 14) >> 1]), c.g.o = b;else if ((d & 247) === 17 && (a & 240) === 48) wu(c.g, 1, a);else if ((d & 246) === 18 && (a & 224) === 32) wu(c.g, d & 1 ? 3 : 2, a);else {
                      if ((d & 246) === 20 && (a & 240) === 32) {
                        a = b.pts;
                        d = null;
                        switch (b.hc) {
                          case 32:
                            Eu(c);
                            break;
                          case 33:
                            c = c.g;
                            c.i[c.g].pop();
                            break;
                          case 37:
                            d = Du(c, 2, a);
                            break;
                          case 38:
                            d = Du(c, 3, a);
                            break;
                          case 39:
                            d = Du(c, 4, a);
                            break;
                          case 40:
                            wu(c.g, 0, 32);
                            break;
                          case 41:
                            c.h = 2;
                            c.g = c.i;
                            c.g.h = 0;
                            c.l = a;
                            break;
                          case 42:
                            su(c.o);
                            Fu(c);
                            break;
                          case 43:
                            Fu(c);
                            break;
                          case 44:
                            b = c.i;
                            d = null;
                            c.h !== 4 && (d = tu(b, c.l, a));
                            vu(b, 0, 15);
                            break;
                          case 45:
                            b = c.g;
                            c.h !== 3 ? d = null : (d = tu(b, c.l, a), e = b.g - b.h + 1, Bu(b, e - 1, e, b.h), vu(b, 0, e - 1), vu(b, b.g, 15 - b.g), c.l = a);
                            break;
                          case 46:
                            vu(c.j, 0, 15);
                            break;
                          case 47:
                            b = null, c.h !== 4 && (b = tu(c.i, c.l, a)), d = c.j, c.j = c.i, c.i = d, Eu(c), c.l = a, d = b;
                        }
                        e = d;
                        break a;
                      }
                      (d == 23 || d == 31) && a >= 33 && a <= 35 && (c.g.B = a - 32);
                    }
                    e = null;
                  } else a = b.hc, wu(c.g, 0, b.Cb), wu(c.g, 0, a);
                  return e;
                }
                function ev(a, b) {
                  var c = [];
                  try {
                    for (; b.Ia();) {
                      var d = Su(b).value,
                        e = (d & 224) >> 5,
                        f = d & 31;
                      e === 7 && f != 0 && (e = Su(b).value & 63);
                      if (e != 0) {
                        a.B.add("svc" + e);
                        a.j.has(e) || a.j.set(e, new Tu(e));
                        for (var g = a.j.get(e), h = b.Oa(); b.Oa() - h < f;) {
                          e = g;
                          var k = b,
                            l = Su(k),
                            m = l.value,
                            n = l.pts;
                          if (m === 16) {
                            var q = Su(k);
                            m = m << 16 | q.value;
                          }
                          if (m >= 0 && m <= 31) var r = Uu(e, k, m, n);else if (m >= 128 && m <= 159) r = Vu(e, k, m, n);else {
                            if (m >= 4096 && m <= 4127) e = k, k = m & 255, k >= 8 && k <= 15 ? e.skip(1) : k >= 16 && k <= 23 ? e.skip(2) : k >= 24 && k <= 31 && e.skip(3);else if (m >= 4224 && m <= 4255) e = k, k = m & 255, k >= 128 && k <= 135 ? e.skip(4) : k >= 136 && k <= 143 && e.skip(5);else if (m >= 32 && m <= 127) k = m, e.g && (k === 127 ? Lu(e.g, "\u266A") : Lu(e.g, String.fromCharCode(k)));else if (m >= 160 && m <= 255) e.g && Lu(e.g, String.fromCharCode(m));else if (m >= 4128 && m <= 4223) {
                              if (k = m & 255, e.g) if (av.has(k)) {
                                var u = av.get(k);
                                Lu(e.g, u);
                              } else Lu(e.g, "_");
                            } else m >= 4256 && m <= 4351 && e.g && ((m & 255) != 160 ? Lu(e.g, "_") : Lu(e.g, "[CC]"));
                            r = [];
                          }
                          c.push.apply(c, x(r));
                        }
                      }
                    }
                  } catch (v) {
                    if (v instanceof U && v.code === 3E3) cb("CEA708_INVALID_DATA", "Buffer read out of bounds / invalid CEA-708 Data.");else throw v;
                  }
                  return c;
                }
                function fv(a) {
                  for (var b = 0; a;) b ^= a & 1, a >>= 1;
                  return b === 1;
                }
                bv.prototype.getStreams = function () {
                  return Array.from(this.B);
                };
                S("shaka.cea.CeaDecoder", bv);
                Rc = function Rc() {
                  return new bv();
                };
                function gv(a) {
                  for (var b = [], c = a, d = a = 0; d < c.length;) a == 2 && c[d] == 3 ? (a = 0, c = [].concat(x(c)), c.splice(d, 1), c = new Uint8Array(c)) : c[d] == 0 ? a++ : a = 0, d++;
                  a = c;
                  for (d = 0; d < a.length;) {
                    for (c = 0; a[d] == 255;) c += 255, d++;
                    c += a[d++];
                    for (var e = 0; a[d] == 255;) e += 255, d++;
                    e += a[d++];
                    c == 4 && b.push(a.subarray(d, d + e));
                    d += e;
                  }
                  return b;
                }
                function hv() {
                  this.j = new Map();
                  this.i = this.h = 0;
                  this.g = iv;
                }
                hv.prototype.init = function (a) {
                  function b(f) {
                    f = f.name;
                    jv.has(f) && (c.g = jv.get(f));
                  }
                  var c = this,
                    d = [],
                    e = [];
                  new hh().box("moov", mh).box("mvex", mh).S("trex", function (f) {
                    var g = f.reader;
                    g.skip(4);
                    g.skip(4);
                    f = g.U();
                    g = g.U();
                    c.h = f;
                    c.i = g;
                  }).box("trak", mh).S("tkhd", function (f) {
                    var g = f.reader;
                    f = f.version;
                    f == 1 ? (g.skip(8), g.skip(8)) : (g.skip(4), g.skip(4));
                    var h = g.U();
                    f == 1 ? g.skip(8) : g.skip(4);
                    g.skip(4);
                    g.skip(8);
                    g.skip(2);
                    g.skip(2);
                    g.skip(2);
                    g.skip(2);
                    g.skip(36);
                    g.Ca();
                    g.Ca();
                    g.Ca();
                    g.Ca();
                    d.push(h);
                  }).box("mdia", mh).S("mdhd", function (f) {
                    f = Di(f.reader, f.version);
                    e.push(f.timescale);
                  }).box("minf", mh).box("stbl", mh).S("stsd", oh).box("avc1", b).box("avc3", b).box("dvav", b).box("dva1", b).box("hev1", b).box("hvc1", b).box("dvh1", b).box("dvhe", b).box("vvc1", b).box("vvi1", b).box("dvc1", b).box("dvi1", b).box("encv", ph).box("sinf", mh).box("frma", function (f) {
                    f = Gi(f.reader).codec;
                    jv.has(f) && (c.g = jv.get(f));
                  }).parse(a, true, true);
                  if (!d.length || !e.length || d.length != e.length) throw new U(2, 2, 2010);
                  this.g == iv && ab("Unable to determine bitstream format for CEA parsing!");
                  d.forEach(function (f, g) {
                    c.j.set(f, e[g]);
                  });
                };
                hv.prototype.parse = function (a) {
                  var b = this;
                  if (this.g == iv) return [];
                  var c = [],
                    d = 0,
                    e = [];
                  new hh().box("moof", function (f) {
                    d = f.start;
                    e = [];
                    mh(f);
                  }).box("traf", function (f) {
                    e.push({
                      baseMediaDecodeTime: null,
                      Td: b.h,
                      Ud: b.i,
                      Ci: [],
                      timescale: 9E4
                    });
                    mh(f);
                  }).S("trun", function (f) {
                    var g = e[e.length - 1];
                    f = Ei(f.reader, f.version, f.flags);
                    g.Ci.push(f);
                  }).S("tfhd", function (f) {
                    var g = e[e.length - 1];
                    f = Bi(f.reader, f.flags);
                    g.Td = f.Td || b.h;
                    g.Ud = f.Ud || b.i;
                    f = f.trackId;
                    b.j.has(f) && (g.timescale = b.j.get(f));
                  }).S("tfdt", function (f) {
                    var g = e[e.length - 1];
                    f = Ci(f.reader, f.version);
                    g.baseMediaDecodeTime = f.baseMediaDecodeTime;
                  }).box("mdat", function (f) {
                    for (var g = d - f.start - 8, h = f.reader.Oa(), k = t(e), l = k.next(); !l.done; l = k.next()) l = l.value, l.baseMediaDecodeTime === null ? ab("Unable to find base media decode time for CEA captions!") : (f.reader.seek(h), kv(b, f.reader, l.baseMediaDecodeTime, l.timescale, l.Td, l.Ud, g, l.Ci, c));
                  }).parse(a, false, true);
                  return c;
                };
                function kv(a, b, c, d, e, f, g, h, k) {
                  var l = 0,
                    m = f,
                    n = h.map(function (u) {
                      return u.hh;
                    });
                  n = [].concat.apply([], x(n));
                  n.length && (m = n[0].sampleSize || f);
                  for (b.skip(g + h[0].mg); b.Ia();) {
                    g = b.U();
                    var q = b.Y(),
                      r = null;
                    r = false;
                    h = 1;
                    switch (a.g) {
                      case lv:
                        r = q & 31;
                        r = r == 6;
                        break;
                      case mv:
                        h = 2;
                        b.skip(1);
                        r = q >> 1 & 63;
                        r = r == 39 || r == 40;
                        break;
                      case nv:
                        h = 2;
                        b.skip(1);
                        r = q >> 1 & 63;
                        r = r == 23 || r == 24;
                        break;
                      default:
                        return;
                    }
                    if (r) for (q = 0, l < n.length && (q = n[l].Cf || 0), q = (c + q) / d, h = b.Tb(g - h, false), h = t(gv(h)), r = h.next(); !r.done; r = h.next()) k.push({
                      packet: r.value,
                      pts: q
                    });else try {
                      b.skip(g - h);
                    } catch (u) {
                      break;
                    }
                    m -= g + 4;
                    m == 0 && (c = l < n.length ? c + (n[l].ih || e) : c + e, l++, l < n.length ? m = n[l].sampleSize || f : m = f);
                  }
                }
                S("shaka.cea.Mp4CeaParser", hv);
                var iv = 0,
                  lv = 1,
                  mv = 2,
                  nv = 3,
                  jv = new Map().set("avc1", lv).set("avc3", lv).set("dvav", lv).set("dva1", lv).set("hev1", mv).set("hvc1", mv).set("dvh1", mv).set("dvhe", mv).set("vvc1", nv).set("vvi1", nv).set("dvc1", nv).set("dvi1", nv);
                Sc("video/mp4", function () {
                  return new hv();
                });
                function ov() {
                  this.g = null;
                }
                ov.prototype.init = function () {};
                ov.prototype.parse = function (a) {
                  this.g ? this.g.clearData() : this.g = new ek();
                  var b = [];
                  a = Vb(a);
                  if (!mk(a)) return b;
                  a = this.g.parse(a);
                  var c = a.Vd(),
                    d = a.$e();
                  a = [];
                  switch (c.video) {
                    case "avc":
                      a.push(6);
                      break;
                    case "hvc":
                      a.push(39), a.push(40);
                  }
                  if (!a.length) return b;
                  c = t(d);
                  for (d = c.next(); !d.done; d = c.next()) if (d = d.value, a.includes(d.type) && d.time != null) for (var e = t(gv(d.data)), f = e.next(); !f.done; f = e.next()) b.push({
                    packet: f.value,
                    pts: d.time
                  });
                  return b;
                };
                S("shaka.cea.TsCeaParser", ov);
                Sc("video/mp2t", function () {
                  return new ov();
                });
                function pv(a) {
                  var b = 0,
                    c = ac(a),
                    d = c.getUint32(b, true);
                  if (d != a.byteLength) return [];
                  a: {
                    a = b + 4 + 2;
                    for (b = []; a < c.byteLength - 1;) {
                      d = c.getUint16(a, true);
                      a += 2;
                      var e = c.getUint16(a, true);
                      a += 2;
                      if ((e & 1) != 0 || e + a > c.byteLength) {
                        c = [];
                        break a;
                      }
                      var f = Vb(c, a, e);
                      b.push({
                        type: d,
                        value: f
                      });
                      a += e;
                    }
                    c = b;
                  }
                  return c;
                }
                function qv(a) {
                  a = pc(ud(a));
                  a = pv(a).filter(function (b) {
                    return b.type === rv;
                  })[0];
                  if (!a) return null;
                  a = ec(a.value, true);
                  return (a = kd(a, "WRMHEADER")) ? a : null;
                }
                function sv(a) {
                  try {
                    var b = qv(a);
                    if (b) a: {
                      for (var c = t(wd(b, "DATA")), d = c.next(); !d.done; d = c.next()) {
                        var e = d.value;
                        if (e.children) for (var f = t(e.children), g = f.next(); !g.done; g = f.next()) {
                          var h = g.value;
                          if (h.tagName == "LA_URL") {
                            var k = ud(h);
                            break a;
                          }
                        }
                      }
                      k = "";
                    } else k = "";
                    return k;
                  } catch (l) {
                    return "";
                  }
                }
                var rv = 1;
                function tv() {
                  this.g = new Map();
                }
                tv.prototype.release = function () {
                  this.g.clear();
                };
                function uv(a, b, c, d) {
                  var e = vv(a, b),
                    f = null;
                  a = [];
                  var g = [];
                  b = null;
                  var h = new Set(e.map(function (l) {
                    return l.keyId;
                  }));
                  h.delete(null);
                  var k = "cenc";
                  if (h.size > 1) throw new U(2, 4, 4010);
                  if (!c) {
                    g = e.filter(function (l) {
                      return l.Gd == "urn:mpeg:dash:sea:2012";
                    });
                    if (g.length > 1) throw new U(2, 4, 4050);
                    g.length && (b = wv(g[0]));
                    (g = e.find(function (l) {
                      return l.Gd == "urn:mpeg:dash:mp4protection:2011";
                    })) && g.encryptionScheme && (k = g.encryptionScheme);
                    g = e.filter(function (l) {
                      return l.Gd == "urn:mpeg:dash:mp4protection:2011" ? (f = l.init || f, false) : l.Gd != "urn:mpeg:dash:sea:2012";
                    });
                    g.length && (a = xv(f, k, g, d, h), a.length == 0 && (a = [vc("", k, f)]));
                  }
                  if (e.length && !b && (c || !g.length)) for (a = [], c = t(Object.values(d)), d = c.next(); !d.done; d = c.next()) d = d.value, d != "org.w3.clearkey" && a.push(vc(d, k, f));
                  if (h = Array.from(h)[0] || null) for (k = t(a), c = k.next(); !c.done; c = k.next()) for (c = t(c.value.initData), d = c.next(); !d.done; d = c.next()) d.value.keyId = h;
                  return {
                    Sh: h,
                    Am: f,
                    drmInfos: a,
                    dg: b,
                    Xh: true
                  };
                }
                function yv(a, b, c, d, e) {
                  var f = uv(a, b, d, e);
                  if (c.Xh) {
                    a = c.drmInfos.length == 1 && !c.drmInfos[0].keySystem;
                    b = f.drmInfos.length == 0;
                    if (c.drmInfos.length == 0 || a && !b) c.drmInfos = f.drmInfos;
                    c.Xh = false;
                  } else if (f.drmInfos.length > 0 && (c.drmInfos = c.drmInfos.filter(function (g) {
                    return f.drmInfos.some(function (h) {
                      return h.keySystem == g.keySystem;
                    });
                  }), c.drmInfos.length == 0)) throw new U(2, 4, 4008);
                  return f.Sh || c.Sh;
                }
                function zv(a) {
                  var b = yd(a.node, "https://dashif.org/CPS", "Laurl");
                  if (b && (b = ud(b))) return b;
                  if ((b = yd(a.node, "urn:microsoft:playready", "pro")) && ud(b)) return sv(b);
                  if (a = yd(a.node, "urn:mpeg:cenc:2013", "pssh")) if (a = ud(a)) {
                    b = pc(a);
                    a = 8;
                    b = ac(b);
                    var c = b.getUint8(a);
                    a += 20;
                    c > 0 && (a += 4 + 16 * b.getUint32(a));
                    a = Vb(b, a + 4);
                    a = nc(a);
                    a = kd("<pro>" + a + "</pro>");
                    return sv(a);
                  }
                  return "";
                }
                function xv(a, b, c, d, e) {
                  var f = [];
                  c = t(c);
                  for (var g = c.next(); !g.done; g = c.next()) {
                    g = g.value;
                    var h = d[g.Gd];
                    if (h) {
                      var k;
                      if ((k = yd(g.node, "urn:microsoft:playready", "pro")) && ud(k)) {
                        k = ud(k);
                        k = pc(k);
                        var l = new Uint8Array([154, 4, 240, 121, 152, 64, 66, 134, 171, 146, 230, 91, 224, 136, 95, 149]);
                        k = [{
                          initData: uh(k, l, new Set(), 0),
                          initDataType: "cenc",
                          keyId: g.keyId
                        }];
                      } else k = null;
                      l = null;
                      if (g.Gd === "urn:uuid:e2719d58-a985-b3c9-781a-b030af78d30e") {
                        l = g;
                        var m = e;
                        if (m.size == 0) l = null;else {
                          var n = new Uint8Array([16, 119, 239, 236, 192, 178, 77, 2, 172, 227, 60, 30, 82, 226, 251, 75]),
                            q = new Uint8Array([]);
                          l = [{
                            initData: uh(q, n, m, 1),
                            initDataType: "cenc",
                            keyId: l.keyId
                          }];
                        }
                      }
                      k = vc(h, b, g.init || a || k || l);
                      if (h = Av.get(h)) k.licenseServerUri = h(g);
                      a: {
                        if (g = yd(g.node, "https://dashif.org/CPS", "Certurl")) if (g = ud(g)) break a;
                        g = "";
                      }
                      k.serverCertificateUri = g;
                      f.push(k);
                    }
                  }
                  return f;
                }
                function vv(a, b) {
                  var c = [];
                  b = t(b);
                  for (var d = b.next(); !d.done; d = b.next()) (d = Bv(a, d.value)) && c.push(d);
                  return c;
                }
                function Bv(a, b) {
                  var c = b.attributes.schemeIdUri,
                    d = Bd(b, "urn:mpeg:cenc:2013", "default_KID"),
                    e = zd(b, "urn:mpeg:cenc:2013", "pssh").map(vd),
                    f = b.attributes.value;
                  if (!c) return null;
                  c = c.toLowerCase();
                  if (d && (d = d.replace(/-/g, "").toLowerCase(), d.includes(" "))) throw new U(2, 4, 4009);
                  var g = [];
                  try {
                    g = e.map(function (h) {
                      if (!a.g.has(h)) {
                        var k = pc(h);
                        a.g.set(h, k);
                      }
                      return {
                        initDataType: "cenc",
                        initData: a.g.get(h),
                        keyId: null
                      };
                    });
                  } catch (h) {
                    throw new U(2, 4, 4007);
                  }
                  return {
                    node: b,
                    Gd: c,
                    keyId: d,
                    init: g.length > 0 ? g : null,
                    encryptionScheme: f
                  };
                }
                function wv(a) {
                  if (!window.crypto || !window.crypto.subtle) throw ab("Web Crypto API is not available to decrypt AES-128. (Web Crypto only exists in secure origins like https)"), new U(2, 4, 4042);
                  var b = yd(a.node, "urn:mpeg:dash:schema:sea:2012", "SegmentEncryption");
                  if (!b) throw new U(2, 4, 4051);
                  if (b.attributes.schemeIdUri != "urn:mpeg:dash:sea:aes128-cbc:2013") throw new U(2, 4, 4051);
                  b = yd(a.node, "urn:mpeg:dash:schema:sea:2012", "CryptoPeriod");
                  if (!b) throw new U(2, 4, 4051);
                  a = b.attributes.IV;
                  b = lc(b.attributes.keyUriTemplate);
                  if (!a || !b) throw new U(2, 4, 4051);
                  a = qc(a.substr(2));
                  if (a.byteLength != 16) throw new U(2, 4, 4048);
                  return {
                    qk: b,
                    iv: a
                  };
                }
                var Av = new Map().set("com.apple.fps", function (a) {
                  if ("apple" === window.shakaMediaKeysPolyfill) throw new U(2, 4, 4054);
                  if (a = yd(a.node, "https://dashif.org/CPS", "Laurl")) if (a = ud(a)) return a;
                  return "";
                }).set("com.widevine.alpha", function (a) {
                  var b = yd(a.node, "https://dashif.org/CPS", "Laurl");
                  return b && (b = ud(b)) ? b : (a = yd(a.node, "urn:microsoft", "laurl")) ? lc(a.attributes.licenseUrl) || "" : "";
                }).set("com.microsoft.playready", zv).set("com.microsoft.playready.recommendation", zv).set("com.microsoft.playready.software", zv).set("com.microsoft.playready.hardware", zv).set("org.w3.clearkey", function (a) {
                  var b = yd(a.node, "https://dashif.org/CPS", "Laurl");
                  return b && (b = ud(b)) ? b : (a = yd(a.node, "http://dashif.org/guidelines/clearKey", "Laurl")) && a.attributes.Lic_type === "EME-1.0" && a && (a = ud(a)) ? a : "";
                });
                function Cv(a, b, c, d, e, f) {
                  var g = new Map().set("RepresentationID", b).set("Number", c).set("SubNumber", d).set("Bandwidth", e).set("Time", f);
                  return a.replace(/\$(RepresentationID|Number|SubNumber|Bandwidth|Time)?(?:%0([0-9]+)([diouxX]))?\$/g, function (h, k, l, m) {
                    if (h == "$$") return "$";
                    var n = g.get(k);
                    if (n == null) return h;
                    k == "RepresentationID" && l && (l = void 0);
                    k == "Time" && typeof n != "bigint" && (Math.abs(n - Math.round(n)) >= .2 && ab("Calculated $Time$ values must be close to integers"), n = Math.round(n));
                    switch (m) {
                      case void 0:
                      case "d":
                      case "i":
                      case "u":
                        h = n.toString();
                        break;
                      case "o":
                        h = n.toString(8);
                        break;
                      case "x":
                        h = n.toString(16);
                        break;
                      case "X":
                        h = n.toString(16).toUpperCase();
                        break;
                      default:
                        h = n.toString();
                    }
                    l = window.parseInt(l, 10) || 1;
                    return Array(Math.max(0, l - h.length) + 1).join("0") + h;
                  });
                }
                function Dv(a, b) {
                  var c = Ev(a, b, "timescale"),
                    d = 1;
                  c && (d = Hd(c) || 1);
                  c = Ev(a, b, "duration");
                  var e = (c = Hd(c || "")) ? c / d : null,
                    f = Ev(a, b, "startNumber"),
                    g = Number(Ev(a, b, "presentationTimeOffset")) || 0,
                    h = Id(f || "");
                  if (f == null || h == null) h = 1;
                  f = null;
                  if (b = Fv(a, b, "SegmentTimeline")) {
                    b = td(b, "S");
                    f = d;
                    a = a.na.duration || Infinity;
                    for (var k = h, l = [], m = -g, n = 0; n < b.length; ++n) {
                      var q = b[n],
                        r = b[n + 1],
                        u = Ad(q, "t", Id),
                        v = Ad(q, "d", Id),
                        w = Ad(q, "r", Gd);
                      q = Ad(q, "k", Gd) || 0;
                      u != null && (u -= g);
                      if (v) {
                        u = u != null ? u : m;
                        w = w || 0;
                        if (w < 0) if (r) {
                          r = Ad(r, "t", Id);
                          if (r == null) break;else if (u >= r) break;
                          w = Math.ceil((r - u) / v) - 1;
                        } else {
                          if (a == Infinity) break;else if (u / f >= a) break;
                          w = Math.ceil((a * f - u) / v) - 1;
                        }
                        l.length > 0 && u != m && (l[l.length - 1].end = u / f);
                        for (r = 0; r <= w; ++r) m = u + v, l.push({
                          start: u / f,
                          end: m / f,
                          Eh: u,
                          vc: q,
                          Rk: l.length + k
                        }), u = m;
                      }
                    }
                    f = l;
                  }
                  return {
                    timescale: d,
                    Mf: c,
                    fb: e,
                    qe: h,
                    Ib: g / d || 0,
                    gd: g,
                    timeline: f
                  };
                }
                function Gv(a, b) {
                  return [b(a.L), b(a.oa), b(a.sa)].filter(gf);
                }
                function Ev(a, b, c) {
                  b = Gv(a, b);
                  a = null;
                  b = t(b);
                  for (var d = b.next(); !d.done && !(a = d.value.attributes[c]); d = b.next());
                  return a;
                }
                function Fv(a, b, c) {
                  b = Gv(a, b);
                  a = null;
                  b = t(b);
                  for (var d = b.next(); !d.done && !(a = xd(d.value, c)); d = b.next());
                  return a;
                }
                function Hv(a, b, c, d, e, f) {
                  for (var g = Bd(a, "http://www.w3.org/1999/xlink", "href"), h = Bd(a, "http://www.w3.org/1999/xlink", "actuate") || "onRequest", k = t(Object.keys(a.attributes)), l = k.next(); !l.done; l = k.next()) {
                    l = l.value;
                    var m = l.split(":"),
                      n = nd("http://www.w3.org/1999/xlink");
                    m[0] == n && delete a.attributes[l];
                  }
                  if (f >= 5) return Bg(new U(2, 4, 4028));
                  if (h != "onLoad") return Bg(new U(2, 4, 4027));
                  var q = uc([d], [g]);
                  return e.request(0, Rg(q, b)).Xa(function (r) {
                    r = jd(r.data, a.tagName);
                    if (!r) return Bg(new U(2, 4, 4001, g));
                    for (a.children = []; r.children.length;) {
                      var u = r.children.shift();
                      a.children.push(u);
                    }
                    u = t(Object.keys(r.attributes));
                    for (var v = u.next(); !v.done; v = u.next()) v = v.value, a.attributes[v] = r.attributes[v];
                    return Iv(a, b, c, q[0], e, f + 1);
                  });
                }
                function Iv(a, b, c, d, e, f) {
                  f = f === void 0 ? 0 : f;
                  if (Bd(a, "http://www.w3.org/1999/xlink", "href")) {
                    var g = Hv(a, b, c, d, e, f);
                    c && (g = g.Xa(void 0, function () {
                      return Iv(a, b, c, d, e, f);
                    }));
                    return g;
                  }
                  g = [];
                  for (var h = t(sd(a)), k = h.next(), l = {}; !k.done; l = {
                    Qd: void 0
                  }, k = h.next()) l.Qd = k.value, Bd(l.Qd, "http://www.w3.org/1999/xlink", "href") == "urn:mpeg:dash:resolve-to-zero:2013" ? a.children = a.children.filter(function (m) {
                    return function (n) {
                      return n !== m.Qd;
                    };
                  }(l)) : l.Qd.tagName != "SegmentTimeline" && g.push(Iv(l.Qd, b, c, d, e, f));
                  return Fg(g).Xa(function () {
                    return a;
                  });
                }
                function Jv(a, b, c, d, e, f, g) {
                  var h,
                    k = new hh().S("sidx", function (l) {
                      h = Kv(b, d, e, f, g, c, l);
                    });
                  a && k.parse(a);
                  if (h) return h;
                  throw new U(2, 3, 3004);
                }
                function Kv(a, b, c, d, e, f, g) {
                  var h = [];
                  g.reader.skip(4);
                  var k = g.reader.U();
                  if (k == 0) throw new U(2, 3, 3005);
                  if (g.version == 0) {
                    var l = g.reader.U();
                    var m = g.reader.U();
                  } else l = g.reader.Dd(), m = g.reader.Dd();
                  g.reader.skip(2);
                  var n = g.reader.Ca();
                  a = a + g.size + m;
                  for (m = 0; m < n; m++) {
                    var q = g.reader.U(),
                      r = (q & 2147483648) >>> 31;
                    q &= 2147483647;
                    var u = g.reader.U();
                    g.reader.skip(4);
                    if (r == 1) throw new U(2, 3, 3006);
                    h.push(new rj(l / k + c, (l + u) / k + c, function () {
                      return f;
                    }, a, a + q - 1, b, c, d, e));
                    l += u;
                    a += q;
                  }
                  g.parser.stop();
                  return h;
                }
                function Lv(a) {
                  this.h = ac(a);
                  this.g = new eh(this.h, 0);
                }
                Lv.prototype.Ia = function () {
                  return this.g.Ia();
                };
                function Mv(a) {
                  var b = Nv(a);
                  if (b.length > 7) throw new U(2, 3, 3002);
                  var c = 0;
                  b = t(b);
                  for (var d = b.next(); !d.done; d = b.next()) c = 256 * c + d.value;
                  b = Nv(a);
                  a: {
                    d = t(Ov);
                    for (var e = d.next(); !e.done; e = d.next()) if (Ub(b, new Uint8Array(e.value))) {
                      d = true;
                      break a;
                    }
                    d = false;
                  }
                  if (d) b = a.h.byteLength - a.g.Oa();else {
                    if (b.length == 8 && b[1] & 224) throw new U(2, 3, 3001);
                    for (e = d = 0; e < b.length; e++) {
                      var f = b[e];
                      d = e == 0 ? f & (1 << 8 - b.length) - 1 : 256 * d + f;
                    }
                    b = d;
                  }
                  b = a.g.Oa() + b <= a.h.byteLength ? b : a.h.byteLength - a.g.Oa();
                  d = ac(a.h, a.g.Oa(), b);
                  a.g.skip(b);
                  return new Pv(c, d);
                }
                function Nv(a) {
                  var b = a.g.Oa(),
                    c = a.g.Y();
                  if (c == 0) throw new U(2, 3, 3002);
                  c = 8 - Math.floor(Math.log2(c));
                  a.g.skip(c - 1);
                  return Vb(a.h, b, c);
                }
                var Ov = [[255], [127, 255], [63, 255, 255], [31, 255, 255, 255], [15, 255, 255, 255, 255], [7, 255, 255, 255, 255, 255], [3, 255, 255, 255, 255, 255, 255], [1, 255, 255, 255, 255, 255, 255, 255]];
                function Pv(a, b) {
                  this.id = a;
                  this.g = b;
                }
                function Qv(a) {
                  if (a.g.byteLength > 8) throw new U(2, 3, 3002);
                  if (a.g.byteLength == 8 && a.g.getUint8(0) & 224) throw new U(2, 3, 3001);
                  for (var b = 0, c = 0; c < a.g.byteLength; c++) {
                    var d = a.g.getUint8(c);
                    b = 256 * b + d;
                  }
                  return b;
                }
                function Rv(a, b, c, d, e, f, g, h, k) {
                  function l() {
                    return e;
                  }
                  var m = [];
                  a = new Lv(a.g);
                  for (var n = null, q = null; a.Ia();) {
                    var r = Mv(a);
                    if (r.id == 187) {
                      var u = Sv(r);
                      u && (r = c * u.il, u = b + u.Jk, n != null && m.push(new rj(n + g, r + g, l, q, u - 1, f, g, h, k)), n = r, q = u);
                    }
                  }
                  n != null && m.push(new rj(n + g, d + g, l, q, null, f, g, h, k));
                  return m;
                }
                function Sv(a) {
                  var b = new Lv(a.g);
                  a = Mv(b);
                  if (a.id != 179) throw new U(2, 3, 3013);
                  a = Qv(a);
                  b = Mv(b);
                  if (b.id != 183) throw new U(2, 3, 3012);
                  b = new Lv(b.g);
                  for (var c = 0; b.Ia();) {
                    var d = Mv(b);
                    if (d.id == 241) {
                      c = Qv(d);
                      break;
                    }
                  }
                  return {
                    il: a,
                    Jk: c
                  };
                }
                function Tv(a, b, c) {
                  b = Fv(a, b, "Initialization");
                  if (!b) return null;
                  var d = a.L.cb(),
                    e = b.attributes.sourceURL;
                  e && (d = uc(d, [lc(e)], a.Lb()));
                  e = 0;
                  var f = null;
                  if (b = Ad(b, "range", Fd)) e = b.start, f = b.end;
                  c = new pj(function () {
                    return d;
                  }, e, f, Uv(a), null, null, c, a.oa.encrypted);
                  c.codecs = a.L.codecs;
                  c.mimeType = a.L.mimeType;
                  a.na && !a.na.ef && (c.g = a.na.start + a.na.duration);
                  return c;
                }
                function Vv(a, b, c) {
                  var d = Number(Ev(a, Wv, "presentationTimeOffset")) || 0,
                    e = Ev(a, Wv, "timescale"),
                    f = 1;
                  e && (f = Hd(e) || 1);
                  var g = d / f || 0,
                    h = Tv(a, Wv, c);
                  Xv(a, h);
                  var k = hd(a);
                  return {
                    endTime: -1,
                    timeline: -1,
                    Sc: function Sc() {
                      var l = Fv(k, Wv, "RepresentationIndex");
                      var m = k.L.cb();
                      l && (l = lc(l.attributes.sourceURL)) && (m = uc(m, [l], k.Lb()));
                      l = Yv(k);
                      return Zv(k, b, h, m, l.start, l.end, g);
                    },
                    timescale: f
                  };
                }
                function Zv(a, b, c, d, e, f, g) {
                  var h, k, l, m, n, q, r, u, v, w, z, y, B, D, I, C, A, E;
                  return P(function (J) {
                    if (J.g == 1) return h = a.presentationTimeline, k = !a.Eb || !a.na.ef, l = a.na.start, m = a.na.duration, n = a.L.mimeType.split("/")[1], q = b, r = null, u = [q(d, e, f, false), n == "webm" ? q(c.P(), c.startByte, c.endByte, true) : null], q = null, F(J, Promise.all(u), 2);
                    v = J.h;
                    w = v[0];
                    z = v[1] || null;
                    y = null;
                    B = l - g;
                    D = l;
                    I = m ? l + m : Infinity;
                    if (n == "mp4") var H = Jv(w, e, d, c, B, D, I);else {
                      H = w;
                      var K = new Lv(z);
                      if (Mv(K).id != 440786851) throw new U(2, 3, 3008);
                      var L = Mv(K);
                      if (L.id != 408125543) throw new U(2, 3, 3009);
                      K = L.g.byteOffset;
                      L = new Lv(L.g);
                      for (var O = null; L.Ia();) {
                        var Q = Mv(L);
                        if (Q.id == 357149030) {
                          O = Q;
                          break;
                        }
                      }
                      if (!O) throw new U(2, 3, 3010);
                      O = new Lv(O.g);
                      Q = 1E6;
                      for (L = null; O.Ia();) {
                        var N = Mv(O);
                        if (N.id == 2807729) Q = Qv(N);else if (N.id == 17545) if (N.g.byteLength == 4) L = N.g.getFloat32(0);else if (N.g.byteLength == 8) L = N.g.getFloat64(0);else throw new U(2, 3, 3003);
                      }
                      if (L == null) throw new U(2, 3, 3011);
                      O = Q / 1E9;
                      L *= O;
                      H = Mv(new Lv(H));
                      if (H.id != 475249515) throw new U(2, 3, 3007);
                      H = Rv(H, K, O, L, d, c, B, D, I);
                    }
                    y = H;
                    C = t(y);
                    for (A = C.next(); !A.done; A = C.next()) E = A.value, E.codecs = a.L.codecs, E.mimeType = a.L.mimeType, E.bandwidth = a.bandwidth;
                    h.ie(y);
                    r = new Nl(y);
                    k && r.pd(D, I, true);
                    return J.return(r);
                  });
                }
                function Wv(a) {
                  return a.Hd;
                }
                function Yv(a) {
                  var b = Fv(a, Wv, "RepresentationIndex");
                  a = Ev(a, Wv, "indexRange");
                  a = Fd(a || "");
                  b && (a = Ad(b, "range", Fd, a));
                  return a;
                }
                function Xv(a, b) {
                  $v(a, b);
                  if (!Yv(a)) throw new U(2, 4, 4002);
                }
                function $v(a, b) {
                  var c = a.L.mimeType.split("/")[1];
                  if (a.L.contentType != Ac && c != "mp4" && c != "webm") throw new U(2, 4, 4006);
                  if (c == "webm" && !b) throw new U(2, 4, 4005);
                }
                function Uv(a) {
                  var b = a.L;
                  return {
                    bandwidth: a.bandwidth,
                    audioSamplingRate: b.audioSamplingRate,
                    codecs: b.codecs,
                    contentType: b.contentType,
                    frameRate: b.frameRate || null,
                    height: b.height || null,
                    mimeType: b.mimeType,
                    channelsCount: b.uf,
                    pixelAspectRatio: b.pixelAspectRatio || null,
                    width: b.width || null,
                    label: a.oa.label || null,
                    roles: a.roles || null,
                    language: a.oa.language || null
                  };
                }
                function aw(a, b, c) {
                  var d = Tv(a, bw, c),
                    e = cw(a);
                  if (!e.fb && !e.timeline && e.yd.length > 1) throw new U(2, 4, 4002);
                  if (!e.fb && !a.na.duration && !e.timeline && e.yd.length == 1) throw new U(2, 4, 4002);
                  if (e.timeline && e.timeline.length == 0) throw new U(2, 4, 4002);
                  var f = null,
                    g = null;
                  a.sa.id && a.L.id && (g = b.get(a.sa.id + "," + a.L.id)) && (f = g.segmentIndex);
                  var h = dw(a.na.start, a.na.duration, a.L.cb, e, d, c, a.L.mimeType, a.L.codecs, a.bandwidth, a.Lb);
                  b = !f;
                  f ? f.fe(h, a.presentationTimeline.Hb()) : f = new Nl(h);
                  a.presentationTimeline.ie(h);
                  a.Eb && a.na.ef || f.pd(a.na.start, a.na.duration ? a.na.start + a.na.duration : Infinity, b);
                  g && (g.segmentIndex = f);
                  return {
                    endTime: -1,
                    timeline: -1,
                    Sc: function Sc() {
                      f && f.getNumReferences() != 0 || f.nf(h);
                      return Promise.resolve(f);
                    },
                    timescale: e.timescale
                  };
                }
                function bw(a) {
                  return a.zc;
                }
                function cw(a) {
                  var b = ew(a);
                  a = Dv(a, bw);
                  var c = a.qe;
                  c == 0 && (c = 1);
                  var d = 0;
                  a.fb ? d = a.fb * (c - 1) : a.timeline && a.timeline.length > 0 && (d = a.timeline[0].start);
                  return {
                    fb: a.fb,
                    startTime: d,
                    qe: c,
                    Ib: a.Ib,
                    timescale: a.timescale,
                    timeline: a.timeline,
                    yd: b
                  };
                }
                function dw(a, b, c, d, e, f, g, h, k, l) {
                  var m = d.yd.length;
                  d.timeline && d.timeline.length != d.yd.length && (m = Math.min(d.timeline.length, d.yd.length));
                  for (var n = a - d.Ib, q = b ? a + b : Infinity, r = [], u = d.startTime, v = {}, w = 0; w < m; v = {
                    Of: void 0,
                    Df: void 0
                  }, w++) {
                    v.Df = d.yd[w];
                    var z = u;
                    u = void 0;
                    u = d.fb != null ? z + d.fb : d.timeline ? d.timeline[w].end : z + b;
                    v.Of = null;
                    v = new rj(a + z, a + u, function (y) {
                      return function () {
                        y.Of == null && (y.Of = uc(c(), [y.Df.yk], l()));
                        return y.Of;
                      };
                    }(v), v.Df.start, v.Df.end, e, n, a, q, [], "", null, null, sj, f);
                    v.codecs = h;
                    v.mimeType = g;
                    v.bandwidth = k;
                    r.push(v);
                  }
                  return r;
                }
                function ew(a) {
                  return [a.L.zc, a.oa.zc, a.sa.zc].filter(gf).map(function (b) {
                    return td(b, "SegmentURL");
                  }).reduce(function (b, c) {
                    return b.length > 0 ? b : c;
                  }).map(function (b) {
                    b.attributes.indexRange && !a.Kg && (a.Kg = true);
                    var c = lc(b.attributes.media);
                    b = Ad(b, "mediaRange", Fd, {
                      start: 0,
                      end: null
                    });
                    return {
                      yk: c,
                      start: b.start,
                      end: b.end
                    };
                  });
                }
                function fw(a, b, c, d, e, f, g, h, k, l) {
                  k || a.L.cf || (a.L.cf = Ev(a, gw, "initialization"));
                  var m = a.L.cf ? hw(a, g) : null,
                    n = iw(a);
                  jw(n);
                  var q = hd(a);
                  if (n.ae) return $v(a, m), {
                    endTime: -1,
                    timeline: -1,
                    Sc: function Sc() {
                      var z = Cv(n.ae, q.L.originalId, null, null, q.bandwidth || null, null);
                      z = uc(q.L.cb(), [z]);
                      return Zv(q, b, m, z, 0, null, n.Ib);
                    },
                    timescale: n.timescale
                  };
                  if (n.fb) return d || a.oa.contentType === "image" || a.oa.contentType === "text" || (d = a.na.start, l = a.sa.id, c = a.na.duration, l = (l = l != null && f.get(l) || c) ? d + l : Infinity, a.presentationTimeline.Sg(n.fb), a.presentationTimeline.Ai(d, l)), {
                    endTime: -1,
                    timeline: -1,
                    Sc: function Sc() {
                      return kw(q, n, e, m, f, g, h, a.L.Ef);
                    },
                    timescale: n.timescale
                  };
                  var r = null;
                  d = d = null;
                  a.sa.id && a.L.id && (d = a.sa.id + "," + a.L.id, d = c.get(d)) && (r = d.segmentIndex);
                  var u = a.na.start,
                    v = a.na.duration ? u + a.na.duration : Infinity;
                  if (r) l = r, lw(l, n, u, v, m, a.Eb), l.Ya(a.presentationTimeline.Hb());else {
                    c = 0;
                    k = -1;
                    if (a.sa.id != null && a.L.id != null) {
                      var w = l.get(a.sa.id);
                      if (w) k = w.timeline;else for (l = t(l.values()), w = l.next(); !w.done; w = l.next()) if (w = w.value, Math.abs(n.Ib - w.endTime) <= Dc && w.bh.includes(a.L.id)) {
                        k = w.timeline;
                        break;
                      } else w.timeline >= c && (c = w.timeline + 1);
                    }
                    k == -1 && (k = c);
                    r = new mw(a.Eb, n, a.L.originalId, a.bandwidth, a.L.cb, a.Lb, u, v, m, g, a.L.Ef, k);
                  }
                  n.timeline && a.oa.contentType !== "image" && a.oa.contentType !== "text" && a.presentationTimeline.Bi(r.h ? r.h.timeline : [], u);
                  d && a.Eb && (d.segmentIndex = r);
                  d = (d = (d = n.timeline) && d[d.length - 1]) ? d.end + n.Ib : -1;
                  l = -1;
                  r instanceof mw && (l = r.Te());
                  return {
                    endTime: d,
                    timeline: l,
                    Sc: function Sc() {
                      r instanceof mw && r.getNumReferences() == 0 && lw(r, n, u, v, m, a.Eb);
                      return Promise.resolve(r);
                    },
                    timescale: n.timescale
                  };
                }
                function gw(a) {
                  return a.Nc;
                }
                function iw(a) {
                  var b = Dv(a, gw),
                    c = Ev(a, gw, "media"),
                    d = Ev(a, gw, "index"),
                    e = Ev(a, gw, "k"),
                    f = 0;
                  e && (f = parseInt(e, 10));
                  return {
                    Mf: b.Mf,
                    fb: b.fb,
                    timescale: b.timescale,
                    qe: b.qe,
                    Ib: b.Ib,
                    gd: b.gd,
                    timeline: b.timeline,
                    $b: c && lc(c),
                    ae: d,
                    mimeType: a.L.mimeType,
                    codecs: a.L.codecs,
                    bandwidth: a.bandwidth,
                    zk: f
                  };
                }
                function jw(a) {
                  var b = a.ae ? 1 : 0;
                  b += a.timeline ? 1 : 0;
                  b += a.fb ? 1 : 0;
                  if (b == 0) throw new U(2, 4, 4002);
                  b != 1 && (a.ae && (a.timeline = null), a.Mf = null, a.fb = null);
                  if (!a.ae && !a.$b) throw new U(2, 4, 4002);
                }
                function kw(a, b, c, d, e, f, g, h) {
                  function k(L) {
                    var O = L - w,
                      Q = O * v,
                      N = b.Mf,
                      M = O * N;
                    "BigInt" in window && M > Number.MAX_SAFE_INTEGER && (M = BigInt(O) * BigInt(N));
                    Q += q;
                    O = Q + v;
                    N = Math.min(O, m());
                    var R = [],
                      T = b.zk;
                    if (T) for (var pa = (N - Q) / T, Y = {}, Ha = 0; Ha < T; Y = {
                      Xi: void 0
                    }, Ha++) {
                      var Ba = Q + pa * Ha,
                        Ca = Ba + pa;
                      Y.Xi = Ha;
                      Y = new rj(Ba, Ca, function (za) {
                        return function () {
                          var oa = Cv(z, B, L, za.Xi, y, M);
                          return uc(D(), [oa], I());
                        };
                      }(Y), 0, null, d, C, q, m(), [], "", null, null, sj, f);
                      Y.codecs = a.L.codecs;
                      Y.mimeType = a.L.mimeType;
                      h == 0 ? Ha > 0 && Y.wd() : Ha % h != 0 && Y.wd();
                      R.push(Y);
                    }
                    Q = new rj(Q, N, function () {
                      if (T) return [];
                      var za = Cv(z, B, L, null, y, M);
                      return uc(D(), [za], I());
                    }, 0, null, d, C, q, m(), R, "", null, null, sj, f, R.length > 0);
                    Q.codecs = a.L.codecs;
                    Q.mimeType = a.L.mimeType;
                    Q.bandwidth = a.bandwidth;
                    Q.j = O;
                    return Q;
                  }
                  function l() {
                    var L = [Math.max(n.Hb(), q), Math.min(n.Hc(), m())].map(function (O) {
                      return O - q;
                    });
                    L = [Math.ceil(L[0] / v), Math.ceil(L[1] / v) - 1];
                    a.L.rb && L[1]++;
                    return L.map(function (O) {
                      return O + w;
                    });
                  }
                  function m() {
                    var L = r != null && e.get(r) || u;
                    return L ? q + L : Infinity;
                  }
                  var n = a.presentationTimeline,
                    q = a.na.start,
                    r = a.sa.id,
                    u = a.na.duration,
                    v = b.fb,
                    w = b.qe,
                    z = b.$b,
                    y = a.bandwidth || null,
                    B = a.L.originalId,
                    D = a.L.cb,
                    I = a.Lb,
                    C = q - b.Ib,
                    A = l();
                  c = a.Eb ? Math.max(A[0], A[1] - c + 1) : A[0];
                  g = g || A[1];
                  A = [];
                  for (var E = c; E <= g; ++E) {
                    var J = k(E);
                    A.push(J);
                  }
                  var H = new Nl(A);
                  A = n.Hc() < m();
                  E = n.W();
                  if (A || E) {
                    var K = Math.max(c, g + 1);
                    c = v;
                    a.L.rb && (c = .1);
                    H.Nf(c, function () {
                      var L = n.Hb();
                      H.Ya(L);
                      var O = t(l());
                      O.next();
                      O = O.next().value;
                      for (var Q = []; K <= O;) {
                        var N = k(K);
                        Q.push(N);
                        K++;
                      }
                      return L > m() && !Q.length ? null : Q;
                    });
                  }
                  return Promise.resolve(H);
                }
                function hw(a, b) {
                  var c = a.L.cf;
                  c || (c = Ev(a, gw, "initialization"));
                  if (!c) return null;
                  c = lc(c);
                  var d = a.L.originalId,
                    e = a.bandwidth || null,
                    f = a.L.cb,
                    g = a.Lb;
                  b = new pj(function () {
                    var h = Cv(c, d, null, null, e, null);
                    return uc(f(), [h], g());
                  }, 0, null, Uv(a), null, null, b, a.oa.encrypted);
                  b.codecs = a.L.codecs;
                  b.mimeType = a.L.mimeType;
                  a.na && !a.na.ef && (b.g = a.na.start + a.na.duration);
                  return b;
                }
                function mw(a, b, c, d, e, f, g, h, k, l, m, n) {
                  Nl.call(this, []);
                  this.F = a;
                  this.h = b;
                  this.H = c;
                  this.C = d;
                  this.G = e;
                  this.J = f;
                  this.j = g;
                  this.l = h;
                  this.u = k;
                  this.B = l;
                  this.I = m;
                  this.K = n;
                  nw(this);
                }
                la(mw, Nl);
                p = mw.prototype;
                p.getNumReferences = function () {
                  return this.h ? this.h.timeline.length : 0;
                };
                p.release = function () {
                  Nl.prototype.release.call(this);
                  this.h = null;
                };
                p.Ya = function (a) {
                  if (this.h) {
                    for (var b = 0, c = this.h.timeline, d = 0; d < c.length; d += 1) if (c[d].end + this.j <= a) b += 1;else break;
                    b > 0 && (this.h.timeline = c.slice(b), this.g.length >= b && (this.g = this.g.slice(b)), this.i += b, this.getNumReferences() === 0 && this.release());
                  }
                };
                function lw(a, b, c, d, e, f) {
                  ow(a, e);
                  a.F = f;
                  if (a.h) {
                    a.h.gd !== b.gd && (a.h.timeline = b.timeline, a.h.gd = b.gd, a.h.Ib = b.Ib);
                    a.h.$b !== b.$b && (a.h.$b = b.$b);
                    c = a.h.timeline;
                    if (c.length) {
                      var g = c[c.length - 1];
                      b = b.timeline.filter(function (h) {
                        return h.end > g.end;
                      });
                    } else b = b.timeline.slice();
                    b.length > 0 && a.h.timeline.push.apply(a.h.timeline, x(b));
                    a.l !== d && (a.l = d);
                  } else a.h = b, a.j = c, a.l = d;
                  nw(a);
                }
                function ow(a, b) {
                  if (a.u !== b) {
                    a.u = b;
                    a = t(a.g);
                    for (var c = a.next(); !c.done; c = a.next()) (c = c.value) && vj(c, b);
                  }
                }
                function nw(a) {
                  if (a.h && !a.o) {
                    for (var b = [], c = t(a.h.timeline), d = c.next(); !d.done; d = c.next()) d = d.value, d.start >= a.l || d.end <= 0 || b.push(d);
                    a.h.timeline = b;
                    a.Ya(a.j);
                  }
                }
                p.find = function (a) {
                  if (this.h && this.h.timeline && this.h.timeline.length && a < this.h.timeline[0].start + this.j) return this.i;
                  if (!this.h) return null;
                  var b = this.h.timeline;
                  if (a < this.j || a >= this.l) return null;
                  for (var c = b.length - 1, d = 0; d < b.length; d++) {
                    var e = b[d],
                      f = e.start + this.j;
                    e = d < c ? b[d + 1].start + this.j : this.l === Infinity ? e.end + this.j : this.l;
                    if (a >= f && a < e) return d + this.i;
                  }
                  return null;
                };
                p.get = function (a) {
                  var b = this;
                  a -= this.i;
                  if (a < 0 || a >= this.getNumReferences() || !this.h) return null;
                  var c = this.g[a];
                  if (!c) {
                    c = this.h.timeline[a];
                    var d = c.Rk,
                      e = c.Eh + this.h.gd,
                      f = this.j - this.h.Ib,
                      g = this.j + c.end,
                      h = g;
                    a === this.getNumReferences() - 1 && this.l !== Infinity && (h = this.F && Math.abs(h - this.l) > .1 ? Math.min(h, this.l) : this.l);
                    var k = this.h.codecs,
                      l = this.h.mimeType,
                      m = this.h.bandwidth,
                      n = [],
                      q = false;
                    c.vc && this.h && this.h.$b && (q = this.h.$b.includes("$SubNumber$"));
                    if (q) {
                      q = (c.end - c.start) / c.vc;
                      for (var r = {}, u = 0; u < c.vc; r = {
                        Pf: void 0,
                        Yi: void 0
                      }, u++) {
                        var v = c.start + q * u,
                          w = v + q;
                        r.Yi = u;
                        r.Pf = null;
                        r = new rj(this.j + v, this.j + w, function (z) {
                          return function () {
                            if (!b.h) return [];
                            z.Pf == null && (z.Pf = pw(b.h.$b, b.H, d, b.C, e, z.Yi, b.G, b.J));
                            return z.Pf;
                          };
                        }(r), 0, null, this.u, f, this.j, this.l, [], "", null, null, sj, this.B);
                        r.codecs = k;
                        r.mimeType = l;
                        r.bandwidth = m;
                        this.I == 0 ? u > 0 && r.wd() : u % this.I != 0 && r.wd();
                        n.push(r);
                      }
                    }
                    c = new rj(this.j + c.start, h, function () {
                      return n.length > 0 || !b.h ? [] : pw(b.h.$b, b.H, d, b.C, e, null, b.G, b.J);
                    }, 0, null, this.u, f, this.j, this.l, n, "", null, null, sj, this.B, n.length > 0);
                    c.codecs = k;
                    c.mimeType = l;
                    c.j = g;
                    c.bandwidth = m;
                    this.g[a] = c;
                  }
                  return c;
                };
                p.Fb = function (a) {
                  nw(this);
                  for (var b = 0; b < this.getNumReferences(); b++) {
                    var c = this.get(b + this.i);
                    c && a(c);
                  }
                };
                function pw(a, b, c, d, e, f, g, h) {
                  a = Cv(a, b, c, f, d || null, e);
                  return uc(g(), [a], h()).map(function (k) {
                    return k.toString();
                  });
                }
                p.Te = function () {
                  return this.K;
                };
                function qw(a) {
                  this.o = null;
                  this.B = a;
                  this.H = new Kg();
                  this.i = [];
                  this.h = null;
                  this.m = [];
                  this.C = null;
                  this.G = [];
                  this.F = 300;
                  this.l = new Map();
                  this.j = new Map();
                  this.g = null;
                  this.u = "UNKNOWN";
                }
                qw.prototype.configure = function (a) {
                  this.o = a;
                };
                qw.prototype.destroy = function () {
                  this.B = this.o = null;
                  this.i = [];
                  this.h = null;
                  this.m = [];
                  this.G = [];
                  this.l.clear();
                  this.g != null && (this.g.stop(), this.g = null);
                  return this.H.destroy();
                };
                qw.prototype.setManifestType = function (a) {
                  this.u = a;
                };
                function rw(a, b) {
                  var c, d, e, f, g, h, k;
                  return P(function (l) {
                    if (l.g == 1) return c = uc(a.i, [sw(a, b)]), d = Rg(c, a.o.retryParameters), e = a.B.networkingEngine.request(8, d), Lg(a.H, e), ua(l, 2), F(l, e.promise, 4);
                    if (l.g != 2) return f = l.h, g = dc(f.data), h = JSON.parse(g), h.VERSION == 1 && tw(a, h, f.uri), xa(l, 0);
                    if ((k = ya(l)) && k.code == 7001) return l.return();
                    a.g != null && (a.g.stop(), a.g = null);
                    a.g = new df(function () {
                      rw(a, b);
                    });
                    a.g.ia(a.F);
                    G(l);
                  });
                }
                function sw(a, b) {
                  if (!a.m.length) return b;
                  b = new Db(b);
                  var c = a.C || a.m[0],
                    d = Math.round(a.B.getBandwidthEstimate()),
                    e = b.g;
                  a.u == "DASH" ? (e.add("_DASH_pathway", c), e.add("_DASH_throughput", String(d))) : a.u == "HLS" && (e.add("_HLS_pathway", c), e.add("_HLS_throughput", String(d)));
                  Sb(e) && Hb(b, e);
                  return b.toString();
                }
                function tw(a, b, c) {
                  a.g != null && (a.g.stop(), a.g = null);
                  var d = b["RELOAD-URI"] || c;
                  a.g = new df(function () {
                    rw(a, d);
                  });
                  if (c = b.TTL) a.F = c;
                  a.g.ia(a.F);
                  a.m = b["PATHWAY-PRIORITY"] || [];
                  a.G = b["PATHWAY-CLONES"] || [];
                }
                function uw(a, b, c, d) {
                  var e = a.l.get(b);
                  e || (e = new Map());
                  e.set(c, d);
                  a.l.set(b, e);
                }
                qw.prototype.banLocation = function (a) {
                  this.j.set(a, Date.now() + 6E4);
                };
                function vw(a, b, c) {
                  c = c === void 0 ? false : c;
                  b = a.l.get(b) || new Map();
                  for (var d = [], e = t(a.m), f = e.next(), g = {}; !f.done; g = {
                    Bd: void 0
                  }, f = e.next()) if (g.Bd = f.value, f = b.get(g.Bd)) d.push({
                    Xg: g.Bd,
                    location: f
                  });else if (f = a.G.find(function (k) {
                    return function (l) {
                      return l.Kl == k.Bd;
                    };
                  }(g))) {
                    var h = b.get(f["BASE-ID"]);
                    h && (f["URI-REPLACEMENT"].ij ? (h = new Db(h), Fb(h, f["URI-REPLACEMENT"].ij), d.push({
                      Xg: g.Bd,
                      location: h.toString()
                    })) : d.push({
                      Xg: g.Bd,
                      location: h
                    }));
                  }
                  e = Date.now();
                  g = t(a.j.keys());
                  for (f = g.next(); !f.done; f = g.next()) f = f.value, h = a.j.get(f), e > h && a.j.delete(f);
                  d = d.filter(function (k) {
                    for (var l = t(a.j.keys()), m = l.next(); !m.done; m = l.next()) if (m.value.includes(new Db(k.location).Db)) return false;
                    return true;
                  });
                  d.length && (a.C = d[0].Xg);
                  d = d.map(function (k) {
                    return k.location;
                  });
                  if (!d.length && a.h) for (e = t(a.h.split(",")), g = e.next(); !g.done; g = e.next()) if (g = b.get(g.value)) a.C = a.h, d.push(g);
                  if (!d.length) for (b = t(b.values()), e = b.next(); !e.done; e = b.next()) d.push(e.value);
                  return c ? d : uc(a.i, d);
                }
                function ww() {
                  this.l = [];
                  this.h = [];
                  this.g = [];
                  this.j = [];
                  this.i = [];
                  this.o = false;
                  this.m = new Set();
                }
                p = ww.prototype;
                p.release = function () {
                  for (var a = t(this.h.concat(this.g, this.j, this.i)), b = a.next(); !b.done; b = a.next()) b = b.value, b.segmentIndex && b.segmentIndex.release();
                  this.h = [];
                  this.g = [];
                  this.j = [];
                  this.i = [];
                  this.l = [];
                  this.o = false;
                  this.m.clear();
                };
                p.bk = function () {
                  return this.l;
                };
                p.Ig = function () {
                  return this.j.slice();
                };
                p.Gj = function () {
                  return this.i;
                };
                p.Th = function (a, b) {
                  if (a) {
                    if (a.type == "audio") for (var c = t(this.h), d = c.next(); !d.done; d = c.next()) d = d.value, d.matchedStreams = d.matchedStreams.filter(function (e) {
                      return e !== a;
                    });else if (a.type == "video") for (c = t(this.g), d = c.next(); !d.done; d = c.next()) d = d.value, d.matchedStreams = d.matchedStreams.filter(function (e) {
                      return e !== a;
                    }), d.trickModeVideo && (d.trickModeVideo.matchedStreams = d.trickModeVideo.matchedStreams.filter(function (e) {
                      return e !== a;
                    })), d.dependencyStream && (d.dependencyStream.matchedStreams = d.dependencyStream.matchedStreams.filter(function (e) {
                      return e !== a;
                    }));else if (a.type == Ac) for (c = t(this.j), d = c.next(); !d.done; d = c.next()) d = d.value, d.matchedStreams = d.matchedStreams.filter(function (e) {
                      return e !== a;
                    });else if (a.type == "image") for (c = t(this.i), d = c.next(); !d.done; d = c.next()) d = d.value, d.matchedStreams = d.matchedStreams.filter(function (e) {
                      return e !== a;
                    });
                    a.segmentIndex && a.closeSegmentIndex();
                    this.m.delete(b);
                  }
                };
                function xw(a, b) {
                  var c = [],
                    d = [],
                    e = [],
                    f = [];
                  a = t(a);
                  for (var g = a.next(); !g.done; g = a.next()) {
                    var h = g.value;
                    g = new Map(h.audioStreams.map(function (n) {
                      return [yw(n), n];
                    }));
                    var k = new Map(h.videoStreams.map(function (n) {
                        return [zw(n), n];
                      })),
                      l = new Map(h.textStreams.map(function (n) {
                        return [Aw(n), n];
                      }));
                    h = new Map(h.imageStreams.map(function (n) {
                      return [Bw(n), n];
                    }));
                    if (b) {
                      var m = Cw(Ac);
                      l.set(Aw(m), m);
                      m = Cw("image");
                      h.set(Bw(m), m);
                    }
                    c.push(g);
                    d.push(k);
                    e.push(l);
                    f.push(h);
                  }
                  return {
                    Mh: c,
                    gj: d,
                    cj: e,
                    ji: f
                  };
                }
                p.hg = function (a, b, c) {
                  c = c === void 0 ? false : c;
                  var d = this,
                    e,
                    f,
                    g,
                    h,
                    k,
                    l,
                    m,
                    n,
                    q,
                    r,
                    u,
                    v,
                    w,
                    z,
                    y,
                    B,
                    D,
                    I,
                    C,
                    A,
                    E,
                    J,
                    H,
                    K,
                    L,
                    O,
                    Q,
                    N,
                    M,
                    R,
                    T,
                    pa;
                  return P(function (Y) {
                    if (Y.g == 1) {
                      e = Cc;
                      if (!b && a.length == 1) return f = xw(a, false), g = f.Mh, h = f.gj, k = f.cj, l = f.ji, d.h = Array.from(g[0].values()), d.g = Array.from(h[0].values()), d.j = Array.from(k[0].values()), d.i = Array.from(l[0].values()), Y.A(2);
                      m = c ? d.m.size : 0;
                      n = -1;
                      for (q = 0; q < a.length; q++) r = a[q], d.m.has(r.id) || (d.m.add(r.id), n == -1 && (n = q));
                      if (n == -1) return Y.return();
                      u = xw(a, true);
                      v = u.Mh;
                      w = u.gj;
                      z = u.cj;
                      y = u.ji;
                      return F(Y, Promise.all([Dw(d, d.h, v, n, Ew, Fw, m), Dw(d, d.g, w, n, Ew, Fw, m), Dw(d, d.j, z, n, Ew, Fw, m), Dw(d, d.i, y, n, Ew, Fw, m)]), 2);
                    }
                    B = 0;
                    D = [];
                    if (d.g.length && d.h.length) for (K = t(d.h), L = K.next(); !L.done; L = K.next()) for (O = L.value, Q = t(d.g), N = Q.next(); !N.done; N = Q.next()) M = N.value, R = rg(O.drmInfos, M.drmInfos), O.drmInfos.length && M.drmInfos.length && !R.length || (T = (O.bandwidth || 0) + (M.bandwidth || 0), O.dependencyStream && (T += O.dependencyStream.bandwidth || 0), M.dependencyStream && (T += M.dependencyStream.bandwidth || 0), pa = B++, D.push({
                      id: pa,
                      language: O.language,
                      disabledUntilTime: 0,
                      primary: O.primary,
                      audio: O,
                      video: M,
                      bandwidth: T,
                      drmInfos: R,
                      allowedByApplication: true,
                      allowedByKeySystem: true,
                      decodingInfos: []
                    }));else for (I = d.g.length ? d.g : d.h, C = t(I), A = C.next(); !A.done; A = C.next()) E = A.value, J = B++, H = E.bandwidth || 0, E.dependencyStream && (H += E.dependencyStream.bandwidth || 0), D.push({
                      id: J,
                      language: E.language,
                      disabledUntilTime: 0,
                      primary: E.primary,
                      audio: E.type == e.ka ? E : null,
                      video: E.type == e.Aa ? E : null,
                      bandwidth: H,
                      drmInfos: E.drmInfos,
                      allowedByApplication: true,
                      allowedByKeySystem: true,
                      decodingInfos: []
                    });
                    d.l = D;
                    G(Y);
                  });
                };
                function Gw(a) {
                  var b, c, d, e, f, g, h, k, l, m, n, q, r, u, v, w, z, y, B, D, I, C, A, E, J, H, K, L, O, Q;
                  return P(function (N) {
                    switch (N.g) {
                      case 1:
                        b = Cc;
                        if (a.length == 1) return N.return(a[0]);
                        c = a.map(function (M) {
                          return new Map(M.filter(function (R) {
                            return R.type === b.ka;
                          }).map(function (R) {
                            return [yw(R), R];
                          }));
                        });
                        d = a.map(function (M) {
                          return new Map(M.filter(function (R) {
                            return R.type === b.Aa;
                          }).map(function (R) {
                            return [zw(R), R];
                          }));
                        });
                        e = a.map(function (M) {
                          return new Map(M.filter(function (R) {
                            return R.type === b.Na;
                          }).map(function (R) {
                            return [Aw(R), R];
                          }));
                        });
                        f = a.map(function (M) {
                          return new Map(M.filter(function (R) {
                            return R.type === b.Uf;
                          }).map(function (R) {
                            return [Bw(R), R];
                          }));
                        });
                        g = t(e);
                        for (h = g.next(); !h.done; h = g.next()) k = h.value, l = Hw(b.Na), k.set(Aw(l), l);
                        m = t(f);
                        for (n = m.next(); !n.done; n = m.next()) q = n.value, r = Hw(b.Uf), q.set(Bw(r), r);
                        u = new ww();
                        return F(N, Dw(u, [], c, 0, Iw, Jw, 0), 2);
                      case 2:
                        return v = N.h, F(N, Dw(u, [], d, 0, Iw, Jw, 0), 3);
                      case 3:
                        return w = N.h, F(N, Dw(u, [], e, 0, Iw, Jw, 0), 4);
                      case 4:
                        return z = N.h, F(N, Dw(u, [], f, 0, Iw, Jw, 0), 5);
                      case 5:
                        y = N.h;
                        B = 0;
                        if (w.length && v.length) for (E = t(v), J = E.next(); !J.done; J = E.next()) for (H = J.value, K = t(w), L = K.next(); !L.done; L = K.next()) O = L.value, Q = B++, O.variantIds.push(Q), H.variantIds.push(Q);else for (D = w.concat(v), I = t(D), C = I.next(); !C.done; C = I.next()) A = C.value, A.variantIds = [B++];
                        return N.return(w.concat(v).concat(z).concat(y));
                    }
                  });
                }
                function Dw(a, b, c, d, e, f, g) {
                  var h, k, l, m, n, q, r, u, v, w, z, y, B, D, I, C, A, E, J;
                  return P(function (K) {
                    switch (K.g) {
                      case 1:
                        h = [];
                        for (k = 0; k < c.length; k++) k >= d ? h.push(new Set(c[k].values())) : h.push(new Set());
                        l = t(b);
                        m = l.next();
                      case 2:
                        if (m.done) {
                          K.A(4);
                          break;
                        }
                        n = m.value;
                        return F(K, Kw(a, n, c, d, f, h, g), 5);
                      case 5:
                        q = K.h;
                        if (!q) throw new U(2, 4, 4037);
                        m = l.next();
                        K.A(2);
                        break;
                      case 4:
                        r = t(h);
                        for (u = r.next(); !u.done; u = r.next()) for (v = u.value, w = t(v), z = w.next(); !z.done; z = w.next()) y = z.value, (B = Lw(a, b, y, c, e, f, h)) && b.push(B);
                        D = t(h);
                        for (I = D.next(); !I.done; I = D.next()) for (C = I.value, A = t(C), E = A.next(), J = {}; !E.done; J = {
                          sh: void 0
                        }, E = A.next()) if (J.sh = E.value, !Mw(J.sh) && b.some(function (L) {
                          return function (O) {
                            return Nw(L.sh, O);
                          };
                        }(J))) throw new U(2, 4, 4037);
                        return K.return(b);
                    }
                  });
                }
                function Kw(a, b, c, d, e, f, g) {
                  return P(function (h) {
                    if (h.g == 1) return Ow(a, c, b, g > 0), b.matchedStreams ? b.segmentIndex ? F(h, Pw(b, d + g), 2) : h.A(2) : h.return(false);
                    Qw(b, d, e, f, g);
                    return h.return(true);
                  });
                }
                function Pw(a, b) {
                  var c, d, e, f, g, h;
                  return P(function (k) {
                    if (k.g == 1) {
                      c = [];
                      d = a.matchedStreams;
                      for (e = b; e < d.length; e++) f = d[e], c.push(f.createSegmentIndex()), f.trickModeVideo && !f.trickModeVideo.segmentIndex && c.push(f.trickModeVideo.createSegmentIndex()), f.dependencyStream && !f.dependencyStream.segmentIndex && c.push(f.dependencyStream.createSegmentIndex());
                      return F(k, Promise.all(c), 2);
                    }
                    if (a.segmentIndex instanceof Ql) for (g = b; g < d.length; g++) h = d[g], h.segmentIndex && a.segmentIndex.h.push(h.segmentIndex);
                    G(k);
                  });
                }
                function Lw(a, b, c, d, e, f, g) {
                  if (Mw(c)) return null;
                  var h = e(c);
                  Ow(a, d, h);
                  h.createSegmentIndex && (h.createSegmentIndex = function () {
                    return P(function (k) {
                      if (h.segmentIndex) return k.A(0);
                      h.segmentIndex = new Ql();
                      return F(k, Pw(h, 0), 0);
                    });
                  }, h.closeSegmentIndex = function () {
                    h.segmentIndex && (h.segmentIndex.release(), h.segmentIndex = null);
                    if (h.matchedStreams) for (var k = t(h.matchedStreams), l = k.next(); !l.done; l = k.next()) {
                      l = l.value;
                      var m;
                      if (m = l.segmentIndex) {
                        a: {
                          m = t(b);
                          for (var n = m.next(); !n.done; n = m.next()) if (n = n.value, n !== h && n.segmentIndex && n.matchedStreams && n.matchedStreams.includes(l)) {
                            m = true;
                            break a;
                          }
                          m = false;
                        }
                        m = !m;
                      }
                      m && (l.segmentIndex.release(), l.segmentIndex = null);
                    }
                  });
                  if (!h.matchedStreams || !h.matchedStreams.length) return null;
                  Qw(h, 0, f, g, 0);
                  return h;
                }
                function Qw(a, b, c, d, e) {
                  var f = a.matchedStreams;
                  for (b += e; b < f.length; b++) {
                    var g = f[b];
                    c(a, g);
                    var h = true;
                    a.type == "audio" && pf(a.language, g.language) == 0 && (h = false);
                    if (h && ((h = d[b - e]) && h.delete(g), g.fullMimeTypes)) for (g = t(g.fullMimeTypes.values()), h = g.next(); !h.done; h = g.next()) a.fullMimeTypes.add(h.value);
                  }
                }
                function Ew(a) {
                  var b = Object.assign({}, a);
                  b.originalId = null;
                  b.createSegmentIndex = function () {
                    return Promise.resolve();
                  };
                  b.closeSegmentIndex = function () {};
                  b.roles = b.roles.slice();
                  b.segmentIndex = null;
                  b.emsgSchemeIdUris = [];
                  b.keyIds = new Set(a.keyIds);
                  b.closedCaptions = a.closedCaptions ? new Map(a.closedCaptions) : null;
                  b.trickModeVideo = null;
                  b.dependencyStream = null;
                  return b;
                }
                function Iw(a) {
                  var b = Object.assign({}, a);
                  b.roles = b.roles.slice();
                  b.keyIds = new Set(a.keyIds);
                  b.segments = [];
                  b.variantIds = [];
                  b.closedCaptions = a.closedCaptions ? new Map(a.closedCaptions) : null;
                  return b;
                }
                function Fw(a, b) {
                  function c(g, h) {
                    g || (g = []);
                    h = t(h);
                    for (var k = h.next(); !k.done; k = h.next()) k = k.value, g.includes(k) || g.push(k);
                    return g;
                  }
                  a.roles = c(a.roles, b.roles);
                  b.emsgSchemeIdUris && (a.emsgSchemeIdUris = c(a.emsgSchemeIdUris, b.emsgSchemeIdUris));
                  for (var d = t(b.keyIds), e = d.next(); !e.done; e = d.next()) a.keyIds.add(e.value);
                  a.originalId == null ? a.originalId = b.originalId : (d = b.originalId || "") && !a.originalId.endsWith(d) && (a.originalId += "," + d);
                  d = rg(a.drmInfos, b.drmInfos);
                  if (b.drmInfos.length && a.drmInfos.length && !d.length) throw new U(2, 4, 4038);
                  a.drmInfos = d;
                  a.encrypted = a.encrypted || b.encrypted;
                  if (b.closedCaptions) for (a.closedCaptions || (a.closedCaptions = new Map()), d = t(b.closedCaptions), e = d.next(); !e.done; e = d.next()) {
                    var f = t(e.value);
                    e = f.next().value;
                    f = f.next().value;
                    a.closedCaptions.set(e, f);
                  }
                  a.bandwidth && b.bandwidth && (a.bandwidth = Math.max(a.bandwidth, b.bandwidth));
                  b.trickModeVideo ? (a.trickModeVideo || (a.trickModeVideo = Ew(b.trickModeVideo), a.trickModeVideo.matchedStreams = [], a.trickModeVideo.createSegmentIndex = function () {
                    if (a.trickModeVideo.segmentIndex) return Promise.resolve();
                    for (var g = new Ql(), h = t(a.trickModeVideo.matchedStreams), k = h.next(); !k.done; k = h.next()) g.h.push(k.value.segmentIndex);
                    a.trickModeVideo.segmentIndex = g;
                    return Promise.resolve();
                  }), a.trickModeVideo.matchedStreams.push(b.trickModeVideo), Fw(a.trickModeVideo, b.trickModeVideo)) : a.trickModeVideo && (a.trickModeVideo.matchedStreams.push(b), Fw(a.trickModeVideo, b));
                  b.dependencyStream ? (a.dependencyStream || (a.dependencyStream = Ew(b.dependencyStream), a.dependencyStream.matchedStreams = [], a.dependencyStream.createSegmentIndex = function () {
                    if (a.dependencyStream.segmentIndex) return Promise.resolve();
                    for (var g = new Ql(), h = t(a.dependencyStream.matchedStreams), k = h.next(); !k.done; k = h.next()) g.h.push(k.value.segmentIndex);
                    a.dependencyStream.segmentIndex = g;
                    return Promise.resolve();
                  }), a.dependencyStream.matchedStreams.push(b.dependencyStream), Fw(a.dependencyStream, b.dependencyStream)) : a.dependencyStream && (a.dependencyStream.matchedStreams.push(b), Fw(a.dependencyStream, b));
                }
                function Jw(a, b) {
                  var c = a.roles;
                  c || (c = []);
                  for (var d = t(b.roles), e = d.next(); !e.done; e = d.next()) e = e.value, c.includes(e) || c.push(e);
                  a.roles = c;
                  c = t(b.keyIds);
                  for (d = c.next(); !d.done; d = c.next()) a.keyIds.add(d.value);
                  a.encrypted = a.encrypted && b.encrypted;
                  a.segments.push.apply(a.segments, x(b.segments));
                  if (b.closedCaptions) for (a.closedCaptions || (a.closedCaptions = new Map()), b = t(b.closedCaptions), c = b.next(); !c.done; c = b.next()) d = t(c.value), c = d.next().value, d = d.next().value, a.closedCaptions.set(c, d);
                }
                function Ow(a, b, c, d) {
                  d = (d === void 0 ? 0 : d) ? c.matchedStreams : [];
                  b = t(b);
                  for (var e = b.next(); !e.done; e = b.next()) {
                    e = Rw(a, e.value, c);
                    if (!e) return;
                    d.push(e);
                  }
                  c.matchedStreams = d;
                }
                function Rw(a, b, c) {
                  var d = {
                      audio: yw,
                      video: zw,
                      text: Aw,
                      image: Bw
                    }[c.type],
                    e = null,
                    f = d(c);
                  if (b.has(f)) e = b.get(f);else {
                    f = {
                      audio: function audio(l, m) {
                        return Nw(l, m);
                      },
                      video: function video(l, m) {
                        return Nw(l, m);
                      },
                      text: Sw,
                      image: Tw
                    }[c.type];
                    for (var g = {
                        audio: Uw,
                        video: Vw,
                        text: Ww,
                        image: jx
                      }[c.type], h = t(b.values()), k = h.next(); !k.done; k = h.next()) k = k.value, !f(c, k) || c.fastSwitching != k.fastSwitching || e && !g(c, e, k) || (e = k);
                  }
                  a.o && !Mw(e) && b.delete(d(e));
                  return e;
                }
                function kx(a, b) {
                  return a.mimeType != b.mimeType ? false : lx(a.codecs) === lx(b.codecs);
                }
                p.Si = function (a) {
                  this.o = a;
                };
                function Nw(a, b) {
                  return a.drmInfos && !pg(a.drmInfos, b.drmInfos) ? false : true;
                }
                function Sw(a, b) {
                  return b.language ? a.forced !== b.forced || pf(a.language, b.language) == 0 || b.kind != a.kind ? false : true : true;
                }
                function Tw() {
                  return true;
                }
                function Uw(a, b, c) {
                  var d = mx(a, b, c);
                  if (d === nx) return true;
                  if (d === ox) return false;
                  d = pf(a.language, b.language);
                  var e = pf(a.language, c.language);
                  if (e > d) return true;
                  if (e < d) return false;
                  if (b.label !== c.label) {
                    if (a.label === b.label) return false;
                    if (a.label === c.label) return true;
                  }
                  if (a.roles.length) {
                    d = b.roles.filter(function (f) {
                      return a.roles.includes(f);
                    });
                    e = c.roles.filter(function (f) {
                      return a.roles.includes(f);
                    });
                    if (e.length > d.length) return true;
                    if (e.length < d.length) return false;
                    if (c.roles.length !== b.roles.length) return c.roles.length < b.roles.length;
                  } else {
                    if (!c.roles.length && b.roles.length) return true;
                    if (c.roles.length && !b.roles.length) return false;
                  }
                  if (!b.primary && c.primary) return true;
                  if (b.primary && !c.primary) return false;
                  d = px(a.channelsCount, b.channelsCount, c.channelsCount);
                  if (d == nx) return true;
                  if (d == ox) return false;
                  d = px(a.audioSamplingRate, b.audioSamplingRate, c.audioSamplingRate);
                  return d == nx ? true : d == ox ? false : a.bandwidth && qx(a.bandwidth, b.bandwidth, c.bandwidth) == nx ? true : false;
                }
                function Vw(a, b, c) {
                  var d = mx(a, b, c);
                  if (d === nx) return true;
                  if (d === ox) return false;
                  d = px(a.width * a.height, b.width * b.height, c.width * c.height);
                  if (d == nx) return true;
                  if (d == ox) return false;
                  if (a.frameRate) {
                    d = px(a.frameRate, b.frameRate, c.frameRate);
                    if (d == nx) return true;
                    if (d == ox) return false;
                  }
                  return a.bandwidth && qx(a.bandwidth, b.bandwidth, c.bandwidth) == nx ? true : false;
                }
                function Ww(a, b, c) {
                  var d = pf(a.language, b.language),
                    e = pf(a.language, c.language);
                  if (e > d) return true;
                  if (e < d) return false;
                  if (!b.primary && c.primary) return true;
                  if (b.primary && !c.primary) return false;
                  if (b.label !== c.label) {
                    if (a.label === b.label) return false;
                    if (a.label === c.label) return true;
                  }
                  if (a.roles.length) {
                    d = b.roles.filter(function (f) {
                      return a.roles.includes(f);
                    });
                    e = c.roles.filter(function (f) {
                      return a.roles.includes(f);
                    });
                    if (e.length > d.length) return true;
                    if (e.length < d.length) return false;
                  } else {
                    if (!c.roles.length && b.roles.length) return true;
                    if (c.roles.length && !b.roles.length) return false;
                  }
                  return c.mimeType != a.mimeType || c.codecs != a.codecs || b.mimeType == a.mimeType && b.codecs == a.codecs ? false : true;
                }
                function jx(a, b, c) {
                  return px(a.width * a.height, b.width * b.height, c.width * c.height) == nx ? true : false;
                }
                function Hw(a) {
                  return {
                    id: 0,
                    originalId: "",
                    groupId: null,
                    primary: false,
                    type: a,
                    mimeType: "",
                    codecs: "",
                    language: "",
                    originalLanguage: null,
                    label: null,
                    width: null,
                    height: null,
                    encrypted: false,
                    keyIds: new Set(),
                    segments: [],
                    variantIds: [],
                    roles: [],
                    forced: false,
                    channelsCount: null,
                    audioSamplingRate: null,
                    spatialAudio: false,
                    closedCaptions: null,
                    external: false,
                    fastSwitching: false,
                    isAudioMuxedInVideo: false,
                    baseOriginalId: null
                  };
                }
                function Cw(a) {
                  return {
                    id: 0,
                    originalId: "",
                    groupId: null,
                    createSegmentIndex: function createSegmentIndex() {
                      return Promise.resolve();
                    },
                    segmentIndex: new Nl([]),
                    mimeType: "",
                    codecs: "",
                    encrypted: false,
                    drmInfos: [],
                    keyIds: new Set(),
                    language: "",
                    originalLanguage: null,
                    label: null,
                    type: a,
                    primary: false,
                    trickModeVideo: null,
                    dependencyStream: null,
                    emsgSchemeIdUris: null,
                    roles: [],
                    forced: false,
                    channelsCount: null,
                    audioSamplingRate: null,
                    spatialAudio: false,
                    closedCaptions: null,
                    accessibilityPurpose: null,
                    external: false,
                    fastSwitching: false,
                    fullMimeTypes: new Set(),
                    isAudioMuxedInVideo: false,
                    baseOriginalId: null
                  };
                }
                function px(a, b, c) {
                  if (b == a && a != c) return ox;
                  if (c == a && a != b) return nx;
                  if (b > a) {
                    if (c <= a || c - a < b - a) return nx;
                    if (c - a > b - a) return ox;
                  } else {
                    if (c > a) return ox;
                    if (a - c < a - b) return nx;
                    if (a - c > a - b) return ox;
                  }
                  return rx;
                }
                function mx(a, b, c) {
                  var d = a.mimeType === b.mimeType && a.codecs === b.codecs,
                    e = a.mimeType === c.mimeType && a.codecs === c.codecs;
                  if (d && !e) return ox;
                  if (!d && e) return nx;
                  b = kx(a, b);
                  a = kx(a, c);
                  return b && !a ? ox : !b && a ? nx : rx;
                }
                function qx(a, b, c) {
                  b = Math.abs(a - b);
                  a = Math.abs(a - c);
                  return a < b ? nx : b < a ? ox : rx;
                }
                function Mw(a) {
                  switch (a.type) {
                    case Ac:
                      return !a.language;
                    case "image":
                      return !a.tilesLayout;
                    default:
                      return false;
                  }
                }
                function zw(a) {
                  return sx([a.fastSwitching, a.width, a.frameRate, a.codecs, a.mimeType, a.label, a.roles, a.closedCaptions ? Array.from(a.closedCaptions.entries()) : null, a.bandwidth, a.dependencyStream ? a.dependencyStream.baseOriginalId : null, Array.from(a.keyIds)]);
                }
                function yw(a) {
                  return sx([a.fastSwitching, a.channelsCount, a.language, a.bandwidth, a.label, a.codecs, a.mimeType, a.roles, a.audioSamplingRate, a.primary, a.dependencyStream ? a.dependencyStream.baseOriginalId : null, Array.from(a.keyIds)]);
                }
                function Aw(a) {
                  return sx([a.language, a.label, a.codecs, a.mimeType, a.bandwidth, a.roles]);
                }
                function Bw(a) {
                  return sx([a.width, a.codecs, a.mimeType]);
                }
                function sx(a) {
                  return JSON.stringify(a);
                }
                function lx(a) {
                  if (!tx.has(a)) {
                    var b = Ke(a);
                    tx.set(a, b);
                  }
                  return tx.get(a);
                }
                S("shaka.util.PeriodCombiner", ww);
                ww.prototype.setUseStreamOnce = ww.prototype.Si;
                ww.prototype.combinePeriods = ww.prototype.hg;
                ww.prototype.deleteStream = ww.prototype.Th;
                ww.prototype.getImageStreams = ww.prototype.Gj;
                ww.prototype.getTextStreams = ww.prototype.Ig;
                ww.prototype.getVariants = ww.prototype.bk;
                var nx = 1,
                  rx = 0,
                  ox = -1,
                  tx = new Map();
                function ux(a, b) {
                  var c = new DOMParser(),
                    d = vx.value()(a);
                  a = null;
                  try {
                    a = c.parseFromString(d, "text/xml");
                  } catch (e) {
                    return null;
                  }
                  c = a.documentElement;
                  if (!c || c.getElementsByTagName("parsererror").length || c.tagName != b) return null;
                  if (!("createNodeIterator" in document)) return c;
                  for (b = document.createNodeIterator(a, NodeFilter.SHOW_ALL); a = b.nextNode();) if (a instanceof HTMLElement || a instanceof SVGElement) return null;
                  return c;
                }
                function wx(a, b) {
                  try {
                    var c = hc(a);
                    return ux(c, b);
                  } catch (d) {
                    return null;
                  }
                }
                var vx = new sb(function () {
                  if (typeof trustedTypes !== "undefined") {
                    var a = trustedTypes.createPolicy("shaka-player#xml", {
                      createHTML: function createHTML(b) {
                        return b;
                      }
                    });
                    return function (b) {
                      return a.createHTML(b);
                    };
                  }
                  return function (b) {
                    return b;
                  };
                });
                function xx() {
                  var a = this;
                  this.j = this.g = null;
                  this.B = [];
                  this.h = null;
                  this.Fa = 1;
                  this.H = [];
                  this.l = {
                    qf: "",
                    type: "",
                    profiles: [],
                    sc: null,
                    rb: 0,
                    cb: null,
                    le: 0
                  };
                  this.u = new Map();
                  this.C = new Map();
                  this.o = new Map();
                  this.F = new Map();
                  this.ya = new Map();
                  this.m = new ww();
                  this.K = 0;
                  this.Da = new Va(5);
                  this.M = new df(function () {
                    if (a.J && !a.g.continueLoadingWhenPaused && (a.I.Ma(a.J, "timeupdate"), a.J.paused)) {
                      a.I.Ba(a.J, "timeupdate", function () {
                        return yx(a);
                      });
                      return;
                    }
                    yx(a);
                  });
                  this.R = new Kg();
                  this.O = null;
                  this.G = [];
                  this.aa = Infinity;
                  this.va = false;
                  this.i = null;
                  this.N = 0;
                  this.T = false;
                  this.I = new nb();
                  this.J = null;
                  this.V = false;
                  this.$ = "";
                  this.qa = function () {
                    return false;
                  };
                  this.X = [];
                  this.ma = new Set();
                  this.xa = new tv();
                }
                p = xx.prototype;
                p.configure = function (a, b) {
                  var c = this.j && a.updatePeriod != this.g.updatePeriod && a.updatePeriod >= 0;
                  this.g = a;
                  b && (this.qa = b);
                  c && this.h && this.h.presentationTimeline.W() && this.M.Jb();
                  this.i && this.i.configure(this.g);
                  this.m && this.m.Si(this.g.dash.useStreamOnceInPeriodFlattening);
                };
                p.start = function (a, b) {
                  var c = this,
                    d;
                  return P(function (e) {
                    if (e.g == 1) return c.va = b.isLowLatencyMode(), c.B = [a], c.j = b, F(e, zx(c), 2);
                    d = e.h;
                    c.j && Ax(c, d);
                    if (!c.j) throw new U(2, 7, 7001);
                    return e.return(c.h);
                  });
                };
                p.stop = function () {
                  for (var a = t(this.o.values()), b = a.next(); !b.done; b = a.next()) b = b.value, b.segmentIndex && b.segmentIndex.release();
                  this.m && this.m.release();
                  this.g = this.j = null;
                  this.B = [];
                  this.h = null;
                  this.o.clear();
                  this.F.clear();
                  this.u.clear();
                  this.C.clear();
                  this.l = {
                    qf: "",
                    type: "",
                    profiles: [],
                    sc: null,
                    rb: 0,
                    cb: null,
                    le: 0
                  };
                  this.m = null;
                  this.M != null && (this.M.stop(), this.M = null);
                  this.i && this.i.destroy();
                  this.I && (this.I.release(), this.I = null);
                  this.ma.clear();
                  this.xa.release();
                  return this.R.destroy();
                };
                p.update = function () {
                  var a = this,
                    b;
                  return P(function (c) {
                    if (c.g == 1) return ua(c, 2), F(c, zx(a), 4);
                    if (c.g != 2) return xa(c, 0);
                    b = ya(c);
                    if (!a.j || !b) return c.return();
                    a.j.onError(b);
                    G(c);
                  });
                };
                p.onExpirationUpdated = function () {};
                p.onInitialVariantChosen = function (a) {
                  if (this.h && this.h.presentationTimeline.W()) {
                    var b = a.video || a.audio;
                    if (b && b.segmentIndex) {
                      a = this.h.presentationTimeline.Hc();
                      var c = b.segmentIndex.find(a);
                      c != null && (b = b.segmentIndex.get(c)) && (this.K = b.endTime - a, Ax(this, 0));
                    }
                  }
                };
                p.banLocation = function (a) {
                  this.i && this.i.banLocation(a);
                };
                p.setMediaElement = function (a) {
                  this.J = a;
                };
                function zx(a) {
                  var b, c, d, e, f, g, h, k, l, m, n;
                  return P(function (q) {
                    if (q.g == 1) return b = 4, c = "MPD", d = Bx(a), e = a.B, d.length ? (e = d, c = "Patch", b = 6) : a.B.length > 1 && a.i && (f = vw(a.i, "Location", true), f.length && (e = f)), g = Rg(e, a.g.retryParameters), h = Date.now(), F(q, Cx(a, g, 0, {
                      type: b
                    }), 2);
                    if (q.g != 3) {
                      k = q.h;
                      if (!a.j) return q.return(0);
                      k.uri && k.uri != k.originalUri && !a.B.includes(k.uri) && a.B.unshift(k.uri);
                      l = new Db(k.uri);
                      a.$ = l.g.toString();
                      return F(q, Dx(a, k.data, k.uri, c), 3);
                    }
                    m = Date.now();
                    n = (m - h) / 1E3;
                    a.Da.sample(1, n);
                    a.ma.clear();
                    return q.return(n);
                  });
                }
                function Dx(a, b, c, d) {
                  var e, f, g, h, k, l, m, q, r, u;
                  return P(function (v) {
                    if (v.g == 1) {
                      e = b;
                      f = a.g.dash.manifestPreprocessor;
                      g = On;
                      if (f != g) {
                        yb("manifest.dash.manifestPreprocessor configuration", "Please Use manifest.dash.manifestPreprocessorTXml instead.");
                        h = wx(e, d);
                        if (!h) throw new U(2, 4, 4001, c);
                        f(h);
                        e = ic(h.outerHTML);
                      }
                      k = jd(e, d);
                      if (!k) throw new U(2, 4, 4001, c);
                      l = a.g.dash.manifestPreprocessorTXml;
                      m = Pn;
                      l != m && l(k);
                      if (d === "Patch") return v.return(Ex(a, k));
                      if (a.g.dash.disableXlinkProcessing) return v.return(Fx(a, k, c));
                      q = a.g.dash.xlinkFailGracefully;
                      r = Iv(k, a.g.retryParameters, q, c, a.j.networkingEngine);
                      Lg(a.R, r);
                      return F(v, r.promise, 2);
                    }
                    u = v.h;
                    return v.return(Fx(a, u, c));
                  });
                }
                function Fx(a, b, c) {
                  var d, e, f, g, h, k, l, m, n, q, r, u, v, w, z, B, D, I, C, A, E, J, H, K, L, O, Q, N, M, R, T, pa, Y, Ha, Ba, Ca, za, oa, wa, Fa, Ea, ta, Za, bb, ib, Na, Xb, Sf, dd, ke, md, Tf, Kj, qh;
                  return P(function (Wc) {
                    switch (Wc.g) {
                      case 1:
                        a.i && a.i.l.clear();
                        d = [c];
                        e = [];
                        f = new Map();
                        g = td(b, "Location");
                        h = t(g);
                        for (k = h.next(); !k.done; k = h.next()) if (l = k.value, m = l.attributes.serviceLocation, n = vd(l)) q = uc(d, [n])[0], m && (a.i ? uw(a.i, "Location", m, q) : f.set(m, q)), e.push(q);
                        a.i ? (r = vw(a.i, "Location", true), r.length > 0 && (d = a.B = r)) : e.length && (d = a.B = e);
                        a.l.qf = b.attributes.id || "";
                        a.l.le = Ad(b, "publishTime", Dd) || 0;
                        a.H = td(b, "PatchLocation");
                        u = Promise.resolve();
                        if ((v = xd(b, "ContentSteering")) && a.j) {
                          w = v.attributes.defaultServiceLocation;
                          if (a.i) a.i.i = d, a.i.h = w;else if (a.i = new qw(a.j), a.i.configure(a.g), a.i.setManifestType("DASH"), a.i.i = d, a.i.h = w, z = vd(v)) Ad(v, "queryBeforeStart", Kd, false) ? u = rw(a.i, z) : rw(a.i, z);
                          B = t(f.keys());
                          for (D = B.next(); !D.done; D = B.next()) I = D.value, C = f.get(I), uw(a.i, "Location", I, C);
                        }
                        A = td(b, "BaseURL");
                        E = false;
                        if (a.i) for (J = t(A), H = J.next(); !H.done; H = J.next()) K = H.value, L = K.attributes.serviceLocation, O = vd(K), L && O && (uw(a.i, "BaseURL", L, O), E = true);
                        a.X.splice(0);
                        E && a.i || (Q = A.map(vd), a.X.push.apply(a.X, x(uc(d, Q))));
                        N = a.i;
                        M = a.X;
                        R = function R() {
                          return N && E ? vw(N, "BaseURL") : M.slice();
                        };
                        a.l.cb = R;
                        T = 0;
                        A && A.length && (T = Ad(A[0], "availabilityTimeOffset", Jd) || 0);
                        a.l.rb = T;
                        a.K = Ad(b, "minimumUpdatePeriod", Ed, -1);
                        pa = Ad(b, "availabilityStartTime", Dd);
                        Y = Ad(b, "timeShiftBufferDepth", Ed);
                        Ha = a.g.dash.ignoreSuggestedPresentationDelay;
                        Ba = null;
                        Ha || (Ba = Ad(b, "suggestedPresentationDelay", Ed));
                        Ca = a.g.dash.ignoreMaxSegmentDuration;
                        za = null;
                        Ca || (za = Ad(b, "maxSegmentDuration", Ed));
                        oa = b.attributes.type || "static";
                        a.h && a.h.presentationTimeline && (a.V = a.h.presentationTimeline.W() && oa == "static");
                        a.l.type = oa;
                        if (a.h) for (wa = a.h.presentationTimeline, Fa = wa.Hb(), Ea = t(a.o.values()), ta = Ea.next(); !ta.done; ta = Ea.next()) Za = ta.value, Za.segmentIndex && Za.segmentIndex.Ya(Fa);else bb = a.g.dash.ignoreMinBufferTime, ib = 0, bb || (ib = Ad(b, "minBufferTime", Ed) || 0), Na = 0, Na = Ba != null ? Math.min(Ba, Y || Infinity) : a.g.defaultPresentationDelay > 0 ? a.g.defaultPresentationDelay : Math.min(ib * 1.5, Y || Infinity), wa = new ol(pa, Na, a.g.dash.autoCorrectDrift);
                        wa.cd(oa == "static");
                        wa.W() && !isNaN(a.g.availabilityWindowOverride) && (Y = a.g.availabilityWindowOverride);
                        Y == null && (Y = Infinity);
                        wa.Hf(Y);
                        Xb = b.attributes.profiles || "";
                        a.l.profiles = Xb.split(",");
                        Sf = {
                          Eb: oa != "static",
                          presentationTimeline: wa,
                          sa: null,
                          na: null,
                          oa: null,
                          L: null,
                          bandwidth: 0,
                          Kg: false,
                          rb: T,
                          sc: null,
                          profiles: Xb.split(","),
                          roles: null,
                          Lb: function Lb() {
                            return "";
                          }
                        };
                        return F(Wc, u, 2);
                      case 2:
                        a.N = 0;
                        dd = Gx(a, Sf, R, b, false);
                        ke = dd.duration;
                        md = dd.periods;
                        (oa != "static" || a.V) && dd.Vh || wa.Ab(ke || Infinity);
                        a.T && a.va && wa.Pi(a.aa);
                        wa.Sg(za || 1);
                        a.T && a.va && (Tf = Ba != null ? Ba : a.g.defaultPresentationDelay, wa.nh(Tf));
                        if (!a.h) return F(Wc, a.m.hg(md, Sf.Eb), 6);
                        a.h.periodCount = md.length;
                        a.h.gapCount = a.N;
                        return F(Wc, Hx(a, md, false), 4);
                      case 6:
                        a.h = {
                          presentationTimeline: wa,
                          variants: a.m.l,
                          textStreams: a.m.Ig(),
                          imageStreams: a.m.i,
                          offlineSessionIds: [],
                          sequenceMode: a.g.dash.sequenceMode,
                          ignoreManifestTimestampsInSegmentsMode: false,
                          type: "DASH",
                          serviceDescription: Ix(b),
                          nextUrl: Jx(b),
                          periodCount: md.length,
                          gapCount: a.N,
                          isLowLatency: a.T,
                          startTime: null
                        };
                        if (!wa.fj()) {
                          Wc.A(7);
                          break;
                        }
                        Kj = td(b, "UTCTiming");
                        return F(Wc, Kx(a, R, Kj), 8);
                      case 8:
                        qh = Wc.h;
                        if (!a.j) return Wc.return();
                        wa.Qi(qh);
                      case 7:
                        wa.lf(), a.m && !a.h.presentationTimeline.W() && a.m.release();
                      case 4:
                        a.j.makeTextStreamsForClosedCaptions(a.h), Lx(a), Mx(a, md), G(Wc);
                    }
                  });
                }
                function Hx(a, b, c) {
                  var d;
                  return P(function (e) {
                    if (e.g == 1) return F(e, a.m.hg(b, true, c), 2);
                    a.h.variants = a.m.l;
                    d = a.m.Ig();
                    d.length > 0 && (a.h.textStreams = d);
                    a.h.imageStreams = a.m.i;
                    a.j.filter(a.h);
                    G(e);
                  });
                }
                function Ex(a, b) {
                  var c, d, e, f, g, h, k, l, m, n, q, r, u, v, w, z, y, B, D, I, C, A, E, J, H, K, L;
                  return P(function (O) {
                    if (O.g == 1) {
                      c = b.attributes.mpdId;
                      d = Ad(b, "originalPublishTime", Dd);
                      if (!c || c !== a.l.qf || d !== a.l.le) throw a.H = [], new U(1, 4, 4052);
                      e = [];
                      f = [];
                      g = new Set();
                      h = t(sd(b));
                      for (k = h.next(); !k.done; k = h.next()) if (l = k.value, m = Md(l.attributes.sel || ""), n = m[m.length - 1], q = vd(l) || "", n.name === "MPD") {
                        if (n.Cc === "mediaPresentationDuration") {
                          r = vd(l) || "";
                          var Q = Ed(r);
                          if (Q != null) {
                            a.l.sc = Q;
                            for (var N = t(a.u.values()), M = N.next(); !M.done; M = N.next()) M.value.sc = Q;
                          }
                        } else if (n.Cc === "type") {
                          a.h.presentationTimeline.cd(q == "static");
                          a.l.type = q;
                          Q = t(a.u.values());
                          for (N = Q.next(); !N.done; N = Q.next()) N.value.Eb = q == "dynamic";
                          q == "static" && (a.K = -1);
                        } else n.Cc === "publishTime" ? a.l.le = Dd(q) || 0 : n.Cc === null && l.tagName === "add" && f.push(l);
                      } else if (n.name === "PatchLocation") Nd(a.H, l);else if (n.name === "Period") l.tagName === "add" ? f.push(l) : l.tagName === "remove" && n.id && Nx(a, n.id);else if (n.name === "SegmentTemplate") {
                        N = Md(l.attributes.sel || "");
                        Q = N[N.length - 1];
                        if (Q.Cc) {
                          N = Ox(a, N);
                          M = vd(l) || "";
                          for (var R = t(N), T = R.next(); !T.done; T = R.next()) T = a.u.get(T.value), Pd(T.L.Nc, l.tagName, Q.Cc, M);
                          Q = N;
                        } else Q = [];
                        u = Q;
                        v = t(u);
                        for (w = v.next(); !w.done; w = v.next()) z = w.value, g.add(z);
                      } else if (n.name === "SegmentTimeline" || n.name === "S") {
                        Q = Md(l.attributes.sel || "");
                        Q = Ox(a, Q);
                        N = t(Q);
                        for (M = N.next(); !M.done; M = N.next()) M = a.u.get(M.value), M = Fv(M, gw, "SegmentTimeline"), R = td(M, "S"), Nd(R, l), M.children = R;
                        y = Q;
                        B = t(y);
                        for (D = B.next(); !D.done; D = B.next()) I = D.value, g.add(I);
                      }
                      C = t(g);
                      for (A = C.next(); !A.done; A = C.next()) E = A.value, Px(a, E);
                      J = t(f);
                      for (H = J.next(); !H.done; H = J.next()) K = H.value, e.push.apply(e, x(Qx(a, K)));
                      if (!e.length) return O.A(2);
                      a.h.periodCount += e.length;
                      a.h.gapCount = a.N;
                      return F(O, Hx(a, e, true), 2);
                    }
                    a.l.type == "static" && (L = a.l.sc, a.h.presentationTimeline.Ab(L || Infinity));
                    G(O);
                  });
                }
                function Qx(a, b) {
                  return Gx(a, {
                    Eb: a.l.type == "dynamic",
                    presentationTimeline: a.h.presentationTimeline,
                    sa: null,
                    na: null,
                    oa: null,
                    L: null,
                    bandwidth: 0,
                    Kg: false,
                    rb: a.l.rb,
                    profiles: a.l.profiles,
                    sc: a.l.sc,
                    roles: null,
                    Lb: function Lb() {
                      return "";
                    }
                  }, a.l.cb, b, true).periods;
                }
                function Nx(a, b) {
                  a.h.periodCount--;
                  for (var c = t(a.u.keys()), d = c.next(); !d.done; d = c.next()) if (d = d.value, d.startsWith(b)) {
                    var e = a.u.get(d);
                    Fv(e, gw, "SegmentTimeline").children = [];
                    Px(a, d);
                    a.u.delete(d);
                  }
                  a.G = a.G.filter(function (f) {
                    return f !== b;
                  });
                }
                function Ox(a, b) {
                  var c = "",
                    d = "",
                    e = -1,
                    f = "";
                  b = t(b);
                  for (var g = b.next(); !g.done; g = b.next()) g = g.value, g.name === "Period" ? c = g.id : g.name === "AdaptationSet" ? (d = g.id, g.position !== null && (e = g.position)) : g.name === "Representation" && (f = g.id);
                  b = [];
                  if (f) b.push(c + "," + f);else if (d) for (e = t(a.u.values()), a = e.next(); !a.done; a = e.next()) a = a.value, a.sa.id === c && a.oa.id === d && a.L.id && b.push(c + "," + a.L.id);else if (e > -1) for (d = t(a.u.values()), a = d.next(); !a.done; a = d.next()) a = a.value, a.sa.id === c && a.oa.position === e && a.L.id && b.push(c + "," + a.L.id);
                  return b;
                }
                function Px(a, b) {
                  var c = a.u.get(b),
                    d = a.o.get(b);
                  d.segmentIndex && d.segmentIndex.Ya(a.h.presentationTimeline.Hb());
                  try {
                    var e = fw(c, function (f, g, h, k) {
                      return Rx(a, f, g, h, k);
                    }, a.o, !0, a.g.dash.initialSegmentLimit, a.ya, c.L.aesKey, null, !0, a.C);
                    d.createSegmentIndex = function () {
                      return P(function (f) {
                        if (f.g == 1) return d.segmentIndex ? f.A(0) : F(f, e.Sc(), 3);
                        d.segmentIndex = f.h;
                        G(f);
                      });
                    };
                  } catch (f) {
                    if (b = c.L.contentType, b != Ac && b != "application" && b != "image" || f.code != 4002) throw f;
                  }
                }
                function Ix(a) {
                  var b = xd(a, "ServiceDescription");
                  if (!b) return null;
                  a = xd(b, "Latency");
                  b = xd(b, "PlaybackRate");
                  if (!a && !b) return null;
                  var c = {};
                  a && ("target" in a.attributes && (c.targetLatency = parseInt(a.attributes.target, 10) / 1E3), "max" in a.attributes && (c.maxLatency = parseInt(a.attributes.max, 10) / 1E3), "min" in a.attributes && (c.minLatency = parseInt(a.attributes.min, 10) / 1E3));
                  b && ("max" in b.attributes && (c.maxPlaybackRate = parseFloat(b.attributes.max)), "min" in b.attributes && (c.minPlaybackRate = parseFloat(b.attributes.min)));
                  return c;
                }
                function Jx(a) {
                  a = td(a, "SupplementalProperty");
                  if (!a.length) return null;
                  a = t(a);
                  for (var b = a.next(); !b.done; b = a.next()) if (b = b.value, b.attributes.schemeIdUri == "urn:mpeg:dash:chaining:2016") return b.attributes.value;
                  return null;
                }
                function Gx(a, b, c, d, e) {
                  var f = b.sc;
                  f || (f = Ad(d, "mediaPresentationDuration", Ed), a.l.sc = f);
                  var g = 0;
                  a.h && a.h.presentationTimeline && a.V && (g = a.h.presentationTimeline.Xb());
                  var h = [],
                    k = g;
                  d = td(d, "Period");
                  for (var l = 0; l < d.length; l++) {
                    var m = d[l],
                      n = d[l + 1],
                      q = Ad(m, "start", Ed, k),
                      r = m.attributes.id,
                      u = Ad(m, "duration", Ed);
                    q = l == 0 && q == 0 && a.V ? g : q;
                    var v = null;
                    if (n) {
                      var w = Ad(n, "start", Ed);
                      w != null && (v = w - q + g);
                    } else f != null && (v = f - q + g);
                    w = Dc;
                    v && u && Math.abs(v - u) > w && v > u && a.N++;
                    v == null && (v = u);
                    if (!(a.O !== null && r !== null && q !== null && q < a.O) || a.G.includes(r) || l + 1 == d.length) {
                      q !== null && (a.O === null || q > a.O) && (a.O = q);
                      k = Sx(a, b, c, {
                        start: q,
                        duration: v,
                        node: m,
                        ef: v == null || !n
                      });
                      h.push(k);
                      b.sa.id && v && a.ya.set(b.sa.id, v);
                      if (v == null) {
                        k = null;
                        break;
                      }
                      k = q + v;
                    }
                  }
                  if (e) for (b = t(h), c = b.next(); !c.done; c = b.next()) c = c.value.id, a.G.includes(c) || a.G.push(c);else a.G = h.map(function (z) {
                    return z.id;
                  });
                  return f != null ? {
                    periods: h,
                    duration: f + g,
                    Vh: false
                  } : {
                    periods: h,
                    duration: k,
                    Vh: true
                  };
                }
                function Lx(a) {
                  var b = Array.from(a.F.keys()).filter(function (h) {
                    return !a.G.includes(h);
                  });
                  b = t(b);
                  for (var c = b.next(); !c.done; c = b.next()) {
                    c = c.value;
                    for (var d = true, e = t(a.F.get(c)), f = e.next(); !f.done; f = e.next()) {
                      f = f.value;
                      var g = a.o.get(f);
                      g && (g.segmentIndex && g.segmentIndex.getNumReferences() != 0 ? d = false : (a.m && a.m.Th(g, c), a.o.delete(f)));
                    }
                    d && a.F.delete(c);
                  }
                }
                function Mx(a, b) {
                  b = new Set(b.map(function (e) {
                    return e.id;
                  }));
                  for (var c = t(a.C.keys()), d = c.next(); !d.done; d = c.next()) d = d.value, b.has(d) || a.C.delete(d);
                }
                function Sx(a, b, c, d) {
                  b.sa = Tx(a, d.node, null, c);
                  b.na = d;
                  b.sa.rb = b.rb;
                  b.sa.id || (b.sa.id = "__shaka_period_" + d.start);
                  var e = td(d.node, "EventStream");
                  c = b.presentationTimeline.Hb();
                  e = t(e);
                  for (var f = e.next(); !f.done; f = e.next()) Ux(a, d.start, d.duration, f.value, c);
                  c = td(d.node, "SupplementalProperty");
                  c = t(c);
                  for (e = c.next(); !e.done; e = c.next()) if (e = e.value, e.attributes.schemeIdUri == "urn:mpeg:dash:urlparam:2014" && (e = Vx(a, e))) b.Lb = e;
                  c = td(d.node, "AdaptationSet").map(function (r, u) {
                    return Wx(a, b, u, r);
                  }).filter(gf);
                  if (b.Eb) {
                    e = [];
                    f = t(c);
                    for (var g = f.next(); !g.done; g = f.next()) {
                      g = t(g.value.Nk);
                      for (var h = g.next(); !h.done; h = g.next()) e.push(h.value);
                    }
                    if (e.length != new Set(e).size) throw new U(2, 4, 4018);
                  }
                  e = new Map();
                  f = t(c);
                  for (g = f.next(); !g.done; g = f.next()) for (g = t(g.value.uj), h = g.next(); !h.done; h = g.next()) {
                    var k = t(h.value);
                    h = k.next().value;
                    k = k.next().value;
                    e.set(h, k);
                  }
                  if (e.size) for (f = null, g = t(c), h = g.next(); !h.done; h = g.next()) {
                    h = h.value;
                    k = [];
                    for (var l = t(h.streams), m = l.next(), n = {}; !m.done; n = {
                      uh: void 0
                    }, m = l.next()) if (n.uh = m.value, e.has(n.uh.originalId)) {
                      f || (f = td(d.node, "AdaptationSet").map(function (r, u) {
                        return Wx(a, b, u, r);
                      }).filter(gf));
                      m = t(f);
                      for (var q = m.next(); !q.done; q = m.next()) if (q = q.value.streams.find(function (r) {
                        return function (u) {
                          return u.originalId == r.uh.originalId;
                        };
                      }(n))) q.dependencyStream = e.get(q.originalId), q.originalId += q.dependencyStream.originalId, k.push(q);
                    }
                    k.length && h.streams.push.apply(h.streams, x(k));
                  }
                  d = c.filter(function (r) {
                    return !r.Dh;
                  });
                  c = c.filter(function (r) {
                    return r.Dh;
                  });
                  if (!a.g.disableIFrames) for (c = t(c), e = c.next(); !e.done; e = c.next()) for (e = e.value, f = e.Dh.split(" "), g = t(d), h = g.next(); !h.done; h = g.next()) if (h = h.value, f.includes(h.id)) for (h = t(h.streams), k = h.next(); !k.done; k = h.next()) hg(k.value, e.streams);
                  c = Xx(a.g.disableAudio, d, "audio");
                  e = Xx(a.g.disableVideo, d, "video");
                  f = Xx(a.g.disableText, d, Ac);
                  d = Xx(a.g.disableThumbnails, d, "image");
                  if (e.length === 0 && c.length === 0) throw new U(2, 4, 4004);
                  return {
                    id: b.sa.id,
                    audioStreams: c,
                    videoStreams: e,
                    textStreams: f,
                    imageStreams: d
                  };
                }
                function Xx(a, b, c) {
                  return a || !b.length ? [] : b.reduce(function (d, e) {
                    if (e.contentType != c) return d;
                    d.push.apply(d, x(e.streams));
                    return d;
                  }, []);
                }
                function Wx(a, b, c, d) {
                  function e(L) {
                    var O = L.attributes["dvb:fontFamily"];
                    L = L.attributes["dvb:url"];
                    O && L && (L = uc(b.oa.cb(), [L], b.Lb()), a.j.addFont(O, L[0]));
                  }
                  function f(L) {
                    switch (L) {
                      case 1:
                      case 5:
                      case 6:
                      case 7:
                        return "srgb";
                      case 9:
                        return "rec2020";
                      case 11:
                      case 12:
                        return "p3";
                    }
                  }
                  function g(L) {
                    switch (L) {
                      case 1:
                      case 6:
                      case 13:
                      case 14:
                      case 15:
                        return "SDR";
                      case 16:
                        return "PQ";
                      case 18:
                        return "HLG";
                    }
                  }
                  b.oa = Tx(a, d, b.sa, null);
                  b.oa.position = c;
                  var h = false;
                  c = td(d, "Role");
                  var k = c.map(function (L) {
                      return L.attributes.value;
                    }).filter(gf),
                    l = void 0,
                    m = b.oa.contentType == Ac;
                  m && (l = "subtitle");
                  c = t(c);
                  for (var n = c.next(); !n.done; n = c.next()) {
                    n = n.value;
                    var q = n.attributes.schemeIdUri;
                    if (q == null || q == "urn:mpeg:dash:role:2011") switch (n = n.attributes.value, n) {
                      case "main":
                        h = true;
                        break;
                      case "caption":
                      case "subtitle":
                        l = n;
                    }
                  }
                  var r = td(d, "EssentialProperty");
                  c = null;
                  var u = false;
                  n = null;
                  q = false;
                  r = t(r);
                  for (var v = r.next(); !v.done; v = r.next()) {
                    v = v.value;
                    var w = v.attributes.schemeIdUri;
                    if (w == "http://dashif.org/guidelines/trickmode") c = v.attributes.value;else if (w == "urn:mpeg:mpegB:cicp:TransferCharacteristics") var z = g(parseInt(v.attributes.value, 10));else if (w == "urn:mpeg:mpegB:cicp:ColourPrimaries") var y = f(parseInt(v.attributes.value, 10));else w != "urn:mpeg:mpegB:cicp:MatrixCoefficients" && (w == "urn:mpeg:dash:ssr:2023" && a.g.dash.enableFastSwitching ? u = true : w == "urn:dvb:dash:fontdownload:2014" ? e(v) : w == "urn:mpeg:dash:urlparam:2014" ? (n = Vx(a, v)) || (q = true) : q = true);
                  }
                  if (q) return null;
                  var B = null;
                  q = td(d, "SupplementalProperty");
                  q = t(q);
                  for (r = q.next(); !r.done; r = q.next()) r = r.value, v = r.attributes.schemeIdUri, v == "http://dashif.org/guidelines/last-segment-number" ? B = parseInt(r.attributes.value, 10) - 1 : v == "urn:mpeg:mpegB:cicp:TransferCharacteristics" ? z = g(parseInt(r.attributes.value, 10)) : v == "urn:mpeg:mpegB:cicp:ColourPrimaries" ? y = f(parseInt(r.attributes.value, 10)) : v == "urn:dvb:dash:fontdownload:2014" ? e(r) : v == "urn:mpeg:dash:urlparam:2014" && (n = Vx(a, r));
                  n && (b.Lb = n);
                  n = td(d, "Accessibility");
                  var D = new Map(),
                    I;
                  n = t(n);
                  for (q = n.next(); !q.done; q = n.next()) if (r = q.value, q = r.attributes.schemeIdUri, r = r.attributes.value, q != "urn:scte:dash:cc:cea-608:2015" || a.g.disableText) {
                    if (q != "urn:scte:dash:cc:cea-708:2015" || a.g.disableText) q == "urn:mpeg:dash:role:2011" ? r != null && (k.push(r), r == "captions" && (l = "caption")) : q == "urn:tva:metadata:cs:AudioPurposeCS:2007" && (r == "1" ? I = "visually impaired" : r == "2" ? I = "hard of hearing" : r == "9" && (I = "spoken subtitles"));else if (q = 1, r != null) for (r = t(r.split(";")), v = r.next(); !v.done; v = r.next()) {
                      w = v.value;
                      var C = v = void 0;
                      w.includes("=") ? (w = w.split("="), v = "svc" + w[0], C = w[1].split(",")[0].split(":").pop()) : (v = "svc" + q, q++, C = w);
                      D.set(v, lf(C));
                    } else D.set("svc1", "und");
                  } else if (q = 1, r != null) for (r = r.split(";"), v = t(r), w = v.next(); !w.done; w = v.next()) {
                    C = w.value;
                    var A = w = void 0;
                    C.includes("=") ? (C = C.split("="), w = C[0].startsWith("CC") ? C[0] : "CC" + C[0], A = C[1] || "und") : (w = "CC" + q, r.length == 2 ? q += 2 : q++, A = C);
                    D.set(w, lf(A));
                  } else D.set("CC1", "und");
                  n = td(d, "ContentProtection");
                  var E = uv(a.xa, n, a.g.ignoreDrmInfo, a.g.dash.keySystemsByURI);
                  b.oa.encrypted = n.length > 0;
                  var J = lf(b.oa.language || "und"),
                    H = b.oa.label,
                    K = new Map();
                  d = td(d, "Representation");
                  if (!a.g.ignoreSupplementalCodecs) {
                    n = [];
                    q = t(d);
                    for (r = q.next(); !r.done; r = q.next()) if (v = r.value, r = Bd(v, "urn:scte:dash:scte214-extensions", "supplementalCodecs")) v = gd(v), v.attributes.codecs = r.split(" ").join(","), v.attributes.id && (v.attributes.supplementalId = v.attributes.id + "_supplementalCodecs"), n.push(v);
                    d.push.apply(d, x(n));
                  }
                  n = d.map(function (L) {
                    var O = Yx(a, b, E, l, J, H, h, k, D, L, I, B);
                    return O && (O.hdr = O.hdr || z, O.colorGamut = O.colorGamut || y, O.fastSwitching = u, L = L.attributes.dependencyId) ? (O.baseOriginalId = L, K.set(L, O), null) : O;
                  }).filter(function (L) {
                    return !!L;
                  });
                  if (n.length == 0 && K.size == 0) {
                    c = b.oa.contentType == "image";
                    if (a.g.dash.ignoreEmptyAdaptationSet || m || c) return null;
                    throw new U(2, 4, 4003);
                  }
                  if (!b.oa.contentType || b.oa.contentType == "application") for (b.oa.contentType = Zx(n[0].mimeType, n[0].codecs), m = t(n), q = m.next(); !q.done; q = m.next()) q.value.type = b.oa.contentType;
                  m = b.oa.id || "__fake__" + a.Fa++;
                  q = t(n);
                  for (r = q.next(); !r.done; r = q.next()) {
                    r = r.value;
                    v = t(E.drmInfos);
                    for (w = v.next(); !w.done; w = v.next()) w = w.value, w.keyIds = w.keyIds && r.keyIds ? new Set([].concat(x(w.keyIds), x(r.keyIds))) : w.keyIds || r.keyIds;
                    a.g.enableAudioGroups && (r.groupId = m);
                  }
                  d = d.map(function (L) {
                    return L.attributes.supplementalId || L.attributes.id;
                  }).filter(gf);
                  return {
                    id: m,
                    contentType: b.oa.contentType,
                    language: J,
                    Bm: h,
                    streams: n,
                    drmInfos: E.drmInfos,
                    Dh: c,
                    Nk: d,
                    uj: K
                  };
                }
                function Vx(a, b) {
                  if ((b = yd(b, "urn:mpeg:dash:schema:urlparam:2014", "UrlQueryInfo")) && Ad(b, "useMPDUrlQuery", Kd, false)) {
                    var c = b.attributes.queryTemplate;
                    if (c) return function () {
                      return c == "$querypart$" ? a.$ : c.split("&").map(function (d) {
                        if (d == "$querypart$") return a.$;
                        var e = /\$query:(.*?)\$/g.exec(d);
                        if (e && e.length == 2) {
                          e = e[1];
                          var f = new Jb(a.$).get(e);
                          if (f.length) return e + "=" + f[0];
                        }
                        return d;
                      }).join("&");
                    };
                  }
                  return null;
                }
                function Yx(a, b, c, d, e, f, g, h, k, l, m, n) {
                  b.L = Tx(a, l, b.oa, null);
                  var q = b.L.id;
                  a.aa = Math.min(a.aa, b.L.rb);
                  a.T = a.aa > 0;
                  if (!$x(b.L)) return null;
                  var r = b.na.start;
                  b.bandwidth = Ad(l, "bandwidth", Hd) || 0;
                  b.roles = h;
                  var u = td(l, "SupplementalProperty"),
                    v = td(l, "EssentialProperty"),
                    w = td(l, "ContentProtection");
                  l = null;
                  var z = v.find(function (N) {
                    return N.attributes.schemeIdUri == "urn:mpeg:dash:urlparam:2014";
                  });
                  z ? l = Vx(a, z) : (z = u.find(function (N) {
                    return N.attributes.schemeIdUri == "urn:mpeg:dash:urlparam:2014";
                  })) && (l = Vx(a, z));
                  l && (b.Lb = l);
                  z = b.L.contentType;
                  l = z == Ac || z == "application";
                  z = z == "image";
                  w.length && (b.oa.encrypted = true);
                  try {
                    var y = void 0;
                    if (c.dg) {
                      var B = b.L.cb,
                        D = b.Lb,
                        I = uc(B(), [c.dg.qk], D()),
                        C = Rg(I, a.g.retryParameters);
                      y = {
                        bitsKey: 128,
                        blockCipherMode: "CBC",
                        iv: c.dg.iv,
                        firstMediaSequenceNumber: 0,
                        fetchKey: function fetchKey() {
                          var N, M, R;
                          return P(function (T) {
                            if (T.g == 1) return F(T, Cx(a, C, 6), 2);
                            if (T.g != 3) {
                              N = T.h;
                              if (!N.data || N.data.byteLength != 16) throw new U(2, 4, 4049);
                              M = {
                                name: "AES-CBC"
                              };
                              R = y;
                              return F(T, window.crypto.subtle.importKey("raw", N.data, M, !0, ["decrypt"]), 3);
                            }
                            R.cryptoKey = T.h;
                            y.fetchKey = void 0;
                            G(T);
                          });
                        }
                      };
                    }
                    b.L.aesKey = y;
                    B = function B(N, M, R, T) {
                      return Rx(a, N, M, R, T);
                    };
                    if (b.L.Hd) var A = Vv(b, B, y);else if (b.L.zc) A = aw(b, a.o, y);else if (b.L.Nc) A = fw(b, B, a.o, !!a.h, a.g.dash.initialSegmentLimit, a.ya, y, n, !1, a.C);else {
                      var E = b.na.duration || 0,
                        J = b.L.cb,
                        H = b.L.mimeType,
                        K = b.L.codecs;
                      A = {
                        endTime: -1,
                        timeline: -1,
                        Sc: function Sc() {
                          var N = Pl(r, E, J());
                          N.Fb(function (M) {
                            M.mimeType = H;
                            M.codecs = K;
                          });
                          return Promise.resolve(N);
                        },
                        timescale: 1
                      };
                    }
                  } catch (N) {
                    if ((l || z) && N.code == 4002) return null;
                    throw N;
                  }
                  n = yv(a.xa, w, c, a.g.ignoreDrmInfo, a.g.dash.keySystemsByURI);
                  n = new Set(n ? [n] : []);
                  w = false;
                  u.some(function (N) {
                    return N.attributes.schemeIdUri == "tag:dolby.com,2018:dash:EC3_ExtensionType:2018" && N.attributes.value == "JOC";
                  }) && (w = true);
                  u = false;
                  l && (u = h.includes("forced_subtitle") || h.includes("forced-subtitle"));
                  var L;
                  if (z && ((v = v.find(function (N) {
                    return ["http://dashif.org/thumbnail_tile", "http://dashif.org/guidelines/thumbnail_tile"].includes(N.attributes.schemeIdUri);
                  })) && (L = v.attributes.value), !L)) return null;
                  var O;
                  l = b.L.codecs;
                  b.profiles.includes("http://dashif.org/guidelines/dash-if-uhd#hevc-hdr-pq10") && (l.includes("hvc1.2.4.L153.B0") || l.includes("hev1.2.4.L153.B0")) && (O = "PQ");
                  v = b.L.id ? b.sa.id + "," + b.L.id : "";
                  a.H.length && q && a.u.set(b.sa.id + "," + q, ay(b));
                  b.L.zf && by(a, b.L.zf, A, b.presentationTimeline);
                  A.endTime != -1 && b.sa.id != null && b.L.id != null && ((q = a.C.get(b.sa.id)) ? (q.endTime = A.endTime, q.bh.includes(b.L.id) || q.bh.push(b.L.id), a.C.set(b.sa.id, q)) : a.C.set(b.sa.id, {
                    endTime: A.endTime,
                    timeline: A.timeline,
                    bh: [b.L.id]
                  }));
                  var Q = v && a.o.has(v) ? a.o.get(v) : {
                    id: a.Fa++,
                    originalId: b.L.id,
                    groupId: null,
                    createSegmentIndex: function createSegmentIndex() {
                      return Promise.resolve();
                    },
                    closeSegmentIndex: function closeSegmentIndex() {
                      Q.segmentIndex && (Q.segmentIndex.release(), Q.segmentIndex = null);
                    },
                    segmentIndex: null,
                    mimeType: b.L.mimeType,
                    codecs: l,
                    frameRate: b.L.frameRate,
                    pixelAspectRatio: b.L.pixelAspectRatio,
                    bandwidth: b.bandwidth,
                    width: b.L.width,
                    height: b.L.height,
                    kind: d,
                    encrypted: c.drmInfos.length > 0,
                    drmInfos: c.drmInfos,
                    keyIds: n,
                    language: e,
                    originalLanguage: b.oa.language,
                    label: f,
                    type: b.oa.contentType,
                    primary: g,
                    trickModeVideo: null,
                    dependencyStream: null,
                    emsgSchemeIdUris: b.L.emsgSchemeIdUris,
                    roles: h,
                    forced: u,
                    channelsCount: b.L.uf,
                    audioSamplingRate: b.L.audioSamplingRate,
                    spatialAudio: w,
                    closedCaptions: k,
                    hdr: O,
                    colorGamut: void 0,
                    videoLayout: void 0,
                    tilesLayout: L,
                    accessibilityPurpose: m,
                    external: false,
                    fastSwitching: false,
                    fullMimeTypes: new Set([Fe(b.L.mimeType, b.L.codecs)]),
                    isAudioMuxedInVideo: false,
                    baseOriginalId: null
                  };
                  Q.createSegmentIndex = function () {
                    var N;
                    return P(function (M) {
                      if (M.g == 1) {
                        if (Q.segmentIndex) return M.A(0);
                        N = Q;
                        return F(M, A.Sc(), 3);
                      }
                      N.segmentIndex = M.h;
                      G(M);
                    });
                  };
                  v && b.Eb && !a.o.has(v) && (b = b.sa.id || "", a.F.has(b) || a.F.set(b, []), a.o.set(v, Q), a.F.get(b).push(v));
                  return Q;
                }
                function by(a, b, c, d) {
                  if (!a.ma.has(b)) {
                    a.ma.add(b);
                    var e = Ad(b, "presentationTime", Id) || 0,
                      f = xd(b, "UTCTiming"),
                      g;
                    if (g = f && f.attributes.schemeIdUri) f = f.attributes.schemeIdUri, g = !(f === "urn:mpeg:dash:utc:http-ntp:2014" || f === "urn:mpeg:dash:utc:ntp:2014" || f === "urn:mpeg:dash:utc:sntp:2014");
                    g ? b = (Ad(b, "wallClockTime", Dd) || 0) * 1E3 : (b = Ad(b, "wallClockTime", Id) || 0, b = Sj(b));
                    c = new Date(b - e / c.timescale * 1E3);
                    e = c.getTime() / 1E3;
                    isNaN(e) || (d.o || d.oh(e), d = new Map().set("detail", {
                      wallClockTime: b,
                      programStartDate: c
                    }), d = new V("prft", d), a.j.onEvent(d));
                  }
                }
                function ay(a) {
                  function b(c) {
                    if (!c) return null;
                    c = hd(c);
                    c.Hd = null;
                    c.zc = null;
                    c.Nc = Sd(c.Nc);
                    c.zf = null;
                    return c;
                  }
                  a = hd(a);
                  a.sa = b(a.sa);
                  a.oa = b(a.oa);
                  a.L = b(a.L);
                  a.na && (a.na = hd(a.na), a.na.node = null);
                  return a;
                }
                function yx(a) {
                  var b, c;
                  return P(function (d) {
                    switch (d.g) {
                      case 1:
                        return b = 0, ua(d, 2), F(d, zx(a), 4);
                      case 4:
                        b = d.h;
                        xa(d, 3);
                        break;
                      case 2:
                        if (c = ya(d), a.j) {
                          if (a.g.raiseFatalErrorOnManifestUpdateRequestFailure) return a.j.onError(c), d.return();
                          c.severity = 1;
                          a.j.onError(c);
                        }
                      case 3:
                        if (!a.j) return d.return();
                        a.j.onManifestUpdated();
                        Ax(a, b);
                        G(d);
                    }
                  });
                }
                function Ax(a, b) {
                  if (!(a.K < 0)) {
                    var c = a.K;
                    a.g.updatePeriod >= 0 && (c = a.g.updatePeriod);
                    a.M.ia(Math.max(c - b, Wa(a.Da)));
                  }
                }
                function Tx(a, b, c, d) {
                  c = c || {
                    contentType: "",
                    mimeType: "",
                    codecs: "",
                    emsgSchemeIdUris: [],
                    frameRate: void 0,
                    pixelAspectRatio: void 0,
                    uf: null,
                    audioSamplingRate: null,
                    rb: 0,
                    Ef: 1,
                    encrypted: false
                  };
                  d = d || c.cb;
                  var e = b.attributes.id,
                    f = b.attributes.supplementalId,
                    g = td(b, "BaseURL"),
                    h,
                    k = false;
                  if (a.i) for (var l = t(g), m = l.next(); !m.done; m = l.next()) {
                    var n = m.value;
                    m = n.attributes.serviceLocation;
                    n = vd(n);
                    m && n && (uw(a.i, e, m, n), k = true);
                  }
                  k && a.i || (h = g.map(vd));
                  var q = a.i;
                  a = b.attributes.contentType || c.contentType;
                  l = b.attributes.mimeType || c.mimeType;
                  m = tm([b.attributes.codecs || c.codecs]).join(",");
                  n = Ad(b, "frameRate", Ld) || c.frameRate;
                  var r = b.attributes.sar || c.pixelAspectRatio,
                    u = cy(td(b, "InbandEventStream"), c.emsgSchemeIdUris),
                    v = td(b, "AudioChannelConfiguration");
                  v = dy(v) || c.uf;
                  var w = Ad(b, "audioSamplingRate", Id) || c.audioSamplingRate;
                  a || (a = Zx(l, m));
                  var z = xd(b, "SegmentBase"),
                    y = xd(b, "SegmentTemplate"),
                    B = z ? Ad(z, "availabilityTimeOffset", Jd) || 0 : 0,
                    D = y ? Ad(y, "availabilityTimeOffset", Jd) || 0 : 0,
                    I = g && g.length ? Ad(g[0], "availabilityTimeOffset", Jd) || 0 : 0;
                  B = c.rb + I + B + D;
                  D = null;
                  (I = xd(b, "SegmentSequenceProperties")) && (I = Ad(I, "cadence", Hd)) && (D = I);
                  I = b.attributes.label;
                  var C = td(b, "Label");
                  C && C.length && (C = C[0], ud(C) && (I = ud(C)));
                  return {
                    cb: function cb() {
                      return uc(d(), g.length ? q && k ? vw(q, e) : h ? h : [] : []);
                    },
                    Hd: z || c.Hd,
                    zc: xd(b, "SegmentList") || c.zc,
                    Nc: y || c.Nc,
                    zf: xd(b, "ProducerReferenceTime") || c.zf,
                    width: Ad(b, "width", Id) || c.width,
                    height: Ad(b, "height", Id) || c.height,
                    contentType: a,
                    mimeType: l,
                    codecs: m,
                    frameRate: n,
                    pixelAspectRatio: r,
                    emsgSchemeIdUris: u,
                    id: f || e,
                    originalId: e,
                    language: b.attributes.lang,
                    uf: v,
                    audioSamplingRate: w,
                    rb: B,
                    cf: null,
                    Ef: D || c.Ef,
                    label: I || null,
                    encrypted: false
                  };
                }
                function cy(a, b) {
                  b = b.slice();
                  a = t(a);
                  for (var c = a.next(); !c.done; c = a.next()) c = c.value.attributes.schemeIdUri, b.includes(c) || b.push(c);
                  return b;
                }
                function dy(a) {
                  a = t(a);
                  for (var b = a.next(); !b.done; b = a.next()) {
                    b = b.value;
                    var c = b.attributes.schemeIdUri;
                    if (c && (b = b.attributes.value)) switch (c) {
                      case "urn:mpeg:dash:outputChannelPositionList:2012":
                        return b.trim().split(/ +/).length;
                      case "urn:mpeg:dash:23003:3:audio_channel_configuration:2011":
                      case "urn:dts:dash:audio_channel_configuration:2012":
                        b = parseInt(b, 10);
                        if (!b) continue;
                        return b;
                      case "tag:dolby.com,2015:dash:audio_channel_configuration:2015":
                        c = [2, 1, 2, 2, 2, 2, 1, 2, 2, 1, 1, 1, 1, 2, 1, 1, 2, 2];
                        b = parseInt(b, 16);
                        if (!b) continue;
                        for (var d = 0, e = 0; e < c.length; e++) b & 1 << e && (d += c[e]);
                        if (d) return d;
                        continue;
                      case "tag:dolby.com,2014:dash:audio_channel_configuration:2011":
                      case "urn:dolby:dash:audio_channel_configuration:2011":
                        c = [1, 1, 1, 1, 1, 2, 2, 1, 1, 2, 2, 2, 1, 2, 1, 1].reverse();
                        b = parseInt(b, 16);
                        if (!b) continue;
                        for (e = d = 0; e < c.length; e++) b & 1 << e && (d += c[e]);
                        if (d) return d;
                        continue;
                      case "urn:mpeg:mpegB:cicp:ChannelConfiguration":
                        if (c = [0, 1, 2, 3, 4, 5, 6, 8, 2, 3, 4, 7, 8, 24, 8, 12, 10, 12, 14, 12, 14], (b = parseInt(b, 10)) && b > 0 && b < c.length) return c[b];
                    }
                  }
                  return null;
                }
                function $x(a) {
                  var b = a.Hd ? 1 : 0;
                  b += a.zc ? 1 : 0;
                  b += a.Nc ? 1 : 0;
                  if (b == 0) return a.contentType == Ac || a.contentType == "application" ? true : false;
                  b != 1 && (a.Hd && (a.zc = null), a.Nc = null);
                  return true;
                }
                function ey(a, b, c, d) {
                  var e, f, g, h, k, l, m;
                  return P(function (n) {
                    if (n.g == 1) return e = [lc(c)], f = uc(b(), e), g = Rg(f, a.g.retryParameters), g.method = d, h = a.j.networkingEngine.request(4, g, {
                      isPreload: a.qa()
                    }), Lg(a.R, h), F(n, h.promise, 2);
                    k = n.h;
                    if (d == "HEAD") {
                      if (!k.headers || !k.headers.date) return n.return(0);
                      l = k.headers.date;
                    } else l = dc(k.data);
                    m = Date.parse(l);
                    return isNaN(m) ? n.return(0) : n.return(m - Date.now());
                  });
                }
                function Kx(a, b, c) {
                  var d, e, f, g, h, k, l, m;
                  return P(function (n) {
                    switch (n.g) {
                      case 1:
                        d = c.map(function (q) {
                          return {
                            scheme: q.attributes.schemeIdUri,
                            value: q.attributes.value
                          };
                        }), e = a.g.dash.clockSyncUri, !d.length && e && d.push({
                          scheme: "urn:mpeg:dash:utc:http-head:2014",
                          value: e
                        }), f = t(d), g = f.next();
                      case 2:
                        if (g.done) {
                          n.A(4);
                          break;
                        }
                        h = g.value;
                        ua(n, 5);
                        k = h.scheme;
                        l = h.value;
                        switch (k) {
                          case "urn:mpeg:dash:utc:http-head:2014":
                          case "urn:mpeg:dash:utc:http-head:2012":
                            return n.A(7);
                          case "urn:mpeg:dash:utc:http-xsdate:2014":
                          case "urn:mpeg:dash:utc:http-iso:2014":
                          case "urn:mpeg:dash:utc:http-xsdate:2012":
                          case "urn:mpeg:dash:utc:http-iso:2012":
                            return n.A(8);
                          case "urn:mpeg:dash:utc:direct:2014":
                          case "urn:mpeg:dash:utc:direct:2012":
                            return m = Date.parse(l), n.return(isNaN(m) ? 0 : m - Date.now());
                          case "urn:mpeg:dash:utc:http-ntp:2014":
                          case "urn:mpeg:dash:utc:ntp:2014":
                          case "urn:mpeg:dash:utc:sntp:2014":
                            ab("NTP UTCTiming scheme is not supported");
                            break;
                          default:
                            ab("Unrecognized scheme in UTCTiming element", k);
                        }
                        n.A(9);
                        break;
                      case 7:
                        return F(n, ey(a, b, l, "HEAD"), 10);
                      case 10:
                        return n.return(n.h);
                      case 8:
                        return F(n, ey(a, b, l, "GET"), 11);
                      case 11:
                        return n.return(n.h);
                      case 9:
                        xa(n, 3);
                        break;
                      case 5:
                        ya(n);
                      case 3:
                        g = f.next();
                        n.A(2);
                        break;
                      case 4:
                        return ab("A UTCTiming element should always be given in live manifests! This content may not play on clients with bad clocks!"), n.return(0);
                    }
                  });
                }
                function Ux(a, b, c, d, e) {
                  var f = d.attributes.schemeIdUri || "",
                    g = d.attributes.value || "",
                    h = Ad(d, "timescale", Id) || 1,
                    k = Ad(d, "presentationTimeOffset", Id) || 0;
                  d = t(td(d, "Event"));
                  for (var l = d.next(); !l.done; l = d.next()) {
                    l = l.value;
                    var m = Ad(l, "presentationTime", Id) || 0,
                      n = Ad(l, "duration", Id) || 0;
                    m = Math.max((m - k) / h + b, b);
                    n = m + n / h;
                    c != null && (m = Math.min(m, b + c), n = Math.min(n, b + c));
                    n < e || (l = {
                      schemeIdUri: f,
                      value: g,
                      startTime: m,
                      endTime: n,
                      id: l.attributes.id || "",
                      timescale: h,
                      eventElement: Rd(l),
                      eventNode: Sd(l)
                    }, a.j.onTimelineRegionAdded(l));
                  }
                }
                function Rx(a, b, c, d, e) {
                  var f, g, h, k;
                  return P(function (l) {
                    if (l.g == 1) return f = Xg, g = e ? 0 : 1, h = xm(b, c, d, a.g.retryParameters), F(l, Cx(a, h, f, {
                      type: g
                    }), 2);
                    k = l.h;
                    return l.return(k.data);
                  });
                }
                function Zx(a, b) {
                  b = Fe(a, b);
                  return Ve(b) ? Ac : a.split("/")[0];
                }
                function Cx(a, b, c, d) {
                  d || (d = {});
                  d.isPreload = a.qa();
                  b = a.j.networkingEngine.request(c, b, d);
                  Lg(a.R, b);
                  return b.promise;
                }
                function Bx(a) {
                  var b = a.l.le;
                  if (!a.l.qf || !b || !a.H.length) return [];
                  var c = Date.now() / 1E3,
                    d = a.H.filter(function (e) {
                      e = Id(e.attributes.ttl);
                      return !e || b + e > c;
                    }).map(vd).filter(gf);
                  return d.length ? uc(a.B, d) : [];
                }
                S("shaka.dash.DashParser", xx);
                vi("application/dash+xml", function () {
                  return new xx();
                });
                vi("video/vnd.mpeg.dash.mpd", function () {
                  return new xx();
                });
                function fy() {}
                S("shaka.dependencies", fy);
                fy.has = function (a) {
                  return gy.has(a);
                };
                fy.add = function (a, b) {
                  if (!hy[a]) throw Error(a + " is not supported");
                  a == iy ? yb("mux.js", "mux.js is no longer used in Shaka Player.") : gy.set(a, function () {
                    return b;
                  });
                };
                var iy = "muxjs",
                  hy = {
                    Cm: iy,
                    ISOBoxer: "ISOBoxer"
                  };
                fy.Allowed = hy;
                var gy = new Map([["ISOBoxer", function () {
                  return window.ISOBoxer;
                }]]);
                function jy() {
                  this.j = new sb(function () {
                    return ["Oculus", "Quest"].some(function (a) {
                      return navigator.userAgent.includes(a.toLowerCase());
                    }) ? "VR" : navigator.userAgent.match(/Smart( ?|_)TV/i) || navigator.userAgent.match(/Android ?TV/i) ? "TV" : navigator.userAgentData ? navigator.userAgentData.mobile ? "MOBILE" : "DESKTOP" : /(?:iPhone|iPad|iPod)/.test(navigator.userAgent) ? "MOBILE" : navigator.userAgentData && navigator.userAgentData.platform ? navigator.userAgentData.platform.toLowerCase() == "android" ? "MOBILE" : "DESKTOP" : navigator.userAgent.includes("Android") ? "MOBILE" : "DESKTOP";
                  });
                  this.l = new sb(function () {
                    return navigator.vendor.includes("Apple") && (navigator.userAgent.includes("Version/") || navigator.userAgent.includes("OS/")) ? "WEBKIT" : navigator.userAgent.includes("Edge/") ? "EDGE" : navigator.userAgent.includes("Chrome/") ? "CHROMIUM" : navigator.userAgent.includes("Firefox/") ? "GECKO" : "UNKNOWN";
                  });
                }
                function yi() {
                  var a = window.ManagedMediaSource || window.MediaSource;
                  return a && a.isTypeSupported ? true : false;
                }
                p = jy.prototype;
                p.cc = function () {
                  return !!navigator.mediaCapabilities;
                };
                p.Ua = function () {
                  return this.j.value();
                };
                p.Ha = function () {
                  return this.l.value();
                };
                p.Ed = function () {
                  return false;
                };
                p.Hi = function () {
                  return false;
                };
                p.df = function () {
                  return false;
                };
                p.Ii = function () {
                  return false;
                };
                p.oe = function () {
                  return false;
                };
                p.fd = function () {
                  return true;
                };
                p.Pc = function () {
                  return true;
                };
                p.re = function () {
                  return true;
                };
                p.Ni = function () {
                  return 0;
                };
                p.jc = function () {
                  return Promise.resolve({
                    width: Infinity,
                    height: Infinity
                  });
                };
                p.Vi = function () {
                  return false;
                };
                p.rh = function () {
                  return false;
                };
                p.Wa = function (a) {
                  var b = this.Ua();
                  if (b === "TV" || b === "CONSOLE" || b === "CAST") a.ads.customPlayheadTracker = true, a.ads.skipPlayDetection = true, a.ads.supportsMultipleMediaElements = false;
                  return a;
                };
                p.xh = function () {
                  return !!window.indexedDB;
                };
                p.Fi = function () {
                  return [];
                };
                p.sd = function (a) {
                  return window.matchMedia !== void 0 && window.matchMedia("(color-gamut: p3)").matches ? a ? "HLG" : "PQ" : "SDR";
                };
                p.bj = function () {
                  return false;
                };
                p.ti = function () {
                  return false;
                };
                p.gh = function () {
                  return false;
                };
                p.Kf = function () {
                  return true;
                };
                p.ui = function () {
                  return false;
                };
                p.aj = function () {
                  return true;
                };
                p.ed = function () {
                  return false;
                };
                p.Rg = function (a) {
                  return a === "com.apple.fps";
                };
                p.Jf = function () {
                  return true;
                };
                p.toString = function () {
                  return "Device: " + this.Nb() + " v" + this.za() + "; Type: " + this.Ua();
                };
                function ky() {
                  jy.call(this);
                  this.g = new sb(function () {
                    var a = navigator.userAgent.match(/Version\/(\d+)/);
                    return a ? parseInt(a[1], 10) : (a = navigator.userAgent.match(/OS (\d+)(?:_\d+)?/)) ? parseInt(a[1], 10) : null;
                  });
                  this.h = new sb(function () {
                    return /(?:iPhone|iPad|iPod)/.test(navigator.userAgent) || navigator.maxTouchPoints > 1 ? "xr" in navigator ? "APPLE_VR" : "MOBILE" : "xr" in navigator ? "APPLE_VR" : "DESKTOP";
                  });
                }
                la(ky, jy);
                p = ky.prototype;
                p.za = function () {
                  return this.g.value();
                };
                p.Nb = function () {
                  return "Apple Browser";
                };
                p.Ua = function () {
                  return this.h.value();
                };
                p.Ha = function () {
                  return "WEBKIT";
                };
                p.cc = function () {
                  return false;
                };
                p.Ed = function (a, b) {
                  return b === "audio";
                };
                p.df = function () {
                  return true;
                };
                p.Ii = function (a) {
                  return a === "audio";
                };
                p.Wa = function (a) {
                  jy.prototype.Wa.call(this, a);
                  a.abr.minTimeToSwitch = .5;
                  return a;
                };
                p.bj = function () {
                  return true;
                };
                p.Jf = function () {
                  return false;
                };
                (navigator.vendor || "").includes("Apple") && (/(?:iPhone|iPad|iPod)/.test(navigator.userAgent) || navigator.maxTouchPoints > 1 || navigator.userAgentData && navigator.userAgentData.platform && navigator.userAgentData.platform.toLowerCase() == "macos" || navigator.platform && navigator.platform.toLowerCase().includes("mac")) && (vb = function vb() {
                  return new ky();
                });
                function ly() {
                  if (!my()) throw Error("Not a Chromecast device!");
                  jy.call(this);
                  this.h = new sb(function () {
                    var a = navigator.userAgent.match(/Chrome\/(\d+)/);
                    return a ? parseInt(a[1], 10) : null;
                  });
                  this.g = new sb(function () {
                    var a = navigator.userAgentData && navigator.userAgentData.platform || navigator.userAgent;
                    a = a.toLowerCase();
                    return a.includes("android") ? ny : a.includes("fuchsia") ? oy : py;
                  });
                }
                la(ly, jy);
                p = ly.prototype;
                p.za = function () {
                  return this.h.value();
                };
                p.Nb = function () {
                  return "Chromecast with " + this.g.value();
                };
                p.Ua = function () {
                  return "CAST";
                };
                p.Ha = function () {
                  return "CHROMIUM";
                };
                p.cc = function () {
                  return jy.prototype.cc.call(this) && this.g.value() !== py;
                };
                p.Pc = function () {
                  return this.g.value() !== py;
                };
                p.Ni = function () {
                  switch (this.g.value()) {
                    case ny:
                      return 0;
                    case oy:
                      return 3;
                    default:
                      return 1;
                  }
                };
                p.jc = function () {
                  var a, b, c, d, e;
                  return P(function (f) {
                    switch (f.g) {
                      case 1:
                        a = window.cast && cast.__platform__ && cast.__platform__.canDisplayType;
                        b = {
                          width: 1280,
                          height: 720
                        };
                        ua(f, 2);
                        if (!(c = a)) {
                          f.A(4);
                          break;
                        }
                        return F(f, cast.__platform__.canDisplayType('video/mp4; codecs="avc1.640028"; width=3840; height=2160'), 5);
                      case 5:
                        c = f.h;
                      case 4:
                        if (c) {
                          b.width = 3840;
                          b.height = 2160;
                          f.A(6);
                          break;
                        }
                        if (!(d = a)) {
                          f.A(7);
                          break;
                        }
                        return F(f, cast.__platform__.canDisplayType('video/mp4; codecs="avc1.640028"; width=1920; height=1080'), 8);
                      case 8:
                        d = f.h;
                      case 7:
                        d && (b.width = 1920, b.height = 1080);
                      case 6:
                        xa(f, 3);
                        break;
                      case 2:
                        e = ya(f), $a("Failed to check canDisplayType:", e);
                      case 3:
                        return f.return(b);
                    }
                  });
                };
                p.Wa = function (a) {
                  jy.prototype.Wa.call(this, a);
                  a.streaming.stallSkip = 0;
                  return a;
                };
                p.xh = function () {
                  return false;
                };
                p.ed = function () {
                  return true;
                };
                function my() {
                  return navigator.userAgent.includes("CrKey") && !navigator.userAgent.includes("VIZIO SmartCast");
                }
                var ny = "Android",
                  oy = "Fuchsia",
                  py = "Linux";
                my() && (vb = function vb() {
                  return new ly();
                });
                function qy() {
                  jy.call(this);
                  var a = this;
                  this.i = new sb(function () {
                    var b = navigator.userAgent.match(/(Chrome|Firefox)\/(\d+)/);
                    return b ? parseInt(b[2], 10) : null;
                  });
                  this.g = new sb(function () {
                    return navigator.userAgent.match(/Edge?\//) ? "Edge" : navigator.userAgent.includes("Chrome") ? "Chrome" : navigator.userAgent.includes("Firefox") ? "Firefox" : "Unknown";
                  });
                  this.h = new sb(function () {
                    return navigator.userAgentData && navigator.userAgentData.platform ? navigator.userAgentData.platform.toLowerCase() == "windows" : navigator.platform ? navigator.platform.toLowerCase().includes("win32") : false;
                  });
                  this.u = new sb(function () {
                    return navigator.userAgent.match(/Edge?\//) ? !a.h.value() : true;
                  });
                  this.o = new sb(function () {
                    return navigator.userAgent.includes("sony.hbbtv.tv");
                  });
                  this.m = new sb(function () {
                    return navigator.userAgentData && navigator.userAgentData.platform ? navigator.userAgentData.platform.toLowerCase() == "android" : navigator.userAgent.includes("Android") ? true : false;
                  });
                }
                la(qy, jy);
                p = qy.prototype;
                p.za = function () {
                  return this.i.value();
                };
                p.Nb = function () {
                  return this.g.value();
                };
                p.Ed = function (a) {
                  return sg(a) ? this.g.value() === "Edge" && this.h.value() : false;
                };
                p.Hi = function () {
                  return this.g.value() === "Edge" && this.h.value();
                };
                p.df = function () {
                  return this.g.value() === "Edge" && this.h.value();
                };
                p.Pc = function () {
                  return this.u.value();
                };
                p.Wa = function (a) {
                  jy.prototype.Wa.call(this, a);
                  if (this.h.value()) switch (this.g.value()) {
                    case "Firefox":
                      a.drm.keySystemsMapping = {
                        "com.microsoft.playready": "com.microsoft.playready.recommendation"
                      };
                      break;
                    case "Chrome":
                      a.drm.keySystemsMapping = {
                        "com.microsoft.playready": "com.microsoft.playready.recommendation.3000",
                        "com.microsoft.playready.recommendation": "com.microsoft.playready.recommendation.3000"
                      };
                  }
                  this.m.value() && (a.drm.defaultAudioRobustnessForWidevine = "", a.drm.defaultVideoRobustnessForWidevine = "");
                  return a;
                };
                p.gh = function () {
                  return this.g.value() === "Edge" || this.o.value();
                };
                p.ed = function () {
                  if (this.Ha() === "GECKO") {
                    var a = this.za();
                    return a !== null ? a >= 100 : jy.prototype.ed.call(this);
                  }
                  return jy.prototype.ed.call(this);
                };
                p.Rg = function (a) {
                  return this.Ha() === "GECKO" ? a.startsWith("com.microsoft.playready.recommendation") : jy.prototype.Rg.call(this, a);
                };
                wb = function wb() {
                  return new qy();
                };
                function ry() {
                  jy.apply(this, arguments);
                }
                la(ry, jy);
                p = ry.prototype;
                p.za = function () {
                  return null;
                };
                p.Nb = function () {
                  return "Hisense";
                };
                p.Ua = function () {
                  return "TV";
                };
                p.cc = function () {
                  return false;
                };
                p.jc = function () {
                  var a = {
                      width: 1920,
                      height: 1080
                    },
                    b = null;
                  if (window.Hisense_Get4KSupportState) try {
                    b = window.Hisense_Get4KSupportState();
                  } catch (c) {}
                  b == null && (b = navigator.userAgent.includes("UHD"));
                  b && (a.width = 3840, a.height = 2160);
                  return Promise.resolve(a);
                };
                p.Wa = function (a) {
                  jy.prototype.Wa.call(this, a);
                  a.streaming.stallSkip = 0;
                  return a;
                };
                if (navigator.userAgent.includes("Hisense") || navigator.userAgent.includes("VIDAA")) vb = function vb() {
                  return new ry();
                };
                function sy() {
                  jy.call(this);
                  this.g = new sb(function () {
                    var a = navigator.userAgent.match(/PlayStation (\d+)/);
                    return a ? parseInt(a[1], 10) : null;
                  });
                }
                la(sy, jy);
                p = sy.prototype;
                p.Nb = function () {
                  return "PlayStation";
                };
                p.Ua = function () {
                  return "CONSOLE";
                };
                p.Ha = function () {
                  return "WEBKIT";
                };
                p.za = function () {
                  return this.g.value();
                };
                p.cc = function () {
                  return false;
                };
                p.fd = function () {
                  return false;
                };
                p.Pc = function () {
                  return false;
                };
                p.rh = function () {
                  return this.za() === 4;
                };
                p.jc = function () {
                  var a, b, c, d, e;
                  return P(function (f) {
                    switch (f.g) {
                      case 1:
                        return a = {
                          width: 1920,
                          height: 1080
                        }, b = false, ua(f, 2), F(f, window.msdk.device.getDisplayInfo(), 4);
                      case 4:
                        c = f.h;
                        b = c.resolution === "4K";
                        xa(f, 3);
                        break;
                      case 2:
                        return ya(f), ua(f, 5), F(f, window.msdk.device.getDisplayInfoImmediate(), 7);
                      case 7:
                        d = f.h;
                        b = d.resolution === "4K";
                        xa(f, 3);
                        break;
                      case 5:
                        e = ya(f), ab("PlayStation: Failed to get the display info:", e);
                      case 3:
                        return b && (a.width = 3840, a.height = 2160), f.return(a);
                    }
                  });
                };
                p.Wa = function (a) {
                  jy.prototype.Wa.call(this, a);
                  this.za() === 4 && a.drm.preferredKeySystems.push("com.microsoft.playready");
                  a.streaming.clearDecodingCache = true;
                  return a;
                };
                p.gh = function () {
                  return this.za() === 4;
                };
                p.Kf = function () {
                  return this.za() !== 4;
                };
                navigator.userAgent.includes("PlayStation") && (vb = function vb() {
                  return new sy();
                });
                function ty() {
                  jy.call(this);
                  var a = navigator.userAgent.match(/Tizen (\d+).(\d+)/);
                  this.g = a ? parseInt(a[1], 10) : null;
                  this.h = a ? parseInt(a[2], 10) : null;
                }
                la(ty, jy);
                p = ty.prototype;
                p.za = function () {
                  return this.g;
                };
                p.Nb = function () {
                  return "Tizen";
                };
                p.Ha = function () {
                  return "CHROMIUM";
                };
                p.Ua = function () {
                  return "TV";
                };
                p.Ed = function () {
                  return true;
                };
                p.oe = function () {
                  return this.za() === 3;
                };
                p.cc = function () {
                  return false;
                };
                p.fd = function () {
                  var a = this.za();
                  return a !== null ? a >= 4 : jy.prototype.fd.call(this);
                };
                p.Pc = function () {
                  return false;
                };
                p.re = function () {
                  return this.g && this.h ? this.g === 5 ? this.h >= 5 : this.g > 5 : jy.prototype.re.call(this);
                };
                p.jc = function () {
                  var a = window.devicePixelRatio;
                  a = {
                    width: window.screen.width * a > 1920 ? 3840 : 1920,
                    height: window.screen.height * a > 1080 ? 2160 : 1080
                  };
                  try {
                    if (webapis.systeminfo && webapis.systeminfo.getMaxVideoResolution) {
                      var b = webapis.systeminfo.getMaxVideoResolution();
                      a.width = b.width;
                      a.height = b.height;
                    } else webapis.productinfo.is8KPanelSupported && webapis.productinfo.is8KPanelSupported() ? (a.width = 7680, a.height = 4320) : webapis.productinfo.isUdPanelSupported && webapis.productinfo.isUdPanelSupported() && (a.width = 3840, a.height = 2160);
                  } catch (c) {
                    ab("Tizen: Error detecting screen size, default screen size 1920x1080.");
                  }
                  return Promise.resolve(a);
                };
                p.Wa = function (a) {
                  jy.prototype.Wa.call(this, a);
                  a.drm.ignoreDuplicateInitData = this.za() !== 2;
                  this.za() === 3 && (a.streaming.crossBoundaryStrategy = "reset_to_encrypted");
                  a.streaming.shouldFixTimestampOffset = true;
                  a.streaming.stallSkip = 0;
                  a.streaming.gapPadding = 2;
                  return a;
                };
                p.Fi = function () {
                  var a = [];
                  this.g !== null && this.g < 5 && a.push("opus");
                  return a;
                };
                p.sd = function (a) {
                  try {
                    if (webapis.avinfo.isHdrTvSupport()) return a ? "HLG" : "PQ";
                  } catch (b) {
                    return jy.prototype.sd.call(this, a);
                  }
                  return "SDR";
                };
                p.ti = function () {
                  return true;
                };
                p.ui = function () {
                  return this.za() === 3;
                };
                navigator.userAgent.includes("Tizen") && (vb = function vb() {
                  return new ty();
                });
                function uy() {
                  jy.apply(this, arguments);
                }
                la(uy, jy);
                uy.prototype.za = function () {
                  return null;
                };
                uy.prototype.Nb = function () {
                  return "Vizio";
                };
                uy.prototype.Ua = function () {
                  return "TV";
                };
                uy.prototype.cc = function () {
                  return false;
                };
                navigator.userAgent.includes("VIZIO SmartCast") && (vb = function vb() {
                  return new uy();
                });
                function vy() {
                  jy.call(this);
                  this.i = new sb(function () {
                    return navigator.userAgent.includes("DT_STB_BCM") || navigator.userAgent.includes("Sky_STB");
                  });
                  this.h = new sb(function () {
                    return navigator.userAgent.includes("SOPOpenBrowser");
                  });
                  this.g = new sb(function () {
                    if (navigator.userAgent.includes("DT_STB_BCM")) return 11;
                    var a = navigator.userAgent.match(/Version\/(\d+)/);
                    return a ? parseInt(a[1], 10) : (a = navigator.userAgent.match(/OS (\d+)(?:_\d+)?/)) ? parseInt(a[1], 10) : null;
                  });
                }
                la(vy, jy);
                p = vy.prototype;
                p.za = function () {
                  return this.g.value();
                };
                p.Nb = function () {
                  return "WebKit STB";
                };
                p.Ua = function () {
                  return "TV";
                };
                p.Ha = function () {
                  return "WEBKIT";
                };
                p.cc = function () {
                  return false;
                };
                p.fd = function () {
                  var a = this.g.value();
                  return a !== null ? a >= 15 : true;
                };
                p.Ed = function () {
                  return this.h.value();
                };
                p.jc = function () {
                  return Promise.resolve({
                    width: window.screen.width * window.devicePixelRatio,
                    height: window.screen.height * window.devicePixelRatio
                  });
                };
                p.Kf = function () {
                  return !this.i.value();
                };
                p.Jf = function () {
                  return false;
                };
                if (navigator.userAgent.includes("SOPOpenBrowser") || navigator.userAgent.includes("DT_STB_BCM") || navigator.userAgent.includes("Sky_STB") || !(!(navigator.vendor || "").includes("Apple") || /(?:iPhone|iPad|iPod)/.test(navigator.userAgent) || navigator.maxTouchPoints > 1 || navigator.userAgentData && navigator.userAgentData.platform && navigator.userAgentData.platform.toLowerCase() == "macos" || navigator.platform && navigator.platform.toLowerCase().includes("mac"))) vb = function vb() {
                  return new vy();
                };
                function wy() {
                  jy.call(this);
                  var a = this;
                  this.h = xy();
                  this.g = null;
                  try {
                    var b = new PalmServiceBridge();
                    b.onservicecallback = function (c) {
                      c = JSON.parse(c);
                      a.g = c.configs["tv.model.supportHDR"] || c.configs["tv.config.supportDolbyHDRContents"] || !1;
                    };
                    b.call("luna://com.webos.service.config/getConfigs", JSON.stringify({
                      configNames: ["tv.model.supportHDR", "tv.config.supportDolbyHDRContents"]
                    }));
                  } catch (c) {
                    ab("WebOS: getConfigs call failed", c);
                  }
                }
                la(wy, jy);
                p = wy.prototype;
                p.za = function () {
                  return this.h;
                };
                p.Nb = function () {
                  return "WebOS";
                };
                p.Ua = function () {
                  return "TV";
                };
                p.Ha = function () {
                  return "CHROMIUM";
                };
                p.cc = function () {
                  return false;
                };
                p.fd = function () {
                  var a = this.za();
                  return a !== null ? a > 3 : jy.prototype.fd.call(this);
                };
                p.Pc = function () {
                  var a = this.za();
                  return a !== null ? a > 6 : jy.prototype.Pc.call(this);
                };
                p.re = function () {
                  var a = this.za();
                  return a !== null ? a > 3 : jy.prototype.re.call(this);
                };
                p.jc = function () {
                  var a = {
                    width: 1920,
                    height: 1080
                  };
                  try {
                    var b = JSON.parse(window.PalmSystem.deviceInfo);
                    a.width = Math.max(1920, b.screenWidth);
                    a.height = Math.max(1080, b.screenHeight);
                  } catch (c) {
                    ab("WebOS: Error detecting screen size, default screen size 1920x1080.");
                  }
                  return Promise.resolve(a);
                };
                p.Wa = function (a) {
                  jy.prototype.Wa.call(this, a);
                  this.za() === 3 && (a.streaming.crossBoundaryStrategy = "reset");
                  a.streaming.shouldFixTimestampOffset = true;
                  a.streaming.stallSkip = 0;
                  return a;
                };
                p.sd = function (a) {
                  return this.g == null ? (ab("WebOS: getConfigs call haven't finished"), jy.prototype.sd.call(this, a)) : this.g ? a ? "HLG" : "PQ" : "SDR";
                };
                function xy() {
                  var a = null,
                    b = navigator.userAgent.match(/Chrome\/(\d+)/);
                  b && (a = parseInt(b[1], 10));
                  switch (a) {
                    case 38:
                      return 3;
                    case 53:
                      return 4;
                    case 68:
                      return 5;
                    case 79:
                      return 6;
                    case 87:
                      return 22;
                    case 94:
                      return 23;
                    case 108:
                      return 24;
                    case 120:
                      return 25;
                    default:
                      return null;
                  }
                }
                p.aj = function () {
                  return false;
                };
                p.ed = function () {
                  var a = this.za();
                  return a !== null ? a >= 6 : jy.prototype.ed.call(this);
                };
                if (navigator.userAgent.includes("Web0S")) {
                  var yy = new wy();
                  vb = function vb() {
                    return yy;
                  };
                }
                function zy() {
                  jy.call(this);
                  this.g = navigator.userAgent.includes("Edge/");
                  var a = navigator.userAgent.match(/Edge?\/(\d+)/);
                  this.h = a ? parseInt(a[1], 10) : null;
                }
                la(zy, jy);
                p = zy.prototype;
                p.za = function () {
                  return this.h;
                };
                p.Nb = function () {
                  return "Xbox";
                };
                p.Ua = function () {
                  return "CONSOLE";
                };
                p.Ha = function () {
                  return this.g ? "EDGE" : "CHROMIUM";
                };
                p.Ed = function () {
                  return true;
                };
                p.df = function () {
                  return true;
                };
                p.Vi = function () {
                  return this.g;
                };
                p.jc = function () {
                  var a = {
                      width: 1920,
                      height: 1080
                    },
                    b = Ay();
                  if (b) try {
                    var c = new b.Media.Protection.ProtectionCapabilities(),
                      d = b.Media.Protection.ProtectionCapabilityResult;
                    b = null;
                    do b = c.isTypeSupported('video/mp4;codecs="hvc1,mp4a";features="decode-res-x=3840,decode-res-y=2160,decode-bitrate=20000,decode-fps=30,decode-bpc=10,display-res-x=3840,display-res-y=2160,display-bpc=8"', "com.microsoft.playready.recommendation"); while (b === d.maybe);
                    b === d.probably && (a.width = 3840, a.height = 2160);
                  } catch (e) {
                    ab("Xbox: Error detecting screen size, default screen size 1920x1080.");
                  }
                  return Promise.resolve(a);
                };
                p.Wa = function (a) {
                  jy.prototype.Wa.call(this, a);
                  a.drm.parseInbandPsshEnabled = this.g;
                  a.drm.preferredKeySystems.push("com.microsoft.playready");
                  this.g && (a.streaming.gapPadding = .01);
                  return a;
                };
                p.xh = function () {
                  return false;
                };
                function Ay() {
                  var a = null;
                  try {
                    a = typeof Windows !== "undefined" ? Windows : chrome.webview.hostObjects.sync.Windows;
                  } catch (b) {}
                  return a;
                }
                if (navigator.userAgent.includes("Xbox One") || Ay() !== null) vb = function vb() {
                  return new zy();
                };
                function By(a, b, c) {
                  this.type = a;
                  this.ea = b;
                  this.segments = c || null;
                }
                function Cy(a, b, c, d) {
                  this.id = a;
                  this.name = b;
                  this.attributes = c;
                  this.value = d === void 0 ? null : d;
                }
                Cy.prototype.toString = function (a) {
                  function b(e) {
                    return e.name + "=" + (isNaN(Number(e.value)) ? '"' + e.value + '"' : e.value);
                  }
                  var c = "#" + this.name,
                    d = this.attributes ? this.attributes.filter(function (e) {
                      return a ? !a.has(e.name) : true;
                    }).map(b) : [];
                  this.value && d.unshift(this.value);
                  d.length > 0 && (c += ":" + d.join(","));
                  return c;
                };
                function Dy(a, b) {
                  if (b) return a.toString();
                  b = new Set().add("AUDIO").add("VIDEO").add("SUBTITLES").add("PATHWAY-ID").add("GROUP-ID").add("URI");
                  return a.toString(b);
                }
                function Ey(a, b) {
                  a = a.attributes.filter(function (c) {
                    return c.name == b;
                  });
                  return a.length ? a[0] : null;
                }
                function Fy(a, b, c) {
                  return (a = Ey(a, b)) ? a.value : c || null;
                }
                function Gy(a, b) {
                  a = Ey(a, b);
                  if (!a) throw new U(2, 4, 4023, b);
                  return a.value;
                }
                function Hy(a, b, c) {
                  c = c === void 0 ? [] : c;
                  this.ea = b;
                  this.g = a;
                  this.vc = c;
                }
                function Iy(a, b) {
                  this.name = a;
                  this.value = b;
                }
                function Jy(a, b) {
                  return a.filter(function (c) {
                    return c.name == b;
                  });
                }
                function Ky(a, b) {
                  return a.filter(function (c) {
                    return Gy(c, "TYPE") == b;
                  });
                }
                function Ly(a, b) {
                  a = t(a);
                  for (var c = a.next(); !c.done; c = a.next()) if (c = c.value, c.name === b) return c;
                  return null;
                }
                function My(a, b, c) {
                  c = c === void 0 ? 0 : c;
                  return (a = Ly(a, b)) ? Number(a.value) : c;
                }
                function Ny(a, b, c) {
                  return b ? Oy(a, [b], c) : [];
                }
                function Oy(a, b, c) {
                  if (!b.length) return [];
                  var d = b;
                  c && c.size && (d = b.map(function (e) {
                    return Py(e, c);
                  }));
                  return uc(a, d);
                }
                function Py(a, b) {
                  if (!b || !b.size) return a;
                  a = String(a).replace(/%7B/g, "{").replace(/%7D/g, "}");
                  var c = a.match(/{\$\w*}/g);
                  if (c) {
                    c = t(c);
                    for (var d = c.next(); !d.done; d = c.next()) {
                      d = d.value;
                      var e = d.slice(2, d.length - 1),
                        f = b.get(e);
                      if (f) a = a.replace(d, f);else throw new U(2, 4, 4039, e);
                    }
                  }
                  return a;
                }
                function Qy() {
                  this.g = 0;
                }
                function Ry(a, b) {
                  b = dc(b);
                  b = b.replace(/\r\n|\r(?=[^\n]|$)/gm, "\n").trim();
                  var c = b.split(/\n+/m);
                  if (!Sy.test(c[0])) throw new U(2, 4, 4015);
                  b = 0;
                  for (var d = false, e = [], f = true, g = 0; g < c.length; g++) {
                    var h = c[g],
                      k = c[g + 1];
                    if (h.startsWith("#") && !h.startsWith("#EXT") || f) f = false;else {
                      h = Ty(a, h);
                      d || (Uy.has(h.name) ? (b = 1, d = true) : h.name == "EXT-X-STREAM-INF" || h.name == "EXT-X-MEDIA" ? d = true : Vy.has(h.name) && (b = 1, d = true));
                      if (Vy.has(h.name)) {
                        if (b != 1) throw new U(2, 4, 4017);
                        f = a;
                        a = Array(Math.max(100, Math.floor((c.length - g) / 2)));
                        d = 0;
                        h = [];
                        var l = [];
                        for (k = null; g < c.length; g++) {
                          var m = c[g];
                          if (m.startsWith("#EXT")) m = Ty(f, m), Uy.has(m.name) ? e.push(m) : m.name == "EXT-X-MAP" ? k = m : m.name == "EXT-X-PART" ? l.push(m) : m.name == "EXT-X-PRELOAD-HINT" ? Fy(m, "TYPE") == "PART" ? l.push(m) : Fy(m, "TYPE") == "MAP" && (m.name = "EXT-X-MAP", k = m) : h.push(m);else if (!m.startsWith("#") || m.startsWith("#EXT")) m = m.trim(), k && h.push(k), h = new Hy(m, h, l), d < a.length ? a[d++] = h : (a.push(h), d++), h = [], l = [];
                        }
                        l.length && (k && h.push(k), c = new Hy("", h, l), d < a.length ? a[d++] = c : (a.push(c), d++));
                        return new By(b, e, d < a.length ? a.slice(0, d) : a);
                      }
                      e.push(h);
                      h.name == "EXT-X-STREAM-INF" && (h.attributes.push(new Iy("URI", k)), f = true);
                    }
                  }
                  return new By(b, e);
                }
                function Ty(a, b) {
                  a = a.g++;
                  var c = b.match(Wy);
                  if (!c) throw new U(2, 4, 4016, b);
                  b = c[1];
                  var d = c[2];
                  c = [];
                  var e;
                  if (d) {
                    d = new Yc(d);
                    var f;
                    Xy.lastIndex = 0;
                    (f = $c(d, Xy)) && (e = f[1]);
                    Yy.lastIndex = 0;
                    for (f = $c(d, Yy); f;) c.push(new Iy(f[1], f[2] || f[3])), Zc(d), f = $c(d, Yy);
                  }
                  return new Cy(a, b, c, e);
                }
                var Wy = /^#(EXT[^:]*)(?::(.*))?$/,
                  Sy = /^#EXTM3U($|[ \t\n])/m,
                  Xy = /^([^,=]+)(?:,|$)/g,
                  Yy = /([^=]+)=(?:"([^"]*)"|([^",]*))(?:,|$)/g,
                  Uy = new Set("EXT-X-TARGETDURATION EXT-X-MEDIA-SEQUENCE EXT-X-DISCONTINUITY-SEQUENCE EXT-X-PLAYLIST-TYPE EXT-X-I-FRAMES-ONLY EXT-X-ENDLIST EXT-X-SERVER-CONTROL EXT-X-SKIP EXT-X-PART-INF EXT-X-DATERANGE".split(" ")),
                  Vy = new Set("EXTINF EXT-X-BYTERANGE EXT-X-DISCONTINUITY EXT-X-PROGRAM-DATE-TIME EXT-X-KEY EXT-X-DATERANGE EXT-X-MAP EXT-X-GAP EXT-X-TILES".split(" "));
                function Zy() {}
                function $y(a, b) {
                  try {
                    var c = az(a);
                    return Dg({
                      uri: a,
                      originalUri: a,
                      data: c.data,
                      headers: {
                        "content-type": c.contentType
                      },
                      originalRequest: b
                    });
                  } catch (d) {
                    return Bg(d);
                  }
                }
                function az(a) {
                  var b = a.split(":");
                  if (b.length < 2 || b[0] != "data") throw new U(2, 1, 1004, a);
                  b = b.slice(1).join(":").split(",");
                  if (b.length < 2) throw new U(2, 1, 1004, a);
                  var c = b[0];
                  a = window.decodeURIComponent(b.slice(1).join(","));
                  b = c.split(";");
                  c = b[0];
                  var d = false;
                  b.length > 1 && b[b.length - 1] == "base64" && (d = true, b.pop());
                  var e;
                  d ? e = pc(a) : e = ic(a);
                  return {
                    data: e,
                    contentType: c
                  };
                }
                S("shaka.net.DataUriPlugin", Zy);
                Zy.parse = $y;
                Ng("data", $y);
                function bz() {
                  var a = this;
                  this.g = this.h = null;
                  this.G = 1;
                  this.B = new Map();
                  this.M = new Map();
                  this.C = new Map();
                  this.C.set("video", new Map());
                  this.C.set("audio", new Map());
                  this.C.set(Ac, new Map());
                  this.C.set("image", new Map());
                  this.uc = new Map().set("com.apple.streamingkeydelivery", function (b, c, d) {
                    return cz(a, b, c, d);
                  }).set("urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed", function (b) {
                    var c = Gy(b, "METHOD");
                    if (["SAMPLE-AES", "SAMPLE-AES-CTR"].includes(c)) {
                      var d = "cenc";
                      c == "SAMPLE-AES" && (d = "cbcs");
                      var e = Gy(b, "URI");
                      c = az(e.split("?")[0]);
                      e = e.split("?")[0];
                      a.I.has(e) || (c = Vb(c.data), a.I.set(e, c));
                      d = vc("com.widevine.alpha", d, [{
                        initDataType: "cenc",
                        initData: a.I.get(e)
                      }]);
                      (b = Fy(b, "KEYID")) && d.keyIds.add(b.toLowerCase().substr(2));
                      b = Promise.resolve(d);
                    } else b = Promise.resolve(null);
                    return b;
                  }).set("com.microsoft.playready", function (b) {
                    var c = Gy(b, "METHOD");
                    if (["SAMPLE-AES", "SAMPLE-AES-CTR"].includes(c)) {
                      var d = "cenc";
                      c == "SAMPLE-AES" && (d = "cbcs");
                      b = Gy(b, "URI");
                      b = az(b.split("?")[0]);
                      b = Vb(b.data);
                      c = new Uint8Array([154, 4, 240, 121, 152, 64, 66, 134, 171, 146, 230, 91, 224, 136, 95, 149]);
                      c = uh(b, c, new Set(), 0);
                      d = vc("com.microsoft.playready", d, [{
                        initDataType: "cenc",
                        initData: c
                      }]);
                      if (b = kd(["<PLAYREADY>", oc(b), "</PLAYREADY>"].join("\n"))) d.licenseServerUri = sv(b);
                      d = Promise.resolve(d);
                    } else d = Promise.resolve(null);
                    return d;
                  }).set("urn:uuid:3d5e6d35-9b9a-41e8-b843-dd3c6e72c42c", function (b) {
                    var c = Gy(b, "METHOD");
                    if (["SAMPLE-AES", "SAMPLE-AES-CTR"].includes(c)) {
                      var d = "cenc";
                      c == "SAMPLE-AES" && (d = "cbcs");
                      var e = Gy(b, "URI");
                      c = az(e.split("?")[0]);
                      e = e.split("?")[0];
                      a.I.has(e) || (c = Vb(c.data), a.I.set(e, c));
                      d = vc("com.huawei.wiseplay", d, [{
                        initDataType: "cenc",
                        initData: a.I.get(e)
                      }]);
                      (b = Fy(b, "KEYID")) && d.keyIds.add(b.toLowerCase().substr(2));
                      b = Promise.resolve(d);
                    } else b = Promise.resolve(null);
                    return b;
                  });
                  this.ob = new Set();
                  this.i = new Map();
                  this.l = null;
                  this.H = "";
                  this.Ta = new Qy();
                  this.N = -1;
                  this.ma = Infinity;
                  this.aa = this.yc = this.kb = false;
                  this.F = new df(function () {
                    if (a.X && !a.g.continueLoadingWhenPaused && (a.V.Ma(a.X, "timeupdate"), a.X.paused)) {
                      a.V.Ba(a.X, "timeupdate", function () {
                        return dz(a);
                      });
                      return;
                    }
                    dz(a);
                  });
                  this.Fa = ez;
                  this.m = null;
                  this.ib = 0;
                  this.o = Infinity;
                  this.ab = this.Sa = this.T = 0;
                  this.$ = new Kg();
                  this.J = new Map();
                  this.K = new Map();
                  this.Da = new Map();
                  this.va = new Map();
                  this.O = new Map();
                  this.xa = new Map();
                  this.ya = new Map();
                  this.xc = this.qa = false;
                  this.Zb = new Va(5);
                  this.j = null;
                  this.R = true;
                  this.V = new nb();
                  this.u = this.X = null;
                  this.ac = function () {
                    return false;
                  };
                  this.I = new Map();
                }
                p = bz.prototype;
                p.configure = function (a, b) {
                  var c = this.h && a.updatePeriod != this.g.updatePeriod && a.updatePeriod >= 0;
                  this.g = a;
                  b && (this.ac = b);
                  this.j && this.j.configure(this.g);
                  c && this.m && this.m.presentationTimeline.W() && this.F.Jb();
                };
                p.start = function (a, b) {
                  var c = this,
                    d;
                  return P(function (e) {
                    return e.g == 1 ? (c.h = b, c.qa = b.isLowLatencyMode(), F(e, fz(c, [a]).promise, 2)) : e.g != 3 ? (d = e.h, c.H = d.uri, F(e, gz(c, d.data), 3)) : e.return(c.m);
                  });
                };
                p.stop = function () {
                  this.F && (this.F.stop(), this.F = null);
                  var a = [];
                  this.$ && (a.push(this.$.destroy()), this.$ = null);
                  this.g = this.h = null;
                  this.ob.clear();
                  this.m = null;
                  this.i.clear();
                  this.M.clear();
                  this.K.clear();
                  this.B.clear();
                  this.Da.clear();
                  this.va.clear();
                  this.O.clear();
                  this.xa.clear();
                  this.ya.clear();
                  this.I.clear();
                  this.j && this.j.destroy();
                  this.V && (this.V.release(), this.V = null);
                  return Promise.all(a);
                };
                p.update = function () {
                  var a = this,
                    b,
                    c,
                    d,
                    e,
                    f,
                    g,
                    h,
                    k,
                    l,
                    m;
                  return P(function (n) {
                    if (n.g == 1) {
                      if (!hz(a)) return n.return();
                      b = [];
                      c = Array.from(a.i.values());
                      a.o = Infinity;
                      a.m.gapCount = 0;
                      d = c.filter(function (q) {
                        return !q.stream.isAudioMuxedInVideo && q.stream.segmentIndex;
                      });
                      e = t(d);
                      for (f = e.next(); !f.done; f = e.next()) g = f.value, b.push(iz(a, g));
                      return F(n, Promise.all(b), 2);
                    }
                    jz(a, d.map(function (q) {
                      return q.stream;
                    }));
                    h = d.some(function (q) {
                      return q.Yd == 0;
                    });
                    d.length && !h && (kz(a, ez), lz(a));
                    h && lz(a);
                    k = t(d);
                    for (l = k.next(); !l.done; l = k.next()) m = l.value, m.stream.isAudioMuxedInVideo || !m.stream.segmentIndex || Uf(m.stream.segmentIndex) || a.h.disableStream(m.stream);
                    G(n);
                  });
                };
                function mz(a, b) {
                  return hz(a) ? a.C.get(b.type) : b.mf;
                }
                function iz(a, b) {
                  var c, d, e, f, g, h, k, l, m, n, q, r, u, v, w, z, y, B, D, I, C, A, E, J, H, K, L, O, Q, N, M, R, T, pa, Y, Ha;
                  return P(function (Ca) {
                    switch (Ca.g) {
                      case 1:
                        if (b.stream.isAudioMuxedInVideo) return Ca.return();
                        c = [];
                        d = t(b.P());
                        for (e = d.next(); !e.done; e = d.next()) f = e.value, g = new Db(f), h = g.g, b.Re && (b.Qb >= 0 && h.add("_HLS_msn", String(b.Qb)), b.Rb >= 0 && h.add("_HLS_part", String(b.Rb))), b.Se && h.add("_HLS_skip", "YES"), Sb(h) && Hb(g, Ib(h.toString())), c.push(g.toString());
                        ua(Ca, 2);
                        return F(Ca, fz(a, c, true).promise, 4);
                      case 4:
                        k = Ca.h;
                        xa(Ca, 3);
                        break;
                      case 2:
                        throw l = ya(Ca), a.h && a.h.disableStream(b.stream), l;
                      case 3:
                        if (!b.stream.segmentIndex) return Ca.return();
                        m = Ry(a.Ta, k.data);
                        if (m.type != 1) throw new U(2, 4, 4017);
                        n = k.uri;
                        n == k.originalUri || b.P().includes(n) || b.Af.push(n);
                        q = Jy(m.ea, "EXT-X-DEFINE");
                        r = nz(a, q, n);
                        u = b.stream;
                        v = mz(a, b);
                        return F(Ca, oz(a, m, u.mimeType, b.P, r), 5);
                      case 5:
                        w = Ca.h;
                        z = w.keyIds;
                        y = w.drmInfos;
                        B = w.encrypted;
                        D = w.Lh;
                        u.encrypted || !B || D || (u.encrypted = true);
                        I = function I(za, oa) {
                          return za.size === oa.size && [].concat(x(za)).every(function (wa) {
                            return oa.has(wa);
                          });
                        };
                        I(u.keyIds, z) || (u.keyIds = z, u.drmInfos = y, a.h.newDrmInfo(u));
                        C = pz(a, m, v, r, b.P, b.type);
                        A = C.segments;
                        if (E = C.bandwidth) u.bandwidth = E;
                        J = bm(u);
                        H = t(A);
                        for (K = H.next(); !K.done; K = H.next()) L = K.value, L.ba && (L.ba.xd = J);
                        u.segmentIndex.fe(A, a.l.Hb());
                        A.length && (O = My(m.ea, "EXT-X-MEDIA-SEQUENCE", 0), N = (Q = Ly(m.ea, "EXT-X-SKIP")) ? Number(Fy(Q, "SKIPPED-SEGMENTS")) : 0, M = qz(O, A), R = M.Qb, T = M.Rb, b.Qb = R + N, b.Rb = T, pa = v.get(O), u.segmentIndex.Ya(pa));
                        if (Y = Uf(u.segmentIndex)) b.Wc = Y.startTime, Ha = A[A.length - 1], b.Lc = Ha.endTime;
                        if (Ly(m.ea, "EXT-X-ENDLIST")) b.Yd = true;
                        rz(a, m);
                        sz(a, m.ea, u.type, r, b.P);
                        G(Ca);
                    }
                  });
                }
                p.onExpirationUpdated = function () {};
                p.onInitialVariantChosen = function () {};
                p.banLocation = function (a) {
                  this.j && this.j.banLocation(a);
                };
                p.setMediaElement = function (a) {
                  this.X = a;
                };
                function tz(a, b, c) {
                  c = c === void 0 ? false : c;
                  for (var d = a.N == -1, e = t(b), f = e.next(); !f.done; f = e.next()) {
                    f = f.value;
                    var g = f.stream.segmentIndex,
                      h = mz(a, f);
                    if (g = Uf(g)) {
                      h = t(h);
                      for (var k = h.next(); !k.done; k = h.next()) {
                        k = t(k.value);
                        var l = k.next().value;
                        if (k.next().value == g.startTime) {
                          d && (a.N = Math.max(a.N, l));
                          f.og = l;
                          break;
                        }
                      }
                    }
                  }
                  if (!(a.N < 0)) for (b = t(b), d = b.next(); !d.done; d = b.next()) if (d = d.value, uz(a, d.type) || c) if (e = d.stream.segmentIndex) if (f = a.N - d.og, f > 0 && (e.g.splice(0, f), e = Uf(e))) e = -e.startTime, d.stream.segmentIndex.offset(e), vz(a, d, e);
                }
                function wz(a, b) {
                  if (a.ma == Infinity) {
                    b = t(b);
                    for (var c = b.next(); !c.done; c = b.next()) c = Uf(c.value.stream.segmentIndex), c != null && c.h != null && (a.ma = Math.min(a.ma, c.h));
                  }
                  b = a.ma;
                  if (b != Infinity) {
                    c = t(a.i.values());
                    for (var d = c.next(); !d.done; d = c.next()) if (d = d.value, !uz(a, d.type)) {
                      var e = d.stream.segmentIndex;
                      if (e != null) {
                        var f = Uf(e);
                        if (f) if (f.h == null) $a("Missing EXT-X-PROGRAM-DATE-TIME for stream", d.P(), "Expect AV sync issues!");else for (vz(a, d, f.h - b - f.startTime), d = t(e), e = d.next(); !e.done; e = d.next()) e.value.yh(b);
                      }
                    }
                  }
                }
                function vz(a, b, c) {
                  if (!(Math.abs(c) < .001)) {
                    b.Wc += c;
                    b.Lc += c;
                    a = mz(a, b);
                    for (var d = t(a), e = d.next(); !e.done; e = d.next()) {
                      var f = t(e.value);
                      e = f.next().value;
                      f = f.next().value;
                      a.set(e, f + c);
                    }
                    b.P();
                  }
                }
                function gz(a, b) {
                  var c, d, e, f, g, h, k, l, m, n, q, r, u, v, w, z, y, B, D, I, C, A, E, J, H, K, L, O, Q, N, M, R, T, pa, Y, Ha, Ba, Ca, za, oa, wa, Fa, Ea;
                  return P(function (ta) {
                    switch (ta.g) {
                      case 1:
                        c = Cc;
                        d = Ry(a.Ta, b);
                        e = Jy(d.ea, "EXT-X-DEFINE");
                        f = [];
                        g = [];
                        h = [];
                        a.l = new ol(null, 0);
                        a.l.cd(true);
                        k = function k() {
                          return [a.H];
                        };
                        l = null;
                        m = new Map();
                        if (d.type == 1) return a.R = false, R = Jy(d.ea, "EXT-X-DEFINE"), m = nz(a, R, a.H), l = c.Aa, T = "", pa = new Map(), F(ta, xz(a, a.G++, m, d, k, "", l, T, true, "Media Playlist", null, pa, null, false, null, false), 7);
                        yz(a, e);
                        n = Jy(d.ea, "EXT-X-MEDIA");
                        q = Jy(d.ea, "EXT-X-STREAM-INF");
                        r = Jy(d.ea, "EXT-X-IMAGE-STREAM-INF");
                        u = Jy(d.ea, "EXT-X-I-FRAME-STREAM-INF");
                        v = Jy(d.ea, "EXT-X-SESSION-KEY");
                        w = Jy(d.ea, "EXT-X-SESSION-DATA");
                        z = Jy(d.ea, "EXT-X-CONTENT-STEERING");
                        zz(a, w);
                        return F(ta, Az(a, z), 4);
                      case 4:
                        if (!a.g.ignoreSupplementalCodecs) {
                          y = [];
                          B = t(q);
                          D = B.next();
                          for (I = {}; !D.done; I = {
                            Zi: void 0
                          }, D = B.next()) if (C = D.value, A = Fy(C, "SUPPLEMENTAL-CODECS")) I.Zi = A.split(/\s*,\s*/).map(function (Za) {
                            return Za.split("/")[0];
                          }), E = C.attributes.map(function (Za) {
                            return function (bb) {
                              var ib = bb.name,
                                Na = bb.value;
                              ib == "CODECS" && (Na = Za.Zi.join(","), bb = bb.value.split(","), bb.length > 1 && (bb = yc("audio", bb)) && (Na += "," + bb));
                              return new Iy(ib, Na);
                            };
                          }(I)), y.push(new Cy(C.id, C.name, E, null));
                          q.push.apply(q, x(y));
                          J = [];
                          H = t(u);
                          K = H.next();
                          for (L = {}; !K.done; L = {
                            $i: void 0
                          }, K = H.next()) if (O = K.value, Q = Fy(O, "SUPPLEMENTAL-CODECS")) L.$i = Q.split(/\s*,\s*/).map(function (Za) {
                            return Za.split("/")[0];
                          }), N = O.attributes.map(function (Za) {
                            return function (bb) {
                              var ib = bb.name;
                              bb = bb.value;
                              ib == "CODECS" && (bb = Za.$i.join(","));
                              return new Iy(ib, bb);
                            };
                          }(L)), J.push(new Cy(O.id, O.name, N, null));
                          u.push.apply(u, x(J));
                        }
                        Bz(a, q);
                        Cz(a, n);
                        M = Dz(a, u);
                        return F(ta, Ez(a, q, v, n, k, a.B, M), 5);
                      case 5:
                        return f = ta.h, g = Fz(a, n), F(ta, Gz(a, r, u), 6);
                      case 6:
                        h = ta.h;
                        ta.A(3);
                        break;
                      case 7:
                        Y = ta.h, a.i.set(a.H, Y), Y.stream && (Ha = bm(Y.stream), Y.stream.segmentIndex.Fb(function (Za) {
                          Za.ba && (Za.ba.xd = Ha);
                        })), l = Y.stream.type, Ba = true, a.g.disableAudio && Y.type == "audio" ? Ba = false : a.g.disableVideo && Y.type == "video" && !Y.stream.codecs.includes(",") && (Ba = false), Ba && f.push({
                          id: 0,
                          language: lf(T || "und"),
                          disabledUntilTime: 0,
                          primary: true,
                          audio: Y.type == "audio" ? Y.stream : null,
                          video: Y.type == "video" ? Y.stream : null,
                          bandwidth: Y.stream.bandwidth || 0,
                          allowedByApplication: true,
                          allowedByKeySystem: true,
                          decodingInfos: []
                        });
                      case 3:
                        if (!a.h) throw new U(2, 7, 7001);
                        Hz(a, d);
                        d.type == 1 && (hz(a) && (Iz(a, d), Ca = a.o, a.F.ia(Ca)), za = Array.from(a.i.values()), Jz(a, za), lz(a), sz(a, d.ea, l, m, k));
                        a.m = {
                          presentationTimeline: a.l,
                          variants: f,
                          textStreams: g,
                          imageStreams: h,
                          offlineSessionIds: [],
                          sequenceMode: a.g.hls.sequenceMode,
                          ignoreManifestTimestampsInSegmentsMode: a.g.hls.ignoreManifestTimestampsInSegmentsMode,
                          type: "HLS",
                          serviceDescription: null,
                          nextUrl: null,
                          periodCount: 1,
                          gapCount: 0,
                          isLowLatency: false,
                          startTime: a.u
                        };
                        if (a.aa || !a.g.hls.disableCodecGuessing) {
                          ta.A(8);
                          break;
                        }
                        oa = [];
                        wa = t(a.m.variants);
                        for (Fa = wa.next(); !Fa.done; Fa = wa.next()) Ea = Fa.value, Ea.audio && Ea.audio.codecs === "" && oa.push(Ea.audio.createSegmentIndex()), Ea.video && Ea.video.codecs === "" && oa.push(Ea.video.createSegmentIndex());
                        return F(ta, Promise.all(oa), 8);
                      case 8:
                        a.h.makeTextStreamsForClosedCaptions(a.m), G(ta);
                    }
                  });
                }
                function Kz(a, b) {
                  var c, d, e, f, g, h, k, l, m, n, q, r, u, v, w, z;
                  return P(function (y) {
                    if (y.g == 1) {
                      c = rm(a.g.hls.mediaPlaylistFullMimeType);
                      if (!b.length) return y.return(c);
                      d = Lz(a, b);
                      e = d.segment;
                      f = d.segmentIndex;
                      g = e.P();
                      if (h = Oo(g[0])) if (k = Mz.get(h)) return y.return(rm(k));
                      return F(y, Promise.all([Nz(a, e.ba, 0), Nz(a, e, f)]), 2);
                    }
                    l = y.h;
                    m = l[1].mimeType;
                    n = l[0].data;
                    q = l[1].data;
                    r = "mp4 mp4a m4s m4i m4a m4f cmfa mp4v m4v cmfv fmp4".split(" ");
                    u = ["audio/mp4", "video/mp4", "video/iso.segment"];
                    v = e.ba || u.includes(m);
                    if (!v && mk(Vb(q))) {
                      var B = q,
                        D = a.g.disableAudio,
                        I = a.g.disableVideo,
                        C = a.g.disableText;
                      var A = Vb(B);
                      var E = new ek().parse(A),
                        J = E.Vd();
                      A = E.Jg();
                      var H = [],
                        K = false,
                        L = false;
                      if (!D) switch (J.audio) {
                        case "aac":
                        case "aac-loas":
                          E.ub().length && (H.push("mp4a.40.2"), K = true);
                          break;
                        case "mp3":
                          E.ub().length && (H.push("mp4a.40.34"), K = true);
                          break;
                        case "ac3":
                          E.ub().length && (H.push("ac-3"), K = true);
                          break;
                        case "ec3":
                          E.ub().length && (H.push("ec-3"), K = true);
                          break;
                        case "opus":
                          E.ub().length && (H.push("opus"), K = true);
                      }
                      if (!I) switch (J.video) {
                        case "avc":
                          A.codec ? H.push(A.codec) : H.push("avc1.42E01E");
                          L = true;
                          break;
                        case "hvc":
                          A.codec ? H.push(A.codec) : H.push("hvc1.1.6.L93.90");
                          L = true;
                          break;
                        case "av1":
                          H.push("av01.0.01M.08"), L = true;
                      }
                      if (H.length) {
                        D = K && !L;
                        I = new Map();
                        if (L && !C) {
                          C = new Pc("video/mp2t");
                          C.xf(B);
                          B = t(C.Vf());
                          for (L = B.next(); !L.done; L = B.next()) L = L.value, I.set(L, L);
                          C.Nd();
                        }
                        A = {
                          type: D ? "audio" : "video",
                          mimeType: "video/mp2t",
                          codecs: H.join(", "),
                          language: null,
                          height: A.height,
                          width: A.width,
                          channelCount: null,
                          sampleRate: null,
                          closedCaptions: I,
                          ve: null,
                          colorGamut: null,
                          frameRate: A.frameRate
                        };
                      } else A = null;
                      if (w = A) return y.return(w);
                    } else if (v || r.includes(h)) if (z = sm(n, q, a.g.disableText)) return y.return(z);
                    return m ? y.return(rm(m)) : y.return(c);
                  });
                }
                function Nz(a, b, c) {
                  var d, e, f, g, h, k;
                  return P(function (l) {
                    switch (l.g) {
                      case 1:
                        if (!b) return l.return({
                          mimeType: null,
                          data: null
                        });
                        d = Xg;
                        e = xm(b.P(), b.Ic(), b.Gc(), a.g.retryParameters);
                        f = b instanceof rj ? 1 : 0;
                        return F(l, Oz(a, e, d, {
                          type: f
                        }).promise, 2);
                      case 2:
                        g = l.h;
                        h = g.data;
                        if (!b.aesKey) {
                          l.A(3);
                          break;
                        }
                        return F(l, wm(h, b.aesKey, c), 4);
                      case 4:
                        h = l.h;
                      case 3:
                        return b instanceof rj ? b.pe(h, true) : b.pe(h), (k = g.headers["content-type"]) && (k = k.split(";")[0].toLowerCase()), l.return({
                          mimeType: k,
                          data: h
                        });
                    }
                  });
                }
                function lz(a) {
                  if (hz(a)) {
                    if (a.Fa == Pz) {
                      for (var b = Infinity, c = Infinity, d = t(a.i.values()), e = d.next(); !e.done; e = d.next()) e = e.value, e.stream.segmentIndex && e.stream.type != "text" && !e.stream.isAudioMuxedInVideo && (b = Math.min(b, e.Lc), c = Math.min(c, e.Wc));
                      b = b - c || 0;
                      isNaN(a.g.availabilityWindowOverride) || (b = a.g.availabilityWindowOverride);
                      a.l.Hf(b);
                    }
                  } else a.l.Ab(Qz(a));
                  if (!a.l.o) for (b = t(a.i.values()), c = b.next(); !c.done; c = b.next()) c = c.value, !c.stream.segmentIndex || c.type != "audio" && c.type != "video" || (c = Uf(c.stream.segmentIndex)) && c.h && a.l.oh(c.h);
                  a.l.lf();
                }
                function yz(a, b) {
                  var c = new Db(a.H).g;
                  b = t(b);
                  for (var d = b.next(); !d.done; d = b.next()) {
                    var e = d.value;
                    d = Fy(e, "NAME");
                    var f = Fy(e, "VALUE");
                    e = Fy(e, "QUERYPARAM");
                    d && f && (a.B.has(d) || a.B.set(d, f));
                    e && (d = c.get(e)[0]) && !a.B.has(d) && a.B.set(e, d);
                  }
                }
                function nz(a, b, c) {
                  c = new Db(c).g;
                  var d = new Map();
                  b = t(b);
                  for (var e = b.next(); !e.done; e = b.next()) {
                    var f = e.value,
                      g = Fy(f, "NAME"),
                      h = Fy(f, "VALUE");
                    e = Fy(f, "QUERYPARAM");
                    f = Fy(f, "IMPORT");
                    g && h && (d.has(g) || d.set(g, h));
                    e && (g = c.get(e)[0]) && !d.has(g) && d.set(e, g);
                    f && (e = a.B.get(f)) && d.set(f, e);
                  }
                  return d;
                }
                function Bz(a, b) {
                  b = t(b);
                  for (var c = b.next(); !c.done; c = b.next()) {
                    var d = c.value,
                      e = Fy(d, "AUDIO");
                    c = Fy(d, "VIDEO");
                    var f = Fy(d, "SUBTITLES");
                    d = Rz(a, d);
                    if (f) {
                      var g = yc(Ac, d);
                      a.K.set(f, g);
                      jb(d, g);
                    }
                    e && (f = yc("audio", d), f || (f = a.g.hls.defaultAudioCodec), a.K.set(e, f));
                    c && (e = yc("video", d), e || (e = a.g.hls.defaultVideoCodec), a.K.set(c, e));
                  }
                }
                function zz(a, b) {
                  b = t(b);
                  for (var c = b.next(); !c.done; c = b.next()) {
                    var d = c.value,
                      e = Fy(d, "DATA-ID");
                    c = Fy(d, "URI");
                    var f = Fy(d, "LANGUAGE");
                    d = Fy(d, "VALUE");
                    e = new Map().set("id", e);
                    c && e.set("uri", Ny([a.H], c, a.B)[0]);
                    f && e.set("language", f);
                    d && e.set("value", d);
                    c = new V("sessiondata", e);
                    if (a.h) a.h.onEvent(c);
                  }
                }
                function Az(a, b) {
                  var c, d, e, f, g, h;
                  return P(function (k) {
                    if (!a.h || !a.g) return k.return();
                    d = t(b);
                    for (e = d.next(); !e.done; e = d.next()) if (f = e.value, g = Fy(f, "PATHWAY-ID"), h = Fy(f, "SERVER-URI"), g && h) {
                      a.j = new qw(a.h);
                      a.j.configure(a.g);
                      a.j.i = [a.H];
                      a.j.setManifestType("HLS");
                      a.j.h = g;
                      c = rw(a.j, h);
                      break;
                    }
                    return F(k, c, 0);
                  });
                }
                function Fz(a, b) {
                  var c = Ky(b, "SUBTITLES");
                  b = c.map(function (g) {
                    if (a.g.disableText) return null;
                    try {
                      return Sz(a, [g], new Map()).stream;
                    } catch (h) {
                      if (a.g.hls.ignoreTextStreamFailures) return null;
                      throw h;
                    }
                  });
                  c = t(c);
                  for (var d = c.next(); !d.done; d = c.next()) {
                    var e = Gy(d.value, "GROUP-ID");
                    if (d = a.K.get(e)) if (e = a.M.get(e)) {
                      e = t(e);
                      for (var f = e.next(); !f.done; f = e.next()) f = f.value, f.stream.codecs = d, f.stream.mimeType = Tz(Ac, d) || Uz(Ac), Vz(f.stream);
                    }
                  }
                  return b.filter(function (g) {
                    return g;
                  });
                }
                function Vz(a) {
                  var b = new Set([Fe(a.mimeType, a.codecs)]);
                  a.segmentIndex && a.segmentIndex.Fb(function (c) {
                    c.mimeType && b.add(Fe(c.mimeType, a.codecs));
                  });
                  a.fullMimeTypes = b;
                }
                function Gz(a, b, c) {
                  var d, e;
                  return P(function (f) {
                    if (f.g == 1) return d = b.map(function (g) {
                      var k, l;
                      return P(function (m) {
                        if (m.g == 1) {
                          if (a.g.disableThumbnails) return m.return(null);
                          ua(m, 2);
                          return F(m, Wz(a, g), 4);
                        }
                        if (m.g != 2) return k = m.h, m.return(k.stream);
                        l = ya(m);
                        if (a.g.hls.ignoreImageStreamFailures) return m.return(null);
                        throw l;
                      });
                    }).concat(c.map(function (g) {
                      if (a.g.disableThumbnails) return null;
                      try {
                        var h = Xz(a, g);
                        return h.stream.type !== "image" ? null : h.stream;
                      } catch (k) {
                        if (a.g.hls.ignoreImageStreamFailures) return null;
                        throw k;
                      }
                    })), F(f, Promise.all(d), 2);
                    e = f.h;
                    return f.return(e.filter(function (g) {
                      return g;
                    }));
                  });
                }
                function Yz(a, b, c) {
                  b = b.filter(function (h) {
                    var k = Fy(h, "URI") || "";
                    h = Fy(h, "TYPE");
                    return h != "SUBTITLES" && (k != "" || h == "AUDIO");
                  });
                  var d = {};
                  b = t(b);
                  for (var e = b.next(); !e.done; e = b.next()) {
                    e = e.value;
                    var f = Dy(e, !a.j);
                    d[f] ? d[f].push(e) : d[f] = [e];
                  }
                  for (var g in d) Sz(a, d[g], c, false);
                }
                function Dz(a, b) {
                  return b.map(function (c) {
                    c = Xz(a, c);
                    return c.stream.type !== "video" ? null : c.stream;
                  }).filter(function (c) {
                    return c;
                  });
                }
                function Ez(a, b, c, d, e, f, g) {
                  var h, k, l, m, n, q, r, u, v, w, z, y, B, D, I, C, A, E, J, H, K, L, O, Q, N, M, R, T, pa, Y, Ha, Ba, Ca, za, oa, wa;
                  return P(function (Fa) {
                    switch (Fa.g) {
                      case 1:
                        h = [];
                        k = new Set();
                        if (a.g.ignoreDrmInfo || !(c.length > 0)) {
                          Fa.A(2);
                          break;
                        }
                        l = t(c);
                        m = l.next();
                      case 3:
                        if (m.done) {
                          Fa.A(2);
                          break;
                        }
                        n = m.value;
                        q = Gy(n, "METHOD");
                        r = Fy(n, "KEYFORMAT") || "identity";
                        u = null;
                        if (q == "NONE") {
                          Fa.A(4);
                          break;
                        }
                        if (Zz(q)) {
                          v = Ny(e(), Gy(n, "URI"), f);
                          w = v.sort().join("");
                          a.O.has(w) || (z = Rg(v, a.g.retryParameters), y = Oz(a, z, 6).promise, a.O.set(w, y));
                          Fa.A(4);
                          break;
                        }
                        if (r == "identity") return F(Fa, $z(a, n, "", e, null, f), 12);
                        B = a.uc.get(r);
                        if (!B) {
                          D = null;
                          Fa.A(10);
                          break;
                        }
                        return F(Fa, B(n, "", null), 11);
                      case 11:
                        D = Fa.h;
                      case 10:
                        u = D;
                        Fa.A(6);
                        break;
                      case 12:
                        u = Fa.h;
                      case 6:
                        if (u) {
                          if (u.keyIds) for (I = t(u.keyIds), C = I.next(); !C.done; C = I.next()) A = C.value, k.add(A);
                          h.push(u);
                        }
                      case 4:
                        m = l.next();
                        Fa.A(3);
                        break;
                      case 2:
                        E = {};
                        J = t(b);
                        for (H = J.next(); !H.done; H = J.next()) K = H.value, L = Dy(K, !a.j), E[L] ? E[L].push(K) : E[L] = [K];
                        O = [];
                        for (Q in E) N = E[Q], M = N[0], R = Fy(M, "FRAME-RATE"), T = Number(Fy(M, "AVERAGE-BANDWIDTH")) || Number(Gy(M, "BANDWIDTH")), pa = Fy(M, "RESOLUTION"), Y = t(pa ? pa.split("x") : [null, null]), Ha = Y.next().value, Ba = Y.next().value, Ca = Fy(M, "VIDEO-RANGE"), (za = Fy(M, "REQ-VIDEO-LAYOUT")) && za.includes(",") && (oa = za.split(",").filter(function (Ea) {
                          return Ea == "CH-STEREO" || Ea == "CH-MONO";
                        }), za = oa[0]), za = za || "CH-MONO", wa = aA(a, N, d), O.push.apply(O, x(bA(a, wa.audio, wa.video, T, Ha, Ba, R, Ca, za, h, k, g)));
                        return Fa.return(O.filter(function (Ea) {
                          return Ea != null;
                        }));
                    }
                  });
                }
                function aA(a, b, c) {
                  for (var d = {
                      audio: [],
                      video: []
                    }, e = new Map(), f = [], g = false, h = false, k = t(b), l = k.next(); !l.done; l = k.next()) {
                    var m = l.value;
                    l = Fy(m, "AUDIO");
                    var n = Fy(m, "VIDEO"),
                      q = l || n;
                    q && (f.includes(q) || f.push(q), (m = Fy(m, "PATHWAY-ID")) && e.set(q, m), l ? g = true : n && (h = true));
                  }
                  f.length && c.length && (c = c.filter(function (u) {
                    return f.includes(Gy(u, "GROUP-ID"));
                  }), Yz(a, c, e));
                  c = (e = f.sort().join(",")) && a.M.has(e) ? a.M.get(e) : [];
                  g ? d.audio.push.apply(d.audio, x(c)) : h && d.video.push.apply(d.video, x(c));
                  h = false;
                  var r = b.map(function (u) {
                    return Gy(u, "URI");
                  });
                  g = d.audio.find(function (u) {
                    return u && u.P().find(function (v) {
                      return r.includes(v);
                    });
                  });
                  c = Rz(a, b[0]);
                  k = yc("video", c);
                  (l = yc("audio", c)) && !k ? (g = "audio", h = d.audio.length > 0 && !d.audio.some(function (u) {
                    return u.stream.isAudioMuxedInVideo;
                  })) : !d.audio.length && !d.video.length && l && k ? (g = "video", c = [[k, l].join()]) : d.audio.length && g ? (g = "audio", h = true) : g = d.video.length && !d.audio.length ? "audio" : "video";
                  h || (b = cA(a, b, c, g), e && a.g.enableAudioGroups && (b.stream.groupId = e), b.stream.type == "audio" && g === "audio" && d.audio.some(function (u) {
                    return u.stream.isAudioMuxedInVideo;
                  }) && (a = d.audio[0].stream, b.stream.language = a.language, b.stream.channelsCount = a.channelsCount, b.stream.label = a.label, b.stream.audioSamplingRate = a.audioSamplingRate, b.stream.originalId = a.originalId, b.stream.originalLanguage = a.originalLanguage), d[b.stream.type] = [b]);
                  return d;
                }
                function Rz(a, b) {
                  b = Fy(b, "CODECS") || "";
                  a.aa = b.length > 0;
                  a.aa || a.g.hls.disableCodecGuessing || (b = [], a.g.disableVideo || b.push(a.g.hls.defaultVideoCodec), a.g.disableAudio || b.push(a.g.hls.defaultAudioCodec), b = b.join(","));
                  return tm(b.split(/\s*,\s*/));
                }
                function dA(a) {
                  return (a = Fy(a, "CHANNELS")) ? parseInt(a.split("/")[0], 10) : null;
                }
                function eA(a) {
                  return (a = Fy(a, "SAMPLE-RATE")) ? parseInt(a, 10) : null;
                }
                function fA(a) {
                  a = Fy(a, "CHANNELS");
                  if (!a) return false;
                  a = a.split("/");
                  return a.length != 2 ? false : a[1] === "JOC" || a[1].includes("ATMOS");
                }
                function gA(a) {
                  a = Gy(a, "TYPE").toLowerCase();
                  a == "subtitles" && (a = Ac);
                  return a;
                }
                function bA(a, b, c, d, e, f, g, h, k, l, m, n) {
                  for (var q = t(c), r = q.next(); !r.done; r = q.next()) hA(r.value.stream, e, f, g, h, k, null);
                  e = a.g.disableVideo;
                  if (!c.length || e) c = [null];
                  e && (b = b.filter(function (z) {
                    return !z.stream.isAudioMuxedInVideo;
                  }));
                  e = a.g.disableAudio;
                  if (!b.length || e) b = [null];
                  e = [];
                  b = t(b);
                  for (f = b.next(); !f.done; f = b.next()) for (f = f.value, g = t(c), h = g.next(); !h.done; h = g.next()) {
                    var u = h.value;
                    if (h = f ? f.stream : null) h.drmInfos = l, h.keyIds = m;
                    if (k = u ? u.stream : null) k.drmInfos = l, k.keyIds = m, a.g.disableIFrames || hg(k, n);
                    k && !h && (k.bandwidth = d);
                    !k && h && (h.bandwidth = d);
                    q = f ? f.stream.drmInfos : null;
                    r = u ? u.stream.drmInfos : null;
                    u = u ? u.P().sort().join(",") : "";
                    var v = f ? f.P().sort().join(",") : "",
                      w = [];
                    h && h.codecs && w.push(h.codecs);
                    k && k.codecs && w.push(k.codecs);
                    u = [u, v, w.sort()].join("-");
                    h && k && !pg(q, r) || a.ob.has(u) || (h = {
                      id: a.G++,
                      language: h ? h.language : "und",
                      disabledUntilTime: 0,
                      primary: !!h && h.primary || !!k && k.primary,
                      audio: h,
                      video: k,
                      bandwidth: d,
                      allowedByApplication: true,
                      allowedByKeySystem: true,
                      decodingInfos: []
                    }, e.push(h), a.ob.add(u));
                  }
                  return e;
                }
                function Cz(a, b) {
                  b = Ky(b, "CLOSED-CAPTIONS");
                  a.R = b.length == 0;
                  b = t(b);
                  for (var c = b.next(); !c.done; c = b.next()) {
                    var d = c.value,
                      e = Fy(d, "LANGUAGE");
                    c = lf(e || "und");
                    e || (e = Fy(d, "NAME")) && (c = e);
                    e = Gy(d, "GROUP-ID");
                    d = Gy(d, "INSTREAM-ID").replace("SERVICE", "svc");
                    a.J.get(e) || a.J.set(e, new Map());
                    a.J.get(e).set(d, c);
                  }
                }
                function Sz(a, b, c, d) {
                  d = d === void 0 ? true : d;
                  for (var e = [], f = [], g = new Map(), h = t(b), k = h.next(), l = {}; !k.done; l = {
                    ii: void 0
                  }, k = h.next()) k = k.value, l.ii = ++a.G, l = function (v) {
                    return function () {
                      return "shaka://hls-muxed" + v.ii;
                    };
                  }(l), l = d ? Gy(k, "URI") : Fy(k, "URI") || l(), k = Gy(k, "GROUP-ID"), e.push(l), f.push(k), g.set(k, l);
                  d = f.sort().join(",");
                  k = b[0];
                  b = "";
                  h = gA(k);
                  if (h == Ac) b = Fy(k, "CODECS") || "";else for (f = t(f), l = f.next(); !l.done; l = f.next()) if (l = l.value, a.K.has(l)) {
                    b = a.K.get(l);
                    break;
                  }
                  f = e.sort().join(",");
                  if (a.i.has(f)) return a.i.get(f);
                  l = a.G++;
                  if (a.j) {
                    g = t(g);
                    for (var m = g.next(); !m.done; m = g.next()) {
                      var n = t(m.value);
                      m = n.next().value;
                      n = n.next().value;
                      (m = c.get(m)) && uw(a.j, l, m, n);
                    }
                  }
                  c = Fy(k, "LANGUAGE");
                  g = Fy(k, "NAME");
                  m = Fy(k, "DEFAULT") == "YES";
                  n = h == "audio" ? dA(k) : null;
                  var q = h == "audio" ? fA(k) : false,
                    r = Fy(k, "CHARACTERISTICS"),
                    u = Fy(k, "FORCED") == "YES";
                  k = h == "audio" ? eA(k) : null;
                  e = iA(a, l, e, b, h, c, m, g, n, null, r, u, k, q);
                  e.stream && a.g.enableAudioGroups && (e.stream.groupId = d);
                  a.M.has(d) ? a.M.get(d).push(e) : a.M.set(d, [e]);
                  a.i.set(f, e);
                  return e;
                }
                function Wz(a, b) {
                  var c, d, e, f, g, h, k, l, m, n;
                  return P(function (q) {
                    if (q.g == 1) {
                      c = Gy(b, "URI");
                      d = Fy(b, "CODECS", "jpeg") || "";
                      if (a.i.has(c)) return q.return(a.i.get(c));
                      e = Fy(b, "LANGUAGE");
                      f = Fy(b, "NAME");
                      g = Fy(b, "CHARACTERISTICS");
                      h = iA(a, a.G++, [c], d, "image", e, false, f, null, null, g, false, null, false);
                      return (k = Fy(b, "RESOLUTION")) ? F(q, h.stream.createSegmentIndex(), 3) : q.A(2);
                    }
                    if (q.g != 2) {
                      l = Uf(h.stream.segmentIndex);
                      if (m = l.tilesLayout) h.stream.width = Number(k.split("x")[0]) * Number(m.split("x")[0]), h.stream.height = Number(k.split("x")[1]) * Number(m.split("x")[1]);
                      h.stream.closeSegmentIndex();
                    }
                    if (n = Fy(b, "BANDWIDTH")) h.stream.bandwidth = Number(n);
                    a.i.set(c, h);
                    return q.return(h);
                  });
                }
                function Xz(a, b) {
                  var c = "video",
                    d = Gy(b, "URI"),
                    e = Fy(b, "CODECS") || "";
                  e == "mjpg" && (c = "image");
                  if (a.i.has(d)) return a.i.get(d);
                  var f = Fy(b, "LANGUAGE"),
                    g = Fy(b, "NAME"),
                    h = Fy(b, "CHARACTERISTICS");
                  c = iA(a, a.G++, [d], e, c, f, false, g, null, null, h, false, null, false);
                  e = Fy(b, "RESOLUTION");
                  f = t(e ? e.split("x") : [null, null]);
                  e = f.next().value;
                  f = f.next().value;
                  c.stream.width = Number(e) || void 0;
                  c.stream.height = Number(f) || void 0;
                  if (b = Fy(b, "BANDWIDTH")) c.stream.bandwidth = Number(b);
                  a.i.set(d, c);
                  return c;
                }
                function cA(a, b, c, d) {
                  for (var e = a.G++, f = [], g = t(b), h = g.next(); !h.done; h = g.next()) {
                    var k = h.value;
                    h = Gy(k, "URI");
                    k = Fy(k, "PATHWAY-ID");
                    a.j && k && uw(a.j, e, k, h);
                    f.push(h);
                  }
                  g = f.sort().join(",") + c.sort().join(",");
                  if (a.i.has(g)) return a.i.get(g);
                  h = f.join(",");
                  a: {
                    b = Fy(b[0], "CLOSED-CAPTIONS");
                    if (d == "video") {
                      if (a.g.disableText) {
                        a.R = false;
                        b = null;
                        break a;
                      }
                      if (b) {
                        if (b != "NONE") {
                          b = a.J.get(b);
                          break a;
                        }
                        a.R = false;
                      } else if (!b && a.J.size) for (b = t(a.J.keys()), b = b.next(); !b.done; b = b.next()) {
                        b = a.J.get(b.value);
                        break a;
                      }
                    }
                    b = null;
                  }
                  c = xc(d, c);
                  d = iA(a, e, f, c, d, null, false, h, null, b, null, false, null, false);
                  a.i.set(g, d);
                  return d;
                }
                function iA(a, b, c, d, e, f, g, h, k, l, m, n, q, r) {
                  function u(D) {
                    var I, C, A, E, J, H, K, L, O, Q, N, M, R, T, pa, Y, Ha, Ba, Ca, za;
                    return P(function (oa) {
                      switch (oa.g) {
                        case 1:
                          return I = Cc, ua(oa, 2), F(oa, D.promise, 4);
                        case 4:
                          C = oa.h;
                          if (D.aborted) return oa.return();
                          A = C.uri;
                          A != C.originalUri && (E = z.P(), E.includes(A) || z.Af.push(A));
                          J = Ry(a.Ta, C.data);
                          if (J.type != 1) throw new U(2, 4, 4017);
                          H = Jy(J.ea, "EXT-X-DEFINE");
                          K = nz(a, H, A);
                          L = false;
                          (!a.aa && a.g.hls.disableCodecGuessing || a.R && e == I.Aa && !a.g.hls.disableClosedCaptionsDetection) && J.segments.length > 0 && (a.R = false, L = true);
                          O = !a.aa && a.g.hls.disableCodecGuessing;
                          Q = hz(a);
                          return F(oa, xz(a, 0, K, J, v, d, e, f, g, h, k, l, m, n, q, r, void 0, L, O), 5);
                        case 5:
                          N = oa.h;
                          if (D.aborted) return oa.return();
                          M = N.stream;
                          Hz(a, J);
                          hz(a) && !Q && Iz(a, J);
                          z.Wc = N.Wc;
                          z.Lc = N.Lc;
                          z.Se = N.Se;
                          z.Re = N.Re;
                          z.Yd = N.Yd;
                          z.mf = N.mf;
                          z.Qb = N.Qb;
                          z.Rb = N.Rb;
                          w.segmentIndex = M.segmentIndex;
                          w.encrypted = M.encrypted;
                          w.drmInfos = M.drmInfos;
                          w.keyIds = M.keyIds;
                          w.mimeType = M.mimeType;
                          w.bandwidth = w.bandwidth || M.bandwidth;
                          w.codecs = w.codecs || M.codecs;
                          w.closedCaptions = w.closedCaptions || M.closedCaptions;
                          w.width = w.width || M.width;
                          w.height = w.height || M.height;
                          w.hdr = w.hdr || M.hdr;
                          w.colorGamut = w.colorGamut || M.colorGamut;
                          w.frameRate = w.frameRate || M.frameRate;
                          w.language == "und" && M.language != "und" && (w.language = M.language);
                          w.language = w.language || M.language;
                          w.channelsCount = w.channelsCount || M.channelsCount;
                          w.audioSamplingRate = w.audioSamplingRate || M.audioSamplingRate;
                          Vz(w);
                          w.drmInfos.length && a.h.newDrmInfo(w);
                          R = false;
                          if (!l && w.closedCaptions || l && w.closedCaptions && l.size != w.closedCaptions.size) R = true;
                          a.m && R && a.h.makeTextStreamsForClosedCaptions(a.m);
                          e == I.Na && (T = Uf(M.segmentIndex)) && T.ba && (w.mimeType = "application/mp4", Vz(w));
                          pa = bm(w);
                          w.segmentIndex.Fb(function (wa) {
                            wa.ba && (wa.ba.xd = pa);
                          });
                          jA(a) && (a.yc ? Jz(a, [z]) : (a.yc = true, Y = Array.from(a.i.values()), Ha = Y.filter(function (wa) {
                            return wa.stream.segmentIndex;
                          }), Jz(a, Ha), lz(a), Ba = a.o, Ba > 0 && a.F.ia(Ba)));
                          sz(a, J.ea, w.type, K, v);
                          a.m && (a.m.startTime = a.u);
                          xa(oa, 0);
                          break;
                        case 2:
                          Ca = ya(oa);
                          w.closeSegmentIndex();
                          if (Ca.code === 7001) return oa.return();
                          za = a.h.disableStream(w);
                          if (!za) throw Ca;
                          G(oa);
                      }
                    });
                  }
                  function v() {
                    return a.j && c.length > 1 ? vw(a.j, b) : z.Af.concat(Oy([a.H], c, a.B));
                  }
                  var w = kA(a, d, e, f, g, h, k, l, m, n, q, r);
                  c.some(function (D) {
                    return D.startsWith("shaka://hls-muxed");
                  }) && (w.isAudioMuxedInVideo = true, w.mimeType = "video/mp2t", Vz(w));
                  var z = {
                      stream: w,
                      type: e,
                      Af: [],
                      Wc: 0,
                      Lc: 0,
                      mf: new Map(),
                      Se: false,
                      Re: false,
                      Yd: false,
                      og: -1,
                      Qb: -1,
                      Rb: -1,
                      P: v
                    },
                    y = null,
                    B;
                  w.createSegmentIndex = function () {
                    if (y) return y;
                    if (w.isAudioMuxedInVideo) return w.segmentIndex = new Nl([]), Promise.resolve();
                    B = fz(a, z.P(), true);
                    return y = new Promise(function (D) {
                      D(u(B));
                    });
                  };
                  w.closeSegmentIndex = function () {
                    y && !w.segmentIndex && B.abort();
                    w.segmentIndex && (w.segmentIndex.release(), w.segmentIndex = null);
                    y = null;
                  };
                  return z;
                }
                function Qz(a) {
                  var b = Infinity;
                  a = t(a.i.values());
                  for (var c = a.next(); !c.done; c = a.next()) c = c.value, c.stream.segmentIndex && c.stream.type != "text" && !c.stream.isAudioMuxedInVideo && (b = Math.min(b, c.Lc));
                  return b;
                }
                function jz(a, b) {
                  var c = [];
                  b = t(b);
                  for (var d = b.next(); !d.done; d = b.next()) d = d.value, d.segmentIndex && d.segmentIndex.Fb(function (e) {
                    c.push(e);
                  });
                  a.l.ie(c);
                }
                function Jz(a, b) {
                  if (!hz(a)) for (var c = Qz(a), d = t(b), e = d.next(); !e.done; e = d.next()) e.value.stream.segmentIndex.pd(0, c);
                  jz(a, b.map(function (f) {
                    return f.stream;
                  }));
                  d = Array.from(a.i.values()).filter(function (f) {
                    return f.stream.segmentIndex;
                  });
                  c = d.some(function (f) {
                    return f.stream.type == "audio";
                  });
                  e = d.some(function (f) {
                    return f.stream.type == "video";
                  });
                  d = hz(a) && !a.kb;
                  c = !hz(a) && a.kb && !(c && e);
                  a.g.hls.ignoreManifestProgramDateTime || d || c ? tz(a, b, d) : (wz(a, b), a.g.hls.ignoreManifestProgramDateTimeForTypes.length > 0 && tz(a, b));
                }
                function uz(a, b) {
                  return a.g.hls.ignoreManifestProgramDateTime ? true : a.g.hls.ignoreManifestProgramDateTimeForTypes.includes(b);
                }
                function jA(a) {
                  if (!a.m) return false;
                  var b = [],
                    c = [];
                  a = t(a.m.variants);
                  for (var d = a.next(); !d.done; d = a.next()) d = d.value, d.video && b.push(d.video), d.audio && c.push(d.audio);
                  return b.length > 0 && !b.some(function (e) {
                    return e.segmentIndex;
                  }) || c.length > 0 && !c.some(function (e) {
                    return e.segmentIndex;
                  }) ? false : true;
                }
                function xz(a, b, c, d, e, f, g, h, k, l, m, n, q, r, u, v, w, z, y) {
                  z = z === void 0 ? true : z;
                  y = y === void 0 ? true : y;
                  var B, D, I, C, A, E, J, H, K, L, O, Q, N, M, R, T, pa, Y, Ha, Ba, Ca, za, oa, wa, Fa, Ea, ta, Za, bb;
                  return P(function (ib) {
                    switch (ib.g) {
                      case 1:
                        B = d.segments || [];
                        D = B.every(function (Na) {
                          return Ly(Na.ea, "EXT-X-GAP") ? true : false;
                        });
                        if (!B.length || D) throw new U(2, 4, 4053);
                        lA(a, d);
                        hz(a) && rz(a, d);
                        I = hz(a) ? a.C.get(g) : new Map();
                        C = pz(a, d, I, c, e, g);
                        A = C.segments;
                        E = C.bandwidth;
                        O = L = K = H = J = null;
                        if (!(A.length > 0 && z)) {
                          ib.A(2);
                          break;
                        }
                        return F(ib, Kz(a, A), 3);
                      case 3:
                        Q = ib.h, g != Q.type && hz(a) && (a.C.set(Q.type, a.C.get(g)), a.C.set(g, new Map())), g = Q.type, h = Q.language, m = Q.channelCount, u = Q.sampleRate, a.g.disableText || (n = Q.closedCaptions), H = Q.height, J = Q.width, K = Q.ve, L = Q.colorGamut, O = Q.frameRate, y && (w = Q.mimeType, f = Q.codecs);
                      case 2:
                        if (w) {
                          ib.A(4);
                          break;
                        }
                        return F(ib, mA(a, g, f, A), 5);
                      case 5:
                        w = ib.h, g != Ac || f || w != "application/mp4" || !A[0] || A[0].ba || (w = "text/vtt");
                      case 4:
                        return F(ib, oz(a, d, w, e, c), 6);
                      case 6:
                        N = ib.h;
                        M = N.drmInfos;
                        R = N.keyIds;
                        T = N.encrypted;
                        pa = N.Lh;
                        if (T && !M.length && !pa) throw new U(2, 4, 4026);
                        Y = kA(a, f, g, h, k, l, m, n, q, r, u, v);
                        Y.encrypted = T && !pa;
                        Y.drmInfos = M;
                        Y.keyIds = R;
                        Y.mimeType = w;
                        E && (Y.bandwidth = E);
                        Vz(Y);
                        g == "video" && (J || H || K || L) && hA(Y, J, H, O, K, null, L);
                        hz(a) && rz(a, d);
                        Ha = A[0].startTime;
                        Ba = A[A.length - 1];
                        Ca = Ba.endTime;
                        za = new Nl(A);
                        Y.segmentIndex = za;
                        wa = (oa = Ly(d.ea, "EXT-X-SERVER-CONTROL")) ? Ey(oa, "CAN-SKIP-UNTIL") != null : false;
                        Fa = oa ? Ey(oa, "CAN-BLOCK-RELOAD") != null : false;
                        Ea = My(d.ea, "EXT-X-MEDIA-SEQUENCE", 0);
                        ta = qz(Ea, A);
                        Za = ta.Qb;
                        bb = ta.Rb;
                        return ib.return({
                          stream: Y,
                          type: g,
                          Af: [],
                          P: e,
                          Wc: Ha,
                          Lc: Ca,
                          Se: wa,
                          Re: Fa,
                          Yd: false,
                          og: -1,
                          Qb: Za,
                          Rb: bb,
                          mf: I
                        });
                    }
                  });
                }
                function qz(a, b) {
                  a = a + b.length - 1;
                  var c = -1;
                  if (!b.length) return a++, {
                    Qb: a,
                    Rb: c
                  };
                  b = b[b.length - 1];
                  var d = b.g;
                  if (!b.g.length) return a++, b.o && (c = 0), {
                    Qb: a,
                    Rb: c
                  };
                  c = d.length - 1;
                  d[d.length - 1].isPreload() || (a++, c = 0);
                  return {
                    Qb: a,
                    Rb: c
                  };
                }
                function kA(a, b, c, d, e, f, g, h, k, l, m, n) {
                  var q = Tz(c, b) || Uz(c),
                    r = [];
                  if (k) {
                    k = t(k.split(","));
                    for (var u = k.next(); !u.done; u = k.next()) r.push(u.value);
                  }
                  u = void 0;
                  k = null;
                  c == Ac ? u = r.includes("public.accessibility.transcribes-spoken-dialog") && r.includes("public.accessibility.describes-music-and-sound") ? "caption" : "subtitle" : r.includes("public.accessibility.describes-video") && (k = "visually impaired");
                  r.length || u !== "subtitle" || r.push("subtitle");
                  u = null;
                  c != "video" && (u = f);
                  a = {
                    id: a.G++,
                    originalId: f,
                    groupId: null,
                    createSegmentIndex: function createSegmentIndex() {
                      return Promise.resolve();
                    },
                    segmentIndex: null,
                    mimeType: q,
                    codecs: b,
                    kind: c == Ac ? "subtitle" : void 0,
                    encrypted: false,
                    drmInfos: [],
                    keyIds: new Set(),
                    language: lf(d || "und"),
                    originalLanguage: d,
                    label: u,
                    type: c,
                    primary: e,
                    trickModeVideo: null,
                    dependencyStream: null,
                    emsgSchemeIdUris: null,
                    frameRate: void 0,
                    pixelAspectRatio: void 0,
                    width: void 0,
                    height: void 0,
                    bandwidth: void 0,
                    roles: r,
                    forced: l,
                    channelsCount: g,
                    audioSamplingRate: m,
                    spatialAudio: n,
                    closedCaptions: h,
                    hdr: void 0,
                    colorGamut: void 0,
                    videoLayout: void 0,
                    tilesLayout: void 0,
                    accessibilityPurpose: k,
                    external: false,
                    fastSwitching: false,
                    fullMimeTypes: new Set(),
                    isAudioMuxedInVideo: false,
                    baseOriginalId: null
                  };
                  Vz(a);
                  return a;
                }
                function oz(a, b, c, d, e) {
                  var f, g, h, k, l, m, n, q, r, u, v, w, z, y, B, D, I, C, A, E, J, H, K, L, O, Q, N, M, R;
                  return P(function (T) {
                    switch (T.g) {
                      case 1:
                        f = new Map();
                        if (!a.g.ignoreDrmInfo && b.segments) for (g = t(b.segments), h = g.next(); !h.done; h = g.next()) if (k = h.value, l = Jy(k.ea, "EXT-X-KEY"), m = null, l.length) for (m = nA(a, b, k.ea, d, e), n = t(l), q = n.next(); !q.done; q = n.next()) r = q.value, f.set(r, m);
                        v = u = false;
                        w = [];
                        z = new Set();
                        y = t(f);
                        B = y.next();
                      case 2:
                        if (B.done) {
                          T.A(4);
                          break;
                        }
                        D = B.value;
                        I = t(D);
                        C = I.next().value;
                        A = I.next().value;
                        E = C;
                        J = A;
                        H = Gy(E, "METHOD");
                        if (H == "NONE") {
                          T.A(3);
                          break;
                        }
                        u = true;
                        K = Fy(E, "KEYFORMAT") || "identity";
                        L = null;
                        if (Zz(H)) {
                          v = true;
                          T.A(3);
                          break;
                        }
                        if (K == "identity") return F(T, $z(a, E, c, d, J, e), 11);
                        O = a.uc.get(K);
                        if (!O) {
                          Q = null;
                          T.A(9);
                          break;
                        }
                        return F(T, O(E, c, J), 10);
                      case 10:
                        Q = T.h;
                      case 9:
                        L = Q;
                        T.A(6);
                        break;
                      case 11:
                        L = T.h;
                      case 6:
                        if (L) {
                          if (L.keyIds) for (N = t(L.keyIds), M = N.next(); !M.done; M = N.next()) R = M.value, z.add(R);
                          w.push(L);
                        }
                      case 3:
                        B = y.next();
                        T.A(2);
                        break;
                      case 4:
                        return T.return({
                          drmInfos: w,
                          keyIds: z,
                          encrypted: u,
                          Lh: v
                        });
                    }
                  });
                }
                function oA(a, b, c, d, e) {
                  if (!window.crypto || !window.crypto.subtle) throw ab("Web Crypto API is not available to decrypt AES. (Web Crypto only exists in secure origins like https)"), new U(2, 4, 4042);
                  var f = 0,
                    g = Fy(b, "IV", "");
                  if (g) {
                    var h = qc(g.substr(2));
                    if (h.byteLength != 16) throw new U(2, 4, 4048);
                  } else f = My(c.ea, "EXT-X-MEDIA-SEQUENCE", 0);
                  var k = Ny(d(), Gy(b, "URI"), e),
                    l = k.sort().join("");
                  c = b.toString() + "-" + f + "-" + l;
                  if (!a.va.has(c)) {
                    var m = {
                      bitsKey: 128,
                      blockCipherMode: "CBC",
                      iv: h,
                      firstMediaSequenceNumber: f
                    };
                    switch (Gy(b, "METHOD")) {
                      case "AES-256":
                        m.bitsKey = 256;
                        break;
                      case "AES-256-CTR":
                        m.bitsKey = 256, m.blockCipherMode = "CTR";
                    }
                    m.fetchKey = function () {
                      var n, q, r, u;
                      return P(function (v) {
                        if (v.g == 1) return a.O.has(l) || (n = Rg(k, a.g.retryParameters), q = Oz(a, n, 6).promise, a.O.set(l, q)), F(v, a.O.get(l), 2);
                        if (v.g != 3) {
                          r = v.h;
                          if (!r.data || r.data.byteLength != m.bitsKey / 8) throw new U(2, 4, 4049);
                          u = {
                            name: m.blockCipherMode == "CTR" ? "AES-CTR" : "AES-CBC",
                            length: m.bitsKey
                          };
                          return F(v, window.crypto.subtle.importKey("raw", r.data, u, true, ["decrypt"]), 3);
                        }
                        m.cryptoKey = v.h;
                        m.fetchKey = void 0;
                        G(v);
                      });
                    };
                    a.va.set(c, m);
                  }
                  return a.va.get(c);
                }
                function Hz(a, b) {
                  a.u == null && (b = Ly(b.ea, "EXT-X-START")) && (a.u = Number(Gy(b, "TIME-OFFSET")));
                }
                function lA(a, b) {
                  var c = Ly(b.ea, "EXT-X-PLAYLIST-TYPE");
                  b = Ly(b.ea, "EXT-X-ENDLIST");
                  b = c && c.value == "VOD" || b;
                  c = c && c.value == "EVENT" && !b;
                  c = !b && !c;
                  b ? kz(a, ez) : c ? kz(a, Pz) : kz(a, pA);
                }
                function rz(a, b) {
                  var c = Infinity,
                    d = b.segments;
                  if (d.length) for (var e = d.length - 1; e >= 0;) {
                    var f = Ly(d[e].ea, "EXTINF");
                    if (f) {
                      c = Number(f.value.split(",")[0]);
                      break;
                    }
                    e--;
                  }
                  d = Ly(b.ea, "EXT-X-TARGETDURATION");
                  if (!d) throw new U(2, 4, 4024, "EXT-X-TARGETDURATION");
                  d = Number(d.value);
                  if (e = Ly(b.ea, "EXT-X-PART-INF")) a.T = Number(Gy(e, "PART-TARGET"));
                  b = Ly(b.ea, "EXT-X-SERVER-CONTROL");
                  a.qa && a.T ? (a.o = a.xc ? a.T * 5 <= c ? Math.min(a.T, a.o) : Math.min(c, a.o) : Math.min(a.T, a.o), a.ab = b ? Number(Gy(b, "PART-HOLD-BACK")) : 0) : (a.o = Math.min(c, a.o), c = b ? Ey(b, "HOLD-BACK") : null, a.Sa = c ? Number(c.value) : 0);
                  a.ib = Math.max(d, a.ib);
                }
                function Iz(a, b) {
                  var c = 0;
                  if (a.g.defaultPresentationDelay) c = a.g.defaultPresentationDelay;else if (a.ab) c = a.ab;else if (a.Sa) c = a.Sa;else for (var d = b.segments.length, e = d - Math.min(d, a.g.hls.liveSegmentsDelay); e < d; e++) {
                    var f = Ly(b.segments[e].ea, "EXTINF");
                    c = f ? c + Number(f.value.split(",")[0]) : c + a.ib;
                  }
                  a.u && a.u < 0 && (c = Math.min(-a.u, c), a.u += c);
                  a.l.Ri(0);
                  a.l.nh(c);
                  a.l.cd(false);
                }
                function nA(a, b, c, d, e) {
                  var f = Ly(c, "EXT-X-MAP");
                  if (!f) return null;
                  var g = Gy(f, "URI"),
                    h = Ny(d(), g, e);
                  g = [h.toString(), Fy(f, "BYTERANGE", "")].join("-");
                  if (!a.Da.has(g)) {
                    var k = void 0,
                      l = null,
                      m = false;
                    c = t(c);
                    for (var n = c.next(); !n.done; n = c.next()) n = n.value, n.name == "EXT-X-KEY" ? (m = Gy(n, "METHOD"), Zz(m) && n.id < f.id ? (m = false, k = oA(a, n, b, d, e)) : m = m != "NONE") : n.name == "EXT-X-BYTERANGE" && n.id < f.id && (l = n);
                    b = qA(h, f, l, k, m);
                    a.Da.set(g, b);
                  }
                  return a.Da.get(g);
                }
                function qA(a, b, c, d, e) {
                  var f = 0,
                    g = null;
                  b = Fy(b, "BYTERANGE");
                  !b && c && (b = c.value);
                  b && (f = b.split("@"), g = Number(f[0]), f = Number(f[1]), g = f + g - 1, d && (c = g + 1 - f, c % 16 && (g += 16 - c % 16)));
                  return new pj(function () {
                    return a;
                  }, f, g, null, null, null, d, e);
                }
                function rA(a, b, c, d, e, f, g, h, k, l) {
                  var m = d.ea,
                    n = Ly(m, "EXTINF"),
                    q = 0,
                    r = 0,
                    u = null;
                  d.vc.length && (a.m.isLowLatency = true);
                  var v = null;
                  if (c && c.h) v = c.h + c.endTime - c.startTime;else if (!a.g.hls.ignoreManifestProgramDateTime) {
                    var w = Ly(m, "EXT-X-PROGRAM-DATE-TIME");
                    w && w.value && (v = Dd(w.value), a.kb = true);
                  }
                  var z = sj;
                  Ly(m, "EXT-X-GAP") && (a.m.gapCount++, z = 2);
                  if (!n) {
                    if (d.vc.length == 0) throw new U(2, 4, 4024, "EXTINF");
                    if (!a.qa) return null;
                  }
                  var y = [];
                  w = false;
                  var B = null,
                    D = false,
                    I = false;
                  if (a.qa && d.vc.length) {
                    q = b && window.ReadableStream && a.g.hls.allowLowLatencyByteRangeOptimization;
                    for (var C = v, A = {}, E = 0; E < d.vc.length; A = {
                      Qf: void 0,
                      ke: void 0
                    }, E++) {
                      var J = d.vc[E],
                        H = E == 0 ? c : y[y.length - 1],
                        K = E == 0 ? e : H.endTime,
                        L = Number(Fy(J, "DURATION")) || a.T;
                      if (L) {
                        var O = K + L,
                          Q = 0,
                          N = null;
                        J.name == "EXT-X-PRELOAD-HINT" ? (Q = (Q = Fy(J, "BYTERANGE-START")) ? Number(Q) : 0, (H = Fy(J, "BYTERANGE-LENGTH")) ? N = Q + Number(H) - 1 : Q && (N = Number.MAX_SAFE_INTEGER)) : (Q = Fy(J, "BYTERANGE"), N = t(sA(H, Q)), Q = N.next().value, N = N.next().value);
                        A.ke = Fy(J, "URI");
                        if (A.ke) {
                          H = sj;
                          Fy(J, "GAP") == "YES" && (a.m.gapCount++, H = 2, D = true);
                          A.Qf = null;
                          var M = function (T) {
                            return function () {
                              T.Qf == null && (T.Qf = Ny(h(), T.ke, f));
                              return T.Qf;
                            };
                          }(A);
                          q && Q >= 0 && N != null && (B = M, w = true);
                          K = new rj(K, O, M, Q, N, b, 0, 0, Infinity, [], "", null, C, H, l);
                          J.name == "EXT-X-PRELOAD-HINT" && (K.Qg(), I = true);
                          Fy(J, "INDEPENDENT") != "YES" && E > 0 && K.wd();
                          J = k;
                          J || (y.length && y[0].mimeType ? J = y[0].mimeType : A.ke && (A = Oo(A.ke), J = tA.get(g).get(A) || null));
                          J && (K.mimeType = J, uA.has(J) && (K.ba = null));
                          y.push(K);
                          C && (C += L);
                        }
                      }
                    }
                  }
                  if (n) {
                    n = Number(n.value.split(",")[0]);
                    if (n == 0) return null;
                    q = e + n;
                  } else if (y.length) q = y[y.length - 1].endTime;else return null;
                  w && (D || y[0].startByte != 0 ? (w = false, B = null) : y = []);
                  (n = Ly(m, "EXT-X-BYTERANGE")) ? (u = t(sA(c, n.value)), r = u.next().value, u = u.next().value) : y.length && (r = y[0].startByte, u = y[y.length - 1].endByte);
                  c = "";
                  n = null;
                  g == "image" && (c = "1x1", g = Ly(m, "EXT-X-TILES")) && (c = Gy(g, "LAYOUT"), (g = Fy(g, "DURATION")) && (n = Number(g)));
                  var R = null;
                  b = new rj(e, q, function () {
                    if (B) return B();
                    R == null && (R = Ny(h(), d.g, f));
                    return R || [];
                  }, r, u, b, 0, 0, Infinity, y, c, n, v, z, l, y.length > 0 && !!d.g);
                  k && (b.mimeType = k, uA.has(k) && (b.ba = null));
                  w && (a.xc = true, b.pi(), I && b.Qg());
                  return b;
                }
                function sA(a, b) {
                  var c = 0,
                    d = null;
                  b && (c = b.split("@"), b = Number(c[0]), c = c[1] ? Number(c[1]) : a.endByte + 1, d = c + b - 1);
                  return [c, d];
                }
                function sz(a, b, c, d, e) {
                  if (c == "video" || c == "audio") {
                    var f = a.l.m;
                    if (f && !uz(a, c)) for (b = Jy(b, "EXT-X-DATERANGE"), b = b.filter(function (H) {
                      return Ey(H, "START-DATE") != null;
                    }).sort(function (H, K) {
                      H = Gy(H, "START-DATE");
                      K = Gy(K, "START-DATE");
                      return H < K ? -1 : H > K ? 1 : 0;
                    }), c = 0; c < b.length; c++) {
                      var g = b[c];
                      try {
                        var h = Gy(g, "START-DATE"),
                          k = Dd(h);
                        if (!isNaN(k)) {
                          var l = Math.max(0, k - f),
                            m = null,
                            n = Fy(g, "END-DATE");
                          if (n) {
                            var q = Dd(n);
                            if (!isNaN(q) && (m = q - f, m < 0)) continue;
                          }
                          if (m == null) {
                            var r = Fy(g, "DURATION") || Fy(g, "PLANNED-DURATION");
                            if (r) {
                              var u = parseFloat(r);
                              isNaN(u) || (m = l + u);
                              if (k - f + u < 0) continue;
                            }
                          }
                          var v = Fy(g, "CLASS") || "com.apple.quicktime.HLS",
                            w = Fy(g, "END-ON-NEXT") == "YES";
                          if (m == null && w) {
                            for (var z = c + 1; z < b.length; z++) {
                              var y = Fy(b[z], "CLASS") || "com.apple.quicktime.HLS";
                              if (v == y) {
                                var B = Gy(b[z], "START-DATE"),
                                  D = Dd(B);
                                if (!isNaN(D) && D && D > k) {
                                  m = Math.max(0, D - f);
                                  break;
                                }
                              }
                            }
                            if (m == null) continue;
                          }
                          z = ["CLASS", "START-DATE", "END-DATE", "DURATION", "END-ON-NEXT"];
                          for (var I = [], C = t(g.attributes), A = C.next(); !A.done; A = C.next()) {
                            var E = A.value;
                            if (!z.includes(E.name)) {
                              var J = Py(E.value, d);
                              if (E.name == "X-ASSET-URI" || E.name == "X-ASSET-LIST") J = Ny(e(), E.value, d)[0];
                              I.push({
                                key: E.name,
                                description: "",
                                data: J,
                                mimeType: null,
                                pictureType: null
                              });
                            }
                          }
                          if (I.length > 1) a.h.onMetadata(v, l, m, I);
                        }
                      } catch (H) {}
                    }
                  }
                }
                function pz(a, b, c, d, e, f) {
                  function g(H) {
                    H = Oo(H);
                    if (!H) return null;
                    var K = tA.get(f).get(H);
                    K || (K = Mz.get(H));
                    return K;
                  }
                  var h = b.segments,
                    k = null,
                    l = null,
                    m = null,
                    n = null,
                    q = void 0,
                    r = My(b.ea, "EXT-X-DISCONTINUITY-SEQUENCE", -1),
                    u = My(b.ea, "EXT-X-MEDIA-SEQUENCE", 0),
                    v = Ly(b.ea, "EXT-X-SKIP"),
                    w = v ? Number(Fy(v, "SKIPPED-SEGMENTS")) : 0,
                    z = u + w,
                    y = 0;
                  hz(a) && c.has(z) && (y = c.get(z));
                  y === 0 && a.Fa == Pz && c.size > 0 && !c.has(z) && a.l.i != null && (y = a.l.Hb());
                  var B = [],
                    D = null;
                  v = [];
                  for (var I = 0; I < h.length; I++) {
                    var C = h[I];
                    (z = Ly(C.ea, "EXT-X-MAP")) && z.id !== l && (k = nA(a, b, C.ea, e, d), l = z.id);
                    z = C.g;
                    var A = "";
                    z && (A = Oo(z));
                    A !== n && (m = g(z), n = A);
                    A = I == 0 ? y : D.endTime;
                    z = u + w + I;
                    Ly(C.ea, "EXT-X-DISCONTINUITY") && (r++, D && D.ba && (D.ba.g = A));
                    for (var E = t(C.ea), J = E.next(); !J.done; J = E.next()) J = J.value, J.name == "EXT-X-KEY" && (Zz(Gy(J, "METHOD")) ? q = oA(a, J, b, e, d) : q = void 0);
                    c.set(z, A);
                    if (A = rA(a, k, D, C, A, d, f, e, m, q)) {
                      if (D = My(C.ea, "EXT-X-BITRATE")) v.push({
                        bitrate: D,
                        duration: A.endTime - A.startTime
                      }), A.bandwidth = D;else if (A.endByte) {
                        if (C = tj(A)) D = A.endTime - A.startTime, C = C * 8 / D / 1E3, v.push({
                          bitrate: C,
                          duration: D
                        }), A.bandwidth = C;
                      } else v.length && (D = v.pop(), D.duration += A.endTime - A.startTime, v.push(D), A.bandwidth = D.bitrate);
                      if (A.bandwidth) for (D = t(A.g), C = D.next(); !C.done; C = D.next()) C.value.bandwidth = A.bandwidth;
                      D = A;
                      A.i = r;
                      uz(a, f) && a.N != null && z < a.N || B.push(A);
                    }
                  }
                  b = void 0;
                  v.length && (b = v.reduce(function (H, K) {
                    return H + K.duration;
                  }, 0), b = Math.round(v.reduce(function (H, K) {
                    return H + K.bitrate * K.duration;
                  }, 0) / b * 1E3));
                  if (v = B.some(function (H) {
                    return H.h != null;
                  })) for (c = {}, d = 0; d < B.length; c = {
                    We: void 0,
                    Ve: void 0,
                    Oe: void 0,
                    Zc: void 0,
                    Ne: void 0
                  }, d++) if (c.Zc = B[d], c.Zc.h == null) for (c.Ve = 0, c.We = d, e = function (H) {
                    return function () {
                      var K = B[H.We];
                      if (K) {
                        if (K.h != null) return K.h + H.Ve;
                        H.Ve -= K.endTime - K.startTime;
                        H.We += 1;
                      }
                      return null;
                    };
                  }(c), c.Ne = 0, c.Oe = d, h = function (H) {
                    return function () {
                      var K = B[H.Oe];
                      if (K) {
                        K != H.Zc && (H.Ne += K.endTime - K.startTime);
                        if (K.h != null) return K.h + H.Ne;
                        --H.Oe;
                      }
                      return null;
                    };
                  }(c); c.Zc.h == null;) c.Zc.h = h(), c.Zc.h == null && (c.Zc.h = e());
                  if (v) for (c = t(B), d = c.next(); !d.done; d = c.next()) for (e = d.value, d = e.h, e = t(e.g), h = e.next(); !h.done; h = e.next()) h = h.value, h.h = d, d += h.endTime - h.startTime;
                  c = a.ma;
                  if (v && c != Infinity && !uz(a, f)) for (a = t(B), v = a.next(); !v.done; v = a.next()) v.value.yh(c);
                  return {
                    segments: B,
                    bandwidth: b
                  };
                }
                function Tz(a, b) {
                  if (a == Ac) {
                    if (b == "vtt" || b == "wvtt") return "text/vtt";
                    if (b && b !== "") return "application/mp4";
                  }
                  return a != "image" || b && b != "jpeg" ? a == "audio" && b == "mp4a.40.34" ? "audio/mpeg" : b == "mjpg" ? "application/mp4" : null : "image/jpeg";
                }
                function Uz(a) {
                  return a == Ac ? "text/vtt" : tA.get(a).get("mp4");
                }
                function Lz(a, b) {
                  a = hz(a) ? Math.trunc((b.length - 1) / 2) : 0;
                  for (var c = b[a]; c.Jc() == 2 && a + 1 < b.length;) a++, c = b[a];
                  return {
                    segment: c,
                    segmentIndex: a
                  };
                }
                function mA(a, b, c, d) {
                  var e, f, g, h, k, l, m, n, q, r, u, v, w;
                  return P(function (z) {
                    switch (z.g) {
                      case 1:
                        e = Xg;
                        f = Lz(a, d);
                        g = f.segment;
                        if (g.status == 2) return z.return(Uz(b));
                        k = g.P();
                        if (l = Oo(k[0])) if (m = tA.get(b), (n = m.get(l)) || (n = Mz.get(l))) return z.return(n);
                        if (h = Tz(b, c)) return z.return(h);
                        r = 1;
                        u = Rg(k, a.g.retryParameters);
                        ua(z, 2);
                        u.method = "HEAD";
                        return F(z, Oz(a, u, e, {
                          type: r
                        }).promise, 4);
                      case 4:
                        v = z.h;
                        q = v.headers["content-type"];
                        xa(z, 3);
                        break;
                      case 2:
                        w = ya(z);
                        if (!w || w.code != 1002 && w.code != 1001) {
                          z.A(3);
                          break;
                        }
                        u.method = "GET";
                        a.g.hls.allowRangeRequestsToGuessMimeType && (u.headers.Range = "bytes=0-0");
                        return F(z, Oz(a, u, e, {
                          type: r
                        }).promise, 6);
                      case 6:
                        v = z.h, q = v.headers["content-type"];
                      case 3:
                        if (!q) {
                          z.A(7);
                          break;
                        }
                        h = q.toLowerCase().split(";")[0];
                        if (h != "application/octet-stream") {
                          z.A(8);
                          break;
                        }
                        if (v.data.byteLength) {
                          z.A(9);
                          break;
                        }
                        u.method = "GET";
                        return F(z, Oz(a, u, e, {
                          type: r
                        }).promise, 10);
                      case 10:
                        v = z.h;
                      case 9:
                        mk(Vb(v.data)) && (h = "video/mp2t");
                      case 8:
                        if (h != "application/octet-stream") return z.return(h);
                      case 7:
                        return z.return(Uz(b));
                    }
                  });
                }
                function hA(a, b, c, d, e, f, g) {
                  a && (a.width = Number(b) || void 0, a.height = Number(c) || void 0, a.frameRate = Number(d) || void 0, a.hdr = e || void 0, a.videoLayout = f || void 0, a.colorGamut = g || void 0);
                }
                function fz(a, b, c) {
                  return Oz(a, Rg(b, a.g.retryParameters), 0, {
                    type: c ? 2 : 3
                  });
                }
                function dz(a) {
                  var b, c, d, e, f, g;
                  return P(function (h) {
                    switch (h.g) {
                      case 1:
                        if (!a.h) return h.return();
                        ua(h, 2);
                        b = Date.now();
                        return F(h, a.update(), 4);
                      case 4:
                        c = Date.now();
                        hz(a) && (d = (c - b) / 1E3, a.Zb.sample(1, d), e = a.g.updatePeriod > 0 ? a.g.updatePeriod : a.o, f = Math.max(0, e - Wa(a.Zb)), a.F.ia(f));
                        xa(h, 3);
                        break;
                      case 2:
                        g = ya(h);
                        if (!a.h) return h.return();
                        if (a.g.raiseFatalErrorOnManifestUpdateRequestFailure) return a.h.onError(g), h.return();
                        g.severity = 1;
                        a.h.onError(g);
                        a.F.ia(.1);
                      case 3:
                        if (!a.h) return h.return();
                        a.h.onManifestUpdated();
                        G(h);
                    }
                  });
                }
                function hz(a) {
                  return a.Fa != ez;
                }
                function kz(a, b) {
                  a.Fa = b;
                  a.l && a.l.cd(!hz(a));
                  hz(a) || a.F.stop();
                }
                function Oz(a, b, c, d) {
                  if (!a.$) throw new U(2, 7, 7001);
                  d || (d = {});
                  d.isPreload = a.ac();
                  b = a.h.networkingEngine.request(c, b, d);
                  Lg(a.$, b);
                  return b;
                }
                function Zz(a) {
                  return a == "AES-128" || a == "AES-256" || a == "AES-256-CTR";
                }
                function cz(a, b, c, d) {
                  var e, f, g, h, k, l;
                  return P(function (m) {
                    if (m.g == 1) {
                      if (c == "video/mp2t") throw new U(2, 4, 4040);
                      if ("apple" === window.shakaMediaKeysPolyfill) throw new U(2, 4, 4041);
                      e = Gy(b, "METHOD");
                      f = ["SAMPLE-AES", "SAMPLE-AES-CTR"];
                      if (!f.includes(e)) return m.return(null);
                      g = "cenc";
                      e == "SAMPLE-AES" && (g = "cbcs");
                      h = Gy(b, "URI");
                      k = vc("com.apple.fps", g, [{
                        initDataType: "sinf",
                        initData: new Uint8Array(0),
                        keyId: null
                      }], h);
                      var n = new Db(h).Db.replace(/-/g, "").toLowerCase();
                      return (l = n.length === 32 && /^[0-9a-f]+$/.test(n) ? n : null) || !d ? m.A(2) : F(m, vA(a, d), 3);
                    }
                    m.g != 2 && (l = m.h);
                    l && k.keyIds.add(l);
                    return m.return(k);
                  });
                }
                function $z(a, b, c, d, e, f) {
                  var g, h, k, l, m, n, q, r, u, v, w, z;
                  return P(function (y) {
                    switch (y.g) {
                      case 1:
                        if (c == "video/mp2t") throw new U(2, 4, 4040);
                        if ("apple" === window.shakaMediaKeysPolyfill) throw new U(2, 4, 4041);
                        g = Gy(b, "METHOD");
                        h = ["SAMPLE-AES", "SAMPLE-AES-CTR"];
                        if (!h.includes(g)) return y.return(null);
                        k = Ny(d(), Gy(b, "URI"), f);
                        if (k[0].startsWith("data:text/plain;base64,")) {
                          l = rc(pc(k[0].split("data:text/plain;base64,").pop()));
                          y.A(2);
                          break;
                        }
                        m = k.sort().join("");
                        a.xa.has(m) || (n = Rg(k, a.g.retryParameters), q = Oz(a, n, 6).promise, a.xa.set(m, q));
                        return F(y, a.xa.get(m), 3);
                      case 3:
                        r = y.h, l = rc(r.data);
                      case 2:
                        u = "00000000000000000000000000000000";
                        if (!e) {
                          y.A(4);
                          break;
                        }
                        return F(y, vA(a, e), 5);
                      case 5:
                        (v = y.h) && (u = v);
                      case 4:
                        return w = new Map(), w.set(u, l), z = "cenc", g == "SAMPLE-AES" && (z = "cbcs"), y.return(wc(w, z));
                    }
                  });
                }
                function vA(a, b) {
                  var c, d, e, f;
                  return P(function (g) {
                    if (g.g == 1) {
                      c = null;
                      if (a.ya.has(b)) return c = a.ya.get(b), g.A(2);
                      d = xm(b.P(), b.Ic(), b.Gc(), a.g.retryParameters);
                      e = Xg;
                      return F(g, Oz(a, d, e, {
                        type: 0
                      }).promise, 3);
                    }
                    g.g != 2 && (f = g.h, b.pe(f.data), c = vm(f.data), a.ya.set(b, c));
                    return g.return(c);
                  });
                }
                S("shaka.hls.HlsParser", bz);
                var Mz = new Map().set("aac", "audio/aac").set("ac3", "audio/ac3").set("ec3", "audio/ec3").set("mp3", "audio/mpeg"),
                  wA = new Map().set("mp4", "audio/mp4").set("mp4a", "audio/mp4").set("m4s", "audio/mp4").set("m4i", "audio/mp4").set("m4a", "audio/mp4").set("m4f", "audio/mp4").set("cmfa", "audio/mp4").set("ts", "video/mp2t").set("tsa", "video/mp2t"),
                  xA = new Map().set("mp4", "video/mp4").set("mp4v", "video/mp4").set("m4s", "video/mp4").set("m4i", "video/mp4").set("m4v", "video/mp4").set("m4f", "video/mp4").set("cmfv", "video/mp4").set("ts", "video/mp2t").set("tsv", "video/mp2t"),
                  yA = new Map().set("mp4", "application/mp4").set("m4s", "application/mp4").set("m4i", "application/mp4").set("m4f", "application/mp4").set("cmft", "application/mp4").set("vtt", "text/vtt").set("webvtt", "text/vtt").set("ttml", "application/ttml+xml"),
                  zA = new Map().set("jpg", "image/jpeg").set("png", "image/png").set("svg", "image/svg+xml").set("webp", "image/webp").set("avif", "image/avif"),
                  tA = new Map().set("audio", wA).set("video", xA).set("text", yA).set("image", zA),
                  uA = new Set(["video/mp2t"].concat(x(Ge))),
                  ez = "VOD",
                  pA = "EVENT",
                  Pz = "LIVE";
                vi("application/x-mpegurl", function () {
                  return new bz();
                });
                vi("application/vnd.apple.mpegurl", function () {
                  return new bz();
                });
                function AA(a) {
                  return sv(a);
                }
                var BA = new Map().set("com.microsoft.playready", AA).set("com.microsoft.playready.recommendation", AA).set("com.microsoft.playready.software", AA).set("com.microsoft.playready.hardware", AA);
                function CA() {
                  var a = this;
                  this.h = this.g = null;
                  this.l = [];
                  this.j = null;
                  this.u = 1;
                  this.i = null;
                  this.F = new Va(5);
                  this.o = new df(function () {
                    DA(a);
                  });
                  this.C = new Kg();
                  this.m = new Map();
                  this.B = function () {
                    return false;
                  };
                }
                p = CA.prototype;
                p.configure = function (a, b) {
                  this.g = a;
                  b && (this.B = b);
                };
                p.start = function (a, b) {
                  var c = this;
                  return P(function (d) {
                    if (d.g == 1) return c.l = [a], c.h = b, F(d, EA(c), 2);
                    if (!c.h) throw new U(2, 7, 7001);
                    return d.return(c.j);
                  });
                };
                function DA(a) {
                  var b;
                  P(function (c) {
                    switch (c.g) {
                      case 1:
                        return ua(c, 2), F(c, EA(a), 4);
                      case 4:
                        xa(c, 3);
                        break;
                      case 2:
                        b = ya(c), a.h && (b.severity = 1, a.h.onError(b));
                      case 3:
                        if (!a.h) return c.return();
                        G(c);
                    }
                  });
                }
                p.stop = function () {
                  this.g = this.h = null;
                  this.l = [];
                  this.j = null;
                  this.o != null && (this.o.stop(), this.o = null);
                  this.m.clear();
                  return this.C.destroy();
                };
                p.update = function () {
                  var a = this,
                    b;
                  return P(function (c) {
                    if (c.g == 1) return ua(c, 2), F(c, EA(a), 4);
                    if (c.g != 2) return xa(c, 0);
                    b = ya(c);
                    if (!a.h || !b) return c.return();
                    a.h.onError(b);
                    G(c);
                  });
                };
                p.onExpirationUpdated = function () {};
                p.onInitialVariantChosen = function () {};
                p.banLocation = function () {};
                p.setMediaElement = function () {};
                function EA(a) {
                  var b, c, d, e, f, g, h;
                  return P(function (k) {
                    if (k.g == 1) return b = Rg(a.l, a.g.retryParameters), c = a.h.networkingEngine, d = Date.now(), e = c.request(0, b, {
                      type: 5,
                      isPreload: a.B()
                    }), Lg(a.C, e), F(k, e.promise, 2);
                    f = k.h;
                    if (!a.h) return k.return();
                    f.uri && !a.l.includes(f.uri) && a.l.unshift(f.uri);
                    var l = f.uri,
                      m = f.data,
                      n = a.g.mss.manifestPreprocessor;
                    if (n != On) {
                      yb("manifest.mss.manifestPreprocessor configuration", "Please Use manifest.mss.manifestPreprocessorTXml instead.");
                      m = wx(m, "SmoothStreamingMedia");
                      if (!m) throw new U(2, 4, 4046, l);
                      n(m);
                      m = ic(m.outerHTML);
                    }
                    var q = jd(m, "SmoothStreamingMedia");
                    if (!q) throw new U(2, 4, 4046, l);
                    l = a.g.mss.manifestPreprocessorTXml;
                    l != Pn && l(q);
                    a.i || (a.i = new ol(null, 0));
                    if (l = Ad(q, "IsLive", Kd, false)) throw new U(2, 4, 4047);
                    a.i.cd(!l);
                    n = Ad(q, "TimeScale", Id, 1E7);
                    m = Ad(q, "DVRWindowLength", Id);
                    l && (m === 0 || isNaN(m)) && (m = Infinity);
                    var r = Ad(q, "CanSeek", Kd, false);
                    m === 0 && r && (m = Infinity);
                    r = null;
                    m && m > 0 && (r = m / n);
                    l && !isNaN(a.g.availabilityWindowOverride) && (r = a.g.availabilityWindowOverride);
                    r == null && (r = Infinity);
                    a.i.Hf(r);
                    m = Ad(q, "Duration", Id, Infinity);
                    l || a.i.Ab(m / n);
                    l = {
                      variants: [],
                      textStreams: [],
                      timescale: n,
                      duration: m / n
                    };
                    var u;
                    r = td(q, "Protection");
                    n = a.g.mss.keySystemsBySystemId;
                    m = [];
                    r = t(r);
                    for (u = r.next(); !u.done; u = r.next()) m = m.concat(td(u.value, "ProtectionHeader"));
                    if (m.length) {
                      r = [];
                      for (u = 0; u < m.length; u++) {
                        var v = m[u],
                          w = v.attributes.SystemID.toLowerCase(),
                          z = n[w];
                        if (z) {
                          var y;
                          a: {
                            if (y = qv(v)) {
                              y = t(wd(y, "DATA"));
                              for (var B = y.next(); !B.done; B = y.next()) if (B = xd(B.value, "KID")) {
                                y = pc(ud(B));
                                y = new Uint8Array([y[3], y[2], y[1], y[0], y[5], y[4], y[7], y[6]].concat(x(y.slice(8))));
                                y = rc(y);
                                break a;
                              }
                            }
                            y = null;
                          }
                          B = pc(ud(v));
                          w = qc(w.replace(/-/g, ""));
                          w = [{
                            initData: uh(B, w, new Set(), 0),
                            initDataType: "cenc",
                            keyId: y
                          }];
                          w = vc(z, "cenc", w);
                          y && w.keyIds.add(y);
                          if (z = BA.get(z)) w.licenseServerUri = z(v);
                          r.push(w);
                        }
                      }
                      n = r;
                    } else n = [];
                    u = n;
                    r = [];
                    n = [];
                    m = [];
                    q = td(q, "StreamIndex");
                    q = t(q);
                    for (v = q.next(); !v.done; v = q.next()) {
                      v = v.value;
                      z = td(v, "QualityLevel");
                      w = l.timescale;
                      y = l.duration;
                      B = td(v, "c");
                      for (var D = [], I = 0, C = 0; C < B.length; ++C) {
                        var A = B[C],
                          E = B[C + 1],
                          J = Ad(A, "t", Id),
                          H = Ad(A, "d", Id);
                        A = Ad(A, "r", Gd);
                        if (!H) break;
                        J = J != null ? J : I;
                        (A = A || 0) && A--;
                        if (A < 0) if (E) {
                          E = Ad(E, "t", Id);
                          if (E == null) break;else if (J >= E) break;
                          A = Math.ceil((E - J) / H) - 1;
                        } else {
                          if (y == Infinity) break;else if (J / w >= y) break;
                          A = Math.ceil((y * w - J) / H) - 1;
                        }
                        for (E = 0; E <= A; ++E) I = J + H, D.push({
                          start: J / w,
                          end: I / w,
                          Eh: J
                        }), J = I;
                      }
                      w = D;
                      z = t(z);
                      for (y = z.next(); !y.done; y = z.next()) (y = FA(a, v, y.value, w, u, l)) && (y.type != "audio" || a.g.disableAudio ? y.type != "video" || a.g.disableVideo ? y.type != Ac || a.g.disableText || m.push(y) : n.push(y) : r.push(y));
                    }
                    q = [];
                    r = t(r.length > 0 ? r : [null]);
                    for (u = r.next(); !u.done; u = r.next()) for (u = u.value, v = t(n.length > 0 ? n : [null]), D = v.next(); !D.done; D = v.next()) z = q, w = z.push, y = a, B = u, D = D.value, C = 0, B && B.bandwidth && B.bandwidth > 0 && (C += B.bandwidth), D && D.bandwidth && D.bandwidth > 0 && (C += D.bandwidth), y = {
                      id: y.u++,
                      language: B ? B.language : "und",
                      disabledUntilTime: 0,
                      primary: !!B && B.primary || !!D && D.primary,
                      audio: B,
                      video: D,
                      bandwidth: C,
                      allowedByApplication: true,
                      allowedByKeySystem: true,
                      decodingInfos: []
                    }, w.call(z, y);
                    l.variants = q;
                    l.textStreams = m;
                    a.j ? (a.j.variants = l.variants, a.j.textStreams = l.textStreams, a.h.filter(a.j)) : (a.j = {
                      presentationTimeline: a.i,
                      variants: l.variants,
                      textStreams: l.textStreams,
                      imageStreams: [],
                      offlineSessionIds: [],
                      sequenceMode: a.g.mss.sequenceMode,
                      ignoreManifestTimestampsInSegmentsMode: false,
                      type: "MSS",
                      serviceDescription: null,
                      nextUrl: null,
                      periodCount: 1,
                      gapCount: 0,
                      isLowLatency: false,
                      startTime: null
                    }, a.i.lf());
                    Promise.resolve();
                    g = Date.now();
                    h = (g - d) / 1E3;
                    a.F.sample(1, h);
                    G(k);
                  });
                }
                function FA(a, b, c, d, e, f) {
                  var g = b.attributes.Type;
                  if (g !== "audio" && g !== "video" && g !== "text") return ab("Ignoring unrecognized type:", g), null;
                  var h = b.attributes.Language,
                    k = a.u++,
                    l = Ad(c, "Bitrate", Hd),
                    m = Ad(c, "MaxWidth", Hd),
                    n = Ad(c, "MaxHeight", Hd),
                    q = Ad(c, "Channels", Hd),
                    r = Ad(c, "SamplingRate", Hd),
                    u = f.duration;
                  d.length && (u = d[d.length - 1].end - d[0].start);
                  var v = a.i.getDuration();
                  a.i.Ab(Math.min(u, v));
                  (v = b.attributes.Name) && (v += c.attributes.Index);
                  v || (v = String(k));
                  var w = {
                    id: k,
                    originalId: v,
                    groupId: null,
                    createSegmentIndex: function createSegmentIndex() {
                      return Promise.resolve();
                    },
                    closeSegmentIndex: function closeSegmentIndex() {
                      return Promise.resolve();
                    },
                    segmentIndex: null,
                    mimeType: "",
                    codecs: "",
                    frameRate: void 0,
                    pixelAspectRatio: void 0,
                    bandwidth: l || 0,
                    width: m || void 0,
                    height: n || void 0,
                    kind: "",
                    encrypted: e.length > 0,
                    drmInfos: e,
                    keyIds: new Set(),
                    language: lf(h || "und"),
                    originalLanguage: h,
                    label: "",
                    type: "",
                    primary: false,
                    trickModeVideo: null,
                    dependencyStream: null,
                    emsgSchemeIdUris: [],
                    roles: [],
                    forced: false,
                    channelsCount: q,
                    audioSamplingRate: r,
                    spatialAudio: false,
                    closedCaptions: null,
                    hdr: void 0,
                    colorGamut: void 0,
                    videoLayout: void 0,
                    tilesLayout: void 0,
                    matchedStreams: [],
                    mssPrivateData: {
                      duration: u,
                      timescale: f.timescale,
                      codecPrivateData: null
                    },
                    accessibilityPurpose: null,
                    external: false,
                    fastSwitching: false,
                    fullMimeTypes: new Set(),
                    isAudioMuxedInVideo: false,
                    baseOriginalId: null
                  };
                  if (e = b.attributes.Subtype) (e = GA.get(e)) && w.roles.push(e), e === "main" && (w.primary = true);
                  e = c.attributes.FourCC;
                  if (e === null || e === "") e = b.attributes.FourCC;
                  if (!e) if (g === "audio") e = "AAC";else if (g === "video") return ab('FourCC is not defined whereas it is required for a QualityLevel element for a StreamIndex of type "video"'), null;
                  if (!HA.includes(e.toUpperCase())) return ab("Codec not supported:", e), null;
                  c = IA(c, g, e, w);
                  w.mssPrivateData.codecPrivateData = c;
                  switch (g) {
                    case "audio":
                      if (!c) return ab("Quality unsupported without CodecPrivateData", g), null;
                      w.type = "audio";
                      w.mimeType = "mss/audio/mp4";
                      w.codecs = JA(e, c);
                      break;
                    case "video":
                      if (!c) return ab("Quality unsupported without CodecPrivateData", g), null;
                      w.type = "video";
                      w.mimeType = "mss/video/mp4";
                      w.codecs = KA(c);
                      break;
                    case "text":
                      if (w.type = Ac, w.mimeType = "application/mp4", e === "TTML" || e === "DFXP") w.codecs = "stpp";
                  }
                  w.fullMimeTypes.add(Fe(w.mimeType, w.codecs));
                  w.createSegmentIndex = function () {
                    if (w.segmentIndex) return Promise.resolve();
                    if (a.m.has(w.id)) var z = a.m.get(w.id);else z = [], w.type == "video" && (z = w.mssPrivateData.codecPrivateData.split("00000001").slice(1)), z = {
                      id: w.id,
                      type: w.type,
                      codecs: w.codecs,
                      encrypted: w.encrypted,
                      timescale: w.mssPrivateData.timescale,
                      duration: w.mssPrivateData.duration,
                      Bb: z,
                      Ga: new Uint8Array([]),
                      Ra: new Uint8Array([]),
                      Za: 0,
                      $a: 0,
                      data: null,
                      stream: w
                    }, z = Li(new Ki([z])), a.m.set(w.id, z);
                    z = LA(a, new pj(function () {
                      return [];
                    }, 0, null, bm(w), w.mssPrivateData.timescale, z, null, w.encrypted), w, b, d);
                    w.segmentIndex = new Nl(z);
                    return Promise.resolve();
                  };
                  w.closeSegmentIndex = function () {
                    w.segmentIndex && (w.segmentIndex.release(), w.segmentIndex = null);
                  };
                  return w;
                }
                function IA(a, b, c, d) {
                  if (a = a.attributes.CodecPrivateData) return a;
                  if (b !== "audio") return null;
                  b = d.channelsCount || 2;
                  a = d.audioSamplingRate || 44100;
                  var e = {
                    96E3: 0,
                    88200: 1,
                    64E3: 2,
                    48E3: 3,
                    44100: 4,
                    32E3: 5,
                    24E3: 6,
                    22050: 7,
                    16E3: 8,
                    12E3: 9,
                    11025: 10,
                    8E3: 11,
                    7350: 12
                  };
                  d = e[a];
                  if (c === "AACH") return c = new Uint8Array(4), a = e[a * 2], c[0] = 40 | d >> 1, c[1] = d << 7 | b << 3 | a >> 1, c[2] = a << 7 | 8, c[3] = 0, b = new Uint16Array(2), b[0] = (c[0] << 8) + c[1], b[1] = (c[2] << 8) + c[3], b[0].toString(16) + b[1].toString(16);
                  c = new Uint8Array(2);
                  c[0] = 16 | d >> 1;
                  c[1] = d << 7 | b << 3;
                  b = new Uint16Array(1);
                  b[0] = (c[0] << 8) + c[1];
                  return b[0].toString(16);
                }
                function JA(a, b) {
                  var c = 0;
                  a === "AACH" && (c = 5);
                  b ? c === 0 && (c = (parseInt(b.substr(0, 2), 16) & 248) >> 3) : (c = 2, a === "AACH" && (c = 5));
                  return "mp4a.40." + c;
                }
                function KA(a) {
                  var b = /00000001[0-9]7/.exec(a);
                  return b.length && a ? "avc1." + a.substr(a.indexOf(b[0]) + 10, 6) : "";
                }
                function LA(a, b, c, d, e) {
                  var f = d.attributes.Url.replace("{bitrate}", String(c.bandwidth));
                  d = [];
                  e = t(e);
                  for (var g = e.next(), h = {}; !g.done; h = {
                    Lf: void 0
                  }, g = e.next()) h.Lf = g.value, d.push(new rj(h.Lf.start, h.Lf.end, function (k) {
                    return function () {
                      return uc(a.l, [f.replace("{start time}", String(k.Lf.Eh))]);
                    };
                  }(h), 0, null, b, 0, 0, c.mssPrivateData.duration));
                  return d;
                }
                S("shaka.mss.MssParser", CA);
                var HA = "AAC AACL AACH AACP AVC1 H264 TTML DFXP".split(" "),
                  GA = new Map().set("CAPT", "main").set("SUBT", "alternate").set("DESC", "main");
                vi("application/vnd.ms-sstr+xml", function () {
                  return new CA();
                });
                function MA(a, b, c, d, e, f, g) {
                  if (c >= 200 && c <= 299 && c != 202 || c == 304) return {
                    uri: e || d,
                    originalUri: d,
                    data: b,
                    status: c,
                    headers: a,
                    fromCache: !!a["x-shaka-from-cache"],
                    originalRequest: f
                  };
                  f = null;
                  try {
                    f = hc(b);
                  } catch (h) {}
                  throw new U(c == 401 || c == 403 ? 2 : 1, 1, 1001, d, c, f, a, g, e || d);
                }
                function NA() {}
                function OA(a, b, c, d, e, f) {
                  var g = new PA();
                  try {
                    ch(b.headers).forEach(function (m, n) {
                      g.append(n, m);
                    });
                  } catch (m) {
                    return Bg(new U(1, 1, 1002, a, m, c));
                  }
                  var h = new QA(),
                    k = {
                      Ph: false,
                      dj: false
                    };
                  a = RA(a, b, c, {
                    body: b.body || void 0,
                    headers: g,
                    method: b.method,
                    signal: h.signal,
                    credentials: b.allowCrossSiteCredentials ? "include" : void 0
                  }, k, d, e, b.streamDataCallback, f.minBytesForProgressEvents || 0);
                  a = new Ag(a, function () {
                    k.Ph = true;
                    h.abort();
                    return Promise.resolve();
                  });
                  if (b = b.retryParameters.timeout) {
                    var l = new df(function () {
                      k.dj = true;
                      h.abort();
                    });
                    l.ia(b / 1E3);
                    a.finally(function () {
                      l.stop();
                    });
                  }
                  return a;
                }
                function RA(a, b, c, d, e, f, g, h, k) {
                  var l, m, n, q, r, u, v, w, z, y, B, D, I, C, A;
                  return P(function (E) {
                    switch (E.g) {
                      case 1:
                        return l = SA, m = TA, q = new ArrayBuffer(0), u = r = 0, v = {}, w = Date.now(), ua(E, 2), F(E, l(a, d), 4);
                      case 4:
                        n = E.h;
                        v = UA(n.headers);
                        g(v);
                        if (d.method == "HEAD") {
                          E.A(5);
                          break;
                        }
                        y = (z = n.headers.get("Content-Length")) ? parseInt(z, 10) : 0;
                        if (!n.body) return F(E, n.arrayBuffer(), 9);
                        B = n.clone().body.getReader();
                        D = function D(J) {
                          function H() {
                            var K, L, O, Q;
                            return P(function (N) {
                              switch (N.g) {
                                case 1:
                                  return ua(N, 2), F(N, B.read(), 4);
                                case 4:
                                  K = N.h;
                                  xa(N, 3);
                                  break;
                                case 2:
                                  return ya(N), N.return();
                                case 3:
                                  if (K.done) {
                                    N.A(5);
                                    break;
                                  }
                                  r += K.value.byteLength;
                                  if (!h) {
                                    N.A(5);
                                    break;
                                  }
                                  return F(N, h(K.value), 5);
                                case 5:
                                  L = Date.now();
                                  O = r - u;
                                  if (L - w > 100 && O >= k || K.done) Q = K.done ? 0 : y - r, f(L - w, O, Q), u = r, w = L;
                                  K.done ? J.close() : (J.enqueue(K.value), H());
                                  G(N);
                              }
                            });
                          }
                          H();
                        };
                        new m({
                          start: D
                        });
                        return F(E, n.arrayBuffer(), 8);
                      case 8:
                        q = E.h;
                        E.A(5);
                        break;
                      case 9:
                        q = E.h, I = Date.now(), f(I - w, q.byteLength, 0);
                      case 5:
                        b.headers.Range && (C = b.headers.Range.replace("bytes=", "").split("-").filter(function (J) {
                          return J;
                        }).map(function (J) {
                          return parseInt(J, 10);
                        }), C.length == 2 && q.byteLength != C[1] - C[0] + 1 && ab("Payload length does not match range requested bytes", b, n));
                        xa(E, 3);
                        break;
                      case 2:
                        A = ya(E);
                        if (e.Ph) throw new U(1, 1, 7001, a, c);
                        if (e.dj) throw new U(1, 1, 1003, a, c);
                        throw new U(1, 1, 1002, a, A, c);
                      case 3:
                        return E.return(MA(v, q, n.status, a, n.url, b, c));
                    }
                  });
                }
                function UA(a) {
                  var b = {};
                  a.forEach(function (c, d) {
                    b[d.trim()] = c;
                  });
                  return b;
                }
                function VA() {
                  if (window.ReadableStream) try {
                    new ReadableStream({});
                  } catch (a) {
                    return false;
                  } else return false;
                  if (window.Response) {
                    if (!new Response("").body) return false;
                  } else return false;
                  return !(!window.fetch || "polyfill" in window.fetch || !window.AbortController);
                }
                S("shaka.net.HttpFetchPlugin", NA);
                NA.isSupported = VA;
                NA.parse = OA;
                var SA = window.fetch,
                  QA = window.AbortController,
                  TA = window.ReadableStream,
                  PA = window.Headers;
                VA() && (Ng("http", OA, 2, true), Ng("https", OA, 2, true), Ng("blob", OA, 2, true));
                function WA() {}
                function XA(a, b, c, d, e, f) {
                  var g = new YA(),
                    h = Date.now(),
                    k = 0,
                    l = new Promise(function (m, n) {
                      g.open(b.method, a, true);
                      g.responseType = "arraybuffer";
                      g.timeout = b.retryParameters.timeout;
                      g.withCredentials = b.allowCrossSiteCredentials;
                      var q = {};
                      g.onabort = function () {
                        n(new U(1, 1, 7001, a, c));
                      };
                      g.onreadystatechange = function () {
                        if (g.readyState === XMLHttpRequest.HEADERS_RECEIVED) {
                          var u = g.getAllResponseHeaders().trim().split("\r\n"),
                            v = {};
                          u = t(u);
                          for (var w = u.next(); !w.done; w = u.next()) w = w.value.split(": "), v[w[0].toLowerCase()] = w.slice(1).join(": ");
                          q = v;
                          e(q);
                        }
                      };
                      g.onload = function (u) {
                        var v = g.response;
                        try {
                          d(Date.now() - h, u.loaded - k, 0);
                          var w = MA(q, v, g.status, a, g.responseURL, b, c);
                          m(w);
                        } catch (z) {
                          n(z);
                        }
                      };
                      g.onerror = function (u) {
                        n(new U(1, 1, 1002, a, u, c));
                      };
                      g.ontimeout = function () {
                        n(new U(1, 1, 1003, a, c));
                      };
                      g.onprogress = function (u) {
                        var v = Date.now(),
                          w = f.minBytesForProgressEvents || 0,
                          z = u.loaded - k;
                        if (v - h > 100 && z >= w || u.lengthComputable && u.loaded == u.total) d(v - h, z, g.readyState == 4 ? 0 : u.total - u.loaded), k = u.loaded, h = v;
                      };
                      for (var r in b.headers) try {
                        g.setRequestHeader(r.toLowerCase(), b.headers[r]);
                      } catch (u) {
                        throw new U(1, 1, 1002, a, u, c);
                      }
                      g.send(b.body);
                    });
                  return new Ag(l, function () {
                    g.abort();
                    return Promise.resolve();
                  });
                }
                S("shaka.net.HttpXHRPlugin", WA);
                WA.parse = XA;
                var YA = window.XMLHttpRequest;
                Ng("http", XA, 1, true);
                Ng("https", XA, 1, true);
                Ng("blob", XA, 1, true);
                function ZA(a, b, c, d, e) {
                  this.g = a;
                  this.i = b;
                  this.groupId = c;
                  this.h = d;
                  this.j = e;
                }
                function $A(a) {
                  var b = a.Yb(false);
                  return b ? oc(b) : a.P().map(function (c) {
                    return "{" + encodeURI(c.split("#xywh=")[0]) + "}";
                  }).join("") + ":" + a.startByte + ":" + a.endByte;
                }
                function aB(a, b) {
                  return xm(a.g.P(), a.g.startByte, a.g.endByte, b.streaming.retryParameters);
                }
                function bB() {
                  this.g = this.j = this.i = 0;
                  this.h = new Map();
                  this.l = 0;
                }
                function cB(a, b) {
                  a.i += b;
                  var c = a.l;
                  a.l++;
                  a.h.set(c, b);
                  return c;
                }
                bB.prototype.close = function (a, b) {
                  if (this.h.has(a)) {
                    var c = this.h.get(a);
                    this.h.delete(a);
                    this.j += c;
                    this.g += b;
                  }
                };
                function dB(a) {
                  return a.i == 0 ? 0 : a.j / a.i;
                }
                function eB(a) {
                  var b = this;
                  this.u = a;
                  this.i = new Map();
                  this.h = new Zg(function () {
                    return fB(b).catch(function () {});
                  });
                  this.j = [];
                  this.o = function () {};
                  this.m = function () {};
                  this.g = new bB();
                  this.l = false;
                }
                eB.prototype.destroy = function () {
                  return this.h.destroy();
                };
                function gB(a, b, c) {
                  a.o = b;
                  a.m = c;
                }
                function fB(a) {
                  a.l = true;
                  var b = a.j.map(function (c) {
                    return c();
                  });
                  a.j = [];
                  return Promise.all(b);
                }
                eB.prototype.queue = function (a, b, c, d, e) {
                  var f = this;
                  $g(this.h);
                  var g = (this.i.get(a) || Promise.resolve()).then(function () {
                    var h, k, l, m, n, q, r;
                    return P(function (u) {
                      if (u.g == 1) return F(u, hB(f, b), 2);
                      h = u.h;
                      if (f.h.g) throw new U(2, 9, 7001);
                      if (d) for (m in k = Vb(h), l = new th(k), l.data) n = Number(m), q = l.data[n], r = l.g[n], f.m(q, r);
                      f.g.close(c, h.byteLength);
                      f.o(dB(f.g), f.g.g);
                      return u.return(e(h));
                    });
                  });
                  this.i.set(a, g);
                  return g;
                };
                function iB(a, b, c, d, e, f) {
                  $g(a.h);
                  var g = (a.i.get(b) || Promise.resolve()).then(function () {
                    if (a.h.g) throw new U(2, 9, 7001);
                    if (e) {
                      var h = Vb(c);
                      h = new th(h);
                      for (var k in h.data) {
                        var l = Number(k);
                        a.m(h.data[l], h.g[l]);
                      }
                    }
                    a.g.close(d, c.byteLength);
                    a.o(dB(a.g), a.g.g);
                    return f(c);
                  });
                  a.i.set(b, g);
                }
                function jB(a) {
                  return P(function (b) {
                    return b.g == 1 ? F(b, Promise.all(a.i.values()), 2) : b.return(a.g.g);
                  });
                }
                function hB(a, b) {
                  var c, d, e, f;
                  return P(function (g) {
                    if (g.g == 1) return c = Xg, d = a.u.request(c, b), e = function e() {
                      return d.abort();
                    }, a.j.push(e), F(g, d.promise, 2);
                    f = g.h;
                    jb(a.j, e);
                    return g.return(f.data);
                  });
                }
                function kB(a, b) {
                  var c = this;
                  this.i = a;
                  this.h = a.objectStore(b);
                  this.g = new zg();
                  a.onabort = function (d) {
                    d.preventDefault();
                    c.g.reject();
                  };
                  a.onerror = function (d) {
                    d.preventDefault();
                    c.g.reject();
                  };
                  a.oncomplete = function () {
                    c.g.resolve();
                  };
                }
                kB.prototype.abort = function () {
                  var a = this;
                  return P(function (b) {
                    if (b.g == 1) {
                      try {
                        a.i.abort();
                      } catch (c) {}
                      ua(b, 2);
                      return F(b, a.g, 4);
                    }
                    if (b.g != 2) return xa(b, 0);
                    ya(b);
                    G(b);
                  });
                };
                function lB(a, b) {
                  return new Promise(function (c, d) {
                    var e = a.h.openCursor();
                    e.onerror = d;
                    e.onsuccess = function () {
                      var f;
                      return P(function (g) {
                        if (g.g == 1) {
                          if (e.result == null) return c(), g.return();
                          f = e.result;
                          return F(g, b(f.key, f.value, f), 2);
                        }
                        f.continue();
                        G(g);
                      });
                    };
                  });
                }
                kB.prototype.store = function () {
                  return this.h;
                };
                kB.prototype.promise = function () {
                  return this.g;
                };
                function mB(a) {
                  this.h = a;
                  this.g = [];
                }
                mB.prototype.destroy = function () {
                  return Promise.all(this.g.map(function (a) {
                    return a.abort();
                  }));
                };
                function nB(a, b) {
                  return oB(a, b, "readwrite");
                }
                function oB(a, b, c) {
                  c = a.h.transaction([b], c);
                  var d = new kB(c, b);
                  a.g.push(d);
                  d.promise().then(function () {
                    jb(a.g, d);
                  }, function () {
                    jb(a.g, d);
                  });
                  return d;
                }
                function pB(a, b, c) {
                  this.h = new mB(a);
                  this.i = b;
                  this.g = c;
                }
                p = pB.prototype;
                p.destroy = function () {
                  return this.h.destroy();
                };
                p.hasFixedKeySpace = function () {
                  return true;
                };
                p.addSegments = function () {
                  return qB(this.i);
                };
                p.removeSegments = function (a, b) {
                  return rB(this, this.i, a, b);
                };
                p.getSegments = function (a) {
                  var b = this,
                    c;
                  return P(function (d) {
                    if (d.g == 1) return F(d, sB(b, b.i, a), 2);
                    c = d.h;
                    return d.return(c.map(function (e) {
                      return b.Rh(e);
                    }));
                  });
                };
                p.addManifests = function () {
                  return qB(this.g);
                };
                p.updateManifest = function () {
                  return Promise.reject(new U(2, 9, 9016, "Cannot modify values in " + this.g));
                };
                function tB(a, b, c) {
                  a = nB(a.h, a.g);
                  var d = a.store();
                  d.get(b).onsuccess = function () {
                    d.put(c, b);
                  };
                  return a.promise();
                }
                p.updateManifestExpiration = function (a, b) {
                  var c = nB(this.h, this.g),
                    d = c.store();
                  d.get(a).onsuccess = function (e) {
                    if (e = e.target.result) e.expiration = b, d.put(e, a);
                  };
                  return c.promise();
                };
                p.removeManifests = function (a, b) {
                  return rB(this, this.g, a, b);
                };
                p.getManifests = function (a) {
                  var b = this,
                    c;
                  return P(function (d) {
                    if (d.g == 1) return F(d, sB(b, b.g, a), 2);
                    c = d.h;
                    return d.return(Promise.all(c.map(function (e) {
                      return b.Rd(e);
                    })));
                  });
                };
                p.getAllManifests = function () {
                  var a = this,
                    b,
                    c;
                  return P(function (d) {
                    return d.g == 1 ? (b = oB(a.h, a.g, "readonly"), c = new Map(), F(d, lB(b, function (e, f) {
                      var g;
                      return P(function (h) {
                        if (h.g == 1) return F(h, a.Rd(f), 2);
                        g = h.h;
                        c.set(e, g);
                        G(h);
                      });
                    }), 2)) : d.g != 3 ? F(d, b.promise(), 3) : d.return(c);
                  });
                };
                p.Rh = function (a) {
                  return a;
                };
                p.Rd = function (a) {
                  return Promise.resolve(a);
                };
                function qB(a) {
                  return Promise.reject(new U(2, 9, 9011, "Cannot add new value to " + a));
                }
                p.add = function (a, b) {
                  var c = this,
                    d,
                    e,
                    f,
                    g,
                    h,
                    k,
                    l;
                  return P(function (m) {
                    if (m.g == 1) {
                      d = nB(c.h, a);
                      e = d.store();
                      f = [];
                      g = t(b);
                      h = g.next();
                      for (k = {}; !h.done; k = {
                        dh: void 0
                      }, h = g.next()) l = h.value, k.dh = e.add(l), k.dh.onsuccess = function (n) {
                        return function () {
                          f.push(n.dh.result);
                        };
                      }(k);
                      return F(m, d.promise(), 2);
                    }
                    return m.return(f);
                  });
                };
                function rB(a, b, c, d) {
                  a = nB(a.h, b);
                  b = a.store();
                  c = t(c);
                  for (var e = c.next(), f = {}; !e.done; f = {
                    Pg: void 0
                  }, e = c.next()) f.Pg = e.value, b.delete(f.Pg).onsuccess = function (g) {
                    return function () {
                      return d(g.Pg);
                    };
                  }(f);
                  return a.promise();
                }
                function sB(a, b, c) {
                  var d, e, f, g, h, k, l;
                  return P(function (m) {
                    if (m.g == 1) {
                      d = oB(a.h, b, "readonly");
                      e = d.store();
                      f = {};
                      g = [];
                      h = t(c);
                      k = h.next();
                      for (l = {}; !k.done; l = {
                        Bf: void 0,
                        gf: void 0
                      }, k = h.next()) l.gf = k.value, l.Bf = e.get(l.gf), l.Bf.onsuccess = function (n) {
                        return function () {
                          n.Bf.result == void 0 && g.push(n.gf);
                          f[n.gf] = n.Bf.result;
                        };
                      }(l);
                      return F(m, d.promise(), 2);
                    }
                    if (g.length) throw new U(2, 9, 9012, "Could not find values for " + g);
                    return m.return(c.map(function (n) {
                      return f[n];
                    }));
                  });
                }
                function uB(a) {
                  this.g = new mB(a);
                }
                uB.prototype.destroy = function () {
                  return this.g.destroy();
                };
                uB.prototype.getAll = function () {
                  var a = this,
                    b,
                    c;
                  return P(function (d) {
                    return d.g == 1 ? (b = oB(a.g, "session-ids", "readonly"), c = [], F(d, lB(b, function (e, f) {
                      c.push(f);
                    }), 2)) : d.g != 3 ? F(d, b.promise(), 3) : d.return(c);
                  });
                };
                uB.prototype.add = function (a) {
                  var b = nB(this.g, "session-ids"),
                    c = b.store();
                  a = t(a);
                  for (var d = a.next(); !d.done; d = a.next()) c.add(d.value);
                  return b.promise();
                };
                uB.prototype.remove = function (a) {
                  var b = this,
                    c;
                  return P(function (d) {
                    return d.g == 1 ? (c = nB(b.g, "session-ids"), F(d, lB(c, function (e, f, g) {
                      a.includes(f.sessionId) && g.delete();
                    }), 2)) : F(d, c.promise(), 0);
                  });
                };
                function vB() {
                  this.g = new Map();
                }
                vB.prototype.destroy = function () {
                  for (var a = [], b = t(this.g.values()), c = b.next(); !c.done; c = b.next()) a.push(c.value.destroy());
                  this.g.clear();
                  return Promise.all(a);
                };
                vB.prototype.init = function () {
                  var a = this;
                  wB.forEach(function (e, f) {
                    (e = e()) && a.g.set(f, e);
                  });
                  for (var b = [], c = t(this.g.values()), d = c.next(); !d.done; d = c.next()) b.push(d.value.init());
                  return Promise.all(b);
                };
                function xB(a) {
                  var b = null;
                  a.g.forEach(function (c, d) {
                    c.getCells().forEach(function (e, f) {
                      e.hasFixedKeySpace() || b || (b = {
                        path: {
                          Pb: d,
                          bb: f
                        },
                        bb: e
                      });
                    });
                  });
                  if (b) return b;
                  throw new U(2, 9, 9013, "Could not find a cell that supports add-operations");
                }
                function yB(a, b) {
                  a.g.forEach(function (c, d) {
                    c.getCells().forEach(function (e, f) {
                      b({
                        Pb: d,
                        bb: f
                      }, e);
                    });
                  });
                }
                function zB(a, b, c) {
                  a = a.g.get(b);
                  if (!a) throw new U(2, 9, 9013, "Could not find mechanism with name " + b);
                  b = a.getCells().get(c);
                  if (!b) throw new U(2, 9, 9013, "Could not find cell with name " + c);
                  return b;
                }
                function AB(a, b) {
                  a.g.forEach(function (c) {
                    b(c.getEmeSessionCell());
                  });
                }
                function BB(a) {
                  var b = Array.from(a.g.keys());
                  if (!b.length) throw new U(2, 9, 9E3, "No supported storage mechanisms found");
                  return a.g.get(b[0]).getEmeSessionCell();
                }
                function CB(a) {
                  var b, c, d;
                  return P(function (e) {
                    return e.g == 1 ? (b = Array.from(a.g.values()), c = b.length > 0, c || (d = wB, d.forEach(function (f) {
                      (f = f()) && b.push(f);
                    })), F(e, Promise.all(b.map(function (f) {
                      return f.erase();
                    })), 2)) : c ? e.A(0) : F(e, Promise.all(b.map(function (f) {
                      return f.destroy();
                    })), 0);
                  });
                }
                function DB(a, b) {
                  wB.set(a, b);
                }
                S("shaka.offline.StorageMuxer", vB);
                vB.unregister = function (a) {
                  wB.delete(a);
                };
                vB.register = DB;
                vB.prototype.destroy = vB.prototype.destroy;
                var wB = new Map();
                function EB() {
                  pB.apply(this, arguments);
                }
                la(EB, pB);
                EB.prototype.updateManifestExpiration = function (a, b) {
                  var c = this,
                    d,
                    e,
                    f;
                  return P(function (g) {
                    d = nB(c.h, c.g);
                    e = d.store();
                    f = new zg();
                    e.get(a).onsuccess = function (h) {
                      (h = h.target.result) ? (h.expiration = b, e.put(h), f.resolve()) : f.reject(new U(2, 9, 9012, "Could not find values for " + a));
                    };
                    return F(g, Promise.all([d.promise(), f]), 0);
                  });
                };
                EB.prototype.Rd = function (a) {
                  var b, c, d, e, f, g;
                  return P(function (h) {
                    if (h.g == 1) {
                      b = [];
                      for (c = 0; c < a.periods.length; ++c) d = c == a.periods.length - 1 ? a.duration : a.periods[c + 1].startTime, e = d - a.periods[c].startTime, f = FB(a.periods[c], e), b.push(f);
                      return F(h, Gw(b), 2);
                    }
                    g = h.h;
                    return h.return({
                      creationTime: 0,
                      originalManifestUri: a.originalManifestUri,
                      duration: a.duration,
                      size: a.size,
                      expiration: a.expiration == null ? Infinity : a.expiration,
                      streams: g,
                      sessionIds: a.sessionIds,
                      drmInfo: a.drmInfo,
                      appMetadata: a.appMetadata,
                      sequenceMode: false
                    });
                  });
                };
                function FB(a, b) {
                  GB(a);
                  for (var c = t(a.streams), d = c.next(); !d.done; d = c.next());
                  return a.streams.map(function (e) {
                    return HB(e, a.startTime, b);
                  });
                }
                function HB(a, b, c) {
                  var d = a.initSegmentUri ? IB(a.initSegmentUri) : null,
                    e = b + a.presentationTimeOffset,
                    f = b + c;
                  return {
                    id: a.id,
                    originalId: null,
                    groupId: null,
                    primary: a.primary,
                    type: a.contentType,
                    mimeType: a.mimeType,
                    codecs: a.codecs,
                    frameRate: a.frameRate,
                    pixelAspectRatio: void 0,
                    hdr: void 0,
                    colorGamut: void 0,
                    videoLayout: void 0,
                    kind: a.kind,
                    language: a.language,
                    originalLanguage: a.language || null,
                    label: a.label,
                    width: a.width,
                    height: a.height,
                    initSegmentKey: d,
                    encrypted: a.encrypted,
                    keyIds: new Set([a.keyId]),
                    segments: a.segments.map(function (g) {
                      var h = IB(g.uri);
                      return {
                        startTime: b + g.startTime,
                        endTime: b + g.endTime,
                        dataKey: h,
                        initSegmentKey: d,
                        appendWindowStart: b,
                        appendWindowEnd: f,
                        timestampOffset: e,
                        tilesLayout: "",
                        mimeType: null,
                        codecs: null,
                        thumbnailSprite: null
                      };
                    }),
                    variantIds: a.variantIds,
                    roles: [],
                    forced: false,
                    audioSamplingRate: null,
                    channelsCount: null,
                    spatialAudio: false,
                    closedCaptions: null,
                    tilesLayout: void 0,
                    external: false,
                    fastSwitching: false,
                    isAudioMuxedInVideo: false
                  };
                }
                EB.prototype.Rh = function (a) {
                  return {
                    data: a.data
                  };
                };
                function IB(a) {
                  var b;
                  if ((b = /^offline:[0-9]+\/[0-9]+\/([0-9]+)$/.exec(a)) || (b = /^offline:segment\/([0-9]+)$/.exec(a))) return Number(b[1]);
                  throw new U(2, 9, 9004, "Could not parse uri " + a);
                }
                function GB(a) {
                  var b = a.streams.filter(function (h) {
                    return h.contentType == "audio";
                  });
                  a = a.streams.filter(function (h) {
                    return h.contentType == "video";
                  });
                  if (!b.every(function (h) {
                    return h.variantIds;
                  }) || !a.every(function (h) {
                    return h.variantIds;
                  })) {
                    for (var c = t(b), d = c.next(); !d.done; d = c.next()) d.value.variantIds = [];
                    c = t(a);
                    for (d = c.next(); !d.done; d = c.next()) d.value.variantIds = [];
                    c = 0;
                    if (a.length && !b.length) {
                      d = c++;
                      for (var e = t(a), f = e.next(); !f.done; f = e.next()) f.value.variantIds.push(d);
                    }
                    if (!a.length && b.length) for (d = c++, e = t(b), f = e.next(); !f.done; f = e.next()) f.value.variantIds.push(d);
                    if (a.length && b.length) for (b = t(b), d = b.next(); !d.done; d = b.next()) for (d = d.value, e = t(a), f = e.next(); !f.done; f = e.next()) {
                      f = f.value;
                      var g = c++;
                      d.variantIds.push(g);
                      f.variantIds.push(g);
                    }
                  }
                }
                function JB() {
                  pB.apply(this, arguments);
                }
                la(JB, pB);
                JB.prototype.Rd = function (a) {
                  var b, c, d, e, f, g;
                  return P(function (h) {
                    if (h.g == 1) {
                      b = [];
                      for (c = 0; c < a.periods.length; ++c) {
                        d = c == a.periods.length - 1 ? a.duration : a.periods[c + 1].startTime;
                        e = d - a.periods[c].startTime;
                        for (var k = a.periods[c], l = [], m = t(k.streams), n = m.next(); !n.done; n = m.next()) n = n.value, n.variantIds.length != 0 && l.push(KB(n, k.startTime, k.startTime + e));
                        f = l;
                        b.push(f);
                      }
                      return F(h, Gw(b), 2);
                    }
                    g = h.h;
                    return h.return({
                      appMetadata: a.appMetadata,
                      creationTime: 0,
                      drmInfo: a.drmInfo,
                      duration: a.duration,
                      expiration: a.expiration == null ? Infinity : a.expiration,
                      originalManifestUri: a.originalManifestUri,
                      sessionIds: a.sessionIds,
                      size: a.size,
                      streams: g,
                      sequenceMode: false
                    });
                  });
                };
                function KB(a, b, c) {
                  return {
                    id: a.id,
                    originalId: a.originalId,
                    groupId: null,
                    primary: a.primary,
                    type: a.contentType,
                    mimeType: a.mimeType,
                    codecs: a.codecs,
                    frameRate: a.frameRate,
                    pixelAspectRatio: a.pixelAspectRatio,
                    hdr: void 0,
                    colorGamut: void 0,
                    videoLayout: void 0,
                    kind: a.kind,
                    language: a.language,
                    originalLanguage: a.language || null,
                    label: a.label,
                    width: a.width,
                    height: a.height,
                    encrypted: a.encrypted,
                    keyIds: new Set([a.keyId]),
                    segments: a.segments.map(function (d) {
                      return {
                        startTime: b + d.startTime,
                        endTime: b + d.endTime,
                        initSegmentKey: a.initSegmentKey,
                        appendWindowStart: b,
                        appendWindowEnd: c,
                        timestampOffset: b - a.presentationTimeOffset,
                        dataKey: d.dataKey,
                        tilesLayout: "",
                        mimeType: null,
                        codecs: null,
                        thumbnailSprite: null
                      };
                    }),
                    variantIds: a.variantIds,
                    roles: [],
                    forced: false,
                    audioSamplingRate: null,
                    channelsCount: null,
                    spatialAudio: false,
                    closedCaptions: null,
                    tilesLayout: void 0,
                    external: false,
                    fastSwitching: false,
                    isAudioMuxedInVideo: false
                  };
                }
                function LB() {
                  pB.apply(this, arguments);
                }
                la(LB, pB);
                p = LB.prototype;
                p.hasFixedKeySpace = function () {
                  return false;
                };
                p.addSegments = function (a) {
                  return this.add(this.i, a);
                };
                p.addManifests = function (a) {
                  return this.add(this.g, a);
                };
                p.updateManifest = function (a, b) {
                  return tB(this, a, b);
                };
                p.Rd = function (a) {
                  a.expiration == null && (a.expiration = Infinity);
                  return Promise.resolve(a);
                };
                function MB() {
                  this.m = this.j = this.i = this.h = this.g = this.l = null;
                }
                p = MB.prototype;
                p.init = function () {
                  var a = this,
                    b = new zg(),
                    c = false,
                    d = new df(function () {
                      c = true;
                      b.reject(new U(2, 9, 9017));
                    });
                  typeof NB === "number" && NB > 0 && d.ia(NB);
                  var e = window.indexedDB.open("shaka_offline_db", 5);
                  e.onsuccess = function () {
                    if (!c) {
                      d.stop();
                      var f = e.result;
                      a.l = f;
                      var g = f.objectStoreNames;
                      g = g.contains("manifest") && g.contains("segment") ? new EB(f, "segment", "manifest") : null;
                      a.g = g;
                      g = f.objectStoreNames;
                      g = g.contains("manifest-v2") && g.contains("segment-v2") ? new JB(f, "segment-v2", "manifest-v2") : null;
                      a.h = g;
                      g = f.objectStoreNames;
                      g = g.contains("manifest-v3") && g.contains("segment-v3") ? new JB(f, "segment-v3", "manifest-v3") : null;
                      a.i = g;
                      g = f.objectStoreNames;
                      g = g.contains("manifest-v5") && g.contains("segment-v5") ? new LB(f, "segment-v5", "manifest-v5") : null;
                      a.j = g;
                      f = f.objectStoreNames.contains("session-ids") ? new uB(f) : null;
                      a.m = f;
                      b.resolve();
                    }
                  };
                  e.onupgradeneeded = function () {
                    for (var f = e.result, g = t(["segment-v5", "manifest-v5", "session-ids"]), h = g.next(); !h.done; h = g.next()) h = h.value, f.objectStoreNames.contains(h) || f.createObjectStore(h, {
                      autoIncrement: true
                    });
                  };
                  e.onerror = function (f) {
                    c || (d.stop(), b.reject(new U(2, 9, 9001, e.error)), f.preventDefault());
                  };
                  return b;
                };
                p.destroy = function () {
                  var a = this;
                  return P(function (b) {
                    switch (b.g) {
                      case 1:
                        if (!a.g) {
                          b.A(2);
                          break;
                        }
                        return F(b, a.g.destroy(), 2);
                      case 2:
                        if (!a.h) {
                          b.A(4);
                          break;
                        }
                        return F(b, a.h.destroy(), 4);
                      case 4:
                        if (!a.i) {
                          b.A(6);
                          break;
                        }
                        return F(b, a.i.destroy(), 6);
                      case 6:
                        if (!a.j) {
                          b.A(8);
                          break;
                        }
                        return F(b, a.j.destroy(), 8);
                      case 8:
                        if (!a.m) {
                          b.A(10);
                          break;
                        }
                        return F(b, a.m.destroy(), 10);
                      case 10:
                        a.l && a.l.close(), G(b);
                    }
                  });
                };
                p.getCells = function () {
                  var a = new Map();
                  this.g && a.set("v1", this.g);
                  this.h && a.set("v2", this.h);
                  this.i && a.set("v3", this.i);
                  this.j && a.set("v5", this.j);
                  return a;
                };
                p.getEmeSessionCell = function () {
                  return this.m;
                };
                p.erase = function () {
                  var a = this;
                  return P(function (b) {
                    switch (b.g) {
                      case 1:
                        if (!a.g) {
                          b.A(2);
                          break;
                        }
                        return F(b, a.g.destroy(), 2);
                      case 2:
                        if (!a.h) {
                          b.A(4);
                          break;
                        }
                        return F(b, a.h.destroy(), 4);
                      case 4:
                        if (!a.i) {
                          b.A(6);
                          break;
                        }
                        return F(b, a.i.destroy(), 6);
                      case 6:
                        if (!a.j) {
                          b.A(8);
                          break;
                        }
                        return F(b, a.j.destroy(), 8);
                      case 8:
                        return a.l && a.l.close(), F(b, OB(), 10);
                      case 10:
                        return a.l = null, a.g = null, a.h = null, a.i = null, a.j = null, F(b, a.init(), 0);
                    }
                  });
                };
                function OB() {
                  var a = new zg(),
                    b = window.indexedDB.deleteDatabase("shaka_offline_db");
                  b.onblocked = function () {};
                  b.onsuccess = function () {
                    a.resolve();
                  };
                  b.onerror = function (c) {
                    a.reject(new U(2, 9, 9001, b.error));
                    c.preventDefault();
                  };
                  return a;
                }
                var NB = 5;
                S("shaka.offline.indexeddb.StorageMechanismOpenTimeout", NB);
                DB("idb", function () {
                  return tb().xh() ? new MB() : null;
                });
                function PB(a, b, c, d) {
                  this.g = a;
                  this.i = b;
                  this.h = c;
                  this.l = d;
                  this.j = ["offline:", a, "/", b, "/", c, "/", d].join("");
                }
                PB.prototype.Pb = function () {
                  return this.i;
                };
                PB.prototype.bb = function () {
                  return this.h;
                };
                PB.prototype.key = function () {
                  return this.l;
                };
                PB.prototype.toString = function () {
                  return this.j;
                };
                function QB(a) {
                  a = /^offline:([a-z]+)\/([^/]+)\/([^/]+)\/([0-9]+)$/.exec(a);
                  if (a == null) return null;
                  var b = a[1];
                  if (b != "manifest" && b != "segment") return null;
                  var c = a[2];
                  if (!c) return null;
                  var d = a[3];
                  return d && b != null ? new PB(b, c, d, Number(a[4])) : null;
                }
                function RB(a, b) {
                  this.h = a;
                  this.g = b;
                }
                function SB(a, b) {
                  var c = new ol(null, 0);
                  c.Ab(b.duration);
                  var d = b.streams.filter(function (l) {
                      return l.type == "audio";
                    }),
                    e = b.streams.filter(function (l) {
                      return l.type == "video";
                    });
                  d = TB(a, d, e, c);
                  e = b.streams.filter(function (l) {
                    return l.type == Ac;
                  }).map(function (l) {
                    return UB(a, l, c);
                  });
                  var f = b.streams.filter(function (l) {
                      return l.type == "image";
                    }).map(function (l) {
                      return UB(a, l, c);
                    }),
                    g = b.drmInfo ? [b.drmInfo] : [];
                  if (b.drmInfo) for (var h = t(d.values()), k = h.next(); !k.done; k = h.next()) k = k.value, k.audio && k.audio.encrypted && (k.audio.drmInfos = g), k.video && k.video.encrypted && (k.video.drmInfos = g);
                  return {
                    presentationTimeline: c,
                    offlineSessionIds: b.sessionIds,
                    variants: Array.from(d.values()),
                    textStreams: e,
                    imageStreams: f,
                    sequenceMode: b.sequenceMode || false,
                    ignoreManifestTimestampsInSegmentsMode: false,
                    type: b.type || "UNKNOWN",
                    serviceDescription: null,
                    nextUrl: null,
                    periodCount: 1,
                    gapCount: 0,
                    isLowLatency: false,
                    startTime: null
                  };
                }
                function TB(a, b, c, d) {
                  for (var e = new Set(), f = t(b), g = f.next(); !g.done; g = f.next()) {
                    g = t(g.value.variantIds);
                    for (var h = g.next(); !h.done; h = g.next()) e.add(h.value);
                  }
                  f = t(c);
                  for (g = f.next(); !g.done; g = f.next()) for (g = t(g.value.variantIds), h = g.next(); !h.done; h = g.next()) e.add(h.value);
                  f = new Map();
                  e = t(e);
                  for (g = e.next(); !g.done; g = e.next()) g = g.value, f.set(g, {
                    id: g,
                    language: "",
                    disabledUntilTime: 0,
                    primary: false,
                    audio: null,
                    video: null,
                    bandwidth: 0,
                    allowedByApplication: true,
                    allowedByKeySystem: true,
                    decodingInfos: []
                  });
                  b = t(b);
                  for (e = b.next(); !e.done; e = b.next()) for (g = e.value, e = UB(a, g, d), g = t(g.variantIds), h = g.next(); !h.done; h = g.next()) h = f.get(h.value), h.language = e.language, h.primary = h.primary || e.primary, h.audio = e;
                  c = t(c);
                  for (b = c.next(); !b.done; b = c.next()) for (e = b.value, b = UB(a, e, d), e = t(e.variantIds), g = e.next(); !g.done; g = e.next()) g = f.get(g.value), g.primary = g.primary || b.primary, g.video = b;
                  return f;
                }
                function UB(a, b, c) {
                  var d = b.segments.map(function (e) {
                    return VB(a, e, b);
                  });
                  c.ie(d);
                  return {
                    id: b.id,
                    originalId: b.originalId,
                    groupId: b.groupId,
                    createSegmentIndex: function createSegmentIndex() {
                      return Promise.resolve();
                    },
                    segmentIndex: new Nl(d),
                    mimeType: b.mimeType,
                    codecs: b.codecs,
                    width: b.width || void 0,
                    height: b.height || void 0,
                    frameRate: b.frameRate,
                    pixelAspectRatio: b.pixelAspectRatio,
                    hdr: b.hdr,
                    colorGamut: b.colorGamut,
                    videoLayout: b.videoLayout,
                    kind: b.kind,
                    encrypted: b.encrypted,
                    drmInfos: [],
                    keyIds: b.keyIds,
                    language: b.language,
                    originalLanguage: b.originalLanguage || null,
                    label: b.label,
                    type: b.type,
                    primary: b.primary,
                    trickModeVideo: null,
                    dependencyStream: null,
                    emsgSchemeIdUris: null,
                    roles: b.roles,
                    forced: b.forced,
                    channelsCount: b.channelsCount,
                    audioSamplingRate: b.audioSamplingRate,
                    spatialAudio: b.spatialAudio,
                    closedCaptions: b.closedCaptions,
                    tilesLayout: b.tilesLayout,
                    mssPrivateData: b.mssPrivateData,
                    accessibilityPurpose: null,
                    external: b.external,
                    fastSwitching: b.fastSwitching,
                    fullMimeTypes: new Set([Fe(b.mimeType, b.codecs)]),
                    isAudioMuxedInVideo: false,
                    baseOriginalId: null
                  };
                }
                function VB(a, b, c) {
                  var d = new PB("segment", a.h, a.g, b.dataKey);
                  a = new rj(b.startTime, b.endTime, function () {
                    return [d.toString()];
                  }, 0, null, b.initSegmentKey != null ? WB(a, b.initSegmentKey) : null, b.timestampOffset, b.appendWindowStart, b.appendWindowEnd, [], b.tilesLayout || "");
                  a.mimeType = b.mimeType || c.mimeType || "";
                  a.codecs = b.codecs || c.codecs || "";
                  b.thumbnailSprite && a.If(b.thumbnailSprite);
                  return a;
                }
                function WB(a, b) {
                  var c = new PB("segment", a.h, a.g, b);
                  return new pj(function () {
                    return [c.toString()];
                  }, 0, null);
                }
                function XB() {
                  this.g = null;
                }
                p = XB.prototype;
                p.configure = function () {};
                p.start = function (a, b) {
                  var c = this,
                    d,
                    e,
                    f,
                    g,
                    h,
                    k,
                    l;
                  return P(function (m) {
                    switch (m.g) {
                      case 1:
                        d = QB(a);
                        c.g = d;
                        if (d == null || d.g != "manifest") throw new U(2, 1, 9004, a);
                        e = new vB();
                        va(m, 2);
                        return F(m, e.init(), 4);
                      case 4:
                        return F(m, zB(e, d.Pb(), d.bb()), 5);
                      case 5:
                        return f = m.h, F(m, f.getManifests([d.key()]), 6);
                      case 6:
                        return g = m.h, h = g[0], k = new RB(d.Pb(), d.bb()), l = SB(k, h), b.makeTextStreamsForClosedCaptions(l), m.return(l);
                      case 2:
                        return Aa(m), F(m, e.destroy(), 7);
                      case 7:
                        Da(m, 0);
                    }
                  });
                };
                p.stop = function () {
                  return Promise.resolve();
                };
                p.update = function () {};
                p.onExpirationUpdated = function (a, b) {
                  var c = this,
                    d,
                    e,
                    f,
                    g,
                    h,
                    k,
                    l;
                  return P(function (m) {
                    switch (m.g) {
                      case 1:
                        return d = c.g, e = new vB(), ua(m, 2, 3), F(m, e.init(), 5);
                      case 5:
                        return F(m, zB(e, d.Pb(), d.bb()), 6);
                      case 6:
                        return f = m.h, F(m, f.getManifests([d.key()]), 7);
                      case 7:
                        g = m.h;
                        h = g[0];
                        k = h.sessionIds.includes(a);
                        l = h.expiration == void 0 || h.expiration > b;
                        if (!k || !l) {
                          m.A(3);
                          break;
                        }
                        return F(m, f.updateManifestExpiration(d.key(), b), 3);
                      case 3:
                        return Aa(m), F(m, e.destroy(), 10);
                      case 10:
                        Da(m, 0);
                        break;
                      case 2:
                        ya(m), m.A(3);
                    }
                  });
                };
                p.onInitialVariantChosen = function () {};
                p.banLocation = function () {};
                p.setMediaElement = function () {};
                vi("application/x-offline-manifest", function () {
                  return new XB();
                });
                function YB() {}
                function ZB(a, b) {
                  var c = QB(a);
                  c && c.g == "manifest" ? (a = {
                    uri: a,
                    originalUri: a,
                    data: new ArrayBuffer(0),
                    headers: {
                      "content-type": "application/x-offline-manifest"
                    },
                    originalRequest: b
                  }, a = Dg(a)) : a = c && c.g == "segment" ? $B(c.key(), c, b) : Bg(new U(2, 1, 9004, a));
                  return a;
                }
                function $B(a, b, c) {
                  var d = new vB();
                  return Dg(void 0).Xa(function () {
                    return d.init();
                  }).Xa(function () {
                    return zB(d, b.Pb(), b.bb());
                  }).Xa(function (e) {
                    return e.getSegments([b.key()]);
                  }).Xa(function (e) {
                    return {
                      uri: b,
                      data: e[0].data,
                      headers: {},
                      originalRequest: c
                    };
                  }).finally(function () {
                    return d.destroy();
                  });
                }
                S("shaka.offline.OfflineScheme", YB);
                YB.plugin = ZB;
                Ng("offline", ZB);
                function aC(a, b, c) {
                  var d, e, f, g, h, k;
                  return P(function (l) {
                    switch (l.g) {
                      case 1:
                        d = [];
                        for (var m = [], n = t(c), q = n.next(); !q.done; q = n.next()) {
                          q = q.value;
                          for (var r = false, u = t(m), v = u.next(); !v.done; v = u.next()) if (v = v.value, bC(v.info, q)) {
                            v.sessionIds.push(q.sessionId);
                            r = true;
                            break;
                          }
                          r || m.push({
                            info: q,
                            sessionIds: [q.sessionId]
                          });
                        }
                        e = t(m);
                        f = e.next();
                      case 2:
                        if (f.done) {
                          l.A(4);
                          break;
                        }
                        g = f.value;
                        h = cC(a, b, g);
                        return F(l, h, 5);
                      case 5:
                        k = l.h;
                        d = d.concat(k);
                        f = e.next();
                        l.A(2);
                        break;
                      case 4:
                        return l.return(d);
                    }
                  });
                }
                function cC(a, b, c) {
                  var d, e;
                  return P(function (f) {
                    switch (f.g) {
                      case 1:
                        return d = new vh({
                          tc: b,
                          onError: function onError() {},
                          vf: function vf() {},
                          onExpirationUpdated: function onExpirationUpdated() {},
                          onEvent: function onEvent() {}
                        }), ua(f, 2), d.configure(a), F(f, Gh(d, c.info.keySystem, c.info.licenseUri, c.info.serverCertificate, c.info.audioCapabilities, c.info.videoCapabilities), 4);
                      case 4:
                        xa(f, 3);
                        break;
                      case 2:
                        return ya(f), F(f, d.destroy(), 5);
                      case 5:
                        return f.return([]);
                      case 3:
                        return e = [], F(f, Promise.all(c.sessionIds.map(function (g) {
                          return P(function (h) {
                            if (h.g == 1) return ua(h, 2), F(h, Sh(d, g), 4);
                            if (h.g != 2) return e.push(g), xa(h, 0);
                            ya(h);
                            G(h);
                          });
                        })), 6);
                      case 6:
                        return F(f, d.destroy(), 7);
                      case 7:
                        return f.return(e);
                    }
                  });
                }
                function bC(a, b) {
                  function c(d, e) {
                    return d.robustness == e.robustness && d.contentType == e.contentType;
                  }
                  return a.keySystem == b.keySystem && a.licenseUri == b.licenseUri && kb(a.audioCapabilities, b.audioCapabilities, c) && kb(a.videoCapabilities, b.videoCapabilities, c);
                }
                function dC(a, b, c) {
                  var d = b.presentationTimeline.getDuration();
                  b = eC(b);
                  return {
                    offlineUri: null,
                    originalManifestUri: a,
                    duration: d,
                    size: 0,
                    expiration: Infinity,
                    tracks: b,
                    appMetadata: c,
                    isIncomplete: false
                  };
                }
                function fC(a, b) {
                  var c = SB(new RB(a.Pb(), a.bb()), b),
                    d = b.appMetadata || {};
                  c = eC(c);
                  return {
                    offlineUri: a.toString(),
                    originalManifestUri: b.originalManifestUri,
                    duration: b.duration,
                    size: b.size,
                    expiration: b.expiration,
                    tracks: c,
                    appMetadata: d,
                    isIncomplete: b.isIncomplete || false
                  };
                }
                function eC(a) {
                  var b = [],
                    c = dg(a.variants);
                  c = t(c);
                  for (var d = c.next(); !d.done; d = c.next()) b.push(Pf(d.value));
                  a = t(a.textStreams);
                  for (c = a.next(); !c.done; c = a.next()) b.push(Qf(c.value));
                  return b;
                }
                function gC() {
                  this.g = new Map();
                }
                function hC(a, b) {
                  var c = b.audio,
                    d = b.video;
                  c && !d && a.g.set(c.id, c.bandwidth || b.bandwidth);
                  !c && d && a.g.set(d.id, d.bandwidth || b.bandwidth);
                  if (c && d) {
                    var e = c.bandwidth || 393216,
                      f = d.bandwidth || b.bandwidth - e;
                    f <= 0 && (f = b.bandwidth);
                    a.g.set(c.id, e);
                    a.g.set(d.id, f);
                  }
                }
                function iC(a, b) {
                  a.g.set(b.id, b.bandwidth || 2048);
                }
                function jC(a, b) {
                  a = a.g.get(b);
                  a == null && (a = 0);
                  return a;
                }
                function kC(a) {
                  var b = this;
                  if (a && a.constructor != X) throw new U(2, 9, 9008);
                  this.g = this.h = null;
                  a ? (this.h = a.g, this.g = a.Wb()) : (this.h = Nn(), this.g = new Mg(), this.g.configure(this.h.networking));
                  this.i = [];
                  this.l = [];
                  var c = !a;
                  this.j = new Zg(function () {
                    var d, e, f, g, h;
                    return P(function (k) {
                      switch (k.g) {
                        case 1:
                          return F(k, Promise.all(b.l.map(function (l) {
                            return fB(l);
                          })), 2);
                        case 2:
                          d = function d() {};
                          e = [];
                          f = t(b.i);
                          for (g = f.next(); !g.done; g = f.next()) h = g.value, e.push(h.then(d, d));
                          return F(k, Promise.all(e), 3);
                        case 3:
                          if (!c) {
                            k.A(4);
                            break;
                          }
                          return F(k, b.g.destroy(), 4);
                        case 4:
                          b.h = null, b.g = null, G(k);
                      }
                    });
                  });
                  this.m = 1E9;
                }
                function lC() {
                  if (yi(tb())) a: {
                    var a = t(wB.values());
                    for (var b = a.next(); !b.done; b = a.next()) if (b = b.value, b = b()) {
                      b.destroy();
                      a = true;
                      break a;
                    }
                    a = false;
                  } else a = false;
                  return a;
                }
                p = kC.prototype;
                p.destroy = function () {
                  return this.j.destroy();
                };
                p.configure = function (a, b) {
                  arguments.length == 2 && typeof a == "string" && (a = rn(a, b));
                  return Sn(this.h, a);
                };
                p.getConfiguration = function () {
                  var a = Nn();
                  Sn(a, this.h, Nn());
                  return a;
                };
                p.Wb = function () {
                  return this.g;
                };
                p.store = function (a, b, c, d, e) {
                  var f = this,
                    g = this.getConfiguration(),
                    h = new eB(this.g);
                  this.l.push(h);
                  b = mC(this, a, b || {}, d || [], e || [], function () {
                    var k;
                    return P(function (l) {
                      if (l.g == 1) return c ? l.A(2) : F(l, No(a, f.g, g.manifest.retryParameters), 3);
                      l.g != 2 && (c = l.h);
                      k = Ai(a, c || null);
                      return l.return(k());
                    });
                  }, g, h);
                  b = new Ag(b, function () {
                    return fB(h);
                  });
                  b.finally(function () {
                    jb(f.l, h);
                  });
                  return nC(this, b);
                };
                function mC(a, b, c, d, e, f, g, h) {
                  var k, l, m, n, q, r, u, v, w, z, y, B, D, I, C, A, E, J, H, K, L, O, Q, N;
                  return P(function (M) {
                    switch (M.g) {
                      case 1:
                        return oC(), l = k = null, m = new vB(), r = q = n = null, ua(M, 2, 3), F(M, f(), 5);
                      case 5:
                        return k = M.h, F(M, pC(a, b, k, g), 6);
                      case 6:
                        u = M.h;
                        qC(a);
                        v = !u.presentationTimeline.W() && !u.presentationTimeline.Vc();
                        if (!v) throw new U(2, 9, 9005, b);
                        w = t(d);
                        z = w.next();
                      case 7:
                        if (z.done) {
                          M.A(9);
                          break;
                        }
                        y = z.value;
                        return F(M, rC(a, y, u), 10);
                      case 10:
                        B = M.h;
                        u.imageStreams.push(B);
                        qC(a);
                        z = w.next();
                        M.A(7);
                        break;
                      case 9:
                        D = t(e), I = D.next();
                      case 11:
                        if (I.done) return Ih(g.drm.clearKeys, u.variants), E = u.variants.some(function (R) {
                          if (R.audio) for (var T = t(R.audio.drmInfos), pa = T.next(); !pa.done; pa = T.next()) if (pa.value.licenseServerUri.startsWith("data:")) return true;
                          if (R.video) for (R = t(R.video.drmInfos), T = R.next(); !T.done; T = R.next()) if (T.value.licenseServerUri.startsWith("data:")) return true;
                          return false;
                        }), J = g.offline.usePersistentLicense, E && (J = false), F(M, a.md(u, function (R) {
                          r = r || R;
                        }, g, J), 15);
                        C = I.value;
                        return F(M, sC(a, u, C.uri, C.language, C.kind, C.mime, C.codecs), 14);
                      case 14:
                        A = M.h;
                        u.textStreams.push(A);
                        qC(a);
                        I = D.next();
                        M.A(11);
                        break;
                      case 15:
                        l = M.h;
                        qC(a);
                        if (r) throw r;
                        return F(M, tC(u, l, g, J), 16);
                      case 16:
                        return F(M, m.init(), 17);
                      case 17:
                        return qC(a), F(M, xB(m), 18);
                      case 18:
                        return n = M.h, qC(a), H = uC(l, u, b, c, g, h, J), K = H.rk, L = H.Ch, F(M, n.bb.addManifests([K]), 19);
                      case 19:
                        O = M.h;
                        qC(a);
                        q = O[0];
                        qC(a);
                        if (r) throw r;
                        return F(M, vC(a, L, q, K, h, g, n.bb, u, l, J), 20);
                      case 20:
                        return qC(a), wC(u, K, l, J), F(M, n.bb.updateManifest(q, K), 21);
                      case 21:
                        return qC(a), Q = new PB("manifest", n.path.Pb, n.path.bb, q), M.return(fC(Q, K));
                      case 3:
                        return Aa(M), F(M, m.destroy(), 22);
                      case 22:
                        if (!k) {
                          M.A(23);
                          break;
                        }
                        return F(M, k.stop(), 23);
                      case 23:
                        if (!l) {
                          M.A(25);
                          break;
                        }
                        return F(M, l.destroy(), 25);
                      case 25:
                        Da(M, 0);
                        break;
                      case 2:
                        N = ya(M);
                        if (q == null) {
                          M.A(27);
                          break;
                        }
                        return F(M, xC(q), 27);
                      case 27:
                        throw r || N;
                    }
                  });
                }
                function vC(a, b, c, d, e, f, g, h, k, l) {
                  var m, n, q, r, u, v, w, z, y, B, D;
                  return P(function (I) {
                    switch (I.g) {
                      case 1:
                        m = {};
                        n = 0;
                        q = function q() {
                          if (a.j.g || e.l) throw new U(2, 9, 7001);
                        };
                        r = function r(C, A) {
                          var E, J, H, K, L, O, Q, N, M;
                          return P(function (R) {
                            if (R.g == 1) {
                              E = t(C);
                              J = E.next();
                              for (H = {}; !J.done; H = {
                                kc: void 0
                              }, J = E.next()) H.kc = J.value, q(), K = aB(H.kc, f), L = H.kc.i, O = H.kc.h, Q = function (T) {
                                return function (pa) {
                                  var Y, Ha, Ba, Ca;
                                  return P(function (za) {
                                    switch (za.g) {
                                      case 1:
                                        Y = T.kc.g;
                                        Ha = Y.Yb(false);
                                        if (!Y.aesKey || Ha) {
                                          za.A(2);
                                          break;
                                        }
                                        return F(za, wm(pa, Y.aesKey, T.kc.j), 3);
                                      case 3:
                                        pa = za.h;
                                      case 2:
                                        return Ba = $A(Y), F(za, g.addSegments([{
                                          data: pa
                                        }]), 4);
                                      case 4:
                                        Ca = za.h, q(), m[Ba] = Ca[0], n += pa.byteLength, G(za);
                                    }
                                  });
                                };
                              }(H), N = H.kc.g, (M = N.Yb(false)) ? iB(e, H.kc.groupId, M, L, O, Q) : e.queue(H.kc.groupId, K, L, O, Q);
                              return F(R, jB(e), 2);
                            }
                            q();
                            if (!A || e.l) return R.A(0);
                            wC(h, d, k, l);
                            return F(R, g.updateManifest(c, d), 0);
                          });
                        };
                        u = false;
                        ua(I, 2);
                        if (!yC(h) || !u || zC(h)) {
                          I.A(4);
                          break;
                        }
                        return F(I, r(b.filter(function (C) {
                          return C.h;
                        }), true), 5);
                      case 5:
                        return q(), b = b.filter(function (C) {
                          return !C.h;
                        }), v = m, w = n, m = {}, n = 0, F(I, AC(g, c, d, v, w, function () {
                          return qC(a);
                        }), 6);
                      case 6:
                        q();
                      case 4:
                        if (u) {
                          I.A(7);
                          break;
                        }
                        return F(I, r(b, false), 8);
                      case 8:
                        return q(), z = m, y = n, m = {}, n = 0, F(I, AC(g, c, d, z, y, function () {
                          return q();
                        }), 9);
                      case 9:
                        q();
                      case 7:
                        xa(I, 0);
                        break;
                      case 2:
                        return B = ya(I), D = Object.values(m), F(I, g.removeSegments(D, function () {}), 10);
                      case 10:
                        throw B;
                    }
                  });
                }
                function xC(a) {
                  var b, c, d, e;
                  return P(function (f) {
                    switch (f.g) {
                      case 1:
                        return b = new vB(), F(f, b.init(), 2);
                      case 2:
                        return F(f, xB(b), 3);
                      case 3:
                        return c = f.h, d = new PB("manifest", c.path.Pb, c.path.bb, a), F(f, b.destroy(), 4);
                      case 4:
                        return e = new kC(), F(f, e.remove(d.toString()), 0);
                    }
                  });
                }
                function AC(a, b, c, d, e, f) {
                  var g, h, k, l, m, n, q, r, u, v, w;
                  return P(function (z) {
                    switch (z.g) {
                      case 1:
                        g = false;
                        ua(z, 2);
                        h = true;
                        k = t(c.streams);
                        for (l = k.next(); !l.done; l = k.next()) for (m = l.value, n = t(m.segments), q = n.next(); !q.done; q = n.next()) r = q.value, u = r.pendingSegmentRefId ? d[r.pendingSegmentRefId] : null, u != null && (r.dataKey = u, r.pendingSegmentRefId = void 0), u = r.pendingInitSegmentRefId ? d[r.pendingInitSegmentRefId] : null, u != null && (r.initSegmentKey = u, r.pendingInitSegmentRefId = void 0), r.pendingSegmentRefId && (h = false), r.pendingInitSegmentRefId && (h = false);
                        c.size += e;
                        h && (c.isIncomplete = false);
                        return F(z, a.updateManifest(b, c), 4);
                      case 4:
                        g = true;
                        f();
                        xa(z, 0);
                        break;
                      case 2:
                        return v = ya(z), F(z, xC(b), 5);
                      case 5:
                        if (g) {
                          z.A(6);
                          break;
                        }
                        w = Object.values(d);
                        return F(z, a.removeSegments(w, function () {}), 6);
                      case 6:
                        throw v;
                    }
                  });
                }
                function tC(a, b, c, d) {
                  var e, f, g, h, k, l, m, n, q, r, u, v, w, z, y, B, D, I, C, A, E, J, H, K, L, O, Q, N, M, R;
                  return P(function (T) {
                    switch (T.g) {
                      case 1:
                        return e = {
                          width: Infinity,
                          height: Infinity
                        }, wf(a, c.restrictions, e), F(T, zf(b, a, d, c.drm.preferredKeySystems, c.drm.keySystemsMapping), 2);
                      case 2:
                        f = [];
                        g = c.preferredDecodingAttributes;
                        h = c.preferredVideoCodecs;
                        k = c.preferredAudioCodecs;
                        l = c.preferredTextFormats;
                        uf(a, h, k, g, l);
                        m = t(a.variants);
                        for (n = m.next(); !n.done; n = m.next()) q = n.value, f.push(Pf(q));
                        r = t(a.textStreams);
                        for (u = r.next(); !u.done; u = r.next()) v = u.value, f.push(Qf(v));
                        w = t(a.imageStreams);
                        for (z = w.next(); !z.done; z = w.next()) y = z.value, f.push(Rf(y));
                        return F(T, c.offline.trackSelectionCallback(f), 3);
                      case 3:
                        B = T.h;
                        D = a.presentationTimeline.getDuration();
                        I = 0;
                        C = t(B);
                        for (A = C.next(); !A.done; A = C.next()) E = A.value, J = E.bandwidth * D / 8, I += J;
                        ua(T, 4);
                        return F(T, c.offline.downloadSizeCallback(I), 6);
                      case 6:
                        H = T.h;
                        if (!H) throw new U(2, 9, 9014);
                        xa(T, 5);
                        break;
                      case 4:
                        K = ya(T);
                        if (K instanceof U) throw K;
                        throw new U(2, 9, 9015);
                      case 5:
                        L = new Set();
                        O = new Set();
                        Q = new Set();
                        N = t(B);
                        for (M = N.next(); !M.done; M = N.next()) R = M.value, R.type == "variant" && L.add(R.id), R.type == "text" && O.add(R.id), R.type == "image" && Q.add(R.id);
                        a.variants = a.variants.filter(function (pa) {
                          return L.has(pa.id);
                        });
                        a.textStreams = a.textStreams.filter(function (pa) {
                          return O.has(pa.id);
                        });
                        a.imageStreams = a.imageStreams.filter(function (pa) {
                          return Q.has(pa.id);
                        });
                        BC(a);
                        G(T);
                    }
                  });
                }
                function uC(a, b, c, d, e, f, g) {
                  var h = dC(c, b, d),
                    k = e.offline.progressCallback;
                  gB(f, function (u, v) {
                    h.size = v;
                    k(h, u);
                  }, function (u, v) {
                    l && g && m == v && _Oh(a, "cenc", u);
                  });
                  var l = yC(b) && !zC(b),
                    m = null;
                  l && (m = CC.get(a.g.keySystem));
                  for (var n = new gC(), q = t(b.textStreams), r = q.next(); !r.done; r = q.next()) n.g.set(r.value.id, 52);
                  q = t(b.imageStreams);
                  for (r = q.next(); !r.done; r = q.next()) iC(n, r.value);
                  q = t(b.variants);
                  for (r = q.next(); !r.done; r = q.next()) hC(n, r.value);
                  f = DC(f, n, b, e);
                  e = f.streams;
                  f = f.Ch;
                  (n = a.g) && g && (n.initData = []);
                  return {
                    rk: {
                      creationTime: Date.now(),
                      originalManifestUri: c,
                      duration: b.presentationTimeline.getDuration(),
                      size: 0,
                      expiration: a.Wd(),
                      streams: e,
                      sessionIds: g ? Xh(a) : [],
                      drmInfo: n,
                      appMetadata: d,
                      isIncomplete: true,
                      sequenceMode: b.sequenceMode,
                      type: b.type
                    },
                    Ch: f
                  };
                }
                function yC(a) {
                  return a.variants.some(function (b) {
                    var c = b.audio && b.audio.encrypted;
                    return b.video && b.video.encrypted || c;
                  });
                }
                function zC(a) {
                  return a.variants.some(function (b) {
                    return (b.video ? b.video.drmInfos : []).concat(b.audio ? b.audio.drmInfos : []).some(function (c) {
                      return c.initData && c.initData.length;
                    });
                  });
                }
                function wC(a, b, c, d) {
                  b.expiration = c.Wd();
                  c = Xh(c);
                  b.sessionIds = d ? c : [];
                  if (yC(a) && d && !c.length) throw new U(2, 9, 9007);
                }
                p.remove = function (a) {
                  return EC(this, FC(this, a));
                };
                function FC(a, b) {
                  var c, d, e, f, g, h;
                  return P(function (k) {
                    switch (k.g) {
                      case 1:
                        oC();
                        c = QB(b);
                        if (c == null || c.g != "manifest") throw new U(2, 9, 9004, b);
                        d = c;
                        e = new vB();
                        va(k, 2);
                        return F(k, e.init(), 4);
                      case 4:
                        return F(k, zB(e, d.Pb(), d.bb()), 5);
                      case 5:
                        return f = k.h, F(k, f.getManifests([d.key()]), 6);
                      case 6:
                        return g = k.h, h = g[0], F(k, Promise.all([GC(a, h, e), HC(f, d, h)]), 2);
                      case 2:
                        return Aa(k), F(k, e.destroy(), 8);
                      case 8:
                        Da(k, 0);
                    }
                  });
                }
                function IC(a, b) {
                  for (var c = [], d = t(a.streams), e = d.next(); !e.done; e = d.next()) e = e.value, b && e.type == "video" ? c.push({
                    contentType: Fe(e.mimeType, e.codecs),
                    robustness: a.drmInfo.videoRobustness
                  }) : b || e.type != "audio" || c.push({
                    contentType: Fe(e.mimeType, e.codecs),
                    robustness: a.drmInfo.audioRobustness
                  });
                  return c;
                }
                function GC(a, b, c) {
                  return P(function (d) {
                    return F(d, JC(a.g, a.h.drm, c, b), 0);
                  });
                }
                function HC(a, b, c) {
                  function d() {}
                  var e = KC(c);
                  fC(b, c);
                  return Promise.all([a.removeSegments(e, d), a.removeManifests([b.key()], d)]);
                }
                p.Mk = function () {
                  return EC(this, LC(this));
                };
                function LC(a) {
                  var b, c, d, e, f, g, h, k, l, m;
                  return P(function (n) {
                    switch (n.g) {
                      case 1:
                        return oC(), b = a.g, c = a.h.drm, d = new vB(), e = false, va(n, 2), F(n, d.init(), 4);
                      case 4:
                        f = [], AB(d, function (q) {
                          return f.push(q);
                        }), g = t(f), h = g.next();
                      case 5:
                        if (h.done) {
                          n.A(2);
                          break;
                        }
                        k = h.value;
                        return F(n, k.getAll(), 8);
                      case 8:
                        return l = n.h, F(n, aC(c, b, l), 9);
                      case 9:
                        return m = n.h, F(n, k.remove(m), 10);
                      case 10:
                        m.length != l.length && (e = true);
                        h = g.next();
                        n.A(5);
                        break;
                      case 2:
                        return Aa(n), F(n, d.destroy(), 11);
                      case 11:
                        Da(n, 3);
                        break;
                      case 3:
                        return n.return(!e);
                    }
                  });
                }
                p.list = function () {
                  return EC(this, MC());
                };
                function MC() {
                  var a, b, c;
                  return P(function (d) {
                    switch (d.g) {
                      case 1:
                        return oC(), a = [], b = new vB(), va(d, 2), F(d, b.init(), 4);
                      case 4:
                        return c = Promise.resolve(), yB(b, function (e, f) {
                          c = c.then(function () {
                            var g;
                            return P(function (h) {
                              if (h.g == 1) return F(h, f.getAllManifests(), 2);
                              g = h.h;
                              g.forEach(function (k, l) {
                                k = fC(new PB("manifest", e.Pb, e.bb, l), k);
                                a.push(k);
                              });
                              G(h);
                            });
                          });
                        }), F(d, c, 2);
                      case 2:
                        return Aa(d), F(d, b.destroy(), 6);
                      case 6:
                        Da(d, 3);
                        break;
                      case 3:
                        return d.return(a);
                    }
                  });
                }
                function pC(a, b, c, d) {
                  var e, f, g, h, k;
                  return P(function (l) {
                    if (l.g == 1) return e = null, f = a.g, g = {
                      networkingEngine: f,
                      filter: function filter() {
                        return Promise.resolve();
                      },
                      makeTextStreamsForClosedCaptions: function makeTextStreamsForClosedCaptions() {},
                      onTimelineRegionAdded: function onTimelineRegionAdded() {},
                      onEvent: function onEvent() {},
                      onError: function onError(m) {
                        e = m;
                      },
                      isLowLatencyMode: function isLowLatencyMode() {
                        return false;
                      },
                      updateDuration: function updateDuration() {},
                      newDrmInfo: function newDrmInfo() {},
                      onManifestUpdated: function onManifestUpdated() {},
                      getBandwidthEstimate: function getBandwidthEstimate() {
                        return d.abr.defaultBandwidthEstimate;
                      },
                      onMetadata: function onMetadata() {},
                      disableStream: function disableStream() {},
                      addFont: function addFont() {}
                    }, c.configure(d.manifest), qC(a), F(l, c.start(b, g), 2);
                    if (l.g != 3) return h = l.h, qC(a), k = NC(h), F(l, Promise.all(ah(k, function (m) {
                      return m.createSegmentIndex();
                    })), 3);
                    qC(a);
                    if (e) throw e;
                    return l.return(h);
                  });
                }
                function rC(a, b, c) {
                  var d, e, f, g, h, k, l, m, n, q, r, u, v, w, z;
                  return P(function (y) {
                    switch (y.g) {
                      case 1:
                        return F(y, OC(a, b), 2);
                      case 2:
                        d = y.h;
                        if (d != "text/vtt") throw new U(1, 2, 2017, b);
                        return F(y, PC(b, a.g, a.h.streaming.retryParameters), 3);
                      case 3:
                        e = y.h;
                        f = Ue(d);
                        if (!f) throw new U(2, 2, 2014, d);
                        g = f();
                        h = {
                          periodStart: 0,
                          segmentStart: 0,
                          segmentEnd: c.presentationTimeline.getDuration(),
                          vttOffset: 0
                        };
                        k = Vb(e);
                        l = g.parseMedia(k, h, b, []);
                        m = [];
                        n = t(l);
                        q = n.next();
                        for (r = {}; !q.done; r = {
                          Rf: void 0,
                          od: void 0
                        }, q = n.next()) r.od = q.value, r.Rf = null, u = function (B) {
                          return function () {
                            B.Rf == null && (B.Rf = uc([b], [B.od.payload]));
                            return B.Rf || [];
                          };
                        }(r), v = new rj(r.od.startTime, r.od.endTime, u, 0, null, null, 0, 0, Infinity), r.od.payload.includes("#xywh") && (w = r.od.payload.split("#xywh=")[1].split(","), w.length === 4 && v.If({
                          height: parseInt(w[3], 10),
                          positionX: parseInt(w[0], 10),
                          positionY: parseInt(w[1], 10),
                          width: parseInt(w[2], 10)
                        })), m.push(v);
                        z = d;
                        if (!m.length) {
                          y.A(4);
                          break;
                        }
                        return F(y, No(m[0].P()[0], a.g, a.h.manifest.retryParameters), 5);
                      case 5:
                        z = y.h;
                      case 4:
                        return y.return({
                          id: a.m++,
                          originalId: null,
                          groupId: null,
                          createSegmentIndex: function createSegmentIndex() {
                            return Promise.resolve();
                          },
                          segmentIndex: new Nl(m),
                          mimeType: z || "",
                          codecs: "",
                          kind: "",
                          encrypted: false,
                          drmInfos: [],
                          keyIds: new Set(),
                          language: "und",
                          originalLanguage: null,
                          label: null,
                          type: "image",
                          primary: false,
                          trickModeVideo: null,
                          dependencyStream: null,
                          emsgSchemeIdUris: null,
                          roles: [],
                          forced: false,
                          channelsCount: null,
                          audioSamplingRate: null,
                          spatialAudio: false,
                          closedCaptions: null,
                          tilesLayout: "1x1",
                          accessibilityPurpose: null,
                          external: true,
                          fastSwitching: false,
                          fullMimeTypes: new Set([Fe(z || "", "")]),
                          isAudioMuxedInVideo: false,
                          baseOriginalId: null
                        });
                    }
                  });
                }
                function sC(a, b, c, d, e, f, g) {
                  var h, k, l;
                  return P(function (m) {
                    if (m.g == 1) return f ? m.A(2) : F(m, OC(a, c), 3);
                    m.g != 2 && (f = m.h);
                    h = {
                      id: a.m++,
                      originalId: null,
                      groupId: null,
                      createSegmentIndex: function createSegmentIndex() {
                        return Promise.resolve();
                      },
                      segmentIndex: Pl(0, b.presentationTimeline.getDuration(), [c]),
                      mimeType: f || "",
                      codecs: g || "",
                      kind: e,
                      encrypted: false,
                      drmInfos: [],
                      keyIds: new Set(),
                      language: d,
                      originalLanguage: d,
                      label: null,
                      type: Ac,
                      primary: false,
                      trickModeVideo: null,
                      dependencyStream: null,
                      emsgSchemeIdUris: null,
                      roles: [],
                      forced: false,
                      channelsCount: null,
                      audioSamplingRate: null,
                      spatialAudio: false,
                      closedCaptions: null,
                      accessibilityPurpose: null,
                      external: true,
                      fastSwitching: false,
                      fullMimeTypes: new Set([Fe(f || "", g || "")]),
                      isAudioMuxedInVideo: false,
                      baseOriginalId: null
                    };
                    k = Fe(h.mimeType, h.codecs);
                    l = Ve(k);
                    if (!l) throw new U(2, 2, 2014, f);
                    return m.return(h);
                  });
                }
                function OC(a, b) {
                  var c;
                  return P(function (d) {
                    switch (d.g) {
                      case 1:
                        return ua(d, 2), F(d, No(b, a.g, a.h.streaming.retryParameters), 4);
                      case 4:
                        c = d.h;
                        xa(d, 3);
                        break;
                      case 2:
                        ya(d);
                      case 3:
                        if (c) return d.return(c);
                        throw new U(1, 2, 2011, b);
                    }
                  });
                }
                function PC(a, b, c) {
                  var d, e, f;
                  return P(function (g) {
                    if (g.g == 1) return d = Xg, e = Rg([a], c), e.method = "GET", F(g, b.request(d, e).promise, 2);
                    f = g.h;
                    return g.return(f.data);
                  });
                }
                p.md = function (a, b, c, d) {
                  var e = this,
                    f;
                  return P(function (g) {
                    return g.g == 1 ? (f = new vh({
                      tc: e.g,
                      onError: b,
                      vf: function vf() {},
                      onExpirationUpdated: function onExpirationUpdated() {},
                      onEvent: function onEvent() {}
                    }), f.configure(c.drm), F(g, Ah(f, a.variants, d), 2)) : g.g != 3 ? F(g, Qh(f), 3) : g.return(f);
                  });
                };
                function DC(a, b, c, d) {
                  var e = new Map(),
                    f = NC(c),
                    g = new Map();
                  f = t(f);
                  for (var h = f.next(); !h.done; h = f.next()) {
                    h = h.value;
                    var k = QC(a, b, c, h, d, e);
                    g.set(h.id, k);
                  }
                  a = t(c.variants);
                  for (b = a.next(); !b.done; b = a.next()) b = b.value, b.audio && g.get(b.audio.id).variantIds.push(b.id), b.video && g.get(b.video.id).variantIds.push(b.id);
                  return {
                    streams: Array.from(g.values()),
                    Ch: Array.from(e.values())
                  };
                }
                function QC(a, b, c, d, e, f) {
                  var g = {
                      id: d.id,
                      originalId: d.originalId,
                      groupId: d.groupId,
                      primary: d.primary,
                      type: d.type,
                      mimeType: d.mimeType,
                      codecs: d.codecs,
                      frameRate: d.frameRate,
                      pixelAspectRatio: d.pixelAspectRatio,
                      hdr: d.hdr,
                      colorGamut: d.colorGamut,
                      videoLayout: d.videoLayout,
                      kind: d.kind,
                      language: d.language,
                      originalLanguage: d.originalLanguage,
                      label: d.label,
                      width: d.width || null,
                      height: d.height || null,
                      encrypted: d.encrypted,
                      keyIds: d.keyIds,
                      segments: [],
                      variantIds: [],
                      roles: d.roles,
                      forced: d.forced,
                      channelsCount: d.channelsCount,
                      audioSamplingRate: d.audioSamplingRate,
                      spatialAudio: d.spatialAudio,
                      closedCaptions: d.closedCaptions,
                      tilesLayout: d.tilesLayout,
                      mssPrivateData: d.mssPrivateData,
                      external: d.external,
                      fastSwitching: d.fastSwitching,
                      isAudioMuxedInVideo: d.isAudioMuxedInVideo
                    },
                    h = e.offline.numberOfParallelDownloads,
                    k = h === 0 ? d.id : 0;
                  RC(d, c.presentationTimeline.Hb(), function (l, m) {
                    var n = $A(l),
                      q = void 0;
                    if (!f.has(n)) {
                      var r = l.endTime - l.startTime;
                      r = jC(b, d.id) * r;
                      r = cB(a.g, r);
                      f.set(n, new ZA(l, r, k, false, m));
                    }
                    l.ba && (q = $A(l.ba), f.has(q) || (r = jC(b, d.id) * .5, r = cB(a.g, r), f.set(q, new ZA(l.ba, r, k, true, m))));
                    g.segments.push({
                      pendingInitSegmentRefId: q,
                      initSegmentKey: q ? 0 : null,
                      startTime: l.startTime,
                      endTime: l.endTime,
                      appendWindowStart: l.appendWindowStart,
                      appendWindowEnd: l.appendWindowEnd,
                      timestampOffset: l.timestampOffset,
                      tilesLayout: l.tilesLayout,
                      pendingSegmentRefId: n,
                      dataKey: 0,
                      mimeType: l.mimeType,
                      codecs: l.codecs,
                      thumbnailSprite: l.thumbnailSprite
                    });
                    h !== 0 && (k = (k + 1) % h);
                  });
                  return g;
                }
                function RC(a, b, c) {
                  b = a.segmentIndex.find(b);
                  if (b != null) for (var d = a.segmentIndex.get(b); d;) c(d, b), d = a.segmentIndex.get(++b);
                }
                function qC(a) {
                  if (a.j.g) throw new U(2, 9, 7001);
                }
                function oC() {
                  if (!lC()) throw new U(2, 9, 9E3);
                }
                function EC(a, b) {
                  return P(function (c) {
                    if (c.g == 1) return a.i.push(b), va(c, 2), F(c, b, 4);
                    if (c.g != 2) return c.return(c.h);
                    Aa(c);
                    jb(a.i, b);
                    return Da(c, 0);
                  });
                }
                function nC(a, b) {
                  var c = b.promise;
                  a.i.push(c);
                  return b.finally(function () {
                    jb(a.i, c);
                  });
                }
                function KC(a) {
                  var b = new Set();
                  a = t(a.streams);
                  for (var c = a.next(); !c.done; c = a.next()) {
                    c = t(c.value.segments);
                    for (var d = c.next(); !d.done; d = c.next()) d = d.value, d.initSegmentKey != null && b.add(d.initSegmentKey), b.add(d.dataKey);
                  }
                  return Array.from(b);
                }
                function JC(a, b, c, d) {
                  var e, f, g;
                  return P(function (h) {
                    if (h.g == 1) {
                      if (!d.drmInfo) return h.return();
                      e = BB(c);
                      f = d.sessionIds.map(function (k) {
                        return {
                          sessionId: k,
                          keySystem: d.drmInfo.keySystem,
                          licenseUri: d.drmInfo.licenseServerUri,
                          serverCertificate: d.drmInfo.serverCertificate,
                          audioCapabilities: IC(d, false),
                          videoCapabilities: IC(d, true)
                        };
                      });
                      return F(h, aC(b, a, f), 2);
                    }
                    return h.g != 3 ? (g = h.h, F(h, e.remove(g), 3)) : F(h, e.add(f.filter(function (k) {
                      return !g.includes(k.sessionId);
                    })), 0);
                  });
                }
                function NC(a) {
                  for (var b = new Set(), c = t(a.variants), d = c.next(); !d.done; d = c.next()) d = d.value, d.audio && b.add(d.audio), d.video && b.add(d.video);
                  c = t(a.textStreams);
                  for (d = c.next(); !d.done; d = c.next()) b.add(d.value);
                  a = t(a.imageStreams);
                  for (c = a.next(); !c.done; c = a.next()) b.add(c.value);
                  return b;
                }
                function BC(a) {
                  a.variants.map(function (f) {
                    return f.video;
                  });
                  var b = new Set(a.variants.map(function (f) {
                    return f.audio;
                  }));
                  a = a.textStreams;
                  for (var c = t(b), d = c.next(); !d.done; d = c.next()) {
                    d = t(b);
                    for (var e = d.next(); !e.done; e = d.next());
                  }
                  b = t(a);
                  for (c = b.next(); !c.done; c = b.next()) for (c = t(a), d = c.next(); !d.done; d = c.next());
                }
                S("shaka.offline.Storage", kC);
                kC.deleteAll = function () {
                  var a;
                  return P(function (b) {
                    return b.g == 1 ? (a = new vB(), va(b, 2), F(b, CB(a), 2)) : b.g != 5 ? (Aa(b), F(b, a.destroy(), 5)) : Da(b, 0);
                  });
                };
                kC.prototype.list = kC.prototype.list;
                kC.prototype.removeEmeSessions = kC.prototype.Mk;
                kC.prototype.remove = kC.prototype.remove;
                kC.prototype.store = kC.prototype.store;
                kC.prototype.getNetworkingEngine = kC.prototype.Wb;
                kC.prototype.getConfiguration = kC.prototype.getConfiguration;
                kC.prototype.configure = kC.prototype.configure;
                kC.prototype.destroy = kC.prototype.destroy;
                kC.support = lC;
                var CC = new Map().set("org.w3.clearkey", "1077efecc0b24d02ace33c1e52e2fb4b").set("com.widevine.alpha", "edef8ba979d64acea3c827dcd51d21ed").set("com.microsoft.playready", "9a04f07998404286ab92e65be0885f95").set("com.microsoft.playready.recommendation", "9a04f07998404286ab92e65be0885f95").set("com.microsoft.playready.software", "9a04f07998404286ab92e65be0885f95").set("com.microsoft.playready.hardware", "9a04f07998404286ab92e65be0885f95").set("com.huawei.wiseplay", "3d5e6d359b9a41e8b843dd3c6e72c42c");
                Lq("offline", lC);
                function SC() {}
                function TC(a, b) {
                  a = {
                    priority: b || 0,
                    callback: a
                  };
                  for (b = 0; b < UC.length; b++) if (UC[b].priority < a.priority) {
                    UC.splice(b, 0, a);
                    return;
                  }
                  UC.push(a);
                }
                S("shaka.polyfill", SC);
                SC.register = TC;
                SC.installAll = function () {
                  for (var a = t(UC), b = a.next(); !b.done; b = a.next()) {
                    b = b.value;
                    try {
                      b.callback();
                    } catch (c) {
                      ab("Error installing polyfill!", c);
                    }
                  }
                };
                var UC = [];
                function VC() {}
                function WC() {
                  if (!Object.getOwnPropertyDescriptor(Element.prototype, "ariaHidden")) for (var a = t(["ariaHidden", "ariaLabel", "ariaPressed", "ariaSelected"]), b = a.next(); !b.done; b = a.next()) XC(b.value);
                }
                function XC(a) {
                  var b = "aria-" + a.toLowerCase().replace(/^aria/, "");
                  Object.defineProperty(Element.prototype, a, {
                    get: function get() {
                      return this.getAttribute(b);
                    },
                    set: function set(c) {
                      c == null || c == void 0 ? this.removeAttribute(b) : this.setAttribute(b, c);
                    }
                  });
                }
                SC.Aria = VC;
                VC.install = WC;
                TC(WC);
                function YC(a, b, c) {
                  this.g = a;
                  this.i = b || null;
                  this.h = c || null;
                  this.keySystem = a.keySystem;
                }
                YC.prototype.getConfiguration = function () {
                  var a = this.g.getConfiguration();
                  if (a.videoCapabilities) for (var b = t(a.videoCapabilities), c = b.next(); !c.done; c = b.next()) c.value.encryptionScheme = this.i;
                  if (a.audioCapabilities) for (b = t(a.audioCapabilities), c = b.next(); !c.done; c = b.next()) c.value.encryptionScheme = this.h;
                  return a;
                };
                YC.prototype.createMediaKeys = function () {
                  return this.g.createMediaKeys();
                };
                function ZC(a) {
                  if (a.startsWith("com.apple")) return "cbcs";
                  if (a.startsWith("com.widevine") || a.startsWith("com.microsoft") || a.startsWith("com.chromecast") || a.startsWith("org.w3") || a.startsWith("com.huawei")) return "cenc";
                  ab("EmeEncryptionSchemePolyfill: Unknown key system:", a, "Please contribute!");
                  return null;
                }
                function $C(a) {
                  if (!a) return false;
                  a = a.getConfiguration();
                  var b = a.audioCapabilities && a.audioCapabilities[0];
                  return (a = a.videoCapabilities && a.videoCapabilities[0] || b) && a.encryptionScheme !== void 0 ? true : false;
                }
                function aD(a, b) {
                  return !a || a == b || (a == "cbcs" || a == "cbcs-1-9") && tb().ed() ? true : false;
                }
                function bD() {}
                var cD;
                function dD() {
                  tb().Kf() && !cD && !navigator.emeEncryptionSchemePolyfilled && navigator.requestMediaKeySystemAccess && MediaKeySystemAccess.prototype.getConfiguration && (cD = navigator.requestMediaKeySystemAccess, navigator.requestMediaKeySystemAccess = eD, navigator.emeEncryptionSchemePolyfilled = true);
                }
                function eD(a, b) {
                  var c = this,
                    d;
                  return P(function (f) {
                    if (f.g == 1) return F(f, cD.call(c, a, b), 2);
                    d = f.h;
                    if ($C(d)) return navigator.requestMediaKeySystemAccess = cD, f.return(d);
                    navigator.requestMediaKeySystemAccess = fD;
                    return f.return(fD.call(c, a, b));
                  });
                }
                function fD(a, b) {
                  var c = this,
                    d,
                    e,
                    f,
                    g,
                    h,
                    k,
                    l,
                    m,
                    n,
                    q,
                    r,
                    u;
                  return P(function (v) {
                    if (v.g == 1) {
                      d = ZC(a);
                      e = [];
                      f = t(b);
                      for (g = f.next(); !g.done; g = f.next()) h = g.value, k = gD(h.videoCapabilities, d), l = gD(h.audioCapabilities, d), h.videoCapabilities && h.videoCapabilities.length && !k.length || h.audioCapabilities && h.audioCapabilities.length && !l.length || (m = Object.assign({}, h), m.videoCapabilities = k, m.audioCapabilities = l, e.push(m));
                      if (!e.length) throw n = Error("Unsupported keySystem or supportedConfigurations."), n.name = "NotSupportedError", n.code = DOMException.NOT_SUPPORTED_ERR, n;
                      return F(v, cD.call(c, a, e), 2);
                    }
                    q = v.h;
                    u = r = null;
                    e[0] && (e[0].videoCapabilities && (r = e[0].videoCapabilities[0].encryptionScheme), e[0].audioCapabilities && (u = e[0].audioCapabilities[0].encryptionScheme));
                    return v.return(new YC(q, r, u));
                  });
                }
                function gD(a, b) {
                  return a ? a.filter(function (c) {
                    return aD(c.encryptionScheme, b);
                  }) : a;
                }
                SC.EmeEncryptionScheme = bD;
                bD.install = dD;
                TC(dD);
                function hD() {}
                function iD() {
                  if (window.Document) {
                    var a = Element.prototype;
                    a.requestFullscreen = a.requestFullscreen || a.mozRequestFullScreen || a.msRequestFullscreen || a.webkitRequestFullscreen;
                    a = Document.prototype;
                    a.exitFullscreen = a.exitFullscreen || a.mozCancelFullScreen || a.msExitFullscreen || a.webkitCancelFullScreen;
                    "fullscreenElement" in document || (Object.defineProperty(document, "fullscreenElement", {
                      get: function get() {
                        return document.mozFullScreenElement || document.msFullscreenElement || document.webkitCurrentFullScreenElement || document.webkitFullscreenElement;
                      }
                    }), Object.defineProperty(document, "fullscreenEnabled", {
                      get: function get() {
                        return document.mozFullScreenEnabled || document.msFullscreenEnabled || document.webkitFullscreenEnabled;
                      }
                    }));
                    document.addEventListener("webkitfullscreenchange", jD);
                    document.addEventListener("webkitfullscreenerror", jD);
                    document.addEventListener("mozfullscreenchange", jD);
                    document.addEventListener("mozfullscreenerror", jD);
                    document.addEventListener("MSFullscreenChange", jD);
                    document.addEventListener("MSFullscreenError", jD);
                  }
                }
                function jD(a) {
                  var b = a.type.replace(/^(webkit|moz|MS)/, "").toLowerCase(),
                    c = document.createEvent("Event");
                  c.initEvent(b, a.bubbles, a.cancelable);
                  a.target.dispatchEvent(c);
                }
                SC.Fullscreen = hD;
                hD.install = iD;
                TC(iD);
                function kD() {}
                var lD;
                function mD() {
                  tb().Kf() && !lD && !navigator.mediaCapabilitiesEncryptionSchemePolyfilled && navigator.mediaCapabilities && (lD = navigator.mediaCapabilities.decodingInfo, navigator.mediaCapabilities.decodingInfo = nD, navigator.mediaCapabilitiesEncryptionSchemePolyfilled = true);
                }
                function nD(a) {
                  var b = this,
                    c,
                    d;
                  return P(function (f) {
                    switch (f.g) {
                      case 1:
                        return F(f, lD.call(b, a), 2);
                      case 2:
                        c = f.h;
                        if (!c.supported || !a.keySystemConfiguration) return f.return(c);
                        d = c.keySystemAccess;
                        if ($C(d)) return navigator.mediaCapabilities.decodingInfo = lD, f.return(c);
                        navigator.mediaCapabilities.decodingInfo = oD;
                        if (d) {
                          f.A(3);
                          break;
                        }
                        return F(f, pD(a), 4);
                      case 4:
                        return c.keySystemAccess = f.h, f.return(c);
                      case 3:
                        return f.return(oD.call(b, a));
                    }
                  });
                }
                function oD(a) {
                  var b = this,
                    c,
                    d,
                    e,
                    f,
                    g,
                    h,
                    k;
                  return P(function (l) {
                    switch (l.g) {
                      case 1:
                        return d = c = null, !a.keySystemConfiguration || (e = a.keySystemConfiguration, f = e.keySystem, d = e.audio && e.audio.encryptionScheme, c = e.video && e.video.encryptionScheme, g = ZC(f), h = {
                          powerEfficient: false,
                          smooth: false,
                          supported: false,
                          keySystemAccess: null,
                          configuration: a
                        }, aD(d, g) && aD(c, g)) ? F(l, lD.call(b, a), 2) : l.return(h);
                      case 2:
                        k = l.h;
                        if (k.keySystemAccess) {
                          k.keySystemAccess = new YC(k.keySystemAccess, c, d);
                          l.A(3);
                          break;
                        }
                        if (!a.keySystemConfiguration) {
                          l.A(3);
                          break;
                        }
                        return F(l, pD(a), 5);
                      case 5:
                        k.keySystemAccess = l.h;
                      case 3:
                        return l.return(k);
                    }
                  });
                }
                function pD(a) {
                  var b, c;
                  return P(function (d) {
                    if (d.g == 1) {
                      var e = a.keySystemConfiguration,
                        f = [],
                        g = [];
                      e.audio && f.push({
                        robustness: e.audio.robustness || "",
                        contentType: a.audio.contentType,
                        encryptionScheme: e.audio.encryptionScheme
                      });
                      e.video && g.push({
                        robustness: e.video.robustness || "",
                        contentType: a.video.contentType,
                        encryptionScheme: e.video.encryptionScheme
                      });
                      e = {
                        initDataTypes: e.initDataType ? [e.initDataType] : [],
                        distinctiveIdentifier: e.distinctiveIdentifier,
                        persistentState: e.persistentState,
                        sessionTypes: e.sessionTypes
                      };
                      f.length && (e.audioCapabilities = f);
                      g.length && (e.videoCapabilities = g);
                      b = e;
                      return F(d, navigator.requestMediaKeySystemAccess(a.keySystemConfiguration.keySystem, [b]), 2);
                    }
                    c = d.h;
                    return d.return(c);
                  });
                }
                SC.MCapEncryptionScheme = kD;
                kD.install = mD;
                TC(mD, -2);
                function qD() {}
                function rD() {
                  tb().cc() || (navigator.mediaCapabilities || (navigator.mediaCapabilities = {}), qD.originalMcap = navigator.mediaCapabilities, navigator.mediaCapabilities.decodingInfo = sD);
                }
                function sD(a) {
                  var b, c, d, e, f, g, h, k, l, m, n;
                  return P(function (q) {
                    switch (q.g) {
                      case 1:
                        b = {
                          supported: false,
                          powerEfficient: true,
                          smooth: true,
                          keySystemAccess: null,
                          configuration: a
                        };
                        tb();
                        c = a.video;
                        d = a.audio;
                        if (a.type != "media-source") {
                          if (a.type == "file") {
                            if (c && (e = c.contentType, f = zi().canPlayType(e) != "", !f) || d && (g = d.contentType, h = zi().canPlayType(g) != "", !h)) return q.return(b);
                          } else return q.return(b);
                          q.A(2);
                          break;
                        }
                        if (!yi()) return q.return(b);
                        if (!c) {
                          q.A(3);
                          break;
                        }
                        return F(q, tD(c), 4);
                      case 4:
                        if (k = q.h, !k) return q.return(b);
                      case 3:
                        if (d) {
                          var r = tb().Ua(),
                            u = d.contentType;
                          r === "CAST" && d.spatialRendering && (u += "; spatialRendering=true");
                          l = Ic(u);
                          if (!l) return q.return(b);
                        }
                      case 2:
                        if (!a.keySystemConfiguration) return b.supported = true, q.return(b);
                        m = a.keySystemConfiguration;
                        return F(q, uD(c, d, m), 6);
                      case 6:
                        if (n = q.h) b.supported = true, b.keySystemAccess = n;
                      case 5:
                        return q.return(b);
                    }
                  });
                }
                function tD(a) {
                  var b, c, d;
                  return P(function (e) {
                    return e.g == 1 ? (b = tb(), c = b.Ua(), c !== "CAST" ? e.A(2) : F(e, vD(a), 3)) : e.g != 2 ? (d = e.h, e.return(d)) : e.return(Ic(a.contentType));
                  });
                }
                function uD(a, b, c) {
                  var d, e, f, g, h, k, l, m, n, q, r;
                  return P(function (u) {
                    switch (u.g) {
                      case 1:
                        d = [];
                        e = [];
                        c.audio && (f = {
                          robustness: c.audio.robustness || "",
                          contentType: b.contentType
                        }, tb().ti() && b.contentType.includes('codecs="ac-3"') && (f.contentType = 'audio/mp4; codecs="ec-3"'), c.audio.encryptionScheme && (f.encryptionScheme = c.audio.encryptionScheme), d.push(f));
                        c.video && (g = {
                          robustness: c.video.robustness || "",
                          contentType: a.contentType
                        }, c.video.encryptionScheme && (g.encryptionScheme = c.video.encryptionScheme), e.push(g));
                        h = {
                          initDataTypes: [c.initDataType],
                          distinctiveIdentifier: c.distinctiveIdentifier,
                          persistentState: c.persistentState,
                          sessionTypes: c.sessionTypes
                        };
                        d.length && (h.audioCapabilities = d);
                        e.length && (h.videoCapabilities = e);
                        k = a ? a.contentType : "";
                        l = b ? b.contentType : "";
                        m = Ne(k) + ";" + Me(k);
                        n = Ne(l) + ";" + Me(l);
                        q = c.keySystem;
                        r = null;
                        ua(u, 2);
                        if (vg.has(m + "#" + n + "#" + q)) {
                          r = vg.get(m + "#" + n + "#" + q) || null;
                          u.A(4);
                          break;
                        }
                        return F(u, navigator.requestMediaKeySystemAccess(c.keySystem, [h]), 5);
                      case 5:
                        r = u.h, vg.set(m + "#" + n + "#" + q, r);
                      case 4:
                        xa(u, 3);
                        break;
                      case 2:
                        ya(u);
                      case 3:
                        return u.return(r);
                    }
                  });
                }
                function vD(a) {
                  var b, c, d, e, f;
                  return P(function (g) {
                    if (g.g == 1) {
                      if (!(window.cast && cast.__platform__ && cast.__platform__.canDisplayType)) return g.return(Ic(a.contentType));
                      b = a.contentType;
                      a.width && a.height && a.width > 1280 && a.height > 720 && (b += "; width=" + a.width + "; height=" + a.height);
                      a.framerate && (c = Math.round(a.framerate), c < 24 || c > 30) && (b += "; framerate=" + a.framerate);
                      d = a.transferFunction || "";
                      switch (d) {
                        case "":
                        case "srgb":
                          break;
                        case "pq":
                          b += "; eotf=smpte2084";
                          break;
                        case "hlg":
                          b += "; eotf=arib-std-b67";
                          break;
                        default:
                          return g.return(false);
                      }
                      e = false;
                      f = wD;
                      return f.has(b) ? (e = f.get(b), g.A(2)) : F(g, cast.__platform__.canDisplayType(b), 3);
                    }
                    g.g != 2 && (e = g.h, f.set(b, e));
                    return g.return(e);
                  });
                }
                SC.MediaCapabilities = qD;
                qD.install = rD;
                qD.originalMcap = null;
                var wD = new Map();
                TC(rD, -1);
                function xD() {}
                function yD() {
                  var a = tb(),
                    b = a.Ha() === "WEBKIT" ? a.za() : null;
                  (window.MediaSource || window.ManagedMediaSource) && b && window.MediaSource && (b <= 12 ? (zD(), AD()) : b <= 15 && zD());
                  a = t(a.Fi());
                  for (b = a.next(); !b.done; b = a.next()) BD(b.value);
                  (window.MediaSource || window.ManagedMediaSource) && CD();
                  window.MediaSource && MediaSource.isTypeSupported('video/webm; codecs="vp9"') && !MediaSource.isTypeSupported('video/webm; codecs="vp09.00.10.08"') && DD();
                }
                function zD() {
                  var a = MediaSource.prototype.addSourceBuffer;
                  MediaSource.prototype.addSourceBuffer = function () {
                    var b = a.apply(this, Oa.apply(0, arguments));
                    b.abort = function () {};
                    return b;
                  };
                }
                function AD() {
                  var a = SourceBuffer.prototype.remove;
                  SourceBuffer.prototype.remove = function (b, c) {
                    return a.call(this, b, c - .001);
                  };
                }
                function CD() {
                  if (window.MediaSource) {
                    var a = MediaSource.isTypeSupported.bind(MediaSource);
                    MediaSource.isTypeSupported = function (c) {
                      return Je(c) != "mp2t" && a(c);
                    };
                  }
                  if (window.ManagedMediaSource) {
                    var b = ManagedMediaSource.isTypeSupported.bind(ManagedMediaSource);
                    window.ManagedMediaSource.isTypeSupported = function (c) {
                      return Je(c) != "mp2t" && b(c);
                    };
                  }
                }
                function BD(a) {
                  var b = MediaSource.isTypeSupported.bind(MediaSource);
                  MediaSource.isTypeSupported = function (d) {
                    return Me(d) != a && b(d);
                  };
                  if (window.ManagedMediaSource) {
                    var c = ManagedMediaSource.isTypeSupported.bind(ManagedMediaSource);
                    window.ManagedMediaSource.isTypeSupported = function (d) {
                      return Me(d) != a && c(d);
                    };
                  }
                }
                function DD() {
                  var a = MediaSource.isTypeSupported;
                  tb().aj() && (MediaSource.isTypeSupported = function (b) {
                    var c = b.split(/ *; */),
                      d = c.findIndex(function (g) {
                        return g.startsWith("codecs=");
                      });
                    if (d < 0) return a(b);
                    var e = c[d].replace("codecs=", "").replace(/"/g, "").split(/\s*,\s*/),
                      f = e.findIndex(function (g) {
                        return g.startsWith("vp09");
                      });
                    f >= 0 && (e[f] = "vp9", c[d] = 'codecs="' + e.join(",") + '"', b = c.join("; "));
                    return a(b);
                  });
                }
                SC.MediaSource = xD;
                xD.install = yD;
                TC(yD);
                function ED() {}
                function FD() {
                  screen.orientation && screen.orientation.unlock || (screen.orientation != void 0 ? GD() : window.orientation != void 0 && HD());
                }
                function GD() {
                  screen.orientation.lock === void 0 && (screen.orientation.lock = function () {
                    return Promise.resolve();
                  });
                  screen.orientation.unlock === void 0 && (screen.orientation.unlock = function () {});
                }
                function HD() {
                  function a() {
                    switch (window.orientation) {
                      case -90:
                        b.type = "landscape-secondary";
                        b.angle = 270;
                        break;
                      case 0:
                        b.type = "portrait-primary";
                        b.angle = 0;
                        break;
                      case 90:
                        b.type = "landscape-primary";
                        b.angle = 90;
                        break;
                      case 180:
                        b.type = "portrait-secondary", b.angle = 180;
                    }
                  }
                  var b = new ID();
                  screen.orientation = b;
                  a();
                  window.addEventListener("orientationchange", function () {
                    a();
                    var c = new V("change");
                    b.dispatchEvent(c);
                  });
                }
                SC.Orientation = ED;
                ED.install = FD;
                function ID() {
                  Jg.call(this);
                  this.type = "";
                  this.angle = 0;
                }
                la(ID, Jg);
                ID.prototype.lock = function (a) {
                  function b(d) {
                    return screen.lockOrientation ? screen.lockOrientation(d) : screen.mozLockOrientation ? screen.mozLockOrientation(d) : screen.msLockOrientation ? screen.msLockOrientation(d) : false;
                  }
                  var c = false;
                  switch (a) {
                    case "natural":
                      c = b("default");
                      break;
                    case "any":
                      c = true;
                      this.unlock();
                      break;
                    default:
                      c = b(a);
                  }
                  if (c) return Promise.resolve();
                  a = Error("screen.orientation.lock() is not available on this device");
                  a.name = "NotSupportedError";
                  a.code = DOMException.NOT_SUPPORTED_ERR;
                  return Promise.reject(a);
                };
                ID.prototype.unlock = function () {
                  screen.unlockOrientation ? screen.unlockOrientation() : screen.mozUnlockOrientation ? screen.mozUnlockOrientation() : screen.msUnlockOrientation && screen.msUnlockOrientation();
                };
                TC(FD);
                function JD() {}
                var KD, LD, MD, ND, OD, PD;
                function QD(a) {
                  if (window.HTMLVideoElement && window.WebKitMediaKeys && window.shakaMediaKeysPolyfill != RD) {
                    if (a === void 0 ? 0 : a) KD = true, LD = Object.getOwnPropertyDescriptor(HTMLMediaElement.prototype, "mediaKeys"), MD = HTMLMediaElement.prototype.setMediaKeys, ND = window.MediaKeys, OD = window.MediaKeySystemAccess, PD = navigator.requestMediaKeySystemAccess;
                    delete HTMLMediaElement.prototype.mediaKeys;
                    HTMLMediaElement.prototype.mediaKeys = null;
                    HTMLMediaElement.prototype.setMediaKeys = SD;
                    window.MediaKeys = TD;
                    window.MediaKeySystemAccess = UD;
                    navigator.requestMediaKeySystemAccess = VD;
                    window.shakaMediaKeysPolyfill = RD;
                    Hf.clear();
                    vg.clear();
                  }
                }
                function VD(a, b) {
                  try {
                    var c = new UD(a, b);
                    return Promise.resolve(c);
                  } catch (d) {
                    return Promise.reject(d);
                  }
                }
                function SD(a) {
                  var b = this.mediaKeys;
                  b && b != a && WD(b, null);
                  delete this.mediaKeys;
                  return (this.mediaKeys = a) ? WD(a, this) : Promise.resolve();
                }
                function XD(a) {
                  a = Vb(a.initData);
                  if (ac(a).getUint32(0, true) + 4 != a.byteLength) throw new RangeError("Malformed FairPlay init data");
                  a = ec(a.subarray(4), true);
                  a = ic(a);
                  var b = new Event("encrypted");
                  b.initDataType = "skd";
                  b.initData = Wb(a);
                  this.dispatchEvent(b);
                }
                SC.PatchedMediaKeysApple = JD;
                JD.uninstall = function () {
                  window.shakaMediaKeysPolyfill == RD && KD && (KD = false, Object.defineProperty(HTMLMediaElement.prototype, "mediaKeys", LD), HTMLMediaElement.prototype.setMediaKeys = MD, window.MediaKeys = ND, window.MediaKeySystemAccess = OD, navigator.requestMediaKeySystemAccess = PD, LD = PD = MD = OD = ND = null, window.shakaMediaKeysPolyfill = "", Hf.clear(), vg.clear());
                };
                JD.install = QD;
                function UD(a, b) {
                  this.keySystem = a;
                  if (a.startsWith("com.apple.fps")) for (a = t(b), b = a.next(); !b.done; b = a.next()) {
                    var c = b.value;
                    if (c.persistentState == "required") b = null;else {
                      b = {
                        audioCapabilities: [],
                        videoCapabilities: [],
                        persistentState: "optional",
                        distinctiveIdentifier: "optional",
                        initDataTypes: c.initDataTypes,
                        sessionTypes: ["temporary"],
                        label: c.label
                      };
                      var d = false,
                        e = false;
                      if (c.audioCapabilities) for (var f = t(c.audioCapabilities), g = f.next(); !g.done; g = f.next()) g = g.value, g.contentType && (d = true, WebKitMediaKeys.isTypeSupported(this.keySystem, g.contentType.split(";")[0]) && (b.audioCapabilities.push(g), e = true));
                      if (c.videoCapabilities) for (c = t(c.videoCapabilities), f = c.next(); !f.done; f = c.next()) f = f.value, f.contentType && (d = true, WebKitMediaKeys.isTypeSupported(this.keySystem, f.contentType.split(";")[0]) && (b.videoCapabilities.push(f), e = true));
                      d || (e = WebKitMediaKeys.isTypeSupported(this.keySystem, "video/mp4"));
                      b = e ? b : null;
                    }
                    if (b) {
                      this.g = b;
                      return;
                    }
                  }
                  a = Error("Unsupported keySystem");
                  a.name = "NotSupportedError";
                  a.code = DOMException.NOT_SUPPORTED_ERR;
                  throw a;
                }
                UD.prototype.createMediaKeys = function () {
                  var a = new TD(this.keySystem);
                  return Promise.resolve(a);
                };
                UD.prototype.getConfiguration = function () {
                  return this.g;
                };
                function TD(a) {
                  this.h = new WebKitMediaKeys(a);
                  this.g = new nb();
                }
                TD.prototype.createSession = function (a) {
                  a = a || "temporary";
                  if (a != "temporary") throw new TypeError("Session type " + a + " is unsupported on this platform.");
                  return new YD(this.h);
                };
                TD.prototype.setServerCertificate = function () {
                  return Promise.resolve(false);
                };
                function WD(a, b) {
                  a.g.Pa();
                  if (!b) return Promise.resolve();
                  a.g.D(b, "webkitneedkey", XD);
                  try {
                    return wl(b, HTMLMediaElement.HAVE_METADATA, a.g, function () {
                      b.webkitSetMediaKeys(a.h);
                    }), Promise.resolve();
                  } catch (c) {
                    return Promise.reject(c);
                  }
                }
                TD.prototype.getStatusForPolicy = function () {
                  return Promise.resolve("usable");
                };
                function YD(a) {
                  Jg.call(this);
                  this.i = null;
                  this.l = a;
                  this.g = this.h = null;
                  this.j = new nb();
                  this.sessionId = "";
                  this.expiration = NaN;
                  this.closed = new zg();
                  this.keyStatuses = new ZD();
                  this.onkeystatuseschange = null;
                }
                la(YD, Jg);
                p = YD.prototype;
                p.generateRequest = function (a, b) {
                  var c = this;
                  this.h = new zg();
                  try {
                    var d = this.l.createSession("video/mp4", Vb(b));
                    this.i = d;
                    this.sessionId = d.sessionId || "";
                    this.j.D(this.i, "webkitkeymessage", function (e) {
                      c.h && (c.h.resolve(), c.h = null);
                      e = new Map().set("messageType", c.keyStatuses.Jc() == void 0 ? "license-request" : "license-renewal").set("message", Wb(e.message));
                      e = new V("message", e);
                      c.dispatchEvent(e);
                    });
                    this.j.D(d, "webkitkeyadded", function () {
                      c.g && ($D(c, "usable"), c.g.resolve(), c.g = null);
                    });
                    this.j.D(d, "webkitkeyerror", function () {
                      var e = Error("EME PatchedMediaKeysApple key error");
                      e.errorCode = c.i.error;
                      if (c.h != null) c.h.reject(e), c.h = null;else if (c.g != null) c.g.reject(e), c.g = null;else switch (c.i.error.code) {
                        case WebKitMediaKeyError.MEDIA_KEYERR_OUTPUT:
                        case WebKitMediaKeyError.MEDIA_KEYERR_HARDWARECHANGE:
                          $D(c, "output-not-allowed");
                          break;
                        default:
                          $D(c, "internal-error");
                      }
                    });
                    $D(this, "status-pending");
                  } catch (e) {
                    this.h.reject(e);
                  }
                  return this.h;
                };
                p.load = function () {
                  return Promise.reject(Error("MediaKeySession.load not yet supported"));
                };
                p.update = function (a) {
                  this.g = new zg();
                  try {
                    this.i.update(Vb(a));
                  } catch (b) {
                    this.g.reject(b);
                  }
                  return this.g;
                };
                p.close = function () {
                  try {
                    this.i.close(), this.closed.resolve(), this.j.Pa();
                  } catch (a) {
                    this.closed.reject(a);
                  }
                  return this.closed;
                };
                p.remove = function () {
                  return Promise.reject(Error("MediaKeySession.remove is only applicable for persistent licenses, which are not supported on this platform"));
                };
                function $D(a, b) {
                  var c = a.keyStatuses;
                  c.size = b == void 0 ? 0 : 1;
                  c.g = b;
                  b = new V("keystatuseschange");
                  a.dispatchEvent(b);
                  if (a.onkeystatuseschange) a.onkeystatuseschange(b);
                }
                function ZD() {
                  this.size = 0;
                  this.g = void 0;
                }
                p = ZD.prototype;
                p.Jc = function () {
                  return this.g;
                };
                p.forEach = function (a) {
                  this.g && a(this.g, ug.value());
                };
                p.get = function (a) {
                  if (this.has(a)) return this.g;
                };
                p.has = function (a) {
                  var b = ug.value();
                  return this.g && Ub(a, b) ? true : false;
                };
                p.entries = function () {};
                p.keys = function () {};
                p.values = function () {};
                var RD = "apple";
                TC(function () {
                  window.HTMLVideoElement && window.WebKitMediaKeys && (navigator.requestMediaKeySystemAccess && MediaKeySystemAccess.prototype.getConfiguration || QD());
                });
                function aE() {}
                function bE() {
                  if (window.MediaKeys) {
                    var a = tb();
                    MediaKeys.prototype.setServerCertificate && a.re() || (MediaKeys.prototype.setServerCertificate = cE);
                  }
                }
                function cE() {
                  return Promise.resolve(false);
                }
                SC.PatchedMediaKeysCert = aE;
                aE.install = bE;
                TC(bE);
                function dE() {}
                function eE() {
                  if (!(!window.HTMLVideoElement || navigator.requestMediaKeySystemAccess && MediaKeySystemAccess.prototype.getConfiguration)) {
                    if (HTMLMediaElement.prototype.webkitGenerateKeyRequest) fE = "webkit";else if (!HTMLMediaElement.prototype.generateKeyRequest) return;
                    navigator.requestMediaKeySystemAccess = gE;
                    delete HTMLMediaElement.prototype.mediaKeys;
                    HTMLMediaElement.prototype.mediaKeys = null;
                    HTMLMediaElement.prototype.setMediaKeys = hE;
                    window.MediaKeys = iE;
                    window.MediaKeySystemAccess = jE;
                    window.shakaMediaKeysPolyfill = kE;
                  }
                }
                function lE(a) {
                  var b = fE;
                  return b ? b + a.charAt(0).toUpperCase() + a.slice(1) : a;
                }
                function gE(a, b) {
                  try {
                    var c = new jE(a, b);
                    return Promise.resolve(c);
                  } catch (d) {
                    return Promise.reject(d);
                  }
                }
                function hE(a) {
                  var b = this.mediaKeys;
                  b && b != a && mE(b, null);
                  delete this.mediaKeys;
                  (this.mediaKeys = a) && mE(a, this);
                  return Promise.resolve();
                }
                SC.PatchedMediaKeysWebkit = dE;
                dE.install = eE;
                function jE(a, b) {
                  this.g = this.keySystem = a;
                  var c = false;
                  a == "org.w3.clearkey" && (this.g = "webkit-org.w3.clearkey", c = false);
                  var d = false;
                  var e = document.getElementsByTagName("video");
                  e = e.length ? e[0] : document.createElement("video");
                  b = t(b);
                  for (var f = b.next(); !f.done; f = b.next()) {
                    f = f.value;
                    var g = {
                        audioCapabilities: [],
                        videoCapabilities: [],
                        persistentState: "optional",
                        distinctiveIdentifier: "optional",
                        initDataTypes: f.initDataTypes,
                        sessionTypes: ["temporary"],
                        label: f.label
                      },
                      h = false;
                    if (f.audioCapabilities) for (var k = t(f.audioCapabilities), l = k.next(); !l.done; l = k.next()) l = l.value, l.contentType && (h = true, e.canPlayType(l.contentType.split(";")[0], this.g) && (g.audioCapabilities.push(l), d = true));
                    if (f.videoCapabilities) for (k = t(f.videoCapabilities), l = k.next(); !l.done; l = k.next()) l = l.value, l.contentType && (h = true, e.canPlayType(l.contentType, this.g) && (g.videoCapabilities.push(l), d = true));
                    h || (d = e.canPlayType("video/mp4", this.g) || e.canPlayType("video/webm", this.g));
                    f.persistentState == "required" && (c ? (g.persistentState = "required", g.sessionTypes = ["persistent-license"]) : d = false);
                    if (d) {
                      this.h = g;
                      return;
                    }
                  }
                  c = "Unsupported keySystem";
                  if (a == "org.w3.clearkey" || a == "com.widevine.alpha") c = "None of the requested configurations were supported.";
                  a = Error(c);
                  a.name = "NotSupportedError";
                  a.code = DOMException.NOT_SUPPORTED_ERR;
                  throw a;
                }
                jE.prototype.createMediaKeys = function () {
                  var a = new iE(this.g);
                  return Promise.resolve(a);
                };
                jE.prototype.getConfiguration = function () {
                  return this.h;
                };
                function iE(a) {
                  this.l = a;
                  this.h = null;
                  this.g = new nb();
                  this.i = [];
                  this.j = new Map();
                }
                function mE(a, b) {
                  a.h = b;
                  a.g.Pa();
                  var c = fE;
                  b && (a.g.D(b, c + "needkey", function (d) {
                    var e = new CustomEvent("encrypted");
                    e.initDataType = "cenc";
                    e.initData = Wb(d.initData);
                    a.h.dispatchEvent(e);
                  }), a.g.D(b, c + "keymessage", function (d) {
                    var e = nE(a, d.sessionId);
                    e && (d = new Map().set("messageType", e.keyStatuses.Jc() == void 0 ? "licenserequest" : "licenserenewal").set("message", d.message), d = new V("message", d), e.h && (e.h.resolve(), e.h = null), e.dispatchEvent(d));
                  }), a.g.D(b, c + "keyadded", function (d) {
                    (d = nE(a, d.sessionId)) && d.ready();
                  }), a.g.D(b, c + "keyerror", function (d) {
                    var e = nE(a, d.sessionId);
                    if (e) {
                      var f = Error("EME v0.1b key error"),
                        g = d.errorCode;
                      g.systemCode = d.systemCode;
                      f.errorCode = g;
                      !d.sessionId && e.h ? (d.systemCode == 45 && (f.message = "Unsupported session type."), e.h.reject(f), e.h = null) : d.sessionId && e.g ? (e.g.reject(f), e.g = null) : (f = d.systemCode, d.errorCode.code == MediaKeyError.MEDIA_KEYERR_OUTPUT ? oE(e, "output-restricted") : f == 1 ? oE(e, "expired") : oE(e, "internal-error"));
                    }
                  }));
                }
                iE.prototype.createSession = function (a) {
                  a = a || "temporary";
                  if (a != "temporary" && a != "persistent-license") throw new TypeError("Session type " + a + " is unsupported on this platform.");
                  var b = this.h || document.createElement("video");
                  b.src || (b.src = "about:blank");
                  a = new pE(b, this.l, a);
                  this.i.push(a);
                  return a;
                };
                iE.prototype.setServerCertificate = function () {
                  return Promise.resolve(false);
                };
                iE.prototype.getStatusForPolicy = function () {
                  return Promise.resolve("usable");
                };
                function nE(a, b) {
                  var c = a.j.get(b);
                  return c ? c : (c = a.i.shift()) ? (c.sessionId = b, a.j.set(b, c), c) : null;
                }
                function pE(a, b, c) {
                  Jg.call(this);
                  this.j = a;
                  this.m = false;
                  this.g = this.h = null;
                  this.i = b;
                  this.l = c;
                  this.sessionId = "";
                  this.expiration = NaN;
                  this.closed = new zg();
                  this.keyStatuses = new qE();
                  this.onkeystatuseschange = null;
                }
                la(pE, Jg);
                p = pE.prototype;
                p.ready = function () {
                  oE(this, "usable");
                  this.g && this.g.resolve();
                  this.g = null;
                };
                function rE(a, b, c) {
                  if (a.m) return Promise.reject(Error("The session is already initialized."));
                  a.m = true;
                  try {
                    if (a.l == "persistent-license") {
                      if (c) var d = Vb(ic("LOAD_SESSION|" + c));else {
                        var e = ic("PERSISTENT|");
                        d = tc(e, b);
                      }
                    } else d = Vb(b);
                  } catch (g) {
                    return Promise.reject(g);
                  }
                  a.h = new zg();
                  var f = lE("generateKeyRequest");
                  try {
                    a.j[f](a.i, d);
                  } catch (g) {
                    if (g.name != "InvalidStateError") return a.h = null, Promise.reject(g);
                    new df(function () {
                      try {
                        a.j[f](a.i, d);
                      } catch (h) {
                        a.h.reject(h), a.h = null;
                      }
                    }).ia(.01);
                  }
                  return a.h;
                }
                function sE(a, b, c) {
                  if (a.g) a.g.then(function () {
                    return sE(a, b, c);
                  }).catch(function () {
                    return sE(a, b, c);
                  });else {
                    a.g = b;
                    if (a.i == "webkit-org.w3.clearkey") {
                      var d = dc(c);
                      var e = JSON.parse(d);
                      e.keys[0].kty != "oct" && (a.g.reject(Error("Response is not a valid JSON Web Key Set.")), a.g = null);
                      d = pc(e.keys[0].k);
                      e = pc(e.keys[0].kid);
                    } else d = Vb(c), e = null;
                    var f = lE("addKey");
                    try {
                      a.j[f](a.i, d, e, a.sessionId);
                    } catch (g) {
                      a.g.reject(g), a.g = null;
                    }
                  }
                }
                function oE(a, b) {
                  var c = a.keyStatuses;
                  c.size = b == void 0 ? 0 : 1;
                  c.g = b;
                  b = new V("keystatuseschange");
                  a.dispatchEvent(b);
                  if (a.onkeystatuseschange) a.onkeystatuseschange(b);
                }
                p.generateRequest = function (a, b) {
                  return rE(this, b, null);
                };
                p.load = function (a) {
                  return this.l == "persistent-license" ? rE(this, null, a) : Promise.reject(Error("Not a persistent session."));
                };
                p.update = function (a) {
                  var b = new zg();
                  sE(this, b, a);
                  return b;
                };
                p.close = function () {
                  if (this.l != "persistent-license") {
                    if (!this.sessionId) return this.closed.reject(Error("The session is not callable.")), this.closed;
                    var a = lE("cancelKeyRequest");
                    try {
                      this.j[a](this.i, this.sessionId);
                    } catch (b) {}
                  }
                  this.closed.resolve();
                  return this.closed;
                };
                p.remove = function () {
                  return this.l != "persistent-license" ? Promise.reject(Error("Not a persistent session.")) : this.close();
                };
                function qE() {
                  this.size = 0;
                  this.g = void 0;
                }
                p = qE.prototype;
                p.Jc = function () {
                  return this.g;
                };
                p.forEach = function (a) {
                  this.g && a(this.g, ug.value());
                };
                p.get = function (a) {
                  if (this.has(a)) return this.g;
                };
                p.has = function (a) {
                  var b = ug.value();
                  return this.g && Ub(a, b) ? true : false;
                };
                p.entries = function () {};
                p.keys = function () {};
                p.values = function () {};
                var fE = "",
                  kE = "webkit";
                TC(eE);
                function tE() {}
                function uE() {
                  if (window.HTMLVideoElement) {
                    var a = HTMLVideoElement.prototype;
                    a.requestPictureInPicture && document.exitPictureInPicture || !a.webkitSupportsPresentationMode || (document.pictureInPictureEnabled = true, document.pictureInPictureElement = null, a.requestPictureInPicture = vE, Object.defineProperty(a, "disablePictureInPicture", {
                      get: wE,
                      set: xE,
                      enumerable: true,
                      configurable: true
                    }), document.exitPictureInPicture = yE, document.addEventListener("webkitpresentationmodechanged", zE, true));
                  }
                }
                function zE(a) {
                  a = a.target;
                  if (a.webkitPresentationMode == "picture-in-picture") {
                    document.pictureInPictureElement = a;
                    var b = new Event("enterpictureinpicture");
                    a.dispatchEvent(b);
                  } else document.pictureInPictureElement == a && (document.pictureInPictureElement = null), b = new Event("leavepictureinpicture"), a.dispatchEvent(b);
                }
                function vE() {
                  return this.webkitSupportsPresentationMode("picture-in-picture") ? (this.webkitSetPresentationMode("picture-in-picture"), document.pictureInPictureElement = this, Promise.resolve()) : Promise.reject(Error("PiP not allowed by video element"));
                }
                function yE() {
                  var a = document.pictureInPictureElement;
                  return a ? (a.webkitSetPresentationMode("inline"), document.pictureInPictureElement = null, Promise.resolve()) : Promise.reject(Error("No picture in picture element found"));
                }
                function wE() {
                  return this.hasAttribute("disablePictureInPicture") ? true : !this.webkitSupportsPresentationMode("picture-in-picture");
                }
                function xE(a) {
                  a ? this.setAttribute("disablePictureInPicture", "") : this.removeAttribute("disablePictureInPicture");
                }
                SC.PiPWebkit = tE;
                tE.install = uE;
                TC(uE);
                function AE() {}
                function BE() {
                  window.crypto && ("randomUUID" in window.crypto || (window.crypto.randomUUID = CE));
                }
                function CE() {
                  var a = URL.createObjectURL(new Blob()),
                    b = a.toString();
                  URL.revokeObjectURL(a);
                  return b.substr(b.lastIndexOf("/") + 1);
                }
                SC.RandomUUID = AE;
                AE.install = BE;
                TC(BE);
                function DE() {}
                function EE() {
                  var a = Symbol.prototype;
                  "description" in a || Object.defineProperty(a, "description", {
                    get: FE
                  });
                }
                function FE() {
                  var a = /\((.*)\)/.exec(this.toString());
                  return a ? a[1] : void 0;
                }
                SC.Symbol = DE;
                DE.install = EE;
                TC(EE);
                function GE() {}
                function HE() {
                  for (var a = t([Uint8Array, Uint8ClampedArray, Uint16Array, Uint32Array, Int8Array, Int16Array, Int32Array, Float32Array, Float64Array]), b = a.next(); !b.done; b = a.next()) b = b.value, b.prototype.indexOf || (b.prototype.indexOf = IE), b.prototype.lastIndexOf || (b.prototype.lastIndexOf = JE), b.prototype.includes || (b.prototype.includes = KE);
                }
                function IE(a, b) {
                  return Array.prototype.indexOf.call(this, a, b);
                }
                function JE(a, b) {
                  return Array.prototype.lastIndexOf.call(this, a, b);
                }
                function KE(a, b) {
                  return this.indexOf(a, b) !== -1;
                }
                SC.TypedArray = GE;
                GE.install = HE;
                TC(HE);
                function LE() {}
                function ME() {
                  if (window.HTMLMediaElement) {
                    var a = HTMLMediaElement.prototype.play;
                    HTMLMediaElement.prototype.play = function () {
                      var b = a.apply(this);
                      b && b.catch(function () {});
                      return b;
                    };
                  }
                }
                SC.VideoPlayPromise = LE;
                LE.install = ME;
                TC(ME);
                function NE() {}
                function OE() {
                  if (window.HTMLVideoElement) {
                    var a = HTMLVideoElement.prototype;
                    !a.getVideoPlaybackQuality && ("webkitDroppedFrameCount" in a || typeof zi().webkitDroppedFrameCount === "number") && (a.getVideoPlaybackQuality = PE);
                  }
                }
                function PE() {
                  return {
                    droppedVideoFrames: this.webkitDroppedFrameCount,
                    totalVideoFrames: this.webkitDecodedFrameCount,
                    corruptedVideoFrames: 0,
                    creationTime: NaN,
                    totalFrameDelay: 0
                  };
                }
                SC.VideoPlaybackQuality = NE;
                NE.install = OE;
                TC(OE);
                function QE() {}
                function RE() {
                  if (!window.VTTCue && window.TextTrackCue) {
                    var a = null,
                      b = TextTrackCue.length;
                    if (b == 3) a = SE;else if (b == 6) a = TE;else {
                      try {
                        var c = !!SE(1, 2, "");
                      } catch (d) {
                        c = false;
                      }
                      c && (a = SE);
                    }
                    a && (window.VTTCue = function (d, e, f) {
                      return a(d, e, f);
                    });
                  }
                }
                function SE(a, b, c) {
                  return new window.TextTrackCue(a, b, c);
                }
                function TE(a, b, c) {
                  return new window.TextTrackCue(a + "-" + b + "-" + c, a, b, c);
                }
                SC.VTTCue = QE;
                QE.install = RE;
                TC(RE);
                function UE(a) {
                  Jg.call(this);
                  this.g = a;
                  this.m = null;
                  this.h = [];
                  this.j = -1;
                  this.i = this.l = null;
                  this.o = new nb();
                }
                la(UE, Jg);
                p = UE.prototype;
                p.destroy = function () {
                  var a = this;
                  return P(function (b) {
                    if (b.g == 1) return F(b, a.removeAllItems(), 2);
                    a.g = null;
                    a.o && (a.o.release(), a.o = null);
                    Jg.prototype.release.call(a);
                    G(b);
                  });
                };
                p.configure = function (a) {
                  this.m = a;
                };
                p.getConfiguration = function () {
                  return this.m;
                };
                p.getCurrentItem = function () {
                  return this.h.length && this.j >= 0 && this.j < this.h.length ? this.h[this.j] : null;
                };
                p.getCurrentItemIndex = function () {
                  return this.j;
                };
                p.getItems = function () {
                  return this.h.slice();
                };
                p.insertItems = function (a) {
                  this.h.push.apply(this.h, x(a));
                  this.dispatchEvent(new V("itemsinserted"));
                };
                p.removeAllItems = function () {
                  var a = this,
                    b,
                    c,
                    d,
                    e;
                  return P(function (f) {
                    if (f.g == 1) return a.o.Pa(), a.h.length && a.j >= 0 ? F(f, a.g.Bc(), 2) : f.A(2);
                    if (f.g != 4) {
                      b = [];
                      a.i && (a.i.preloadManager.j || b.push(a.i.preloadManager.destroy()), a.i = null);
                      a.l && (a.l.preloadManager.j || b.push(a.l.preloadManager.destroy()), a.l = null);
                      c = t(a.h);
                      for (d = c.next(); !d.done; d = c.next()) e = d.value, e.preloadManager && !e.preloadManager.j && b.push(e.preloadManager.destroy());
                      return b.length ? F(f, Promise.all(b), 4) : f.A(4);
                    }
                    a.h = [];
                    a.j = -1;
                    a.dispatchEvent(new V("itemsremoved"));
                    G(f);
                  });
                };
                p.playItem = function (a) {
                  var b = this,
                    c,
                    d,
                    e,
                    f,
                    g,
                    h,
                    k,
                    l,
                    m,
                    n,
                    q,
                    r,
                    u,
                    v,
                    w,
                    z,
                    y;
                  return P(function (B) {
                    switch (B.g) {
                      case 1:
                        b.o.Pa();
                        if (!b.h.length || a >= b.h.length) throw new U(2, 7, 7007);
                        c = b.getCurrentItem();
                        d = b.h[a];
                        b.j != a && (b.j = a, b.dispatchEvent(new V("currentitemchanged")));
                        e = b.g.h;
                        f = b.m ? b.m.preloadNextUrlWindow : 0;
                        f > 0 && (g = false, b.o.D(e, "timeupdate", function () {
                          var D, I, C, A;
                          return P(function (E) {
                            switch (E.g) {
                              case 1:
                                if (b.l || b.h.length <= 1 || g || b.g.W() || !e.duration) return E.return();
                                D = b.g.Qa().end - e.currentTime;
                                if (isNaN(D)) {
                                  E.A(0);
                                  break;
                                }
                                if (!(D <= f)) {
                                  E.A(0);
                                  break;
                                }
                                I = b.m && b.m.repeatMode;
                                C = null;
                                b.j + 1 < b.h.length ? C = b.h[b.j + 1] : I == 1 && (C = b.h[0]);
                                if (!C || C.preloadManager && !C.preloadManager.j) {
                                  E.A(0);
                                  break;
                                }
                                g = true;
                                A = null;
                                ua(E, 5);
                                return F(E, b.g.preload(C.manifestUri, C.startTime, C.mimeType, C.config), 7);
                              case 7:
                                A = E.h;
                                xa(E, 6);
                                break;
                              case 5:
                                ya(E), A = null;
                              case 6:
                                b.l = {
                                  item: C,
                                  preloadManager: A
                                }, g = false, G(E);
                            }
                          });
                        }));
                        b.o.D(b.g, "complete", function () {
                          var D = b.m && b.m.repeatMode,
                            I = false;
                          if (D == 2) I = true;else {
                            var C = b.j + 1;
                            C < b.h.length ? b.playItem(C) : D == 1 && (b.h.length == 1 ? I = true : b.playItem(0));
                          }
                          I && (e.paused ? (e.currentTime = b.g.Qa().start, e.play()) : b.o.D(e, "paused", function () {
                            e.currentTime = b.g.Qa().start;
                            e.play();
                          }));
                        });
                        h = d.manifestUri;
                        d.preloadManager && !d.preloadManager.j && (h = d.preloadManager);
                        k = false;
                        b.l && b.l.item == d && b.l.preloadManager ? h = b.l.preloadManager : b.i && b.i.item == d && b.i.preloadManager && (h = b.i.preloadManager, k = true);
                        if (!b.i) {
                          B.A(2);
                          break;
                        }
                        if (k || b.i.preloadManager.j) {
                          B.A(3);
                          break;
                        }
                        return F(B, b.i.preloadManager.destroy(), 3);
                      case 3:
                        b.i = null;
                      case 2:
                        if (!(b.m && b.m.preloadPrevItem && c && b.g.m === lr)) {
                          B.A(5);
                          break;
                        }
                        l = null;
                        ua(B, 6);
                        return F(B, b.g.ej(), 8);
                      case 8:
                        l = B.h;
                        xa(B, 7);
                        break;
                      case 6:
                        ya(B), l = null;
                      case 7:
                        b.i = {
                          item: c,
                          preloadManager: l
                        };
                      case 5:
                        return d.config && (b.g.Ji(), b.g.configure(d.config)), F(B, b.g.load(h, d.startTime, d.mimeType), 9);
                      case 9:
                        b.l = null;
                        if (d.extraText) for (m = t(d.extraText), n = m.next(); !n.done; n = m.next()) q = n.value, q.mime ? b.g.Od(q.uri, q.language, q.kind, q.mime, q.codecs) : b.g.Od(q.uri, q.language, q.kind);
                        if (d.extraThumbnail) for (r = t(d.extraThumbnail), u = r.next(); !u.done; u = r.next()) v = u.value, b.g.Me(v);
                        if (d.extraChapter) for (w = t(d.extraChapter), z = w.next(); !z.done; z = w.next()) y = z.value, b.g.Le(y.uri, y.language, y.mime);
                        G(B);
                    }
                  });
                };
                S("shaka.queue.QueueManager", UE);
                UE.prototype.playItem = UE.prototype.playItem;
                UE.prototype.removeAllItems = UE.prototype.removeAllItems;
                UE.prototype.insertItems = UE.prototype.insertItems;
                UE.prototype.getItems = UE.prototype.getItems;
                UE.prototype.getCurrentItemIndex = UE.prototype.getCurrentItemIndex;
                UE.prototype.getCurrentItem = UE.prototype.getCurrentItem;
                UE.prototype.getConfiguration = UE.prototype.getConfiguration;
                UE.prototype.configure = UE.prototype.configure;
                UE.prototype.destroy = UE.prototype.destroy;
                Eq = function Eq(a) {
                  return new UE(a);
                };
                function VE() {}
                VE.prototype.parseInit = function () {};
                VE.prototype.setSequenceMode = function () {};
                VE.prototype.setManifestType = function () {};
                VE.prototype.parseMedia = function (a, b) {
                  var c = null,
                    d = [];
                  a = dc(a).split(/\r?\n/);
                  a = t(a);
                  for (var e = a.next(); !e.done; e = a.next()) if ((e = e.value) && !/^\s+$/.test(e) && (e = WE.exec(e))) {
                    var f = XE.exec(e[1]);
                    f = parseInt(f[1], 10) * 60 + parseFloat(f[2].replace(",", "."));
                    e = new Td(f, b.segmentEnd ? b.segmentEnd : f + 2, e[2]);
                    c && (c.endTime = f, d.push(c));
                    c = e;
                  }
                  c && d.push(c);
                  return d;
                };
                S("shaka.text.LrcTextParser", VE);
                VE.prototype.parseMedia = VE.prototype.parseMedia;
                VE.prototype.setManifestType = VE.prototype.setManifestType;
                VE.prototype.setSequenceMode = VE.prototype.setSequenceMode;
                VE.prototype.parseInit = VE.prototype.parseInit;
                var WE = /^\[(\d{1,2}:\d{1,2}(?:[.,]\d{1,3})?)\](.*)/,
                  XE = /^(\d+):(\d{1,2}(?:[.,]\d{1,3})?)$/;
                Re("application/x-subtitle-lrc", function () {
                  return new VE();
                });
                function YE() {
                  this.g = "UNKNOWN";
                }
                YE.prototype.parseInit = function () {};
                YE.prototype.setSequenceMode = function () {};
                YE.prototype.setManifestType = function (a) {
                  this.g = a;
                };
                YE.prototype.parseMedia = function (a, b, c, d) {
                  var e = dc(a);
                  a = [];
                  if (e == "") return a;
                  var f = kd(e, "tt", true);
                  if (!f) throw new U(2, 2, 2005, "Failed to parse TTML.");
                  e = wd(f, "body")[0];
                  if (!e) return [];
                  var g = Cd(f, ZE, "frameRate"),
                    h = Cd(f, ZE, "subFrameRate"),
                    k = Cd(f, ZE, "frameRateMultiplier"),
                    l = Cd(f, ZE, "tickRate"),
                    m = Cd(f, ZE, "cellResolution"),
                    n = f.attributes["xml:space"] || "default",
                    q = Cd(f, $E, "extent");
                  if (n != "default" && n != "preserve") throw new U(2, 2, 2005, "Invalid xml:space value: " + n);
                  n = n == "default";
                  g = new aF(g, h, k, l);
                  m = bF(m);
                  h = wd(f, "metadata")[0];
                  h = (h ? h.children : []).filter(function (v) {
                    return v != "\n";
                  });
                  k = wd(f, "style");
                  f = wd(f, "region");
                  l = [];
                  for (var r = t(f), u = r.next(); !u.done; u = r.next()) (u = cF(this, u.value, k, q)) && l.push(u);
                  if (td(e, "p").length) throw new U(2, 2, 2001, "<p> can only be inside <div> in TTML");
                  q = t(td(e, "div"));
                  for (r = q.next(); !r.done; r = q.next()) if (td(r.value, "span").length) throw new U(2, 2, 2001, "<span> can only be inside <p> in TTML");
                  if (b = dF(this, e, b, g, h, k, f, l, n, m, null, false, c, d)) b.backgroundColor || (b.backgroundColor = "transparent"), a.push(b);
                  return a;
                };
                function dF(a, b, c, d, e, f, g, h, k, l, m, n, q, r) {
                  var u = m;
                  if (rd(b)) {
                    if (!n) return null;
                    var v = {
                      tagName: "span",
                      children: [ud(b)],
                      attributes: {},
                      parent: null
                    };
                  } else v = b;
                  for (var w = null, z = t(eF), y = z.next(); !y.done && !(w = fF(v, "backgroundImage", e, "#", y.value)[0]); y = z.next());
                  z = null;
                  y = Cd(v, eF, "backgroundImage");
                  var B = /^(urn:)(mpeg:[a-z0-9][a-z0-9-]{0,31}:)(subs:)([0-9]+)$/;
                  if (y && B.test(y)) {
                    z = parseInt(y.split(":").pop(), 10) - 1;
                    if (z >= r.length) return null;
                    z = r[z];
                  } else q && y && !y.startsWith("#") && (B = new Db(q), y = new Db(y), (y = B.resolve(y).toString()) && (z = y));
                  if (b.tagName == "p" || w || z) n = true;
                  b = n;
                  y = (v.attributes["xml:space"] || (k ? "default" : "preserve")) == "default";
                  B = v.children.every(rd);
                  k = [];
                  if (!B) for (var D = t(v.children), I = D.next(); !I.done; I = D.next()) (I = dF(a, I.value, c, d, e, f, g, h, y, l, v, n, q, r)) && k.push(I);
                  e = m != null;
                  q = ud(v);
                  q = v.children.length && q && /\S/.test(q);
                  D = v.attributes.begin || v.attributes.end || v.attributes.dur;
                  if (!(D || q || v.tagName == "br" || k.length != 0 || e && !y)) return null;
                  r = gF(v, d);
                  q = r.start;
                  for (r = r.end; u && u.tagName && u.tagName != "tt";) r = hF(u, d, q, r), q = r.start, r = r.end, u = u.parent;
                  q == null && (q = 0);
                  q += c.periodStart;
                  r = r == null ? Infinity : r + c.periodStart;
                  a.g !== "HLS" && (q = Math.max(q, c.segmentStart), r = Math.min(r, c.segmentEnd));
                  if (!D && k.length > 0) for (q = Infinity, r = 0, c = t(k), d = c.next(); !d.done; d = c.next()) d = d.value, q = Math.min(q, d.startTime), r = Math.max(r, d.endTime);
                  if (v.tagName == "br") return a = new Td(q, r, ""), a.lineBreak = true, a;
                  c = "";
                  B && (c = lc(ud(v) || ""), y && (c = c.replace(/\s+/g, " ")));
                  c = new Td(q, r, c);
                  c.nestedCues = k;
                  n || (c.isContainer = true);
                  l && (c.cellResolution = l);
                  l = fF(v, "region", g, "")[0];
                  if (v.attributes.region && l && l.attributes["xml:id"]) {
                    var C = l.attributes["xml:id"];
                    c.region = h.filter(function (A) {
                      return A.id == C;
                    })[0];
                  }
                  h = l;
                  m && e && !v.attributes.region && !v.attributes.style && (h = fF(m, "region", g, "")[0]);
                  iF(a, c, v, h, w, z, f, b, k.length == 0);
                  return c;
                }
                function cF(a, b, c, d) {
                  var e = new Uc(),
                    f = b.attributes["xml:id"];
                  if (!f) return null;
                  e.id = f;
                  f = null;
                  d && (f = jF.exec(d) || kF.exec(d));
                  d = f ? Number(f[1]) : null;
                  f = f ? Number(f[2]) : null;
                  var g,
                    h = lF(a, b, c, "extent");
                  if (h) {
                    var k = (g = jF.exec(h)) || kF.exec(h);
                    k != null && (e.width = Number(k[1]), e.height = Number(k[2]), g || (d != null && (e.width = e.width * 100 / d), f != null && (e.height = e.height * 100 / f)), e.widthUnits = g || d != null ? Vc : 0, e.heightUnits = g || f != null ? Vc : 0);
                  }
                  if (a = lF(a, b, c, "origin")) if (k = (g = jF.exec(a)) || kF.exec(a), k != null) e.viewportAnchorX = Number(k[1]), e.viewportAnchorY = Number(k[2]), g ? h || (e.width = 100 - e.viewportAnchorX, e.widthUnits = Vc, e.height = 100 - e.viewportAnchorY, e.heightUnits = Vc) : (f != null && (e.viewportAnchorY = e.viewportAnchorY * 100 / f), d != null && (e.viewportAnchorX = e.viewportAnchorX * 100 / d)), e.viewportAnchorUnits = g || d != null ? Vc : 0;
                  return e;
                }
                function mF(a) {
                  var b = a.match(/rgba\(([^)]+)\)/);
                  return b && (b = b[1].split(","), b.length == 4) ? (b[3] = String(Number(b[3]) / 255), "rgba(" + b.join(",") + ")") : a;
                }
                function iF(a, b, c, d, e, f, g, h, k) {
                  h = h || k;
                  nF(a, c, d, g, "direction", h) == "rtl" && (b.direction = "rtl");
                  k = nF(a, c, d, g, "writingMode", h);
                  k == "tb" || k == "tblr" ? b.writingMode = "vertical-lr" : k == "tbrl" ? b.writingMode = "vertical-rl" : k == "rltb" || k == "rl" ? b.direction = "rtl" : k && (b.direction = Wd);
                  (k = nF(a, c, d, g, "textAlign", true)) ? (b.positionAlign = oF.get(k), b.lineAlign = pF.get(k), b.textAlign = se[k.toUpperCase()]) : b.textAlign = Vd;
                  if (k = nF(a, c, d, g, "displayAlign", true)) b.displayAlign = te[k.toUpperCase()];
                  if (k = nF(a, c, d, g, "color", h)) b.color = mF(k);
                  if (k = nF(a, c, d, g, "backgroundColor", h)) b.backgroundColor = mF(k);
                  if (k = nF(a, c, d, g, "border", h)) b.border = k;
                  if (k = nF(a, c, d, g, "fontFamily", h)) switch (k) {
                    case "monospaceSerif":
                      b.fontFamily = "Courier New,Liberation Mono,Courier,monospace";
                      break;
                    case "proportionalSansSerif":
                      b.fontFamily = "Arial,Helvetica,Liberation Sans,sans-serif";
                      break;
                    case "sansSerif":
                      b.fontFamily = "sans-serif";
                      break;
                    case "monospaceSansSerif":
                      b.fontFamily = "Consolas,monospace";
                      break;
                    case "proportionalSerif":
                      b.fontFamily = "serif";
                      break;
                    default:
                      b.fontFamily = k.split(",").filter(function (l) {
                        return l != "default";
                      }).join(",");
                  }
                  (k = nF(a, c, d, g, "fontWeight", h)) && k == "bold" && (b.fontWeight = pe);
                  k = nF(a, c, d, g, "wrapOption", h);
                  b.wrapLine = k && k == "noWrap" ? false : true;
                  (k = nF(a, c, d, g, "lineHeight", h)) && k.match(qF) && (b.lineHeight = k);
                  (k = nF(a, c, d, g, "fontSize", h)) && (k.match(qF) || k.match(rF)) && (b.fontSize = k);
                  if (k = nF(a, c, d, g, "fontStyle", h)) b.fontStyle = ve[k.toUpperCase()];
                  e ? (f = e.attributes.imageType || e.attributes.imagetype, k = e.attributes.encoding, e = ud(e).trim(), f == "PNG" && k == "Base64" && e && (b.backgroundImage = "data:image/png;base64," + e)) : f && (b.backgroundImage = f);
                  if (e = nF(a, c, d, g, "textOutline", h)) e = e.split(" "), e[0].match(qF) ? b.textStrokeColor = b.color : (b.textStrokeColor = mF(e[0]), e.shift()), e[0] && e[0].match(qF) ? b.textStrokeWidth = e[0] : b.textStrokeColor = "";
                  (e = nF(a, c, d, g, "letterSpacing", h)) && e.match(qF) && (b.letterSpacing = e);
                  (e = nF(a, c, d, g, "linePadding", h)) && e.match(qF) && (b.linePadding = e);
                  if (e = nF(a, c, d, g, "opacity", h)) b.opacity = parseFloat(e);
                  (e = lF(a, d, g, "textDecoration")) && sF(b, e);
                  (e = tF(a, c, g, "textDecoration")) && sF(b, e);
                  if (e = nF(a, c, d, g, "textCombine", h)) b.textCombineUpright = e;
                  switch (nF(a, c, d, g, "ruby", h)) {
                    case "container":
                      b.rubyTag = "ruby";
                      break;
                    case "text":
                      b.rubyTag = "rt";
                  }
                }
                function sF(a, b) {
                  b = t(b.split(" "));
                  for (var c = b.next(); !c.done; c = b.next()) switch (c.value) {
                    case "underline":
                      a.textDecoration.includes(re) || a.textDecoration.push(re);
                      break;
                    case "noUnderline":
                      a.textDecoration.includes(re) && jb(a.textDecoration, re);
                      break;
                    case "lineThrough":
                      a.textDecoration.includes("lineThrough") || a.textDecoration.push("lineThrough");
                      break;
                    case "noLineThrough":
                      a.textDecoration.includes("lineThrough") && jb(a.textDecoration, "lineThrough");
                      break;
                    case "overline":
                      a.textDecoration.includes("overline") || a.textDecoration.push("overline");
                      break;
                    case "noOverline":
                      a.textDecoration.includes("overline") && jb(a.textDecoration, "overline");
                  }
                }
                function nF(a, b, c, d, e, f) {
                  f = f === void 0 ? true : f;
                  return (b = tF(a, b, d, e)) ? b : f ? lF(a, c, d, e) : null;
                }
                function lF(a, b, c, d) {
                  if (!b) return null;
                  var e = Cd(b, $E, d);
                  return e ? e : uF(a, b, c, d);
                }
                function tF(a, b, c, d) {
                  var e = Cd(b, $E, d);
                  return e ? e : uF(a, b, c, d);
                }
                function uF(a, b, c, d) {
                  b = fF(b, "style", c, "");
                  for (var e = null, f = 0; f < b.length; f++) {
                    var g = Bd(b[f], "urn:ebu:tt:style", d);
                    g || (g = Cd(b[f], $E, d));
                    g || (g = tF(a, b[f], c, d));
                    g && (e = g);
                  }
                  return e;
                }
                function fF(a, b, c, d, e) {
                  var f = [];
                  if (!a || c.length < 1) return f;
                  var g = a;
                  for (a = null; !a && !(a = e ? Bd(g, e, b) : g.attributes[b]) && (g = g.parent, g););
                  if (b = a) for (b = t(b.split(" ")), e = b.next(); !e.done; e = b.next()) for (e = e.value, a = t(c), g = a.next(); !g.done; g = a.next()) if (g = g.value, d + g.attributes["xml:id"] == e) {
                    f.push(g);
                    break;
                  }
                  return f;
                }
                function hF(a, b, c, d) {
                  a = gF(a, b);
                  c == null ? c = a.start : a.start != null && (c += a.start);
                  d == null ? d = a.end : a.start != null && (d += a.start);
                  return {
                    start: c,
                    end: d
                  };
                }
                function gF(a, b) {
                  var c = vF(a.attributes.begin, b),
                    d = vF(a.attributes.end, b);
                  a = vF(a.attributes.dur, b);
                  d == null && a != null && (d = c + a);
                  return {
                    start: c,
                    end: d
                  };
                }
                function vF(a, b) {
                  var c = null;
                  if (wF.test(a)) {
                    a = wF.exec(a);
                    c = Number(a[1]);
                    var d = Number(a[2]),
                      e = Number(a[3]),
                      f = Number(a[4]);
                    f += (Number(a[5]) || 0) / b.h;
                    e += f / b.frameRate;
                    c = e + d * 60 + c * 3600;
                  } else if (xF.test(a)) c = yF(xF, a);else if (zF.test(a)) c = yF(zF, a);else if (AF.test(a)) a = AF.exec(a), c = Number(a[1]) / b.frameRate;else if (BF.test(a)) a = BF.exec(a), c = Number(a[1]) / b.g;else if (CF.test(a)) c = yF(CF, a);else if (a) throw new U(2, 2, 2001, "Could not parse cue time range in TTML");
                  return c;
                }
                function yF(a, b) {
                  a = a.exec(b);
                  return a == null || a[0] == "" ? null : (Number(a[4]) || 0) / 1E3 + (Number(a[3]) || 0) + (Number(a[2]) || 0) * 60 + (Number(a[1]) || 0) * 3600;
                }
                function bF(a) {
                  return a ? (a = /^(\d+) (\d+)$/.exec(a)) ? {
                    columns: parseInt(a[1], 10),
                    rows: parseInt(a[2], 10)
                  } : null : null;
                }
                S("shaka.text.TtmlTextParser", YE);
                YE.prototype.parseMedia = YE.prototype.parseMedia;
                YE.prototype.setManifestType = YE.prototype.setManifestType;
                YE.prototype.setSequenceMode = YE.prototype.setSequenceMode;
                YE.prototype.parseInit = YE.prototype.parseInit;
                function aF(a, b, c, d) {
                  this.frameRate = Number(a) || 30;
                  this.h = Number(b) || 1;
                  this.g = Number(d);
                  this.g == 0 && (this.g = a ? this.frameRate * this.h : 1);
                  c && (a = /^(\d+) (\d+)$/g.exec(c)) && (this.frameRate *= Number(a[1]) / Number(a[2]));
                }
                var jF = /^(\d{1,2}(?:\.\d+)?|100(?:\.0+)?)% (\d{1,2}(?:\.\d+)?|100(?:\.0+)?)%$/,
                  rF = /^(\d{1,4}(?:\.\d+)?|100)%$/,
                  qF = /^(\d+px|\d+em|\d*\.?\d+c)$/,
                  kF = /^(\d+)px (\d+)px$/,
                  wF = /^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,
                  xF = /^(?:(\d{2,}):)?(\d{2}):(\d{2})$/,
                  zF = /^(?:(\d{2,}):)?(\d{2}):(\d{2}\.\d+)$/,
                  AF = /^(\d*(?:\.\d*)?)f$/,
                  BF = /^(\d*(?:\.\d*)?)t$/,
                  CF = RegExp("^(?:(\\d*(?:\\.\\d*)?)h)?(?:(\\d*(?:\\.\\d*)?)m)?(?:(\\d*(?:\\.\\d*)?)s)?(?:(\\d*(?:\\.\\d*)?)ms)?$"),
                  pF = new Map().set("left", Zd).set("center", "center").set("right", "end").set("start", Zd).set("end", "end"),
                  oF = new Map().set("left", "line-left").set("center", "center").set("right", "line-right"),
                  ZE = ["http://www.w3.org/ns/ttml#parameter", "http://www.w3.org/2006/10/ttaf1#parameter"],
                  $E = ["http://www.w3.org/ns/ttml#styling", "http://www.w3.org/2006/10/ttaf1#styling"],
                  eF = ["http://www.smpte-ra.org/schemas/2052-1/2010/smpte-tt", "http://www.smpte-ra.org/schemas/2052-1/2013/smpte-tt"];
                Re("application/ttml+xml", function () {
                  return new YE();
                });
                function DF() {
                  this.g = new YE();
                }
                DF.prototype.parseInit = function (a) {
                  var b = false;
                  new hh().box("moov", mh).box("trak", mh).box("mdia", mh).box("minf", mh).box("stbl", mh).S("stsd", oh).box("stpp", function (c) {
                    b = true;
                    c.parser.stop();
                  }).parse(a);
                  if (!b) throw new U(2, 2, 2007);
                };
                DF.prototype.setSequenceMode = function (a) {
                  this.g.setSequenceMode(a);
                };
                DF.prototype.setManifestType = function (a) {
                  this.g.setManifestType(a);
                };
                DF.prototype.parseMedia = function (a, b, c) {
                  var d = [],
                    e = null,
                    f = [],
                    g = new Map(),
                    h = [];
                  new hh().box("moof", mh).box("traf", mh).S("tfhd", function (z) {
                    e = Bi(z.reader, z.flags).Ud;
                  }).S("trun", function (z) {
                    z = Ei(z.reader, z.version, z.flags);
                    z = t(z.hh);
                    for (var y = z.next(); !y.done; y = z.next()) h.push(y.value.sampleSize || e || 0);
                  }).S("subs", function (z) {
                    for (var y = z.reader, B = y.U(), D = -1, I = 0; I < B; I++) {
                      var C = y.U();
                      D += C;
                      C = y.Ca();
                      for (var A = [], E = 0; E < C; E++) z.version == 1 ? A.push(y.U()) : A.push(y.Ca()), y.Y(), y.Y(), y.U();
                      g.set(D, A);
                    }
                  }).box("mdat", sh(function (z) {
                    f.push(z);
                  }, false)).parse(a, false);
                  if (f.length == 0) throw new U(2, 2, 2007);
                  for (var k = tc.apply(mc, x(f)), l = 0, m = 0; m < h.length; m++) {
                    var n = Vb(k, l, h[m]);
                    l += h[m];
                    var q = g.get(m);
                    if (q && q.length) {
                      n = Vb(n, 0, q[0]);
                      for (var r = [], u = q[0], v = 1; v < q.length; v++) {
                        var w = Vb(a, u, q[v]);
                        w = nc(w);
                        r.push("data:image/png;base64," + w);
                        u += q[v];
                      }
                      d = d.concat(this.g.parseMedia(n, b, c, r));
                    } else d = d.concat(this.g.parseMedia(n, b, c, []));
                  }
                  return d;
                };
                S("shaka.text.Mp4TtmlParser", DF);
                DF.prototype.parseMedia = DF.prototype.parseMedia;
                DF.prototype.setManifestType = DF.prototype.setManifestType;
                DF.prototype.setSequenceMode = DF.prototype.setSequenceMode;
                DF.prototype.parseInit = DF.prototype.parseInit;
                Re('application/mp4; codecs="stpp"', function () {
                  return new DF();
                });
                Re('application/mp4; codecs="stpp.ttml"', function () {
                  return new DF();
                });
                Re('application/mp4; codecs="stpp.ttml.im1i"', function () {
                  return new DF();
                });
                Re('application/mp4; codecs="stpp.ttml.im1t"', function () {
                  return new DF();
                });
                Re('application/mp4; codecs="stpp.ttml.im2i"', function () {
                  return new DF();
                });
                Re('application/mp4; codecs="stpp.ttml.im2t"', function () {
                  return new DF();
                });
                Re('application/mp4; codecs="stpp.ttml.etd1"', function () {
                  return new DF();
                });
                Re('application/mp4; codecs="stpp.ttml.etd1|im1t"', function () {
                  return new DF();
                });
                Re('application/mp4; codecs="stpp.ttml.im1t|etd1"', function () {
                  return new DF();
                });
                Re('application/mp4; codecs="stpp.TTML.im1t"', function () {
                  return new DF();
                });
                function EF() {
                  this.g = "UNKNOWN";
                }
                EF.prototype.parseInit = function () {};
                EF.prototype.setSequenceMode = function () {};
                EF.prototype.setManifestType = function (a) {
                  this.g = a;
                };
                EF.prototype.parseMedia = function (a, b) {
                  a = dc(a);
                  a = a.replace(/\r\n|\r(?=[^\n]|$)/gm, "\n");
                  var c = a.split(/\n{2,}/m);
                  if (!/^WEBVTT($|[ \t\n])/m.test(c[0])) throw new U(2, 2, 2E3);
                  a = b.vttOffset;
                  if (this.g == "HLS") if (c[0].includes("X-TIMESTAMP-MAP")) {
                    var d = c[0];
                    a = d.match(/LOCAL:((?:(\d{1,}):)?(\d{2}):(\d{2})\.(\d{3}))/m);
                    d = d.match(/MPEGTS:(\d+)/m);
                    if (!a || !d) throw new U(2, 2, 2E3);
                    a = ed(a[1]);
                    if (a == null) throw new U(2, 2, 2E3);
                    d = Number(d[1]);
                    for (var e = b.segmentStart - b.periodStart; e >= 95443.7176888889;) e -= 95443.7176888889, d += 8589934592;
                    a = b.periodStart + d / 9E4 - a;
                  } else b.periodStart && b.vttOffset == b.periodStart && (a = 0);
                  b = [];
                  d = t(c[0].split("\n"));
                  for (e = d.next(); !e.done; e = d.next()) if (e = e.value, /^Region:/.test(e)) {
                    e = new Yc(e);
                    var f = new Uc();
                    ad(e);
                    Zc(e);
                    for (var g = ad(e); g;) {
                      var h = f,
                        k = g;
                      (g = /^id=(.*)$/.exec(k)) ? h.id = g[1] : (g = /^width=(\d{1,2}|100)%$/.exec(k)) ? h.width = Number(g[1]) : (g = /^lines=(\d+)$/.exec(k)) ? (h.height = Number(g[1]), h.heightUnits = 2) : (g = /^regionanchor=(\d{1,2}|100)%,(\d{1,2}|100)%$/.exec(k)) ? (h.regionAnchorX = Number(g[1]), h.regionAnchorY = Number(g[2])) : (g = /^viewportanchor=(\d{1,2}|100)%,(\d{1,2}|100)%$/.exec(k)) ? (h.viewportAnchorX = Number(g[1]), h.viewportAnchorY = Number(g[2])) : /^scroll=up$/.exec(k) && (h.scroll = "up");
                      Zc(e);
                      g = ad(e);
                    }
                    b.push(f);
                  }
                  d = new Map();
                  fe(d);
                  e = [];
                  c = t(c.slice(1));
                  for (f = c.next(); !f.done; f = c.next()) {
                    f = f.value.split("\n");
                    if ((f.length != 1 || f[0]) && !/^NOTE($|[ \t])/.test(f[0]) && f[0] == "STYLE") {
                      h = [];
                      g = -1;
                      for (k = 1; k < f.length; k++) f[k].includes("::cue") && (h.push([]), g = h.length - 1), g != -1 && (h[g].push(f[k]), f[k].includes("}") && (g = -1));
                      h = t(h);
                      for (g = h.next(); !g.done; g = h.next()) {
                        var l = g.value;
                        g = "global";
                        (k = l[0].match(/\((.*)\)/)) && (g = k.pop());
                        k = l.slice(1, -1);
                        l[0].includes("}") && (l = /\{(.*?)\}/.exec(l[0])) && (k = l[1].split(";"));
                        (l = d.get(g)) || (l = new Td(0, 0, ""));
                        for (var m = false, n = 0; n < k.length; n++) {
                          var q = /^\s*([^:]+):\s*(.*)/.exec(k[n]);
                          if (q) {
                            var r = q[2].trim().replace(";", "");
                            switch (q[1].trim()) {
                              case "background-color":
                              case "background":
                                m = true;
                                l.backgroundColor = r;
                                break;
                              case "color":
                                m = true;
                                l.color = r;
                                break;
                              case "font-family":
                                m = true;
                                l.fontFamily = r;
                                break;
                              case "font-size":
                                m = true;
                                l.fontSize = r;
                                break;
                              case "font-weight":
                                if (parseInt(r, 10) >= 700 || r == "bold") m = true, l.fontWeight = pe;
                                break;
                              case "font-style":
                                switch (r) {
                                  case "normal":
                                    m = true;
                                    l.fontStyle = be;
                                    break;
                                  case "italic":
                                    m = true;
                                    l.fontStyle = qe;
                                    break;
                                  case "oblique":
                                    m = true, l.fontStyle = "oblique";
                                }
                                break;
                              case "opacity":
                                m = true;
                                l.opacity = parseFloat(r);
                                break;
                              case "text-combine-upright":
                                m = true;
                                l.textCombineUpright = r;
                                break;
                              case "text-shadow":
                                m = true;
                                l.textShadow = r;
                                break;
                              case "white-space":
                                m = true, l.wrapLine = r != "noWrap";
                            }
                          }
                        }
                        m && d.set(g, l);
                      }
                    }
                    l = f;
                    m = a;
                    if (l.length == 1 && !l[0] || /^NOTE($|[ \t])/.test(l[0]) || l[0] == "STYLE" || l[0] == "REGION") f = null;else if (f = null, l[0].includes("--\x3e") || (f = l[0], l.splice(0, 1)), h = new Yc(l[0]), g = bd(h), n = $c(h, /[ \t]+--\x3e[ \t]+/g), k = bd(h), g == null || n == null || k == null) ab("Failed to parse VTT time code. Cue skipped:", f, l), f = null;else {
                      g += m;
                      k += m;
                      m = l.slice(1).join("\n").trim();
                      d.has("global") ? (l = d.get("global").clone(), l.startTime = g, l.endTime = k, l.payload = m) : l = new Td(g, k, m);
                      Zc(h);
                      for (g = ad(h); g;) FF(l, g, b), Zc(h), g = ad(h);
                      ee(l, d);
                      f != null && (l.id = f);
                      f = l;
                    }
                    f && e.push(f);
                  }
                  return e;
                };
                function FF(a, b, c) {
                  var d;
                  if (d = /^align:(start|middle|center|end|left|right)$/.exec(b)) b = d[1], b == "middle" ? a.textAlign = Vd : a.textAlign = se[b.toUpperCase()];else if (d = /^vertical:(lr|rl)$/.exec(b)) a.writingMode = d[1] == "lr" ? "vertical-lr" : "vertical-rl";else if (d = /^size:([\d.]+)%$/.exec(b)) a.size = Number(d[1]);else if (d = /^position:([\d.]+)%(?:,(line-left|line-right|middle|center|start|end|auto))?$/.exec(b)) a.position = Number(d[1]), d[2] && (b = d[2], a.positionAlign = b == "line-left" || b == "start" ? "line-left" : b == "line-right" || b == "end" ? "line-right" : b == "center" || b == "middle" ? "center" : Ud);else if (d = /^region:(.*)$/.exec(b)) {
                    if (b = GF(c, d[1])) a.region = b;
                  } else if (c = /^line:([\d.]+)%(?:,(start|end|center))?$/.exec(b)) a.lineInterpretation = 1, a.line = Number(c[1]), c[2] && (a.lineAlign = ue[c[2].toUpperCase()]);else if (c = /^line:(-?\d+)(?:,(start|end|center))?$/.exec(b)) a.lineInterpretation = Yd, a.line = Number(c[1]), c[2] && (a.lineAlign = ue[c[2].toUpperCase()]);
                }
                function GF(a, b) {
                  a = a.filter(function (c) {
                    return c.id == b;
                  });
                  return a.length ? a[0] : null;
                }
                S("shaka.text.VttTextParser", EF);
                EF.prototype.parseMedia = EF.prototype.parseMedia;
                EF.prototype.setManifestType = EF.prototype.setManifestType;
                EF.prototype.setSequenceMode = EF.prototype.setSequenceMode;
                EF.prototype.parseInit = EF.prototype.parseInit;
                Re("text/vtt", function () {
                  return new EF();
                });
                Re('text/vtt; codecs="vtt"', function () {
                  return new EF();
                });
                Re('text/vtt; codecs="wvtt"', function () {
                  return new EF();
                });
                function HF() {
                  this.g = null;
                }
                HF.prototype.parseInit = function (a) {
                  var b = this,
                    c = false;
                  new hh().box("moov", mh).box("trak", mh).box("mdia", mh).S("mdhd", function (d) {
                    d = Di(d.reader, d.version);
                    b.g = d.timescale;
                  }).box("minf", mh).box("stbl", mh).S("stsd", oh).box("wvtt", function () {
                    c = true;
                  }).parse(a);
                  if (!this.g) throw new U(2, 2, 2008);
                  if (!c) throw new U(2, 2, 2008);
                };
                HF.prototype.setSequenceMode = function () {};
                HF.prototype.setManifestType = function () {};
                HF.prototype.parseMedia = function (a, b) {
                  if (!a.length) return [];
                  if (!this.g) throw new U(2, 2, 2008);
                  var c = 0,
                    d = [],
                    e,
                    f = [],
                    g = false,
                    h = false,
                    k = false,
                    l = null;
                  new hh().box("moof", mh).box("traf", mh).S("tfdt", function (B) {
                    g = true;
                    c = Ci(B.reader, B.version).baseMediaDecodeTime;
                  }).S("tfhd", function (B) {
                    l = Bi(B.reader, B.flags).Td;
                  }).S("trun", function (B) {
                    h = true;
                    d = Ei(B.reader, B.version, B.flags).hh;
                  }).box("mdat", sh(function (B) {
                    k = true;
                    e = B;
                  }, false)).parse(a, false);
                  if (!k && !g && !h) throw new U(2, 2, 2008);
                  a = c;
                  for (var m = new eh(e, 0), n = t(d), q = n.next(); !q.done; q = n.next()) {
                    q = q.value;
                    var r = q.ih || l,
                      u = q.Cf ? c + q.Cf : a;
                    a = u + (r || 0);
                    var v = 0;
                    do {
                      var w = m.U();
                      v += w;
                      var z = m.U(),
                        y = null;
                      lh(z) == "vttc" ? w > 8 && (y = m.Tb(w - 8, false)) : m.skip(w - 8);
                      r && y && (w = IF(y, b.periodStart + u / this.g, b.periodStart + a / this.g), f.push(w));
                    } while (q.sampleSize && v < q.sampleSize);
                  }
                  return f.filter(gf);
                };
                function IF(a, b, c) {
                  var d, e, f;
                  new hh().box("payl", sh(function (g) {
                    d = dc(g);
                  }, false)).box("iden", sh(function (g) {
                    e = dc(g);
                  }, false)).box("sttg", sh(function (g) {
                    f = dc(g);
                  }, false)).parse(a);
                  return d ? JF(d, e, f, b, c) : null;
                }
                function JF(a, b, c, d, e) {
                  a = new Td(d, e, a);
                  ee(a);
                  b && (a.id = b);
                  if (c) for (b = new Yc(c), c = ad(b); c;) FF(a, c, []), Zc(b), c = ad(b);
                  return a;
                }
                S("shaka.text.Mp4VttParser", HF);
                HF.prototype.parseMedia = HF.prototype.parseMedia;
                HF.prototype.setManifestType = HF.prototype.setManifestType;
                HF.prototype.setSequenceMode = HF.prototype.setSequenceMode;
                HF.prototype.parseInit = HF.prototype.parseInit;
                Re('application/mp4; codecs="wvtt"', function () {
                  return new HF();
                });
                function KF() {}
                KF.prototype.parseInit = function () {};
                KF.prototype.setSequenceMode = function () {};
                KF.prototype.setManifestType = function () {};
                KF.prototype.parseMedia = function (a) {
                  var b = dc(a).replace(/\r+/g, "");
                  b = b.trim();
                  a = [];
                  if (b == "") return a;
                  b = t(b.split("\n\n"));
                  for (var c = b.next(); !c.done; c = b.next()) {
                    c = c.value.split("\n");
                    var d = new Yc(c[0]),
                      e = bd(d),
                      f = $c(d, /,/g);
                    d = bd(d);
                    if (e == null || f == null || d == null) throw new U(2, 2, 2001, "Could not parse cue time range in SubViewer");
                    a.push(new Td(e, d, c.slice(1).join("\n").trim()));
                  }
                  return a;
                };
                S("shaka.text.SbvTextParser", KF);
                KF.prototype.parseMedia = KF.prototype.parseMedia;
                KF.prototype.setManifestType = KF.prototype.setManifestType;
                KF.prototype.setSequenceMode = KF.prototype.setSequenceMode;
                KF.prototype.parseInit = KF.prototype.parseInit;
                Re("text/x-subviewer", function () {
                  return new KF();
                });
                function LF() {
                  this.g = new EF();
                }
                LF.prototype.parseInit = function () {};
                LF.prototype.setSequenceMode = function () {};
                LF.prototype.setManifestType = function () {};
                LF.prototype.parseMedia = function (a, b, c) {
                  a = dc(a);
                  a = MF(a);
                  a = Vb(ic(a));
                  return this.g.parseMedia(a, b, c, []);
                };
                function MF(a) {
                  var b = "WEBVTT\n\n";
                  if (a == "") return b;
                  a = a.replace(/\r+/g, "");
                  a = a.trim();
                  a = t(a.split("\n\n"));
                  for (var c = a.next(); !c.done; c = a.next()) c = c.value.split(/\n/), c[0].match(/\d+/) && c.shift(), c[0] = c[0].replace(/,/g, "."), b += c.join("\n").replace(/{b}/g, "<b>").replace(/{\/b}/g, "</b>").replace(/{i}/g, "<i>").replace(/{\/i}/g, "</i>").replace(/{u}/g, "<u>").replace(/{\/u}/g, "</u>") + "\n\n";
                  return b;
                }
                S("shaka.text.SrtTextParser", LF);
                LF.srt2webvtt = MF;
                LF.prototype.parseMedia = LF.prototype.parseMedia;
                LF.prototype.setManifestType = LF.prototype.setManifestType;
                LF.prototype.setSequenceMode = LF.prototype.setSequenceMode;
                LF.prototype.parseInit = LF.prototype.parseInit;
                Re("text/srt", function () {
                  return new LF();
                });
                function NF() {}
                NF.prototype.parseInit = function () {};
                NF.prototype.setSequenceMode = function () {};
                NF.prototype.setManifestType = function () {};
                NF.prototype.parseMedia = function (a) {
                  var b = "",
                    c = "",
                    d = null,
                    e = null;
                  e = dc(a).split(/\r?\n\s*\r?\n/);
                  a = t(e);
                  for (e = a.next(); !e.done; e = a.next()) {
                    var f = e.value;
                    e = f;
                    if (f = OF.exec(f)) d = f[1], e = f[2];
                    d == "V4 Styles" || d == "V4+ Styles" ? (b = e, b = c ? b + ("\n" + e) : e) : d == "Events" && (c = c ? c + ("\n" + e) : e);
                  }
                  d = [];
                  e = null;
                  b = t(b.split(/\r?\n/));
                  for (a = b.next(); !a.done; a = b.next()) if (a = a.value, !/^\s*;/.test(a) && (f = PF.exec(a))) if (a = f[1].trim(), f = f[2].trim(), a == "Format") e = f.split(QF);else if (a == "Style") {
                    a = f.split(QF);
                    f = {};
                    for (var g = 0; g < e.length && g < a.length; g++) f[e[g]] = a[g];
                    d.push(f);
                  }
                  e = [];
                  b = null;
                  c = t(c.split(/\r?\n/));
                  f = c.next();
                  for (a = {}; !f.done; a = {
                    Wi: void 0
                  }, f = c.next()) if (f = f.value, !/^\s*;/.test(f) && (g = PF.exec(f))) if (f = g[1].trim(), g = g[2].trim(), f == "Format") b = g.split(QF);else if (f == "Dialogue") {
                    g = g.split(QF);
                    f = {};
                    for (var h = 0; h < b.length && h < g.length; h++) f[b[h]] = g[h];
                    h = RF(f.Start);
                    var k = RF(f.End);
                    g = new Td(h, k, g.slice(b.length - 1).join(",").replace(/\\N/g, "\n").replace(/\{[^}]+\}/g, ""));
                    a.Wi = f.Style;
                    (a = d.find(function (l) {
                      return function (m) {
                        return m.Name == l.Wi;
                      };
                    }(a))) && SF(g, a);
                    e.push(g);
                  }
                  return e;
                };
                function SF(a, b) {
                  var c = b.Fontname;
                  c && (a.fontFamily = c);
                  if (c = b.Fontsize) a.fontSize = c + "px";
                  if (c = b.PrimaryColour) if (c = TF(c)) a.color = c;
                  if (c = b.BackColour) if (c = TF(c)) a.backgroundColor = c;
                  b.Bold && (a.fontWeight = pe);
                  b.Italic && (a.fontStyle = qe);
                  b.Underline && a.textDecoration.push(re);
                  if (c = b.Spacing) a.letterSpacing = c + "px";
                  if (c = b.Alignment) switch (parseInt(c, 10)) {
                    case 1:
                      a.displayAlign = $d;
                      a.textAlign = "start";
                      break;
                    case 2:
                      a.displayAlign = $d;
                      a.textAlign = Vd;
                      break;
                    case 3:
                      a.displayAlign = $d;
                      a.textAlign = "end";
                      break;
                    case 5:
                      a.displayAlign = "before";
                      a.textAlign = "start";
                      break;
                    case 6:
                      a.displayAlign = "before";
                      a.textAlign = Vd;
                      break;
                    case 7:
                      a.displayAlign = "before";
                      a.textAlign = "end";
                      break;
                    case 9:
                      a.displayAlign = "center";
                      a.textAlign = "start";
                      break;
                    case 10:
                      a.displayAlign = "center";
                      a.textAlign = Vd;
                      break;
                    case 11:
                      a.displayAlign = "center", a.textAlign = "end";
                  }
                  if (b = b.AlphaLevel) a.opacity = parseFloat(b);
                }
                function TF(a) {
                  a = parseInt(a.replace("&H", ""), 16);
                  return a >= 0 ? "rgba(" + (a & 255) + "," + (a >> 8 & 255) + "," + (a >> 16 & 255) + "," + (a >> 24 & 255 ^ 255) / 255 + ")" : null;
                }
                function RF(a) {
                  a = UF.exec(a);
                  return (a[1] ? parseInt(a[1].replace(":", ""), 10) : 0) * 3600 + parseInt(a[2], 10) * 60 + parseFloat(a[3]);
                }
                S("shaka.text.SsaTextParser", NF);
                NF.prototype.parseMedia = NF.prototype.parseMedia;
                NF.prototype.setManifestType = NF.prototype.setManifestType;
                NF.prototype.setSequenceMode = NF.prototype.setSequenceMode;
                NF.prototype.parseInit = NF.prototype.parseInit;
                var OF = /^\s*\[([^\]]+)\]\r?\n([\s\S]*)/,
                  PF = /^\s*([^:]+):\s*(.*)/,
                  QF = /\s*,\s*/,
                  UF = /^(\d+:)?(\d{1,2}):(\d{1,2}(?:[.]\d{1,3})?)?$/;
                Re("text/x-ssa", function () {
                  return new NF();
                });
                function VF(a, b) {
                  var c = a[b + 1] & 1 ? 7 : 9;
                  return b + c <= a.length && (a = ((a[b + 3] & 3) << 11 | a[b + 4] << 3 | (a[b + 5] & 224) >>> 5) - c, a > 0) ? {
                    $d: c,
                    ra: a
                  } : null;
                }
                function WF(a, b) {
                  var c = [96E3, 88200, 64E3, 48E3, 44100, 32E3, 24E3, 22050, 16E3, 12E3, 11025, 8E3, 7350],
                    d = (a[b + 2] & 60) >>> 2;
                  if (d > c.length - 1) return null;
                  var e = ((a[b + 2] & 192) >>> 6) + 1,
                    f = (a[b + 2] & 1) << 2;
                  f |= (a[b + 3] & 192) >>> 6;
                  return {
                    sampleRate: c[d],
                    channelCount: f,
                    codec: "mp4a.40." + e
                  };
                }
                function XF(a, b) {
                  if (b + 1 < a.length && a[b] === 255 && (a[b + 1] & 246) === 240) {
                    var c = a[b + 1] & 1 ? 7 : 9;
                    if (b + c >= a.length) return false;
                    var d = (a[b + 3] & 3) << 11 | a[b + 4] << 3 | (a[b + 5] & 224) >>> 5;
                    if (d <= c) return false;
                    b += d;
                    return b === a.length || b + 1 < a.length && a[b] === 255 && (a[b + 1] & 246) === 240;
                  }
                  return false;
                }
                function YF(a, b) {
                  switch (a) {
                    case "mp4a.40.2":
                      if (b === 1) return new Uint8Array([0, 200, 0, 128, 35, 128]);
                      if (b === 2) return new Uint8Array([33, 0, 73, 144, 2, 25, 0, 35, 128]);
                      if (b === 3) return new Uint8Array([0, 200, 0, 128, 32, 132, 1, 38, 64, 8, 100, 0, 142]);
                      if (b === 4) return new Uint8Array([0, 200, 0, 128, 32, 132, 1, 38, 64, 8, 100, 0, 128, 44, 128, 8, 2, 56]);
                      if (b === 5) return new Uint8Array([0, 200, 0, 128, 32, 132, 1, 38, 64, 8, 100, 0, 130, 48, 4, 153, 0, 33, 144, 2, 56]);
                      if (b === 6) return new Uint8Array([0, 200, 0, 128, 32, 132, 1, 38, 64, 8, 100, 0, 130, 48, 4, 153, 0, 33, 144, 2, 0, 178, 0, 32, 8, 224]);
                      break;
                    default:
                      if (b === 1) return new Uint8Array([1, 64, 34, 128, 163, 78, 230, 128, 186, 8, 0, 0, 0, 28, 6, 241, 193, 10, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 94]);
                      if (b === 2 || b === 3) return new Uint8Array([1, 64, 34, 128, 163, 94, 230, 128, 186, 8, 0, 0, 0, 0, 149, 0, 6, 241, 161, 10, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 94]);
                  }
                  return null;
                }
                function ZF(a) {
                  this.j = a;
                  this.h = 0;
                  this.g = new Map();
                  this.i = null;
                }
                p = ZF.prototype;
                p.destroy = function () {
                  this.g.clear();
                };
                p.isSupported = function (a) {
                  return a.toLowerCase().split(";")[0] == "audio/aac" ? Ic(this.convertCodecs("audio", a)) : false;
                };
                p.convertCodecs = function (a, b) {
                  return b.toLowerCase().split(";")[0] == "audio/aac" ? 'audio/mp4; codecs="' + (Oe(b) || "mp4a.40.2") + '"' : b;
                };
                p.getOriginalMimeType = function () {
                  return this.j;
                };
                p.transmux = function (a, b, c, d) {
                  for (var e = Vb(a), f = Rj(e), g = f.length; g < e.length && !XF(e, g); g++);
                  a = c.endTime * 1E3;
                  f = Qj(f);
                  f.length && c && (f = f.find(function (m) {
                    return m.description === "com.apple.streaming.transportStreamTimestamp";
                  })) && (a = f.data);
                  f = WF(e, g);
                  if (!f) return Promise.reject(new U(2, 3, 3018, c ? c.P()[0] : null));
                  b.audioSamplingRate = f.sampleRate;
                  b.channelsCount = f.channelCount;
                  for (var h = []; g < e.length;) {
                    var k = VF(e, g);
                    if (!k) return Promise.reject(new U(2, 3, 3018, c ? c.P()[0] : null));
                    var l = k.$d + k.ra;
                    g + l <= e.length && h.push({
                      data: e.subarray(g + k.$d, g + l),
                      size: k.ra,
                      duration: 1024,
                      sb: 0,
                      flags: {
                        xb: 0,
                        mb: 0,
                        jb: 0,
                        gb: 0,
                        hb: 2,
                        yb: 0
                      }
                    });
                    g += l;
                  }
                  e = f.sampleRate;
                  a = Math.floor(a * e / 1E3);
                  d = {
                    id: b.id,
                    type: "audio",
                    codecs: f.codec,
                    encrypted: b.encrypted && b.drmInfos.length > 0,
                    timescale: e,
                    duration: d,
                    Bb: [],
                    Ga: new Uint8Array([]),
                    Ra: new Uint8Array([]),
                    Za: 0,
                    $a: 0,
                    data: {
                      sequenceNumber: this.h,
                      baseMediaDecodeTime: a,
                      zb: h
                    },
                    stream: b
                  };
                  d = new Ki([d]);
                  c = b.id + "_" + c.i;
                  this.g.has(c) ? b = this.g.get(c) : (b = Li(d), this.g.set(c, b));
                  c = this.i !== b;
                  d = fj(d);
                  this.i = b;
                  this.h++;
                  return Promise.resolve({
                    data: d,
                    init: c ? b : null
                  });
                };
                S("shaka.transmuxer.AacTransmuxer", ZF);
                ZF.prototype.transmux = ZF.prototype.transmux;
                ZF.prototype.getOriginalMimeType = ZF.prototype.getOriginalMimeType;
                ZF.prototype.convertCodecs = ZF.prototype.convertCodecs;
                ZF.prototype.isSupported = ZF.prototype.isSupported;
                ZF.prototype.destroy = ZF.prototype.destroy;
                xe("audio/aac", function () {
                  return new ZF("audio/aac");
                }, De);
                function $F(a, b) {
                  if (b + 8 > a.length || a[b] !== 11 || a[b + 1] !== 119) return null;
                  var c = a[b + 4] >> 6;
                  if (c >= 3) return null;
                  var d = a[b + 4] & 63,
                    e = [64, 69, 96, 64, 70, 96, 80, 87, 120, 80, 88, 120, 96, 104, 144, 96, 105, 144, 112, 121, 168, 112, 122, 168, 128, 139, 192, 128, 140, 192, 160, 174, 240, 160, 175, 240, 192, 208, 288, 192, 209, 288, 224, 243, 336, 224, 244, 336, 256, 278, 384, 256, 279, 384, 320, 348, 480, 320, 349, 480, 384, 417, 576, 384, 418, 576, 448, 487, 672, 448, 488, 672, 512, 557, 768, 512, 558, 768, 640, 696, 960, 640, 697, 960, 768, 835, 1152, 768, 836, 1152, 896, 975, 1344, 896, 976, 1344, 1024, 1114, 1536, 1024, 1115, 1536, 1152, 1253, 1728, 1152, 1254, 1728, 1280, 1393, 1920, 1280, 1394, 1920][d * 3 + c] * 2;
                  if (b + e > a.length) return null;
                  var f = a[b + 6] >> 5,
                    g = 0;
                  f === 2 ? g += 2 : (f & 1 && f !== 1 && (g += 2), f & 4 && (g += 2));
                  g = (a[b + 6] << 8 | a[b + 7]) >> 12 - g & 1;
                  var h = a[b + 5] & 7;
                  a = new Uint8Array([c << 6 | a[b + 5] >> 3 << 1 | h >> 2, (h & 3) << 6 | f << 3 | g << 2 | d >> 4, d << 4 & 224]);
                  return {
                    sampleRate: [48E3, 44100, 32E3][c],
                    channelCount: [2, 1, 2, 3, 3, 4, 4, 5][f] + g,
                    Ga: a,
                    ra: e
                  };
                }
                function aG(a, b) {
                  if (a[b] === 11 && a[b + 1] === 119) {
                    var c = 0,
                      d = 5;
                    b += d;
                    for (var e, f; d > 0;) {
                      f = a[b];
                      var g = Math.min(d, 8),
                        h = 8 - g;
                      e = 4278190080 >>> 24 + h << h;
                      e = (f & e) >> h;
                      c = c ? c << g | e : e;
                      b += 1;
                      d -= g;
                    }
                    if (c < 16) return true;
                  }
                  return false;
                }
                function bG(a) {
                  this.j = a;
                  this.h = 0;
                  this.g = new Map();
                  this.i = null;
                }
                p = bG.prototype;
                p.destroy = function () {
                  this.g.clear();
                };
                p.isSupported = function (a) {
                  return a.toLowerCase().split(";")[0] == "audio/ac3" ? Ic(this.convertCodecs("audio", a)) : false;
                };
                p.convertCodecs = function (a, b) {
                  return b.toLowerCase().split(";")[0] == "audio/ac3" ? tb().oe() ? 'audio/mp4; codecs="ec-3"' : 'audio/mp4; codecs="ac-3"' : b;
                };
                p.getOriginalMimeType = function () {
                  return this.j;
                };
                p.transmux = function (a, b, c, d) {
                  a = Vb(a);
                  for (var e = Rj(a), f = e.length; f < a.length && !aG(a, f); f++);
                  var g = c.endTime * 1E3;
                  e = Qj(e);
                  e.length && c && (e = e.find(function (m) {
                    return m.description === "com.apple.streaming.transportStreamTimestamp";
                  })) && (g = e.data);
                  e = 0;
                  for (var h = new Uint8Array([]), k = []; f < a.length;) {
                    var l = $F(a, f);
                    if (!l) return Promise.reject(new U(2, 3, 3018, c ? c.P()[0] : null));
                    b.audioSamplingRate = l.sampleRate;
                    b.channelsCount = l.channelCount;
                    e = l.sampleRate;
                    h = l.Ga;
                    k.push({
                      data: a.subarray(f, f + l.ra),
                      size: l.ra,
                      duration: 1536,
                      sb: 0,
                      flags: {
                        xb: 0,
                        mb: 0,
                        jb: 0,
                        gb: 0,
                        hb: 2,
                        yb: 0
                      }
                    });
                    f += l.ra;
                  }
                  a = Math.floor(g * e / 1E3);
                  d = {
                    id: b.id,
                    type: "audio",
                    codecs: "ac-3",
                    encrypted: b.encrypted && b.drmInfos.length > 0,
                    timescale: e,
                    duration: d,
                    Bb: [],
                    Ga: h,
                    Ra: new Uint8Array([]),
                    Za: 0,
                    $a: 0,
                    data: {
                      sequenceNumber: this.h,
                      baseMediaDecodeTime: a,
                      zb: k
                    },
                    stream: b
                  };
                  d = new Ki([d]);
                  c = b.id + "_" + c.i;
                  this.g.has(c) ? b = this.g.get(c) : (b = Li(d), this.g.set(c, b));
                  c = this.i !== b;
                  d = fj(d);
                  this.i = b;
                  this.h++;
                  return Promise.resolve({
                    data: d,
                    init: c ? b : null
                  });
                };
                S("shaka.transmuxer.Ac3Transmuxer", bG);
                bG.prototype.transmux = bG.prototype.transmux;
                bG.prototype.getOriginalMimeType = bG.prototype.getOriginalMimeType;
                bG.prototype.convertCodecs = bG.prototype.convertCodecs;
                bG.prototype.isSupported = bG.prototype.isSupported;
                bG.prototype.destroy = bG.prototype.destroy;
                xe("audio/ac3", function () {
                  return new bG("audio/ac3");
                }, De);
                function cG(a, b) {
                  if (b + 8 > a.length || (a[b] << 8 | a[b + 1] << 0) !== 2935) return null;
                  var c = new Tj(a.subarray(b + 2));
                  Vj(c, 2);
                  Vj(c, 3);
                  var d = Wj(c, 11) + 1 << 1,
                    e = Wj(c, 2);
                  if (e == 3) {
                    e = Wj(c, 2);
                    e = [24E3, 22060, 16E3][e];
                    var f = 3;
                  } else e = [48E3, 44100, 32E3][e], f = Wj(c, 2);
                  var g = Wj(c, 3),
                    h = Wj(c, 1);
                  c = Wj(c, 5);
                  if (b + d > a.byteLength) return null;
                  a = Math.floor(d * e / ([1, 2, 3, 6][f] * 16));
                  a = new Uint8Array([(a & 8160) >> 5, (a & 31) << 3, e << 6 | c << 1 | 0, 0 | g << 1 | h << 0, 0]);
                  return {
                    sampleRate: e,
                    channelCount: [2, 1, 2, 3, 3, 4, 4, 5][g] + h,
                    Ga: a,
                    ra: d
                  };
                }
                function dG(a) {
                  this.j = a;
                  this.h = 0;
                  this.g = new Map();
                  this.i = null;
                }
                p = dG.prototype;
                p.destroy = function () {
                  this.g.clear();
                };
                p.isSupported = function (a) {
                  return a.toLowerCase().split(";")[0] == "audio/ec3" ? Ic(this.convertCodecs("audio", a)) : false;
                };
                p.convertCodecs = function (a, b) {
                  return b.toLowerCase().split(";")[0] == "audio/ec3" ? 'audio/mp4; codecs="ec-3"' : b;
                };
                p.getOriginalMimeType = function () {
                  return this.j;
                };
                p.transmux = function (a, b, c, d) {
                  a = Vb(a);
                  for (var e = Rj(a), f = e.length; f < a.length && (a[f] << 8 | a[f + 1] << 0) !== 2935; f++);
                  var g = c.endTime * 1E3;
                  e = Qj(e);
                  e.length && c && (e = e.find(function (m) {
                    return m.description === "com.apple.streaming.transportStreamTimestamp";
                  })) && (g = e.data);
                  e = 0;
                  for (var h = new Uint8Array([]), k = []; f < a.length;) {
                    var l = cG(a, f);
                    if (!l) return Promise.reject(new U(2, 3, 3018, c ? c.P()[0] : null));
                    b.audioSamplingRate = l.sampleRate;
                    b.channelsCount = l.channelCount;
                    e = l.sampleRate;
                    h = l.Ga;
                    k.push({
                      data: a.subarray(f, f + l.ra),
                      size: l.ra,
                      duration: 1536,
                      sb: 0,
                      flags: {
                        xb: 0,
                        mb: 0,
                        jb: 0,
                        gb: 0,
                        hb: 2,
                        yb: 0
                      }
                    });
                    f += l.ra;
                  }
                  a = Math.floor(g * e / 1E3);
                  d = {
                    id: b.id,
                    type: "audio",
                    codecs: "ec-3",
                    encrypted: b.encrypted && b.drmInfos.length > 0,
                    timescale: e,
                    duration: d,
                    Bb: [],
                    Ga: h,
                    Ra: new Uint8Array([]),
                    Za: 0,
                    $a: 0,
                    data: {
                      sequenceNumber: this.h,
                      baseMediaDecodeTime: a,
                      zb: k
                    },
                    stream: b
                  };
                  d = new Ki([d]);
                  c = b.id + "_" + c.i;
                  this.g.has(c) ? b = this.g.get(c) : (b = Li(d), this.g.set(c, b));
                  c = this.i !== b;
                  d = fj(d);
                  this.i = b;
                  this.h++;
                  return Promise.resolve({
                    data: d,
                    init: c ? b : null
                  });
                };
                S("shaka.transmuxer.Ec3Transmuxer", dG);
                dG.prototype.transmux = dG.prototype.transmux;
                dG.prototype.getOriginalMimeType = dG.prototype.getOriginalMimeType;
                dG.prototype.convertCodecs = dG.prototype.convertCodecs;
                dG.prototype.isSupported = dG.prototype.isSupported;
                dG.prototype.destroy = dG.prototype.destroy;
                xe("audio/ec3", function () {
                  return new dG("audio/ec3");
                }, De);
                function eG(a) {
                  if (!a.length) return null;
                  var b = a.find(function (v) {
                    return v.type == 7;
                  });
                  a = a.find(function (v) {
                    return v.type == 8;
                  });
                  if (!b || !a) return null;
                  var c = new Tj(b.data),
                    d = bk(c);
                  bk(c);
                  bk(c);
                  Yj(c);
                  if (fG.includes(d) && (d = W(c), d === 3 && Vj(c, 1), Yj(c), Yj(c), Vj(c, 1), ak(c))) {
                    d = d !== 3 ? 8 : 12;
                    for (var e = 0; e < d; e++) ak(c) && (e < 6 ? ck(c, 16) : ck(c, 64));
                  }
                  Yj(c);
                  d = W(c);
                  if (d === 0) W(c);else if (d === 1) for (Vj(c, 1), Yj(c), Yj(c), d = W(c), e = 0; e < d; e++) Yj(c);
                  Yj(c);
                  Vj(c, 1);
                  var f = W(c),
                    g = W(c),
                    h = Wj(c, 1);
                  h === 0 && Vj(c, 1);
                  Vj(c, 1);
                  var k = 0,
                    l = 0,
                    m = 0,
                    n = 0;
                  ak(c) && (k = W(c), l = W(c), m = W(c), n = W(c));
                  e = d = 1;
                  if (ak(c) && ak(c)) {
                    var q = bk(c),
                      r = [1, 12, 10, 16, 40, 24, 20, 32, 80, 18, 15, 64, 160, 4, 3, 2],
                      u = [1, 11, 11, 11, 33, 11, 11, 11, 33, 11, 11, 33, 99, 3, 2, 1];
                    q > 0 && q <= 16 ? (d = r[q - 1], e = u[q - 1]) : q === 255 && (d = Wj(c, 16), e = Wj(c, 16));
                  }
                  c = (2 - h) * (g + 1) * 16 - m * 2 - n * 2;
                  f = (f + 1) * 16 - k * 2 - l * 2;
                  k = [];
                  b = b.fullData;
                  k.push(b.byteLength >>> 8 & 255);
                  k.push(b.byteLength & 255);
                  k = k.concat.apply(k, x(b));
                  b = [];
                  a = a.fullData;
                  b.push(a.byteLength >>> 8 & 255);
                  b.push(a.byteLength & 255);
                  b = b.concat.apply(b, x(a));
                  a = new Uint8Array([1, k[3], k[4], k[5], 255, 225].concat(k, [1], b));
                  return {
                    height: c,
                    width: f,
                    Ra: a,
                    Za: d,
                    $a: e
                  };
                }
                function gG(a) {
                  function b(u) {
                    e = {
                      data: new Uint8Array([]),
                      frame: false,
                      isKeyframe: false,
                      pts: u.pts,
                      dts: u.dts,
                      nalus: []
                    };
                  }
                  function c() {
                    if (e && e.nalus.length && e.frame) {
                      for (var u = [], v = t(e.nalus), w = v.next(); !w.done; w = v.next()) {
                        w = w.value;
                        var z = w.fullData.byteLength,
                          y = new Uint8Array(4);
                        y[0] = z >> 24 & 255;
                        y[1] = z >> 16 & 255;
                        y[2] = z >> 8 & 255;
                        y[3] = z & 255;
                        u.push(y);
                        u.push(w.fullData);
                      }
                      e.data = tc.apply(mc, x(u));
                      d.push(e);
                    }
                  }
                  for (var d = [], e = null, f = false, g = 0; g < a.length; g++) {
                    var h = a[g],
                      k = h.nalus,
                      l = false;
                    e && k.length && !f && (c(), b(h));
                    k = t(h.nalus);
                    for (var m = k.next(); !m.done; m = k.next()) {
                      m = m.value;
                      var n = false;
                      switch (m.type) {
                        case 1:
                          var q = false;
                          n = true;
                          var r = m.data;
                          l && r.length > 4 && (r = dk(new Tj(r)), r === 2 || r === 4 || r === 7 || r === 9) && (q = true);
                          q && e && e.frame && !e.isKeyframe && (c(), e = null);
                          e || b(h);
                          e.frame = true;
                          e.isKeyframe = q;
                          break;
                        case 5:
                          n = true;
                          e && e.frame && !e.isKeyframe && (c(), e = null);
                          e || b(h);
                          e.frame = true;
                          e.isKeyframe = true;
                          break;
                        case 6:
                          n = true;
                          break;
                        case 7:
                          l = n = true;
                          break;
                        case 8:
                          n = true;
                          break;
                        case 9:
                          f = n = true;
                          e && e.frame && (c(), e = null);
                          e || b(h);
                          break;
                        case 12:
                          n = true;
                          break;
                        default:
                          n = false;
                      }
                      e && n && e.nalus.push(m);
                    }
                  }
                  c();
                  return d;
                }
                var fG = [100, 110, 122, 244, 44, 83, 86, 118, 128, 138, 139, 134];
                function hG(a) {
                  if (!a.length) return null;
                  var b = a.find(function (g) {
                      return g.type == 32;
                    }),
                    c = a.find(function (g) {
                      return g.type == 33;
                    }),
                    d = a.find(function (g) {
                      return g.type == 34;
                    });
                  if (!b || !c || !d) return null;
                  var e = iG(b.fullData);
                  a = jG(c.fullData);
                  var f = kG(d.fullData);
                  b = lG(b.fullData, c.fullData, d.fullData, {
                    Tg: e.Tg,
                    Ah: e.Ah,
                    Eg: a.Eg,
                    Fg: a.Fg,
                    yg: a.yg,
                    Dg: a.Dg,
                    zg: a.zg,
                    Ag: a.Ag,
                    Bg: a.Bg,
                    Cg: a.Cg,
                    rg: a.rg,
                    sg: a.sg,
                    ug: a.ug,
                    vg: a.vg,
                    wg: a.wg,
                    xg: a.xg,
                    pf: a.pf,
                    gg: a.gg,
                    fg: a.fg,
                    eg: a.eg,
                    Vg: f.Vg,
                    qg: a.qg,
                    pg: a.pg
                  });
                  return {
                    height: a.height,
                    width: a.width,
                    Ra: b,
                    Za: a.Qk,
                    $a: a.Pk
                  };
                }
                function iG(a) {
                  var b = new Tj(a, true);
                  bk(b);
                  bk(b);
                  Wj(b, 4);
                  Wj(b, 2);
                  Wj(b, 6);
                  a = Wj(b, 3);
                  b = ak(b);
                  return {
                    Tg: a + 1,
                    Ah: b
                  };
                }
                function jG(a) {
                  a = new Tj(a, true);
                  bk(a);
                  bk(a);
                  var b = 0,
                    c = 0,
                    d = 0,
                    e = 0;
                  Wj(a, 4);
                  var f = Wj(a, 3);
                  ak(a);
                  for (var g = Wj(a, 2), h = Wj(a, 1), k = Wj(a, 5), l = bk(a), m = bk(a), n = bk(a), q = bk(a), r = bk(a), u = bk(a), v = bk(a), w = bk(a), z = bk(a), y = bk(a), B = bk(a), D = [], I = [], C = 0; C < f; C++) D.push(ak(a)), I.push(ak(a));
                  if (f > 0) for (C = f; C < 8; C++) Wj(a, 2);
                  for (C = 0; C < f; C++) D[C] && Wj(a, 88), I[C] && bk(a);
                  W(a);
                  D = W(a);
                  D == 3 && Wj(a, 1);
                  I = W(a);
                  C = W(a);
                  ak(a) && (b += W(a), c += W(a), d += W(a), e += W(a));
                  var A = W(a),
                    E = W(a),
                    J = W(a);
                  if (ak(a)) for (var H = 0; H <= f; H++) W(a), W(a), W(a);else W(a), W(a), W(a);
                  W(a);
                  W(a);
                  W(a);
                  W(a);
                  W(a);
                  W(a);
                  if (ak(a) && ak(a)) for (H = 0; H < 4; H++) for (var K = 0; K < (H === 3 ? 2 : 6); K++) if (ak(a)) {
                    var L = Math.min(64, 1 << 4 + (H << 1));
                    H > 1 && Zj(a);
                    for (var O = 0; O < L; O++) Zj(a);
                  } else W(a);
                  ak(a);
                  ak(a);
                  ak(a) && (bk(a), W(a), W(a), ak(a));
                  H = W(a);
                  for (L = K = 0; L < H; L++) if (O = false, L !== 0 && (O = ak(a)), O) {
                    L === H && W(a);
                    ak(a);
                    W(a);
                    for (var Q = O = 0; Q <= K; Q++) {
                      var N = ak(a),
                        M = false;
                      N || (M = ak(a));
                      (N || M) && O++;
                    }
                    K = O;
                  } else {
                    Q = W(a);
                    O = W(a);
                    K = Q + O;
                    for (N = 0; N < Q; N++) W(a), ak(a);
                    for (Q = 0; Q < O; Q++) W(a), ak(a);
                  }
                  if (ak(a)) for (H = W(a), K = 0; K < H; K++) {
                    for (L = 0; L < J + 4; L++) Wj(a, 1);
                    Wj(a, 1);
                  }
                  H = J = 1;
                  K = true;
                  L = 1;
                  Q = O = 0;
                  ak(a);
                  ak(a);
                  if (ak(a)) {
                    if (ak(a)) {
                      N = bk(a);
                      M = [1, 12, 10, 16, 40, 24, 20, 32, 80, 18, 15, 64, 160, 4, 3, 2];
                      var R = [1, 11, 11, 11, 33, 11, 11, 11, 33, 11, 11, 33, 99, 3, 2, 1];
                      N > 0 && N <= 16 ? (J = M[N - 1], H = R[N - 1]) : N === 255 && (J = Wj(a, 16), H = Wj(a, 16));
                    }
                    ak(a) && ak(a);
                    ak(a) && (Wj(a, 3), ak(a), ak(a) && (bk(a), bk(a), bk(a)));
                    ak(a) && (W(a), W(a));
                    ak(a);
                    ak(a);
                    ak(a);
                    if (N = ak(a)) Yj(a), Yj(a), Yj(a), Yj(a);
                    if (ak(a) && (L = Wj(a, 32), O = Wj(a, 32), ak(a) && W(a), ak(a))) {
                      R = false;
                      N = ak(a);
                      M = ak(a);
                      if (N || M) {
                        if (R = ak(a)) bk(a), Wj(a, 5), ak(a), Wj(a, 5);
                        Wj(a, 4);
                        Wj(a, 4);
                        R && Wj(a, 4);
                        Wj(a, 5);
                        Wj(a, 5);
                        Wj(a, 5);
                      }
                      for (var T = 0; T <= f; T++) {
                        K = ak(a);
                        var pa = true,
                          Y = 1;
                        K || (pa = ak(a));
                        var Ha = false;
                        pa ? W(a) : Ha = ak(a);
                        Ha || (Y = W(a) + 1);
                        if (N) {
                          for (pa = 0; pa < Y; pa++) W(a), W(a), R && (W(a), W(a));
                          ak(a);
                        }
                        if (M) {
                          for (pa = 0; pa < Y; pa++) W(a), W(a), R && (W(a), W(a));
                          ak(a);
                        }
                      }
                    }
                    ak(a) && (ak(a), ak(a), ak(a), Q = W(a), W(a), W(a), W(a), W(a));
                  }
                  return {
                    yg: B,
                    Eg: g,
                    Fg: h,
                    Dg: k,
                    zg: l,
                    Ag: m,
                    Bg: n,
                    Cg: q,
                    rg: r,
                    sg: u,
                    ug: v,
                    vg: w,
                    wg: z,
                    xg: y,
                    pf: Q,
                    gg: D,
                    fg: A,
                    eg: E,
                    width: I - (b + c) * (D === 1 || D === 2 ? 2 : 1),
                    height: C - (d + e) * (D === 1 ? 2 : 1),
                    Qk: J,
                    Pk: H,
                    qg: O / L,
                    pg: K
                  };
                }
                function kG(a) {
                  var b = new Tj(a, true);
                  bk(b);
                  bk(b);
                  W(b);
                  W(b);
                  ak(b);
                  ak(b);
                  Wj(b, 3);
                  ak(b);
                  ak(b);
                  W(b);
                  W(b);
                  Zj(b);
                  ak(b);
                  ak(b);
                  ak(b) && W(b);
                  Zj(b);
                  Zj(b);
                  ak(b);
                  ak(b);
                  ak(b);
                  ak(b);
                  a = ak(b);
                  b = ak(b);
                  var c = 1;
                  b && a ? c = 0 : b ? c = 3 : a && (c = 2);
                  return {
                    Vg: c
                  };
                }
                function lG(a, b, c, d) {
                  var e = new Uint8Array(23 + (5 + a.byteLength) + (5 + b.byteLength) + (5 + c.byteLength));
                  e[0] = 1;
                  e[1] = (d.Eg & 3) << 6 | (d.Fg ? 1 : 0) << 5 | d.Dg & 31;
                  e[2] = d.zg;
                  e[3] = d.Ag;
                  e[4] = d.Bg;
                  e[5] = d.Cg;
                  e[6] = d.rg;
                  e[7] = d.sg;
                  e[8] = d.ug;
                  e[9] = d.vg;
                  e[10] = d.wg;
                  e[11] = d.xg;
                  e[12] = d.yg;
                  e[13] = 240 | (d.pf & 3840) >> 8;
                  e[14] = d.pf & 255;
                  e[15] = 252 | d.Vg & 3;
                  e[16] = 252 | d.gg & 3;
                  e[17] = 248 | d.fg & 7;
                  e[18] = 248 | d.eg & 7;
                  e[19] = 0;
                  e[20] = parseInt(d.qg, 10);
                  e[21] = ((d.pg ? 1 : 0) & 3) << 6 | (d.Tg & 7) << 3 | (d.Ah ? 1 : 0) << 2 | 3;
                  e[22] = 3;
                  a = [a, b, c];
                  b = 23;
                  c = a.length - 1;
                  for (d = 0; d < a.length; d += 1) e.set(new Uint8Array([32 + d | (d === c ? 128 : 0), 0, 1]), b), b += 3, e.set(new Uint8Array([a[d].byteLength >> 8, a[d].byteLength & 255]), b), b += 2, e.set(a[d], b), b += a[d].byteLength;
                  return e;
                }
                function mG(a, b) {
                  var c = a[b + 1] >> 3 & 3,
                    d = a[b + 1] >> 1 & 3,
                    e = a[b + 2] >> 4 & 15,
                    f = a[b + 2] >> 2 & 3;
                  if (c !== 1 && e !== 0 && e !== 15 && f !== 3) {
                    var g = a[b + 3] >> 6;
                    e = nG[(c === 3 ? 3 - d : d === 3 ? 3 : 4) * 14 + e - 1] * 1E3;
                    f = oG[(c === 3 ? 0 : c === 2 ? 1 : 2) * 3 + f];
                    c = pG[c][d];
                    var h = qG[d],
                      k = Math.floor(c * e / f + (a[b + 2] >> 1 & 1)) * h,
                      l = (navigator.userAgent || "").match(/Chrome\/(\d+)/i);
                    (l = l ? parseInt(l[1], 10) : 0) && l <= 87 && d === 2 && e >= 224E3 && g === 0 && (a[b + 3] |= 128);
                    return {
                      sampleRate: f,
                      channelCount: g === 3 ? 1 : 2,
                      ra: k,
                      Ok: c * 8 * h
                    };
                  }
                  return null;
                }
                function rG(a, b) {
                  return a[b] === 255 && (a[b + 1] & 224) === 224 && (a[b + 1] & 6) !== 0;
                }
                function sG(a, b) {
                  if (b + 1 < a.length && rG(a, b)) {
                    var c = mG(a, b),
                      d = 4;
                    c && c.ra && (d = c.ra);
                    b += d;
                    return b === a.length || b + 1 < a.length && rG(a, b);
                  }
                  return false;
                }
                var nG = [32, 64, 96, 128, 160, 192, 224, 256, 288, 320, 352, 384, 416, 448, 32, 48, 56, 64, 80, 96, 112, 128, 160, 192, 224, 256, 320, 384, 32, 40, 48, 56, 64, 80, 96, 112, 128, 160, 192, 224, 256, 320, 32, 48, 56, 64, 80, 96, 112, 128, 144, 160, 176, 192, 224, 256, 8, 16, 24, 32, 40, 48, 56, 64, 80, 96, 112, 128, 144, 160],
                  oG = [44100, 48E3, 32E3, 22050, 24E3, 16E3, 11025, 12E3, 8E3],
                  pG = [[0, 72, 144, 12], [0, 0, 0, 0], [0, 72, 144, 12], [0, 144, 144, 12]],
                  qG = [0, 1, 1, 4];
                function tG(a) {
                  this.j = a;
                  this.h = 0;
                  this.g = new Map();
                  this.i = null;
                }
                p = tG.prototype;
                p.destroy = function () {
                  this.g.clear();
                };
                p.isSupported = function (a) {
                  return a.toLowerCase().split(";")[0] == "audio/mpeg" ? Ic(this.convertCodecs("audio", a)) : false;
                };
                p.convertCodecs = function (a, b) {
                  return b.toLowerCase().split(";")[0] == "audio/mpeg" ? 'audio/mp4; codecs="mp3"' : b;
                };
                p.getOriginalMimeType = function () {
                  return this.j;
                };
                p.transmux = function (a, b, c, d) {
                  for (var e = Vb(a), f = Rj(e).length; f < e.length && !sG(e, f); f++);
                  var g;
                  for (a = []; f < e.length;) {
                    var h = mG(e, f);
                    if (!h) return Promise.reject(new U(2, 3, 3018, c ? c.P()[0] : null));
                    g || (g = h);
                    f + h.ra <= e.length && a.push({
                      data: e.subarray(f, f + h.ra),
                      size: h.ra,
                      duration: 1152,
                      sb: 0,
                      flags: {
                        xb: 0,
                        mb: 0,
                        jb: 0,
                        gb: 0,
                        hb: 2,
                        yb: 0
                      }
                    });
                    f += h.ra;
                  }
                  if (!g) return Promise.reject(new U(2, 3, 3018, c ? c.P()[0] : null));
                  e = g.Ok * 9E4 / g.sampleRate * this.h;
                  d = {
                    id: b.id,
                    type: "audio",
                    codecs: "mp3",
                    encrypted: b.encrypted && b.drmInfos.length > 0,
                    timescale: g.sampleRate,
                    duration: d,
                    Bb: [],
                    Ga: new Uint8Array([]),
                    Ra: new Uint8Array([]),
                    Za: 0,
                    $a: 0,
                    data: {
                      sequenceNumber: this.h,
                      baseMediaDecodeTime: e,
                      zb: a
                    },
                    stream: b
                  };
                  d = new Ki([d]);
                  c = b.id + "_" + c.i;
                  this.g.has(c) ? b = this.g.get(c) : (b = Li(d), this.g.set(c, b));
                  c = this.i !== b;
                  d = fj(d);
                  this.i = b;
                  this.h++;
                  return Promise.resolve({
                    data: d,
                    init: c ? b : null
                  });
                };
                S("shaka.transmuxer.Mp3Transmuxer", tG);
                tG.prototype.transmux = tG.prototype.transmux;
                tG.prototype.getOriginalMimeType = tG.prototype.getOriginalMimeType;
                tG.prototype.convertCodecs = tG.prototype.convertCodecs;
                tG.prototype.isSupported = tG.prototype.isSupported;
                tG.prototype.destroy = tG.prototype.destroy;
                xe("audio/mpeg", function () {
                  return new tG("audio/mpeg");
                }, De);
                function uG(a) {
                  this.h = a;
                  this.g = null;
                }
                p = uG.prototype;
                p.destroy = function () {};
                p.isSupported = function (a) {
                  if (a.toLowerCase().split(";")[0] != "video/mp2t") return false;
                  var b = Oe(a).split(","),
                    c = yc("audio", b);
                  b = yc("video", b);
                  return !c || b || Ke(c) != "mp3" ? false : Ic(this.convertCodecs("audio", a));
                };
                p.convertCodecs = function (a, b) {
                  return b.toLowerCase().split(";")[0] == "video/mp2t" ? "audio/mpeg" : b;
                };
                p.getOriginalMimeType = function () {
                  return this.h;
                };
                p.transmux = function (a, b, c, d, e) {
                  this.g ? this.g.clearData() : this.g = new ek();
                  this.g.Gf(c.i);
                  a = Vb(a);
                  a = this.g.parse(a);
                  if (a.Vd().audio != "mp3" || e != "audio") return Promise.reject(new U(2, 3, 3018, c ? c.P()[0] : null));
                  c = new Uint8Array([]);
                  e = t(a.ub());
                  for (a = e.next(); !a.done; a = e.next()) if (a = a.value.data) for (b = 0; b < a.length;) (d = mG(a, b)) ? (b + d.ra <= a.length && (c = tc(c, a.subarray(b, b + d.ra))), b += d.ra) : b++;
                  return Promise.resolve(c);
                };
                S("shaka.transmuxer.MpegTsTransmuxer", uG);
                uG.prototype.transmux = uG.prototype.transmux;
                uG.prototype.getOriginalMimeType = uG.prototype.getOriginalMimeType;
                uG.prototype.convertCodecs = uG.prototype.convertCodecs;
                uG.prototype.isSupported = uG.prototype.isSupported;
                uG.prototype.destroy = uG.prototype.destroy;
                xe("video/mp2t", function () {
                  return new uG("video/mp2t");
                }, Ce); /*
                        @license
                        MSS Transmuxer
                        Copyright 2015 Dash Industry Forum
                        SPDX-License-Identifier: BSD-3-Clause
                        */
                function vG(a) {
                  this.h = a;
                  (this.g = gy.get("ISOBoxer")()) && wG(this);
                }
                function wG(a) {
                  function b() {
                    this._procFullBox();
                    this.flags & 1 && (this._procField("AlgorithmID", "uint", 24), this._procField("IV_size", "uint", 8), this._procFieldArray("KID", 16, "uint", 8));
                    this._procField("sample_count", "uint", 32);
                    this._procEntries("entry", this.sample_count, function (c) {
                      this._procEntryField(c, "InitializationVector", "data", 8);
                      this.flags & 2 && (this._procEntryField(c, "NumberOfEntries", "uint", 16), this._procSubEntries(c, "clearAndCryptedData", c.NumberOfEntries, function (d) {
                        this._procEntryField(d, "BytesOfClearData", "uint", 16);
                        this._procEntryField(d, "BytesOfEncryptedData", "uint", 32);
                      }));
                    });
                  }
                  a.g.addBoxProcessor("saio", function () {
                    this._procFullBox();
                    this.flags & 1 && (this._procField("aux_info_type", "uint", 32), this._procField("aux_info_type_parameter", "uint", 32));
                    this._procField("entry_count", "uint", 32);
                    this._procFieldArray("offset", this.entry_count, "uint", this.version === 1 ? 64 : 32);
                  });
                  a.g.addBoxProcessor("saiz", function () {
                    this._procFullBox();
                    this.flags & 1 && (this._procField("aux_info_type", "uint", 32), this._procField("aux_info_type_parameter", "uint", 32));
                    this._procField("default_sample_info_size", "uint", 8);
                    this._procField("sample_count", "uint", 32);
                    this.default_sample_info_size === 0 && this._procFieldArray("sample_info_size", this.sample_count, "uint", 8);
                  });
                  a.g.addBoxProcessor("senc", b);
                  a.g.addBoxProcessor("uuid", function () {
                    for (var c = true, d = 0; d < 16; d++) this.usertype[d] !== xG[d] && (c = false);
                    c && (this._parsing && (this.type = "sepiff"), b.call(this));
                  });
                }
                p = vG.prototype;
                p.destroy = function () {};
                p.isSupported = function (a, b) {
                  var c = a.startsWith("mss/");
                  if (!this.g || !c) return false;
                  if (b) return Ic(this.convertCodecs(b, a));
                  b = this.convertCodecs("audio", a);
                  a = this.convertCodecs("video", a);
                  return Ic(b) || Ic(a);
                };
                p.convertCodecs = function (a, b) {
                  return b.replace("mss/", "");
                };
                p.getOriginalMimeType = function () {
                  return this.h;
                };
                p.transmux = function (a, b, c) {
                  if (!c) return Promise.resolve(Vb(a));
                  if (!b.mssPrivateData) return Promise.reject(new U(2, 3, 3020, c ? c.P()[0] : null));
                  try {
                    var d,
                      e = this.g.parseBuffer(a),
                      f = e.fetch("tfhd");
                    f.track_ID = b.id + 1;
                    var g = e.fetch("tfdt"),
                      h = e.fetch("traf");
                    g === null && (g = this.g.createFullBox("tfdt", h, f), g.version = 1, g.flags = 0, g.baseMediaDecodeTime = Math.floor(c.startTime * b.mssPrivateData.timescale));
                    var k = e.fetch("trun"),
                      l = e.fetch("tfxd");
                    l && l._parent.boxes.splice(l._parent.boxes.indexOf(l), 1);
                    var m = e.fetch("tfrf");
                    m && m._parent.boxes.splice(m._parent.boxes.indexOf(m), 1);
                    var n = e.fetch("sepiff");
                    if (n !== null) {
                      n.type = "senc";
                      n.usertype = void 0;
                      var q = e.fetch("saio");
                      if (q === null) {
                        q = this.g.createFullBox("saio", h);
                        q.version = 0;
                        q.flags = 0;
                        q.entry_count = 1;
                        q.offset = [0];
                        var r = this.g.createFullBox("saiz", h);
                        r.version = 0;
                        r.flags = 0;
                        r.sample_count = n.sample_count;
                        r.default_sample_info_size = 0;
                        r.sample_info_size = [];
                        if (n.flags & 2) for (d = 0; d < n.sample_count; d += 1) r.sample_info_size[d] = 10 + 6 * n.entry[d].NumberOfEntries;else r.default_sample_info_size = 8;
                      }
                    }
                    f.flags &= 16777214;
                    f.flags |= 131072;
                    k.flags |= 1;
                    var u = e.fetch("moof");
                    k.data_offset = u.getLength() + 8;
                    var v = e.fetch("saio");
                    v !== null && (v.offset[0] = yG(u, "traf") + yG(h, "senc") + 16);
                    var w = Vb(e.write());
                    return Promise.resolve(w);
                  } catch (z) {
                    return z instanceof U ? Promise.reject(z) : Promise.reject(new U(2, 3, 3022, c ? c.P()[0] : null));
                  }
                };
                function yG(a, b) {
                  for (var c = 8, d = 0; d < a.boxes.length && a.boxes[d].type !== b; d++) c += a.boxes[d].size;
                  return c;
                }
                S("shaka.transmuxer.MssTransmuxer", vG);
                vG.prototype.transmux = vG.prototype.transmux;
                vG.prototype.getOriginalMimeType = vG.prototype.getOriginalMimeType;
                vG.prototype.convertCodecs = vG.prototype.convertCodecs;
                vG.prototype.isSupported = vG.prototype.isSupported;
                vG.prototype.destroy = vG.prototype.destroy;
                var xG = new Uint8Array([162, 57, 79, 82, 90, 155, 79, 20, 162, 68, 108, 66, 124, 100, 141, 244]);
                xe("mss/audio/mp4", function () {
                  return new vG("mss/audio/mp4");
                }, De);
                xe("mss/video/mp4", function () {
                  return new vG("mss/video/mp4");
                }, De);
                function zG(a) {
                  this.m = a;
                  this.g = 0;
                  this.j = new Map();
                  this.l = this.i = this.h = null;
                }
                p = zG.prototype;
                p.destroy = function () {
                  this.j.clear();
                  this.i && this.i.destroy();
                };
                p.isSupported = function (a, b) {
                  if (a.toLowerCase().split(";")[0] != "video/mp2t") return false;
                  var c = a;
                  b && (c = this.convertCodecs(b, a));
                  var d = Oe(c).split(",");
                  c = yc("audio", d);
                  d = yc("video", d);
                  if (c && (c = Ke(c), !AG.includes(c)) || d && (c = Ke(d), !BG.includes(c))) return false;
                  if (b) return Ic(this.convertCodecs(b, a));
                  b = this.convertCodecs("audio", a);
                  a = this.convertCodecs("video", a);
                  return Ic(b) || Ic(a);
                };
                p.convertCodecs = function (a, b) {
                  return b.toLowerCase().split(";")[0] == "video/mp2t" ? (b = Oe(b).replace("mp4a.40.34", "mp3").split(",").map(function (c) {
                    return Kf(c, "audio/mp4");
                  }).map(Lf).join(","), a == "audio" ? 'audio/mp4; codecs="' + b + '"' : 'video/mp4; codecs="' + b + '"') : b;
                };
                p.getOriginalMimeType = function () {
                  return this.m;
                };
                p.transmux = function (a, b, c, d, e) {
                  var f = Vb(a);
                  if (e == "audio" && !mk(f)) {
                    for (var g = Rj(f), h = g.length; h < f.length; h++) if (sG(f, h)) return Promise.reject(new U(2, 3, 3018, c ? c.P()[0] : null));
                    for (h = g.length; h < f.length; h++) if (XF(f, h)) return this.i || (this.i = new ZF("audio/aac")), this.i.transmux(a, b, c, d, e);
                    return Promise.reject(new U(2, 3, 3018, c ? c.P()[0] : null));
                  }
                  this.h ? this.h.clearData() : this.h = new ek();
                  this.h.Gf(c.i);
                  var k = this.h.parse(f),
                    l = [],
                    m = k.Vd();
                  try {
                    var n = null;
                    if (e == "video") {
                      switch (m.video) {
                        case "avc":
                          var q = [],
                            r = null,
                            u = k.ud(),
                            v = gG(u);
                          if (!v.length) throw new U(2, 3, 3023, c ? c.P()[0] : null);
                          for (var w = 0; w < v.length; w++) {
                            var z = v[w];
                            r == null && (r = z.dts);
                            var y = void 0;
                            y = w + 1 < v.length ? (v[w + 1].dts || 0) - (z.dts || 0) : v.length > 1 ? (z.dts || 0) - (v[w - 1].dts || 0) : (c.endTime - c.startTime) * 9E4;
                            q.push({
                              data: z.data,
                              size: z.data.byteLength,
                              duration: y,
                              sb: Math.round((z.pts || 0) - (z.dts || 0)),
                              flags: {
                                xb: 0,
                                mb: 0,
                                jb: 0,
                                gb: 0,
                                hb: z.isKeyframe ? 2 : 1,
                                yb: z.isKeyframe ? 0 : 1
                              }
                            });
                          }
                          for (var B = [], D = t(u), I = D.next(); !I.done; I = D.next()) B.push.apply(B, x(I.value.nalus));
                          var C = eG(B);
                          if (!C || r == null) throw new U(2, 3, 3018, c ? c.P()[0] : null);
                          b.height = C.height;
                          b.width = C.width;
                          n = {
                            id: b.id,
                            type: "video",
                            codecs: "avc1",
                            encrypted: b.encrypted && b.drmInfos.length > 0,
                            timescale: 9E4,
                            duration: d,
                            Bb: [],
                            Ga: new Uint8Array([]),
                            Ra: C.Ra,
                            Za: C.Za,
                            $a: C.$a,
                            data: {
                              sequenceNumber: this.g,
                              baseMediaDecodeTime: r,
                              zb: q
                            },
                            stream: b
                          };
                          break;
                        case "hvc":
                          var A = [],
                            E = null,
                            J = [],
                            H = k.ud();
                          if (!H.length) throw new U(2, 3, 3023, c ? c.P()[0] : null);
                          for (var K = 0; K < H.length; K++) {
                            var L = H[K],
                              O = L.nalus;
                            J.push.apply(J, x(O));
                            for (var Q = !1, N = [], M = !1, R = t(O), T = R.next(); !T.done; T = R.next()) {
                              var pa = T.value;
                              switch (pa.type) {
                                case 1:
                                case 0:
                                  var Y = M = !0;
                                  break;
                                case 19:
                                case 20:
                                case 21:
                                  Q = Y = M = !0;
                                  break;
                                case 32:
                                  Y = !0;
                                  break;
                                case 33:
                                  Y = !0;
                                  break;
                                case 34:
                                  Y = !0;
                                  break;
                                case 35:
                                  M = Y = !0;
                                  break;
                                case 39:
                                case 40:
                                  Y = !0;
                                  break;
                                default:
                                  Y = !1;
                              }
                              if (M && Y) {
                                var Ha = pa.fullData.byteLength,
                                  Ba = new Uint8Array(4);
                                Ba[0] = Ha >> 24 & 255;
                                Ba[1] = Ha >> 16 & 255;
                                Ba[2] = Ha >> 8 & 255;
                                Ba[3] = Ha & 255;
                                N.push(Ba);
                                N.push(pa.fullData);
                              }
                            }
                            var Ca = N.length ? {
                              data: tc.apply(mc, x(N)),
                              isKeyframe: Q
                            } : null;
                            if (Ca) {
                              E == null && L.dts != null && (E = L.dts);
                              var za = void 0;
                              za = K + 1 < H.length ? (H[K + 1].dts || 0) - (L.dts || 0) : H.length > 1 ? (L.dts || 0) - (H[K - 1].dts || 0) : (c.endTime - c.startTime) * 9E4;
                              A.push({
                                data: Ca.data,
                                size: Ca.data.byteLength,
                                duration: za,
                                sb: Math.round((L.pts || 0) - (L.dts || 0)),
                                flags: {
                                  xb: 0,
                                  mb: 0,
                                  jb: 0,
                                  gb: 0,
                                  hb: Ca.isKeyframe ? 2 : 1,
                                  yb: Ca.isKeyframe ? 0 : 1
                                }
                              });
                            }
                          }
                          var oa = hG(J);
                          if (!oa || E == null) throw new U(2, 3, 3018, c ? c.P()[0] : null);
                          b.height = oa.height;
                          b.width = oa.width;
                          n = {
                            id: b.id,
                            type: "video",
                            codecs: "hvc1",
                            encrypted: b.encrypted && b.drmInfos.length > 0,
                            timescale: 9E4,
                            duration: d,
                            Bb: [],
                            Ga: new Uint8Array([]),
                            Ra: oa.Ra,
                            Za: oa.Za,
                            $a: oa.$a,
                            data: {
                              sequenceNumber: this.g,
                              baseMediaDecodeTime: E,
                              zb: A
                            },
                            stream: b
                          };
                      }
                      n && (l.push(n), n = null);
                    }
                    if (e == "audio") {
                      switch (m.audio) {
                        case "aac":
                          for (var wa = [], Fa, Ea = null, ta = null, Za = null, bb = t(k.ub()), ib = bb.next(); !ib.done; ib = bb.next()) {
                            var Na = ib.value,
                              sc = Na.data;
                            if (sc) {
                              var Xb = 0;
                              if (ta == -1 && Za) sc = tc(Za, Na.data), ta = null;else if (ta != null && Za) {
                                Xb = Math.max(0, ta);
                                var Sf = tc(Za, sc.subarray(0, Xb));
                                wa.push({
                                  data: Sf,
                                  size: Sf.byteLength,
                                  duration: 1024,
                                  sb: 0,
                                  flags: {
                                    xb: 0,
                                    mb: 0,
                                    jb: 0,
                                    gb: 0,
                                    hb: 2,
                                    yb: 0
                                  }
                                });
                                ta = Za = null;
                              }
                              Fa = WF(sc, Xb);
                              if (!Fa) throw new U(2, 3, 3018, c ? c.P()[0] : null);
                              b.audioSamplingRate = Fa.sampleRate;
                              b.channelsCount = Fa.channelCount;
                              Ea == null && Na.pts !== null && (Ea = Na.pts);
                              for (; Xb < sc.length;) {
                                var dd = VF(sc, Xb);
                                if (!dd) {
                                  Za = sc.subarray(Xb, sc.length);
                                  ta = -1;
                                  break;
                                }
                                var ke = dd.$d + dd.ra;
                                ta = Math.max(0, Xb + ke - sc.length);
                                ta != 0 ? Za = sc.subarray(Xb + dd.$d, Xb + ke) : Xb + ke <= sc.length && wa.push({
                                  data: sc.subarray(Xb + dd.$d, Xb + ke),
                                  size: dd.ra,
                                  duration: 1024,
                                  sb: 0,
                                  flags: {
                                    xb: 0,
                                    mb: 0,
                                    jb: 0,
                                    gb: 0,
                                    hb: 2,
                                    yb: 0
                                  }
                                });
                                Xb += ke;
                              }
                            }
                          }
                          if (!Fa || Ea == null) {
                            Ea = c.startTime * 9E4;
                            var md = yc("audio", b.codecs.split(","));
                            if (!md || !b.channelsCount || !b.audioSamplingRate) throw new U(2, 3, 3018, c ? c.P()[0] : null);
                            Fa = {
                              sampleRate: b.audioSamplingRate,
                              channelCount: b.channelsCount,
                              codec: md
                            };
                            var Tf = YF(md, b.channelsCount);
                            if (!Tf) throw new U(2, 3, 3018, c ? c.P()[0] : null);
                            for (var Kj = Ea + (c.endTime - c.startTime) * 9E4, qh = Ea; qh < Kj;) wa.push({
                              data: Tf,
                              size: Tf.byteLength,
                              duration: 1024,
                              sb: 0,
                              flags: {
                                xb: 0,
                                mb: 0,
                                jb: 0,
                                gb: 0,
                                hb: 2,
                                yb: 0
                              }
                            }), qh += 1024 / Fa.sampleRate * 9E4;
                          }
                          var Wc = Fa.sampleRate,
                            DG = Ea / 9E4 * Wc;
                          n = {
                            id: b.id,
                            type: "audio",
                            codecs: Fa.codec,
                            encrypted: b.encrypted && b.drmInfos.length > 0,
                            timescale: Wc,
                            duration: d,
                            Bb: [],
                            Ga: new Uint8Array([]),
                            Ra: new Uint8Array([]),
                            Za: 0,
                            $a: 0,
                            data: {
                              sequenceNumber: this.g,
                              baseMediaDecodeTime: DG,
                              zb: wa
                            },
                            stream: b
                          };
                          break;
                        case "ac3":
                          for (var Xw = [], uk = 0, to = new Uint8Array([]), vk = null, Yw = t(k.ub()), uo = Yw.next(); !uo.done; uo = Yw.next()) {
                            var vo = uo.value,
                              wo = vo.data;
                            vk == null && vo.pts !== null && (vk = vo.pts);
                            for (var $f = 0; $f < wo.length;) {
                              var me = $F(wo, $f);
                              me ? (b.audioSamplingRate = me.sampleRate, b.channelsCount = me.channelCount, uk = me.sampleRate, to = me.Ga, Xw.push({
                                data: wo.subarray($f, $f + me.ra),
                                size: me.ra,
                                duration: 1536,
                                sb: 0,
                                flags: {
                                  xb: 0,
                                  mb: 0,
                                  jb: 0,
                                  gb: 0,
                                  hb: 2,
                                  yb: 0
                                }
                              }), $f += me.ra) : $f++;
                            }
                          }
                          if (uk == 0 || to.byteLength == 0 || vk == null) throw new U(2, 3, 3018, c ? c.P()[0] : null);
                          var EG = vk / 9E4 * uk;
                          n = {
                            id: b.id,
                            type: "audio",
                            codecs: "ac-3",
                            encrypted: b.encrypted && b.drmInfos.length > 0,
                            timescale: uk,
                            duration: d,
                            Bb: [],
                            Ga: to,
                            Ra: new Uint8Array([]),
                            Za: 0,
                            $a: 0,
                            data: {
                              sequenceNumber: this.g,
                              baseMediaDecodeTime: EG,
                              zb: Xw
                            },
                            stream: b
                          };
                          break;
                        case "ec3":
                          for (var Zw = [], wk = 0, xo = new Uint8Array([]), xk = null, $w = t(k.ub()), yo = $w.next(); !yo.done; yo = $w.next()) {
                            var zo = yo.value,
                              Ao = zo.data;
                            xk == null && zo.pts !== null && (xk = zo.pts);
                            for (var ag = 0; ag < Ao.length;) {
                              var ne = cG(Ao, ag);
                              ne ? (b.audioSamplingRate = ne.sampleRate, b.channelsCount = ne.channelCount, wk = ne.sampleRate, xo = ne.Ga, Zw.push({
                                data: Ao.subarray(ag, ag + ne.ra),
                                size: ne.ra,
                                duration: 1536,
                                sb: 0,
                                flags: {
                                  xb: 0,
                                  mb: 0,
                                  jb: 0,
                                  gb: 0,
                                  hb: 2,
                                  yb: 0
                                }
                              }), ag += ne.ra) : ag++;
                            }
                          }
                          if (wk == 0 || xo.byteLength == 0 || xk == null) throw new U(2, 3, 3018, c ? c.P()[0] : null);
                          var FG = xk / 9E4 * wk;
                          n = {
                            id: b.id,
                            type: "audio",
                            codecs: "ec-3",
                            encrypted: b.encrypted && b.drmInfos.length > 0,
                            timescale: wk,
                            duration: d,
                            Bb: [],
                            Ga: xo,
                            Ra: new Uint8Array([]),
                            Za: 0,
                            $a: 0,
                            data: {
                              sequenceNumber: this.g,
                              baseMediaDecodeTime: FG,
                              zb: Zw
                            },
                            stream: b
                          };
                          break;
                        case "mp3":
                          for (var ax = [], yk, zk = null, bx = t(k.ub()), Bo = bx.next(); !Bo.done; Bo = bx.next()) {
                            var Co = Bo.value,
                              Ch = Co.data;
                            if (Ch) {
                              zk == null && Co.pts !== null && (zk = Co.pts);
                              for (var Se = 0; Se < Ch.length;) {
                                var bg = mG(Ch, Se);
                                bg ? (yk || (yk = bg), Se + bg.ra <= Ch.length && ax.push({
                                  data: Ch.subarray(Se, Se + bg.ra),
                                  size: bg.ra,
                                  duration: 1152,
                                  sb: 0,
                                  flags: {
                                    xb: 0,
                                    mb: 0,
                                    jb: 0,
                                    gb: 0,
                                    hb: 2,
                                    yb: 0
                                  }
                                }), Se += bg.ra) : Se++;
                              }
                            }
                          }
                          if (!yk || zk == null) throw new U(2, 3, 3018, c ? c.P()[0] : null);
                          var cx = yk.sampleRate,
                            GG = zk / 9E4 * cx;
                          n = {
                            id: b.id,
                            type: "audio",
                            codecs: "mp3",
                            encrypted: b.encrypted && b.drmInfos.length > 0,
                            timescale: cx,
                            duration: d,
                            Bb: [],
                            Ga: new Uint8Array([]),
                            Ra: new Uint8Array([]),
                            Za: 0,
                            $a: 0,
                            data: {
                              sequenceNumber: this.g,
                              baseMediaDecodeTime: GG,
                              zb: ax
                            },
                            stream: b
                          };
                          break;
                        case "opus":
                          var dx = [],
                            Ak = null,
                            od = k.H;
                          if (!od) throw new U(2, 3, 3018, c ? c.P()[0] : null);
                          var Zb = [];
                          switch (od.oj) {
                            case 1:
                            case 2:
                              Zb = [0];
                              break;
                            case 0:
                              Zb = [255, 1, 1, 0, 1];
                              break;
                            case 128:
                              Zb = [255, 2, 0, 0, 1];
                              break;
                            case 3:
                              Zb = [1, 2, 1, 0, 2, 1];
                              break;
                            case 4:
                              Zb = [1, 2, 2, 0, 1, 2, 3];
                              break;
                            case 5:
                              Zb = [1, 3, 2, 0, 4, 1, 2, 3];
                              break;
                            case 6:
                              Zb = [1, 4, 2, 0, 4, 1, 2, 3, 5];
                              break;
                            case 7:
                              Zb = [1, 4, 2, 0, 4, 1, 2, 3, 5, 6];
                              break;
                            case 8:
                              Zb = [1, 5, 3, 0, 6, 1, 2, 3, 4, 5, 7];
                              break;
                            case 130:
                              Zb = [1, 1, 2, 0, 1];
                              break;
                            case 131:
                              Zb = [1, 1, 3, 0, 1, 2];
                              break;
                            case 132:
                              Zb = [1, 1, 4, 0, 1, 2, 3];
                              break;
                            case 133:
                              Zb = [1, 1, 5, 0, 1, 2, 3, 4];
                              break;
                            case 134:
                              Zb = [1, 1, 6, 0, 1, 2, 3, 4, 5];
                              break;
                            case 135:
                              Zb = [1, 1, 7, 0, 1, 2, 3, 4, 5, 6];
                              break;
                            case 136:
                              Zb = [1, 1, 8, 0, 1, 2, 3, 4, 5, 6, 7];
                          }
                          var ex = new Uint8Array([0, od.channelCount, 0, 0, od.sampleRate >>> 24 & 255, od.sampleRate >>> 17 & 255, od.sampleRate >>> 8 & 255, od.sampleRate >>> 0 & 255, 0, 0].concat(x(Zb)));
                          for (var fx = od.sampleRate, gx = t(k.ub()), Do = gx.next(); !Do.done; Do = gx.next()) {
                            var Eo = Do.value,
                              cg = Eo.data;
                            Ak == null && Eo.pts !== null && (Ak = Eo.pts);
                            for (var Dh = 0; Dh < cg.length;) {
                              for (var HG = (cg[Dh + 1] & 16) !== 0, IG = (cg[Dh + 1] & 8) !== 0, Qd = Dh + 2, Bk = 0; cg[Qd] === 255;) Bk += 255, Qd += 1;
                              Bk += cg[Qd];
                              Qd += 1;
                              Qd += HG ? 2 : 0;
                              Qd += IG ? 2 : 0;
                              var hx = cg.slice(Qd, Qd + Bk);
                              dx.push({
                                data: hx,
                                size: hx.byteLength,
                                duration: 960,
                                sb: 0,
                                flags: {
                                  xb: 0,
                                  mb: 0,
                                  jb: 0,
                                  gb: 0,
                                  hb: 2,
                                  yb: 0
                                }
                              });
                              Dh = Qd + Bk;
                            }
                          }
                          if (ex.byteLength == 0 || Ak == null) throw new U(2, 3, 3018, c ? c.P()[0] : null);
                          b.audioSamplingRate = od.sampleRate;
                          b.channelsCount = od.channelCount;
                          var JG = Ak / 9E4 * fx;
                          n = {
                            id: b.id,
                            type: "audio",
                            codecs: "opus",
                            encrypted: b.encrypted && b.drmInfos.length > 0,
                            timescale: fx,
                            duration: d,
                            Bb: [],
                            Ga: ex,
                            Ra: new Uint8Array([]),
                            Za: 0,
                            $a: 0,
                            data: {
                              sequenceNumber: this.g,
                              baseMediaDecodeTime: JG,
                              zb: dx
                            },
                            stream: b
                          };
                      }
                      n && (l.push(n), n = null);
                    }
                  } catch (Fo) {
                    return Fo && Fo.code == 3023 ? Promise.resolve(new Uint8Array([])) : Promise.reject(Fo);
                  }
                  if (!l.length) return Promise.reject(new U(2, 3, 3018, c ? c.P()[0] : null));
                  var ix = new Ki(l),
                    Go = b.id + "_" + c.i;
                  if (this.j.has(Go)) var Eh = this.j.get(Go);else Eh = Li(ix), this.j.set(Go, Eh);
                  var KG = this.l !== Eh,
                    LG = fj(ix);
                  this.l = Eh;
                  this.g++;
                  return Promise.resolve({
                    data: LG,
                    init: KG ? Eh : null
                  });
                };
                S("shaka.transmuxer.TsTransmuxer", zG);
                zG.prototype.transmux = zG.prototype.transmux;
                zG.prototype.getOriginalMimeType = zG.prototype.getOriginalMimeType;
                zG.prototype.convertCodecs = zG.prototype.convertCodecs;
                zG.prototype.isSupported = zG.prototype.isSupported;
                zG.prototype.destroy = zG.prototype.destroy;
                var AG = ["aac", "ac-3", "ec-3", "mp3", "opus"],
                  BG = ["avc", "hevc"];
                xe("video/mp2t", function () {
                  return new zG("video/mp2t");
                }, Be);
                function CG() {}
                la(CG, un);
                S("shaka.util.FairPlayUtils", CG);
              }).call(exportTo, innerGlobal, innerGlobal, undefined);
              for (var k in exportTo.shaka) exports[k] = exportTo.shaka[k];
            })();
          })(shakaPlayer_compiled);
          return shakaPlayer_compiled;
        }
        var shakaPlayer_compiledExports = requireShakaPlayer_compiled();
        var shaka = /*@__PURE__*/getDefaultExportFromCjs(shakaPlayer_compiledExports);
        var player;
        var videoElement;
        var init = /*#__PURE__*/function () {
          var _ref59 = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee23(element) {
            return _regenerator().w(function (_context24) {
              while (1) switch (_context24.n) {
                case 0:
                  shaka.polyfill.installAll(); // polyfilling for devices that need it.

                  videoElement = element;
                  if (videoElement) {
                    _context24.n = 2;
                    break;
                  }
                  videoElement = document.createElement("video");
                  videoElement.style.cssText = "position: absolute; top: 0; left: 0; z-index: -1";
                  videoElement.width = window.innerWidth;
                  videoElement.height = window.innerHeight;
                  player = new shaka.Player();
                  _context24.n = 1;
                  return player.attach(videoElement);
                case 1:
                  videoElement.autoplay = true;
                  videoElement.preload = true;
                  videoElement.muted = true;
                  player.addEventListener("error", function (err) {
                    console.error(err);
                  });
                  document.body.insertBefore(videoElement, document.body.firstChild);
                case 2:
                  return _context24.a(2);
              }
            }, _callee23);
          }));
          return function init(_x22) {
            return _ref59.apply(this, arguments);
          };
        }();
        /**
         * Loads the player.
         * @param {Object} config - The player configuration.
         * @returns {Promise<void>}
         */
        var load = /*#__PURE__*/function () {
          var _ref60 = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee24(config) {
            return _regenerator().w(function (_context25) {
              while (1) switch (_context25.n) {
                case 0:
                  if (!(!player || !videoElement)) {
                    _context25.n = 1;
                    break;
                  }
                  throw "Player not initialized yet";
                case 1:
                  _context25.n = 2;
                  return player.load(config.streamUrl);
                case 2:
                  return _context25.a(2);
              }
            }, _callee24);
          }));
          return function load(_x23) {
            return _ref60.apply(this, arguments);
          };
        }();
        var play = function play() {
          videoElement.play().then(function () {});
        };
        var Player = function Player() {
          var parent;
          var navigate = useNavigate();
          ({
            color: hexColor("00000000")
          });
          onMount(function () {
            setGlobalBackground(0x000000FF);
            parent = document.querySelector('[data-testid="player"]');
            init(parent);
            load({
              streamUrl: "https://bitdash-a.akamaihd.net/content/sintel/hls/playlist.m3u8"
            });
            play();
          });
          return createComponent(View, {
            autofocus: true,
            onBack: function onBack() {
              return navigate(-1);
            }
          });
        };
        function Background() {
          var params = new URLSearchParams(window.location.search);
          var disableBG = params.get("disableBG") === "true";
          var bg1, bg2, heroMask;
          var active = 0;
          var alpha = 1;
          var animationSettings = {
            duration: 550,
            easing: "ease-in-out"
          };
          var bgStyles = {
            alpha: alpha,
            color: 4294967295
          };
          onMount(function () {
            if (disableBG) {
              heroMask.src = "";
              heroMask.colorLeft = 0x000000FF;
              heroMask.colorRight = 0x00000000;
              return;
            }
          });
          function changeBackgrounds(img) {
            if (disableBG) {
              heroMask.src = "";
              heroMask.colorLeft = 0x000000FF;
              heroMask.colorRight = 0x00000000;
              return;
            }
            if (typeof img !== "string") {
              bg1.color = img;
              bg1.src = "";
              bg1.alpha = 1;
              active = 1;
              bg2.alpha = 0;
              heroMask.alpha = 0;
              return;
            } else {
              bg1.color = 4294967295;
              heroMask.alpha = 1;
            }
            var currentBg = active === 1 ? bg2 : bg1;
            var nextBg = active === 1 ? bg1 : bg2;
            currentBg.src = img;
            if (active === 0) {
              currentBg.alpha = 1;
            } else {
              currentBg.alpha = 0.01;
              currentBg.animate({
                alpha: 1
              }, animationSettings).start();
            }
            nextBg.animate({
              alpha: 0.01
            }, animationSettings).start();
            active = active === 1 ? 2 : 1;
          }
          createEffect(on(globalBackground, function (img) {
            changeBackgrounds(img);
          }, {
            defer: true
          }));
          return createComponent(View, {
            width: 1920,
            height: 1080,
            zIndex: -5,
            get children() {
              return [createComponent(View, {
                ref: function ref(r$) {
                  var _ref$ = bg1;
                  typeof _ref$ === "function" ? _ref$(r$) : bg1 = r$;
                },
                style: bgStyles
              }), createComponent(View, {
                ref: function ref(r$) {
                  var _ref$2 = bg2;
                  typeof _ref$2 === "function" ? _ref$2(r$) : bg2 = r$;
                },
                style: bgStyles,
                alpha: 0
              }), createComponent(View, {
                ref: function ref(r$) {
                  var _ref$3 = heroMask;
                  typeof _ref$3 === "function" ? _ref$3(r$) : heroMask = r$;
                },
                src: "./assets/hero-mask-inverted.png",
                get color() {
                  return hexColor(theme.color.materialBrand);
                },
                width: 1920,
                height: 1080
              })];
            }
          });
        }
        var styles = {
          Column: {
            flexDirection: "column",
            display: "flex",
            width: 140,
            height: 600,
            y: 360,
            gap: 20,
            zIndex: 101,
            transition: {
              x: {
                duration: 250,
                easing: "ease-in-out"
              }
            },
            x: 8,
            $focus: {
              width: 500,
              x: theme.layout.marginX
            }
          },
          Gradient: {
            zIndex: 99,
            color: 0x000000FF,
            src: "./assets/sidenav.png",
            alpha: 0,
            width: 200,
            height: 1080,
            $focus: {
              alpha: 1,
              width: 1600
            },
            transition: {
              alpha: true,
              width: true
            }
          },
          NavButton: {
            zIndex: 102,
            height: 70,
            width: 100,
            borderRadius: 8,
            color: 0,
            $focus: {
              color: 0x424242FF
            },
            $active: {
              width: 328,
              height: 70
            }
          }
        };
        var basePath = "/solid-demo-app/";
        var icons = [{
          name: "experiment",
          width: 81,
          height: 100,
          x: 0,
          y: 0
        }, {
          name: "trending",
          width: 100,
          height: 56,
          x: 81,
          y: 0
        }, {
          name: "tv",
          width: 100,
          height: 68,
          x: 181,
          y: 0
        }, {
          name: "movie",
          width: 94,
          height: 100,
          x: 282,
          y: 0
        }];
        var sprite;
        function Icon(props) {
          sprite = sprite || createSpriteMap(basePath + "assets/icons_white.png", icons);
          return createComponent(View, mergeProps(props, {
            get texture() {
              return sprite[props.name];
            },
            get width() {
              return sprite[props.name].props.width;
            },
            get height() {
              return sprite[props.name].props.height;
            },
            get x() {
              return (100 - (sprite[props.name].props.width || 0)) / 2;
            },
            get y() {
              return (100 - (sprite[props.name].props.height || 0)) / 2;
            }
          }));
        }
        var NavButtonTextStyles = {
          fontSize: 38,
          x: 116,
          y: 18,
          height: 50,
          alpha: 0,
          $active: {
            alpha: 1
          }
        };
        function NavButton(props) {
          return createComponent(View, mergeProps(props, {
            forwardStates: true,
            get style() {
              return styles.NavButton;
            },
            get children() {
              return [createComponent(View, {
                y: -16,
                get children() {
                  return createComponent(Icon, {
                    scale: 0.5,
                    get name() {
                      return props.icon;
                    }
                  });
                }
              }), createComponent(Text$1, {
                style: NavButtonTextStyles,
                get children() {
                  return props.children;
                }
              })];
            }
          }));
        }
        function NavDrawer(props) {
          var backdrop;
          var navigate = useNavigate();
          function onFocus() {
            backdrop.states.add("$focus");
            this.children.forEach(function (c) {
              return c.states.add("$active");
            });
            this.children[this.selected || 0].setFocus();
          }
          function onBlur() {
            backdrop.states.remove("$focus");
            this.selected = 0;
            this.children.forEach(function (c) {
              return c.states.remove("$active");
            });
          }
          function handleNavigate(page) {
            var isOnPage = useMatch(function () {
              return page;
            });
            if (isOnPage()) {
              return props.focusPage();
            }
            navigate(page);
          }
          return [createComponent(View, {
            flexItem: false,
            width: 300,
            height: 150,
            x: 30,
            y: 15,
            zIndex: 105,
            get alpha() {
              return props.showWidgets ? 1 : 0.01;
            },
            get children() {
              return [createComponent(Text$1, {
                x: 80,
                fontSize: 28,
                color: 4143380036,
                children: "Built With:"
              }), createComponent(View, {
                y: 22,
                src: "./assets/solidWord.png",
                width: 280,
                height: 52
              }), createComponent(View, {
                x: 0,
                y: 110,
                src: "./assets/tmdb.png",
                width: 80,
                height: 41
              }), createComponent(Text$1, {
                x: 90,
                y: 110,
                contain: "width",
                width: 160,
                fontSize: 12,
                color: 4143380036,
                children: "This product uses the TMDB API but is not endorsed or certified by TMDB."
              })];
            }
          }), createComponent(Column, mergeProps(props, {
            onFocus: onFocus,
            onBlur: onBlur,
            get style() {
              return styles.Column;
            },
            announce: "Main Menu",
            scroll: "none",
            get children() {
              return [createComponent(NavButton, {
                onEnter: function onEnter() {
                  return handleNavigate("/browse/all");
                },
                announce: ["Trending Browse", "button"],
                icon: "trending",
                children: "Trending"
              }), createComponent(NavButton, {
                icon: "movie",
                announce: ["Movies Browse", "button"],
                onEnter: function onEnter() {
                  return handleNavigate("/browse/movie");
                },
                children: "Movies"
              }), createComponent(NavButton, {
                icon: "tv",
                announce: ["TV Browse", "button"],
                onEnter: function onEnter() {
                  return handleNavigate("/browse/tv");
                },
                children: "TV"
              }), createComponent(NavButton, {
                icon: "experiment",
                announce: ["Examples", "button"],
                onEnter: function onEnter() {
                  return handleNavigate("/examples");
                },
                children: "Examples"
              })];
            }
          })), createComponent(View, {
            skipFocus: true,
            ref: function ref(r$) {
              var _ref$ = backdrop;
              typeof _ref$ === "function" ? _ref$(r$) : backdrop = r$;
            },
            get style() {
              return styles.Gradient;
            }
          })];
        }
        var LeftNavWrapper = function LeftNavWrapper(props) {
          var navigate = useNavigate();
          var announcer = useAnnouncer();
          announcer.debug = true;
          announcer.enabled = false;
          var navDrawer, lastFocused;
          setupFPS({
            renderer: renderer$1
          });
          function focusNavDrawer() {
            if (navDrawer.states.has("focus")) {
              return false;
            }
            lastFocused = activeElement();
            return navDrawer.setFocus();
          }
          var _createSignal91 = createSignal(true),
            _createSignal92 = _slicedToArray(_createSignal91, 2),
            showWidgets = _createSignal92[0],
            setShowWidgets = _createSignal92[1];
          var location = useLocation();
          var showOnPaths = ["/browse", "/entity"];
          createEffect(function () {
            var currentPath = location.pathname;
            var matchesPartial = showOnPaths.some(function (path) {
              return currentPath.startsWith(path);
            });
            if (currentPath === "/") {
              matchesPartial = true;
            }
            setShowWidgets(matchesPartial);
          });
          var _createSignal93 = createSignal(),
            _createSignal94 = _slicedToArray(_createSignal93, 2),
            lastKey = _createSignal94[0],
            setLastKey = _createSignal94[1];
          var _createSignal95 = createSignal(),
            _createSignal96 = _slicedToArray(_createSignal95, 2),
            lastError = _createSignal96[0],
            setLastError = _createSignal96[1];
          var keyPressHandler = function keyPressHandler(e) {
            setLastKey("Last key: ".concat(e.key, ", Code: ").concat(e.keyCode));
          };
          document.addEventListener("keydown", keyPressHandler);
          var displayError = function displayError(e) {
            setLastError(function (p) {
              return (p || "") + "\n" + e.message;
            });
          };
          document.addEventListener("onerror", displayError);
          onCleanup(function () {
            document.removeEventListener("onerror", displayError);
            document.removeEventListener("keydown", keyPressHandler);
          });
          var pageContainer;
          return createComponent(View, {
            ref: function ref(r$) {
              var _ref$ = window.APP;
              typeof _ref$ === "function" ? _ref$(r$) : window.APP = r$;
            },
            onAnnouncer: function onAnnouncer() {
              return announcer.enabled = !announcer.enabled;
            },
            onLast: function onLast() {
              return history.back();
            },
            onMenu: function onMenu() {
              return navigate("/");
            },
            onBack: function onBack() {
              return navigate(-1);
            },
            style: {
              width: 1920,
              height: 1080
            },
            onBackspace: focusNavDrawer,
            onLeft: focusNavDrawer,
            onRight: function onRight() {
              return navDrawer.states.has("focus") && (lastFocused || pageContainer).setFocus();
            },
            get children() {
              return [createComponent(Background, {}), createComponent(FPSCounter, {
                mountX: 1,
                x: 1910,
                y: 10,
                get alpha() {
                  return showWidgets() ? 1 : 0.01;
                }
              }), createComponent(View, {
                mountX: 1,
                width: 330,
                height: 28,
                x: 1910,
                y: 190,
                color: 255,
                get hidden() {
                  return !showWidgets();
                },
                get children() {
                  return createComponent(Text$1, {
                    fontSize: 20,
                    y: 4,
                    x: 4,
                    get children() {
                      return lastKey();
                    }
                  });
                }
              }), createComponent(Text$1, {
                x: 270,
                y: 20,
                fontSize: 24,
                contain: "width",
                width: 800,
                get children() {
                  return lastError();
                }
              }), createComponent(View, {
                ref: function ref(r$) {
                  var _ref$2 = pageContainer;
                  typeof _ref$2 === "function" ? _ref$2(r$) : pageContainer = r$;
                },
                forwardFocus: 0,
                get children() {
                  return props.children;
                }
              }), createComponent(NavDrawer, {
                ref: function ref(r$) {
                  var _ref$3 = navDrawer;
                  typeof _ref$3 === "function" ? _ref$3(r$) : navDrawer = r$;
                },
                focusPage: function focusPage() {
                  return lastFocused.setFocus();
                },
                get showWidgets() {
                  return showWidgets();
                }
              })];
            }
          });
        };
        var Grid = lazy(function () {
          return __vitePreload(function () {
            return module.import('./Grid-legacy-9WxrGHQh.js');
          }, false              ? __VITE_PRELOAD__ : void 0);
        });
        var Loops = lazy(function () {
          return __vitePreload(function () {
            return module.import('./Loops-legacy-DYSAusmQ.js');
          }, false              ? __VITE_PRELOAD__ : void 0);
        });
        var Infinite = lazy(function () {
          return __vitePreload(function () {
            return module.import('./Infinite-legacy-B9fU2v4m.js');
          }, false              ? __VITE_PRELOAD__ : void 0);
        });
        var TMDBGrid = lazy(function () {
          return __vitePreload(function () {
            return module.import('./TMDBGrid-legacy-1BeffMR4.js');
          }, false              ? __VITE_PRELOAD__ : void 0);
        });
        var Portal = lazy(function () {
          return __vitePreload(function () {
            return module.import('./Portal-legacy-w1wG2PzU.js');
          }, false              ? __VITE_PRELOAD__ : void 0);
        });
        var TextPage = lazy(function () {
          return __vitePreload(function () {
            return module.import('./Text-legacy-DoBgQC2h.js');
          }, false              ? __VITE_PRELOAD__ : void 0);
        });
        var TextPosterPage = lazy(function () {
          return __vitePreload(function () {
            return module.import('./TextPoster-legacy-sQp0Ob_I.js');
          }, false              ? __VITE_PRELOAD__ : void 0);
        });
        var CreatePage = lazy(function () {
          return __vitePreload(function () {
            return module.import('./Create-legacy-irgfNy8g.js');
          }, false              ? __VITE_PRELOAD__ : void 0);
        });
        var ViewportPage = lazy(function () {
          return __vitePreload(function () {
            return module.import('./Viewport-legacy-tQgDuRN3.js');
          }, false              ? __VITE_PRELOAD__ : void 0);
        });
        var PositioningPage = lazy(function () {
          return __vitePreload(function () {
            return module.import('./Positioning-legacy-C-eGQAdX.js');
          }, false              ? __VITE_PRELOAD__ : void 0);
        });
        var LayoutPage = lazy(function () {
          return __vitePreload(function () {
            return module.import('./Layout-legacy-ByAGt4L7.js');
          }, false              ? __VITE_PRELOAD__ : void 0);
        });
        var FocusBasicsPage = lazy(function () {
          return __vitePreload(function () {
            return module.import('./FocusBasics-legacy-Ck06_9Hc.js');
          }, false              ? __VITE_PRELOAD__ : void 0);
        });
        var KeyHandlingPage = lazy(function () {
          return __vitePreload(function () {
            return module.import('./KeyHandling-legacy-Dr1W3sWN.js');
          }, false              ? __VITE_PRELOAD__ : void 0);
        });
        var TransitionsPage = lazy(function () {
          return __vitePreload(function () {
            return module.import('./Transitions-legacy-BM74_Ljt.js');
          }, false              ? __VITE_PRELOAD__ : void 0);
        });
        var ComponentsPage = lazy(function () {
          return __vitePreload(function () {
            return module.import('./Components-legacy-Bd2WNcM-.js');
          }, false              ? __VITE_PRELOAD__ : void 0);
        });
        var FocusHandlingPage = lazy(function () {
          return __vitePreload(function () {
            return module.import('./FocusHandling-legacy-CNJAzyL2.js');
          }, false              ? __VITE_PRELOAD__ : void 0);
        });
        var GradientsPage = lazy(function () {
          return __vitePreload(function () {
            return module.import('./Gradients-legacy-CFWr04SF.js');
          }, false              ? __VITE_PRELOAD__ : void 0);
        });
        var FlexPage = lazy(function () {
          return __vitePreload(function () {
            return module.import('./Flex-legacy-D7EGpLEj.js');
          }, false              ? __VITE_PRELOAD__ : void 0);
        });
        var FlexGrowPage = lazy(function () {
          return __vitePreload(function () {
            return module.import('./FlexGrow-legacy--1ERLej7.js');
          }, false              ? __VITE_PRELOAD__ : void 0);
        });
        var FlexMenuPage = lazy(function () {
          return __vitePreload(function () {
            return module.import('./FlexMenu-legacy-BwxzswCE.js');
          }, false              ? __VITE_PRELOAD__ : void 0);
        });
        var FlexSizePage = lazy(function () {
          return __vitePreload(function () {
            return module.import('./FlexSize-legacy-Bm1adC6m.js');
          }, false              ? __VITE_PRELOAD__ : void 0);
        });
        var FlexColumnSizePage = lazy(function () {
          return __vitePreload(function () {
            return module.import('./FlexColumnSize-legacy-Be7fVTFz.js');
          }, false              ? __VITE_PRELOAD__ : void 0);
        });
        var FlexColumnPage = lazy(function () {
          return __vitePreload(function () {
            return module.import('./FlexColumn-legacy-DwXS_1ks.js');
          }, false              ? __VITE_PRELOAD__ : void 0);
        });
        var ButtonsMaterialPage = lazy(function () {
          return __vitePreload(function () {
            return module.import('./ButtonsMaterial-legacy-Dw0I1lgh.js');
          }, false              ? __VITE_PRELOAD__ : void 0);
        });
        var SuperFlexPage = lazy(function () {
          return __vitePreload(function () {
            return module.import('./SuperFlex-legacy-DmLJN-Bk.js');
          }, false              ? __VITE_PRELOAD__ : void 0);
        });
        var Entity = lazy(function () {
          return __vitePreload(function () {
            return module.import('./Entity-legacy-B8e6Cvv3.js');
          }, false              ? __VITE_PRELOAD__ : void 0);
        });
        var People = lazy(function () {
          return __vitePreload(function () {
            return module.import('./People-legacy-6oRY5tV2.js');
          }, false              ? __VITE_PRELOAD__ : void 0);
        });
        var FireboltPage = lazy(function () {
          return __vitePreload(function () {
            return module.import('./Firebolt-legacy-DyOaULFI.js');
          }, false              ? __VITE_PRELOAD__ : void 0);
        });
        var LoginPage = lazy(function () {
          return __vitePreload(function () {
            return module.import('./Login-legacy-C79hjtlb.js');
          }, false              ? __VITE_PRELOAD__ : void 0);
        });
        var VirtualPage = lazy(function () {
          return __vitePreload(function () {
            return module.import('./Virtual-legacy-D7GDD4wd.js');
          }, false              ? __VITE_PRELOAD__ : void 0);
        });
        var numImageWorkers = 4;
        var urlParams = new URLSearchParams(window.location.search);
        var numWorkers = urlParams.get("numImageWorkers");
        var screenSize = urlParams.get("size") || "default";
        var rendererMode = urlParams.get("mode") || "webgl";
        var animationsEnabled = urlParams.get("animate") || "true";
        if (numWorkers) {
          numImageWorkers = parseInt(numWorkers);
        }
        var deviceLogicalPixelRatio = {
          "720": 0.666667,
          "medium": 0.8,
          "1080": 1,
          "4k": 2,
          default: window.innerHeight / 1080
        }[screenSize];
        Config.debug = false;
        Config.animationsEnabled = animationsEnabled === "true";
        Config.simpleAnimationsEnabled = true;
        Config.fontSettings.fontFamily = "Roboto";
        Config.fontSettings.color = 4143380223;
        Config.fontSettings.fontSize = 32;
        Config.rendererOptions = {
          fpsUpdateInterval: 1e3,
          inspector: void 0,
          // textureMemory: {
          //   criticalThreshold: 80e6,
          // },
          numImageWorkers: numImageWorkers,
          // temp fix for renderer bug
          // Set the resolution based on window height
          // 720p = 0.666667, 1080p = 1, 1440p = 1.5, 2160p = 2
          deviceLogicalPixelRatio: deviceLogicalPixelRatio,
          devicePhysicalPixelRatio: 1,
          createImageBitmapSupport: "auto",
          targetFPS: 30
        };
        if (rendererMode === "canvas") {
          Config.rendererOptions.fontEngines = [CanvasTextRenderer];
          Config.rendererOptions.renderEngine = CanvasCoreRenderer;
        } else {
          Config.rendererOptions.fontEngines = [SdfTextRenderer];
          Config.rendererOptions.renderEngine = WebGlCoreRenderer;
        }
        var _createRenderer = createRenderer(),
          render = _createRenderer.render;
        loadFonts(fonts);
        render(function () {
          return createComponent(FocusStackProvider, {
            get children() {
              return createComponent(HashRouter, {
                root: function root(props) {
                  return createComponent(App, props);
                },
                get children() {
                  return [createComponent(Route, {
                    path: "",
                    component: LeftNavWrapper,
                    get children() {
                      return [createComponent(Route, {
                        path: "",
                        component: function component() {
                          return createComponent(Navigate, {
                            href: "/browse/all"
                          });
                        }
                      }), createComponent(Route, {
                        path: "examples",
                        component: Portal,
                        get children() {
                          return [createComponent(Route, {
                            path: "/"
                          }), createComponent(Route, {
                            path: "tmdb",
                            component: TMDB,
                            preload: tmdbData
                          })];
                        }
                      }), createComponent(KeepAliveRoute, {
                        id: "browse",
                        path: "browse/:filter",
                        component: Browse,
                        preload: browsePreload
                      }), createComponent(Route, {
                        path: "loops",
                        component: Loops,
                        preload: tmdbData
                      }), createComponent(Route, {
                        path: "infinite",
                        component: Infinite,
                        preload: tmdbData
                      }), createComponent(Route, {
                        path: "tmdbgrid",
                        component: TMDBGrid,
                        preload: tmdbData
                      }), createComponent(Route, {
                        path: "virtual",
                        component: VirtualPage,
                        preload: tmdbData
                      }), createComponent(Route, {
                        path: "destroy",
                        component: Destroy,
                        preload: destroyData
                      }), createComponent(Route, {
                        path: "grid",
                        component: Grid
                      }), createComponent(Route, {
                        path: "text",
                        component: TextPage
                      }), createComponent(Route, {
                        path: "firebolt",
                        component: FireboltPage
                      }), createComponent(Route, {
                        path: "login",
                        component: LoginPage
                      }), createComponent(Route, {
                        path: "nested",
                        get component() {
                          return lazy(function () {
                            return __vitePreload(function () {
                              return module.import('./Nested-legacy-B2mYk4Lx.js');
                            }, false              ? __VITE_PRELOAD__ : void 0);
                          });
                        }
                      }), createComponent(Route, {
                        path: "textposter",
                        component: TextPosterPage
                      }), createComponent(Route, {
                        path: "positioning",
                        component: PositioningPage
                      }), createComponent(Route, {
                        path: "layout",
                        component: LayoutPage
                      }), createComponent(Route, {
                        path: "focusbasics",
                        component: FocusBasicsPage
                      }), createComponent(Route, {
                        path: "transitions",
                        component: TransitionsPage
                      }), createComponent(Route, {
                        path: "components",
                        component: ComponentsPage
                      }), createComponent(Route, {
                        path: "focushandling",
                        component: FocusHandlingPage
                      }), createComponent(Route, {
                        path: "keyhandling",
                        component: KeyHandlingPage
                      }), createComponent(Route, {
                        path: "gradients",
                        component: GradientsPage
                      }), createComponent(Route, {
                        path: "flex",
                        component: FlexPage
                      }), createComponent(Route, {
                        path: "create",
                        component: CreatePage
                      }), createComponent(Route, {
                        path: "viewport",
                        component: ViewportPage
                      }), createComponent(Route, {
                        path: "flexsize",
                        component: FlexSizePage
                      }), createComponent(Route, {
                        path: "flexmenu",
                        component: FlexMenuPage
                      }), createComponent(Route, {
                        path: "flexcolumnsize",
                        component: FlexColumnSizePage
                      }), createComponent(Route, {
                        path: "flexcolumn",
                        component: FlexColumnPage
                      }), createComponent(Route, {
                        path: "flexgrow",
                        component: FlexGrowPage
                      }), createComponent(Route, {
                        path: "keepalive",
                        get component() {
                          return lazy(function () {
                            return __vitePreload(function () {
                              return module.import('./KeepAlive-legacy-XRNvm-MP.js');
                            }, false              ? __VITE_PRELOAD__ : void 0);
                          });
                        }
                      }), createComponent(Route, {
                        path: "suspense",
                        get component() {
                          return lazy(function () {
                            return __vitePreload(function () {
                              return module.import('./suspense-legacy-BmBe9W7B.js');
                            }, false              ? __VITE_PRELOAD__ : void 0);
                          });
                        }
                      }), createComponent(Route, {
                        path: "superflex",
                        component: SuperFlexPage
                      }), createComponent(Route, {
                        path: "buttonsmaterial",
                        component: ButtonsMaterialPage
                      }), createComponent(Route, {
                        path: "entity/people/:id",
                        component: People
                      }), createComponent(Route, {
                        path: "entity/:type/:id",
                        component: Entity,
                        preload: entityPreload
                      }), createComponent(Route, {
                        path: "*all",
                        component: NotFound
                      })];
                    }
                  }), createComponent(Route, {
                    path: "player",
                    get children() {
                      return createComponent(Route, {
                        path: ":id",
                        component: Player
                      });
                    }
                  })];
                }
              });
            }
          });
        });
      }
    };
  });
})();
