const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Loops-CXRvG6cT.js","assets/index-Cv4LNVbV.js","assets/Infinite-CZ6Ia1xh.js"])))=>i.map(i=>d[i]);
var __defProp = Object.defineProperty;
var __defNormalProp = (obj, key, value) => key in obj ? __defProp(obj, key, { enumerable: true, configurable: true, writable: true, value }) : obj[key] = value;
var __publicField = (obj, key, value) => __defNormalProp(obj, typeof key !== "symbol" ? key + "" : key, value);
var _a;
function __vite_legacy_guard() {
  import.meta.url;
  import("_").catch(() => 1);
  (async function* () {
  })().next();
}
;
(function polyfill() {
  const relList = document.createElement("link").relList;
  if (relList && relList.supports && relList.supports("modulepreload")) {
    return;
  }
  for (const link of document.querySelectorAll('link[rel="modulepreload"]')) {
    processPreload(link);
  }
  new MutationObserver((mutations) => {
    for (const mutation of mutations) {
      if (mutation.type !== "childList") {
        continue;
      }
      for (const node of mutation.addedNodes) {
        if (node.tagName === "LINK" && node.rel === "modulepreload")
          processPreload(node);
      }
    }
  }).observe(document, { childList: true, subtree: true });
  function getFetchOpts(link) {
    const fetchOpts = {};
    if (link.integrity) fetchOpts.integrity = link.integrity;
    if (link.referrerPolicy) fetchOpts.referrerPolicy = link.referrerPolicy;
    if (link.crossOrigin === "use-credentials")
      fetchOpts.credentials = "include";
    else if (link.crossOrigin === "anonymous") fetchOpts.credentials = "omit";
    else fetchOpts.credentials = "same-origin";
    return fetchOpts;
  }
  function processPreload(link) {
    if (link.ep)
      return;
    link.ep = true;
    const fetchOpts = getFetchOpts(link);
    fetch(link.href, fetchOpts);
  }
})();
const scriptRel = "modulepreload";
const assetsURL = function(dep) {
  return "/solid-demo-app/" + dep;
};
const seen = {};
const __vitePreload = function preload(baseModule, deps, importerUrl) {
  let promise = Promise.resolve();
  if (deps && deps.length > 0) {
    let allSettled2 = function(promises) {
      return Promise.all(
        promises.map(
          (p) => Promise.resolve(p).then(
            (value) => ({ status: "fulfilled", value }),
            (reason) => ({ status: "rejected", reason })
          )
        )
      );
    };
    document.getElementsByTagName("link");
    const cspNonceMeta = document.querySelector(
      "meta[property=csp-nonce]"
    );
    const cspNonce = (cspNonceMeta == null ? void 0 : cspNonceMeta.nonce) || (cspNonceMeta == null ? void 0 : cspNonceMeta.getAttribute("nonce"));
    promise = allSettled2(
      deps.map((dep) => {
        dep = assetsURL(dep);
        if (dep in seen) return;
        seen[dep] = true;
        const isCss = dep.endsWith(".css");
        const cssSelector = isCss ? '[rel="stylesheet"]' : "";
        if (document.querySelector('link[href="'.concat(dep, '"]').concat(cssSelector))) {
          return;
        }
        const link = document.createElement("link");
        link.rel = isCss ? "stylesheet" : scriptRel;
        if (!isCss) {
          link.as = "script";
        }
        link.crossOrigin = "";
        link.href = dep;
        if (cspNonce) {
          link.setAttribute("nonce", cspNonce);
        }
        document.head.appendChild(link);
        if (isCss) {
          return new Promise((res, rej) => {
            link.addEventListener("load", res);
            link.addEventListener(
              "error",
              () => rej(new Error("Unable to preload CSS for ".concat(dep)))
            );
          });
        }
      })
    );
  }
  function handlePreloadError(err) {
    const e = new Event("vite:preloadError", {
      cancelable: true
    });
    e.payload = err;
    window.dispatchEvent(e);
    if (!e.defaultPrevented) {
      throw err;
    }
  }
  return promise.then((res) => {
    for (const item of res || []) {
      if (item.status !== "rejected") continue;
      handlePreloadError(item.reason);
    }
    return baseModule().catch(handlePreloadError);
  });
};
const __vite_import_meta_env__ = { "BASE_URL": "/solid-demo-app/", "DEV": false, "LEGACY": false, "MODE": "production", "PROD": true, "SSR": false };
function createWebGLContext(canvas, forceWebGL2 = false, contextSpy) {
  const config = {
    alpha: true,
    antialias: false,
    depth: false,
    stencil: true,
    desynchronized: false,
    // Disabled because it prevents Visual Regression Tests from working
    // failIfMajorPerformanceCaveat: true,
    powerPreference: "high-performance",
    premultipliedAlpha: true,
    preserveDrawingBuffer: false
  };
  const gl = (
    // TODO: Remove this assertion once this issue is fixed in TypeScript
    // https://github.com/microsoft/TypeScript/issues/53614
    canvas.getContext(forceWebGL2 ? "webgl2" : "webgl", config) || canvas.getContext("experimental-webgl", config)
  );
  if (!gl) {
    throw new Error("Unable to create WebGL context");
  }
  if (contextSpy) {
    return new Proxy(gl, {
      get(target, prop) {
        const value = target[prop];
        if (typeof value === "function") {
          contextSpy.increment(String(prop));
          return value.bind(target);
        }
        return value;
      }
    });
  }
  return gl;
}
function assertTruthy(condition, message) {
  if (isProductionEnvironment() === true)
    return;
  if (!condition) {
    throw new Error(message || "Assertion failed");
  }
}
function mergeColorProgress$1(rgba1, rgba2, p) {
  const r1 = Math.trunc(rgba1 >>> 24);
  const g1 = Math.trunc(rgba1 >>> 16 & 255);
  const b1 = Math.trunc(rgba1 >>> 8 & 255);
  const a1 = Math.trunc(rgba1 & 255);
  const r2 = Math.trunc(rgba2 >>> 24);
  const g2 = Math.trunc(rgba2 >>> 16 & 255);
  const b2 = Math.trunc(rgba2 >>> 8 & 255);
  const a2 = Math.trunc(rgba2 & 255);
  const r = Math.round(r2 * p + r1 * (1 - p));
  const g = Math.round(g2 * p + g1 * (1 - p));
  const b = Math.round(b2 * p + b1 * (1 - p));
  const a = Math.round(a2 * p + a1 * (1 - p));
  return (r << 24 | g << 16 | b << 8 | a) >>> 0;
}
function mergeColorAlpha(rgba, alpha) {
  const r = rgba >>> 24;
  const g = rgba >>> 16 & 255;
  const b = rgba >>> 8 & 255;
  const a = Math.trunc((rgba & 255) * alpha);
  return (r << 24 | g << 16 | b << 8 | a) >>> 0;
}
let premultiplyRGB = true;
function setPremultiplyMode(mode) {
  premultiplyRGB = mode === "webgl";
}
function mergeColorAlphaPremultiplied(rgba, alpha, flipEndianess = false) {
  const newAlpha = (rgba & 255) / 255 * alpha;
  const rgbAlpha = premultiplyRGB ? newAlpha : 1;
  const r = Math.trunc((rgba >>> 24) * rgbAlpha);
  const g = Math.trunc((rgba >>> 16 & 255) * rgbAlpha);
  const b = Math.trunc((rgba >>> 8 & 255) * rgbAlpha);
  const a = Math.trunc(newAlpha * 255);
  if (flipEndianess) {
    return (a << 24 | b << 16 | g << 8 | r) >>> 0;
  }
  return (r << 24 | g << 16 | b << 8 | a) >>> 0;
}
function hasOwn(obj, prop) {
  return Object.prototype.hasOwnProperty.call(obj, prop);
}
function isProductionEnvironment() {
  return __vite_import_meta_env__ && true;
}
let nextId = 1;
function getNewId() {
  return nextId++;
}
class EventEmitter {
  constructor() {
    __publicField(this, "eventListeners", {});
  }
  on(event, listener) {
    let listeners = this.eventListeners[event];
    if (!listeners) {
      listeners = [];
    }
    listeners.push(listener);
    this.eventListeners[event] = listeners;
  }
  off(event, listener) {
    const listeners = this.eventListeners[event];
    if (!listeners) {
      return;
    }
    if (!listener) {
      delete this.eventListeners[event];
      return;
    }
    const index = listeners.indexOf(listener);
    if (index >= 0) {
      listeners.splice(index, 1);
    }
  }
  once(event, listener) {
    const onceListener = (target, data) => {
      this.off(event, onceListener);
      listener(target, data);
    };
    this.on(event, onceListener);
  }
  emit(event, data) {
    const listeners = this.eventListeners[event];
    if (!listeners) {
      return;
    }
    [...listeners].forEach((listener) => {
      listener(this, data);
    });
  }
  removeAllListeners() {
    this.eventListeners = {};
  }
}
var TextureType;
(function(TextureType2) {
  TextureType2[TextureType2["generic"] = 0] = "generic";
  TextureType2[TextureType2["color"] = 1] = "color";
  TextureType2[TextureType2["image"] = 2] = "image";
  TextureType2[TextureType2["noise"] = 3] = "noise";
  TextureType2[TextureType2["renderToTexture"] = 4] = "renderToTexture";
  TextureType2[TextureType2["subTexture"] = 5] = "subTexture";
})(TextureType || (TextureType = {}));
class Texture extends EventEmitter {
  constructor(txManager) {
    super();
    __publicField(this, "txManager");
    /**
     * The dimensions of the texture
     *
     * @remarks
     * Until the texture data is loaded for the first time the value will be
     * `null`.
     */
    __publicField(this, "_dimensions", null);
    __publicField(this, "_error", null);
    // aggregate state
    __publicField(this, "state", "initial");
    __publicField(this, "renderableOwners", /* @__PURE__ */ new Set());
    __publicField(this, "renderable", false);
    __publicField(this, "type", TextureType.generic);
    __publicField(this, "preventCleanup", false);
    __publicField(this, "ctxTexture");
    __publicField(this, "textureData", null);
    this.txManager = txManager;
  }
  get dimensions() {
    return this._dimensions;
  }
  get error() {
    return this._error;
  }
  /**
   * Add/remove an owner to/from the Texture based on its renderability.
   *
   * @remarks
   * Any object can own a texture, be it a CoreNode or even the state object
   * from a Text Renderer.
   *
   * When the reference to the texture that an owner object holds is replaced
   * or cleared it must call this with `renderable=false` to release the owner
   * association.
   *
   * @param owner
   * @param renderable
   */
  setRenderableOwner(owner, renderable) {
    var _a2, _b;
    const oldSize = this.renderableOwners.size;
    if (renderable === true) {
      if (this.renderableOwners.has(owner) === false) {
        this.renderableOwners.add(owner);
      }
      const newSize = this.renderableOwners.size;
      if (newSize > oldSize && newSize === 1) {
        this.renderable = true;
        (_a2 = this.onChangeIsRenderable) == null ? void 0 : _a2.call(this, true);
        this.load();
      }
    } else {
      this.renderableOwners.delete(owner);
      const newSize = this.renderableOwners.size;
      if (newSize < oldSize && newSize === 0) {
        this.renderable = false;
        (_b = this.onChangeIsRenderable) == null ? void 0 : _b.call(this, false);
        this.txManager.orphanTexture(this);
      }
    }
  }
  load() {
    this.txManager.loadTexture(this);
  }
  /**
   * Load the core context texture for this Texture.
   * The ctxTexture is created by the renderer and lives on the GPU.
   *
   * @returns
   */
  loadCtxTexture() {
    if (this.ctxTexture === void 0) {
      this.ctxTexture = this.txManager.renderer.createCtxTexture(this);
    }
    return this.ctxTexture;
  }
  /**
   * Free the core context texture for this Texture.
   *
   * @remarks
   * The ctxTexture is created by the renderer and lives on the GPU.
   */
  free() {
    var _a2;
    (_a2 = this.ctxTexture) == null ? void 0 : _a2.free();
  }
  /**
   * Destroy the texture.
   *
   * @remarks
   * This method is called when the texture is no longer needed and should be
   * cleaned up.
   */
  destroy() {
    if (this.state === "loaded") {
      this.free();
    }
    this.freeTextureData();
  }
  /**
   * Free the source texture data for this Texture.
   *
   * @remarks
   * The texture data is the source data that is used to populate the CoreContextTexture.
   * e.g. ImageData that is downloaded from a URL.
   */
  freeTextureData() {
    this.textureData = null;
  }
  setState(state, errorOrDimensions) {
    if (this.state === state) {
      return;
    }
    let payload = null;
    if (state === "loaded") {
      if (errorOrDimensions !== void 0 && "width" in errorOrDimensions === true && "height" in errorOrDimensions === true && errorOrDimensions.width !== void 0 && errorOrDimensions.height !== void 0) {
        this._dimensions = errorOrDimensions;
      }
      payload = this._dimensions;
    } else if (state === "failed") {
      this._error = errorOrDimensions;
      payload = this._error;
    }
    this.state = state;
    this.emit(state, payload);
  }
  /**
   * Get the texture data for this texture.
   *
   * @remarks
   * This method is called by the CoreContextTexture when the texture is loaded.
   * The texture data is then used to populate the CoreContextTexture.
   *
   * @returns
   * The texture data for this texture.
   */
  async getTextureData() {
    if (this.textureData === null) {
      this.textureData = await this.getTextureSource();
    }
    return this.textureData;
  }
  /**
   * Make a cache key for this texture.
   *
   * @remarks
   * Each concrete `Texture` subclass must implement this method to provide an
   * appropriate cache key for the texture type including the texture's
   * properties that uniquely identify a copy of the texture. If the texture
   * type does not support caching, then this method should return `false`.
   *
   * @param props
   * @returns
   * A cache key for this texture or `false` if the texture type does not
   * support caching.
   */
  // eslint-disable-next-line @typescript-eslint/no-unused-vars
  static makeCacheKey(props) {
    return false;
  }
  /**
   * Resolve the default values for the texture's properties.
   *
   * @remarks
   * Each concrete `Texture` subclass must implement this method to provide
   * default values for the texture's optional properties.
   *
   * @param props
   * @returns
   * The default values for the texture's properties.
   */
  static resolveDefaults(props) {
    return {};
  }
}
/**
 * Texture states that are considered transitional and should be skipped during cleanup
 */
__publicField(Texture, "TRANSITIONAL_TEXTURE_STATES", ["fetching", "fetched", "loading"]);
const PROTOCOL_REGEX = /^(data|ftps?|https?):/;
const getNormalizedRgbaComponents = (rgba) => {
  const r = rgba >>> 24;
  const g = rgba >>> 16 & 255;
  const b = rgba >>> 8 & 255;
  const a = rgba & 255;
  return [r / 255, g / 255, b / 255, a / 255];
};
const getRgbaComponents = (rgba) => {
  const r = rgba >>> 24;
  const g = rgba >>> 16 & 255;
  const b = rgba >>> 8 & 255;
  const a = rgba & 255;
  return [r, g, b, a];
};
function getNormalizedAlphaComponent(rgba) {
  return (rgba & 255) / 255;
}
function getRgbaString(color) {
  const r = Math.floor(color[0] * 255);
  const g = Math.floor(color[1] * 255);
  const b = Math.floor(color[2] * 255);
  const a = Math.floor(color[3] * 255);
  return "rgba(".concat(r, ",").concat(g, ",").concat(b, ",").concat(a.toFixed(4), ")");
}
function createBound(x1, y1, x2, y2, out) {
  if (out) {
    out.x1 = x1;
    out.y1 = y1;
    out.x2 = x2;
    out.y2 = y2;
    return out;
  }
  return {
    x1,
    y1,
    x2,
    y2
  };
}
function boundsOverlap(a, b) {
  return a.x1 < b.x2 && a.x2 > b.x1 && a.y1 < b.y2 && a.y2 > b.y1;
}
function convertBoundToRect(bound, out) {
  if (out) {
    out.x = bound.x1;
    out.y = bound.y1;
    out.width = bound.x2 - bound.x1;
    out.height = bound.y2 - bound.y1;
    return out;
  }
  return {
    x: bound.x1,
    y: bound.y1,
    width: bound.x2 - bound.x1,
    height: bound.y2 - bound.y1
  };
}
function intersectRect(a, b, out) {
  const x = Math.max(a.x, b.x);
  const y = Math.max(a.y, b.y);
  const width = Math.min(a.x + a.width, b.x + b.width) - x;
  const height = Math.min(a.y + a.height, b.y + b.height) - y;
  if (width > 0 && height > 0) {
    if (out) {
      out.x = x;
      out.y = y;
      out.width = width;
      out.height = height;
      return out;
    }
    return {
      x,
      y,
      width,
      height
    };
  }
  if (out) {
    out.x = 0;
    out.y = 0;
    out.width = 0;
    out.height = 0;
    return out;
  }
  return {
    x: 0,
    y: 0,
    width: 0,
    height: 0
  };
}
function copyRect(a, out) {
  if (out) {
    out.x = a.x;
    out.y = a.y;
    out.width = a.width;
    out.height = a.height;
    return out;
  }
  return {
    x: a.x,
    y: a.y,
    width: a.width,
    height: a.height
  };
}
function compareRect(a, b) {
  if (a === b) {
    return true;
  }
  if (a === null || b === null) {
    return false;
  }
  return a.x === b.x && a.y === b.y && a.width === b.width && a.height === b.height;
}
function boundInsideBound(bound1, bound2) {
  return bound1.x1 <= bound2.x2 && bound1.y1 <= bound2.y2 && bound1.x2 >= bound2.x1 && bound1.y2 >= bound2.y1;
}
function boundLargeThanBound(bound1, bound2) {
  return bound1.x1 < bound2.x1 && bound1.x2 > bound2.x2 && bound1.y1 < bound2.y1 && bound1.y2 > bound2.y2;
}
function isBoundPositive(bound) {
  return bound.x1 < bound.x2 && bound.y1 < bound.y2;
}
function createPreloadBounds(strictBound, boundsMargin) {
  return createBound(strictBound.x1 - boundsMargin[3], strictBound.y1 - boundsMargin[0], strictBound.x2 + boundsMargin[1], strictBound.y2 + boundsMargin[2]);
}
function convertUrlToAbsolute(url) {
  if (self.location.protocol === "file:" && !PROTOCOL_REGEX.test(url)) {
    const path = self.location.pathname.split("/");
    path.pop();
    const basePath2 = path.join("/");
    const baseUrl = self.location.protocol + "//" + basePath2;
    if (url.charAt(0) === ".") {
      url = url.slice(1);
    }
    if (url.charAt(0) === "/") {
      url = url.slice(1);
    }
    return baseUrl + "/" + url;
  }
  const absoluteUrl = new URL(url, self.location.href);
  return absoluteUrl.href;
}
function isBase64Image(src) {
  return src.startsWith("data:") === true;
}
function dataURIToBlob(dataURI) {
  var _a2, _b;
  dataURI = dataURI.replace(/^data:/, "");
  const type = ((_a2 = dataURI.match(/image\/[^;]+/)) == null ? void 0 : _a2[0]) || "";
  const base64 = dataURI.replace(/^[^,]+,/, "");
  const sliceSize = 1024;
  const byteCharacters = atob(base64);
  const bytesLength = byteCharacters.length;
  const slicesCount = Math.ceil(bytesLength / sliceSize);
  const byteArrays = new Array(slicesCount);
  for (let sliceIndex = 0; sliceIndex < slicesCount; ++sliceIndex) {
    const begin = sliceIndex * sliceSize;
    const end = Math.min(begin + sliceSize, bytesLength);
    const bytes = new Array(end - begin);
    for (let offset = begin, i = 0; offset < end; ++i, ++offset) {
      bytes[i] = (_b = byteCharacters[offset]) == null ? void 0 : _b.charCodeAt(0);
    }
    byteArrays[sliceIndex] = new Uint8Array(bytes);
  }
  return new Blob(byteArrays, { type });
}
class Matrix3d {
  /**
   * Creates a new 3x3 matrix.
   *
   * @param entries Row-major 3x3 matrix
   */
  constructor() {
    __publicField(this, "ta");
    __publicField(this, "tb");
    __publicField(this, "tx");
    __publicField(this, "tc");
    __publicField(this, "td");
    __publicField(this, "ty");
    __publicField(this, "_floatArr", null);
    /**
     * Potential Mutation Flag
     *
     * @remarks
     * This flag is set to true whenever the matrix is potentially modified.
     * We don't waste CPU trying to identify if each operation actually modifies
     * the matrix. Instead, we set this flag to true whenever we think the matrix
     * is modified. This signals that the `floatArr` should to be updated.
     */
    __publicField(this, "mutation");
    this.ta = 0;
    this.tb = 0;
    this.tx = 0;
    this.tc = 0;
    this.td = 0;
    this.ty = 0;
    this.mutation = true;
  }
  /**
   * Returns a temporary matrix that can be used for calculations.
   *
   * @remarks
   * This is useful for avoiding allocations in tight loops.
   *
   * The matrix is not guaranteed to be the same between calls.
   *
   * @returns
   */
  static get temp() {
    return tempMatrix;
  }
  static multiply(a, b, out) {
    const e0 = a.ta * b.ta + a.tb * b.tc;
    const e1 = a.ta * b.tb + a.tb * b.td;
    const e2 = a.ta * b.tx + a.tb * b.ty + a.tx;
    const e3 = a.tc * b.ta + a.td * b.tc;
    const e4 = a.tc * b.tb + a.td * b.td;
    const e5 = a.tc * b.tx + a.td * b.ty + a.ty;
    if (!out) {
      out = new Matrix3d();
    }
    out.ta = e0;
    out.tb = e1;
    out.tx = e2;
    out.tc = e3;
    out.td = e4;
    out.ty = e5;
    out.mutation = true;
    return out;
  }
  static identity(out) {
    if (!out) {
      out = new Matrix3d();
    }
    out.ta = 1;
    out.tb = 0;
    out.tx = 0;
    out.tc = 0;
    out.td = 1;
    out.ty = 0;
    out.mutation = true;
    return out;
  }
  static translate(x, y, out) {
    if (!out) {
      out = new Matrix3d();
    }
    out.ta = 1;
    out.tb = 0;
    out.tx = x;
    out.tc = 0;
    out.td = 1;
    out.ty = y;
    out.mutation = true;
    return out;
  }
  static scale(sx, sy, out) {
    if (!out) {
      out = new Matrix3d();
    }
    out.ta = sx;
    out.tb = 0;
    out.tx = 0;
    out.tc = 0;
    out.td = sy;
    out.ty = 0;
    out.mutation = true;
    return out;
  }
  static rotate(angle, out) {
    const cos = Math.cos(angle);
    const sin = Math.sin(angle);
    if (!out) {
      out = new Matrix3d();
    }
    out.ta = cos;
    out.tb = -sin;
    out.tx = 0;
    out.tc = sin;
    out.td = cos;
    out.ty = 0;
    out.mutation = true;
    return out;
  }
  static copy(src, dst) {
    if (!dst) {
      dst = new Matrix3d();
    }
    dst.ta = src.ta;
    dst.tc = src.tc;
    dst.tb = src.tb;
    dst.td = src.td;
    dst.tx = src.tx;
    dst.ty = src.ty;
    dst.mutation = true;
    return dst;
  }
  translate(x, y) {
    this.tx = this.ta * x + this.tb * y + this.tx;
    this.ty = this.tc * x + this.td * y + this.ty;
    this.mutation = true;
    return this;
  }
  scale(sx, sy) {
    this.ta = this.ta * sx;
    this.tb = this.tb * sy;
    this.tc = this.tc * sx;
    this.td = this.td * sy;
    this.mutation = true;
    return this;
  }
  rotate(angle) {
    if (angle === 0 || !(angle % Math.PI * 2)) {
      return this;
    }
    const cos = Math.cos(angle);
    const sin = Math.sin(angle);
    const e0 = this.ta * cos + this.tb * sin;
    const e1 = this.tb * cos - this.ta * sin;
    const e3 = this.tc * cos + this.td * sin;
    const e4 = this.td * cos - this.tc * sin;
    this.ta = e0;
    this.tb = e1;
    this.tc = e3;
    this.td = e4;
    this.mutation = true;
    return this;
  }
  multiply(other) {
    return Matrix3d.multiply(this, other, this);
  }
  /**
   * Returns the matrix as a Float32Array in column-major order.
   *
   * @remarks
   * This method is optimized to avoid unnecessary allocations. The same array
   * is returned every time this method is called, and is updated in place.
   *
   * WARNING: Use the array only for passing directly to a WebGL shader uniform
   * during a frame render. Do not modify or hold onto the array for longer than
   * a frame.
   */
  getFloatArr() {
    if (!this._floatArr) {
      this._floatArr = new Float32Array(9);
    }
    if (this.mutation) {
      this._floatArr[0] = this.ta;
      this._floatArr[1] = this.tc;
      this._floatArr[2] = 0;
      this._floatArr[3] = this.tb;
      this._floatArr[4] = this.td;
      this._floatArr[5] = 0;
      this._floatArr[6] = this.tx;
      this._floatArr[7] = this.ty;
      this._floatArr[8] = 1;
      this.mutation = false;
    }
    return this._floatArr;
  }
}
const tempMatrix = new Matrix3d();
const rx1 = 0;
const rx2 = 2;
const rx3 = 4;
const rx4 = 6;
const ry1 = 1;
const ry2 = 3;
const ry3 = 5;
const ry4 = 7;
class RenderCoords {
  constructor(entries) {
    __publicField(this, "data");
    this.data = new Float32Array(8);
    if (entries) {
      this.data[rx1] = entries[rx1];
      this.data[rx2] = entries[rx2];
      this.data[rx3] = entries[rx3];
      this.data[rx4] = entries[rx4];
      this.data[ry1] = entries[ry1];
      this.data[ry2] = entries[ry2];
      this.data[ry3] = entries[ry3];
      this.data[ry4] = entries[ry4];
    }
  }
  static translate(x1, y1, x2, y2, x3, y3, x4, y4, out) {
    if (!out) {
      out = new RenderCoords();
    }
    out.data[rx1] = x1;
    out.data[rx2] = x2;
    out.data[rx3] = x3;
    out.data[rx4] = x4;
    out.data[ry1] = y1;
    out.data[ry2] = y2;
    out.data[ry3] = y3;
    out.data[ry4] = y4;
    return out;
  }
  get x1() {
    return this.data[rx1];
  }
  get x2() {
    return this.data[rx2];
  }
  get x3() {
    return this.data[rx3];
  }
  get x4() {
    return this.data[rx4];
  }
  get y1() {
    return this.data[ry1];
  }
  get y2() {
    return this.data[ry2];
  }
  get y3() {
    return this.data[ry3];
  }
  get y4() {
    return this.data[ry4];
  }
}
const getTimingBezier$1 = (a, b, c, d) => {
  const xc = 3 * a;
  const xb = 3 * (c - a) - xc;
  const xa = 1 - xc - xb;
  const yc = 3 * b;
  const yb = 3 * (d - b) - yc;
  const ya = 1 - yc - yb;
  return function(time) {
    if (time >= 1) {
      return 1;
    }
    if (time <= 0) {
      return 0;
    }
    let t = 0.5, cbx, cbxd, dx;
    for (let it = 0; it < 20; it++) {
      cbx = t * (t * (t * xa + xb) + xc);
      dx = time - cbx;
      if (dx > -1e-8 && dx < 1e-8) {
        return t * (t * (t * ya + yb) + yc);
      }
      cbxd = t * (t * (3 * xa) + 2 * xb) + xc;
      if (cbxd > 1e-10 && cbxd < 1e-10) {
        break;
      }
      t += dx / cbxd;
    }
    let minT = 0;
    let maxT = 1;
    for (let it = 0; it < 20; it++) {
      t = 0.5 * (minT + maxT);
      cbx = t * (t * (t * xa + xb) + xc);
      dx = time - cbx;
      if (dx > -1e-8 && dx < 1e-8) {
        return t * (t * (t * ya + yb) + yc);
      }
      if (dx < 0) {
        maxT = t;
      } else {
        minT = t;
      }
    }
  };
};
const timingMapping$1 = {};
const timingLookup$1 = {
  ease: [0.25, 0.1, 0.25, 1],
  "ease-in": [0.42, 0, 1, 1],
  "ease-out": [0, 0, 0.58, 1],
  "ease-in-out": [0.42, 0, 0.58, 1],
  "ease-in-sine": [0.12, 0, 0.39, 0],
  "ease-out-sine": [0.12, 0, 0.39, 0],
  "ease-in-out-sine": [0.37, 0, 0.63, 1],
  "ease-in-cubic": [0.32, 0, 0.67, 0],
  "ease-out-cubic": [0.33, 1, 0.68, 1],
  "ease-in-out-cubic": [0.65, 0, 0.35, 1],
  "ease-in-circ": [0.55, 0, 1, 0.45],
  "ease-out-circ": [0, 0.55, 0.45, 1],
  "ease-in-out-circ": [0.85, 0, 0.15, 1],
  "ease-in-back": [0.36, 0, 0.66, -0.56],
  "ease-out-back": [0.34, 1.56, 0.64, 1],
  "ease-in-out-back": [0.68, -0.6, 0.32, 1.6]
};
const defaultTiming$1 = (t) => t;
const parseCubicBezier$1 = (str) => {
  const regex = /-?\d*\.?\d+/g;
  const match = str.match(regex);
  if (match) {
    const [num1, num2, num3, num4] = match;
    const a = parseFloat(num1 || "0.42");
    const b = parseFloat(num2 || "0");
    const c = parseFloat(num3 || "1");
    const d = parseFloat(num4 || "1");
    const timing = getTimingBezier$1(a, b, c, d);
    timingMapping$1[str] = timing;
    return timing;
  }
  console.warn("Unknown cubic-bezier timing: " + str);
  return defaultTiming$1;
};
const getTimingFunction$1 = (str) => {
  if (str === "linear") {
    return defaultTiming$1;
  }
  if (timingMapping$1[str] !== void 0) {
    return timingMapping$1[str] || defaultTiming$1;
  }
  if (str === "step-start") {
    return () => {
      return 1;
    };
  }
  if (str === "step-end") {
    return (time) => {
      return time === 1 ? 1 : 0;
    };
  }
  const lookup = timingLookup$1[str];
  if (lookup !== void 0) {
    const [a, b, c, d] = lookup;
    const timing = getTimingBezier$1(a, b, c, d);
    timingMapping$1[str] = timing;
    return timing;
  }
  if (str.startsWith("cubic-bezier")) {
    return parseCubicBezier$1(str);
  }
  console.warn("Unknown timing function: " + str);
  return defaultTiming$1;
};
function bytesToMb$1(bytes) {
  return (bytes / 1024 / 1024).toFixed(2);
}
class CoreAnimation extends EventEmitter {
  constructor(node, props, settings) {
    var _a2, _b, _c, _d, _e, _f;
    super();
    __publicField(this, "node");
    __publicField(this, "props");
    __publicField(this, "settings");
    __publicField(this, "progress", 0);
    __publicField(this, "delayFor", 0);
    __publicField(this, "delay", 0);
    __publicField(this, "timingFunction");
    __publicField(this, "propValuesMap", {});
    __publicField(this, "dynPropValuesMap");
    this.node = node;
    this.props = props;
    for (const key in props) {
      if (key !== "shaderProps") {
        if (this.propValuesMap["props"] === void 0) {
          this.propValuesMap["props"] = {};
        }
        this.propValuesMap["props"][key] = {
          start: node[key] || 0,
          target: props[key]
        };
      } else if (node.shader.type !== "DynamicShader") {
        this.propValuesMap["shaderProps"] = {};
        for (const key2 in props.shaderProps) {
          this.propValuesMap["shaderProps"][key2] = {
            start: node.shader.props[key2],
            target: props.shaderProps[key2]
          };
        }
      } else {
        const shaderPropKeys = Object.keys(props.shaderProps);
        const spLength = shaderPropKeys.length;
        this.dynPropValuesMap = {};
        for (let j = 0; j < spLength; j++) {
          const effectName = shaderPropKeys[j];
          const effect2 = props.shaderProps[effectName];
          this.dynPropValuesMap[effectName] = {};
          const effectProps = Object.entries(effect2);
          const eLength = effectProps.length;
          for (let k = 0; k < eLength; k++) {
            const [key2, value] = effectProps[k];
            this.dynPropValuesMap[effectName][key2] = {
              start: node.shader.props[effectName][key2],
              target: value
            };
          }
        }
      }
    }
    const easing = settings.easing || "linear";
    const delay2 = (_a2 = settings.delay) != null ? _a2 : 0;
    this.settings = {
      duration: (_b = settings.duration) != null ? _b : 0,
      delay: delay2,
      easing,
      loop: (_c = settings.loop) != null ? _c : false,
      repeat: (_d = settings.repeat) != null ? _d : 0,
      repeatDelay: (_e = settings.repeatDelay) != null ? _e : 0,
      stopMethod: (_f = settings.stopMethod) != null ? _f : false
    };
    this.timingFunction = getTimingFunction$1(easing);
    this.delayFor = delay2;
    this.delay = delay2;
  }
  reset() {
    this.progress = 0;
    this.delayFor = this.settings.delay || 0;
    this.update(0);
  }
  restoreValues(target, valueMap) {
    const entries = Object.entries(valueMap);
    const eLength = entries.length;
    for (let i = 0; i < eLength; i++) {
      const [key, value] = entries[i];
      target[key] = value.start;
    }
  }
  restore() {
    this.reset();
    if (this.propValuesMap["props"] !== void 0) {
      this.restoreValues(this.node, this.propValuesMap["props"]);
    }
    if (this.propValuesMap["shaderProps"] !== void 0) {
      this.restoreValues(this.node.shader.props, this.propValuesMap["shaderProps"]);
    }
    if (this.dynPropValuesMap !== void 0) {
      const dynEntries = Object.keys(this.dynPropValuesMap);
      const dynEntriesL = dynEntries.length;
      if (dynEntriesL > 0) {
        for (let i = 0; i < dynEntriesL; i++) {
          const key = dynEntries[i];
          this.restoreValues(this.node.shader.props[key], this.dynPropValuesMap[key]);
        }
      }
    }
  }
  reverseValues(valueMap) {
    const entries = Object.entries(valueMap);
    const eLength = entries.length;
    for (let i = 0; i < eLength; i++) {
      const [key, value] = entries[i];
      valueMap[key] = {
        start: value.target,
        target: value.start
      };
    }
  }
  reverse() {
    this.progress = 0;
    if (this.propValuesMap["props"] !== void 0) {
      this.reverseValues(this.propValuesMap["props"]);
    }
    if (this.propValuesMap["shaderProps"] !== void 0) {
      this.reverseValues(this.propValuesMap["shaderProps"]);
    }
    if (this.dynPropValuesMap !== void 0) {
      const dynEntries = Object.keys(this.dynPropValuesMap);
      const dynEntriesL = dynEntries.length;
      if (dynEntriesL > 0) {
        for (let i = 0; i < dynEntriesL; i++) {
          const key = dynEntries[i];
          this.reverseValues(this.dynPropValuesMap[key]);
        }
      }
    }
    if (!this.settings.loop) {
      this.settings.stopMethod = false;
    }
  }
  applyEasing(p, s, e) {
    return (this.timingFunction(p) || p) * (e - s) + s;
  }
  updateValue(propName, propValue, startValue, easing) {
    if (this.progress === 1) {
      return propValue;
    }
    if (this.progress === 0) {
      return startValue;
    }
    const endValue = propValue;
    if (propName.indexOf("color") !== -1) {
      if (startValue === endValue) {
        return startValue;
      }
      if (easing) {
        const easingProgressValue = this.timingFunction(this.progress) || this.progress;
        return mergeColorProgress$1(startValue, endValue, easingProgressValue);
      }
      return mergeColorProgress$1(startValue, endValue, this.progress);
    }
    if (easing) {
      return this.applyEasing(this.progress, startValue, endValue);
    }
    return startValue + (endValue - startValue) * this.progress;
  }
  updateValues(target, valueMap, easing) {
    const entries = Object.entries(valueMap);
    const eLength = entries.length;
    for (let i = 0; i < eLength; i++) {
      const [key, value] = entries[i];
      target[key] = this.updateValue(key, value.target, value.start, easing);
    }
  }
  update(dt) {
    const { duration, loop, easing, stopMethod } = this.settings;
    const { delayFor } = this;
    if (this.node.destroyed) {
      this.emit("destroyed", {});
      return;
    }
    if (duration === 0 && delayFor === 0) {
      this.emit("finished", {});
      return;
    }
    if (this.delayFor > 0) {
      this.delayFor -= dt;
      if (this.delayFor >= 0) {
        return;
      } else {
        dt = -this.delayFor;
        this.delayFor = 0;
      }
    }
    if (duration === 0) {
      this.emit("finished", {});
      return;
    }
    if (this.progress === 0) {
      this.emit("animating", {});
    }
    this.progress += dt / duration;
    if (this.progress > 1) {
      this.progress = loop ? 0 : 1;
      this.delayFor = this.delay;
      if (stopMethod) {
        this.emit("finished", {});
        return;
      }
    }
    if (this.propValuesMap["props"] !== void 0) {
      this.updateValues(this.node, this.propValuesMap["props"], easing);
    }
    if (this.propValuesMap["shaderProps"] !== void 0) {
      this.updateValues(this.node.shader.props, this.propValuesMap["shaderProps"], easing);
    }
    if (this.dynPropValuesMap !== void 0) {
      const dynEntries = Object.keys(this.dynPropValuesMap);
      const dynEntriesL = dynEntries.length;
      if (dynEntriesL > 0) {
        for (let i = 0; i < dynEntriesL; i++) {
          const key = dynEntries[i];
          this.updateValues(this.node.shader.props[key], this.dynPropValuesMap[key], easing);
        }
      }
    }
    if (this.progress < 1) {
      this.emit("tick", { progress: this.progress });
    }
    if (this.progress === 1) {
      this.emit("finished", {});
    }
  }
}
class CoreAnimationController extends EventEmitter {
  constructor(manager, animation) {
    super();
    __publicField(this, "manager");
    __publicField(this, "animation");
    __publicField(this, "stoppedPromise");
    /**
     * If this is null, then the animation is in a finished / stopped state.
     */
    __publicField(this, "stoppedResolve", null);
    __publicField(this, "state");
    this.manager = manager;
    this.animation = animation;
    this.state = "stopped";
    this.stoppedPromise = Promise.resolve();
    this.onAnimating = this.onAnimating.bind(this);
    this.onFinished = this.onFinished.bind(this);
    this.onTick = this.onTick.bind(this);
    this.onDestroy = this.onDestroy.bind(this);
  }
  start() {
    if (this.state !== "running" && this.state !== "scheduled") {
      this.makeStoppedPromise();
      this.registerAnimation();
      this.state = "scheduled";
    }
    return this;
  }
  stop() {
    this.unregisterAnimation();
    if (this.stoppedResolve !== null) {
      this.stoppedResolve();
      this.stoppedResolve = null;
      this.emit("stopped", this);
    }
    this.animation.reset();
    this.state = "stopped";
    return this;
  }
  pause() {
    this.unregisterAnimation();
    this.state = "paused";
    return this;
  }
  restore() {
    this.stoppedResolve = null;
    this.animation.restore();
    return this;
  }
  waitUntilStopped() {
    return this.stoppedPromise;
  }
  registerAnimation() {
    this.animation.once("finished", this.onFinished);
    this.animation.on("animating", this.onAnimating);
    this.animation.on("tick", this.onTick);
    this.animation.on("destroyed", this.onDestroy);
    this.manager.registerAnimation(this.animation);
  }
  unregisterAnimation() {
    this.manager.unregisterAnimation(this.animation);
    this.animation.off("finished", this.onFinished);
    this.animation.off("animating", this.onAnimating);
    this.animation.off("tick", this.onTick);
    this.animation.off("destroy", this.onDestroy);
  }
  makeStoppedPromise() {
    if (this.stoppedResolve === null) {
      this.stoppedPromise = new Promise((resolve) => {
        this.stoppedResolve = resolve;
      });
    }
  }
  onDestroy() {
    this.unregisterAnimation();
    this.state = "stopped";
  }
  onFinished() {
    const { loop, stopMethod } = this.animation.settings;
    if (stopMethod === "reverse") {
      this.animation.once("finished", this.onFinished);
      this.animation.reverse();
      return;
    }
    if (loop) {
      return;
    }
    this.unregisterAnimation();
    if (this.stoppedResolve !== null) {
      this.stoppedResolve();
      this.stoppedResolve = null;
    }
    this.emit("stopped", this);
    this.state = "stopped";
  }
  onAnimating() {
    this.state = "running";
    this.emit("animating", this);
  }
  onTick(_animation, data) {
    this.emit("tick", data);
  }
}
var CoreNodeRenderState;
(function(CoreNodeRenderState2) {
  CoreNodeRenderState2[CoreNodeRenderState2["Init"] = 0] = "Init";
  CoreNodeRenderState2[CoreNodeRenderState2["OutOfBounds"] = 2] = "OutOfBounds";
  CoreNodeRenderState2[CoreNodeRenderState2["InBounds"] = 4] = "InBounds";
  CoreNodeRenderState2[CoreNodeRenderState2["InViewport"] = 8] = "InViewport";
})(CoreNodeRenderState || (CoreNodeRenderState = {}));
const CoreNodeRenderStateMap = /* @__PURE__ */ new Map();
CoreNodeRenderStateMap.set(CoreNodeRenderState.Init, "init");
CoreNodeRenderStateMap.set(CoreNodeRenderState.OutOfBounds, "outOfBounds");
CoreNodeRenderStateMap.set(CoreNodeRenderState.InBounds, "inBounds");
CoreNodeRenderStateMap.set(CoreNodeRenderState.InViewport, "inViewport");
var UpdateType;
(function(UpdateType2) {
  UpdateType2[UpdateType2["Children"] = 1] = "Children";
  UpdateType2[UpdateType2["ScaleRotate"] = 2] = "ScaleRotate";
  UpdateType2[UpdateType2["Local"] = 4] = "Local";
  UpdateType2[UpdateType2["Global"] = 8] = "Global";
  UpdateType2[UpdateType2["Clipping"] = 16] = "Clipping";
  UpdateType2[UpdateType2["CalculatedZIndex"] = 32] = "CalculatedZIndex";
  UpdateType2[UpdateType2["ZIndexSortedChildren"] = 64] = "ZIndexSortedChildren";
  UpdateType2[UpdateType2["PremultipliedColors"] = 128] = "PremultipliedColors";
  UpdateType2[UpdateType2["WorldAlpha"] = 256] = "WorldAlpha";
  UpdateType2[UpdateType2["RenderState"] = 512] = "RenderState";
  UpdateType2[UpdateType2["IsRenderable"] = 1024] = "IsRenderable";
  UpdateType2[UpdateType2["RenderTexture"] = 2048] = "RenderTexture";
  UpdateType2[UpdateType2["ParentRenderTexture"] = 4096] = "ParentRenderTexture";
  UpdateType2[UpdateType2["RenderBounds"] = 8192] = "RenderBounds";
  UpdateType2[UpdateType2["None"] = 0] = "None";
  UpdateType2[UpdateType2["All"] = 14335] = "All";
})(UpdateType || (UpdateType = {}));
class CoreNode extends EventEmitter {
  constructor(stage, props) {
    super();
    __publicField(this, "stage");
    __publicField(this, "children", []);
    __publicField(this, "_id", getNewId());
    __publicField(this, "props");
    __publicField(this, "updateType", UpdateType.All);
    __publicField(this, "childUpdateType", UpdateType.None);
    __publicField(this, "globalTransform");
    __publicField(this, "scaleRotateTransform");
    __publicField(this, "localTransform");
    __publicField(this, "sceneGlobalTransform");
    __publicField(this, "renderCoords");
    __publicField(this, "sceneRenderCoords");
    __publicField(this, "renderBound");
    __publicField(this, "strictBound");
    __publicField(this, "preloadBound");
    __publicField(this, "clippingRect", {
      x: 0,
      y: 0,
      width: 0,
      height: 0,
      valid: false
    });
    __publicField(this, "isRenderable", false);
    __publicField(this, "renderState", CoreNodeRenderState.Init);
    __publicField(this, "worldAlpha", 1);
    __publicField(this, "premultipliedColorTl", 0);
    __publicField(this, "premultipliedColorTr", 0);
    __publicField(this, "premultipliedColorBl", 0);
    __publicField(this, "premultipliedColorBr", 0);
    __publicField(this, "calcZIndex", 0);
    __publicField(this, "hasRTTupdates", false);
    __publicField(this, "parentHasRenderTexture", false);
    __publicField(this, "rttParent", null);
    __publicField(this, "destroyed", false);
    __publicField(this, "onTextureLoaded", (_, dimensions) => {
      var _a2, _b;
      this.autosizeNode(dimensions);
      this.setUpdateType(UpdateType.IsRenderable);
      this.stage.requestRender();
      if (this.parentHasRenderTexture) {
        this.notifyParentRTTOfUpdate();
      }
      if (dimensions.width > 1 && dimensions.height > 1) {
        this.emit("loaded", {
          type: "texture",
          dimensions
        });
      }
      if (((_b = (_a2 = this.props.textureOptions) == null ? void 0 : _a2.resizeMode) == null ? void 0 : _b.type) === "contain") {
        this.setUpdateType(UpdateType.Local);
      }
    });
    __publicField(this, "onTextureFailed", (_, error) => {
      this.isRenderable = false;
      this.setUpdateType(UpdateType.IsRenderable);
      if (this.parentHasRenderTexture) {
        this.notifyParentRTTOfUpdate();
      }
      this.emit("failed", {
        type: "texture",
        error
      });
    });
    __publicField(this, "onTextureFreed", () => {
      this.isRenderable = false;
      this.setUpdateType(UpdateType.IsRenderable);
      if (this.parentHasRenderTexture) {
        this.notifyParentRTTOfUpdate();
      }
      this.emit("freed", {
        type: "texture"
      });
    });
    this.stage = stage;
    this.props = {
      ...props,
      parent: null,
      texture: null,
      src: null,
      rtt: false
    };
    this.parent = props.parent;
    this.texture = props.texture;
    this.src = props.src;
    this.rtt = props.rtt;
    if (props.boundsMargin) {
      this.boundsMargin = Array.isArray(props.boundsMargin) ? props.boundsMargin : [
        props.boundsMargin,
        props.boundsMargin,
        props.boundsMargin,
        props.boundsMargin
      ];
    }
    this.setUpdateType(UpdateType.ScaleRotate | UpdateType.Local | UpdateType.RenderBounds | UpdateType.RenderState);
    if (isProductionEnvironment() === false && props.preventCleanup === true) {
      console.warn("CoreNode.preventCleanup: Is deprecated and will be removed in upcoming release, please use textureOptions.preventCleanup instead");
    }
    if (this.stage.defaultTexture && this.stage.defaultTexture.state !== "loaded") {
      this.stage.defaultTexture.once("loaded", () => {
        this.setUpdateType(UpdateType.IsRenderable);
      });
    }
  }
  //#region Textures
  loadTexture() {
    const { texture } = this.props;
    assertTruthy(texture);
    queueMicrotask(() => {
      var _a2, _b;
      if (this.textureOptions.preload === true) {
        this.stage.txManager.loadTexture(texture);
      }
      texture.preventCleanup = (_b = (_a2 = this.props.textureOptions) == null ? void 0 : _a2.preventCleanup) != null ? _b : false;
      texture.on("loaded", this.onTextureLoaded);
      texture.on("failed", this.onTextureFailed);
      texture.on("freed", this.onTextureFreed);
      if (this.parentHasRenderTexture) {
        this.notifyParentRTTOfUpdate();
        return;
      }
      if (texture.state === "loaded") {
        assertTruthy(texture.dimensions);
        this.onTextureLoaded(texture, texture.dimensions);
      } else if (texture.state === "failed") {
        assertTruthy(texture.error);
        this.onTextureFailed(texture, texture.error);
      } else if (texture.state === "freed") {
        this.onTextureFreed(texture);
      }
    });
  }
  unloadTexture() {
    if (this.texture !== null) {
      this.texture.off("loaded", this.onTextureLoaded);
      this.texture.off("failed", this.onTextureFailed);
      this.texture.off("freed", this.onTextureFreed);
      this.texture.setRenderableOwner(this, false);
    }
  }
  autosizeNode(dimensions) {
    if (this.autosize) {
      this.width = dimensions.width;
      this.height = dimensions.height;
    }
  }
  //#endregion Textures
  /**
   * Change types types is used to determine the scope of the changes being applied
   *
   * @remarks
   * See {@link UpdateType} for more information on each type
   *
   * @param type
   */
  setUpdateType(type) {
    this.updateType |= type;
    const parent = this.props.parent;
    if (!parent)
      return;
    if ((parent.updateType & UpdateType.Children) === 0) {
      parent.setUpdateType(UpdateType.Children);
    }
  }
  sortChildren() {
    this.children.sort((a, b) => a.calcZIndex - b.calcZIndex);
  }
  updateScaleRotateTransform() {
    const { rotation, scaleX, scaleY } = this.props;
    if (rotation === 0 && scaleX === 1 && scaleY === 1) {
      this.scaleRotateTransform = void 0;
      return;
    }
    this.scaleRotateTransform = Matrix3d.rotate(rotation, this.scaleRotateTransform).scale(scaleX, scaleY);
  }
  updateLocalTransform() {
    var _a2, _b;
    const { x, y, width, height } = this.props;
    const mountTranslateX = this.props.mountX * width;
    const mountTranslateY = this.props.mountY * height;
    if (this.scaleRotateTransform) {
      const pivotTranslateX = this.props.pivotX * width;
      const pivotTranslateY = this.props.pivotY * height;
      this.localTransform = Matrix3d.translate(x - mountTranslateX + pivotTranslateX, y - mountTranslateY + pivotTranslateY, this.localTransform).multiply(this.scaleRotateTransform).translate(-pivotTranslateX, -pivotTranslateY);
    } else {
      this.localTransform = Matrix3d.translate(x - mountTranslateX, y - mountTranslateY, this.localTransform);
    }
    const texture = this.props.texture;
    if (texture && texture.dimensions && ((_b = (_a2 = this.props.textureOptions) == null ? void 0 : _a2.resizeMode) == null ? void 0 : _b.type) === "contain") {
      let resizeModeScaleX = 1;
      let resizeModeScaleY = 1;
      let extraX = 0;
      let extraY = 0;
      const { width: tw, height: th } = texture.dimensions;
      const txAspectRatio = tw / th;
      const nodeAspectRatio = width / height;
      if (txAspectRatio > nodeAspectRatio) {
        const scaleX = width / tw;
        const scaledTxHeight = th * scaleX;
        extraY = (height - scaledTxHeight) / 2;
        resizeModeScaleY = scaledTxHeight / height;
      } else {
        const scaleY = height / th;
        const scaledTxWidth = tw * scaleY;
        extraX = (width - scaledTxWidth) / 2;
        resizeModeScaleX = scaledTxWidth / width;
      }
      this.localTransform.translate(extraX, extraY).scale(resizeModeScaleX, resizeModeScaleY);
    }
    this.setUpdateType(UpdateType.Global);
  }
  /**
   * @todo: test for correct calculation flag
   * @param delta
   */
  update(delta, parentClippingRect) {
    if (this.updateType & UpdateType.ScaleRotate) {
      this.updateScaleRotateTransform();
      this.setUpdateType(UpdateType.Local);
    }
    if (this.updateType & UpdateType.Local) {
      this.updateLocalTransform();
      this.setUpdateType(UpdateType.Global);
    }
    const parent = this.props.parent;
    let renderState = null;
    if (this.updateType & UpdateType.RenderTexture && this.rtt) {
      this.hasRTTupdates = true;
    }
    if (this.updateType & UpdateType.Global) {
      assertTruthy(this.localTransform);
      if (this.parentHasRenderTexture === true && (parent == null ? void 0 : parent.rtt) === true) {
        this.globalTransform = Matrix3d.identity();
        this.sceneGlobalTransform = Matrix3d.copy((parent == null ? void 0 : parent.globalTransform) || Matrix3d.identity()).multiply(this.localTransform);
      } else if (this.parentHasRenderTexture === true && (parent == null ? void 0 : parent.rtt) === false) {
        this.sceneGlobalTransform = Matrix3d.copy((parent == null ? void 0 : parent.sceneGlobalTransform) || this.localTransform).multiply(this.localTransform);
        this.globalTransform = Matrix3d.copy((parent == null ? void 0 : parent.globalTransform) || this.localTransform, this.globalTransform);
      } else {
        this.globalTransform = Matrix3d.copy((parent == null ? void 0 : parent.globalTransform) || this.localTransform, this.globalTransform);
      }
      if (parent !== null) {
        this.globalTransform.multiply(this.localTransform);
      }
      this.calculateRenderCoords();
      this.updateBoundingRect();
      this.setUpdateType(UpdateType.RenderState | UpdateType.Children);
      this.childUpdateType |= UpdateType.Global;
      if (this.clipping === true) {
        this.setUpdateType(UpdateType.Clipping | UpdateType.RenderBounds);
        this.childUpdateType |= UpdateType.RenderBounds;
      }
    }
    if (this.updateType & UpdateType.RenderBounds) {
      this.createRenderBounds();
      this.setUpdateType(UpdateType.RenderState);
      this.setUpdateType(UpdateType.Children);
      this.childUpdateType |= UpdateType.RenderBounds;
    }
    if (this.updateType & UpdateType.RenderState) {
      renderState = this.checkRenderBounds();
      this.setUpdateType(UpdateType.IsRenderable);
      if (renderState !== CoreNodeRenderState.OutOfBounds) {
        this.updateRenderState(renderState);
      }
    }
    if (this.updateType & UpdateType.WorldAlpha) {
      if (parent) {
        this.worldAlpha = parent.worldAlpha * this.props.alpha;
      } else {
        this.worldAlpha = this.props.alpha;
      }
      this.setUpdateType(UpdateType.Children | UpdateType.PremultipliedColors | UpdateType.IsRenderable);
      this.childUpdateType |= UpdateType.WorldAlpha;
    }
    if (this.updateType & UpdateType.IsRenderable) {
      this.updateIsRenderable();
    }
    if (this.updateType & UpdateType.Clipping) {
      this.calculateClippingRect(parentClippingRect);
      this.setUpdateType(UpdateType.Children);
      this.childUpdateType |= UpdateType.Clipping;
      this.childUpdateType |= UpdateType.RenderBounds;
    }
    if (this.updateType & UpdateType.PremultipliedColors) {
      this.premultipliedColorTl = mergeColorAlphaPremultiplied(this.props.colorTl, this.worldAlpha, true);
      if (this.props.colorTl === this.props.colorTr && this.props.colorBl === this.props.colorBr && this.props.colorTl === this.props.colorBl) {
        this.premultipliedColorTr = this.premultipliedColorBl = this.premultipliedColorBr = this.premultipliedColorTl;
      } else {
        this.premultipliedColorTr = mergeColorAlphaPremultiplied(this.props.colorTr, this.worldAlpha, true);
        this.premultipliedColorBl = mergeColorAlphaPremultiplied(this.props.colorBl, this.worldAlpha, true);
        this.premultipliedColorBr = mergeColorAlphaPremultiplied(this.props.colorBr, this.worldAlpha, true);
      }
    }
    if (parent !== null && this.updateType & UpdateType.CalculatedZIndex) {
      this.calculateZIndex();
      parent.setUpdateType(UpdateType.ZIndexSortedChildren);
    }
    if (this.props.strictBounds === true && this.renderState === CoreNodeRenderState.OutOfBounds) {
      this.updateType &= ~UpdateType.RenderBounds;
      return;
    }
    if (this.updateType & UpdateType.Children && this.children.length > 0) {
      for (let i = 0, length = this.children.length; i < length; i++) {
        const child = this.children[i];
        child.setUpdateType(this.childUpdateType);
        if (child.updateType === 0) {
          continue;
        }
        let childClippingRect = this.clippingRect;
        if (this.rtt === true) {
          childClippingRect = {
            x: 0,
            y: 0,
            width: 0,
            height: 0,
            valid: false
          };
        }
        child.update(delta, childClippingRect);
      }
    }
    if (this.parentHasRenderTexture && this.updateType > 0) {
      this.notifyParentRTTOfUpdate();
    }
    if (this.updateType & UpdateType.ZIndexSortedChildren) {
      this.sortChildren();
    }
    if (renderState === CoreNodeRenderState.OutOfBounds) {
      this.updateRenderState(renderState);
      this.updateIsRenderable();
      if (this.rtt === true && renderState === CoreNodeRenderState.OutOfBounds) {
        this.notifyChildrenRTTOfUpdate(renderState);
      }
    }
    this.updateType = 0;
    this.childUpdateType = 0;
  }
  findParentRTTNode() {
    let rttNode = this.parent;
    while (rttNode && !rttNode.rtt) {
      rttNode = rttNode.parent;
    }
    return rttNode;
  }
  getRTTParentRenderState() {
    const rttNode = this.rttParent || this.findParentRTTNode();
    if (!rttNode) {
      return null;
    }
    return rttNode.renderState;
  }
  notifyChildrenRTTOfUpdate(renderState) {
    for (const child of this.children) {
      child.updateRenderState(renderState);
      child.updateIsRenderable();
      child.notifyChildrenRTTOfUpdate(renderState);
    }
  }
  notifyParentRTTOfUpdate() {
    if (this.parent === null) {
      return;
    }
    const rttNode = this.rttParent || this.findParentRTTNode();
    if (!rttNode) {
      return;
    }
    rttNode.hasRTTupdates = true;
    rttNode.setUpdateType(UpdateType.RenderTexture);
    if (rttNode.parentHasRenderTexture === true) {
      rttNode.notifyParentRTTOfUpdate();
    }
  }
  checkRenderBounds() {
    assertTruthy(this.renderBound);
    assertTruthy(this.strictBound);
    assertTruthy(this.preloadBound);
    if (boundInsideBound(this.renderBound, this.strictBound)) {
      return CoreNodeRenderState.InViewport;
    }
    if (boundInsideBound(this.renderBound, this.preloadBound)) {
      return CoreNodeRenderState.InBounds;
    }
    if (boundLargeThanBound(this.renderBound, this.strictBound)) {
      return CoreNodeRenderState.InViewport;
    }
    if (this.parent !== null && (this.props.width === 0 || this.props.height === 0)) {
      return this.parent.renderState;
    }
    return CoreNodeRenderState.OutOfBounds;
  }
  updateBoundingRect() {
    const transform = this.sceneGlobalTransform || this.globalTransform;
    const renderCoords = this.sceneRenderCoords || this.renderCoords;
    assertTruthy(transform);
    assertTruthy(renderCoords);
    const { tb, tc } = transform;
    const { x1, y1, x3, y3 } = renderCoords;
    if (tb === 0 || tc === 0) {
      this.renderBound = createBound(x1, y1, x3, y3, this.renderBound);
    } else {
      const { x2, x4, y2, y4 } = renderCoords;
      this.renderBound = createBound(Math.min(x1, x2, x3, x4), Math.min(y1, y2, y3, y4), Math.max(x1, x2, x3, x4), Math.max(y1, y2, y3, y4), this.renderBound);
    }
  }
  createRenderBounds() {
    assertTruthy(this.stage);
    if (this.parent !== null && this.parent.strictBound !== void 0) {
      const parentBound = this.parent.strictBound;
      this.strictBound = createBound(parentBound.x1, parentBound.y1, parentBound.x2, parentBound.y2);
      this.preloadBound = createPreloadBounds(this.strictBound, this.boundsMargin);
    } else {
      this.strictBound = this.stage.strictBound;
      this.preloadBound = this.stage.preloadBound;
    }
    if (this.props.clipping === false) {
      return;
    }
    if (this.renderBound === void 0) {
      return;
    }
    if (boundInsideBound(this.renderBound, this.strictBound) === false) {
      return;
    }
    const { x, y, width, height } = this.props;
    const { tx, ty } = this.sceneGlobalTransform || this.globalTransform || {};
    const _x = tx != null ? tx : x;
    const _y = ty != null ? ty : y;
    this.strictBound = createBound(_x, _y, _x + width, _y + height, this.strictBound);
    this.preloadBound = createPreloadBounds(this.strictBound, this.boundsMargin);
  }
  updateRenderState(renderState) {
    if (renderState === this.renderState) {
      return;
    }
    const previous = this.renderState;
    this.renderState = renderState;
    const event = CoreNodeRenderStateMap.get(renderState);
    assertTruthy(event);
    this.emit(event, {
      previous,
      current: renderState
    });
  }
  /**
   * Updates the `isRenderable` property based on various conditions.
   */
  updateIsRenderable() {
    let newIsRenderable = false;
    let needsTextureOwnership = false;
    if (this.checkBasicRenderability() === false) {
      this.updateTextureOwnership(false);
      this.setRenderable(false);
      return;
    }
    if (this.texture !== null) {
      needsTextureOwnership = true;
      newIsRenderable = this.texture.state === "loaded";
    } else if ((this.hasShader() || this.hasColorProperties() === true) && this.hasDimensions() === true) {
      if (this.stage.defaultTexture && this.stage.defaultTexture.state === "loaded") {
        newIsRenderable = true;
      }
    }
    this.updateTextureOwnership(needsTextureOwnership);
    this.setRenderable(newIsRenderable);
  }
  /**
   * Checks if the node is renderable based on world alpha, dimensions and out of bounds status.
   */
  checkBasicRenderability() {
    if (this.worldAlpha === 0 || this.isOutOfBounds() === true) {
      return false;
    } else {
      return true;
    }
  }
  /**
   * Sets the renderable state and triggers changes if necessary.
   * @param isRenderable - The new renderable state
   */
  setRenderable(isRenderable) {
    this.isRenderable = isRenderable;
  }
  /**
   * Changes the renderable state of the node.
   */
  updateTextureOwnership(isRenderable) {
    var _a2;
    (_a2 = this.texture) == null ? void 0 : _a2.setRenderableOwner(this, isRenderable);
  }
  /**
   * Checks if the node is out of the viewport bounds.
   */
  isOutOfBounds() {
    return this.renderState <= CoreNodeRenderState.OutOfBounds;
  }
  /**
   * Checks if the node has dimensions (width/height)
   */
  hasDimensions() {
    return this.props.width !== 0 && this.props.height !== 0;
  }
  /**
   * Checks if the node has any color properties set.
   */
  hasColorProperties() {
    return this.props.color !== 0 || this.props.colorTop !== 0 || this.props.colorBottom !== 0 || this.props.colorLeft !== 0 || this.props.colorRight !== 0 || this.props.colorTl !== 0 || this.props.colorTr !== 0 || this.props.colorBl !== 0 || this.props.colorBr !== 0;
  }
  hasShader() {
    return this.props.shader !== null;
  }
  calculateRenderCoords() {
    const { width, height } = this;
    const { tx, ty, ta, tb, tc, td } = this.globalTransform;
    if (tb === 0 && tc === 0) {
      const minX = tx;
      const maxX = tx + width * ta;
      const minY = ty;
      const maxY = ty + height * td;
      this.renderCoords = RenderCoords.translate(
        //top-left
        minX,
        minY,
        //top-right
        maxX,
        minY,
        //bottom-right
        maxX,
        maxY,
        //bottom-left
        minX,
        maxY,
        this.renderCoords
      );
    } else {
      this.renderCoords = RenderCoords.translate(
        //top-left
        tx,
        ty,
        //top-right
        tx + width * ta,
        ty + width * tc,
        //bottom-right
        tx + width * ta + height * tb,
        ty + width * tc + height * td,
        //bottom-left
        tx + height * tb,
        ty + height * td,
        this.renderCoords
      );
    }
    if (this.sceneGlobalTransform === void 0) {
      return;
    }
    const { tx: stx, ty: sty, ta: sta, tb: stb, tc: stc, td: std } = this.sceneGlobalTransform;
    if (stb === 0 && stc === 0) {
      const minX = stx;
      const maxX = stx + width * sta;
      const minY = sty;
      const maxY = sty + height * std;
      this.sceneRenderCoords = RenderCoords.translate(
        //top-left
        minX,
        minY,
        //top-right
        maxX,
        minY,
        //bottom-right
        maxX,
        maxY,
        //bottom-left
        minX,
        maxY,
        this.sceneRenderCoords
      );
    } else {
      this.sceneRenderCoords = RenderCoords.translate(
        //top-left
        stx,
        sty,
        //top-right
        stx + width * sta,
        sty + width * stc,
        //bottom-right
        stx + width * sta + height * stb,
        sty + width * stc + height * std,
        //bottom-left
        stx + height * stb,
        sty + height * std,
        this.sceneRenderCoords
      );
    }
  }
  /**
   * This function calculates the clipping rectangle for a node.
   *
   * The function then checks if the node is rotated. If the node requires clipping and is not rotated, a new clipping rectangle is created based on the node's global transform and dimensions.
   * If a parent clipping rectangle exists, it is intersected with the node's clipping rectangle (if it exists), or replaces the node's clipping rectangle.
   *
   * Finally, the node's parentClippingRect and clippingRect properties are updated.
   */
  calculateClippingRect(parentClippingRect) {
    assertTruthy(this.globalTransform);
    const { clippingRect, props, globalTransform: gt } = this;
    const { clipping } = props;
    const isRotated = gt.tb !== 0 || gt.tc !== 0;
    if (clipping === true && isRotated === false) {
      clippingRect.x = gt.tx;
      clippingRect.y = gt.ty;
      clippingRect.width = this.width * gt.ta;
      clippingRect.height = this.height * gt.td;
      clippingRect.valid = true;
    } else {
      clippingRect.valid = false;
    }
    if (parentClippingRect.valid === true && clippingRect.valid === true) {
      intersectRect(parentClippingRect, clippingRect, clippingRect);
    } else if (parentClippingRect.valid === true) {
      copyRect(parentClippingRect, clippingRect);
      clippingRect.valid = true;
    }
  }
  calculateZIndex() {
    var _a2, _b;
    const props = this.props;
    const z = props.zIndex || 0;
    const p = ((_a2 = props.parent) == null ? void 0 : _a2.zIndex) || 0;
    let zIndex = z;
    if ((_b = props.parent) == null ? void 0 : _b.zIndexLocked) {
      zIndex = z < p ? z : p;
    }
    this.calcZIndex = zIndex;
  }
  /**
   * Destroy the node and cleanup all resources
   */
  destroy() {
    var _a2;
    if (this.destroyed === true) {
      return;
    }
    this.destroyed = true;
    this.unloadTexture();
    this.clippingRect.valid = false;
    this.isRenderable = false;
    this.renderCoords = void 0;
    this.renderBound = void 0;
    this.strictBound = void 0;
    this.preloadBound = void 0;
    this.globalTransform = void 0;
    this.scaleRotateTransform = void 0;
    this.localTransform = void 0;
    this.props.texture = null;
    this.props.shader = this.stage.defShaderCtr;
    while (this.children.length > 0) {
      (_a2 = this.children[0]) == null ? void 0 : _a2.destroy();
    }
    this.parent = null;
    if (this.rtt) {
      this.stage.renderer.removeRTTNode(this);
    }
    this.removeAllListeners();
  }
  renderQuads(renderer2) {
    if (this.parentHasRenderTexture) {
      if (!renderer2.renderToTextureActive) {
        return;
      }
      if (this.parentRenderTexture !== renderer2.activeRttNode) {
        return;
      }
    }
    assertTruthy(this.globalTransform);
    assertTruthy(this.renderCoords);
    renderer2.addQuad({
      width: this.props.width,
      height: this.props.height,
      colorTl: this.premultipliedColorTl,
      colorTr: this.premultipliedColorTr,
      colorBl: this.premultipliedColorBl,
      colorBr: this.premultipliedColorBr,
      // if we do not have a texture, use the default texture
      // this assumes any renderable node is either a distinct texture or a ColorTexture
      texture: this.texture || this.stage.defaultTexture,
      textureOptions: this.textureOptions,
      zIndex: this.zIndex,
      shader: this.shader.shader,
      shaderProps: this.shader.getResolvedProps(),
      alpha: this.worldAlpha,
      clippingRect: this.clippingRect,
      tx: this.globalTransform.tx,
      ty: this.globalTransform.ty,
      ta: this.globalTransform.ta,
      tb: this.globalTransform.tb,
      tc: this.globalTransform.tc,
      td: this.globalTransform.td,
      renderCoords: this.renderCoords,
      rtt: this.rtt,
      parentHasRenderTexture: this.parentHasRenderTexture,
      framebufferDimensions: this.framebufferDimensions
    });
  }
  //#region Properties
  get id() {
    return this._id;
  }
  get data() {
    return this.props.data;
  }
  set data(d) {
    this.props.data = d;
  }
  get x() {
    return this.props.x;
  }
  set x(value) {
    if (this.props.x !== value) {
      this.props.x = value;
      this.setUpdateType(UpdateType.Local);
    }
  }
  get absX() {
    var _a2, _b, _c;
    return this.props.x + -this.props.width * this.props.mountX + (((_a2 = this.props.parent) == null ? void 0 : _a2.absX) || ((_c = (_b = this.props.parent) == null ? void 0 : _b.globalTransform) == null ? void 0 : _c.tx) || 0);
  }
  get absY() {
    var _a2, _b;
    return this.props.y + -this.props.height * this.props.mountY + ((_b = (_a2 = this.props.parent) == null ? void 0 : _a2.absY) != null ? _b : 0);
  }
  get y() {
    return this.props.y;
  }
  set y(value) {
    if (this.props.y !== value) {
      this.props.y = value;
      this.setUpdateType(UpdateType.Local);
    }
  }
  get width() {
    return this.props.width;
  }
  set width(value) {
    if (this.props.width !== value) {
      this.props.width = value;
      this.setUpdateType(UpdateType.Local);
      if (this.props.rtt) {
        this.texture = this.stage.txManager.createTexture("RenderTexture", {
          width: this.width,
          height: this.height
        });
        this.setUpdateType(UpdateType.RenderTexture);
      }
    }
  }
  get height() {
    return this.props.height;
  }
  set height(value) {
    if (this.props.height !== value) {
      this.props.height = value;
      this.setUpdateType(UpdateType.Local);
      if (this.props.rtt) {
        this.texture = this.stage.txManager.createTexture("RenderTexture", {
          width: this.width,
          height: this.height
        });
        this.setUpdateType(UpdateType.RenderTexture);
      }
    }
  }
  get scale() {
    return this.scaleX;
  }
  set scale(value) {
    this.scaleX = value;
    this.scaleY = value;
  }
  get scaleX() {
    return this.props.scaleX;
  }
  set scaleX(value) {
    if (this.props.scaleX !== value) {
      this.props.scaleX = value;
      this.setUpdateType(UpdateType.ScaleRotate);
    }
  }
  get scaleY() {
    return this.props.scaleY;
  }
  set scaleY(value) {
    if (this.props.scaleY !== value) {
      this.props.scaleY = value;
      this.setUpdateType(UpdateType.ScaleRotate);
    }
  }
  get mount() {
    return this.props.mount;
  }
  set mount(value) {
    if (this.props.mountX !== value || this.props.mountY !== value) {
      this.props.mountX = value;
      this.props.mountY = value;
      this.props.mount = value;
      this.setUpdateType(UpdateType.Local);
    }
  }
  get mountX() {
    return this.props.mountX;
  }
  set mountX(value) {
    if (this.props.mountX !== value) {
      this.props.mountX = value;
      this.setUpdateType(UpdateType.Local);
    }
  }
  get mountY() {
    return this.props.mountY;
  }
  set mountY(value) {
    if (this.props.mountY !== value) {
      this.props.mountY = value;
      this.setUpdateType(UpdateType.Local);
    }
  }
  get pivot() {
    return this.props.pivot;
  }
  set pivot(value) {
    if (this.props.pivotX !== value || this.props.pivotY !== value) {
      this.props.pivotX = value;
      this.props.pivotY = value;
      this.props.pivot = value;
      this.setUpdateType(UpdateType.Local);
    }
  }
  get pivotX() {
    return this.props.pivotX;
  }
  set pivotX(value) {
    if (this.props.pivotX !== value) {
      this.props.pivotX = value;
      this.setUpdateType(UpdateType.Local);
    }
  }
  get pivotY() {
    return this.props.pivotY;
  }
  set pivotY(value) {
    if (this.props.pivotY !== value) {
      this.props.pivotY = value;
      this.setUpdateType(UpdateType.Local);
    }
  }
  get rotation() {
    return this.props.rotation;
  }
  set rotation(value) {
    if (this.props.rotation !== value) {
      this.props.rotation = value;
      this.setUpdateType(UpdateType.ScaleRotate);
    }
  }
  get alpha() {
    return this.props.alpha;
  }
  set alpha(value) {
    this.props.alpha = value;
    this.setUpdateType(UpdateType.PremultipliedColors | UpdateType.WorldAlpha | UpdateType.Children | UpdateType.IsRenderable);
    this.childUpdateType |= UpdateType.WorldAlpha;
  }
  get autosize() {
    return this.props.autosize;
  }
  set autosize(value) {
    this.props.autosize = value;
  }
  get boundsMargin() {
    var _a2, _b, _c;
    return (_c = (_b = this.props.boundsMargin) != null ? _b : (_a2 = this.parent) == null ? void 0 : _a2.boundsMargin) != null ? _c : this.stage.boundsMargin;
  }
  set boundsMargin(value) {
    if (value === this.props.boundsMargin) {
      return;
    }
    if (value === null) {
      this.props.boundsMargin = value;
    } else {
      const bm = Array.isArray(value) ? value : [value, value, value, value];
      this.props.boundsMargin = bm;
    }
    this.setUpdateType(UpdateType.RenderBounds);
  }
  get clipping() {
    return this.props.clipping;
  }
  set clipping(value) {
    this.props.clipping = value;
    this.setUpdateType(UpdateType.Clipping | UpdateType.RenderBounds | UpdateType.Children);
    this.childUpdateType |= UpdateType.Global | UpdateType.Clipping;
  }
  get color() {
    return this.props.color;
  }
  set color(value) {
    this.colorTop = value;
    this.colorBottom = value;
    this.colorLeft = value;
    this.colorRight = value;
    this.props.color = value;
    this.setUpdateType(UpdateType.PremultipliedColors);
  }
  get colorTop() {
    return this.props.colorTop;
  }
  set colorTop(value) {
    if (this.props.colorTl !== value || this.props.colorTr !== value) {
      this.colorTl = value;
      this.colorTr = value;
    }
    this.props.colorTop = value;
    this.setUpdateType(UpdateType.PremultipliedColors);
  }
  get colorBottom() {
    return this.props.colorBottom;
  }
  set colorBottom(value) {
    if (this.props.colorBl !== value || this.props.colorBr !== value) {
      this.colorBl = value;
      this.colorBr = value;
    }
    this.props.colorBottom = value;
    this.setUpdateType(UpdateType.PremultipliedColors);
  }
  get colorLeft() {
    return this.props.colorLeft;
  }
  set colorLeft(value) {
    if (this.props.colorTl !== value || this.props.colorBl !== value) {
      this.colorTl = value;
      this.colorBl = value;
    }
    this.props.colorLeft = value;
    this.setUpdateType(UpdateType.PremultipliedColors);
  }
  get colorRight() {
    return this.props.colorRight;
  }
  set colorRight(value) {
    if (this.props.colorTr !== value || this.props.colorBr !== value) {
      this.colorTr = value;
      this.colorBr = value;
    }
    this.props.colorRight = value;
    this.setUpdateType(UpdateType.PremultipliedColors);
  }
  get colorTl() {
    return this.props.colorTl;
  }
  set colorTl(value) {
    this.props.colorTl = value;
    this.setUpdateType(UpdateType.PremultipliedColors);
  }
  get colorTr() {
    return this.props.colorTr;
  }
  set colorTr(value) {
    this.props.colorTr = value;
    this.setUpdateType(UpdateType.PremultipliedColors);
  }
  get colorBl() {
    return this.props.colorBl;
  }
  set colorBl(value) {
    this.props.colorBl = value;
    this.setUpdateType(UpdateType.PremultipliedColors);
  }
  get colorBr() {
    return this.props.colorBr;
  }
  set colorBr(value) {
    this.props.colorBr = value;
    this.setUpdateType(UpdateType.PremultipliedColors);
  }
  // we're only interested in parent zIndex to test
  // if we should use node zIndex is higher then parent zIndex
  get zIndexLocked() {
    return this.props.zIndexLocked || 0;
  }
  set zIndexLocked(value) {
    this.props.zIndexLocked = value;
    this.setUpdateType(UpdateType.CalculatedZIndex | UpdateType.Children);
    for (let i = 0, length = this.children.length; i < length; i++) {
      this.children[i].setUpdateType(UpdateType.CalculatedZIndex);
    }
  }
  get zIndex() {
    return this.props.zIndex;
  }
  set zIndex(value) {
    this.props.zIndex = value;
    this.setUpdateType(UpdateType.CalculatedZIndex | UpdateType.Children);
    for (let i = 0, length = this.children.length; i < length; i++) {
      this.children[i].setUpdateType(UpdateType.CalculatedZIndex);
    }
  }
  get parent() {
    return this.props.parent;
  }
  set parent(newParent) {
    const oldParent = this.props.parent;
    if (oldParent === newParent) {
      return;
    }
    this.props.parent = newParent;
    if (oldParent) {
      const index = oldParent.children.indexOf(this);
      assertTruthy(index !== -1, "CoreNode.parent: Node not found in old parent's children!");
      oldParent.children.splice(index, 1);
      oldParent.setUpdateType(UpdateType.Children | UpdateType.ZIndexSortedChildren);
    }
    if (newParent) {
      newParent.children.push(this);
      this.setUpdateType(UpdateType.All);
      newParent.setUpdateType(UpdateType.Children | UpdateType.ZIndexSortedChildren);
      if (newParent.rtt || newParent.parentHasRenderTexture) {
        this.applyRTTInheritance(newParent);
      }
    }
    this.updateScaleRotateTransform();
    this.setUpdateType(UpdateType.RenderBounds | UpdateType.Children);
  }
  get preventCleanup() {
    return this.props.textureOptions.preventCleanup || false;
  }
  set preventCleanup(value) {
    if (isProductionEnvironment() === false) {
      console.warn("CoreNode.preventCleanup: Is deprecated and will be removed in upcoming release, please use textureOptions.preventCleanup instead");
    }
    this.props.textureOptions.preventCleanup = value;
  }
  get rtt() {
    return this.props.rtt;
  }
  set rtt(value) {
    if (this.props.rtt === value) {
      return;
    }
    this.props.rtt = value;
    if (value === true) {
      this.initRenderTexture();
      this.markChildrenWithRTT();
    } else {
      this.cleanupRenderTexture();
    }
    this.setUpdateType(UpdateType.RenderTexture);
    if (this.parentHasRenderTexture === true) {
      this.notifyParentRTTOfUpdate();
    }
  }
  initRenderTexture() {
    this.texture = this.stage.txManager.createTexture("RenderTexture", {
      width: this.width,
      height: this.height
    });
    this.stage.renderer.renderToTexture(this);
  }
  cleanupRenderTexture() {
    this.unloadTexture();
    this.clearRTTInheritance();
    this.hasRTTupdates = false;
    this.texture = null;
  }
  markChildrenWithRTT(node = null) {
    const parent = node || this;
    for (const child of parent.children) {
      child.setUpdateType(UpdateType.All);
      child.parentHasRenderTexture = true;
      child.markChildrenWithRTT();
    }
  }
  // Apply RTT inheritance when a node has an RTT-enabled parent
  applyRTTInheritance(parent) {
    if (parent.rtt) {
      parent.setUpdateType(UpdateType.RenderTexture);
    }
    this.markChildrenWithRTT(parent);
  }
  // Clear RTT inheritance when detaching from an RTT chain
  clearRTTInheritance() {
    if (this.rtt) {
      return;
    }
    for (const child of this.children) {
      child.parentHasRenderTexture = false;
      child.rttParent = null;
      child.setUpdateType(UpdateType.All);
      child.clearRTTInheritance();
    }
  }
  get shader() {
    return this.props.shader;
  }
  set shader(value) {
    if (this.props.shader === value) {
      return;
    }
    this.props.shader = value;
    this.setUpdateType(UpdateType.IsRenderable);
  }
  get src() {
    return this.props.src;
  }
  set src(imageUrl) {
    if (this.props.src === imageUrl) {
      return;
    }
    this.props.src = imageUrl;
    if (!imageUrl) {
      this.texture = null;
      return;
    }
    this.texture = this.stage.txManager.createTexture("ImageTexture", {
      src: imageUrl,
      width: this.props.width,
      height: this.props.height,
      type: this.props.imageType,
      sx: this.props.srcX,
      sy: this.props.srcY,
      sw: this.props.srcWidth,
      sh: this.props.srcHeight
    });
  }
  set imageType(type) {
    if (this.props.imageType === type) {
      return;
    }
    this.props.imageType = type;
  }
  get imageType() {
    return this.props.imageType || null;
  }
  get srcHeight() {
    return this.props.srcHeight;
  }
  set srcHeight(value) {
    this.props.srcHeight = value;
  }
  get srcWidth() {
    return this.props.srcWidth;
  }
  set srcWidth(value) {
    this.props.srcWidth = value;
  }
  get srcX() {
    return this.props.srcX;
  }
  set srcX(value) {
    this.props.srcX = value;
  }
  get srcY() {
    return this.props.srcY;
  }
  set srcY(value) {
    this.props.srcY = value;
  }
  /**
   * Returns the framebuffer dimensions of the node.
   * If the node has a render texture, the dimensions are the same as the node's dimensions.
   * If the node does not have a render texture, the dimensions are inherited from the parent.
   * If the node parent has a render texture and the node is a render texture, the nodes dimensions are used.
   */
  get framebufferDimensions() {
    if (this.parentHasRenderTexture && !this.rtt && this.parent) {
      return this.parent.framebufferDimensions;
    }
    return { width: this.width, height: this.height };
  }
  /**
   * Returns the parent render texture node if it exists.
   */
  get parentRenderTexture() {
    let parent = this.parent;
    while (parent) {
      if (parent.rtt) {
        return parent;
      }
      parent = parent.parent;
    }
    return null;
  }
  get texture() {
    return this.props.texture;
  }
  set texture(value) {
    if (this.props.texture === value) {
      return;
    }
    const oldTexture = this.props.texture;
    if (oldTexture) {
      oldTexture.setRenderableOwner(this, false);
      this.unloadTexture();
    }
    this.props.texture = value;
    if (value !== null) {
      value.setRenderableOwner(this, this.isRenderable);
      this.loadTexture();
    }
    this.setUpdateType(UpdateType.IsRenderable);
  }
  set textureOptions(value) {
    this.props.textureOptions = value;
  }
  get textureOptions() {
    return this.props.textureOptions;
  }
  get strictBounds() {
    return this.props.strictBounds;
  }
  set strictBounds(v) {
    if (v === this.props.strictBounds) {
      return;
    }
    this.props.strictBounds = v;
    this.setUpdateType(UpdateType.RenderBounds | UpdateType.Children);
    this.childUpdateType |= UpdateType.RenderBounds | UpdateType.Children;
  }
  animate(props, settings) {
    const animation = new CoreAnimation(this, props, settings);
    const controller = new CoreAnimationController(this.stage.animationManager, animation);
    return controller;
  }
  flush() {
  }
}
const startLoop = (stage) => {
  let isIdle = false;
  let lastFrameTime = 0;
  const runLoop = (currentTime = 0) => {
    const targetFrameTime = stage.targetFrameTime;
    if (targetFrameTime > 0 && currentTime - lastFrameTime < targetFrameTime) {
      const delay2 = targetFrameTime - (currentTime - lastFrameTime);
      setTimeout(() => requestAnimationFrame(runLoop), delay2);
      return;
    }
    lastFrameTime = currentTime;
    stage.updateFrameTime();
    stage.updateAnimations();
    if (!stage.hasSceneUpdates()) {
      stage.calculateFps();
      if (targetFrameTime > 0) {
        setTimeout(() => requestAnimationFrame(runLoop), Math.max(targetFrameTime, 16.666666666666668));
      } else {
        setTimeout(() => requestAnimationFrame(runLoop), 16.666666666666668);
      }
      if (!isIdle) {
        stage.eventBus.emit("idle");
        isIdle = true;
      }
      if (stage.txMemManager.checkCleanup() === true) {
        stage.txMemManager.cleanup(false);
      }
      stage.flushFrameEvents();
      return;
    }
    isIdle = false;
    stage.drawFrame();
    stage.flushFrameEvents();
    if (targetFrameTime > 0) {
      const nextFrameDelay = Math.max(0, targetFrameTime - (performance.now() - currentTime));
      setTimeout(() => requestAnimationFrame(runLoop), nextFrameDelay);
    } else {
      requestAnimationFrame(runLoop);
    }
  };
  requestAnimationFrame(runLoop);
};
const getTimeStamp = () => {
  return performance ? performance.now() : Date.now();
};
class AnimationManager {
  constructor() {
    __publicField(this, "activeAnimations", /* @__PURE__ */ new Set());
  }
  registerAnimation(animation) {
    this.activeAnimations.add(animation);
  }
  unregisterAnimation(animation) {
    this.activeAnimations.delete(animation);
  }
  update(dt) {
    this.activeAnimations.forEach((animation) => {
      animation.update(dt);
    });
  }
}
function createImageWorker() {
  function hasAlphaChannel(mimeType) {
    return mimeType.indexOf("image/png") !== -1;
  }
  function getImage(src, premultiplyAlpha, x, y, width, height, options) {
    return new Promise(function(resolve, reject) {
      var xhr = new XMLHttpRequest();
      xhr.open("GET", src, true);
      xhr.responseType = "blob";
      xhr.onload = function() {
        if (xhr.status !== 200 && xhr.status !== 0) {
          return reject(new Error("Failed to load image: " + xhr.statusText));
        }
        var blob = xhr.response;
        premultiplyAlpha !== void 0 ? premultiplyAlpha : hasAlphaChannel(blob.type);
        {
          createImageBitmap(blob).then(function(data) {
            resolve({ data, premultiplyAlpha });
          }).catch(function(error) {
            reject(error);
          });
        }
      };
      xhr.onerror = function() {
        reject(new Error("Network error occurred while trying to fetch the image."));
      };
      xhr.send();
    });
  }
  self.onmessage = (event) => {
    var src = event.data.src;
    var id = event.data.id;
    var premultiplyAlpha = event.data.premultiplyAlpha;
    event.data.sx;
    event.data.sy;
    event.data.sw;
    event.data.sh;
    getImage(src, premultiplyAlpha).then(function(data) {
      self.postMessage({ id, src, data }, [data.data]);
    }).catch(function(error) {
      self.postMessage({ id, src, error: error.message });
    });
  };
}
class ImageWorkerManager {
  constructor(numImageWorkers2, createImageBitmapSupport) {
    __publicField(this, "imageWorkersEnabled", true);
    __publicField(this, "messageManager", {});
    __publicField(this, "workers", []);
    __publicField(this, "workerIndex", 0);
    __publicField(this, "nextId", 0);
    this.workers = this.createWorkers(numImageWorkers2, createImageBitmapSupport);
    this.workers.forEach((worker) => {
      worker.onmessage = this.handleMessage.bind(this);
    });
  }
  handleMessage(event) {
    const { id, data, error } = event.data;
    const msg = this.messageManager[id];
    if (msg) {
      const [resolve, reject] = msg;
      delete this.messageManager[id];
      if (error) {
        reject(new Error(error));
      } else {
        resolve(data);
      }
    }
  }
  createWorkers(numWorkers2 = 1, createImageBitmapSupport) {
    let workerCode = "(".concat(createImageWorker.toString(), ")()");
    if (createImageBitmapSupport.options === true) {
      workerCode = workerCode.replace("var supportsOptionsCreateImageBitmap = false;", "var supportsOptionsCreateImageBitmap = true;");
    }
    if (createImageBitmapSupport.full === true) {
      workerCode = workerCode.replace("var supportsOptionsCreateImageBitmap = false;", "var supportsOptionsCreateImageBitmap = true;");
      workerCode = workerCode.replace("var supportsFullCreateImageBitmap = false;", "var supportsFullCreateImageBitmap = true;");
    }
    workerCode = workerCode.replace('"use strict";', "");
    const blob = new Blob([workerCode], {
      type: "application/javascript"
    });
    const blobURL = (self.URL ? URL : webkitURL).createObjectURL(blob);
    const workers = [];
    for (let i = 0; i < numWorkers2; i++) {
      workers.push(new Worker(blobURL));
    }
    return workers;
  }
  getNextWorker() {
    const worker = this.workers[this.workerIndex];
    this.workerIndex = (this.workerIndex + 1) % this.workers.length;
    return worker;
  }
  getImage(src, premultiplyAlpha, sx, sy, sw, sh) {
    return new Promise((resolve, reject) => {
      try {
        if (this.workers) {
          const id = this.nextId++;
          this.messageManager[id] = [resolve, reject];
          const nextWorker = this.getNextWorker();
          if (nextWorker) {
            nextWorker.postMessage({
              id,
              src,
              premultiplyAlpha,
              sx,
              sy,
              sw,
              sh
            });
          }
        }
      } catch (error) {
        reject(error);
      }
    });
  }
}
const _ColorTexture = class _ColorTexture extends Texture {
  constructor(txManager, props) {
    super(txManager);
    __publicField(this, "type", TextureType.color);
    __publicField(this, "props");
    this.props = _ColorTexture.resolveDefaults(props || {});
  }
  get color() {
    return this.props.color;
  }
  set color(color) {
    this.props.color = color;
  }
  async getTextureSource() {
    const pixelData = new Uint8Array(4);
    if (this.color === 4294967295) {
      pixelData[0] = 255;
      pixelData[1] = 255;
      pixelData[2] = 255;
      pixelData[3] = 255;
    } else {
      pixelData[0] = this.color >> 16 & 255;
      pixelData[1] = this.color >> 8 & 255;
      pixelData[2] = this.color & 255;
      pixelData[3] = this.color >>> 24 & 255;
    }
    this.setState("fetched", { width: 1, height: 1 });
    return {
      data: pixelData,
      premultiplyAlpha: true
    };
  }
  static makeCacheKey(props) {
    const resolvedProps = _ColorTexture.resolveDefaults(props);
    return "ColorTexture,".concat(resolvedProps.color);
  }
  static resolveDefaults(props) {
    return {
      color: props.color || 4294967295
    };
  }
};
__publicField(_ColorTexture, "z$__type__Props");
let ColorTexture = _ColorTexture;
function isCompressedTextureContainer(url) {
  return /\.(ktx|pvr)$/.test(url);
}
const loadCompressedTexture = async (url) => {
  const response = await fetch(url);
  const arrayBuffer = await response.arrayBuffer();
  if (url.indexOf(".ktx") !== -1) {
    return loadKTXData(arrayBuffer);
  }
  return loadPVRData(arrayBuffer);
};
const loadKTXData = async (buffer) => {
  const view = new DataView(buffer);
  const littleEndian = view.getUint32(12) === 16909060 ? true : false;
  const mipmaps = [];
  const data = {
    glInternalFormat: view.getUint32(28, littleEndian),
    pixelWidth: view.getUint32(36, littleEndian),
    pixelHeight: view.getUint32(40, littleEndian),
    numberOfMipmapLevels: view.getUint32(56, littleEndian),
    bytesOfKeyValueData: view.getUint32(60, littleEndian)
  };
  let offset = 64;
  offset += data.bytesOfKeyValueData;
  for (let i = 0; i < data.numberOfMipmapLevels; i++) {
    const imageSize = view.getUint32(offset);
    offset += 4;
    mipmaps.push(view.buffer.slice(offset, imageSize));
    offset += imageSize;
  }
  return {
    data: {
      glInternalFormat: data.glInternalFormat,
      mipmaps,
      width: data.pixelWidth || 0,
      height: data.pixelHeight || 0,
      type: "ktx"
    },
    premultiplyAlpha: false
  };
};
const loadPVRData = async (buffer) => {
  const pvrHeaderLength = 13;
  const pvrFormatEtc1 = 36196;
  const pvrWidth = 7;
  const pvrHeight = 6;
  const pvrMipmapCount = 11;
  const pvrMetadata = 12;
  const arrayBuffer = buffer;
  const header = new Int32Array(arrayBuffer, 0, pvrHeaderLength);
  const dataOffset = header[pvrMetadata] + 52;
  const pvrtcData = new Uint8Array(arrayBuffer, dataOffset);
  const mipmaps = [];
  const data = {
    pixelWidth: header[pvrWidth],
    pixelHeight: header[pvrHeight],
    numberOfMipmapLevels: header[pvrMipmapCount] || 0
  };
  let offset = 0;
  let width = data.pixelWidth || 0;
  let height = data.pixelHeight || 0;
  for (let i = 0; i < data.numberOfMipmapLevels; i++) {
    const level = (width + 3 >> 2) * (height + 3 >> 2) * 8;
    const view = new Uint8Array(arrayBuffer, pvrtcData.byteOffset + offset, level);
    mipmaps.push(view);
    offset += level;
    width = width >> 1;
    height = height >> 1;
  }
  return {
    data: {
      glInternalFormat: pvrFormatEtc1,
      mipmaps,
      width: data.pixelWidth || 0,
      height: data.pixelHeight || 0,
      type: "pvr"
    },
    premultiplyAlpha: false
  };
};
function isSvgImage(url) {
  return /\.(svg)(\?.*)?$/.test(url);
}
const loadSvg = (url, width, height, sx, sy, sw, sh) => {
  return new Promise((resolve, reject) => {
    const canvas = document.createElement("canvas");
    const ctx = canvas.getContext("2d");
    assertTruthy(ctx);
    ctx.imageSmoothingEnabled = true;
    const img = new Image();
    img.onload = () => {
      const x = sx != null ? sx : 0;
      const y = sy != null ? sy : 0;
      const w = width || img.width;
      const h = height || img.height;
      canvas.width = w;
      canvas.height = h;
      ctx.drawImage(img, 0, 0, w, h);
      resolve({
        data: ctx.getImageData(x, y, sw != null ? sw : w, sh != null ? sh : h),
        premultiplyAlpha: false
      });
    };
    img.onerror = (err) => {
      reject(err);
    };
    img.src = url;
  });
};
function fetchJson(url, responseType = "") {
  return new Promise((resolve, reject) => {
    const xhr = new XMLHttpRequest();
    xhr.responseType = responseType;
    xhr.onreadystatechange = function() {
      if (xhr.readyState == XMLHttpRequest.DONE) {
        if (xhr.status === 0 || xhr.status === 200) {
          resolve(xhr.response);
        } else {
          reject(xhr.statusText);
        }
      }
    };
    xhr.open("GET", url, true);
    xhr.send(null);
  });
}
const _ImageTexture = class _ImageTexture extends Texture {
  constructor(txManager, props) {
    super(txManager);
    __publicField(this, "props");
    __publicField(this, "type", TextureType.image);
    this.props = _ImageTexture.resolveDefaults(props);
  }
  hasAlphaChannel(mimeType) {
    return mimeType.indexOf("image/png") !== -1;
  }
  async loadImageFallback(src, hasAlpha) {
    const img = new Image();
    if (typeof src === "string" && isBase64Image(src) === false) {
      img.crossOrigin = "anonymous";
    }
    return new Promise((resolve) => {
      img.onload = () => {
        resolve({ data: img, premultiplyAlpha: hasAlpha });
      };
      img.onerror = () => {
        console.warn("Image loading failed, returning fallback object.");
        resolve({ data: null, premultiplyAlpha: hasAlpha });
      };
      if (src instanceof Blob) {
        img.src = URL.createObjectURL(src);
      } else {
        img.src = src;
      }
    });
  }
  async createImageBitmap(blob, premultiplyAlpha, sx, sy, sw, sh) {
    const hasAlphaChannel = premultiplyAlpha != null ? premultiplyAlpha : blob.type.includes("image/png");
    const imageBitmapSupported = this.txManager.imageBitmapSupported;
    if (imageBitmapSupported.full === true && sw !== null && sh !== null) {
      const bitmap2 = await createImageBitmap(blob, sx || 0, sy || 0, sw, sh, {
        premultiplyAlpha: hasAlphaChannel ? "premultiply" : "none",
        colorSpaceConversion: "none",
        imageOrientation: "none"
      });
      return { data: bitmap2, premultiplyAlpha: hasAlphaChannel };
    } else if (imageBitmapSupported.basic === true) {
      return {
        data: await createImageBitmap(blob),
        premultiplyAlpha: hasAlphaChannel
      };
    }
    const bitmap = await createImageBitmap(blob, {
      premultiplyAlpha: hasAlphaChannel ? "premultiply" : "none",
      colorSpaceConversion: "none",
      imageOrientation: "none"
    });
    return { data: bitmap, premultiplyAlpha: hasAlphaChannel };
  }
  async loadImage(src) {
    const { premultiplyAlpha, sx, sy, sw, sh } = this.props;
    if (this.txManager.hasCreateImageBitmap === true) {
      if (isBase64Image(src) === false && this.txManager.hasWorker === true && this.txManager.imageWorkerManager !== null) {
        return this.txManager.imageWorkerManager.getImage(src, premultiplyAlpha, sx, sy, sw, sh);
      }
      let blob;
      if (isBase64Image(src) === true) {
        blob = dataURIToBlob(src);
      } else {
        blob = await fetchJson(src, "blob").then((response) => response);
      }
      return this.createImageBitmap(blob, premultiplyAlpha, sx, sy, sw, sh);
    }
    return this.loadImageFallback(src, premultiplyAlpha != null ? premultiplyAlpha : true);
  }
  async getTextureSource() {
    var _a2, _b, _c, _d, _e, _f, _g;
    let resp;
    try {
      resp = await this.determineImageTypeAndLoadImage();
    } catch (e) {
      this.setState("failed", e);
      return {
        data: null
      };
    }
    if (resp.data === null) {
      this.setState("failed", Error("ImageTexture: No image data"));
      return {
        data: null
      };
    }
    let width, height;
    if (resp.data instanceof Uint8Array) {
      width = (_a2 = this.props.width) != null ? _a2 : 0;
      height = (_b = this.props.height) != null ? _b : 0;
    } else {
      width = (_d = (_c = resp.data) == null ? void 0 : _c.width) != null ? _d : this.props.width || 0;
      height = (_f = (_e = resp.data) == null ? void 0 : _e.height) != null ? _f : this.props.height || 0;
    }
    this.setState("fetched", {
      width,
      height
    });
    return {
      data: resp.data,
      premultiplyAlpha: (_g = this.props.premultiplyAlpha) != null ? _g : true
    };
  }
  determineImageTypeAndLoadImage() {
    const { src, premultiplyAlpha, type } = this.props;
    if (src === null) {
      return {
        data: null
      };
    }
    if (typeof src !== "string") {
      if (src instanceof Blob) {
        if (this.txManager.hasCreateImageBitmap === true) {
          const { sx, sy, sw, sh } = this.props;
          return this.createImageBitmap(src, premultiplyAlpha, sx, sy, sw, sh);
        } else {
          return this.loadImageFallback(src, premultiplyAlpha != null ? premultiplyAlpha : true);
        }
      }
      if (src instanceof ImageData) {
        return {
          data: src,
          premultiplyAlpha
        };
      }
      return {
        data: src(),
        premultiplyAlpha
      };
    }
    const absoluteSrc = convertUrlToAbsolute(src);
    if (type === "regular") {
      return this.loadImage(absoluteSrc);
    }
    if (type === "svg") {
      return loadSvg(absoluteSrc, this.props.width, this.props.height, this.props.sx, this.props.sy, this.props.sw, this.props.sh);
    }
    if (isSvgImage(src) === true) {
      return loadSvg(absoluteSrc, this.props.width, this.props.height, this.props.sx, this.props.sy, this.props.sw, this.props.sh);
    }
    if (type === "compressed") {
      return loadCompressedTexture(absoluteSrc);
    }
    if (isCompressedTextureContainer(src) === true) {
      return loadCompressedTexture(absoluteSrc);
    }
    return this.loadImage(absoluteSrc);
  }
  /**
   * Generates a cache key for the ImageTexture based on the provided props.
   * @param props - The props used to generate the cache key.
   * @returns The cache key as a string, or `false` if the key cannot be generated.
   */
  static makeCacheKey(props) {
    var _a2, _b, _c;
    const resolvedProps = _ImageTexture.resolveDefaults(props);
    const key = resolvedProps.key || resolvedProps.src;
    if (typeof key !== "string") {
      return false;
    }
    let dimensionProps = "";
    if (resolvedProps.sh !== null && resolvedProps.sw !== null) {
      dimensionProps += ",";
      dimensionProps += (_a2 = resolvedProps.sx) != null ? _a2 : "";
      dimensionProps += (_b = resolvedProps.sy) != null ? _b : "";
      dimensionProps += resolvedProps.sw || "";
      dimensionProps += resolvedProps.sh || "";
    }
    return "ImageTexture,".concat(key, ",").concat((_c = resolvedProps.premultiplyAlpha) != null ? _c : "true").concat(dimensionProps);
  }
  static resolveDefaults(props) {
    var _a2, _b, _c, _d, _e, _f, _g, _h, _i, _j;
    return {
      src: (_a2 = props.src) != null ? _a2 : "",
      premultiplyAlpha: (_b = props.premultiplyAlpha) != null ? _b : true,
      // null,
      key: (_c = props.key) != null ? _c : null,
      type: (_d = props.type) != null ? _d : null,
      width: (_e = props.width) != null ? _e : null,
      height: (_f = props.height) != null ? _f : null,
      sx: (_g = props.sx) != null ? _g : null,
      sy: (_h = props.sy) != null ? _h : null,
      sw: (_i = props.sw) != null ? _i : null,
      sh: (_j = props.sh) != null ? _j : null
    };
  }
};
__publicField(_ImageTexture, "z$__type__Props");
let ImageTexture = _ImageTexture;
const _NoiseTexture = class _NoiseTexture extends Texture {
  constructor(txManager, props) {
    super(txManager);
    __publicField(this, "props");
    __publicField(this, "type", TextureType.noise);
    this.props = _NoiseTexture.resolveDefaults(props);
  }
  async getTextureSource() {
    const { width, height } = this.props;
    const size = width * height * 4;
    const pixelData8 = new Uint8ClampedArray(size);
    for (let i = 0; i < size; i += 4) {
      const v = Math.floor(Math.random() * 256);
      pixelData8[i] = v;
      pixelData8[i + 1] = v;
      pixelData8[i + 2] = v;
      pixelData8[i + 3] = 255;
    }
    this.setState("fetched");
    return {
      data: new ImageData(pixelData8, width, height)
    };
  }
  static makeCacheKey(props) {
    if (props.cacheId === void 0) {
      return false;
    }
    const resolvedProps = _NoiseTexture.resolveDefaults(props);
    return "NoiseTexture,".concat(resolvedProps.width, ",").concat(resolvedProps.height, ",").concat(resolvedProps.cacheId);
  }
  static resolveDefaults(props) {
    var _a2, _b, _c;
    return {
      width: (_a2 = props.width) != null ? _a2 : 128,
      height: (_b = props.height) != null ? _b : 128,
      cacheId: (_c = props.cacheId) != null ? _c : 0
    };
  }
};
__publicField(_NoiseTexture, "z$__type__Props");
let NoiseTexture = _NoiseTexture;
const _SubTexture = class _SubTexture extends Texture {
  constructor(txManager, props) {
    super(txManager);
    __publicField(this, "props");
    __publicField(this, "parentTexture");
    __publicField(this, "type", TextureType.subTexture);
    __publicField(this, "onParentTxLoaded", () => {
      this.forwardParentTxState("loaded", {
        width: this.props.width,
        height: this.props.height
      });
    });
    __publicField(this, "onParentTxFailed", (target, error) => {
      this.forwardParentTxState("failed", error);
    });
    __publicField(this, "onParentTxFetched", () => {
      this.forwardParentTxState("fetched", {
        width: this.props.width,
        height: this.props.height
      });
    });
    __publicField(this, "onParentTxFetching", () => {
      this.forwardParentTxState("fetching");
    });
    __publicField(this, "onParentTxLoading", () => {
      this.forwardParentTxState("loading");
    });
    __publicField(this, "onParentTxFreed", () => {
      this.forwardParentTxState("freed");
    });
    this.props = _SubTexture.resolveDefaults(props || {});
    assertTruthy(this.props.texture, "SubTexture requires a parent texture");
    assertTruthy(this.props.texture instanceof ImageTexture, "SubTexture requires an ImageTexture parent");
    this.parentTexture = txManager.resolveParentTexture(this.props.texture);
    if (this.renderableOwners.size > 0) {
      this.parentTexture.setRenderableOwner(this, true);
    }
    queueMicrotask(() => {
      const parentTx = this.parentTexture;
      if (parentTx.state === "loaded") {
        this.onParentTxLoaded(parentTx, parentTx.dimensions);
      } else if (parentTx.state === "fetching") {
        this.onParentTxFetching();
      } else if (parentTx.state === "fetched") {
        this.onParentTxFetched();
      } else if (parentTx.state === "loading") {
        this.onParentTxLoading();
      } else if (parentTx.state === "failed") {
        this.onParentTxFailed(parentTx, parentTx.error);
      } else if (parentTx.state === "freed") {
        this.onParentTxFreed();
      }
      parentTx.on("fetched", this.onParentTxFetched);
      parentTx.on("loading", this.onParentTxLoading);
      parentTx.on("fetching", this.onParentTxFetching);
      parentTx.on("loaded", this.onParentTxLoaded);
      parentTx.on("failed", this.onParentTxFailed);
      parentTx.on("freed", this.onParentTxFreed);
    });
  }
  forwardParentTxState(state, errorOrDimensions) {
    this.setState(state, errorOrDimensions);
  }
  onChangeIsRenderable(isRenderable) {
    this.parentTexture.setRenderableOwner(this, isRenderable);
  }
  async getTextureSource() {
    return new Promise((resolve, reject) => {
      this.setState("fetched");
      resolve({
        data: this.props
      });
    });
  }
  // eslint-disable-next-line @typescript-eslint/no-unused-vars
  static makeCacheKey(props) {
    return false;
  }
  static resolveDefaults(props) {
    return {
      texture: props.texture,
      x: props.x || 0,
      y: props.y || 0,
      width: props.width || 0,
      height: props.height || 0
    };
  }
};
__publicField(_SubTexture, "z$__type__Props");
let SubTexture = _SubTexture;
const _RenderTexture = class _RenderTexture extends Texture {
  constructor(txManager, props) {
    super(txManager);
    __publicField(this, "props");
    __publicField(this, "type", TextureType.renderToTexture);
    this.props = _RenderTexture.resolveDefaults(props || {});
  }
  get width() {
    return this.props.width;
  }
  set width(value) {
    this.props.width = value;
  }
  get height() {
    return this.props.height;
  }
  set height(value) {
    this.props.height = value;
  }
  async getTextureSource() {
    this.setState("fetched");
    return {
      data: null,
      premultiplyAlpha: null
    };
  }
  static resolveDefaults(props) {
    return {
      width: props.width || 256,
      height: props.height || 256
    };
  }
};
__publicField(_RenderTexture, "z$__type__Props");
let RenderTexture = _RenderTexture;
async function validateCreateImageBitmap() {
  var _a2, _b, _c;
  const pngBinaryData = new Uint8Array([
    137,
    80,
    78,
    71,
    13,
    10,
    26,
    10,
    // PNG signature
    0,
    0,
    0,
    13,
    // IHDR chunk length
    73,
    72,
    68,
    82,
    // "IHDR" chunk type
    0,
    0,
    0,
    1,
    // Width: 1
    0,
    0,
    0,
    1,
    // Height: 1
    1,
    // Bit depth: 1
    3,
    // Color type: Indexed
    0,
    // Compression method: Deflate
    0,
    // Filter method: None
    0,
    // Interlace method: None
    37,
    219,
    86,
    202,
    // CRC for IHDR
    0,
    0,
    0,
    3,
    // PLTE chunk length
    80,
    76,
    84,
    69,
    // "PLTE" chunk type
    0,
    0,
    0,
    // Palette entry: Black
    167,
    122,
    61,
    218,
    // CRC for PLTE
    0,
    0,
    0,
    1,
    // tRNS chunk length
    116,
    82,
    78,
    83,
    // "tRNS" chunk type
    0,
    // Transparency for black: Fully transparent
    64,
    230,
    216,
    102,
    // CRC for tRNS
    0,
    0,
    0,
    10,
    // IDAT chunk length
    73,
    68,
    65,
    84,
    // "IDAT" chunk type
    8,
    215,
    // Deflate header
    99,
    96,
    0,
    0,
    0,
    2,
    0,
    1,
    // Zlib-compressed data
    226,
    33,
    188,
    51,
    // CRC for IDAT
    0,
    0,
    0,
    0,
    // IEND chunk length
    73,
    69,
    78,
    68,
    // "IEND" chunk type
    174,
    66,
    96,
    130
    // CRC for IEND
  ]);
  const support = {
    basic: false,
    options: false,
    full: false
  };
  const blob = new Blob([pngBinaryData], { type: "image/png" });
  const bitmap = await createImageBitmap(blob);
  (_a2 = bitmap.close) == null ? void 0 : _a2.call(bitmap);
  support.basic = true;
  try {
    const options = { premultiplyAlpha: "none" };
    const bitmapWithOptions = await createImageBitmap(blob, options);
    (_b = bitmapWithOptions.close) == null ? void 0 : _b.call(bitmapWithOptions);
    support.options = true;
  } catch (e) {
  }
  try {
    const bitmapWithFullOptions = await createImageBitmap(blob, 0, 0, 1, 1, {
      premultiplyAlpha: "none"
    });
    (_c = bitmapWithFullOptions.close) == null ? void 0 : _c.call(bitmapWithFullOptions);
    support.full = true;
  } catch (e) {
  }
  return support;
}
class CoreTextureManager extends EventEmitter {
  constructor(stage, settings) {
    super();
    /**
     * Map of textures by cache key
     */
    __publicField(this, "keyCache", /* @__PURE__ */ new Map());
    /**
     * Map of cache keys by texture
     */
    __publicField(this, "inverseKeyCache", /* @__PURE__ */ new WeakMap());
    /**
     * Map of texture constructors by their type name
     */
    __publicField(this, "txConstructors", {});
    __publicField(this, "priorityQueue", []);
    __publicField(this, "uploadTextureQueue", []);
    __publicField(this, "initialized", false);
    __publicField(this, "stage");
    __publicField(this, "numImageWorkers");
    __publicField(this, "imageWorkerManager", null);
    __publicField(this, "hasCreateImageBitmap", !!self.createImageBitmap);
    __publicField(this, "imageBitmapSupported", {
      basic: false,
      options: false,
      full: false
    });
    __publicField(this, "hasWorker", !!self.Worker);
    /**
     * Renderer that this texture manager is associated with
     *
     * @remarks
     * This MUST be set before the texture manager is used. Otherwise errors
     * will occur when using the texture manager.
     */
    __publicField(this, "renderer");
    /**
     * The current frame time in milliseconds
     *
     * @remarks
     * This is used to populate the `lastRenderableChangeTime` property of
     * {@link Texture} instances when their renderable state changes.
     *
     * Set by stage via `updateFrameTime` method.
     */
    __publicField(this, "frameTime", 0);
    const { numImageWorkers: numImageWorkers2, createImageBitmapSupport } = settings;
    this.stage = stage;
    this.numImageWorkers = numImageWorkers2;
    if (createImageBitmapSupport === "auto") {
      validateCreateImageBitmap().then((result) => {
        this.initialize(result);
      }).catch(() => {
        console.warn("[Lightning] createImageBitmap is not supported on this browser. ImageTexture will be slower.");
        this.initialized = true;
        this.emit("initialized");
      });
    } else {
      this.initialize({
        basic: createImageBitmapSupport === "basic",
        options: createImageBitmapSupport === "options",
        full: createImageBitmapSupport === "full"
      });
    }
    this.registerTextureType("ImageTexture", ImageTexture);
    this.registerTextureType("ColorTexture", ColorTexture);
    this.registerTextureType("NoiseTexture", NoiseTexture);
    this.registerTextureType("SubTexture", SubTexture);
    this.registerTextureType("RenderTexture", RenderTexture);
  }
  registerTextureType(textureType, textureClass) {
    this.txConstructors[textureType] = textureClass;
  }
  initialize(support) {
    this.hasCreateImageBitmap = support.basic || support.options || support.full;
    this.imageBitmapSupported = support;
    if (!this.hasCreateImageBitmap) {
      console.warn("[Lightning] createImageBitmap is not supported on this browser. ImageTexture will be slower.");
    }
    if (this.hasCreateImageBitmap && this.hasWorker && this.numImageWorkers > 0) {
      this.imageWorkerManager = new ImageWorkerManager(this.numImageWorkers, support);
    } else {
      console.warn("[Lightning] Imageworker is 0 or not supported on this browser. Image loading will be slower.");
    }
    this.initialized = true;
    this.emit("initialized");
  }
  /**
   * Enqueue a texture for uploading to the GPU.
   *
   * @param texture - The texture to upload
   */
  enqueueUploadTexture(texture) {
    if (this.uploadTextureQueue.includes(texture) === false) {
      this.uploadTextureQueue.push(texture);
    }
  }
  /**
   * Create a texture
   *
   * @param textureType - The type of texture to create
   * @param props - The properties to use for the texture
   */
  createTexture(textureType, props) {
    let texture;
    const TextureClass = this.txConstructors[textureType];
    if (!TextureClass) {
      throw new Error('Texture type "'.concat(textureType, '" is not registered'));
    }
    const cacheKey = TextureClass.makeCacheKey(props);
    if (cacheKey && this.keyCache.has(cacheKey)) {
      texture = this.keyCache.get(cacheKey);
    } else {
      texture = new TextureClass(this, props);
      if (cacheKey) {
        this.initTextureToCache(texture, cacheKey);
      }
    }
    return texture;
  }
  orphanTexture(texture) {
    this.removeTextureFromQueue(texture);
    if (texture.type === TextureType.subTexture) {
      return;
    }
    this.stage.txMemManager.addToOrphanedTextures(texture);
  }
  /**
   * Override loadTexture to use the batched approach.
   *
   * @param texture - The texture to load
   * @param immediate - Whether to prioritize the texture for immediate loading
   */
  loadTexture(texture, priority) {
    this.stage.txMemManager.removeFromOrphanedTextures(texture);
    if (texture.type === TextureType.subTexture) {
      return;
    }
    if (texture.state === "loaded") {
      return;
    }
    if (Texture.TRANSITIONAL_TEXTURE_STATES.includes(texture.state)) {
      return;
    }
    if (this.initialized === false) {
      this.priorityQueue.push(texture);
      return;
    }
    if (texture.state === "failed") {
      texture.free();
      texture.freeTextureData();
    }
    texture.setState("loading");
    texture.getTextureData().then(() => {
      if (texture.state !== "fetched") {
        texture.setState("failed");
        return;
      }
      if (texture.type !== TextureType.image) {
        this.uploadTexture(texture).catch((err) => {
          console.error("Failed to upload non-image texture:", err);
          texture.setState("failed");
        });
      } else {
        if (priority === true) {
          this.uploadTexture(texture).catch((err) => {
            console.error("Failed to upload priority texture:", err);
            texture.setState("failed");
          });
        } else {
          this.enqueueUploadTexture(texture);
        }
      }
    }).catch((err) => {
      console.error(err);
      texture.setState("failed");
    });
  }
  /**
   * Upload a texture to the GPU
   *
   * @param texture Texture to upload
   * @returns Promise that resolves when the texture is fully loaded
   */
  async uploadTexture(texture) {
    if (this.stage.txMemManager.doNotExceedCriticalThreshold === true && this.stage.txMemManager.criticalCleanupRequested === true) {
      this.enqueueUploadTexture(texture);
      return;
    }
    const coreContext = texture.loadCtxTexture();
    if (coreContext !== null && coreContext.state === "loaded") {
      texture.setState("loaded");
      return;
    }
    await coreContext.load();
  }
  /**
   * Check if a texture is being processed
   */
  isProcessingTexture(texture) {
    return this.uploadTextureQueue.includes(texture) === true;
  }
  /**
   * Process a limited number of uploads.
   *
   * @param maxProcessingTime - The maximum processing time in milliseconds
   */
  async processSome(maxProcessingTime) {
    if (this.initialized === false) {
      return;
    }
    const startTime = getTimeStamp();
    while (this.priorityQueue.length > 0 && getTimeStamp() - startTime < maxProcessingTime) {
      const texture = this.priorityQueue.pop();
      try {
        await texture.getTextureData();
        await this.uploadTexture(texture);
      } catch (error) {
        console.error("Failed to process priority texture:", error);
      }
    }
    while (this.uploadTextureQueue.length > 0 && getTimeStamp() - startTime < maxProcessingTime) {
      const texture = this.uploadTextureQueue.shift();
      try {
        await this.uploadTexture(texture);
      } catch (error) {
        console.error("Failed to upload texture:", error);
      }
    }
  }
  hasUpdates() {
    return this.uploadTextureQueue.length > 0;
  }
  /**
   * Initialize a texture to the cache
   *
   * @param texture Texture to cache
   * @param cacheKey Cache key for the texture
   */
  initTextureToCache(texture, cacheKey) {
    const { keyCache, inverseKeyCache } = this;
    keyCache.set(cacheKey, texture);
    inverseKeyCache.set(texture, cacheKey);
  }
  /**
   * Get a texture from the cache
   *
   * @param cacheKey
   */
  getTextureFromCache(cacheKey) {
    return this.keyCache.get(cacheKey);
  }
  /**
   * Remove a texture from the cache
   *
   * @remarks
   * Called by Texture Cleanup when a texture is freed.
   *
   * @param texture
   */
  removeTextureFromCache(texture) {
    const { inverseKeyCache, keyCache } = this;
    const cacheKey = inverseKeyCache.get(texture);
    if (cacheKey) {
      keyCache.delete(cacheKey);
    }
  }
  /**
   * Remove texture from the upload queue
   *
   * @param texture - The texture to remove
   */
  removeTextureFromQueue(texture) {
    const uploadIndex = this.uploadTextureQueue.indexOf(texture);
    if (uploadIndex !== -1) {
      this.uploadTextureQueue.splice(uploadIndex, 1);
    }
  }
  /**
   * Resolve a parent texture from the cache or fallback to the provided texture.
   *
   * @param texture - The provided texture to resolve.
   * @returns The cached or provided texture.
   */
  resolveParentTexture(texture) {
    if (!(texture == null ? void 0 : texture.props)) {
      return texture;
    }
    const cacheKey = ImageTexture.makeCacheKey(texture.props);
    const cachedTexture = cacheKey ? this.getTextureFromCache(cacheKey) : void 0;
    return cachedTexture != null ? cachedTexture : texture;
  }
}
const weightConversions = {
  normal: 400,
  bold: 700,
  bolder: 900,
  lighter: 100
};
const fontWeightToNumber = (weight) => {
  if (typeof weight === "number") {
    return weight;
  }
  return weightConversions[weight] || 400;
};
function resolveFontToUse(familyMapsByPriority, family, weightIn, style, stretch) {
  let weight = fontWeightToNumber(weightIn);
  for (const fontFamiles of familyMapsByPriority) {
    const fontFaces = fontFamiles[family];
    if (!fontFaces) {
      continue;
    }
    if (fontFaces.size === 1) {
      console.warn("TrFontManager: Only one font face found for family: '".concat(family, "' - will be used for all weights and styles"));
      return fontFaces.values().next().value;
    }
    const weightMap = /* @__PURE__ */ new Map();
    for (const fontFace of fontFaces) {
      const fontFamilyWeight = fontWeightToNumber(fontFace.descriptors.weight);
      if (fontFamilyWeight === weight && fontFace.descriptors.style === style && fontFace.descriptors.stretch === stretch) {
        return fontFace;
      }
      weightMap.set(fontFamilyWeight, fontFace);
    }
    const msg = "TrFontManager: No exact match: '".concat(family, " Weight: ").concat(weight, " Style: ").concat(style, " Stretch: ").concat(stretch, "'");
    console.error(msg);
    if (weight === 400 && weightMap.has(500)) {
      return weightMap.get(500);
    }
    if (weight === 500 && weightMap.has(400)) {
      return weightMap.get(400);
    }
    if (weight < 400) {
      while (weight > 0) {
        if (weightMap.has(weight)) {
          return weightMap.get(weight);
        }
        weight -= 100;
      }
      weight = 600;
    }
    while (weight < 1e3) {
      if (weightMap.has(weight)) {
        return weightMap.get(weight);
      }
      weight += 100;
    }
    weight = 500;
    while (weight > 0) {
      if (weightMap.has(weight)) {
        return weightMap.get(weight);
      }
      weight -= 100;
    }
  }
  return;
}
class TrFontManager {
  constructor(textRenderers) {
    __publicField(this, "textRenderers");
    __publicField(this, "fontCache", /* @__PURE__ */ new Map());
    this.textRenderers = textRenderers;
  }
  addFontFace(font) {
    for (const trId in this.textRenderers) {
      const tr = this.textRenderers[trId];
      if (tr && tr.isFontFaceSupported(font)) {
        tr.addFontFace(font);
      }
    }
  }
  /**
   * Utility method to resolve a single font face from a list of prioritized family maps based on
   * a set of font properties.
   *
   * @remarks
   * These are to be used by a text renderer to resolve a font face if needed.
   *
   * @param familyMapsByPriority
   * @param props
   * @returns
   */
  resolveFontFace(familyMapsByPriority, props, rendererType) {
    const { fontFamily, fontWeight, fontStyle, fontStretch } = props;
    const fontCacheString = "".concat(rendererType, "_").concat(fontFamily, "_").concat(fontStyle, "_").concat(fontWeight, "_").concat(fontStretch);
    if (this.fontCache.has(fontCacheString) === true) {
      return this.fontCache.get(fontCacheString);
    }
    const resolvedFont = resolveFontToUse(familyMapsByPriority, fontFamily, fontWeight, fontStyle, fontStretch);
    if (resolvedFont !== void 0) {
      this.fontCache.set(fontCacheString, resolvedFont);
    }
    return resolvedFont;
  }
}
class CoreShader {
  // abstract draw(): void;
  static makeCacheKey(props) {
    return false;
  }
  static resolveDefaults(props) {
    return {};
  }
}
function createShader(glw, type, source) {
  const shader = glw.createShader(type);
  if (!shader) {
    const glError = glw.getError();
    throw new Error("Unable to create the shader: ".concat(type === glw.VERTEX_SHADER ? "VERTEX_SHADER" : "FRAGMENT_SHADER", ".").concat(glError ? " WebGlContext Error: ".concat(glError) : ""));
  }
  glw.shaderSource(shader, source);
  glw.compileShader(shader);
  const success = !!glw.getShaderParameter(shader, glw.COMPILE_STATUS);
  if (success) {
    return shader;
  }
  console.error(glw.getShaderInfoLog(shader));
  glw.deleteShader(shader);
}
function createProgram(glw, vertexShader, fragmentShader) {
  const program = glw.createProgram();
  if (!program) {
    throw new Error("Unable to create program");
  }
  glw.attachShader(program, vertexShader);
  glw.attachShader(program, fragmentShader);
  glw.linkProgram(program);
  const success = !!glw.getProgramParameter(program, glw.LINK_STATUS);
  if (success) {
    return program;
  }
  console.warn(glw.getProgramInfoLog(program));
  glw.deleteProgram(program);
  return void 0;
}
class WebGlCoreShader extends CoreShader {
  constructor(options) {
    super();
    __publicField(this, "boundBufferCollection", null);
    __publicField(this, "buffersBound", false);
    __publicField(this, "program");
    /**
     * Vertex Array Object
     *
     * @remarks
     * Used by WebGL2 Only
     */
    __publicField(this, "vao");
    __publicField(this, "renderer");
    __publicField(this, "glw");
    __publicField(this, "attributeBuffers");
    __publicField(this, "attributeLocations");
    __publicField(this, "attributeNames");
    __publicField(this, "uniformLocations");
    __publicField(this, "uniformTypes");
    __publicField(this, "supportsIndexedTextures");
    const renderer2 = this.renderer = options.renderer;
    const glw = this.glw = this.renderer.glw;
    this.supportsIndexedTextures = options.supportsIndexedTextures || false;
    const webGl2 = glw.isWebGl2();
    const requiredExtensions = webGl2 && options.webgl2Extensions || !webGl2 && options.webgl1Extensions || [];
    const glVersion = webGl2 ? "2.0" : "1.0";
    requiredExtensions.forEach((extensionName) => {
      if (!glw.getExtension(extensionName)) {
        throw new Error('Shader "'.concat(this.constructor.name, '" requires extension "').concat(extensionName, '" for WebGL ').concat(glVersion, " but wasn't found"));
      }
    });
    const shaderSources = options.shaderSources || this.constructor.shaderSources;
    if (!shaderSources) {
      throw new Error('Shader "'.concat(this.constructor.name, '" is missing shaderSources.'));
    } else if (webGl2 && (shaderSources == null ? void 0 : shaderSources.webGl2)) {
      shaderSources.fragment = shaderSources.webGl2.fragment;
      shaderSources.vertex = shaderSources.webGl2.vertex;
      delete shaderSources.webGl2;
    }
    const textureUnits = renderer2.system.parameters.MAX_VERTEX_TEXTURE_IMAGE_UNITS;
    const vertexSource = shaderSources.vertex instanceof Function ? shaderSources.vertex(textureUnits) : shaderSources.vertex;
    const fragmentSource = shaderSources.fragment instanceof Function ? shaderSources.fragment(textureUnits) : shaderSources.fragment;
    const vertexShader = createShader(glw, glw.VERTEX_SHADER, vertexSource);
    const fragmentShader = createShader(glw, glw.FRAGMENT_SHADER, fragmentSource);
    if (!vertexShader || !fragmentShader) {
      throw new Error("Unable to create the following shader(s): ".concat([
        !vertexShader && "VERTEX_SHADER",
        !fragmentShader && "FRAGMENT_SHADER"
      ].filter(Boolean).join(" and ")));
    }
    const program = createProgram(glw, vertexShader, fragmentShader);
    if (!program) {
      throw new Error("Unable to create program");
    }
    this.program = program;
    this.attributeLocations = {};
    this.attributeBuffers = {};
    this.attributeNames = [];
    [...options.attributes].forEach((attributeName) => {
      const location2 = glw.getAttribLocation(this.program, attributeName);
      if (location2 < 0) {
        throw new Error("".concat(this.constructor.name, ': Vertex shader must have an attribute "').concat(attributeName, '"!'));
      }
      const buffer = glw.createBuffer();
      if (!buffer) {
        throw new Error("".concat(this.constructor.name, ': Could not create buffer for attribute "').concat(attributeName, '"'));
      }
      this.attributeLocations[attributeName] = location2;
      this.attributeBuffers[attributeName] = buffer;
      this.attributeNames.push(attributeName);
    });
    this.uniformLocations = {};
    this.uniformTypes = {};
    options.uniforms.forEach((uniform) => {
      const location2 = glw.getUniformLocation(this.program, uniform.name);
      this.uniformTypes[uniform.name] = uniform.uniform;
      if (!location2) {
        console.warn('Shader "'.concat(this.constructor.name, '" could not get uniform location for "').concat(uniform.name, '"'));
        return;
      }
      this.uniformLocations[uniform.name] = location2;
    });
  }
  bindBufferAttribute(location2, buffer, attribute) {
    const { glw } = this;
    glw.enableVertexAttribArray(location2);
    glw.vertexAttribPointer(buffer, location2, attribute.size, attribute.type, attribute.normalized, attribute.stride, attribute.offset);
  }
  disableAttribute(location2) {
    this.glw.disableVertexAttribArray(location2);
  }
  disableAttributes() {
    for (const loc in this.attributeLocations) {
      this.disableAttribute(this.attributeLocations[loc]);
    }
    this.boundBufferCollection = null;
  }
  /**
   * Given two sets of Shader props destined for this Shader, determine if they can be batched together
   * to reduce the number of draw calls.
   *
   * @remarks
   * This is used by the {@link WebGlCoreRenderer} to determine if it can batch multiple consecutive draw
   * calls into a single draw call.
   *
   * By default, this returns false (meaning no batching is allowed), but can be
   * overridden by child classes to provide more efficient batching.
   *
   * @param propsA
   * @param propsB
   * @returns
   */
  canBatchShaderProps(propsA, propsB) {
    return false;
  }
  bindRenderOp(renderOp, props) {
    var _a2;
    this.bindBufferCollection(renderOp.buffers);
    if (renderOp.textures.length > 0 && ((_a2 = renderOp.textures[0]) == null ? void 0 : _a2.ctxTexture)) {
      this.bindTextures(renderOp.textures);
    }
    const { glw, parentHasRenderTexture, renderToTexture } = renderOp;
    if (renderToTexture && parentHasRenderTexture) {
      return;
    }
    if (parentHasRenderTexture) {
      const { width, height } = renderOp.framebufferDimensions || {};
      glw.uniform1f(this.getUniformLocation("u_pixelRatio"), 1);
      glw.uniform2f(this.getUniformLocation("u_resolution"), width != null ? width : 0, height != null ? height : 0);
    } else {
      glw.uniform1f(this.getUniformLocation("u_pixelRatio"), renderOp.options.pixelRatio);
      glw.uniform2f(this.getUniformLocation("u_resolution"), glw.canvas.width, glw.canvas.height);
    }
    if (props) {
      if (hasOwn(props, "$dimensions")) {
        let dimensions = props.$dimensions;
        if (!dimensions) {
          dimensions = renderOp.dimensions;
        }
        glw.uniform2f(this.getUniformLocation("u_dimensions"), dimensions.width, dimensions.height);
      }
      if (hasOwn(props, "$alpha")) {
        let alpha = props.$alpha;
        if (!alpha) {
          alpha = renderOp.alpha;
        }
        glw.uniform1f(this.getUniformLocation("u_alpha"), alpha);
      }
      this.bindProps(props);
    }
  }
  getUniformLocation(name) {
    return this.uniformLocations[name] || null;
  }
  bindBufferCollection(buffer) {
    if (this.boundBufferCollection === buffer) {
      return;
    }
    for (const attributeName in this.attributeLocations) {
      const resolvedBuffer = buffer.getBuffer(attributeName);
      const resolvedInfo = buffer.getAttributeInfo(attributeName);
      assertTruthy(resolvedBuffer, 'Buffer for "'.concat(attributeName, '" not found'));
      assertTruthy(resolvedInfo);
      this.bindBufferAttribute(this.attributeLocations[attributeName], resolvedBuffer, resolvedInfo);
    }
    this.boundBufferCollection = buffer;
  }
  bindProps(props) {
  }
  bindTextures(textures) {
  }
  attach() {
    this.glw.useProgram(this.program);
    if (this.glw.isWebGl2() && this.vao) {
      this.glw.bindVertexArray(this.vao);
    }
  }
  detach() {
    this.disableAttributes();
  }
}
__publicField(WebGlCoreShader, "shaderSources");
class DefaultShader extends WebGlCoreShader {
  constructor(renderer2) {
    super({
      renderer: renderer2,
      attributes: ["a_position", "a_textureCoordinate", "a_color"],
      uniforms: [
        { name: "u_resolution", uniform: "uniform2fv" },
        { name: "u_pixelRatio", uniform: "uniform1f" },
        { name: "u_texture", uniform: "uniform2fv" }
      ]
    });
  }
  bindTextures(textures) {
    const { glw } = this;
    glw.activeTexture(0);
    glw.bindTexture(textures[0].ctxTexture);
  }
}
__publicField(DefaultShader, "shaderSources", {
  vertex: "\n      # ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n      # else\n      precision mediump float;\n      # endif\n\n      attribute vec2 a_position;\n      attribute vec2 a_textureCoordinate;\n      attribute vec4 a_color;\n\n      uniform vec2 u_resolution;\n      uniform float u_pixelRatio;\n\n\n      varying vec4 v_color;\n      varying vec2 v_textureCoordinate;\n\n      void main() {\n        vec2 normalized = a_position * u_pixelRatio;\n        vec2 screenSpace = vec2(2.0 / u_resolution.x, -2.0 / u_resolution.y);\n\n        v_color = a_color;\n        v_textureCoordinate = a_textureCoordinate;\n\n        gl_Position = vec4(normalized.x * screenSpace.x - 1.0, normalized.y * -abs(screenSpace.y) + 1.0, 0.0, 1.0);\n        gl_Position.y = -sign(screenSpace.y) * gl_Position.y;\n      }\n    ",
  fragment: "\n      # ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n      # else\n      precision mediump float;\n      # endif\n\n      uniform vec2 u_resolution;\n      uniform sampler2D u_texture;\n\n      varying vec4 v_color;\n      varying vec2 v_textureCoordinate;\n\n      void main() {\n          vec4 color = texture2D(u_texture, v_textureCoordinate);\n          gl_FragColor = vec4(v_color) * texture2D(u_texture, v_textureCoordinate);\n      }\n    "
});
class DefaultShaderBatched extends WebGlCoreShader {
  constructor(renderer2) {
    super({
      renderer: renderer2,
      attributes: [
        "a_position",
        "a_textureCoordinate",
        "a_color",
        "a_textureIndex"
      ],
      uniforms: [
        { name: "u_resolution", uniform: "uniform2fv" },
        { name: "u_pixelRatio", uniform: "uniform1f" },
        { name: "u_textures[0]", uniform: "uniform1iv" }
      ]
    });
    __publicField(this, "supportsIndexedTextures", true);
  }
  bindTextures(texture) {
    const { renderer: renderer2, glw } = this;
    if (texture.length > renderer2.system.parameters.MAX_VERTEX_TEXTURE_IMAGE_UNITS) {
      throw new Error("DefaultShaderBatched: Cannot bind more than ".concat(renderer2.system.parameters.MAX_VERTEX_TEXTURE_IMAGE_UNITS, " textures"));
    }
    texture.forEach((t, i) => {
      glw.activeTexture(i);
      glw.bindTexture(t.ctxTexture);
    });
    const samplers = Array.from(Array(texture.length).keys());
    this.glw.uniform1iv(this.getUniformLocation("u_textures[0]"), samplers);
  }
}
__publicField(DefaultShaderBatched, "shaderSources", {
  vertex: "\n      # ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n      # else\n      precision mediump float;\n      # endif\n\n      attribute vec2 a_textureCoordinate;\n      attribute vec2 a_position;\n      attribute vec4 a_color;\n      attribute float a_textureIndex;\n      attribute float a_depth;\n\n      uniform vec2 u_resolution;\n      uniform float u_pixelRatio;\n\n      varying vec4 v_color;\n      varying vec2 v_textureCoordinate;\n      varying float v_textureIndex;\n\n      void main(){\n        vec2 normalized = a_position * u_pixelRatio / u_resolution;\n        vec2 zero_two = normalized * 2.0;\n        vec2 clip_space = zero_two - 1.0;\n\n        // pass to fragment\n        v_color = a_color;\n        v_textureCoordinate = a_textureCoordinate;\n        v_textureIndex = a_textureIndex;\n\n        // flip y\n        gl_Position = vec4(clip_space * vec2(1.0, -1.0), 0, 1);\n      }\n    ",
  fragment: (textureUnits) => "\n      #define txUnits ".concat(textureUnits, "\n      # ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n      # else\n      precision mediump float;\n      # endif\n\n      uniform vec2 u_resolution;\n      uniform sampler2D u_image;\n      uniform sampler2D u_textures[txUnits];\n\n      varying vec4 v_color;\n      varying vec2 v_textureCoordinate;\n      varying float v_textureIndex;\n\n      vec4 sampleFromTexture(sampler2D textures[").concat(textureUnits, "], int idx, vec2 uv) {\n        ").concat(Array.from(Array(textureUnits).keys()).map((idx) => "\n          ".concat(idx !== 0 ? "else " : "", "if (idx == ").concat(idx, ") {\n            return texture2D(textures[").concat(idx, "], uv);\n          }\n        ")).join(""), "\n        return texture2D(textures[0], uv);\n      }\n\n      void main(){\n        gl_FragColor = vec4(v_color) * sampleFromTexture(u_textures, int(v_textureIndex), v_textureCoordinate);\n      }\n    ")
});
class ShaderEffect {
  constructor(options) {
    __publicField(this, "priority", 1);
    __publicField(this, "name", "");
    __publicField(this, "ref");
    __publicField(this, "target");
    __publicField(this, "passParameters", "");
    __publicField(this, "declaredUniforms", "");
    __publicField(this, "uniformInfo", {});
    const { ref, target, props = {} } = options;
    this.ref = ref;
    this.target = target;
    const uniformInfo = {};
    const passParameters = [];
    let declaredUniforms = "";
    const uniforms = this.constructor.uniforms || {};
    for (const u in uniforms) {
      const unif = uniforms[u];
      const uniType = unif.type;
      const uniformName = "".concat(ref, "_").concat(u);
      let define = "";
      if (unif.size) {
        define = "[".concat(unif.size(props), "]");
      }
      passParameters.push(uniformName);
      declaredUniforms += "uniform ".concat(uniType, " ").concat(uniformName).concat(define, ";");
      uniformInfo[u] = { name: uniformName, uniform: uniforms[u].method };
    }
    this.passParameters = passParameters.join(",");
    this.declaredUniforms = declaredUniforms;
    this.uniformInfo = uniformInfo;
  }
  static getEffectKey(props) {
    return "";
  }
  static getMethodParameters(uniforms, props) {
    const res = [];
    for (const u in uniforms) {
      const uni = uniforms[u];
      let define = "";
      if (uni.size) {
        define = "[".concat(uni.size(props), "]");
      }
      res.push("".concat(uni.type, " ").concat(u).concat(define));
    }
    return res.join(",");
  }
  static resolveDefaults(props) {
    return {};
  }
  static makeEffectKey(props) {
    return false;
  }
}
__publicField(ShaderEffect, "uniforms", {});
__publicField(ShaderEffect, "methods");
__publicField(ShaderEffect, "onShaderMask");
__publicField(ShaderEffect, "onColorize");
__publicField(ShaderEffect, "onEffectMask");
const effectCache = /* @__PURE__ */ new Map();
const getResolvedEffect = (effects, effectContructors) => {
  const key = JSON.stringify(effects);
  if (effectCache.has(key)) {
    return effectCache.get(key);
  }
  effects = effects != null ? effects : [];
  const resolvedEffects = [];
  const effectsLength = effects.length;
  let i = 0;
  for (; i < effectsLength; i++) {
    const { name, type, props } = effects[i];
    const resolvedEffect = {
      name,
      type,
      props: {}
    };
    const effectConstructor = effectContructors[type];
    const defaultPropValues = effectConstructor.resolveDefaults(props);
    const uniforms = effectConstructor.uniforms;
    const uniformKeys = Object.keys(uniforms);
    const uniformsLength = uniformKeys.length;
    let j = 0;
    for (; j < uniformsLength; j++) {
      const key2 = uniformKeys[j];
      const uniform = uniforms[key2];
      const result = {
        value: defaultPropValues[key2],
        programValue: void 0,
        method: uniform.method,
        updateOnBind: uniform.updateOnBind || false,
        hasValidator: uniform.validator !== void 0,
        hasProgramValueUpdater: uniform.updateProgramValue !== void 0
      };
      const validatedValue = result.hasValidator && uniform.validator(defaultPropValues[key2], defaultPropValues) || defaultPropValues[key2];
      if (defaultPropValues[key2] !== validatedValue) {
        result.validatedValue = validatedValue;
      }
      if (result.hasProgramValueUpdater) {
        uniform.updateProgramValue(result);
      }
      if (result.programValue === void 0) {
        result.programValue = result.value;
      }
      resolvedEffect.props[key2] = result;
    }
    resolvedEffects.push(resolvedEffect);
  }
  effectCache.set(key, resolvedEffects);
  return resolvedEffects;
};
const _DynamicShader = class _DynamicShader extends WebGlCoreShader {
  constructor(renderer2, props, effectContructors) {
    const shader = _DynamicShader.createShader(props, effectContructors);
    super({
      renderer: renderer2,
      attributes: ["a_position", "a_textureCoordinate", "a_color"],
      uniforms: [
        { name: "u_resolution", uniform: "uniform2fv" },
        { name: "u_pixelRatio", uniform: "uniform1f" },
        { name: "u_texture", uniform: "uniform2fv" },
        { name: "u_dimensions", uniform: "uniform2fv" },
        { name: "u_alpha", uniform: "uniform1f" },
        ...shader.uniforms
      ],
      shaderSources: {
        vertex: shader.vertex,
        fragment: shader.fragment
      }
    });
    __publicField(this, "effects", []);
    this.effects = shader.effects;
  }
  bindTextures(textures) {
    const { glw } = this;
    glw.activeTexture(0);
    glw.bindTexture(textures[0].ctxTexture);
  }
  bindUniformMethods(props) {
    const glw = this.glw;
    const effects = props.effects;
    const effectsL = effects.length;
    for (let i = 0; i < effectsL; i++) {
      const uniformInfo = this.effects[i].uniformInfo;
      const effect2 = effects[i];
      const propKeys = Object.keys(effect2.props);
      const propsLength = propKeys.length;
      for (let j = 0; j < propsLength; j++) {
        const key = propKeys[j];
        const method = effect2.props[key].method;
        const location2 = this.getUniformLocation(uniformInfo[key].name);
        if (method === "uniform2fv" || method === "uniform2iv" || //uniform === 'uniform3fv	' || <--- check why this isnt recognized
        method === "uniform3iv" || method === "uniform4fv" || method === "uniform4iv" || method === "uniformMatrix2fv" || method === "uniformMatrix3fv" || method === "uniformMatrix4fv" || method === "uniform1f" || method === "uniform1fv" || method === "uniform1i" || method === "uniform1iv") {
          effect2.props[key].setUniformValue = function() {
            glw[method](location2, this.programValue);
          };
          continue;
        }
        if (method === "uniform2f" || method === "uniform2i") {
          effect2.props[key].setUniformValue = function() {
            glw[method](location2, this.programValue[0], this.programValue[1]);
          };
          continue;
        }
        if (method === "uniform3f" || method === "uniform3i") {
          effect2.props[key].setUniformValue = function() {
            glw[method](location2, this.programValue[0], this.programValue[1], this.programValue[2]);
          };
          continue;
        }
        if (method === "uniform4f" || method === "uniform4i") {
          effect2.props[key].setUniformValue = function() {
            glw[method](location2, this.programValue[0], this.programValue[1], this.programValue[2], this.programValue[3]);
          };
          continue;
        }
      }
    }
  }
  bindProps(props) {
    var _a2;
    const effects = props.effects;
    const effectsL = effects.length;
    let i = 0;
    for (; i < effectsL; i++) {
      const effect2 = effects[i];
      const propKeys = Object.keys(effect2.props);
      const propsLength = propKeys.length;
      let j = 0;
      for (; j < propsLength; j++) {
        const key = propKeys[j];
        const prop = effect2.props[key];
        if (prop.updateOnBind === true) {
          const uniform = (_a2 = this.renderer.shManager.getRegisteredEffects()[effect2.type]) == null ? void 0 : _a2.uniforms[key];
          uniform == null ? void 0 : uniform.updateProgramValue(effect2.props[key], props);
        }
        prop.setUniformValue();
      }
    }
  }
  canBatchShaderProps(propsA, propsB) {
    if (propsA.$alpha !== propsB.$alpha || propsA.$dimensions.width !== propsB.$dimensions.width || propsA.$dimensions.height !== propsB.$dimensions.height || propsA.effects.length !== propsB.effects.length) {
      return false;
    }
    const propsEffectsLen = propsA.effects.length;
    let i = 0;
    for (; i < propsEffectsLen; i++) {
      const effectA = propsA.effects[i];
      const effectB = propsB.effects[i];
      if (effectA.type !== effectB.type) {
        return false;
      }
      for (const key in effectA.props) {
        if (effectB.props && !effectB.props[key] || effectA.props[key].value !== effectB.props[key].value) {
          return false;
        }
      }
    }
    return true;
  }
  static createShader(props, effectContructors) {
    const effectNameCount = {};
    const methods = {};
    let declareUniforms = "";
    const uniforms = [];
    const uFx = [];
    const effects = props.effects.map((effect2) => {
      const baseClass = effectContructors[effect2.type];
      const key = baseClass.getEffectKey(effect2.props || {});
      effectNameCount[key] = effectNameCount[key] ? ++effectNameCount[key] : 1;
      const nr = effectNameCount[key];
      if (nr === 1) {
        uFx.push({ key, type: effect2.type, props: effect2.props });
      }
      const fxClass = new baseClass({
        ref: "".concat(key).concat(nr === 1 ? "" : nr),
        target: key,
        props: effect2.props
      });
      declareUniforms += fxClass.declaredUniforms;
      uniforms.push(...Object.values(fxClass.uniformInfo));
      return fxClass;
    });
    let effectMethods = "";
    uFx == null ? void 0 : uFx.forEach((fx) => {
      var _a2;
      const fxClass = effectContructors[fx.type];
      const fxProps = fxClass.resolveDefaults((_a2 = fx.props) != null ? _a2 : {});
      const remap = [];
      for (const m in fxClass.methods) {
        let cm = m;
        const fxMethod = fxClass.methods[m];
        if (methods[m] && methods[m] !== fxMethod) {
          cm = _DynamicShader.resolveMethodDuplicate(m, fxMethod, methods);
        }
        methods[cm] = fxMethod.replace("function", cm);
        remap.push({ m, cm });
      }
      let onShaderMask = fxClass.onShaderMask instanceof Function ? fxClass.onShaderMask(fxProps) : fxClass.onShaderMask;
      let onColorize = fxClass.onColorize instanceof Function ? fxClass.onColorize(fxProps) : fxClass.onColorize;
      let onEffectMask = fxClass.onEffectMask instanceof Function ? fxClass.onEffectMask(fxProps) : fxClass.onEffectMask;
      remap.forEach((r) => {
        const { m, cm } = r;
        const reg = new RegExp("\\$".concat(m), "g");
        if (onShaderMask) {
          onShaderMask = onShaderMask.replace(reg, cm);
        }
        if (onColorize) {
          onColorize = onColorize.replace(reg, cm);
        }
        if (onEffectMask) {
          onEffectMask = onEffectMask.replace(reg, cm);
        }
      });
      const methodParameters = fxClass.getMethodParameters(fxClass.uniforms, fxProps);
      const pm = methodParameters.length > 0 ? ", ".concat(methodParameters) : "";
      if (onShaderMask) {
        effectMethods += "\n        float fx_".concat(fx.key, "_onShaderMask(float shaderMask ").concat(pm, ") {\n          ").concat(onShaderMask, "\n        }\n        ");
      }
      if (onColorize) {
        effectMethods += "\n          vec4 fx_".concat(fx.key, "_onColorize(float shaderMask, vec4 maskColor, vec4 shaderColor").concat(pm, ") {\n            ").concat(onColorize, "\n          }\n        ");
      }
      if (onEffectMask) {
        effectMethods += "\n          vec4 fx_".concat(fx.key, "_onEffectMask(float shaderMask, vec4 maskColor, vec4 shaderColor").concat(pm, ") {\n            ").concat(onEffectMask, "\n          }\n        ");
      }
    });
    let sharedMethods = "";
    for (const m in methods) {
      sharedMethods += methods[m];
    }
    let currentMask = "mix(shaderColor, maskColor, clamp(-(lng_DefaultMask), 0.0, 1.0))";
    let drawEffects = "\n\n    ";
    for (let i = 0; i < effects.length; i++) {
      const current = effects[i];
      const pm = current.passParameters.length > 0 ? ", ".concat(current.passParameters) : "";
      const currentClass = effectContructors[current.name];
      if (currentClass.onShaderMask) {
        drawEffects += "\n        shaderMask = fx_".concat(current.target, "_onShaderMask(shaderMask ").concat(pm, ");\n        ");
      }
      if (currentClass.onColorize) {
        drawEffects += "\n        maskColor = fx_".concat(current.target, "_onColorize(shaderMask, maskColor, shaderColor").concat(pm, ");\n        ");
      }
      if (currentClass.onEffectMask) {
        currentMask = "fx_".concat(current.target, "_onEffectMask(shaderMask, maskColor, shaderColor").concat(pm, ")");
      }
      const next = effects[i + 1];
      if (next === void 0 || effectContructors[next.name].onEffectMask) {
        drawEffects += "\n          shaderColor = ".concat(currentMask, ";\n        ");
      }
    }
    return {
      effects,
      uniforms,
      fragment: _DynamicShader.fragment(declareUniforms, sharedMethods, effectMethods, drawEffects),
      vertex: _DynamicShader.vertex()
    };
  }
  static resolveMethodDuplicate(key, effectMethod, methodCollection, increment = 0) {
    const m = key + (increment > 0 ? increment : "");
    if (methodCollection[m] && methodCollection[m] !== effectMethod) {
      return this.resolveMethodDuplicate(key, effectMethod, methodCollection, ++increment);
    }
    return m;
  }
  static resolveDefaults(props, effectContructors) {
    var _a2;
    assertTruthy(effectContructors);
    return {
      effects: getResolvedEffect((_a2 = props.effects) != null ? _a2 : [], effectContructors),
      $dimensions: {
        width: 0,
        height: 0
      },
      $alpha: 0
    };
  }
  static makeCacheKey(props, effectContructors) {
    var _a2;
    let fx = "";
    (_a2 = props.effects) == null ? void 0 : _a2.forEach((effect2) => {
      const baseClass = effectContructors[effect2.type];
      const key = baseClass.getEffectKey(effect2.props || {});
      fx += ",".concat(key);
    });
    return "DynamicShader".concat(fx);
  }
};
__publicField(_DynamicShader, "z$__type__Props");
__publicField(_DynamicShader, "vertex", () => "\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision mediump float;\n    # endif\n\n    attribute vec2 a_textureCoordinate;\n    attribute vec2 a_position;\n    attribute vec4 a_color;\n    attribute float a_textureIndex;\n\n    uniform vec2 u_resolution;\n    uniform float u_pixelRatio;\n\n    varying vec4 v_color;\n    varying vec2 v_textureCoordinate;\n    varying float v_textureIndex;\n\n    void main(){\n      vec2 normalized = a_position * u_pixelRatio / u_resolution;\n      vec2 zero_two = normalized * 2.0;\n      vec2 clip_space = zero_two - 1.0;\n\n      // pass to fragment\n      v_color = a_color;\n      v_textureCoordinate = a_textureCoordinate;\n      v_textureIndex = a_textureIndex;\n\n      // flip y\n      gl_Position = vec4(clip_space * vec2(1.0, -1.0), 0, 1);\n    }\n  ");
__publicField(_DynamicShader, "fragment", (uniforms, methods, effectMethods, drawEffects) => "\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision mediump float;\n    # endif\n\n    #define PI 3.14159265359\n\n    uniform vec2 u_resolution;\n    uniform vec2 u_dimensions;\n    uniform float u_alpha;\n    uniform float u_radius;\n    uniform sampler2D u_texture;\n    uniform float u_pixelRatio;\n\n    ".concat(uniforms, "\n\n    varying vec4 v_color;\n    varying vec2 v_textureCoordinate;\n\n    ").concat(methods, "\n\n    ").concat(effectMethods, "\n\n    void main() {\n      vec2 p = v_textureCoordinate.xy * u_dimensions - u_dimensions * 0.5;\n      vec2 d = abs(p) - (u_dimensions) * 0.5;\n      float lng_DefaultMask = min(max(d.x, d.y), 0.0) + length(max(d, 0.0));\n\n      vec4 shaderColor = vec4(0.0);\n      float shaderMask = lng_DefaultMask;\n\n      vec4 maskColor = texture2D(u_texture, v_textureCoordinate) * v_color;\n\n      shaderColor = mix(shaderColor, maskColor, clamp(-(lng_DefaultMask + 0.5), 0.0, 1.0));\n\n      ").concat(drawEffects, "\n\n      gl_FragColor = shaderColor * u_alpha;\n    }\n  "));
let DynamicShader = _DynamicShader;
class RoundedRectangle extends WebGlCoreShader {
  constructor(renderer2) {
    super({
      renderer: renderer2,
      attributes: ["a_position", "a_textureCoordinate", "a_color"],
      uniforms: [
        { name: "u_resolution", uniform: "uniform2fv" },
        { name: "u_pixelRatio", uniform: "uniform1f" },
        { name: "u_texture", uniform: "uniform2f" },
        { name: "u_dimensions", uniform: "uniform2fv" },
        { name: "u_radius", uniform: "uniform1f" }
      ]
    });
  }
  static resolveDefaults(props) {
    return {
      radius: props.radius || 10,
      $dimensions: {
        width: 0,
        height: 0
      }
    };
  }
  bindTextures(textures) {
    const { glw } = this;
    glw.activeTexture(0);
    glw.bindTexture(textures[0].ctxTexture);
  }
  bindProps(props) {
    const radiusFactor = Math.min(props.$dimensions.width, props.$dimensions.height) / (2 * props.radius);
    this.glw.uniform1f(this.getUniformLocation("u_radius"), props.radius * Math.min(radiusFactor, 1));
  }
  canBatchShaderProps(propsA, propsB) {
    return propsA.radius === propsB.radius && propsA.$dimensions.width === propsB.$dimensions.width && propsA.$dimensions.height === propsB.$dimensions.height;
  }
}
__publicField(RoundedRectangle, "z$__type__Props");
__publicField(RoundedRectangle, "shaderSources", {
  vertex: "\n      # ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n      # else\n      precision mediump float;\n      # endif\n\n      attribute vec2 a_position;\n      attribute vec2 a_textureCoordinate;\n      attribute vec4 a_color;\n      attribute float a_textureIndex;\n      attribute float a_depth;\n\n      uniform vec2 u_resolution;\n      uniform float u_pixelRatio;\n\n      varying vec4 v_color;\n      varying vec2 v_textureCoordinate;\n\n      void main() {\n        vec2 normalized = a_position * u_pixelRatio / u_resolution;\n        vec2 zero_two = normalized * 2.0;\n        vec2 clip_space = zero_two - 1.0;\n\n        // pass to fragment\n        v_color = a_color;\n        v_textureCoordinate = a_textureCoordinate;\n\n        // flip y\n        gl_Position = vec4(clip_space * vec2(1.0, -1.0), 0, 1);\n      }\n    ",
  fragment: "\n      # ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n      # else\n      precision mediump float;\n      # endif\n\n      uniform vec2 u_resolution;\n      uniform vec2 u_dimensions;\n      uniform float u_radius;\n      uniform sampler2D u_texture;\n\n      varying vec4 v_color;\n      varying vec2 v_textureCoordinate;\n\n      float boxDist(vec2 p, vec2 size, float radius){\n        size -= vec2(radius);\n        vec2 d = abs(p) - size;\n        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0)) - radius;\n      }\n\n      float fillMask(float dist) {\n        return clamp(-dist, 0.0, 1.0);\n      }\n\n      void main() {\n        vec4 color = texture2D(u_texture, v_textureCoordinate) * v_color;\n        vec2 halfDimensions = u_dimensions * 0.5;\n\n        float d = boxDist(v_textureCoordinate.xy * u_dimensions - halfDimensions, halfDimensions + 0.5, u_radius);\n        gl_FragColor = mix(vec4(0.0), color, fillMask(d));\n      }\n    "
});
const IDENTITY_MATRIX_3x3 = new Float32Array([1, 0, 0, 0, 1, 0, 0, 0, 1]);
const _SdfShader = class _SdfShader extends WebGlCoreShader {
  constructor(renderer2) {
    super({
      renderer: renderer2,
      attributes: ["a_position", "a_textureCoordinate"],
      uniforms: [
        { name: "u_resolution", uniform: "uniform2fv" },
        { name: "u_transform", uniform: "uniformMatrix3fv" },
        { name: "u_scrollY", uniform: "uniform1f" },
        { name: "u_pixelRatio", uniform: "uniform1f" },
        { name: "u_texture", uniform: "uniform2f" },
        { name: "u_color", uniform: "uniform4fv" },
        { name: "u_size", uniform: "uniform1f" },
        { name: "u_distanceRange", uniform: "uniform1f" },
        { name: "u_debug", uniform: "uniform1i" }
      ]
    });
  }
  bindTextures(textures) {
    const { glw } = this;
    glw.activeTexture(0);
    glw.bindTexture(textures[0].ctxTexture);
  }
  bindProps(props) {
    const resolvedProps = _SdfShader.resolveDefaults(props);
    for (const key in resolvedProps) {
      if (key === "transform") {
        this.glw.uniformMatrix3fv(this.getUniformLocation("u_transform"), resolvedProps[key]);
      } else if (key === "scrollY") {
        this.glw.uniform1f(this.getUniformLocation("u_scrollY"), resolvedProps[key]);
      } else if (key === "color") {
        const components = getNormalizedRgbaComponents(resolvedProps.color);
        this.glw.uniform4fv(this.getUniformLocation("u_color"), components);
      } else if (key === "size") {
        this.glw.uniform1f(this.getUniformLocation("u_size"), resolvedProps[key]);
      } else if (key === "distanceRange") {
        this.glw.uniform1f(this.getUniformLocation("u_distanceRange"), resolvedProps[key]);
      } else if (key === "debug") {
        this.glw.uniform1i(this.getUniformLocation("u_debug"), resolvedProps[key] ? 1 : 0);
      }
    }
  }
  static resolveDefaults(props = {}) {
    var _a2, _b, _c, _d, _e, _f;
    return {
      transform: (_a2 = props.transform) != null ? _a2 : IDENTITY_MATRIX_3x3,
      scrollY: (_b = props.scrollY) != null ? _b : 0,
      color: (_c = props.color) != null ? _c : 4294967295,
      size: (_d = props.size) != null ? _d : 16,
      distanceRange: (_e = props.distanceRange) != null ? _e : 1,
      debug: (_f = props.debug) != null ? _f : false
    };
  }
};
__publicField(_SdfShader, "z$__type__Props");
__publicField(_SdfShader, "shaderSources", {
  vertex: "\n      # ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n      # else\n      precision mediump float;\n      # endif\n      // an attribute is an input (in) to a vertex shader.\n      // It will receive data from a buffer\n      attribute vec2 a_position;\n      attribute vec2 a_textureCoordinate;\n\n      uniform vec2 u_resolution;\n      uniform mat3 u_transform;\n      uniform float u_scrollY;\n      uniform float u_pixelRatio;\n      uniform float u_size;\n\n      varying vec2 v_texcoord;\n\n      void main() {\n        vec2 scrolledPosition = a_position * u_size - vec2(0, u_scrollY);\n        vec2 transformedPosition = (u_transform * vec3(scrolledPosition, 1)).xy;\n\n        // Calculate screen space with pixel ratio\n        vec2 screenSpace = (transformedPosition * u_pixelRatio / u_resolution * 2.0 - 1.0) * vec2(1, -1);\n\n        gl_Position = vec4(screenSpace, 0.0, 1.0);\n        v_texcoord = a_textureCoordinate;\n\n      }\n    ",
  fragment: "\n      # ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n      # else\n      precision mediump float;\n      # endif\n      uniform vec4 u_color;\n      uniform sampler2D u_texture;\n      uniform float u_distanceRange;\n      uniform float u_pixelRatio;\n      uniform int u_debug;\n\n      varying vec2 v_texcoord;\n\n      float median(float r, float g, float b) {\n          return max(min(r, g), min(max(r, g), b));\n      }\n\n      void main() {\n          vec3 sample = texture2D(u_texture, v_texcoord).rgb;\n          if (u_debug == 1) {\n            gl_FragColor = vec4(sample.r, sample.g, sample.b, 1.0);\n            return;\n          }\n          float scaledDistRange = u_distanceRange * u_pixelRatio;\n          float sigDist = scaledDistRange * (median(sample.r, sample.g, sample.b) - 0.5);\n          float opacity = clamp(sigDist + 0.5, 0.0, 1.0) * u_color.a;\n\n          // Build the final color.\n          // IMPORTANT: We must premultiply the color by the alpha value before returning it.\n          gl_FragColor = vec4(u_color.r * opacity, u_color.g * opacity, u_color.b * opacity, opacity);\n      }\n    "
});
let SdfShader = _SdfShader;
const updateShaderEffectColor = (values) => {
  if (values.programValue === void 0) {
    values.programValue = new Float32Array(4);
  }
  const rgba = values.value;
  const floatArray = values.programValue;
  floatArray[0] = (rgba >>> 24) / 255;
  floatArray[1] = (rgba >>> 16 & 255) / 255;
  floatArray[2] = (rgba >>> 8 & 255) / 255;
  floatArray[3] = (rgba & 255) / 255;
};
const updateFloat32ArrayLength2 = (values) => {
  const validatedValue = values.validatedValue || values.value;
  if (values.programValue instanceof Float32Array) {
    const floatArray = values.programValue;
    floatArray[0] = validatedValue[0];
    floatArray[1] = validatedValue[1];
  } else {
    values.programValue = new Float32Array(validatedValue);
  }
};
const updateFloat32ArrayLength4 = (values) => {
  const validatedValue = values.validatedValue || values.value;
  if (values.programValue instanceof Float32Array) {
    const floatArray = values.programValue;
    floatArray[0] = validatedValue[0];
    floatArray[1] = validatedValue[1];
    floatArray[2] = validatedValue[2];
    floatArray[3] = validatedValue[3];
  } else {
    values.programValue = new Float32Array(validatedValue);
  }
};
const updateFloat32ArrayLengthN = (values) => {
  const validatedValue = values.validatedValue || values.value;
  if (values.programValue instanceof Float32Array) {
    const len = validatedValue.length;
    const programValue = values.programValue;
    for (let i = 0; i < len; i++) {
      programValue[i] = validatedValue[i];
    }
  } else {
    values.programValue = new Float32Array(validatedValue);
  }
};
const validateArrayLength4 = (value) => {
  const isArray2 = Array.isArray(value);
  if (!isArray2) {
    return [value, value, value, value];
  } else if (isArray2 && value.length === 4) {
    return value;
  } else if (isArray2 && value.length === 2) {
    return [value[0], value[1], value[0], value[1]];
  } else if (isArray2 && value.length === 3) {
    return [value[0], value[1], value[2], value[0]];
  }
  return [value[0], value[0], value[0], value[0]];
};
const updateWebSafeRadius = (values, shaderProps) => {
  if (values.programValue === void 0) {
    values.programValue = new Float32Array(4);
  }
  const programValue = values.programValue;
  const validatedValue = values.validatedValue || values.value;
  if (shaderProps === void 0 && values.$dimensions === void 0) {
    programValue[0] = validatedValue[0];
    programValue[1] = validatedValue[1];
    programValue[2] = validatedValue[2];
    programValue[3] = validatedValue[3];
    return;
  }
  let storedDimensions = values.$dimensions;
  if (shaderProps !== void 0) {
    const { $dimensions } = shaderProps;
    if (storedDimensions !== void 0 && (storedDimensions.width === $dimensions.width || storedDimensions.height === $dimensions.height)) {
      return;
    }
    if (storedDimensions === void 0) {
      storedDimensions = {
        width: $dimensions == null ? void 0 : $dimensions.width,
        height: $dimensions == null ? void 0 : $dimensions.height
      };
      values.$dimensions = storedDimensions;
    }
  }
  const { width, height } = storedDimensions;
  const [r0, r1, r2, r3] = validatedValue;
  const factor = Math.min(Math.min(Math.min(width / Math.max(width, r0 + r1), width / Math.max(width, r2 + r3)), Math.min(height / Math.max(height, r0 + r2), height / Math.max(height, r1 + r3))), 1);
  programValue[0] = r0 * factor;
  programValue[1] = r1 * factor;
  programValue[2] = r2 * factor;
  programValue[3] = r3 * factor;
};
class RadiusEffect extends ShaderEffect {
  constructor() {
    super(...arguments);
    __publicField(this, "name", "radius");
  }
  static getEffectKey() {
    return "radius";
  }
  static resolveDefaults(props) {
    var _a2;
    return {
      radius: (_a2 = props.radius) != null ? _a2 : 10
    };
  }
}
__publicField(RadiusEffect, "z$__type__Props");
__publicField(RadiusEffect, "uniforms", {
  radius: {
    value: 0,
    method: "uniform4fv",
    type: "vec4",
    updateOnBind: true,
    validator: validateArrayLength4,
    updateProgramValue: updateWebSafeRadius
  }
});
__publicField(RadiusEffect, "methods", {
  fillMask: "\n      float function(float dist) {\n        return clamp(-dist, 0.0, 1.0);\n      }\n    ",
  boxDist: "\n      float function(vec2 p, vec2 size, float radius) {\n        size -= vec2(radius);\n        vec2 d = abs(p) - size;\n        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0)) - radius;\n      }\n    "
});
__publicField(RadiusEffect, "onShaderMask", "\n  vec2 halfDimensions = u_dimensions * 0.5;\n  float r = radius[0] * step(v_textureCoordinate.x, 0.5) * step(v_textureCoordinate.y, 0.5);\n  r = r + radius[1] * step(0.5, v_textureCoordinate.x) * step(v_textureCoordinate.y, 0.5);\n  r = r + radius[2] * step(0.5, v_textureCoordinate.x) * step(0.5, v_textureCoordinate.y);\n  r = r + radius[3] * step(v_textureCoordinate.x, 0.5) * step(0.5, v_textureCoordinate.y);\n  return $boxDist(v_textureCoordinate.xy * u_dimensions - halfDimensions, halfDimensions, r);\n  ");
__publicField(RadiusEffect, "onEffectMask", "\n  return mix(vec4(0.0), maskColor, $fillMask(shaderMask));\n  ");
class BorderEffect extends ShaderEffect {
  constructor() {
    super(...arguments);
    __publicField(this, "name", "border");
  }
  static getEffectKey() {
    return "border";
  }
  static resolveDefaults(props) {
    var _a2, _b;
    return {
      width: (_a2 = props.width) != null ? _a2 : 10,
      color: (_b = props.color) != null ? _b : 4294967295
    };
  }
}
__publicField(BorderEffect, "z$__type__Props");
__publicField(BorderEffect, "uniforms", {
  width: {
    value: 0,
    method: "uniform1f",
    type: "float"
  },
  color: {
    value: 4294967295,
    updateProgramValue: updateShaderEffectColor,
    method: "uniform4fv",
    type: "vec4"
  }
});
__publicField(BorderEffect, "onEffectMask", "\n  float intR = shaderMask + 1.0;\n  float mask = clamp(intR + width, 0.0, 1.0) - clamp(intR, 0.0, 1.0);\n  return mix(shaderColor, mix(shaderColor, maskColor, maskColor.a), mask);\n  ");
__publicField(BorderEffect, "onColorize", "\n    return color;\n  ");
const _LinearGradientEffect = class _LinearGradientEffect extends ShaderEffect {
  constructor() {
    super(...arguments);
    __publicField(this, "name", "linearGradient");
  }
  static getEffectKey(props) {
    if (props.colors.value) {
      return "linearGradient".concat(props.colors.value.length);
    }
    return "linearGradient".concat(props.colors.length);
  }
  static resolveDefaults(props) {
    var _a2, _b;
    const colors = (_a2 = props.colors) != null ? _a2 : [4278190080, 4294967295];
    let stops = props.stops || [];
    if (stops.length === 0 || stops.length !== colors.length) {
      const colorsL = colors.length;
      let i = 0;
      const tmp = stops;
      for (; i < colorsL; i++) {
        if (stops[i]) {
          tmp[i] = stops[i];
          if (stops[i - 1] === void 0 && tmp[i - 2] !== void 0) {
            tmp[i - 1] = tmp[i - 2] + (stops[i] - tmp[i - 2]) / 2;
          }
        } else {
          tmp[i] = i * (1 / (colors.length - 1));
        }
      }
      stops = tmp;
    }
    return {
      colors,
      stops,
      angle: (_b = props.angle) != null ? _b : 0
    };
  }
};
__publicField(_LinearGradientEffect, "z$__type__Props");
__publicField(_LinearGradientEffect, "uniforms", {
  angle: {
    value: 0,
    method: "uniform1f",
    type: "float"
  },
  colors: {
    value: 4294967295,
    validator: (rgbas) => {
      return rgbas.reduce((acc, val) => acc.concat(getNormalizedRgbaComponents(val)), []);
    },
    updateProgramValue: updateFloat32ArrayLengthN,
    size: (props) => props.colors.length,
    method: "uniform4fv",
    type: "vec4"
  },
  stops: {
    value: [],
    size: (props) => props.colors.length,
    method: "uniform1fv",
    type: "float"
  }
});
__publicField(_LinearGradientEffect, "methods", {
  fromLinear: "\n      vec4 function(vec4 linearRGB) {\n        vec4 higher = vec4(1.055)*pow(linearRGB, vec4(1.0/2.4)) - vec4(0.055);\n        vec4 lower = linearRGB * vec4(12.92);\n        return mix(higher, lower, 1.0);\n      }\n    ",
  toLinear: "\n      vec4 function(vec4 sRGB) {\n        vec4 higher = pow((sRGB + vec4(0.055))/vec4(1.055), vec4(2.4));\n        vec4 lower = sRGB/vec4(12.92);\n        return mix(higher, lower, 1.0);\n      }\n    ",
  calcPoint: "\n      vec2 function(float d, float angle) {\n        return d * vec2(cos(angle), sin(angle)) + (u_dimensions * 0.5);\n      }\n    "
});
__publicField(_LinearGradientEffect, "ColorLoop", (amount) => {
  let loop = "";
  for (let i = 2; i < amount; i++) {
    loop += "colorOut = mix(colorOut, colors[".concat(i, "], clamp((dist - stops[").concat(i - 1, "]) / (stops[").concat(i, "] - stops[").concat(i - 1, "]), 0.0, 1.0));");
  }
  return loop;
});
__publicField(_LinearGradientEffect, "onColorize", (props) => {
  const colors = props.colors.length || 1;
  return "\n      float a = angle - (PI / 180.0 * 90.0);\n      float lineDist = abs(u_dimensions.x * cos(a)) + abs(u_dimensions.y * sin(a));\n      vec2 f = $calcPoint(lineDist * 0.5, a);\n      vec2 t = $calcPoint(lineDist * 0.5, a + PI);\n      vec2 gradVec = t - f;\n      float dist = dot(v_textureCoordinate.xy * u_dimensions - f, gradVec) / dot(gradVec, gradVec);\n\n      float stopCalc = (dist - stops[0]) / (stops[1] - stops[0]);\n      vec4 colorOut = $fromLinear(mix($toLinear(colors[0]), $toLinear(colors[1]), stopCalc));\n      ".concat(_LinearGradientEffect.ColorLoop(colors), "\n      return mix(maskColor, colorOut, clamp(colorOut.a, 0.0, 1.0));\n    ");
});
let LinearGradientEffect = _LinearGradientEffect;
class GrayscaleEffect extends ShaderEffect {
  constructor() {
    super(...arguments);
    __publicField(this, "name", "grayscale");
  }
  static getEffectKey() {
    return "grayscale";
  }
  static resolveDefaults(props) {
    var _a2;
    return {
      amount: (_a2 = props.amount) != null ? _a2 : 1
    };
  }
}
__publicField(GrayscaleEffect, "uniforms", {
  amount: {
    value: 1,
    method: "uniform1f",
    type: "float"
  }
});
__publicField(GrayscaleEffect, "onColorize", "\n    float grayness = 0.2 * maskColor.r + 0.6 * maskColor.g + 0.2 * maskColor.b;\n    return vec4(amount * vec3(grayness) + (1.0 - amount) * maskColor.rgb, maskColor.a);\n  ");
class BorderRightEffect extends ShaderEffect {
  constructor() {
    super(...arguments);
    __publicField(this, "name", "borderRight");
  }
  static getEffectKey() {
    return "borderRight";
  }
  static resolveDefaults(props) {
    var _a2, _b;
    return {
      width: (_a2 = props.width) != null ? _a2 : 10,
      color: (_b = props.color) != null ? _b : 4294967295
    };
  }
}
__publicField(BorderRightEffect, "z$__type__Props");
__publicField(BorderRightEffect, "uniforms", {
  width: {
    value: 0,
    method: "uniform1f",
    type: "float"
  },
  color: {
    value: 4294967295,
    updateProgramValue: updateShaderEffectColor,
    method: "uniform4fv",
    type: "vec4"
  }
});
__publicField(BorderRightEffect, "methods", {
  fillMask: "\n      float function(float dist) {\n        return clamp(-dist, 0.0, 1.0);\n      }\n    ",
  rectDist: "\n      float function(vec2 p, vec2 size) {\n        vec2 d = abs(p) - size;\n        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0));\n      }\n    "
});
__publicField(BorderRightEffect, "onEffectMask", "\n  vec2 pos = vec2(u_dimensions.x - width * 0.5, 0.0);\n  float mask = $rectDist(v_textureCoordinate.xy * u_dimensions - pos, vec2(width*0.5, u_dimensions.y));\n  return mix(shaderColor, maskColor, $fillMask(mask));\n  ");
__publicField(BorderRightEffect, "onColorize", "\n    return color;\n  ");
class BorderTopEffect extends ShaderEffect {
  constructor() {
    super(...arguments);
    __publicField(this, "name", "borderTop");
  }
  static getEffectKey() {
    return "borderTop";
  }
  static resolveDefaults(props) {
    var _a2, _b;
    return {
      width: (_a2 = props.width) != null ? _a2 : 10,
      color: (_b = props.color) != null ? _b : 4294967295
    };
  }
}
__publicField(BorderTopEffect, "z$__type__Props");
__publicField(BorderTopEffect, "uniforms", {
  width: {
    value: 0,
    method: "uniform1f",
    type: "float"
  },
  color: {
    value: 4294967295,
    updateProgramValue: updateShaderEffectColor,
    method: "uniform4fv",
    type: "vec4"
  }
});
__publicField(BorderTopEffect, "methods", {
  fillMask: "\n      float function(float dist) {\n        return clamp(-dist, 0.0, 1.0);\n      }\n    ",
  rectDist: "\n      float function(vec2 p, vec2 size) {\n        vec2 d = abs(p) - size;\n        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0));\n      }\n    "
});
__publicField(BorderTopEffect, "onEffectMask", "\n  vec2 pos = vec2(0.0, width * 0.5);\n  float mask = $rectDist(v_textureCoordinate.xy * u_dimensions - pos, vec2(u_dimensions.x, width*0.5));\n  return mix(shaderColor, maskColor, $fillMask(mask));\n  ");
__publicField(BorderTopEffect, "onColorize", "\n    return color;\n  ");
class BorderBottomEffect extends ShaderEffect {
  constructor() {
    super(...arguments);
    __publicField(this, "name", "borderBottom");
  }
  static getEffectKey() {
    return "borderBottom";
  }
  static resolveDefaults(props) {
    var _a2, _b;
    return {
      width: (_a2 = props.width) != null ? _a2 : 10,
      color: (_b = props.color) != null ? _b : 4294967295
    };
  }
}
__publicField(BorderBottomEffect, "z$__type__Props");
__publicField(BorderBottomEffect, "uniforms", {
  width: {
    value: 0,
    method: "uniform1f",
    type: "float"
  },
  color: {
    value: 4294967295,
    updateProgramValue: updateShaderEffectColor,
    method: "uniform4fv",
    type: "vec4"
  }
});
__publicField(BorderBottomEffect, "methods", {
  fillMask: "\n      float function(float dist) {\n        return clamp(-dist, 0.0, 1.0);\n      }\n    ",
  rectDist: "\n      float function(vec2 p, vec2 size) {\n        vec2 d = abs(p) - size;\n        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0));\n      }\n    "
});
__publicField(BorderBottomEffect, "onEffectMask", "\n  vec2 pos = vec2(0.0, u_dimensions.y - width * 0.5);\n  float mask = $rectDist(v_textureCoordinate.xy * u_dimensions - pos, vec2(u_dimensions.x, width*0.5));\n  return mix(shaderColor, maskColor, $fillMask(mask));\n  ");
__publicField(BorderBottomEffect, "onColorize", "\n    return color;\n  ");
class BorderLeftEffect extends ShaderEffect {
  constructor() {
    super(...arguments);
    __publicField(this, "name", "borderLeft");
  }
  static getEffectKey() {
    return "borderLeft";
  }
  static resolveDefaults(props) {
    var _a2, _b;
    return {
      width: (_a2 = props.width) != null ? _a2 : 10,
      color: (_b = props.color) != null ? _b : 4294967295
    };
  }
}
__publicField(BorderLeftEffect, "z$__type__Props");
__publicField(BorderLeftEffect, "uniforms", {
  width: {
    value: 0,
    method: "uniform1f",
    type: "float"
  },
  color: {
    value: 4294967295,
    updateProgramValue: updateShaderEffectColor,
    method: "uniform4fv",
    type: "vec4"
  }
});
__publicField(BorderLeftEffect, "methods", {
  fillMask: "\n      float function(float dist) {\n        return clamp(-dist, 0.0, 1.0);\n      }\n    ",
  rectDist: "\n      float function(vec2 p, vec2 size) {\n        vec2 d = abs(p) - size;\n        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0));\n      }\n    "
});
__publicField(BorderLeftEffect, "onEffectMask", "\n  vec2 pos = vec2(width * 0.5, 0.0);\n  float mask = $rectDist(v_textureCoordinate.xy * u_dimensions - pos, vec2(width*0.5, u_dimensions.y));\n  return mix(shaderColor, maskColor, $fillMask(mask));\n  ");
__publicField(BorderLeftEffect, "onColorize", "\n    return color;\n  ");
class GlitchEffect extends ShaderEffect {
  constructor() {
    super(...arguments);
    __publicField(this, "name", "glitch");
  }
  static getEffectKey(props) {
    return "glitch";
  }
  static resolveDefaults(props) {
    var _a2, _b, _c, _d, _e;
    return {
      amplitude: (_a2 = props.amplitude) != null ? _a2 : 0.2,
      narrowness: (_b = props.narrowness) != null ? _b : 4,
      blockiness: (_c = props.blockiness) != null ? _c : 2,
      minimizer: (_d = props.minimizer) != null ? _d : 8,
      time: (_e = props.time) != null ? _e : Date.now()
    };
  }
}
__publicField(GlitchEffect, "z$__type__Props");
__publicField(GlitchEffect, "uniforms", {
  amplitude: {
    value: 0,
    method: "uniform1f",
    type: "float"
  },
  narrowness: {
    value: 0,
    method: "uniform1f",
    type: "float"
  },
  blockiness: {
    value: 0,
    method: "uniform1f",
    type: "float"
  },
  minimizer: {
    value: 0,
    method: "uniform1f",
    type: "float"
  },
  time: {
    value: 0,
    method: "uniform1f",
    updateOnBind: true,
    updateProgramValue: (values) => {
      const value = values.value = (Date.now() - values.value) % 1e3;
      values.programValue = value;
    },
    type: "float"
  }
});
__publicField(GlitchEffect, "methods", {
  rand: "\n      float function(vec2 p, float time) {\n        float t = floor(time * 20.) / 10.;\n        return fract(sin(dot(p, vec2(t * 12.9898, t * 78.233))) * 43758.5453);\n      }\n    ",
  noise: "\n      float function(vec2 uv, float blockiness, float time) {\n        vec2 lv = fract(uv);\n        vec2 id = floor(uv);\n\n        float n1 = rand(id, time);\n        float n2 = rand(id+vec2(1,0), time);\n        float n3 = rand(id+vec2(0,1), time);\n        float n4 = rand(id+vec2(1,1), time);\n        vec2 u = smoothstep(0.0, 1.0 + blockiness, lv);\n        return mix(mix(n1, n2, u.x), mix(n3, n4, u.x), u.y);\n      }\n    ",
  fbm: "\n      float function(vec2 uv, int count, float blockiness, float complexity, float time) {\n        float val = 0.0;\n        float amp = 0.5;\n        const int MAX_ITERATIONS = 10;\n\n        for(int i = 0; i < MAX_ITERATIONS; i++) {\n          if(i >= count) {break;}\n          val += amp * noise(uv, blockiness, time);\n          amp *= 0.5;\n          uv *= complexity;\n        }\n        return val;\n      }\n    "
});
__publicField(GlitchEffect, "onColorize", "\n    vec2 uv = v_textureCoordinate.xy;\n    float aspect = u_dimensions.x / u_dimensions.y;\n    vec2 a = vec2(uv.x * aspect , uv.y);\n    vec2 uv2 = vec2(a.x / u_dimensions.x, exp(a.y));\n\n    float shift = amplitude * pow($fbm(uv2, 4, blockiness, narrowness, time), minimizer);\n    float colR = texture2D(u_texture, vec2(uv.x + shift, uv.y)).r * (1. - shift);\n    float colG = texture2D(u_texture, vec2(uv.x - shift, uv.y)).g * (1. - shift);\n    float colB = texture2D(u_texture, vec2(uv.x - shift, uv.y)).b * (1. - shift);\n\n    vec3 f = vec3(colR, colG, colB);\n    return vec4(f, texture2D(u_texture, vec2(uv.x - shift, uv.y)).a);\n  ");
class FadeOutEffect extends ShaderEffect {
  constructor() {
    super(...arguments);
    __publicField(this, "name", "fadeOut");
  }
  static getEffectKey() {
    return "fadeOut";
  }
  static resolveDefaults(props) {
    var _a2;
    return {
      fade: (_a2 = props.fade) != null ? _a2 : 10
    };
  }
}
__publicField(FadeOutEffect, "z$__type__Props");
__publicField(FadeOutEffect, "uniforms", {
  fade: {
    value: 0,
    method: "uniform4fv",
    type: "vec4",
    validator: validateArrayLength4,
    updateProgramValue: updateFloat32ArrayLength4
  }
});
__publicField(FadeOutEffect, "onColorize", "\n  vec2 point = v_textureCoordinate.xy * u_dimensions.xy;\n  vec2 pos1;\n  vec2 pos2;\n  vec2 d;\n  float c;\n  vec4 result = maskColor;\n\n\n  if(fade[0] > 0.0) {\n    pos1 = vec2(point.x, point.y);\n    pos2 = vec2(point.x, point.y + fade[0]);\n    d = pos2 - pos1;\n    c = dot(pos1, d) / dot(d, d);\n    result = mix(vec4(0.0), result, smoothstep(0.0, 1.0, clamp(c, 0.0, 1.0)));\n  }\n\n  if(fade[1] > 0.0) {\n    pos1 = vec2(point.x - u_dimensions.x - fade[1], v_textureCoordinate.y);\n    pos2 = vec2(point.x - u_dimensions.x, v_textureCoordinate.y);\n    d = pos1 - pos2;\n    c = dot(pos2, d) / dot(d, d);\n    result = mix(vec4(0.0), result, smoothstep(0.0, 1.0, clamp(c, 0.0, 1.0)));\n  }\n\n  if(fade[2] > 0.0) {\n    pos1 = vec2(v_textureCoordinate.x, point.y - u_dimensions.y - fade[2]);\n    pos2 = vec2(v_textureCoordinate.x, point.y - u_dimensions.y);\n    d = pos1 - pos2;\n    c = dot(pos2, d) / dot(d, d);\n    result = mix(vec4(0.0), result, smoothstep(0.0, 1.0, clamp(c, 0.0, 1.0)));\n  }\n\n  if(fade[3] > 0.0) {\n    pos1 = vec2(point.x, point.y);\n    pos2 = vec2(point.x + fade[3], point.y);\n    d = pos2 - pos1;\n    c = dot(pos1, d) / dot(d, d);\n    result = mix(vec4(0.0), result, smoothstep(0.0, 1.0, clamp(c, 0.0, 1.0)));\n  }\n\n  return result;\n  ");
const _RadialGradientEffect = class _RadialGradientEffect extends ShaderEffect {
  constructor() {
    super(...arguments);
    __publicField(this, "name", "radialGradient");
  }
  static getEffectKey(props) {
    if (props.colors.value) {
      return "radialGradient".concat(props.colors.value.length);
    }
    return "radialGradient".concat(props.colors.length);
  }
  static resolveDefaults(props) {
    var _a2, _b, _c, _d, _e;
    const colors = (_a2 = props.colors) != null ? _a2 : [4278190080, 4294967295];
    let stops = props.stops || [];
    if (stops.length === 0 || stops.length !== colors.length) {
      const colorsL = colors.length;
      let i = 0;
      const tmp = stops;
      for (; i < colorsL; i++) {
        if (stops[i]) {
          tmp[i] = stops[i];
          if (stops[i - 1] === void 0 && tmp[i - 2] !== void 0) {
            tmp[i - 1] = tmp[i - 2] + (stops[i] - tmp[i - 2]) / 2;
          }
        } else {
          tmp[i] = i * (1 / (colors.length - 1));
        }
      }
      stops = tmp;
    }
    return {
      colors,
      stops,
      width: (_b = props.width) != null ? _b : 0,
      height: (_d = (_c = props.height) != null ? _c : props.width) != null ? _d : 0,
      pivot: (_e = props.pivot) != null ? _e : [0.5, 0.5]
    };
  }
};
__publicField(_RadialGradientEffect, "z$__type__Props");
__publicField(_RadialGradientEffect, "uniforms", {
  width: {
    value: 0,
    method: "uniform1f",
    type: "float"
  },
  height: {
    value: 0,
    method: "uniform1f",
    type: "float"
  },
  pivot: {
    value: [0.5, 0.5],
    updateProgramValue: updateFloat32ArrayLength2,
    method: "uniform2fv",
    type: "vec2"
  },
  colors: {
    value: 4294967295,
    validator: (rgbas) => {
      return rgbas.reduce((acc, val) => acc.concat(getNormalizedRgbaComponents(val)), []);
    },
    updateProgramValue: updateFloat32ArrayLengthN,
    size: (props) => props.colors.length,
    method: "uniform4fv",
    type: "vec4"
  },
  stops: {
    value: [],
    size: (props) => props.colors.length,
    method: "uniform1fv",
    type: "float"
  }
});
__publicField(_RadialGradientEffect, "ColorLoop", (amount) => {
  let loop = "";
  for (let i = 2; i < amount; i++) {
    loop += "colorOut = mix(colorOut, colors[".concat(i, "], clamp((dist - stops[").concat(i - 1, "]) / (stops[").concat(i, "] - stops[").concat(i - 1, "]), 0.0, 1.0));");
  }
  return loop;
});
__publicField(_RadialGradientEffect, "onColorize", (props) => {
  const colors = props.colors.length || 1;
  return "\n      vec2 point = v_textureCoordinate.xy * u_dimensions;\n      vec2 projection = vec2(pivot.x * u_dimensions.x, pivot.y * u_dimensions.y);\n\n      float dist = length((point - projection) / vec2(width, height));\n\n      float stopCalc = (dist - stops[0]) / (stops[1] - stops[0]);\n      vec4 colorOut = mix(colors[0], colors[1], stopCalc);\n      ".concat(_RadialGradientEffect.ColorLoop(colors), "\n      return mix(maskColor, colorOut, clamp(colorOut.a, 0.0, 1.0));\n    ");
});
let RadialGradientEffect = _RadialGradientEffect;
class RadialProgressEffect extends ShaderEffect {
  constructor() {
    super(...arguments);
    __publicField(this, "name", "radialProgress");
  }
  static getEffectKey() {
    return "radialProgress";
  }
  static resolveDefaults(props) {
    var _a2, _b, _c, _d, _e, _f, _g;
    return {
      width: (_a2 = props.width) != null ? _a2 : 10,
      progress: (_b = props.progress) != null ? _b : 0.5,
      offset: (_c = props.offset) != null ? _c : 0,
      range: (_d = props.range) != null ? _d : Math.PI * 2,
      rounded: (_e = props.rounded) != null ? _e : false,
      radius: (_f = props.radius) != null ? _f : 1,
      color: (_g = props.color) != null ? _g : 4294967295
    };
  }
}
__publicField(RadialProgressEffect, "z$__type__Props");
__publicField(RadialProgressEffect, "uniforms", {
  width: {
    value: 0,
    method: "uniform1f",
    type: "float"
  },
  progress: {
    value: 0.5,
    method: "uniform1f",
    type: "float"
  },
  offset: {
    value: 0,
    method: "uniform1f",
    type: "float"
  },
  range: {
    value: 0,
    method: "uniform1f",
    type: "float"
  },
  rounded: {
    value: 0,
    method: "uniform1f",
    type: "float",
    validator: (value) => {
      return value ? 1 : 0;
    }
  },
  radius: {
    value: 1,
    method: "uniform1f",
    type: "float"
  },
  color: {
    value: 4294967295,
    updateProgramValue: updateShaderEffectColor,
    method: "uniform4fv",
    type: "vec4"
  }
});
__publicField(RadialProgressEffect, "methods", {
  rotateUV: "\n    vec2 function(vec2 uv, float d) {\n      float s = sin(d);\n      float c = cos(d);\n      mat2 rotMatrix = mat2(c, -s, s, c);\n      return uv * rotMatrix;\n    }\n    ",
  drawDot: "\n    float function(vec2 uv, vec2 p, float r) {\n      uv += p;\n      float circle = length(uv) - r;\n      return clamp(-circle, 0.0, 1.0);\n    }\n    "
});
__publicField(RadialProgressEffect, "onEffectMask", "\n    float outerRadius = radius * u_dimensions.y * 0.5;\n\n    float endAngle = range * progress - 0.0005;\n\n    vec2 uv = v_textureCoordinate.xy * u_dimensions.xy - u_dimensions * 0.5;\n\n    uv = $rotateUV(uv, -(offset));\n    float linewidth = width * u_pixelRatio;\n    float circle = length(uv) - (outerRadius - linewidth) ;\n    circle = abs(circle) - linewidth;\n    circle = clamp(-circle, 0.0, 1.0);\n\n    float angle = (atan(uv.x, -uv.y) / 3.14159265359 * 0.5);\n    float p = endAngle / (PI * 2.);\n\n    circle *= step(fract(angle), fract(p));\n\n    circle = rounded < 1. ? circle : max(circle, $drawDot(uv, vec2(0, outerRadius - linewidth), linewidth));\n    circle = rounded < 1. ? circle : max(circle, $drawDot($rotateUV(uv, -(endAngle)), vec2(0, outerRadius - linewidth), linewidth));\n\n    return mix(shaderColor, maskColor, circle);\n  ");
__publicField(RadialProgressEffect, "onColorize", "\n    return color;\n  ");
class HolePunchEffect extends ShaderEffect {
  constructor() {
    super(...arguments);
    __publicField(this, "name", "holePunch");
  }
  static getEffectKey() {
    return "holePunch";
  }
  static resolveDefaults(props) {
    var _a2;
    return {
      x: props.x || 0,
      y: props.y || 0,
      width: props.width || 50,
      height: props.height || 50,
      radius: (_a2 = props.radius) != null ? _a2 : 0
    };
  }
}
__publicField(HolePunchEffect, "z$__type__Props");
__publicField(HolePunchEffect, "uniforms", {
  x: {
    value: 0,
    method: "uniform1f",
    type: "float"
  },
  y: {
    value: 0,
    method: "uniform1f",
    type: "float"
  },
  width: {
    value: 0,
    method: "uniform1f",
    type: "float"
  },
  height: {
    value: 0,
    method: "uniform1f",
    type: "float"
  },
  radius: {
    value: 0,
    method: "uniform4fv",
    type: "vec4",
    updateOnBind: true,
    validator: validateArrayLength4,
    updateProgramValue: updateWebSafeRadius
  }
});
__publicField(HolePunchEffect, "methods", {
  fillMask: "\n      float function(float dist) {\n        return clamp(-dist, 0.0, 1.0);\n      }\n    ",
  boxDist: "\n      float function(vec2 p, vec2 size, float radius) {\n        size -= vec2(radius);\n        vec2 d = abs(p) - size;\n        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0)) - radius;\n      }\n    "
});
__publicField(HolePunchEffect, "onShaderMask", "\n  vec2 halfDimensions = u_dimensions * 0.5;\n  vec2 size = vec2(width, height) * 0.5;\n  vec2 basePos = v_textureCoordinate.xy * u_dimensions.xy - vec2(x, y);\n  vec2 pos = basePos - size;\n  float r = radius[0] * step(pos.x, 0.5) * step(pos.y, 0.5);\n  r = r + radius[1] * step(0.5, pos.x) * step(pos.y, 0.5);\n  r = r + radius[2] * step(0.5, pos.x) * step(0.5, pos.y);\n  r = r + radius[3] * step(pos.x, 0.5) * step(0.5, pos.y);\n  return $boxDist(pos, size, r);\n  ");
__publicField(HolePunchEffect, "onEffectMask", "\n  return mix(maskColor, vec4(0.0), $fillMask(shaderMask));\n  ");
const ROUNDED_RECTANGLE_SHADER_TYPE = "RoundedRectangle";
class UnsupportedShader extends CoreShader {
  constructor(shType) {
    super();
    __publicField(this, "shType");
    this.shType = shType;
  }
  bindRenderOp() {
  }
  bindProps() {
  }
  attach() {
  }
  detach() {
  }
}
class ShaderController {
  constructor(type, shader, props, stage) {
    __publicField(this, "type");
    __publicField(this, "shader");
    __publicField(this, "resolvedProps");
    __publicField(this, "props");
    this.type = type;
    this.shader = shader;
    this.resolvedProps = props;
    const keys = Object.keys(props);
    const l = keys.length;
    const definedProps = {};
    for (let i = 0; i < l; i++) {
      const name = keys[i];
      Object.defineProperty(definedProps, name, {
        get: () => {
          return this.resolvedProps[name];
        },
        set: (value) => {
          this.resolvedProps[name] = value;
          stage.requestRender();
        }
      });
    }
    this.props = definedProps;
  }
  getResolvedProps() {
    return this.resolvedProps;
  }
}
class DynamicShaderController {
  constructor(shader, props, shManager) {
    __publicField(this, "shader");
    __publicField(this, "resolvedProps");
    __publicField(this, "props");
    __publicField(this, "type");
    this.shader = shader;
    this.type = "DynamicShader";
    this.resolvedProps = props;
    const effectConstructors = shManager.getRegisteredEffects();
    const definedProps = {};
    const effects = props.effects;
    const effectsLength = effects.length;
    for (let i = 0; i < effectsLength; i++) {
      const { name: effectName, props: effectProps, type: effectType } = effects[i];
      if (effectName === void 0) {
        continue;
      }
      const definedEffectProps = {};
      const propEntries = Object.keys(effectProps);
      const propEntriesLength = propEntries.length;
      for (let j = 0; j < propEntriesLength; j++) {
        const propName = propEntries[j];
        Object.defineProperty(definedEffectProps, propName, {
          get: () => {
            return this.resolvedProps.effects[i].props[propName].value;
          },
          set: (value) => {
            var _a2, _b;
            const target = this.resolvedProps.effects[i].props[propName];
            target.value = value;
            if (target.hasValidator) {
              value = target.validatedValue = (_a2 = effectConstructors[effectType].uniforms[propName]) == null ? void 0 : _a2.validator(value, effectProps);
            }
            if (target.hasProgramValueUpdater) {
              (_b = effectConstructors[effectType].uniforms[propName]) == null ? void 0 : _b.updateProgramValue(target);
            } else {
              target.programValue = value;
            }
            shManager.renderer.stage.requestRender();
          }
        });
      }
      Object.defineProperty(definedProps, effectName, {
        get: () => {
          return definedEffectProps;
        }
      });
    }
    this.props = definedProps;
  }
  getResolvedProps() {
    return this.resolvedProps;
  }
}
class CoreShaderManager {
  constructor() {
    __publicField(this, "shCache", /* @__PURE__ */ new Map());
    __publicField(this, "shConstructors", {});
    __publicField(this, "attachedShader", null);
    __publicField(this, "effectConstructors", {});
    __publicField(this, "renderer");
    this.registerShaderType("DefaultShader", DefaultShader);
    this.registerShaderType("DefaultShaderBatched", DefaultShaderBatched);
    this.registerShaderType("RoundedRectangle", RoundedRectangle);
    this.registerShaderType("DynamicShader", DynamicShader);
    this.registerShaderType("SdfShader", SdfShader);
    this.registerEffectType("border", BorderEffect);
    this.registerEffectType("borderBottom", BorderBottomEffect);
    this.registerEffectType("borderLeft", BorderLeftEffect);
    this.registerEffectType("borderRight", BorderRightEffect);
    this.registerEffectType("borderTop", BorderTopEffect);
    this.registerEffectType("fadeOut", FadeOutEffect);
    this.registerEffectType("linearGradient", LinearGradientEffect);
    this.registerEffectType("radialGradient", RadialGradientEffect);
    this.registerEffectType("grayscale", GrayscaleEffect);
    this.registerEffectType("glitch", GlitchEffect);
    this.registerEffectType("radius", RadiusEffect);
    this.registerEffectType("radialProgress", RadialProgressEffect);
    this.registerEffectType("holePunch", HolePunchEffect);
  }
  registerShaderType(shType, shClass) {
    this.shConstructors[shType] = shClass;
  }
  registerEffectType(effectType, effectClass) {
    this.effectConstructors[effectType] = effectClass;
  }
  getRegisteredEffects() {
    return this.effectConstructors;
  }
  getRegisteredShaders() {
    return this.shConstructors;
  }
  /**
   * Loads a shader (if not already loaded) and returns a controller for it.
   *
   * @param shType
   * @param props
   * @returns
   */
  loadShader(shType, props) {
    if (!this.renderer) {
      throw new Error("Renderer is not been defined");
    }
    const ShaderClass = this.shConstructors[shType];
    if (!ShaderClass) {
      throw new Error('Shader type "'.concat(shType, '" is not registered'));
    }
    if (this.renderer.mode === "canvas" && ShaderClass.prototype instanceof WebGlCoreShader) {
      return this._createShaderCtr(shType, new UnsupportedShader(shType), props);
    }
    if (shType === "DynamicShader") {
      return this.loadDynamicShader(props);
    }
    const resolvedProps = ShaderClass.resolveDefaults(props);
    const cacheKey = ShaderClass.makeCacheKey(resolvedProps) || ShaderClass.name;
    if (cacheKey && this.shCache.has(cacheKey)) {
      return this._createShaderCtr(shType, this.shCache.get(cacheKey), resolvedProps);
    }
    const shader = new ShaderClass(this.renderer, props);
    if (cacheKey) {
      this.shCache.set(cacheKey, shader);
    }
    return this._createShaderCtr(shType, shader, resolvedProps);
  }
  loadDynamicShader(props) {
    if (!this.renderer) {
      throw new Error("Renderer is not been defined");
    }
    const resolvedProps = DynamicShader.resolveDefaults(props, this.effectConstructors);
    const cacheKey = DynamicShader.makeCacheKey(resolvedProps, this.effectConstructors);
    if (cacheKey && this.shCache.has(cacheKey)) {
      return this._createDynShaderCtr(this.shCache.get(cacheKey), resolvedProps);
    }
    const shader = new DynamicShader(this.renderer, props, this.effectConstructors);
    if (cacheKey) {
      this.shCache.set(cacheKey, shader);
    }
    return this._createDynShaderCtr(shader, resolvedProps);
  }
  _createShaderCtr(type, shader, props) {
    return new ShaderController(type, shader, props, this.renderer.stage);
  }
  _createDynShaderCtr(shader, props) {
    shader.bindUniformMethods(props);
    return new DynamicShaderController(shader, props, this);
  }
  useShader(shader) {
    if (this.attachedShader === shader) {
      return;
    }
    if (this.attachedShader) {
      this.attachedShader.detach();
    }
    shader.attach();
    this.attachedShader = shader;
  }
}
const trPropSetterDefaults = {
  x: (state, value) => {
    state.props.x = value;
  },
  y: (state, value) => {
    state.props.y = value;
  },
  width: (state, value) => {
    state.props.width = value;
  },
  height: (state, value) => {
    state.props.height = value;
  },
  color: (state, value) => {
    state.props.color = value;
  },
  zIndex: (state, value) => {
    state.props.zIndex = value;
  },
  fontFamily: (state, value) => {
    state.props.fontFamily = value;
  },
  fontWeight: (state, value) => {
    state.props.fontWeight = value;
  },
  fontStyle: (state, value) => {
    state.props.fontStyle = value;
  },
  fontStretch: (state, value) => {
    state.props.fontStretch = value;
  },
  fontSize: (state, value) => {
    state.props.fontSize = value;
  },
  text: (state, value) => {
    state.props.text = value;
  },
  textAlign: (state, value) => {
    state.props.textAlign = value;
  },
  contain: (state, value) => {
    state.props.contain = value;
  },
  offsetY: (state, value) => {
    state.props.offsetY = value;
  },
  scrollable: (state, value) => {
    state.props.scrollable = value;
  },
  scrollY: (state, value) => {
    state.props.scrollY = value;
  },
  letterSpacing: (state, value) => {
    state.props.letterSpacing = value;
  },
  lineHeight: (state, value) => {
    state.props.lineHeight = value;
  },
  maxLines: (state, value) => {
    state.props.maxLines = value;
  },
  textBaseline: (state, value) => {
    state.props.textBaseline = value;
  },
  verticalAlign: (state, value) => {
    state.props.verticalAlign = value;
  },
  overflowSuffix: (state, value) => {
    state.props.overflowSuffix = value;
  },
  debug: (state, value) => {
    state.props.debug = value;
  }
};
class TextRenderer {
  constructor(stage) {
    __publicField(this, "stage");
    __publicField(this, "set");
    this.stage = stage;
    const propSetters = {
      ...trPropSetterDefaults,
      ...this.getPropertySetters()
    };
    const propSet = {};
    Object.keys(propSetters).forEach((key) => {
      Object.defineProperty(propSet, key, {
        value: (state, value) => {
          if (state.props[key] !== value) {
            propSetters[key](state, value);
            this.stage.requestRender();
          }
        },
        writable: false,
        // Prevents property from being changed
        configurable: false
        // Prevents property from being deleted
      });
    });
    this.set = propSet;
  }
  setStatus(state, status, error) {
    if (state.status === status) {
      return;
    }
    state.status = status;
    state.emitter.emit(status, error);
  }
  /**
   * Allows the CoreTextNode to communicate changes to the isRenderable state of
   * the itself.
   *
   * @param state
   * @param renderable
   */
  setIsRenderable(state, renderable) {
    state.isRenderable = renderable;
  }
  /**
   * Destroy/Clean up the state object
   *
   * @remarks
   * Opposite of createState(). Frees any event listeners / resources held by
   * the state that may not reliably get garbage collected.
   *
   * @param state
   */
  destroyState(state) {
    this.setStatus(state, "destroyed");
    state.emitter.removeAllListeners();
  }
  /**
   * Schedule a state update via queueMicrotask
   *
   * @remarks
   * This method is used to schedule a state update via queueMicrotask. This
   * method should be called whenever a state update is needed, and it will
   * ensure that the state is only updated once per microtask.
   * @param state
   * @returns
   */
  scheduleUpdateState(state) {
    if (state.updateScheduled) {
      return;
    }
    state.updateScheduled = true;
    queueMicrotask(() => {
      if (state.status === "destroyed") {
        return;
      }
      state.updateScheduled = false;
      this.updateState(state);
    });
  }
}
class ContextSpy {
  constructor() {
    __publicField(this, "data", {});
  }
  reset() {
    this.data = {};
  }
  increment(name) {
    if (!this.data[name]) {
      this.data[name] = 0;
    }
    this.data[name]++;
  }
  getData() {
    return { ...this.data };
  }
}
class TextureMemoryManager {
  constructor(stage, settings) {
    __publicField(this, "stage");
    __publicField(this, "memUsed", 0);
    __publicField(this, "loadedTextures", /* @__PURE__ */ new Map());
    __publicField(this, "orphanedTextures", []);
    __publicField(this, "criticalThreshold");
    __publicField(this, "targetThreshold");
    __publicField(this, "cleanupInterval");
    __publicField(this, "debugLogging");
    __publicField(this, "lastCleanupTime", 0);
    __publicField(this, "baselineMemoryAllocation");
    __publicField(this, "criticalCleanupRequested", false);
    __publicField(this, "doNotExceedCriticalThreshold");
    /**
     * The current frame time in milliseconds
     *
     * @remarks
     * This is used to determine when to perform Idle Texture Cleanups.
     *
     * Set by stage via `updateFrameTime` method.
     */
    __publicField(this, "frameTime", 0);
    this.stage = stage;
    const { criticalThreshold, doNotExceedCriticalThreshold } = settings;
    this.doNotExceedCriticalThreshold = doNotExceedCriticalThreshold || false;
    this.criticalThreshold = Math.round(criticalThreshold);
    const targetFraction = Math.max(0, Math.min(1, settings.targetThresholdLevel));
    this.cleanupInterval = settings.cleanupInterval;
    this.debugLogging = settings.debugLogging;
    this.baselineMemoryAllocation = Math.round(settings.baselineMemoryAllocation);
    this.targetThreshold = Math.max(Math.round(criticalThreshold * targetFraction), this.baselineMemoryAllocation);
    this.memUsed = Math.round(settings.baselineMemoryAllocation);
    if (settings.debugLogging) {
      let lastMemUse = 0;
      setInterval(() => {
        if (lastMemUse !== this.memUsed) {
          lastMemUse = this.memUsed;
          console.log("[TextureMemoryManager] Memory used: ".concat(bytesToMb$1(this.memUsed), " mb / ").concat(bytesToMb$1(this.criticalThreshold), " mb (").concat((this.memUsed / this.criticalThreshold * 100).toFixed(1), "%)"));
        }
      }, 1e3);
    }
    if (criticalThreshold === 0) {
      this.setTextureMemUse = () => {
      };
    }
  }
  /**
   * Add a texture to the orphaned textures list
   *
   * @param texture - The texture to add to the orphaned textures list
   */
  addToOrphanedTextures(texture) {
    if (this.orphanedTextures.includes(texture)) {
      this.removeFromOrphanedTextures(texture);
    }
    if (texture.preventCleanup === false) {
      this.orphanedTextures.push(texture);
    }
  }
  /**
   * Remove a texture from the orphaned textures list
   *
   * @param texture - The texture to remove from the orphaned textures list
   */
  removeFromOrphanedTextures(texture) {
    const index = this.orphanedTextures.indexOf(texture);
    if (index !== -1) {
      this.orphanedTextures.splice(index, 1);
    }
  }
  /**
   * Set the memory usage of a texture
   *
   * @param texture - The texture to set memory usage for
   * @param byteSize - The size of the texture in bytes
   */
  setTextureMemUse(texture, byteSize) {
    if (this.loadedTextures.has(texture)) {
      this.memUsed -= this.loadedTextures.get(texture);
    }
    if (byteSize === 0) {
      this.loadedTextures.delete(texture);
      return;
    } else {
      this.memUsed += byteSize;
      this.loadedTextures.set(texture, byteSize);
    }
    if (this.memUsed > this.criticalThreshold) {
      this.criticalCleanupRequested = true;
    }
  }
  checkCleanup() {
    return this.criticalCleanupRequested || this.memUsed > this.targetThreshold && this.frameTime - this.lastCleanupTime >= this.cleanupInterval;
  }
  checkCriticalCleanup() {
    return this.memUsed > this.criticalThreshold;
  }
  cleanupQuick(critical) {
    const memTarget = this.targetThreshold;
    const timestamp = getTimeStamp();
    while (this.memUsed >= memTarget && this.orphanedTextures.length > 0 && (critical || getTimeStamp() - timestamp < 10)) {
      const texture = this.orphanedTextures.shift();
      if (texture === void 0) {
        continue;
      }
      if (texture.renderable === true) {
        continue;
      }
      if (Texture.TRANSITIONAL_TEXTURE_STATES.includes(texture.state)) {
        continue;
      }
      this.destroyTexture(texture);
    }
  }
  /**
   * Destroy a texture and remove it from the memory manager
   *
   * @param texture - The texture to destroy
   */
  destroyTexture(texture) {
    if (this.debugLogging === true) {
      console.log("[TextureMemoryManager] Destroying texture. State: ".concat(texture.state));
    }
    const txManager = this.stage.txManager;
    txManager.removeTextureFromQueue(texture);
    txManager.removeTextureFromCache(texture);
    texture.destroy();
    this.removeFromOrphanedTextures(texture);
    this.loadedTextures.delete(texture);
  }
  cleanupDeep(critical) {
    const memTarget = critical ? this.criticalThreshold : this.targetThreshold;
    const filteredAndSortedTextures = [];
    const textures = [...this.loadedTextures.keys()];
    for (let i = 0; i < textures.length; i++) {
      const texture = textures[i];
      if (texture === void 0) {
        continue;
      }
      if (texture.type === TextureType.image || texture.type === TextureType.noise || texture.type === TextureType.renderToTexture) {
        if (texture.renderable === true) {
          filteredAndSortedTextures.push(texture);
        } else {
          filteredAndSortedTextures.unshift(texture);
        }
      }
    }
    while (this.memUsed >= memTarget && filteredAndSortedTextures.length > 0) {
      const texture = filteredAndSortedTextures.shift();
      if (texture === void 0) {
        continue;
      }
      if (texture.preventCleanup === true) {
        continue;
      }
      if (texture.renderable === true) {
        break;
      }
      if (Texture.TRANSITIONAL_TEXTURE_STATES.includes(texture.state)) {
        break;
      }
      this.destroyTexture(texture);
    }
  }
  cleanup(aggressive = false) {
    const critical = this.criticalCleanupRequested;
    this.lastCleanupTime = this.frameTime;
    if (critical === true) {
      this.stage.queueFrameEvent("criticalCleanup", {
        memUsed: this.memUsed,
        criticalThreshold: this.criticalThreshold
      });
    }
    if (this.debugLogging === true) {
      console.log("[TextureMemoryManager] Cleaning up textures. Critical: ".concat(critical, ". Aggressive: ").concat(aggressive));
    }
    this.cleanupQuick(critical);
    if (aggressive === true && this.memUsed >= this.criticalThreshold) {
      this.cleanupDeep(critical);
    }
    if (this.memUsed >= this.criticalThreshold) {
      this.stage.queueFrameEvent("criticalCleanupFailed", {
        memUsed: this.memUsed,
        criticalThreshold: this.criticalThreshold
      });
      if (this.debugLogging === true || isProductionEnvironment() === false) {
        console.warn("[TextureMemoryManager] Memory usage above critical threshold after cleanup: ".concat(this.memUsed));
      }
    } else {
      this.criticalCleanupRequested = false;
    }
  }
  /**
   * Get the current texture memory usage information
   *
   * @remarks
   * This method is for debugging purposes and returns information about the
   * current memory usage of the textures in the Renderer.
   */
  getMemoryInfo() {
    let renderableTexturesLoaded = 0;
    const renderableMemUsed = [...this.loadedTextures.keys()].reduce((acc, texture) => {
      var _a2;
      renderableTexturesLoaded += texture.renderable ? 1 : 0;
      const textureMemory = (_a2 = this.loadedTextures.get(texture)) != null ? _a2 : 0;
      return acc + (texture.renderable ? textureMemory : 0);
    }, this.baselineMemoryAllocation);
    return {
      criticalThreshold: this.criticalThreshold,
      targetThreshold: this.targetThreshold,
      renderableMemUsed,
      memUsed: this.memUsed,
      renderableTexturesLoaded,
      loadedTextures: this.loadedTextures.size,
      baselineMemoryAllocation: this.baselineMemoryAllocation
    };
  }
}
class CoreContextTexture {
  constructor(memManager, textureSource) {
    __publicField(this, "textureSource");
    __publicField(this, "memManager");
    __publicField(this, "state", "freed");
    this.memManager = memManager;
    this.textureSource = textureSource;
  }
  setTextureMemUse(byteSize) {
    this.memManager.setTextureMemUse(this.textureSource, byteSize);
  }
  get renderable() {
    return this.textureSource.renderable;
  }
}
class CoreRenderer {
  constructor(options) {
    __publicField(this, "options");
    __publicField(this, "mode");
    __publicField(this, "stage");
    //// Core Managers
    __publicField(this, "txManager");
    __publicField(this, "txMemManager");
    __publicField(this, "shManager");
    __publicField(this, "rttNodes", []);
    this.options = options;
    this.stage = options.stage;
    this.txManager = options.txManager;
    this.txMemManager = options.txMemManager;
    this.shManager = options.shManager;
  }
}
class CoreTextNode extends CoreNode {
  constructor(stage, props, textRenderer) {
    super(stage, props);
    __publicField(this, "textRenderer");
    __publicField(this, "trState");
    __publicField(this, "_textRendererOverride", null);
    __publicField(this, "onTextLoaded", () => {
      const { contain } = this;
      const setWidth = this.trState.props.width;
      const setHeight = this.trState.props.height;
      const calcWidth = this.trState.textW || 0;
      const calcHeight2 = this.trState.textH || 0;
      if (contain === "both") {
        this.props.width = setWidth;
        this.props.height = setHeight;
      } else if (contain === "width") {
        this.props.width = setWidth;
        this.props.height = calcHeight2;
      } else if (contain === "none") {
        this.props.width = calcWidth;
        this.props.height = calcHeight2;
      }
      this.updateLocalTransform();
      this.stage.requestRender();
      this.emit("loaded", {
        type: "text",
        dimensions: {
          width: this.trState.textW || 0,
          height: this.trState.textH || 0
        }
      });
    });
    __publicField(this, "onTextFailed", (target, error) => {
      this.emit("failed", {
        type: "text",
        error
      });
    });
    this._textRendererOverride = props.textRendererOverride;
    this.textRenderer = textRenderer;
    const textRendererState = this.createState({
      x: 0,
      y: 0,
      width: props.width,
      height: props.height,
      textAlign: props.textAlign,
      color: props.color,
      zIndex: props.zIndex,
      contain: props.contain,
      scrollable: props.scrollable,
      scrollY: props.scrollY,
      offsetY: props.offsetY,
      letterSpacing: props.letterSpacing,
      debug: props.debug,
      fontFamily: props.fontFamily,
      fontSize: props.fontSize,
      fontStretch: props.fontStretch,
      fontStyle: props.fontStyle,
      fontWeight: props.fontWeight,
      text: props.text,
      lineHeight: props.lineHeight,
      maxLines: props.maxLines,
      textBaseline: props.textBaseline,
      verticalAlign: props.verticalAlign,
      overflowSuffix: props.overflowSuffix
    });
    this.trState = textRendererState;
  }
  get width() {
    return this.props.width;
  }
  set width(value) {
    this.props.width = value;
    this.textRenderer.set.width(this.trState, value);
    if (this.contain === "none") {
      this.setUpdateType(UpdateType.Local);
    }
  }
  get height() {
    return this.props.height;
  }
  set height(value) {
    this.props.height = value;
    this.textRenderer.set.height(this.trState, value);
    if (this.contain !== "both") {
      this.setUpdateType(UpdateType.Local);
    }
  }
  get color() {
    return this.trState.props.color;
  }
  set color(value) {
    this.textRenderer.set.color(this.trState, value);
  }
  get text() {
    return this.trState.props.text;
  }
  set text(value) {
    this.textRenderer.set.text(this.trState, value);
  }
  get textRendererOverride() {
    return this._textRendererOverride;
  }
  set textRendererOverride(value) {
    this._textRendererOverride = value;
    this.textRenderer.destroyState(this.trState);
    const textRenderer = this.stage.resolveTextRenderer(this.trState.props, this._textRendererOverride);
    if (!textRenderer) {
      console.warn("Text Renderer not found for font", this.trState.props.fontFamily);
      return;
    }
    this.textRenderer = textRenderer;
    this.trState = this.createState(this.trState.props);
  }
  get fontSize() {
    return this.trState.props.fontSize;
  }
  set fontSize(value) {
    this.textRenderer.set.fontSize(this.trState, value);
  }
  get fontFamily() {
    return this.trState.props.fontFamily;
  }
  set fontFamily(value) {
    this.textRenderer.set.fontFamily(this.trState, value);
  }
  get fontStretch() {
    return this.trState.props.fontStretch;
  }
  set fontStretch(value) {
    this.textRenderer.set.fontStretch(this.trState, value);
  }
  get fontStyle() {
    return this.trState.props.fontStyle;
  }
  set fontStyle(value) {
    this.textRenderer.set.fontStyle(this.trState, value);
  }
  get fontWeight() {
    return this.trState.props.fontWeight;
  }
  set fontWeight(value) {
    this.textRenderer.set.fontWeight(this.trState, value);
  }
  get textAlign() {
    return this.trState.props.textAlign;
  }
  set textAlign(value) {
    this.textRenderer.set.textAlign(this.trState, value);
  }
  get contain() {
    return this.trState.props.contain;
  }
  set contain(value) {
    this.textRenderer.set.contain(this.trState, value);
  }
  get scrollable() {
    return this.trState.props.scrollable;
  }
  set scrollable(value) {
    this.textRenderer.set.scrollable(this.trState, value);
  }
  get scrollY() {
    return this.trState.props.scrollY;
  }
  set scrollY(value) {
    this.textRenderer.set.scrollY(this.trState, value);
  }
  get offsetY() {
    return this.trState.props.offsetY;
  }
  set offsetY(value) {
    this.textRenderer.set.offsetY(this.trState, value);
  }
  get letterSpacing() {
    return this.trState.props.letterSpacing;
  }
  set letterSpacing(value) {
    this.textRenderer.set.letterSpacing(this.trState, value);
  }
  get lineHeight() {
    return this.trState.props.lineHeight;
  }
  set lineHeight(value) {
    this.textRenderer.set.lineHeight(this.trState, value);
  }
  get maxLines() {
    return this.trState.props.maxLines;
  }
  set maxLines(value) {
    this.textRenderer.set.maxLines(this.trState, value);
  }
  get textBaseline() {
    return this.trState.props.textBaseline;
  }
  set textBaseline(value) {
    this.textRenderer.set.textBaseline(this.trState, value);
  }
  get verticalAlign() {
    return this.trState.props.verticalAlign;
  }
  set verticalAlign(value) {
    this.textRenderer.set.verticalAlign(this.trState, value);
  }
  get overflowSuffix() {
    return this.trState.props.overflowSuffix;
  }
  set overflowSuffix(value) {
    this.textRenderer.set.overflowSuffix(this.trState, value);
  }
  get debug() {
    return this.trState.props.debug;
  }
  set debug(value) {
    this.textRenderer.set.debug(this.trState, value);
  }
  update(delta, parentClippingRect) {
    super.update(delta, parentClippingRect);
    assertTruthy(this.globalTransform);
    this.textRenderer.set.x(this.trState, this.globalTransform.tx);
    this.textRenderer.set.y(this.trState, this.globalTransform.ty);
  }
  checkBasicRenderability() {
    if (this.worldAlpha === 0 || this.isOutOfBounds() === true) {
      return false;
    }
    if (this.trState && this.trState.props.text !== "") {
      return true;
    }
    return false;
  }
  setRenderable(isRenderable) {
    super.setRenderable(isRenderable);
    this.textRenderer.setIsRenderable(this.trState, isRenderable);
  }
  renderQuads(renderer2) {
    var _a2;
    assertTruthy(this.globalTransform);
    if (!this.textRenderer.renderQuads) {
      super.renderQuads(renderer2);
      return;
    }
    if (this.parentHasRenderTexture) {
      if (!renderer2.renderToTextureActive) {
        return;
      }
      if (this.parentRenderTexture !== renderer2.activeRttNode) {
        return;
      }
    }
    if (this.parentHasRenderTexture && ((_a2 = this.props.parent) == null ? void 0 : _a2.rtt)) {
      this.globalTransform = Matrix3d.identity();
      if (this.localTransform) {
        this.globalTransform.multiply(this.localTransform);
      }
    }
    assertTruthy(this.globalTransform);
    this.textRenderer.renderQuads(this.trState, this.globalTransform, this.clippingRect, this.worldAlpha, this.parentHasRenderTexture, this.framebufferDimensions);
  }
  /**
   * Destroy the node and cleanup all resources
   */
  destroy() {
    super.destroy();
    this.textRenderer.destroyState(this.trState);
  }
  /**
   * Resolve a text renderer and a new state based on the current text renderer props provided
   * @param props
   * @returns
   */
  createState(props) {
    const textRendererState = this.textRenderer.createState(props, this);
    textRendererState.emitter.on("loaded", this.onTextLoaded);
    textRendererState.emitter.on("failed", this.onTextFailed);
    this.textRenderer.scheduleUpdateState(textRendererState);
    return textRendererState;
  }
}
function santizeCustomDataMap(d) {
  const validTypes = {
    boolean: true,
    string: true,
    number: true,
    undefined: true
  };
  const keys = Object.keys(d);
  for (let i = 0; i < keys.length; i++) {
    const key = keys[i];
    if (!key) {
      continue;
    }
    const value = d[key];
    const valueType = typeof value;
    if (valueType === "string" && value.length > 2048) {
      console.warn("Custom Data value for ".concat(key, " is too long, it will be truncated to 2048 characters"));
      d[key] = value.substring(0, 2048);
    }
    if (!validTypes[valueType]) {
      console.warn("Custom Data value for ".concat(key, " is not a boolean, string, or number, it will be ignored"));
      delete d[key];
    }
  }
  return d;
}
const bufferMemory = 2e6;
class Stage {
  /**
   * Stage constructor
   */
  constructor(options) {
    __publicField(this, "options");
    /// Module Instances
    __publicField(this, "animationManager");
    __publicField(this, "txManager");
    __publicField(this, "txMemManager");
    __publicField(this, "fontManager");
    __publicField(this, "textRenderers");
    __publicField(this, "shManager");
    __publicField(this, "renderer");
    __publicField(this, "root");
    __publicField(this, "boundsMargin");
    __publicField(this, "defShaderCtr");
    __publicField(this, "strictBound");
    __publicField(this, "preloadBound");
    __publicField(this, "strictBounds");
    __publicField(this, "defaultTexture", null);
    /**
     * Target frame time in milliseconds (calculated from targetFPS)
     *
     * @remarks
     * This is pre-calculated to avoid recalculating on every frame.
     * - 0 means no throttling (use display refresh rate)
     * - >0 means throttle to this frame time (1000 / targetFPS)
     */
    __publicField(this, "targetFrameTime", 0);
    /**
     * Renderer Event Bus for the Stage to emit events onto
     *
     * @remarks
     * In reality this is just the RendererMain instance, which is an EventEmitter.
     * this allows us to directly emit events from the Stage to RendererMain
     * without having to set up forwarding handlers.
     */
    __publicField(this, "eventBus");
    /// State
    __publicField(this, "deltaTime", 0);
    __publicField(this, "lastFrameTime", 0);
    __publicField(this, "currentFrameTime", 0);
    __publicField(this, "fpsNumFrames", 0);
    __publicField(this, "fpsElapsedTime", 0);
    __publicField(this, "numQuadsRendered", 0);
    __publicField(this, "renderRequested", false);
    __publicField(this, "frameEventQueue", []);
    __publicField(this, "fontResolveMap", {});
    /// Debug data
    __publicField(this, "contextSpy", null);
    this.options = options;
    const { canvas, clearColor, appWidth, appHeight, boundsMargin, enableContextSpy, forceWebGL2, numImageWorkers: numImageWorkers2, textureMemory, renderEngine, fontEngines, createImageBitmapSupport } = options;
    this.eventBus = options.eventBus;
    this.targetFrameTime = options.targetFPS > 0 ? 1e3 / options.targetFPS : 0;
    this.txManager = new CoreTextureManager(this, {
      numImageWorkers: numImageWorkers2,
      createImageBitmapSupport
    });
    this.txManager.on("initialized", () => {
      this.requestRender();
    });
    this.txMemManager = new TextureMemoryManager(this, textureMemory);
    this.shManager = new CoreShaderManager();
    this.animationManager = new AnimationManager();
    this.contextSpy = enableContextSpy ? new ContextSpy() : null;
    this.strictBounds = options.strictBounds;
    let bm = [0, 0, 0, 0];
    if (boundsMargin) {
      bm = Array.isArray(boundsMargin) ? boundsMargin : [boundsMargin, boundsMargin, boundsMargin, boundsMargin];
    }
    this.boundsMargin = bm;
    this.strictBound = createBound(0, 0, appWidth, appHeight);
    this.preloadBound = createPreloadBounds(this.strictBound, bm);
    const rendererOptions = {
      stage: this,
      canvas,
      pixelRatio: options.devicePhysicalPixelRatio * options.deviceLogicalPixelRatio,
      clearColor: clearColor != null ? clearColor : 4278190080,
      bufferMemory,
      txManager: this.txManager,
      txMemManager: this.txMemManager,
      shManager: this.shManager,
      contextSpy: this.contextSpy,
      forceWebGL2
    };
    this.renderer = new renderEngine(rendererOptions);
    const renderMode = this.renderer.mode || "webgl";
    this.createDefaultTexture();
    this.defShaderCtr = this.renderer.getDefShaderCtr();
    setPremultiplyMode(renderMode);
    this.txManager.renderer = this.renderer;
    this.textRenderers = {};
    fontEngines.forEach((fontEngineConstructor) => {
      const fontEngineInstance = new fontEngineConstructor(this);
      const className = fontEngineInstance.type;
      if (className === "sdf" && renderMode === "canvas") {
        console.warn("SdfTextRenderer is not compatible with Canvas renderer. Skipping...");
        return;
      }
      if (fontEngineInstance instanceof TextRenderer) {
        if (className === "canvas") {
          this.textRenderers["canvas"] = fontEngineInstance;
        } else if (className === "sdf") {
          this.textRenderers["sdf"] = fontEngineInstance;
        }
      }
    });
    if (Object.keys(this.textRenderers).length === 0) {
      console.warn("No text renderers available. Your text will not render.");
    }
    this.fontManager = new TrFontManager(this.textRenderers);
    const rootNode2 = new CoreNode(this, {
      x: 0,
      y: 0,
      width: appWidth,
      height: appHeight,
      alpha: 1,
      autosize: false,
      boundsMargin: null,
      clipping: false,
      color: 0,
      colorTop: 0,
      colorBottom: 0,
      colorLeft: 0,
      colorRight: 0,
      colorTl: 0,
      colorTr: 0,
      colorBl: 0,
      colorBr: 0,
      zIndex: 0,
      zIndexLocked: 0,
      scaleX: 1,
      scaleY: 1,
      mountX: 0,
      mountY: 0,
      mount: 0,
      pivot: 0.5,
      pivotX: 0.5,
      pivotY: 0.5,
      rotation: 0,
      parent: null,
      texture: null,
      textureOptions: {},
      shader: this.defShaderCtr,
      rtt: false,
      src: null,
      scale: 1,
      preventCleanup: false,
      strictBounds: this.strictBounds
    });
    this.root = rootNode2;
    {
      startLoop(this);
    }
  }
  setClearColor(color) {
    this.renderer.updateClearColor(color);
    this.renderRequested = true;
  }
  /**
   * Update the target frame time based on the current targetFPS setting
   *
   * @remarks
   * This should be called whenever the targetFPS option is changed
   * to ensure targetFrameTime stays in sync.
   * targetFPS of 0 means no throttling (targetFrameTime = 0)
   * targetFPS > 0 means throttle to 1000/targetFPS milliseconds
   */
  updateTargetFrameTime() {
    this.targetFrameTime = this.options.targetFPS > 0 ? 1e3 / this.options.targetFPS : 0;
  }
  updateFrameTime() {
    const newFrameTime = getTimeStamp();
    this.lastFrameTime = this.currentFrameTime;
    this.currentFrameTime = newFrameTime;
    this.deltaTime = !this.lastFrameTime ? 100 / 6 : newFrameTime - this.lastFrameTime;
    this.txManager.frameTime = newFrameTime;
    this.txMemManager.frameTime = newFrameTime;
    this.eventBus.emit("frameTick", {
      time: this.currentFrameTime,
      delta: this.deltaTime
    });
  }
  /**
   * Create default PixelTexture
   */
  createDefaultTexture() {
    console.log("Creating default texture");
    this.defaultTexture = this.txManager.createTexture("ColorTexture", {
      color: 4294967295
    });
    assertTruthy(this.defaultTexture instanceof ColorTexture);
    this.txManager.loadTexture(this.defaultTexture, true);
    this.defaultTexture.setRenderableOwner(this, true);
    this.defaultTexture.once("loaded", () => {
      this.requestRender();
    });
  }
  /**
   * Update animations
   */
  updateAnimations() {
    const { animationManager } = this;
    if (!this.root) {
      return;
    }
    animationManager.update(this.deltaTime);
  }
  /**
   * Check if the scene has updates
   */
  hasSceneUpdates() {
    return !!this.root.updateType || this.renderRequested || this.txManager.hasUpdates();
  }
  /**
   * Start a new frame draw
   */
  drawFrame() {
    const { renderer: renderer2, renderRequested } = this;
    assertTruthy(renderer2);
    if (this.root.updateType !== 0) {
      this.root.update(this.deltaTime, this.root.clippingRect);
    }
    this.txManager.processSome(this.options.textureProcessingTimeLimit).catch((err) => {
      console.error("Error processing textures:", err);
    });
    renderer2.reset();
    if (this.txMemManager.criticalCleanupRequested === true) {
      this.txMemManager.cleanup(false);
      if (this.txMemManager.criticalCleanupRequested === true) {
        this.txMemManager.cleanup(true);
      }
    }
    if (renderer2.rttNodes.length > 0) {
      renderer2.renderRTTNodes();
    }
    this.addQuads(this.root);
    renderer2 == null ? void 0 : renderer2.render();
    this.calculateFps();
    this.calculateQuads();
    if (renderRequested) {
      this.renderRequested = false;
    }
  }
  /**
   * Queue an event to be emitted after the current/next frame is rendered
   *
   * @remarks
   * When we are operating in the context of the render loop, we may want to
   * emit events that are related to the current frame. However, we generally do
   * NOT want to emit events directly in the middle of the render loop, since
   * this could enable event handlers to modify the scene graph and cause
   * unexpected behavior. Instead, we queue up events to be emitted and then
   * flush the queue after the frame has been rendered.
   *
   * @param name
   * @param data
   */
  queueFrameEvent(name, data) {
    this.frameEventQueue.push([name, data]);
  }
  /**
   * Emit all queued frame events
   *
   * @remarks
   * This method should be called after the frame has been rendered to emit
   * all events that were queued during the frame.
   *
   * See {@link queueFrameEvent} for more information.
   */
  flushFrameEvents() {
    for (const [name, data] of this.frameEventQueue) {
      this.eventBus.emit(name, data);
    }
    this.frameEventQueue = [];
  }
  calculateFps() {
    var _a2, _b, _c;
    const { fpsUpdateInterval } = this.options;
    if (fpsUpdateInterval) {
      this.fpsNumFrames++;
      this.fpsElapsedTime += this.deltaTime;
      if (this.fpsElapsedTime >= fpsUpdateInterval) {
        const fps2 = Math.round(this.fpsNumFrames * 1e3 / this.fpsElapsedTime);
        this.fpsNumFrames = 0;
        this.fpsElapsedTime = 0;
        this.queueFrameEvent("fpsUpdate", {
          fps: fps2,
          contextSpyData: (_b = (_a2 = this.contextSpy) == null ? void 0 : _a2.getData()) != null ? _b : null
        });
        (_c = this.contextSpy) == null ? void 0 : _c.reset();
      }
    }
  }
  calculateQuads() {
    const quads = this.renderer.getQuadCount();
    if (quads && quads !== this.numQuadsRendered) {
      this.numQuadsRendered = quads;
      this.queueFrameEvent("quadsUpdate", {
        quads
      });
    }
  }
  addQuads(node) {
    assertTruthy(this.renderer);
    if (node.isRenderable === true) {
      node.renderQuads(this.renderer);
    }
    for (let i = 0; i < node.children.length; i++) {
      const child = node.children[i];
      if (child === void 0) {
        continue;
      }
      if (child.worldAlpha === 0 || child.strictBounds === true && child.renderState === CoreNodeRenderState.OutOfBounds) {
        continue;
      }
      this.addQuads(child);
    }
  }
  /**
   * Request a render pass without forcing an update
   */
  requestRender() {
    this.renderRequested = true;
  }
  /**
   * Given a font name, and possible renderer override, return the best compatible text renderer.
   *
   * @remarks
   * Will try to return a canvas renderer if no other suitable renderer can be resolved.
   *
   * @param fontFamily
   * @param textRendererOverride
   * @returns
   */
  resolveTextRenderer(trProps, textRendererOverride = null) {
    const fontCacheString = "".concat(trProps.fontFamily).concat(trProps.fontStyle).concat(trProps.fontWeight).concat(trProps.fontStretch).concat(textRendererOverride ? textRendererOverride : "");
    if (this.fontResolveMap[fontCacheString] !== void 0) {
      return this.fontResolveMap[fontCacheString];
    }
    let rendererId = textRendererOverride;
    let overrideFallback = false;
    if (rendererId) {
      const possibleRenderer = this.textRenderers[rendererId];
      if (!possibleRenderer) {
        console.warn("Text renderer override '".concat(rendererId, "' not found."));
        rendererId = null;
        overrideFallback = true;
      } else if (!possibleRenderer.canRenderFont(trProps)) {
        console.warn("Cannot use override text renderer '".concat(rendererId, "' for font"), trProps);
        rendererId = null;
        overrideFallback = true;
      }
    }
    if (!rendererId) {
      for (const [trId, tr] of Object.entries(this.textRenderers)) {
        if (tr.canRenderFont(trProps)) {
          rendererId = trId;
          break;
        }
      }
      if (!rendererId && this.textRenderers.canvas !== void 0) {
        rendererId = "canvas";
      }
    }
    if (overrideFallback) {
      console.warn("Falling back to text renderer ".concat(String(rendererId)));
    }
    if (!rendererId) {
      return null;
    }
    const resolvedTextRenderer = this.textRenderers[rendererId];
    assertTruthy(resolvedTextRenderer, "resolvedTextRenderer undefined");
    this.fontResolveMap[fontCacheString] = resolvedTextRenderer;
    return resolvedTextRenderer;
  }
  /**
   * Create a shader controller instance
   *
   * @param type
   * @param props
   * @returns
   */
  createShaderCtr(type, props) {
    return this.shManager.loadShader(type, props);
  }
  createNode(props) {
    const resolvedProps = this.resolveNodeDefaults(props);
    return new CoreNode(this, resolvedProps);
  }
  createTextNode(props) {
    var _a2, _b, _c, _d, _e, _f, _g, _h, _i, _j, _k, _l, _m, _n, _o, _p, _q, _r;
    const fontSize = (_a2 = props.fontSize) != null ? _a2 : 16;
    const resolvedProps = {
      ...this.resolveNodeDefaults(props),
      text: (_b = props.text) != null ? _b : "",
      textRendererOverride: (_c = props.textRendererOverride) != null ? _c : null,
      fontSize,
      fontFamily: (_d = props.fontFamily) != null ? _d : "sans-serif",
      fontStyle: (_e = props.fontStyle) != null ? _e : "normal",
      fontWeight: (_f = props.fontWeight) != null ? _f : "normal",
      fontStretch: (_g = props.fontStretch) != null ? _g : "normal",
      textAlign: (_h = props.textAlign) != null ? _h : "left",
      contain: (_i = props.contain) != null ? _i : "none",
      scrollable: (_j = props.scrollable) != null ? _j : false,
      scrollY: (_k = props.scrollY) != null ? _k : 0,
      offsetY: (_l = props.offsetY) != null ? _l : 0,
      letterSpacing: (_m = props.letterSpacing) != null ? _m : 0,
      lineHeight: props.lineHeight,
      // `undefined` is a valid value
      maxLines: (_n = props.maxLines) != null ? _n : 0,
      textBaseline: (_o = props.textBaseline) != null ? _o : "alphabetic",
      verticalAlign: (_p = props.verticalAlign) != null ? _p : "middle",
      overflowSuffix: (_q = props.overflowSuffix) != null ? _q : "...",
      debug: (_r = props.debug) != null ? _r : {},
      shaderProps: null
    };
    const resolvedTextRenderer = this.resolveTextRenderer(resolvedProps, props.textRendererOverride);
    if (!resolvedTextRenderer) {
      throw new Error("No compatible text renderer found for ".concat(resolvedProps.fontFamily));
    }
    return new CoreTextNode(this, resolvedProps, resolvedTextRenderer);
  }
  setBoundsMargin(value) {
    this.boundsMargin = Array.isArray(value) ? value : [value, value, value, value];
    this.root.setUpdateType(UpdateType.RenderBounds);
  }
  /**
   * Resolves the default property values for a Node
   *
   * @remarks
   * This method is used internally by the RendererMain to resolve the default
   * property values for a Node. It is exposed publicly so that it can be used
   * by Core Driver implementations.
   *
   * @param props
   * @returns
   */
  resolveNodeDefaults(props) {
    var _a2, _b, _c, _d, _e, _f, _g, _h, _i, _j, _k, _l, _m, _n, _o, _p, _q, _r, _s, _t, _u, _v, _w, _x, _y, _z, _A, _B, _C, _D, _E, _F, _G, _H, _I, _J, _K, _L, _M, _N, _O, _P, _Q, _R, _S, _T, _U, _V, _W, _X, _Y, _Z;
    const color = (_a2 = props.color) != null ? _a2 : 4294967295;
    const colorTl = (_d = (_c = (_b = props.colorTl) != null ? _b : props.colorTop) != null ? _c : props.colorLeft) != null ? _d : color;
    const colorTr = (_g = (_f = (_e = props.colorTr) != null ? _e : props.colorTop) != null ? _f : props.colorRight) != null ? _g : color;
    const colorBl = (_j = (_i = (_h = props.colorBl) != null ? _h : props.colorBottom) != null ? _i : props.colorLeft) != null ? _j : color;
    const colorBr = (_m = (_l = (_k = props.colorBr) != null ? _k : props.colorBottom) != null ? _l : props.colorRight) != null ? _m : color;
    let data = {};
    if (this.options.inspector === true) {
      data = santizeCustomDataMap((_n = props.data) != null ? _n : {});
    }
    return {
      x: (_o = props.x) != null ? _o : 0,
      y: (_p = props.y) != null ? _p : 0,
      width: (_q = props.width) != null ? _q : 0,
      height: (_r = props.height) != null ? _r : 0,
      alpha: (_s = props.alpha) != null ? _s : 1,
      autosize: (_t = props.autosize) != null ? _t : false,
      boundsMargin: (_u = props.boundsMargin) != null ? _u : null,
      clipping: (_v = props.clipping) != null ? _v : false,
      color,
      colorTop: (_w = props.colorTop) != null ? _w : color,
      colorBottom: (_x = props.colorBottom) != null ? _x : color,
      colorLeft: (_y = props.colorLeft) != null ? _y : color,
      colorRight: (_z = props.colorRight) != null ? _z : color,
      colorBl,
      colorBr,
      colorTl,
      colorTr,
      zIndex: (_A = props.zIndex) != null ? _A : 0,
      zIndexLocked: (_B = props.zIndexLocked) != null ? _B : 0,
      parent: (_C = props.parent) != null ? _C : null,
      texture: (_D = props.texture) != null ? _D : null,
      textureOptions: (_E = props.textureOptions) != null ? _E : {},
      shader: (_F = props.shader) != null ? _F : this.defShaderCtr,
      // Since setting the `src` will trigger a texture load, we need to set it after
      // we set the texture. Otherwise, problems happen.
      src: (_G = props.src) != null ? _G : null,
      srcHeight: props.srcHeight,
      srcWidth: props.srcWidth,
      srcX: props.srcX,
      srcY: props.srcY,
      scale: (_H = props.scale) != null ? _H : null,
      scaleX: (_J = (_I = props.scaleX) != null ? _I : props.scale) != null ? _J : 1,
      scaleY: (_L = (_K = props.scaleY) != null ? _K : props.scale) != null ? _L : 1,
      mount: (_M = props.mount) != null ? _M : 0,
      mountX: (_O = (_N = props.mountX) != null ? _N : props.mount) != null ? _O : 0,
      mountY: (_Q = (_P = props.mountY) != null ? _P : props.mount) != null ? _Q : 0,
      pivot: (_R = props.pivot) != null ? _R : 0.5,
      pivotX: (_T = (_S = props.pivotX) != null ? _S : props.pivot) != null ? _T : 0.5,
      pivotY: (_V = (_U = props.pivotY) != null ? _U : props.pivot) != null ? _V : 0.5,
      rotation: (_W = props.rotation) != null ? _W : 0,
      rtt: (_X = props.rtt) != null ? _X : false,
      data,
      preventCleanup: (_Y = props.preventCleanup) != null ? _Y : false,
      imageType: props.imageType,
      strictBounds: (_Z = props.strictBounds) != null ? _Z : this.strictBounds
    };
  }
  /**
   * Cleanup Orphaned Textures
   *
   * @remarks
   * This method is used to cleanup orphaned textures that are no longer in use.
   */
  cleanup(aggressive) {
    this.txMemManager.cleanup(aggressive);
  }
}
class RendererMain extends EventEmitter {
  /**
   * Constructs a new Renderer instance
   *
   * @param settings Renderer settings
   * @param target Element ID or HTMLElement to insert the canvas into
   * @param driver Core Driver to use
   */
  constructor(settings, target) {
    var _a2, _b, _c, _d, _e, _f, _g, _h, _i, _j, _k, _l;
    super();
    __publicField(this, "root");
    __publicField(this, "canvas");
    __publicField(this, "settings");
    __publicField(this, "stage");
    __publicField(this, "inspector", null);
    const resolvedTxSettings = {
      criticalThreshold: ((_a2 = settings.textureMemory) == null ? void 0 : _a2.criticalThreshold) || 124e6,
      targetThresholdLevel: ((_b = settings.textureMemory) == null ? void 0 : _b.targetThresholdLevel) || 0.5,
      cleanupInterval: ((_c = settings.textureMemory) == null ? void 0 : _c.cleanupInterval) || 5e3,
      debugLogging: ((_d = settings.textureMemory) == null ? void 0 : _d.debugLogging) || false,
      baselineMemoryAllocation: ((_e = settings.textureMemory) == null ? void 0 : _e.baselineMemoryAllocation) || 26e6,
      doNotExceedCriticalThreshold: ((_f = settings.textureMemory) == null ? void 0 : _f.doNotExceedCriticalThreshold) || false
    };
    const resolvedSettings = {
      appWidth: settings.appWidth || 1920,
      appHeight: settings.appHeight || 1080,
      textureMemory: resolvedTxSettings,
      boundsMargin: settings.boundsMargin || 0,
      deviceLogicalPixelRatio: settings.deviceLogicalPixelRatio || 1,
      devicePhysicalPixelRatio: settings.devicePhysicalPixelRatio || window.devicePixelRatio,
      clearColor: (_g = settings.clearColor) != null ? _g : 0,
      fpsUpdateInterval: settings.fpsUpdateInterval || 0,
      targetFPS: settings.targetFPS || 0,
      numImageWorkers: settings.numImageWorkers !== void 0 ? settings.numImageWorkers : 2,
      enableContextSpy: (_h = settings.enableContextSpy) != null ? _h : false,
      forceWebGL2: (_i = settings.forceWebGL2) != null ? _i : false,
      inspector: (_j = settings.inspector) != null ? _j : false,
      renderEngine: settings.renderEngine,
      quadBufferSize: (_k = settings.quadBufferSize) != null ? _k : 4 * 1024 * 1024,
      fontEngines: settings.fontEngines,
      strictBounds: (_l = settings.strictBounds) != null ? _l : true,
      textureProcessingTimeLimit: settings.textureProcessingTimeLimit || 42,
      canvas: settings.canvas || document.createElement("canvas"),
      createImageBitmapSupport: settings.createImageBitmapSupport || "full"
    };
    this.settings = resolvedSettings;
    const { appWidth, appHeight, deviceLogicalPixelRatio: deviceLogicalPixelRatio2, devicePhysicalPixelRatio, inspector, canvas } = resolvedSettings;
    const deviceLogicalWidth = appWidth * deviceLogicalPixelRatio2;
    const deviceLogicalHeight = appHeight * deviceLogicalPixelRatio2;
    this.canvas = canvas;
    canvas.width = deviceLogicalWidth * devicePhysicalPixelRatio;
    canvas.height = deviceLogicalHeight * devicePhysicalPixelRatio;
    canvas.style.width = "".concat(deviceLogicalWidth, "px");
    canvas.style.height = "".concat(deviceLogicalHeight, "px");
    this.stage = new Stage({
      appWidth: this.settings.appWidth,
      appHeight: this.settings.appHeight,
      boundsMargin: this.settings.boundsMargin,
      clearColor: this.settings.clearColor,
      canvas: this.canvas,
      deviceLogicalPixelRatio: this.settings.deviceLogicalPixelRatio,
      devicePhysicalPixelRatio: this.settings.devicePhysicalPixelRatio,
      enableContextSpy: this.settings.enableContextSpy,
      forceWebGL2: this.settings.forceWebGL2,
      fpsUpdateInterval: this.settings.fpsUpdateInterval,
      targetFPS: this.settings.targetFPS,
      numImageWorkers: this.settings.numImageWorkers,
      renderEngine: this.settings.renderEngine,
      textureMemory: resolvedTxSettings,
      eventBus: this,
      quadBufferSize: this.settings.quadBufferSize,
      fontEngines: this.settings.fontEngines,
      inspector: this.settings.inspector !== null,
      strictBounds: this.settings.strictBounds,
      textureProcessingTimeLimit: this.settings.textureProcessingTimeLimit,
      createImageBitmapSupport: this.settings.createImageBitmapSupport
    });
    this.root = this.stage.root;
    let targetEl;
    if (typeof target === "string") {
      targetEl = document.getElementById(target);
    } else {
      targetEl = target;
    }
    if (!targetEl) {
      throw new Error("Could not find target element");
    }
    targetEl.appendChild(canvas);
    if (inspector && !isProductionEnvironment()) {
      this.inspector = new inspector(canvas, resolvedSettings);
    }
  }
  /**
   * Create a new scene graph node
   *
   * @remarks
   * A node is the main graphical building block of the Renderer scene graph. It
   * can be a container for other nodes, or it can be a leaf node that renders a
   * solid color, gradient, image, or specific texture, using a specific shader.
   *
   * To create a text node, see {@link createTextNode}.
   *
   * See {@link CoreNode} for more details.
   *
   * @param props
   * @returns
   */
  createNode(props) {
    const node = this.stage.createNode(props);
    if (this.inspector) {
      return this.inspector.createNode(node);
    }
    return node;
  }
  /**
   * Create a new scene graph text node
   *
   * @remarks
   * A text node is the second graphical building block of the Renderer scene
   * graph. It renders text using a specific text renderer that is automatically
   * chosen based on the font requested and what type of fonts are installed
   * into an app.
   *
   * See {@link ITextNode} for more details.
   *
   * @param props
   * @returns
   */
  createTextNode(props) {
    const textNode = this.stage.createTextNode(props);
    if (this.inspector) {
      return this.inspector.createTextNode(textNode);
    }
    return textNode;
  }
  /**
   * Destroy a node
   *
   * @remarks
   * This method destroys a node
   *
   * @param node
   * @returns
   */
  destroyNode(node) {
    if (this.inspector) {
      this.inspector.destroyNode(node.id);
    }
    return node.destroy();
  }
  /**
   * Create a new texture reference
   *
   * @remarks
   * This method creates a new reference to a texture. The texture is not
   * loaded until it is used on a node.
   *
   * It can be assigned to a node's `texture` property, or it can be used
   * when creating a SubTexture.
   *
   * @param textureType
   * @param props
   * @param options
   * @returns
   */
  createTexture(textureType, props) {
    return this.stage.txManager.createTexture(textureType, props);
  }
  /**
   * Create a new shader controller for a shader type
   *
   * @remarks
   * This method creates a new Shader Controller for a specific shader type.
   *
   * If the shader has not been loaded yet, it will be loaded. Otherwise, the
   * existing shader will be reused.
   *
   * It can be assigned to a Node's `shader` property.
   *
   * @param shaderType
   * @param props
   * @returns
   */
  createShader(shaderType, props) {
    return this.stage.shManager.loadShader(shaderType, props);
  }
  /**
   * Create a new Dynamic Shader controller
   *
   * @remarks
   * A Dynamic Shader is a shader that can be composed of an array of mulitple
   * effects. Each effect can be animated or changed after creation (provided
   * the effect is given a name).
   *
   * Example:
   * ```ts
   * renderer.createNode({
   *   shader: renderer.createDynamicShader([
   *     renderer.createEffect('radius', {
   *       radius: 0
   *     }, 'effect1'),
   *     renderer.createEffect('border', {
   *       color: 0xff00ffff,
   *       width: 10,
   *     }, 'effect2'),
   *   ]),
   * });
   * ```
   *
   * @param effects
   * @returns
   */
  createDynamicShader(effects) {
    return this.stage.shManager.loadDynamicShader({
      effects
    });
  }
  /**
   * Create an effect to be used in a Dynamic Shader
   *
   * @remark
   * The {name} parameter is optional but required if you want to animate the effect
   * or change the effect's properties after creation.
   *
   * See {@link createDynamicShader} for an example.
   *
   * @param type
   * @param props
   * @param name
   * @returns
   */
  createEffect(type, props, name) {
    return {
      name,
      type,
      props
    };
  }
  /**
   * Get a Node by its ID
   *
   * @param id
   * @returns
   */
  getNodeById(id) {
    var _a2;
    const root = (_a2 = this.stage) == null ? void 0 : _a2.root;
    if (!root) {
      return null;
    }
    const findNode = (node) => {
      if (node.id === id) {
        return node;
      }
      for (const child of node.children) {
        const found = findNode(child);
        if (found) {
          return found;
        }
      }
      return null;
    };
    return findNode(root);
  }
  toggleFreeze() {
    throw new Error("Not implemented");
  }
  advanceFrame() {
    throw new Error("Not implemented");
  }
  getBufferInfo() {
    return this.stage.renderer.getBufferInfo();
  }
  /**
   * Re-render the current frame without advancing any running animations.
   *
   * @remarks
   * Any state changes will be reflected in the re-rendered frame. Useful for
   * debugging.
   *
   * May not do anything if the render loop is running on a separate worker.
   */
  rerender() {
    this.stage.requestRender();
  }
  /**
   * Cleanup textures that are not being used
   *
   * @param aggressive - If true, will cleanup all textures, regardless of render status
   *
   * @remarks
   * This can be used to free up GFX memory used by textures that are no longer
   * being displayed.
   *
   * This routine is also called automatically when the memory used by textures
   * exceeds the critical threshold on frame generation **OR** when the renderer
   * is idle and the memory used by textures exceeds the target threshold.
   *
   * **NOTE**: This is a heavy operation and should be used sparingly.
   * **NOTE2**: This will not cleanup textures that are currently being displayed.
   * **NOTE3**: This will not cleanup textures that are marked as `preventCleanup`.
   * **NOTE4**: This has nothing to do with the garbage collection of JavaScript.
   */
  cleanup(aggressive = false) {
    this.stage.cleanup(aggressive);
  }
  /**
   * Sets the clear color for the stage.
   *
   * @param color - The color to set as the clear color.
   */
  setClearColor(color) {
    this.stage.setClearColor(color);
  }
  /**
   * Gets the target FPS for the global render loop
   *
   * @returns The current target FPS (0 means no throttling)
   *
   * @remarks
   * This controls the maximum frame rate of the entire rendering system.
   * When 0, the system runs at display refresh rate.
   */
  get targetFPS() {
    return this.stage.options.targetFPS;
  }
  /**
   * Sets the target FPS for the global render loop
   *
   * @param fps - The target FPS to set for the global render loop.
   *              Set to 0 or a negative value to disable throttling.
   *
   * @remarks
   * This setting affects the entire rendering system immediately.
   * All animations, rendering, and frame updates will be throttled
   * to this target FPS. Provides global performance control.
   *
   * @example
   * ```typescript
   * // Set global target to 30fps for better performance
   * renderer.targetFPS = 30;
   *
   * // Disable global throttling (use display refresh rate)
   * renderer.targetFPS = 0;
   * ```
   */
  set targetFPS(fps2) {
    this.stage.options.targetFPS = fps2 > 0 ? fps2 : 0;
    this.stage.updateTargetFrameTime();
  }
}
class TrFontFace extends EventEmitter {
  constructor(options) {
    super();
    __publicField(this, "fontFamily");
    __publicField(this, "descriptors");
    __publicField(this, "loaded", false);
    __publicField(this, "metrics", null);
    const { fontFamily, descriptors, metrics } = options;
    if (metrics) {
      this.metrics = {
        ascender: metrics.ascender / metrics.unitsPerEm,
        descender: metrics.descender / metrics.unitsPerEm,
        lineGap: metrics.lineGap / metrics.unitsPerEm
      };
    }
    this.fontFamily = fontFamily;
    this.descriptors = {
      style: "normal",
      weight: "normal",
      stretch: "normal",
      ...descriptors
    };
  }
  /**
   * Convert a TrFontFaceDescriptors to a FontFaceDescriptors which differ slightly
   *
   * @param descriptors
   * @returns
   */
  static convertToCssFontFaceDescriptors(descriptors) {
    return {
      style: descriptors.style,
      weight: typeof descriptors.weight === "number" ? "".concat(descriptors.weight) : descriptors.weight,
      stretch: descriptors.stretch,
      unicodeRange: descriptors.unicodeRange,
      featureSettings: descriptors.featureSettings,
      display: descriptors.display
    };
  }
}
class WebTrFontFace extends TrFontFace {
  constructor(options) {
    super(options);
    __publicField(this, "fontFace");
    __publicField(this, "fontUrl");
    const { fontFamily, fontUrl } = options;
    const fontUrlWithoutParentheses = fontUrl.replace(/\(|\)/g, "");
    const determinedDescriptors = this.descriptors;
    let cssDescriptors = {
      style: determinedDescriptors.style,
      weight: typeof determinedDescriptors.weight === "number" ? "".concat(determinedDescriptors.weight) : determinedDescriptors.weight,
      stretch: determinedDescriptors.stretch,
      unicodeRange: determinedDescriptors.unicodeRange,
      featureSettings: determinedDescriptors.featureSettings,
      display: determinedDescriptors.display
    };
    for (const k in cssDescriptors) {
      const key = k;
      if (cssDescriptors[key] === void 0) {
        delete cssDescriptors[key];
      }
    }
    const fontFace = new FontFace(fontFamily, "url(".concat(fontUrlWithoutParentheses, ")"), cssDescriptors);
    if (fontUrlWithoutParentheses.length > 0) {
      fontFace.load().then(() => {
        this.loaded = true;
        this.emit("loaded");
      }).catch(console.error);
    } else {
      this.loaded = true;
      this.emit("loaded");
    }
    this.fontFace = fontFace;
    this.fontUrl = fontUrl;
  }
}
class CoreRenderOp {
}
class WebGlCoreRenderOp extends CoreRenderOp {
  constructor(glw, options, buffers, shader, shaderProps, alpha, clippingRect, dimensions, bufferIdx, zIndex, renderToTexture, parentHasRenderTexture, framebufferDimensions) {
    super();
    __publicField(this, "glw");
    __publicField(this, "options");
    __publicField(this, "buffers");
    __publicField(this, "shader");
    __publicField(this, "shaderProps");
    __publicField(this, "alpha");
    __publicField(this, "clippingRect");
    __publicField(this, "dimensions");
    __publicField(this, "bufferIdx");
    __publicField(this, "zIndex");
    __publicField(this, "renderToTexture");
    __publicField(this, "parentHasRenderTexture");
    __publicField(this, "framebufferDimensions");
    __publicField(this, "length", 0);
    __publicField(this, "numQuads", 0);
    __publicField(this, "textures", []);
    __publicField(this, "maxTextures");
    this.glw = glw;
    this.options = options;
    this.buffers = buffers;
    this.shader = shader;
    this.shaderProps = shaderProps;
    this.alpha = alpha;
    this.clippingRect = clippingRect;
    this.dimensions = dimensions;
    this.bufferIdx = bufferIdx;
    this.zIndex = zIndex;
    this.renderToTexture = renderToTexture;
    this.parentHasRenderTexture = parentHasRenderTexture;
    this.framebufferDimensions = framebufferDimensions;
    this.maxTextures = shader.supportsIndexedTextures ? glw.getParameter(glw.MAX_VERTEX_TEXTURE_IMAGE_UNITS) : 1;
  }
  addTexture(texture) {
    const { textures, maxTextures } = this;
    let existingIdx = -1;
    const texturesLength = textures.length;
    for (let i = 0; i < texturesLength; i++) {
      const t = textures[i];
      if (t === texture) {
        existingIdx = i;
        break;
      }
    }
    if (existingIdx !== -1) {
      return existingIdx;
    }
    if (texturesLength >= maxTextures) {
      return 4294967295;
    }
    this.textures.push(texture);
    return texturesLength;
  }
  draw() {
    const { glw, shader, shaderProps, options } = this;
    const { shManager } = options;
    shManager.useShader(shader);
    shader.bindRenderOp(this, shaderProps);
    const quadIdx = this.bufferIdx / 24 * 6 * 2;
    if (this.clippingRect.valid) {
      const { x, y, width, height } = this.clippingRect;
      const pixelRatio = this.parentHasRenderTexture ? 1 : options.pixelRatio;
      const canvasHeight = options.canvas.height;
      const clipX = Math.round(x * pixelRatio);
      const clipWidth = Math.round(width * pixelRatio);
      const clipHeight = Math.round(height * pixelRatio);
      let clipY = Math.round(canvasHeight - clipHeight - y * pixelRatio);
      if (this.parentHasRenderTexture) {
        clipY = this.framebufferDimensions ? this.framebufferDimensions.height - this.dimensions.height : 0;
      }
      glw.setScissorTest(true);
      glw.scissor(clipX, clipY, clipWidth, clipHeight);
    } else {
      glw.setScissorTest(false);
    }
    glw.drawElements(glw.TRIANGLES, 6 * this.numQuads, glw.UNSIGNED_SHORT, quadIdx);
  }
}
function getWebGlParameters(glw) {
  const params2 = {
    MAX_RENDERBUFFER_SIZE: 0,
    MAX_TEXTURE_SIZE: 0,
    // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment, @typescript-eslint/no-explicit-any
    MAX_VIEWPORT_DIMS: 0,
    // Code below will replace this with an Int32Array
    MAX_VERTEX_TEXTURE_IMAGE_UNITS: 0,
    MAX_TEXTURE_IMAGE_UNITS: 0,
    MAX_COMBINED_TEXTURE_IMAGE_UNITS: 0,
    MAX_VERTEX_ATTRIBS: 0,
    MAX_VARYING_VECTORS: 0,
    MAX_VERTEX_UNIFORM_VECTORS: 0,
    MAX_FRAGMENT_UNIFORM_VECTORS: 0
  };
  const keys = Object.keys(params2);
  keys.forEach((key) => {
    params2[key] = glw.getParameter(glw[key]);
  });
  return params2;
}
function getWebGlExtensions(glw) {
  const extensions = {
    ANGLE_instanced_arrays: null,
    WEBGL_compressed_texture_s3tc: null,
    WEBGL_compressed_texture_astc: null,
    WEBGL_compressed_texture_etc: null,
    WEBGL_compressed_texture_etc1: null,
    WEBGL_compressed_texture_pvrtc: null,
    WEBKIT_WEBGL_compressed_texture_pvrtc: null,
    WEBGL_compressed_texture_s3tc_srgb: null,
    OES_vertex_array_object: null
  };
  const keys = Object.keys(extensions);
  keys.forEach((key) => {
    extensions[key] = glw.getExtension(key);
  });
  return extensions;
}
function createIndexBuffer(glw, size) {
  const maxQuads = ~~(size / 80);
  const indices = new Uint16Array(maxQuads * 6);
  for (let i = 0, j = 0; i < maxQuads; i += 6, j += 4) {
    indices[i] = j;
    indices[i + 1] = j + 1;
    indices[i + 2] = j + 2;
    indices[i + 3] = j + 2;
    indices[i + 4] = j + 1;
    indices[i + 5] = j + 3;
  }
  const buffer = glw.createBuffer();
  glw.elementArrayBufferData(buffer, indices, glw.STATIC_DRAW);
}
function isHTMLImageElement(obj) {
  return obj !== null && (typeof obj === "object" && obj.constructor && obj.constructor.name === "HTMLImageElement" || typeof HTMLImageElement !== "undefined" && obj instanceof HTMLImageElement);
}
const TRANSPARENT_TEXTURE_DATA = new Uint8Array([0, 0, 0, 0]);
class WebGlCoreCtxTexture extends CoreContextTexture {
  constructor(glw, memManager, textureSource) {
    super(memManager, textureSource);
    __publicField(this, "glw");
    __publicField(this, "_nativeCtxTexture", null);
    __publicField(this, "_w", 0);
    __publicField(this, "_h", 0);
    this.glw = glw;
  }
  get ctxTexture() {
    if (this.state === "freed") {
      this.load();
      return null;
    }
    assertTruthy(this._nativeCtxTexture);
    return this._nativeCtxTexture;
  }
  get w() {
    return this._w;
  }
  get h() {
    return this._h;
  }
  /**
   * Load the texture data from the Texture source and upload it to the GPU
   *
   * @remarks
   * This method is called automatically when accessing the ctxTexture property
   * if the texture hasn't been loaded yet. But it can also be called manually
   * to force the texture to be pre-loaded prior to accessing the ctxTexture
   * property.
   */
  async load() {
    if (this.state === "loading" || this.state === "loaded") {
      return Promise.resolve();
    }
    this.state = "loading";
    this.textureSource.setState("loading");
    this._nativeCtxTexture = this.createNativeCtxTexture();
    if (this._nativeCtxTexture === null) {
      this.state = "failed";
      const error = new Error("Could not create WebGL Texture");
      this.textureSource.setState("failed", error);
      console.error("Could not create WebGL Texture");
      throw error;
    }
    try {
      const { width, height } = await this.onLoadRequest();
      if (this.state === "freed") {
        return;
      }
      this.state = "loaded";
      this._w = width;
      this._h = height;
      this.textureSource.setState("loaded", { width, height });
      queueMicrotask(() => {
        this.textureSource.freeTextureData();
      });
    } catch (err) {
      if (this.state === "freed") {
        return;
      }
      this.state = "failed";
      const error = err instanceof Error ? err : new Error(String(err));
      this.textureSource.setState("failed", error);
      this.textureSource.freeTextureData();
      console.error(err);
      throw error;
    }
  }
  /**
   * Called when the texture data needs to be loaded and uploaded to a texture
   */
  async onLoadRequest() {
    var _a2;
    const { glw } = this;
    const textureData = this.textureSource.textureData;
    if (textureData === null || this._nativeCtxTexture === null) {
      throw new Error("Texture data or native texture is null " + this.textureSource.type);
    }
    glw.texImage2D(0, glw.RGBA, 1, 1, 0, glw.RGBA, glw.UNSIGNED_BYTE, null);
    this.setTextureMemUse(TRANSPARENT_TEXTURE_DATA.byteLength);
    let width = 0;
    let height = 0;
    glw.activeTexture(0);
    const tdata = textureData.data;
    const format = glw.RGBA;
    const formatBytes = 4;
    const memoryPadding = 1.1;
    if (typeof ImageBitmap !== "undefined" && tdata instanceof ImageBitmap || tdata instanceof ImageData || // not using typeof HTMLImageElement due to web worker
    isHTMLImageElement(tdata)) {
      width = tdata.width;
      height = tdata.height;
      glw.bindTexture(this._nativeCtxTexture);
      glw.pixelStorei(glw.UNPACK_PREMULTIPLY_ALPHA_WEBGL, !!textureData.premultiplyAlpha);
      glw.texImage2D(0, format, format, glw.UNSIGNED_BYTE, tdata);
      this.setTextureMemUse(height * width * formatBytes * memoryPadding);
    } else if (tdata === null) {
      width = 0;
      height = 0;
      glw.bindTexture(this._nativeCtxTexture);
      glw.texImage2D(0, format, 1, 1, 0, format, glw.UNSIGNED_BYTE, TRANSPARENT_TEXTURE_DATA);
      this.setTextureMemUse(TRANSPARENT_TEXTURE_DATA.byteLength);
    } else if ("mipmaps" in tdata && tdata.mipmaps) {
      const { mipmaps, width: width2 = 0, height: height2 = 0, type, glInternalFormat } = tdata;
      const view = type === "ktx" ? new DataView((_a2 = mipmaps[0]) != null ? _a2 : new ArrayBuffer(0)) : mipmaps[0];
      glw.bindTexture(this._nativeCtxTexture);
      glw.compressedTexImage2D(0, glInternalFormat, width2, height2, 0, view);
      glw.texParameteri(glw.TEXTURE_WRAP_S, glw.CLAMP_TO_EDGE);
      glw.texParameteri(glw.TEXTURE_WRAP_T, glw.CLAMP_TO_EDGE);
      glw.texParameteri(glw.TEXTURE_MAG_FILTER, glw.LINEAR);
      glw.texParameteri(glw.TEXTURE_MIN_FILTER, glw.LINEAR);
      this.setTextureMemUse(view.byteLength);
    } else if (tdata && tdata instanceof Uint8Array) {
      width = 1;
      height = 1;
      glw.bindTexture(this._nativeCtxTexture);
      glw.pixelStorei(glw.UNPACK_PREMULTIPLY_ALPHA_WEBGL, !!textureData.premultiplyAlpha);
      glw.texImage2D(0, format, width, height, 0, format, glw.UNSIGNED_BYTE, tdata);
      this.setTextureMemUse(width * height * formatBytes);
    } else {
      console.error("WebGlCoreCtxTexture.onLoadRequest: Unexpected textureData returned", textureData);
    }
    return {
      width,
      height
    };
  }
  /**
   * Free the WebGLTexture from the GPU
   *
   * @returns
   */
  free() {
    if (this.state === "freed") {
      return;
    }
    this.state = "freed";
    this.textureSource.setState("freed");
    this._w = 0;
    this._h = 0;
    if (this._nativeCtxTexture !== null) {
      this.glw.deleteTexture(this._nativeCtxTexture);
      this.setTextureMemUse(0);
      this._nativeCtxTexture = null;
    }
    this.textureSource.freeTextureData();
  }
  /**
   * Create native context texture asynchronously
   *
   * @remarks
   * When this method resolves, the returned texture will be bound to the GL context state
   * and fully ready for use. This ensures proper GPU resource allocation timing.
   *
   * @returns Promise that resolves to the native WebGL texture or null on failure
   */
  createNativeCtxTexture() {
    const { glw } = this;
    const nativeTexture = glw.createTexture();
    if (!nativeTexture) {
      return null;
    }
    glw.activeTexture(0);
    glw.bindTexture(nativeTexture);
    glw.texParameteri(glw.TEXTURE_MAG_FILTER, glw.LINEAR);
    glw.texParameteri(glw.TEXTURE_MIN_FILTER, glw.LINEAR);
    glw.texParameteri(glw.TEXTURE_WRAP_S, glw.CLAMP_TO_EDGE);
    glw.texParameteri(glw.TEXTURE_WRAP_T, glw.CLAMP_TO_EDGE);
    return nativeTexture;
  }
}
class WebGlCoreCtxSubTexture extends WebGlCoreCtxTexture {
  constructor(glw, memManager, textureSource) {
    super(glw, memManager, textureSource);
  }
  async onLoadRequest() {
    var _a2, _b;
    const props = this.textureSource.textureData;
    assertTruthy(props, "SubTexture must have texture data");
    if (props.data instanceof Uint8Array) {
      return { width: 1, height: 1 };
    }
    return {
      width: ((_a2 = props.data) == null ? void 0 : _a2.width) || 0,
      height: ((_b = props.data) == null ? void 0 : _b.height) || 0
    };
  }
}
class BufferCollection {
  constructor(config) {
    __publicField(this, "config");
    this.config = config;
  }
  /**
   * Get the WebGLBuffer associated with the given attribute name if it exists.
   *
   * @param attributeName
   * @returns
   */
  getBuffer(attributeName) {
    var _a2;
    return (_a2 = this.config.find((item) => item.attributes[attributeName])) == null ? void 0 : _a2.buffer;
  }
  /**
   * Get the AttributeInfo associated with the given attribute name if it exists.
   *
   * @param attributeName
   * @returns
   */
  getAttributeInfo(attributeName) {
    var _a2;
    return (_a2 = this.config.find((item) => item.attributes[attributeName])) == null ? void 0 : _a2.attributes[attributeName];
  }
}
function isWebGl2(gl) {
  return self.WebGL2RenderingContext && gl instanceof self.WebGL2RenderingContext;
}
class WebGlContextWrapper {
  //#endregion WebGL Enums
  constructor(gl) {
    __publicField(this, "gl");
    //#region Cached WebGL State
    __publicField(this, "activeTextureUnit", 0);
    __publicField(this, "texture2dUnits");
    __publicField(this, "texture2dParams", /* @__PURE__ */ new WeakMap());
    __publicField(this, "scissorEnabled");
    __publicField(this, "scissorX");
    __publicField(this, "scissorY");
    __publicField(this, "scissorWidth");
    __publicField(this, "scissorHeight");
    __publicField(this, "blendEnabled");
    __publicField(this, "blendSrcRgb");
    __publicField(this, "blendDstRgb");
    __publicField(this, "blendSrcAlpha");
    __publicField(this, "blendDstAlpha");
    __publicField(this, "boundArrayBuffer");
    __publicField(this, "boundElementArrayBuffer");
    __publicField(this, "curProgram");
    //#endregion Cached WebGL State
    //#region Canvas
    __publicField(this, "canvas");
    //#endregion Canvas
    //#region WebGL Enums
    __publicField(this, "MAX_RENDERBUFFER_SIZE");
    __publicField(this, "MAX_TEXTURE_SIZE");
    __publicField(this, "MAX_VIEWPORT_DIMS");
    __publicField(this, "MAX_VERTEX_TEXTURE_IMAGE_UNITS");
    __publicField(this, "MAX_TEXTURE_IMAGE_UNITS");
    __publicField(this, "MAX_COMBINED_TEXTURE_IMAGE_UNITS");
    __publicField(this, "MAX_VERTEX_ATTRIBS");
    __publicField(this, "MAX_VARYING_VECTORS");
    __publicField(this, "MAX_VERTEX_UNIFORM_VECTORS");
    __publicField(this, "MAX_FRAGMENT_UNIFORM_VECTORS");
    __publicField(this, "TEXTURE_MAG_FILTER");
    __publicField(this, "TEXTURE_MIN_FILTER");
    __publicField(this, "TEXTURE_WRAP_S");
    __publicField(this, "TEXTURE_WRAP_T");
    __publicField(this, "LINEAR");
    __publicField(this, "CLAMP_TO_EDGE");
    __publicField(this, "RGB");
    __publicField(this, "RGBA");
    __publicField(this, "UNSIGNED_BYTE");
    __publicField(this, "UNPACK_PREMULTIPLY_ALPHA_WEBGL");
    __publicField(this, "UNPACK_FLIP_Y_WEBGL");
    __publicField(this, "FLOAT");
    __publicField(this, "TRIANGLES");
    __publicField(this, "UNSIGNED_SHORT");
    __publicField(this, "ONE");
    __publicField(this, "ONE_MINUS_SRC_ALPHA");
    __publicField(this, "VERTEX_SHADER");
    __publicField(this, "FRAGMENT_SHADER");
    __publicField(this, "STATIC_DRAW");
    __publicField(this, "COMPILE_STATUS");
    __publicField(this, "LINK_STATUS");
    __publicField(this, "DYNAMIC_DRAW");
    __publicField(this, "COLOR_ATTACHMENT0");
    __publicField(this, "INVALID_ENUM");
    __publicField(this, "INVALID_OPERATION");
    this.gl = gl;
    this.activeTextureUnit = gl.getParameter(gl.ACTIVE_TEXTURE) - gl.TEXTURE0;
    const maxTextureUnits = gl.getParameter(gl.MAX_TEXTURE_IMAGE_UNITS);
    this.texture2dUnits = new Array(maxTextureUnits).fill(void 0).map((_, i) => {
      this.activeTexture(i);
      return gl.getParameter(gl.TEXTURE_BINDING_2D);
    });
    this.activeTexture(this.activeTextureUnit);
    this.scissorEnabled = gl.isEnabled(gl.SCISSOR_TEST);
    const scissorBox = gl.getParameter(gl.SCISSOR_BOX);
    this.scissorX = scissorBox[0];
    this.scissorY = scissorBox[1];
    this.scissorWidth = scissorBox[2];
    this.scissorHeight = scissorBox[3];
    this.blendEnabled = gl.isEnabled(gl.BLEND);
    this.blendSrcRgb = gl.getParameter(gl.BLEND_SRC_RGB);
    this.blendDstRgb = gl.getParameter(gl.BLEND_DST_RGB);
    this.blendSrcAlpha = gl.getParameter(gl.BLEND_SRC_ALPHA);
    this.blendDstAlpha = gl.getParameter(gl.BLEND_DST_ALPHA);
    this.boundArrayBuffer = gl.getParameter(gl.ARRAY_BUFFER_BINDING);
    this.boundElementArrayBuffer = gl.getParameter(gl.ELEMENT_ARRAY_BUFFER_BINDING);
    this.curProgram = gl.getParameter(gl.CURRENT_PROGRAM);
    this.canvas = gl.canvas;
    this.MAX_RENDERBUFFER_SIZE = gl.MAX_RENDERBUFFER_SIZE;
    this.MAX_TEXTURE_SIZE = gl.MAX_TEXTURE_SIZE;
    this.MAX_VIEWPORT_DIMS = gl.MAX_VIEWPORT_DIMS;
    this.MAX_VERTEX_TEXTURE_IMAGE_UNITS = gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS;
    this.MAX_TEXTURE_IMAGE_UNITS = gl.MAX_TEXTURE_IMAGE_UNITS;
    this.MAX_COMBINED_TEXTURE_IMAGE_UNITS = gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS;
    this.MAX_VERTEX_ATTRIBS = gl.MAX_VERTEX_ATTRIBS;
    this.MAX_VARYING_VECTORS = gl.MAX_VARYING_VECTORS;
    this.MAX_VERTEX_UNIFORM_VECTORS = gl.MAX_VERTEX_UNIFORM_VECTORS;
    this.MAX_FRAGMENT_UNIFORM_VECTORS = gl.MAX_FRAGMENT_UNIFORM_VECTORS;
    this.TEXTURE_MAG_FILTER = gl.TEXTURE_MAG_FILTER;
    this.TEXTURE_MIN_FILTER = gl.TEXTURE_MIN_FILTER;
    this.TEXTURE_WRAP_S = gl.TEXTURE_WRAP_S;
    this.TEXTURE_WRAP_T = gl.TEXTURE_WRAP_T;
    this.LINEAR = gl.LINEAR;
    this.CLAMP_TO_EDGE = gl.CLAMP_TO_EDGE;
    this.RGB = gl.RGB;
    this.RGBA = gl.RGBA;
    this.UNSIGNED_BYTE = gl.UNSIGNED_BYTE;
    this.UNPACK_PREMULTIPLY_ALPHA_WEBGL = gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL;
    this.UNPACK_FLIP_Y_WEBGL = gl.UNPACK_FLIP_Y_WEBGL;
    this.FLOAT = gl.FLOAT;
    this.TRIANGLES = gl.TRIANGLES;
    this.UNSIGNED_SHORT = gl.UNSIGNED_SHORT;
    this.ONE = gl.ONE;
    this.ONE_MINUS_SRC_ALPHA = gl.ONE_MINUS_SRC_ALPHA;
    this.MAX_VERTEX_TEXTURE_IMAGE_UNITS = gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS;
    this.TRIANGLES = gl.TRIANGLES;
    this.UNSIGNED_SHORT = gl.UNSIGNED_SHORT;
    this.VERTEX_SHADER = gl.VERTEX_SHADER;
    this.FRAGMENT_SHADER = gl.FRAGMENT_SHADER;
    this.STATIC_DRAW = gl.STATIC_DRAW;
    this.COMPILE_STATUS = gl.COMPILE_STATUS;
    this.LINK_STATUS = gl.LINK_STATUS;
    this.DYNAMIC_DRAW = gl.DYNAMIC_DRAW;
    this.COLOR_ATTACHMENT0 = gl.COLOR_ATTACHMENT0;
    this.INVALID_ENUM = gl.INVALID_ENUM;
    this.INVALID_OPERATION = gl.INVALID_OPERATION;
  }
  /**
   * Returns true if the WebGL context is WebGL2
   *
   * @returns
   */
  isWebGl2() {
    return isWebGl2(this.gl);
  }
  /**
   * ```
   * gl.activeTexture(textureUnit + gl.TEXTURE0);
   * ```
   *
   * @remarks
   * **WebGL Difference**: `textureUnit` is based from 0, not `gl.TEXTURE0`.
   *
   * @param textureUnit
   */
  activeTexture(textureUnit) {
    const { gl } = this;
    if (this.activeTextureUnit !== textureUnit) {
      gl.activeTexture(textureUnit + gl.TEXTURE0);
      this.activeTextureUnit = textureUnit;
    }
  }
  /**
   * ```
   * gl.bindTexture(gl.TEXTURE_2D, texture);
   * ```
   * @remarks
   * **WebGL Difference**: Bind target is always `gl.TEXTURE_2D`
   *
   * @param texture
   */
  bindTexture(texture) {
    const { gl, activeTextureUnit, texture2dUnits } = this;
    if (texture2dUnits[activeTextureUnit] === texture) {
      return;
    }
    texture2dUnits[activeTextureUnit] = texture;
    gl.bindTexture(this.gl.TEXTURE_2D, texture);
  }
  _getActiveTexture() {
    const { activeTextureUnit, texture2dUnits } = this;
    return texture2dUnits[activeTextureUnit];
  }
  /**
   * ```
   * gl.texParameteri(gl.TEXTURE_2D, pname, param);
   * ```
   * @remarks
   * **WebGL Difference**: Bind target is always `gl.TEXTURE_2D`
   *
   * @param pname
   * @param param
   * @returns
   */
  texParameteri(pname, param) {
    const { gl, texture2dParams } = this;
    const activeTexture = this._getActiveTexture();
    if (!activeTexture) {
      throw new Error("No active texture");
    }
    let textureParams = texture2dParams.get(activeTexture);
    if (!textureParams) {
      textureParams = {};
      texture2dParams.set(activeTexture, textureParams);
    }
    if (textureParams[pname] === param) {
      return;
    }
    textureParams[pname] = param;
    gl.texParameteri(gl.TEXTURE_2D, pname, param);
  }
  texImage2D(level, internalFormat, widthOrFormat, heightOrType, borderOrSource, format, type, pixels) {
    const { gl } = this;
    if (format) {
      gl.texImage2D(gl.TEXTURE_2D, level, internalFormat, widthOrFormat, heightOrType, borderOrSource, format, type, pixels);
    } else {
      gl.texImage2D(gl.TEXTURE_2D, level, internalFormat, widthOrFormat, heightOrType, borderOrSource);
    }
  }
  /**
   * ```
   * gl.compressedTexImage2D(gl.TEXTURE_2D, level, internalFormat, width, height, border, data);
   * ```
   *
   * @remarks
   * **WebGL Difference**: Bind target is always `gl.TEXTURE_2D`
   */
  compressedTexImage2D(level, internalformat, width, height, border, data) {
    const { gl } = this;
    gl.compressedTexImage2D(gl.TEXTURE_2D, level, internalformat, width, height, border, data);
  }
  /**
   * ```
   * gl.pixelStorei(pname, param);
   * ```
   *
   * @param pname
   * @param param
   */
  pixelStorei(pname, param) {
    const { gl } = this;
    gl.pixelStorei(pname, param);
  }
  /**
   * ```
   * gl.generateMipmap(gl.TEXTURE_2D);
   * ```
   *
   * @remarks
   * **WebGL Difference**: Bind target is always `gl.TEXTURE_2D`
   */
  generateMipmap() {
    const { gl } = this;
    gl.generateMipmap(gl.TEXTURE_2D);
  }
  /**
   * ```
   * gl.createTexture();
   * ```
   *
   * @returns
   */
  createTexture() {
    const { gl } = this;
    return gl.createTexture();
  }
  /**
   * ```
   * gl.deleteTexture(texture);
   * ```
   *
   * @param texture
   */
  deleteTexture(texture) {
    const { gl } = this;
    if (texture) {
      this.texture2dParams.delete(texture);
    }
    gl.deleteTexture(texture);
  }
  /**
   * ```
   * gl.deleteFramebuffer(framebuffer);
   *
   * @param framebuffer
   */
  deleteFramebuffer(framebuffer) {
    this.gl.deleteFramebuffer(framebuffer);
  }
  /**
   * ```
   * gl.viewport(x, y, width, height);
   * ```
   */
  viewport(x, y, width, height) {
    const { gl } = this;
    gl.viewport(x, y, width, height);
  }
  /**
   * ```
   * gl.clearColor(red, green, blue, alpha);
   * ```
   *
   * @param red
   * @param green
   * @param blue
   * @param alpha
   */
  clearColor(red, green, blue, alpha) {
    const { gl } = this;
    gl.clearColor(red, green, blue, alpha);
  }
  /**
   * ```
   * gl["enable"|"disable"](gl.SCISSOR_TEST);
   * ```
   * @param enable
   */
  setScissorTest(enable) {
    const { gl, scissorEnabled } = this;
    if (enable === scissorEnabled) {
      return;
    }
    if (enable) {
      gl.enable(gl.SCISSOR_TEST);
    } else {
      gl.disable(gl.SCISSOR_TEST);
    }
    this.scissorEnabled = enable;
  }
  /**
   * ```
   * gl.scissor(x, y, width, height);
   * ```
   *
   * @param x
   * @param y
   * @param width
   * @param height
   */
  scissor(x, y, width, height) {
    const { gl, scissorX, scissorY, scissorWidth, scissorHeight } = this;
    if (x !== scissorX || y !== scissorY || width !== scissorWidth || height !== scissorHeight) {
      gl.scissor(x, y, width, height);
      this.scissorX = x;
      this.scissorY = y;
      this.scissorWidth = width;
      this.scissorHeight = height;
    }
  }
  /**
   * ```
   * gl["enable"|"disable"](gl.BLEND);
   * ```
   *
   * @param blend
   * @returns
   */
  setBlend(blend) {
    const { gl, blendEnabled } = this;
    if (blend === blendEnabled) {
      return;
    }
    if (blend) {
      gl.enable(gl.BLEND);
    } else {
      gl.disable(gl.BLEND);
    }
    this.blendEnabled = blend;
  }
  /**
   * ```
   * gl.blendFunc(src, dst);
   * ```
   *
   * @param src
   * @param dst
   */
  blendFunc(src, dst) {
    const { gl, blendSrcRgb, blendDstRgb, blendSrcAlpha, blendDstAlpha } = this;
    if (src !== blendSrcRgb || dst !== blendDstRgb || src !== blendSrcAlpha || dst !== blendDstAlpha) {
      gl.blendFunc(src, dst);
      this.blendSrcRgb = src;
      this.blendDstRgb = dst;
      this.blendSrcAlpha = src;
      this.blendDstAlpha = dst;
    }
  }
  /**
   * ```
   * gl.createBuffer();
   * ```
   *
   * @returns
   */
  createBuffer() {
    const { gl } = this;
    return gl.createBuffer();
  }
  /**
   * ```
   * gl.createFramebuffer();
   * ```
   * @returns
   */
  createFramebuffer() {
    const { gl } = this;
    return gl.createFramebuffer();
  }
  /**
   * ```
   * gl.bindFramebuffer(gl.FRAMEBUFFER, framebuffer);
   * ```
   *
   * @param framebuffer
   */
  bindFramebuffer(framebuffer) {
    const { gl } = this;
    gl.bindFramebuffer(gl.FRAMEBUFFER, framebuffer);
  }
  /**
   * ```
   * gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, texture, 0);
   * ```
   * @remarks
   * **WebGL Difference**: Bind target is always `gl.FRAMEBUFFER` and textarget is always `gl.TEXTURE_2D`
   */
  framebufferTexture2D(attachment, texture, level) {
    const { gl } = this;
    gl.framebufferTexture2D(gl.FRAMEBUFFER, attachment, gl.TEXTURE_2D, texture, level);
  }
  /**
   * ```
   * gl.clear(gl.COLOR_BUFFER_BIT);
   * ```
   *
   * @remarks
   * **WebGL Difference**: Clear mask is always `gl.COLOR_BUFFER_BIT`
   */
  clear() {
    const { gl } = this;
    gl.clear(gl.COLOR_BUFFER_BIT);
  }
  /**
   * ```
   * gl.bindBuffer(gl.ARRAY_BUFFER, buffer);
   * gl.bufferData(gl.ARRAY_BUFFER, data, usage);
   * ```
   *
   * @remarks
   * **WebGL Combo**: `gl.bindBuffer` and `gl.bufferData` are combined into one function.
   *
   * @param buffer
   * @param data
   * @param usage
   */
  arrayBufferData(buffer, data, usage) {
    const { gl, boundArrayBuffer } = this;
    if (boundArrayBuffer !== buffer) {
      gl.bindBuffer(gl.ARRAY_BUFFER, buffer);
      this.boundArrayBuffer = buffer;
    }
    gl.bufferData(gl.ARRAY_BUFFER, data, usage);
  }
  /**
   * ```
   * gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, buffer);
   * gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, data, usage);
   * ```
   * @remarks
   * **WebGL Combo**: `gl.bindBuffer` and `gl.bufferData` are combined into one function.
   *
   * @param buffer
   * @param data
   * @param usage
   */
  elementArrayBufferData(buffer, data, usage) {
    const { gl, boundElementArrayBuffer } = this;
    if (boundElementArrayBuffer !== buffer) {
      gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, buffer);
      this.boundElementArrayBuffer = buffer;
    }
    gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, data, usage);
  }
  /**
   * ```
   * gl.bindBuffer(gl.ARRAY_BUFFER, buffer);
   * gl.vertexAttribPointer(index, size, type, normalized, stride, offset);
   * ```
   *
   * @remarks
   * **WebGL Combo**: `gl.bindBuffer` and `gl.vertexAttribPointer` are combined into one function.
   *
   * @param buffer
   * @param index
   * @param size
   * @param type
   * @param normalized
   * @param stride
   * @param offset
   */
  vertexAttribPointer(buffer, index, size, type, normalized, stride, offset) {
    const { gl, boundArrayBuffer } = this;
    if (boundArrayBuffer !== buffer) {
      gl.bindBuffer(gl.ARRAY_BUFFER, buffer);
      this.boundArrayBuffer = buffer;
    }
    gl.vertexAttribPointer(index, size, type, normalized, stride, offset);
  }
  /**
   * ```
   * gl.useProgram(program);
   * ```
   *
   * @param program
   * @returns
   */
  useProgram(program) {
    const { gl, curProgram } = this;
    if (curProgram === program) {
      return;
    }
    gl.useProgram(program);
    this.curProgram = program;
  }
  /**
   * Sets the value of a single float uniform variable.
   *
   * @param location - The location of the uniform variable.
   * @param v0 - The value to set.
   */
  uniform1f(location2, v0) {
    const { gl } = this;
    gl.uniform1f(location2, v0);
  }
  /**
   * Sets the value of a float array uniform variable.
   *
   * @param location - The location of the uniform variable.
   * @param value - The array of values to set.
   */
  uniform1fv(location2, value) {
    const { gl } = this;
    gl.uniform1fv(location2, value);
  }
  /**
   * Sets the value of a single integer uniform variable.
   *
   * @param location - The location of the uniform variable.
   * @param v0 - The value to set.
   */
  uniform1i(location2, v0) {
    const { gl } = this;
    gl.uniform1i(location2, v0);
  }
  /**
   * Sets the value of an integer array uniform variable.
   *
   * @param location - The location of the uniform variable.
   * @param value - The array of values to set.
   */
  uniform1iv(location2, value) {
    const { gl } = this;
    gl.uniform1iv(location2, value);
  }
  /**
   * Sets the value of a vec2 uniform variable.
   *
   * @param location - The location of the uniform variable.
   * @param v0 - The first component of the vector.
   * @param v1 - The second component of the vector.
   */
  uniform2f(location2, v0, v1) {
    const { gl } = this;
    gl.uniform2f(location2, v0, v1);
  }
  /**
   * Sets the value of a vec2 array uniform variable.
   *
   * @param location - The location of the uniform variable.
   * @param value - The array of vec2 values to set.
   */
  uniform2fv(location2, value) {
    const { gl } = this;
    gl.uniform2fv(location2, value);
  }
  /**
   * Sets the value of a ivec2 uniform variable.
   *
   * @param location - The location of the uniform variable.
   * @param v0 - The first component of the vector.
   * @param v1 - The second component of the vector.
   */
  uniform2i(location2, v0, v1) {
    const { gl } = this;
    gl.uniform2i(location2, v0, v1);
  }
  /**
   * Sets the value of an ivec2 array uniform variable.
   *
   * @param location - The location of the uniform variable.
   * @param value - The array of ivec2 values to set.
   */
  uniform2iv(location2, value) {
    const { gl } = this;
    gl.uniform2iv(location2, value);
  }
  /**
   * Sets the value of a vec3 uniform variable.
   *
   * @param location - The location of the uniform variable.
   * @param v0 - The first component of the vector.
   * @param v1 - The second component of the vector.
   * @param v2 - The third component of the vector.
   */
  uniform3f(location2, v0, v1, v2) {
    const { gl } = this;
    gl.uniform3f(location2, v0, v1, v2);
  }
  /**
   * Sets the value of a vec3 array uniform variable.
   *
   * @param location - The location of the uniform variable.
   * @param value - The array of vec3 values to set.
   */
  uniform3fv(location2, value) {
    const { gl } = this;
    gl.uniform3fv(location2, value);
  }
  /**
   * Sets the value of a ivec3 uniform variable.
   *
   * @param location - The location of the uniform variable.
   * @param v0 - The first component of the vector.
   * @param v1 - The second component of the vector.
   * @param v2 - The third component of the vector.
   */
  uniform3i(location2, v0, v1, v2) {
    const { gl } = this;
    gl.uniform3i(location2, v0, v1, v2);
  }
  /**
   * Sets the value of an ivec3 array uniform variable.
   *
   * @param location - The location of the uniform variable.
   * @param value - The array of ivec3 values to set.
   */
  uniform3iv(location2, value) {
    const { gl } = this;
    gl.uniform3iv(location2, value);
  }
  /**
   * Sets the value of a vec4 uniform variable.
   *
   * @param location - The location of the uniform variable.
   * @param v0 - The first component of the vector.
   * @param v1 - The second component of the vector.
   * @param v2 - The third component of the vector.
   * @param v3 - The fourth component of the vector.
   */
  uniform4f(location2, v0, v1, v2, v3) {
    const { gl } = this;
    gl.uniform4f(location2, v0, v1, v2, v3);
  }
  /**
   * Sets the value of a vec4 array uniform variable.
   *
   * @param location - The location of the uniform variable.
   * @param value - The array of vec4 values to set.
   */
  uniform4fv(location2, value) {
    const { gl } = this;
    gl.uniform4fv(location2, value);
  }
  /**
   * Sets the value of a ivec4 uniform variable.
   *
   * @param location - The location of the uniform variable.
   * @param v0 - The first component of the vector.
   * @param v1 - The second component of the vector.
   * @param v2 - The third component of the vector.
   * @param v3 - The fourth component of the vector.
   */
  uniform4i(location2, v0, v1, v2, v3) {
    const { gl } = this;
    gl.uniform4i(location2, v0, v1, v2, v3);
  }
  /**
   * Sets the value of an ivec4 array uniform variable.
   *
   * @param location - The location of the uniform variable.
   * @param value - The array of ivec4 values to set.
   */
  uniform4iv(location2, value) {
    const { gl } = this;
    gl.uniform4iv(location2, value);
  }
  /**
   * Sets the value of a mat2 uniform variable.
   *
   * @param location - The location of the uniform variable.
   * @param transpose - Whether to transpose the matrix.
   * @param value - The array of mat2 values to set.
   */
  uniformMatrix2fv(location2, value) {
    const { gl } = this;
    gl.uniformMatrix2fv(location2, false, value);
  }
  /**
   * Sets the value of a mat2 uniform variable.
   * @param location - The location of the uniform variable.
   * @param value - The array of mat2 values to set.
   */
  uniformMatrix3fv(location2, value) {
    const { gl } = this;
    gl.uniformMatrix3fv(location2, false, value);
  }
  /**
   * Sets the value of a mat4 uniform variable.
   * @param location - The location of the uniform variable.
   * @param value - The array of mat4 values to set.
   */
  uniformMatrix4fv(location2, value) {
    const { gl } = this;
    gl.uniformMatrix4fv(location2, false, value);
  }
  /**
   * ```
   * gl.getParameter(pname);
   * ```
   *
   * @param pname
   * @returns
   */
  getParameter(pname) {
    const { gl } = this;
    return gl.getParameter(pname);
  }
  /**
   * ```
   * gl.drawElements(mode, count, type, offset);
   * ```
   *
   * @param mode
   * @param count
   * @param type
   * @param offset
   */
  drawElements(mode, count2, type, offset) {
    const { gl } = this;
    gl.drawElements(mode, count2, type, offset);
  }
  /**
   * ```
   * gl.drawArrays(mode, first, count);
   * ```
   *
   * @param name
   * @returns
   */
  getExtension(name) {
    const { gl } = this;
    return gl.getExtension(name);
  }
  /**
   * ```
   * gl.getError(type);
   * ```
   *
   * @returns
   */
  getError() {
    const { gl } = this;
    return gl.getError();
  }
  /**
   * ```
   * gl.createVertexArray();
   * ```
   *
   * @returns
   */
  createVertexArray() {
    const { gl } = this;
    assertTruthy(gl instanceof WebGL2RenderingContext);
    return gl.createVertexArray();
  }
  /**
   * ```
   * gl.bindVertexArray(vertexArray);
   * ```
   *
   * @param vertexArray
   */
  bindVertexArray(vertexArray) {
    const { gl } = this;
    assertTruthy(gl instanceof WebGL2RenderingContext);
    gl.bindVertexArray(vertexArray);
  }
  /**
   * ```
   * gl.getAttribLocation(program, name);
   * ```
   *
   * @param program
   * @param name
   * @returns
   */
  getAttribLocation(program, name) {
    const { gl } = this;
    return gl.getAttribLocation(program, name);
  }
  /**
   * ```
   * gl.getUniformLocation(program, name);
   * ```
   *
   * @param program
   * @param name
   * @returns
   */
  getUniformLocation(program, name) {
    const { gl } = this;
    return gl.getUniformLocation(program, name);
  }
  /**
   * ```
   * gl.enableVertexAttribArray(index);
   * ```
   *
   * @param index
   */
  enableVertexAttribArray(index) {
    const { gl } = this;
    gl.enableVertexAttribArray(index);
  }
  /**
   * ```
   * gl.disableVertexAttribArray(index);
   * ```
   *
   * @param index
   */
  disableVertexAttribArray(index) {
    const { gl } = this;
    gl.disableVertexAttribArray(index);
  }
  /**
   * ```
   * gl.createShader(type);
   * ```
   *
   * @param type
   * @returns
   */
  createShader(type) {
    const { gl } = this;
    return gl.createShader(type);
  }
  /**
   * ```
   * gl.compileShader(shader);
   * ```
   *
   * @param shader
   * @returns
   */
  compileShader(shader) {
    const { gl } = this;
    gl.compileShader(shader);
  }
  /**
   * ```
   * gl.attachShader(program, shader);
   * ```
   *
   * @param program
   * @param shader
   */
  attachShader(program, shader) {
    const { gl } = this;
    gl.attachShader(program, shader);
  }
  /**
   * ```
   * gl.linkProgram(program);
   * ```
   *
   * @param program
   */
  linkProgram(program) {
    const { gl } = this;
    gl.linkProgram(program);
  }
  /**
   * ```
   * gl.deleteProgram(shader);
   * ```
   *
   * @param shader
   */
  deleteProgram(shader) {
    const { gl } = this;
    gl.deleteProgram(shader);
  }
  /**
   * ```
   * gl.getShaderParameter(shader, pname);
   * ```
   *
   * @param shader
   * @param pname
   */
  getShaderParameter(shader, pname) {
    const { gl } = this;
    return gl.getShaderParameter(shader, pname);
  }
  /**
   * ```
   * gl.getShaderInfoLog(shader);
   * ```
   *
   * @param shader
   */
  getShaderInfoLog(shader) {
    const { gl } = this;
    return gl.getShaderInfoLog(shader);
  }
  /**
   * ```
   * gl.createProgram();
   * ```
   *
   * @returns
   */
  createProgram() {
    const { gl } = this;
    return gl.createProgram();
  }
  /**
   * ```
   * gl.getProgramParameter(program, pname);
   * ```
   *
   * @param program
   * @param pname
   * @returns
   */
  getProgramParameter(program, pname) {
    const { gl } = this;
    return gl.getProgramParameter(program, pname);
  }
  /**
   * ```
   * gl.getProgramInfoLog(program);
   * ```
   *
   * @param program
   * @returns
   */
  getProgramInfoLog(program) {
    const { gl } = this;
    return gl.getProgramInfoLog(program);
  }
  /**
   * ```
   * gl.shaderSource(shader, source);
   * ```
   *
   * @param shader
   * @param source
   */
  shaderSource(shader, source) {
    const { gl } = this;
    gl.shaderSource(shader, source);
  }
  /**
   * ```
   * gl.deleteShader(shader);
   * ```
   *
   * @param shader
   */
  deleteShader(shader) {
    const { gl } = this;
    gl.deleteShader(shader);
  }
}
class WebGlCoreCtxRenderTexture extends WebGlCoreCtxTexture {
  constructor(glw, memManager, textureSource) {
    super(glw, memManager, textureSource);
    __publicField(this, "framebuffer", null);
  }
  async onLoadRequest() {
    const { glw } = this;
    const nativeTexture = this._nativeCtxTexture = this.createNativeCtxTexture();
    if (!nativeTexture) {
      throw new Error("Failed to create native texture for RenderTexture");
    }
    const { width, height } = this.textureSource;
    this.framebuffer = glw.createFramebuffer();
    glw.texImage2D(0, glw.RGBA, width, height, 0, glw.RGBA, glw.UNSIGNED_BYTE, null);
    this.setTextureMemUse(width * height * 4);
    glw.bindFramebuffer(this.framebuffer);
    glw.framebufferTexture2D(glw.COLOR_ATTACHMENT0, nativeTexture, 0);
    glw.bindFramebuffer(null);
    return {
      width,
      height
    };
  }
  free() {
    super.free();
    this.glw.deleteFramebuffer(this.framebuffer);
    this.framebuffer = null;
  }
}
const WORDS_PER_QUAD = 24;
class WebGlCoreRenderer extends CoreRenderer {
  constructor(options) {
    super(options);
    //// WebGL Native Context and Data
    __publicField(this, "glw");
    __publicField(this, "system");
    //// Persistent data
    __publicField(this, "quadBuffer");
    __publicField(this, "fQuadBuffer");
    __publicField(this, "uiQuadBuffer");
    __publicField(this, "renderOps", []);
    //// Render Op / Buffer Filling State
    __publicField(this, "curBufferIdx", 0);
    __publicField(this, "curRenderOp", null);
    __publicField(this, "rttNodes", []);
    __publicField(this, "activeRttNode", null);
    //// Default Shader
    __publicField(this, "defShaderCtrl");
    __publicField(this, "defaultShader");
    __publicField(this, "quadBufferCollection");
    __publicField(this, "clearColor", {
      raw: 0,
      normalized: [0, 0, 0, 0]
    });
    /**
     * White pixel texture used by default when no texture is specified.
     */
    __publicField(this, "quadBufferUsage", 0);
    __publicField(this, "numQuadsRendered", 0);
    /**
     * Whether the renderer is currently rendering to a texture.
     */
    __publicField(this, "renderToTextureActive", false);
    this.quadBuffer = new ArrayBuffer(this.stage.options.quadBufferSize);
    this.fQuadBuffer = new Float32Array(this.quadBuffer);
    this.uiQuadBuffer = new Uint32Array(this.quadBuffer);
    this.mode = "webgl";
    const { canvas, clearColor, bufferMemory: bufferMemory2 } = options;
    const gl = createWebGLContext(canvas, options.forceWebGL2, options.contextSpy);
    const glw = this.glw = new WebGlContextWrapper(gl);
    glw.viewport(0, 0, canvas.width, canvas.height);
    this.updateClearColor(clearColor);
    glw.setBlend(true);
    glw.blendFunc(glw.ONE, glw.ONE_MINUS_SRC_ALPHA);
    createIndexBuffer(glw, bufferMemory2);
    this.system = {
      parameters: getWebGlParameters(this.glw),
      extensions: getWebGlExtensions(this.glw)
    };
    this.shManager.renderer = this;
    this.defShaderCtrl = this.shManager.loadShader("DefaultShader");
    this.defaultShader = this.defShaderCtrl.shader;
    const quadBuffer = glw.createBuffer();
    assertTruthy(quadBuffer);
    const stride = 6 * Float32Array.BYTES_PER_ELEMENT;
    this.quadBufferCollection = new BufferCollection([
      {
        buffer: quadBuffer,
        attributes: {
          a_position: {
            name: "a_position",
            size: 2,
            // 2 components per iteration
            type: glw.FLOAT,
            // the data is 32bit floats
            normalized: false,
            // don't normalize the data
            stride,
            // 0 = move forward size * sizeof(type) each iteration to get the next position
            offset: 0
            // start at the beginning of the buffer
          },
          a_textureCoordinate: {
            name: "a_textureCoordinate",
            size: 2,
            type: glw.FLOAT,
            normalized: false,
            stride,
            offset: 2 * Float32Array.BYTES_PER_ELEMENT
          },
          a_color: {
            name: "a_color",
            size: 4,
            type: glw.UNSIGNED_BYTE,
            normalized: true,
            stride,
            offset: 4 * Float32Array.BYTES_PER_ELEMENT
          },
          a_textureIndex: {
            name: "a_textureIndex",
            size: 1,
            type: glw.FLOAT,
            normalized: false,
            stride,
            offset: 5 * Float32Array.BYTES_PER_ELEMENT
          }
        }
      }
    ]);
  }
  reset() {
    const { glw } = this;
    this.curBufferIdx = 0;
    this.curRenderOp = null;
    this.renderOps.length = 0;
    glw.setScissorTest(false);
    glw.clear();
  }
  getShaderManager() {
    return this.shManager;
  }
  createCtxTexture(textureSource) {
    if (textureSource instanceof SubTexture) {
      return new WebGlCoreCtxSubTexture(this.glw, this.txMemManager, textureSource);
    } else if (textureSource instanceof RenderTexture) {
      return new WebGlCoreCtxRenderTexture(this.glw, this.txMemManager, textureSource);
    }
    return new WebGlCoreCtxTexture(this.glw, this.txMemManager, textureSource);
  }
  /**
   * This function adds a quad (a rectangle composed of two triangles) to the WebGL rendering pipeline.
   *
   * It takes a set of options that define the quad's properties, such as its dimensions, colors, texture, shader, and transformation matrix.
   * The function first updates the shader properties with the current dimensions if necessary, then sets the default texture if none is provided.
   * It then checks if a new render operation is needed, based on the current shader and clipping rectangle.
   * If a new render operation is needed, it creates one and updates the current render operation.
   * The function then adjusts the texture coordinates based on the texture options and adds the texture to the texture manager.
   *
   * Finally, it calculates the vertices for the quad, taking into account any transformations, and adds them to the quad buffer.
   * The function updates the length and number of quads in the current render operation, and updates the current buffer index.
   */
  addQuad(params2) {
    var _a2, _b, _c;
    const { fQuadBuffer, uiQuadBuffer } = this;
    let texture = params2.texture;
    assertTruthy(texture !== null, "Texture is required");
    if (params2.shaderProps !== null) {
      if (hasOwn(params2.shaderProps, "$dimensions") == true) {
        const dimensions = params2.shaderProps.$dimensions;
        dimensions.width = params2.width;
        dimensions.height = params2.height;
      }
      if (hasOwn(params2.shaderProps, "$alpha") === true) {
        params2.shaderProps.$alpha = params2.alpha;
      }
    }
    let { curBufferIdx: bufferIdx, curRenderOp } = this;
    const targetDims = { width: -1, height: -1 };
    targetDims.width = params2.width;
    targetDims.height = params2.height;
    const targetShader = params2.shader || this.defaultShader;
    assertTruthy(targetShader.getUniformLocation !== void 0, "Invalid WebGL shader");
    if (this.reuseRenderOp(params2) === false) {
      this.newRenderOp(targetShader, params2.shaderProps, params2.alpha, targetDims, params2.clippingRect, bufferIdx, params2.rtt, params2.parentHasRenderTexture, params2.framebufferDimensions);
      curRenderOp = this.curRenderOp;
      assertTruthy(curRenderOp);
    }
    let texCoordX1 = 0;
    let texCoordY1 = 0;
    let texCoordX2 = 1;
    let texCoordY2 = 1;
    if (texture.type === TextureType.subTexture) {
      const { x: tx, y: ty, width: tw, height: th } = texture.props;
      const { width: parentW = 0, height: parentH = 0 } = texture.parentTexture.dimensions || { width: 0, height: 0 };
      texCoordX1 = tx / parentW;
      texCoordX2 = texCoordX1 + tw / parentW;
      texCoordY1 = ty / parentH;
      texCoordY2 = texCoordY1 + th / parentH;
      texture = texture.parentTexture;
    }
    if (texture.type === TextureType.image && params2.textureOptions !== null && params2.textureOptions.resizeMode !== void 0 && texture.dimensions !== null) {
      const resizeMode = params2.textureOptions.resizeMode;
      const { width: tw, height: th } = texture.dimensions;
      if (resizeMode.type === "cover") {
        const scaleX = params2.width / tw;
        const scaleY = params2.height / th;
        const scale = Math.max(scaleX, scaleY);
        const precision = 1 / scale;
        if (scale && scaleX && scaleX < scale) {
          const desiredSize = precision * params2.width;
          texCoordX1 = (1 - desiredSize / tw) * ((_a2 = resizeMode.clipX) != null ? _a2 : 0.5);
          texCoordX2 = texCoordX1 + desiredSize / tw;
        }
        if (scale && scaleY && scaleY < scale) {
          const desiredSize = precision * params2.height;
          texCoordY1 = (1 - desiredSize / th) * ((_b = resizeMode.clipY) != null ? _b : 0.5);
          texCoordY2 = texCoordY1 + desiredSize / th;
        }
      }
    }
    let flipY = 0;
    if (params2.textureOptions !== null) {
      if (params2.textureOptions.flipX === true) {
        [texCoordX1, texCoordX2] = [texCoordX2, texCoordX1];
      }
      flipY = +(params2.textureOptions.flipY || false);
    }
    if (flipY ^ +(texture.type === TextureType.renderToTexture)) {
      [texCoordY1, texCoordY2] = [texCoordY2, texCoordY1];
    }
    let ctxTexture = texture.ctxTexture;
    if (ctxTexture === void 0) {
      ctxTexture = (_c = this.stage.defaultTexture) == null ? void 0 : _c.ctxTexture;
      console.warn("WebGL Renderer: Texture does not have a ctxTexture, using default texture instead");
    }
    const textureIdx = this.addTexture(ctxTexture, bufferIdx);
    assertTruthy(this.curRenderOp !== null);
    if (params2.renderCoords) {
      fQuadBuffer[bufferIdx++] = params2.renderCoords.x1;
      fQuadBuffer[bufferIdx++] = params2.renderCoords.y1;
      fQuadBuffer[bufferIdx++] = texCoordX1;
      fQuadBuffer[bufferIdx++] = texCoordY1;
      uiQuadBuffer[bufferIdx++] = params2.colorTl;
      fQuadBuffer[bufferIdx++] = textureIdx;
      fQuadBuffer[bufferIdx++] = params2.renderCoords.x2;
      fQuadBuffer[bufferIdx++] = params2.renderCoords.y2;
      fQuadBuffer[bufferIdx++] = texCoordX2;
      fQuadBuffer[bufferIdx++] = texCoordY1;
      uiQuadBuffer[bufferIdx++] = params2.colorTr;
      fQuadBuffer[bufferIdx++] = textureIdx;
      fQuadBuffer[bufferIdx++] = params2.renderCoords.x4;
      fQuadBuffer[bufferIdx++] = params2.renderCoords.y4;
      fQuadBuffer[bufferIdx++] = texCoordX1;
      fQuadBuffer[bufferIdx++] = texCoordY2;
      uiQuadBuffer[bufferIdx++] = params2.colorBl;
      fQuadBuffer[bufferIdx++] = textureIdx;
      fQuadBuffer[bufferIdx++] = params2.renderCoords.x3;
      fQuadBuffer[bufferIdx++] = params2.renderCoords.y3;
      fQuadBuffer[bufferIdx++] = texCoordX2;
      fQuadBuffer[bufferIdx++] = texCoordY2;
      uiQuadBuffer[bufferIdx++] = params2.colorBr;
      fQuadBuffer[bufferIdx++] = textureIdx;
    } else if (params2.tb !== 0 || params2.tc !== 0) {
      fQuadBuffer[bufferIdx++] = params2.tx;
      fQuadBuffer[bufferIdx++] = params2.ty;
      fQuadBuffer[bufferIdx++] = texCoordX1;
      fQuadBuffer[bufferIdx++] = texCoordY1;
      uiQuadBuffer[bufferIdx++] = params2.colorTl;
      fQuadBuffer[bufferIdx++] = textureIdx;
      fQuadBuffer[bufferIdx++] = params2.tx + params2.width * params2.ta;
      fQuadBuffer[bufferIdx++] = params2.ty + params2.width * params2.tc;
      fQuadBuffer[bufferIdx++] = texCoordX2;
      fQuadBuffer[bufferIdx++] = texCoordY1;
      uiQuadBuffer[bufferIdx++] = params2.colorTr;
      fQuadBuffer[bufferIdx++] = textureIdx;
      fQuadBuffer[bufferIdx++] = params2.tx + params2.height * params2.tb;
      fQuadBuffer[bufferIdx++] = params2.ty + params2.height * params2.td;
      fQuadBuffer[bufferIdx++] = texCoordX1;
      fQuadBuffer[bufferIdx++] = texCoordY2;
      uiQuadBuffer[bufferIdx++] = params2.colorBl;
      fQuadBuffer[bufferIdx++] = textureIdx;
      fQuadBuffer[bufferIdx++] = params2.tx + params2.width * params2.ta + params2.height * params2.tb;
      fQuadBuffer[bufferIdx++] = params2.ty + params2.width * params2.tc + params2.height * params2.td;
      fQuadBuffer[bufferIdx++] = texCoordX2;
      fQuadBuffer[bufferIdx++] = texCoordY2;
      uiQuadBuffer[bufferIdx++] = params2.colorBr;
      fQuadBuffer[bufferIdx++] = textureIdx;
    } else {
      const rightCornerX = params2.tx + params2.width * params2.ta;
      const rightCornerY = params2.ty + params2.height * params2.td;
      fQuadBuffer[bufferIdx++] = params2.tx;
      fQuadBuffer[bufferIdx++] = params2.ty;
      fQuadBuffer[bufferIdx++] = texCoordX1;
      fQuadBuffer[bufferIdx++] = texCoordY1;
      uiQuadBuffer[bufferIdx++] = params2.colorTl;
      fQuadBuffer[bufferIdx++] = textureIdx;
      fQuadBuffer[bufferIdx++] = rightCornerX;
      fQuadBuffer[bufferIdx++] = params2.ty;
      fQuadBuffer[bufferIdx++] = texCoordX2;
      fQuadBuffer[bufferIdx++] = texCoordY1;
      uiQuadBuffer[bufferIdx++] = params2.colorTr;
      fQuadBuffer[bufferIdx++] = textureIdx;
      fQuadBuffer[bufferIdx++] = params2.tx;
      fQuadBuffer[bufferIdx++] = rightCornerY;
      fQuadBuffer[bufferIdx++] = texCoordX1;
      fQuadBuffer[bufferIdx++] = texCoordY2;
      uiQuadBuffer[bufferIdx++] = params2.colorBl;
      fQuadBuffer[bufferIdx++] = textureIdx;
      fQuadBuffer[bufferIdx++] = rightCornerX;
      fQuadBuffer[bufferIdx++] = rightCornerY;
      fQuadBuffer[bufferIdx++] = texCoordX2;
      fQuadBuffer[bufferIdx++] = texCoordY2;
      uiQuadBuffer[bufferIdx++] = params2.colorBr;
      fQuadBuffer[bufferIdx++] = textureIdx;
    }
    this.curRenderOp.length += WORDS_PER_QUAD;
    this.curRenderOp.numQuads++;
    this.curBufferIdx = bufferIdx;
  }
  /**
   * Replace the existing RenderOp with a new one that uses the specified Shader
   * and starts at the specified buffer index.
   *
   * @param shader
   * @param bufferIdx
   */
  newRenderOp(shader, shaderProps, alpha, dimensions, clippingRect, bufferIdx, renderToTexture, parentHasRenderTexture, framebufferDimensions) {
    const curRenderOp = new WebGlCoreRenderOp(
      this.glw,
      this.options,
      this.quadBufferCollection,
      shader,
      shaderProps,
      alpha,
      clippingRect,
      dimensions,
      bufferIdx,
      0,
      // Z-Index is only used for explictly added Render Ops
      renderToTexture,
      parentHasRenderTexture,
      framebufferDimensions
    );
    this.curRenderOp = curRenderOp;
    this.renderOps.push(curRenderOp);
  }
  /**
   * Add a texture to the current RenderOp. If the texture cannot be added to the
   * current RenderOp, a new RenderOp will be created and the texture will be added
   * to that one.
   *
   * If the texture cannot be added to the new RenderOp, an error will be thrown.
   *
   * @param texture
   * @param bufferIdx
   * @param recursive
   * @returns Assigned Texture Index of the texture in the render op
   */
  addTexture(texture, bufferIdx, recursive) {
    const { curRenderOp } = this;
    assertTruthy(curRenderOp);
    const textureIdx = curRenderOp.addTexture(texture);
    if (textureIdx === 4294967295) {
      if (recursive) {
        throw new Error("Unable to add texture to render op");
      }
      this.newRenderOp(curRenderOp.shader, curRenderOp.shaderProps, curRenderOp.alpha, curRenderOp.dimensions, curRenderOp.clippingRect, bufferIdx);
      return this.addTexture(texture, bufferIdx, true);
    }
    return textureIdx;
  }
  /**
   * Test if the current Render operation can be reused for the specified parameters.
   * @param params
   * @returns
   */
  reuseRenderOp(params2) {
    var _a2;
    const { shader, shaderProps, parentHasRenderTexture, rtt, clippingRect } = params2;
    const targetShader = shader || this.defaultShader;
    if (((_a2 = this.curRenderOp) == null ? void 0 : _a2.shader) !== targetShader) {
      return false;
    }
    if (compareRect(this.curRenderOp.clippingRect, clippingRect) === false) {
      return false;
    }
    if (parentHasRenderTexture !== void 0 || rtt !== void 0) {
      return false;
    }
    if (this.curRenderOp.shader !== this.defaultShader && (shaderProps === null || this.curRenderOp.shader.canBatchShaderProps(this.curRenderOp.shaderProps, shaderProps) === false)) {
      return false;
    }
    return true;
  }
  /**
   * add RenderOp to the render pipeline
   */
  addRenderOp(renderable) {
    this.renderOps.push(renderable);
    this.curRenderOp = null;
  }
  /**
   * Render the current set of RenderOps to render to the specified surface.
   *
   * TODO: 'screen' is the only supported surface at the moment.
   *
   * @param surface
   */
  render(surface = "screen") {
    const { glw, quadBuffer } = this;
    const arr = new Float32Array(quadBuffer, 0, this.curBufferIdx);
    const buffer = this.quadBufferCollection.getBuffer("a_position") || null;
    glw.arrayBufferData(buffer, arr, glw.STATIC_DRAW);
    for (let i = 0, length = this.renderOps.length; i < length; i++) {
      this.renderOps[i].draw();
    }
    this.quadBufferUsage = this.curBufferIdx * arr.BYTES_PER_ELEMENT;
    const QUAD_SIZE_IN_BYTES = 4 * (6 * arr.BYTES_PER_ELEMENT);
    this.numQuadsRendered = this.quadBufferUsage / QUAD_SIZE_IN_BYTES;
  }
  getQuadCount() {
    return this.numQuadsRendered;
  }
  renderToTexture(node) {
    for (let i = 0; i < this.rttNodes.length; i++) {
      if (this.rttNodes[i] === node) {
        return;
      }
    }
    this.insertRTTNodeInOrder(node);
  }
  /**
   * Inserts an RTT node into `this.rttNodes` while maintaining the correct rendering order based on hierarchy.
   *
   * Rendering order for RTT nodes is critical when nested RTT nodes exist in a parent-child relationship.
   * Specifically:
   *  - Child RTT nodes must be rendered before their RTT-enabled parents to ensure proper texture composition.
   *  - If an RTT node is added and it has existing RTT children, it should be rendered after those children.
   *
   * This function addresses both cases by:
   * 1. **Checking Upwards**: It traverses the node's hierarchy upwards to identify any RTT parent
   *    already in `rttNodes`. If an RTT parent is found, the new node is placed before this parent.
   * 2. **Checking Downwards**: It traverses the node’s children recursively to find any RTT-enabled
   *    children that are already in `rttNodes`. If such children are found, the new node is inserted
   *    after the last (highest index) RTT child node.
   *
   * The final calculated insertion index ensures the new node is positioned in `rttNodes` to respect
   * both parent-before-child and child-before-parent rendering rules, preserving the correct order
   * for the WebGL renderer.
   *
   * @param node - The RTT-enabled CoreNode to be added to `rttNodes` in the appropriate hierarchical position.
   */
  insertRTTNodeInOrder(node) {
    let insertIndex = this.rttNodes.length;
    let currentNode = node;
    while (currentNode) {
      if (!currentNode.parent) {
        break;
      }
      const parentIndex = this.rttNodes.indexOf(currentNode.parent);
      if (parentIndex !== -1) {
        insertIndex = parentIndex;
        break;
      }
      currentNode = currentNode.parent;
    }
    const maxChildIndex = this.findMaxChildRTTIndex(node);
    if (maxChildIndex !== -1) {
      insertIndex = Math.max(insertIndex, maxChildIndex + 1);
    }
    this.rttNodes.splice(insertIndex, 0, node);
  }
  // Helper function to find the highest index of any RTT children of a node within rttNodes
  findMaxChildRTTIndex(node) {
    let maxIndex = -1;
    const traverseChildren = (currentNode) => {
      const currentIndex = this.rttNodes.indexOf(currentNode);
      if (currentIndex !== -1) {
        maxIndex = Math.max(maxIndex, currentIndex);
      }
      for (const child of currentNode.children) {
        traverseChildren(child);
      }
    };
    traverseChildren(node);
    return maxIndex;
  }
  renderRTTNodes() {
    const { glw } = this;
    const { txManager } = this.stage;
    for (let i = 0; i < this.rttNodes.length; i++) {
      const node = this.rttNodes[i];
      if (node === void 0 || node.hasRTTupdates === false) {
        continue;
      }
      if (node.worldAlpha === 0 || node.strictBounds === true && node.renderState === CoreNodeRenderState.OutOfBounds) {
        continue;
      }
      if (node.texture === null || node.texture.state !== "loaded") {
        continue;
      }
      this.activeRttNode = node;
      assertTruthy(node.texture, "RTT node missing texture");
      const ctxTexture = node.texture.ctxTexture;
      assertTruthy(ctxTexture instanceof WebGlCoreCtxRenderTexture);
      this.renderToTextureActive = true;
      glw.bindFramebuffer(ctxTexture.framebuffer);
      glw.viewport(0, 0, ctxTexture.w, ctxTexture.h);
      glw.clearColor(0, 0, 0, 0);
      glw.clear();
      for (let i2 = 0; i2 < node.children.length; i2++) {
        const child = node.children[i2];
        if (child === void 0) {
          continue;
        }
        this.stage.addQuads(child);
        child.hasRTTupdates = false;
      }
      this.render();
      this.renderOps.length = 0;
      node.hasRTTupdates = false;
    }
    const clearColor = this.clearColor.normalized;
    glw.clearColor(clearColor[0], clearColor[1], clearColor[2], clearColor[3]);
    glw.bindFramebuffer(null);
    glw.viewport(0, 0, this.glw.canvas.width, this.glw.canvas.height);
    this.renderToTextureActive = false;
  }
  removeRTTNode(node) {
    const index = this.rttNodes.indexOf(node);
    if (index === -1) {
      return;
    }
    this.rttNodes.splice(index, 1);
  }
  getBufferInfo() {
    const bufferInfo = {
      totalAvailable: this.stage.options.quadBufferSize,
      totalUsed: this.quadBufferUsage
    };
    return bufferInfo;
  }
  getDefShaderCtr() {
    return this.defShaderCtrl;
  }
  /**
   * Updates the WebGL context's clear color and clears the color buffer.
   *
   * @param color - The color to set as the clear color, represented as a 32-bit integer.
   */
  updateClearColor(color) {
    if (this.clearColor.raw === color) {
      return;
    }
    const glw = this.glw;
    const normalizedColor = getNormalizedRgbaComponents(color);
    glw.clearColor(normalizedColor[0], normalizedColor[1], normalizedColor[2], normalizedColor[3]);
    this.clearColor = {
      raw: color,
      normalized: normalizedColor
    };
    glw.clear();
  }
}
const SpecialCodepoints = {
  LINE_FEED: 10
};
class FontShaper {
}
class SdfFontShaper extends FontShaper {
  constructor(data, glyphMap) {
    super();
    __publicField(this, "data");
    __publicField(this, "glyphMap");
    __publicField(this, "kernings");
    this.data = data;
    this.glyphMap = glyphMap;
    const kernings = this.kernings = {};
    data.kernings.forEach((kerning) => {
      const second = kerning.second;
      const firsts = kernings[second] = kernings[second] || {};
      firsts[kerning.first] = kerning.amount;
    });
    this.kernings = kernings;
  }
  *shapeText(props, codepoints) {
    var _a2;
    let codepointResult;
    let lastGlyphId = void 0;
    while ((codepointResult = codepoints.peek()) && !codepointResult.done) {
      const codepoint = codepointResult.value;
      const glyph = this.glyphMap.get(codepoint);
      codepoints.next();
      if (glyph !== void 0) {
        const kerning = lastGlyphId !== void 0 ? (((_a2 = this.kernings[glyph.id]) == null ? void 0 : _a2[lastGlyphId]) || 0) + props.letterSpacing : 0;
        lastGlyphId = glyph.id;
        yield {
          mapped: true,
          glyphId: glyph.id,
          codepoint,
          cluster: codepoints.lastIndex,
          xAdvance: glyph.xadvance + kerning,
          yAdvance: 0,
          xOffset: glyph.xoffset + kerning,
          yOffset: glyph.yoffset,
          xBearing: 0,
          yBearing: 0,
          width: glyph.width,
          height: glyph.height
        };
      } else {
        if (codepoint === SpecialCodepoints.LINE_FEED) {
          lastGlyphId = void 0;
        }
        yield {
          mapped: false,
          codepoint,
          cluster: codepoints.lastIndex
        };
      }
    }
  }
}
class SdfTrFontFace extends TrFontFace {
  constructor(type, options) {
    super(options);
    __publicField(this, "type");
    __publicField(this, "texture");
    /**
     * Height of the tallest character in the font including the whitespace above it
     * in SDF/vertex units.
     */
    __publicField(this, "maxCharHeight", 0);
    __publicField(this, "shaper");
    __publicField(this, "glyphMap", /* @__PURE__ */ new Map());
    __publicField(this, "data");
    const { atlasUrl, atlasDataUrl, stage } = options;
    this.type = type;
    const renderer2 = stage.renderer;
    assertTruthy(renderer2 instanceof WebGlCoreRenderer, "SDF Font Faces can only be used with the WebGL Renderer");
    this.texture = stage.txManager.createTexture("ImageTexture", {
      src: atlasUrl,
      // IMPORTANT: The SDF shader requires the alpha channel to NOT be
      // premultiplied on the atlas texture. If it is premultiplied, the
      // rendering of SDF glyphs (especially single-channel SDF fonts) will
      // be very jagged.
      premultiplyAlpha: false
    });
    stage.txManager.loadTexture(this.texture, true);
    this.texture.preventCleanup = true;
    this.texture.on("loaded", () => {
      this.checkLoaded();
      stage.requestRender();
    });
    fetchJson(atlasDataUrl).then((response) => {
      var _a2;
      this.data = JSON.parse(response);
      assertTruthy(this.data);
      let maxCharHeight = 0;
      this.data.chars.forEach((glyph) => {
        this.glyphMap.set(glyph.id, glyph);
        const charHeight = glyph.yoffset + glyph.height;
        if (charHeight > maxCharHeight) {
          maxCharHeight = charHeight;
        }
      });
      this.maxCharHeight = maxCharHeight;
      this.shaper = new SdfFontShaper(this.data, this.glyphMap);
      if (!this.metrics) {
        if ((_a2 = this.data) == null ? void 0 : _a2.lightningMetrics) {
          const { ascender, descender, lineGap, unitsPerEm } = this.data.lightningMetrics;
          this.metrics = {
            ascender: ascender / unitsPerEm,
            descender: descender / unitsPerEm,
            lineGap: lineGap / unitsPerEm
          };
        } else {
          throw new Error("Font metrics not found in ".concat(this.type, " font ").concat(this.fontFamily, ". ") + "Make sure you are using the latest version of the Lightning 3 `msdf-generator` tool to generate your SDF fonts.");
        }
      }
      this.checkLoaded();
    }).catch(console.error);
  }
  getAtlasEntry(glyphId) {
    const glyph = this.glyphMap.get(glyphId);
    if (glyph === void 0) {
      throw new Error("Glyph ".concat(glyphId, " not found in font ").concat(this.fontFamily));
    }
    return {
      x: glyph.x,
      y: glyph.y,
      width: glyph.width,
      height: glyph.height
    };
  }
  checkLoaded() {
    if (this.loaded)
      return;
    if (this.texture.state === "loaded" && this.data) {
      this.loaded = true;
      this.emit("loaded");
    }
  }
}
({ "LEGACY": false });
const DOM_RENDERING = typeof LIGHTNING_DOM_RENDERING === "boolean" && LIGHTNING_DOM_RENDERING;
const SHADERS_ENABLED = !(typeof LIGHTNING_DISABLE_SHADERS === "boolean" && LIGHTNING_DISABLE_SHADERS);
const Config = {
  debug: false,
  focusDebug: false,
  keyDebug: false,
  animationsEnabled: true,
  animationSettings: {
    duration: 250,
    easing: "ease-in-out"
  },
  fontSettings: {
    fontFamily: "Ubuntu",
    fontSize: 100
  },
  setActiveElement: () => {
  },
  focusStateKey: "$focus",
  lockStyles: true
};
const colorToRgba = (c) => "rgba(".concat(c >> 24 & 255, ",").concat(c >> 16 & 255, ",").concat(c >> 8 & 255, ",").concat((c & 255) / 255, ")");
function applyEasing(easing, progress) {
  switch (easing) {
    case "linear":
    default:
      return progress;
    case "ease-in":
      return progress * progress;
    case "ease-out":
      return progress * (2 - progress);
    case "ease-in-out":
      return progress < 0.5 ? 2 * progress * progress : -1 + (4 - 2 * progress) * progress;
  }
}
function interpolate(start, end, t) {
  return start + (end - start) * t;
}
function interpolateColor(start, end, t) {
  return interpolate(start >> 24 & 255, end >> 24 & 255, t) << 24 | interpolate(start >> 16 & 255, end >> 16 & 255, t) << 16 | interpolate(start >> 8 & 255, end >> 8 & 255, t) << 8 | interpolate(start & 255, end & 255, t);
}
function interpolateProp(name, start, end, t) {
  return name.startsWith("color") ? interpolateColor(start, end, t) : interpolate(start, end, t);
}
let animationTasks = [];
let animationFrameRequested = false;
function requestAnimationUpdate() {
  if (!animationFrameRequested && animationTasks.length > 0) {
    animationFrameRequested = true;
    requestAnimationFrame(updateAnimations);
  }
}
function updateAnimations(time) {
  animationFrameRequested = false;
  for (let i = 0; i < animationTasks.length; i++) {
    let task = animationTasks[i];
    if (task.pausedTime != null)
      continue;
    let elapsed = time - task.timeStart;
    if (elapsed < task.settings.delay) {
      requestAnimationUpdate();
      continue;
    }
    let activeTime = elapsed - task.settings.delay;
    if (activeTime >= task.settings.duration) {
      if (task.settings.loop || task.iteration < task.settings.repeat - 1) {
        task.iteration++;
        task.timeStart = time - task.settings.delay;
        if (task.settings.repeatDelay > 0) {
          task.timeStart += task.settings.repeatDelay;
        }
        requestAnimationUpdate();
      } else {
        Object.assign(task.node.props, task.propsEnd);
        updateNodeStyles(task.node);
        task.stop();
        i--;
      }
      continue;
    }
    let t = activeTime / task.settings.duration;
    t = applyEasing(task.settings.easing, t);
    for (let prop in task.propsEnd) {
      let start = task.propsStart[prop];
      let end = task.propsEnd[prop];
      task.node.props[prop] = interpolateProp(prop, start, end, t);
    }
    updateNodeStyles(task.node);
  }
  requestAnimationUpdate();
}
class AnimationController {
  constructor(node, props, rawSettings) {
    __publicField(this, "node");
    __publicField(this, "state", "paused");
    __publicField(this, "stopPromise", null);
    __publicField(this, "stopResolve", null);
    __publicField(this, "propsStart", {});
    __publicField(this, "propsEnd", {});
    __publicField(this, "timeStart", performance.now());
    __publicField(this, "timeEnd");
    __publicField(this, "settings");
    __publicField(this, "iteration", 0);
    __publicField(this, "pausedTime", null);
    var _a2, _b, _c, _d, _e, _f;
    this.node = node;
    this.settings = {
      duration: (_a2 = rawSettings.duration) != null ? _a2 : 300,
      delay: (_b = rawSettings.delay) != null ? _b : 0,
      easing: (_c = rawSettings.easing) != null ? _c : "linear",
      loop: (_d = rawSettings.loop) != null ? _d : false,
      repeat: (_e = rawSettings.repeat) != null ? _e : 1,
      repeatDelay: (_f = rawSettings.repeatDelay) != null ? _f : 0,
      stopMethod: false
    };
    this.timeEnd = this.timeStart + this.settings.delay + this.settings.duration;
    for (let [prop, value] of Object.entries(props)) {
      if (value != null && typeof value === "number") {
        this.propsStart[prop] = node.props[prop];
        this.propsEnd[prop] = value;
      }
    }
    animationTasks.push(this);
  }
  start() {
    if (this.pausedTime != null) {
      this.timeStart += performance.now() - this.pausedTime;
      this.pausedTime = null;
    } else {
      this.timeStart = performance.now();
    }
    this.state = "running";
    requestAnimationUpdate();
    return this;
  }
  pause() {
    this.pausedTime = performance.now();
    this.state = "paused";
    return this;
  }
  stop() {
    let index = animationTasks.indexOf(this);
    if (index !== -1) {
      animationTasks.splice(index, 1);
    }
    this.state = "stopped";
    if (this.stopResolve) {
      this.stopResolve();
      this.stopResolve = null;
      this.stopPromise = null;
    }
    return this;
  }
  restore() {
    return this;
  }
  waitUntilStopped() {
    var _a2;
    (_a2 = this.stopPromise) != null ? _a2 : this.stopPromise = new Promise((resolve) => {
      this.stopResolve = resolve;
    });
    return this.stopPromise;
  }
  on() {
    return this;
  }
  once() {
    return this;
  }
  off() {
    return this;
  }
  emit() {
    return this;
  }
}
function animate(props, settings) {
  return new AnimationController(this, props, settings);
}
let elMap = /* @__PURE__ */ new WeakMap();
function updateNodeParent(node) {
  if (node.parent != null) {
    elMap.get(node.parent).appendChild(node.div);
  }
}
function getNodeLineHeight(props) {
  var _a2, _b;
  return (_b = (_a2 = props.lineHeight) != null ? _a2 : Config.fontSettings.lineHeight) != null ? _b : 1.2 * props.fontSize;
}
function updateNodeStyles(node) {
  var _a2, _b, _c, _d, _e, _f, _g;
  let { props } = node;
  let style = "position: absolute; z-index: ".concat(props.zIndex, ";");
  if (props.alpha !== 1)
    style += "opacity: ".concat(props.alpha, ";");
  if (props.clipping) {
    style += "overflow: hidden;";
  }
  {
    let transform = "";
    let { x, y } = props;
    if (props.mountX != null) {
      x -= ((_a2 = props.width) != null ? _a2 : 0) * props.mountX;
    }
    if (props.mountY != null) {
      y -= ((_b = props.height) != null ? _b : 0) * props.mountY;
    }
    if (x !== 0)
      transform += "translateX(".concat(x, "px)");
    if (y !== 0)
      transform += "translateY(".concat(y, "px)");
    if (props.rotation !== 0)
      transform += "rotate(".concat(props.rotation, "rad)");
    if (props.scale !== 1 && props.scale != null) {
      transform += "scale(".concat(props.scale, ")");
    } else {
      if (props.scaleX !== 1)
        transform += "scaleX(".concat(props.scaleX, ")");
      if (props.scaleY !== 1)
        transform += "scaleY(".concat(props.scaleY, ")");
    }
    if (transform.length > 0) {
      style += "transform: ".concat(transform, ";");
    }
  }
  if (node instanceof DOMText) {
    let textProps = node.props;
    if (textProps.color != null && textProps.color !== 0) {
      style += "color: ".concat(colorToRgba(textProps.color), ";");
    }
    if (textProps.fontFamily) {
      style += "font-family: ".concat(textProps.fontFamily, ";");
    }
    if (textProps.fontSize) {
      style += "font-size: ".concat(textProps.fontSize, "px;");
    }
    if (textProps.fontStyle !== "normal") {
      style += "font-style: ".concat(textProps.fontStyle, ";");
    }
    if (textProps.fontWeight !== "normal") {
      style += "font-weight: ".concat(textProps.fontWeight, ";");
    }
    if (textProps.fontStretch !== "normal") {
      style += "font-stretch: ".concat(textProps.fontStretch, ";");
    }
    if (textProps.lineHeight != null) {
      style += "line-height: ".concat(textProps.lineHeight, "px;");
    }
    if (textProps.letterSpacing) {
      style += "letter-spacing: ".concat(textProps.letterSpacing, "px;");
    }
    if (textProps.textAlign !== "left") {
      style += "text-align: ".concat(textProps.textAlign, ";");
    }
    let maxLines = textProps.maxLines || Infinity;
    switch (textProps.contain) {
      case "width":
        style += "width: ".concat(props.width, "px; overflow: hidden;");
        break;
      case "both": {
        let lineHeight = getNodeLineHeight(textProps);
        maxLines = Math.min(maxLines, Math.floor(props.height / lineHeight));
        maxLines = Math.max(1, maxLines);
        let height = maxLines * lineHeight;
        style += "width: ".concat(props.width, "px; height: ").concat(height, "px; overflow: hidden;");
        break;
      }
      case "none":
        style += "width: max-content;";
        break;
    }
    if (maxLines !== Infinity) {
      style += "display: -webkit-box;\n        overflow: hidden;\n        -webkit-line-clamp: ".concat(maxLines, ";\n        line-clamp: ").concat(maxLines, ";\n        -webkit-box-orient: vertical;");
    }
    scheduleUpdateDOMTextMeasurement(node);
  } else {
    if (props.width !== 0)
      style += "width: ".concat(props.width, "px;");
    if (props.height !== 0)
      style += "height: ".concat(props.height, "px;");
    let vGradient = props.colorBottom !== props.colorTop ? "linear-gradient(to bottom, ".concat(colorToRgba(props.colorTop), ", ").concat(colorToRgba(props.colorBottom), ")") : null;
    let hGradient = props.colorLeft !== props.colorRight ? "linear-gradient(to right, ".concat(colorToRgba(props.colorLeft), ", ").concat(colorToRgba(props.colorRight), ")") : null;
    let gradient = vGradient && hGradient ? "".concat(vGradient, ", ").concat(hGradient) : vGradient || hGradient;
    let srcImg = null;
    let srcPos = null;
    if (props.texture != null && props.texture.type === TextureType.subTexture) {
      srcPos = props.texture.props;
      srcImg = "url(".concat(props.texture.props.texture.props.src, ")");
    } else if (props.src) {
      srcImg = "url(".concat(props.src, ")");
    }
    let bgStyle = "";
    let borderStyle = "";
    let radiusStyle = "";
    let maskStyle = "";
    if (srcImg) {
      if (props.color !== 4294967295 && props.color !== 0) {
        bgStyle += "background-color: ".concat(colorToRgba(props.color), "; background-blend-mode: multiply;");
        maskStyle += "mask-image: ".concat(srcImg, ";");
        if (srcPos !== null) {
          maskStyle += "mask-position: -".concat(srcPos.x, "px -").concat(srcPos.y, "px;");
        } else {
          maskStyle += "mask-size: 100% 100%;";
        }
      } else if (gradient) {
        maskStyle += "mask-image: ".concat(gradient, ";");
      }
      bgStyle += "background-image: ".concat(srcImg, ";");
      bgStyle += "background-repeat: no-repeat;";
      if ((_c = props.textureOptions.resizeMode) == null ? void 0 : _c.type) {
        bgStyle += "background-size: ".concat(props.textureOptions.resizeMode.type, "; background-position: center;");
      } else if (srcPos !== null) {
        bgStyle += "background-position: -".concat(srcPos.x, "px -").concat(srcPos.y, "px;");
      } else {
        bgStyle += "background-size: 100% 100%;";
      }
      if (maskStyle !== "") {
        bgStyle += maskStyle;
      }
      if (maskStyle !== "" && node.divBg == null) {
        node.div.appendChild(node.divBg = document.createElement("div"));
        node.div.appendChild(node.divBorder = document.createElement("div"));
      }
    } else if (gradient) {
      bgStyle += "background-image: ".concat(gradient, ";");
      bgStyle += "background-repeat: no-repeat;";
      bgStyle += "background-size: 100% 100%;";
    } else if (props.color !== 0) {
      bgStyle += "background-color: ".concat(colorToRgba(props.color), ";");
    }
    if (props.shader != null) {
      let effects = (_d = props.shader.props) == null ? void 0 : _d.effects;
      if (Array.isArray(effects)) {
        for (let effect2 of effects) {
          switch (effect2.type) {
            case "radius": {
              let radius = (_e = effect2.props) == null ? void 0 : _e.radius;
              if (typeof radius === "number" && radius > 0) {
                radiusStyle += "border-radius: ".concat(radius, "px;");
              } else if (Array.isArray(radius) && radius.length === 4) {
                radiusStyle += "border-radius: ".concat(radius[0], "px ").concat(radius[1], "px ").concat(radius[2], "px ").concat(radius[3], "px;");
              }
              break;
            }
            case "border": {
              let borderWidth = (_f = effect2.props) == null ? void 0 : _f.width;
              let borderColor = (_g = effect2.props) == null ? void 0 : _g.color;
              if (typeof borderWidth === "number" && borderWidth !== 0 && typeof borderColor === "number" && borderColor !== 0) {
                borderStyle += "box-shadow: inset 0px 0px 0px ".concat(borderWidth, "px ").concat(colorToRgba(borderColor), ";");
              }
              break;
            }
            default:
              console.warn("Unknown shader effect type: ".concat(effect2.type));
              break;
          }
        }
      }
    }
    style += radiusStyle;
    bgStyle += radiusStyle;
    borderStyle += radiusStyle;
    if (node.divBg == null) {
      style += bgStyle;
    } else {
      bgStyle += "position: absolute; inset: 0; z-index: -1;";
      node.divBg.setAttribute("style", bgStyle);
    }
    if (node.divBorder == null) {
      style += borderStyle;
    } else {
      borderStyle += "position: absolute; inset: 0; z-index: -1;";
      node.divBorder.setAttribute("style", borderStyle);
    }
  }
  node.div.setAttribute("style", style);
}
const fontFamiliesToLoad = /* @__PURE__ */ new Set();
const textNodesToMeasure = /* @__PURE__ */ new Set();
function getElSize(node) {
  var _a2, _b;
  let rect = node.div.getBoundingClientRect();
  let dpr = (_b = (_a2 = Config.rendererOptions) == null ? void 0 : _a2.deviceLogicalPixelRatio) != null ? _b : 1;
  rect.height /= dpr;
  rect.width /= dpr;
  for (; ; ) {
    if (node.props.scale != null && node.props.scale !== 1) {
      rect.height /= node.props.scale;
      rect.width /= node.props.scale;
    } else {
      rect.height /= node.props.scaleY;
      rect.width /= node.props.scaleX;
    }
    if (node.parent instanceof DOMNode) {
      node = node.parent;
    } else {
      break;
    }
  }
  return rect;
}
function updateDOMTextSize(node) {
  let size;
  switch (node.contain) {
    case "width":
      size = getElSize(node);
      if (node.props.height !== size.height) {
        node.props.height = size.height;
        updateNodeStyles(node);
        node.emit("loaded");
      }
      break;
    case "none":
      size = getElSize(node);
      if (node.props.height !== size.height || node.props.width !== size.width) {
        node.props.width = size.width;
        node.props.height = size.height;
        updateNodeStyles(node);
        node.emit("loaded");
      }
      break;
  }
}
function updateDOMTextMeasurements() {
  textNodesToMeasure.forEach(updateDOMTextSize);
  textNodesToMeasure.clear();
}
function scheduleUpdateDOMTextMeasurement(node) {
  if (node.fontFamily && !fontFamiliesToLoad.has(node.fontFamily)) {
    fontFamiliesToLoad.add(node.fontFamily);
    document.fonts.load("16px ".concat(node.fontFamily));
  }
  if (textNodesToMeasure.size === 0) {
    if (document.fonts.status === "loaded") {
      setTimeout(updateDOMTextMeasurements);
    } else {
      document.fonts.ready.then(updateDOMTextMeasurements);
    }
  }
  textNodesToMeasure.add(node);
}
function updateNodeData(node) {
  for (let key in node.data) {
    let keyValue = node.data[key];
    if (keyValue === void 0) {
      node.div.removeAttribute("data-" + key);
    } else {
      node.div.setAttribute("data-" + key, String(keyValue));
    }
  }
}
function resolveNodeDefaults(props) {
  var _a2, _b, _c, _d, _e, _f, _g, _h, _i, _j, _k, _l, _m, _n, _o, _p, _q, _r, _s, _t, _u, _v, _w, _x, _y, _z, _A, _B, _C, _D, _E, _F, _G, _H, _I, _J, _K, _L, _M, _N, _O, _P, _Q, _R, _S, _T, _U, _V, _W, _X, _Y;
  const color = (_a2 = props.color) != null ? _a2 : 4294967295;
  return {
    x: (_b = props.x) != null ? _b : 0,
    y: (_c = props.y) != null ? _c : 0,
    width: (_d = props.width) != null ? _d : 0,
    height: (_e = props.height) != null ? _e : 0,
    alpha: (_f = props.alpha) != null ? _f : 1,
    autosize: (_g = props.autosize) != null ? _g : false,
    boundsMargin: (_h = props.boundsMargin) != null ? _h : null,
    clipping: (_i = props.clipping) != null ? _i : false,
    color,
    colorTop: (_j = props.colorTop) != null ? _j : color,
    colorBottom: (_k = props.colorBottom) != null ? _k : color,
    colorLeft: (_l = props.colorLeft) != null ? _l : color,
    colorRight: (_m = props.colorRight) != null ? _m : color,
    colorBl: (_p = (_o = (_n = props.colorBl) != null ? _n : props.colorBottom) != null ? _o : props.colorLeft) != null ? _p : color,
    colorBr: (_s = (_r = (_q = props.colorBr) != null ? _q : props.colorBottom) != null ? _r : props.colorRight) != null ? _s : color,
    colorTl: (_v = (_u = (_t = props.colorTl) != null ? _t : props.colorTop) != null ? _u : props.colorLeft) != null ? _v : color,
    colorTr: (_y = (_x = (_w = props.colorTr) != null ? _w : props.colorTop) != null ? _x : props.colorRight) != null ? _y : color,
    zIndex: (_z = props.zIndex) != null ? _z : 0,
    zIndexLocked: (_A = props.zIndexLocked) != null ? _A : 0,
    parent: (_B = props.parent) != null ? _B : null,
    texture: (_C = props.texture) != null ? _C : null,
    textureOptions: (_D = props.textureOptions) != null ? _D : {},
    shader: (_E = props.shader) != null ? _E : defaultShader,
    // Since setting the `src` will trigger a texture load, we need to set it after
    // we set the texture. Otherwise, problems happen.
    src: (_F = props.src) != null ? _F : null,
    srcHeight: props.srcHeight,
    srcWidth: props.srcWidth,
    srcX: props.srcX,
    srcY: props.srcY,
    scale: (_G = props.scale) != null ? _G : null,
    scaleX: (_I = (_H = props.scaleX) != null ? _H : props.scale) != null ? _I : 1,
    scaleY: (_K = (_J = props.scaleY) != null ? _J : props.scale) != null ? _K : 1,
    mount: (_L = props.mount) != null ? _L : 0,
    mountX: (_N = (_M = props.mountX) != null ? _M : props.mount) != null ? _N : 0,
    mountY: (_P = (_O = props.mountY) != null ? _O : props.mount) != null ? _P : 0,
    pivot: (_Q = props.pivot) != null ? _Q : 0.5,
    pivotX: (_S = (_R = props.pivotX) != null ? _R : props.pivot) != null ? _S : 0.5,
    pivotY: (_U = (_T = props.pivotY) != null ? _T : props.pivot) != null ? _U : 0.5,
    rotation: (_V = props.rotation) != null ? _V : 0,
    rtt: (_W = props.rtt) != null ? _W : false,
    data: {},
    imageType: props.imageType,
    strictBounds: (_X = props.strictBounds) != null ? _X : false,
    preventCleanup: (_Y = props.preventCleanup) != null ? _Y : false
  };
}
function resolveTextNodeDefaults(props) {
  var _a2, _b, _c, _d, _e, _f, _g, _h, _i, _j, _k, _l, _m, _n, _o, _p, _q, _r;
  return {
    ...resolveNodeDefaults(props),
    text: (_a2 = props.text) != null ? _a2 : "",
    textRendererOverride: (_b = props.textRendererOverride) != null ? _b : null,
    fontSize: (_c = props.fontSize) != null ? _c : 16,
    fontFamily: (_d = props.fontFamily) != null ? _d : "sans-serif",
    fontStyle: (_e = props.fontStyle) != null ? _e : "normal",
    fontWeight: (_f = props.fontWeight) != null ? _f : "normal",
    fontStretch: (_g = props.fontStretch) != null ? _g : "normal",
    textAlign: (_h = props.textAlign) != null ? _h : "left",
    contain: (_i = props.contain) != null ? _i : "none",
    scrollable: (_j = props.scrollable) != null ? _j : false,
    scrollY: (_k = props.scrollY) != null ? _k : 0,
    offsetY: (_l = props.offsetY) != null ? _l : 0,
    letterSpacing: (_m = props.letterSpacing) != null ? _m : 0,
    lineHeight: props.lineHeight,
    // `undefined` is a valid value
    maxLines: (_n = props.maxLines) != null ? _n : 0,
    textBaseline: (_o = props.textBaseline) != null ? _o : "alphabetic",
    verticalAlign: (_p = props.verticalAlign) != null ? _p : "middle",
    overflowSuffix: (_q = props.overflowSuffix) != null ? _q : "...",
    debug: (_r = props.debug) != null ? _r : {}
  };
}
const defaultShader = {
  shaderType: "",
  props: void 0
};
let lastNodeId = 0;
class DOMNode extends EventEmitter {
  constructor(stage, props) {
    super();
    __publicField(this, "stage");
    __publicField(this, "props");
    __publicField(this, "div", document.createElement("div"));
    __publicField(this, "divBg");
    __publicField(this, "divBorder");
    __publicField(this, "id", ++lastNodeId);
    __publicField(this, "renderState", 0);
    __publicField(this, "preventCleanup", true);
    __publicField(this, "animate", animate);
    this.stage = stage;
    this.props = props;
    this.div._node = this;
    this.div.setAttribute("data-id", String(this.id));
    elMap.set(this, this.div);
    updateNodeParent(this);
    updateNodeStyles(this);
    updateNodeData(this);
  }
  destroy() {
    elMap.delete(this);
    this.div.parentNode.removeChild(this.div);
  }
  get parent() {
    return this.props.parent;
  }
  set parent(value) {
    this.props.parent = value;
    updateNodeParent(this);
  }
  get x() {
    return this.props.x;
  }
  set x(v) {
    this.props.x = v;
    updateNodeStyles(this);
  }
  get y() {
    return this.props.y;
  }
  set y(v) {
    this.props.y = v;
    updateNodeStyles(this);
  }
  get width() {
    return this.props.width;
  }
  set width(v) {
    this.props.width = v;
    updateNodeStyles(this);
  }
  get height() {
    return this.props.height;
  }
  set height(v) {
    this.props.height = v;
    updateNodeStyles(this);
  }
  get alpha() {
    return this.props.alpha;
  }
  set alpha(v) {
    this.props.alpha = v;
    updateNodeStyles(this);
  }
  get autosize() {
    return this.props.autosize;
  }
  set autosize(v) {
    this.props.autosize = v;
    updateNodeStyles(this);
  }
  get clipping() {
    return this.props.clipping;
  }
  set clipping(v) {
    this.props.clipping = v;
    updateNodeStyles(this);
  }
  get color() {
    return this.props.color;
  }
  set color(v) {
    this.props.color = v;
    updateNodeStyles(this);
  }
  get colorTop() {
    return this.props.colorTop;
  }
  set colorTop(v) {
    this.props.colorTop = v;
    updateNodeStyles(this);
  }
  get colorBottom() {
    return this.props.colorBottom;
  }
  set colorBottom(v) {
    this.props.colorBottom = v;
    updateNodeStyles(this);
  }
  get colorLeft() {
    return this.props.colorLeft;
  }
  set colorLeft(v) {
    this.props.colorLeft = v;
    updateNodeStyles(this);
  }
  get colorRight() {
    return this.props.colorRight;
  }
  set colorRight(v) {
    this.props.colorRight = v;
    updateNodeStyles(this);
  }
  get colorTl() {
    return this.props.colorTl;
  }
  set colorTl(v) {
    this.props.colorTl = v;
    updateNodeStyles(this);
  }
  get colorTr() {
    return this.props.colorTr;
  }
  set colorTr(v) {
    this.props.colorTr = v;
    updateNodeStyles(this);
  }
  get colorBr() {
    return this.props.colorBr;
  }
  set colorBr(v) {
    this.props.colorBr = v;
    updateNodeStyles(this);
  }
  get colorBl() {
    return this.props.colorBl;
  }
  set colorBl(v) {
    this.props.colorBl = v;
    updateNodeStyles(this);
  }
  get zIndex() {
    return this.props.zIndex;
  }
  set zIndex(v) {
    this.props.zIndex = v;
    updateNodeStyles(this);
  }
  get texture() {
    return this.props.texture;
  }
  set texture(v) {
    this.props.texture = v;
    updateNodeStyles(this);
  }
  get textureOptions() {
    return this.props.textureOptions;
  }
  set textureOptions(v) {
    this.props.textureOptions = v;
    updateNodeStyles(this);
  }
  get src() {
    return this.props.src;
  }
  set src(v) {
    this.props.src = v;
    updateNodeStyles(this);
  }
  get zIndexLocked() {
    return this.props.zIndexLocked;
  }
  set zIndexLocked(v) {
    this.props.zIndexLocked = v;
    updateNodeStyles(this);
  }
  get scale() {
    var _a2;
    return (_a2 = this.props.scale) != null ? _a2 : 1;
  }
  set scale(v) {
    this.props.scale = v;
    updateNodeStyles(this);
  }
  get scaleX() {
    return this.props.scaleX;
  }
  set scaleX(v) {
    this.props.scaleX = v;
    updateNodeStyles(this);
  }
  get scaleY() {
    return this.props.scaleY;
  }
  set scaleY(v) {
    this.props.scaleY = v;
    updateNodeStyles(this);
  }
  get mount() {
    return this.props.mount;
  }
  set mount(v) {
    this.props.mount = v;
    updateNodeStyles(this);
  }
  get mountX() {
    return this.props.mountX;
  }
  set mountX(v) {
    this.props.mountX = v;
    updateNodeStyles(this);
  }
  get mountY() {
    return this.props.mountY;
  }
  set mountY(v) {
    this.props.mountY = v;
    updateNodeStyles(this);
  }
  get pivot() {
    return this.props.pivot;
  }
  set pivot(v) {
    this.props.pivot = v;
    updateNodeStyles(this);
  }
  get pivotX() {
    return this.props.pivotX;
  }
  set pivotX(v) {
    this.props.pivotX = v;
    updateNodeStyles(this);
  }
  get pivotY() {
    return this.props.pivotY;
  }
  set pivotY(v) {
    this.props.pivotY = v;
    updateNodeStyles(this);
  }
  get rotation() {
    return this.props.rotation;
  }
  set rotation(v) {
    this.props.rotation = v;
    updateNodeStyles(this);
  }
  get rtt() {
    return this.props.rtt;
  }
  set rtt(v) {
    this.props.rtt = v;
    updateNodeStyles(this);
  }
  get shader() {
    return this.props.shader;
  }
  set shader(v) {
    this.props.shader = v;
    updateNodeStyles(this);
  }
  get strictBounds() {
    return this.props.strictBounds;
  }
  set strictBounds(v) {
    this.props.strictBounds = v;
    updateNodeStyles(this);
  }
  get data() {
    return this.props.data;
  }
  set data(v) {
    this.props.data = v;
    updateNodeData(this);
  }
  get imageType() {
    return this.props.imageType;
  }
  set imageType(v) {
    this.props.imageType = v;
  }
  get srcWidth() {
    return this.props.srcWidth;
  }
  set srcWidth(v) {
    this.props.srcWidth = v;
  }
  get srcHeight() {
    return this.props.srcHeight;
  }
  set srcHeight(v) {
    this.props.srcHeight = v;
  }
  get srcX() {
    return this.props.srcX;
  }
  set srcX(v) {
    this.props.srcX = v;
  }
  get srcY() {
    return this.props.srcY;
  }
  set srcY(v) {
    this.props.srcY = v;
  }
  get boundsMargin() {
    return this.props.boundsMargin;
  }
  set boundsMargin(value) {
    this.props.boundsMargin = value;
  }
  get absX() {
    var _a2, _b;
    return this.x + -this.width * this.mountX + ((_b = (_a2 = this.parent) == null ? void 0 : _a2.absX) != null ? _b : 0);
  }
  get absY() {
    var _a2, _b;
    return this.y + -this.height * this.mountY + ((_b = (_a2 = this.parent) == null ? void 0 : _a2.absY) != null ? _b : 0);
  }
}
class DOMText extends DOMNode {
  constructor(stage, props) {
    super(stage, props);
    __publicField(this, "props");
    this.props = props;
    this.div.innerText = props.text;
  }
  get text() {
    return this.props.text;
  }
  set text(v) {
    this.props.text = v;
    this.div.innerText = v;
    scheduleUpdateDOMTextMeasurement(this);
  }
  get fontFamily() {
    return this.props.fontFamily;
  }
  set fontFamily(v) {
    this.props.fontFamily = v;
    updateNodeStyles(this);
  }
  get fontSize() {
    return this.props.fontSize;
  }
  set fontSize(v) {
    this.props.fontSize = v;
    updateNodeStyles(this);
  }
  get fontStyle() {
    return this.props.fontStyle;
  }
  set fontStyle(v) {
    this.props.fontStyle = v;
    updateNodeStyles(this);
  }
  get fontWeight() {
    return this.props.fontWeight;
  }
  set fontWeight(v) {
    this.props.fontWeight = v;
    updateNodeStyles(this);
  }
  get fontStretch() {
    return this.props.fontStretch;
  }
  set fontStretch(v) {
    this.props.fontStretch = v;
    updateNodeStyles(this);
  }
  get lineHeight() {
    return this.props.lineHeight;
  }
  set lineHeight(v) {
    this.props.lineHeight = v;
    updateNodeStyles(this);
  }
  get letterSpacing() {
    return this.props.letterSpacing;
  }
  set letterSpacing(v) {
    this.props.letterSpacing = v;
    updateNodeStyles(this);
  }
  get textAlign() {
    return this.props.textAlign;
  }
  set textAlign(v) {
    this.props.textAlign = v;
    updateNodeStyles(this);
  }
  get overflowSuffix() {
    return this.props.overflowSuffix;
  }
  set overflowSuffix(v) {
    this.props.overflowSuffix = v;
    updateNodeStyles(this);
  }
  get maxLines() {
    return this.props.maxLines;
  }
  set maxLines(v) {
    this.props.maxLines = v;
    updateNodeStyles(this);
  }
  get contain() {
    return this.props.contain;
  }
  set contain(v) {
    this.props.contain = v;
    updateNodeStyles(this);
  }
  get verticalAlign() {
    return this.props.verticalAlign;
  }
  set verticalAlign(v) {
    this.props.verticalAlign = v;
    updateNodeStyles(this);
  }
  get textBaseline() {
    return this.props.textBaseline;
  }
  set textBaseline(v) {
    this.props.textBaseline = v;
    updateNodeStyles(this);
  }
  get textRendererOverride() {
    return this.props.textRendererOverride;
  }
  set textRendererOverride(v) {
    this.props.textRendererOverride = v;
    updateNodeStyles(this);
  }
  get scrollable() {
    return this.props.scrollable;
  }
  set scrollable(v) {
    this.props.scrollable = v;
    updateNodeStyles(this);
  }
  get scrollY() {
    return this.props.scrollY;
  }
  set scrollY(v) {
    this.props.scrollY = v;
    updateNodeStyles(this);
  }
  get offsetY() {
    return this.props.offsetY;
  }
  set offsetY(v) {
    this.props.offsetY = v;
    updateNodeStyles(this);
  }
  get debug() {
    return this.props.debug;
  }
  set debug(v) {
    this.props.debug = v;
    updateNodeStyles(this);
  }
}
function updateRootPosition() {
  var _a2, _b, _c;
  let { canvas, settings } = this;
  let rect = canvas.getBoundingClientRect();
  let top = document.documentElement.scrollTop + rect.top;
  let left = document.documentElement.scrollLeft + rect.left;
  let dpr = (_a2 = settings.deviceLogicalPixelRatio) != null ? _a2 : 1;
  let height = Math.ceil((_b = settings.appHeight) != null ? _b : 1080 / dpr);
  let width = Math.ceil((_c = settings.appWidth) != null ? _c : 1920 / dpr);
  this.root.div.style.left = "".concat(left, "px");
  this.root.div.style.top = "".concat(top, "px");
  this.root.div.style.width = "".concat(width, "px");
  this.root.div.style.height = "".concat(height, "px");
  this.root.div.style.position = "absolute";
  this.root.div.style.transformOrigin = "0 0 0";
  this.root.div.style.transform = "scale(".concat(dpr, ", ").concat(dpr, ")");
  this.root.div.style.overflow = "hidden";
}
class DOMRendererMain {
  constructor(settings, rawTarget) {
    __publicField(this, "settings");
    __publicField(this, "root");
    __publicField(this, "canvas");
    __publicField(this, "stage");
    var _a2, _b;
    this.settings = settings;
    let target;
    if (typeof rawTarget === "string") {
      let result = document.getElementById(rawTarget);
      if (result instanceof HTMLElement) {
        target = result;
      } else {
        throw new Error("Target #".concat(rawTarget, " not found"));
      }
    } else {
      target = rawTarget;
    }
    let canvas = document.body.appendChild(document.createElement("canvas"));
    canvas.style.position = "absolute";
    canvas.style.top = "0";
    canvas.style.left = "0";
    canvas.style.width = "100vw";
    canvas.style.height = "100vh";
    this.canvas = canvas;
    this.stage = {
      root: null,
      renderer: {
        mode: "canvas"
      },
      fontManager: {
        addFontFace: () => {
        }
      },
      shManager: {
        registerShaderType() {
        }
      },
      animationManager: {
        registerAnimation(anim) {
          console.log("registerAnimation", anim);
        },
        unregisterAnimation(anim) {
          console.log("unregisterAnimation", anim);
        }
      }
    };
    this.root = new DOMNode(this.stage, resolveNodeDefaults({
      width: (_a2 = settings.appWidth) != null ? _a2 : 1920,
      height: (_b = settings.appHeight) != null ? _b : 1080,
      shader: defaultShader,
      zIndex: 65534
    }));
    this.stage.root = this.root;
    target.appendChild(this.root.div);
    if (Config.fontSettings.fontFamily) {
      this.root.div.style.fontFamily = Config.fontSettings.fontFamily;
    }
    if (Config.fontSettings.fontSize) {
      this.root.div.style.fontSize = Config.fontSettings.fontSize + "px";
    }
    if (Config.fontSettings.lineHeight) {
      this.root.div.style.lineHeight = Config.fontSettings.lineHeight + "px";
    } else {
      this.root.div.style.lineHeight = "1.2";
    }
    if (Config.fontSettings.fontWeight) {
      if (typeof Config.fontSettings.fontWeight === "number") {
        this.root.div.style.fontWeight = Config.fontSettings.fontWeight + "px";
      } else {
        this.root.div.style.fontWeight = Config.fontSettings.fontWeight;
      }
    }
    updateRootPosition.call(this);
    new MutationObserver(updateRootPosition.bind(this)).observe(this.canvas, {
      attributes: true
    });
    new ResizeObserver(updateRootPosition.bind(this)).observe(this.canvas);
    window.addEventListener("resize", updateRootPosition.bind(this));
  }
  createNode(props) {
    return new DOMNode(this.stage, resolveNodeDefaults(props));
  }
  createTextNode(props) {
    return new DOMText(this.stage, resolveTextNodeDefaults(props));
  }
  createShader(shaderType, props) {
    return { shaderType, props, program: {} };
  }
  createTexture(textureType, props) {
    let type = TextureType.generic;
    switch (textureType) {
      case "SubTexture":
        type = TextureType.subTexture;
        break;
      case "ImageTexture":
        type = TextureType.image;
        break;
      case "ColorTexture":
        type = TextureType.color;
        break;
      case "NoiseTexture":
        type = TextureType.noise;
        break;
      case "RenderTexture":
        type = TextureType.renderToTexture;
        break;
    }
    return { type, props };
  }
  createEffect(type, props, name) {
    return { type, props, name };
  }
  on(name, callback) {
    console.log("on", name, callback);
  }
}
let renderer$1;
function startLightningRenderer(options, rootId = "app") {
  renderer$1 = DOM_RENDERING ? new DOMRendererMain(options, rootId) : new RendererMain(options, rootId);
  return renderer$1;
}
function loadFonts(fonts2) {
  for (const font of fonts2) {
    if (renderer$1.stage.renderer.mode === "webgl" && "type" in font && (font.type === "msdf" || font.type === "ssdf")) {
      renderer$1.stage.fontManager.addFontFace(new SdfTrFontFace(font.type, {
        ...font,
        stage: renderer$1.stage
      }));
    } else if ("fontUrl" in font) {
      renderer$1.stage.fontManager.addFontFace(new WebTrFontFace(font));
    }
  }
}
const NodeType = {
  Element: "element",
  TextNode: "textNode",
  Text: "text"
};
function log(msg, node, ...args) {
}
const isFunc = (obj) => obj instanceof Function;
const isFunction = (obj) => typeof obj === "function";
function isArray(item) {
  return Array.isArray(item);
}
function isString(item) {
  return typeof item === "string";
}
function isNumber(item) {
  return typeof item === "number";
}
function isInteger(item) {
  return Number.isInteger(item);
}
function isINode(node) {
  return "destroy" in node && typeof node.destroy === "function";
}
function isElementNode(node) {
  return node instanceof ElementNode;
}
function isElementText(node) {
  return node._type === NodeType.TextNode;
}
function isTextNode(node) {
  return node._type === NodeType.Text;
}
function keyExists(obj, keys) {
  for (const key of keys) {
    if (key in obj) {
      return true;
    }
  }
  return false;
}
class States extends Array {
  constructor(callback, initialState = {}) {
    var __super = (...args) => {
      super(...args);
      __publicField(this, "onChange");
      return this;
    };
    if (isArray(initialState)) {
      __super(...initialState);
    } else if (isString(initialState)) {
      __super(initialState);
    } else {
      __super(...Object.entries(initialState).filter(([_key, value]) => value).map(([key]) => key));
    }
    this.onChange = callback;
    return this;
  }
  has(state) {
    return this.indexOf(state) >= 0 || this.indexOf("$".concat(state)) >= 0;
  }
  is(state) {
    return this.indexOf(state) >= 0;
  }
  add(state) {
    if (this.has(state)) {
      return;
    }
    this.push(state);
    this.onChange();
  }
  toggle(state, force) {
    if (force === true) {
      this.add(state);
    } else if (force === false) {
      this.remove(state);
    } else {
      if (this.has(state)) {
        this.remove(state);
      } else {
        this.add(state);
      }
    }
  }
  merge(newStates) {
    if (isArray(newStates)) {
      this.length = 0;
      this.push(...newStates);
    } else if (isString(newStates)) {
      this.length = 0;
      this.push(newStates);
    } else {
      for (const state in newStates) {
        const value = newStates[state];
        if (value) {
          if (!this.has(state)) {
            this.push(state);
          }
        } else {
          const stateIndexToRemove = this.indexOf(state);
          if (stateIndexToRemove >= 0) {
            this.splice(stateIndexToRemove, 1);
          }
        }
      }
    }
    return this;
  }
  remove(state) {
    const stateIndexToRemove = this.indexOf(state);
    if (stateIndexToRemove >= 0) {
      this.splice(stateIndexToRemove, 1);
      this.onChange();
    }
  }
}
function calculateFlex(node) {
  var _a2, _b, _c;
  const direction = node.flexDirection || "row";
  const isRow = direction === "row";
  const dimension = isRow ? "width" : "height";
  const crossDimension = isRow ? "height" : "width";
  const marginOne = isRow ? "marginLeft" : "marginTop";
  const crossMarginOne = isRow ? "marginTop" : "marginLeft";
  const marginTwo = isRow ? "marginRight" : "marginBottom";
  const crossMarginTwo = isRow ? "marginBottom" : "marginRight";
  const processedChildren = [];
  let hasOrder = false;
  let totalFlexGrow = 0;
  for (let i = 0; i < node.children.length; i++) {
    const c = node.children[i];
    if (isElementText(c) && c.text && !(c.width || c.height)) {
      return false;
    }
    if (isTextNode(c) || c.flexItem === false) {
      continue;
    }
    const flexOrder = c.flexOrder;
    if (flexOrder !== void 0) {
      hasOrder = true;
    }
    const flexGrow = c.flexGrow;
    const isGrowItem = flexGrow !== void 0 && flexGrow >= 0;
    if (isGrowItem) {
      totalFlexGrow += flexGrow;
    }
    const mainSize = c[dimension] || 0;
    const currentMarginStart = c[marginOne] || 0;
    const currentMarginEnd = c[marginTwo] || 0;
    processedChildren.push({
      node: c,
      mainSize,
      marginStart: currentMarginStart,
      marginEnd: currentMarginEnd,
      totalMainSizeOnAxis: mainSize + currentMarginStart + currentMarginEnd,
      isGrowItem,
      flexGrowValue: isGrowItem ? flexGrow : 0,
      flexOrder: flexOrder || 0,
      crossSize: c[crossDimension] || 0,
      crossMarginStart: c[crossMarginOne] || 0,
      crossMarginEnd: c[crossMarginTwo] || 0
    });
  }
  if (hasOrder) {
    processedChildren.sort((a, b) => a.flexOrder - b.flexOrder);
  } else if (node.direction === "rtl") {
    processedChildren.reverse();
  }
  const numProcessedChildren = processedChildren.length;
  if (numProcessedChildren === 0) {
    return false;
  }
  const prop = isRow ? "x" : "y";
  const crossProp = isRow ? "y" : "x";
  const containerSize = node[dimension] || 0;
  let containerCrossSize = node[crossDimension] || 0;
  const gap = node.gap || 0;
  const justify = node.justifyContent || "flexStart";
  let containerUpdated = false;
  if (totalFlexGrow > 0 && numProcessedChildren > 1) {
    node.flexBoundary = node.flexBoundary || "fixed";
    let sumOfFlexBaseSizesWithMargins = 0;
    for (const pc of processedChildren) {
      sumOfFlexBaseSizesWithMargins += pc.mainSize + pc.marginStart + pc.marginEnd;
    }
    const totalGapSpace = numProcessedChildren > 0 ? gap * (numProcessedChildren - 1) : 0;
    const availableSpace = containerSize - sumOfFlexBaseSizesWithMargins - totalGapSpace;
    if (availableSpace > 0) {
      for (const pc of processedChildren) {
        if (pc.isGrowItem && pc.flexGrowValue > 0) {
          const shareOfSpace = pc.flexGrowValue / totalFlexGrow * availableSpace;
          const newMainSize = pc.mainSize + shareOfSpace;
          pc.node[dimension] = newMainSize;
          pc.mainSize = newMainSize;
          pc.totalMainSizeOnAxis = newMainSize + pc.marginStart + pc.marginEnd;
        }
      }
    } else {
      console.warn("No available space for flex-grow items to expand, or items overflow.");
    }
  }
  let totalItemSize = 0;
  if (justify === "center" || justify === "spaceBetween" || justify === "spaceEvenly") {
    for (const pc of processedChildren) {
      totalItemSize += pc.totalMainSizeOnAxis;
    }
  }
  const align = node.alignItems || (node.flexWrap ? "flexStart" : void 0);
  const doCrossAlign = containerCrossSize ? (pc, crossCurrentPos = 0) => {
    const alignSelf = pc.node.alignSelf || align;
    if (!alignSelf) {
      return;
    }
    if (alignSelf === "flexStart") {
      pc.node[crossProp] = crossCurrentPos + pc.crossMarginStart;
    } else if (alignSelf === "center") {
      pc.node[crossProp] = crossCurrentPos + (containerCrossSize - pc.crossSize) / 2 + pc.crossMarginStart;
    } else if (alignSelf === "flexEnd") {
      pc.node[crossProp] = crossCurrentPos + containerCrossSize - pc.crossSize - pc.crossMarginEnd;
    }
  } : (_pc, _crossCurrentPos = 0) => {
  };
  if (isRow && node._calcHeight && !node.flexCrossBoundary) {
    const firstChildNode = (_a2 = processedChildren[0]) == null ? void 0 : _a2.node;
    const newHeight = (firstChildNode == null ? void 0 : firstChildNode.height) || node.height;
    if (newHeight !== node.height) {
      containerUpdated = true;
      node.height = containerCrossSize = newHeight;
    }
  }
  let currentPos = node.padding || 0;
  if (justify === "flexStart") {
    if (node.flexWrap === "wrap") {
      let crossCurrentPos = 0;
      const crossGap = isRow ? (_b = node.columnGap) != null ? _b : gap : (_c = node.rowGap) != null ? _c : gap;
      for (const pc of processedChildren) {
        if (currentPos + pc.totalMainSizeOnAxis > containerSize && currentPos > (node.padding || 0)) {
          currentPos = node.padding || 0;
          crossCurrentPos += containerCrossSize + crossGap;
        }
        pc.node[prop] = currentPos + pc.marginStart;
        currentPos += pc.totalMainSizeOnAxis + gap;
        doCrossAlign(pc, crossCurrentPos);
      }
      const finalCrossSize = crossCurrentPos + containerCrossSize;
      if (node[crossDimension] !== finalCrossSize) {
        node["preFlex".concat(crossDimension)] = node[crossDimension];
        node[crossDimension] = finalCrossSize;
        containerUpdated = true;
      }
    } else {
      for (const pc of processedChildren) {
        pc.node[prop] = currentPos + pc.marginStart;
        currentPos += pc.totalMainSizeOnAxis + gap;
        doCrossAlign(pc);
      }
    }
    if (node.flexBoundary !== "fixed" && node.flexWrap !== "wrap") {
      const calculatedSize = currentPos - gap + (node.padding || 0);
      if (calculatedSize !== containerSize) {
        node["preFlex".concat(dimension)] = containerSize;
        node[dimension] = calculatedSize;
        return true;
      }
    }
  } else if (justify === "flexEnd") {
    currentPos = containerSize - (node.padding || 0);
    for (let i = numProcessedChildren - 1; i >= 0; i--) {
      const pc = processedChildren[i];
      pc.node[prop] = currentPos - pc.mainSize - pc.marginEnd;
      currentPos -= pc.totalMainSizeOnAxis + gap;
      doCrossAlign(pc);
    }
  } else if (justify === "center") {
    currentPos = (containerSize - (totalItemSize + gap * (numProcessedChildren - 1))) / 2 + (node.padding || 0);
    for (const pc of processedChildren) {
      pc.node[prop] = currentPos + pc.marginStart;
      currentPos += pc.totalMainSizeOnAxis + gap;
      doCrossAlign(pc);
    }
  } else if (justify === "spaceBetween") {
    const spaceBetween = numProcessedChildren > 1 ? (containerSize - totalItemSize - (node.padding || 0) * 2) / (numProcessedChildren - 1) : 0;
    currentPos = node.padding || 0;
    for (const pc of processedChildren) {
      pc.node[prop] = currentPos + pc.marginStart;
      currentPos += pc.totalMainSizeOnAxis + spaceBetween;
      doCrossAlign(pc);
    }
  } else if (justify === "spaceEvenly") {
    const spaceAround = (containerSize - totalItemSize - (node.padding || 0) * 2) / (numProcessedChildren + 1);
    currentPos = spaceAround + (node.padding || 0);
    for (const pc of processedChildren) {
      pc.node[prop] = currentPos + pc.marginStart;
      currentPos += pc.totalMainSizeOnAxis + spaceAround;
      doCrossAlign(pc);
    }
  }
  return containerUpdated;
}
const keyMapEntries = {
  ArrowLeft: "Left",
  ArrowRight: "Right",
  ArrowUp: "Up",
  ArrowDown: "Down",
  Enter: "Enter",
  l: "Last",
  " ": "Space",
  Backspace: "Back",
  Escape: "Escape"
};
const keyHoldMapEntries = {
  // Enter: 'EnterHold',
};
const flattenKeyMap = (keyMap, targetMap) => {
  for (const [key, value] of Object.entries(keyMap)) {
    if (Array.isArray(value)) {
      value.forEach((v) => {
        targetMap[v] = key;
      });
    } else if (value === null) {
      delete targetMap[key];
    } else {
      targetMap[value] = key;
    }
  }
};
let needFocusDebugStyles = true;
const addFocusDebug = (prevFocusPath2, newFocusPath) => {
  if (needFocusDebugStyles) {
    const style = document.createElement("style");
    style.type = "text/css";
    style.innerHTML = '\n      [data-focus="3"] {\n        border: 2px solid rgba(255, 33, 33, 0.2);\n        border-radius: 5px;\n        transition: border-color 0.3s ease;\n      }\n\n      [data-focus="2"] {\n        border: 2px solid rgba(255, 33, 33, 0.4);\n        border-radius: 5px;\n        transition: border-color 0.3s ease;\n      }\n\n      [data-focus="1"] {\n        border: 4px solid rgba(255, 33, 33, 0.9);\n        border-radius: 5px;\n        transition: border-color 0.5s ease;\n      }\n    ';
    document.head.appendChild(style);
    needFocusDebugStyles = false;
  }
  prevFocusPath2.forEach((elm) => {
    elm.data = {
      ...elm.data,
      focus: void 0
    };
  });
  newFocusPath.forEach((elm, i) => {
    elm.data = {
      ...elm.data,
      focus: i + 1
    };
  });
};
let activeElement$1;
const setActiveElement$1 = (elm) => {
  updateFocusPath(elm, activeElement$1);
  activeElement$1 = elm;
  Config.setActiveElement(elm);
};
let focusPath$1 = [];
const updateFocusPath = (currentFocusedElm, prevFocusedElm) => {
  var _a2, _b;
  let current = currentFocusedElm;
  const fp = [];
  while (current) {
    if (!current.states.has(Config.focusStateKey) || current === currentFocusedElm) {
      current.states.add(Config.focusStateKey);
      (_a2 = current.onFocus) == null ? void 0 : _a2.call(current, currentFocusedElm, prevFocusedElm);
      (_b = current.onFocusChanged) == null ? void 0 : _b.call(current, true, currentFocusedElm, prevFocusedElm);
    }
    fp.push(current);
    current = current.parent;
  }
  focusPath$1.forEach((elm) => {
    var _a3, _b2;
    if (!fp.includes(elm)) {
      elm.states.remove(Config.focusStateKey);
      (_a3 = elm.onBlur) == null ? void 0 : _a3.call(elm, currentFocusedElm, prevFocusedElm);
      (_b2 = elm.onFocusChanged) == null ? void 0 : _b2.call(elm, false, currentFocusedElm, prevFocusedElm);
    }
  });
  if (Config.focusDebug) {
    addFocusDebug(focusPath$1, fp);
  }
  focusPath$1 = fp;
  return fp;
};
const propagateKeyPress = (e, mappedEvent, isHold = false, isUp = false) => {
  let finalFocusElm;
  const numItems = focusPath$1.length;
  const captureEvent = "onCapture".concat(mappedEvent || e.key) + isUp ? "Release" : "";
  const captureKey = isUp ? "onCaptureKeyRelease" : "onCaptureKey";
  for (let i = numItems - 1; i >= 0; i--) {
    const elm = focusPath$1[i];
    const captureHandler = elm[captureEvent] || elm[captureKey];
    if (isFunction(captureHandler)) {
      if (captureHandler.call(elm, e, elm, finalFocusElm, mappedEvent) === true) {
        return true;
      }
    }
  }
  let eventHandlerKey;
  let releaseEventHandlerKey;
  let fallbackHandlerKey;
  if (mappedEvent) {
    eventHandlerKey = "on".concat(mappedEvent);
    releaseEventHandlerKey = "on".concat(mappedEvent, "Release");
  }
  if (!isUp) {
    fallbackHandlerKey = isHold ? "onKeyHold" : "onKeyPress";
  }
  for (let i = 0; i < numItems; i++) {
    const elm = focusPath$1[i];
    if (!finalFocusElm) {
      finalFocusElm = elm;
    }
    if (isUp && releaseEventHandlerKey) {
      const eventHandler = elm[releaseEventHandlerKey];
      if (isFunction(eventHandler)) {
        if (eventHandler.call(elm, e, elm, finalFocusElm) === true) {
          return true;
        }
      }
    } else if (!isUp && eventHandlerKey) {
      const eventHandler = elm[eventHandlerKey];
      if (isFunction(eventHandler)) {
        if (eventHandler.call(elm, e, elm, finalFocusElm) === true) {
          return true;
        }
      }
    }
    if (fallbackHandlerKey) {
      const fallbackHandler = elm[fallbackHandlerKey];
      if (isFunction(fallbackHandler)) {
        if (fallbackHandler.call(elm, e, mappedEvent, elm, finalFocusElm) === true) {
          return true;
        }
      }
    }
  }
  return false;
};
const DEFAULT_KEY_HOLD_THRESHOLD = 500;
const keyHoldTimeouts = {};
const handleKeyEvents = (delay2, keydown, keyup) => {
  if (keydown) {
    const key = keydown.key || keydown.keyCode;
    const mappedKeyHoldEvent = keyHoldMapEntries[keydown.key] || keyHoldMapEntries[keydown.keyCode];
    const mappedKeyEvent = keyMapEntries[keydown.key] || keyMapEntries[keydown.keyCode];
    if (mappedKeyHoldEvent) {
      if (!keyHoldTimeouts[key]) {
        keyHoldTimeouts[key] = window.setTimeout(() => {
          keyHoldTimeouts[key] = true;
          propagateKeyPress(keydown, mappedKeyHoldEvent, true);
        }, delay2);
      }
      return;
    }
    propagateKeyPress(keydown, mappedKeyEvent, false);
  } else if (keyup) {
    const key = keyup.key || keyup.keyCode;
    const mappedKeyEvent = keyMapEntries[keyup.key] || keyMapEntries[keyup.keyCode];
    if (keyHoldTimeouts[key] === true) {
      delete keyHoldTimeouts[key];
    } else if (keyHoldTimeouts[key]) {
      clearTimeout(keyHoldTimeouts[key]);
      delete keyHoldTimeouts[key];
      propagateKeyPress(keyup, mappedKeyEvent, false);
    }
    propagateKeyPress(keyup, mappedKeyEvent, false, true);
  }
};
const useFocusManager$1 = ({ userKeyMap, keyHoldOptions, ownerContext = (cb) => {
  cb();
} } = {}) => {
  if (userKeyMap) {
    flattenKeyMap(userKeyMap, keyMapEntries);
  }
  if (keyHoldOptions == null ? void 0 : keyHoldOptions.userKeyHoldMap) {
    flattenKeyMap(keyHoldOptions.userKeyHoldMap, keyHoldMapEntries);
  }
  const delay2 = (keyHoldOptions == null ? void 0 : keyHoldOptions.holdThreshold) || DEFAULT_KEY_HOLD_THRESHOLD;
  const runKeyEvent = handleKeyEvents.bind(null, delay2);
  const keyPressHandler = (event) => ownerContext(() => {
    runKeyEvent(event, void 0);
  });
  const keyUpHandler = (event) => ownerContext(() => {
    runKeyEvent(void 0, event);
  });
  document.addEventListener("keyup", keyUpHandler);
  document.addEventListener("keydown", keyPressHandler);
  return {
    cleanup: () => {
      document.removeEventListener("keydown", keyPressHandler);
      document.removeEventListener("keyup", keyUpHandler);
      for (const [_, timeout] of Object.entries(keyHoldTimeouts)) {
        if (timeout && timeout !== true)
          clearTimeout(timeout);
      }
    },
    focusPath: () => focusPath$1
  };
};
function mergeColorProgress(rgba1, rgba2, p) {
  const r1 = Math.trunc(rgba1 >>> 24);
  const g1 = Math.trunc(rgba1 >>> 16 & 255);
  const b1 = Math.trunc(rgba1 >>> 8 & 255);
  const a1 = Math.trunc(rgba1 & 255);
  const r2 = Math.trunc(rgba2 >>> 24);
  const g2 = Math.trunc(rgba2 >>> 16 & 255);
  const b2 = Math.trunc(rgba2 >>> 8 & 255);
  const a2 = Math.trunc(rgba2 & 255);
  const r = Math.round(r2 * p + r1 * (1 - p));
  const g = Math.round(g2 * p + g1 * (1 - p));
  const b = Math.round(b2 * p + b1 * (1 - p));
  const a = Math.round(a2 * p + a1 * (1 - p));
  return (r << 24 | g << 16 | b << 8 | a) >>> 0;
}
const getTimingBezier = (a, b, c, d) => {
  const xc = 3 * a;
  const xb = 3 * (c - a) - xc;
  const xa = 1 - xc - xb;
  const yc = 3 * b;
  const yb = 3 * (d - b) - yc;
  const ya = 1 - yc - yb;
  return function(time) {
    if (time >= 1) {
      return 1;
    }
    if (time <= 0) {
      return 0;
    }
    let t = 0.5, cbx, cbxd, dx;
    for (let it = 0; it < 20; it++) {
      cbx = t * (t * (t * xa + xb) + xc);
      dx = time - cbx;
      if (dx > -1e-8 && dx < 1e-8) {
        return t * (t * (t * ya + yb) + yc);
      }
      cbxd = t * (t * (3 * xa) + 2 * xb) + xc;
      if (cbxd > 1e-10 && cbxd < 1e-10) {
        break;
      }
      t += dx / cbxd;
    }
    let minT = 0;
    let maxT = 1;
    for (let it = 0; it < 20; it++) {
      t = 0.5 * (minT + maxT);
      cbx = t * (t * (t * xa + xb) + xc);
      dx = time - cbx;
      if (dx > -1e-8 && dx < 1e-8) {
        return t * (t * (t * ya + yb) + yc);
      }
      if (dx < 0) {
        maxT = t;
      } else {
        minT = t;
      }
    }
  };
};
const timingMapping = {};
const timingLookup = {
  ease: [0.25, 0.1, 0.25, 1],
  "ease-in": [0.42, 0, 1, 1],
  "ease-out": [0, 0, 0.58, 1],
  "ease-in-out": [0.42, 0, 0.58, 1],
  "ease-in-sine": [0.12, 0, 0.39, 0],
  "ease-out-sine": [0.12, 0, 0.39, 0],
  "ease-in-out-sine": [0.37, 0, 0.63, 1],
  "ease-in-cubic": [0.32, 0, 0.67, 0],
  "ease-out-cubic": [0.33, 1, 0.68, 1],
  "ease-in-out-cubic": [0.65, 0, 0.35, 1],
  "ease-in-circ": [0.55, 0, 1, 0.45],
  "ease-out-circ": [0, 0.55, 0.45, 1],
  "ease-in-out-circ": [0.85, 0, 0.15, 1],
  "ease-in-back": [0.36, 0, 0.66, -0.56],
  "ease-out-back": [0.34, 1.56, 0.64, 1],
  "ease-in-out-back": [0.68, -0.6, 0.32, 1.6]
};
const defaultTiming = (t) => t;
const parseCubicBezier = (str) => {
  const regex = /-?\d*\.?\d+/g;
  const match = str.match(regex);
  if (match) {
    const [num1, num2, num3, num4] = match;
    const a = parseFloat(num1 || "0.42");
    const b = parseFloat(num2 || "0");
    const c = parseFloat(num3 || "1");
    const d = parseFloat(num4 || "1");
    const timing = getTimingBezier(a, b, c, d);
    timingMapping[str] = timing;
    return timing;
  }
  console.warn("Unknown cubic-bezier timing: " + str);
  return defaultTiming;
};
const getTimingFunction = (str) => {
  if (str === "linear") {
    return defaultTiming;
  }
  if (timingMapping[str] !== void 0) {
    return timingMapping[str] || defaultTiming;
  }
  if (str === "step-start") {
    return () => {
      return 1;
    };
  }
  if (str === "step-end") {
    return (time) => {
      return time === 1 ? 1 : 0;
    };
  }
  const lookup = timingLookup[str];
  if (lookup !== void 0) {
    const [a, b, c, d] = lookup;
    const timing = getTimingBezier(a, b, c, d);
    timingMapping[str] = timing;
    return timing;
  }
  if (str.startsWith("cubic-bezier")) {
    return parseCubicBezier(str);
  }
  console.warn("Unknown timing function: " + str);
  return defaultTiming;
};
class SimpleAnimation {
  constructor() {
    __publicField(this, "nodeConfigs", []);
    __publicField(this, "isRegistered", false);
    __publicField(this, "stage");
  }
  register(stage) {
    if (this.isRegistered) {
      return;
    }
    this.isRegistered = true;
    this.stage = stage;
    stage.animationManager.registerAnimation(this);
  }
  /**
   * Adds a node and its animation properties to this animation instance.
   * The animation's start values for the specified properties are captured
   * from the node's current state when this method is called.
   *
   * @param node - The CoreNode to animate.
   * @param props - The properties to animate and their target values. Only number properties are supported.
   * @param settings - Animation settings for this specific node animation.
   */
  add(node, key, value, settings) {
    var _a2, _b;
    const duration = (_a2 = settings.duration) != null ? _a2 : 0;
    const delay2 = (_b = settings.delay) != null ? _b : 0;
    const easing = settings.easing || "linear";
    const timingFunction = getTimingFunction(easing);
    const targetValue = value;
    const startValue = node[key];
    this.nodeConfigs.push({
      node,
      duration,
      delay: delay2,
      easing,
      progress: 0,
      delayFor: delay2,
      timingFunction,
      propName: key,
      startValue,
      targetValue
    });
  }
  update(dt) {
    var _a2;
    for (let i = this.nodeConfigs.length - 1; i >= 0; i--) {
      const nodeConfig = this.nodeConfigs[i];
      const { node, duration, timingFunction, propName, startValue, targetValue } = nodeConfig;
      let remainingDt = dt;
      if (nodeConfig.delayFor > 0) {
        nodeConfig.delayFor -= remainingDt;
        if (nodeConfig.delayFor >= 0) {
          continue;
        } else {
          remainingDt = -nodeConfig.delayFor;
          nodeConfig.delayFor = 0;
        }
      }
      if (duration > 0) {
        nodeConfig.progress += remainingDt / duration;
        nodeConfig.progress = Math.max(0, Math.min(1, nodeConfig.progress));
      } else if (duration === 0 && nodeConfig.delayFor <= 0) {
        nodeConfig.progress = 1;
      }
      const easedProgress = timingFunction(nodeConfig.progress) || nodeConfig.progress;
      let interpolatedValue;
      if (nodeConfig.progress === 1) {
        interpolatedValue = targetValue;
      } else {
        if (propName.includes("color")) {
          interpolatedValue = mergeColorProgress(startValue, targetValue, easedProgress);
        } else {
          interpolatedValue = startValue + (targetValue - startValue) * easedProgress;
        }
      }
      node.lng[propName] = interpolatedValue;
      if (nodeConfig.progress === 1) {
        this.nodeConfigs.splice(i, 1);
      }
      if (this.nodeConfigs.length === 0) {
        (_a2 = this.stage) == null ? void 0 : _a2.animationManager.unregisterAnimation(this);
        this.isRegistered = false;
      }
    }
  }
}
const simpleAnimation = new SimpleAnimation();
let layoutRunQueued = false;
const layoutQueue = /* @__PURE__ */ new Set();
function runLayout() {
  layoutRunQueued = false;
  const queue = [...layoutQueue];
  layoutQueue.clear();
  for (let i = queue.length - 1; i >= 0; i--) {
    const node = queue[i];
    node.updateLayout();
  }
}
function convertEffectsToShader(node, styleEffects) {
  const effects = [];
  for (const type in styleEffects) {
    let props = styleEffects[type];
    if (typeof props === "object") {
      effects.push(renderer$1.createEffect(type, props, type));
    }
  }
  return renderer$1.createShader("DynamicShader", { effects });
}
function borderAccessor(direction = "") {
  return {
    set(value) {
      if (isNumber(value)) {
        value = { width: value, color: 255 };
      }
      this.effects = this.effects ? {
        ...this.effects || {},
        ...{ ["border".concat(direction)]: value }
      } : { ["border".concat(direction)]: value };
    },
    get() {
      var _a2;
      return (_a2 = this.effects) == null ? void 0 : _a2["border".concat(direction)];
    }
  };
}
const LightningRendererNumberProps = [
  "alpha",
  "color",
  "colorTop",
  "colorRight",
  "colorLeft",
  "colorBottom",
  "colorTl",
  "colorTr",
  "colorBl",
  "colorBr",
  "height",
  "fontSize",
  "lineHeight",
  "mount",
  "mountX",
  "mountY",
  "pivot",
  "pivotX",
  "pivotY",
  "rotation",
  "scale",
  "scaleX",
  "scaleY",
  "width",
  "worldX",
  "worldY",
  "x",
  "y",
  "zIndex",
  "zIndexLocked"
];
const LightningRendererNonAnimatingProps = [
  "absX",
  "absY",
  "autosize",
  "clipping",
  "contain",
  "data",
  "fontFamily",
  "fontStretch",
  "fontStyle",
  "fontWeight",
  "imageType",
  "letterSpacing",
  "maxLines",
  "offsetY",
  "overflowSuffix",
  "preventCleanup",
  "rtt",
  "scrollable",
  "scrollY",
  "srcHeight",
  "srcWidth",
  "srcX",
  "srcY",
  "strictBounds",
  "text",
  "textAlign",
  "textBaseline",
  "textOverflow",
  "texture",
  "textureOptions",
  "verticalAlign",
  "wordWrap"
];
class ElementNode extends Object {
  constructor(name) {
    super();
    this._type = name === "text" ? NodeType.TextNode : NodeType.Element;
    this.rendered = false;
    this.lng = {};
    this.children = [];
  }
  get effects() {
    return this._effects;
  }
  set effects(v) {
    this._effects = v;
    if (SHADERS_ENABLED && this.rendered) {
      this.lng.shader = convertEffectsToShader(this, v);
    }
  }
  set id(id) {
    var _a2;
    this._id = id;
    if ((_a2 = Config.rendererOptions) == null ? void 0 : _a2.inspector) {
      this.data = { ...this.data, testId: id };
    }
  }
  get id() {
    return this._id;
  }
  get parent() {
    return this._parent;
  }
  set parent(p) {
    var _a2;
    this._parent = p;
    if (this.rendered && (p == null ? void 0 : p.rendered)) {
      this.lng.parent = (_a2 = p.lng) != null ? _a2 : null;
    }
  }
  insertChild(node, beforeNode) {
    node.parent = this;
    if (beforeNode) {
      this.removeChild(node);
      const index = this.children.indexOf(beforeNode);
      if (index >= 0) {
        this.children.splice(index, 0, node);
        return;
      }
    }
    this.children.push(node);
  }
  removeChild(node) {
    var _a2;
    const nodeIndexToRemove = this.children.indexOf(node);
    if (nodeIndexToRemove >= 0) {
      this.children.splice(nodeIndexToRemove, 1);
      (_a2 = node.onRemove) == null ? void 0 : _a2.call(node, node);
    }
  }
  get selectedNode() {
    const selectedIndex = this.selected || 0;
    for (let i = selectedIndex; i < this.children.length; i++) {
      const element = this.children[i];
      if (isElementNode(element)) {
        this.selected = i;
        return element;
      }
    }
    return void 0;
  }
  set shader(shaderProps) {
    this.lng.shader = isArray(shaderProps) ? renderer$1.createShader(...shaderProps) : shaderProps;
  }
  _sendToLightningAnimatable(name, value) {
    if (this.transition && this.rendered && Config.animationsEnabled && (this.transition === true || this.transition[name])) {
      const animationSettings = this.transition === true || this.transition[name] === true ? void 0 : this.transition[name];
      if (Config.simpleAnimationsEnabled) {
        simpleAnimation.add(this, name, value, animationSettings || this.animationSettings);
        simpleAnimation.register(renderer$1.stage);
        return;
      } else {
        const animationController = this.animate({ [name]: value }, animationSettings);
        if (this.onAnimation) {
          const animationEvents = Object.keys(this.onAnimation);
          for (const event of animationEvents) {
            const handler = this.onAnimation[event];
            animationController.on(event, (controller, props) => {
              handler.call(this, controller, name, value, props);
            });
          }
        }
        return animationController.start();
      }
    }
    this.lng[name] = value;
  }
  animate(props, animationSettings) {
    return this.lng.animate(props, animationSettings || this.animationSettings || {});
  }
  chain(props, animationSettings) {
    if (this._animationRunning) {
      this._animationQueue = [];
      this._animationRunning = false;
    }
    if (animationSettings) {
      this._animationQueueSettings = animationSettings;
    } else if (!this._animationQueueSettings) {
      this._animationQueueSettings = animationSettings || this.animationSettings;
    }
    animationSettings = animationSettings || this._animationQueueSettings;
    this._animationQueue = this._animationQueue || [];
    this._animationQueue.push({ props, animationSettings });
    return this;
  }
  async start() {
    let animation = this._animationQueue.shift();
    while (animation) {
      this._animationRunning = true;
      await this.animate(animation.props, animation.animationSettings).start().waitUntilStopped();
      animation = this._animationQueue.shift();
    }
    this._animationRunning = false;
    this._animationQueueSettings = void 0;
  }
  emit(event, ...args) {
    let current = this;
    const capitalizedEvent = "on".concat(event.charAt(0).toUpperCase()).concat(event.slice(1));
    while (current) {
      const handler = current[capitalizedEvent];
      if (isFunction(handler)) {
        if (handler.call(current, this, ...args) === true) {
          return true;
        }
      }
      current = current.parent;
    }
    return false;
  }
  setFocus() {
    if (this.rendered) {
      if (this.forwardFocus !== void 0) {
        if (isFunc(this.forwardFocus)) {
          if (this.forwardFocus.call(this, this) !== false) {
            return;
          }
        } else {
          const focusedIndex = typeof this.forwardFocus === "number" ? this.forwardFocus : null;
          const nodes = this.children;
          if (focusedIndex !== null && focusedIndex < nodes.length) {
            const child = nodes[focusedIndex];
            isElementNode(child) && child.setFocus();
            return;
          }
        }
      }
      queueMicrotask(() => setActiveElement$1(this));
    } else {
      this._autofocus = true;
    }
  }
  _layoutOnLoad() {
    this.lng.on("loaded", () => {
      this.parent.updateLayout();
    });
  }
  getText() {
    let result = "";
    for (let i = 0; i < this.children.length; i++) {
      result += this.children[i].text;
    }
    return result;
  }
  destroy() {
    if (this.onDestroy) {
      const destroyPromise = this.onDestroy(this);
      if (destroyPromise instanceof Promise) {
        destroyPromise.then(() => this._destroy());
      } else {
        this._destroy();
      }
    } else {
      this._destroy();
    }
  }
  _destroy() {
    var _a2;
    if (isINode(this.lng)) {
      this.lng.destroy();
      if ((_a2 = this.parent) == null ? void 0 : _a2.requiresLayout()) {
        this.parent.updateLayout();
      }
    }
  }
  set style(style) {
    if (Config.lockStyles && this._style) {
      return;
    }
    if (!style) {
      return;
    }
    this._style = style;
    for (const key in this._style) {
      if (this[key] === void 0) {
        this[key] = this._style[key];
      }
    }
  }
  get style() {
    return this._style;
  }
  get hasChildren() {
    return this.children.length > 0;
  }
  set src(src) {
    if (typeof src === "string") {
      this.lng.src = src;
      if (!this.color && this.rendered) {
        this.color = 4294967295;
      }
    } else {
      this.color = 0;
    }
  }
  get src() {
    return this.lng.src;
  }
  getChildById(id) {
    return this.children.find((c) => c.id === id);
  }
  searchChildrenById(id) {
    for (let i = 0; i < this.children.length; i++) {
      const child = this.children[i];
      if (isElementNode(child)) {
        if (child.id === id) {
          return child;
        }
        const found = child.searchChildrenById(id);
        if (found) {
          return found;
        }
      }
    }
  }
  set states(states) {
    this._states = this._states ? this._states.merge(states) : new States(this._stateChanged.bind(this), states);
    if (this.rendered) {
      this._stateChanged();
    }
  }
  get states() {
    this._states = this._states || new States(this._stateChanged.bind(this));
    return this._states;
  }
  get animationSettings() {
    return this._animationSettings || Config.animationSettings;
  }
  set animationSettings(animationSettings) {
    this._animationSettings = animationSettings;
  }
  set hidden(val) {
    this.alpha = val ? 0 : 1;
  }
  get hidden() {
    return this.alpha === 0;
  }
  /**
   * Sets the autofocus state of the element.
   * When set to a truthy value, the element will automatically gain focus.
   * You can also set it to a signal to recalculate
   *
   * @param val - A value to determine if the element should autofocus.
   *              A truthy value enables autofocus, otherwise disables it.
   */
  set autofocus(val) {
    this._autofocus = val;
    val && queueMicrotask(() => this.setFocus());
  }
  get autofocus() {
    return this._autofocus;
  }
  requiresLayout() {
    return this.display === "flex" || this.onLayout;
  }
  set updateLayoutOn(v) {
    this.updateLayout();
  }
  get updateLayoutOn() {
    return null;
  }
  updateLayout() {
    if (this.hasChildren) {
      const flexChanged = this.display === "flex" && calculateFlex(this);
      layoutQueue.delete(this);
      const onLayoutChanged = isFunc(this.onLayout) && this.onLayout.call(this, this);
      if ((flexChanged || onLayoutChanged) && this.parent) {
        layoutQueue.add(this.parent);
        if (!layoutRunQueued) {
          layoutRunQueued = true;
          queueMicrotask(runLayout);
        }
      }
    }
  }
  _stateChanged() {
    if (this.forwardStates) {
      const states2 = this.states.slice();
      this.children.forEach((c) => {
        c.states = states2;
      });
    }
    const states = this.states;
    if (this._undoStyles || keyExists(this, states)) {
      let stylesToUndo;
      if (this._undoStyles && this._undoStyles.length) {
        stylesToUndo = {};
        this._undoStyles.forEach((styleKey) => {
          stylesToUndo[styleKey] = this.style[styleKey];
        });
      }
      const numStates = states.length;
      if (numStates === 0) {
        Object.assign(this, stylesToUndo);
        this._undoStyles = [];
        return;
      }
      let newStyles;
      if (numStates === 1) {
        newStyles = this[states[0]];
        newStyles = stylesToUndo ? { ...stylesToUndo, ...newStyles } : newStyles;
      } else {
        newStyles = states.reduce((acc, state) => {
          const styles2 = this[state];
          return styles2 ? { ...acc, ...styles2 } : acc;
        }, stylesToUndo || {});
      }
      if (newStyles) {
        this._undoStyles = Object.keys(newStyles);
        if (newStyles.transition !== void 0) {
          this.transition = newStyles.transition;
        }
        Object.assign(this, newStyles);
      } else {
        this._undoStyles = [];
      }
    }
  }
  render(topNode) {
    var _a2, _b, _c, _d;
    const node = this;
    const parent = this.parent;
    if (!parent) {
      console.warn("Parent not set - no node created for: ", this);
      return;
    }
    if (!parent.rendered) {
      console.warn("Parent not rendered yet: ", this);
      return;
    }
    if (parent.requiresLayout()) {
      layoutQueue.add(parent);
    }
    if (this.rendered) {
      (_a2 = this.onRender) == null ? void 0 : _a2.call(this, this);
      return;
    }
    if (this._states) {
      this._stateChanged();
    }
    const props = node.lng;
    const parentWidth = parent.width || 0;
    const parentHeight = parent.height || 0;
    props.x = props.x || 0;
    props.y = props.y || 0;
    props.parent = parent.lng;
    if (this.right || this.right === 0) {
      props.x = parentWidth - this.right;
      props.mountX = 1;
    }
    if (this.bottom || this.bottom === 0) {
      props.y = parentHeight - this.bottom;
      props.mountY = 1;
    }
    if (this.center) {
      this.centerX = this.centerY = true;
    }
    if (this.centerX) {
      props.x += parentWidth / 2;
      props.mountX = 0.5;
    }
    if (this.centerY) {
      props.y += parentHeight / 2;
      props.mountY = 0.5;
    }
    if (isElementText(node)) {
      const textProps = props;
      if (Config.fontSettings) {
        for (const key in Config.fontSettings) {
          if (textProps[key] === void 0) {
            textProps[key] = Config.fontSettings[key];
          }
        }
      }
      textProps.text = textProps.text || node.getText();
      if (textProps.textAlign && !textProps.contain) {
        console.warn("Text align requires contain: ", node.getText());
      }
      if (textProps.contain) {
        if (!textProps.width) {
          textProps.width = parentWidth - textProps.x - (textProps.marginRight || 0);
        }
        if (textProps.contain === "both" && !textProps.height && !textProps.maxLines) {
          textProps.height = parentHeight - textProps.y - (textProps.marginBottom || 0);
        } else if (textProps.maxLines === 1) {
          textProps.height = textProps.height || textProps.lineHeight || textProps.fontSize;
        }
      }
      if (SHADERS_ENABLED && node._effects) {
        props.shader = convertEffectsToShader(node, node._effects);
      }
      node.lng = renderer$1.createTextNode(props);
      if (parent.requiresLayout()) {
        if (!props.width || !props.height) {
          node._layoutOnLoad();
        }
      }
    } else {
      if (!props.texture) {
        if (isNaN(props.width)) {
          props.width = node.flexGrow ? 0 : parentWidth - props.x;
          node._calcWidth = true;
        }
        if (isNaN(props.height)) {
          props.height = parentHeight - props.y;
          node._calcHeight = true;
        }
        if (props.rtt && !props.color) {
          props.color = 4294967295;
        }
        if (!props.color && !props.src) {
          props.color = 0;
        }
      }
      if (SHADERS_ENABLED && node._effects) {
        props.shader = convertEffectsToShader(node, node._effects);
      }
      node.lng = renderer$1.createNode(props);
    }
    node.rendered = true;
    if (node.autosize && parent.requiresLayout()) {
      node._layoutOnLoad();
    }
    (_b = this.onCreate) == null ? void 0 : _b.call(this, this);
    (_c = this.onRender) == null ? void 0 : _c.call(this, this);
    if (node.onEvent) {
      for (const [name, handler] of Object.entries(node.onEvent)) {
        node.lng.on(name, (_inode, data) => handler.call(node, node, data));
      }
    }
    if ((_d = node.lng) == null ? void 0 : _d.div) {
      node.lng.div.element = node;
    }
    if (node._type === NodeType.Element) {
      const numChildren = node.children.length;
      for (let i = 0; i < numChildren; i++) {
        const c = node.children[i];
        if (isElementNode(c)) {
          c.render();
        }
      }
    }
    if (topNode && !layoutRunQueued) {
      layoutRunQueued = true;
      queueMicrotask(runLayout);
    }
    node._autofocus && node.setFocus();
  }
}
for (const key of LightningRendererNumberProps) {
  Object.defineProperty(ElementNode.prototype, key, {
    get() {
      return this.lng[key];
    },
    set(v) {
      this._sendToLightningAnimatable(key, v);
    }
  });
}
for (const key of LightningRendererNonAnimatingProps) {
  Object.defineProperty(ElementNode.prototype, key, {
    get() {
      return this.lng[key];
    },
    set(v) {
      this.lng[key] = v;
    }
  });
}
function createEffectAccessor(key) {
  return {
    set(value) {
      this.effects = this.effects ? {
        ...this.effects,
        [key]: value
      } : { [key]: value };
    },
    get() {
      var _a2;
      return (_a2 = this.effects) == null ? void 0 : _a2[key];
    }
  };
}
Object.defineProperties(ElementNode.prototype, {
  border: borderAccessor(),
  borderLeft: borderAccessor("Left"),
  borderRight: borderAccessor("Right"),
  borderTop: borderAccessor("Top"),
  borderBottom: borderAccessor("Bottom"),
  linearGradient: createEffectAccessor("linearGradient"),
  radialGradient: createEffectAccessor("radialGradient"),
  radialProgress: createEffectAccessor("radialProgressGradient"),
  borderRadius: {
    set(radius) {
      this.effects = this.effects ? {
        ...this.effects,
        radius: { radius }
      } : { radius: { radius } };
    },
    get() {
      var _a2, _b;
      return (_b = (_a2 = this.effects) == null ? void 0 : _a2.radius) == null ? void 0 : _b.radius;
    }
  }
});
const sharedConfig = {
  context: void 0,
  registry: void 0,
  effects: void 0,
  done: false,
  getContextId() {
    return getContextId(this.context.count);
  },
  getNextContextId() {
    return getContextId(this.context.count++);
  }
};
function getContextId(count2) {
  const num = String(count2), len = num.length - 1;
  return sharedConfig.context.id + (len ? String.fromCharCode(96 + len) : "") + num;
}
function setHydrateContext(context) {
  sharedConfig.context = context;
}
const IS_DEV = false;
const equalFn = (a, b) => a === b;
const $PROXY = Symbol("solid-proxy");
const SUPPORTS_PROXY$1 = typeof Proxy === "function";
const $TRACK = Symbol("solid-track");
const signalOptions = {
  equals: equalFn
};
let runEffects = runQueue;
const STALE = 1;
const PENDING = 2;
const UNOWNED = {
  owned: null,
  cleanups: null,
  context: null,
  owner: null
};
const NO_INIT = {};
var Owner = null;
let Transition = null;
let ExternalSourceConfig = null;
let Listener = null;
let Updates = null;
let Effects = null;
let ExecCount = 0;
function createRoot(fn, detachedOwner) {
  const listener = Listener, owner = Owner, unowned = fn.length === 0, current = detachedOwner === void 0 ? owner : detachedOwner, root = unowned ? UNOWNED : {
    owned: null,
    cleanups: null,
    context: current ? current.context : null,
    owner: current
  }, updateFn = unowned ? fn : () => fn(() => untrack(() => cleanNode(root)));
  Owner = root;
  Listener = null;
  try {
    return runUpdates(updateFn, true);
  } finally {
    Listener = listener;
    Owner = owner;
  }
}
function createSignal(value, options) {
  options = options ? Object.assign({}, signalOptions, options) : signalOptions;
  const s = {
    value,
    observers: null,
    observerSlots: null,
    comparator: options.equals || void 0
  };
  const setter = (value2) => {
    if (typeof value2 === "function") {
      if (Transition && Transition.running && Transition.sources.has(s)) value2 = value2(s.tValue);
      else value2 = value2(s.value);
    }
    return writeSignal(s, value2);
  };
  return [readSignal.bind(s), setter];
}
function createComputed(fn, value, options) {
  const c = createComputation(fn, value, true, STALE);
  updateComputation(c);
}
function createRenderEffect(fn, value, options) {
  const c = createComputation(fn, value, false, STALE);
  updateComputation(c);
}
function createEffect(fn, value, options) {
  runEffects = runUserEffects;
  const c = createComputation(fn, value, false, STALE), s = SuspenseContext && useContext(SuspenseContext);
  if (s) c.suspense = s;
  c.user = true;
  Effects ? Effects.push(c) : updateComputation(c);
}
function createMemo(fn, value, options) {
  options = options ? Object.assign({}, signalOptions, options) : signalOptions;
  const c = createComputation(fn, value, true, 0);
  c.observers = null;
  c.observerSlots = null;
  c.comparator = options.equals || void 0;
  updateComputation(c);
  return readSignal.bind(c);
}
function isPromise(v) {
  return v && typeof v === "object" && "then" in v;
}
function createResource(pSource, pFetcher, pOptions) {
  let source;
  let fetcher;
  let options;
  if (typeof pFetcher === "function") {
    source = pSource;
    fetcher = pFetcher;
    options = {};
  } else {
    source = true;
    fetcher = pSource;
    options = pFetcher || {};
  }
  let pr = null, initP = NO_INIT, id = null, loadedUnderTransition = false, scheduled = false, resolved = "initialValue" in options, dynamic = typeof source === "function" && createMemo(source);
  const contexts = /* @__PURE__ */ new Set(), [value, setValue] = (options.storage || createSignal)(options.initialValue), [error, setError] = createSignal(void 0), [track, trigger] = createSignal(void 0, {
    equals: false
  }), [state, setState] = createSignal(resolved ? "ready" : "unresolved");
  if (sharedConfig.context) {
    id = sharedConfig.getNextContextId();
    if (options.ssrLoadFrom === "initial") initP = options.initialValue;
    else if (sharedConfig.load && sharedConfig.has(id)) initP = sharedConfig.load(id);
  }
  function loadEnd(p, v, error2, key) {
    if (pr === p) {
      pr = null;
      key !== void 0 && (resolved = true);
      if ((p === initP || v === initP) && options.onHydrated)
        queueMicrotask(
          () => options.onHydrated(key, {
            value: v
          })
        );
      initP = NO_INIT;
      if (Transition && p && loadedUnderTransition) {
        Transition.promises.delete(p);
        loadedUnderTransition = false;
        runUpdates(() => {
          Transition.running = true;
          completeLoad(v, error2);
        }, false);
      } else completeLoad(v, error2);
    }
    return v;
  }
  function completeLoad(v, err) {
    runUpdates(() => {
      if (err === void 0) setValue(() => v);
      setState(err !== void 0 ? "errored" : resolved ? "ready" : "unresolved");
      setError(err);
      for (const c of contexts.keys()) c.decrement();
      contexts.clear();
    }, false);
  }
  function read() {
    const c = SuspenseContext && useContext(SuspenseContext), v = value(), err = error();
    if (err !== void 0 && !pr) throw err;
    if (Listener && !Listener.user && c) {
      createComputed(() => {
        track();
        if (pr) {
          if (c.resolved && Transition && loadedUnderTransition) Transition.promises.add(pr);
          else if (!contexts.has(c)) {
            c.increment();
            contexts.add(c);
          }
        }
      });
    }
    return v;
  }
  function load2(refetching = true) {
    if (refetching !== false && scheduled) return;
    scheduled = false;
    const lookup = dynamic ? dynamic() : source;
    loadedUnderTransition = Transition && Transition.running;
    if (lookup == null || lookup === false) {
      loadEnd(pr, untrack(value));
      return;
    }
    if (Transition && pr) Transition.promises.delete(pr);
    const p = initP !== NO_INIT ? initP : untrack(
      () => fetcher(lookup, {
        value: value(),
        refetching
      })
    );
    if (!isPromise(p)) {
      loadEnd(pr, p, void 0, lookup);
      return p;
    }
    pr = p;
    if ("value" in p) {
      if (p.status === "success") loadEnd(pr, p.value, void 0, lookup);
      else loadEnd(pr, void 0, castError(p.value), lookup);
      return p;
    }
    scheduled = true;
    queueMicrotask(() => scheduled = false);
    runUpdates(() => {
      setState(resolved ? "refreshing" : "pending");
      trigger();
    }, false);
    return p.then(
      (v) => loadEnd(p, v, void 0, lookup),
      (e) => loadEnd(p, void 0, castError(e), lookup)
    );
  }
  Object.defineProperties(read, {
    state: {
      get: () => state()
    },
    error: {
      get: () => error()
    },
    loading: {
      get() {
        const s = state();
        return s === "pending" || s === "refreshing";
      }
    },
    latest: {
      get() {
        if (!resolved) return read();
        const err = error();
        if (err && !pr) throw err;
        return value();
      }
    }
  });
  if (dynamic) createComputed(() => load2(false));
  else load2(false);
  return [
    read,
    {
      refetch: load2,
      mutate: setValue
    }
  ];
}
function createSelector(source, fn = equalFn, options) {
  const subs = /* @__PURE__ */ new Map();
  const node = createComputation(
    (p) => {
      const v = source();
      for (const [key, val] of subs.entries())
        if (fn(key, v) !== fn(key, p)) {
          for (const c of val.values()) {
            c.state = STALE;
            if (c.pure) Updates.push(c);
            else Effects.push(c);
          }
        }
      return v;
    },
    void 0,
    true,
    STALE
  );
  updateComputation(node);
  return (key) => {
    const listener = Listener;
    if (listener) {
      let l;
      if (l = subs.get(key)) l.add(listener);
      else subs.set(key, l = /* @__PURE__ */ new Set([listener]));
      onCleanup(() => {
        l.delete(listener);
        !l.size && subs.delete(key);
      });
    }
    return fn(
      key,
      Transition && Transition.running && Transition.sources.has(node) ? node.tValue : node.value
    );
  };
}
function batch(fn) {
  return runUpdates(fn, false);
}
function untrack(fn) {
  if (Listener === null) return fn();
  const listener = Listener;
  Listener = null;
  try {
    if (ExternalSourceConfig) ;
    return fn();
  } finally {
    Listener = listener;
  }
}
function on(deps, fn, options) {
  const isArray2 = Array.isArray(deps);
  let prevInput;
  let defer = options && options.defer;
  return (prevValue) => {
    let input;
    if (isArray2) {
      input = Array(deps.length);
      for (let i = 0; i < deps.length; i++) input[i] = deps[i]();
    } else input = deps();
    if (defer) {
      defer = false;
      return prevValue;
    }
    const result = untrack(() => fn(input, prevInput, prevValue));
    prevInput = input;
    return result;
  };
}
function onMount(fn) {
  createEffect(() => untrack(fn));
}
function onCleanup(fn) {
  if (Owner === null) ;
  else if (Owner.cleanups === null) Owner.cleanups = [fn];
  else Owner.cleanups.push(fn);
  return fn;
}
function getOwner() {
  return Owner;
}
function runWithOwner(o, fn) {
  const prev = Owner;
  const prevListener = Listener;
  Owner = o;
  Listener = null;
  try {
    return runUpdates(fn, true);
  } catch (err) {
    handleError(err);
  } finally {
    Owner = prev;
    Listener = prevListener;
  }
}
function startTransition(fn) {
  if (Transition && Transition.running) {
    fn();
    return Transition.done;
  }
  const l = Listener;
  const o = Owner;
  return Promise.resolve().then(() => {
    Listener = l;
    Owner = o;
    let t;
    if (SuspenseContext) {
      t = Transition || (Transition = {
        sources: /* @__PURE__ */ new Set(),
        effects: [],
        promises: /* @__PURE__ */ new Set(),
        disposed: /* @__PURE__ */ new Set(),
        queue: /* @__PURE__ */ new Set(),
        running: true
      });
      t.done || (t.done = new Promise((res) => t.resolve = res));
      t.running = true;
    }
    runUpdates(fn, false);
    Listener = Owner = null;
    return t ? t.done : void 0;
  });
}
const [transPending, setTransPending] = /* @__PURE__ */ createSignal(false);
function resumeEffects(e) {
  Effects.push.apply(Effects, e);
  e.length = 0;
}
function createContext(defaultValue, options) {
  const id = Symbol("context");
  return {
    id,
    Provider: createProvider(id),
    defaultValue
  };
}
function useContext(context) {
  let value;
  return Owner && Owner.context && (value = Owner.context[context.id]) !== void 0 ? value : context.defaultValue;
}
function children(fn) {
  const children2 = createMemo(fn);
  const memo2 = createMemo(() => resolveChildren(children2()));
  memo2.toArray = () => {
    const c = memo2();
    return Array.isArray(c) ? c : c != null ? [c] : [];
  };
  return memo2;
}
let SuspenseContext;
function getSuspenseContext() {
  return SuspenseContext || (SuspenseContext = createContext());
}
function readSignal() {
  const runningTransition = Transition && Transition.running;
  if (this.sources && (runningTransition ? this.tState : this.state)) {
    if ((runningTransition ? this.tState : this.state) === STALE) updateComputation(this);
    else {
      const updates = Updates;
      Updates = null;
      runUpdates(() => lookUpstream(this), false);
      Updates = updates;
    }
  }
  if (Listener) {
    const sSlot = this.observers ? this.observers.length : 0;
    if (!Listener.sources) {
      Listener.sources = [this];
      Listener.sourceSlots = [sSlot];
    } else {
      Listener.sources.push(this);
      Listener.sourceSlots.push(sSlot);
    }
    if (!this.observers) {
      this.observers = [Listener];
      this.observerSlots = [Listener.sources.length - 1];
    } else {
      this.observers.push(Listener);
      this.observerSlots.push(Listener.sources.length - 1);
    }
  }
  if (runningTransition && Transition.sources.has(this)) return this.tValue;
  return this.value;
}
function writeSignal(node, value, isComp) {
  let current = Transition && Transition.running && Transition.sources.has(node) ? node.tValue : node.value;
  if (!node.comparator || !node.comparator(current, value)) {
    if (Transition) {
      const TransitionRunning = Transition.running;
      if (TransitionRunning || !isComp && Transition.sources.has(node)) {
        Transition.sources.add(node);
        node.tValue = value;
      }
      if (!TransitionRunning) node.value = value;
    } else node.value = value;
    if (node.observers && node.observers.length) {
      runUpdates(() => {
        for (let i = 0; i < node.observers.length; i += 1) {
          const o = node.observers[i];
          const TransitionRunning = Transition && Transition.running;
          if (TransitionRunning && Transition.disposed.has(o)) continue;
          if (TransitionRunning ? !o.tState : !o.state) {
            if (o.pure) Updates.push(o);
            else Effects.push(o);
            if (o.observers) markDownstream(o);
          }
          if (!TransitionRunning) o.state = STALE;
          else o.tState = STALE;
        }
        if (Updates.length > 1e6) {
          Updates = [];
          if (IS_DEV) ;
          throw new Error();
        }
      }, false);
    }
  }
  return value;
}
function updateComputation(node) {
  if (!node.fn) return;
  cleanNode(node);
  const time = ExecCount;
  runComputation(
    node,
    Transition && Transition.running && Transition.sources.has(node) ? node.tValue : node.value,
    time
  );
  if (Transition && !Transition.running && Transition.sources.has(node)) {
    queueMicrotask(() => {
      runUpdates(() => {
        Transition && (Transition.running = true);
        Listener = Owner = node;
        runComputation(node, node.tValue, time);
        Listener = Owner = null;
      }, false);
    });
  }
}
function runComputation(node, value, time) {
  let nextValue;
  const owner = Owner, listener = Listener;
  Listener = Owner = node;
  try {
    nextValue = node.fn(value);
  } catch (err) {
    if (node.pure) {
      if (Transition && Transition.running) {
        node.tState = STALE;
        node.tOwned && node.tOwned.forEach(cleanNode);
        node.tOwned = void 0;
      } else {
        node.state = STALE;
        node.owned && node.owned.forEach(cleanNode);
        node.owned = null;
      }
    }
    node.updatedAt = time + 1;
    return handleError(err);
  } finally {
    Listener = listener;
    Owner = owner;
  }
  if (!node.updatedAt || node.updatedAt <= time) {
    if (node.updatedAt != null && "observers" in node) {
      writeSignal(node, nextValue, true);
    } else if (Transition && Transition.running && node.pure) {
      Transition.sources.add(node);
      node.tValue = nextValue;
    } else node.value = nextValue;
    node.updatedAt = time;
  }
}
function createComputation(fn, init2, pure, state = STALE, options) {
  const c = {
    fn,
    state,
    updatedAt: null,
    owned: null,
    sources: null,
    sourceSlots: null,
    cleanups: null,
    value: init2,
    owner: Owner,
    context: Owner ? Owner.context : null,
    pure
  };
  if (Transition && Transition.running) {
    c.state = 0;
    c.tState = state;
  }
  if (Owner === null) ;
  else if (Owner !== UNOWNED) {
    if (Transition && Transition.running && Owner.pure) {
      if (!Owner.tOwned) Owner.tOwned = [c];
      else Owner.tOwned.push(c);
    } else {
      if (!Owner.owned) Owner.owned = [c];
      else Owner.owned.push(c);
    }
  }
  return c;
}
function runTop(node) {
  const runningTransition = Transition && Transition.running;
  if ((runningTransition ? node.tState : node.state) === 0) return;
  if ((runningTransition ? node.tState : node.state) === PENDING) return lookUpstream(node);
  if (node.suspense && untrack(node.suspense.inFallback)) return node.suspense.effects.push(node);
  const ancestors = [node];
  while ((node = node.owner) && (!node.updatedAt || node.updatedAt < ExecCount)) {
    if (runningTransition && Transition.disposed.has(node)) return;
    if (runningTransition ? node.tState : node.state) ancestors.push(node);
  }
  for (let i = ancestors.length - 1; i >= 0; i--) {
    node = ancestors[i];
    if (runningTransition) {
      let top = node, prev = ancestors[i + 1];
      while ((top = top.owner) && top !== prev) {
        if (Transition.disposed.has(top)) return;
      }
    }
    if ((runningTransition ? node.tState : node.state) === STALE) {
      updateComputation(node);
    } else if ((runningTransition ? node.tState : node.state) === PENDING) {
      const updates = Updates;
      Updates = null;
      runUpdates(() => lookUpstream(node, ancestors[0]), false);
      Updates = updates;
    }
  }
}
function runUpdates(fn, init2) {
  if (Updates) return fn();
  let wait = false;
  if (!init2) Updates = [];
  if (Effects) wait = true;
  else Effects = [];
  ExecCount++;
  try {
    const res = fn();
    completeUpdates(wait);
    return res;
  } catch (err) {
    if (!wait) Effects = null;
    Updates = null;
    handleError(err);
  }
}
function completeUpdates(wait) {
  if (Updates) {
    runQueue(Updates);
    Updates = null;
  }
  if (wait) return;
  let res;
  if (Transition) {
    if (!Transition.promises.size && !Transition.queue.size) {
      const sources = Transition.sources;
      const disposed = Transition.disposed;
      Effects.push.apply(Effects, Transition.effects);
      res = Transition.resolve;
      for (const e2 of Effects) {
        "tState" in e2 && (e2.state = e2.tState);
        delete e2.tState;
      }
      Transition = null;
      runUpdates(() => {
        for (const d of disposed) cleanNode(d);
        for (const v of sources) {
          v.value = v.tValue;
          if (v.owned) {
            for (let i = 0, len = v.owned.length; i < len; i++) cleanNode(v.owned[i]);
          }
          if (v.tOwned) v.owned = v.tOwned;
          delete v.tValue;
          delete v.tOwned;
          v.tState = 0;
        }
        setTransPending(false);
      }, false);
    } else if (Transition.running) {
      Transition.running = false;
      Transition.effects.push.apply(Transition.effects, Effects);
      Effects = null;
      setTransPending(true);
      return;
    }
  }
  const e = Effects;
  Effects = null;
  if (e.length) runUpdates(() => runEffects(e), false);
  if (res) res();
}
function runQueue(queue) {
  for (let i = 0; i < queue.length; i++) runTop(queue[i]);
}
function runUserEffects(queue) {
  let i, userLength = 0;
  for (i = 0; i < queue.length; i++) {
    const e = queue[i];
    if (!e.user) runTop(e);
    else queue[userLength++] = e;
  }
  if (sharedConfig.context) {
    if (sharedConfig.count) {
      sharedConfig.effects || (sharedConfig.effects = []);
      sharedConfig.effects.push(...queue.slice(0, userLength));
      return;
    }
    setHydrateContext();
  }
  if (sharedConfig.effects && (sharedConfig.done || !sharedConfig.count)) {
    queue = [...sharedConfig.effects, ...queue];
    userLength += sharedConfig.effects.length;
    delete sharedConfig.effects;
  }
  for (i = 0; i < userLength; i++) runTop(queue[i]);
}
function lookUpstream(node, ignore) {
  const runningTransition = Transition && Transition.running;
  if (runningTransition) node.tState = 0;
  else node.state = 0;
  for (let i = 0; i < node.sources.length; i += 1) {
    const source = node.sources[i];
    if (source.sources) {
      const state = runningTransition ? source.tState : source.state;
      if (state === STALE) {
        if (source !== ignore && (!source.updatedAt || source.updatedAt < ExecCount))
          runTop(source);
      } else if (state === PENDING) lookUpstream(source, ignore);
    }
  }
}
function markDownstream(node) {
  const runningTransition = Transition && Transition.running;
  for (let i = 0; i < node.observers.length; i += 1) {
    const o = node.observers[i];
    if (runningTransition ? !o.tState : !o.state) {
      if (runningTransition) o.tState = PENDING;
      else o.state = PENDING;
      if (o.pure) Updates.push(o);
      else Effects.push(o);
      o.observers && markDownstream(o);
    }
  }
}
function cleanNode(node) {
  let i;
  if (node.sources) {
    while (node.sources.length) {
      const source = node.sources.pop(), index = node.sourceSlots.pop(), obs = source.observers;
      if (obs && obs.length) {
        const n = obs.pop(), s = source.observerSlots.pop();
        if (index < obs.length) {
          n.sourceSlots[s] = index;
          obs[index] = n;
          source.observerSlots[index] = s;
        }
      }
    }
  }
  if (node.tOwned) {
    for (i = node.tOwned.length - 1; i >= 0; i--) cleanNode(node.tOwned[i]);
    delete node.tOwned;
  }
  if (Transition && Transition.running && node.pure) {
    reset(node, true);
  } else if (node.owned) {
    for (i = node.owned.length - 1; i >= 0; i--) cleanNode(node.owned[i]);
    node.owned = null;
  }
  if (node.cleanups) {
    for (i = node.cleanups.length - 1; i >= 0; i--) node.cleanups[i]();
    node.cleanups = null;
  }
  if (Transition && Transition.running) node.tState = 0;
  else node.state = 0;
}
function reset(node, top) {
  if (!top) {
    node.tState = 0;
    Transition.disposed.add(node);
  }
  if (node.owned) {
    for (let i = 0; i < node.owned.length; i++) reset(node.owned[i]);
  }
}
function castError(err) {
  if (err instanceof Error) return err;
  return new Error(typeof err === "string" ? err : "Unknown error", {
    cause: err
  });
}
function handleError(err, owner = Owner) {
  const error = castError(err);
  throw error;
}
function resolveChildren(children2) {
  if (typeof children2 === "function" && !children2.length) return resolveChildren(children2());
  if (Array.isArray(children2)) {
    const results = [];
    for (let i = 0; i < children2.length; i++) {
      const result = resolveChildren(children2[i]);
      Array.isArray(result) ? results.push.apply(results, result) : results.push(result);
    }
    return results;
  }
  return children2;
}
function createProvider(id, options) {
  return function provider(props) {
    let res;
    createRenderEffect(
      () => res = untrack(() => {
        Owner.context = {
          ...Owner.context,
          [id]: props.value
        };
        return children(() => props.children);
      }),
      void 0
    );
    return res;
  };
}
const FALLBACK = Symbol("fallback");
function dispose(d) {
  for (let i = 0; i < d.length; i++) d[i]();
}
function mapArray(list, mapFn, options = {}) {
  let items = [], mapped = [], disposers = [], len = 0, indexes = mapFn.length > 1 ? [] : null;
  onCleanup(() => dispose(disposers));
  return () => {
    let newItems = list() || [], newLen = newItems.length, i, j;
    newItems[$TRACK];
    return untrack(() => {
      let newIndices, newIndicesNext, temp, tempdisposers, tempIndexes, start, end, newEnd, item;
      if (newLen === 0) {
        if (len !== 0) {
          dispose(disposers);
          disposers = [];
          items = [];
          mapped = [];
          len = 0;
          indexes && (indexes = []);
        }
        if (options.fallback) {
          items = [FALLBACK];
          mapped[0] = createRoot((disposer) => {
            disposers[0] = disposer;
            return options.fallback();
          });
          len = 1;
        }
      } else if (len === 0) {
        mapped = new Array(newLen);
        for (j = 0; j < newLen; j++) {
          items[j] = newItems[j];
          mapped[j] = createRoot(mapper);
        }
        len = newLen;
      } else {
        temp = new Array(newLen);
        tempdisposers = new Array(newLen);
        indexes && (tempIndexes = new Array(newLen));
        for (start = 0, end = Math.min(len, newLen); start < end && items[start] === newItems[start]; start++) ;
        for (end = len - 1, newEnd = newLen - 1; end >= start && newEnd >= start && items[end] === newItems[newEnd]; end--, newEnd--) {
          temp[newEnd] = mapped[end];
          tempdisposers[newEnd] = disposers[end];
          indexes && (tempIndexes[newEnd] = indexes[end]);
        }
        newIndices = /* @__PURE__ */ new Map();
        newIndicesNext = new Array(newEnd + 1);
        for (j = newEnd; j >= start; j--) {
          item = newItems[j];
          i = newIndices.get(item);
          newIndicesNext[j] = i === void 0 ? -1 : i;
          newIndices.set(item, j);
        }
        for (i = start; i <= end; i++) {
          item = items[i];
          j = newIndices.get(item);
          if (j !== void 0 && j !== -1) {
            temp[j] = mapped[i];
            tempdisposers[j] = disposers[i];
            indexes && (tempIndexes[j] = indexes[i]);
            j = newIndicesNext[j];
            newIndices.set(item, j);
          } else disposers[i]();
        }
        for (j = start; j < newLen; j++) {
          if (j in temp) {
            mapped[j] = temp[j];
            disposers[j] = tempdisposers[j];
            if (indexes) {
              indexes[j] = tempIndexes[j];
              indexes[j](j);
            }
          } else mapped[j] = createRoot(mapper);
        }
        mapped = mapped.slice(0, len = newLen);
        items = newItems.slice(0);
      }
      return mapped;
    });
    function mapper(disposer) {
      disposers[j] = disposer;
      if (indexes) {
        const [s, set] = createSignal(j);
        indexes[j] = set;
        return mapFn(newItems[j], s);
      }
      return mapFn(newItems[j]);
    }
  };
}
function indexArray(list, mapFn, options = {}) {
  let items = [], mapped = [], disposers = [], signals = [], len = 0, i;
  onCleanup(() => dispose(disposers));
  return () => {
    const newItems = list() || [], newLen = newItems.length;
    newItems[$TRACK];
    return untrack(() => {
      if (newLen === 0) {
        if (len !== 0) {
          dispose(disposers);
          disposers = [];
          items = [];
          mapped = [];
          len = 0;
          signals = [];
        }
        if (options.fallback) {
          items = [FALLBACK];
          mapped[0] = createRoot((disposer) => {
            disposers[0] = disposer;
            return options.fallback();
          });
          len = 1;
        }
        return mapped;
      }
      if (items[0] === FALLBACK) {
        disposers[0]();
        disposers = [];
        items = [];
        mapped = [];
        len = 0;
      }
      for (i = 0; i < newLen; i++) {
        if (i < items.length && items[i] !== newItems[i]) {
          signals[i](() => newItems[i]);
        } else if (i >= items.length) {
          mapped[i] = createRoot(mapper);
        }
      }
      for (; i < items.length; i++) {
        disposers[i]();
      }
      len = signals.length = disposers.length = newLen;
      items = newItems.slice(0);
      return mapped = mapped.slice(0, len);
    });
    function mapper(disposer) {
      disposers[i] = disposer;
      const [s, set] = createSignal(newItems[i]);
      signals[i] = set;
      return mapFn(s, i);
    }
  };
}
function createComponent$1(Comp, props) {
  return untrack(() => Comp(props || {}));
}
function trueFn() {
  return true;
}
const propTraps = {
  get(_, property, receiver) {
    if (property === $PROXY) return receiver;
    return _.get(property);
  },
  has(_, property) {
    if (property === $PROXY) return true;
    return _.has(property);
  },
  set: trueFn,
  deleteProperty: trueFn,
  getOwnPropertyDescriptor(_, property) {
    return {
      configurable: true,
      enumerable: true,
      get() {
        return _.get(property);
      },
      set: trueFn,
      deleteProperty: trueFn
    };
  },
  ownKeys(_) {
    return _.keys();
  }
};
function resolveSource(s) {
  return !(s = typeof s === "function" ? s() : s) ? {} : s;
}
function resolveSources() {
  for (let i = 0, length = this.length; i < length; ++i) {
    const v = this[i]();
    if (v !== void 0) return v;
  }
}
function mergeProps$1(...sources) {
  let proxy = false;
  for (let i = 0; i < sources.length; i++) {
    const s = sources[i];
    proxy = proxy || !!s && $PROXY in s;
    sources[i] = typeof s === "function" ? (proxy = true, createMemo(s)) : s;
  }
  if (SUPPORTS_PROXY$1 && proxy) {
    return new Proxy(
      {
        get(property) {
          for (let i = sources.length - 1; i >= 0; i--) {
            const v = resolveSource(sources[i])[property];
            if (v !== void 0) return v;
          }
        },
        has(property) {
          for (let i = sources.length - 1; i >= 0; i--) {
            if (property in resolveSource(sources[i])) return true;
          }
          return false;
        },
        keys() {
          const keys = [];
          for (let i = 0; i < sources.length; i++)
            keys.push(...Object.keys(resolveSource(sources[i])));
          return [...new Set(keys)];
        }
      },
      propTraps
    );
  }
  const sourcesMap = {};
  const defined = /* @__PURE__ */ Object.create(null);
  for (let i = sources.length - 1; i >= 0; i--) {
    const source = sources[i];
    if (!source) continue;
    const sourceKeys = Object.getOwnPropertyNames(source);
    for (let i2 = sourceKeys.length - 1; i2 >= 0; i2--) {
      const key = sourceKeys[i2];
      if (key === "__proto__" || key === "constructor") continue;
      const desc = Object.getOwnPropertyDescriptor(source, key);
      if (!defined[key]) {
        defined[key] = desc.get ? {
          enumerable: true,
          configurable: true,
          get: resolveSources.bind(sourcesMap[key] = [desc.get.bind(source)])
        } : desc.value !== void 0 ? desc : void 0;
      } else {
        const sources2 = sourcesMap[key];
        if (sources2) {
          if (desc.get) sources2.push(desc.get.bind(source));
          else if (desc.value !== void 0) sources2.push(() => desc.value);
        }
      }
    }
  }
  const target = {};
  const definedKeys = Object.keys(defined);
  for (let i = definedKeys.length - 1; i >= 0; i--) {
    const key = definedKeys[i], desc = defined[key];
    if (desc && desc.get) Object.defineProperty(target, key, desc);
    else target[key] = desc ? desc.value : void 0;
  }
  return target;
}
function splitProps(props, ...keys) {
  if (SUPPORTS_PROXY$1 && $PROXY in props) {
    const blocked = new Set(keys.length > 1 ? keys.flat() : keys[0]);
    const res = keys.map((k) => {
      return new Proxy(
        {
          get(property) {
            return k.includes(property) ? props[property] : void 0;
          },
          has(property) {
            return k.includes(property) && property in props;
          },
          keys() {
            return k.filter((property) => property in props);
          }
        },
        propTraps
      );
    });
    res.push(
      new Proxy(
        {
          get(property) {
            return blocked.has(property) ? void 0 : props[property];
          },
          has(property) {
            return blocked.has(property) ? false : property in props;
          },
          keys() {
            return Object.keys(props).filter((k) => !blocked.has(k));
          }
        },
        propTraps
      )
    );
    return res;
  }
  const otherObject = {};
  const objects = keys.map(() => ({}));
  for (const propName of Object.getOwnPropertyNames(props)) {
    const desc = Object.getOwnPropertyDescriptor(props, propName);
    const isDefaultDesc = !desc.get && !desc.set && desc.enumerable && desc.writable && desc.configurable;
    let blocked = false;
    let objectIndex = 0;
    for (const k of keys) {
      if (k.includes(propName)) {
        blocked = true;
        isDefaultDesc ? objects[objectIndex][propName] = desc.value : Object.defineProperty(objects[objectIndex], propName, desc);
      }
      ++objectIndex;
    }
    if (!blocked) {
      isDefaultDesc ? otherObject[propName] = desc.value : Object.defineProperty(otherObject, propName, desc);
    }
  }
  return [...objects, otherObject];
}
function lazy(fn) {
  let comp;
  let p;
  const wrap = (props) => {
    const ctx = sharedConfig.context;
    if (ctx) {
      const [s, set] = createSignal();
      sharedConfig.count || (sharedConfig.count = 0);
      sharedConfig.count++;
      (p || (p = fn())).then((mod) => {
        !sharedConfig.done && setHydrateContext(ctx);
        sharedConfig.count--;
        set(() => mod.default);
        setHydrateContext();
      });
      comp = s;
    } else if (!comp) {
      const [s] = createResource(() => (p || (p = fn())).then((mod) => mod.default));
      comp = s;
    }
    let Comp;
    return createMemo(
      () => (Comp = comp()) ? untrack(() => {
        if (IS_DEV) ;
        if (!ctx || sharedConfig.done) return Comp(props);
        const c = sharedConfig.context;
        setHydrateContext(ctx);
        const r = Comp(props);
        setHydrateContext(c);
        return r;
      }) : ""
    );
  };
  wrap.preload = () => p || ((p = fn()).then((mod) => comp = () => mod.default), p);
  return wrap;
}
const narrowedError = (name) => "Stale read from <".concat(name, ">.");
function For(props) {
  const fallback = "fallback" in props && {
    fallback: () => props.fallback
  };
  return createMemo(mapArray(() => props.each, props.children, fallback || void 0));
}
function Index(props) {
  const fallback = "fallback" in props && {
    fallback: () => props.fallback
  };
  return createMemo(indexArray(() => props.each, props.children, fallback || void 0));
}
function Show(props) {
  const keyed = props.keyed;
  const conditionValue = createMemo(() => props.when, void 0, void 0);
  const condition = keyed ? conditionValue : createMemo(conditionValue, void 0, {
    equals: (a, b) => !a === !b
  });
  return createMemo(
    () => {
      const c = condition();
      if (c) {
        const child = props.children;
        const fn = typeof child === "function" && child.length > 0;
        return fn ? untrack(
          () => child(
            keyed ? c : () => {
              if (!untrack(condition)) throw narrowedError("Show");
              return conditionValue();
            }
          )
        ) : child;
      }
      return props.fallback;
    },
    void 0,
    void 0
  );
}
const SuspenseListContext = /* @__PURE__ */ createContext();
function Suspense(props) {
  let counter = 0, show, ctx, p, flicker, error;
  const [inFallback, setFallback] = createSignal(false), SuspenseContext2 = getSuspenseContext(), store = {
    increment: () => {
      if (++counter === 1) setFallback(true);
    },
    decrement: () => {
      if (--counter === 0) setFallback(false);
    },
    inFallback,
    effects: [],
    resolved: false
  }, owner = getOwner();
  if (sharedConfig.context && sharedConfig.load) {
    const key = sharedConfig.getContextId();
    let ref = sharedConfig.load(key);
    if (ref) {
      if (typeof ref !== "object" || ref.status !== "success") p = ref;
      else sharedConfig.gather(key);
    }
    if (p && p !== "$$f") {
      const [s, set] = createSignal(void 0, {
        equals: false
      });
      flicker = s;
      p.then(
        () => {
          if (sharedConfig.done) return set();
          sharedConfig.gather(key);
          setHydrateContext(ctx);
          set();
          setHydrateContext();
        },
        (err) => {
          error = err;
          set();
        }
      );
    }
  }
  const listContext = useContext(SuspenseListContext);
  if (listContext) show = listContext.register(store.inFallback);
  let dispose2;
  onCleanup(() => dispose2 && dispose2());
  return createComponent$1(SuspenseContext2.Provider, {
    value: store,
    get children() {
      return createMemo(() => {
        if (error) throw error;
        ctx = sharedConfig.context;
        if (flicker) {
          flicker();
          return flicker = void 0;
        }
        if (ctx && p === "$$f") setHydrateContext();
        const rendered = createMemo(() => props.children);
        return createMemo((prev) => {
          const inFallback2 = store.inFallback(), { showContent = true, showFallback = true } = show ? show() : {};
          if ((!inFallback2 || p && p !== "$$f") && showContent) {
            store.resolved = true;
            dispose2 && dispose2();
            dispose2 = ctx = p = void 0;
            resumeEffects(store.effects);
            return rendered();
          }
          if (!showFallback) return;
          if (dispose2) return prev;
          return createRoot((disposer) => {
            dispose2 = disposer;
            if (ctx) {
              setHydrateContext({
                id: ctx.id + "F",
                count: 0
              });
              ctx = void 0;
            }
            return props.fallback;
          }, owner);
        });
      });
    }
  });
}
const [activeElement, setActiveElement] = createSignal(void 0);
function hexColor(color = "") {
  if (isInteger(color)) {
    return color;
  }
  if (typeof color === "string") {
    if (color.startsWith("#")) {
      return Number(color.replace("#", "0x") + (color.length === 7 ? "ff" : ""));
    }
    if (color.startsWith("0x")) {
      return Number(color);
    }
    return Number("0x" + (color.length === 6 ? color + "ff" : color));
  }
  return 0;
}
function combineStyles(style1, style2) {
  if (!style1) {
    return style2;
  }
  if (!style2) {
    return style1;
  }
  return {
    ...style2,
    ...style1
  };
}
function createRenderer$1({
  createElement: createElement2,
  createTextNode: createTextNode2,
  isTextNode: isTextNode2,
  replaceText,
  insertNode: insertNode2,
  removeNode,
  setProperty,
  getParentNode,
  getFirstChild,
  getNextSibling
}) {
  function insert2(parent, accessor, marker, initial) {
    if (marker !== void 0 && !initial) initial = [];
    if (typeof accessor !== "function") return insertExpression(parent, accessor, initial, marker);
    createRenderEffect((current) => insertExpression(parent, accessor(), current, marker), initial);
  }
  function insertExpression(parent, value, current, marker, unwrapArray) {
    while (typeof current === "function") current = current();
    if (value === current) return current;
    const t = typeof value, multi = marker !== void 0;
    if (t === "string" || t === "number") {
      if (t === "number") value = value.toString();
      if (multi) {
        let node = current[0];
        if (node && isTextNode2(node)) {
          replaceText(node, value);
        } else node = createTextNode2(value);
        current = cleanChildren(parent, current, marker, node);
      } else {
        if (current !== "" && typeof current === "string") {
          replaceText(getFirstChild(parent), current = value);
        } else {
          cleanChildren(parent, current, marker, createTextNode2(value));
          current = value;
        }
      }
    } else if (value == null || t === "boolean") {
      current = cleanChildren(parent, current, marker);
    } else if (t === "function") {
      createRenderEffect(() => {
        let v = value();
        while (typeof v === "function") v = v();
        current = insertExpression(parent, v, current, marker);
      });
      return () => current;
    } else if (Array.isArray(value)) {
      const array = [];
      if (normalizeIncomingArray(array, value, unwrapArray)) {
        createRenderEffect(
          () => current = insertExpression(parent, array, current, marker, true)
        );
        return () => current;
      }
      if (array.length === 0) {
        const replacement = cleanChildren(parent, current, marker);
        if (multi) return current = replacement;
      } else {
        if (Array.isArray(current)) {
          if (current.length === 0) {
            appendNodes(parent, array, marker);
          } else reconcileArrays(parent, current, array);
        } else if (current == null || current === "") {
          appendNodes(parent, array);
        } else {
          reconcileArrays(parent, multi && current || [getFirstChild(parent)], array);
        }
      }
      current = array;
    } else {
      if (Array.isArray(current)) {
        if (multi) return current = cleanChildren(parent, current, marker, value);
        cleanChildren(parent, current, null, value);
      } else if (current == null || current === "" || !getFirstChild(parent)) {
        insertNode2(parent, value);
      } else replaceNode(parent, value, getFirstChild(parent));
      current = value;
    }
    return current;
  }
  function normalizeIncomingArray(normalized, array, unwrap) {
    let dynamic = false;
    for (let i = 0, len = array.length; i < len; i++) {
      let item = array[i], t;
      if (item == null || item === true || item === false) ;
      else if (Array.isArray(item)) {
        dynamic = normalizeIncomingArray(normalized, item) || dynamic;
      } else if ((t = typeof item) === "string" || t === "number") {
        normalized.push(createTextNode2(item));
      } else if (t === "function") {
        if (unwrap) {
          while (typeof item === "function") item = item();
          dynamic = normalizeIncomingArray(normalized, Array.isArray(item) ? item : [item]) || dynamic;
        } else {
          normalized.push(item);
          dynamic = true;
        }
      } else normalized.push(item);
    }
    return dynamic;
  }
  function reconcileArrays(parentNode, a, b) {
    let bLength = b.length, aEnd = a.length, bEnd = bLength, aStart = 0, bStart = 0, after = getNextSibling(a[aEnd - 1]), map = null;
    while (aStart < aEnd || bStart < bEnd) {
      if (a[aStart] === b[bStart]) {
        aStart++;
        bStart++;
        continue;
      }
      while (a[aEnd - 1] === b[bEnd - 1]) {
        aEnd--;
        bEnd--;
      }
      if (aEnd === aStart) {
        const node = bEnd < bLength ? bStart ? getNextSibling(b[bStart - 1]) : b[bEnd - bStart] : after;
        while (bStart < bEnd) insertNode2(parentNode, b[bStart++], node);
      } else if (bEnd === bStart) {
        while (aStart < aEnd) {
          if (!map || !map.has(a[aStart])) removeNode(parentNode, a[aStart]);
          aStart++;
        }
      } else if (a[aStart] === b[bEnd - 1] && b[bStart] === a[aEnd - 1]) {
        const node = getNextSibling(a[--aEnd]);
        insertNode2(parentNode, b[bStart++], getNextSibling(a[aStart++]));
        insertNode2(parentNode, b[--bEnd], node);
        a[aEnd] = b[bEnd];
      } else {
        if (!map) {
          map = /* @__PURE__ */ new Map();
          let i = bStart;
          while (i < bEnd) map.set(b[i], i++);
        }
        const index = map.get(a[aStart]);
        if (index != null) {
          if (bStart < index && index < bEnd) {
            let i = aStart, sequence = 1, t;
            while (++i < aEnd && i < bEnd) {
              if ((t = map.get(a[i])) == null || t !== index + sequence) break;
              sequence++;
            }
            if (sequence > index - bStart) {
              const node = a[aStart];
              while (bStart < index) insertNode2(parentNode, b[bStart++], node);
            } else replaceNode(parentNode, b[bStart++], a[aStart++]);
          } else aStart++;
        } else removeNode(parentNode, a[aStart++]);
      }
    }
  }
  function cleanChildren(parent, current, marker, replacement) {
    if (marker === void 0) {
      let removed;
      while (removed = getFirstChild(parent)) removeNode(parent, removed);
      replacement && insertNode2(parent, replacement);
      return "";
    }
    const node = replacement || createTextNode2("");
    if (current.length) {
      let inserted = false;
      for (let i = current.length - 1; i >= 0; i--) {
        const el = current[i];
        if (node !== el) {
          const isParent = getParentNode(el) === parent;
          if (!inserted && !i)
            isParent ? replaceNode(parent, node, el) : insertNode2(parent, node, marker);
          else isParent && removeNode(parent, el);
        } else inserted = true;
      }
    } else insertNode2(parent, node, marker);
    return [node];
  }
  function appendNodes(parent, array, marker) {
    for (let i = 0, len = array.length; i < len; i++) insertNode2(parent, array[i], marker);
  }
  function replaceNode(parent, newNode, oldNode) {
    insertNode2(parent, newNode, oldNode);
    removeNode(parent, oldNode);
  }
  function spreadExpression(node, props, prevProps = {}, skipChildren) {
    props || (props = {});
    if (!skipChildren) {
      createRenderEffect(
        () => prevProps.children = insertExpression(node, props.children, prevProps.children)
      );
    }
    createRenderEffect(() => props.ref && props.ref(node));
    createRenderEffect(() => {
      for (const prop in props) {
        if (prop === "children" || prop === "ref") continue;
        const value = props[prop];
        if (value === prevProps[prop]) continue;
        setProperty(node, prop, value, prevProps[prop]);
        prevProps[prop] = value;
      }
    });
    return prevProps;
  }
  return {
    render(code, element) {
      let disposer;
      createRoot((dispose2) => {
        disposer = dispose2;
        insert2(element, code());
      });
      return disposer;
    },
    insert: insert2,
    spread(node, accessor, skipChildren) {
      if (typeof accessor === "function") {
        createRenderEffect((current) => spreadExpression(node, accessor(), current, skipChildren));
      } else spreadExpression(node, accessor, void 0, skipChildren);
    },
    createElement: createElement2,
    createTextNode: createTextNode2,
    insertNode: insertNode2,
    setProp(node, name, value, prev) {
      setProperty(node, name, value, prev);
      return value;
    },
    mergeProps: mergeProps$1,
    effect: createRenderEffect,
    memo: createMemo,
    createComponent: createComponent$1,
    use(fn, element, arg) {
      return untrack(() => fn(element, arg));
    }
  };
}
function createRenderer$2(options) {
  const renderer2 = createRenderer$1(options);
  renderer2.mergeProps = mergeProps$1;
  return renderer2;
}
Object.defineProperty(ElementNode.prototype, "preserve", {
  get() {
    return this._queueDelete === 0;
  },
  set(v) {
    this._queueDelete = v ? 0 : void 0;
  }
});
let elementDeleteQueue = [];
function flushDeleteQueue() {
  for (let el of elementDeleteQueue) {
    if (Number(el._queueDelete) < 0) {
      el.destroy();
    }
    el._queueDelete = void 0;
  }
  elementDeleteQueue.length = 0;
}
function pushDeleteQueue(node, n) {
  if (node._queueDelete === void 0) {
    node._queueDelete = n;
    if (elementDeleteQueue.push(node) === 1) {
      queueMicrotask(flushDeleteQueue);
    }
  } else {
    node._queueDelete += n;
  }
}
const nodeOpts = {
  createElement(name) {
    return new ElementNode(name);
  },
  createTextNode(text) {
    return { _type: NodeType.Text, text };
  },
  replaceText(node, value) {
    log("Replace Text: ", node, value);
    node.text = value;
    const parent = node.parent;
    assertTruthy(parent);
    parent.text = parent.getText();
  },
  setProperty(node, name, value = true) {
    node[name] = value;
  },
  insertNode(parent, node, anchor) {
    log("INSERT: ", parent, node, anchor);
    let prevParent = node.parent;
    parent.insertChild(node, anchor);
    if (node instanceof ElementNode) {
      node.parent.rendered && node.render(true);
      if (prevParent !== void 0) {
        pushDeleteQueue(node, 1);
      }
    } else if (isElementText(parent)) {
      parent.text = parent.getText();
    }
  },
  isTextNode(node) {
    return isElementText(node);
  },
  removeNode(parent, node) {
    log("REMOVE: ", parent, node);
    parent.removeChild(node);
    if (node instanceof ElementNode) {
      pushDeleteQueue(node, -1);
    } else if (isElementText(parent)) {
      parent.text = parent.getText();
    }
  },
  getParentNode(node) {
    return node.parent;
  },
  getFirstChild(node) {
    return node.children[0];
  },
  getNextSibling(node) {
    const children2 = node.parent.children || [];
    const index = children2.indexOf(node) + 1;
    if (index < children2.length) {
      return children2[index];
    }
    return void 0;
  }
};
const solidRenderer = createRenderer$2(nodeOpts);
let renderer;
const rootNode = nodeOpts.createElement("App");
const render$1 = function(code) {
  return solidRenderer.render(code, rootNode);
};
function createRenderer(rendererOptions, node) {
  const options = Config.rendererOptions;
  renderer = startLightningRenderer(options, "app");
  Config.setActiveElement = setActiveElement;
  rootNode.lng = renderer.root;
  rootNode.rendered = true;
  renderer.on("idle", () => {
    tasksEnabled = true;
    processTasks();
  });
  return {
    renderer,
    rootNode,
    render: render$1
  };
}
const { effect, memo, createComponent, createElement, createTextNode, insertNode, insert, spread, setProp, mergeProps, use } = solidRenderer;
const taskQueue = [];
let tasksEnabled = false;
createRoot(() => {
  createRenderEffect(() => {
    activeElement();
    tasksEnabled = false;
  });
});
function scheduleTask(callback, priority = "low") {
  if (priority === "high") {
    taskQueue.unshift(callback);
  } else {
    taskQueue.push(callback);
  }
  processTasks();
}
function processTasks() {
  if (tasksEnabled && taskQueue.length) {
    setTimeout(() => {
      const task = taskQueue.shift();
      if (task) {
        task();
        processTasks();
      }
    }, Config.taskDelay || 50);
  }
}
function Dynamic(props) {
  const [p, others] = splitProps(props, ["component"]);
  const cached = createMemo(() => p.component);
  return createMemo(() => {
    const component = cached();
    switch (typeof component) {
      case "function":
        return untrack(() => component(others));
      case "string": {
        const el = createElement(component);
        spread(el, others);
        return el;
      }
    }
  });
}
const View = (props) => {
  const el = createElement("node");
  spread(el, props, false);
  return el;
};
const Text$1 = (props) => {
  const el = createElement("text");
  spread(el, props, false);
  return el;
};
const FLOATS_PER_GLYPH = 24;
function getStartConditions(sdfFontSize, sdfLineHeight, fontFace, verticalAlign, offsetY, fontSizeRatio, renderWindow, lineCache, textH) {
  const startLineIndex = Math.min(Math.max(renderWindow.firstLineIdx, 0), lineCache.length);
  const sdfStartX = 0;
  const { metrics } = fontFace;
  assertTruthy(metrics, "Font metrics not loaded");
  assertTruthy(fontFace.data, "Font data not loaded");
  const sdfBareLineHeight = (metrics.ascender - metrics.descender) * sdfFontSize;
  let sdfVerticalAlignYOffset = 0;
  if (verticalAlign === "middle") {
    sdfVerticalAlignYOffset = (sdfLineHeight - sdfBareLineHeight) / 2;
  } else if (verticalAlign === "bottom") {
    sdfVerticalAlignYOffset = sdfLineHeight - sdfBareLineHeight;
  }
  const sdfOffsetY = offsetY / fontSizeRatio;
  const sdfEncodedAscender = fontFace.data.common.base;
  const sdfConfiguredAscender = metrics.ascender * sdfFontSize;
  const sdfAscenderAdjOffset = sdfConfiguredAscender - sdfEncodedAscender;
  const sdfStartY = sdfOffsetY + sdfAscenderAdjOffset + startLineIndex * sdfLineHeight + sdfVerticalAlignYOffset;
  if (textH && sdfStartY >= textH / fontSizeRatio) {
    return;
  }
  return {
    sdfX: sdfStartX,
    sdfY: sdfStartY,
    lineIndex: startLineIndex
  };
}
class PeekableIterator {
  constructor(iterator, indexBase = 0) {
    __publicField(this, "iterator");
    __publicField(this, "peekBuffer", []);
    __publicField(this, "_lastIndex");
    this.iterator = iterator;
    this.iterator = iterator;
    this._lastIndex = indexBase - 1;
    this.peekBuffer = [];
  }
  next() {
    const nextResult = this.peekBuffer.length > 0 ? (
      // eslint-disable-next-line @typescript-eslint/no-non-null-assertion
      this.peekBuffer.pop()
    ) : this.iterator.next();
    if (nextResult.done) {
      this._lastIndex = -1;
    } else {
      this._lastIndex++;
    }
    return nextResult;
  }
  peek() {
    if (this.peekBuffer.length > 0) {
      return this.peekBuffer[0];
    }
    const result = this.iterator.next();
    this.peekBuffer.push(result);
    return result;
  }
  get lastIndex() {
    return this._lastIndex;
  }
}
function* getUnicodeCodepoints(text, start = 0) {
  let i = start;
  while (i < text.length) {
    const codePoint = text.codePointAt(i);
    if (codePoint === void 0) {
      throw new Error("Invalid Unicode code point");
    }
    yield codePoint;
    i += codePoint <= 65535 ? 1 : 2;
  }
}
function measureText(text, shaperProps, shaper) {
  const glyphs = shaper.shapeText(shaperProps, new PeekableIterator(getUnicodeCodepoints(text, 0), 0));
  let width = 0;
  for (const glyph of glyphs) {
    if (glyph.mapped && glyph.codepoint !== 8203) {
      width += glyph.xAdvance;
    }
  }
  return width;
}
function layoutText(curLineIndex, startX, startY, text, textAlign, width, height, fontSize, lineHeight, letterSpacing, vertexBuffer, contain, lineCache, rwSdf, trFontFace, forceFullLayoutCalc, scrollable, overflowSuffix, maxLines) {
  assertTruthy(trFontFace, "Font face must be loaded");
  assertTruthy(trFontFace.loaded, "Font face must be loaded");
  assertTruthy(trFontFace.data, "Font face must be loaded");
  assertTruthy(trFontFace.shaper, "Font face must be loaded");
  const fontSizeRatio = fontSize / trFontFace.data.info.size;
  const vertexLineHeight = lineHeight / fontSizeRatio;
  const vertexW = width / fontSizeRatio;
  const vertexLSpacing = letterSpacing / fontSizeRatio;
  const startingLineCacheEntry = lineCache[curLineIndex];
  const startingCodepointIndex = (startingLineCacheEntry == null ? void 0 : startingLineCacheEntry.codepointIndex) || 0;
  const startingMaxX = (startingLineCacheEntry == null ? void 0 : startingLineCacheEntry.maxX) || 0;
  const startingMaxY = (startingLineCacheEntry == null ? void 0 : startingLineCacheEntry.maxY) || 0;
  let maxX = startingMaxX;
  let maxY = startingMaxY;
  let curX = startX;
  let curY = startY;
  let bufferOffset = 0;
  const lastWord = {
    codepointIndex: -1,
    bufferOffset: -1,
    xStart: -1
  };
  const shaper = trFontFace.shaper;
  const shaperProps = {
    letterSpacing: vertexLSpacing
  };
  if (text.endsWith(" ")) {
    text += " ";
  }
  let glyphs = shaper.shapeText(shaperProps, new PeekableIterator(getUnicodeCodepoints(text, startingCodepointIndex), startingCodepointIndex));
  let glyphResult;
  let curLineBufferStart = -1;
  const bufferLineInfos = [];
  const vertexTruncateHeight = height / fontSizeRatio;
  const overflowSuffVertexWidth = measureText(overflowSuffix, shaperProps, shaper);
  let moreLines = true;
  while (moreLines) {
    const nextLineWillFit = (maxLines === 0 || curLineIndex + 1 < maxLines) && (contain !== "both" || scrollable || curY + vertexLineHeight + trFontFace.maxCharHeight <= vertexTruncateHeight);
    const lineVertexW = nextLineWillFit ? vertexW : vertexW - overflowSuffVertexWidth;
    let xStartLastWordBoundary = 0;
    const lineIsBelowWindowTop = curY + trFontFace.maxCharHeight >= rwSdf.y1;
    const lineIsAboveWindowBottom = curY <= rwSdf.y2;
    const lineIsWithinWindow = lineIsBelowWindowTop && lineIsAboveWindowBottom;
    while ((glyphResult = glyphs.next()) && !glyphResult.done) {
      const glyph = glyphResult.value;
      if (curLineIndex === lineCache.length) {
        lineCache.push({
          codepointIndex: glyph.cluster,
          maxY,
          maxX
        });
      } else if (curLineIndex > lineCache.length) {
        throw new Error("Unexpected lineCache length");
      }
      if (glyph.codepoint === 32 || glyph.codepoint === 10 || glyph.codepoint === 8203) {
        if (lastWord.codepointIndex !== -1) {
          lastWord.codepointIndex = -1;
          xStartLastWordBoundary = curX;
        }
      } else if (lastWord.codepointIndex === -1) {
        lastWord.codepointIndex = glyph.cluster;
        lastWord.bufferOffset = bufferOffset;
        lastWord.xStart = xStartLastWordBoundary;
      }
      if (glyph.mapped) {
        const charEndX = curX + glyph.xOffset + glyph.width;
        if (
          // We are containing the text
          contain !== "none" && // The current glyph reaches outside the contained width
          charEndX >= lineVertexW && // There is a last word that we can break to the next line
          lastWord.codepointIndex !== -1 && // Prevents infinite loop when a single word is longer than the width
          lastWord.xStart > 0
        ) {
          if (nextLineWillFit) {
            glyphs = shaper.shapeText(shaperProps, new PeekableIterator(getUnicodeCodepoints(text, lastWord.codepointIndex), lastWord.codepointIndex));
            bufferOffset = lastWord.bufferOffset;
            break;
          } else {
            glyphs = shaper.shapeText(shaperProps, new PeekableIterator(getUnicodeCodepoints(overflowSuffix, 0), 0));
            curX = lastWord.xStart;
            bufferOffset = lastWord.bufferOffset;
            contain = "none";
          }
        } else {
          const quadX = curX + glyph.xOffset;
          const quadY = curY + glyph.yOffset;
          if (lineIsWithinWindow) {
            if (curLineBufferStart === -1) {
              curLineBufferStart = bufferOffset;
            }
            const atlasEntry = trFontFace.getAtlasEntry(glyph.glyphId);
            const u = atlasEntry.x / trFontFace.data.common.scaleW;
            const v = atlasEntry.y / trFontFace.data.common.scaleH;
            const uvWidth = atlasEntry.width / trFontFace.data.common.scaleW;
            const uvHeight = atlasEntry.height / trFontFace.data.common.scaleH;
            vertexBuffer[bufferOffset++] = quadX;
            vertexBuffer[bufferOffset++] = quadY;
            vertexBuffer[bufferOffset++] = u;
            vertexBuffer[bufferOffset++] = v;
            vertexBuffer[bufferOffset++] = quadX + glyph.width;
            vertexBuffer[bufferOffset++] = quadY;
            vertexBuffer[bufferOffset++] = u + uvWidth;
            vertexBuffer[bufferOffset++] = v;
            vertexBuffer[bufferOffset++] = quadX;
            vertexBuffer[bufferOffset++] = quadY + glyph.height;
            vertexBuffer[bufferOffset++] = u;
            vertexBuffer[bufferOffset++] = v + uvHeight;
            vertexBuffer[bufferOffset++] = quadX + glyph.width;
            vertexBuffer[bufferOffset++] = quadY + glyph.height;
            vertexBuffer[bufferOffset++] = u + uvWidth;
            vertexBuffer[bufferOffset++] = v + uvHeight;
          }
          maxY = Math.max(maxY, quadY + glyph.height);
          maxX = Math.max(maxX, quadX + glyph.width);
          curX += glyph.xAdvance;
        }
      } else {
        if (glyph.codepoint === 10) {
          if (nextLineWillFit) {
            break;
          } else {
            glyphs = shaper.shapeText(shaperProps, new PeekableIterator(getUnicodeCodepoints(overflowSuffix, 0), 0));
            contain = "none";
          }
        }
      }
    }
    if (curLineBufferStart !== -1) {
      bufferLineInfos.push({
        bufferStart: curLineBufferStart,
        bufferEnd: bufferOffset
      });
      curLineBufferStart = -1;
    }
    curX = 0;
    curY += vertexLineHeight;
    curLineIndex++;
    lastWord.codepointIndex = -1;
    xStartLastWordBoundary = 0;
    if (!forceFullLayoutCalc && contain === "both" && curY > rwSdf.y2) {
      moreLines = false;
    } else if (glyphResult && glyphResult.done) {
      moreLines = false;
    } else if (!nextLineWillFit) {
      moreLines = false;
    }
  }
  if (textAlign === "center") {
    const vertexTextW = contain === "none" ? maxX : vertexW;
    for (let i = 0; i < bufferLineInfos.length; i++) {
      const line = bufferLineInfos[i];
      const lineWidth = (
        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion
        vertexBuffer[line.bufferEnd - 4] - vertexBuffer[line.bufferStart]
      );
      const xOffset = (vertexTextW - lineWidth) / 2;
      for (let j = line.bufferStart; j < line.bufferEnd; j += 4) {
        vertexBuffer[j] += xOffset;
      }
    }
  } else if (textAlign === "right") {
    const vertexTextW = contain === "none" ? maxX : vertexW;
    for (let i = 0; i < bufferLineInfos.length; i++) {
      const line = bufferLineInfos[i];
      const lineWidth = line.bufferEnd === line.bufferStart ? 0 : (
        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion
        vertexBuffer[line.bufferEnd - 4] - vertexBuffer[line.bufferStart]
      );
      const xOffset = vertexTextW - lineWidth;
      for (let j = line.bufferStart; j < line.bufferEnd; j += 4) {
        vertexBuffer[j] += xOffset;
      }
    }
  }
  assertTruthy(glyphResult);
  return {
    bufferNumFloats: bufferOffset,
    bufferNumQuads: bufferOffset / 16,
    layoutNumCharacters: glyphResult.done ? text.length - startingCodepointIndex : glyphResult.value.cluster - startingCodepointIndex + 1,
    fullyProcessed: !!glyphResult.done,
    maxX,
    maxY,
    numLines: lineCache.length
  };
}
function roundUpToMultiple(value, multiple) {
  return Math.ceil(value / multiple) * multiple;
}
function roundDownToMultiple(value, multiple) {
  return Math.floor(value / multiple) * multiple;
}
function setRenderWindow(outRenderWindow, x, y, scrollY, lineHeight, bufferMargin, visibleWindow, fontSizeRatio) {
  const { screen: screen2, sdf } = outRenderWindow;
  if (!isBoundPositive(visibleWindow)) {
    screen2.x1 = 0;
    screen2.y1 = 0;
    screen2.x2 = 0;
    screen2.y2 = 0;
    sdf.x1 = 0;
    sdf.y1 = 0;
    sdf.x2 = 0;
    sdf.y2 = 0;
    outRenderWindow.numLines = 0;
    outRenderWindow.firstLineIdx = 0;
  } else {
    const x1 = visibleWindow.x1 - x;
    const x2 = x1 + (visibleWindow.x2 - visibleWindow.x1);
    const y1Base = visibleWindow.y1 - y + scrollY;
    const y1 = roundDownToMultiple(y1Base - bufferMargin, lineHeight || 1);
    const y2 = roundUpToMultiple(y1Base + (visibleWindow.y2 - visibleWindow.y1) + bufferMargin, lineHeight || 1);
    screen2.x1 = x1;
    screen2.y1 = y1;
    screen2.x2 = x2;
    screen2.y2 = y2;
    sdf.x1 = x1 / fontSizeRatio;
    sdf.y1 = y1 / fontSizeRatio;
    sdf.x2 = x2 / fontSizeRatio;
    sdf.y2 = y2 / fontSizeRatio;
    outRenderWindow.numLines = Math.ceil((y2 - y1) / lineHeight);
    outRenderWindow.firstLineIdx = lineHeight ? Math.floor(y1 / lineHeight) : 0;
  }
  outRenderWindow.valid = true;
}
function calcDefaultLineHeight(metrics, fontSize) {
  return fontSize * (metrics.ascender - metrics.descender + metrics.lineGap);
}
const tmpRect = {
  x: 0,
  y: 0,
  width: 0,
  height: 0
};
class SdfTextRenderer extends TextRenderer {
  constructor(stage) {
    super(stage);
    /**
     * Map of font family names to a set of font faces.
     */
    __publicField(this, "ssdfFontFamilies", {});
    __publicField(this, "msdfFontFamilies", {});
    __publicField(this, "fontFamilyArray", [
      this.ssdfFontFamilies,
      this.msdfFontFamilies
    ]);
    __publicField(this, "sdfShader");
    __publicField(this, "rendererBounds");
    __publicField(this, "type", "sdf");
    this.sdfShader = this.stage.shManager.loadShader("SdfShader", {
      transform: new Float32Array(),
      color: 0,
      size: 0,
      scrollY: 0,
      distanceRange: 0,
      debug: false
    }).shader;
    this.rendererBounds = {
      x1: 0,
      y1: 0,
      x2: this.stage.options.appWidth,
      y2: this.stage.options.appHeight
    };
  }
  //#region Overrides
  getPropertySetters() {
    return {
      fontFamily: (state, value) => {
        state.props.fontFamily = value;
        this.releaseFontFace(state);
        this.invalidateLayoutCache(state);
      },
      fontWeight: (state, value) => {
        state.props.fontWeight = value;
        this.releaseFontFace(state);
        this.invalidateLayoutCache(state);
      },
      fontStyle: (state, value) => {
        state.props.fontStyle = value;
        this.releaseFontFace(state);
        this.invalidateLayoutCache(state);
      },
      fontStretch: (state, value) => {
        state.props.fontStretch = value;
        this.releaseFontFace(state);
        this.invalidateLayoutCache(state);
      },
      fontSize: (state, value) => {
        state.props.fontSize = value;
        this.invalidateLayoutCache(state);
      },
      text: (state, value) => {
        state.props.text = value;
        this.invalidateLayoutCache(state);
      },
      textAlign: (state, value) => {
        state.props.textAlign = value;
        this.invalidateLayoutCache(state);
      },
      color: (state, value) => {
        state.props.color = value;
      },
      x: (state, value) => {
        state.props.x = value;
        if (state.elementBounds.valid) {
          this.setElementBoundsX(state);
          if (!state.renderWindow.valid && boundsOverlap(state.elementBounds, this.rendererBounds)) {
            this.scheduleUpdateState(state);
          }
        }
      },
      y: (state, value) => {
        state.props.y = value;
        if (state.elementBounds.valid) {
          this.setElementBoundsY(state);
          if (!state.renderWindow.valid && boundsOverlap(state.elementBounds, this.rendererBounds)) {
            this.scheduleUpdateState(state);
          }
        }
      },
      contain: (state, value) => {
        state.props.contain = value;
        this.invalidateLayoutCache(state);
      },
      width: (state, value) => {
        state.props.width = value;
        if (state.props.contain !== "none") {
          this.invalidateLayoutCache(state);
        }
      },
      height: (state, value) => {
        state.props.height = value;
        if (state.props.contain === "both") {
          this.invalidateLayoutCache(state);
        }
      },
      offsetY: (state, value) => {
        state.props.offsetY = value;
        this.invalidateLayoutCache(state);
      },
      scrollable: (state, value) => {
        state.props.scrollable = value;
        this.invalidateLayoutCache(state);
      },
      scrollY: (state, value) => {
        state.props.scrollY = value;
        this.scheduleUpdateState(state);
      },
      letterSpacing: (state, value) => {
        state.props.letterSpacing = value;
        this.invalidateLayoutCache(state);
      },
      lineHeight: (state, value) => {
        state.props.lineHeight = value;
        state.resLineHeight = void 0;
        this.invalidateLayoutCache(state);
      },
      maxLines: (state, value) => {
        state.props.maxLines = value;
        this.invalidateLayoutCache(state);
      },
      textBaseline: (state, value) => {
        state.props.textBaseline = value;
        this.invalidateLayoutCache(state);
      },
      verticalAlign: (state, value) => {
        state.props.verticalAlign = value;
        this.invalidateLayoutCache(state);
      },
      overflowSuffix: (state, value) => {
        state.props.overflowSuffix = value;
        this.invalidateLayoutCache(state);
      },
      debug: (state, value) => {
        state.props.debug = value;
      }
    };
  }
  canRenderFont(props) {
    const { fontFamily } = props;
    return fontFamily in this.ssdfFontFamilies || fontFamily in this.msdfFontFamilies || fontFamily === "$$SDF_FAILURE_TEST$$";
  }
  isFontFaceSupported(fontFace) {
    return fontFace instanceof SdfTrFontFace;
  }
  addFontFace(fontFace) {
    assertTruthy(fontFace instanceof SdfTrFontFace);
    const familyName = fontFace.fontFamily;
    const fontFamiles = fontFace.type === "ssdf" ? this.ssdfFontFamilies : fontFace.type === "msdf" ? this.msdfFontFamilies : void 0;
    if (!fontFamiles) {
      console.warn("Invalid font face type: ".concat(fontFace.type));
      return;
    }
    let faceSet = fontFamiles[familyName];
    if (!faceSet) {
      faceSet = /* @__PURE__ */ new Set();
      fontFamiles[familyName] = faceSet;
    }
    faceSet.add(fontFace);
  }
  createState(props) {
    return {
      props,
      status: "initialState",
      updateScheduled: false,
      emitter: new EventEmitter(),
      lineCache: [],
      forceFullLayoutCalc: false,
      renderWindow: {
        screen: {
          x1: 0,
          y1: 0,
          x2: 0,
          y2: 0
        },
        sdf: {
          x1: 0,
          y1: 0,
          x2: 0,
          y2: 0
        },
        firstLineIdx: 0,
        numLines: 0,
        valid: false
      },
      elementBounds: {
        x1: 0,
        y1: 0,
        x2: 0,
        y2: 0,
        valid: false
      },
      clippingRect: {
        x: 0,
        y: 0,
        width: 0,
        height: 0,
        valid: false
      },
      bufferNumFloats: 0,
      bufferNumQuads: 0,
      vertexBuffer: void 0,
      webGlBuffers: null,
      bufferUploaded: false,
      textH: void 0,
      textW: void 0,
      distanceRange: 0,
      trFontFace: void 0,
      isRenderable: false,
      resLineHeight: void 0,
      debugData: {
        updateCount: 0,
        layoutCount: 0,
        lastLayoutNumCharacters: 0,
        layoutSum: 0,
        drawSum: 0,
        drawCount: 0,
        bufferSize: 0
      }
    };
  }
  updateState(state) {
    let { trFontFace } = state;
    const { textH, lineCache, debugData, forceFullLayoutCalc } = state;
    debugData.updateCount++;
    if (state.status === "initialState") {
      this.setStatus(state, "loading");
    }
    if (trFontFace === void 0) {
      trFontFace = this.resolveFontFace(state.props);
      state.trFontFace = trFontFace;
      if (trFontFace === void 0) {
        const msg = "SdfTextRenderer: Could not resolve font face for family: '".concat(state.props.fontFamily, "'");
        console.error(msg);
        this.setStatus(state, "failed", new Error(msg));
        return;
      }
      trFontFace.texture.setRenderableOwner(state, true);
    }
    if (trFontFace.loaded === false) {
      trFontFace.once("loaded", () => {
        this.scheduleUpdateState(state);
      });
      return;
    }
    assertTruthy(trFontFace.data, "Font face data should be loaded");
    assertTruthy(trFontFace.metrics, "Font face metrics should be loaded");
    const { text, fontSize, x, y, contain, width, height, verticalAlign, scrollable, overflowSuffix, maxLines } = state.props;
    const scrollY = contain === "both" && scrollable ? state.props.scrollY : 0;
    const { renderWindow } = state;
    const sdfFontSize = trFontFace.data.info.size;
    const fontSizeRatio = fontSize / sdfFontSize;
    let resLineHeight = state.resLineHeight;
    if (resLineHeight === void 0) {
      const lineHeight = state.props.lineHeight;
      if (lineHeight === void 0) {
        resLineHeight = calcDefaultLineHeight(trFontFace.metrics, fontSize);
      } else {
        resLineHeight = lineHeight;
      }
      state.resLineHeight = resLineHeight;
    }
    const sdfLineHeight = resLineHeight / fontSizeRatio;
    state.distanceRange = fontSizeRatio * trFontFace.data.distanceField.distanceRange;
    const neededLength = text.length * FLOATS_PER_GLYPH;
    let vertexBuffer = state.vertexBuffer;
    if (!vertexBuffer || vertexBuffer.length < neededLength) {
      vertexBuffer = new Float32Array(neededLength * 2);
    }
    const elementBounds = state.elementBounds;
    if (!elementBounds.valid) {
      this.setElementBoundsX(state);
      this.setElementBoundsY(state);
      elementBounds.valid = true;
    }
    if (!forceFullLayoutCalc && renderWindow.valid) {
      const rwScreen = renderWindow.screen;
      if (x + rwScreen.x1 <= elementBounds.x1 && x + rwScreen.x2 >= elementBounds.x2 && y - scrollY + rwScreen.y1 <= elementBounds.y1 && y - scrollY + rwScreen.y2 >= elementBounds.y2) {
        this.setStatus(state, "loaded");
        return;
      }
      renderWindow.valid = false;
      this.setStatus(state, "loading");
    }
    const { offsetY, textAlign } = state.props;
    if (!renderWindow.valid) {
      const isPossiblyOnScreen = boundsOverlap(elementBounds, this.rendererBounds);
      if (!isPossiblyOnScreen) {
        return;
      }
      setRenderWindow(renderWindow, x, y, scrollY, resLineHeight, contain === "both" ? elementBounds.y2 - elementBounds.y1 : 0, elementBounds, fontSizeRatio);
    }
    const start = getStartConditions(sdfFontSize, sdfLineHeight, trFontFace, verticalAlign, offsetY, fontSizeRatio, renderWindow, lineCache, textH);
    if (!start) {
      this.setStatus(state, "loaded");
      return;
    }
    const { letterSpacing } = state.props;
    const out2 = layoutText(start.lineIndex, start.sdfX, start.sdfY, text, textAlign, width, height, fontSize, resLineHeight, letterSpacing, vertexBuffer, contain, lineCache, renderWindow.sdf, trFontFace, forceFullLayoutCalc, scrollable, overflowSuffix, maxLines);
    state.bufferUploaded = false;
    state.bufferNumFloats = out2.bufferNumFloats;
    state.bufferNumQuads = out2.bufferNumQuads;
    state.vertexBuffer = vertexBuffer;
    state.renderWindow = renderWindow;
    debugData.lastLayoutNumCharacters = out2.layoutNumCharacters;
    debugData.bufferSize = vertexBuffer.byteLength;
    if (out2.fullyProcessed) {
      state.textW = out2.maxX * fontSizeRatio;
      state.textH = out2.numLines * sdfLineHeight * fontSizeRatio;
    }
    this.setStatus(state, "loaded");
  }
  renderQuads(state, transform, clippingRect, alpha, parentHasRenderTexture, framebufferDimensions) {
    var _a2, _b, _c;
    if (!state.vertexBuffer) {
      return;
    }
    const renderer2 = this.stage.renderer;
    assertTruthy(renderer2 instanceof WebGlCoreRenderer);
    const { fontSize, color, contain, scrollable, zIndex, debug } = state.props;
    const scrollY = contain === "both" && scrollable ? state.props.scrollY : 0;
    const { textW = 0, textH = 0, distanceRange, vertexBuffer, bufferUploaded, trFontFace, elementBounds } = state;
    let { webGlBuffers } = state;
    if (!webGlBuffers) {
      const glw = renderer2.glw;
      const stride = 4 * Float32Array.BYTES_PER_ELEMENT;
      const webGlBuffer = glw.createBuffer();
      assertTruthy(webGlBuffer);
      state.webGlBuffers = new BufferCollection([
        {
          buffer: webGlBuffer,
          attributes: {
            a_position: {
              name: "a_position",
              size: 2,
              // 2 components per iteration
              type: glw.FLOAT,
              // the data is 32bit floats
              normalized: false,
              // don't normalize the data
              stride,
              // 0 = move forward size * sizeof(type) each iteration to get the next position
              offset: 0
              // start at the beginning of the buffer
            },
            a_textureCoordinate: {
              name: "a_textureCoordinate",
              size: 2,
              type: glw.FLOAT,
              normalized: false,
              stride,
              offset: 2 * Float32Array.BYTES_PER_ELEMENT
            }
          }
        }
      ]);
      state.bufferUploaded = false;
      assertTruthy(state.webGlBuffers);
      webGlBuffers = state.webGlBuffers;
    }
    if (!bufferUploaded) {
      const glw = renderer2.glw;
      const buffer = (_a2 = webGlBuffers == null ? void 0 : webGlBuffers.getBuffer("a_textureCoordinate")) != null ? _a2 : null;
      glw.arrayBufferData(buffer, vertexBuffer, glw.STATIC_DRAW);
      state.bufferUploaded = true;
    }
    assertTruthy(trFontFace);
    if (scrollable && contain === "both") {
      assertTruthy(elementBounds.valid);
      const elementRect = convertBoundToRect(elementBounds, tmpRect);
      if (clippingRect.valid) {
        state.clippingRect.valid = true;
        clippingRect = intersectRect(clippingRect, elementRect, state.clippingRect);
      } else {
        state.clippingRect.valid = true;
        clippingRect = copyRect(elementRect, state.clippingRect);
      }
    }
    const renderOp = new WebGlCoreRenderOp(renderer2.glw, renderer2.options, webGlBuffers, this.sdfShader, {
      transform: transform.getFloatArr(),
      // IMPORTANT: The SDF Shader expects the color NOT to be premultiplied
      // for the best blending results. Which is why we use `mergeColorAlpha`
      // instead of `mergeColorAlphaPremultiplied` here.
      color: mergeColorAlpha(color, alpha),
      size: fontSize / (((_b = trFontFace.data) == null ? void 0 : _b.info.size) || 0),
      scrollY,
      distanceRange,
      debug: debug.sdfShaderDebug
    }, alpha, clippingRect, { height: textH, width: textW }, 0, zIndex, false, parentHasRenderTexture, framebufferDimensions);
    const texture = (_c = state.trFontFace) == null ? void 0 : _c.texture;
    assertTruthy(texture);
    const ctxTexture = texture.ctxTexture;
    renderOp.addTexture(ctxTexture);
    renderOp.length = state.bufferNumFloats;
    renderOp.numQuads = state.bufferNumQuads;
    renderer2.addRenderOp(renderOp);
  }
  setIsRenderable(state, renderable) {
    var _a2;
    super.setIsRenderable(state, renderable);
    (_a2 = state.trFontFace) == null ? void 0 : _a2.texture.setRenderableOwner(state, renderable);
  }
  destroyState(state) {
    var _a2;
    super.destroyState(state);
    (_a2 = state.trFontFace) == null ? void 0 : _a2.texture.setRenderableOwner(state, false);
  }
  //#endregion Overrides
  resolveFontFace(props) {
    return this.stage.fontManager.resolveFontFace(this.fontFamilyArray, props, "sdf");
  }
  /**
   * Release the loaded SDF font face
   *
   * @param state
   */
  releaseFontFace(state) {
    state.resLineHeight = void 0;
    if (state.trFontFace) {
      state.trFontFace.texture.setRenderableOwner(state, false);
      state.trFontFace = void 0;
    }
  }
  /**
   * Invalidate the layout cache stored in the state. This will cause the text
   * to be re-layed out on the next update.
   *
   * @remarks
   * This also invalidates the visible window cache.
   *
   * @param state
   */
  invalidateLayoutCache(state) {
    state.renderWindow.valid = false;
    state.elementBounds.valid = false;
    state.textH = void 0;
    state.textW = void 0;
    state.lineCache = [];
    this.setStatus(state, "loading");
    this.scheduleUpdateState(state);
  }
  setElementBoundsX(state) {
    const { x, contain, width } = state.props;
    const { elementBounds } = state;
    elementBounds.x1 = x;
    elementBounds.x2 = contain !== "none" ? x + width : Infinity;
  }
  setElementBoundsY(state) {
    const { y, contain, height } = state.props;
    const { elementBounds } = state;
    elementBounds.y1 = y;
    elementBounds.y2 = contain === "both" ? y + height : Infinity;
  }
}
function isZeroWidthSpace(space) {
  return space === "" || space === "​";
}
function getWebFontMetrics(context, fontFace, fontSize) {
  if (fontFace.metrics) {
    return fontFace.metrics;
  }
  const browserMetrics = context.measureText("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz");
  console.warn("Font metrics not provided for Canvas Web font ".concat(fontFace.fontFamily, ". ") + "Using fallback values. It is HIGHLY recommended you use the latest version of the Lightning 3 `msdf-generator` tool to extract the default metrics for the font and provide them in the Canvas Web font definition.");
  let metrics;
  if (browserMetrics.actualBoundingBoxDescent && browserMetrics.actualBoundingBoxAscent) {
    metrics = {
      ascender: browserMetrics.actualBoundingBoxAscent / fontSize,
      descender: -browserMetrics.actualBoundingBoxDescent / fontSize,
      lineGap: 0.2
    };
  } else {
    metrics = {
      ascender: 0.8,
      descender: -0.2,
      lineGap: 0.2
    };
  }
  fontFace.metrics = metrics;
  return metrics;
}
const MAX_TEXTURE_DIMENSION = 2048;
function calcHeight(textBaseline, fontSize, lineHeight, numLines, offsetY) {
  const baselineOffset = textBaseline !== "bottom" ? 0.5 * fontSize : 0;
  return lineHeight * (numLines - 1) + baselineOffset + Math.max(lineHeight, fontSize) + (offsetY || 0);
}
class LightningTextTextureRenderer {
  constructor(canvas, context) {
    __publicField(this, "_canvas");
    __publicField(this, "_context");
    __publicField(this, "_settings");
    this._canvas = canvas;
    this._context = context;
    this._settings = this.mergeDefaults({});
  }
  set settings(v) {
    this._settings = this.mergeDefaults(v);
  }
  get settings() {
    return this._settings;
  }
  getPrecision() {
    return this._settings.precision;
  }
  setFontProperties() {
    this._context.font = this._getFontSetting();
    this._context.textBaseline = this._settings.textBaseline;
  }
  _getFontSetting() {
    const ff = [this._settings.fontFamily];
    const ffs = [];
    for (let i = 0, n = ff.length; i < n; i++) {
      if (ff[i] === "serif" || ff[i] === "sans-serif") {
        ffs.push(ff[i]);
      } else {
        ffs.push('"'.concat(ff[i], '"'));
      }
    }
    return "".concat(this._settings.fontStyle, " ").concat(this._settings.fontSize * this.getPrecision(), "px ").concat(ffs.join(","));
  }
  _load() {
    if (document.fonts) {
      const fontSetting = this._getFontSetting();
      try {
        if (!document.fonts.check(fontSetting, this._settings.text)) {
          return document.fonts.load(fontSetting, this._settings.text).catch((err) => {
            console.warn("[Lightning] Font load error", err, fontSetting);
          }).then(() => {
            if (!document.fonts.check(fontSetting, this._settings.text)) {
              console.warn("[Lightning] Font not found", fontSetting);
            }
          });
        }
      } catch (e) {
        console.warn("[Lightning] Can't check font loading for " + fontSetting);
      }
    }
  }
  calculateRenderInfo() {
    const renderInfo = {};
    const precision = this.getPrecision();
    const paddingLeft = this._settings.paddingLeft * precision;
    const paddingRight = this._settings.paddingRight * precision;
    const fontSize = this._settings.fontSize * precision;
    let offsetY = this._settings.offsetY === null ? null : this._settings.offsetY * precision;
    const w = this._settings.w * precision;
    const h = this._settings.h * precision;
    let wordWrapWidth = this._settings.wordWrapWidth * precision;
    const cutSx = this._settings.cutSx * precision;
    const cutEx = this._settings.cutEx * precision;
    const cutSy = this._settings.cutSy * precision;
    const cutEy = this._settings.cutEy * precision;
    const letterSpacing = (this._settings.letterSpacing || 0) * precision;
    const textIndent = this._settings.textIndent * precision;
    const trFontFace = this._settings.trFontFace;
    this.setFontProperties();
    assertTruthy(trFontFace);
    const metrics = getWebFontMetrics(this._context, trFontFace, fontSize);
    const defLineHeight = calcDefaultLineHeight(metrics, fontSize) * precision;
    const lineHeight = this._settings.lineHeight !== null ? this._settings.lineHeight * precision : defLineHeight;
    const maxHeight = this._settings.maxHeight;
    const containedMaxLines = maxHeight !== null && lineHeight > 0 ? Math.floor(maxHeight / lineHeight) : 0;
    const setMaxLines = this._settings.maxLines;
    const calcMaxLines = containedMaxLines > 0 && setMaxLines > 0 ? Math.min(containedMaxLines, setMaxLines) : Math.max(containedMaxLines, setMaxLines);
    let width = w || 2048 / this.getPrecision();
    let innerWidth = width - paddingLeft;
    if (innerWidth < 10) {
      width += 10 - innerWidth;
      innerWidth = 10;
    }
    if (!wordWrapWidth) {
      wordWrapWidth = innerWidth;
    }
    if (this._settings.textOverflow && !this._settings.wordWrap) {
      let suffix;
      switch (this._settings.textOverflow) {
        case "clip":
          suffix = "";
          break;
        case "ellipsis":
          suffix = this._settings.overflowSuffix;
          break;
        default:
          suffix = this._settings.textOverflow;
      }
      this._settings.text = this.wrapWord(this._settings.text, wordWrapWidth - textIndent, suffix);
    }
    let linesInfo;
    if (this._settings.wordWrap) {
      linesInfo = this.wrapText(this._settings.text, wordWrapWidth, letterSpacing, textIndent);
    } else {
      linesInfo = { l: this._settings.text.split(/(?:\r\n|\r|\n)/), n: [] };
      const n = linesInfo.l.length;
      for (let i = 0; i < n - 1; i++) {
        linesInfo.n.push(i);
      }
    }
    let lines = linesInfo.l;
    if (calcMaxLines && lines.length > calcMaxLines) {
      const usedLines = lines.slice(0, calcMaxLines);
      let otherLines = null;
      if (this._settings.overflowSuffix) {
        const w2 = this._settings.overflowSuffix ? this.measureText(this._settings.overflowSuffix) : 0;
        const al = this.wrapText(usedLines[usedLines.length - 1], wordWrapWidth - w2, letterSpacing, textIndent);
        usedLines[usedLines.length - 1] = "".concat(al.l[0]).concat(this._settings.overflowSuffix);
        otherLines = [al.l.length > 1 ? al.l[1] : ""];
      } else {
        otherLines = [""];
      }
      let i;
      const n = lines.length;
      let j = 0;
      const m = linesInfo.n.length;
      for (i = calcMaxLines; i < n; i++) {
        otherLines[j] += "".concat(otherLines[j] ? " " : "").concat(lines[i]);
        if (i + 1 < m && linesInfo.n[i + 1]) {
          j++;
        }
      }
      renderInfo.remainingText = otherLines.join("\n");
      renderInfo.moreTextLines = true;
      lines = usedLines;
    } else {
      renderInfo.moreTextLines = false;
      renderInfo.remainingText = "";
    }
    let maxLineWidth = 0;
    const lineWidths = [];
    for (let i = 0; i < lines.length; i++) {
      const lineWidth = this.measureText(lines[i], letterSpacing) + (i === 0 ? textIndent : 0);
      lineWidths.push(lineWidth);
      maxLineWidth = Math.max(maxLineWidth, lineWidth);
    }
    renderInfo.lineWidths = lineWidths;
    if (!w) {
      width = maxLineWidth + paddingLeft + paddingRight;
      innerWidth = maxLineWidth;
    }
    if (this._settings.wordWrap && w > maxLineWidth && this._settings.textAlign === "left" && lines.length === 1) {
      width = maxLineWidth + paddingLeft + paddingRight;
    }
    let height;
    if (h) {
      height = h;
    } else {
      height = calcHeight(this._settings.textBaseline, fontSize, lineHeight, lines.length, offsetY);
    }
    if (offsetY === null) {
      offsetY = fontSize;
    }
    renderInfo.w = width;
    renderInfo.h = height;
    renderInfo.lines = lines;
    renderInfo.precision = precision;
    if (!width) {
      width = 1;
    }
    if (!height) {
      height = 1;
    }
    if (cutSx || cutEx) {
      width = Math.min(width, cutEx - cutSx);
    }
    if (cutSy || cutEy) {
      height = Math.min(height, cutEy - cutSy);
    }
    renderInfo.width = width;
    renderInfo.innerWidth = innerWidth;
    renderInfo.height = height;
    renderInfo.fontSize = fontSize;
    renderInfo.cutSx = cutSx;
    renderInfo.cutSy = cutSy;
    renderInfo.cutEx = cutEx;
    renderInfo.cutEy = cutEy;
    renderInfo.lineHeight = lineHeight;
    renderInfo.defLineHeight = defLineHeight;
    renderInfo.lineWidths = lineWidths;
    renderInfo.offsetY = offsetY;
    renderInfo.paddingLeft = paddingLeft;
    renderInfo.paddingRight = paddingRight;
    renderInfo.letterSpacing = letterSpacing;
    renderInfo.textIndent = textIndent;
    renderInfo.metrics = metrics;
    return renderInfo;
  }
  draw(renderInfo, linesOverride) {
    const precision = this.getPrecision();
    const lines = (linesOverride == null ? void 0 : linesOverride.lines) || renderInfo.lines;
    const lineWidths = (linesOverride == null ? void 0 : linesOverride.lineWidths) || renderInfo.lineWidths;
    const height = linesOverride ? calcHeight(this._settings.textBaseline, renderInfo.fontSize, renderInfo.lineHeight, linesOverride.lines.length, this._settings.offsetY === null ? null : this._settings.offsetY * precision) : renderInfo.height;
    this._canvas.width = Math.min(Math.ceil(renderInfo.width + this._settings.textRenderIssueMargin), MAX_TEXTURE_DIMENSION);
    this._canvas.height = Math.min(Math.ceil(height), MAX_TEXTURE_DIMENSION);
    this.setFontProperties();
    if (renderInfo.fontSize >= 128) {
      this._context.globalAlpha = 0.01;
      this._context.fillRect(0, 0, 0.01, 0.01);
      this._context.globalAlpha = 1;
    }
    if (renderInfo.cutSx || renderInfo.cutSy) {
      this._context.translate(-renderInfo.cutSx, -renderInfo.cutSy);
    }
    let linePositionX;
    let linePositionY;
    const drawLines = [];
    const { metrics } = renderInfo;
    const ascenderPx = metrics ? metrics.ascender * renderInfo.fontSize : renderInfo.fontSize;
    const bareLineHeightPx = (metrics.ascender - metrics.descender) * renderInfo.fontSize;
    for (let i = 0, n = lines.length; i < n; i++) {
      linePositionX = i === 0 ? renderInfo.textIndent : 0;
      linePositionY = i * renderInfo.lineHeight + ascenderPx;
      if (this._settings.verticalAlign == "middle") {
        linePositionY += (renderInfo.lineHeight - bareLineHeightPx) / 2;
      } else if (this._settings.verticalAlign == "bottom") {
        linePositionY += renderInfo.lineHeight - bareLineHeightPx;
      }
      if (this._settings.textAlign === "right") {
        linePositionX += renderInfo.innerWidth - lineWidths[i];
      } else if (this._settings.textAlign === "center") {
        linePositionX += (renderInfo.innerWidth - lineWidths[i]) / 2;
      }
      linePositionX += renderInfo.paddingLeft;
      drawLines.push({
        text: lines[i],
        x: linePositionX,
        y: linePositionY,
        w: lineWidths[i]
      });
    }
    if (this._settings.highlight) {
      const color = this._settings.highlightColor;
      const hlHeight = this._settings.highlightHeight * precision || renderInfo.fontSize * 1.5;
      const offset = this._settings.highlightOffset * precision;
      const hlPaddingLeft = this._settings.highlightPaddingLeft !== null ? this._settings.highlightPaddingLeft * precision : renderInfo.paddingLeft;
      const hlPaddingRight = this._settings.highlightPaddingRight !== null ? this._settings.highlightPaddingRight * precision : renderInfo.paddingRight;
      this._context.fillStyle = getRgbaString(color);
      for (let i = 0; i < drawLines.length; i++) {
        const drawLine = drawLines[i];
        this._context.fillRect(drawLine.x - hlPaddingLeft, drawLine.y - renderInfo.offsetY + offset, drawLine.w + hlPaddingRight + hlPaddingLeft, hlHeight);
      }
    }
    let prevShadowSettings = null;
    if (this._settings.shadow) {
      prevShadowSettings = [
        this._context.shadowColor,
        this._context.shadowOffsetX,
        this._context.shadowOffsetY,
        this._context.shadowBlur
      ];
      this._context.shadowColor = getRgbaString(this._settings.shadowColor);
      this._context.shadowOffsetX = this._settings.shadowOffsetX * precision;
      this._context.shadowOffsetY = this._settings.shadowOffsetY * precision;
      this._context.shadowBlur = this._settings.shadowBlur * precision;
    }
    this._context.fillStyle = getRgbaString(this._settings.textColor);
    for (let i = 0, n = drawLines.length; i < n; i++) {
      const drawLine = drawLines[i];
      if (renderInfo.letterSpacing === 0) {
        this._context.fillText(drawLine.text, drawLine.x, drawLine.y);
      } else {
        const textSplit = drawLine.text.split("");
        let x = drawLine.x;
        for (let i2 = 0, j = textSplit.length; i2 < j; i2++) {
          this._context.fillText(textSplit[i2], x, drawLine.y);
          x += this.measureText(textSplit[i2], renderInfo.letterSpacing);
        }
      }
    }
    if (prevShadowSettings) {
      this._context.shadowColor = prevShadowSettings[0];
      this._context.shadowOffsetX = prevShadowSettings[1];
      this._context.shadowOffsetY = prevShadowSettings[2];
      this._context.shadowBlur = prevShadowSettings[3];
    }
    if (renderInfo.cutSx || renderInfo.cutSy) {
      this._context.translate(renderInfo.cutSx, renderInfo.cutSy);
    }
  }
  wrapWord(word, wordWrapWidth, suffix) {
    const suffixWidth = this._context.measureText(suffix).width;
    const wordLen = word.length;
    const wordWidth = this._context.measureText(word).width;
    if (wordWidth <= wordWrapWidth) {
      return word;
    }
    let cutoffIndex = Math.floor(wordWrapWidth * wordLen / wordWidth);
    let truncWordWidth = this._context.measureText(word.substring(0, cutoffIndex)).width + suffixWidth;
    if (truncWordWidth > wordWrapWidth) {
      while (cutoffIndex > 0) {
        truncWordWidth = this._context.measureText(word.substring(0, cutoffIndex)).width + suffixWidth;
        if (truncWordWidth > wordWrapWidth) {
          cutoffIndex -= 1;
        } else {
          break;
        }
      }
    } else {
      while (cutoffIndex < wordLen) {
        truncWordWidth = this._context.measureText(word.substring(0, cutoffIndex)).width + suffixWidth;
        if (truncWordWidth < wordWrapWidth) {
          cutoffIndex += 1;
        } else {
          cutoffIndex -= 1;
          break;
        }
      }
    }
    return word.substring(0, cutoffIndex) + (wordWrapWidth >= suffixWidth ? suffix : "");
  }
  /**
   * Applies newlines to a string to have it optimally fit into the horizontal
   * bounds set by the Text object's wordWrapWidth property.
   */
  wrapText(text, wordWrapWidth, letterSpacing, indent = 0) {
    const spaceRegex = / |\u200B/g;
    const lines = text.split(/\r?\n/g);
    let allLines = [];
    const realNewlines = [];
    for (let i = 0; i < lines.length; i++) {
      const resultLines = [];
      let result = "";
      let spaceLeft = wordWrapWidth - indent;
      const words = lines[i].split(spaceRegex);
      const spaces = lines[i].match(spaceRegex) || [];
      for (let j = 0; j < words.length; j++) {
        const space = spaces[j - 1] || "";
        const word = words[j];
        const wordWidth = this.measureText(word, letterSpacing);
        const wordWidthWithSpace = isZeroWidthSpace(space) ? wordWidth : wordWidth + this.measureText(space, letterSpacing);
        if (j === 0 || wordWidthWithSpace > spaceLeft) {
          if (j > 0) {
            resultLines.push(result);
            result = "";
          }
          result += word;
          spaceLeft = wordWrapWidth - wordWidth - (j === 0 ? indent : 0);
        } else {
          spaceLeft -= wordWidthWithSpace;
          result += space + word;
        }
      }
      resultLines.push(result);
      result = "";
      allLines = allLines.concat(resultLines);
      if (i < lines.length - 1) {
        realNewlines.push(allLines.length);
      }
    }
    return { l: allLines, n: realNewlines };
  }
  measureText(word, space = 0) {
    if (!space) {
      return this._context.measureText(word).width;
    }
    return word.split("").reduce((acc, char) => {
      if (isZeroWidthSpace(char)) {
        return acc;
      }
      return acc + this._context.measureText(char).width + space;
    }, 0);
  }
  mergeDefaults(settings) {
    return {
      text: "",
      w: 0,
      h: 0,
      fontStyle: "normal",
      fontSize: 40,
      fontFamily: null,
      trFontFace: null,
      wordWrap: true,
      wordWrapWidth: 0,
      wordBreak: false,
      textOverflow: "",
      lineHeight: null,
      textBaseline: "alphabetic",
      textAlign: "left",
      verticalAlign: "top",
      offsetY: null,
      maxLines: 0,
      maxHeight: null,
      overflowSuffix: "...",
      textColor: [1, 1, 1, 1],
      paddingLeft: 0,
      paddingRight: 0,
      shadow: false,
      shadowColor: [0, 0, 0, 1],
      shadowOffsetX: 0,
      shadowOffsetY: 0,
      shadowBlur: 5,
      highlight: false,
      highlightHeight: 0,
      highlightColor: [0, 0, 0, 1],
      highlightOffset: 0,
      highlightPaddingLeft: 0,
      highlightPaddingRight: 0,
      letterSpacing: 0,
      textIndent: 0,
      cutSx: 0,
      cutEx: 0,
      cutSy: 0,
      cutEy: 0,
      advancedRenderer: false,
      fontBaselineRatio: 0,
      precision: 1,
      textRenderIssueMargin: 0,
      ...settings
    };
  }
}
const resolvedGlobal = typeof self === "undefined" ? globalThis : self;
const globalFontSet = ((_a = resolvedGlobal.document) == null ? void 0 : _a.fonts) || resolvedGlobal.fonts;
function getFontCssString(props) {
  const { fontFamily, fontStyle, fontWeight, fontStretch, fontSize } = props;
  return [fontStyle, fontWeight, fontStretch, "".concat(fontSize, "px"), fontFamily].join(" ");
}
class CanvasTextRenderer extends TextRenderer {
  constructor(stage) {
    super(stage);
    __publicField(this, "canvas");
    __publicField(this, "context");
    /**
     * Font family map used to store web font faces that were added to the
     * canvas text renderer.
     */
    __publicField(this, "fontFamilies", {});
    __publicField(this, "fontFamilyArray", [this.fontFamilies]);
    __publicField(this, "type", "canvas");
    __publicField(this, "loadFont", (state) => {
      const cssString = getFontCssString(state.props);
      const trFontFace = this.stage.fontManager.resolveFontFace(this.fontFamilyArray, state.props, "canvas");
      assertTruthy(trFontFace, "Could not resolve font face for ".concat(cssString));
      state.fontInfo = {
        fontFace: trFontFace,
        cssString,
        // TODO: For efficiency we would use this here but it's not reliable on WPE -> document.fonts.check(cssString),
        loaded: false
      };
      if (!state.fontInfo.loaded) {
        globalFontSet.load(cssString).then(this.onFontLoaded.bind(this, state, cssString)).catch(this.onFontLoadError.bind(this, state, cssString));
        return;
      }
    });
    if (typeof OffscreenCanvas !== "undefined") {
      this.canvas = new OffscreenCanvas(0, 0);
    } else {
      this.canvas = document.createElement("canvas");
    }
    let context = this.canvas.getContext("2d", {
      willReadFrequently: true
    });
    if (!context) {
      this.canvas = document.createElement("canvas");
      context = this.canvas.getContext("2d", {
        willReadFrequently: true
      });
    }
    assertTruthy(context);
    this.context = context;
    this.addFontFace(new WebTrFontFace({
      fontFamily: "sans-serif",
      descriptors: {},
      fontUrl: ""
    }));
  }
  //#region Overrides
  getPropertySetters() {
    return {
      fontFamily: (state, value) => {
        state.props.fontFamily = value;
        state.fontInfo = void 0;
        this.invalidateLayoutCache(state);
      },
      fontWeight: (state, value) => {
        state.props.fontWeight = value;
        state.fontInfo = void 0;
        this.invalidateLayoutCache(state);
      },
      fontStyle: (state, value) => {
        state.props.fontStyle = value;
        state.fontInfo = void 0;
        this.invalidateLayoutCache(state);
      },
      fontStretch: (state, value) => {
        state.props.fontStretch = value;
        state.fontInfo = void 0;
        this.invalidateLayoutCache(state);
      },
      fontSize: (state, value) => {
        state.props.fontSize = value;
        state.fontInfo = void 0;
        this.invalidateLayoutCache(state);
      },
      text: (state, value) => {
        state.props.text = value;
        this.invalidateLayoutCache(state);
      },
      textAlign: (state, value) => {
        state.props.textAlign = value;
        this.invalidateLayoutCache(state);
      },
      color: (state, value) => {
        state.props.color = value;
        this.invalidateLayoutCache(state);
      },
      x: (state, value) => {
        state.props.x = value;
      },
      y: (state, value) => {
        state.props.y = value;
      },
      contain: (state, value) => {
        state.props.contain = value;
        this.invalidateLayoutCache(state);
      },
      width: (state, value) => {
        state.props.width = value;
        if (state.props.contain !== "none") {
          this.invalidateLayoutCache(state);
        }
      },
      height: (state, value) => {
        state.props.height = value;
        if (state.props.contain === "both") {
          this.invalidateLayoutCache(state);
        }
      },
      offsetY: (state, value) => {
        state.props.offsetY = value;
        this.invalidateLayoutCache(state);
      },
      scrollY: (state, value) => {
        state.props.scrollY = value;
      },
      letterSpacing: (state, value) => {
        state.props.letterSpacing = value;
        this.invalidateLayoutCache(state);
      },
      lineHeight: (state, value) => {
        state.props.lineHeight = value;
        this.invalidateLayoutCache(state);
      },
      maxLines: (state, value) => {
        state.props.maxLines = value;
        this.invalidateLayoutCache(state);
      },
      textBaseline: (state, value) => {
        state.props.textBaseline = value;
        this.invalidateLayoutCache(state);
      },
      verticalAlign: (state, value) => {
        state.props.verticalAlign = value;
        this.invalidateLayoutCache(state);
      },
      overflowSuffix: (state, value) => {
        state.props.overflowSuffix = value;
        this.invalidateLayoutCache(state);
      }
    };
  }
  // eslint-disable-next-line @typescript-eslint/no-unused-vars
  canRenderFont(props) {
    return true;
  }
  isFontFaceSupported(fontFace) {
    return fontFace instanceof WebTrFontFace;
  }
  addFontFace(fontFace) {
    assertTruthy(fontFace instanceof WebTrFontFace);
    const fontFamily = fontFace.fontFamily;
    if (fontFamily !== "sans-serif") {
      globalFontSet.add(fontFace.fontFace);
    }
    let faceSet = this.fontFamilies[fontFamily];
    if (!faceSet) {
      faceSet = /* @__PURE__ */ new Set();
      this.fontFamilies[fontFamily] = faceSet;
    }
    faceSet.add(fontFace);
  }
  createState(props, node) {
    return {
      node,
      props,
      status: "initialState",
      updateScheduled: false,
      emitter: new EventEmitter(),
      textureNode: void 0,
      lightning2TextRenderer: new LightningTextTextureRenderer(this.canvas, this.context),
      renderInfo: void 0,
      forceFullLayoutCalc: false,
      textW: 0,
      textH: 0,
      fontInfo: void 0,
      isRenderable: false,
      debugData: {
        updateCount: 0,
        layoutCount: 0,
        drawCount: 0,
        lastLayoutNumCharacters: 0,
        layoutSum: 0,
        drawSum: 0,
        bufferSize: 0
      }
    };
  }
  updateState(state) {
    if (state.status === "initialState") {
      this.setStatus(state, "loading");
    }
    if (state.status === "loaded") {
      return;
    }
    if (!state.fontInfo) {
      return this.loadFont(state);
    }
    if (!state.fontInfo.loaded) {
      return;
    }
    if (!state.renderInfo) {
      state.renderInfo = this.calculateRenderInfo(state);
      state.textH = state.renderInfo.lineHeight * state.renderInfo.lines.length;
      state.textW = state.renderInfo.width;
      this.renderSingleCanvasPage(state);
    }
  }
  renderSingleCanvasPage(state) {
    assertTruthy(state.renderInfo);
    const node = state.node;
    const texture = this.stage.txManager.createTexture("ImageTexture", {
      premultiplyAlpha: true,
      src: (function(lightning2TextRenderer, renderInfo) {
        assertTruthy(renderInfo);
        lightning2TextRenderer.draw(renderInfo, {
          lines: renderInfo.lines,
          lineWidths: renderInfo.lineWidths
        });
        if (this.canvas.width === 0 || this.canvas.height === 0) {
          return null;
        }
        return this.context.getImageData(0, 0, this.canvas.width, this.canvas.height);
      }).bind(this, state.lightning2TextRenderer, state.renderInfo)
    });
    if (state.textureNode) {
      state.textureNode.texture = texture;
      state.textureNode.alpha = getNormalizedAlphaComponent(state.props.color);
    } else {
      const textureNode = this.stage.createNode({
        parent: node,
        texture,
        autosize: true,
        // The alpha channel of the color is ignored when rasterizing the text
        // texture so we need to pass it directly to the texture node.
        alpha: getNormalizedAlphaComponent(state.props.color)
      });
      state.textureNode = textureNode;
    }
    this.setStatus(state, "loaded");
  }
  calculateRenderInfo(state) {
    var _a2, _b;
    state.lightning2TextRenderer.settings = {
      text: state.props.text,
      textAlign: state.props.textAlign,
      fontFamily: state.props.fontFamily,
      trFontFace: (_a2 = state.fontInfo) == null ? void 0 : _a2.fontFace,
      fontSize: state.props.fontSize,
      fontStyle: [
        state.props.fontStretch,
        state.props.fontStyle,
        state.props.fontWeight
      ].join(" "),
      textColor: getNormalizedRgbaComponents(state.props.color),
      offsetY: state.props.offsetY,
      wordWrap: state.props.contain !== "none",
      wordWrapWidth: state.props.contain === "none" ? void 0 : state.props.width,
      letterSpacing: state.props.letterSpacing,
      lineHeight: (_b = state.props.lineHeight) != null ? _b : null,
      maxLines: state.props.maxLines,
      maxHeight: state.props.contain === "both" ? state.props.height - state.props.offsetY : null,
      textBaseline: state.props.textBaseline,
      verticalAlign: state.props.verticalAlign,
      overflowSuffix: state.props.overflowSuffix,
      w: state.props.contain !== "none" ? state.props.width : void 0
    };
    state.renderInfo = state.lightning2TextRenderer.calculateRenderInfo();
    return state.renderInfo;
  }
  renderQuads() {
    return;
  }
  destroyState(state) {
    if (state.status === "destroyed") {
      return;
    }
    super.destroyState(state);
    if (state.textureNode) {
      state.textureNode.destroy();
      delete state.textureNode;
    }
    delete state.renderInfo;
  }
  //#endregion Overrides
  /**
   * Invalidate the layout cache stored in the state. This will cause the text
   * to be re-rendered on the next update.
   *
   * @remarks
   * This also invalidates the visible window cache.
   *
   * @param state
   */
  invalidateLayoutCache(state) {
    state.renderInfo = void 0;
    this.setStatus(state, "loading");
    this.scheduleUpdateState(state);
  }
  onFontLoaded(state, cssString) {
    var _a2;
    if (cssString !== ((_a2 = state.fontInfo) == null ? void 0 : _a2.cssString) || !state.fontInfo) {
      return;
    }
    state.fontInfo.loaded = true;
    this.scheduleUpdateState(state);
  }
  onFontLoadError(state, cssString, error) {
    var _a2;
    if (cssString !== ((_a2 = state.fontInfo) == null ? void 0 : _a2.cssString) || !state.fontInfo) {
      return;
    }
    state.fontInfo.loaded = true;
    console.error("CanvasTextRenderer: Error loading font '".concat(state.fontInfo.cssString, "'"), error);
    this.scheduleUpdateState(state);
  }
}
const WHITE = {
  isWhite: true,
  a: 1,
  r: 255,
  g: 255,
  b: 255
};
function parseColor(abgr) {
  if (abgr === 4294967295) {
    return WHITE;
  }
  const a = (abgr >>> 24 & 255) / 255;
  const b = abgr >>> 16 & 255 & 255;
  const g = abgr >>> 8 & 255 & 255;
  const r = abgr & 255 & 255;
  return { isWhite: false, a, r, g, b };
}
function parseColorRgba(rgba) {
  if (rgba === 4294967295) {
    return WHITE;
  }
  const r = rgba >>> 24 & 255;
  const g = rgba >>> 16 & 255 & 255;
  const b = rgba >>> 8 & 255 & 255;
  const a = (rgba & 255 & 255) / 255;
  return { isWhite: false, r, g, b, a };
}
function formatRgba({ a, r, g, b }) {
  return "rgba(".concat(r, ",").concat(g, ",").concat(b, ",").concat(a, ")");
}
class CanvasCoreTexture extends CoreContextTexture {
  constructor() {
    super(...arguments);
    __publicField(this, "image");
    __publicField(this, "tintCache");
  }
  async load() {
    this.textureSource.setState("loading");
    try {
      const size = await this.onLoadRequest();
      this.textureSource.setState("loaded", size);
      this.textureSource.freeTextureData();
      this.updateMemSize();
    } catch (err) {
      this.textureSource.setState("failed", err);
      this.textureSource.freeTextureData();
      throw err;
    }
  }
  free() {
    this.image = void 0;
    this.tintCache = void 0;
    this.textureSource.setState("freed");
    this.setTextureMemUse(0);
    this.textureSource.freeTextureData();
  }
  updateMemSize() {
    const mult = this.tintCache ? 8 : 4;
    if (this.textureSource.dimensions) {
      const { width, height } = this.textureSource.dimensions;
      this.setTextureMemUse(width * height * mult);
    }
  }
  hasImage() {
    return this.image !== void 0;
  }
  getImage(color) {
    var _a2;
    const image = this.image;
    assertTruthy(image, "Attempt to get unloaded image texture");
    if (color.isWhite) {
      if (this.tintCache) {
        this.tintCache = void 0;
        this.updateMemSize();
      }
      return image;
    }
    const key = formatRgba(color);
    if (((_a2 = this.tintCache) == null ? void 0 : _a2.key) === key) {
      return this.tintCache.image;
    }
    const tintedImage = this.tintTexture(image, key);
    this.tintCache = {
      key,
      image: tintedImage
    };
    this.updateMemSize();
    return tintedImage;
  }
  tintTexture(source, color) {
    const { width, height } = source;
    const canvas = document.createElement("canvas");
    canvas.width = width;
    canvas.height = height;
    const ctx = canvas.getContext("2d");
    if (ctx) {
      ctx.fillStyle = color;
      ctx.globalCompositeOperation = "copy";
      ctx.fillRect(0, 0, width, height);
      ctx.globalCompositeOperation = "multiply";
      ctx.drawImage(source, 0, 0, width, height, 0, 0, width, height);
      ctx.globalCompositeOperation = "destination-in";
      ctx.drawImage(source, 0, 0, width, height, 0, 0, width, height);
    }
    return canvas;
  }
  async onLoadRequest() {
    var _a2, _b;
    assertTruthy((_b = (_a2 = this.textureSource) == null ? void 0 : _a2.textureData) == null ? void 0 : _b.data, "Texture data is null");
    const { data } = this.textureSource.textureData;
    if (data instanceof ImageData) {
      const canvas = document.createElement("canvas");
      canvas.width = data.width;
      canvas.height = data.height;
      const ctx = canvas.getContext("2d");
      if (ctx)
        ctx.putImageData(data, 0, 0);
      this.image = canvas;
      return { width: data.width, height: data.height };
    } else if (typeof ImageBitmap !== "undefined" && data instanceof ImageBitmap || data instanceof HTMLImageElement) {
      this.image = data;
      return { width: data.width, height: data.height };
    }
    return { width: 0, height: 0 };
  }
}
function getRadius(quad) {
  var _a2, _b, _c;
  if (quad.shader instanceof UnsupportedShader) {
    const shType = quad.shader.shType;
    if (shType === ROUNDED_RECTANGLE_SHADER_TYPE) {
      return (_b = (_a2 = quad.shaderProps) == null ? void 0 : _a2.radius) != null ? _b : 0;
    } else if (shType === "DynamicShader") {
      const effects = (_c = quad.shaderProps) == null ? void 0 : _c.effects;
      if (effects) {
        const effect2 = effects.find((effect3) => {
          var _a3;
          return effect3.type === "radius" && ((_a3 = effect3 == null ? void 0 : effect3.props) == null ? void 0 : _a3.radius);
        });
        return effect2 && effect2.type === "radius" && effect2.props.radius || 0;
      }
    }
  }
  return 0;
}
function getBorder(quad, direction = "") {
  var _a2;
  if (quad.shader instanceof UnsupportedShader) {
    const shType = quad.shader.shType;
    if (shType === "DynamicShader") {
      const effects = (_a2 = quad.shaderProps) == null ? void 0 : _a2.effects;
      if (effects && effects.length) {
        const effect2 = effects.find((effect3) => {
          return effect3.type === "border".concat(direction) && effect3.props && effect3.props.width;
        });
        return effect2 && effect2.props;
      }
    }
  }
  return void 0;
}
function roundRect(x, y, width, height, radius) {
  const context = Object.getPrototypeOf(this);
  if (!context.roundRect) {
    const fixOverlappingCorners = (radii2) => {
      const maxRadius = Math.min(width / 2, height / 2);
      const totalHorizontal = radii2.topLeft + radii2.topRight + radii2.bottomRight + radii2.bottomLeft;
      if (totalHorizontal > width || totalHorizontal > height) {
        const scale = maxRadius / Math.max(radii2.topLeft, radii2.topRight, radii2.bottomRight, radii2.bottomLeft);
        radii2.topLeft *= scale;
        radii2.topRight *= scale;
        radii2.bottomRight *= scale;
        radii2.bottomLeft *= scale;
      }
    };
    const radii = typeof radius === "number" ? {
      topLeft: radius,
      topRight: radius,
      bottomRight: radius,
      bottomLeft: radius
    } : { topLeft: 0, topRight: 0, bottomRight: 0, bottomLeft: 0, ...radius };
    fixOverlappingCorners(radii);
    this.moveTo(x + radii.topLeft, y);
    this.lineTo(x + width - radii.topRight, y);
    this.ellipse(x + width - radii.topRight, y + radii.topRight, radii.topRight, radii.topRight, 0, 1.5 * Math.PI, 2 * Math.PI);
    this.lineTo(x + width, y + height - radii.bottomRight);
    this.ellipse(x + width - radii.bottomRight, y + height - radii.bottomRight, radii.bottomRight, radii.bottomRight, 0, 0, 0.5 * Math.PI);
    this.lineTo(x + radii.bottomLeft, y + height);
    this.ellipse(x + radii.bottomLeft, y + height - radii.bottomLeft, radii.bottomLeft, radii.bottomLeft, 0, 0.5 * Math.PI, Math.PI);
    this.lineTo(x, y + radii.topLeft);
    this.ellipse(x + radii.topLeft, y + radii.topLeft, radii.topLeft, radii.topLeft, 0, Math.PI, 1.5 * Math.PI);
  } else {
    this.roundRect(x, y, width, height, radius);
  }
}
function strokeLine(ctx, x, y, width, height, lineWidth = 0, color, direction) {
  if (!lineWidth) {
    return;
  }
  let sx, sy = 0;
  let ex, ey = 0;
  switch (direction) {
    case "Top":
      sx = x;
      sy = y;
      ex = width + x;
      ey = y;
      break;
    case "Right":
      sx = x + width;
      sy = y;
      ex = x + width;
      ey = y + height;
      break;
    case "Bottom":
      sx = x;
      sy = y + height;
      ex = x + width;
      ey = y + height;
      break;
    case "Left":
      sx = x;
      sy = y;
      ex = x;
      ey = y + height;
      break;
  }
  ctx.beginPath();
  ctx.lineWidth = lineWidth;
  ctx.strokeStyle = formatRgba(parseColorRgba(color != null ? color : 0));
  ctx.moveTo(sx, sy);
  ctx.lineTo(ex, ey);
  ctx.stroke();
}
class CanvasCoreRenderer extends CoreRenderer {
  constructor(options) {
    super(options);
    __publicField(this, "context");
    __publicField(this, "canvas");
    __publicField(this, "pixelRatio");
    __publicField(this, "clearColor");
    __publicField(this, "renderToTextureActive", false);
    __publicField(this, "activeRttNode", null);
    __publicField(this, "defShaderCtr");
    this.mode = "canvas";
    this.shManager.renderer = this;
    const { canvas, pixelRatio, clearColor } = options;
    this.canvas = canvas;
    this.context = canvas.getContext("2d");
    this.pixelRatio = pixelRatio;
    this.clearColor = clearColor ? getRgbaComponents(clearColor) : void 0;
    this.defShaderCtr = {
      type: "DefaultShader",
      props: {},
      shader: new UnsupportedShader("DefaultShader"),
      getResolvedProps: () => () => {
        return {};
      }
    };
  }
  reset() {
    this.canvas.width = this.canvas.width;
    const ctx = this.context;
    if (this.clearColor) {
      const [r, g, b, a] = this.clearColor;
      ctx.fillStyle = "rgba(".concat(r, ", ").concat(g, ", ").concat(b, ", ").concat(a / 255, ")");
      ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
    }
    ctx.scale(this.pixelRatio, this.pixelRatio);
  }
  render() {
  }
  addQuad(quad) {
    var _a2, _b;
    const ctx = this.context;
    const { tx, ty, width, height, alpha, colorTl, colorTr, colorBr, ta, tb, tc, td, clippingRect } = quad;
    let texture = quad.texture;
    let ctxTexture = void 0;
    let frame;
    const textureType = texture == null ? void 0 : texture.type;
    assertTruthy(textureType, "Texture type is not defined");
    if (textureType !== TextureType.image && textureType !== TextureType.color && textureType !== TextureType.subTexture && textureType !== TextureType.noise) {
      return;
    }
    if (texture) {
      if (texture instanceof SubTexture) {
        frame = texture.props;
        texture = texture.parentTexture;
      }
      ctxTexture = texture.ctxTexture;
      if (texture.state === "freed") {
        return;
      }
      if (texture.state !== "loaded") {
        return;
      }
    }
    const color = parseColor(colorTl);
    const hasTransform = ta !== 1;
    const hasClipping = clippingRect.width !== 0 && clippingRect.height !== 0;
    const hasGradient = colorTl !== colorTr || colorTl !== colorBr;
    const hasQuadShader = Boolean(quad.shader);
    const radius = hasQuadShader ? getRadius(quad) : 0;
    const border = hasQuadShader ? getBorder(quad) : void 0;
    if (hasTransform || hasClipping || radius) {
      ctx.save();
    }
    if (hasClipping) {
      const path = new Path2D();
      const { x, y, width: width2, height: height2 } = clippingRect;
      path.rect(x, y, width2, height2);
      ctx.clip(path);
    }
    if (hasTransform) {
      const scale = this.pixelRatio;
      ctx.setTransform(ta, tc, tb, td, tx * scale, ty * scale);
      ctx.scale(scale, scale);
      ctx.translate(-tx, -ty);
    }
    if (radius) {
      const path = new Path2D();
      roundRect.call(path, tx, ty, width, height, radius);
      ctx.clip(path);
    }
    if ((textureType === TextureType.image || textureType === TextureType.subTexture || textureType === TextureType.noise) && ctxTexture) {
      const image = ctxTexture.getImage(color);
      ctx.globalAlpha = (_a2 = color.a) != null ? _a2 : alpha;
      if (frame) {
        ctx.drawImage(image, frame.x, frame.y, frame.width, frame.height, tx, ty, width, height);
      } else {
        try {
          ctx.drawImage(image, tx, ty, width, height);
        } catch (error) {
        }
      }
      ctx.globalAlpha = 1;
    } else if (textureType === TextureType.color && hasGradient) {
      let endX = tx;
      let endY = ty;
      let endColor;
      if (colorTl === colorTr) {
        endX = tx;
        endY = ty + height;
        endColor = parseColor(colorBr);
      } else {
        endX = tx + width;
        endY = ty;
        endColor = parseColor(colorTr);
      }
      const gradient = ctx.createLinearGradient(tx, ty, endX, endY);
      gradient.addColorStop(0, formatRgba(color));
      gradient.addColorStop(1, formatRgba(endColor));
      ctx.fillStyle = gradient;
      ctx.fillRect(tx, ty, width, height);
    } else if (textureType === TextureType.color) {
      ctx.fillStyle = formatRgba(color);
      ctx.fillRect(tx, ty, width, height);
    }
    if (border && border.width) {
      const borderWidth = border.width;
      const borderInnerWidth = border.width / 2;
      const borderColor = formatRgba(parseColorRgba((_b = border.color) != null ? _b : 0));
      ctx.beginPath();
      ctx.lineWidth = borderWidth;
      ctx.strokeStyle = borderColor;
      ctx.globalAlpha = alpha;
      if (radius) {
        roundRect.call(ctx, tx + borderInnerWidth, ty + borderInnerWidth, width - borderWidth, height - borderWidth, radius);
        ctx.stroke();
      } else {
        ctx.strokeRect(tx + borderInnerWidth, ty + borderInnerWidth, width - borderWidth, height - borderWidth);
      }
      ctx.globalAlpha = 1;
    } else if (hasQuadShader) {
      const borderTop = getBorder(quad, "Top");
      const borderRight = getBorder(quad, "Right");
      const borderBottom = getBorder(quad, "Bottom");
      const borderLeft = getBorder(quad, "Left");
      if (borderTop) {
        strokeLine(ctx, tx, ty, width, height, borderTop.width, borderTop.color, "Top");
      }
      if (borderRight) {
        strokeLine(ctx, tx, ty, width, height, borderRight.width, borderRight.color, "Right");
      }
      if (borderBottom) {
        strokeLine(ctx, tx, ty, width, height, borderBottom.width, borderBottom.color, "Bottom");
      }
      if (borderLeft) {
        strokeLine(ctx, tx, ty, width, height, borderLeft.width, borderLeft.color, "Left");
      }
    }
    if (hasTransform || hasClipping || radius) {
      ctx.restore();
    }
  }
  createCtxTexture(textureSource) {
    return new CanvasCoreTexture(this.txMemManager, textureSource);
  }
  getShaderManager() {
    return this.shManager;
  }
  getDefShaderCtr() {
    return this.defShaderCtr;
  }
  renderRTTNodes() {
  }
  removeRTTNode(node) {
  }
  renderToTexture(node) {
  }
  getBufferInfo() {
    return null;
  }
  getQuadCount() {
    return null;
  }
  /**
   * Updates the clear color of the canvas renderer.
   *
   * @param color - The color to set as the clear color.
   */
  updateClearColor(color) {
    this.clearColor = color ? getRgbaComponents(color) : void 0;
  }
}
const [focusPath, setFocusPath] = createSignal([]);
const useFocusManager = (userKeyMap, keyHoldOptions) => {
  const owner = getOwner();
  const ownerContext = runWithOwner.bind(void 0, owner);
  Config.setActiveElement = (activeElm) => ownerContext(() => setActiveElement(activeElm));
  const { cleanup, focusPath: focusPathCore } = useFocusManager$1({
    userKeyMap,
    keyHoldOptions,
    ownerContext
  });
  createEffect(on(activeElement, () => {
    setFocusPath([...focusPathCore()]);
  }, { defer: true }));
  onCleanup(cleanup);
};
function flattenStrings(series = []) {
  const flattenedSeries = [];
  let i;
  for (i = 0; i < series.length; i++) {
    const s = series[i];
    if (typeof s === "string" && !s.includes("PAUSE-")) {
      flattenedSeries.push(series[i]);
    } else {
      break;
    }
  }
  return [flattenedSeries.join(",\b ")].concat(series.slice(i));
}
function delay(pause) {
  return new Promise((resolve) => {
    setTimeout(resolve, pause);
  });
}
function speak(phrase, utterances, lang = "en-US", voiceName) {
  const synth = window.speechSynthesis;
  return new Promise((resolve, reject) => {
    let selectedVoice;
    if (voiceName) {
      const availableVoices = synth.getVoices();
      selectedVoice = availableVoices.find((v) => v.name === voiceName) || availableVoices[0];
    }
    const utterance = new SpeechSynthesisUtterance(phrase);
    utterance.lang = lang;
    if (selectedVoice) {
      utterance.voice = selectedVoice;
    }
    utterance.onend = () => {
      resolve();
    };
    utterance.onerror = (e) => {
      reject(e);
    };
    utterances.push(utterance);
    synth.speak(utterance);
  });
}
function speakSeries(series, lang, voice, root = true) {
  const synth = window.speechSynthesis;
  const remainingPhrases = flattenStrings(Array.isArray(series) ? series : [series]);
  const nestedSeriesResults = [];
  const utterances = [];
  let active = true;
  const seriesChain = (async () => {
    try {
      while (active && remainingPhrases.length) {
        const phrase = await Promise.resolve(remainingPhrases.shift());
        if (!active) {
          break;
        }
        if (typeof phrase === "string" && phrase.includes("PAUSE-")) {
          const pause = Number(phrase.split("PAUSE-")[1]) * 1e3;
          if (!isNaN(pause)) {
            await delay(pause);
          }
        } else if (typeof phrase === "string") {
          if (!phrase) {
            continue;
          }
          const totalRetries = 3;
          let retriesLeft = totalRetries;
          while (active && retriesLeft > 0) {
            try {
              await speak(phrase, utterances, lang, voice);
              retriesLeft = 0;
            } catch (e) {
              if (e instanceof SpeechSynthesisErrorEvent) {
                if (e.error === "network") {
                  retriesLeft--;
                  console.warn("Speech synthesis network error. Retries left: ".concat(retriesLeft));
                  await delay(500 * (totalRetries - retriesLeft));
                } else if (e.error === "canceled" || e.error === "interrupted") {
                  retriesLeft = 0;
                } else {
                  throw new Error("SpeechSynthesisErrorEvent: ".concat(e.error));
                }
              } else {
                throw e;
              }
            }
          }
        } else if (phrase instanceof SpeechSynthesisUtterance) {
          const totalRetries = 3;
          let retriesLeft = totalRetries;
          const text = phrase.text;
          const objectLang = phrase == null ? void 0 : phrase.lang;
          const objectVoice = phrase == null ? void 0 : phrase.voice;
          while (active && retriesLeft > 0) {
            try {
              await speak(text, utterances, objectLang, objectVoice == null ? void 0 : objectVoice.name);
              retriesLeft = 0;
            } catch (e) {
              if (e instanceof SpeechSynthesisErrorEvent) {
                if (e.error === "network") {
                  retriesLeft--;
                  console.warn("Speech synthesis network error. Retries left: ".concat(retriesLeft));
                  await delay(500 * (totalRetries - retriesLeft));
                } else if (e.error === "canceled" || e.error === "interrupted") {
                  retriesLeft = 0;
                } else {
                  throw new Error("SpeechSynthesisErrorEvent: ".concat(e.error));
                }
              } else {
                throw e;
              }
            }
          }
        } else if (typeof phrase === "function") {
          const seriesResult = speakSeries(phrase(), lang, voice, false);
          nestedSeriesResults.push(seriesResult);
          await seriesResult.series;
        } else if (Array.isArray(phrase)) {
          const seriesResult = speakSeries(phrase, lang, voice, false);
          nestedSeriesResults.push(seriesResult);
          await seriesResult.series;
        }
      }
    } finally {
      active = false;
    }
  })();
  return {
    series: seriesChain,
    get active() {
      return active;
    },
    append: (toSpeak) => {
      remainingPhrases.push(toSpeak);
    },
    cancel: () => {
      if (!active) {
        return;
      }
      if (root) {
        synth.cancel();
      }
      nestedSeriesResults.forEach((nestedSeriesResult) => {
        nestedSeriesResult.cancel();
      });
      active = false;
    }
  };
}
let currentSeries;
function SpeechEngine(toSpeak, lang = "en-US", voice) {
  currentSeries && currentSeries.cancel();
  currentSeries = speakSeries(toSpeak, lang, voice);
  return currentSeries;
}
const voidFn = () => void 0;
const isServer = false;
const debounce = (callback, wait) => {
  let timeoutId;
  const clear = () => clearTimeout(timeoutId);
  if (getOwner())
    onCleanup(clear);
  const debounced = (...args) => {
    if (timeoutId !== void 0)
      clear();
    timeoutId = setTimeout(() => callback(...args), wait);
  };
  return Object.assign(debounced, { clear });
};
let resetFocusPathTimer;
let prevFocusPath = [];
let currentlySpeaking;
let voiceOutDisabled = false;
const fiveMinutes = 3e5;
function debounceWithFlush(callback, time) {
  const trigger = debounce(callback, time);
  let scopedValue;
  const debounced = (newValue) => {
    scopedValue = newValue;
    trigger(newValue);
  };
  debounced.flush = () => {
    trigger.clear();
    callback(scopedValue);
  };
  debounced.clear = trigger.clear;
  return debounced;
}
function getElmName(elm) {
  return elm.id || elm.name;
}
function onFocusChangeCore(focusPath2 = []) {
  if (!Announcer.onFocusChange || !Announcer.enabled) {
    return;
  }
  const loaded = focusPath2.every((elm) => !elm.loading);
  const focusDiff = focusPath2.filter((elm) => !prevFocusPath.includes(elm));
  resetFocusPathTimer();
  if (!loaded && Announcer.onFocusChange) {
    Announcer.onFocusChange([]);
    return;
  }
  prevFocusPath = focusPath2.slice(0);
  const toAnnounceText = [];
  const toAnnounce = focusDiff.reverse().reduce((acc, elm) => {
    if (elm.announce) {
      acc.push([getElmName(elm), "Announce", elm.announce]);
      toAnnounceText.push(elm.announce);
    } else if (elm.title) {
      acc.push([getElmName(elm), "Title", elm.title]);
      toAnnounceText.push(elm.title);
    } else {
      acc.push([getElmName(elm), "No Announce", ""]);
    }
    return acc;
  }, []);
  focusDiff.reverse().reduce((acc, elm) => {
    if (elm.announceContext) {
      acc.push([getElmName(elm), "Context", elm.announceContext]);
      toAnnounceText.push(elm.announceContext);
    } else {
      acc.push([getElmName(elm), "No Context", ""]);
    }
    return acc;
  }, toAnnounce);
  if (Announcer.debug) {
    console.table(toAnnounce);
  }
  if (toAnnounceText.length) {
    return Announcer.speak(toAnnounceText.reduce((acc, val) => acc.concat(val), []));
  }
}
function textToSpeech(toSpeak, lang, voice) {
  if (voiceOutDisabled) {
    return;
  }
  return currentlySpeaking = SpeechEngine(toSpeak, lang, voice);
}
const Announcer = {
  debug: false,
  enabled: true,
  lang: "en-US",
  cancel: function() {
    currentlySpeaking && currentlySpeaking.cancel();
  },
  clearPrevFocus: function(depth2 = 0) {
    prevFocusPath = prevFocusPath.slice(0, depth2);
    resetFocusPathTimer();
  },
  speak: function(text, { append = false, notification = false } = {}) {
    if (Announcer.onFocusChange && Announcer.enabled) {
      if (append && currentlySpeaking && currentlySpeaking.active) {
        currentlySpeaking.append(text);
      } else {
        Announcer.cancel();
        textToSpeech(text, Announcer.lang, Announcer.voice);
      }
      if (notification) {
        voiceOutDisabled = true;
        currentlySpeaking == null ? void 0 : currentlySpeaking.series.finally(() => {
          voiceOutDisabled = false;
          Announcer.refresh();
        }).catch(console.error);
      }
    }
    return currentlySpeaking;
  },
  refresh: function(depth2 = 0) {
    Announcer.clearPrevFocus(depth2);
    Announcer.onFocusChange && Announcer.onFocusChange(untrack(() => focusPath()));
  },
  setupTimers: function({ focusDebounce = 400, focusChangeTimeout = fiveMinutes } = {}) {
    Announcer.onFocusChange = debounceWithFlush(onFocusChangeCore, focusDebounce);
    resetFocusPathTimer = debounceWithFlush(() => {
      prevFocusPath = [];
    }, focusChangeTimeout);
  }
};
let doOnce = false;
const useAnnouncer = (options) => {
  if (doOnce) {
    return Announcer;
  }
  doOnce = true;
  Announcer.setupTimers(options);
  createEffect(on(focusPath, Announcer.onFocusChange, { defer: true }));
  return Announcer;
};
function createLazy(component, props, keyHandler) {
  const [offset, setOffset] = createSignal(props.sync ? props.upCount : 1);
  let timeoutId = null;
  createEffect(() => setOffset((offset2) => Math.max(offset2, (props.selected || 0) + 1)));
  if (!props.sync || props.eaglerLoad) {
    createEffect(() => {
      if (props.each) {
        const loadItems = () => {
          let count2 = untrack(offset);
          if (count2 < props.upCount) {
            setOffset(count2 + 1);
            timeoutId = setTimeout(loadItems, 16);
            count2++;
          } else if (props.eagerLoad) {
            const maxOffset = props.each ? props.each.length : 0;
            if (offset() >= maxOffset) return;
            setOffset((prev) => Math.min(prev + 1, maxOffset));
            scheduleTask(loadItems);
          }
        };
        loadItems();
      }
    });
  }
  const items = createMemo(() => Array.isArray(props.each) ? props.each.slice(0, offset()) : []);
  const updateOffset = () => {
    var _a2;
    const maxOffset = props.each ? props.each.length : 0;
    if (offset() >= maxOffset) return;
    if (!props.delay) {
      setOffset((prev) => Math.min(prev + 1, maxOffset));
      return;
    }
    if (timeoutId) {
      clearTimeout(timeoutId);
      setOffset((prev) => Math.min(prev + 1, maxOffset));
    }
    timeoutId = setTimeout(() => {
      setOffset((prev) => Math.min(prev + 1, maxOffset));
      timeoutId = null;
    }, (_a2 = props.delay) != null ? _a2 : 0);
  };
  const handler = keyHandler(updateOffset);
  return createComponent(Show, {
    get when() {
      return items();
    },
    get fallback() {
      return props.fallback;
    },
    get children() {
      return createComponent(Dynamic, mergeProps({
        component
      }, props, handler, {
        get children() {
          return createComponent(Index, {
            get each() {
              return items();
            },
            get children() {
              return props.children;
            }
          });
        }
      }));
    }
  });
}
function LazyRow(props) {
  return createLazy(Row, props, (updateOffset) => ({
    onRight: updateOffset
  }));
}
function LazyColumn(props) {
  return createLazy(Column, props, (updateOffset) => ({
    onDown: updateOffset
  }));
}
function createBeforeLeave() {
  let listeners = /* @__PURE__ */ new Set();
  function subscribe(listener) {
    listeners.add(listener);
    return () => listeners.delete(listener);
  }
  let ignore = false;
  function confirm(to, options) {
    if (ignore)
      return !(ignore = false);
    const e = {
      to,
      options,
      defaultPrevented: false,
      preventDefault: () => e.defaultPrevented = true
    };
    for (const l of listeners)
      l.listener({
        ...e,
        from: l.location,
        retry: (force) => {
          force && (ignore = true);
          l.navigate(to, { ...options, resolve: false });
        }
      });
    return !e.defaultPrevented;
  }
  return {
    subscribe,
    confirm
  };
}
let depth;
function saveCurrentDepth() {
  if (!window.history.state || window.history.state._depth == null) {
    window.history.replaceState({ ...window.history.state, _depth: window.history.length - 1 }, "");
  }
  depth = window.history.state._depth;
}
{
  saveCurrentDepth();
}
function keepDepth(state) {
  return {
    ...state,
    _depth: window.history.state && window.history.state._depth
  };
}
function notifyIfNotBlocked(notify, block) {
  let ignore = false;
  return () => {
    const prevDepth = depth;
    saveCurrentDepth();
    const delta = prevDepth == null ? null : depth - prevDepth;
    if (ignore) {
      ignore = false;
      return;
    }
    if (delta && block(delta)) {
      ignore = true;
      window.history.go(-delta);
    } else {
      notify();
    }
  };
}
const hasSchemeRegex = /^(?:[a-z0-9]+:)?\/\//i;
const trimPathRegex = /^\/+|(\/)\/+$/g;
const mockBase = "http://sr";
function normalizePath(path, omitSlash = false) {
  const s = path.replace(trimPathRegex, "$1");
  return s ? omitSlash || /^[?#]/.test(s) ? s : "/" + s : "";
}
function resolvePath(base, path, from) {
  if (hasSchemeRegex.test(path)) {
    return void 0;
  }
  const basePath2 = normalizePath(base);
  const fromPath = from && normalizePath(from);
  let result = "";
  if (!fromPath || path.startsWith("/")) {
    result = basePath2;
  } else if (fromPath.toLowerCase().indexOf(basePath2.toLowerCase()) !== 0) {
    result = basePath2 + fromPath;
  } else {
    result = fromPath;
  }
  return (result || "/") + normalizePath(path, !result);
}
function invariant(value, message) {
  if (value == null) {
    throw new Error(message);
  }
  return value;
}
function joinPaths(from, to) {
  return normalizePath(from).replace(/\/*(\*.*)?$/g, "") + normalizePath(to);
}
function extractSearchParams(url) {
  const params2 = {};
  url.searchParams.forEach((value, key) => {
    if (key in params2) {
      if (Array.isArray(params2[key]))
        params2[key].push(value);
      else
        params2[key] = [params2[key], value];
    } else
      params2[key] = value;
  });
  return params2;
}
function createMatcher(path, partial, matchFilters) {
  const [pattern, splat] = path.split("/*", 2);
  const segments = pattern.split("/").filter(Boolean);
  const len = segments.length;
  return (location2) => {
    const locSegments = location2.split("/").filter(Boolean);
    const lenDiff = locSegments.length - len;
    if (lenDiff < 0 || lenDiff > 0 && splat === void 0 && !partial) {
      return null;
    }
    const match = {
      path: len ? "" : "/",
      params: {}
    };
    const matchFilter = (s) => matchFilters === void 0 ? void 0 : matchFilters[s];
    for (let i = 0; i < len; i++) {
      const segment = segments[i];
      const dynamic = segment[0] === ":";
      const locSegment = dynamic ? locSegments[i] : locSegments[i].toLowerCase();
      const key = dynamic ? segment.slice(1) : segment.toLowerCase();
      if (dynamic && matchSegment(locSegment, matchFilter(key))) {
        match.params[key] = locSegment;
      } else if (dynamic || !matchSegment(locSegment, key)) {
        return null;
      }
      match.path += "/".concat(locSegment);
    }
    if (splat) {
      const remainder = lenDiff ? locSegments.slice(-lenDiff).join("/") : "";
      if (matchSegment(remainder, matchFilter(splat))) {
        match.params[splat] = remainder;
      } else {
        return null;
      }
    }
    return match;
  };
}
function matchSegment(input, filter) {
  const isEqual = (s) => s === input;
  if (filter === void 0) {
    return true;
  } else if (typeof filter === "string") {
    return isEqual(filter);
  } else if (typeof filter === "function") {
    return filter(input);
  } else if (Array.isArray(filter)) {
    return filter.some(isEqual);
  } else if (filter instanceof RegExp) {
    return filter.test(input);
  }
  return false;
}
function scoreRoute(route) {
  const [pattern, splat] = route.pattern.split("/*", 2);
  const segments = pattern.split("/").filter(Boolean);
  return segments.reduce((score, segment) => score + (segment.startsWith(":") ? 2 : 3), segments.length - (splat === void 0 ? 0 : 1));
}
function createMemoObject(fn) {
  const map = /* @__PURE__ */ new Map();
  const owner = getOwner();
  return new Proxy({}, {
    get(_, property) {
      if (!map.has(property)) {
        runWithOwner(owner, () => map.set(property, createMemo(() => fn()[property])));
      }
      return map.get(property)();
    },
    getOwnPropertyDescriptor() {
      return {
        enumerable: true,
        configurable: true
      };
    },
    ownKeys() {
      return Reflect.ownKeys(fn());
    }
  });
}
function expandOptionals(pattern) {
  let match = /(\/?\:[^\/]+)\?/.exec(pattern);
  if (!match)
    return [pattern];
  let prefix = pattern.slice(0, match.index);
  let suffix = pattern.slice(match.index + match[0].length);
  const prefixes = [prefix, prefix += match[1]];
  while (match = /^(\/\:[^\/]+)\?/.exec(suffix)) {
    prefixes.push(prefix += match[1]);
    suffix = suffix.slice(match[0].length);
  }
  return expandOptionals(suffix).reduce((results, expansion) => [...results, ...prefixes.map((p) => p + expansion)], []);
}
const MAX_REDIRECTS = 100;
const RouterContextObj = createContext();
const RouteContextObj = createContext();
const useRouter = () => invariant(useContext(RouterContextObj), "<A> and 'use' router primitives can be only used inside a Route.");
const useNavigate = () => useRouter().navigatorFactory();
const useLocation = () => useRouter().location;
const usePreloadRoute = () => {
  const pre = useRouter().preloadRoute;
  return (url, options = {}) => pre(url instanceof URL ? url : new URL(url, mockBase), options.preloadData);
};
const useMatch = (path, matchFilters) => {
  const location2 = useLocation();
  const matchers = createMemo(() => expandOptionals(path()).map((path2) => createMatcher(path2, void 0, matchFilters)));
  return createMemo(() => {
    for (const matcher of matchers()) {
      const match = matcher(location2.pathname);
      if (match)
        return match;
    }
  });
};
const useParams = () => useRouter().params;
function createRoutes(routeDef, base = "") {
  const { component, preload: preload2, load: load2, children: children2, info } = routeDef;
  const isLeaf = !children2 || Array.isArray(children2) && !children2.length;
  const shared = {
    key: routeDef,
    component,
    preload: preload2 || load2,
    info
  };
  return asArray(routeDef.path).reduce((acc, originalPath) => {
    for (const expandedPath of expandOptionals(originalPath)) {
      const path = joinPaths(base, expandedPath);
      let pattern = isLeaf ? path : path.split("/*", 1)[0];
      pattern = pattern.split("/").map((s) => {
        return s.startsWith(":") || s.startsWith("*") ? s : encodeURIComponent(s);
      }).join("/");
      acc.push({
        ...shared,
        originalPath,
        pattern,
        matcher: createMatcher(pattern, !isLeaf, routeDef.matchFilters)
      });
    }
    return acc;
  }, []);
}
function createBranch(routes, index = 0) {
  return {
    routes,
    score: scoreRoute(routes[routes.length - 1]) * 1e4 - index,
    matcher(location2) {
      const matches = [];
      for (let i = routes.length - 1; i >= 0; i--) {
        const route = routes[i];
        const match = route.matcher(location2);
        if (!match) {
          return null;
        }
        matches.unshift({
          ...match,
          route
        });
      }
      return matches;
    }
  };
}
function asArray(value) {
  return Array.isArray(value) ? value : [value];
}
function createBranches(routeDef, base = "", stack = [], branches = []) {
  const routeDefs = asArray(routeDef);
  for (let i = 0, len = routeDefs.length; i < len; i++) {
    const def = routeDefs[i];
    if (def && typeof def === "object") {
      if (!def.hasOwnProperty("path"))
        def.path = "";
      const routes = createRoutes(def, base);
      for (const route of routes) {
        stack.push(route);
        const isEmptyArray = Array.isArray(def.children) && def.children.length === 0;
        if (def.children && !isEmptyArray) {
          createBranches(def.children, route.pattern, stack, branches);
        } else {
          const branch = createBranch([...stack], branches.length);
          branches.push(branch);
        }
        stack.pop();
      }
    }
  }
  return stack.length ? branches : branches.sort((a, b) => b.score - a.score);
}
function getRouteMatches(branches, location2) {
  for (let i = 0, len = branches.length; i < len; i++) {
    const match = branches[i].matcher(location2);
    if (match) {
      return match;
    }
  }
  return [];
}
function createLocation(path, state, queryWrapper) {
  const origin = new URL(mockBase);
  const url = createMemo((prev) => {
    const path_ = path();
    try {
      return new URL(path_, origin);
    } catch (err) {
      console.error("Invalid path ".concat(path_));
      return prev;
    }
  }, origin, {
    equals: (a, b) => a.href === b.href
  });
  const pathname = createMemo(() => url().pathname);
  const search = createMemo(() => url().search, true);
  const hash = createMemo(() => url().hash);
  const key = () => "";
  const queryFn = on(search, () => extractSearchParams(url()));
  return {
    get pathname() {
      return pathname();
    },
    get search() {
      return search();
    },
    get hash() {
      return hash();
    },
    get state() {
      return state();
    },
    get key() {
      return key();
    },
    query: queryWrapper ? queryWrapper(queryFn) : createMemoObject(queryFn)
  };
}
let intent;
function getIntent() {
  return intent;
}
function setInPreloadFn(value) {
}
function createRouterContext(integration, branches, getContext, options = {}) {
  const { signal: [source, setSource], utils = {} } = integration;
  const parsePath = utils.parsePath || ((p) => p);
  const renderPath = utils.renderPath || ((p) => p);
  const beforeLeave = utils.beforeLeave || createBeforeLeave();
  const basePath2 = resolvePath("", options.base || "");
  if (basePath2 === void 0) {
    throw new Error("".concat(basePath2, " is not a valid base path"));
  } else if (basePath2 && !source().value) {
    setSource({ value: basePath2, replace: true, scroll: false });
  }
  const [isRouting, setIsRouting] = createSignal(false);
  let lastTransitionTarget;
  const transition = (newIntent, newTarget) => {
    if (newTarget.value === reference() && newTarget.state === state())
      return;
    if (lastTransitionTarget === void 0)
      setIsRouting(true);
    intent = newIntent;
    lastTransitionTarget = newTarget;
    startTransition(() => {
      if (lastTransitionTarget !== newTarget)
        return;
      setReference(lastTransitionTarget.value);
      setState(lastTransitionTarget.state);
      submissions[1]((subs) => subs.filter((s) => s.pending));
    }).finally(() => {
      if (lastTransitionTarget !== newTarget)
        return;
      batch(() => {
        intent = void 0;
        if (newIntent === "navigate")
          navigateEnd(lastTransitionTarget);
        setIsRouting(false);
        lastTransitionTarget = void 0;
      });
    });
  };
  const [reference, setReference] = createSignal(source().value);
  const [state, setState] = createSignal(source().state);
  const location2 = createLocation(reference, state, utils.queryWrapper);
  const referrers = [];
  const submissions = createSignal([]);
  const matches = createMemo(() => {
    if (typeof options.transformUrl === "function") {
      return getRouteMatches(branches(), options.transformUrl(location2.pathname));
    }
    return getRouteMatches(branches(), location2.pathname);
  });
  const buildParams = () => {
    const m = matches();
    const params3 = {};
    for (let i = 0; i < m.length; i++) {
      Object.assign(params3, m[i].params);
    }
    return params3;
  };
  const params2 = utils.paramsWrapper ? utils.paramsWrapper(buildParams, branches) : createMemoObject(buildParams);
  const baseRoute = {
    pattern: basePath2,
    path: () => basePath2,
    outlet: () => null,
    resolvePath(to) {
      return resolvePath(basePath2, to);
    }
  };
  createRenderEffect(on(source, (source2) => transition("native", source2), { defer: true }));
  return {
    base: baseRoute,
    location: location2,
    params: params2,
    isRouting,
    renderPath,
    parsePath,
    navigatorFactory,
    matches,
    beforeLeave,
    preloadRoute,
    singleFlight: options.singleFlight === void 0 ? true : options.singleFlight,
    submissions
  };
  function navigateFromRoute(route, to, options2) {
    untrack(() => {
      if (typeof to === "number") {
        if (!to) {
        } else if (utils.go) {
          utils.go(to);
        } else {
          console.warn("Router integration does not support relative routing");
        }
        return;
      }
      const queryOnly = !to || to[0] === "?";
      const { replace, resolve, scroll: scroll2, state: nextState } = {
        replace: false,
        resolve: !queryOnly,
        scroll: true,
        ...options2
      };
      const resolvedTo = resolve ? route.resolvePath(to) : resolvePath(queryOnly && location2.pathname || "", to);
      if (resolvedTo === void 0) {
        throw new Error("Path '".concat(to, "' is not a routable path"));
      } else if (referrers.length >= MAX_REDIRECTS) {
        throw new Error("Too many redirects");
      }
      const current = reference();
      if (resolvedTo !== current || nextState !== state()) {
        if (isServer) ;
        else if (beforeLeave.confirm(resolvedTo, options2)) {
          referrers.push({ value: current, replace, scroll: scroll2, state: state() });
          transition("navigate", {
            value: resolvedTo,
            state: nextState
          });
        }
      }
    });
  }
  function navigatorFactory(route) {
    route = route || useContext(RouteContextObj) || baseRoute;
    return (to, options2) => navigateFromRoute(route, to, options2);
  }
  function navigateEnd(next) {
    const first = referrers[0];
    if (first) {
      setSource({
        ...next,
        replace: first.replace,
        scroll: first.scroll
      });
      referrers.length = 0;
    }
  }
  function preloadRoute(url, preloadData) {
    const matches2 = getRouteMatches(branches(), url.pathname);
    const prevIntent = intent;
    intent = "preload";
    for (let match in matches2) {
      const { route, params: params3 } = matches2[match];
      route.component && route.component.preload && route.component.preload();
      const { preload: preload2 } = route;
      preloadData && preload2 && runWithOwner(getContext(), () => preload2({
        params: params3,
        location: {
          pathname: url.pathname,
          search: url.search,
          hash: url.hash,
          query: extractSearchParams(url),
          state: null,
          key: ""
        },
        intent: "preload"
      }));
    }
    intent = prevIntent;
  }
}
function createRouteContext(router, parent, outlet, match) {
  const { base, location: location2, params: params2 } = router;
  const { pattern, component, preload: preload2 } = match().route;
  const path = createMemo(() => match().path);
  component && component.preload && component.preload();
  const data = preload2 ? preload2({ params: params2, location: location2, intent: intent || "initial" }) : void 0;
  const route = {
    parent,
    pattern,
    path,
    outlet: () => component ? createComponent$1(component, {
      params: params2,
      location: location2,
      data,
      get children() {
        return outlet();
      }
    }) : outlet(),
    resolvePath(to) {
      return resolvePath(base.path(), to, path());
    }
  };
  return route;
}
const createRouterComponent = (router) => (props) => {
  const {
    base
  } = props;
  const routeDefs = children(() => props.children);
  const branches = createMemo(() => createBranches(routeDefs(), props.base || ""));
  let context;
  const routerState = createRouterContext(router, branches, () => context, {
    base,
    singleFlight: props.singleFlight,
    transformUrl: props.transformUrl
  });
  router.create && router.create(routerState);
  return createComponent(RouterContextObj.Provider, {
    value: routerState,
    get children() {
      return createComponent(Root, {
        routerState,
        get root() {
          return props.root;
        },
        get preload() {
          return props.rootPreload || props.rootLoad;
        },
        get children() {
          return [memo(() => (context = getOwner()) && null), createComponent(Routes, {
            routerState,
            get branches() {
              return branches();
            }
          })];
        }
      });
    }
  });
};
function Root(props) {
  const location2 = props.routerState.location;
  const params2 = props.routerState.params;
  const data = createMemo(() => props.preload && untrack(() => {
    setInPreloadFn(true);
    props.preload({
      params: params2,
      location: location2,
      intent: getIntent() || "initial"
    });
    setInPreloadFn(false);
  }));
  return createComponent(Show, {
    get when() {
      return props.root;
    },
    keyed: true,
    get fallback() {
      return props.children;
    },
    children: (Root2) => createComponent(Root2, {
      params: params2,
      location: location2,
      get data() {
        return data();
      },
      get children() {
        return props.children;
      }
    })
  });
}
function Routes(props) {
  const disposers = [];
  let root;
  const routeStates = createMemo(on(props.routerState.matches, (nextMatches, prevMatches, prev) => {
    let equal = prevMatches && nextMatches.length === prevMatches.length;
    const next = [];
    for (let i = 0, len = nextMatches.length; i < len; i++) {
      const prevMatch = prevMatches && prevMatches[i];
      const nextMatch = nextMatches[i];
      if (prev && prevMatch && nextMatch.route.key === prevMatch.route.key) {
        next[i] = prev[i];
      } else {
        equal = false;
        if (disposers[i]) {
          disposers[i]();
        }
        createRoot((dispose2) => {
          disposers[i] = dispose2;
          next[i] = createRouteContext(props.routerState, next[i - 1] || props.routerState.base, createOutlet(() => routeStates()[i + 1]), () => props.routerState.matches()[i]);
        });
      }
    }
    disposers.splice(nextMatches.length).forEach((dispose2) => dispose2());
    if (prev && equal) {
      return prev;
    }
    root = next[0];
    return next;
  }));
  return createOutlet(() => routeStates() && root)();
}
const createOutlet = (child) => {
  return () => createComponent(Show, {
    get when() {
      return child();
    },
    keyed: true,
    children: (child2) => createComponent(RouteContextObj.Provider, {
      value: child2,
      get children() {
        return child2.outlet();
      }
    })
  });
};
const Route = (props) => {
  const childRoutes = children(() => props.children);
  return mergeProps$1(props, {
    get children() {
      return childRoutes();
    }
  });
};
function intercept([value, setValue], get2, set) {
  return [value, set ? (v) => setValue(set(v)) : setValue];
}
function createRouter(config) {
  let ignore = false;
  const wrap = (value) => typeof value === "string" ? { value } : value;
  const signal = intercept(createSignal(wrap(config.get()), {
    equals: (a, b) => a.value === b.value && a.state === b.state
  }), void 0, (next) => {
    !ignore && config.set(next);
    if (sharedConfig.registry && !sharedConfig.done)
      sharedConfig.done = true;
    return next;
  });
  config.init && onCleanup(config.init((value = config.get()) => {
    ignore = true;
    signal[1](wrap(value));
    ignore = false;
  }));
  return createRouterComponent({
    signal,
    create: config.create,
    utils: config.utils
  });
}
function hashParser(str) {
  const to = str.replace(/^.*?#/, "");
  if (!to.startsWith("/")) {
    const [, path = "/"] = window.location.hash.split("#", 2);
    return "".concat(path, "#").concat(to);
  }
  return to;
}
function bindEvent(target, type, handler) {
  target.addEventListener(type, handler);
  return () => target.removeEventListener(type, handler);
}
function HashRouter(props) {
  const getSource = () => window.location.hash.slice(1);
  const beforeLeave = createBeforeLeave();
  return createRouter({
    get: getSource,
    set({ value, replace, state }) {
      if (replace) {
        window.history.replaceState(keepDepth(state), "", "#" + value);
      } else {
        window.history.pushState(state, "", "#" + value);
      }
      saveCurrentDepth();
    },
    init: (notify) => bindEvent(window, "hashchange", notifyIfNotBlocked(notify, (delta) => !beforeLeave.confirm(delta && delta < 0 ? delta : getSource()))),
    utils: {
      go: (delta) => window.history.go(delta),
      renderPath: (path) => "#".concat(path),
      parsePath: hashParser,
      beforeLeave,
      queryWrapper: props.forceProxy || !SUPPORTS_PROXY ? (getQuery) => {
        return createMemoWithoutProxy(getQuery, props.queryParams);
      } : void 0,
      paramsWrapper: props.forceProxy || !SUPPORTS_PROXY ? (buildParams, branches) => {
        return createMemoWithoutProxy(buildParams, collectDynamicParams(branches()));
      } : void 0
    }
  })(props);
}
const SUPPORTS_PROXY = typeof Proxy === "function";
function createMemoWithoutProxy(fn, allKeys) {
  const map = /* @__PURE__ */ new Map();
  const owner = getOwner();
  const target = {};
  const handler = (property) => {
    if (!map.has(property)) {
      runWithOwner(owner, () => map.set(property, createMemo(() => fn()[property])));
    }
    return map.get(property)();
  };
  const keys = allKeys ? allKeys : Object.keys(fn());
  keys.forEach((key) => {
    Object.defineProperty(target, key, {
      get: () => handler(key),
      enumerable: true,
      configurable: true
    });
  });
  return target;
}
const collectDynamicParams = (branches) => {
  const dynamicParams = [];
  branches.forEach((branch) => {
    branch.routes.forEach((route) => {
      if (route.pattern) {
        const matches = route.pattern.match(/:(\w+)/g);
        if (matches) {
          matches.forEach((param) => {
            const p = param.slice(1);
            if (!dynamicParams.includes(p))
              dynamicParams.push(p);
          });
        }
      }
    });
  });
  return dynamicParams;
};
function onGridFocus(onSelectedChanged) {
  return function() {
    if (!this || this.children.length === 0)
      return false;
    this.children.find((child2, index) => {
      if (child2.states.has(Config.focusStateKey)) {
        this.selected = index;
        return true;
      }
      return false;
    });
    this.selected = this.selected || 0;
    let child = this.selected ? this.children[this.selected] : this.selectedNode;
    while (child == null ? void 0 : child.skipFocus) {
      this.selected++;
      child = this.children[this.selected];
    }
    if (!(child instanceof ElementNode))
      return false;
    child.setFocus();
    if (onSelectedChanged) {
      const grid = this;
      onSelectedChanged.call(grid, grid.selected, grid, child);
    }
    return true;
  };
}
function handleNavigation(direction) {
  return function() {
    var _a2, _b, _c;
    const numChildren = this.children.length;
    const wrap = this.wrap;
    const lastSelected = this.selected || 0;
    if (numChildren === 0) {
      return false;
    }
    if (direction === "right" || direction === "down") {
      do {
        this.selected = (this.selected || 0) % numChildren + 1;
        if (this.selected >= numChildren) {
          if (!wrap) {
            this.selected = -1;
            break;
          }
          this.selected = 0;
        }
      } while ((_a2 = this.children[this.selected]) == null ? void 0 : _a2.skipFocus);
    } else if (direction === "left" || direction === "up") {
      do {
        this.selected = (this.selected || 0) % numChildren - 1;
        if (this.selected < 0) {
          if (!wrap) {
            this.selected = -1;
            break;
          }
          this.selected = numChildren - 1;
        }
      } while ((_b = this.children[this.selected]) == null ? void 0 : _b.skipFocus);
    }
    if (this.selected === -1) {
      this.selected = lastSelected;
      if ((_c = this.children[this.selected]) == null ? void 0 : _c.states.has(Config.focusStateKey || "$focus")) {
        return false;
      }
    }
    const active = this.children[this.selected || 0] || this.children[0];
    if (!(active instanceof ElementNode))
      return false;
    const navigableThis = this;
    navigableThis.onSelectedChanged && navigableThis.onSelectedChanged.call(navigableThis, navigableThis.selected, navigableThis, active, lastSelected);
    if (this.plinko) {
      const lastSelectedChild = this.children[lastSelected];
      assertTruthy(lastSelectedChild instanceof ElementNode);
      const num = lastSelectedChild.selected || 0;
      active.selected = num < active.children.length ? num : active.children.length - 1;
    }
    active.setFocus();
    return true;
  };
}
const InViewPort = 8;
const isNotShown = (node) => {
  return node.lng.renderState !== InViewPort;
};
function withScrolling(isRow) {
  const dimension = isRow ? "width" : "height";
  const axis = isRow ? "x" : "y";
  return (selected, component, selectedElement, lastSelected) => {
    var _a2, _b, _c, _d, _e, _f, _g, _h, _i, _j;
    let componentRef = component;
    if (typeof selected !== "number") {
      componentRef = selected;
      selected = componentRef.selected || 0;
    }
    if (!componentRef || componentRef.scroll === "none" || !componentRef.children.length)
      return;
    if (componentRef._initialPosition === void 0) {
      componentRef._initialPosition = componentRef[axis];
    }
    const lng = componentRef.lng;
    const screenSize2 = isRow ? lng.stage.root.width : lng.stage.root.height;
    const isIncrementing = lastSelected === void 0 || lastSelected - 1 !== selected;
    if (componentRef._screenOffset === void 0) {
      if (componentRef.parent.clipping) {
        const p = componentRef.parent;
        componentRef.endOffset = screenSize2 - ((isRow ? p.absX : p.absY) || 0) - p[dimension];
      }
      componentRef._screenOffset = (_a2 = componentRef.offset) != null ? _a2 : (isRow ? lng.absX : lng.absY) - componentRef[axis];
    }
    const screenOffset = componentRef._screenOffset;
    const gap = componentRef.gap || 0;
    const scroll2 = componentRef.scroll || (lastSelected === void 0 ? componentRef.scrollIndex ? "center" : "always" : "auto");
    const targetPosition = (_b = componentRef._targetPosition) != null ? _b : componentRef[axis];
    const rootPosition = isIncrementing || scroll2 === "auto" ? Math.min(targetPosition, componentRef[axis]) : Math.max(targetPosition, componentRef[axis]);
    componentRef.offset = (_c = componentRef.offset) != null ? _c : rootPosition;
    const offset = componentRef.offset;
    selectedElement = selectedElement || componentRef.children[selected];
    if (!selectedElement) {
      return;
    }
    const selectedPosition = (_d = selectedElement[axis]) != null ? _d : 0;
    const selectedSize = (_e = selectedElement[dimension]) != null ? _e : 0;
    const selectedScale = (_i = (_h = selectedElement.scale) != null ? _h : (_g = (_f = selectedElement.style) == null ? void 0 : _f.focus) == null ? void 0 : _g.scale) != null ? _i : 1;
    const selectedSizeScaled = selectedSize * selectedScale;
    const containerSize = (_j = componentRef[dimension]) != null ? _j : 0;
    const maxOffset = Math.min(screenSize2 - containerSize - screenOffset - (componentRef.endOffset || 2 * gap), offset);
    const nextIndex = isIncrementing ? selected + 1 : selected - 1;
    const nextElement = componentRef.children[nextIndex] || null;
    let nextPosition = rootPosition;
    if (selectedElement.centerScroll) {
      nextPosition = -selectedPosition + (screenSize2 - selectedSizeScaled) / 2;
    } else if (scroll2 === "always") {
      nextPosition = -selectedPosition + offset;
    } else if (scroll2 === "center") {
      const centerPosition = -selectedPosition + (screenSize2 - selectedSizeScaled) / 2 - screenOffset;
      nextPosition = Math.min(Math.max(centerPosition, maxOffset), offset);
    } else if (!nextElement) {
      nextPosition = isIncrementing ? maxOffset : offset;
    } else if (scroll2 === "auto") {
      if (componentRef.scrollIndex && componentRef.scrollIndex > 0) {
        const totalItems = componentRef.children.length;
        const nearEndIndex = totalItems - componentRef.scrollIndex;
        if (isIncrementing && componentRef.selected >= componentRef.scrollIndex) {
          nextPosition = rootPosition - selectedSize - gap;
        } else if (!isIncrementing && componentRef.selected < nearEndIndex) {
          nextPosition = rootPosition + selectedSize + gap;
        }
      } else if (isIncrementing) {
        nextPosition = -selectedPosition + offset;
      } else {
        nextPosition = rootPosition + selectedSize + gap;
      }
    } else if (isIncrementing && isNotShown(nextElement)) {
      nextPosition = rootPosition - selectedSize - gap;
    } else if (isNotShown(nextElement)) {
      nextPosition = -selectedPosition + offset;
    }
    nextPosition = isIncrementing && scroll2 !== "always" ? Math.max(nextPosition, maxOffset) : Math.min(nextPosition, offset);
    if (componentRef[axis] !== nextPosition) {
      if (componentRef.onScrolled) {
        const isInitial = nextPosition === componentRef._initialPosition;
        componentRef.onScrolled(componentRef, nextPosition, isInitial);
      }
      componentRef[axis] = nextPosition;
      componentRef._targetPosition = nextPosition;
    }
  };
}
function chainFunctions(...fns) {
  const onlyFunctions = fns.filter((func) => typeof func === "function");
  if (onlyFunctions.length === 0) {
    return void 0;
  }
  if (onlyFunctions.length === 1) {
    return onlyFunctions[0];
  }
  return function(...innerArgs) {
    let result;
    for (const func of onlyFunctions) {
      result = func.apply(this, innerArgs);
      if (result === true) {
        return result;
      }
    }
    return result;
  };
}
const chainRefs = chainFunctions;
const ColumnStyles = {
  display: "flex",
  flexDirection: "column",
  gap: 30,
  transition: {
    y: {
      duration: 250,
      easing: "ease-in-out"
    }
  }
};
const onUp = handleNavigation("up");
const onDown = handleNavigation("down");
const scroll$1 = withScrolling(false);
function scrollToIndex$1(index) {
  this.selected = index;
  scroll$1(index, this);
  this.setFocus();
}
const Column = (props) => {
  const gridFocus = onGridFocus(props.onSelectedChanged);
  const refocus = (elm) => {
    if (elm.states.has(Config.focusStateKey)) {
      gridFocus.call(elm);
    }
  };
  return (() => {
    var _el$ = createElement("view");
    spread(_el$, mergeProps(props, {
      "onUp": chainFunctions(props.onUp, onUp),
      "onDown": chainFunctions(props.onDown, onDown),
      get selected() {
        return props.selected || 0;
      },
      "scrollToIndex": scrollToIndex$1,
      "forwardFocus": gridFocus,
      "onLayout": props.selected ? chainFunctions(props.onLayout, refocus, scroll$1) : props.onLayout,
      "onSelectedChanged": chainFunctions(props.onSelectedChanged, props.scroll !== "none" ? scroll$1 : void 0),
      "style": combineStyles(props.style, ColumnStyles)
    }), false);
    return _el$;
  })();
};
const RowStyles = {
  display: "flex",
  gap: 30,
  transition: {
    x: {
      duration: 250,
      easing: "ease-in-out"
    }
  }
};
const onLeft = handleNavigation("left");
const onRight = handleNavigation("right");
const scroll = withScrolling(true);
function scrollToIndex(index) {
  this.selected = index;
  scroll(index, this);
  this.setFocus();
}
const Row = (props) => {
  const gridFocus = onGridFocus(props.onSelectedChanged);
  const refocus = (elm) => {
    if (elm.states.has(Config.focusStateKey)) {
      gridFocus.call(elm);
    }
  };
  return (() => {
    var _el$ = createElement("view");
    spread(_el$, mergeProps(props, {
      get selected() {
        return props.selected || 0;
      },
      "onLeft": chainFunctions(props.onLeft, onLeft),
      "onRight": chainFunctions(props.onRight, onRight),
      "forwardFocus": gridFocus,
      "scrollToIndex": scrollToIndex,
      "onLayout": props.selected ? chainFunctions(props.onLayout, refocus, scroll) : props.onLayout,
      "onSelectedChanged": chainFunctions(props.onSelectedChanged, props.scroll !== "none" ? scroll : void 0),
      "style": combineStyles(props.style, RowStyles)
    }), false);
    return _el$;
  })();
};
const fpsStyle = {
  color: 255,
  height: 180,
  width: 330,
  x: 1900,
  y: 6,
  mountX: 1,
  alpha: 0.8,
  zIndex: 100
};
const fpsLabel = {
  x: 10,
  fontSize: 20,
  textColor: 4143380223
};
const fpsValue = {
  fontSize: 22,
  textColor: 4143380223
};
const [fps, setFps] = createSignal(0);
const [avgFps, setAvgFps] = createSignal(0);
const [minFps, setMinFps] = createSignal(99);
const [maxFps, setMaxFps] = createSignal(0);
const [criticalThresholdSignal, setCriticalThresholdSignal] = createSignal("");
const [targetThresholdSignal, setTargetThresholdSignal] = createSignal("");
const [renderableMemUsedSignal, setRenderableMemUsedSignal] = createSignal("");
const [memUsedSignal, setMemUsedSignal] = createSignal("");
const [renderableTexturesLoadedSignal, setRenderableTexturesLoadedSignal] = createSignal(0);
const [loadedTexturesSignal, setLoadedTexturesSignal] = createSignal(0);
let count = 0;
let totalFps = 0;
const infoFontSize = 14;
function bytesToMb(bytes) {
  return (bytes / 1024 / 1024).toFixed(2) + " Mb";
}
const calcFps = (fps2) => {
  if (!fps2) return;
  setFps(fps2);
  setMinFps((prev) => Math.min(fps2, prev));
  setMaxFps((prev) => Math.max(fps2, prev));
  totalFps += fps2;
  count++;
  setAvgFps(Math.round(totalFps / count));
};
function updateMemoryInfo(stage) {
  const memInfo = stage.txMemManager.getMemoryInfo();
  setCriticalThresholdSignal(bytesToMb(memInfo.criticalThreshold));
  setTargetThresholdSignal(bytesToMb(memInfo.targetThreshold));
  setRenderableMemUsedSignal(bytesToMb(memInfo.renderableMemUsed));
  setMemUsedSignal(bytesToMb(memInfo.memUsed));
  setRenderableTexturesLoadedSignal(memInfo.renderableTexturesLoaded);
  setLoadedTexturesSignal(memInfo.loadedTextures);
}
let frameCount = 0;
function setupFPS(root) {
  root.renderer.on("fpsUpdate", (target, fpsData) => {
    const fps2 = typeof fpsData === "number" ? fpsData : fpsData.fps;
    if (fps2 > 5) {
      calcFps(fps2);
      if (frameCount % 10 === 0) {
        updateMemoryInfo(target.stage);
        frameCount = 0;
      }
      frameCount++;
    }
  });
}
const FPSCounter = (props) => {
  return (() => {
    var _el$ = createElement("view"), _el$2 = createElement("view"), _el$3 = createElement("text"), _el$5 = createElement("text"), _el$6 = createElement("view"), _el$7 = createElement("text"), _el$9 = createElement("text"), _el$10 = createElement("view"), _el$11 = createElement("text"), _el$13 = createElement("text"), _el$14 = createElement("view"), _el$15 = createElement("text"), _el$17 = createElement("text"), _el$18 = createElement("view"), _el$19 = createElement("view"), _el$20 = createElement("text"), _el$22 = createElement("text"), _el$23 = createElement("view"), _el$24 = createElement("text"), _el$26 = createElement("text"), _el$27 = createElement("view"), _el$28 = createElement("text"), _el$30 = createElement("text"), _el$31 = createElement("view"), _el$32 = createElement("text"), _el$34 = createElement("text"), _el$35 = createElement("view"), _el$36 = createElement("text"), _el$38 = createElement("text"), _el$39 = createElement("view"), _el$40 = createElement("text"), _el$42 = createElement("text");
    insertNode(_el$, _el$2);
    insertNode(_el$, _el$6);
    insertNode(_el$, _el$10);
    insertNode(_el$, _el$14);
    insertNode(_el$, _el$18);
    spread(_el$, mergeProps(props, {
      "style": fpsStyle
    }), true);
    insertNode(_el$2, _el$3);
    insertNode(_el$2, _el$5);
    setProp(_el$2, "y", 6);
    insertNode(_el$3, createTextNode("FPS:"));
    setProp(_el$3, "style", fpsLabel);
    setProp(_el$5, "style", fpsValue);
    setProp(_el$5, "x", 90);
    insert(_el$5, () => fps().toString());
    insertNode(_el$6, _el$7);
    insertNode(_el$6, _el$9);
    setProp(_el$6, "y", 6);
    setProp(_el$6, "x", 160);
    insertNode(_el$7, createTextNode("AVG:"));
    setProp(_el$7, "style", fpsLabel);
    setProp(_el$9, "style", fpsValue);
    setProp(_el$9, "x", 100);
    insert(_el$9, () => avgFps().toString());
    insertNode(_el$10, _el$11);
    insertNode(_el$10, _el$13);
    setProp(_el$10, "x", 0);
    setProp(_el$10, "y", 26);
    insertNode(_el$11, createTextNode("MIN:"));
    setProp(_el$11, "style", fpsLabel);
    setProp(_el$13, "style", fpsValue);
    setProp(_el$13, "x", 90);
    insert(_el$13, () => minFps().toString());
    insertNode(_el$14, _el$15);
    insertNode(_el$14, _el$17);
    setProp(_el$14, "x", 160);
    setProp(_el$14, "y", 26);
    insertNode(_el$15, createTextNode("MAX:"));
    setProp(_el$15, "style", fpsLabel);
    setProp(_el$17, "style", fpsValue);
    setProp(_el$17, "x", 100);
    insert(_el$17, () => maxFps().toString());
    insertNode(_el$18, _el$19);
    insertNode(_el$18, _el$23);
    insertNode(_el$18, _el$27);
    insertNode(_el$18, _el$31);
    insertNode(_el$18, _el$35);
    insertNode(_el$18, _el$39);
    setProp(_el$18, "display", "flex");
    setProp(_el$18, "flexDirection", "column");
    setProp(_el$18, "y", 58);
    setProp(_el$18, "gap", 4);
    insertNode(_el$19, _el$20);
    insertNode(_el$19, _el$22);
    setProp(_el$19, "height", infoFontSize);
    insertNode(_el$20, createTextNode("criticalThreshold:"));
    setProp(_el$20, "fontSize", infoFontSize);
    setProp(_el$20, "style", fpsLabel);
    setProp(_el$22, "fontSize", infoFontSize);
    setProp(_el$22, "style", fpsLabel);
    setProp(_el$22, "x", 230);
    insert(_el$22, criticalThresholdSignal);
    insertNode(_el$23, _el$24);
    insertNode(_el$23, _el$26);
    setProp(_el$23, "height", infoFontSize);
    insertNode(_el$24, createTextNode("targetThreshold:"));
    setProp(_el$24, "fontSize", infoFontSize);
    setProp(_el$24, "style", fpsLabel);
    setProp(_el$26, "fontSize", infoFontSize);
    setProp(_el$26, "style", fpsLabel);
    setProp(_el$26, "x", 230);
    insert(_el$26, targetThresholdSignal);
    insertNode(_el$27, _el$28);
    insertNode(_el$27, _el$30);
    setProp(_el$27, "height", infoFontSize);
    insertNode(_el$28, createTextNode("renderableMemUsed:"));
    setProp(_el$28, "fontSize", infoFontSize);
    setProp(_el$28, "style", fpsLabel);
    setProp(_el$30, "fontSize", infoFontSize);
    setProp(_el$30, "style", fpsLabel);
    setProp(_el$30, "x", 230);
    insert(_el$30, renderableMemUsedSignal);
    insertNode(_el$31, _el$32);
    insertNode(_el$31, _el$34);
    setProp(_el$31, "height", infoFontSize);
    insertNode(_el$32, createTextNode("memUsed:"));
    setProp(_el$32, "fontSize", infoFontSize);
    setProp(_el$32, "style", fpsLabel);
    setProp(_el$34, "fontSize", infoFontSize);
    setProp(_el$34, "style", fpsLabel);
    setProp(_el$34, "x", 230);
    insert(_el$34, memUsedSignal);
    insertNode(_el$35, _el$36);
    insertNode(_el$35, _el$38);
    setProp(_el$35, "height", infoFontSize);
    insertNode(_el$36, createTextNode("renderableTexturesLoaded:"));
    setProp(_el$36, "fontSize", infoFontSize);
    setProp(_el$36, "style", fpsLabel);
    setProp(_el$38, "fontSize", infoFontSize);
    setProp(_el$38, "style", fpsLabel);
    setProp(_el$38, "x", 230);
    insert(_el$38, () => renderableTexturesLoadedSignal().toString());
    insertNode(_el$39, _el$40);
    insertNode(_el$39, _el$42);
    setProp(_el$39, "height", infoFontSize);
    insertNode(_el$40, createTextNode("loadedTextures:"));
    setProp(_el$40, "fontSize", infoFontSize);
    setProp(_el$40, "style", fpsLabel);
    setProp(_el$42, "fontSize", infoFontSize);
    setProp(_el$42, "style", fpsLabel);
    setProp(_el$42, "x", 230);
    insert(_el$42, () => loadedTexturesSignal().toString());
    return _el$;
  })();
};
const SAFETY_MARGIN = 10;
function MarqueeText(props) {
  const speed = createMemo(() => props.speed || 200);
  const delay2 = createMemo(() => {
    var _a2;
    return (_a2 = props.delay) != null ? _a2 : 1e3;
  });
  const scrollGap = createMemo(() => {
    var _a2;
    return (_a2 = props.scrollGap) != null ? _a2 : props.clipWidth * 0.5;
  });
  const [textWidth, setTextWidth] = createSignal(0);
  const isTextOverflowing = createMemo(() => textWidth() > props.clipWidth - SAFETY_MARGIN);
  const shouldScroll = createMemo(() => props.marquee && isTextOverflowing());
  const wasFocusedBefore = createMemo((p) => p || props.marquee, false);
  createEffect(() => {
    if (shouldScroll()) {
      let options = {
        duration: (textWidth() + scrollGap()) / speed() * 1e3,
        delay: delay2(),
        loop: true,
        easing: props.easing
      };
      text1.lng.x = 0;
      text2.lng.x = textWidth() + scrollGap();
      let a1 = text1.lng.animate({
        x: -textWidth() - scrollGap()
      }, options).start();
      let a2 = text2.lng.animate({
        x: 0
      }, options).start();
      onCleanup(() => {
        a1.stop();
        a2.stop();
      });
    }
  });
  const events = {
    loaded(el) {
      setTextWidth(el.width);
    }
  };
  let text1;
  let text2;
  return [memo(() => memo(() => !!wasFocusedBefore())() && [(() => {
    var _el$2 = createElement("text");
    var _ref$ = text1;
    typeof _ref$ === "function" ? use(_ref$, _el$2) : text1 = _el$2;
    spread(_el$2, mergeProps(props, {
      get hidden() {
        return !shouldScroll();
      },
      "rtt": true,
      "maxLines": 1,
      "onEvent": events
    }), false);
    return _el$2;
  })(), (() => {
    var _el$3 = createElement("text");
    var _ref$2 = text2;
    typeof _ref$2 === "function" ? use(_ref$2, _el$3) : text2 = _el$3;
    spread(_el$3, mergeProps(props, {
      get hidden() {
        return !shouldScroll();
      },
      "rtt": true,
      "maxLines": 1
    }), false);
    return _el$3;
  })()]), (() => {
    var _el$ = createElement("text");
    spread(_el$, mergeProps(props, {
      "maxLines": 1,
      get hidden() {
        return shouldScroll();
      },
      "contain": "width"
    }), false);
    return _el$;
  })()];
}
function Marquee(props) {
  const [clipWidth, setClipWidth] = createSignal(props.width || 0);
  const clipHeight = createMemo(() => {
    var _a2, _b;
    return props.height || ((_a2 = props.textProps) == null ? void 0 : _a2.lineHeight) || (((_b = props.textProps) == null ? void 0 : _b.fontSize) || 16) * 1.5;
  });
  return (() => {
    var _el$4 = createElement("view");
    spread(_el$4, mergeProps(props, {
      get height() {
        return clipHeight();
      },
      "onLayout": chainFunctions(props.onLayout, (e) => setClipWidth(e.width)),
      get clipping() {
        return props.marquee;
      }
    }), true);
    insert(_el$4, createComponent(MarqueeText, mergeProps(() => props.textProps, {
      get marquee() {
        return props.marquee;
      },
      get clipWidth() {
        return clipWidth();
      },
      get speed() {
        return props.speed;
      },
      get delay() {
        return props.delay;
      },
      get scrollGap() {
        return props.scrollGap;
      },
      get easing() {
        return props.easing;
      },
      get children() {
        return props.children;
      }
    })));
    return _el$4;
  })();
}
const FocusStackContext = createContext(void 0);
function FocusStackProvider(props) {
  const [_focusStack, setFocusStack] = createSignal([]);
  function storeFocus(element, prevElement) {
    setFocusStack((stack) => [...stack, prevElement || element]);
  }
  function restoreFocus() {
    let wasFocused = false;
    setFocusStack((stack) => {
      const prevElement = stack.pop();
      if (prevElement && typeof prevElement.setFocus === "function") {
        prevElement.setFocus();
        wasFocused = true;
      }
      return [...stack];
    });
    return wasFocused;
  }
  function clearFocusStack() {
    setFocusStack([]);
  }
  return createComponent(FocusStackContext.Provider, {
    value: {
      storeFocus,
      restoreFocus,
      clearFocusStack
    },
    get children() {
      return props.children;
    }
  });
}
function useFocusStack() {
  const context = useContext(FocusStackContext);
  if (!context) {
    throw new Error("useFocusStack must be used within a FocusStackProvider");
  }
  return context;
}
function createSpriteMap(src, subTextures) {
  const spriteMapTexture = renderer$1.createTexture("ImageTexture", {
    src
  });
  return subTextures.reduce((acc, t) => {
    const { x, y, width, height } = t;
    acc[t.name] = renderer$1.createTexture("SubTexture", {
      texture: spriteMapTexture,
      x,
      y,
      width,
      height
    });
    return acc;
  }, {});
}
const App = (props) => {
  useFocusManager({
    Announcer: ["a"],
    Menu: ["m"],
    Escape: ["Escape", 27],
    Backspace: ["Backspace", 8],
    Back: ["b"],
    Left: ["ArrowLeft", 37],
    Right: ["ArrowRight", 39],
    Up: ["ArrowUp", 38],
    Down: ["ArrowDown", 40],
    Enter: ["Enter", 13]
  }, {
    userKeyHoldMap: {
      EnterHold: ["Enter", 13],
      BackHold: ["b", 66]
    },
    holdThreshold: 1e3
  });
  return props.children;
};
const theme = {
  layout: {
    gutterX: 20,
    marginX: 150,
    screenW: 1920
  },
  typography: {
    display2: {
      fontFamily: "Arial",
      fontSize: 50,
      lineHeight: 60,
      fontWeight: 500,
      verticalAlign: "middle",
      textBaseline: "bottom"
    },
    body1: {
      fontFamily: "Arial",
      fontSize: 25,
      fontWeight: 300,
      lineHeight: 40,
      verticalAlign: "middle",
      textBaseline: "bottom"
    },
    body2: {
      fontFamily: "Arial",
      fontSize: 22,
      fontWeight: 300,
      lineHeight: 32,
      verticalAlign: "middle",
      textBaseline: "bottom"
    }
  },
  color: {
    materialBrand: 13311
  }
};
const params = new URLSearchParams(window.location.search);
const roundPoster = params.get("roundPoster") !== "false";
const styles$1 = {
  itemsContainer: {
    width: theme.layout.screenW,
    height: 800,
    y: 560,
    x: 0,
    zIndex: 2
  },
  Thumbnail: {
    width: 185,
    height: 278,
    scale: 1,
    zIndex: 2,
    transition: {
      scale: { duration: 250, easing: "linear" },
      border: { duration: 250, easing: "linear" }
    },
    borderRadius: roundPoster ? 16 : 0,
    border: { width: 0, color: 0 },
    $focus: {
      scale: 1.1,
      border: { color: 743406824, width: 8 }
    }
  },
  RowTitle: {
    height: 60,
    width: 300,
    marginBottom: -40,
    fontSize: 36,
    color: 4042322175,
    zIndex: 2
  },
  Row: {
    display: "flex",
    justifyContent: "spaceBetween",
    height: 300
  },
  Column: {
    display: "flex",
    flexDirection: "column",
    justifyContent: "flexStart",
    flexBoundary: "contain",
    gap: 64,
    width: theme.layout.screenW - 2 * theme.layout.marginX,
    x: theme.layout.marginX + theme.layout.gutterX,
    y: 48,
    transition: { y: { duration: 250, easing: "ease-in-out" } },
    zIndex: 2
  },
  peopleBio: {
    ...theme.typography.body1,
    fontFamily: "Roboto",
    fontWeight: "normal",
    contain: "both",
    width: 780,
    height: 340
  }
};
const Button$1 = {
  width: 300,
  height: 90,
  color: 842150604,
  $focus: {
    color: 4294967295
  }
};
({
  width: Button$1.width + 8
});
const ButtonText = {
  fontSize: 26,
  lineHeight: Button$1.height,
  contain: "width",
  textAlign: "center",
  height: Button$1.height,
  width: Button$1.width,
  color: 4294967295,
  $focus: {
    color: 255
  }
};
const buttonStyles = {
  container: Button$1,
  text: ButtonText
};
const MaterialButton = {
  width: 386,
  height: 136
};
const MaterialButtonText = {
  fontSize: 32,
  contain: "width",
  textAlign: "center",
  mountY: -0.35,
  color: 4294967295,
  height: MaterialButton.height,
  width: MaterialButton.width,
  // lineHeight: MaterialButton.height, // TODO: Add back when lineHeight is supported
  $focus: {
    fontSize: 40
  },
  $disabled: {
    color: 2425393407
  }
};
function Thumbnail(props) {
  return createComponent(View, mergeProps(props, {
    id: "thumbnail",
    get src() {
      return props.item.src;
    },
    get item() {
      return props.item;
    },
    get announce() {
      return [props.item.title, "PAUSE-1", props.item.overview];
    },
    get style() {
      return styles$1.Thumbnail;
    }
  }));
}
function TileRow(props) {
  return createComponent(Row, mergeProps(props, {
    get style() {
      return styles$1.Row;
    },
    get children() {
      return createComponent(Index, {
        get each() {
          return props.items;
        },
        children: (item, index) => createComponent(Thumbnail, {
          get item() {
            return item();
          },
          get announceContext() {
            return "".concat(index + 1, " of ").concat(props.items.length);
          }
        })
      });
    }
  }));
}
function Button(props) {
  return createComponent(View, mergeProps(props, {
    get announce() {
      return [props.children, "button"];
    },
    forwardStates: true,
    get style() {
      return buttonStyles.container;
    },
    get children() {
      return createComponent(Text$1, {
        get style() {
          return buttonStyles.text;
        },
        get children() {
          return props.children;
        }
      });
    }
  }));
}
function AssetPanel(props) {
  let panelRef, actionRef;
  createEffect(() => {
    if (props.open) {
      panelRef.animate({
        x: 1470
      }, {
        duration: 400,
        easing: "ease-in-out"
      }).start();
      actionRef.setFocus();
    } else if (panelRef.rendered) {
      panelRef.animate({
        x: 1920
      }, {
        duration: 400,
        easing: "ease-in-out"
      }).start();
    }
  });
  return createComponent(View, mergeProps(props, {
    x: 1920,
    ref(r$) {
      var _ref$ = panelRef;
      typeof _ref$ === "function" ? _ref$(r$) : panelRef = r$;
    },
    color: 255,
    width: 450,
    height: 1080,
    zIndex: 5,
    get children() {
      return [createComponent(Text$1, {
        x: 75,
        y: 50,
        fontSize: 32,
        get children() {
          var _a2;
          return (_a2 = props.item) == null ? void 0 : _a2.title;
        }
      }), createComponent(Column, {
        ref(r$) {
          var _ref$2 = actionRef;
          typeof _ref$2 === "function" ? _ref$2(r$) : actionRef = r$;
        },
        get onLeft() {
          return props.close;
        },
        get onBack() {
          return props.close;
        },
        x: 75,
        y: 200,
        get children() {
          return [createComponent(Button, {
            get onEnter() {
              return props.close;
            },
            children: "Record"
          }), createComponent(Button, {
            get onEnter() {
              return props.close;
            },
            children: "Watch"
          }), createComponent(Button, {
            get onEnter() {
              return props.close;
            },
            children: "Close"
          })];
        }
      })];
    }
  }));
}
const heroTransition = {
  duration: 300,
  easing: "cubic-bezier(0.20, 1.00, 0.80, 1.00)"
};
const titleRowStyles = {
  fontFamily: "Raleway",
  fontSize: 24,
  height: 32,
  lineHeight: 32
};
function TitleRow(props) {
  return createComponent(View, {
    get height() {
      return props.height;
    },
    forwardFocus: 1,
    marginTop: 30,
    get children() {
      return [createComponent(Text$1, {
        skipFocus: true,
        style: titleRowStyles,
        get children() {
          return props.title;
        }
      }), createComponent(LazyRow, {
        gap: 20,
        upCount: 11,
        sync: true,
        get each() {
          return props.items;
        },
        y: 50,
        children: (item) => createComponent(Dynamic, {
          get component() {
            return typeToComponent[props.row.type];
          },
          get item() {
            return item();
          }
        })
      })];
    }
  });
}
const posterStyles = {
  width: 185,
  height: 278,
  scale: 1,
  zIndex: 2,
  color: 2964369663,
  //borderRadius: 8,
  transition: {
    scale: {
      duration: 200,
      easing: "linear"
    }
  },
  $focus: {
    scale: 1.1,
    color: 4294967295
  }
};
function Poster(props) {
  return createComponent(View, mergeProps({
    get src() {
      var _a2;
      return (_a2 = props.item) == null ? void 0 : _a2.src;
    },
    get backdrop() {
      var _a2;
      return (_a2 = props.item) == null ? void 0 : _a2.backdrop;
    }
  }, props, {
    onFail: (node) => node.src = "failback.png",
    style: posterStyles
  }));
}
const posterTitleStyles = {
  fontFamily: "Raleway",
  fontSize: 22,
  lineHeight: 22,
  height: 22,
  x: 10,
  y: 278,
  contain: "width",
  width: 185,
  maxLines: 2,
  alpha: 0,
  $focus: {
    alpha: 1,
    y: 288
  },
  transition: {
    y: heroTransition,
    alpha: heroTransition
  }
};
function PosterTitle(props) {
  return createComponent(View, mergeProps({
    get src() {
      var _a2;
      return (_a2 = props.item) == null ? void 0 : _a2.src;
    },
    get backdrop() {
      var _a2;
      return (_a2 = props.item) == null ? void 0 : _a2.backdrop;
    }
  }, props, {
    onFail: (node) => node.src = "failback.png",
    style: posterStyles,
    forwardStates: true,
    get children() {
      return createComponent(Text$1, {
        style: posterTitleStyles,
        get children() {
          var _a2;
          return (_a2 = props.item) == null ? void 0 : _a2.title;
        }
      });
    }
  }));
}
const heroStyles = {
  width: 1280,
  height: 720,
  scale: 1,
  zIndex: 2,
  colorTop: 4294967295,
  colorBottom: 255,
  //borderRadius: 8,
  transition: {
    scale: heroTransition
  },
  $focus: {
    scale: 1.05
  }
};
const heroTextStyles = {
  fontFamily: "Raleway",
  contain: "width"
};
function Hero(props) {
  const [hasFocus, setHasFocus] = createSignal(false);
  return createComponent(View, mergeProps(props, {
    get src() {
      return props.item.backdrop;
    },
    style: heroStyles,
    onFocusChanged: setHasFocus,
    forwardStates: true,
    get children() {
      return createComponent(View, {
        transition: {
          alpha: heroTransition
        },
        get alpha() {
          return hasFocus() ? 1 : 0;
        },
        get children() {
          return [createComponent(View, {
            width: 185,
            height: 278,
            x: 54,
            y: 220,
            get src() {
              return props.item.src;
            }
          }), createComponent(Text$1, {
            y: 520,
            x: 54,
            fontSize: 64,
            width: 1e3,
            maxLines: 1,
            style: heroTextStyles,
            get children() {
              return props.item.title;
            }
          }), createComponent(Text$1, {
            y: 620,
            x: 60,
            fontSize: 21,
            width: 1e3,
            maxLines: 2,
            lineHeight: 36,
            color: 3435973887,
            style: heroTextStyles,
            get children() {
              return props.item.overview;
            }
          })];
        }
      });
    }
  }));
}
const typeToComponent = {
  Poster,
  Hero,
  PosterTitle
};
const BlockStyle = {
  alpha: 0.85,
  border: {
    width: 0,
    color: 255
  },
  $focus: {
    border: {
      width: 4,
      color: 4294967295
    },
    alpha: 1
  }
};
function Block(props) {
  return createComponent(View, mergeProps(props, {
    width: 100,
    height: 100,
    style: BlockStyle,
    get color() {
      return props.color || 3772834047;
    }
  }));
}
const [globalBackground, setGlobalBackground] = createSignal("");
function createInfiniteScroll(fetcher) {
  const [pages, setPages] = createSignal([]);
  const [page, setPage] = createSignal(1);
  const [end, setEnd] = createSignal(false);
  const [contents] = createResource(page, fetcher);
  createComputed(() => {
    const content = contents();
    if (!content) return;
    batch(() => {
      if (content.length === 0) setEnd(true);
      setPages((p) => [...p, ...content]);
    });
  });
  return {
    pages,
    page,
    setPage,
    setPages,
    end,
    setEnd
  };
}
const blockWidth = 900;
const ContentBlockStyle = {
  display: "flex",
  flexDirection: "column",
  flexBoundary: "fixed",
  width: blockWidth,
  height: 220,
  gap: 16
};
const HeadlineStyles = {
  ...theme.typography.display2,
  fontFamily: "Roboto",
  fontWeight: 700,
  maxLines: 1,
  width: blockWidth
};
const Headline = (props) => createComponent(Marquee, mergeProps(props, {
  textProps: HeadlineStyles
}));
const DescriptionStyles = {
  ...theme.typography.body1,
  fontFamily: "Roboto",
  fontWeight: 400,
  lineHeight: 32,
  width: blockWidth,
  maxLines: 3,
  contain: "width"
};
const BadgeStyle = {
  fontSize: 16,
  lineHeight: 20,
  marginLeft: 13,
  marginRight: 13
};
const Description = (props) => createComponent(Text$1, mergeProps(props, {
  style: DescriptionStyles,
  get children() {
    return props.children;
  }
}));
const Badge = (props) => {
  return createComponent(View, mergeProps(props, {
    style: {
      color: "0x00000099",
      borderRadius: 8,
      border: {
        width: 2,
        color: "0xffffffff"
      },
      display: "flex",
      height: 36
    },
    get children() {
      return createComponent(Text$1, {
        lineHeight: 36,
        style: BadgeStyle,
        get children() {
          return props.children;
        }
      });
    }
  }));
};
const MetaTextStyle = {
  ...theme.typography.body2,
  fontFamily: "Roboto",
  fontWeight: 400
};
const Metadata = (props) => createComponent(View, {
  style: {
    display: "flex",
    flexDirection: "row",
    gap: 18,
    width: blockWidth,
    height: 48
  },
  get children() {
    return [createComponent(View, {
      y: -4,
      src: "./assets/stars.png",
      width: 188,
      height: 31
    }), createComponent(View, {
      y: -4,
      flexItem: false,
      clipping: true,
      get width() {
        return 188 * props.voteAverage / 10;
      },
      height: 31,
      get children() {
        return createComponent(View, {
          src: "./assets/stars-full.png",
          width: 188,
          height: 31
        });
      }
    }), createComponent(Text$1, {
      style: MetaTextStyle,
      get children() {
        return [memo(() => props.voteCount), " reviews"];
      }
    }), createComponent(Text$1, {
      style: MetaTextStyle,
      get children() {
        return props.metaText;
      }
    }), createComponent(For, {
      get each() {
        return props.badges;
      },
      children: (item) => createComponent(Badge, {
        y: -5,
        children: item
      })
    })];
  }
});
const ContentBlock = (props) => createComponent(View, mergeProps({
  id: "contentBlock",
  style: ContentBlockStyle
}, props, {
  get children() {
    return [createComponent(Headline, {
      get marquee() {
        return props.marquee;
      },
      get children() {
        return props.content.title;
      }
    }), createComponent(Description, {
      get children() {
        return props.content.description;
      }
    }), createComponent(Show, {
      get when() {
        return props.content.voteCount;
      },
      get children() {
        return createComponent(Metadata, {
          get metaText() {
            return props.content.metaText;
          },
          get badges() {
            return props.content.badges;
          },
          get voteCount() {
            return props.content.voteCount;
          },
          get voteAverage() {
            return props.content.voteAverage;
          }
        });
      }
    })];
  }
}));
const Browse = (props) => {
  const [columnY, setcolumnY] = createSignal(0);
  const preload2 = usePreloadRoute();
  const [heroContent, setHeroContent] = createSignal({});
  const navigate = useNavigate();
  let firstRun = true;
  const provider = createMemo(() => {
    return createInfiniteScroll(props.data());
  });
  const delayedBackgrounds = debounce((img) => setGlobalBackground(img), 800);
  const delayedHero = debounce((content) => setHeroContent(content || {}), 600);
  createEffect(on(activeElement, (elm) => {
    if (!elm) return;
    const item = elm.item || {};
    if (firstRun) {
      if (item.backdrop) {
        setGlobalBackground(item.backdrop);
      }
      if (item.heroContent) {
        setHeroContent(item.heroContent);
      }
      preload2("/browse/tv", {
        preloadData: true
      });
      preload2("/browse/movie", {
        preloadData: true
      });
      firstRun = false;
      return;
    }
    if (item.href) {
      preload2(item.href, {
        preloadData: true
      });
    }
    if (item.backdrop) {
      delayedBackgrounds(item.backdrop);
    }
    if (item.heroContent) {
      delayedHero(item.heroContent);
    }
  }, {
    defer: true
  }));
  function onRowFocus() {
    this.children[this.selected || 0].setFocus();
    setcolumnY((this.y || 0) * -1 + 24);
    let numPages = provider().pages().length;
    this.parent.selected = this.parent.children.indexOf(this);
    if (numPages === 0 || this.parent.selected && this.parent.selected >= numPages - 2) {
      provider().setPage((p) => p + 1);
    }
  }
  function onEnter() {
    var _a2;
    this.display = "flex";
    let entity = this.children.find((c) => c.states.has("focus"));
    assertTruthy(entity && ((_a2 = entity.item) == null ? void 0 : _a2.href));
    navigate(entity.item.href);
    return true;
  }
  return createComponent(Show, {
    get when() {
      return provider().pages().length;
    },
    get children() {
      return [createComponent(ContentBlock, {
        y: 360,
        x: 162,
        get content() {
          return heroContent();
        }
      }), createComponent(View, {
        clipping: true,
        get style() {
          return styles$1.itemsContainer;
        },
        get children() {
          return createComponent(Column, {
            id: "BrowseColumn",
            plinko: true,
            get announce() {
              return "All Trending ".concat(props.params.filter);
            },
            get y() {
              return columnY();
            },
            scroll: "none",
            autofocus: true,
            get style() {
              return styles$1.Column;
            },
            get children() {
              return createComponent(For, {
                get each() {
                  return provider().pages();
                },
                children: (items) => createComponent(TileRow, {
                  id: "TileRow",
                  items,
                  width: 1620,
                  onFocus: onRowFocus,
                  onEnter,
                  announceContext: "Press LEFT or RIGHT to review items, press UP or DOWN to review categories, press CENTER to select"
                })
              });
            }
          });
        }
      })];
    }
  });
};
const TMDB = (props) => {
  const [heroContent, setHeroContent] = createSignal({});
  const [openPanel, setOpenPanel] = createSignal(false);
  const {
    storeFocus,
    restoreFocus
  } = useFocusStack();
  let contentBlock, solidLogo, firstRun = true;
  const delayedBackgrounds = debounce(setGlobalBackground, 800);
  const delayedHero = debounce((content) => setHeroContent(content || {}), 600);
  createEffect(on(activeElement, (elm) => {
    if (!elm) return;
    const item = elm.item || {};
    if (firstRun) {
      item.backdrop && setGlobalBackground(item.backdrop);
      item.heroContent && setHeroContent(item.heroContent);
      firstRun = false;
    } else {
      item.backdrop && delayedBackgrounds(item.backdrop);
      item.heroContent && delayedHero(item.heroContent);
    }
  }, {
    defer: true
  }));
  function onSelectedChanged(selectedIndex, column, row) {
    const values = selectedIndex === 0 ? {
      y: 300,
      alpha: 1
    } : {
      y: 200,
      alpha: 0
    };
    contentBlock.animate(values, {
      duration: 300,
      easing: "ease-in-out"
    }).start();
    const values2 = selectedIndex === 0 ? {
      y: 80,
      alpha: 1
    } : {
      y: 0,
      alpha: 0
    };
    solidLogo.animate(values2, {
      duration: 300,
      easing: "ease-in-out"
    }).start();
  }
  return createComponent(View, {
    forwardFocus: 2,
    get children() {
      return [createComponent(View, {
        ref(r$) {
          var _ref$ = solidLogo;
          typeof _ref$ === "function" ? _ref$(r$) : solidLogo = r$;
        },
        width: 300,
        height: 150,
        x: 162,
        y: 80,
        zIndex: 105,
        get children() {
          return [createComponent(Text$1, {
            x: 80,
            fontSize: 28,
            color: 4143380121,
            children: "Built With:"
          }), createComponent(View, {
            y: 32,
            src: "./assets/solidWord.png",
            width: 280,
            height: 52
          }), createComponent(View, {
            x: 0,
            y: 110,
            src: "./assets/tmdb.png",
            width: 80,
            height: 41
          }), createComponent(Text$1, {
            x: 90,
            y: 110,
            contain: "width",
            width: 160,
            fontSize: 12,
            color: 4143380121,
            children: "This product uses the TMDB API but is not endorsed or certified by TMDB."
          })];
        }
      }), createComponent(ContentBlock, {
        ref(r$) {
          var _ref$2 = contentBlock;
          typeof _ref$2 === "function" ? _ref$2(r$) : contentBlock = r$;
        },
        y: 300,
        x: 162,
        get content() {
          return heroContent();
        }
      }), createComponent(LazyColumn, {
        y: 500,
        upCount: 3,
        get each() {
          return props.data.rows;
        },
        id: "BrowseColumn",
        onSelectedChanged,
        onEnter: () => setOpenPanel(true),
        get autofocus() {
          return props.data.rows[0].items();
        },
        gap: 40,
        transition: {
          y: {
            duration: 300,
            easing: "ease-in-out"
          }
        },
        get style() {
          return styles$1.Column;
        },
        children: (row) => row().type === "Hero" ? createComponent(LazyRow, {
          gap: 80,
          upCount: 3,
          scroll: "center",
          centerScroll: true,
          get each() {
            return row().items();
          },
          y: 50,
          get height() {
            return row().height;
          },
          children: (item) => createComponent(Hero, {
            get item() {
              return item();
            }
          })
        }) : createComponent(TitleRow, {
          get row() {
            return row();
          },
          get title() {
            return row().title;
          },
          get height() {
            return row().height;
          },
          get items() {
            return row().items();
          }
        })
      }), createComponent(AssetPanel, {
        onFocus: storeFocus,
        close: () => {
          setOpenPanel(false);
          restoreFocus();
          return true;
        },
        get open() {
          return openPanel();
        },
        get item() {
          return heroContent();
        }
      })];
    }
  });
};
const Destroy = (props) => {
  const [heroContent, setHeroContent] = createSignal();
  const [heroIndex, setHeroIndex] = createSignal(0);
  onMount(() => setGlobalBackground(858993663));
  createEffect(on([props.data.heroRow.items, heroIndex], ([heros, index]) => {
    if (heros) setHeroContent(heros[index]);
    if (heros && index < heros.length - 1) {
      const img = new Image();
      img.crossOrigin = "anonymous";
      img.src = heros[index + 1].backdrop;
    }
  }));
  function onDown2() {
    if (heroIndex() >= 19) return false;
    setHeroIndex((p) => p + 1);
  }
  function onUp2() {
    if (heroIndex() === 0) return false;
    setHeroIndex((p) => p - 1);
    return true;
  }
  function animateOut(node) {
    return node.animate({
      y: 200,
      alpha: 0
    }, {
      duration: 500,
      easing: "ease-in-out"
    }).start().waitUntilStopped();
  }
  function animateIn(node) {
    node.alpha = 0;
    node.y = -100;
    return node.animate({
      y: 0,
      alpha: 1
    }, {
      duration: 500,
      easing: "ease-in-out"
    }).start().waitUntilStopped();
  }
  return createComponent(View, {
    x: 300,
    y: 200,
    onDown: onDown2,
    onUp: onUp2,
    get children() {
      return [createComponent(View, {
        src: "assets/up.svg",
        width: 350,
        height: 200,
        x: 450,
        y: -200,
        get rotation() {
          return Math.PI;
        }
      }), createComponent(Show, {
        get when() {
          return heroContent();
        },
        keyed: true,
        get children() {
          return createComponent(Hero, {
            id: "Hero",
            autofocus: true,
            onDestroy: animateOut,
            onCreate: animateIn,
            get item() {
              return heroContent();
            },
            get title() {
              return heroContent().title;
            }
          });
        }
      })];
    }
  });
};
const API_KEY_V4 = "eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiIyZDE4YjEwMTA0YjdiZTlkNjFiMWYwYjVlMGEwNzM2OCIsInN1YiI6IjYwZTVjMTdlNGNhNjc2MDA3NTA4Njc3MSIsInNjb3BlcyI6WyJhcGlfcmVhZCJdLCJ2ZXJzaW9uIjoxfQ.D_nqH9kd-bhhWzeVsTDPYhHnsUaNAuyAa6YATmKHqsA";
const API_BASE = "https://api.themoviedb.org/3";
let tmdbConfig;
let baseImageUrl;
const urlParams$1 = new URLSearchParams(window.location.search);
const basePosterSize = urlParams$1.get("posterSize") || "w185";
const defaultFetchParams = {
  headers: {
    "Content-Type": "application/json",
    Authorization: "Bearer " + API_KEY_V4
  }
};
function getImageUrl(path, posterSize = basePosterSize) {
  return baseImageUrl + posterSize + path;
}
function get(path, params2 = {}) {
  if (tmdbConfig) {
    return _get(path, params2);
  } else {
    return loadConfig().then(() => _get(path, params2));
  }
}
function _get(path, params2 = {}) {
  return fetch(API_BASE + path, {
    ...defaultFetchParams,
    ...params2
  }).then((r) => r.json());
}
function loadConfig() {
  return _get("/configuration").then((data) => {
    var _a2;
    tmdbConfig = data;
    baseImageUrl = (_a2 = data.images) == null ? void 0 : _a2.secure_base_url;
    return data;
  });
}
const api = {
  get,
  loadConfig
};
function truncateString(str, maxLength) {
  if (str.length > maxLength) {
    return str.substring(0, maxLength - 3) + "...";
  }
  return str;
}
function chunkArray(array, size = 7) {
  let result = [];
  for (let i = 0, j = array.length; i < j; i += size) {
    result.push(array.slice(i, i + size));
  }
  return result;
}
function convertItemsToTiles(items = []) {
  return items.map((item) => ({
    src: getImageUrl(item.poster_path || item.profile_path),
    tileSrc: getImageUrl(item.backdrop_path || item.profile_path, "w300"),
    backdrop: getImageUrl(item.backdrop_path, "w1280"),
    href: "/entity/".concat(item.media_type || "people", "/").concat(item.id),
    shortTitle: truncateString(item.title || item.name, 30),
    title: item.title || item.name,
    overview: item.overview,
    item,
    entityInfo: {
      type: item.media_type || "people",
      id: item.id
    },
    heroContent: {
      title: item.title || item.name,
      description: item.overview
    }
  }));
}
const handleResults = (response) => {
  return response.then(({ results }) => {
    let filteredItems = results.filter((r) => !r.adult);
    return convertItemsToTiles(filteredItems);
  });
};
const fetchPopular = (type) => {
  return handleResults(api.get("/".concat(type, "/popular")));
};
let genreListCache;
const fetchGenreMovies = (genres) => {
  const genreList = genreListCache || (genreListCache = api.get("/genre/movie/list"));
  const targetGenre = Array.isArray(genres) ? genres : [genres];
  return genreList.then(({ genres: genres2 }) => {
    let targetGenreIds = [];
    genres2.forEach((item) => {
      if (targetGenre.includes(item.name)) targetGenreIds.push(item.id);
    });
    return handleResults(
      api.get("/discover/movie?with_genres=".concat(targetGenreIds.join()))
    );
  });
};
function destroyData() {
  const heroRow = {
    title: "Best Adventure and Action movies",
    items: createResource(() => fetchGenreMovies(["adventure", "action"]))[0],
    type: "Hero",
    height: 800
  };
  return {
    heroRow
  };
}
function tmdbData() {
  const rows = [];
  const popularMovies = createResource(() => fetchPopular("movie"));
  rows.push({
    title: "Popular Movies",
    items: popularMovies[0],
    setItems: popularMovies[1].mutate,
    type: "Poster",
    height: 328
  });
  rows.push({
    title: "Best Western movies",
    items: createResource(() => fetchGenreMovies(["Western"]))[0],
    type: "Hero",
    height: 720
  });
  rows.push({
    title: "Best Comedy movies",
    items: createResource(() => fetchGenreMovies(["Comedy"]))[0],
    type: "PosterTitle",
    height: 400
  });
  rows.push({
    title: "Popular TV shows",
    items: createResource(() => fetchPopular("tv"))[0],
    type: "PosterTitle",
    height: 400
  });
  const heroRow = {
    title: "Best Adventure and Action movies",
    items: createResource(() => fetchGenreMovies(["adventure", "action"]))[0],
    type: "Hero",
    height: 720
  };
  rows.push(heroRow);
  rows.push({
    title: "Best Documentaries",
    items: createResource(() => fetchGenreMovies("Documentary"))[0],
    type: "PosterTitle",
    height: 400
  });
  rows.push({
    title: "Best Western movies 2",
    items: createResource(() => fetchGenreMovies("Western"))[0],
    type: "PosterTitle",
    height: 400
  });
  return {
    rows
  };
}
const NotFound = () => {
  return (() => {
    var _el$ = createElement("node");
    setProp(_el$, "style", {
      width: 1920,
      height: 1080,
      color: 868483072
    });
    return _el$;
  })();
};
const basePath$1 = "/solid-demo-app/";
const fonts = [
  {
    type: "msdf",
    fontFamily: "Roboto",
    descriptors: {
      weight: 700
    },
    atlasDataUrl: basePath$1 + "fonts/Roboto-Bold.msdf.json",
    atlasUrl: basePath$1 + "fonts/Roboto-Bold.msdf.png"
  },
  {
    type: "msdf",
    fontFamily: "Roboto",
    descriptors: {
      weight: 400
    },
    atlasDataUrl: basePath$1 + "fonts/Roboto-Regular.msdf.json",
    atlasUrl: basePath$1 + "fonts/Roboto-Regular.msdf.png"
  },
  {
    type: "msdf",
    fontFamily: "Arial",
    descriptors: {
      weight: 500
    },
    atlasDataUrl: basePath$1 + "fonts/Roboto-Regular.msdf.json",
    atlasUrl: basePath$1 + "fonts/Roboto-Regular.msdf.png"
  },
  {
    type: "msdf",
    fontFamily: "Raleway",
    descriptors: {
      weight: 800
    },
    atlasDataUrl: basePath$1 + "fonts/Raleway-ExtraBold.msdf.json",
    atlasUrl: basePath$1 + "fonts/Raleway-ExtraBold.msdf.png"
  },
  {
    fontFamily: "Roboto",
    fontUrl: basePath$1 + "fonts/Roboto-Regular.ttf"
  }
];
let cache = /* @__PURE__ */ new Map();
const leftoverTiles = /* @__PURE__ */ new Map();
function browseProvider(filter) {
  return (pageIndex) => {
    const url = "/trending/".concat(filter, "/week?page=").concat(pageIndex);
    if (cache.has(url)) {
      return cache.get(url);
    }
    let result = api.get(url).then((trending) => {
      let results = trending.results.filter((r) => !r.adult);
      let tiles = (leftoverTiles.has(filter) ? leftoverTiles.get(filter) : []).concat(convertItemsToTiles(results));
      let chunks = chunkArray(tiles);
      if (chunks[chunks.length - 1].length < 7) {
        leftoverTiles.set(filter, chunks.pop());
      } else {
        leftoverTiles.delete(filter);
      }
      return chunks;
    });
    cache.set(url, result);
    return result;
  };
}
function browsePreload({ params: params2 }) {
  return createMemo(() => {
    const provider = browseProvider(params2.filter || "all");
    provider(1);
    return provider;
  });
}
function minutesToHMM(minutes) {
  const hours = Math.floor(minutes / 60);
  const remainingMinutes = minutes % 60;
  return hours + "h " + (remainingMinutes < 10 ? "0" : "") + remainingMinutes + "min";
}
function formatDate(dateString) {
  const parts = dateString.split("-");
  return parts[1] + "/" + parts[2] + "/" + parts[0];
}
function justYear(dateString) {
  const parts = (dateString == null ? void 0 : dateString.split("-")) || [];
  return parts[0] || "";
}
function ensureItems(items, minCount) {
  const remainingCount = minCount - items.length;
  if (remainingCount > 0) {
    return items.concat(Array(remainingCount).fill({}));
  }
  return items;
}
function getRecommendations({ type, id }) {
  return api.get("/".concat(type, "/").concat(id, "/recommendations")).then(({ results }) => {
    if (results.length) {
      return ensureItems(convertItemsToTiles(results.slice(0, 7)), 7);
    }
    return api.get("/trending/".concat(type, "/week?page=1")).then(
      ({ results: results2 }) => ensureItems(convertItemsToTiles(results2.slice(0, 7)), 7)
    );
  });
}
function getCredits({ type, id }) {
  return api.get("/".concat(type, "/").concat(id, "/credits")).then(({ cast: cast2 }) => ensureItems(convertItemsToTiles(cast2.slice(0, 7)), 7));
}
function getInfo({ type, id }) {
  let rt = type === "movie" ? {
    rtCrit: 86,
    rtFan: 92
  } : {};
  return api.get("/".concat(type, "/").concat(id)).then((data) => ({
    backgroundImage: getImageUrl(data.backdrop_path, "w1280"),
    heroContent: {
      title: data.title || data.name,
      description: data.overview,
      badges: ["HD", "CC"],
      voteAverage: data.vote_average,
      voteCount: data.vote_count,
      metaText: type === "movie" ? minutesToHMM(data.runtime) + "   " + formatDate(data.release_date) : "".concat(justYear(data.first_air_date), " - ").concat(justYear(data.last_air_date)),
      reviews: rt
    },
    ...data
  }));
}
function entityPreload({ params: params2, intent: intent2 }) {
  const [entity] = createResource(() => ({ ...params2 }), getInfo);
  if (intent2 === "preload") {
    return;
  }
  const [credits] = createResource(
    () => ({ ...params2 }),
    getCredits
  );
  const [recommendations] = createResource(
    () => ({ ...params2 }),
    getRecommendations
  );
  return { entity, credits, recommendations };
}
var commonjsGlobal = typeof globalThis !== "undefined" ? globalThis : typeof window !== "undefined" ? window : typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : {};
function getDefaultExportFromCjs(x) {
  return x && x.__esModule && Object.prototype.hasOwnProperty.call(x, "default") ? x["default"] : x;
}
var shakaPlayer_compiled = {};
/*
 @license
 Shaka Player
 Copyright 2016 Google LLC
 SPDX-License-Identifier: Apache-2.0
*/
var hasRequiredShakaPlayer_compiled;
function requireShakaPlayer_compiled() {
  if (hasRequiredShakaPlayer_compiled) return shakaPlayer_compiled;
  hasRequiredShakaPlayer_compiled = 1;
  (function(exports) {
    (function() {
      var innerGlobal = typeof window != "undefined" ? window : commonjsGlobal;
      var exportTo = {};
      (function(window2, global2, module) {
        var r;
        function aa(a) {
          var b = 0;
          return function() {
            return b < a.length ? { done: false, value: a[b++] } : { done: true };
          };
        }
        var ba = "function" == typeof Object.defineProperties ? Object.defineProperty : function(a, b, c) {
          if (a == Array.prototype || a == Object.prototype) return a;
          a[b] = c.value;
          return a;
        };
        function ca(a) {
          a = ["object" == typeof globalThis && globalThis, a, "object" == typeof window2 && window2, "object" == typeof self && self, "object" == typeof global2 && global2];
          for (var b = 0; b < a.length; ++b) {
            var c = a[b];
            if (c && c.Math == Math) return c;
          }
          throw Error("Cannot find global object");
        }
        var da = ca(this);
        function ea(a, b) {
          if (b) a: {
            var c = da;
            a = a.split(".");
            for (var d = 0; d < a.length - 1; d++) {
              var e = a[d];
              if (!(e in c)) break a;
              c = c[e];
            }
            a = a[a.length - 1];
            d = c[a];
            b = b(d);
            b != d && null != b && ba(c, a, { configurable: true, writable: true, value: b });
          }
        }
        ea("Symbol", function(a) {
          function b(f) {
            if (this instanceof b) throw new TypeError("Symbol is not a constructor");
            return new c(d + (f || "") + "_" + e++, f);
          }
          function c(f, g) {
            this.g = f;
            ba(this, "description", { configurable: true, writable: true, value: g });
          }
          if (a) return a;
          c.prototype.toString = function() {
            return this.g;
          };
          var d = "jscomp_symbol_" + (1e9 * Math.random() >>> 0) + "_", e = 0;
          return b;
        });
        ea("Symbol.iterator", function(a) {
          if (a) return a;
          a = Symbol("Symbol.iterator");
          for (var b = "Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "), c = 0; c < b.length; c++) {
            var d = da[b[c]];
            "function" === typeof d && "function" != typeof d.prototype[a] && ba(d.prototype, a, { configurable: true, writable: true, value: function() {
              return fa(aa(this));
            } });
          }
          return a;
        });
        function fa(a) {
          a = { next: a };
          a[Symbol.iterator] = function() {
            return this;
          };
          return a;
        }
        function t(a) {
          var b = "undefined" != typeof Symbol && Symbol.iterator && a[Symbol.iterator];
          if (b) return b.call(a);
          if ("number" == typeof a.length) return { next: aa(a) };
          throw Error(String(a) + " is not an iterable or ArrayLike");
        }
        function y(a) {
          if (!(a instanceof Array)) {
            a = t(a);
            for (var b, c = []; !(b = a.next()).done; ) c.push(b.value);
            a = c;
          }
          return a;
        }
        var ha = "function" == typeof Object.create ? Object.create : function(a) {
          function b() {
          }
          b.prototype = a;
          return new b();
        }, ia;
        if ("function" == typeof Object.setPrototypeOf) ia = Object.setPrototypeOf;
        else {
          var ja;
          a: {
            var la = { a: true }, ma = {};
            try {
              ma.__proto__ = la;
              ja = ma.a;
              break a;
            } catch (a) {
            }
            ja = false;
          }
          ia = ja ? function(a, b) {
            a.__proto__ = b;
            if (a.__proto__ !== b) throw new TypeError(a + " is not extensible");
            return a;
          } : null;
        }
        var oa = ia;
        function qa(a, b) {
          a.prototype = ha(b.prototype);
          a.prototype.constructor = a;
          if (oa) oa(a, b);
          else for (var c in b) if ("prototype" != c) if (Object.defineProperties) {
            var d = Object.getOwnPropertyDescriptor(b, c);
            d && Object.defineProperty(a, c, d);
          } else a[c] = b[c];
          a.Tk = b.prototype;
        }
        function ua() {
          this.o = false;
          this.l = null;
          this.h = void 0;
          this.g = 1;
          this.j = this.m = 0;
          this.A = this.i = null;
        }
        function va(a) {
          if (a.o) throw new TypeError("Generator is already running");
          a.o = true;
        }
        ua.prototype.u = function(a) {
          this.h = a;
        };
        function wa(a, b) {
          a.i = { Ng: b, Zg: true };
          a.g = a.m || a.j;
        }
        ua.prototype.return = function(a) {
          this.i = { return: a };
          this.g = this.j;
        };
        function F(a, b, c) {
          a.g = c;
          return { value: b };
        }
        ua.prototype.s = function(a) {
          this.g = a;
        };
        function I(a) {
          a.g = 0;
        }
        function xa(a, b, c) {
          a.m = b;
          void 0 != c && (a.j = c);
        }
        function za(a, b) {
          a.m = 0;
          a.j = b || 0;
        }
        function Aa(a, b, c) {
          a.g = b;
          a.m = c || 0;
        }
        function Ba(a, b) {
          a.m = b || 0;
          b = a.i.Ng;
          a.i = null;
          return b;
        }
        function Da(a) {
          a.A = [a.i];
          a.m = 0;
          a.j = 0;
        }
        function Ea(a, b) {
          var c = a.A.splice(0)[0];
          (c = a.i = a.i || c) ? c.Zg ? a.g = a.m || a.j : void 0 != c.s && a.j < c.s ? (a.g = c.s, a.i = null) : a.g = a.j : a.g = b;
        }
        function Ga(a) {
          this.g = new ua();
          this.h = a;
        }
        function Ha(a, b) {
          va(a.g);
          var c = a.g.l;
          if (c) return Ja(a, "return" in c ? c["return"] : function(d) {
            return { value: d, done: true };
          }, b, a.g.return);
          a.g.return(b);
          return Ka(a);
        }
        function Ja(a, b, c, d) {
          try {
            var e = b.call(a.g.l, c);
            if (!(e instanceof Object)) throw new TypeError("Iterator result " + e + " is not an object");
            if (!e.done) return a.g.o = false, e;
            var f = e.value;
          } catch (g) {
            return a.g.l = null, wa(a.g, g), Ka(a);
          }
          a.g.l = null;
          d.call(a.g, f);
          return Ka(a);
        }
        function Ka(a) {
          for (; a.g.g; ) try {
            var b = a.h(a.g);
            if (b) return a.g.o = false, { value: b.value, done: false };
          } catch (c) {
            a.g.h = void 0, wa(a.g, c);
          }
          a.g.o = false;
          if (a.g.i) {
            b = a.g.i;
            a.g.i = null;
            if (b.Zg) throw b.Ng;
            return { value: b.return, done: true };
          }
          return { value: void 0, done: true };
        }
        function La(a) {
          this.next = function(b) {
            va(a.g);
            a.g.l ? b = Ja(a, a.g.l.next, b, a.g.u) : (a.g.u(b), b = Ka(a));
            return b;
          };
          this.throw = function(b) {
            va(a.g);
            a.g.l ? b = Ja(a, a.g.l["throw"], b, a.g.u) : (wa(a.g, b), b = Ka(a));
            return b;
          };
          this.return = function(b) {
            return Ha(a, b);
          };
          this[Symbol.iterator] = function() {
            return this;
          };
        }
        function Ma(a) {
          function b(d) {
            return a.next(d);
          }
          function c(d) {
            return a.throw(d);
          }
          return new Promise(function(d, e) {
            function f(g) {
              g.done ? d(g.value) : Promise.resolve(g.value).then(b, c).then(f, e);
            }
            f(a.next());
          });
        }
        function Q(a) {
          return Ma(new La(new Ga(a)));
        }
        function Na() {
          for (var a = Number(this), b = [], c = a; c < arguments.length; c++) b[c - a] = arguments[c];
          return b;
        }
        ea("Promise", function(a) {
          function b(g) {
            this.h = 0;
            this.i = void 0;
            this.g = [];
            this.o = false;
            var h = this.j();
            try {
              g(h.resolve, h.reject);
            } catch (k2) {
              h.reject(k2);
            }
          }
          function c() {
            this.g = null;
          }
          function d(g) {
            return g instanceof b ? g : new b(function(h) {
              h(g);
            });
          }
          if (a) return a;
          c.prototype.h = function(g) {
            if (null == this.g) {
              this.g = [];
              var h = this;
              this.i(function() {
                h.l();
              });
            }
            this.g.push(g);
          };
          var e = da.setTimeout;
          c.prototype.i = function(g) {
            e(g, 0);
          };
          c.prototype.l = function() {
            for (; this.g && this.g.length; ) {
              var g = this.g;
              this.g = [];
              for (var h = 0; h < g.length; ++h) {
                var k2 = g[h];
                g[h] = null;
                try {
                  k2();
                } catch (l) {
                  this.j(l);
                }
              }
            }
            this.g = null;
          };
          c.prototype.j = function(g) {
            this.i(function() {
              throw g;
            });
          };
          b.prototype.j = function() {
            function g(l) {
              return function(m) {
                k2 || (k2 = true, l.call(h, m));
              };
            }
            var h = this, k2 = false;
            return { resolve: g(this.F), reject: g(this.l) };
          };
          b.prototype.F = function(g) {
            if (g === this) this.l(new TypeError("A Promise cannot resolve to itself"));
            else if (g instanceof b) this.H(g);
            else {
              a: switch (typeof g) {
                case "object":
                  var h = null != g;
                  break a;
                case "function":
                  h = true;
                  break a;
                default:
                  h = false;
              }
              h ? this.C(g) : this.m(g);
            }
          };
          b.prototype.C = function(g) {
            var h = void 0;
            try {
              h = g.then;
            } catch (k2) {
              this.l(k2);
              return;
            }
            "function" == typeof h ? this.I(h, g) : this.m(g);
          };
          b.prototype.l = function(g) {
            this.u(2, g);
          };
          b.prototype.m = function(g) {
            this.u(1, g);
          };
          b.prototype.u = function(g, h) {
            if (0 != this.h) throw Error("Cannot settle(" + g + ", " + h + "): Promise already settled in state" + this.h);
            this.h = g;
            this.i = h;
            2 === this.h && this.G();
            this.A();
          };
          b.prototype.G = function() {
            var g = this;
            e(function() {
              if (g.B()) {
                var h = da.console;
                "undefined" !== typeof h && h.error(g.i);
              }
            }, 1);
          };
          b.prototype.B = function() {
            if (this.o) return false;
            var g = da.CustomEvent, h = da.Event, k2 = da.dispatchEvent;
            if ("undefined" === typeof k2) return true;
            "function" === typeof g ? g = new g("unhandledrejection", { cancelable: true }) : "function" === typeof h ? g = new h("unhandledrejection", { cancelable: true }) : (g = da.document.createEvent("CustomEvent"), g.initCustomEvent("unhandledrejection", false, true, g));
            g.promise = this;
            g.reason = this.i;
            return k2(g);
          };
          b.prototype.A = function() {
            if (null != this.g) {
              for (var g = 0; g < this.g.length; ++g) f.h(this.g[g]);
              this.g = null;
            }
          };
          var f = new c();
          b.prototype.H = function(g) {
            var h = this.j();
            g.Sd(h.resolve, h.reject);
          };
          b.prototype.I = function(g, h) {
            var k2 = this.j();
            try {
              g.call(h, k2.resolve, k2.reject);
            } catch (l) {
              k2.reject(l);
            }
          };
          b.prototype.then = function(g, h) {
            function k2(p, q) {
              return "function" == typeof p ? function(u) {
                try {
                  l(p(u));
                } catch (w) {
                  m(w);
                }
              } : q;
            }
            var l, m, n = new b(function(p, q) {
              l = p;
              m = q;
            });
            this.Sd(k2(g, l), k2(h, m));
            return n;
          };
          b.prototype.catch = function(g) {
            return this.then(void 0, g);
          };
          b.prototype.Sd = function(g, h) {
            function k2() {
              switch (l.h) {
                case 1:
                  g(l.i);
                  break;
                case 2:
                  h(l.i);
                  break;
                default:
                  throw Error("Unexpected state: " + l.h);
              }
            }
            var l = this;
            null == this.g ? f.h(k2) : this.g.push(k2);
            this.o = true;
          };
          b.resolve = d;
          b.reject = function(g) {
            return new b(function(h, k2) {
              k2(g);
            });
          };
          b.race = function(g) {
            return new b(function(h, k2) {
              for (var l = t(g), m = l.next(); !m.done; m = l.next()) d(m.value).Sd(h, k2);
            });
          };
          b.all = function(g) {
            var h = t(g), k2 = h.next();
            return k2.done ? d([]) : new b(function(l, m) {
              function n(u) {
                return function(w) {
                  p[u] = w;
                  q--;
                  0 == q && l(p);
                };
              }
              var p = [], q = 0;
              do
                p.push(void 0), q++, d(k2.value).Sd(n(p.length - 1), m), k2 = h.next();
              while (!k2.done);
            });
          };
          return b;
        });
        function Oa(a, b) {
          return Object.prototype.hasOwnProperty.call(a, b);
        }
        ea("WeakMap", function(a) {
          function b(k2) {
            this.g = (h += Math.random() + 1).toString();
            if (k2) {
              k2 = t(k2);
              for (var l; !(l = k2.next()).done; ) l = l.value, this.set(l[0], l[1]);
            }
          }
          function c() {
          }
          function d(k2) {
            var l = typeof k2;
            return "object" === l && null !== k2 || "function" === l;
          }
          function e(k2) {
            if (!Oa(k2, g)) {
              var l = new c();
              ba(k2, g, { value: l });
            }
          }
          function f(k2) {
            var l = Object[k2];
            l && (Object[k2] = function(m) {
              if (m instanceof c) return m;
              Object.isExtensible(m) && e(m);
              return l(m);
            });
          }
          if (function() {
            if (!a || !Object.seal) return false;
            try {
              var k2 = Object.seal({}), l = Object.seal({}), m = new a([[k2, 2], [l, 3]]);
              if (2 != m.get(k2) || 3 != m.get(l)) return false;
              m.delete(k2);
              m.set(l, 4);
              return !m.has(k2) && 4 == m.get(l);
            } catch (n) {
              return false;
            }
          }()) return a;
          var g = "$jscomp_hidden_" + Math.random();
          f("freeze");
          f("preventExtensions");
          f("seal");
          var h = 0;
          b.prototype.set = function(k2, l) {
            if (!d(k2)) throw Error("Invalid WeakMap key");
            e(k2);
            if (!Oa(k2, g)) throw Error("WeakMap key fail: " + k2);
            k2[g][this.g] = l;
            return this;
          };
          b.prototype.get = function(k2) {
            return d(k2) && Oa(k2, g) ? k2[g][this.g] : void 0;
          };
          b.prototype.has = function(k2) {
            return d(k2) && Oa(
              k2,
              g
            ) && Oa(k2[g], this.g);
          };
          b.prototype.delete = function(k2) {
            return d(k2) && Oa(k2, g) && Oa(k2[g], this.g) ? delete k2[g][this.g] : false;
          };
          return b;
        });
        ea("Map", function(a) {
          function b() {
            var h = {};
            return h.Yb = h.next = h.head = h;
          }
          function c(h, k2) {
            var l = h[1];
            return fa(function() {
              if (l) {
                for (; l.head != h[1]; ) l = l.Yb;
                for (; l.next != l.head; ) return l = l.next, { done: false, value: k2(l) };
                l = null;
              }
              return { done: true, value: void 0 };
            });
          }
          function d(h, k2) {
            var l = k2 && typeof k2;
            "object" == l || "function" == l ? f.has(k2) ? l = f.get(k2) : (l = "" + ++g, f.set(k2, l)) : l = "p_" + k2;
            var m = h[0][l];
            if (m && Oa(h[0], l)) for (h = 0; h < m.length; h++) {
              var n = m[h];
              if (k2 !== k2 && n.key !== n.key || k2 === n.key) return { id: l, list: m, index: h, entry: n };
            }
            return {
              id: l,
              list: m,
              index: -1,
              entry: void 0
            };
          }
          function e(h) {
            this[0] = {};
            this[1] = b();
            this.size = 0;
            if (h) {
              h = t(h);
              for (var k2; !(k2 = h.next()).done; ) k2 = k2.value, this.set(k2[0], k2[1]);
            }
          }
          if (function() {
            if (!a || "function" != typeof a || !a.prototype.entries || "function" != typeof Object.seal) return false;
            try {
              var h = Object.seal({ x: 4 }), k2 = new a(t([[h, "s"]]));
              if ("s" != k2.get(h) || 1 != k2.size || k2.get({ x: 4 }) || k2.set({ x: 4 }, "t") != k2 || 2 != k2.size) return false;
              var l = k2.entries(), m = l.next();
              if (m.done || m.value[0] != h || "s" != m.value[1]) return false;
              m = l.next();
              return m.done || 4 != m.value[0].x || "t" != m.value[1] || !l.next().done ? false : true;
            } catch (n) {
              return false;
            }
          }()) return a;
          var f = /* @__PURE__ */ new WeakMap();
          e.prototype.set = function(h, k2) {
            h = 0 === h ? 0 : h;
            var l = d(this, h);
            l.list || (l.list = this[0][l.id] = []);
            l.entry ? l.entry.value = k2 : (l.entry = { next: this[1], Yb: this[1].Yb, head: this[1], key: h, value: k2 }, l.list.push(l.entry), this[1].Yb.next = l.entry, this[1].Yb = l.entry, this.size++);
            return this;
          };
          e.prototype.delete = function(h) {
            h = d(this, h);
            return h.entry && h.list ? (h.list.splice(h.index, 1), h.list.length || delete this[0][h.id], h.entry.Yb.next = h.entry.next, h.entry.next.Yb = h.entry.Yb, h.entry.head = null, this.size--, true) : false;
          };
          e.prototype.clear = function() {
            this[0] = {};
            this[1] = this[1].Yb = b();
            this.size = 0;
          };
          e.prototype.has = function(h) {
            return !!d(this, h).entry;
          };
          e.prototype.get = function(h) {
            return (h = d(this, h).entry) && h.value;
          };
          e.prototype.entries = function() {
            return c(this, function(h) {
              return [h.key, h.value];
            });
          };
          e.prototype.keys = function() {
            return c(this, function(h) {
              return h.key;
            });
          };
          e.prototype.values = function() {
            return c(this, function(h) {
              return h.value;
            });
          };
          e.prototype.forEach = function(h, k2) {
            for (var l = this.entries(), m; !(m = l.next()).done; ) m = m.value, h.call(k2, m[1], m[0], this);
          };
          e.prototype[Symbol.iterator] = e.prototype.entries;
          var g = 0;
          return e;
        });
        ea("Set", function(a) {
          function b(c) {
            this.g = /* @__PURE__ */ new Map();
            if (c) {
              c = t(c);
              for (var d; !(d = c.next()).done; ) this.add(d.value);
            }
            this.size = this.g.size;
          }
          if (function() {
            if (!a || "function" != typeof a || !a.prototype.entries || "function" != typeof Object.seal) return false;
            try {
              var c = Object.seal({ x: 4 }), d = new a(t([c]));
              if (!d.has(c) || 1 != d.size || d.add(c) != d || 1 != d.size || d.add({ x: 4 }) != d || 2 != d.size) return false;
              var e = d.entries(), f = e.next();
              if (f.done || f.value[0] != c || f.value[1] != c) return false;
              f = e.next();
              return f.done || f.value[0] == c || 4 != f.value[0].x || f.value[1] != f.value[0] ? false : e.next().done;
            } catch (g) {
              return false;
            }
          }()) return a;
          b.prototype.add = function(c) {
            c = 0 === c ? 0 : c;
            this.g.set(c, c);
            this.size = this.g.size;
            return this;
          };
          b.prototype.delete = function(c) {
            c = this.g.delete(c);
            this.size = this.g.size;
            return c;
          };
          b.prototype.clear = function() {
            this.g.clear();
            this.size = 0;
          };
          b.prototype.has = function(c) {
            return this.g.has(c);
          };
          b.prototype.entries = function() {
            return this.g.entries();
          };
          b.prototype.values = function() {
            return this.g.values();
          };
          b.prototype.keys = b.prototype.values;
          b.prototype[Symbol.iterator] = b.prototype.values;
          b.prototype.forEach = function(c, d) {
            var e = this;
            this.g.forEach(function(f) {
              return c.call(d, f, f, e);
            });
          };
          return b;
        });
        function Qa(a, b) {
          a instanceof String && (a += "");
          var c = 0, d = false, e = { next: function() {
            if (!d && c < a.length) {
              var f = c++;
              return { value: b(f, a[f]), done: false };
            }
            d = true;
            return { done: true, value: void 0 };
          } };
          e[Symbol.iterator] = function() {
            return e;
          };
          return e;
        }
        ea("Array.prototype.values", function(a) {
          return a ? a : function() {
            return Qa(this, function(b, c) {
              return c;
            });
          };
        });
        ea("Array.from", function(a) {
          return a ? a : function(b, c, d) {
            c = null != c ? c : function(h) {
              return h;
            };
            var e = [], f = "undefined" != typeof Symbol && Symbol.iterator && b[Symbol.iterator];
            if ("function" == typeof f) {
              b = f.call(b);
              for (var g = 0; !(f = b.next()).done; ) e.push(c.call(d, f.value, g++));
            } else for (f = b.length, g = 0; g < f; g++) e.push(c.call(d, b[g], g));
            return e;
          };
        });
        ea("Array.prototype.keys", function(a) {
          return a ? a : function() {
            return Qa(this, function(b) {
              return b;
            });
          };
        });
        ea("Object.is", function(a) {
          return a ? a : function(b, c) {
            return b === c ? 0 !== b || 1 / b === 1 / c : b !== b && c !== c;
          };
        });
        ea("Array.prototype.includes", function(a) {
          return a ? a : function(b, c) {
            var d = this;
            d instanceof String && (d = String(d));
            var e = d.length;
            c = c || 0;
            for (0 > c && (c = Math.max(c + e, 0)); c < e; c++) {
              var f = d[c];
              if (f === b || Object.is(f, b)) return true;
            }
            return false;
          };
        });
        function Ra(a, b, c) {
          if (null == a) throw new TypeError("The 'this' value for String.prototype." + c + " must not be null or undefined");
          if (b instanceof RegExp) throw new TypeError("First argument to String.prototype." + c + " must not be a regular expression");
          return a + "";
        }
        ea("String.prototype.includes", function(a) {
          return a ? a : function(b, c) {
            return -1 !== Ra(this, b, "includes").indexOf(b, c || 0);
          };
        });
        ea("String.fromCodePoint", function(a) {
          return a ? a : function(b) {
            for (var c = "", d = 0; d < arguments.length; d++) {
              var e = Number(arguments[d]);
              if (0 > e || 1114111 < e || e !== Math.floor(e)) throw new RangeError("invalid_code_point " + e);
              65535 >= e ? c += String.fromCharCode(e) : (e -= 65536, c += String.fromCharCode(e >>> 10 & 1023 | 55296), c += String.fromCharCode(e & 1023 | 56320));
            }
            return c;
          };
        });
        function Sa(a, b, c) {
          a instanceof String && (a = String(a));
          for (var d = a.length, e = 0; e < d; e++) {
            var f = a[e];
            if (b.call(c, f, e, a)) return { Xg: e, v: f };
          }
          return { Xg: -1, v: void 0 };
        }
        ea("Array.prototype.findIndex", function(a) {
          return a ? a : function(b, c) {
            return Sa(this, b, c).Xg;
          };
        });
        ea("WeakSet", function(a) {
          function b(c) {
            this.g = /* @__PURE__ */ new WeakMap();
            if (c) {
              c = t(c);
              for (var d; !(d = c.next()).done; ) this.add(d.value);
            }
          }
          if (function() {
            if (!a || !Object.seal) return false;
            try {
              var c = Object.seal({}), d = Object.seal({}), e = new a([c]);
              if (!e.has(c) || e.has(d)) return false;
              e.delete(c);
              e.add(d);
              return !e.has(c) && e.has(d);
            } catch (f) {
              return false;
            }
          }()) return a;
          b.prototype.add = function(c) {
            this.g.set(c, true);
            return this;
          };
          b.prototype.has = function(c) {
            return this.g.has(c);
          };
          b.prototype.delete = function(c) {
            return this.g.delete(c);
          };
          return b;
        });
        ea("Array.prototype.find", function(a) {
          return a ? a : function(b, c) {
            return Sa(this, b, c).v;
          };
        });
        ea("String.prototype.startsWith", function(a) {
          return a ? a : function(b, c) {
            var d = Ra(this, b, "startsWith"), e = d.length, f = b.length;
            c = Math.max(0, Math.min(c | 0, d.length));
            for (var g = 0; g < f && c < e; ) if (d[c++] != b[g++]) return false;
            return g >= f;
          };
        });
        ea("Object.entries", function(a) {
          return a ? a : function(b) {
            var c = [], d;
            for (d in b) Oa(b, d) && c.push([d, b[d]]);
            return c;
          };
        });
        var Ta = "function" == typeof Object.assign ? Object.assign : function(a, b) {
          for (var c = 1; c < arguments.length; c++) {
            var d = arguments[c];
            if (d) for (var e in d) Oa(d, e) && (a[e] = d[e]);
          }
          return a;
        };
        ea("Object.assign", function(a) {
          return a || Ta;
        });
        ea("Promise.prototype.finally", function(a) {
          return a ? a : function(b) {
            return this.then(function(c) {
              return Promise.resolve(b()).then(function() {
                return c;
              });
            }, function(c) {
              return Promise.resolve(b()).then(function() {
                throw c;
              });
            });
          };
        });
        ea("Array.prototype.entries", function(a) {
          return a ? a : function() {
            return Qa(this, function(b, c) {
              return [b, c];
            });
          };
        });
        ea("Number.isNaN", function(a) {
          return a ? a : function(b) {
            return "number" === typeof b && isNaN(b);
          };
        });
        ea("String.prototype.repeat", function(a) {
          return a ? a : function(b) {
            var c = Ra(this, null, "repeat");
            if (0 > b || 1342177279 < b) throw new RangeError("Invalid count value");
            b |= 0;
            for (var d = ""; b; ) if (b & 1 && (d += c), b >>>= 1) c += c;
            return d;
          };
        });
        ea("Number.EPSILON", function() {
          return Math.pow(2, -52);
        });
        ea("Number.MAX_SAFE_INTEGER", function() {
          return 9007199254740991;
        });
        ea("Number.isFinite", function(a) {
          return a ? a : function(b) {
            return "number" !== typeof b ? false : !isNaN(b) && Infinity !== b && -Infinity !== b;
          };
        });
        ea("Object.values", function(a) {
          return a ? a : function(b) {
            var c = [], d;
            for (d in b) Oa(b, d) && c.push(b[d]);
            return c;
          };
        });
        ea("Math.log2", function(a) {
          return a ? a : function(b) {
            return Math.log(b) / Math.LN2;
          };
        });
        ea("String.prototype.endsWith", function(a) {
          return a ? a : function(b, c) {
            var d = Ra(this, b, "endsWith");
            void 0 === c && (c = d.length);
            c = Math.max(0, Math.min(c | 0, d.length));
            for (var e = b.length; 0 < e && 0 < c; ) if (d[--c] != b[--e]) return false;
            return 0 >= e;
          };
        });
        ea("Math.trunc", function(a) {
          return a ? a : function(b) {
            b = Number(b);
            if (isNaN(b) || Infinity === b || -Infinity === b || 0 === b) return b;
            var c = Math.floor(Math.abs(b));
            return 0 > b ? -c : c;
          };
        });
        var Ua = this || self;
        function T(a, b) {
          a = a.split(".");
          var c = Ua;
          a[0] in c || "undefined" == typeof c.execScript || c.execScript("var " + a[0]);
          for (var d; a.length && (d = a.shift()); ) a.length || void 0 === b ? c[d] && c[d] !== Object.prototype[d] ? c = c[d] : c = c[d] = {} : c[d] = b;
        }
        function Va() {
        }
        function Wa() {
        }
        function Xa(a) {
          this.g = Math.exp(Math.log(0.5) / a);
          this.i = this.h = 0;
        }
        Xa.prototype.sample = function(a, b) {
          var c = Math.pow(this.g, a);
          b = b * (1 - c) + c * this.h;
          isNaN(b) || (this.h = b, this.i += a);
        };
        function Ya(a) {
          return a.h / (1 - Math.pow(a.g, a.i));
        }
        function Za() {
          this.h = new Xa(2);
          this.j = new Xa(5);
          this.g = 0;
          this.i = 128e3;
          this.l = 16e3;
        }
        Za.prototype.configure = function(a) {
          this.i = a.minTotalBytes;
          this.l = a.minBytes;
          this.h.g = Math.exp(Math.log(0.5) / a.fastHalfLife);
          this.j.g = Math.exp(Math.log(0.5) / a.slowHalfLife);
        };
        Za.prototype.sample = function(a, b) {
          if (!(b < this.l)) {
            var c = 8e3 * b / a;
            a /= 1e3;
            this.g += b;
            this.h.sample(a, c);
            this.j.sample(a, c);
          }
        };
        Za.prototype.getBandwidthEstimate = function(a) {
          return this.g < this.i ? a : Math.min(Ya(this.h), Ya(this.j));
        };
        function $a() {
        }
        function ab() {
        }
        function bb() {
        }
        function cb(a) {
          var b = Na.apply(1, arguments);
          fb.has(a) || (fb.add(a), bb.apply($a, y(b)));
        }
        function gb() {
        }
        function hb() {
        }
        function ib() {
        }
        var fb = /* @__PURE__ */ new Set();
        window2.console && ((/* @__PURE__ */ new Map()).set(1, function() {
          return console.error.apply(console, y(Na.apply(0, arguments)));
        }).set(2, function() {
          return console.warn.apply(console, y(Na.apply(0, arguments)));
        }).set(3, function() {
          return console.info.apply(console, y(Na.apply(0, arguments)));
        }).set(4, function() {
          return console.log.apply(console, y(Na.apply(0, arguments)));
        }).set(5, function() {
          return console.debug.apply(console, y(Na.apply(0, arguments)));
        }).set(6, function() {
          return console.debug.apply(console, y(Na.apply(0, arguments)));
        }), bb = function() {
          return console.warn.apply(console, y(Na.apply(0, arguments)));
        }, ab = function() {
          console.error.apply(console, y(Na.apply(0, arguments)));
        });
        function kb() {
          this.g = /* @__PURE__ */ new Map();
        }
        r = kb.prototype;
        r.push = function(a, b) {
          this.g.has(a) ? this.g.get(a).push(b) : this.g.set(a, [b]);
        };
        r.get = function(a) {
          return this.g.has(a) ? this.g.get(a).slice() : null;
        };
        r.remove = function(a, b) {
          if (this.g.has(a)) {
            var c = this.g.get(a).filter(function(d) {
              return d != b;
            });
            this.g.set(a, c);
            c.length || this.g.delete(a);
          }
        };
        r.forEach = function(a) {
          this.g.forEach(function(b, c) {
            a(c, b);
          });
        };
        r.size = function() {
          return this.g.size;
        };
        r.keys = function() {
          return Array.from(this.g.keys());
        };
        function lb() {
          this.g = new kb();
        }
        r = lb.prototype;
        r.release = function() {
          this.Qa();
          this.g = null;
        };
        r.D = function(a, b, c, d) {
          this.g && (a = new mb(a, b, c, d), this.g.push(b, a));
        };
        r.ma = function(a, b, c, d) {
          function e(g) {
            f.Ja(a, b, e);
            c(g);
          }
          var f = this;
          this.D(a, b, e, d);
        };
        r.Ja = function(a, b, c) {
          if (this.g) {
            var d = this.g.get(b) || [];
            d = t(d);
            for (var e = d.next(); !e.done; e = d.next()) e = e.value, e.target != a || c != e.listener && c || (e.Ja(), this.g.remove(b, e));
          }
        };
        r.Qa = function() {
          if (this.g) {
            for (var a = [], b = t(this.g.g.values()), c = b.next(); !c.done; c = b.next()) a.push.apply(a, y(c.value));
            a = t(a);
            for (b = a.next(); !b.done; b = a.next()) b.value.Ja();
            this.g.g.clear();
          }
        };
        T("shaka.util.EventManager", lb);
        lb.prototype.removeAll = lb.prototype.Qa;
        lb.prototype.unlisten = lb.prototype.Ja;
        lb.prototype.listenOnce = lb.prototype.ma;
        lb.prototype.listen = lb.prototype.D;
        lb.prototype.release = lb.prototype.release;
        function mb(a, b, c, d) {
          this.target = a;
          this.type = b;
          this.listener = c;
          this.g = nb(a, d);
          this.target.addEventListener(b, c, this.g);
        }
        mb.prototype.Ja = function() {
          this.target.removeEventListener(this.type, this.listener, this.g);
          this.listener = this.target = null;
          this.g = false;
        };
        function nb(a, b) {
          if (void 0 == b) return false;
          if ("boolean" == typeof b) return b;
          var c = /* @__PURE__ */ new Set(["passive", "capture"]);
          Object.keys(b).filter(function(d) {
            return !c.has(d);
          });
          return pb(a) ? b : b.capture || false;
        }
        function pb(a) {
          var b = qb;
          if (void 0 == b) {
            b = false;
            try {
              var c = {}, d = { get: function() {
                b = true;
                return false;
              } };
              Object.defineProperty(c, "passive", d);
              Object.defineProperty(c, "capture", d);
              d = function() {
              };
              a.addEventListener("test", d, c);
              a.removeEventListener("test", d, c);
            } catch (e) {
              b = false;
            }
            qb = b;
          }
          return b || false;
        }
        var qb = void 0;
        T("shaka.config.AutoShowText", { NEVER: 0, ALWAYS: 1, IF_PREFERRED_TEXT_LANGUAGE: 2, IF_SUBTITLES_MAY_BE_NEEDED: 3 });
        function rb(a, b) {
          this.g = a;
          this.h = b;
        }
        rb.prototype.toString = function() {
          return "v" + this.g + "." + this.h;
        };
        function sb(a, b) {
          var c = new rb(5, 0), d = tb, e = d.g, f = c.h - e.h;
          (0 < (c.g - e.g || f) ? d.i : d.h)(d.g, c, a, b);
        }
        function vb(a, b, c, d) {
          bb([c, "has been deprecated and will be removed in", b, ". We are currently at version", a, ". Additional information:", d].join(" "));
        }
        function wb(a, b, c, d) {
          ab([c, "has been deprecated and has been removed in", b, ". We are now at version", a, ". Additional information:", d].join(" "));
        }
        var tb = null;
        /*
         @license
         Copyright 2008 The Closure Library Authors
         SPDX-License-Identifier: Apache-2.0
        */
        var xb = RegExp("^(?:([^:/?#.]+):)?(?://(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#(.*))?$");
        /*
         @license
         Copyright 2006 The Closure Library Authors
         SPDX-License-Identifier: Apache-2.0
        */
        function yb(a) {
          var b;
          a instanceof yb ? (zb(this, a.Kb), this.Hc = a.Hc, Ab(this, a.nb), Bb(this, a.$c), this.ab = a.ab, Cb(this, a.g.clone()), this.qc = a.qc) : a && (b = String(a).match(xb)) ? (zb(this, b[1] || "", true), this.Hc = Db(b[2] || ""), Ab(this, b[3] || "", true), Bb(this, b[4]), this.ab = Db(b[5] || "", true), Cb(this, b[6] || "", true), this.qc = Db(b[7] || "")) : this.g = new Eb(null);
        }
        r = yb.prototype;
        r.Kb = "";
        r.Hc = "";
        r.nb = "";
        r.$c = null;
        r.ab = "";
        r.qc = "";
        r.toString = function() {
          var a = [], b = this.Kb;
          b && a.push(Fb(b, Gb, true), ":");
          if (b = this.nb) {
            a.push("//");
            var c = this.Hc;
            c && a.push(Fb(c, Gb, true), "@");
            a.push(encodeURIComponent(b).replace(/%25([0-9a-fA-F]{2})/g, "%$1"));
            b = this.$c;
            null != b && a.push(":", String(b));
          }
          if (b = this.ab) this.nb && "/" != b.charAt(0) && a.push("/"), a.push(Fb(b, "/" == b.charAt(0) ? Hb : Ib, true));
          (b = this.g.toString()) && a.push("?", b);
          (b = this.qc) && a.push("#", Fb(b, Jb));
          return a.join("");
        };
        r.resolve = function(a) {
          var b = this.clone();
          "data" === b.Kb && (b = new yb());
          var c = !!a.Kb;
          c ? zb(b, a.Kb) : c = !!a.Hc;
          c ? b.Hc = a.Hc : c = !!a.nb;
          c ? Ab(b, a.nb) : c = null != a.$c;
          var d = a.ab;
          if (c) Bb(b, a.$c);
          else if (c = !!a.ab) {
            if ("/" != d.charAt(0)) if (this.nb && !this.ab) d = "/" + d;
            else {
              var e = b.ab.lastIndexOf("/");
              -1 != e && (d = b.ab.substr(0, e + 1) + d);
            }
            if (".." == d || "." == d) d = "";
            else if (-1 != d.indexOf("./") || -1 != d.indexOf("/.")) {
              e = 0 == d.lastIndexOf("/", 0);
              d = d.split("/");
              for (var f = [], g = 0; g < d.length; ) {
                var h = d[g++];
                "." == h ? e && g == d.length && f.push("") : ".." == h ? ((1 < f.length || 1 == f.length && "" != f[0]) && f.pop(), e && g == d.length && f.push("")) : (f.push(h), e = true);
              }
              d = f.join("/");
            }
          }
          c ? b.ab = d : c = "" !== a.g.toString();
          c ? Cb(b, a.g.clone()) : c = !!a.qc;
          c && (b.qc = a.qc);
          return b;
        };
        r.clone = function() {
          return new yb(this);
        };
        function zb(a, b, c) {
          a.Kb = c ? Db(b, true) : b;
          a.Kb && (a.Kb = a.Kb.replace(/:$/, ""));
        }
        function Ab(a, b, c) {
          a.nb = c ? Db(b, true) : b;
        }
        function Bb(a, b) {
          if (b) {
            b = Number(b);
            if (isNaN(b) || 0 > b) throw Error("Bad port number " + b);
            a.$c = b;
          } else a.$c = null;
        }
        function Cb(a, b, c) {
          b instanceof Eb ? a.g = b : (c || (b = Fb(b, Kb)), a.g = new Eb(b));
        }
        function Db(a, b) {
          return a ? b ? decodeURI(a) : decodeURIComponent(a) : "";
        }
        function Fb(a, b, c) {
          return null != a ? (a = encodeURI(a).replace(b, Lb), c && (a = a.replace(/%25([0-9a-fA-F]{2})/g, "%$1")), a) : null;
        }
        function Lb(a) {
          a = a.charCodeAt(0);
          return "%" + (a >> 4 & 15).toString(16) + (a & 15).toString(16);
        }
        var Gb = /[#\/\?@]/g, Ib = /[#\?:]/g, Hb = /[#\?]/g, Kb = /[#\?@]/g, Jb = /#/g;
        function Eb(a) {
          this.g = a || null;
        }
        function Mb(a) {
          if (!a.Va && (a.Va = /* @__PURE__ */ new Map(), a.kd = 0, a.g)) for (var b = a.g.split("&"), c = 0; c < b.length; c++) {
            var d = b[c].indexOf("="), e = null;
            if (0 <= d) {
              var f = b[c].substring(0, d);
              e = b[c].substring(d + 1);
            } else f = b[c];
            f = decodeURIComponent(f.replace(/\+/g, " "));
            e = e || "";
            a.add(f, decodeURIComponent(e.replace(/\+/g, " ")));
          }
        }
        r = Eb.prototype;
        r.Va = null;
        r.kd = null;
        function Nb(a) {
          Mb(a);
          return a.kd;
        }
        r.add = function(a, b) {
          Mb(this);
          this.g = null;
          var c = this.Va.has(a) ? this.Va.get(a) : null;
          c || this.Va.set(a, c = []);
          c.push(b);
          this.kd++;
          return this;
        };
        r.set = function(a, b) {
          Mb(this);
          this.g = null;
          this.Va.has(a) ? this.Va.set(a, [b]) : this.add(a, b);
          return this;
        };
        r.get = function(a) {
          Mb(this);
          return this.Va.get(a) || [];
        };
        r.toString = function() {
          if (this.g) return this.g;
          if (!this.Va || !this.Va.size) return "";
          for (var a = [], b = t(this.Va.keys()), c = b.next(); !c.done; c = b.next()) {
            var d = c.value;
            c = encodeURIComponent(d);
            d = this.Va.get(d);
            for (var e = 0; e < d.length; e++) {
              var f = c;
              "" !== d[e] && (f += "=" + encodeURIComponent(d[e]));
              a.push(f);
            }
          }
          return this.g = a.join("&");
        };
        r.clone = function() {
          var a = new Eb();
          a.g = this.g;
          if (this.Va) {
            for (var b = /* @__PURE__ */ new Map(), c = t(this.Va), d = c.next(); !d.done; d = c.next()) {
              var e = t(d.value);
              d = e.next().value;
              e = e.next().value;
              b.set(d, e.concat());
            }
            a.Va = b;
            a.kd = this.kd;
          }
          return a;
        };
        function Ob() {
        }
        function Pb(a, b) {
          if (!a && !b) return true;
          if (!a || !b || a.byteLength != b.byteLength) return false;
          if ((ArrayBuffer.isView(a) ? a.buffer : a) == (ArrayBuffer.isView(b) ? b.buffer : b) && (a.byteOffset || 0) == (b.byteOffset || 0)) return true;
          var c = Qb(a);
          b = Qb(b);
          for (var d = 0; d < a.byteLength; d++) if (c[d] != b[d]) return false;
          return true;
        }
        function Sb(a) {
          return ArrayBuffer.isView(a) ? 0 == a.byteOffset && a.byteLength == a.buffer.byteLength ? a.buffer : new Uint8Array(a).buffer : a;
        }
        function Qb(a, b, c) {
          c = void 0 === c ? Infinity : c;
          return Tb(a, void 0 === b ? 0 : b, c, Uint8Array);
        }
        function Ub(a, b, c) {
          c = void 0 === c ? Infinity : c;
          return Tb(a, void 0 === b ? 0 : b, c, Uint16Array);
        }
        function Vb(a, b, c) {
          c = void 0 === c ? Infinity : c;
          return Tb(a, void 0 === b ? 0 : b, c, DataView);
        }
        function Tb(a, b, c, d) {
          var e = ArrayBuffer.isView(a) ? a.buffer : a, f = 1;
          "BYTES_PER_ELEMENT" in d && (f = d.BYTES_PER_ELEMENT);
          var g = ((a.byteOffset || 0) + a.byteLength) / f;
          a = Math.floor(Math.max(0, Math.min(((a.byteOffset || 0) + b) / f, g)));
          return new d(e, a, Math.floor(Math.min(a + Math.max(c, 0), g)) - a);
        }
        T("shaka.util.BufferUtils", Ob);
        Ob.toDataView = Vb;
        Ob.toUint16 = Ub;
        Ob.toUint8 = Qb;
        Ob.toArrayBuffer = Sb;
        Ob.equal = Pb;
        function U(a, b, c) {
          var d = Na.apply(3, arguments);
          this.severity = a;
          this.category = b;
          this.code = c;
          this.data = d;
          this.handled = false;
          this.message = "Shaka Error " + this.code;
          try {
            throw Error(this.message || "Shaka Error");
          } catch (e) {
            this.stack = e.stack;
          }
        }
        U.prototype.toString = function() {
          return "shaka.util.Error " + JSON.stringify(this, null, "  ");
        };
        T("shaka.util.Error", U);
        U.Severity = { RECOVERABLE: 1, CRITICAL: 2 };
        U.Category = { NETWORK: 1, TEXT: 2, MEDIA: 3, MANIFEST: 4, STREAMING: 5, DRM: 6, PLAYER: 7, CAST: 8, STORAGE: 9, ADS: 10 };
        U.Code = {
          UNSUPPORTED_SCHEME: 1e3,
          BAD_HTTP_STATUS: 1001,
          HTTP_ERROR: 1002,
          TIMEOUT: 1003,
          MALFORMED_DATA_URI: 1004,
          REQUEST_FILTER_ERROR: 1006,
          RESPONSE_FILTER_ERROR: 1007,
          MALFORMED_TEST_URI: 1008,
          UNEXPECTED_TEST_REQUEST: 1009,
          ATTEMPTS_EXHAUSTED: 1010,
          SEGMENT_MISSING: 1011,
          INVALID_TEXT_HEADER: 2e3,
          INVALID_TEXT_CUE: 2001,
          UNABLE_TO_DETECT_ENCODING: 2003,
          BAD_ENCODING: 2004,
          INVALID_XML: 2005,
          INVALID_MP4_TTML: 2007,
          INVALID_MP4_VTT: 2008,
          UNABLE_TO_EXTRACT_CUE_START_TIME: 2009,
          INVALID_MP4_CEA: 2010,
          TEXT_COULD_NOT_GUESS_MIME_TYPE: 2011,
          CANNOT_ADD_EXTERNAL_TEXT_TO_SRC_EQUALS: 2012,
          TEXT_ONLY_WEBVTT_SRC_EQUALS: 2013,
          MISSING_TEXT_PLUGIN: 2014,
          CHAPTERS_TRACK_FAILED: 2015,
          UNSUPPORTED_EXTERNAL_THUMBNAILS_URI: 2017,
          BUFFER_READ_OUT_OF_BOUNDS: 3e3,
          JS_INTEGER_OVERFLOW: 3001,
          EBML_OVERFLOW: 3002,
          EBML_BAD_FLOATING_POINT_SIZE: 3003,
          MP4_SIDX_WRONG_BOX_TYPE: 3004,
          MP4_SIDX_INVALID_TIMESCALE: 3005,
          MP4_SIDX_TYPE_NOT_SUPPORTED: 3006,
          WEBM_CUES_ELEMENT_MISSING: 3007,
          WEBM_EBML_HEADER_ELEMENT_MISSING: 3008,
          WEBM_SEGMENT_ELEMENT_MISSING: 3009,
          WEBM_INFO_ELEMENT_MISSING: 3010,
          WEBM_DURATION_ELEMENT_MISSING: 3011,
          WEBM_CUE_TRACK_POSITIONS_ELEMENT_MISSING: 3012,
          WEBM_CUE_TIME_ELEMENT_MISSING: 3013,
          MEDIA_SOURCE_OPERATION_FAILED: 3014,
          MEDIA_SOURCE_OPERATION_THREW: 3015,
          VIDEO_ERROR: 3016,
          QUOTA_EXCEEDED_ERROR: 3017,
          TRANSMUXING_FAILED: 3018,
          CONTENT_TRANSFORMATION_FAILED: 3019,
          MSS_MISSING_DATA_FOR_TRANSMUXING: 3020,
          MSS_TRANSMUXING_FAILED: 3022,
          TRANSMUXING_NO_VIDEO_DATA: 3023,
          STREAMING_NOT_ALLOWED: 3024,
          UNABLE_TO_GUESS_MANIFEST_TYPE: 4e3,
          DASH_INVALID_XML: 4001,
          DASH_NO_SEGMENT_INFO: 4002,
          DASH_EMPTY_ADAPTATION_SET: 4003,
          DASH_EMPTY_PERIOD: 4004,
          DASH_WEBM_MISSING_INIT: 4005,
          DASH_UNSUPPORTED_CONTAINER: 4006,
          DASH_PSSH_BAD_ENCODING: 4007,
          DASH_NO_COMMON_KEY_SYSTEM: 4008,
          DASH_MULTIPLE_KEY_IDS_NOT_SUPPORTED: 4009,
          DASH_CONFLICTING_KEY_IDS: 4010,
          RESTRICTIONS_CANNOT_BE_MET: 4012,
          HLS_PLAYLIST_HEADER_MISSING: 4015,
          INVALID_HLS_TAG: 4016,
          HLS_INVALID_PLAYLIST_HIERARCHY: 4017,
          DASH_DUPLICATE_REPRESENTATION_ID: 4018,
          HLS_MULTIPLE_MEDIA_INIT_SECTIONS_FOUND: 4020,
          HLS_REQUIRED_ATTRIBUTE_MISSING: 4023,
          HLS_REQUIRED_TAG_MISSING: 4024,
          HLS_COULD_NOT_GUESS_CODECS: 4025,
          HLS_KEYFORMATS_NOT_SUPPORTED: 4026,
          DASH_UNSUPPORTED_XLINK_ACTUATE: 4027,
          DASH_XLINK_DEPTH_LIMIT: 4028,
          CONTENT_UNSUPPORTED_BY_BROWSER: 4032,
          CANNOT_ADD_EXTERNAL_TEXT_TO_LIVE_STREAM: 4033,
          NO_VARIANTS: 4036,
          PERIOD_FLATTENING_FAILED: 4037,
          INCONSISTENT_DRM_ACROSS_PERIODS: 4038,
          HLS_VARIABLE_NOT_FOUND: 4039,
          HLS_MSE_ENCRYPTED_MP2T_NOT_SUPPORTED: 4040,
          HLS_MSE_ENCRYPTED_LEGACY_APPLE_MEDIA_KEYS_NOT_SUPPORTED: 4041,
          NO_WEB_CRYPTO_API: 4042,
          CANNOT_ADD_EXTERNAL_THUMBNAILS_TO_LIVE_STREAM: 4045,
          MSS_INVALID_XML: 4046,
          MSS_LIVE_CONTENT_NOT_SUPPORTED: 4047,
          AES_128_INVALID_IV_LENGTH: 4048,
          AES_128_INVALID_KEY_LENGTH: 4049,
          DASH_CONFLICTING_AES_128: 4050,
          DASH_UNSUPPORTED_AES_128: 4051,
          DASH_INVALID_PATCH: 4052,
          HLS_EMPTY_MEDIA_PLAYLIST: 4053,
          DASH_MSE_ENCRYPTED_LEGACY_APPLE_MEDIA_KEYS_NOT_SUPPORTED: 4054,
          STREAMING_ENGINE_STARTUP_INVALID_STATE: 5006,
          NO_RECOGNIZED_KEY_SYSTEMS: 6e3,
          REQUESTED_KEY_SYSTEM_CONFIG_UNAVAILABLE: 6001,
          FAILED_TO_CREATE_CDM: 6002,
          FAILED_TO_ATTACH_TO_VIDEO: 6003,
          INVALID_SERVER_CERTIFICATE: 6004,
          FAILED_TO_CREATE_SESSION: 6005,
          FAILED_TO_GENERATE_LICENSE_REQUEST: 6006,
          LICENSE_REQUEST_FAILED: 6007,
          LICENSE_RESPONSE_REJECTED: 6008,
          ENCRYPTED_CONTENT_WITHOUT_DRM_INFO: 6010,
          NO_LICENSE_SERVER_GIVEN: 6012,
          OFFLINE_SESSION_REMOVED: 6013,
          EXPIRED: 6014,
          SERVER_CERTIFICATE_REQUIRED: 6015,
          INIT_DATA_TRANSFORM_ERROR: 6016,
          SERVER_CERTIFICATE_REQUEST_FAILED: 6017,
          MIN_HDCP_VERSION_NOT_MATCH: 6018,
          ERROR_CHECKING_HDCP_VERSION: 6019,
          MISSING_EME_SUPPORT: 6020,
          LOAD_INTERRUPTED: 7e3,
          OPERATION_ABORTED: 7001,
          NO_VIDEO_ELEMENT: 7002,
          OBJECT_DESTROYED: 7003,
          CONTENT_NOT_LOADED: 7004,
          SRC_EQUALS_PRELOAD_NOT_SUPPORTED: 7005,
          PRELOAD_DESTROYED: 7006,
          CAST_API_UNAVAILABLE: 8e3,
          NO_CAST_RECEIVERS: 8001,
          ALREADY_CASTING: 8002,
          UNEXPECTED_CAST_ERROR: 8003,
          CAST_CANCELED_BY_USER: 8004,
          CAST_CONNECTION_TIMED_OUT: 8005,
          CAST_RECEIVER_APP_UNAVAILABLE: 8006,
          STORAGE_NOT_SUPPORTED: 9e3,
          INDEXED_DB_ERROR: 9001,
          DEPRECATED_OPERATION_ABORTED: 9002,
          REQUESTED_ITEM_NOT_FOUND: 9003,
          MALFORMED_OFFLINE_URI: 9004,
          CANNOT_STORE_LIVE_OFFLINE: 9005,
          NO_INIT_DATA_FOR_OFFLINE: 9007,
          LOCAL_PLAYER_INSTANCE_REQUIRED: 9008,
          NEW_KEY_OPERATION_NOT_SUPPORTED: 9011,
          KEY_NOT_FOUND: 9012,
          MISSING_STORAGE_CELL: 9013,
          STORAGE_LIMIT_REACHED: 9014,
          DOWNLOAD_SIZE_CALLBACK_ERROR: 9015,
          MODIFY_OPERATION_NOT_SUPPORTED: 9016,
          INDEXED_DB_INIT_TIMED_OUT: 9017,
          CS_IMA_SDK_MISSING: 1e4,
          CS_AD_MANAGER_NOT_INITIALIZED: 10001,
          SS_IMA_SDK_MISSING: 10002,
          SS_AD_MANAGER_NOT_INITIALIZED: 10003,
          CURRENT_DAI_REQUEST_NOT_FINISHED: 10004,
          MT_AD_MANAGER_NOT_INITIALIZED: 10005,
          INTERSTITIAL_AD_MANAGER_NOT_INITIALIZED: 10006,
          VAST_INVALID_XML: 10007
        };
        function Xb(a) {
          this.h = a;
          this.g = void 0;
        }
        Xb.prototype.value = function() {
          void 0 === this.g && (this.g = this.h());
          return this.g;
        };
        function Yb(a, b) {
          return a.length && b.length && a !== b ? 0 < Zb(a, b).length : true;
        }
        function Zb(a, b) {
          if (!a.length) return b;
          if (!b.length) return a;
          var c = [];
          a = t(a);
          for (var d = a.next(); !d.done; d = a.next()) {
            d = d.value;
            for (var e = t(b), f = e.next(); !f.done; f = e.next()) if (f = f.value, d.keySystem == f.keySystem) {
              e = /* @__PURE__ */ new Map();
              for (var g = t((d.initData || []).concat(f.initData || [])), h = g.next(); !h.done; h = g.next()) h = h.value, e.set(h.keyId, h);
              e = Array.from(e.values());
              g = d.keyIds && f.keyIds ? new Set([].concat(y(d.keyIds), y(f.keyIds))) : d.keyIds || f.keyIds;
              c.push({ keySystem: d.keySystem, licenseServerUri: d.licenseServerUri || f.licenseServerUri, distinctiveIdentifierRequired: d.distinctiveIdentifierRequired || f.distinctiveIdentifierRequired, persistentStateRequired: d.persistentStateRequired || f.persistentStateRequired, videoRobustness: d.videoRobustness || f.videoRobustness, audioRobustness: d.audioRobustness || f.audioRobustness, serverCertificate: d.serverCertificate || f.serverCertificate, serverCertificateUri: d.serverCertificateUri || f.serverCertificateUri, initData: e, keyIds: g });
              break;
            }
          }
          return c;
        }
        function $b(a) {
          return a ? !!a.match(/^com\.(microsoft|chromecast)\.playready/) : false;
        }
        function ac(a) {
          return a ? !!a.match(/^com\.apple\.fps/) : false;
        }
        var bc = new Xb(function() {
          return Sb(new Uint8Array([0]));
        }), cc = /* @__PURE__ */ new Map();
        function dc(a) {
          this.h = a;
          this.g = null;
        }
        dc.prototype.da = function(a) {
          var b = this;
          this.stop();
          var c = true, d = null;
          this.g = function() {
            window2.clearTimeout(d);
            c = false;
          };
          d = window2.setTimeout(function() {
            c && b.h();
          }, 1e3 * a);
          return this;
        };
        dc.prototype.stop = function() {
          this.g && (this.g(), this.g = null);
        };
        function ec(a) {
          this.h = a;
          this.g = null;
        }
        ec.prototype.sb = function() {
          this.stop();
          this.h();
          return this;
        };
        ec.prototype.da = function(a) {
          var b = this;
          this.stop();
          this.g = new dc(function() {
            b.h();
          }).da(a);
          return this;
        };
        ec.prototype.ua = function(a) {
          var b = this;
          this.stop();
          this.g = new dc(function() {
            b.g.da(a);
            b.h();
          }).da(a);
          return this;
        };
        ec.prototype.stop = function() {
          this.g && (this.g.stop(), this.g = null);
        };
        T("shaka.util.Timer", ec);
        ec.prototype.stop = ec.prototype.stop;
        ec.prototype.tickEvery = ec.prototype.ua;
        ec.prototype.tickAfter = ec.prototype.da;
        ec.prototype.tickNow = ec.prototype.sb;
        function fc() {
          var a = window2.ManagedMediaSource || window2.MediaSource;
          return a && a.isTypeSupported ? true : false;
        }
        function gc(a) {
          return "" != hc().canPlayType(a);
        }
        function ic() {
          return navigator.userAgent.match(/Edge?\//) ? true : false;
        }
        function jc() {
          return kc("Xbox One");
        }
        function lc() {
          return kc("Tizen");
        }
        function mc() {
          return kc("Tizen 3");
        }
        function nc() {
          return kc("Web0S");
        }
        function oc() {
          return nc() && 38 === pc();
        }
        function qc() {
          return kc("CrKey") && !kc("VIZIO SmartCast");
        }
        function pc() {
          if (!kc("Chrome") || navigator.userAgent.match(/Edge\//)) return null;
          var a = navigator.userAgent.match(/Chrome\/(\d+)/);
          return a ? parseInt(a[1], 10) : null;
        }
        function rc() {
          return sc() && ((navigator.userAgentData && navigator.userAgentData.platform ? "macos" == navigator.userAgentData.platform.toLowerCase() : navigator.platform ? navigator.platform.toLowerCase().includes("mac") : false) || (/(?:iPhone|iPad|iPod)/.test(navigator.userAgent) ? true : sc() && 1 < navigator.maxTouchPoints));
        }
        function tc() {
          return kc("PlayStation 5");
        }
        function uc() {
          return kc("PlayStation 4");
        }
        function vc() {
          return kc("Hisense") || kc("VIDAA");
        }
        function wc() {
          if (!rc() && (!sc() || rc())) return null;
          var a = navigator.userAgent.match(/Version\/(\d+)/);
          return a ? parseInt(a[1], 10) : (a = navigator.userAgent.match(/OS (\d+)(?:_\d+)?/)) ? parseInt(a[1], 10) : null;
        }
        function xc() {
          return navigator.userAgentData && navigator.userAgentData.platform ? "windows" == navigator.userAgentData.platform.toLowerCase() : navigator.platform ? navigator.platform.toLowerCase().includes("win32") : false;
        }
        function yc() {
          return navigator.userAgentData && navigator.userAgentData.platform ? "android" == navigator.userAgentData.platform.toLowerCase() : kc("Android");
        }
        function zc() {
          return navigator.userAgentData && navigator.userAgentData.platform ? "fuchsia" == navigator.userAgentData.platform.toLowerCase() : kc("Fuchsia");
        }
        function Ac() {
          return lc() || nc() || jc() || uc() || tc() || qc() || vc() || kc("VIZIO SmartCast") || sc() && !rc() ? true : false;
        }
        function kc(a) {
          return (navigator.userAgent || "").includes(a);
        }
        function sc() {
          return (navigator.vendor || "").includes("Apple");
        }
        function hc() {
          if (Bc) return Bc;
          Cc || (Cc = new ec(function() {
            Bc = null;
          }));
          (Bc = document.getElementsByTagName("video")[0] || document.getElementsByTagName("audio")[0]) || (Bc = document.createElement("video"));
          Cc.da(1);
          return Bc;
        }
        function Dc() {
          if (mc() || kc("Tizen 2") || oc() || uc() || tc()) return false;
          var a = wc();
          return sc() && !rc() && null != a && 15 > a ? false : true;
        }
        function Ec() {
          var a, b, c, d, e, f, g, h, k2, l, m, n, p, q, u, w, v;
          return Q(function(x) {
            switch (x.g) {
              case 1:
                a = { width: Infinity, height: Infinity };
                if (qc()) {
                  q = window2.cast && cast.__platform__ && cast.__platform__.canDisplayType;
                  a.width = 1280;
                  a.height = 720;
                  xa(x, 14);
                  if (!(u = q)) {
                    x.s(16);
                    break;
                  }
                  return F(x, cast.__platform__.canDisplayType('video/mp4; codecs="avc1.640028"; width=3840; height=2160'), 17);
                }
                if (lc()) {
                  b = window2.devicePixelRatio;
                  a.width = 1920 < window2.screen.width * b ? 3840 : 1920;
                  a.height = 1080 < window2.screen.height * b ? 2160 : 1080;
                  try {
                    webapis.systeminfo && webapis.systeminfo.getMaxVideoResolution ? (c = webapis.systeminfo.getMaxVideoResolution(), a.width = c.width, a.height = c.height) : webapis.productinfo.is8KPanelSupported && webapis.productinfo.is8KPanelSupported() ? (a.width = 7680, a.height = 4320) : webapis.productinfo.isUdPanelSupported && webapis.productinfo.isUdPanelSupported() && (a.width = 3840, a.height = 2160);
                  } catch (z) {
                    bb("Tizen: Error detecting screen size, default screen size 1920x1080.");
                  }
                  x.s(3);
                  break;
                }
                if (nc()) {
                  try {
                    d = JSON.parse(window2.PalmSystem.deviceInfo), a.width = Math.max(1920, d.screenWidth), a.height = Math.max(1080, d.screenHeight);
                  } catch (z) {
                    bb("WebOS: Error detecting screen size, default screen size 1920x1080."), a.width = 1920, a.height = 1080;
                  }
                  x.s(3);
                  break;
                }
                if (vc()) {
                  e = null;
                  if (window2.Hisense_Get4KSupportState) try {
                    e = window2.Hisense_Get4KSupportState();
                  } catch (z) {
                  }
                  null == e && (e = kc("UHD"));
                  e ? (a.width = 3840, a.height = 2160) : (a.width = 1920, a.height = 1080);
                  x.s(3);
                  break;
                }
                if (!uc() && !tc()) {
                  f = void 0;
                  try {
                    f = "undefined" !== typeof Windows ? Windows : chrome.webview.hostObjects.sync.Windows;
                  } catch (z) {
                  }
                  if (f) {
                    a.width = 1920;
                    a.height = 1080;
                    try {
                      g = new f.Media.Protection.ProtectionCapabilities();
                      h = f.Media.Protection.ProtectionCapabilityResult;
                      k2 = null;
                      do
                        k2 = g.isTypeSupported('video/mp4;codecs="hvc1,mp4a";features="decode-res-x=3840,decode-res-y=2160,decode-bitrate=20000,decode-fps=30,decode-bpc=10,display-res-x=3840,display-res-y=2160,display-bpc=8"', "com.microsoft.playready.recommendation");
                      while (k2 === h.maybe);
                      k2 === h.probably && (a.width = 3840, a.height = 2160);
                    } catch (z) {
                      bb("Xbox: Error detecting screen size, default screen size 1920x1080.");
                    }
                  } else jc() && (a.width = 1920, a.height = 1080, bb("Xbox: Error detecting screen size, default screen size 1920x1080."));
                  x.s(3);
                  break;
                }
                l = false;
                xa(x, 8);
                return F(x, window2.msdk.device.getDisplayInfo(), 10);
              case 10:
                m = x.h;
                l = "4K" === m.resolution;
                Aa(x, 9);
                break;
              case 8:
                return Ba(x), xa(x, 11), F(x, window2.msdk.device.getDisplayInfoImmediate(), 13);
              case 13:
                n = x.h;
                l = "4K" === n.resolution;
                Aa(x, 9);
                break;
              case 11:
                p = Ba(x), bb("PlayStation: Failed to get the display info:", p);
              case 9:
                l ? (a.width = 3840, a.height = 2160) : (a.width = 1920, a.height = 1080);
                x.s(3);
                break;
              case 17:
                u = x.h;
              case 16:
                if (u) {
                  a.width = 3840;
                  a.height = 2160;
                  x.s(18);
                  break;
                }
                if (!(w = q)) {
                  x.s(19);
                  break;
                }
                return F(x, cast.__platform__.canDisplayType('video/mp4; codecs="avc1.640028"; width=1920; height=1080'), 20);
              case 20:
                w = x.h;
              case 19:
                w && (a.width = 1920, a.height = 1080);
              case 18:
                Aa(x, 3);
                break;
              case 14:
                v = Ba(x), ab("Failed to check canDisplayType:", v);
              case 3:
                return x.return(a);
            }
          });
        }
        function Fc(a) {
          return void 0 !== window2.matchMedia && window2.matchMedia("(color-gamut: p3)").matches ? a ? "HLG" : "PQ" : "SDR";
        }
        var Cc = null, Bc = null;
        function Gc() {
        }
        function Hc(a) {
          if (!a) return "";
          a = Qb(a);
          239 == a[0] && 187 == a[1] && 191 == a[2] && (a = a.subarray(3));
          if (window2.TextDecoder && !uc()) return a = new TextDecoder().decode(a), a.includes("�") && ab('Decoded string contains an "unknown character" codepoint.  That probably means the UTF8 encoding was incorrect!'), a;
          for (var b = "", c = 0; c < a.length; ++c) {
            var d = 65533;
            0 == (a[c] & 128) ? d = a[c] : a.length >= c + 2 && 192 == (a[c] & 224) && 128 == (a[c + 1] & 192) ? (d = (a[c] & 31) << 6 | a[c + 1] & 63, c += 1) : a.length >= c + 3 && 224 == (a[c] & 240) && 128 == (a[c + 1] & 192) && 128 == (a[c + 2] & 192) ? (d = (a[c] & 15) << 12 | (a[c + 1] & 63) << 6 | a[c + 2] & 63, c += 2) : a.length >= c + 4 && 240 == (a[c] & 241) && 128 == (a[c + 1] & 192) && 128 == (a[c + 2] & 192) && 128 == (a[c + 3] & 192) && (d = (a[c] & 7) << 18 | (a[c + 1] & 63) << 12 | (a[c + 2] & 63) << 6 | a[c + 3] & 63, c += 3);
            if (65535 >= d) b += String.fromCharCode(d);
            else {
              d -= 65536;
              var e = d & 1023;
              b += String.fromCharCode(55296 + (d >> 10));
              b += String.fromCharCode(56320 + e);
            }
          }
          return b;
        }
        function Ic(a, b, c) {
          if (!a) return "";
          if (!c && 0 != a.byteLength % 2) throw new U(2, 2, 2004);
          c = Math.floor(a.byteLength / 2);
          var d = new Uint16Array(c);
          a = Vb(a);
          for (var e = 0; e < c; e++) d[e] = a.getUint16(2 * e, b);
          return Jc(d);
        }
        function Kc(a) {
          function b(d) {
            return c.byteLength <= d || 9 <= c[d] && 126 >= c[d];
          }
          if (!a) return "";
          var c = Qb(a);
          if (239 == c[0] && 187 == c[1] && 191 == c[2]) return Hc(c);
          if (254 == c[0] && 255 == c[1]) return Ic(c.subarray(2), false);
          if (255 == c[0] && 254 == c[1]) return Ic(c.subarray(2), true);
          if (0 == c[0] && 0 == c[2]) return Ic(a, false);
          if (0 == c[1] && 0 == c[3]) return Ic(a, true);
          if (b(0) && b(1) && b(2) && b(3)) return Hc(a);
          throw new U(2, 2, 2003);
        }
        function Lc(a) {
          if (window2.TextEncoder && !uc()) {
            var b = new TextEncoder();
            return Sb(b.encode(a));
          }
          a = encodeURIComponent(a);
          a = unescape(a);
          b = new Uint8Array(a.length);
          for (var c = 0; c < a.length; c++) b[c] = a[c].charCodeAt(0);
          return Sb(b);
        }
        function Mc(a, b) {
          for (var c = new ArrayBuffer(2 * a.length), d = new DataView(c), e = 0; e < a.length; ++e) d.setUint16(2 * e, a.charCodeAt(e), b);
          return c;
        }
        function Jc(a) {
          return Nc.value()(a);
        }
        function Pc(a) {
          var b = { "&amp;": "&", "&lt;": "<", "&gt;": ">", "&quot;": '"', "&apos;": "'", "&nbsp;": " ", "&lrm;": "‎", "&rlm;": "‏" }, c = /&(?:amp|lt|gt|quot|apos|nbsp|lrm|rlm|#[xX]?[0-9a-fA-F]+);/g, d = RegExp(c.source);
          return a && d.test(a) ? a.replace(c, function(e) {
            return "#" == e[1] ? (e = "x" == e[2] || "X" == e[2] ? parseInt(e.substring(3), 16) : parseInt(e.substring(2), 10), 0 <= e && 1114111 >= e ? String.fromCodePoint(e) : "") : b[e] || "'";
          }) : a || "";
        }
        T("shaka.util.StringUtils", Gc);
        Gc.resetFromCharCode = function() {
          Nc.g = void 0;
        };
        Gc.toUTF16 = Mc;
        Gc.toUTF8 = Lc;
        Gc.fromBytesAutoDetect = Kc;
        Gc.fromUTF16 = Ic;
        Gc.fromUTF8 = Hc;
        var Nc = new Xb(function() {
          function a(c) {
            try {
              var d = new Uint8Array(c);
              return 0 < String.fromCharCode.apply(null, d).length;
            } catch (e) {
              return false;
            }
          }
          for (var b = { jc: 65536 }; 0 < b.jc; b = { jc: b.jc }, b.jc /= 2) if (a(b.jc)) return /* @__PURE__ */ function(c) {
            return function(d) {
              for (var e = "", f = 0; f < d.length; f += c.jc) e += String.fromCharCode.apply(null, d.subarray(f, f + c.jc));
              return e;
            };
          }(b);
          return null;
        });
        function Qc() {
        }
        function Rc(a) {
          a = Jc(Qb(a));
          return btoa(a);
        }
        function Sc(a, b) {
          b = void 0 == b ? true : b;
          a = Rc(a).replace(/\+/g, "-").replace(/\//g, "_");
          return b ? a : a.replace(/[=]*$/, "");
        }
        function Tc(a) {
          a = window2.atob(a.replace(/-/g, "+").replace(/_/g, "/"));
          for (var b = new Uint8Array(a.length), c = 0; c < a.length; ++c) b[c] = a.charCodeAt(c);
          return b;
        }
        function Uc(a) {
          for (var b = a.length / 2, c = new Uint8Array(b), d = 0; d < b; d++) c[d] = window2.parseInt(a.substr(2 * d, 2), 16);
          return c;
        }
        function Vc(a) {
          var b = Qb(a);
          a = "";
          b = t(b);
          for (var c = b.next(); !c.done; c = b.next()) c = c.value, c = c.toString(16), 1 == c.length && (c = "0" + c), a += c;
          return a;
        }
        function Wc() {
          for (var a = Na.apply(0, arguments), b = 0, c = 0; c < a.length; ++c) b += a[c].byteLength;
          b = new Uint8Array(b);
          for (var d = c = 0; d < a.length; ++d) {
            var e = a[d];
            ArrayBuffer.isView(e) && 1 === e.BYTES_PER_ELEMENT ? b.set(e, c) : b.set(Qb(e), c);
            c += e.byteLength;
          }
          return b;
        }
        T("shaka.util.Uint8ArrayUtils", Qc);
        Qc.concat = Wc;
        Qc.toHex = Vc;
        Qc.fromHex = Uc;
        Qc.fromBase64 = Tc;
        Qc.toBase64 = Sc;
        Qc.toStandardBase64 = Rc;
        function Xc(a, b, c) {
          c = void 0 === c ? "" : c;
          if (0 == b.length) return a;
          if (1 == a.length && 1 == b.length) {
            var d = new yb(a[0]);
            b = new yb(b[0]);
            b = d.resolve(b);
            c && Cb(b, c);
            return [b.toString()];
          }
          b = b.map(function(h) {
            return new yb(h);
          });
          d = [];
          a = t(a);
          for (var e = a.next(); !e.done; e = a.next()) {
            e = new yb(e.value);
            for (var f = t(b), g = f.next(); !g.done; g = f.next()) g = e.resolve(g.value), c && Cb(g, c), d.push(g.toString());
          }
          return d;
        }
        function Yc(a, b, c, d) {
          a = { keySystem: a, encryptionScheme: b, licenseServerUri: "", distinctiveIdentifierRequired: false, persistentStateRequired: false, audioRobustness: "", videoRobustness: "", serverCertificate: null, serverCertificateUri: "", sessionType: "", initData: c || [], keyIds: /* @__PURE__ */ new Set() };
          d && (a.keySystemUris = /* @__PURE__ */ new Set([d]));
          return a;
        }
        function $c(a, b) {
          b = void 0 === b ? "cenc" : b;
          var c = [], d = [], e = [];
          a.forEach(function(g, h) {
            var k2 = h;
            22 != k2.length && (k2 = Sc(Uc(h), false));
            var l = g;
            22 != l.length && (l = Sc(Uc(g), false));
            g = { kty: "oct", kid: k2, k: l };
            c.push(g);
            d.push(g.kid);
            e.push(h);
          });
          a = JSON.stringify({ keys: c });
          var f = JSON.stringify({ kids: d });
          f = [{ initData: Qb(Lc(f)), initDataType: "keyids" }];
          return {
            keySystem: "org.w3.clearkey",
            encryptionScheme: b,
            licenseServerUri: "data:application/json;base64," + window2.btoa(a),
            distinctiveIdentifierRequired: false,
            persistentStateRequired: false,
            audioRobustness: "",
            videoRobustness: "",
            serverCertificate: null,
            serverCertificateUri: "",
            sessionType: "",
            initData: f,
            keyIds: new Set(e)
          };
        }
        function ad(a, b) {
          if (1 == b.length) return b[0];
          a = bd(a, b);
          if (null != a) return a;
          throw new U(2, 4, 4025, b);
        }
        function bd(a, b) {
          var c = cd.get(a);
          c = t(c);
          for (var d = c.next(); !d.done; d = c.next()) {
            d = d.value;
            for (var e = t(b), f = e.next(); !f.done; f = e.next()) if (f = f.value, d.test(f.trim())) return f.trim();
          }
          return a == dd ? "" : null;
        }
        function ed(a, b) {
          var c = [];
          a = cd.get(a);
          a = t(a);
          for (var d = a.next(); !d.done; d = a.next()) {
            d = d.value;
            for (var e = t(b), f = e.next(); !f.done; f = e.next()) f = f.value, d.test(f.trim()) && c.push(f.trim());
          }
          return c;
        }
        var dd = "text", fd = { la: "video", V: "audio", za: dd, $e: "image", Mj: "application" }, gd = 1 / 15, cd = (/* @__PURE__ */ new Map()).set("audio", [/^vorbis$/, /^Opus$/, /^opus$/, /^fLaC$/, /^flac$/, /^mp4a/, /^[ae]c-3$/, /^ac-4/, /^dts[cex]$/, /^iamf/, /^mhm[12]/, /^ac3$/, /^eac3$/]).set("video", [/^avc/, /^hev/, /^hvc/, /^vvc/, /^vvi/, /^vp0?[89]/, /^av01/, /^dvh/, /^dva/, /^dav/]).set("text", [/^vtt$/, /^wvtt/, /^stpp/]);
        function id(a, b, c, d) {
          this.g = null;
          this.l = a;
          this.i = b;
          this.m = c;
          this.o = d;
          this.j = false;
          a: {
            "undefined" === typeof libDPIModule && bb("Could not find LCEVC Library dependencies on this page");
            if ("undefined" !== typeof LCEVCdec) this.h = LCEVCdec;
            else if ("undefined" !== typeof LcevcDil) this.h = LcevcDil, this.j = true, sb("LcevcDil", "lcevc_dil.js is deprecated, please use lcevc_dec.js instead");
            else {
              bb("Could not find LCEVC Library on this page");
              a = false;
              break a;
            }
            "undefined" === typeof this.h.SupportObject ? (bb("Could not find LCEVC Library on this page"), a = false) : (this.h.SupportObject.SupportStatus || bb(this.h.SupportObject.SupportError), a = "undefined" !== typeof this.h && "undefined" !== typeof libDPIModule && this.i instanceof HTMLCanvasElement && this.h.SupportObject.SupportStatus);
          }
          a && !this.g && this.h.SupportObject.webGLSupport(this.i) && (this.i.classList.remove("shaka-hidden"), this.g = this.j ? new this.h.LcevcDil(this.l, this.i, this.m) : new this.h.LCEVCdec(this.l, this.i, this.m));
        }
        function jd(a, b, c, d) {
          "video" !== d.type || a.o && !d.baseOriginalId || a.g && a.g.appendBuffer(b, "video", d.id, -c, !a.o);
        }
        function kd(a) {
          a.g && a.i.classList.add("shaka-hidden");
        }
        id.prototype.release = function() {
          this.g && (this.g.close(), this.g = null);
        };
        function ld(a) {
          return a && "undefined" !== typeof LCEVCdec ? "lvc1" == a.codecs : false;
        }
        T("shaka.lcevc.Dec", id);
        id.prototype.release = id.prototype.release;
        function md(a) {
          if (nd.has(a)) return nd.get(a);
          var b = window2.ManagedMediaSource || window2.MediaSource;
          return b ? (b = b.isTypeSupported(a), nd.set(a, b), b) : false;
        }
        function od() {
          var a = window2.ManagedSourceBuffer || window2.SourceBuffer;
          return !!a && !!a.prototype && !!a.prototype.changeType;
        }
        function pd() {
          var a = window2.ManagedMediaSource || window2.MediaSource;
          return a && a.prototype ? !!a.prototype.setLiveSeekableRange && !!a.prototype.clearLiveSeekableRange : false;
        }
        var nd = /* @__PURE__ */ new Map();
        function qd() {
        }
        qd.prototype.extract = function() {
        };
        qd.prototype.decode = function() {
          return [];
        };
        qd.prototype.clear = function() {
        };
        qd.prototype.getStreams = function() {
          return [];
        };
        function rd() {
        }
        rd.prototype.init = function() {
        };
        rd.prototype.parse = function() {
          return [];
        };
        function sd() {
        }
        sd.prototype.init = function() {
        };
        sd.prototype.i = function() {
        };
        sd.prototype.g = function() {
        };
        sd.prototype.j = function() {
        };
        T("shaka.media.IClosedCaptionParser", sd);
        function td(a) {
          this.l = new rd();
          if (a = ud(a.toLowerCase())) this.l = a();
          this.h = new qd();
          if (a = vd) this.h = a();
        }
        td.prototype.init = function(a, b) {
          (void 0 === b ? 0 : b) || this.g();
          this.l.init(a);
        };
        td.prototype.i = function(a) {
          a = this.l.parse(a);
          a = t(a);
          for (var b = a.next(); !b.done; b = a.next()) {
            b = b.value;
            var c = Qb(b.packet);
            0 < c.length && this.h.extract(c, b.pts);
          }
          return this.h.decode();
        };
        td.prototype.g = function() {
          this.h.clear();
        };
        td.prototype.j = function() {
          return this.h.getStreams();
        };
        function wd(a, b) {
          xd.set(a, b);
        }
        function ud(a) {
          return xd.get(a);
        }
        T("shaka.media.ClosedCaptionParser", td);
        td.findDecoder = function() {
          return vd;
        };
        td.unregisterDecoder = function() {
          vd = null;
        };
        td.registerDecoder = function(a) {
          vd = a;
        };
        td.findParser = ud;
        td.unregisterParser = function(a) {
          xd.delete(a);
        };
        td.registerParser = wd;
        var xd = /* @__PURE__ */ new Map(), vd = null;
        function yd() {
          this.id = "";
          this.regionAnchorY = this.regionAnchorX = this.viewportAnchorY = this.viewportAnchorX = 0;
          this.height = this.width = 100;
          this.viewportAnchorUnits = this.widthUnits = this.heightUnits = zd;
          this.scroll = Ad;
        }
        T("shaka.text.CueRegion", yd);
        var zd = 1;
        yd.units = { PX: 0, PERCENTAGE: zd, LINES: 2 };
        var Ad = "";
        yd.scrollMode = { NONE: Ad, UP: "up" };
        function Bd(a, b) {
          return "number" === typeof a && "number" === typeof b && isNaN(a) && isNaN(b) ? true : a === b;
        }
        function Cd(a, b) {
          b = a.indexOf(b);
          -1 < b && a.splice(b, 1);
        }
        function Dd(a, b, c) {
          c || (c = Bd);
          if (a.length != b.length) return false;
          b = b.slice();
          a = t(a);
          for (var d = a.next(), e = {}; !d.done; e = { ah: void 0 }, d = a.next()) {
            e.ah = d.value;
            d = b.findIndex(/* @__PURE__ */ function(f) {
              return function(g) {
                return c(f.ah, g);
              };
            }(e));
            if (-1 == d) return false;
            b[d] = b[b.length - 1];
            b.pop();
          }
          return 0 == b.length;
        }
        function Ed(a, b, c) {
          if (a === b) return true;
          if (!a || !b) return a == b;
          c || (c = Bd);
          if (a.length != b.length) return false;
          for (var d = 0; d < a.length; d++) if (!c(a[d], b[d])) return false;
          return true;
        }
        function Fd(a) {
          this.h = a || "";
          this.g = 0;
        }
        function Gd(a) {
          Hd(a, /[ \t]+/gm);
        }
        function Hd(a, b) {
          b.lastIndex = a.g;
          b = b.exec(a.h);
          b = null == b ? null : { position: b.index, length: b[0].length, results: b };
          if (a.g == a.h.length || null == b || b.position != a.g) return null;
          a.g += b.length;
          return b.results;
        }
        function Id(a) {
          return a.g == a.h.length ? null : (a = Hd(a, /[^ \t\n]*/gm)) ? a[0] : null;
        }
        function Kd(a) {
          a = Hd(a, Ld);
          if (null == a) return null;
          var b = Number(a[2]), c = Number(a[3]);
          return 59 < b || 59 < c ? null : (Number(a[6]) || 0) / 1e3 + c + 60 * b + 3600 * (Number(a[1]) || 0);
        }
        function Md(a) {
          return a ? Kd(new Fd(a)) : null;
        }
        var Ld = /(?:(\d{1,}):)?(\d{2}):(\d{2})((\.(\d{1,3})))?/g;
        function Nd(a) {
          function b(d) {
            switch (typeof d) {
              case "undefined":
              case "boolean":
              case "number":
              case "string":
              case "symbol":
              case "function":
                return d;
              default:
                if (!d || ArrayBuffer.isView(d)) return d;
                if (c.has(d)) return null;
                var e = d.constructor == Array;
                if (d.constructor != Object && !e) return null;
                c.add(d);
                var f = e ? [] : {}, g;
                for (g in d) f[g] = b(d[g]);
                e && (f.length = d.length);
                return f;
            }
          }
          var c = /* @__PURE__ */ new WeakSet();
          return b(a);
        }
        function Od(a) {
          var b = {}, c;
          for (c in a) b[c] = a[c];
          return b;
        }
        function Pd(a) {
          if (Array.isArray(a)) {
            for (var b = [], c = 0; c < a.length; c++) {
              var d = c.toString(), e = a[c];
              void 0 !== e && (e = Pd(e)) && b.push(d + ":" + e);
            }
            a = "[" + b.join(",") + "]";
          } else if ("function" == typeof a) a = "";
          else if (a instanceof Object) {
            c = Object.keys(a);
            c.sort();
            b = [];
            c = t(c);
            for (d = c.next(); !d.done; d = c.next()) e = d.value, d = JSON.stringify(e), e = a[e], void 0 !== e && (e = Pd(e)) && b.push(d + ":" + e);
            a = "{" + b.join(",") + "}";
          } else a = JSON.stringify(a);
          return a;
        }
        function Qd(a, b) {
          var c = void 0 === c ? false : c;
          a = Kc(a);
          return Rd(a, b, c);
        }
        function Rd(a, b, c) {
          a = Sd(a, void 0 === c ? false : c);
          return !b && a.length ? a[0] : (a = a.find(function(d) {
            return b.split(",").includes(d.tagName);
          })) ? a : null;
        }
        function Td(a) {
          return Ud.has(a) ? Ud.get(a) : "";
        }
        function Sd(a, b) {
          function c(f, g) {
            g = void 0 === g ? false : g;
            for (var h = []; a[e]; ) if (60 == a.charCodeAt(e)) {
              if (47 === a.charCodeAt(e + 1)) {
                g = e + 2;
                e = a.indexOf(">", e);
                g = a.substring(g, e);
                var k2 = g.indexOf(f);
                if (-1 == k2) {
                  var l = f.indexOf(".");
                  0 < l && (k2 = g.indexOf(f.substring(0, l)));
                }
                if (-1 == k2) throw f = a.substring(0, e).split("\n"), Error("Unexpected close tag\nLine: " + (f.length - 1) + "\nColumn: " + (f[f.length - 1].length + 1) + "\nChar: " + a[e]);
                e + 1 && (e += 1);
                break;
              } else if (33 === a.charCodeAt(e + 1)) {
                if (45 == a.charCodeAt(e + 2)) {
                  for (; -1 !== e && (62 !== a.charCodeAt(e) || 45 != a.charCodeAt(e - 1) || 45 != a.charCodeAt(e - 2) || -1 == e); ) e = a.indexOf(">", e + 1);
                  -1 === e && (e = a.length);
                } else if (91 === a.charCodeAt(e + 2) && 91 === a.charCodeAt(e + 8) && "cdata" === a.substr(e + 3, 5).toLowerCase()) {
                  k2 = a.indexOf("]]>", e);
                  -1 == k2 ? (h.push(a.substr(e + 9)), e = a.length) : (h.push(a.substring(e + 9, k2)), e = k2 + 3);
                  continue;
                }
                e++;
                continue;
              }
              a: {
                l = g;
                e++;
                var m = d(), n = {};
                for (k2 = []; 62 !== a.charCodeAt(e) && a[e]; ) {
                  var p = a.charCodeAt(e);
                  if (64 < p && 91 > p || 96 < p && 123 > p) {
                    p = d();
                    for (var q = a.charCodeAt(e); q && 39 !== q && 34 !== q && !(64 < q && 91 > q || 96 < q && 123 > q) && 62 !== q; ) e++, q = a.charCodeAt(e);
                    var u = e + 1;
                    e = a.indexOf(a[e], u);
                    u = a.slice(u, e);
                    if (39 === q || 34 === q) {
                      if (-1 === e) {
                        l = { tagName: m, attributes: n, children: k2, parent: null };
                        if (b) for (m = 0; m < k2.length; m++) "string" !== typeof k2[m] && (k2[m].parent = l);
                        k2 = l;
                        break a;
                      }
                    } else u = null, e--;
                    if (p.startsWith("xmlns:")) {
                      q = u;
                      var w = p.split(":")[1];
                      Ud.set(q, w);
                      Vd.set(w, q);
                    }
                    "tt" === m && "xml:space" === p && "preserve" === u && (l = true);
                    n[p] = u;
                  }
                  e++;
                }
                47 !== a.charCodeAt(e - 1) ? (e++, k2 = c(m, l)) : e++;
                l = { tagName: m, attributes: n, children: k2, parent: null };
                m = k2.length;
                for (n = 0; n < m; n++) p = k2[n], "string" !== typeof p ? b && (p.parent = l) : n == m - 1 && "\n" == p && k2.pop();
                k2 = l;
              }
              h.push(k2);
              if ("string" === typeof k2) break;
              "?" === k2.tagName[0] && k2.children && (h.push.apply(h, y(k2.children)), k2.children = []);
            } else k2 = e, e = a.indexOf("<", e) - 1, -2 === e && (e = a.length), k2 = a.slice(k2, e + 1), g ? 0 < k2.length && h.push(k2) : h.length && 1 == k2.length && "\n" == k2[0] ? h.push(k2) : 0 < k2.trim().length && h.push(k2), e++;
            return h;
          }
          function d() {
            for (var f = e; -1 === "\r\n	>/= ".indexOf(a[e]) && a[e]; ) e++;
            return a.slice(f, e);
          }
          var e = 0;
          return c("");
        }
        function Wd(a) {
          return "string" === typeof a;
        }
        function Xd(a) {
          var b = [];
          if (!a.children) return [];
          a = t(a.children);
          for (var c = a.next(); !c.done; c = a.next()) c = c.value, "string" !== typeof c && b.push(c);
          return b;
        }
        function Yd(a, b) {
          var c = [];
          if (!a.children) return [];
          a = t(a.children);
          for (var d = a.next(); !d.done; d = a.next()) d = d.value, d.tagName === b && c.push(d);
          return c;
        }
        function Zd(a) {
          if ("string" === typeof a) return Pc(a);
          a = a.children.reduce(function(b, c) {
            return "string" === typeof c ? b + c : b;
          }, "");
          return "" === a ? null : Pc(a);
        }
        function $d(a) {
          if (!Array.from(a.children).every(function(b) {
            return "string" === typeof b;
          })) return null;
          (a = Zd(a)) && (a = a.trim());
          return a;
        }
        function ae(a, b, c) {
          c = void 0 === c ? [] : c;
          a.tagName === b && c.push(a);
          if (a.children) {
            a = t(a.children);
            for (var d = a.next(); !d.done; d = a.next()) ae(d.value, b, c);
          }
          return c;
        }
        function be(a, b) {
          a = Yd(a, b);
          return 1 != a.length ? null : a[0];
        }
        function ce(a, b, c) {
          a = ee(a, b, c);
          return 1 != a.length ? null : a[0];
        }
        function he(a, b, c, d) {
          d = void 0 === d ? null : d;
          var e = null;
          a = a.attributes[b];
          null != a && (e = c(a));
          return null == e ? d : e;
        }
        function ie(a, b, c) {
          b = Td(b);
          return a.attributes[b + ":" + c] || null;
        }
        function ee(a, b, c) {
          var d = Td(b);
          b = [];
          if (a.children) for (c = d ? d + ":" + c : c, a = t(a.children), d = a.next(); !d.done; d = a.next()) (d = d.value) && d.tagName === c && b.push(d);
          return b;
        }
        function je(a, b, c) {
          b = t(b);
          for (var d = b.next(); !d.done; d = b.next()) if (d = ie(a, d.value, c)) return d;
          return null;
        }
        function ke(a) {
          if (!a) return null;
          /^\d+-\d+-\d+T\d+:\d+:\d+(\.\d+)?$/.test(a) && (a += "Z");
          a = Date.parse(a);
          return isNaN(a) ? null : a / 1e3;
        }
        function le(a) {
          if (!a) return null;
          a = RegExp("^P(?:([0-9]*)Y)?(?:([0-9]*)M)?(?:([0-9]*)D)?(?:T(?:([0-9]*)H)?(?:([0-9]*)M)?(?:([0-9.]*)S)?)?$", "i").exec(a);
          if (!a) return null;
          a = 31536e3 * Number(a[1] || null) + 2592e3 * Number(a[2] || null) + 86400 * Number(a[3] || null) + 3600 * Number(a[4] || null) + 60 * Number(a[5] || null) + Number(a[6] || null);
          return isFinite(a) ? a : null;
        }
        function me(a) {
          var b = /([0-9]+)-([0-9]+)/.exec(a);
          if (!b) return null;
          a = Number(b[1]);
          if (!isFinite(a)) return null;
          b = Number(b[2]);
          return isFinite(b) ? { start: a, end: b } : null;
        }
        function ne(a) {
          a = Number(a);
          return 0 === a % 1 ? a : null;
        }
        function oe(a) {
          a = Number(a);
          return 0 === a % 1 && 0 < a ? a : null;
        }
        function pe(a) {
          a = Number(a);
          return 0 === a % 1 && 0 <= a ? a : null;
        }
        function qe(a) {
          a = Number(a);
          return isNaN(a) ? null : a;
        }
        function re(a) {
          return a ? "true" === a.toLowerCase() : false;
        }
        function se(a) {
          var b;
          var c = (b = a.match(/^(\d+)\/(\d+)$/)) ? Number(b[1]) / Number(b[2]) : Number(a);
          return isNaN(c) ? null : c;
        }
        function te(a) {
          var b = [];
          a = Pc(a).split(/\/+(?=(?:[^'"]*['"][^'"]*['"])*[^'"]*$)/);
          a = t(a);
          for (var c = a.next(); !c.done; c = a.next()) {
            c = c.value;
            var d = c.match(/^([\w]+)/);
            if (d) {
              var e = c.match(/(@id='(.*?)')/), f = c.match(/(@t='(\d+)')/), g = c.match(/(@n='(\d+)')/), h = c.match(/\[(\d+)\]/);
              b.push({ name: d[0], id: e ? e[0].match(/'(.*?)'/)[0].replace(/'/gm, "") : null, t: f ? Number(f[0].match(/'(.*?)'/)[0].replace(/'/gm, "")) : null, n: g ? Number(g[0].match(/'(.*?)'/)[0].replace(/'/gm, "")) : null, position: h ? Number(h[1]) - 1 : null, ac: c.split("/@")[1] || null });
            } else c.startsWith("@") && b.length && (b[b.length - 1].ac = c.slice(1));
          }
          return b;
        }
        function ue(a, b) {
          var c = te(b.attributes.sel || "");
          if (c.length) {
            var d = c[c.length - 1], e = b.attributes.pos || null;
            c = d.position;
            null == c && (null !== d.t && (c = ve(a, "t", d.t)), null !== d.n && (c = ve(a, "n", d.n)));
            null === c ? c = "prepend" === e ? 0 : a.length : "prepend" === e ? --c : "after" === e && ++c;
            e = b.tagName;
            (d = d.ac) && a[c] ? we(a[c], e, d, $d(b) || "") : ("remove" !== e && "replace" !== e || a.splice(c, 1), "add" !== e && "replace" !== e || a.splice.apply(a, [c, 0].concat(y(b.children))));
          }
        }
        function ve(a, b, c) {
          var d = 0;
          a = t(a);
          for (var e = a.next(); !e.done; e = a.next()) {
            if (Number(e.value.attributes[b]) === c) return d;
            d++;
          }
          return null;
        }
        function we(a, b, c, d) {
          if ("remove" === b) delete a.attributes[c];
          else if ("add" === b || "replace" === b) a.attributes[c] = d;
        }
        function xe(a) {
          var b = "", c = a.tagName.split(":");
          0 < c.length && (b = c[0], b = Vd.has(b) ? Vd.get(b) : "");
          b = document.createElementNS(b, a.tagName);
          for (var d in a.attributes) b.setAttribute(d, a.attributes[d]);
          a = t(a.children);
          for (d = a.next(); !d.done; d = a.next()) d = d.value, c = void 0, "string" == typeof d ? c = new Text(d) : c = xe(d), b.appendChild(c);
          return b;
        }
        function ze(a) {
          if (!a) return null;
          var b = { tagName: a.tagName, attributes: Od(a.attributes), children: [], parent: null };
          a = t(a.children);
          for (var c = a.next(); !c.done; c = a.next()) c = c.value, "string" === typeof c ? b.children.push(c) : (c = ze(c), c.parent = b, b.children.push(c));
          return b;
        }
        var Ud = /* @__PURE__ */ new Map(), Vd = /* @__PURE__ */ new Map();
        function Ae(a, b, c) {
          this.startTime = a;
          this.endTime = b;
          this.payload = c;
          this.region = new yd();
          this.position = null;
          this.positionAlign = Be;
          this.size = 0;
          this.textAlign = Ce;
          this.direction = De;
          this.writingMode = Ee;
          this.lineInterpretation = Fe;
          this.line = null;
          this.lineHeight = "";
          this.lineAlign = Ge;
          this.displayAlign = He;
          this.fontSize = this.border = this.backgroundImage = this.backgroundColor = this.color = "";
          this.fontWeight = Ie;
          this.fontStyle = Je;
          this.linePadding = this.letterSpacing = this.fontFamily = "";
          this.opacity = 1;
          this.textCombineUpright = "";
          this.textDecoration = [];
          this.textStrokeWidth = this.textStrokeColor = this.textShadow = "";
          this.wrapLine = true;
          this.id = "";
          this.nestedCues = [];
          this.lineBreak = this.isContainer = false;
          this.rubyTag = null;
          this.cellResolution = { oc: 32, rows: 15 };
        }
        function Ke(a, b) {
          a = new Ae(a, b, "");
          a.lineBreak = true;
          return a;
        }
        Ae.prototype.clone = function() {
          var a = new Ae(0, 0, ""), b;
          for (b in this) a[b] = this[b], a[b] && a[b].constructor == Array && (a[b] = a[b].slice());
          return a;
        };
        function Le(a, b) {
          if (a.payload != b.payload || !(1e-3 > Math.abs(a.startTime - b.startTime) && 1e-3 > Math.abs(a.endTime - b.endTime))) return false;
          for (var c in a) if ("startTime" != c && "endTime" != c && "payload" != c) {
            if ("nestedCues" == c) {
              if (!Ed(a.nestedCues, b.nestedCues, Le)) return false;
            } else if ("region" == c || "cellResolution" == c) for (var d in a[c]) {
              if (a[c][d] != b[c][d]) return false;
            }
            else if (Array.isArray(a[c])) {
              if (!Ed(a[c], b[c])) return false;
            } else if (a[c] != b[c]) return false;
          }
          return true;
        }
        function Me(a, b) {
          b = void 0 === b ? /* @__PURE__ */ new Map() : b;
          var c = a.payload;
          if (c.includes("<")) {
            0 === b.size && Ne(b);
            var d = c;
            c = [];
            for (var e = -1, f = 0; f < d.length; f++) "<" === d[f] ? e = f + 1 : ">" === d[f] && 0 < e && (e = d.substr(e, f - e), e.match(Pe) && c.push(e), e = -1);
            c = t(c);
            for (f = c.next(); !f.done; f = c.next()) f = f.value, d = d.replace("<" + f + ">", '<div time="' + f + '">'), d += "</div>";
            a: {
              f = d;
              e = [];
              var g = -1;
              c = "";
              d = false;
              for (var h = 0; h < f.length; h++) if ("/" === f[h]) {
                var k2 = f.indexOf(">", h);
                if (-1 === k2) {
                  c = f;
                  break a;
                }
                if ((k2 = f.substring(h + 1, k2)) && "v" == k2) {
                  d = true;
                  var l = null;
                  e.length && (l = e[e.length - 1]);
                  if (l) {
                    if (l === k2) c += "/" + k2 + ">";
                    else {
                      if (!l.startsWith("v")) {
                        c += f[h];
                        continue;
                      }
                      c += "/" + l + ">";
                    }
                    h += k2.length + 1;
                  } else c += f[h];
                } else c += f[h];
              } else "<" === f[h] ? (g = h + 1, "v" != f[g] && (g = -1)) : ">" === f[h] && 0 < g && (e.push(f.substr(g, h - g)), g = -1), c += f[h];
              f = t(e);
              for (e = f.next(); !e.done; e = f.next()) e = e.value, g = e.replace(" ", ".voice-"), c = c.replace("<" + e + ">", "<" + g + ">"), c = c.replace("</" + e + ">", "</" + g + ">"), d || (c += "</" + g + ">");
            }
            c = Qe(c);
            a.payload = "";
            try {
              var m = Rd("<span>" + c + "</span>", "span");
            } catch (n) {
            }
            if (m) if (m = m.children, 1 != m.length || m[0].tagName) for (m = t(m), c = m.next(); !c.done; c = m.next()) Re(c.value, a, b);
            else a.payload = Pc(c);
            else a.payload = Pc(c);
          } else a.payload = Pc(c);
        }
        function Ne(a) {
          for (var b = t(Object.entries(Se)), c = b.next(); !c.done; c = b.next()) {
            var d = t(c.value);
            c = d.next().value;
            d = d.next().value;
            var e = new Ae(0, 0, "");
            e.color = d;
            a.set("." + c, e);
          }
          b = t(Object.entries(Te));
          for (c = b.next(); !c.done; c = b.next()) d = t(c.value), c = d.next().value, d = d.next().value, e = new Ae(0, 0, ""), e.backgroundColor = d, a.set("." + c, e);
        }
        function Qe(a) {
          var b = { "< ": "", " >": " &gt;" }, c = /(< +>|<\s|\s>)/g, d = RegExp(c.source);
          return a && d.test(a) ? a.replace(c, function(e) {
            return b[e] || "";
          }) : a || "";
        }
        function Re(a, b, c) {
          var d = b.clone();
          d.nestedCues = [];
          d.payload = "";
          d.rubyTag = "";
          d.line = null;
          d.region = new yd();
          d.position = null;
          d.size = 0;
          d.textAlign = Ce;
          if (a.tagName) for (var e = t(a.tagName.split(/(?=[ .])+/g)), f = e.next(); !f.done; f = e.next()) {
            var g = f = f.value;
            if (g.startsWith(".voice-")) {
              var h = g.split("-").pop();
              g = 'v[voice="' + h + '"]';
              c.has(g) || (g = "v[voice=" + h + "]");
            }
            c.has(g) && (h = d, g = c.get(g)) && (h.backgroundColor = Ue(g.backgroundColor, h.backgroundColor), h.color = Ue(g.color, h.color), h.fontFamily = Ue(g.fontFamily, h.fontFamily), h.fontSize = Ue(g.fontSize, h.fontSize), h.textShadow = Ue(g.textShadow, h.textShadow), h.fontWeight = g.fontWeight, h.fontStyle = g.fontStyle, h.opacity = g.opacity, h.rubyTag = g.rubyTag, h.textCombineUpright = g.textCombineUpright, h.wrapLine = g.wrapLine);
            switch (f) {
              case "br":
                d = Ke(d.startTime, d.endTime);
                b.nestedCues.push(d);
                return;
              case "b":
                d.fontWeight = Ve;
                break;
              case "i":
                d.fontStyle = We;
                break;
              case "u":
                d.textDecoration.push(Xe);
                break;
              case "font":
                if (f = a.attributes.color) d.color = f;
                break;
              case "div":
                f = a.attributes.time;
                if (!f) break;
                if (f = Md(f)) d.startTime = f;
                break;
              case "ruby":
              case "rp":
              case "rt":
                d.rubyTag = f;
            }
          }
          e = a.children;
          if (Wd(a) || 1 == e.length && Wd(e[0])) for (c = Zd(a).split("\n"), a = true, c = t(c), e = c.next(); !e.done; e = c.next()) e = e.value, a || (a = Ke(d.startTime, d.endTime), b.nestedCues.push(a)), 0 < e.length && (a = d.clone(), a.payload = Pc(e), b.nestedCues.push(a)), a = false;
          else for (b.nestedCues.push(d), b = t(e), a = b.next(); !a.done; a = b.next()) Re(a.value, d, c);
        }
        function Ue(a, b) {
          return a && 0 < a.length ? a : b;
        }
        T("shaka.text.Cue", Ae);
        Ae.parseCuePayload = Me;
        Ae.equal = Le;
        Ae.prototype.clone = Ae.prototype.clone;
        var Be = "auto";
        Ae.positionAlign = { LEFT: "line-left", RIGHT: "line-right", CENTER: "center", AUTO: Be };
        var Ce = "center", Ye = { LEFT: "left", RIGHT: "right", CENTER: Ce, START: "start", END: "end" };
        Ae.textAlign = Ye;
        var He = "after", Ze = { BEFORE: "before", CENTER: "center", AFTER: He };
        Ae.displayAlign = Ze;
        var De = "ltr";
        Ae.direction = { HORIZONTAL_LEFT_TO_RIGHT: De, HORIZONTAL_RIGHT_TO_LEFT: "rtl" };
        var Ee = "horizontal-tb";
        Ae.writingMode = { HORIZONTAL_TOP_TO_BOTTOM: Ee, VERTICAL_LEFT_TO_RIGHT: "vertical-lr", VERTICAL_RIGHT_TO_LEFT: "vertical-rl" };
        var Fe = 0;
        Ae.lineInterpretation = { LINE_NUMBER: Fe, PERCENTAGE: 1 };
        var Ge = "start", $e = { CENTER: "center", START: Ge, END: "end" };
        Ae.lineAlign = $e;
        var Se = { white: "white", lime: "lime", cyan: "cyan", red: "red", yellow: "yellow", magenta: "magenta", blue: "blue", black: "black" };
        Ae.defaultTextColor = Se;
        var Te = { bg_white: "white", bg_lime: "lime", bg_cyan: "cyan", bg_red: "red", bg_yellow: "yellow", bg_magenta: "magenta", bg_blue: "blue", bg_black: "black" };
        Ae.defaultTextBackgroundColor = Te;
        var Ie = 400, Ve = 700;
        Ae.fontWeight = { NORMAL: Ie, BOLD: Ve };
        var Je = "normal", We = "italic", af = { NORMAL: Je, ITALIC: We, OBLIQUE: "oblique" };
        Ae.fontStyle = af;
        var Xe = "underline";
        Ae.textDecoration = { UNDERLINE: Xe, LINE_THROUGH: "lineThrough", OVERLINE: "overline" };
        var Pe = /(?:(\d{1,}):)?(\d{2}):(\d{2})\.(\d{2,3})/g;
        function bf() {
        }
        bf.prototype.destroy = function() {
        };
        function cf(a, b, c) {
          df.set(a.toLowerCase().split(";")[0] + "-" + c, { priority: c, se: b });
        }
        function ef(a, b) {
          for (var c = a.toLowerCase().split(";")[0], d = t([ff, gf, hf, jf]), e = d.next(); !e.done; e = d.next()) if (e = df.get(c + "-" + e.value)) {
            var f = e.se(), g = f.isSupported(a, b);
            f.destroy();
            if (g) return e.se;
          }
          return null;
        }
        T("shaka.transmuxer.TransmuxerEngine", bf);
        bf.findTransmuxer = ef;
        bf.unregisterTransmuxer = function(a, b) {
          df.delete(a.toLowerCase().split(";")[0] + "-" + b);
        };
        bf.registerTransmuxer = cf;
        bf.prototype.destroy = bf.prototype.destroy;
        var df = /* @__PURE__ */ new Map(), jf = 1, hf = 2, gf = 3, ff = 4;
        bf.PluginPriority = { FALLBACK: jf, PREFERRED_SECONDARY: hf, PREFERRED: gf, APPLICATION: ff };
        function kf() {
        }
        function lf(a, b) {
          var c = a;
          b && !mf.includes(a) && (c += '; codecs="' + b + '"');
          return c;
        }
        function nf(a, b) {
          b && (a += '; codecs="' + b + '"');
          return a;
        }
        function of(a, b, c) {
          var d = lf(a, b);
          b = nf(a, b);
          ef(b) ? (a = ef(b)) ? (a = a(), c = a.convertCodecs(c, b), a.destroy()) : c = b : c = "video/mp2t" != a && "audio" == c ? d.replace("video", "audio") : d;
          return c;
        }
        function pf(a, b, c) {
          var d = [b];
          qf.forEach(function(e, f) {
            var g = a[f];
            "codecs" == f ? mf.includes(a.mimeType) || d.push('codecs="' + c + '"') : g && d.push(e + '="' + g + '"');
          });
          "PQ" == a.hdr && d.push('eotf="smpte2084"');
          return d.join(";");
        }
        function rf(a) {
          return a.split(";")[0].split("/")[1];
        }
        function sf(a) {
          var b = tf(a);
          a = b[0].toLowerCase();
          b = b[1].toLowerCase();
          switch (true) {
            case ("mp4a" === a && "69" === b):
            case ("mp4a" === a && "6b" === b):
            case ("mp4a" === a && "40.34" === b):
              return "mp3";
            case ("mp4a" === a && "66" === b):
            case ("mp4a" === a && "67" === b):
            case ("mp4a" === a && "68" === b):
            case ("mp4a" === a && "40.2" === b):
            case ("mp4a" === a && "40.02" === b):
            case ("mp4a" === a && "40.5" === b):
            case ("mp4a" === a && "40.05" === b):
            case ("mp4a" === a && "40.29" === b):
            case ("mp4a" === a && "40.42" === b):
              return "aac";
            case ("mp4a" === a && "a5" === b):
            case "ac3" === a:
            case "ac-3" === a:
              return "ac-3";
            case ("mp4a" === a && "a6" === b):
            case "eac3" === a:
            case "ec-3" === a:
              return "ec-3";
            case "ac-4" === a:
              return "ac-4";
            case ("mp4a" === a && "b2" === b):
              return "dtsx";
            case ("mp4a" === a && "a9" === b):
              return "dtsc";
            case "vp09" === a:
            case "vp9" === a:
              return "vp9";
            case "avc1" === a:
            case "avc3" === a:
              return "avc";
            case "hvc1" === a:
            case "hev1" === a:
              return "hevc";
            case "vvc1" === a:
            case "vvi1" === a:
              return "vvc";
            case "dvh1" === a:
            case "dvhe" === a:
              return b && b.startsWith("05") ? "dovi-p5" : "dovi-hevc";
            case "dvav" === a:
            case "dva1" === a:
              return "dovi-avc";
            case "dav1" === a:
              return "dovi-av1";
            case "dvc1" === a:
            case "dvi1" === a:
              return "dovi-vvc";
          }
          return a;
        }
        function uf(a) {
          var b = [];
          a = t(a.split(","));
          for (var c = a.next(); !c.done; c = a.next()) c = tf(c.value), b.push(c[0]);
          return b.sort().join(",");
        }
        function vf(a) {
          return a.split(";")[0];
        }
        function wf(a) {
          a = a.split(/ *; */);
          a.shift();
          return (a = a.find(function(b) {
            return b.startsWith("codecs=");
          })) ? a.split("=")[1].replace(/^"|"$/g, "") : "";
        }
        function xf(a) {
          return "application/x-mpegurl" === a || "application/vnd.apple.mpegurl" === a;
        }
        function tf(a) {
          a = a.split(".");
          var b = a[0];
          a.shift();
          return [b, a.join(".")];
        }
        T("shaka.util.MimeUtils", kf);
        kf.getFullTypeWithAllCodecs = nf;
        kf.getFullType = lf;
        var qf = (/* @__PURE__ */ new Map()).set("codecs", "codecs").set("frameRate", "framerate").set("bandwidth", "bitrate").set("width", "width").set("height", "height").set("channelsCount", "channels"), mf = ["audio/aac", "audio/ac3", "audio/ec3", "audio/mpeg"];
        function yf(a) {
          this.i = null;
          this.j = a;
          this.B = false;
          this.l = this.u = 0;
          this.m = Infinity;
          this.h = this.g = null;
          this.C = "";
          this.A = function() {
          };
          this.o = /* @__PURE__ */ new Map();
        }
        function zf(a, b) {
          Af.set(a, b);
        }
        function Bf(a) {
          return Af.get(a);
        }
        function Cf(a) {
          return Af.has(a) ? true : "application/cea-608" == a || "application/cea-708" == a ? !!vd : false;
        }
        yf.prototype.destroy = function() {
          this.j = this.i = null;
          this.o.clear();
          return Promise.resolve();
        };
        function Df(a, b, c, d, e) {
          var f, g, h, k2, l, m, n;
          return Q(function(p) {
            if (1 == p.g) return F(p, Promise.resolve(), 2);
            if (!a.i || !a.j) return p.return();
            if (null == c || null == d) return a.i.parseInit(Qb(b)), p.return();
            f = a.B ? c : a.u;
            g = { periodStart: a.u, segmentStart: c, segmentEnd: d, vttOffset: f };
            h = a.i.parseMedia(Qb(b), g, e, []);
            k2 = t(h);
            for (l = k2.next(); !l.done; l = k2.next()) m = l.value, a.A(m, e || null, g);
            n = h.filter(function(q) {
              return q.startTime >= a.l && q.startTime < a.m;
            });
            a.j.append(n);
            null == a.g && (a.g = Math.max(c, a.l));
            a.h = Math.min(d, a.m);
            I(p);
          });
        }
        yf.prototype.remove = function(a, b) {
          var c = this;
          return Q(function(d) {
            if (1 == d.g) return F(d, Promise.resolve(), 2);
            !c.j || !c.j.remove(a, b) || null == c.g || b <= c.g || a >= c.h || (a <= c.g && b >= c.h ? c.g = c.h = null : a <= c.g && b < c.h ? c.g = b : a > c.g && b >= c.h && (c.h = a));
            I(d);
          });
        };
        function Ef(a, b, c) {
          a.l = b;
          a.m = c;
        }
        function Ff(a, b, c) {
          a.C = b;
          if (b = a.o.get(b)) for (var d = t(b.keys()), e = d.next(); !e.done; e = d.next()) (e = b.get(e.value).filter(function(f) {
            return f.endTime <= c;
          })) && a.j.append(e);
        }
        function Gf(a, b, c) {
          b.startTime += c;
          b.endTime += c;
          b = t(b.nestedCues);
          for (var d = b.next(); !d.done; d = b.next()) Gf(a, d.value, c);
        }
        function Hf(a, b, c, d, e) {
          var f = c + " " + d, g = /* @__PURE__ */ new Map();
          b = t(b);
          for (var h = b.next(); !h.done; h = b.next()) {
            var k2 = h.value;
            h = k2.stream;
            k2 = k2.cue;
            g.has(h) || g.set(h, /* @__PURE__ */ new Map());
            g.get(h).has(f) || g.get(h).set(f, []);
            Gf(a, k2, e);
            k2.startTime >= a.l && k2.startTime < a.m && (g.get(h).get(f).push(k2), h == a.C && a.j.append([k2]));
          }
          e = t(g.keys());
          for (f = e.next(); !f.done; f = e.next()) for (f = f.value, a.o.has(f) || a.o.set(f, /* @__PURE__ */ new Map()), b = t(g.get(f).keys()), h = b.next(); !h.done; h = b.next()) h = h.value, k2 = g.get(f).get(h), a.o.get(f).set(h, k2);
          a.g = null == a.g ? Math.max(
            c,
            a.l
          ) : Math.min(a.g, Math.max(c, a.l));
          a.h = Math.max(a.h, Math.min(d, a.m));
        }
        T("shaka.text.TextEngine", yf);
        yf.prototype.destroy = yf.prototype.destroy;
        yf.findParser = Bf;
        yf.unregisterParser = function(a) {
          Af.delete(a);
        };
        yf.registerParser = zf;
        var Af = /* @__PURE__ */ new Map();
        function If(a, b) {
          return a.concat(b);
        }
        function Jf() {
        }
        function Kf(a) {
          return null != a;
        }
        function Lf(a, b) {
          return Promise.race([b, new Promise(function(c, d) {
            new ec(d).da(a);
          })]);
        }
        function Mf() {
        }
        function Nf(a, b) {
          a = Of(a);
          b = Of(b);
          return a.split("-")[0] == b.split("-")[0];
        }
        function Pf(a, b) {
          a = Of(a);
          b = Of(b);
          a = a.split("-");
          b = b.split("-");
          return a[0] == b[0] && 1 == a.length && 2 == b.length;
        }
        function Sf(a, b) {
          a = Of(a);
          b = Of(b);
          a = a.split("-");
          b = b.split("-");
          return 2 == a.length && 2 == b.length && a[0] == b[0];
        }
        function Of(a) {
          a = t(a.split("-x-"));
          var b = a.next().value;
          b = void 0 === b ? "" : b;
          a = a.next().value;
          a = void 0 === a ? "" : a;
          var c = t(b.split("-"));
          b = c.next().value;
          b = void 0 === b ? "" : b;
          c = c.next().value;
          c = void 0 === c ? "" : c;
          a = a ? "x-" + a : "";
          b = b.toLowerCase();
          b = Tf.get(b) || b;
          c = c.toUpperCase();
          return (c ? b + "-" + c : b) + (a ? "-" + a : "");
        }
        function Uf(a, b) {
          a = Of(a);
          b = Of(b);
          return b == a ? 4 : Pf(b, a) ? 3 : Sf(b, a) ? 2 : Pf(a, b) ? 1 : 0;
        }
        function Vf(a) {
          var b = a.indexOf("-");
          a = 0 <= b ? a.substring(0, b) : a;
          a = a.toLowerCase();
          return a = Tf.get(a) || a;
        }
        function $f(a) {
          return a.language ? Of(a.language) : a.audio && a.audio.language ? Of(a.audio.language) : a.video && a.video.language ? Of(a.video.language) : "und";
        }
        function ag(a, b) {
          a = Of(a);
          var c = /* @__PURE__ */ new Set();
          b = t(b);
          for (var d = b.next(); !d.done; d = b.next()) c.add(Of(d.value));
          b = t(c);
          for (d = b.next(); !d.done; d = b.next()) if (d = d.value, d == a) return d;
          b = t(c);
          for (d = b.next(); !d.done; d = b.next()) if (d = d.value, Pf(d, a)) return d;
          b = t(c);
          for (d = b.next(); !d.done; d = b.next()) if (d = d.value, Sf(d, a)) return d;
          c = t(c);
          for (b = c.next(); !b.done; b = c.next()) if (b = b.value, Pf(a, b)) return b;
          return null;
        }
        T("shaka.util.LanguageUtils", Mf);
        Mf.findClosestLocale = ag;
        Mf.getLocaleForVariant = $f;
        Mf.getLocaleForText = function(a) {
          return Of(a.language || "und");
        };
        Mf.getBase = Vf;
        Mf.relatedness = Uf;
        Mf.areSiblings = function(a, b) {
          var c = Vf(a), d = Vf(b);
          return a != c && b != d && c == d;
        };
        Mf.normalize = Of;
        Mf.isSiblingOf = Sf;
        Mf.isParentOf = Pf;
        Mf.areLanguageCompatible = Nf;
        Mf.areLocaleCompatible = function(a, b) {
          a = Of(a);
          b = Of(b);
          return a == b;
        };
        var Tf = /* @__PURE__ */ new Map([["aar", "aa"], ["abk", "ab"], ["afr", "af"], ["aka", "ak"], ["alb", "sq"], ["amh", "am"], ["ara", "ar"], ["arg", "an"], ["arm", "hy"], ["asm", "as"], ["ava", "av"], ["ave", "ae"], ["aym", "ay"], ["aze", "az"], ["bak", "ba"], ["bam", "bm"], ["baq", "eu"], ["bel", "be"], ["ben", "bn"], ["bih", "bh"], ["bis", "bi"], ["bod", "bo"], ["bos", "bs"], ["bre", "br"], ["bul", "bg"], ["bur", "my"], ["cat", "ca"], ["ces", "cs"], ["cha", "ch"], ["che", "ce"], ["chi", "zh"], ["chu", "cu"], ["chv", "cv"], ["cor", "kw"], ["cos", "co"], ["cre", "cr"], ["cym", "cy"], [
          "cze",
          "cs"
        ], ["dan", "da"], ["deu", "de"], ["div", "dv"], ["dut", "nl"], ["dzo", "dz"], ["ell", "el"], ["eng", "en"], ["epo", "eo"], ["est", "et"], ["eus", "eu"], ["ewe", "ee"], ["fao", "fo"], ["fas", "fa"], ["fij", "fj"], ["fin", "fi"], ["fra", "fr"], ["fre", "fr"], ["fry", "fy"], ["ful", "ff"], ["geo", "ka"], ["ger", "de"], ["gla", "gd"], ["gle", "ga"], ["glg", "gl"], ["glv", "gv"], ["gre", "el"], ["grn", "gn"], ["guj", "gu"], ["hat", "ht"], ["hau", "ha"], ["heb", "he"], ["her", "hz"], ["hin", "hi"], ["hmo", "ho"], ["hrv", "hr"], ["hun", "hu"], ["hye", "hy"], ["ibo", "ig"], [
          "ice",
          "is"
        ], ["ido", "io"], ["iii", "ii"], ["iku", "iu"], ["ile", "ie"], ["ina", "ia"], ["ind", "id"], ["ipk", "ik"], ["isl", "is"], ["ita", "it"], ["jav", "jv"], ["jpn", "ja"], ["kal", "kl"], ["kan", "kn"], ["kas", "ks"], ["kat", "ka"], ["kau", "kr"], ["kaz", "kk"], ["khm", "km"], ["kik", "ki"], ["kin", "rw"], ["kir", "ky"], ["kom", "kv"], ["kon", "kg"], ["kor", "ko"], ["kua", "kj"], ["kur", "ku"], ["lao", "lo"], ["lat", "la"], ["lav", "lv"], ["lim", "li"], ["lin", "ln"], ["lit", "lt"], ["ltz", "lb"], ["lub", "lu"], ["lug", "lg"], ["mac", "mk"], ["mah", "mh"], ["mal", "ml"], [
          "mao",
          "mi"
        ], ["mar", "mr"], ["may", "ms"], ["mkd", "mk"], ["mlg", "mg"], ["mlt", "mt"], ["mon", "mn"], ["mri", "mi"], ["msa", "ms"], ["mya", "my"], ["nau", "na"], ["nav", "nv"], ["nbl", "nr"], ["nde", "nd"], ["ndo", "ng"], ["nep", "ne"], ["nld", "nl"], ["nno", "nn"], ["nob", "nb"], ["nor", "no"], ["nya", "ny"], ["oci", "oc"], ["oji", "oj"], ["ori", "or"], ["orm", "om"], ["oss", "os"], ["pan", "pa"], ["per", "fa"], ["pli", "pi"], ["pol", "pl"], ["por", "pt"], ["pus", "ps"], ["que", "qu"], ["roh", "rm"], ["ron", "ro"], ["rum", "ro"], ["run", "rn"], ["rus", "ru"], ["sag", "sg"], [
          "san",
          "sa"
        ], ["sin", "si"], ["slk", "sk"], ["slo", "sk"], ["slv", "sl"], ["sme", "se"], ["smo", "sm"], ["sna", "sn"], ["snd", "sd"], ["som", "so"], ["sot", "st"], ["spa", "es"], ["sqi", "sq"], ["srd", "sc"], ["srp", "sr"], ["ssw", "ss"], ["sun", "su"], ["swa", "sw"], ["swe", "sv"], ["tah", "ty"], ["tam", "ta"], ["tat", "tt"], ["tel", "te"], ["tgk", "tg"], ["tgl", "tl"], ["tha", "th"], ["tib", "bo"], ["tir", "ti"], ["ton", "to"], ["tsn", "tn"], ["tso", "ts"], ["tuk", "tk"], ["tur", "tr"], ["twi", "tw"], ["uig", "ug"], ["ukr", "uk"], ["urd", "ur"], ["uzb", "uz"], ["ven", "ve"], [
          "vie",
          "vi"
        ], ["vol", "vo"], ["wel", "cy"], ["wln", "wa"], ["wol", "wo"], ["xho", "xh"], ["yid", "yi"], ["yor", "yo"], ["zha", "za"], ["zho", "zh"], ["zul", "zu"]]);
        function bg() {
        }
        function cg(a, b, c, d, e) {
          function f(x) {
            var z = String(x.width || "") + String(x.height || "") + String(Math.round(x.frameRate || 0)) + (x.hdr || "") + x.fastSwitching;
            x.dependencyStream && (z += x.dependencyStream.baseOriginalId || "");
            return z;
          }
          function g(x) {
            var z = x.language + (x.channelsCount || 0) + (x.audioSamplingRate || 0) + x.roles.join(",") + x.label + x.groupId + x.fastSwitching;
            x.dependencyStream && (z += x.dependencyStream.baseOriginalId || "");
            return z;
          }
          if (e.length) {
            var h = a.textStreams;
            e = t(e);
            for (var k2 = e.next(), l = {}; !k2.done; l = { sg: void 0 }, k2 = e.next()) if (l.sg = k2.value, k2 = h.filter(/* @__PURE__ */ function(x) {
              return function(z) {
                return z.codecs.startsWith(x.sg) || z.mimeType.startsWith(x.sg) ? true : false;
              };
            }(l)), k2.length) {
              h = k2;
              break;
            }
            a.textStreams = h;
          }
          h = a.variants;
          if (b.length || c.length) h = dg(h, b, c);
          if (d.length) {
            b = new kb();
            c = t(h);
            for (h = c.next(); !h.done; h = c.next()) h = h.value, b.push(String(h.video.width || 0), h);
            var m = [];
            b.forEach(function(x, z) {
              x = 0;
              var C = [];
              z = t(z);
              for (var D = z.next(), G = {}; !D.done; G = { Pe: void 0 }, D = z.next()) G.Pe = D.value, D = d.filter(/* @__PURE__ */ function(B) {
                return function(A) {
                  return B.Pe.decodingInfos[0][A];
                };
              }(G)).length, D > x ? (x = D, C = [G.Pe]) : D == x && C.push(G.Pe);
              m.push.apply(m, y(C));
            });
            h = m;
          }
          c = /* @__PURE__ */ new Set();
          b = /* @__PURE__ */ new Set();
          h = t(h);
          for (e = h.next(); !e.done; e = h.next()) e = e.value, e.audio && c.add(e.audio), e.video && b.add(e.video);
          h = Array.from(c).sort(function(x, z) {
            return x.bandwidth - z.bandwidth;
          });
          var n = [];
          c = /* @__PURE__ */ new Map();
          h = t(h);
          for (e = h.next(); !e.done; e = h.next()) {
            e = e.value;
            k2 = g(e);
            l = c.get(k2) || [];
            if (l.length) {
              var p = l[l.length - 1], q = sf(p.codecs), u = sf(e.codecs);
              q != u || e.bandwidth && p.bandwidth && !(e.bandwidth > p.bandwidth) || (l.push(e), n.push(e.id));
            } else l.push(e), n.push(e.id);
            c.set(k2, l);
          }
          var w = { vp8: 1, avc: 1, "dovi-avc": 0.95, vp9: 0.9, vp09: 0.9, hevc: 0.85, "dovi-hevc": 0.8, "dovi-p5": 0.75, av01: 0.7, "dovi-av1": 0.65, vvc: 0.6 };
          h = Array.from(b).sort(function(x, z) {
            if (!x.bandwidth || !z.bandwidth || x.bandwidth == z.bandwidth) {
              if (x.codecs && z.codecs && x.codecs != z.codecs && x.width == z.width) {
                var C = sf(x.codecs), D = sf(z.codecs);
                if (C != D) return (w[C] || 1) - (w[D] || 1);
              }
              return x.width - z.width;
            }
            return x.bandwidth - z.bandwidth;
          });
          b = od();
          var v = [];
          c = /* @__PURE__ */ new Map();
          h = t(h);
          for (e = h.next(); !e.done; e = h.next()) {
            e = e.value;
            k2 = f(e);
            l = c.get(k2) || [];
            if (l.length) {
              p = l[l.length - 1];
              if (!b && (q = sf(p.codecs), u = sf(e.codecs), q !== u)) continue;
              q = sf(p.codecs);
              u = sf(e.codecs);
              q != u || e.bandwidth && p.bandwidth && !(e.bandwidth > p.bandwidth) || (l.push(e), v.push(e.id));
            } else l.push(e), v.push(e.id);
            c.set(k2, l);
          }
          a.variants = a.variants.filter(function(x) {
            var z = x.audio;
            x = x.video;
            return z && !n.includes(z.id) || x && !v.includes(x.id) ? false : true;
          });
        }
        function dg(a, b, c) {
          b = t(b);
          for (var d = b.next(), e = {}; !d.done; e = { Lh: void 0 }, d = b.next()) if (e.Lh = d.value, d = a.filter(/* @__PURE__ */ function(f) {
            return function(g) {
              return g.video && g.video.codecs.startsWith(f.Lh);
            };
          }(e)), d.length) {
            a = d;
            break;
          }
          c = t(c);
          b = c.next();
          for (d = {}; !b.done; d = { Cg: void 0 }, b = c.next()) if (d.Cg = b.value, b = a.filter(/* @__PURE__ */ function(f) {
            return function(g) {
              return g.audio && g.audio.codecs.startsWith(f.Cg);
            };
          }(d)), b.length) {
            a = b;
            break;
          }
          return a;
        }
        function eg(a, b, c) {
          a.variants = a.variants.filter(function(d) {
            return fg(d, b, c);
          });
        }
        function fg(a, b, c) {
          function d(h, k2, l) {
            return h >= k2 && h <= l;
          }
          var e = a.video;
          if (e && e.width && e.height) {
            var f = e.width, g = e.height;
            g > f && (g = t([g, f]), f = g.next().value, g = g.next().value);
            if (!d(f, b.minWidth, Math.min(b.maxWidth, c.width)) || !d(g, b.minHeight, Math.min(b.maxHeight, c.height)) || !d(e.width * e.height, b.minPixels, b.maxPixels)) return false;
          }
          return a && a.video && a.video.frameRate && !d(a.video.frameRate, b.minFrameRate, b.maxFrameRate) || a && a.audio && a.audio.channelsCount && !d(a.audio.channelsCount, b.minChannelsCount, b.maxChannelsCount) || !d(a.bandwidth, b.minBandwidth, b.maxBandwidth) ? false : true;
        }
        function gg(a, b, c, d) {
          c = void 0 === c ? [] : c;
          d = void 0 === d ? {} : d;
          return Q(function(e) {
            if (1 == e.g) return F(e, hg(a, b, 0 < b.offlineSessionIds.length, c, d), 2);
            ig(b);
            return F(e, jg(b), 0);
          });
        }
        function hg(a, b, c, d, e) {
          var f, g;
          return Q(function(h) {
            if (1 == h.g) return jc() && kg(b.variants), F(h, lg(b.variants, c, false, d), 2);
            f = null;
            a && (g = a.h) && (f = g.keySystem);
            b.variants = b.variants.filter(function(k2) {
              var l = mg(k2, f, e);
              if (!l) {
                var m = [];
                k2.audio && m.push(ng(k2.audio));
                k2.video && m.push(ng(k2.video));
              }
              return l;
            });
            I(h);
          });
        }
        function kg(a) {
          var b = (/* @__PURE__ */ new Map()).set("dvav", "avc3").set("dva1", "avc1").set("dvhe", "hev1").set("dvh1", "hvc1").set("dvc1", "vvc1").set("dvi1", "vvi1"), c = /* @__PURE__ */ new Set();
          a = t(a);
          for (var d = a.next(); !d.done; d = a.next()) d = d.value, d.video && c.add(d.video);
          c = t(c);
          for (a = c.next(); !a.done; a = c.next()) {
            a = a.value;
            d = t(b);
            for (var e = d.next(); !e.done; e = d.next()) {
              var f = t(e.value);
              e = f.next().value;
              f = f.next().value;
              if (a.codecs.includes(e)) {
                a.codecs = a.codecs.replace(e, f);
                break;
              }
            }
          }
        }
        function mg(a, b, c) {
          if (!a.decodingInfos.some(function(k2) {
            return !k2.supported || b && (k2 = k2.keySystemAccess) && (c[k2.keySystem] || k2.keySystem) != b ? false : true;
          })) return false;
          var d = jc(), e = kc("Firefox") && yc(), f = a.video, g = f && f.width || 0, h = f && f.height || 0;
          if (d && f && (1920 < g || 1080 < h) && (f.codecs.includes("avc1.") || f.codecs.includes("avc3.")) || (d = f && f.dependencyStream) && !ld(d)) return false;
          a = a.audio;
          return e && a && a.encrypted && a.codecs.toLowerCase().includes("opus") || a && a.dependencyStream ? false : true;
        }
        function og(a, b) {
          var c, d, e, f, g, h, k2;
          return Q(function(l) {
            if (1 == l.g) {
              c = function(m, n) {
                if (m) {
                  var p = Od(m);
                  p.supported = m.supported && n.supported;
                  p.powerEfficient = m.powerEfficient && n.powerEfficient;
                  p.smooth = m.smooth && n.smooth;
                  n.keySystemAccess && !p.keySystemAccess && (p.keySystemAccess = n.keySystemAccess);
                  return p;
                }
                return n;
              };
              d = null;
              e = [];
              f = t(b);
              g = f.next();
              for (h = {}; !g.done; h = { cache: void 0, Rd: void 0 }, g = f.next()) k2 = g.value, h.Rd = Pd(k2), h.cache = pg, h.cache.has(h.Rd) ? d = c(d, h.cache.get(h.Rd)) : e.push(qg(k2).then(/* @__PURE__ */ function(m) {
                return function(n) {
                  var p = null;
                  n = t(n || []);
                  for (var q = n.next(); !q.done; q = n.next()) p = c(p, q.value);
                  p && (m.cache.set(m.Rd, p), d = c(d, p));
                };
              }(h)));
              return F(l, Promise.all(e), 2);
            }
            d && a.decodingInfos.push(d);
            I(l);
          });
        }
        function qg(a) {
          var b = [""];
          a.video && (b = wf(a.video.contentType).split(","));
          var c = [""];
          a.audio && (c = wf(a.audio.contentType).split(","));
          var d = [];
          b = t(b);
          for (var e = b.next(); !e.done; e = b.next()) {
            e = e.value;
            for (var f = t(c), g = f.next(), h = {}; !g.done; h = { pc: void 0 }, g = f.next()) g = g.value, h.pc = Nd(a), a.video && (h.pc.video.contentType = lf(vf(h.pc.video.contentType), e)), a.audio && (h.pc.audio.contentType = lf(vf(h.pc.audio.contentType), g)), d.push(new Promise(/* @__PURE__ */ function(k2) {
              return function(l, m) {
                (yc() ? Lf(5, navigator.mediaCapabilities.decodingInfo(k2.pc)) : navigator.mediaCapabilities.decodingInfo(k2.pc)).then(function(n) {
                  l(n);
                }).catch(m);
              };
            }(h)));
          }
          return Promise.all(d).catch(function() {
            JSON.stringify(a);
            return null;
          });
        }
        function lg(a, b, c, d) {
          var f, g, h, k2, l, m, n, p, q, u, w, v, x, z, C, D, G, B;
          return Q(function(A) {
            switch (A.g) {
              case 1:
                if (a.some(function(H) {
                  return H.decodingInfos.length;
                })) return A.return();
                f = t(d);
                g = f.next();
                h = {};
              case 2:
                if (g.done) {
                  A.s(4);
                  break;
                }
                h.mh = g.value;
                k2 = false;
                l = t(a);
                m = l.next();
              case 5:
                if (m.done) {
                  A.s(7);
                  break;
                }
                n = m.value;
                p = rg(n, b, c).filter(/* @__PURE__ */ function(H) {
                  return function(E) {
                    E = E[0];
                    return (E.keySystemConfiguration && E.keySystemConfiguration.keySystem) === H.mh;
                  };
                }(h));
                q = t(p);
                u = q.next();
              case 8:
                if (u.done) {
                  A.s(10);
                  break;
                }
                w = u.value;
                return F(A, og(n, w), 9);
              case 9:
                u = q.next();
                A.s(8);
                break;
              case 10:
                n.decodingInfos.length && (k2 = true);
                m = l.next();
                A.s(5);
                break;
              case 7:
                if (k2) return A.return();
                h = { mh: void 0 };
                g = f.next();
                A.s(2);
                break;
              case 4:
                v = t(a), x = v.next();
              case 12:
                if (x.done) {
                  A.s(0);
                  break;
                }
                z = x.value;
                C = rg(z, b, c).filter(function(H) {
                  H = H[0];
                  H = H.keySystemConfiguration && H.keySystemConfiguration.keySystem;
                  return !H || !d.includes(H);
                });
                D = t(C);
                G = D.next();
              case 15:
                if (G.done) {
                  x = v.next();
                  A.s(12);
                  break;
                }
                B = G.value;
                return F(A, og(z, B), 16);
              case 16:
                G = D.next(), A.s(15);
            }
          });
        }
        function rg(a, b, c) {
          var d = a.audio, e = a.video, f = [], g = [];
          if (e) for (var h = t(e.fullMimeTypes), k2 = h.next(); !k2.done; k2 = h.next()) {
            k2 = k2.value;
            var l = wf(k2);
            if (l.includes(",") && !d) {
              var m = l.split(","), n = vf(k2);
              l = ad("video", m);
              m = ad("audio", m);
              m = sg(m, n);
              n = of(n, m, "audio");
              g.push({ contentType: n, channels: 2, bitrate: a.bandwidth || 1, samplerate: 1, spatialRendering: false });
            }
            l = tg(l);
            k2 = { contentType: of(vf(k2), l, "video"), width: e.width || 64, height: e.height || 64, bitrate: e.bandwidth || a.bandwidth || 1, framerate: e.frameRate || 1 };
            if (e.hdr) switch (e.hdr) {
              case "SDR":
                k2.transferFunction = "srgb";
                break;
              case "PQ":
                k2.transferFunction = "pq";
                break;
              case "HLG":
                k2.transferFunction = "hlg";
            }
            e.colorGamut && (k2.colorGamut = e.colorGamut);
            f.push(k2);
          }
          if (d) for (h = t(d.fullMimeTypes), k2 = h.next(); !k2.done; k2 = h.next()) l = k2.value, k2 = vf(l), l = sg(wf(l), k2), k2 = of(k2, l, "audio"), g.push({ contentType: k2, channels: d.channelsCount || 2, bitrate: d.bandwidth || a.bandwidth || 1, samplerate: d.audioSamplingRate || 1, spatialRendering: d.spatialAudio });
          h = [];
          0 == f.length && f.push(null);
          0 == g.length && g.push(null);
          f = t(f);
          for (k2 = f.next(); !k2.done; k2 = f.next()) for (k2 = k2.value, l = t(g), n = l.next(); !n.done; n = l.next()) n = n.value, m = { type: c ? "file" : "media-source" }, k2 && (m.video = k2), n && (m.audio = n), h.push(m);
          g = (a.video ? a.video.drmInfos : []).concat(a.audio ? a.audio.drmInfos : []);
          if (!g.length) return [h];
          a = [];
          c = /* @__PURE__ */ new Map();
          g = t(g);
          for (f = g.next(); !f.done; f = g.next()) f = f.value, c.get(f.keySystem) || c.set(f.keySystem, []), c.get(f.keySystem).push(f);
          g = b ? "required" : "optional";
          b = b ? ["persistent-license"] : ["temporary"];
          f = t(c.keys());
          for (k2 = f.next(); !k2.done; k2 = f.next()) {
            k2 = k2.value;
            n = c.get(k2);
            l = /* @__PURE__ */ new Map();
            n = t(n);
            for (m = n.next(); !m.done; m = n.next()) {
              m = m.value;
              var p = m.videoRobustness + "," + m.audioRobustness;
              l.get(p) || l.set(p, []);
              l.get(p).push(m);
            }
            l = t(l.values());
            for (n = l.next(); !n.done; n = l.next()) {
              n = n.value;
              m = [];
              p = t(h);
              for (var q = p.next(); !q.done; q = p.next()) {
                q = Object.assign({}, q.value);
                for (var u = { keySystem: k2, initDataType: "cenc", persistentState: g, distinctiveIdentifier: "optional", sessionTypes: b }, w = t(n), v = w.next(); !v.done; v = w.next()) {
                  v = v.value;
                  if (v.initData && v.initData.length) {
                    for (var x = /* @__PURE__ */ new Set(), z = t(v.initData), C = z.next(); !C.done; C = z.next()) x.add(C.value.initDataType);
                    u.initDataType = v.initData[0].initDataType;
                  }
                  v.distinctiveIdentifierRequired && (u.distinctiveIdentifier = "required");
                  v.persistentStateRequired && (u.persistentState = "required");
                  v.sessionType && (u.sessionTypes = [v.sessionType]);
                  d && (u.audio ? (v.encryptionScheme && (u.audio.encryptionScheme = u.audio.encryptionScheme || v.encryptionScheme), u.audio.robustness = u.audio.robustness || v.audioRobustness) : (u.audio = { robustness: v.audioRobustness }, v.encryptionScheme && (u.audio.encryptionScheme = v.encryptionScheme)), "" == u.audio.robustness && delete u.audio.robustness);
                  e && (u.video ? (v.encryptionScheme && (u.video.encryptionScheme = u.video.encryptionScheme || v.encryptionScheme), u.video.robustness = u.video.robustness || v.videoRobustness) : (u.video = { robustness: v.videoRobustness }, v.encryptionScheme && (u.video.encryptionScheme = v.encryptionScheme)), "" == u.video.robustness && delete u.video.robustness);
                }
                q.keySystemConfiguration = u;
                m.push(q);
              }
              a.push(m);
            }
          }
          return a;
        }
        function sg(a, b) {
          return "flac" == a.toLowerCase() ? rc() ? "fLaC" : "flac" : "opus" === a.toLowerCase() ? rc() ? "mp4" == rf(b) ? "Opus" : "opus" : "opus" : "ac-3" == a.toLowerCase() && mc() ? "ec-3" : a;
        }
        function tg(a) {
          if (a.includes("avc1")) {
            var b = a.split(".");
            if (3 == b.length) return a = b.shift() + ".", a += parseInt(b.shift(), 10).toString(16), a += ("000" + parseInt(b.shift(), 10).toString(16)).slice(-4);
          } else if ("vp9" == a) return "vp09.00.41.08";
          return a;
        }
        function ig(a) {
          a.textStreams = a.textStreams.filter(function(b) {
            b = lf(b.mimeType, b.codecs);
            return Cf(b);
          });
        }
        function jg(a) {
          var b, c, d, e, f, g, h;
          return Q(function(l) {
            switch (l.g) {
              case 1:
                b = [], c = t(a.imageStreams), d = c.next();
              case 2:
                if (d.done) {
                  l.s(4);
                  break;
                }
                e = d.value;
                f = e.mimeType;
                "application/mp4" == f && "mjpg" == e.codecs && (f = "image/jpg");
                if (ug.has(f)) {
                  l.s(5);
                  break;
                }
                g = vg.get(f);
                if (!g) {
                  ug.set(f, false);
                  l.s(5);
                  break;
                }
                return F(l, wg(g), 7);
              case 7:
                h = l.h, ug.set(f, h);
              case 5:
                ug.get(f) && b.push(e);
                d = c.next();
                l.s(2);
                break;
              case 4:
                a.imageStreams = b, I(l);
            }
          });
        }
        function wg(a) {
          return new Promise(function(b) {
            var c = new Image();
            c.src = a;
            "decode" in c ? c.decode().then(function() {
              b(true);
            }).catch(function() {
              b(false);
            }) : c.onload = c.onerror = function() {
              b(2 === c.height);
            };
          });
        }
        function xg(a) {
          var b = a.audio, c = a.video, d = b ? b.mimeType : null, e = c ? c.mimeType : null, f = b ? b.codecs : null, g = c ? c.codecs : null, h = b ? b.groupId : null, k2 = [];
          c && k2.push(c.mimeType);
          b && k2.push(b.mimeType);
          k2 = k2[0] || null;
          var l = [];
          b && l.push(b.kind);
          c && l.push(c.kind);
          l = l[0] || null;
          var m = /* @__PURE__ */ new Set();
          if (b) for (var n = t(b.roles), p = n.next(); !p.done; p = n.next()) m.add(p.value);
          if (c) for (n = t(c.roles), p = n.next(); !p.done; p = n.next()) m.add(p.value);
          a = {
            id: a.id,
            active: false,
            type: "variant",
            bandwidth: a.bandwidth,
            language: a.language,
            label: null,
            kind: l,
            width: null,
            height: null,
            frameRate: null,
            pixelAspectRatio: null,
            hdr: null,
            colorGamut: null,
            videoLayout: null,
            mimeType: k2,
            audioMimeType: d,
            videoMimeType: e,
            codecs: "",
            audioCodec: f,
            videoCodec: g,
            primary: a.primary,
            roles: Array.from(m),
            audioRoles: null,
            forced: false,
            videoId: null,
            audioId: null,
            audioGroupId: h,
            channelsCount: null,
            audioSamplingRate: null,
            spatialAudio: false,
            tilesLayout: null,
            audioBandwidth: null,
            videoBandwidth: null,
            originalVideoId: null,
            originalAudioId: null,
            originalTextId: null,
            originalImageId: null,
            accessibilityPurpose: null,
            originalLanguage: null
          };
          if (c) {
            a.videoId = c.id;
            a.originalVideoId = c.originalId;
            a.width = c.width || null;
            a.height = c.height || null;
            a.frameRate = c.frameRate || null;
            a.pixelAspectRatio = c.pixelAspectRatio || null;
            a.videoBandwidth = c.bandwidth || null;
            a.hdr = c.hdr || null;
            a.colorGamut = c.colorGamut || null;
            a.videoLayout = c.videoLayout || null;
            if (d = c.dependencyStream) a.width = d.width || a.width, a.height = d.height || a.height, a.videoCodec = d.codecs || a.videoCodec;
            if (g.includes(",")) {
              a.channelsCount = c.channelsCount;
              a.audioSamplingRate = c.audioSamplingRate;
              a.spatialAudio = c.spatialAudio;
              a.originalLanguage = c.originalLanguage;
              a.audioMimeType = e;
              c = g.split(",");
              try {
                a.videoCodec = ad("video", c), a.audioCodec = ad("audio", c);
              } catch (q) {
              }
            }
          }
          b && (a.audioId = b.id, a.originalAudioId = b.originalId, a.channelsCount = b.channelsCount, a.audioSamplingRate = b.audioSamplingRate, a.audioBandwidth = b.bandwidth || null, a.spatialAudio = b.spatialAudio, a.label = b.label, a.audioRoles = b.roles, a.accessibilityPurpose = b.accessibilityPurpose, a.originalLanguage = b.originalLanguage, b = b.dependencyStream) && (a.audioCodec = b.codecs || a.audioCodec);
          b = [];
          a.videoCodec && b.push(a.videoCodec);
          a.audioCodec && b.push(a.audioCodec);
          a.codecs = b.join(", ");
          return a;
        }
        function yg(a) {
          return {
            id: a.id,
            active: false,
            type: dd,
            bandwidth: 0,
            language: a.language,
            label: a.label,
            kind: a.kind || null,
            width: null,
            height: null,
            frameRate: null,
            pixelAspectRatio: null,
            hdr: null,
            colorGamut: null,
            videoLayout: null,
            mimeType: a.mimeType,
            audioMimeType: null,
            videoMimeType: null,
            codecs: a.codecs || null,
            audioCodec: null,
            videoCodec: null,
            primary: a.primary,
            roles: a.roles,
            audioRoles: null,
            forced: a.forced,
            videoId: null,
            audioId: null,
            audioGroupId: null,
            channelsCount: null,
            audioSamplingRate: null,
            spatialAudio: false,
            tilesLayout: null,
            audioBandwidth: null,
            videoBandwidth: null,
            originalVideoId: null,
            originalAudioId: null,
            originalTextId: a.originalId,
            originalImageId: null,
            accessibilityPurpose: a.accessibilityPurpose,
            originalLanguage: a.originalLanguage
          };
        }
        function zg(a) {
          var b = a.width || null, c = a.height || null, d = null;
          a.segmentIndex && (d = Ag(a.segmentIndex));
          var e = a.tilesLayout;
          d && (e = d.tilesLayout || e);
          e && null != b && (b /= Number(e.split("x")[0]));
          e && null != c && (c /= Number(e.split("x")[1]));
          return {
            id: a.id,
            active: false,
            type: "image",
            bandwidth: a.bandwidth || 0,
            language: "",
            label: null,
            kind: null,
            width: b,
            height: c,
            frameRate: null,
            pixelAspectRatio: null,
            hdr: null,
            colorGamut: null,
            videoLayout: null,
            mimeType: a.mimeType,
            audioMimeType: null,
            videoMimeType: null,
            codecs: a.codecs || null,
            audioCodec: null,
            videoCodec: null,
            primary: false,
            roles: [],
            audioRoles: null,
            forced: false,
            videoId: null,
            audioId: null,
            audioGroupId: null,
            channelsCount: null,
            audioSamplingRate: null,
            spatialAudio: false,
            tilesLayout: e || null,
            audioBandwidth: null,
            videoBandwidth: null,
            originalVideoId: null,
            originalAudioId: null,
            originalTextId: null,
            originalImageId: a.originalId,
            accessibilityPurpose: null,
            originalLanguage: null
          };
        }
        function Bg(a) {
          a.__shaka_id || (a.__shaka_id = Cg++);
          return a.__shaka_id;
        }
        function Dg(a) {
          var b = Eg(a);
          b.active = "disabled" != a.mode;
          b.type = "text";
          b.originalTextId = a.id;
          "captions" == a.kind && (b.mimeType = "unknown");
          "subtitles" == a.kind && (b.mimeType = "text/vtt");
          a.kind && (b.roles = [a.kind]);
          "forced" == a.kind && (b.forced = true);
          return b;
        }
        function Fg(a) {
          var b = Eg(a);
          b.active = a.enabled;
          b.type = "variant";
          b.originalAudioId = a.id;
          "main" == a.kind && (b.primary = true);
          a.kind && (b.roles = [a.kind], b.audioRoles = [a.kind], b.label = a.label);
          return b;
        }
        function Eg(a) {
          var b = a.language;
          return {
            id: Bg(a),
            active: false,
            type: "",
            bandwidth: 0,
            language: Of(b || "und"),
            label: a.label,
            kind: a.kind,
            width: null,
            height: null,
            frameRate: null,
            pixelAspectRatio: null,
            hdr: null,
            colorGamut: null,
            videoLayout: null,
            mimeType: null,
            audioMimeType: null,
            videoMimeType: null,
            codecs: null,
            audioCodec: null,
            videoCodec: null,
            primary: false,
            roles: [],
            forced: false,
            audioRoles: null,
            videoId: null,
            audioId: null,
            audioGroupId: null,
            channelsCount: null,
            audioSamplingRate: null,
            spatialAudio: false,
            tilesLayout: null,
            audioBandwidth: null,
            videoBandwidth: null,
            originalVideoId: null,
            originalAudioId: null,
            originalTextId: null,
            originalImageId: null,
            accessibilityPurpose: null,
            originalLanguage: b
          };
        }
        function Gg(a) {
          return a.allowedByApplication && a.allowedByKeySystem && 0 == a.disabledUntilTime;
        }
        function Hg(a) {
          return a.filter(function(b) {
            return Gg(b);
          });
        }
        function Ig(a, b, c, d) {
          var e = a, f = a.filter(function(k2) {
            return k2.primary;
          });
          f.length && (e = f);
          var g = e.length ? e[0].language : "";
          e = e.filter(function(k2) {
            return k2.language == g;
          });
          if (b) {
            var h = ag(Of(b), a.map(function(k2) {
              return k2.language;
            }));
            h && (e = a.filter(function(k2) {
              return Of(k2.language) == h;
            }));
          }
          e = e.filter(function(k2) {
            return k2.forced == d;
          });
          if (c) {
            if (a = Jg(e, c), a.length) return a;
          } else if (a = e.filter(function(k2) {
            return 0 == k2.roles.length;
          }), a.length) return a;
          a = e.map(function(k2) {
            return k2.roles;
          }).reduce(If, []);
          return a.length ? Jg(e, a[0]) : e;
        }
        function Jg(a, b) {
          return a.filter(function(c) {
            return c.roles.includes(b);
          });
        }
        function Kg(a, b) {
          b.length && (b = b.filter(function(c) {
            return sf(a.codecs) == sf(c.codecs);
          }).sort(function(c, d) {
            return c.bandwidth && d.bandwidth && c.bandwidth != d.bandwidth ? c.bandwidth - d.bandwidth : (c.width || 0) - (d.width || 0);
          }), a.trickModeVideo = b[0], 1 < b.length && (b = b.find(function(c) {
            return a.width == c.width && a.height == c.height;
          }))) && (a.trickModeVideo = b);
        }
        function ng(a) {
          return "audio" == a.type ? "type=audio codecs=" + a.codecs + " bandwidth=" + a.bandwidth + " channelsCount=" + a.channelsCount + " audioSamplingRate=" + a.audioSamplingRate : "video" == a.type ? "type=video codecs=" + a.codecs + " bandwidth=" + a.bandwidth + " frameRate=" + a.frameRate + " width=" + a.width + " height=" + a.height : "unexpected stream type";
        }
        function Lg(a, b, c) {
          if (0 == c.autoShowText) return false;
          if (1 == c.autoShowText) return true;
          var d = Of(c.preferredTextLanguage);
          b = Of(b.language);
          if (2 == c.autoShowText) return Nf(b, d);
          if (3 == c.autoShowText) {
            if (!a) return false;
            a = Of(a.language);
            return Nf(b, d) && !Nf(a, b);
          }
          bb("Invalid autoShowText setting!");
          return false;
        }
        T("shaka.util.StreamUtils", bg);
        bg.meetsRestrictions = fg;
        var pg = /* @__PURE__ */ new Map(), Cg = 0, ug = (/* @__PURE__ */ new Map()).set("image/svg+xml", true).set("image/png", true).set("image/jpeg", true).set("image/jpg", true), vg = (/* @__PURE__ */ new Map()).set("image/webp", "data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA").set("image/avif", "data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A=");
        function Mg() {
          var a = this;
          this.G = null;
          this.o = false;
          this.m = new Za();
          this.j = new lb();
          navigator.connection && navigator.connection.addEventListener && this.j.D(navigator.connection, "change", function() {
            if (a.o && a.g.useNetworkInformation) {
              a.m = new Za();
              a.g && a.m.configure(a.g.advanced);
              var b = a.chooseVariant();
              b && navigator.onLine && a.G(b, a.g.clearBufferSwitch, a.g.safeMarginSwitch);
            }
          });
          this.F = [];
          this.H = 1;
          this.I = false;
          this.h = this.l = this.g = this.u = null;
          this.A = new ec(function() {
            if (a.o && (a.g.restrictToElementSize || a.g.restrictToScreenSize)) {
              var b = a.chooseVariant();
              b && a.G(b, a.g.clearBufferSwitch, a.g.safeMarginSwitch);
            }
          });
          this.B = window2;
          "documentPictureInPicture" in window2 && this.j.D(window2.documentPictureInPicture, "enter", function() {
            a.B = window2.documentPictureInPicture.window;
            a.A && a.A.sb();
            a.j.ma(a.B, "pagehide", function() {
              a.B = window2;
              a.A && a.A.sb();
            });
          });
          this.C = this.i = null;
        }
        r = Mg.prototype;
        r.stop = function() {
          this.G = null;
          this.o = false;
          this.F = [];
          this.H = 1;
          this.l = this.u = null;
          this.h && (this.h.disconnect(), this.h = null);
          this.A.stop();
          this.C = this.i = null;
        };
        r.release = function() {
          this.j.release();
          this.A = null;
        };
        r.init = function(a) {
          this.G = a;
        };
        r.chooseVariant = function() {
          var a = Infinity, b = Infinity;
          if (this.g.restrictToScreenSize) {
            var c = this.g.ignoreDevicePixelRatio ? 1 : this.B.devicePixelRatio;
            a = this.B.screen.height * c;
            b = this.B.screen.width * c;
          }
          if (this.h && this.g.restrictToElementSize) {
            c = this.g.ignoreDevicePixelRatio ? 1 : this.B.devicePixelRatio;
            var d = this.l.clientHeight, e = this.l.clientWidth;
            this.i && document.pictureInPictureElement && document.pictureInPictureElement == this.l && (d = this.i.height, e = this.i.width);
            a = Math.min(a, d * c);
            b = Math.min(b, e * c);
          }
          c = this.F.filter(function(l) {
            return l && !(l.audio && l.audio.fastSwitching || l.video && l.video.fastSwitching);
          });
          c.length || (c = this.F);
          d = c;
          c.length != this.F.length && (d = this.F.filter(function(l) {
            return l && (l.audio && l.audio.fastSwitching || l.video && l.video.fastSwitching ? true : false);
          }));
          c = Ng(this, this.g.restrictions, d, Infinity, Infinity);
          if (Infinity != a || Infinity != b) {
            c = Og(c);
            c = t(c);
            for (e = c.next(); !e.done; e = c.next()) if (e = e.value, e.height >= a && e.width >= b) {
              a = e.height;
              b = e.width;
              break;
            }
            c = Ng(this, this.g.restrictions, d, a, b);
          }
          a = this.getBandwidthEstimate();
          d.length && !c.length && (c = Ng(this, null, d, Infinity, Infinity), c = [c[0]]);
          b = c[0] || null;
          for (d = 0; d < c.length; d++) {
            e = c[d];
            for (var f = isNaN(this.H) ? 1 : Math.abs(this.H), g = f * e.bandwidth / this.g.bandwidthDowngradeTarget, h = { bandwidth: Infinity }, k2 = d + 1; k2 < c.length; k2++) if (e.bandwidth != c[k2].bandwidth) {
              h = c[k2];
              break;
            }
            f = f * h.bandwidth / this.g.bandwidthUpgradeTarget;
            a >= g && a <= f && (b.bandwidth != e.bandwidth || b.bandwidth == e.bandwidth && b.video && e.video && (b.video.width < e.video.width || b.video.height < e.video.height)) && (b = e);
          }
          this.u = Date.now();
          return b;
        };
        r.enable = function() {
          this.o = true;
        };
        r.disable = function() {
          this.o = false;
        };
        r.segmentDownloaded = function(a, b, c) {
          a < this.g.cacheLoadThreshold || (this.m.sample(a, b), c && null != this.u && this.o && Pg(this));
        };
        r.trySuggestStreams = function() {
          null != this.u && this.o && Pg(this);
        };
        r.getBandwidthEstimate = function() {
          var a = this.g.defaultBandwidthEstimate;
          navigator.connection && navigator.connection.downlink && this.g.useNetworkInformation && (a = 1e6 * navigator.connection.downlink);
          if (navigator.connection && navigator.connection.downlink && this.g.useNetworkInformation && this.g.preferNetworkInformationBandwidth) return a;
          a = this.m.getBandwidthEstimate(a);
          return this.C ? this.C.getBandwidthEstimate(a) : a;
        };
        r.setVariants = function(a) {
          this.F = a;
        };
        r.playbackRateChanged = function(a) {
          this.H = a;
        };
        r.setMediaElement = function(a) {
          function b() {
            c.A.da(Qg);
          }
          var c = this;
          this.l = a;
          this.h && (this.h.disconnect(), this.h = null);
          this.l && "ResizeObserver" in window2 && (this.h = new ResizeObserver(b), this.h.observe(this.l));
          this.j.D(a, "enterpictureinpicture", function(d) {
            d.pictureInPictureWindow && (c.i = d.pictureInPictureWindow, c.j.D(c.i, "resize", b));
          });
          this.j.D(a, "leavepictureinpicture", function() {
            c.i && c.j.Ja(c.i, "resize", b);
            c.i = null;
          });
        };
        r.setCmsdManager = function(a) {
          this.C = a;
        };
        r.configure = function(a) {
          this.g = a;
          this.m && this.g && this.m.configure(this.g.advanced);
        };
        function Pg(a) {
          if (!a.I) {
            var b = a.m;
            if (!(b.g >= b.i)) return;
            a.I = true;
            a.u -= 1e3 * (a.g.switchInterval - a.g.minTimeToSwitch);
          }
          Date.now() - a.u < 1e3 * a.g.switchInterval || (b = a.chooseVariant(), a.getBandwidthEstimate(), b && a.G(b, a.g.clearBufferSwitch, a.g.safeMarginSwitch));
        }
        function Ng(a, b, c, d, e) {
          if (a.C) {
            var f = a.C.Ug();
            f && (c = c.filter(function(g) {
              return g.bandwidth && f ? g.bandwidth <= f : true;
            }));
          }
          b && (c = c.filter(function(g) {
            return fg(g, b, { width: e, height: d });
          }));
          return c.sort(function(g, h) {
            return g.bandwidth - h.bandwidth;
          });
        }
        function Og(a) {
          var b = [];
          a = t(a);
          for (var c = a.next(); !c.done; c = a.next()) (c = c.value.video) && c.height && c.width && b.push({ height: c.height, width: c.width });
          return b.sort(function(d, e) {
            return d.width - e.width;
          });
        }
        T("shaka.abr.SimpleAbrManager", Mg);
        Mg.prototype.configure = Mg.prototype.configure;
        Mg.prototype.setCmsdManager = Mg.prototype.setCmsdManager;
        Mg.prototype.setMediaElement = Mg.prototype.setMediaElement;
        Mg.prototype.playbackRateChanged = Mg.prototype.playbackRateChanged;
        Mg.prototype.setVariants = Mg.prototype.setVariants;
        Mg.prototype.getBandwidthEstimate = Mg.prototype.getBandwidthEstimate;
        Mg.prototype.trySuggestStreams = Mg.prototype.trySuggestStreams;
        Mg.prototype.segmentDownloaded = Mg.prototype.segmentDownloaded;
        Mg.prototype.disable = Mg.prototype.disable;
        Mg.prototype.enable = Mg.prototype.enable;
        Mg.prototype.chooseVariant = Mg.prototype.chooseVariant;
        Mg.prototype.init = Mg.prototype.init;
        Mg.prototype.release = Mg.prototype.release;
        Mg.prototype.stop = Mg.prototype.stop;
        var Qg = 1;
        T("shaka.config.CrossBoundaryStrategy", { KEEP: "keep", RESET: "reset", RESET_TO_ENCRYPTED: "reset_to_encrypted", RESET_ON_ENCRYPTION_CHANGE: "RESET_ON_ENCRYPTION_CHANGE" });
        function Rg(a, b) {
          var c = Sg();
          this.l = null == a.maxAttempts ? c.maxAttempts : a.maxAttempts;
          this.j = null == a.baseDelay ? c.baseDelay : a.baseDelay;
          this.o = null == a.fuzzFactor ? c.fuzzFactor : a.fuzzFactor;
          this.m = null == a.backoffFactor ? c.backoffFactor : a.backoffFactor;
          this.g = 0;
          this.h = this.j;
          if (this.i = void 0 === b ? false : b) this.g = 1;
        }
        function Tg(a) {
          var b, c;
          return Q(function(d) {
            if (1 == d.g) {
              if (a.g >= a.l) if (a.i) a.g = 1, a.h = a.j;
              else throw new U(2, 7, 1010);
              b = a.g;
              a.g++;
              if (0 == b) return d.return();
              c = a.h * (1 + (2 * Math.random() - 1) * a.o);
              return F(d, new Promise(function(e) {
                new ec(e).da(c / 1e3);
              }), 2);
            }
            a.h *= a.m;
            I(d);
          });
        }
        function Sg() {
          return { maxAttempts: 2, baseDelay: 1e3, backoffFactor: 2, fuzzFactor: 0.5, timeout: 3e4, stallTimeout: 5e3, connectionTimeout: 1e4 };
        }
        function Ug() {
          var a, b, c = new Promise(function(d, e) {
            a = d;
            b = e;
          });
          c.resolve = a;
          c.reject = b;
          return c;
        }
        Ug.prototype.resolve = function() {
        };
        Ug.prototype.reject = function() {
        };
        function Vg(a, b) {
          this.promise = a;
          this.i = b;
          this.g = null;
        }
        function Wg(a) {
          return new Vg(Promise.reject(a), function() {
            return Promise.resolve();
          });
        }
        function Xg() {
          var a = Promise.reject(new U(2, 7, 7001));
          a.catch(function() {
          });
          return new Vg(a, function() {
            return Promise.resolve();
          });
        }
        function Yg(a) {
          return new Vg(Promise.resolve(a), function() {
            return Promise.resolve();
          });
        }
        function Zg(a) {
          return new Vg(a, function() {
            return a.catch(function() {
            });
          });
        }
        Vg.prototype.abort = function() {
          this.g || (this.g = this.i());
          return this.g;
        };
        function $g(a) {
          return new Vg(Promise.all(a.map(function(b) {
            return b.promise;
          })), function() {
            return Promise.all(a.map(function(b) {
              return b.abort();
            }));
          });
        }
        Vg.prototype.finally = function(a) {
          this.promise.then(function() {
            return a(true);
          }, function() {
            return a(false);
          });
          return this;
        };
        Vg.prototype.Ha = function(a, b) {
          function c(h) {
            return function(k2) {
              if (e.g && h) f.reject(g);
              else {
                var l = h ? a : b;
                l ? d = ah(l, k2, f) : (h ? f.resolve : f.reject)(k2);
              }
            };
          }
          function d() {
            f.reject(g);
            return e.abort();
          }
          var e = this, f = new Ug();
          f.catch(function() {
          });
          var g = new U(2, 7, 7001);
          this.promise.then(c(true), c(false));
          return new Vg(f, function() {
            return d();
          });
        };
        function ah(a, b, c) {
          try {
            var d = a(b);
            if (d && d.promise && d.abort) return c.resolve(d.promise), function() {
              return d.abort();
            };
            c.resolve(d);
            return function() {
              return Promise.resolve(d).then(function() {
              }, function() {
              });
            };
          } catch (e) {
            return c.reject(e), function() {
              return Promise.resolve();
            };
          }
        }
        da.Object.defineProperties(Vg.prototype, { aborted: { configurable: true, enumerable: true, get: function() {
          return null !== this.g;
        } } });
        T("shaka.util.AbortableOperation", Vg);
        Vg.prototype.chain = Vg.prototype.Ha;
        Vg.prototype["finally"] = Vg.prototype.finally;
        Vg.all = $g;
        Vg.prototype.abort = Vg.prototype.abort;
        Vg.notAbortable = Zg;
        Vg.completed = Yg;
        Vg.aborted = Xg;
        Vg.failed = Wg;
        function V(a, b) {
          if (b) if (b instanceof Map) for (var c = t(b.keys()), d = c.next(); !d.done; d = c.next()) d = d.value, Object.defineProperty(this, d, { value: b.get(d), writable: true, enumerable: true });
          else for (c in b) Object.defineProperty(this, c, { value: b[c], writable: true, enumerable: true });
          this.defaultPrevented = this.cancelable = this.bubbles = false;
          this.timeStamp = window2.performance && window2.performance.now ? window2.performance.now() : Date.now();
          this.type = a;
          this.isTrusted = false;
          this.target = this.currentTarget = null;
          this.g = false;
        }
        function bh(a) {
          var b = new V(a.type), c;
          for (c in a) Object.defineProperty(b, c, { value: a[c], writable: true, enumerable: true });
          return b;
        }
        V.prototype.preventDefault = function() {
          this.cancelable && (this.defaultPrevented = true);
        };
        V.prototype.stopImmediatePropagation = function() {
          this.g = true;
        };
        V.prototype.stopPropagation = function() {
        };
        T("shaka.util.FakeEvent", V);
        var ch = {
          Oj: "abrstatuschanged",
          Pj: "adaptation",
          Qj: "audiotrackchanged",
          Rj: "audiotrackschanged",
          Sj: "boundarycrossed",
          Tj: "buffering",
          Uj: "complete",
          Vj: "downloadcompleted",
          Wj: "downloadfailed",
          Xj: "downloadheadersreceived",
          Yj: "drmsessionupdate",
          $j: "emsg",
          uk: "prft",
          Error: "error",
          ak: "expirationupdated",
          bk: "firstquartile",
          ck: "gapjumped",
          fk: "keystatuschanged",
          jk: "loaded",
          kk: "loading",
          mk: "manifestparsed",
          nk: "manifestupdated",
          pk: "mediaqualitychanged",
          qk: "mediasourcerecovered",
          Metadata: "metadata",
          rk: "midpoint",
          sk: "nospatialvideoinfo",
          tk: "onstatechange",
          vk: "ratechange",
          xk: "segmentappended",
          yk: "sessiondata",
          zk: "spatialvideoinfo",
          Ak: "stalldetected",
          Bk: "started",
          Ck: "statechanged",
          Dk: "streaming",
          Ek: "textchanged",
          Fk: "texttrackvisibility",
          Gk: "thirdquartile",
          Hk: "timelineregionadded",
          Ik: "timelineregionenter",
          Jk: "timelineregionexit",
          Kk: "trackschanged",
          Mk: "unloading",
          Ok: "variantchanged"
        };
        function dh() {
          this.Ea = new kb();
          this.Ge = this;
        }
        dh.prototype.addEventListener = function(a, b) {
          this.Ea && this.Ea.push(a, b);
        };
        dh.prototype.removeEventListener = function(a, b) {
          this.Ea && this.Ea.remove(a, b);
        };
        dh.prototype.dispatchEvent = function(a) {
          if (!this.Ea) return true;
          var b = this.Ea.get(a.type) || [], c = this.Ea.get("All");
          c && (b = b.concat(c));
          b = t(b);
          for (c = b.next(); !c.done; c = b.next()) {
            c = c.value;
            a.target = this.Ge;
            a.currentTarget = this.Ge;
            try {
              c.handleEvent ? c.handleEvent(a) : c.call(this, a);
            } catch (d) {
            }
            if (a.g) break;
          }
          return a.defaultPrevented;
        };
        dh.prototype.release = function() {
          this.Ea = null;
        };
        function eh() {
          this.g = [];
        }
        function fh(a, b) {
          a.g.push(b.finally(function() {
            Cd(a.g, b);
          }));
        }
        eh.prototype.destroy = function() {
          for (var a = [], b = t(this.g), c = b.next(); !c.done; c = b.next()) c = c.value, c.promise.catch(function() {
          }), a.push(c.abort());
          this.g = [];
          return Promise.all(a);
        };
        function gh(a, b, c, d, e, f, g) {
          dh.call(this);
          this.i = false;
          this.u = new eh();
          this.g = /* @__PURE__ */ new Set();
          this.h = /* @__PURE__ */ new Set();
          this.m = a || null;
          this.l = b || null;
          this.C = c || null;
          this.F = d || null;
          this.G = e || null;
          this.I = f || null;
          this.H = g || null;
          this.A = this.B = false;
          this.o = 16e3;
          this.j = /* @__PURE__ */ new Map();
        }
        qa(gh, dh);
        r = gh.prototype;
        r.kg = function(a) {
          this.B = a;
        };
        r.lg = function(a) {
          this.A = a;
        };
        function hh(a, b, c, d) {
          d = void 0 === d ? false : d;
          c = c || ih;
          var e = jh.get(a);
          (!e || c >= e.priority) && jh.set(a, { priority: c, se: b, ij: d });
        }
        function kh(a, b) {
          for (var c = t(a.g), d = c.next(); !d.done; d = c.next()) b.g.add(d.value);
          a = t(a.h);
          for (c = a.next(); !c.done; c = a.next()) b.h.add(c.value);
        }
        r.lj = function(a) {
          this.g.add(a);
        };
        r.Hj = function(a) {
          this.g.delete(a);
        };
        r.$h = function() {
          this.g.clear();
        };
        r.mj = function(a) {
          this.h.add(a);
        };
        r.Ij = function(a) {
          this.h.delete(a);
        };
        r.ai = function() {
          this.h.clear();
        };
        r.Hg = function() {
          this.j.clear();
        };
        function lh(a, b, c) {
          return { uris: a, method: "GET", body: null, headers: {}, allowCrossSiteCredentials: false, retryParameters: b, licenseRequestType: null, sessionId: null, drmInfo: null, initData: null, initDataType: null, streamDataCallback: void 0 === c ? null : c };
        }
        r.destroy = function() {
          this.i = true;
          this.g.clear();
          this.h.clear();
          this.j.clear();
          dh.prototype.release.call(this);
          return this.u.destroy();
        };
        r.request = function(a, b, c) {
          var d = this, e = new mh();
          if (this.i) {
            var f = Promise.reject(new U(2, 7, 7001));
            f.catch(function() {
            });
            return new nh(f, function() {
              return Promise.resolve();
            }, e);
          }
          b.method = b.method || "GET";
          b.headers = b.headers || {};
          b.retryParameters = b.retryParameters ? Nd(b.retryParameters) : Sg();
          b.uris = Nd(b.uris);
          f = oh(this, a, b, c);
          var g = f.Ha(function() {
            return ph(d, a, b, c, new Rg(b.retryParameters, false), 0, null, e);
          }), h = g.Ha(function(p) {
            return qh(d, a, p, c);
          }), k2 = Date.now(), l = 0;
          f.promise.then(function() {
            l = Date.now() - k2;
          }, function() {
          });
          var m = 0;
          g.promise.then(function() {
            m = Date.now();
          }, function() {
          });
          var n = h.Ha(function(p) {
            var q = Date.now() - m, u = p.response;
            u.timeMs += l;
            u.timeMs += q;
            p.Oi || !d.m || u.fromCache || "HEAD" == b.method || a != rh || d.m(u.timeMs, u.data.byteLength, sh(c));
            d.H && d.H(a, u, c);
            return u;
          }, function(p) {
            p && (p.severity = 2);
            throw p;
          });
          f = new nh(n.promise, function() {
            return n.abort();
          }, e);
          fh(this.u, f);
          return f;
        };
        function oh(a, b, c, d) {
          function e(h) {
            f = f.Ha(function() {
              c.body && (c.body = Sb(c.body));
              return h(b, c, d);
            });
          }
          var f = Yg(void 0);
          a.G && e(a.G);
          a = t(a.g);
          for (var g = a.next(); !g.done; g = a.next()) e(g.value);
          return f.Ha(void 0, function(h) {
            if (h instanceof U && 7001 == h.code) throw h;
            throw new U(2, 1, 1006, h);
          });
        }
        function ph(a, b, c, d, e, f, g, h) {
          a.B && (c.uris[f] = c.uris[f].replace("https://", "http://"));
          a.A && (c.uris[f] = c.uris[f].replace("http://", "https://"));
          0 < f && a.I && a.I(b, d, c.uris[f], c.uris[f - 1]);
          var k2 = new yb(c.uris[f]), l = k2.Kb, m = false;
          l || (l = location.protocol, l = l.slice(0, -1), zb(k2, l), c.uris[f] = k2.toString());
          l = l.toLowerCase();
          var n = (l = jh.get(l)) ? l.se : null;
          if (!n) return Wg(new U(2, 1, 1e3, k2));
          var p = l.ij;
          (k2 = a.j.get(k2.nb)) && (c.headers["common-access-token"] = k2);
          var q = null, u = null, w = false, v = false, x;
          return Zg(Tg(e)).Ha(function() {
            if (a.i) return Xg();
            x = Date.now();
            var z = 0;
            c.requestStartTime = Date.now();
            var C = n(c.uris[f], c, b, function(B, A, H) {
              q && q.stop();
              u && u.da(G / 1e3);
              a.m && b == rh && (z++, c.packetNumber = z, a.m(B, A, sh(d), c), m = true, h.g = H);
            }, function(B) {
              v = true;
              c.timeToFirstByte = Date.now() - c.requestStartTime;
              a.l && a.l(B, c, b);
            }, { minBytesForProgressEvents: a.o });
            if (!p) return C;
            var D = c.retryParameters.connectionTimeout;
            D && (q = new ec(function() {
              w = true;
              C.abort();
            }), q.da(D / 1e3));
            var G = c.retryParameters.stallTimeout;
            G && (u = new ec(function() {
              w = true;
              C.abort();
            }));
            return C;
          }).Ha(function(z) {
            q && q.stop();
            u && u.stop();
            void 0 == z.timeMs && (z.timeMs = Date.now() - x);
            var C = z.headers["common-access-token"];
            if (C) {
              var D = new yb(z.uri);
              a.j.set(D.nb, C);
            }
            C = { response: z, Oi: m };
            !v && a.l && a.l(z.headers, c, b);
            a.C && a.C(c, z);
            return C;
          }, function(z) {
            q && q.stop();
            u && u.stop();
            if (a.F) {
              var C = null, D = 0;
              z instanceof U && (C = z, 1001 == z.code && (D = z.data[1]));
              a.F(c, C, D, w);
            }
            if (a.i) return Xg();
            w && (z = new U(1, 1, 1003, c.uris[f], b));
            if (z instanceof U) {
              if (7001 == z.code) throw z;
              if (1010 == z.code) throw g;
              if (1 == z.severity) {
                C = (/* @__PURE__ */ new Map()).set(
                  "error",
                  z
                );
                C = new V("retry", C);
                C.cancelable = true;
                a.dispatchEvent(C);
                if (C.defaultPrevented) throw z;
                f = (f + 1) % c.uris.length;
                return ph(a, b, c, d, e, f, z, h);
              }
            }
            throw z;
          });
        }
        function qh(a, b, c, d) {
          var e = Yg(void 0);
          a = t(a.h);
          for (var f = a.next(), g = {}; !f.done; g = { ph: void 0 }, f = a.next()) g.ph = f.value, e = e.Ha(/* @__PURE__ */ function(h) {
            return function() {
              var k2 = c.response;
              k2.data && (k2.data = Sb(k2.data));
              return (0, h.ph)(b, k2, d);
            };
          }(g));
          return e.Ha(function() {
            return c;
          }, function(h) {
            var k2 = 2;
            if (h instanceof U) {
              if (7001 == h.code) throw h;
              k2 = h.severity;
            }
            throw new U(k2, 1, 1007, h);
          });
        }
        function sh(a) {
          if (a) {
            var b = a.segment;
            a = a.stream;
            if (b && a && a.fastSwitching && b.o) return false;
          }
          return true;
        }
        T("shaka.net.NetworkingEngine", gh);
        gh.prototype.request = gh.prototype.request;
        gh.prototype.destroy = gh.prototype.destroy;
        gh.makeRequest = lh;
        gh.defaultRetryParameters = function() {
          return Sg();
        };
        gh.prototype.clearCommonAccessTokenMap = gh.prototype.Hg;
        gh.prototype.clearAllResponseFilters = gh.prototype.ai;
        gh.prototype.unregisterResponseFilter = gh.prototype.Ij;
        gh.prototype.registerResponseFilter = gh.prototype.mj;
        gh.prototype.clearAllRequestFilters = gh.prototype.$h;
        gh.prototype.unregisterRequestFilter = gh.prototype.Hj;
        gh.prototype.registerRequestFilter = gh.prototype.lj;
        gh.unregisterScheme = function(a) {
          jh.delete(a);
        };
        gh.registerScheme = hh;
        gh.prototype.setForceHTTPS = gh.prototype.lg;
        gh.prototype.setForceHTTP = gh.prototype.kg;
        function mh() {
          this.g = 0;
        }
        gh.NumBytesRemainingClass = mh;
        function nh(a, b, c) {
          Vg.call(this, a, b);
          this.h = c;
        }
        qa(nh, Vg);
        gh.PendingRequest = nh;
        var rh = 1;
        gh.RequestType = { MANIFEST: 0, SEGMENT: rh, LICENSE: 2, APP: 3, TIMING: 4, SERVER_CERTIFICATE: 5, KEY: 6, ADS: 7, CONTENT_STEERING: 8 };
        gh.AdvancedRequestType = { INIT_SEGMENT: 0, MEDIA_SEGMENT: 1, MEDIA_PLAYLIST: 2, MASTER_PLAYLIST: 3, MPD: 4, MSS: 5, MPD_PATCH: 6, MEDIATAILOR_SESSION_INFO: 7, MEDIATAILOR_TRACKING_INFO: 8, MEDIATAILOR_STATIC_RESOURCE: 9, MEDIATAILOR_TRACKING_EVENT: 10, INTERSTITIAL_ASSET_LIST: 11, INTERSTITIAL_AD_URL: 12 };
        var ih = 3;
        gh.PluginPriority = { FALLBACK: 1, PREFERRED: 2, APPLICATION: ih };
        var jh = /* @__PURE__ */ new Map();
        function th(a) {
          this.g = false;
          this.h = new Ug();
          this.i = a;
        }
        th.prototype.destroy = function() {
          var a = this;
          if (this.g) return this.h;
          this.g = true;
          return this.i().then(function() {
            a.h.resolve();
          }, function() {
            a.h.resolve();
          });
        };
        function uh(a, b) {
          if (a.g) {
            if (b instanceof U && 7003 == b.code) throw b;
            throw new U(2, 7, 7003, b);
          }
        }
        function vh(a, b) {
          var c = [];
          a = t(a);
          for (var d = a.next(); !d.done; d = a.next()) c.push(b(d.value));
          return c;
        }
        function wh(a, b) {
          a = t(a);
          for (var c = a.next(); !c.done; c = a.next()) if (!b(c.value)) return false;
          return true;
        }
        function Ah(a) {
          for (var b = /* @__PURE__ */ new Map(), c = t(Object.keys(a)), d = c.next(); !d.done; d = c.next()) d = d.value, b.set(d, a[d]);
          return b;
        }
        function Bh(a) {
          var b = {};
          a.forEach(function(c, d) {
            b[d] = c;
          });
          return b;
        }
        function Ch(a, b) {
          this.h = Vb(a);
          this.i = b == Dh;
          this.g = 0;
        }
        r = Ch.prototype;
        r.ta = function() {
          return this.g < this.h.byteLength;
        };
        r.Ba = function() {
          return this.g;
        };
        r.getLength = function() {
          return this.h.byteLength;
        };
        r.X = function() {
          try {
            var a = this.h.getUint8(this.g);
            this.g += 1;
            return a;
          } catch (b) {
            throw Eh();
          }
        };
        r.na = function() {
          try {
            var a = this.h.getUint16(this.g, this.i);
            this.g += 2;
            return a;
          } catch (b) {
            throw Eh();
          }
        };
        r.S = function() {
          try {
            var a = this.h.getUint32(this.g, this.i);
            this.g += 4;
            return a;
          } catch (b) {
            throw Eh();
          }
        };
        r.$f = function() {
          try {
            var a = this.h.getInt32(this.g, this.i);
            this.g += 4;
            return a;
          } catch (b) {
            throw Eh();
          }
        };
        r.bd = function() {
          try {
            if (this.i) {
              var a = this.h.getUint32(this.g, true);
              var b = this.h.getUint32(this.g + 4, true);
            } else b = this.h.getUint32(this.g, false), a = this.h.getUint32(this.g + 4, false);
          } catch (c) {
            throw Eh();
          }
          if (2097151 < b) throw new U(2, 3, 3001);
          this.g += 8;
          return b * Math.pow(2, 32) + a;
        };
        r.Cb = function(a) {
          if (this.g + a > this.h.byteLength) throw Eh();
          var b = Qb(this.h, this.g, a);
          this.g += a;
          return b;
        };
        r.skip = function(a) {
          if (this.g + a > this.h.byteLength) throw Eh();
          this.g += a;
        };
        r.qh = function(a) {
          if (this.g < a) throw Eh();
          this.g -= a;
        };
        r.seek = function(a) {
          if (0 > a || a > this.h.byteLength) throw Eh();
          this.g = a;
        };
        r.Cc = function() {
          for (var a = this.g; this.ta() && 0 != this.h.getUint8(this.g); ) this.g += 1;
          a = Qb(this.h, a, this.g - a);
          this.g += 1;
          return Hc(a);
        };
        function Eh() {
          return new U(2, 3, 3e3);
        }
        T("shaka.util.DataViewReader", Ch);
        Ch.prototype.readTerminatedString = Ch.prototype.Cc;
        Ch.prototype.seek = Ch.prototype.seek;
        Ch.prototype.rewind = Ch.prototype.qh;
        Ch.prototype.skip = Ch.prototype.skip;
        Ch.prototype.readBytes = Ch.prototype.Cb;
        Ch.prototype.readUint64 = Ch.prototype.bd;
        Ch.prototype.readInt32 = Ch.prototype.$f;
        Ch.prototype.readUint32 = Ch.prototype.S;
        Ch.prototype.readUint16 = Ch.prototype.na;
        Ch.prototype.readUint8 = Ch.prototype.X;
        Ch.prototype.getLength = Ch.prototype.getLength;
        Ch.prototype.getPosition = Ch.prototype.Ba;
        Ch.prototype.hasMoreData = Ch.prototype.ta;
        var Dh = 1;
        Ch.Endianness = { BIG_ENDIAN: 0, LITTLE_ENDIAN: Dh };
        function Fh() {
          this.i = /* @__PURE__ */ new Map();
          this.h = /* @__PURE__ */ new Map();
          this.g = false;
        }
        r = Fh.prototype;
        r.box = function(a, b) {
          a = Gh(a);
          this.i.set(a, Hh);
          this.h.set(a, b);
          return this;
        };
        r.R = function(a, b) {
          a = Gh(a);
          this.i.set(a, Ih);
          this.h.set(a, b);
          return this;
        };
        r.stop = function() {
          this.g = true;
        };
        r.parse = function(a, b, c) {
          a = new Ch(a, 0);
          for (this.g = false; a.ta() && !this.g; ) this.Yc(0, a, b, c);
        };
        r.Yc = function(a, b, c, d) {
          var e = b.Ba();
          if (d && e + 8 > b.getLength()) this.g = true;
          else {
            var f = b.S(), g = b.S(), h = Jh(g), k2 = false;
            switch (f) {
              case 0:
                f = b.getLength() - e;
                break;
              case 1:
                if (d && b.Ba() + 8 > b.getLength()) {
                  this.g = true;
                  return;
                }
                f = b.bd();
                k2 = true;
            }
            var l = this.h.get(g);
            if (l) {
              var m = null, n = null;
              if (this.i.get(g) == Ih) {
                if (d && b.Ba() + 4 > b.getLength()) {
                  this.g = true;
                  return;
                }
                n = b.S();
                m = n >>> 24;
                n &= 16777215;
              }
              g = e + f;
              c && g > b.getLength() && (g = b.getLength());
              d && g > b.getLength() ? this.g = true : (d = g - b.Ba(), b = 0 < d ? b.Cb(d) : new Uint8Array(0), b = new Ch(b, 0), l({
                name: h,
                parser: this,
                partialOkay: c || false,
                version: m,
                flags: n,
                reader: b,
                size: f,
                start: e + a,
                has64BitSize: k2
              }));
            } else b.skip(Math.min(e + f - b.Ba(), b.getLength() - b.Ba()));
          }
        };
        function Kh(a) {
          for (var b = Lh(a); a.reader.ta() && !a.parser.g; ) a.parser.Yc(a.start + b, a.reader, a.partialOkay);
        }
        function Mh(a) {
          for (var b = Lh(a), c = a.reader.S(), d = 0; d < c && (a.parser.Yc(a.start + b, a.reader, a.partialOkay), !a.parser.g); d++) ;
        }
        function Nh(a) {
          var b = Lh(a);
          for (a.reader.skip(78); a.reader.ta() && !a.parser.g; ) a.parser.Yc(a.start + b, a.reader, a.partialOkay);
        }
        function Oh(a) {
          var b = Lh(a);
          a.reader.skip(8);
          var c = a.reader.na();
          a.reader.skip(6);
          2 == c ? a.reader.skip(48) : a.reader.skip(12);
          for (1 == c && a.reader.skip(16); a.reader.ta() && !a.parser.g; ) a.parser.Yc(a.start + b, a.reader, a.partialOkay);
        }
        function Ph(a) {
          return function(b) {
            a(b.reader.Cb(b.reader.getLength() - b.reader.Ba()));
          };
        }
        function Gh(a) {
          var b = 0;
          a = t(a);
          for (var c = a.next(); !c.done; c = a.next()) b = b << 8 | c.value.charCodeAt(0);
          return b;
        }
        function Jh(a) {
          return String.fromCharCode(a >> 24 & 255, a >> 16 & 255, a >> 8 & 255, a & 255);
        }
        function Lh(a) {
          return 8 + (a.has64BitSize ? 8 : 0) + (null != a.flags ? 4 : 0);
        }
        T("shaka.util.Mp4Parser", Fh);
        Fh.headerSize = Lh;
        Fh.typeToString = Jh;
        Fh.allData = Ph;
        Fh.audioSampleEntry = Oh;
        Fh.visualSampleEntry = Nh;
        Fh.sampleDescription = Mh;
        Fh.children = Kh;
        Fh.prototype.parseNext = Fh.prototype.Yc;
        Fh.prototype.parse = Fh.prototype.parse;
        Fh.prototype.stop = Fh.prototype.stop;
        Fh.prototype.fullBox = Fh.prototype.R;
        Fh.prototype.box = Fh.prototype.box;
        var Hh = 0, Ih = 1;
        function Qh(a) {
          var b = this;
          this.g = [];
          this.h = [];
          this.data = [];
          new Fh().box("moov", Kh).box("moof", Kh).R("pssh", function(c) {
            if (!(1 < c.version)) {
              var d = Qb(c.reader.h, -12, c.size);
              b.data.push(d);
              b.g.push(Vc(c.reader.Cb(16)));
              if (0 < c.version) {
                d = c.reader.S();
                for (var e = 0; e < d; e++) {
                  var f = Vc(c.reader.Cb(16));
                  b.h.push(f);
                }
              }
            }
          }).parse(a);
        }
        function Rh(a, b, c, d) {
          var e = a.length, f = b.length + 16 + e;
          0 < d && (f += 4 + 16 * c.size);
          var g = new Uint8Array(f), h = Vb(g), k2 = 0;
          h.setUint32(k2, f);
          k2 += 4;
          h.setUint32(k2, 1886614376);
          k2 += 4;
          1 > d ? h.setUint32(k2, 0) : h.setUint32(k2, 16777216);
          k2 += 4;
          g.set(b, k2);
          k2 += b.length;
          if (0 < d) for (h.setUint32(k2, c.size), k2 += 4, b = t(c), c = b.next(); !c.done; c = b.next()) c = Uc(c.value), g.set(c, k2), k2 += c.length;
          h.setUint32(k2, e);
          g.set(a, k2 + 4);
          return g;
        }
        function Sh(a) {
          var b = this;
          this.C = a;
          this.j = this.A = null;
          this.ka = this.ea = false;
          this.H = 0;
          this.h = null;
          this.o = new lb();
          this.i = /* @__PURE__ */ new Map();
          this.T = [];
          this.B = /* @__PURE__ */ new Map();
          this.K = false;
          this.m = new Ug();
          this.g = null;
          this.u = function(c) {
            2 == c.severity && b.m.reject(c);
            a.onError(c);
          };
          this.Y = /* @__PURE__ */ new Map();
          this.fa = /* @__PURE__ */ new Map();
          this.L = new ec(function() {
            return Th(b);
          });
          this.O = false;
          this.M = [];
          this.W = false;
          this.I = new ec(function() {
            Uh(b);
          });
          this.m.catch(function() {
          });
          this.l = new th(function() {
            return Vh(b);
          });
          this.Z = false;
          this.F = this.G = null;
          this.P = function() {
            return false;
          };
        }
        r = Sh.prototype;
        r.destroy = function() {
          return this.l.destroy();
        };
        function Vh(a) {
          return Q(function(b) {
            switch (b.g) {
              case 1:
                return a.o.release(), a.o = null, a.m.reject(), a.I.stop(), a.I = null, a.L.stop(), a.L = null, F(b, Wh(a), 2);
              case 2:
                if (!a.j) {
                  b.s(3);
                  break;
                }
                xa(b, 4);
                return F(b, a.j.setMediaKeys(null), 6);
              case 6:
                Aa(b, 5);
                break;
              case 4:
                Ba(b);
              case 5:
                a.j = null;
              case 3:
                a.h = null, a.A = null, a.B = /* @__PURE__ */ new Map(), a.g = null, a.u = function() {
                }, a.C = null, a.Z = false, a.G = null, I(b);
            }
          });
        }
        r.configure = function(a, b) {
          this.g = a;
          b && (this.P = b);
          this.I && this.I.ua(this.g.updateExpirationTime);
        };
        function Xh(a, b, c) {
          a.ka = true;
          a.B = /* @__PURE__ */ new Map();
          a.O = c;
          return Yh(a, b, false);
        }
        function Zh(a, b, c, d) {
          d = void 0 === d ? true : d;
          a.B = /* @__PURE__ */ new Map();
          c = t(c);
          for (var e = c.next(); !e.done; e = c.next()) a.B.set(e.value, { initData: null, initDataType: null });
          c = t(a.g.persistentSessionsMetadata);
          for (e = c.next(); !e.done; e = c.next()) e = e.value, a.B.set(e.sessionId, { initData: e.initData, initDataType: e.initDataType });
          a.O = 0 < a.B.size;
          return Yh(a, b, d);
        }
        function $h(a, b, c, d, e, f) {
          var g = /* @__PURE__ */ new Map();
          e = { audioCapabilities: e, videoCapabilities: f, distinctiveIdentifier: "optional", persistentState: "required", sessionTypes: ["persistent-license"], label: b };
          e.drmInfos = [{ keySystem: b, licenseServerUri: c, distinctiveIdentifierRequired: false, persistentStateRequired: true, audioRobustness: "", videoRobustness: "", serverCertificate: d, serverCertificateUri: "", initData: null, keyIds: null }];
          g.set(b, e);
          return ai(a, g, []);
        }
        function Yh(a, b, c) {
          var d, e, f, g, h, k2, l, m, n, p, q, u, w, v, x, z, C, D, G;
          return Q(function(B) {
            if (1 == B.g) {
              bi(a.g.clearKeys, b);
              d = b.some(function(A) {
                return A.video && A.video.drmInfos.length || A.audio && A.audio.drmInfos.length ? true : false;
              });
              !d && c && (e = Ah(a.g.servers), ci(b, e));
              f = /* @__PURE__ */ new Set();
              g = t(b);
              for (h = g.next(); !h.done; h = g.next()) for (k2 = h.value, l = di(k2), m = t(l), n = m.next(); !n.done; n = m.next()) p = n.value, f.add(p);
              q = t(f);
              for (u = q.next(); !u.done; u = q.next()) w = u.value, ei(w, Ah(a.g.servers), Ah(a.g.advanced || {}), a.g.keySystemsMapping);
              v = function(A, H) {
                var E = [];
                A = t(A);
                for (var K = A.next(); !K.done; K = A.next()) {
                  K = K.value;
                  var M = K[H] || a.g.advanced && a.g.advanced[K.keySystem] && a.g.advanced[K.keySystem][H] || "", J;
                  if (J = "" == M) J = (J = K.keySystem) ? !!J.match(/^com\.widevine\.alpha/) : false;
                  J && ("audioRobustness" == H ? M = [a.g.defaultAudioRobustnessForWidevine] : "videoRobustness" == H && (M = [a.g.defaultVideoRobustnessForWidevine]));
                  if ("string" === typeof M) E.push(K);
                  else if (Array.isArray(M)) for (0 === M.length && (M = [""]), M = t(M), J = M.next(); !J.done; J = M.next()) {
                    var L = {};
                    E.push(Object.assign(
                      {},
                      K,
                      (L[H] = J.value, L)
                    ));
                  }
                }
                return E;
              };
              x = t(b);
              for (z = x.next(); !z.done; z = x.next()) C = z.value, C.video && (C.video.drmInfos = v(C.video.drmInfos, "videoRobustness"), C.video.drmInfos = v(C.video.drmInfos, "audioRobustness")), C.audio && (C.audio.drmInfos = v(C.audio.drmInfos, "videoRobustness"), C.audio.drmInfos = v(C.audio.drmInfos, "audioRobustness"));
              return F(B, lg(b, a.O, a.Z, a.g.preferredKeySystems), 2);
            }
            uh(a.l);
            D = d || Object.keys(a.g.servers).length;
            if (!D) return a.ea = true, B.return(Promise.resolve());
            G = ai(a, void 0, b);
            return B.return(d ? G : G.catch(function() {
            }));
          });
        }
        function fi(a) {
          var b;
          return Q(function(c) {
            switch (c.g) {
              case 1:
                if (a.j.mediaKeys) return c.return();
                if (!a.G) {
                  c.s(2);
                  break;
                }
                return F(c, a.G, 3);
              case 3:
                return uh(a.l), c.return();
              case 2:
                return xa(c, 4), a.G = a.j.setMediaKeys(a.A), F(c, a.G, 6);
              case 6:
                Aa(c, 5);
                break;
              case 4:
                b = Ba(c), a.u(new U(2, 6, 6003, b.message));
              case 5:
                uh(a.l), I(c);
            }
          });
        }
        function gi(a, b) {
          return Q(function(c) {
            if (1 == c.g) return F(c, fi(a), 2);
            hi(a, b.initDataType, Qb(b.initData));
            I(c);
          });
        }
        r.Lb = function(a) {
          var b = this;
          return Q(function(c) {
            if (1 == c.g) {
              if (b.j === a) return c.return();
              if (!b.A) return b.o.ma(a, "encrypted", function() {
                b.u(new U(2, 6, 6010));
              }), c.return();
              b.j = a;
              b.o.ma(b.j, "play", function() {
                for (var d = t(b.M), e = d.next(); !e.done; e = d.next()) ii(b, e.value);
                b.W = true;
                b.M = [];
              });
              b.j.remote ? (b.o.D(b.j.remote, "connect", function() {
                return Wh(b);
              }), b.o.D(b.j.remote, "connecting", function() {
                return Wh(b);
              }), b.o.D(b.j.remote, "disconnect", function() {
                return Wh(b);
              })) : "webkitCurrentPlaybackTargetIsWireless" in b.j && b.o.D(b.j, "webkitcurrentplaybacktargetiswirelesschanged", function() {
                return Wh(b);
              });
              b.F = b.h ? b.h.initData.find(function(d) {
                return 0 < d.initData.length;
              }) || null : null;
              return b.F || "com.apple.fps" !== b.h.keySystem || b.B.size ? F(c, fi(b), 2) : c.s(2);
            }
            ji(b).catch(function() {
            });
            b.F || b.B.size || b.g.parseInbandPsshEnabled || b.o.D(b.j, "encrypted", function(d) {
              return gi(b, d);
            });
            I(c);
          });
        };
        function ki(a) {
          var b, c, d, e, f;
          return Q(function(g) {
            switch (g.g) {
              case 1:
                if (!a.A || !a.h) return g.return();
                if (!a.h.serverCertificateUri || a.h.serverCertificate && a.h.serverCertificate.length) {
                  g.s(2);
                  break;
                }
                b = lh([a.h.serverCertificateUri], a.g.retryParameters);
                xa(g, 3);
                c = a.C.Xb.request(5, b, { isPreload: a.P() });
                return F(g, c.promise, 5);
              case 5:
                d = g.h;
                a.h.serverCertificate = Qb(d.data);
                Aa(g, 4);
                break;
              case 3:
                throw e = Ba(g), new U(2, 6, 6017, e);
              case 4:
                if (a.l.g) return g.return();
              case 2:
                if (!a.h.serverCertificate || !a.h.serverCertificate.length) return g.return();
                xa(g, 6);
                return F(g, a.A.setServerCertificate(a.h.serverCertificate), 8);
              case 8:
                Aa(g, 0);
                break;
              case 6:
                throw f = Ba(g), new U(2, 6, 6004, f.message);
            }
          });
        }
        function li(a, b) {
          var c, d, e;
          return Q(function(f) {
            if (1 == f.g) return F(f, mi(a, b, { initData: null, initDataType: null }), 2);
            if (3 != f.g) {
              c = f.h;
              if (!c) return f.return();
              d = [];
              if (e = a.i.get(c)) e.ub = new Ug(), d.push(e.ub);
              d.push(c.remove());
              return F(f, Promise.all(d), 3);
            }
            a.i.delete(c);
            I(f);
          });
        }
        function ji(a) {
          var b, c, d, e, f;
          return Q(function(g) {
            if (1 == g.g) {
              if (!a.B.size) return g.s(2);
              a.B.forEach(function(h, k2) {
                mi(a, k2, h);
              });
              return F(g, a.m, 3);
            }
            if (2 != g.g) {
              b = a.h && a.h.keyIds || /* @__PURE__ */ new Set([]);
              if (0 < b.size && ni(a)) return g.return(a.m);
              a.K = false;
              a.m = new Ug();
              a.m.catch(function() {
              });
            }
            c = (a.h ? a.h.initData : []) || [];
            d = t(c);
            for (e = d.next(); !e.done; e = d.next()) f = e.value, hi(a, f.initDataType, f.initData);
            oi(a) && a.m.resolve();
            return g.return(a.m);
          });
        }
        function hi(a, b, c) {
          if (c.length) {
            if (a.g.ignoreDuplicateInitData) {
              var d = a.i.values();
              d = t(d);
              for (var e = d.next(); !e.done; e = d.next()) if (Pb(c, e.value.initData)) return;
              var f = false;
              a.B.forEach(function(g) {
                !f && Pb(c, g.initData) && (f = true);
              });
              if (f) return;
            }
            a.K = true;
            0 < a.i.size && oi(a) && (a.m.resolve(), a.K = false, a.m = new Ug(), a.m.catch(function() {
            }));
            pi(a, b, c, a.h.sessionType);
          }
        }
        function qi(a) {
          a = a.i.keys();
          a = vh(a, function(b) {
            return b.sessionId;
          });
          return Array.from(a);
        }
        r.Gf = function() {
          var a = this, b = this.i.keys();
          b = vh(b, function(c) {
            var d = a.i.get(c);
            return { sessionId: c.sessionId, sessionType: d.type, initData: d.initData, initDataType: d.initDataType };
          });
          return Array.from(b);
        };
        r.pd = function() {
          var a = Infinity, b = this.i.keys();
          b = t(b);
          for (var c = b.next(); !c.done; c = b.next()) c = c.value, isNaN(c.expiration) || (a = Math.min(a, c.expiration));
          return a;
        };
        r.Yd = function() {
          return Bh(this.fa);
        };
        function ai(a, b, c) {
          var d, e, f, g, h, k2, l, m;
          return Q(function(n) {
            switch (n.g) {
              case 1:
                d = /* @__PURE__ */ new Map();
                if (c.length) {
                  e = ri(a, c, d);
                  n.s(2);
                  break;
                }
                return F(n, si(a, b), 3);
              case 3:
                e = n.h;
              case 2:
                f = e;
                if (!f) {
                  if (!navigator.requestMediaKeySystemAccess) throw new U(2, 6, 6020);
                  throw new U(2, 6, 6001);
                }
                uh(a.l);
                xa(n, 4);
                f.getConfiguration();
                g = a.g.keySystemsMapping[f.keySystem] || f.keySystem;
                if (c.length) {
                  var p = g;
                  var q = d.get(g);
                  var u = [], w = [], v = [], x = [], z = [], C = /* @__PURE__ */ new Set(), D = /* @__PURE__ */ new Set();
                  ti(q, u, w, x, v, z, C, D);
                  var G = a.O ? "persistent-license" : "temporary";
                  p = { keySystem: p, encryptionScheme: u[0], licenseServerUri: w[0], distinctiveIdentifierRequired: q[0].distinctiveIdentifierRequired, persistentStateRequired: q[0].persistentStateRequired, sessionType: q[0].sessionType || G, audioRobustness: q[0].audioRobustness || "", videoRobustness: q[0].videoRobustness || "", serverCertificate: x[0], serverCertificateUri: v[0], initData: z, keyIds: C };
                  0 < D.size && (p.keySystemUris = D);
                  q = t(q);
                  for (D = q.next(); !D.done; D = q.next()) D = D.value, D.distinctiveIdentifierRequired && (p.distinctiveIdentifierRequired = D.distinctiveIdentifierRequired), D.persistentStateRequired && (p.persistentStateRequired = D.persistentStateRequired);
                  q = p;
                } else q = g, D = b.get(g), p = [], u = [], w = [], v = [], x = [], z = /* @__PURE__ */ new Set(), ti(D.drmInfos, p, u, v, w, x, z), q = {
                  keySystem: q,
                  encryptionScheme: p[0],
                  licenseServerUri: u[0],
                  distinctiveIdentifierRequired: "required" == D.distinctiveIdentifier,
                  persistentStateRequired: "required" == D.persistentState,
                  sessionType: D.sessionTypes[0] || "temporary",
                  audioRobustness: (D.audioCapabilities ? D.audioCapabilities[0].robustness : "") || "",
                  videoRobustness: (D.videoCapabilities ? D.videoCapabilities[0].robustness : "") || "",
                  serverCertificate: v[0],
                  serverCertificateUri: w[0],
                  initData: x,
                  keyIds: z
                };
                a.h = q;
                if (!a.h.licenseServerUri) throw new U(2, 6, 6012, a.h.keySystem);
                return F(n, f.createMediaKeys(), 6);
              case 6:
                h = n.h;
                uh(a.l);
                a.A = h;
                if (!("" != a.g.minHdcpVersion && "getStatusForPolicy" in a.A)) {
                  n.s(7);
                  break;
                }
                xa(n, 8);
                return F(n, a.A.getStatusForPolicy({ minHdcpVersion: a.g.minHdcpVersion }), 10);
              case 10:
                k2 = n.h;
                if ("usable" != k2) throw new U(2, 6, 6018);
                uh(a.l);
                Aa(n, 7, 4);
                break;
              case 8:
                l = Ba(n, 4);
                if (l instanceof U) throw l;
                throw new U(2, 6, 6019, l.message);
              case 7:
                return a.ea = true, F(n, ki(a), 11);
              case 11:
                uh(a.l);
                Aa(n, 0);
                break;
              case 4:
                m = Ba(n);
                uh(a.l, m);
                a.h = null;
                if (m instanceof U) throw m;
                throw new U(2, 6, 6002, m.message);
            }
          });
        }
        function ri(a, b, c) {
          for (var d = t(b), e = d.next(); !e.done; e = d.next()) {
            e = t(di(e.value));
            for (var f = e.next(); !f.done; f = e.next()) f = f.value, c.has(f.keySystem) || c.set(f.keySystem, []), c.get(f.keySystem).push(f);
          }
          if (1 == c.size && c.has("")) throw new U(2, 6, 6e3);
          d = a.g.preferredKeySystems;
          d.length || (e = Ah(a.g.servers), 1 == e.size && (d = Array.from(e.keys())));
          e = t(d);
          var g = e.next();
          for (f = {}; !g.done; f = { nh: void 0 }, g = e.next()) {
            f.nh = g.value;
            g = t(b);
            for (var h = g.next(); !h.done; h = g.next()) if (h = h.value.decodingInfos.find(/* @__PURE__ */ function(n) {
              return function(p) {
                return p.supported && null != p.keySystemAccess && p.keySystemAccess.keySystem == n.nh;
              };
            }(f))) return h.keySystemAccess;
          }
          e = t([true, false]);
          for (f = e.next(); !f.done; f = e.next()) for (f = f.value, g = t(b), h = g.next(); !h.done; h = g.next()) {
            h = t(h.value.decodingInfos);
            for (var k2 = h.next(); !k2.done; k2 = h.next()) if (k2 = k2.value, k2.supported && k2.keySystemAccess) {
              var l = k2.keySystemAccess.keySystem;
              if (!d.includes(l)) {
                var m = c.get(l);
                !m && a.g.keySystemsMapping[l] && (m = c.get(a.g.keySystemsMapping[l]));
                l = t(m);
                for (m = l.next(); !m.done; m = l.next()) if (!!m.value.licenseServerUri == f) return k2.keySystemAccess;
              }
            }
          }
          return null;
        }
        function si(a, b) {
          var c, d, e, f, g, h, k2, l, m, n, p, q, u, w, v, x;
          return Q(function(z) {
            switch (z.g) {
              case 1:
                if (1 == b.size && b.has("")) throw new U(2, 6, 6e3);
                d = t(b.values());
                for (e = d.next(); !e.done; e = d.next()) f = e.value, 0 == f.audioCapabilities.length && delete f.audioCapabilities, 0 == f.videoCapabilities.length && delete f.videoCapabilities;
                g = t(a.g.preferredKeySystems);
                h = g.next();
              case 2:
                if (h.done) {
                  z.s(4);
                  break;
                }
                k2 = h.value;
                if (!b.has(k2)) {
                  z.s(3);
                  break;
                }
                l = b.get(k2);
                xa(z, 6);
                return F(z, navigator.requestMediaKeySystemAccess(k2, [l]), 8);
              case 8:
                return c = z.h, z.return(c);
              case 6:
                Ba(z);
              case 7:
                uh(a.l);
              case 3:
                h = g.next();
                z.s(2);
                break;
              case 4:
                m = t([true, false]), n = m.next();
              case 9:
                if (n.done) {
                  z.s(11);
                  break;
                }
                p = n.value;
                q = t(b.keys());
                u = q.next();
              case 12:
                if (u.done) {
                  n = m.next();
                  z.s(9);
                  break;
                }
                w = u.value;
                v = b.get(w);
                x = v.drmInfos.some(function(C) {
                  return !!C.licenseServerUri;
                });
                if (x != p) {
                  z.s(13);
                  break;
                }
                xa(z, 15);
                return F(z, navigator.requestMediaKeySystemAccess(w, [v]), 17);
              case 17:
                return c = z.h, z.return(c);
              case 15:
                Ba(z);
              case 16:
                uh(a.l);
              case 13:
                u = q.next();
                z.s(12);
                break;
              case 11:
                return z.return(c);
            }
          });
        }
        function ui(a) {
          oi(a) && a.m.resolve();
        }
        function vi(a, b) {
          new ec(function() {
            b.loaded = true;
            ui(a);
          }).da(wi);
        }
        function mi(a, b, c) {
          var d, e, f, g, h, k2, l;
          return Q(function(m) {
            switch (m.g) {
              case 1:
                try {
                  d = a.A.createSession("persistent-license");
                } catch (n) {
                  return e = new U(2, 6, 6005, n.message), a.u(e), m.return(Promise.reject(e));
                }
                a.o.D(d, "message", function(n) {
                  a.j && a.g.delayLicenseRequestUntilPlayed && a.j.paused && !a.W ? a.M.push(n) : ii(a, n);
                });
                a.o.D(d, "keystatuseschange", function(n) {
                  return xi(a, n);
                });
                f = { initData: c.initData, initDataType: c.initDataType, loaded: false, Vf: Infinity, ub: null, type: "persistent-license" };
                a.i.set(d, f);
                xa(m, 2);
                return F(
                  m,
                  d.load(b),
                  4
                );
              case 4:
                return g = m.h, uh(a.l), g || (a.i.delete(d), h = a.g.persistentSessionOnlinePlayback ? 1 : 2, a.u(new U(h, 6, 6013)), f.loaded = true), vi(a, f), ui(a), m.return(d);
              case 2:
                k2 = Ba(m), uh(a.l, k2), a.i.delete(d), l = a.g.persistentSessionOnlinePlayback ? 1 : 2, a.u(new U(l, 6, 6005, k2.message)), f.loaded = true, ui(a);
              case 3:
                return m.return(Promise.resolve());
            }
          });
        }
        function pi(a, b, c, d) {
          try {
            var e = a.A.createSession(d);
          } catch (f) {
            a.u(new U(2, 6, 6005, f.message));
            return;
          }
          a.o.D(e, "message", function(f) {
            a.j && a.g.delayLicenseRequestUntilPlayed && a.j.paused && !a.W ? a.M.push(f) : ii(a, f);
          });
          a.o.D(e, "keystatuseschange", function(f) {
            return xi(a, f);
          });
          a.i.set(e, { initData: c, initDataType: b, loaded: false, Vf: Infinity, ub: null, type: d });
          try {
            c = a.g.initDataTransform(c, b, a.h);
          } catch (f) {
            b = f;
            f instanceof U || (b = new U(2, 6, 6016, f));
            a.u(b);
            return;
          }
          a.g.logLicenseExchange && Sc(c);
          e.generateRequest(b, c).catch(function(f) {
            if (!a.l.g) {
              a.i.delete(e);
              var g = f.errorCode;
              if (g && g.systemCode) {
                var h = g.systemCode;
                0 > h && (h += Math.pow(2, 32));
                h = "0x" + h.toString(16);
              }
              a.u(new U(2, 6, 6006, f.message, f, h));
            }
          });
        }
        function yi(a) {
          return Q(function(b) {
            return 1 == b.g ? a.K ? F(b, a.m, 3) : b.s(0) : F(b, Promise.all(a.T.map(function(c) {
              return c.promise;
            })), 0);
          });
        }
        function ii(a, b) {
          var c, d, e, f, g, h, k2, l, m, n, p, q, u, w;
          Q(function(v) {
            switch (v.g) {
              case 1:
                c = b.target;
                a.g.logLicenseExchange && Sc(b.message);
                d = a.i.get(c);
                e = a.h.licenseServerUri;
                f = a.g.advanced[a.h.keySystem];
                "individualization-request" == b.messageType && f && f.individualizationServer && (e = f.individualizationServer);
                g = lh([e], a.g.retryParameters);
                g.body = b.message;
                g.method = "POST";
                g.licenseRequestType = b.messageType;
                g.sessionId = c.sessionId;
                g.drmInfo = a.h;
                d && (g.initData = d.initData, g.initDataType = d.initDataType);
                if (f && f.headers) for (h in f.headers) g.headers[h] = f.headers[h];
                if ("org.w3.clearkey" === a.h.keySystem) {
                  var x = g, z = a.h;
                  try {
                    var C = Kc(x.body);
                    if (C) {
                      var D = JSON.parse(C);
                      D.type || (D.type = z.sessionType, x.body = Lc(JSON.stringify(D)));
                    }
                  } catch (G) {
                  }
                }
                if ($b(a.h.keySystem)) if (x = Ic(g.body, true, true), x.includes("PlayReadyKeyMessage")) {
                  x = Rd(x, "PlayReadyKeyMessage");
                  z = ae(x, "HttpHeader");
                  z = t(z);
                  for (C = z.next(); !C.done; C = z.next()) D = C.value, C = ae(D, "name")[0], D = ae(D, "value")[0], g.headers[Zd(C)] = Zd(D);
                  x = ae(x, "Challenge")[0];
                  g.body = Tc(Zd(x));
                } else g.headers["Content-Type"] = "text/xml; charset=utf-8";
                k2 = Date.now();
                xa(v, 2);
                m = a.C.Xb.request(2, g, { isPreload: a.P() });
                a.T.push(m);
                return F(v, m.promise, 4);
              case 4:
                l = v.h;
                Cd(a.T, m);
                Aa(v, 3);
                break;
              case 2:
                n = Ba(v);
                if (a.l.g) return v.return();
                p = new U(2, 6, 6007, n);
                1 == a.i.size ? (a.u(p), d && d.ub && d.ub.reject(p)) : (d && d.ub && d.ub.reject(p), a.i.delete(c), oi(a) && (a.m.resolve(), a.L.da(0.1)));
                return v.return();
              case 3:
                if (a.l.g) return v.return();
                a.H += (Date.now() - k2) / 1e3;
                a.g.logLicenseExchange && Sc(l.data);
                xa(v, 5);
                return F(v, c.update(l.data), 7);
              case 7:
                Aa(v, 6);
                break;
              case 5:
                return q = Ba(v), u = new U(2, 6, 6008, q.message), a.u(u), d && d.ub && d.ub.reject(u), v.return();
              case 6:
                if (a.l.g) return v.return();
                w = new V("drmsessionupdate");
                a.C.onEvent(w);
                d && (d.ub && d.ub.resolve(), vi(a, d));
                I(v);
            }
          });
        }
        function xi(a, b) {
          b = b.target;
          var c = a.i.get(b), d = false;
          b.keyStatuses.forEach(function(f, g) {
            if ("string" == typeof g) {
              var h = g;
              g = f;
              f = h;
            }
            if ($b(a.h.keySystem) && 16 == g.byteLength && (ic() || uc())) {
              h = Vb(g);
              var k2 = h.getUint32(0, true), l = h.getUint16(4, true), m = h.getUint16(6, true);
              h.setUint32(0, k2, false);
              h.setUint16(4, l, false);
              h.setUint16(6, m, false);
            }
            "status-pending" != f && (c.loaded = true);
            "expired" == f && (d = true);
            g = Vc(g).slice(0, 32);
            a.Y.set(g, f);
          });
          var e = b.expiration - Date.now();
          (0 > e || d && 1e3 > e) && c && !c.ub && (a.i.delete(b), zi(b));
          oi(a) && (a.m.resolve(), a.L.da(Ai));
        }
        function Th(a) {
          var b = a.Y, c = a.fa;
          c.clear();
          b.forEach(function(d, e) {
            return c.set(e, d);
          });
          b = Array.from(c.values());
          b.length && b.every(function(d) {
            return "expired" == d;
          }) && a.u(new U(2, 6, 6014));
          a.C.pe(Bh(c));
        }
        function Bi() {
          var a, b, c, d, e, f, g, h, k2, l, m, n, p, q, u, w, v, x, z, C, D, G, B, A, H, E, K, M, J, L, N, P, O, R;
          return Q(function(S) {
            if (1 == S.g) {
              a = "org.w3.clearkey com.widevine.alpha com.widevine.alpha.experiment com.microsoft.playready com.microsoft.playready.hardware com.microsoft.playready.recommendation com.chromecast.playready com.apple.fps.1_0 com.apple.fps com.huawei.wiseplay".split(" ");
              if (!(window2.MediaKeys && window2.navigator && window2.navigator.requestMediaKeySystemAccess && window2.MediaKeySystemAccess && window2.MediaKeySystemAccess.prototype.getConfiguration)) {
                b = {};
                c = t(a);
                for (d = c.next(); !d.done; d = c.next()) e = d.value, b[e] = null;
                return S.return(b);
              }
              f = "1.0 1.1 1.2 1.3 1.4 2.0 2.1 2.2 2.3".split(" ");
              g = ["SW_SECURE_CRYPTO", "SW_SECURE_DECODE", "HW_SECURE_CRYPTO", "HW_SECURE_DECODE", "HW_SECURE_ALL"];
              h = ["150", "2000", "3000"];
              k2 = { "com.widevine.alpha": g, "com.widevine.alpha.experiment": g, "com.microsoft.playready.recommendation": h };
              l = [{ contentType: 'video/mp4; codecs="avc1.42E01E"' }, { contentType: 'video/webm; codecs="vp8"' }];
              m = [{ contentType: 'audio/mp4; codecs="mp4a.40.2"' }, { contentType: 'audio/webm; codecs="opus"' }];
              n = { videoCapabilities: l, audioCapabilities: m, initDataTypes: ["cenc", "sinf", "skd", "keyids"] };
              p = [null, "cenc", "cbcs", "cbcs-1-9"];
              q = /* @__PURE__ */ new Map();
              u = function(pa, Z) {
                var Fa, Ia, sa, ka, Ca, ra, ya, na, ta, Pa, ob, db, eb;
                return Q(function(jb) {
                  switch (jb.g) {
                    case 1:
                      return xa(jb, 2), F(jb, Z.createMediaKeys(), 5);
                    case 5:
                      Fa = jb.h;
                    case 4:
                      Aa(jb, 3);
                      break;
                    case 2:
                      return Ba(jb), jb.return();
                    case 3:
                      sa = (Ia = Z.getConfiguration().sessionTypes) ? Ia.includes("persistent-license") : false;
                      mc() && (sa = false);
                      ka = Z.getConfiguration().videoCapabilities;
                      Ca = Z.getConfiguration().audioCapabilities;
                      ra = { persistentState: sa, encryptionSchemes: [], videoRobustnessLevels: [], audioRobustnessLevels: [], minHdcpVersions: [] };
                      q.has(pa) && q.get(pa) ? ra = q.get(pa) : q.set(pa, ra);
                      (ya = ka[0].encryptionScheme) && !ra.encryptionSchemes.includes(ya) && ra.encryptionSchemes.push(ya);
                      (na = ka[0].robustness) && !ra.videoRobustnessLevels.includes(na) && ra.videoRobustnessLevels.push(na);
                      (ta = Ca[0].robustness) && !ra.audioRobustnessLevels.includes(ta) && ra.audioRobustnessLevels.push(ta);
                      if ("getStatusForPolicy" in Fa) {
                        Pa = [];
                        ob = t(f);
                        db = ob.next();
                        for (eb = {}; !db.done; eb = { td: void 0 }, db = ob.next()) eb.td = db.value, ra.minHdcpVersions.includes(eb.td) || Pa.push(Fa.getStatusForPolicy({ minHdcpVersion: eb.td }).then(/* @__PURE__ */ function(ub) {
                          return function(ye) {
                            "usable" != ye || ra.minHdcpVersions.includes(ub.td) || ra.minHdcpVersions.push(ub.td);
                          };
                        }(eb)));
                        return F(jb, Promise.all(Pa), 0);
                      }
                      jb.s(0);
                  }
                });
              };
              w = function(pa, Z, Fa, Ia) {
                var sa, ka, Ca, ra, ya, na, ta, Pa, ob, db;
                return Q(function(eb) {
                  switch (eb.g) {
                    case 1:
                      xa(eb, 2);
                      sa = Nd(n);
                      ka = t(sa.videoCapabilities);
                      for (Ca = ka.next(); !Ca.done; Ca = ka.next()) ra = Ca.value, ra.encryptionScheme = Z, ra.robustness = Fa;
                      ya = t(sa.audioCapabilities);
                      for (na = ya.next(); !na.done; na = ya.next()) ta = na.value, ta.encryptionScheme = Z, ta.robustness = Ia;
                      Pa = Nd(sa);
                      Pa.persistentState = "required";
                      Pa.sessionTypes = ["persistent-license"];
                      ob = [Pa, sa];
                      return yc() ? F(eb, Lf(5, navigator.requestMediaKeySystemAccess(pa, ob)), 7) : F(eb, navigator.requestMediaKeySystemAccess(pa, ob), 6);
                    case 6:
                      db = eb.h;
                      eb.s(5);
                      break;
                    case 7:
                      db = eb.h;
                    case 5:
                      return F(eb, u(pa, db), 8);
                    case 8:
                      Aa(eb, 0);
                      break;
                    case 2:
                      Ba(eb), I(eb);
                  }
                });
              };
              v = function(pa, Z, Fa, Ia) {
                var sa, ka, Ca;
                return Q(function(ra) {
                  switch (ra.g) {
                    case 1:
                      return xa(ra, 2), sa = { type: "media-source", video: { contentType: l[0].contentType, width: 640, height: 480, bitrate: 1, framerate: 1 }, audio: { contentType: m[0].contentType, channels: 2, bitrate: 1, samplerate: 1 }, keySystemConfiguration: { keySystem: pa, video: { encryptionScheme: Z, robustness: Fa }, audio: { encryptionScheme: Z, robustness: Ia } } }, yc() ? F(ra, Lf(5, navigator.mediaCapabilities.decodingInfo(sa)), 7) : F(
                        ra,
                        navigator.mediaCapabilities.decodingInfo(sa),
                        6
                      );
                    case 6:
                      ka = ra.h;
                      ra.s(5);
                      break;
                    case 7:
                      ka = ra.h;
                    case 5:
                      return Ca = ka.keySystemAccess, F(ra, u(pa, Ca), 8);
                    case 8:
                      Aa(ra, 0);
                      break;
                    case 2:
                      Ba(ra), I(ra);
                  }
                });
              };
              x = t(a);
              for (z = x.next(); !z.done; z = x.next()) C = z.value, q.set(C, null);
              D = function(pa) {
                return "org.w3.clearkey" === pa && rc() ? false : true;
              };
              G = [];
              B = t(p);
              for (A = B.next(); !A.done; A = B.next()) for (H = A.value, E = t(a), K = E.next(); !K.done; K = E.next()) M = K.value, D(M) && (G.push(w(M, H, "", "")), G.push(v(M, H, "", "")));
              J = t(a);
              for (L = J.next(); !L.done; L = J.next()) for (N = L.value, P = t(k2[N] || []), O = P.next(); !O.done; O = P.next()) R = O.value, D(N) && (G.push(w(N, null, R, "")), G.push(w(N, null, "", R)), G.push(v(N, null, R, "")), G.push(v(N, null, "", R)));
              return F(S, Promise.all(G), 2);
            }
            return S.return(Bh(q));
          });
        }
        function zi(a) {
          return Q(function(b) {
            if (1 == b.g) return xa(b, 2), F(b, Lf(Ci, Promise.all([a.close().catch(function() {
            }), a.closed])), 4);
            if (2 != b.g) return Aa(b, 0);
            Ba(b);
            I(b);
          });
        }
        function Wh(a) {
          var b;
          return Q(function(c) {
            b = Array.from(a.i.entries());
            a.i.clear();
            return F(c, Promise.all(b.map(function(d) {
              d = t(d);
              var e = d.next().value, f = d.next().value;
              return Q(function(g) {
                if (1 == g.g) return xa(g, 2), a.ka || a.B.has(e.sessionId) || "persistent-license" !== f.type || a.g.persistentSessionOnlinePlayback ? F(g, zi(e), 5) : F(g, e.remove(), 5);
                if (2 != g.g) return Aa(g, 0);
                Ba(g);
                I(g);
              });
            })), 0);
          });
        }
        function di(a) {
          return (a.video ? a.video.drmInfos : []).concat(a.audio ? a.audio.drmInfos : []);
        }
        function Uh(a) {
          a.i.forEach(function(b, c) {
            var d = b.Vf, e = c.expiration;
            isNaN(e) && (e = Infinity);
            e != d && (a.C.onExpirationUpdated(c.sessionId, e), b.Vf = e);
          });
        }
        function oi(a) {
          a = a.i.values();
          return wh(a, function(b) {
            return b.loaded;
          });
        }
        function ni(a) {
          for (var b = t(a.h && a.h.keyIds || /* @__PURE__ */ new Set([])), c = b.next(); !c.done; c = b.next()) if ("usable" !== a.Y.get(c.value)) return false;
          return true;
        }
        function ci(a, b) {
          var c = [];
          b.forEach(function(d, e) {
            c.push({ keySystem: e, licenseServerUri: d, distinctiveIdentifierRequired: false, persistentStateRequired: false, audioRobustness: "", videoRobustness: "", serverCertificate: null, serverCertificateUri: "", initData: [], keyIds: /* @__PURE__ */ new Set() });
          });
          a = t(a);
          for (b = a.next(); !b.done; b = a.next()) b = b.value, b.video && (b.video.drmInfos = c), b.audio && (b.audio.drmInfos = c);
        }
        function ti(a, b, c, d, e, f, g, h) {
          var k2 = [];
          a = t(a);
          for (var l = a.next(), m = {}; !l.done; m = { va: void 0 }, l = a.next()) {
            m.va = l.value;
            b.includes(m.va.encryptionScheme) || b.push(m.va.encryptionScheme);
            "org.w3.clearkey" == m.va.keySystem && m.va.licenseServerUri.startsWith("data:application/json;base64,") ? k2.includes(m.va.licenseServerUri) || k2.push(m.va.licenseServerUri) : c.includes(m.va.licenseServerUri) || c.push(m.va.licenseServerUri);
            e.includes(m.va.serverCertificateUri) || e.push(m.va.serverCertificateUri);
            m.va.serverCertificate && (d.some(/* @__PURE__ */ function(q) {
              return function(u) {
                return Pb(u, q.va.serverCertificate);
              };
            }(m)) || d.push(m.va.serverCertificate));
            if (m.va.initData) {
              l = t(m.va.initData);
              for (var n = l.next(), p = {}; !n.done; p = { Mf: void 0 }, n = l.next()) p.Mf = n.value, f.some(/* @__PURE__ */ function(q) {
                return function(u) {
                  var w = q.Mf;
                  return u.keyId && u.keyId == w.keyId ? true : u.initDataType == w.initDataType && Pb(u.initData, w.initData);
                };
              }(p)) || f.push(p.Mf);
            }
            if (m.va.keyIds) for (l = t(m.va.keyIds), n = l.next(); !n.done; n = l.next()) g.add(n.value);
            if (m.va.keySystemUris && h) for (m = t(m.va.keySystemUris), l = m.next(); !l.done; l = m.next()) h.add(l.value);
          }
          if (1 == k2.length) c.push(k2[0]);
          else if (0 < k2.length) {
            b = [];
            k2 = t(k2);
            for (d = k2.next(); !d.done; d = k2.next()) d = window2.atob(d.value.split("data:application/json;base64,").pop()), d = JSON.parse(d), b.push.apply(b, y(d.keys));
            k2 = JSON.stringify({ keys: b });
            c.push("data:application/json;base64," + window2.btoa(k2));
          }
        }
        function ei(a, b, c, d) {
          var e = a.keySystem;
          if (e && ("org.w3.clearkey" != e || !a.licenseServerUri)) {
            b.size && b.get(e) && (b = b.get(e), a.licenseServerUri = b);
            a.keyIds || (a.keyIds = /* @__PURE__ */ new Set());
            if (c = c.get(e)) a.distinctiveIdentifierRequired || (a.distinctiveIdentifierRequired = c.distinctiveIdentifierRequired), a.persistentStateRequired || (a.persistentStateRequired = c.persistentStateRequired), a.serverCertificate || (a.serverCertificate = c.serverCertificate), c.sessionType && (a.sessionType = c.sessionType), a.serverCertificateUri || (a.serverCertificateUri = c.serverCertificateUri);
            d[e] && (a.keySystem = d[e]);
            window2.cast && window2.cast.__platform__ && "com.microsoft.playready" == e && (a.keySystem = "com.chromecast.playready");
          }
        }
        function bi(a, b) {
          a = Ah(a);
          if (0 != a.size) {
            a = $c(a);
            b = t(b);
            for (var c = b.next(); !c.done; c = b.next()) c = c.value, c.video && (c.video.drmInfos = [a]), c.audio && (c.audio.drmInfos = [a]);
          }
        }
        var Ci = 1, wi = 5, Ai = 0.5;
        function Di(a, b, c) {
          c = void 0 === c ? true : c;
          this.h = a;
          this.g = /* @__PURE__ */ new Set([a]);
          b = b || [];
          a = t(b);
          for (b = a.next(); !b.done; b = a.next()) this.add(b.value, c);
        }
        Di.prototype.add = function(a, b) {
          var c = this.h;
          b = void 0 === b ? true : b;
          var d;
          if (!(d = !!c.audio != !!a.audio || !!c.video != !!a.video || c.language != a.language) && (d = c.audio && a.audio)) {
            d = c.audio;
            var e = a.audio;
            d = !(!((!d.channelsCount || !e.channelsCount || 2 < d.channelsCount || 2 < e.channelsCount) && d.channelsCount != e.channelsCount || d.spatialAudio !== e.spatialAudio || b && !Ei(d, e)) && Fi(d.roles, e.roles) && d.groupId === e.groupId);
          }
          !d && (d = c.video && a.video) && (c = c.video, d = a.video, d = !((!b || Ei(c, d)) && Fi(c.roles, d.roles)));
          return d ? false : (this.g.add(a), true);
        };
        Di.prototype.values = function() {
          return this.g.values();
        };
        function Ei(a, b) {
          if (a.mimeType != b.mimeType) return false;
          a = a.codecs.split(",").map(function(d) {
            return uf(d);
          });
          b = b.codecs.split(",").map(function(d) {
            return uf(d);
          });
          if (a.length != b.length) return false;
          a.sort();
          b.sort();
          for (var c = 0; c < a.length; c++) if (a[c] != b[c]) return false;
          return true;
        }
        function Fi(a, b) {
          a = new Set(a);
          b = new Set(b);
          a.delete("main");
          b.delete("main");
          if (a.size != b.size) return false;
          a = t(a);
          for (var c = a.next(); !c.done; c = a.next()) if (!b.has(c.value)) return false;
          return true;
        }
        T("shaka.media.AdaptationSet", Di);
        T("shaka.config.CodecSwitchingStrategy", { RELOAD: "reload", SMOOTH: "smooth" });
        function Gi() {
        }
        Gi.prototype.create = function() {
        };
        Gi.prototype.configure = function() {
        };
        T("shaka.media.AdaptationSetCriteria", Gi);
        function Hi() {
          this.g = Ii;
          this.i = (/* @__PURE__ */ new Map()).set(Ii, 2).set(Ji, 1);
          this.h = 0;
        }
        var Ji = 0, Ii = 1;
        /*
         @license
         Shaka Player
         Copyright 2023 Google LLC
         SPDX-License-Identifier: Apache-2.0
        */
        function Ki(a, b, c) {
          this.g = a;
          this.i = b;
          this.h = c;
        }
        function Li(a, b) {
          return Q(function(c) {
            if (1 == c.g) return F(c, gg(a.h, b, a.g.drm.preferredKeySystems, a.g.drm.keySystemsMapping), 2);
            a.g.streaming.dontChooseCodecs || cg(b, a.g.preferredVideoCodecs, a.g.preferredAudioCodecs, a.g.preferredDecodingAttributes, a.g.preferredTextFormats);
            if (!b.variants.some(Gg)) throw new U(2, 4, 4032);
            return c.return(Mi(a, b));
          });
        }
        function Ni(a, b) {
          var c = a.g.restrictions;
          a = a.i;
          var d = false;
          b = t(b.variants);
          for (var e = b.next(); !e.done; e = b.next()) {
            e = e.value;
            var f = e.allowedByApplication;
            e.allowedByApplication = fg(e, c, a);
            f != e.allowedByApplication && (d = true);
          }
          return d;
        }
        function Mi(a, b) {
          var c = Ni(a, b);
          if (b) {
            var d = a.h ? a.h.h : null;
            if (d && a.h.A) for (var e = t(b.variants), f = e.next(); !f.done; f = e.next()) f = f.value, Oi(a, d.keySystem, f.video), Oi(a, d.keySystem, f.audio);
            Pi(a, b);
          }
          return c;
        }
        function Oi(a, b, c) {
          if (c) {
            c = t(c.drmInfos);
            for (var d = c.next(); !d.done; d = c.next()) if (d = d.value, d.keySystem == b) {
              d = t(d.initData || []);
              for (var e = d.next(); !e.done; e = d.next()) e = e.value, hi(a.h, e.initDataType, e.initData);
            }
          }
        }
        function Pi(a, b) {
          a = a.h ? a.h.Yd() : {};
          var c = Object.keys(a);
          c = c.length && "00" == c[0];
          var d = false, e = false, f = /* @__PURE__ */ new Set(), g = /* @__PURE__ */ new Set();
          b = t(b.variants);
          for (var h = b.next(); !h.done; h = b.next()) {
            h = h.value;
            var k2 = [];
            h.audio && k2.push(h.audio);
            h.video && k2.push(h.video);
            k2 = t(k2);
            for (var l = k2.next(); !l.done; l = k2.next()) if (l = l.value, l.keyIds.size) {
              l = t(l.keyIds);
              for (var m = l.next(); !m.done; m = l.next()) {
                m = m.value;
                var n = a[c ? "00" : m];
                n ? Qi.includes(n) && g.add(n) : f.add(m);
              }
            }
            h.allowedByApplication ? h.allowedByKeySystem && (d = true) : e = true;
          }
          if (!d) throw a = {
            hasAppRestrictions: e,
            missingKeys: Array.from(f),
            restrictedKeyStatuses: Array.from(g)
          }, new U(2, 4, 4012, a);
        }
        var Qi = ["output-restricted", "internal-error"];
        function Ri() {
        }
        function Si(a, b) {
          Ti.set(a, b);
        }
        function Ui() {
          var a = {};
          if (fc()) for (var b = t(Ti.keys()), c = b.next(); !c.done; c = b.next()) a[c.value] = true;
          b = t(["application/dash+xml", "application/x-mpegurl", "application/vnd.apple.mpegurl", "application/vnd.ms-sstr+xml"]);
          for (c = b.next(); !c.done; c = b.next()) c = c.value, a[c] = fc() ? Ti.has(c) : gc(c);
          return a;
        }
        function Vi(a, b) {
          if (b) {
            var c = Ti.get(b.toLowerCase());
            if (c) return c;
          }
          throw new U(2, 4, 4e3, a, b);
        }
        T("shaka.media.ManifestParser", Ri);
        Ri.unregisterParserByMime = function(a) {
          Ti.delete(a);
        };
        Ri.registerParserByMime = Si;
        Ri.registerParserByExtension = function() {
          sb("ManifestParser.registerParserByExtension", "Please use an ManifestParser with registerParserByMime function.");
        };
        Ri.AccessibilityPurpose = { Nk: "visually impaired", dk: "hard of hearing" };
        var Ti = /* @__PURE__ */ new Map();
        function Wi(a, b) {
          var c = null, d = null, e = null, f = null, g = a.S();
          b & 1 && (e = a.bd());
          b & 2 && (f = a.S());
          b & 8 && (c = a.S());
          b & 16 && (d = a.S());
          return { trackId: g, ld: c, md: d, Wh: e, rh: f };
        }
        function Xi(a, b) {
          return 1 == b ? (b = a.S(), a = a.S(), { baseMediaDecodeTime: b * Math.pow(2, 32) + a }) : { baseMediaDecodeTime: a.S() };
        }
        function Yi(a, b) {
          1 == b ? (a.skip(8), a.skip(8)) : (a.skip(4), a.skip(4));
          b = a.S();
          a.skip(4);
          a = a.na();
          return { timescale: b, language: String.fromCharCode((a >> 10) + 96) + String.fromCharCode(((a & 960) >> 5) + 96) + String.fromCharCode((a & 31) + 96) };
        }
        function Zi(a, b, c) {
          var d = a.S(), e = [], f = null;
          c & 1 && (f = a.$f());
          c & 4 && a.skip(4);
          for (var g = 0; g < d; g++) {
            var h = { gg: null, sampleSize: null, ye: null };
            c & 256 && (h.gg = a.S());
            c & 512 && (h.sampleSize = a.S());
            c & 1024 && a.skip(4);
            c & 2048 && (h.ye = 0 == b ? a.S() : a.$f());
            e.push(h);
          }
          return { Sk: d, fg: e, nf: f };
        }
        function $i(a) {
          a.skip(6);
          a.skip(2);
          a.skip(8);
          var b = a.na();
          a.skip(2);
          a.skip(2);
          a.skip(2);
          a = a.na() + a.na() / 65536;
          return { channelCount: b, sampleRate: a };
        }
        function aj(a) {
          a = a.S();
          return { codec: Jh(a) };
        }
        function bj(a) {
          var b = null, c = null, d = a.Cb(4);
          var e = String.fromCharCode(d[0]);
          e += String.fromCharCode(d[1]);
          e += String.fromCharCode(d[2]);
          e += String.fromCharCode(d[3]);
          if ("nclx" === e) {
            switch (a.na()) {
              case 1:
              case 5:
              case 6:
              case 7:
                b = "srgb";
                break;
              case 9:
                b = "rec2020";
                break;
              case 11:
              case 12:
                b = "p3";
            }
            d = a.na();
            a.na();
            switch (d) {
              case 1:
              case 6:
              case 13:
              case 14:
              case 15:
                c = "SDR";
                break;
              case 16:
                c = "PQ";
                break;
              case 18:
                c = "HLG";
            }
          }
          return { colorGamut: b, Nd: c };
        }
        function cj(a, b) {
          b = void 0 === b ? false : b;
          a = a.toString(16).toUpperCase();
          return b ? a : ("0" + a).slice(-2);
        }
        function dj(a) {
          return (10 > a ? "0" : "") + a;
        }
        function ej(a) {
          if (!fj) {
            fj = true;
            var b = new Uint8Array([105, 115, 111, 109]), c = new Uint8Array([97, 118, 99, 49]), d = new Uint8Array([0, 0, 0, 1]);
            gj = hj("ftyp", b, d, b, c);
            b = hj("dref", ij);
            jj = hj("dinf", b);
          }
          this.g = a;
        }
        function kj(a) {
          for (var b = [], c = t(a.g), d = c.next(); !d.done; d = c.next()) {
            var e = b, f = e.push;
            var g = d.value;
            d = hj;
            var h = g.id + 1;
            var k2 = g.stream.width || 0, l = g.stream.height || 0;
            "audio" == g.type && (l = k2 = 0);
            var m = g.duration * g.timescale, n = Math.floor(m / (lj + 1));
            m = Math.floor(m % (lj + 1));
            h = new Uint8Array([1, 0, 0, 7, 0, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 3].concat(y(mj(h, 4)), [0, 0, 0, 0], y(mj(n, 4)), y(mj(m, 4)), [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 64, 0, 0, 0], y(mj(k2, 2)), [0, 0], y(mj(
              l,
              2
            )), [0, 0]));
            h = hj("tkhd", h);
            k2 = hj;
            n = g.duration * g.timescale;
            l = Math.floor(n / (lj + 1));
            n = Math.floor(n % (lj + 1));
            m = g.stream.language;
            m = m.charCodeAt(0) - 96 << 10 | m.charCodeAt(1) - 96 << 5 | m.charCodeAt(2) - 96;
            l = new Uint8Array([1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 3].concat(y(mj(g.timescale, 4)), y(mj(l, 4)), y(mj(n, 4)), y(mj(m, 2)), [0, 0]));
            l = hj("mdhd", l);
            n = g;
            m = new Uint8Array([]);
            switch (n.type) {
              case "video":
                m = nj;
                break;
              case "audio":
                m = oj;
            }
            n = hj("hdlr", m);
            a: {
              switch (g.type) {
                case "video":
                  g = hj("minf", hj("vmhd", pj), jj, qj(g));
                  break a;
                case "audio":
                  g = hj("minf", hj("smhd", rj), jj, qj(g));
                  break a;
              }
              g = new Uint8Array([]);
            }
            g = k2("mdia", l, n, g);
            d = d("trak", h, g);
            f.call(e, d);
          }
          b = Wc.apply(Qc, y(b));
          f = a.g[0];
          c = hj;
          d = f.duration * f.timescale;
          e = Math.floor(d / (lj + 1));
          d = Math.floor(d % (lj + 1));
          e = new Uint8Array([1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 3].concat(y(mj(f.timescale, 4)), y(mj(e, 4)), y(mj(d, 4)), [
            0,
            1,
            0,
            0,
            1,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            1,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            1,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            64,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            255,
            255,
            255,
            255
          ]));
          e = hj("mvhd", e);
          d = [];
          a = t(a.g);
          for (k2 = a.next(); !k2.done; k2 = a.next()) g = d, h = g.push, k2 = new Uint8Array([0, 0, 0, 0].concat(y(mj(k2.value.id + 1, 4)), [0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0])), k2 = hj("trex", k2), h.call(g, k2);
          a = Wc.apply(Qc, y(d));
          a = hj("mvex", a);
          d = [];
          if (f.encrypted) {
            f = t(f.stream.drmInfos);
            for (g = f.next(); !g.done; g = f.next()) if (g = g.value, g.initData) for (g = t(g.initData), h = g.next(); !h.done; h = g.next()) d.push(h.value.initData);
            f = Wc.apply(Qc, y(d));
          } else f = new Uint8Array([]);
          a = c("moov", e, b, a, f);
          b = new Uint8Array(gj.byteLength + a.byteLength);
          b.set(gj);
          b.set(a, gj.byteLength);
          return b;
        }
        function qj(a) {
          var b = hj, c = "aac";
          a.codecs.includes("mp3") ? c = "mp3" : a.codecs.includes("ac-3") ? c = mc() ? "ec-3" : "ac-3" : a.codecs.includes("ec-3") ? c = "ec-3" : a.codecs.includes("opus") && (c = "opus");
          var d = new Uint8Array([]);
          switch (a.type) {
            case "video":
              if (a.codecs.includes("avc1")) {
                c = a.stream.width || 0;
                d = a.stream.height || 0;
                if (0 < a.Ca.byteLength) var e = hj("avcC", a.Ca);
                else {
                  e = hj;
                  for (var f = 7, g = [], h = [], k2 = 0, l = 0, m = 0, n = 0; n < a.lb.length; n++) {
                    var p = sj(a.lb[n]);
                    switch (p[0] & 31) {
                      case 7:
                        g.push(p);
                        f += p.length + 2;
                        break;
                      case 8:
                        h.push(p), f += p.length + 2;
                    }
                  }
                  0 < g.length && (k2 = g[0][1], m = g[0][2], l = g[0][3]);
                  f = new Uint8Array(f);
                  n = 0;
                  f[n++] = 1;
                  f[n++] = k2;
                  f[n++] = m;
                  f[n++] = l;
                  f[n++] = 255;
                  f[n++] = 224 | g.length;
                  for (k2 = 0; k2 < g.length; k2++) f[n++] = (g[k2].length & 65280) >> 8, f[n++] = g[k2].length & 255, f.set(g[k2], n), n += g[k2].length;
                  f[n++] = h.length;
                  for (g = 0; g < h.length; g++) f[n++] = (h[g].length & 65280) >> 8, f[n++] = h[g].length & 255, f.set(h[g], n), n += h[g].length;
                  e = e("avcC", f);
                }
                c = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0].concat(y(mj(c, 2)), y(mj(d, 2)), [
                  0,
                  72,
                  0,
                  0,
                  0,
                  72,
                  0,
                  0,
                  0,
                  0,
                  0,
                  0,
                  0,
                  1,
                  19,
                  118,
                  105,
                  100,
                  101,
                  111,
                  106,
                  115,
                  45,
                  99,
                  111,
                  110,
                  116,
                  114,
                  105,
                  98,
                  45,
                  104,
                  108,
                  115,
                  0,
                  0,
                  0,
                  0,
                  0,
                  0,
                  0,
                  0,
                  0,
                  0,
                  0,
                  0,
                  0,
                  24,
                  17,
                  17
                ]));
                d = "avc1";
                h = tj(a);
                g = new Uint8Array([]);
                a.encrypted && (g = uj(0, a.stream, a.codecs), d = "encv");
                d = hj(d, c, e, h, g);
              } else a.codecs.includes("hvc1") && (d = a.stream.width || 0, e = a.stream.height || 0, c = new Uint8Array([]), 0 < a.Ca.byteLength && (c = hj("hvcC", a.Ca)), d = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0].concat(y(mj(d, 2)), y(mj(e, 2)), [
                0,
                72,
                0,
                0,
                0,
                72,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                1,
                19,
                118,
                105,
                100,
                101,
                111,
                106,
                115,
                45,
                99,
                111,
                110,
                116,
                114,
                105,
                98,
                45,
                104,
                108,
                115,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                24,
                17,
                17
              ])), e = "hvc1", h = tj(a), g = new Uint8Array([]), a.encrypted && (g = uj(0, a.stream, a.codecs), e = "encv"), d = hj(e, d, c, h, g));
              break;
            case "audio":
              if ("mp3" == c) a = hj(".mp3", vj(a));
              else if ("ac-3" == c) c = hj("dac3", a.ra), d = "ac-3", e = new Uint8Array([]), a.encrypted && (e = uj(0, a.stream, a.codecs), d = "enca"), a = hj(d, vj(a), c, e);
              else if ("ec-3" == c) c = hj("dec3", a.ra), d = "ec-3", e = new Uint8Array([]), a.encrypted && (e = uj(0, a.stream, a.codecs), d = "enca"), a = hj(d, vj(a), c, e);
              else if ("opus" == c) c = hj("dOps", a.ra), d = "Opus", e = new Uint8Array([]), a.encrypted && (e = uj(0, a.stream, a.codecs), d = "enca"), a = hj(d, vj(a), c, e);
              else {
                if (0 < a.ra.byteLength) c = hj("esds", a.ra);
                else {
                  c = hj;
                  d = a.id + 1;
                  e = a.stream.channelsCount || 2;
                  g = a.stream.audioSamplingRate || 44100;
                  k2 = ad("audio", a.codecs.split(","));
                  l = { 96e3: 0, 88200: 1, 64e3: 2, 48e3: 3, 44100: 4, 32e3: 5, 24e3: 6, 22050: 7, 16e3: 8, 12e3: 9, 11025: 10, 8e3: 11, 7350: 12 };
                  h = l[g];
                  if ("mp4a.40.5" === k2 || "mp4a.40.29" === k2) h = l[2 * g];
                  g = parseInt(
                    k2.split(".").pop(),
                    10
                  );
                  d = new Uint8Array([0, 0, 0, 0, 3, 25].concat(y(mj(d, 2)), [0, 4, 17, 64, 21, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 5, 2, g << 3 | h >>> 1, h << 7 | e << 3, 6, 1, 2]));
                  c = c("esds", d);
                }
                d = "mp4a";
                e = new Uint8Array([]);
                a.encrypted && (e = uj(0, a.stream, a.codecs), d = "enca");
                a = hj(d, vj(a), c, e);
              }
              d = a;
          }
          a = hj("stsd", wj, d);
          return b("stbl", a, hj("stts", xj), hj("stsc", yj), hj("stsz", zj), hj("stco", Aj));
        }
        function tj(a) {
          if (!a.Ia && !a.Ka) return new Uint8Array([]);
          var b = a.Ka;
          a = new Uint8Array([].concat(y(mj(a.Ia, 4)), y(mj(b, 4))));
          return hj("pasp", a);
        }
        function vj(a) {
          return new Uint8Array([0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, a.stream.channelsCount || 2, 0, 16, 0, 0, 0, 0].concat(y(mj(a.stream.audioSamplingRate || 44100, 2)), [0, 0]));
        }
        function uj(a, b, c) {
          a = hj;
          c = new Uint8Array([].concat(y(mj(Bj(c.split(".")[0]), 4))));
          c = hj("frma", c);
          var d = "cenc";
          var e = b.drmInfos[0];
          e && e.encryptionScheme && (d = e.encryptionScheme);
          d = new Uint8Array([0, 0, 0, 0].concat(y(mj(Bj(d), 4)), [0, 1, 0, 0]));
          d = hj("schm", d);
          e = hj;
          var f = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]);
          b = t(b.drmInfos);
          for (var g = b.next(); !g.done; g = b.next()) if ((g = g.value) && g.keyIds && g.keyIds.size) {
            g = t(g.keyIds);
            for (var h = g.next(); !h.done; h = g.next()) f = sj(h.value);
          }
          b = new Uint8Array([
            0,
            0,
            0,
            0,
            0,
            0,
            1,
            8
          ]);
          b = hj("tenc", b, f);
          return a("sinf", c, d, e("schi", b));
        }
        function Cj(a) {
          var b = [];
          a = t(a.g);
          for (var c = a.next(); !c.done; c = a.next()) {
            c = c.value;
            var d = b.push, e = d.apply;
            var f = hj;
            var g = new Uint8Array([0, 0, 0, 0].concat(y(mj(c.data ? c.data.Db : 0, 4))));
            g = hj("mfhd", g);
            var h;
            var k2 = c.data ? c.data.jb : [];
            var l = new Uint8Array(4 + k2.length);
            for (h = 0; h < k2.length; h++) {
              var m = k2[h].flags;
              l[h + 4] = m.Ya << 4 | m.$a << 2 | m.Za;
            }
            k2 = hj("sdtp", l);
            var n = k2.length + 92;
            l = hj;
            h = new Uint8Array([0, 0, 0, 58].concat(y(mj(c.id + 1, 4)), [0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]));
            h = hj("tfhd", h);
            m = c.data ? c.data.baseMediaDecodeTime : 0;
            var p = Math.floor(m % (lj + 1));
            m = new Uint8Array([1, 0, 0, 0].concat(y(mj(Math.floor(m / (lj + 1)), 4)), y(mj(p, 4))));
            m = hj("tfdt", m);
            var q = n;
            n = c.data ? c.data.jb : [];
            p = n.length;
            var u = 12 + 16 * p, w = new Uint8Array(u);
            q += 8 + u;
            w.set(["video" === c.type ? 1 : 0, 0, 15, 1].concat(y(mj(p, 4)), y(mj(q, 4))), 0);
            for (q = 0; q < p; q++) {
              var v = n[q];
              u = mj(v.duration, 4);
              var x = mj(v.size, 4), z = v.flags;
              v = mj(v.eb, 4);
              w.set([].concat(y(u), y(x), [z.hb << 2 | z.Ya, z.$a << 6 | z.Za << 4 | z.ib, z.Xa & 61440, z.Xa & 15], y(v)), 12 + 16 * q);
            }
            n = hj("trun", w);
            k2 = l("traf", h, m, n, k2);
            f = f(
              "moof",
              g,
              k2
            );
            e.call(d, b, [f, Dj(c)]);
          }
          return Wc.apply(Qc, y(b));
        }
        function Dj(a) {
          a = (a.data ? a.data.jb : []).map(function(b) {
            return b.data;
          });
          a = Wc.apply(Qc, y(a));
          return hj("mdat", a);
        }
        function mj(a, b) {
          var c = [];
          for (--b; 0 <= b; b--) c.push(a >> 8 * b & 255);
          return c;
        }
        function sj(a) {
          for (var b = new Uint8Array(a.length / 2), c = 0; c < a.length / 2; c += 1) b[c] = parseInt(String(a[2 * c] + a[2 * c + 1]), 16);
          return b;
        }
        function Bj(a) {
          for (var b = 0, c = 0; c < a.length; c += 1) b |= a.charCodeAt(c) << 8 * (a.length - c - 1);
          return b;
        }
        function hj(a) {
          var b = Na.apply(1, arguments), c = Ej.get(a);
          c || (c = [a.charCodeAt(0), a.charCodeAt(1), a.charCodeAt(2), a.charCodeAt(3)], Ej.set(a, c));
          for (var d = 8, e = b.length - 1; 0 <= e; e--) d += b[e].byteLength;
          e = new Uint8Array(d);
          e[0] = d >> 24 & 255;
          e[1] = d >> 16 & 255;
          e[2] = d >> 8 & 255;
          e[3] = d & 255;
          e.set(c, 4);
          c = 0;
          for (d = 8; c < b.length; c++) e.set(b[c], d), d += b[c].byteLength;
          return e;
        }
        var fj = false, lj = Math.pow(2, 32) - 1, Ej = /* @__PURE__ */ new Map(), nj = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 0, 118, 105, 100, 101, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 86, 105, 100, 101, 111, 72, 97, 110, 100, 108, 101, 114, 0]), oj = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 0, 115, 111, 117, 110, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 83, 111, 117, 110, 100, 72, 97, 110, 100, 108, 101, 114, 0]), xj = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 0]), yj = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 0]), Aj = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 0]), zj = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]), pj = new Uint8Array([0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0]), rj = new Uint8Array([
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0
        ]), wj = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 1]), gj = new Uint8Array([]), ij = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 12, 117, 114, 108, 32, 0, 0, 0, 1]), jj = new Uint8Array([]);
        function Fj(a, b, c) {
          function d(q) {
            n.push({ box: q, hh: 1701733217 });
          }
          function e(q) {
            n.push({ box: q, hh: 1701733238 });
          }
          function f(q) {
            k2 = true;
            q.parser.stop();
          }
          function g(q) {
            m.push(q);
            Kh(q);
          }
          var h = b = Qb(b), k2 = false, l, m = [], n = [];
          new Fh().box("moov", g).box("trak", g).box("mdia", g).box("minf", g).box("stbl", g).R("stsd", function(q) {
            l = q;
            m.push(q);
            Mh(q);
          }).R("encv", f).R("enca", f).R("dvav", e).R("dva1", e).R("dvh1", e).R("dvhe", e).R("dvc1", e).R("dvi1", e).R("hev1", e).R("hvc1", e).R("avc1", e).R("avc3", e).R("ac-3", d).R("ec-3", d).R(
            "ac-4",
            d
          ).R("Opus", d).R("fLaC", d).R("mp4a", d).parse(b);
          if (k2) return b;
          if (0 == n.length || !l) throw ib(Vc(b)), new U(2, 3, 3019, c);
          n.reverse();
          c = t(n);
          for (var p = c.next(); !p.done; p = c.next()) p = p.value, h = Gj(a, h, l, p.box, m, p.hh);
          return ic() && xc() && !jc() ? (a = new Uint8Array(b.byteLength + h.byteLength), a.set(h), a.set(b, h.byteLength), a) : h;
        }
        function Hj(a) {
          a = Qb(a);
          var b = [];
          new Fh().box("mdat", function(g) {
            b.push(g);
          }).parse(a);
          for (var c = [], d = 0; d < b.length; d++) {
            var e = b[d - 1], f = b[d];
            c.push(Ij(a.subarray(e ? e.start + e.size : 0, f.start + f.size)));
          }
          return Wc.apply(Qc, y(c));
        }
        function Ij(a) {
          function b(n) {
            g.push(n);
            Kh(n);
          }
          var c, d, e, f, g = [];
          new Fh().box("moof", b).box("traf", b).R("tfhd", function(n) {
            c = n;
            e = Wi(n.reader, n.flags);
          }).R("trun", function(n) {
            d = n;
            f = Zi(n.reader, n.version, n.flags);
          }).parse(a);
          if (e && 2 !== e.rh) {
            var h = c.start + Lh(c) + 4 + (null !== e.Wh ? 8 : 0), k2 = Vb(a);
            if (null !== e.rh) k2.setUint32(h, 2);
            else {
              Jj(a, c.start, c.size + 4);
              var l = k2.getUint32(c.start + 8);
              k2.setUint32(c.start + 8, l | 2);
              f && null !== f.nf && k2.setInt32(d.start + Lh(d) + 4, f.nf + 4);
              l = a.subarray(0, h);
              k2 = a.subarray(h);
              a = new Uint8Array(a.byteLength + 4);
              a.set(l);
              l = [];
              for (var m = 3; 0 <= m; m--) l.push(2 >> 8 * m & 255);
              a.set(new Uint8Array(l), h);
              a.set(k2, h + 4);
              h = t(g);
              for (k2 = h.next(); !k2.done; k2 = h.next()) k2 = k2.value, Jj(a, k2.start, k2.size + 4);
            }
          }
          return a;
        }
        function Gj(a, b, c, d, e, f) {
          var g = uj(new ej([]), a, d.name), h = b.subarray(d.start, d.start + d.size);
          a = new Uint8Array(d.size + g.byteLength);
          a.set(h, 0);
          Vb(a).setUint32(4, f);
          a.set(g, d.size);
          Jj(a, 0, a.byteLength);
          f = new Uint8Array(b.byteLength + a.byteLength);
          d = rc() || jc() || ic() ? d.start : d.start + d.size;
          g = b.subarray(d);
          f.set(b.subarray(0, d));
          f.set(a, d);
          f.set(g, d + a.byteLength);
          b = t(e);
          for (e = b.next(); !e.done; e = b.next()) e = e.value, Jj(f, e.start, e.size + a.byteLength);
          a = Vb(f, c.start);
          c = Lh(c);
          b = a.getUint32(c);
          a.setUint32(c, b + 1);
          return f;
        }
        function Jj(a, b, c) {
          a = Vb(a, b);
          b = a.getUint32(0);
          0 != b && (1 == b ? (a.setUint32(8, c >> 32), a.setUint32(12, c & 4294967295)) : a.setUint32(0, c));
        }
        function Kj(a) {
          function b(e) {
            d.push({ start: e.start, size: e.size });
            Kh(e);
          }
          var c = Qb(a), d = [];
          new Fh().box("moov", b).box("trak", b).box("mdia", b).box("minf", b).box("stbl", b).box("stsd", function(e) {
            d.push({ start: e.start, size: e.size });
            for (var f = Vb(c, e.start), g = 0; g < e.size - 3; g++) {
              var h = f.getUint32(g);
              1633889587 == h ? f.setUint32(g, 1700998451) : 1684103987 == h && f.setUint32(g, 1684366131);
            }
          }).parse(c);
          return c;
        }
        function Lj(a, b, c, d, e, f, g, h) {
          this.N = a;
          this.Sa = b;
          this.wa = c;
          this.Wc = void 0 === d ? null : d;
          this.timescale = void 0 === e ? null : e;
          this.h = void 0 === f ? null : f;
          this.aesKey = void 0 === g ? null : g;
          this.g = this.mimeType = this.codecs = null;
          this.encrypted = void 0 === h ? false : h;
        }
        Lj.prototype.uc = function() {
          return this.Sa;
        };
        Lj.prototype.tc = function() {
          return this.wa;
        };
        Lj.prototype.Kd = function(a) {
          this.h = a;
        };
        Lj.prototype.Ib = function() {
          return this.h;
        };
        function Mj(a, b) {
          return a === b ? true : a && b ? a.uc() == b.uc() && a.tc() == b.tc() && Ed(a.N().sort(), b.N().sort()) && Pb(a.Ib(), b.Ib()) : a == b;
        }
        T("shaka.media.InitSegmentReference", Lj);
        Lj.prototype.getEndByte = Lj.prototype.tc;
        Lj.prototype.getStartByte = Lj.prototype.uc;
        function Nj(a, b, c, d, e, f, g, h, k2, l, m, n, p, q, u, w) {
          l = void 0 === l ? [] : l;
          q = void 0 === q ? Oj : q;
          this.startTime = a;
          this.j = this.endTime = b;
          this.C = c;
          this.Sa = d;
          this.wa = e;
          this.$ = f;
          this.timestampOffset = g;
          this.appendWindowStart = h;
          this.appendWindowEnd = k2;
          this.g = l;
          this.tilesLayout = void 0 === m ? "" : m;
          this.B = void 0 === n ? null : n;
          this.h = void 0 === p ? null : p;
          this.status = q;
          this.preload = false;
          this.l = true;
          this.m = false;
          this.aesKey = void 0 === u ? null : u;
          this.thumbnailSprite = null;
          this.i = -1;
          this.A = void 0 === w ? false : w;
          this.F = this.o = false;
          a = t(this.g);
          for (b = a.next(); !b.done; b = a.next()) b.value.fh();
          this.A && this.g.length && this.g[this.g.length - 1].eh();
          this.u = this.bandwidth = this.mimeType = this.codecs = null;
          this.G = false;
        }
        r = Nj.prototype;
        r.N = function() {
          return this.C();
        };
        r.getStartTime = function() {
          return this.startTime;
        };
        r.mi = function() {
          return this.endTime;
        };
        r.uc = function() {
          return this.Sa;
        };
        r.tc = function() {
          return this.wa;
        };
        r.Ji = function() {
          return this.tilesLayout;
        };
        r.Ii = function() {
          return this.B;
        };
        r.dc = function() {
          return this.status;
        };
        r.aj = function() {
          this.status = Pj;
        };
        r.Sf = function() {
          this.preload = true;
        };
        r.isPreload = function() {
          return this.preload;
        };
        r.Vc = function() {
          this.l = false;
        };
        r.Ti = function() {
          return this.l;
        };
        r.fh = function() {
          this.o = true;
        };
        r.Vi = function() {
          return this.o;
        };
        r.eh = function() {
          this.F = true;
        };
        r.Ui = function() {
          return this.F;
        };
        r.dh = function() {
          this.m = true;
        };
        r.Pi = function() {
          return this.m;
        };
        r.De = function(a) {
          this.thumbnailSprite = a;
        };
        r.Gi = function() {
          return this.thumbnailSprite;
        };
        r.offset = function(a) {
          this.startTime += a;
          this.endTime += a;
          this.j += a;
          for (var b = t(this.g), c = b.next(); !c.done; c = b.next()) c = c.value, c.startTime += a, c.endTime += a, c.j += a;
        };
        r.qg = function(a) {
          null == this.h ? ab("Sync attempted without sync time!") : (a = this.h - a - this.startTime, 1e-3 <= Math.abs(a) && this.offset(a));
        };
        r.Kd = function(a, b) {
          this.u = a;
          this.G = void 0 === b ? false : b;
        };
        r.Ib = function(a) {
          var b = this.u;
          (void 0 === a || a) && this.G && (this.u = null);
          return b;
        };
        function Qj(a, b) {
          a.$ = b;
          a = t(a.g);
          for (var c = a.next(); !c.done; c = a.next()) Qj(c.value, b);
        }
        T("shaka.media.SegmentReference", Nj);
        Nj.prototype.getSegmentData = Nj.prototype.Ib;
        Nj.prototype.setSegmentData = Nj.prototype.Kd;
        Nj.prototype.syncAgainst = Nj.prototype.qg;
        Nj.prototype.offset = Nj.prototype.offset;
        Nj.prototype.getThumbnailSprite = Nj.prototype.Gi;
        Nj.prototype.setThumbnailSprite = Nj.prototype.De;
        Nj.prototype.hasByterangeOptimization = Nj.prototype.Pi;
        Nj.prototype.markAsByterangeOptimization = Nj.prototype.dh;
        Nj.prototype.isLastPartial = Nj.prototype.Ui;
        Nj.prototype.markAsLastPartial = Nj.prototype.eh;
        Nj.prototype.isPartial = Nj.prototype.Vi;
        Nj.prototype.markAsPartial = Nj.prototype.fh;
        Nj.prototype.isIndependent = Nj.prototype.Ti;
        Nj.prototype.markAsNonIndependent = Nj.prototype.Vc;
        Nj.prototype.isPreload = Nj.prototype.isPreload;
        Nj.prototype.markAsPreload = Nj.prototype.Sf;
        Nj.prototype.markAsUnavailable = Nj.prototype.aj;
        Nj.prototype.getStatus = Nj.prototype.dc;
        Nj.prototype.getTileDuration = Nj.prototype.Ii;
        Nj.prototype.getTilesLayout = Nj.prototype.Ji;
        Nj.prototype.getEndByte = Nj.prototype.tc;
        Nj.prototype.getStartByte = Nj.prototype.uc;
        Nj.prototype.getEndTime = Nj.prototype.mi;
        Nj.prototype.getStartTime = Nj.prototype.getStartTime;
        Nj.prototype.getUris = Nj.prototype.N;
        var Oj = 0, Pj = 1;
        Nj.Status = { Nj: Oj, Lk: Pj, lk: 2 };
        function Rj(a) {
          return 1 == a.length && 1e-4 > a.end(0) - a.start(0);
        }
        function Sj(a) {
          return !a || Rj(a) ? null : a.length ? a.end(a.length - 1) : null;
        }
        function Tj(a, b) {
          return !a || !a.length || Rj(a) || b > a.end(a.length - 1) ? false : b >= a.start(0);
        }
        function Uj(a, b) {
          if (!a || !a.length || Rj(a)) return 0;
          var c = 0;
          a = t(Vj(a));
          for (var d = a.next(); !d.done; d = a.next()) {
            var e = d.value;
            d = e.start;
            e = e.end;
            e > b && (c += e - Math.max(d, b));
          }
          return c;
        }
        function Wj(a, b, c) {
          if (!a || !a.length || Rj(a)) return null;
          a = Vj(a).findIndex(function(d, e, f) {
            return d.start > b && (0 == e || f[e - 1].end - b <= c);
          });
          return 0 <= a ? a : null;
        }
        function Vj(a) {
          if (!a) return [];
          for (var b = [], c = 0; c < a.length; c++) b.push({ start: a.start(c), end: a.end(c) });
          return b;
        }
        function Xj() {
        }
        function Yj(a, b) {
          var c = document.createElement("source");
          c.src = a;
          c.type = void 0 === b ? "" : b;
          return c;
        }
        function Zj(a) {
          for (; a.firstChild; ) a.removeChild(a.firstChild);
        }
        T("shaka.util.Dom", Xj);
        Xj.removeAllChildren = Zj;
        /*
         @license
         Shaka Player
         Copyright 2022 Google LLC
         SPDX-License-Identifier: Apache-2.0
        */
        function ik() {
        }
        function jk(a, b) {
          return b + 10 <= a.length && 73 === a[b] && 68 === a[b + 1] && 51 === a[b + 2] && 255 > a[b + 3] && 255 > a[b + 4] && 128 > a[b + 6] && 128 > a[b + 7] && 128 > a[b + 8] && 128 > a[b + 9] ? true : false;
        }
        function kk(a, b) {
          return b + 10 <= a.length && 51 === a[b] && 68 === a[b + 1] && 73 === a[b + 2] && 255 > a[b + 3] && 255 > a[b + 4] && 128 > a[b + 6] && 128 > a[b + 7] && 128 > a[b + 8] && 128 > a[b + 9] ? true : false;
        }
        function lk(a, b) {
          var c = (a[b] & 127) << 21;
          c |= (a[b + 1] & 127) << 14;
          c |= (a[b + 2] & 127) << 7;
          return c |= a[b + 3] & 127;
        }
        function mk(a) {
          var b = { key: a.type, description: "", data: "", mimeType: null, pictureType: null };
          if ("APIC" === a.type) {
            if (2 > a.size || 3 !== a.data[0]) return null;
            var c = a.data.subarray(1).indexOf(0);
            if (-1 === c) return null;
            var d = Hc(Qb(a.data, 1, c)), e = a.data[2 + c], f = a.data.subarray(3 + c).indexOf(0);
            if (-1 === f) return null;
            var g = Hc(Qb(a.data, 3 + c, f)), h;
            "-->" === d ? h = Hc(Qb(a.data, 4 + c + f)) : h = Sb(a.data.subarray(4 + c + f));
            b.mimeType = d;
            b.pictureType = e;
            b.description = g;
            b.data = h;
            return b;
          }
          if ("TXXX" === a.type) {
            if (2 > a.size || 3 !== a.data[0]) return null;
            d = a.data.subarray(1).indexOf(0);
            if (-1 === d) return null;
            c = Hc(Qb(a.data, 1, d));
            a = Hc(Qb(a.data, 2 + d)).replace(/\0*$/, "");
            b.description = c;
            b.data = a;
            return b;
          }
          if ("WXXX" === a.type) {
            if (2 > a.size || 3 !== a.data[0]) return null;
            d = a.data.subarray(1).indexOf(0);
            if (-1 === d) return null;
            c = Hc(Qb(a.data, 1, d));
            a = Hc(Qb(a.data, 2 + d)).replace(/\0*$/, "");
            b.description = c;
            b.data = a;
            return b;
          }
          if ("PRIV" === a.type) {
            if (2 > a.size) return null;
            c = a.data.indexOf(0);
            if (-1 === c) return null;
            c = Hc(Qb(a.data, 0, c));
            b.description = c;
            "com.apple.streaming.transportStreamTimestamp" == c ? (c = a.data.subarray(c.length + 1), a = c[3] & 1, c = (c[4] << 23) + (c[5] << 15) + (c[6] << 7) + c[7], c /= 45, a && (c += 4772185884e-2), b.data = c) : (a = Sb(a.data.subarray(c.length + 1)), b.data = a);
            return b;
          }
          if ("T" === a.type[0]) {
            if (2 > a.size || 3 !== a.data[0]) return null;
            a = Hc(a.data.subarray(1)).replace(/\0*$/, "");
            b.data = a;
            return b;
          }
          return "W" === a.type[0] ? (a = Hc(a.data).replace(/\0*$/, ""), b.data = a, b) : a.data ? (b.data = Sb(a.data), b) : null;
        }
        function nk(a) {
          for (var b = 0, c = []; jk(a, b); ) {
            var d = lk(a, b + 6);
            a[b + 5] >> 6 & 1 && (b += 10);
            b += 10;
            for (d = b + d; b + 10 < d; ) {
              var e = a.subarray(b), f = lk(e, 4);
              e = { type: String.fromCharCode(e[0], e[1], e[2], e[3]), size: f, data: e.subarray(10, 10 + f) };
              (f = mk(e)) && c.push(f);
              b += e.size + 10;
            }
            kk(a, b) && (b += 10);
          }
          return c;
        }
        function ok(a, b) {
          for (var c = b = void 0 === b ? 0 : b, d = 0; jk(a, b); ) a[b + 5] >> 6 & 1 && (d += 10), d += 10, d += lk(a, b + 6), kk(a, b + 10) && (d += 10), b += d;
          return 0 < d ? a.subarray(c, c + d) : new Uint8Array([]);
        }
        T("shaka.util.Id3Utils", ik);
        ik.getID3Data = ok;
        ik.getID3Frames = nk;
        function pk(a, b) {
          this.j = a;
          if (void 0 === b ? 0 : b) {
            b = new Uint8Array(a.byteLength);
            for (var c = 0, d = 0; d < a.byteLength; d++) 2 <= d && 3 == a[d] && 0 == a[d - 1] && 0 == a[d - 2] || (b[c] = a[d], c++);
            this.j = Qb(b, 0, c);
          }
          this.i = this.j.byteLength;
          this.g = this.h = 0;
        }
        function qk(a) {
          var b = a.j.byteLength - a.i, c = new Uint8Array(4), d = Math.min(4, a.i);
          0 !== d && (c.set(a.j.subarray(b, b + d)), a.h = new Ch(c, 0).S(), a.g = 8 * d, a.i -= d);
        }
        function rk(a, b) {
          if (a.g <= b) {
            b -= a.g;
            var c = Math.floor(b / 8);
            b -= 8 * c;
            a.g -= c;
            qk(a);
          }
          a.h <<= b;
          a.g -= b;
        }
        function sk(a, b) {
          var c = Math.min(a.g, b), d = a.h >>> 32 - c;
          a.g -= c;
          0 < a.g ? a.h <<= c : 0 < a.i && qk(a);
          c = b - c;
          return 0 < c ? d << c | sk(a, c) : d;
        }
        function tk(a) {
          var b;
          for (b = 0; b < a.g; ++b) if (0 !== (a.h & 2147483648 >>> b)) return a.h <<= b, a.g -= b, b;
          qk(a);
          return b + tk(a);
        }
        function uk(a) {
          rk(a, 1 + tk(a));
        }
        function W(a) {
          var b = tk(a);
          return sk(a, b + 1) - 1;
        }
        function vk(a) {
          a = W(a);
          return 1 & a ? 1 + a >>> 1 : -1 * (a >>> 1);
        }
        function wk(a) {
          return 1 === sk(a, 1);
        }
        function xk(a) {
          return sk(a, 8);
        }
        function yk(a, b) {
          for (var c = 8, d = 8, e = 0; e < b; e++) 0 !== d && (d = vk(a), d = (c + d + 256) % 256), c = 0 === d ? c : d;
        }
        function zk(a) {
          xk(a);
          W(a);
          return W(a);
        }
        T("shaka.util.ExpGolomb", pk);
        function Ak() {
          this.G = null;
          this.H = false;
          this.m = this.I = null;
          this.j = [];
          this.g = [];
          this.A = this.B = null;
          this.i = [];
          this.h = [];
          this.C = null;
          this.l = [];
          this.F = this.o = this.u = null;
        }
        r = Ak.prototype;
        r.clearData = function() {
          this.j = [];
          this.g = [];
          this.i = [];
          this.h = [];
          this.l = [];
        };
        r.parse = function(a) {
          if (564 > a.length) return this;
          for (var b = Math.max(0, Bk(a)), c = a.length - (a.length + b) % 188, d = false, e = b; e < c; e += 188) if (71 == a[e]) {
            var f = !!(a[e + 1] & 64), g = ((a[e + 1] & 31) << 8) + a[e + 2];
            if (1 < (a[e + 3] & 48) >> 4) {
              var h = e + 5 + a[e + 4];
              if (h == e + 188) continue;
            } else h = e + 4;
            switch (g) {
              case 0:
                f && (h += a[h] + 1);
                this.G = (a[h + 10] & 31) << 8 | a[h + 11];
                break;
              case 17:
              case 8191:
                break;
              case this.G:
                f && (h += a[h] + 1);
                f = a;
                g = { audio: -1, video: -1, ce: -1, audioCodec: "", videoCodec: "" };
                var k2 = h + 3 + ((f[h + 1] & 15) << 8 | f[h + 2]) - 4;
                for (h += 12 + ((f[h + 10] & 15) << 8 | f[h + 11]); h < k2; ) {
                  var l = (f[h + 1] & 31) << 8 | f[h + 2], m = (f[h + 3] & 15) << 8 | f[h + 4];
                  switch (f[h]) {
                    case 6:
                      if (0 < m) for (var n = h + 5, p = m; 2 < p; ) {
                        var q = f[n + 1] + 2;
                        switch (f[n]) {
                          case 5:
                            var u = Jc(f.subarray(n + 2, n + q));
                            -1 == g.audio && "Opus" === u ? (g.audio = l, g.audioCodec = "opus") : -1 == g.video && "AV01" === u && (g.video = l, g.videoCodec = "av1");
                            break;
                          case 106:
                            -1 == g.audio && (g.audio = l, g.audioCodec = "ac3");
                            break;
                          case 122:
                            -1 == g.audio && (g.audio = l, g.audioCodec = "ec3");
                            break;
                          case 124:
                            -1 == g.audio && (g.audio = l, g.audioCodec = "aac");
                            break;
                          case 127:
                            "opus" == g.audioCodec && (u = null, 128 === f[n + 2] && (u = f[n + 3]), null != u && (this.F = { channelCount: 0 === (u & 15) ? 2 : u & 15, Zh: u, sampleRate: 48e3 }));
                        }
                        n += q;
                        p -= q;
                      }
                      break;
                    case 15:
                      -1 == g.audio && (g.audio = l, g.audioCodec = "aac");
                      break;
                    case 17:
                      -1 == g.audio && (g.audio = l, g.audioCodec = "aac-loas");
                      break;
                    case 21:
                      -1 == g.ce && (g.ce = l);
                      break;
                    case 27:
                      -1 == g.video && (g.video = l, g.videoCodec = "avc");
                      break;
                    case 3:
                    case 4:
                      -1 == g.audio && (g.audio = l, g.audioCodec = "mp3");
                      break;
                    case 36:
                      -1 == g.video && (g.video = l, g.videoCodec = "hvc");
                      break;
                    case 129:
                      -1 == g.audio && (g.audio = l, g.audioCodec = "ac3");
                      break;
                    case 132:
                    case 135:
                      -1 == g.audio && (g.audio = l, g.audioCodec = "ec3");
                  }
                  h += m + 5;
                }
                f = g;
                -1 != f.video && (this.I = f.video, this.m = f.videoCodec);
                -1 != f.audio && (this.B = f.audio, this.A = f.audioCodec);
                -1 != f.ce && (this.C = f.ce);
                d && !this.H && (d = false, e = b - 188);
                this.H = true;
                break;
              case this.I:
                h = a.subarray(h, e + 188);
                f ? this.j.push([h]) : this.j.length && this.j[this.j.length - 1] && this.j[this.j.length - 1].push(h);
                break;
              case this.B:
                h = a.subarray(h, e + 188);
                f ? this.i.push([h]) : this.i.length && this.i[this.i.length - 1] && this.i[this.i.length - 1].push(h);
                break;
              case this.C:
                h = a.subarray(h, e + 188);
                f ? this.l.push([h]) : this.l.length && this.l[this.l.length - 1] && this.l[this.l.length - 1].push(h);
                break;
              default:
                d = true;
            }
          }
          return this;
        };
        function Ck(a, b) {
          if (1 !== (b[0] << 16 | b[1] << 8 | b[2])) return null;
          var c = { data: new Uint8Array(0), packetLength: b[4] << 8 | b[5], pts: null, dts: null, nalus: [] };
          if (c.packetLength && c.packetLength > b.byteLength - 6) return null;
          var d = b[7];
          if (d & 192) {
            var e = 536870912 * (b[9] & 14) + 4194304 * (b[10] & 255) + 16384 * (b[11] & 254) + 128 * (b[12] & 255) + (b[13] & 254) / 2;
            null == a.u && (a.u = e);
            c.pts = Dk(e, a.u);
            a.u = c.pts;
            c.dts = c.pts;
            d & 64 && (d = 536870912 * (b[14] & 14) + 4194304 * (b[15] & 255) + 16384 * (b[16] & 254) + 128 * (b[17] & 255) + (b[18] & 254) / 2, null == a.o && (a.o = d), c.dts = Dk(
              d,
              a.o
            ));
            a.o = c.dts;
          }
          a = b[8] + 9;
          if (b.byteLength <= a) return null;
          c.data = b.subarray(a);
          return c;
        }
        r.hj = function(a) {
          sb("TsParser.parseAvcNalus", "Please use parseNalus function instead.");
          return this.Xf(a, { Dd: null, state: null });
        };
        r.Xf = function(a, b) {
          var c = a.pts ? a.pts / 9e4 : null;
          a = a.data;
          var d = a.byteLength, e = 1;
          "hvc" == this.m && (e = 2);
          var f = b.state || 0, g = f, h = 0, k2 = [], l = -1, m = 0;
          -1 == f && (l = 0, m = "hvc" == this.m ? a[0] >> 1 & 63 : a[0] & 31, f = 0, h = 1);
          for (; h < d; ) {
            var n = a[h++];
            if (f) if (1 === f) f = n ? 0 : 2;
            else if (n) if (1 == n) {
              n = h - f - 1;
              if (0 <= l) k2.push({ data: a.subarray(l + e, n), fullData: a.subarray(l, n), type: m, time: c, state: null });
              else if (f = k2.length ? k2[k2.length - 1] : b.Dd) g && h <= 4 - g && f.state && (f.data = f.data.subarray(0, f.data.byteLength - g), f.fullData = f.fullData.subarray(0, f.fullData.byteLength - g)), 0 < n && (n = a.subarray(0, n), f.data = Wc(f.data, n), f.fullData = Wc(f.fullData, n), f.state = 0);
              h < d ? (m = "hvc" == this.m ? a[h] >> 1 & 63 : a[h] & 31, l = h, f = 0) : f = -1;
            } else f = 0;
            else f = 3;
            else f = n ? 0 : 1;
          }
          0 <= l && 0 <= f && k2.push({ data: a.subarray(l + e, d), fullData: a.subarray(l, d), type: m, time: c, state: f });
          !k2.length && b.Dd && (c = k2.length ? k2[k2.length - 1] : b.Dd) && (c.data = Wc(c.data, a), c.fullData = Wc(c.fullData, a));
          b.state = f;
          return k2;
        };
        r.getMetadata = function() {
          for (var a = [], b = t(this.l), c = b.next(); !c.done; c = b.next()) c = Wc.apply(Qc, y(c.value)), (c = Ck(this, c)) && a.push({ cueTime: c.pts ? c.pts / 9e4 : null, data: c.data, frames: nk(c.data), dts: c.dts, pts: c.pts });
          return a;
        };
        r.fb = function() {
          if (this.i.length && !this.h.length) {
            for (var a = false, b = t(this.i), c = b.next(); !c.done; c = b.next()) {
              var d = Wc.apply(Qc, y(c.value)), e = Ck(this, d);
              c = this.h.length ? this.h[this.h.length - 1] : null;
              e && null != e.pts && null != e.dts && (!c || c.pts != e.pts && c.dts != e.dts) ? (this.h.length && e.dts < (c.dts || 0) && (a = true), this.h.push(e)) : this.h.length && (d = e ? e.data : d) && (c = this.h.pop(), c.data = Wc(c.data, d), this.h.push(c));
            }
            a && (this.h = this.h.sort(function(f, g) {
              var h = (f.pts || 0) - (g.pts || 0);
              return (f.dts || 0) - (g.dts || 0) || h;
            }));
          }
          return this.h;
        };
        r.wc = function(a) {
          a = void 0 === a ? true : a;
          if (this.j.length && !this.g.length) {
            for (var b = false, c = t(this.j), d = c.next(); !d.done; d = c.next()) {
              var e = Wc.apply(Qc, y(d.value)), f = Ck(this, e);
              d = this.g.length ? this.g[this.g.length - 1] : null;
              f && null != f.pts && null != f.dts && (!d || d.pts != f.pts && d.dts != f.dts) ? (this.g.length && f.dts < (d.dts || 0) && (b = true), this.g.push(f)) : this.g.length && (e = f ? f.data : e) && (d = this.g.pop(), d.data = Wc(d.data, e), this.g.push(d));
            }
            if (a) {
              c = { Dd: null, state: null };
              d = [];
              e = t(this.g);
              for (f = e.next(); !f.done; f = e.next()) f = f.value, f.nalus = this.Xf(f, c), f.nalus.length && (d.push(f), c.Dd = f.nalus[f.nalus.length - 1]);
              this.g = d;
            }
            b && (this.g = this.g.sort(function(g, h) {
              var k2 = (g.pts || 0) - (h.pts || 0);
              return (g.dts || 0) - (h.dts || 0) || k2;
            }));
          }
          return a ? this.g : (a = this.g, this.g = [], a);
        };
        r.getStartTime = function(a) {
          if ("audio" == a) {
            a = null;
            var b = this.fb();
            b.length && (a = b[0], a = Math.min(a.dts, a.pts) / 9e4);
            return a;
          }
          return "video" == a ? (a = null, b = this.wc(false), b.length && (a = b[0], a = Math.min(a.dts, a.pts) / 9e4), a) : null;
        };
        r.od = function() {
          return { audio: this.A, video: this.m };
        };
        r.be = function() {
          for (var a = [], b = t(this.wc()), c = b.next(); !c.done; c = b.next()) a.push.apply(a, y(c.value.nalus));
          return a;
        };
        r.Mi = function() {
          sb("TsParser.getVideoResolution", "Please use getVideoInfo function instead.");
          var a = this.Kf();
          return { height: a.height, width: a.width };
        };
        r.Kf = function() {
          return "hvc" == this.m ? Ek(this) : Fk(this);
        };
        function Gk(a) {
          var b = a.wc();
          return 1 < b.length && (a = b[0].pts, b = b[1].pts, !isNaN(b - a)) ? String(1 / (b - a) * 9e4) : null;
        }
        function Fk(a) {
          var b = { height: null, width: null, codec: null, frameRate: null }, c = a.be();
          if (!c.length) return b;
          c = c.find(function(q) {
            return 7 == q.type;
          });
          if (!c) return b;
          c = new pk(c.data);
          var d = xk(c), e = xk(c), f = xk(c);
          uk(c);
          if (Hk.includes(d)) {
            var g = W(c);
            3 === g && rk(c, 1);
            uk(c);
            uk(c);
            rk(c, 1);
            if (wk(c)) {
              g = 3 !== g ? 8 : 12;
              for (var h = 0; h < g; h++) wk(c) && (6 > h ? yk(c, 16) : yk(c, 64));
            }
          }
          uk(c);
          g = W(c);
          if (0 === g) W(c);
          else if (1 === g) for (rk(c, 1), uk(c), uk(c), g = W(c), h = 0; h < g; h++) uk(c);
          uk(c);
          rk(c, 1);
          g = W(c);
          h = W(c);
          var k2 = sk(c, 1);
          0 === k2 && rk(c, 1);
          rk(
            c,
            1
          );
          var l = 0, m = 0, n = 0, p = 0;
          wk(c) && (l = W(c), m = W(c), n = W(c), p = W(c));
          b.height = String((2 - k2) * (h + 1) * 16 - 2 * n - 2 * p);
          b.width = String(16 * (g + 1) - 2 * l - 2 * m);
          b.codec = "avc1." + ("0" + d.toString(16).toUpperCase()).slice(-2) + ("0" + e.toString(16).toUpperCase()).slice(-2) + ("0" + f.toString(16).toUpperCase()).slice(-2);
          b.frameRate = Gk(a);
          return b;
        }
        function Ek(a) {
          var b = { height: null, width: null, codec: null, frameRate: null }, c = a.be();
          if (!c.length) return b;
          c = c.find(function(G) {
            return 33 == G.type;
          });
          if (!c) return b;
          var d = new pk(c.fullData, true);
          xk(d);
          xk(d);
          sk(d, 4);
          var e = sk(d, 3);
          wk(d);
          var f = sk(d, 2), g = sk(d, 1), h = sk(d, 5), k2 = sk(d, 32);
          c = xk(d);
          for (var l = xk(d), m = xk(d), n = xk(d), p = xk(d), q = xk(d), u = xk(d), w = [], v = [], x = 0; x < e; x++) w.push(wk(d)), v.push(wk(d));
          if (0 < e) for (x = e; 8 > x; x++) sk(d, 2);
          for (x = 0; x < e; x++) w[x] && sk(d, 88), v[x] && xk(d);
          W(d);
          e = W(d);
          3 == e && sk(d, 1);
          w = W(d);
          v = W(d);
          var z = x = 0, C = 0, D = 0;
          wk(d) && (x += W(d), z += W(d), C += W(d), D += W(d));
          b.width = String(w - (x + z) * (1 === e || 2 === e ? 2 : 1));
          b.height = String(v - (C + D) * (1 === e ? 2 : 1));
          d = function(G) {
            for (var B = 0, A = 0; 32 > A; A++) B |= (G >> A & 1) << 31 - A;
            return B >>> 0;
          }(k2);
          g = 1 == g ? "H" : "L";
          f = "hvc1" + ("." + ["", "A", "B", "C"][f] + h);
          f += "." + d.toString(16).toUpperCase();
          f += "." + g + u;
          q && (f += "." + q.toString(16).toUpperCase());
          p && (f += "." + p.toString(16).toUpperCase());
          n && (f += "." + n.toString(16).toUpperCase());
          m && (f += "." + m.toString(16).toUpperCase());
          l && (f += "." + l.toString(16).toUpperCase());
          c && (f += "." + c.toString(16).toUpperCase());
          b.codec = f;
          b.frameRate = Gk(a);
          return b;
        }
        function Dk(a, b) {
          var c = 1;
          for (a > b && (c = -1); 4294967296 < Math.abs(b - a); ) a += 8589934592 * c;
          return a;
        }
        function Ik(a) {
          return 0 > Bk(a) ? false : true;
        }
        function Bk(a) {
          for (var b = Math.min(1e3, a.length - 564), c = 0; c < b; ) {
            if (71 == a[c] && 71 == a[c + 188] && 71 == a[c + 376]) return c;
            c++;
          }
          return -1;
        }
        T("shaka.util.TsParser", Ak);
        Ak.syncOffset = Bk;
        Ak.probe = Ik;
        Ak.prototype.getVideoInfo = Ak.prototype.Kf;
        Ak.prototype.getVideoResolution = Ak.prototype.Mi;
        Ak.prototype.getVideoNalus = Ak.prototype.be;
        Ak.prototype.getCodecs = Ak.prototype.od;
        Ak.prototype.getStartTime = Ak.prototype.getStartTime;
        Ak.prototype.getVideoData = Ak.prototype.wc;
        Ak.prototype.getAudioData = Ak.prototype.fb;
        Ak.prototype.getMetadata = Ak.prototype.getMetadata;
        Ak.prototype.parseNalus = Ak.prototype.Xf;
        Ak.prototype.parseAvcNalus = Ak.prototype.hj;
        Ak.prototype.parse = Ak.prototype.parse;
        Ak.prototype.clearData = Ak.prototype.clearData;
        Ak.Timescale = 9e4;
        var Hk = [100, 110, 122, 244, 44, 83, 86, 118, 128, 138, 139, 134];
        function Jk(a, b, c, d) {
          var e = this;
          this.g = a;
          this.K = c;
          this.A = null;
          this.ea = b;
          this.l = /* @__PURE__ */ new Map();
          this.B = /* @__PURE__ */ new Map();
          this.Aa = /* @__PURE__ */ new Map();
          this.h = null;
          this.Ea = false;
          this.I = d || null;
          this.u = /* @__PURE__ */ new Map();
          this.o = new lb();
          this.j = /* @__PURE__ */ new Map();
          this.L = null;
          this.G = new Ug();
          this.Ga = "";
          this.Na = false;
          this.sa = true;
          this.Z = false;
          this.C = this.M = null;
          this.i = Kk(this, this.G);
          this.ya = this.H = false;
          this.O = new th(function() {
            return Lk(e);
          });
          this.F = false;
          this.P = "UNKNOWN";
          this.La = this.Ma = false;
          this.Fa = new Ug();
          this.m = false;
          this.pa = null;
          this.Y = /* @__PURE__ */ new Map();
          this.ka = this.T = this.oa = this.W = null;
          this.fa = new Ug();
          this.g.remote && (this.Z = "disconnected" != this.g.remote.state, this.o.D(this.g.remote, "connect", function() {
            e.Z = "disconnected" != e.g.remote.state;
          }), this.o.D(this.g.remote, "connecting", function() {
            e.Z = "disconnected" != e.g.remote.state;
          }), this.o.D(this.g.remote, "disconnect", function() {
            e.Z = "disconnected" != e.g.remote.state;
          }));
        }
        function Kk(a, b) {
          a.sa = true;
          if (window2.ManagedMediaSource) {
            a.C || (a.g.disableRemotePlayback = true);
            var c = new ManagedMediaSource();
            a.o.D(c, "startstreaming", function() {
              a.sa = true;
            });
            a.o.D(c, "endstreaming", function() {
              a.sa = false;
            });
          } else c = new MediaSource();
          a.o.ma(c, "sourceopen", function() {
            URL.revokeObjectURL(a.Ga);
            b.resolve();
          });
          a.o.ma(a.g, "playing", function() {
            a.Na = true;
          });
          a.Ga = Mk(c);
          a.g.removeAttribute("src");
          a.M && a.g.removeChild(a.M);
          a.C && a.g.removeChild(a.C);
          a.M = Yj(a.Ga);
          a.g.appendChild(a.M);
          a.C && a.g.appendChild(a.C);
          a.g.load();
          return c;
        }
        function Nk(a, b, c) {
          a.g && window2.ManagedMediaSource && a.i && (a.C && a.g.removeChild(a.C), a.C = Yj(b, c), a.g.appendChild(a.C), a.g.disableRemotePlayback = false);
        }
        function Ok(a, b) {
          var c, d, e, f, g, h, k2, l, m, n, p;
          return Q(function(q) {
            if (1 == q.g) return a.createSegmentIndex ? F(q, a.createSegmentIndex(), 2) : q.s(2);
            if (!a.segmentIndex) return q.return(false);
            if (0 == a.segmentIndex.getNumReferences()) return q.return(true);
            c = fd;
            d = /* @__PURE__ */ new Set();
            e = t(a.segmentIndex);
            for (f = e.next(); !f.done; f = e.next()) if (g = f.value, h = g.mimeType || a.mimeType || "", k2 = g.codecs || a.codecs || "", h != a.mimeType || k2 != a.codecs) {
              if (l = h + ":" + k2, !d.has(l)) {
                if (d.add(l), b == c.za) {
                  if (m = lf(h, k2), !Cf(m)) return q.return(false);
                } else if (b == c.la ? k2 = tg(k2) : b == c.V && (k2 = sg(k2, h)), n = pf(a, h, k2), p = nf(h, k2), !md(n) && !ef(p)) return q.return(false);
              }
            }
            return q.return(true);
          });
        }
        function Pk() {
          var a = 'video/mp4; codecs="avc1.42E01E",video/mp4; codecs="avc3.42E01E",video/mp4; codecs="hev1.1.6.L93.90",video/mp4; codecs="hvc1.1.6.L93.90",video/mp4; codecs="hev1.2.4.L153.B0"; eotf="smpte2084",video/mp4; codecs="hvc1.2.4.L153.B0"; eotf="smpte2084",video/mp4; codecs="vp9",video/mp4; codecs="vp09.00.10.08",video/mp4; codecs="av01.0.01M.08",video/mp4; codecs="dvh1.05.01",video/mp4; codecs="dvh1.20.01",audio/mp4; codecs="mp4a.40.2",audio/mp4; codecs="ac-3",audio/mp4; codecs="ec-3",audio/mp4; codecs="ac-4.02.01.01",audio/mp4; codecs="opus",audio/mp4; codecs="flac",audio/mp4; codecs="dtsc",audio/mp4; codecs="dtse",audio/mp4; codecs="dtsx",video/webm; codecs="vp8",video/webm; codecs="vp9",video/webm; codecs="vp09.00.10.08",audio/webm; codecs="vorbis",audio/webm; codecs="opus",video/mp2t; codecs="avc1.42E01E",video/mp2t; codecs="avc3.42E01E",video/mp2t; codecs="hvc1.1.6.L93.90",video/mp2t; codecs="mp4a.40.2",video/mp2t; codecs="ac-3",video/mp2t; codecs="ec-3",text/vtt,application/mp4; codecs="wvtt",application/ttml+xml,application/mp4; codecs="stpp"'.split(",").concat(y(mf)), b = {};
          a = t(a);
          for (var c = a.next(); !c.done; c = a.next()) {
            c = c.value;
            Cf(c) ? b[c] = true : b[c] = fc() ? md(c) || (ef(c) ? true : false) : gc(c);
            var d = c.split(";")[0];
            b[d] = b[d] || b[c];
          }
          return b;
        }
        r = Jk.prototype;
        r.destroy = function() {
          return this.O.destroy();
        };
        function Lk(a) {
          var b, c, d, e, f, g, h, k2, l, m, n, p, q, u, w;
          return Q(function(v) {
            if (1 == v.g) {
              b = [];
              c = t(a.u);
              for (d = c.next(); !d.done; d = c.next()) for (e = d.value, f = t(e), g = f.next().value, h = f.next().value, k2 = h[0], l = g, a.u.set(l, h.slice(0, 1)), k2 && b.push(k2.p.catch(Jf)), m = t(h.slice(1)), n = m.next(); !n.done; n = m.next()) p = n.value, p.p.reject(new U(2, 7, 7003, void 0));
              a.h && b.push(a.h.destroy());
              return F(v, Promise.all(b), 2);
            }
            q = t(a.j.values());
            for (u = q.next(); !u.done; u = q.next()) w = u.value, w.destroy();
            a.o && (a.o.release(), a.o = null);
            a.g && a.C && a.g.removeChild(a.C);
            a.g && a.M && (a.g.removeChild(a.M), a.g.load(), a.g.disableRemotePlayback = false);
            a.g = null;
            a.M = null;
            a.C = null;
            a.A = null;
            a.i = null;
            a.h = null;
            a.ea = null;
            a.l.clear();
            a.Aa.clear();
            a.j.clear();
            a.L = null;
            a.u.clear();
            a.I = null;
            a.Y.clear();
            a.K = null;
            I(v);
          });
        }
        r.init = function(a, b, c, d) {
          b = void 0 === b ? false : b;
          c = void 0 === c ? "UNKNOWN" : c;
          d = void 0 === d ? false : d;
          var e = this, f, g, h, k2, l, m;
          return Q(function(n) {
            switch (n.g) {
              case 1:
                return f = fd, F(n, e.G, 2);
              case 2:
                if (!Qk(e) && !Rk(e)) {
                  n.s(3);
                  break;
                }
                ab("Expected MediaSource to be open during init(); reopening the media source.");
                e.G = new Ug();
                e.i = Kk(e, e.G);
                return F(n, e.G, 3);
              case 3:
                e.F = b, e.P = c, e.Ma = d, e.La = !e.F && "HLS" == e.P && !e.Ma, e.Y.clear(), e.W = null, e.oa = null, e.T = null, e.ka = null, e.fa = new Ug(), g = t(a.keys()), h = g.next();
              case 5:
                if (h.done) {
                  n.s(7);
                  break;
                }
                k2 = h.value;
                l = a.get(k2);
                return F(n, Sk(e, k2, l, l.codecs), 8);
              case 8:
                e.m ? (e.u.set(f.V, []), e.u.set(f.la, [])) : e.u.set(k2, []);
                h = g.next();
                n.s(5);
                break;
              case 7:
                (m = a.get(f.V)) && m.isAudioMuxedInVideo && (e.m = true), I(n);
            }
          });
        };
        function Sk(a, b, c, d) {
          var e, f, g, h, k2, l, m, n, p, q, u, w;
          return Q(function(v) {
            switch (v.g) {
              case 1:
                return e = fd, f = Va, g = Wa, F(v, Ok(c, b), 2);
              case 2:
                g.call(f, v.h, "Type negotiation should happen before MediaSourceEngine.init!");
                b == e.V && d && (d = sg(d, c.mimeType));
                h = lf(c.mimeType, d);
                if (b == e.za) {
                  Tk(a, h, a.F, c.external);
                  v.s(0);
                  break;
                }
                k2 = a.A.forceTransmux;
                if (!md(h) || !a.F && mf.includes(h)) k2 = true;
                l = nf(c.mimeType, d);
                if (!k2) {
                  v.s(4);
                  break;
                }
                m = bd(e.V, (d || "").split(","));
                n = bd(e.la, (d || "").split(","));
                if (!m || !n) {
                  v.s(5);
                  break;
                }
                a.m = true;
                return F(
                  v,
                  Sk(a, e.V, c, m),
                  6
                );
              case 6:
                return F(v, Sk(a, e.la, c, n), 7);
              case 7:
                return v.return();
              case 5:
                if (p = ef(l)) q = p(), a.j.set(b, q), h = q.convertCodecs(b, l);
              case 4:
                u = h + a.A.addExtraFeaturesToSourceBuffer(h);
                uh(a.O);
                try {
                  w = a.i.addSourceBuffer(u);
                } catch (x) {
                  throw new U(2, 3, 3015, x, "The mediaSource_ status was " + a.i.readyState + " expected 'open'", null);
                }
                a.F && (w.mode = Uk);
                a.o.D(w, "error", function() {
                  var x = a.u.get(b)[0];
                  x.p.reject(new U(2, 3, 3014, a.g.error ? a.g.error.code : 0, x.uri));
                });
                a.o.D(w, "updateend", function() {
                  return Vk(a, b);
                });
                a.l.set(b, w);
                a.B.set(b, h);
                a.Aa.set(b, !!c.drmInfos.length);
                I(v);
            }
          });
        }
        r.configure = function(a) {
          this.A = a;
          this.h && (this.h.A = a.modifyCueCallback);
        };
        function Wk(a) {
          return a.sa && !a.Z && !a.H;
        }
        function Tk(a, b, c, d) {
          a.h || (a.h = new yf(a.ea), a.h && (a.h.A = a.A.modifyCueCallback));
          var e = a.h;
          d = d || a.Ea;
          a = a.P;
          "application/cea-608" == b || "application/cea-708" == b ? e.i = null : (e.i = Af.get(b)(), e.i.setSequenceMode ? e.i.setSequenceMode(c) : sb("Text parsers w/ setSequenceMode", 'Text parsers should have a "setSequenceMode" method!'), e.i.setManifestType ? e.i.setManifestType(a) : sb("Text parsers w/ setManifestType", 'Text parsers should have a "setManifestType" method!'), e.B = d);
        }
        function Qk(a) {
          return a.H ? false : a.i ? "ended" == a.i.readyState : true;
        }
        function Rk(a) {
          return a.H ? false : a.i ? "closed" == a.i.readyState : true;
        }
        function Xk(a, b) {
          a.l.size ? b == dd ? a = a.h.g : (a = Yk(a, b), a = !a || Rj(a) ? null : 1 == a.length && 0 > a.start(0) ? 0 : a.length ? a.start(0) : null) : a = null;
          return a;
        }
        function Zk(a, b) {
          return a.l.size ? b == dd ? a.h.h : Sj(Yk(a, b)) : null;
        }
        function $k(a, b, c) {
          if (b == dd) return a = a.h, null == a.h || a.h < c ? 0 : a.h - Math.max(c, a.g);
          a = Yk(a, b);
          return Uj(a, c);
        }
        r.Fb = function() {
          var a = { total: this.H ? [] : Vj(this.g.buffered), audio: Vj(Yk(this, "audio")), video: Vj(Yk(this, "video")), text: [] };
          if (this.h) {
            var b = this.h.g, c = this.h.h;
            null != b && null != c && a.text.push({ start: b, end: c });
          }
          return a;
        };
        function Yk(a, b) {
          if (a.H || a.Z) return null;
          try {
            return a.l.get(b).buffered;
          } catch (c) {
            return a.l.has(b), null;
          }
        }
        function al(a, b, c, d, e, f) {
          var g = null, h = [], k2 = Qb(c);
          if (mf.includes(f)) b = nk(k2), b.length && d && ((c = b.find(function(q) {
            return "com.apple.streaming.transportStreamTimestamp" === q.description;
          })) && (g = Math.round(c.data) / 1e3), a.K.onMetadata([{ cueTime: d.startTime, data: k2, frames: b, dts: d.startTime, pts: d.startTime }], 0, d.endTime));
          else if (f.includes("/mp4") && d && d.$ && d.$.timescale) {
            var l = d.$.timescale;
            if (!isNaN(l)) {
              var m = null != e.emsgSchemeIdUris && 0 < e.emsgSchemeIdUris.length || a.A.dispatchAllEmsgBoxes, n = 0, p = false;
              k2 = new Fh();
              m && k2.R("emsg", function(q) {
                var u = e.emsgSchemeIdUris;
                if (0 === q.version) {
                  var w = q.reader.Cc();
                  var v = q.reader.Cc();
                  var x = q.reader.S();
                  var z = q.reader.S();
                  var C = q.reader.S();
                  var D = q.reader.S();
                  var G = d.startTime + z / x;
                } else x = q.reader.S(), G = q.reader.bd() / x + d.timestampOffset, z = G - d.startTime, C = q.reader.S(), D = q.reader.S(), w = q.reader.Cc(), v = q.reader.Cc();
                q = q.reader.Cb(q.reader.getLength() - q.reader.Ba());
                if (u && u.includes(w) || a.A.dispatchAllEmsgBoxes) {
                  if ("urn:mpeg:dash:event:2012" == w) a.K.gj();
                  else if (u = G + C / x, x = {
                    startTime: G,
                    endTime: u,
                    schemeIdUri: w,
                    value: v,
                    timescale: x,
                    presentationTimeDelta: z,
                    eventDuration: C,
                    id: D,
                    messageData: q
                  }, D = (/* @__PURE__ */ new Map()).set("detail", x), new V("emsg", D).cancelable = true, a.K.ej(x), "https://aomedia.org/emsg/ID3" == w || "https://developer.apple.com/streaming/emsg-id3" == w) {
                    if (w = nk(q), w.length) a.K.onMetadata([{ cueTime: G, data: q, frames: w, dts: G, pts: G }], 0, u);
                  }
                }
              });
              k2.R("prft", function(q) {
                var u = q.reader, w = q.version;
                u.S();
                q = u.S();
                var v = u.S();
                q = 1e3 * q + v / Math.pow(2, 32) * 1e3;
                0 === w ? u = u.S() : (w = u.S(), u = u.S(), u = w * Math.pow(2, 32) + u);
                q = new Date(new Date(Date.UTC(1900, 0, 1, 0, 0, 0)).getTime() + q).getTime();
                u = (/* @__PURE__ */ new Map()).set("detail", { wallClockTime: q, programStartDate: new Date(q - u / l * 1e3) });
                u = new V("prft", u);
                a.K.onEvent(u);
              }).box("moof", Kh).box("traf", Kh).R("tfdt", function(q) {
                p || (n = Xi(q.reader, q.version).baseMediaDecodeTime / l, p = true, m || q.parser.stop());
              }).parse(c, true);
              p && 0 == d.timestampOffset && (g = n);
            }
          } else f.includes("/mp4") || f.includes("/webm") || !Ik(k2) || (a.Y.has(b) ? a.Y.get(b).clearData() : a.Y.set(b, new Ak()), h = a.Y.get(b).parse(k2), k2 = h.getStartTime(b), null != k2 && (g = k2), h = h.getMetadata());
          return { timestamp: g, metadata: h };
        }
        function bl(a, b, c, d, e, f, g, h, k2, l) {
          g = void 0 === g ? false : g;
          h = void 0 === h ? false : h;
          k2 = void 0 === k2 ? false : k2;
          l = void 0 === l ? false : l;
          var m, n, p, q, u, w, v, x, z, C, D, G, B, H, E, K, M;
          return Q(function(J) {
            switch (J.g) {
              case 1:
                m = fd;
                if (b != m.za) {
                  J.s(2);
                  break;
                }
                if ("HLS" != a.P) {
                  J.s(3);
                  break;
                }
                return F(J, a.Fa, 4);
              case 4:
                n = J.h, a.h.u = n;
              case 3:
                return F(J, Df(a.h, c, d ? d.startTime : null, d ? d.endTime : null, d ? d.N()[0] : null), 5);
              case 5:
                return J.return();
              case 2:
                if (l || !a.m) {
                  J.s(6);
                  break;
                }
                return F(J, bl(a, m.V, c, d, e, f, g, h, k2, true), 7);
              case 7:
                return F(J, bl(
                  a,
                  m.la,
                  c,
                  d,
                  e,
                  f,
                  g,
                  h,
                  k2,
                  true
                ), 8);
              case 8:
                return J.return();
              case 6:
                if (!a.l.has(b)) return J.return();
                p = a.l.get(b).timestampOffset;
                q = a.B.get(b);
                a.j.has(b) && (q = a.j.get(b).getOriginalMimeType());
                if (d && (u = al(a, b, c, d, e, q), w = u.timestamp, v = u.metadata, null != w && (null == a.W && b == m.la && (a.W = w, a.oa = d.startTime, null != a.T && (x = 0, a.oa == a.ka && (x = a.W - a.T), a.fa.resolve(x))), null == a.T && b == m.V && (a.T = w, a.ka = d.startTime, null != a.W && (z = 0, a.oa == a.ka && (z = a.W - a.T), a.fa.resolve(z))), C = w, D = mf, !a.F && D.includes(a.B.get(b)) && (C = 0), G = d.startTime - C, B = Math.abs(p - G), (1e-3 <= B || g || h) && (!k2 || 0 < G || !p) && (p = G, a.La && (cl(a, b, function() {
                  return dl(a, b);
                }, null), cl(a, b, function() {
                  return el(a, b, p);
                }, null))), (b == m.la || !a.l.has(m.la)) && a.Fa.resolve(p)), v.length)) a.K.onMetadata(v, p, d ? d.endTime : null);
                f && b == m.la && (a.h || Tk(a, "application/cea-608", a.F, false), a.L || (H = q.split(";", 1)[0], a.L = new td(H)), d ? (E = a.L.i(c), E.length && Hf(a.h, E, d.startTime, d.endTime, p)) : a.L.init(c, h));
                if (!a.j.has(b)) {
                  J.s(9);
                  break;
                }
                return F(J, a.j.get(b).transmux(c, e, d, a.i.duration, b), 10);
              case 10:
                c = J.h;
              case 9:
                c = fl(a, e, c, d, b);
                if (!d || !a.F || b == m.za) {
                  J.s(11);
                  break;
                }
                if (!g && !h) {
                  J.s(11);
                  break;
                }
                K = d.startTime;
                if ("HLS" != a.P || a.m || b != m.V || !a.l.has(m.la)) {
                  J.s(13);
                  break;
                }
                return F(J, a.fa, 14);
              case 14:
                M = J.h, 0.15 < Math.abs(M) && (K -= M);
              case 13:
                cl(a, b, function() {
                  return dl(a, b);
                }, null), cl(a, b, function() {
                  return el(a, b, K);
                }, null);
              case 11:
                return F(J, cl(a, b, function() {
                  var L = c;
                  a.I && jd(a.I, L, p, e);
                  a.l.get(b).appendBuffer(L);
                }, d ? d.N()[0] : null), 15);
              case 15:
                I(J);
            }
          });
        }
        function gl(a, b) {
          var c = Zk(a, "video") || 0;
          Ff(a.h, b, c);
        }
        function hl(a) {
          a.h && Ff(a.h, "", 0);
        }
        r.remove = function(a, b, c) {
          var d = this, e;
          return Q(function(f) {
            return 1 == f.g ? (e = fd, a == e.za ? F(f, d.h.remove(b, c), 0) : c > b ? F(f, cl(d, a, function() {
              return il(d, a, b, c);
            }, null), 5) : f.s(0)) : d.m ? F(f, cl(d, e.V, function() {
              return il(d, e.V, b, c);
            }, null), 0) : f.s(0);
          });
        };
        function jl(a, b) {
          var c;
          return Q(function(d) {
            return 1 == d.g ? (c = fd, b == c.za ? a.h ? F(d, a.h.remove(0, Infinity), 0) : d.return() : F(d, cl(a, b, function() {
              return il(a, b, 0, a.i.duration);
            }, null), 4)) : a.m ? F(d, cl(a, c.V, function() {
              return il(a, c.V, 0, a.i.duration);
            }, null), 0) : d.s(0);
          });
        }
        r.flush = function(a) {
          var b = this, c;
          return Q(function(d) {
            return 1 == d.g ? (c = fd, a == c.za ? d.return() : F(d, cl(b, a, function() {
              b.g.currentTime -= 1e-3;
              Vk(b, a);
            }, null), 2)) : b.m ? F(d, cl(b, c.V, function() {
              var e = c.V;
              b.g.currentTime -= 1e-3;
              Vk(b, e);
            }, null), 0) : d.s(0);
          });
        };
        function kl(a, b, c, d, e, f, g, h, k2) {
          var l, m, n;
          return Q(function(p) {
            if (1 == p.g) {
              l = fd;
              if (b == l.za) return f || (a.h.u = c), Ef(a.h, d, e), p.return();
              m = [];
              return F(p, ll(a, b, g, h, k2), 2);
            }
            n = p.h;
            n || (m.push(cl(a, b, function() {
              return dl(a, b);
            }, null)), a.m && m.push(cl(a, l.V, function() {
              return dl(a, l.V);
            }, null)));
            f || (m.push(cl(a, b, function() {
              return el(a, b, c);
            }, null)), a.m && m.push(cl(a, l.V, function() {
              return el(a, l.V, c);
            }, null)));
            if (0 != d || Infinity != e) m.push(cl(a, b, function() {
              var q = a.l.get(b);
              q.appendWindowStart = 0;
              q.appendWindowEnd = e;
              q.appendWindowStart = d;
              Vk(a, b);
            }, null)), a.m && m.push(cl(a, l.V, function() {
              var q = l.V, u = a.l.get(q);
              u.appendWindowStart = 0;
              u.appendWindowEnd = e;
              u.appendWindowStart = d;
              Vk(a, q);
            }, null));
            return m.length ? F(p, Promise.all(m), 0) : p.s(0);
          });
        }
        function ml(a, b, c) {
          var d, e;
          return Q(function(f) {
            if (1 == f.g) {
              d = fd;
              if (b == d.za) return f.return();
              b == d.la && (a.Fa = new Ug());
              if (!a.F || (e = Zk(a, b)) && 0.1 > Math.abs(e - c)) return f.return();
              cl(a, b, function() {
                return dl(a, b);
              }, null);
              a.m && cl(a, d.V, function() {
                return dl(a, d.V);
              }, null);
              return F(f, cl(a, b, function() {
                return el(a, b, c);
              }, null), 2);
            }
            return a.m ? F(f, cl(a, d.V, function() {
              return el(a, d.V, c);
            }, null), 0) : f.s(0);
          });
        }
        r.endOfStream = function(a) {
          var b = this;
          return Q(function(c) {
            return F(c, nl(b, function() {
              Qk(b) || Rk(b) || (a ? b.i.endOfStream(a) : b.i.endOfStream());
            }), 0);
          });
        };
        r.bb = function(a) {
          var b = this;
          return Q(function(c) {
            return F(c, nl(b, function() {
              if (a < b.i.duration) for (var d = t(b.l.keys()), e = d.next(); !e.done; e = d.next()) {
                e = e.value;
                var f = { start: function() {
                }, p: new Ug(), uri: null };
                b.u.get(e).unshift(f);
              }
              b.i.duration = a;
              b.pa = a;
            }), 0);
          });
        };
        r.getDuration = function() {
          return this.i.duration;
        };
        function ol(a, b, c) {
          Q(function(d) {
            return Qk(a) || Rk(a) ? d.return() : F(d, nl(a, function() {
              Qk(a) || Rk(a) || a.i.setLiveSeekableRange(b, c);
            }), 0);
          });
        }
        function pl(a) {
          Q(function(b) {
            return Qk(a) || Rk(a) ? b.return() : F(b, nl(a, function() {
              Qk(a) || Rk(a) || a.i.clearLiveSeekableRange();
            }), 0);
          });
        }
        function il(a, b, c, d) {
          d <= c ? Vk(a, b) : a.l.get(b).remove(c, d);
        }
        function dl(a, b) {
          var c = a.l.get(b), d = c.appendWindowStart, e = c.appendWindowEnd;
          c.abort();
          c.appendWindowStart = d;
          c.appendWindowEnd = e;
          Vk(a, b);
        }
        function el(a, b, c) {
          0 > c && (c += 1e-3);
          var d = true;
          "HLS" == a.P && (d = Zk(a, b), d = !d || 0.15 < Math.abs(d - c) ? true : false);
          d && (a.l.get(b).timestampOffset = c);
          Vk(a, b);
        }
        function Vk(a, b) {
          if (!a.H) {
            var c = a.u.get(b)[0];
            c && (c.p.resolve(), ql(a, b));
          }
        }
        function cl(a, b, c, d) {
          uh(a.O);
          c = { start: c, p: new Ug(), uri: d };
          a.u.get(b).push(c);
          1 == a.u.get(b).length && rl(a, b);
          return c.p;
        }
        function nl(a, b) {
          var c, d, e, f, g, h, k2, l, m, n, p, q, u;
          return Q(function(w) {
            switch (w.g) {
              case 1:
                uh(a.O);
                c = [];
                d = Array.from(a.l.keys());
                e = t(d);
                f = e.next();
                for (g = {}; !f.done; g = { ready: void 0 }, f = e.next()) h = f.value, g.ready = new Ug(), k2 = { start: /* @__PURE__ */ function(v) {
                  return function() {
                    return v.ready.resolve();
                  };
                }(g), p: g.ready, uri: null }, l = a.u.get(h), l.push(k2), c.push(g.ready), 1 == l.length && k2.start();
                xa(w, 2);
                return F(w, Promise.all(c), 4);
              case 4:
                Aa(w, 3);
                break;
              case 2:
                throw m = Ba(w), m;
              case 3:
                return xa(w, 5, 6), F(w, b(), 6);
              case 6:
                Da(w);
                n = t(d);
                for (p = n.next(); !p.done; p = n.next()) q = p.value, ql(a, q);
                Ea(w, 0);
                break;
              case 5:
                throw u = Ba(w), new U(2, 3, 3015, u, a.g.error || "No error in the media element", null);
            }
          });
        }
        function ql(a, b) {
          a.u.get(b).shift();
          rl(a, b);
        }
        function rl(a, b) {
          var c = a.u.get(b)[0];
          if (c) try {
            c.start();
          } catch (d) {
            "QuotaExceededError" == d.name ? c.p.reject(new U(2, 3, 3017, b)) : Wk(a) ? c.p.reject(new U(2, 3, 3015, d, a.g.error || "No error in the media element", c.uri)) : c.p.reject(new U(2, 3, 3024, b)), ql(a, b);
          }
        }
        function fl(a, b, c, d, e) {
          if ("mp4" != rf(a.B.get(e))) return c;
          var f = null === d, g = a.Aa.get(e), h = a.K.si(), k2 = false;
          d && d.$ && (k2 = d.$.encrypted);
          d = d ? d.N()[0] : null;
          if (a = a.A.insertFakeEncryptionInInit && g) h = $b(h), a = rc() && "audio" === e || lc() || jc() || kc("SOPOpenBrowser") || ic() && xc() && h;
          if (a) if (f) c = Fj(b, c, d);
          else {
            if (b = !k2) b = rc() && "audio" === e;
            b && (c = Hj(c));
          }
          f && mc() && (c = Kj(c));
          return c;
        }
        function sl(a, b, c, d) {
          return cl(a, b, function() {
            if (b !== dd) {
              a.B.get(b);
              if (od()) {
                a.j.has(b) && (a.j.get(b).destroy(), a.j.delete(b));
                d && a.j.set(b, d);
                var e = c + a.A.addExtraFeaturesToSourceBuffer(c);
                a.l.get(b).changeType(e);
                a.B.set(b, c);
              }
              Vk(a, b);
            }
          }, null);
        }
        function tl(a, b) {
          var c, d, e, f, g, h, k2, l, m, n, p, q, u, w, v, x, z, C, D, G;
          return Q(function(B) {
            switch (B.g) {
              case 1:
                if (a.H) return B.return();
                c = fd;
                a.H = true;
                a.m = false;
                d = a.g.currentTime;
                e = a.g.autoplay;
                a.g.paused || (a.ya = true);
                a.Na && (a.g.autoplay = false);
                za(B, 2);
                a.o.Qa();
                f = t(a.j.values());
                for (g = f.next(); !g.done; g = f.next()) h = g.value, h.destroy();
                k2 = t(a.l.values());
                for (l = k2.next(); !l.done; l = k2.next()) {
                  m = l.value;
                  try {
                    a.i.removeSourceBuffer(m);
                  } catch (A) {
                  }
                }
                a.j.clear();
                a.l.clear();
                n = a.i.duration;
                a.G = new Ug();
                a.i = Kk(a, a.G);
                return F(B, a.G, 4);
              case 4:
                !isNaN(n) && n ? a.i.duration = n : !isNaN(a.pa) && a.pa && (a.i.duration = a.pa), p = new Ug(), q = a.i.sourceBuffers, u = b.size, w = 0, v = function() {
                  w++;
                  w === u && (p.resolve(), a.o.Ja(q, "addsourcebuffer", v));
                }, a.o.D(q, "addsourcebuffer", v), x = t(b.keys()), z = x.next();
              case 5:
                if (z.done) return (G = b.get(c.V)) && G.isAudioMuxedInVideo && (a.m = true), a.m && !a.u.has(c.V) && a.u.set(c.V, []), a.g.currentTime = d, F(B, p, 2);
                C = z.value;
                D = b.get(C);
                return F(B, Sk(a, C, D, D.codecs), 6);
              case 6:
                z = x.next();
                B.s(5);
                break;
              case 2:
                Da(B), a.H = false, uh(a.O), a.o.ma(
                  a.g,
                  "canplaythrough",
                  function() {
                    a.O.g || (a.g.autoplay = e, a.ya && (a.ya = false, a.g.play()));
                  }
                ), Ea(B, 0);
            }
          });
        }
        function ul(a, b) {
          return nl(a, function() {
            return tl(a, b);
          });
        }
        function vl(a, b, c, d) {
          var e = false, f = bd("audio", (d || "").split(",")), g = bd("video", (d || "").split(",")), h = g;
          "audio" == b && (h = f);
          h || (h = d);
          d = lf(c, h);
          var k2 = a.A.forceTransmux;
          if (!md(d) || !a.F && mf.includes(d)) k2 = true;
          if (k2 && (a = nf(c, h), c = ef(a))) {
            var l = c();
            f && g && (e = true);
            d = l.convertCodecs(b, a);
          }
          b = sf(wf(d));
          return { ug: l, Fj: e, Eg: vf(d), codec: b, mimeType: d };
        }
        function ll(a, b, c, d, e) {
          var f, g, h, k2, l, m, n, p, q, u, w, v, x, z;
          return Q(function(C) {
            if (1 == C.g) {
              f = fd;
              if (b == f.za) return C.return(false);
              g = sf(wf(a.B.get(b)));
              h = vf(a.B.get(b));
              k2 = vl(a, b, c, d);
              l = k2.ug;
              m = k2.Fj;
              n = k2.Eg;
              p = k2.codec;
              q = k2.mimeType;
              u = true;
              m && a.B.has(f.V) && (w = vl(a, f.V, c, d), v = sf(wf(a.B.get(f.V))), x = vf(a.B.get(f.V)), u = v == w.codec && x == w.Eg, w.ug && w.ug.destroy());
              if (g === p && h === n && u) return a.j.has(b) && !l ? (a.j.get(b).destroy(), a.j.delete(b)) : !a.j.has(b) && l ? a.j.set(b, l) : l && (a.j.has(b) && a.j.get(b).transmux != l.transmux ? (a.j.get(b).destroy(), a.j.delete(b), a.j.set(b, l)) : l.destroy()), C.return(false);
              z = true;
              if (a.m || m && l && !a.j.has(b)) z = false;
              if (z && "smooth" === a.A.codecSwitchingStrategy && od()) return F(C, sl(a, b, q, l), 3);
              l && l.destroy();
              return F(C, ul(a, e), 3);
            }
            return C.return(true);
          });
        }
        function wl(a, b, c, d) {
          if (b == dd) var e = false;
          else {
            e = sf(wf(a.B.get(b)));
            var f = vf(a.B.get(b)), g = lf(c, d), h = a.A.forceTransmux;
            if (!md(g) || !a.F && mf.includes(g)) h = true;
            c = nf(c, d);
            h && (h = ef(c)) && (h = h(), g = h.convertCodecs(b, c), h.destroy());
            b = sf(wf(g));
            g = vf(g);
            e = e !== b || f !== g;
          }
          return e ? "smooth" !== a.A.codecSwitchingStrategy || !od() || a.m : false;
        }
        var Mk = window2.URL.createObjectURL, Uk = "sequence";
        function xl(a, b, c) {
          this.i = a;
          this.C = b;
          this.o = this.l = Infinity;
          this.h = 1;
          this.g = this.j = null;
          this.A = 0;
          this.B = true;
          this.I = false;
          this.H = 0;
          this.F = void 0 === c ? true : c;
          this.G = 0;
          this.u = false;
          this.m = a;
        }
        r = xl.prototype;
        r.getDuration = function() {
          return this.l;
        };
        r.vi = function() {
          return this.h;
        };
        r.yh = function(a) {
          this.i = a;
        };
        r.bb = function(a) {
          this.l = a;
        };
        r.Bi = function() {
          return this.i;
        };
        r.wh = function(a) {
          this.A = a;
        };
        r.Gc = function(a) {
          a && !this.B && (this.I = true);
          this.B = a;
        };
        r.Ce = function(a) {
          this.o = a;
        };
        r.ae = function() {
          return this.o;
        };
        r.jg = function(a) {
          this.C = a;
        };
        r.li = function() {
          return this.C;
        };
        r.kh = function(a, b) {
          if (0 != a.length) {
            var c = (Date.now() + this.A) / 1e3;
            a = a.filter(function(e) {
              return e.start + b < c;
            });
            if (0 != a.length) {
              var d = a[a.length - 1].end + b;
              this.ne(a[0].start + b);
              this.h = a.reduce(function(e, f) {
                return Math.max(e, f.end - f.start);
              }, this.h);
              this.g = Math.max(this.g, d);
              null != this.i && this.F && !this.u && (this.i = c - this.g - this.h);
            }
          }
        };
        r.Ed = function(a) {
          if (0 != a.length) {
            var b = a[0].startTime, c = a[0].endTime, d = (Date.now() + this.A) / 1e3;
            a = t(a);
            for (var e = a.next(); !e.done; e = a.next()) e = e.value, d < e.startTime || (b = Math.min(b, e.startTime), c = Math.max(c, e.endTime), this.h = Math.max(this.h, e.endTime - e.startTime));
            this.ne(b);
            this.g = Math.max(this.g, c);
            null != this.i && this.F && !this.u && (this.i = d - this.g - this.h);
          }
        };
        r.jh = function(a, b) {
          this.ne(a);
          Infinity == b || this.U() || (this.g = Math.max(this.g, b));
        };
        r.wi = function() {
          return this.g;
        };
        r.ie = function() {
          this.u = true;
        };
        r.Wi = function() {
          return this.u;
        };
        r.xh = function(a) {
          this.m = a;
        };
        r.ri = function() {
          return this.m;
        };
        r.ne = function(a) {
          null == this.j ? this.j = a : this.I || (this.j = Math.min(this.j, a));
        };
        r.Tf = function(a) {
          this.h = Math.max(this.h, a);
        };
        r.offset = function(a) {
          null != this.j && (this.j += a);
          null != this.g && (this.g += a);
        };
        r.U = function() {
          return Infinity == this.l && !this.B;
        };
        r.yc = function() {
          return Infinity != this.l && !this.B;
        };
        r.pb = function() {
          return Math.max(this.H, this.cc() - this.o);
        };
        r.Bh = function(a) {
          this.H = a;
        };
        r.cc = function() {
          return this.U() || this.yc() ? Math.min(Math.max(0, (Date.now() + this.A) / 1e3 - this.h - this.i) + this.G, this.l) : this.g ? Math.min(this.g, this.l) : this.l;
        };
        r.qd = function(a) {
          var b = Math.max(this.j, this.H);
          return Infinity == this.o ? Math.ceil(1e3 * b) / 1e3 : Math.max(b, Math.min(this.cc() - this.o + a, this.ob()));
        };
        r.Hb = function() {
          return this.qd(0);
        };
        r.ob = function() {
          return Math.max(0, this.cc() - (this.U() || this.yc() ? this.C : 0));
        };
        r.Kh = function() {
          return null == this.i || null != this.g && this.F ? false : true;
        };
        r.vh = function(a) {
          this.G = a;
        };
        r.ii = function() {
          return this.G;
        };
        T("shaka.media.PresentationTimeline", xl);
        xl.prototype.getAvailabilityTimeOffset = xl.prototype.ii;
        xl.prototype.setAvailabilityTimeOffset = xl.prototype.vh;
        xl.prototype.usingPresentationStartTime = xl.prototype.Kh;
        xl.prototype.getSeekRangeEnd = xl.prototype.ob;
        xl.prototype.getSeekRangeStart = xl.prototype.Hb;
        xl.prototype.getSafeSeekRangeStart = xl.prototype.qd;
        xl.prototype.getSegmentAvailabilityEnd = xl.prototype.cc;
        xl.prototype.setUserSeekStart = xl.prototype.Bh;
        xl.prototype.getSegmentAvailabilityStart = xl.prototype.pb;
        xl.prototype.isInProgress = xl.prototype.yc;
        xl.prototype.isLive = xl.prototype.U;
        xl.prototype.offset = xl.prototype.offset;
        xl.prototype.notifyMaxSegmentDuration = xl.prototype.Tf;
        xl.prototype.notifyMinSegmentStartTime = xl.prototype.ne;
        xl.prototype.getInitialProgramDateTime = xl.prototype.ri;
        xl.prototype.setInitialProgramDateTime = xl.prototype.xh;
        xl.prototype.isStartTimeLocked = xl.prototype.Wi;
        xl.prototype.lockStartTime = xl.prototype.ie;
        xl.prototype.getMaxSegmentEndTime = xl.prototype.wi;
        xl.prototype.notifyPeriodDuration = xl.prototype.jh;
        xl.prototype.notifySegments = xl.prototype.Ed;
        xl.prototype.notifyTimeRange = xl.prototype.kh;
        xl.prototype.getDelay = xl.prototype.li;
        xl.prototype.setDelay = xl.prototype.jg;
        xl.prototype.getSegmentAvailabilityDuration = xl.prototype.ae;
        xl.prototype.setSegmentAvailabilityDuration = xl.prototype.Ce;
        xl.prototype.setStatic = xl.prototype.Gc;
        xl.prototype.setClockOffset = xl.prototype.wh;
        xl.prototype.getPresentationStartTime = xl.prototype.Bi;
        xl.prototype.setDuration = xl.prototype.bb;
        xl.prototype.setPresentationStartTime = xl.prototype.yh;
        xl.prototype.getMaxSegmentDuration = xl.prototype.vi;
        xl.prototype.getDuration = xl.prototype.getDuration;
        function yl(a, b, c, d) {
          var e = this;
          this.u = d;
          this.g = a;
          this.B = b;
          this.h = c;
          this.o = new lb();
          this.l = false;
          this.F = a.readyState;
          this.G = this.C = this.j = 0;
          this.m = zl(this);
          this.A = false;
          this.o.D(a, "waiting", function() {
            return Al(e);
          });
          this.i = new ec(function() {
            Al(e);
          }).ua(this.h.gapJumpTimerTime);
        }
        yl.prototype.release = function() {
          this.o && (this.o.release(), this.o = null);
          null != this.i && (this.i.stop(), this.i = null);
          this.m && (this.m.release(), this.m = null);
          this.g = this.B = this.u = null;
        };
        yl.prototype.qe = function() {
          this.A = true;
          this.i && this.i.ua(this.h.gapJumpTimerTime);
          Al(this);
        };
        function Al(a) {
          if (0 != a.g.readyState) {
            if (a.g.seeking) {
              if (!a.l) return;
            } else a.l = false;
            if (!a.g.paused || a.g.currentTime == a.j && (a.g.autoplay || a.g.currentTime != a.j)) {
              a.g.readyState != a.F && (a.F = a.g.readyState);
              var b;
              if (!(b = !a.m)) {
                b = a.m;
                var c = b.j, d = Bl(c), e = c.g.currentTime, f = Date.now() / 1e3;
                if (b.g != e || b.m != d) b.l = f, b.g = e, b.m = d, b.h = false;
                e = f - b.l;
                if (d = e >= b.o && d && !b.h) b.i && b.i(b.g, e), b.h = true, b.g = c.g.currentTime;
                b = !d;
              }
              b && (b = a.g.currentTime, c = a.g.buffered, d = Wj(c, b, a.h.gapDetectionThreshold), null == d || 0 == d && !a.A || (e = c.start(d), (f = a.h.gapPadding) && (e = Math.ceil(100 * (e + f)) / 100), e >= a.B.ob() || 1e-3 > e - b || (0 != d && c.end(d - 1), a.g.currentTime = e, b == a.j && (a.j = e), a.C++, a.u(new V("gapjumped")))));
            }
          }
        }
        function zl(a) {
          if (!a.h.stallEnabled) return null;
          var b = a.h.stallSkip;
          return new Cl(new Dl(a.g), a.h.stallThreshold, function() {
            var c;
            return Q(function(d) {
              if (1 == d.g) return c = Vj(a.g.buffered), c.length ? b ? (a.g.currentTime += b, d.s(2)) : F(d, a.g.play(), 3) : d.return();
              if (2 != d.g) {
                if (!a.g) return d.return();
                a.g.pause();
                a.g.play();
              }
              a.G++;
              a.u(new V("stalldetected"));
              I(d);
            });
          });
        }
        function Cl(a, b, c) {
          this.j = a;
          this.m = Bl(a);
          this.g = a.g.currentTime;
          this.l = Date.now() / 1e3;
          this.h = false;
          this.o = b;
          this.i = c;
        }
        Cl.prototype.release = function() {
          this.i = this.j = null;
        };
        function Dl(a) {
          this.g = a;
        }
        function Bl(a) {
          if (a.g.paused || 0 == a.g.playbackRate || 0 == a.g.buffered.length) var b = false;
          else a: {
            b = a.g.currentTime;
            a = t(Vj(a.g.buffered));
            for (var c = a.next(); !c.done; c = a.next()) if (c = c.value, !(b < c.start - 0.1 || b > c.end - 0.5)) {
              b = true;
              break a;
            }
            b = false;
          }
          return b;
        }
        function El(a, b, c, d) {
          b == HTMLMediaElement.HAVE_NOTHING || a.readyState >= b ? d() : (b = Fl.value().get(b), c.ma(a, b, d));
        }
        var Fl = new Xb(function() {
          return /* @__PURE__ */ new Map([[HTMLMediaElement.HAVE_METADATA, "loadedmetadata"], [HTMLMediaElement.HAVE_CURRENT_DATA, "loadeddata"], [HTMLMediaElement.HAVE_FUTURE_DATA, "canplay"], [HTMLMediaElement.HAVE_ENOUGH_DATA, "canplaythrough"]]);
        });
        function Gl(a, b, c, d) {
          var e = this;
          this.g = a;
          this.m = b;
          this.u = c;
          this.l = null;
          this.j = function() {
            null == e.l && (e.l = d());
            return e.l;
          };
          this.o = false;
          this.h = new lb();
          this.i = new Hl(a);
          El(this.g, HTMLMediaElement.HAVE_METADATA, this.h, function() {
            Il(e, e.j());
          });
        }
        Gl.prototype.release = function() {
          this.h && (this.h.release(), this.h = null);
          null != this.i && (this.i.release(), this.i = null);
          this.m = function() {
          };
          this.g = null;
        };
        function Jl(a) {
          return a.o ? a.g.currentTime : a.j();
        }
        function Kl(a, b) {
          0 < a.g.readyState ? Ll(a.i, b) : El(a.g, HTMLMediaElement.HAVE_METADATA, a.h, function() {
            Il(a, a.j());
          });
        }
        function Il(a, b) {
          1e-3 > Math.abs(a.g.currentTime - b) ? Ml(a) : (a.h.ma(a.g, "seeking", function() {
            Ml(a);
          }), Ll(a.i, a.g.currentTime && 0 != a.g.currentTime ? a.g.currentTime : b));
        }
        function Ml(a) {
          a.o = true;
          a.h.D(a.g, "seeking", function() {
            return a.m();
          });
          a.u(a.g.currentTime);
        }
        function Hl(a) {
          var b = this;
          this.g = a;
          this.m = 10;
          this.j = this.l = this.i = 0;
          this.h = new ec(function() {
            0 >= b.i ? b.h.stop() : b.g.currentTime != b.l || b.g.currentTime === b.j ? b.h.stop() : (b.g.currentTime = b.j, b.i--);
          });
        }
        Hl.prototype.release = function() {
          this.h && (this.h.stop(), this.h = null);
          this.g = null;
        };
        function Ll(a, b) {
          a.l = a.g.currentTime;
          a.j = b;
          a.i = a.m;
          a.g.currentTime = b;
          a.h.ua(0.1);
        }
        function Nl(a) {
          this.h = a;
          this.j = false;
          this.g = null;
          this.i = new lb();
        }
        r = Nl.prototype;
        r.ready = function() {
          function a() {
            if (null == b.g || 0 == b.g && Infinity != b.h.duration) b.j = true;
            else {
              var c = b.h.currentTime, d = b.g;
              0 > b.g && (d = Math.max(0, c + b.g));
              c != d ? (b.i.ma(b.h, "seeking", function() {
                b.j = true;
              }), b.h.currentTime = d) : b.j = true;
            }
          }
          var b = this;
          El(this.h, HTMLMediaElement.HAVE_CURRENT_DATA, this.i, function() {
            a();
          });
        };
        r.release = function() {
          this.i && (this.i.release(), this.i = null);
          this.h = null;
        };
        r.af = function(a) {
          this.g = this.j ? this.g : a;
        };
        r.Od = function() {
          return (this.j ? this.h.currentTime : this.g) || 0;
        };
        r.Ag = function() {
          return 0;
        };
        r.zg = function() {
          return 0;
        };
        r.ih = function() {
        };
        function Ol(a, b, c, d, e, f) {
          var g = this;
          this.i = a;
          this.g = b.presentationTimeline;
          this.l = c;
          this.u = e;
          this.o = null;
          this.j = new yl(a, b.presentationTimeline, c, f);
          this.h = new Gl(a, function() {
            a: {
              var h = g.j;
              h.l = true;
              h.A = false;
              h.i && h.i.ua(h.h.gapJumpTimerTime);
              Al(h);
              var k2 = Jl(g.h);
              h = Pl(g, k2);
              if (!pd() && 1e-3 < Math.abs(h - k2)) {
                k2 = false;
                if (!qc() || qc() && yc()) k2 = true;
                else {
                  var l = Date.now() / 1e3, m = qc() && zc() ? 3 : 1;
                  if (!g.o || g.o < l - m) g.o = l, k2 = true;
                }
                if (k2) {
                  Kl(g.h, h);
                  h = void 0;
                  break a;
                }
              }
              g.u();
              h = void 0;
            }
            return h;
          }, function(h) {
            var k2 = g.j;
            k2.g.seeking && !k2.l && (k2.l = true, k2.j = h);
            k2.i && k2.i.ua(k2.h.gapJumpTimerTime);
            Al(k2);
          }, function() {
            var h = d;
            null == h ? h = Infinity > g.g.getDuration() ? g.g.Hb() : g.g.ob() : 0 > h && (h = g.g.ob() + h);
            return Ql(g, Rl(g, h));
          });
          this.m = new ec(function() {
            if (0 != g.i.readyState && !g.i.paused) {
              var h = Jl(g.h), k2 = g.g.Hb(), l = g.g.ob();
              3 > l - k2 && (k2 = l - 3);
              h < k2 && (h = Pl(g, h), g.i.currentTime = h);
            }
          });
        }
        r = Ol.prototype;
        r.ready = function() {
          this.m.ua(0.25);
        };
        r.release = function() {
          this.h && (this.h.release(), this.h = null);
          this.j && (this.j.release(), this.j = null);
          this.m && (this.m.stop(), this.m = null);
          this.i = this.h = this.g = this.l = null;
          this.u = function() {
          };
        };
        r.af = function(a) {
          Kl(this.h, a);
        };
        r.Od = function() {
          var a = Jl(this.h);
          return 0 < this.i.readyState && !this.i.paused ? Rl(this, a) : a;
        };
        r.Ag = function() {
          return this.j.G;
        };
        r.zg = function() {
          return this.j.C;
        };
        r.ih = function() {
          this.j.qe();
        };
        function Ql(a, b) {
          var c = a.g.getDuration();
          return b >= c ? c - a.l.durationBackoff : b;
        }
        function Pl(a, b) {
          var c = a.l.rebufferingGoal, d = a.l.safeSeekOffset, e = a.g.Hb(), f = a.g.ob(), g = a.g.getDuration();
          3 > f - e && (e = f - 3);
          var h = a.g.qd(c), k2 = a.g.qd(d);
          c = a.g.qd(c + d);
          return b >= g ? Ql(a, b) : b > f ? f - a.l.safeSeekEndOffset : b < e ? Tj(a.i.buffered, k2) ? k2 : c : b >= h || Tj(a.i.buffered, b) ? b : c;
        }
        function Rl(a, b) {
          var c = a.g.Hb();
          if (b < c) return c;
          a = a.g.ob();
          return b > a ? a : b;
        }
        function Sl(a) {
          this.g = a;
          this.m = null;
          this.i = 0;
          this.o = false;
        }
        r = Sl.prototype;
        r.getNumReferences = function() {
          return this.g.length;
        };
        r.getNumEvicted = function() {
          return this.i;
        };
        r.release = function() {
          this.o || (this.g = [], this.m && this.m.stop(), this.m = null);
        };
        r.bj = function() {
          this.o = true;
        };
        r.Eb = function(a) {
          for (var b = t(this.g), c = b.next(); !c.done; c = b.next()) a(c.value);
        };
        function Ag(a) {
          return a.g[0] || null;
        }
        r.find = function(a) {
          for (var b = this.g.length - 1, c = b; 0 <= c; --c) {
            var d = this.g[c], e = c < b ? this.g[c + 1].startTime : d.endTime;
            if (a >= d.startTime && a < e) return c + this.i;
          }
          return this.g.length && a < this.g[0].startTime ? this.i : null;
        };
        r.get = function(a) {
          if (0 == this.g.length) return null;
          a -= this.i;
          return 0 > a || a >= this.g.length ? null : this.g[a];
        };
        r.offset = function(a) {
          if (!this.o) for (var b = t(this.g), c = b.next(); !c.done; c = b.next()) c.value.offset(a);
        };
        r.ke = function(a) {
          if (!this.o && a.length) {
            var b = Math.round(1e3 * a[0].startTime) / 1e3;
            this.g = this.g.filter(function(c) {
              return Math.round(1e3 * c.startTime) / 1e3 < b;
            });
            this.g.push.apply(this.g, y(a));
          }
        };
        r.Bd = function(a, b) {
          var c = this;
          a = a.filter(function(d) {
            return d.endTime > b && (0 == c.g.length || d.endTime > c.g[0].startTime);
          });
          this.ke(a);
          this.Oa(b);
        };
        r.Oa = function(a) {
          if (!this.o) {
            var b = this.g.length;
            this.g = this.g.filter(function(c) {
              return c.endTime > a;
            });
            this.i += b - this.g.length;
          }
        };
        r.Oc = function(a, b, c) {
          c = void 0 === c ? false : c;
          if (!this.o) {
            for (; this.g.length; ) if (this.g[this.g.length - 1].startTime >= b) this.g.pop();
            else break;
            for (; this.g.length; ) if (this.g[0].endTime <= a) this.g.shift(), c || this.i++;
            else break;
            0 != this.g.length && (a = this.g[this.g.length - 1], b = new Nj(a.startTime, b, a.C, a.Sa, a.wa, a.$, a.timestampOffset, a.appendWindowStart, a.appendWindowEnd, a.g, a.tilesLayout, a.B, a.h, a.status, a.aesKey), b.mimeType = a.mimeType, b.codecs = a.codecs, b.i = a.i, this.g[this.g.length - 1] = b);
          }
        };
        r.Ie = function(a, b) {
          var c = this;
          this.o || (this.m && this.m.stop(), this.m = new ec(function() {
            var d = b();
            d ? c.g.push.apply(c.g, y(d)) : (c.m.stop(), c.m = null);
          }), this.m.ua(a));
        };
        Sl.prototype[Symbol.iterator] = function() {
          return this.Gb(0);
        };
        Sl.prototype.Gb = function(a, b, c) {
          b = void 0 === b ? false : b;
          c = void 0 === c ? false : c;
          var d = this.find(a);
          if (null == d) return null;
          var e = this.get(d);
          c ? d++ : d--;
          var f = -1;
          if (e && 0 < e.g.length) for (var g = e.g.length - 1; 0 <= g; --g) {
            var h = e.g[g];
            if (a >= h.startTime && a < h.endTime) {
              if (!b) {
                for (; g && !h.l; ) g--, h = e.g[g];
                if (!h.l) return ab("No independent partial segment found!"), null;
              }
              c ? d-- : d++;
              f = g - 1;
              break;
            }
          }
          return new Tl(this, d, f, c);
        };
        function Ul(a, b, c) {
          a = new Nj(a, a + b, function() {
            return c;
          }, 0, null, null, a, a, a + b);
          return new Sl([a]);
        }
        T("shaka.media.SegmentIndex", Sl);
        Sl.forSingleSegment = Ul;
        Sl.prototype.getIteratorForTime = Sl.prototype.Gb;
        Sl.prototype.updateEvery = Sl.prototype.Ie;
        Sl.prototype.fit = Sl.prototype.Oc;
        Sl.prototype.evict = Sl.prototype.Oa;
        Sl.prototype.mergeAndEvict = Sl.prototype.Bd;
        Sl.prototype.offset = Sl.prototype.offset;
        Sl.prototype.get = Sl.prototype.get;
        Sl.prototype.find = Sl.prototype.find;
        Sl.prototype.markImmutable = Sl.prototype.bj;
        Sl.prototype.release = Sl.prototype.release;
        Sl.prototype.getNumEvicted = Sl.prototype.getNumEvicted;
        Sl.prototype.getNumReferences = Sl.prototype.getNumReferences;
        function Tl(a, b, c, d) {
          this.i = a;
          this.h = b;
          this.g = c;
          this.reverse = d;
        }
        r = Tl.prototype;
        r.ed = function(a) {
          this.reverse = a;
        };
        r.di = function() {
          return this.h;
        };
        r.current = function() {
          var a = this.i.get(this.h);
          a && 0 < a.g.length && a.A && this.g >= a.g.length && (this.h++, this.g = 0, a = this.i.get(this.h));
          return a && 0 < a.g.length ? a.g[this.g] : a;
        };
        r.next = function() {
          var a = this.i.get(this.h);
          this.reverse ? a && 0 < a.g.length ? (this.g--, 0 > this.g && (this.h--, this.g = (a = this.i.get(this.h)) && 0 < a.g.length ? a.g.length - 1 : 0)) : (this.h--, this.g = 0) : a && 0 < a.g.length ? (this.g++, a.A && this.g == a.g.length && (this.h++, this.g = 0)) : (this.h++, this.g = 0);
          a = this.current();
          return { value: a, done: !a };
        };
        r.dg = function() {
          var a = this.current();
          if (a.o && !a.l && (a = this.i.get(this.h)) && 0 < a.g.length) for (var b = a.g[this.g]; b.l && !(0 >= this.g); ) this.g--, b = a.g[this.g];
        };
        T("shaka.media.SegmentIterator", Tl);
        Tl.prototype.resetToLastIndependent = Tl.prototype.dg;
        Tl.prototype.next = Tl.prototype.next;
        Tl.prototype.current = Tl.prototype.current;
        Tl.prototype.currentPosition = Tl.prototype.di;
        Tl.prototype.setReverse = Tl.prototype.ed;
        function Vl() {
          Sl.call(this, []);
          this.h = [];
        }
        qa(Vl, Sl);
        r = Vl.prototype;
        r.clone = function() {
          var a = new Vl();
          a.h = this.h.slice();
          a.i = this.i;
          return a;
        };
        r.release = function() {
          for (var a = t(this.h), b = a.next(); !b.done; b = a.next()) b.value.release();
          this.h = [];
        };
        r.Eb = function(a) {
          for (var b = t(this.h), c = b.next(); !c.done; c = b.next()) c.value.Eb(a);
        };
        r.find = function(a) {
          for (var b = this.i, c = t(this.h), d = c.next(); !d.done; d = c.next()) {
            d = d.value;
            var e = d.find(a);
            if (null != e) return e + b;
            b += d.getNumEvicted() + d.getNumReferences();
          }
          return null;
        };
        r.get = function(a) {
          for (var b = this.i, c = t(this.h), d = c.next(); !d.done; d = c.next()) {
            d = d.value;
            var e = d.get(a - b);
            if (e) return e;
            e = d.getNumReferences();
            b += d.getNumEvicted() + e;
          }
          return null;
        };
        r.offset = function() {
        };
        r.ke = function() {
        };
        r.Oa = function(a) {
          for (var b = t(this.h), c = b.next(); !c.done; c = b.next()) c.value.Oa(a);
          for (; 1 < this.h.length && 0 == this.h[0].getNumReferences(); ) a = this.h.shift(), this.i += a.getNumEvicted(), a.release();
        };
        r.Bd = function() {
        };
        r.Oc = function() {
        };
        r.Ie = function() {
        };
        T("shaka.media.MetaSegmentIndex", Vl);
        Vl.prototype.updateEvery = Vl.prototype.Ie;
        Vl.prototype.fit = Vl.prototype.Oc;
        Vl.prototype.mergeAndEvict = Vl.prototype.Bd;
        Vl.prototype.evict = Vl.prototype.Oa;
        Vl.prototype.merge = Vl.prototype.ke;
        Vl.prototype.offset = Vl.prototype.offset;
        Vl.prototype.get = Vl.prototype.get;
        Vl.prototype.find = Vl.prototype.find;
        Vl.prototype.forEachTopLevelReference = Vl.prototype.Eb;
        Vl.prototype.release = Vl.prototype.release;
        function Wl(a) {
          var b = this;
          this.g = a;
          this.j = false;
          this.i = this.g.$d();
          this.h = new ec(function() {
            b.g.gh(0.25 * b.i);
          });
        }
        Wl.prototype.release = function() {
          this.set(this.sc());
          this.h && (this.h.stop(), this.h = null);
          this.g = null;
        };
        Wl.prototype.set = function(a) {
          this.i = a;
          Xl(this);
        };
        Wl.prototype.sc = function() {
          return this.g.sc();
        };
        function Xl(a) {
          a.h.stop();
          var b = a.j ? 0 : a.i;
          if (0 <= b) try {
            a.g.$d() != b && a.g.mg(b);
            return;
          } catch (c) {
          }
          a.h.ua(0.25);
          0 != a.g.$d() && a.g.mg(0);
        }
        function Yl(a) {
          var b = this;
          this.j = a;
          this.h = new lb();
          this.g = /* @__PURE__ */ new Set();
          this.i = new ec(function() {
            Zl(b, false);
          }).sb();
          a.paused || this.i.ua(0.25);
          this.h.D(a, "playing", function() {
            b.i.sb().ua(0.25);
          });
          this.h.D(a, "pause", function() {
            b.i.stop();
          });
        }
        Yl.prototype.release = function() {
          this.h && (this.h.release(), this.h = null);
          this.i.stop();
          for (var a = t(this.g), b = a.next(); !b.done; b = a.next()) b.value.release();
          this.g.clear();
        };
        function Zl(a, b) {
          var c = a.j.currentTime;
          a = t(a.g);
          for (var d = a.next(); !d.done; d = a.next()) d.value.j(c, b);
        }
        function $l(a) {
          dh.call(this);
          this.g = /* @__PURE__ */ new Map();
          this.h = a;
        }
        qa($l, dh);
        $l.prototype.release = function() {
          this.g.clear();
          dh.prototype.release.call(this);
        };
        function am(a, b) {
          var c = a.g.get(b);
          c || (c = { Jd: [], mf: null, contentType: b }, a.g.set(b, c));
          return c;
        }
        function bm(a, b, c) {
          var d = am(a, b.contentType);
          cm(a, d);
          a = { Wc: b, position: c };
          d = d.Jd;
          b = d.findIndex(function(e) {
            return e.position >= c;
          });
          0 <= b ? d.splice(b, d[b].position == c ? 1 : 0, a) : d.push(a);
        }
        $l.prototype.j = function(a) {
          for (var b = t(this.g.values()), c = b.next(); !c.done; c = b.next()) {
            c = c.value;
            var d = c.mf;
            a: {
              var e = c.Jd;
              for (var f = e.length - 1; 0 <= f; f--) {
                var g = e[f];
                if (g.position <= a) {
                  e = g.Wc;
                  break a;
                }
              }
              e = null;
            }
            f = e && !(d === e || d && e && d.bandwidth == e.bandwidth && d.audioSamplingRate == e.audioSamplingRate && d.codecs == e.codecs && d.contentType == e.contentType && d.frameRate == e.frameRate && d.height == e.height && d.mimeType == e.mimeType && d.channelsCount == e.channelsCount && d.pixelAspectRatio == e.pixelAspectRatio && d.width == e.width);
            g = e && d && e.label && d.label && d.label !== e.label;
            var h = e && d && e.language && d.language && d.language !== e.language;
            d = e && d && e.roles && d.roles && !Ed(d.roles, e.roles);
            (g || h || d) && dm(this, a, e.contentType) && (c.mf = e, d = new V("audiotrackchange", /* @__PURE__ */ new Map([["quality", e], ["position", a]])), this.dispatchEvent(d));
            f && dm(this, a, e.contentType) && (c.mf = e, JSON.stringify(e), c = new V("qualitychange", /* @__PURE__ */ new Map([["quality", e], ["position", a]])), this.dispatchEvent(c));
          }
        };
        function dm(a, b, c) {
          return (a = a.h()[c]) && 0 < a.length && (c = a[a.length - 1].end, b >= a[0].start && b < c) ? true : false;
        }
        function cm(a, b) {
          if ((a = a.h()[b.contentType]) && 0 < a.length) {
            var c = a[0].start, d = a[a.length - 1].end, e = b.Jd;
            b.Jd = e.filter(function(f, g) {
              return f.position <= c && g + 1 < e.length && e[g + 1].position <= c || f.position >= d ? false : true;
            });
          } else b.Jd = [];
        }
        function em(a) {
          var b = { bandwidth: a.bandwidth || 0, audioSamplingRate: null, codecs: a.codecs, contentType: a.type, frameRate: null, height: null, mimeType: a.mimeType, channelsCount: null, pixelAspectRatio: null, width: null, label: null, roles: a.roles, language: null };
          "video" == a.type && (b.frameRate = a.frameRate || null, b.height = a.height || null, b.pixelAspectRatio = a.pixelAspectRatio || null, b.width = a.width || null);
          "audio" == a.type && (b.audioSamplingRate = a.audioSamplingRate, b.channelsCount = a.channelsCount, b.label = a.label || null, b.language = a.language);
          return b;
        }
        function fm(a) {
          dh.call(this);
          this.h = /* @__PURE__ */ new Map();
          this.i = a;
          this.g = null;
        }
        qa(fm, dh);
        fm.prototype.release = function() {
          this.h.clear();
          this.g && (this.g.stop(), this.g = null);
          dh.prototype.release.call(this);
        };
        function gm(a, b) {
          var c = b.schemeIdUri + "_" + b.id + "_" + (b.startTime.toFixed(1) + "_" + b.endTime.toFixed(1));
          a.h.has(c) || (a.h.set(c, b), b = new V("regionadd", /* @__PURE__ */ new Map([["region", b]])), a.dispatchEvent(b), hm(a));
        }
        function hm(a) {
          a.g || (a.g = new ec(function() {
            for (var b = a.i(), c = t(a.h), d = c.next(); !d.done; d = c.next()) {
              var e = t(d.value);
              d = e.next().value;
              e = e.next().value;
              e.endTime < b.start && (a.h.delete(d), d = new V("regionremove", /* @__PURE__ */ new Map([["region", e]])), a.dispatchEvent(d));
            }
            !a.h.size && a.g && (a.g.stop(), a.g = null);
          }).ua(2));
        }
        function im(a, b, c, d) {
          this.m = a;
          this.i = b;
          this.l = c;
          this.h = /* @__PURE__ */ new Map();
          this.j = /* @__PURE__ */ new Map();
          this.g = null;
          this.o = d;
        }
        function jm(a, b) {
          a.l = b;
          a = t(a.h.values());
          for (var c = a.next(); !c.done; c = a.next()) c.value.g = b;
        }
        function km(a, b, c) {
          c = void 0 === c ? false : c;
          if (!a.i.segmentIndex) return Promise.resolve();
          a.g || (a.g = a.i.segmentIndex.Gb(b, true, a.o));
          if (!a.g) return Promise.resolve();
          c && a.g.next();
          for (b = []; a.h.size < a.m; ) {
            c = a.g.next().value;
            if (!c) break;
            var d = true;
            c.isPreload() && null != c.wa && (d = false);
            2 == c.dc() && (d = false);
            c.Ib(false) && (d = false);
            d && c.$ && b.push(lm(a, c.$));
            d && !a.h.has(c) && (d = new mm(a.l), b.push(nm(d, c, a.i)), a.h.set(c, d));
          }
          om(a);
          return Promise.all(b);
        }
        function lm(a, b) {
          if (!a.i.segmentIndex || b.Ib() || Array.from(a.j.keys()).some(function(e) {
            return Mj(e, b);
          })) return Promise.resolve();
          var c = new mm(a.l), d = nm(c, b, a.i);
          a.j.set(b, c);
          return d;
        }
        function pm(a, b) {
          b = t(b.keys());
          for (var c = b.next(); !c.done; c = b.next()) (c = c.value) && qm(a, c);
        }
        function rm(a) {
          pm(a, a.h);
          pm(a, a.j);
          a.g = null;
        }
        im.prototype.Oa = function(a, b) {
          b = void 0 === b ? false : b;
          for (var c = t(this.h.keys()), d = c.next(); !d.done; d = c.next()) d = d.value, a > d.endTime && qm(this, d);
          b && om(this);
        };
        im.prototype.ed = function(a) {
          this.o = a;
          this.g && this.g.ed(a);
        };
        function om(a) {
          for (var b = Array.from(a.h.keys()), c = t(a.j.keys()), d = c.next(), e = {}; !d.done; e = { Nf: void 0 }, d = c.next()) e.Nf = d.value, b.some(/* @__PURE__ */ function(f) {
            return function(g) {
              return Mj(g.$, f.Nf);
            };
          }(e)) || qm(a, e.Nf);
        }
        function sm(a, b) {
          a.m = b;
          for (var c = Array.from(a.h.keys()); c.length > b; ) {
            var d = c.pop();
            d && qm(a, d);
          }
          om(a);
        }
        function tm(a, b) {
          b && b !== a.i && (rm(a), a.i = b);
        }
        function qm(a, b) {
          var c = a.h;
          b instanceof Lj && (c = a.j);
          a = c.get(b);
          c.delete(b);
          a && a.abort();
        }
        function mm(a) {
          this.g = a;
          this.Gd = this.pg = null;
        }
        function nm(a, b, c) {
          var d = new Uint8Array(0);
          a.Gd = a.g(b, c, function(e) {
            return Q(function(f) {
              if (1 == f.g) return 0 < d.byteLength ? d = Wc(d, e) : d = e, a.pg ? F(f, a.pg(d), 3) : f.s(0);
              d = new Uint8Array(0);
              I(f);
            });
          });
          return a.Gd.promise.catch(function(e) {
            return e instanceof U && 7001 == e.code ? Promise.resolve() : Promise.reject(e);
          });
        }
        mm.prototype.abort = function() {
          this.Gd && this.Gd.abort();
        };
        function um(a) {
          var b = vf(a), c = b.split("/")[0];
          a = wf(a);
          return { type: c, mimeType: b, codecs: a, language: null, height: null, width: null, channelCount: null, sampleRate: null, closedCaptions: /* @__PURE__ */ new Map(), Nd: null, colorGamut: null, frameRate: null };
        }
        function vm(a, b, c) {
          function d(A) {
            x = A.name;
            var H = A.reader;
            H.skip(24);
            var E = H.na(), K = H.na();
            H.skip(50);
            p = String(E);
            n = String(K);
            A.reader.ta() && Kh(A);
          }
          function e(A) {
            var H = $i(A.reader);
            q = H.channelCount;
            u = H.sampleRate;
            f(A.name);
          }
          function f(A) {
            A = A.toLowerCase();
            switch (A) {
              case "avc1":
              case "avc3":
                h.push(A + ".42E01E");
                l = true;
                break;
              case "hev1":
              case "hvc1":
                h.push(A + ".1.6.L93.90");
                l = true;
                break;
              case "dvh1":
              case "dvhe":
                h.push(A + ".05.04");
                l = true;
                break;
              case "vp09":
                h.push(A + ".00.10.08");
                l = true;
                break;
              case "av01":
                h.push(A + ".0.01M.08");
                l = true;
                break;
              case "mp4a":
                g.push("mp4a.40.2");
                k2 = true;
                break;
              case "ac-3":
              case "ec-3":
              case "ac-4":
              case "opus":
              case "flac":
                g.push(A), k2 = true;
            }
          }
          var g = [], h = [], k2 = false, l = false, m = null, n = null, p = null, q = null, u = null, w = null, v = null, x;
          new Fh().box("moov", Kh).box("trak", Kh).box("mdia", Kh).R("mdhd", function(A) {
            m = Yi(A.reader, A.version).language;
          }).box("minf", Kh).box("stbl", Kh).R("stsd", Mh).box("mp4a", function(A) {
            var H = $i(A.reader);
            q = H.channelCount;
            u = H.sampleRate;
            A.reader.ta() ? Kh(A) : f(A.name);
          }).box("esds", function(A) {
            A = A.reader;
            for (var H = "mp4a", E, K; A.ta(); ) {
              E = A.X();
              for (var M = A.X(); M & 128; ) M = A.X();
              if (3 == E) A.na(), M = A.X(), M & 128 && A.na(), M & 64 && A.skip(A.X()), M & 32 && A.na();
              else if (4 == E) K = A.X(), A.skip(12);
              else if (5 == E) break;
            }
            K && (H += "." + cj(K), 5 == E && A.ta() && (E = A.X(), K = (E & 248) >> 3, 31 === K && A.ta() && (K = 32 + ((E & 7) << 3) + ((A.X() & 224) >> 5)), H += "." + K));
            g.push(H);
            k2 = true;
          }).box("ac-3", e).box("ec-3", e).box("ac-4", e).box("Opus", e).box("fLaC", e).box("avc1", d).box("avc3", d).box("hev1", d).box("hvc1", d).box("dva1", d).box("dvav", d).box("dvh1", d).box("dvhe", d).box(
            "vp09",
            d
          ).box("av01", d).box("avcC", function(A) {
            var H = x || "";
            switch (x) {
              case "dvav":
                H = "avc3";
                break;
              case "dva1":
                H = "avc1";
            }
            A = A.reader;
            A.skip(1);
            A = H + "." + cj(A.X()) + cj(A.X()) + cj(A.X());
            h.push(A);
            l = true;
          }).box("hvcC", function(A) {
            var H = x || "";
            switch (x) {
              case "dvh1":
                H = "hvc1";
                break;
              case "dvhe":
                H = "hev1";
            }
            var E = A.reader;
            E.skip(1);
            A = E.X();
            var K = ["", "A", "B", "C"][A >> 6], M = A & 31, J = E.S(), L = (A & 32) >> 5 ? "H" : "L";
            A = [E.X(), E.X(), E.X(), E.X(), E.X(), E.X()];
            E = E.X();
            for (var N = 0, P = 0; 32 > P; P++) {
              N |= J & 1;
              if (31 == P) break;
              N <<= 1;
              J >>= 1;
            }
            H = H + ("." + K + M) + ("." + cj(N, true));
            H += "." + L + E;
            K = "";
            for (M = A.length; M--; ) if ((L = A[M]) || K) K = "." + L.toString(16).toUpperCase() + K;
            H += K;
            h.push(H);
            l = true;
          }).box("dvcC", function(A) {
            var H = x || "";
            switch (x) {
              case "hvc1":
                H = "dvh1";
                break;
              case "hev1":
                H = "dvhe";
                break;
              case "avc1":
                H = "dva1";
                break;
              case "avc3":
                H = "dvav";
                break;
              case "av01":
                H = "dav1";
            }
            var E = A.reader;
            E.skip(2);
            A = E.X();
            E = E.X();
            h.push(H + "." + dj(A >> 1 & 127) + "." + dj(A << 5 & 32 | E >> 3 & 31));
            l = true;
          }).box("dvvC", function(A) {
            var H = x || "";
            switch (x) {
              case "hvc1":
                H = "dvh1";
                break;
              case "hev1":
                H = "dvhe";
                break;
              case "avc1":
                H = "dva1";
                break;
              case "avc3":
                H = "dvav";
                break;
              case "av01":
                H = "dav1";
            }
            var E = A.reader;
            E.skip(2);
            A = E.X();
            E = E.X();
            h.push(H + "." + dj(A >> 1 & 127) + "." + dj(A << 5 & 32 | E >> 3 & 31));
            l = true;
          }).R("vpcC", function(A) {
            var H = x || "", E = A.reader;
            A = E.X();
            var K = E.X();
            E = E.X() >> 4 & 15;
            h.push(H + "." + dj(A) + "." + dj(K) + "." + dj(E));
            l = true;
          }).box("av1C", function(A) {
            var H = x || "";
            switch (x) {
              case "dav1":
                H = "av01";
            }
            var E = A.reader;
            E.skip(1);
            A = E.X();
            E = E.X();
            var K = A >>> 5, M = (E & 64) >> 6;
            h.push(H + "." + K + "." + dj(A & 31) + (E >>> 7 ? "H" : "M") + "." + dj(2 === K && M ? (E & 32) >> 5 ? 12 : 10 : M ? 10 : 8) + "." + ((E & 16) >> 4) + "." + ((E & 8) >> 3) + ((E & 4) >> 2) + (E & 3) + "." + dj(1) + "." + dj(1) + "." + dj(1) + ".0");
            l = true;
          }).box("enca", Oh).box("encv", Nh).box("sinf", Kh).box("frma", function(A) {
            A = aj(A.reader).codec;
            f(A);
          }).box("colr", function(A) {
            h = h.map(function(K) {
              if (K.startsWith("av01.")) {
                var M = A.reader, J = M.Ba(), L = M.Cb(4);
                var N = String.fromCharCode(L[0]);
                N += String.fromCharCode(L[1]);
                N += String.fromCharCode(L[2]);
                N += String.fromCharCode(L[3]);
                if ("nclx" === N) {
                  L = M.na();
                  N = M.na();
                  var P = M.na(), O = M.X() >> 7, R = K.split(".");
                  10 == R.length && (R[6] = dj(L), R[7] = dj(N), R[8] = dj(P), R[9] = String(O), K = R.join("."));
                }
                M.seek(J);
              }
              return K;
            });
            var H = bj(A.reader), E = H.colorGamut;
            w = H.Nd;
            v = E;
          }).parse(a || b, true);
          if (!g.length && !h.length) return null;
          var z = k2 && !l, C = /* @__PURE__ */ new Map();
          if (l && !c) {
            c = new td("video/mp4");
            a && c.init(a);
            try {
              c.i(b);
              for (var D = t(c.j()), G = D.next(); !G.done; G = D.next()) {
                var B = G.value;
                C.set(B, B);
              }
            } catch (A) {
            }
            c.g();
          }
          return {
            type: z ? "audio" : "video",
            mimeType: z ? "audio/mp4" : "video/mp4",
            codecs: wm(g.concat(h)).join(", "),
            language: m,
            height: n,
            width: p,
            channelCount: q,
            sampleRate: u,
            closedCaptions: C,
            Nd: w,
            colorGamut: v,
            frameRate: null
          };
        }
        function wm(a) {
          var b = /* @__PURE__ */ new Set(), c = [];
          a = t(a);
          for (var d = a.next(); !d.done; d = a.next()) {
            d = d.value;
            var e = uf(d);
            b.has(e) || (c.push(d), b.add(e));
          }
          b = ed("audio", c);
          d = ed("video", c);
          a = ed(dd, c);
          d = xm(d);
          b = b.concat(d).concat(a);
          return c.length && !b.length ? c : b;
        }
        function xm(a) {
          if (1 >= a.length) return a;
          var b = a.find(function(c) {
            return c.startsWith("dvav.") || c.startsWith("dva1.") || c.startsWith("dvh1.") || c.startsWith("dvhe.") || c.startsWith("dav1.") || c.startsWith("dvc1.") || c.startsWith("dvi1.");
          });
          return b ? md('video/mp4; codecs="' + b + '"') ? [b] : a.filter(function(c) {
            return c != b;
          }) : a;
        }
        function ym(a) {
          var b = null;
          new Fh().box("moov", Kh).box("trak", Kh).box("mdia", Kh).box("minf", Kh).box("stbl", Kh).R("stsd", Mh).box("encv", Nh).box("enca", Oh).box("sinf", Kh).box("schi", Kh).R("tenc", function(c) {
            c = c.reader;
            c.X();
            c.X();
            c.X();
            c.X();
            b = Vc(c.Cb(16));
          }).parse(a, true);
          return b;
        }
        function zm(a, b, c) {
          var d, e, f, g, h;
          return Q(function(k2) {
            if (1 == k2.g) return d = b, d.cryptoKey ? k2.s(2) : F(k2, d.fetchKey(), 3);
            e = d.iv;
            if (!e) for (e = Qb(new ArrayBuffer(16)), f = d.firstMediaSequenceNumber + c, g = e.byteLength - 1; 0 <= g; g--) e[g] = f & 255, f >>= 8;
            "CBC" == b.blockCipherMode ? h = { name: "AES-CBC", iv: e } : h = { name: "AES-CTR", counter: e, length: 64 };
            return k2.return(window2.crypto.subtle.decrypt(h, d.cryptoKey, a));
          });
        }
        function Am(a, b, c, d, e) {
          a = lh(a, d, e);
          if (0 != b || null != c) a.headers.Range = c ? "bytes=" + b + "-" + c : "bytes=" + b + "-";
          return a;
        }
        function Bm(a, b) {
          var c = this;
          this.g = b;
          this.j = a;
          this.h = null;
          this.K = /* @__PURE__ */ new Map();
          this.C = 1;
          this.u = this.l = null;
          this.O = 0;
          this.i = /* @__PURE__ */ new Map();
          this.I = false;
          this.P = null;
          this.B = false;
          this.m = new th(function() {
            return Cm(c);
          });
          this.L = Date.now() / 1e3;
          this.o = /* @__PURE__ */ new Map();
          this.M = { projection: null, hfov: null };
          this.W = 0;
          this.T = Infinity;
          this.F = null;
          this.A = new ec(function() {
            if (c.j && c.g) if (c.j.presentationTimeline.U()) {
              var d = c.j.presentationTimeline.Hb(), e = c.j.presentationTimeline.ob();
              1 < e - d ? ol(c.g.aa, d, e) : pl(c.g.aa);
            } else pl(c.g.aa), c.A && c.A.stop();
          });
          this.G = null;
          this.H = new ec(function() {
            var d = c.g.video;
            !d.ended && c.G && (d.currentTime = c.G, c.G = null);
          });
        }
        r = Bm.prototype;
        r.destroy = function() {
          return this.m.destroy();
        };
        function Cm(a) {
          var b, c, d, e, f, g, h;
          return Q(function(k2) {
            if (1 == k2.g) {
              b = [];
              c = t(a.i.values());
              for (d = c.next(); !d.done; d = c.next()) e = d.value, Dm(e), b.push(Em(e)), e.ba && (rm(e.ba), e.ba = null);
              f = t(a.o.values());
              for (g = f.next(); !g.done; g = f.next()) h = g.value, rm(h);
              return F(k2, Promise.all(b), 2);
            }
            a.i.clear();
            a.o.clear();
            a.g = null;
            a.j = null;
            a.h = null;
            a.A && a.A.stop();
            a.A = null;
            a.H && a.H.stop();
            a.H = null;
            a.G = null;
            I(k2);
          });
        }
        r.configure = function(a) {
          this.h = a;
          this.P = new Rg({ maxAttempts: Math.max(a.retryParameters.maxAttempts, 2), baseDelay: a.retryParameters.baseDelay, backoffFactor: a.retryParameters.backoffFactor, fuzzFactor: a.retryParameters.fuzzFactor }, true);
          if (a.disableAudioPrefetch) {
            var b = this.i.get("audio");
            b && b.ba && (rm(b.ba), b.ba = null);
            b = t(this.o.keys());
            for (var c = b.next(); !c.done; c = b.next()) c = c.value, rm(this.o.get(c)), this.o.delete(c);
          }
          a.disableTextPrefetch && (b = this.i.get(dd)) && b.ba && (rm(b.ba), b.ba = null);
          a.disableVideoPrefetch && (b = this.i.get("video")) && b.ba && (rm(b.ba), b.ba = null);
          b = t(this.i.keys());
          for (c = b.next(); !c.done; c = b.next()) c = this.i.get(c.value), c.ba ? (sm(c.ba, a.segmentPrefetchLimit), 0 < a.segmentPrefetchLimit || (rm(c.ba), c.ba = null)) : 0 < a.segmentPrefetchLimit && (c.ba = Fm(this, c.stream));
          a.disableAudioPrefetch || Gm(this);
        };
        function Hm(a, b, c) {
          a.j.presentationTimeline.U() || (a.W = b, a.T = c);
        }
        r.start = function(a) {
          var b = this;
          return Q(function(c) {
            if (1 == c.g) return F(c, Im(b, a || /* @__PURE__ */ new Map()), 2);
            uh(b.m);
            b.I = true;
            I(c);
          });
        };
        function Jm(a, b) {
          var c, d, e, f, g, k2;
          Q(function(l) {
            switch (l.g) {
              case 1:
                return c = fd, a.O++, d = a.O, xa(l, 2), F(l, jl(a.g.aa, c.za), 4);
              case 4:
                Aa(l, 3);
                break;
              case 2:
                if (e = Ba(l), a.g) a.g.onError(e);
              case 3:
                f = lf(b.mimeType, b.codecs), Tk(a.g.aa, f, a.j.sequenceMode, b.external), g = a.g.aa.ea, (g.isTextVisible() || a.h.alwaysStreamText) && a.O == d && (k2 = Km(a, b), a.i.set(c.za, k2), Lm(a, k2, 0)), I(l);
            }
          });
        }
        function Mm(a) {
          var b = a.i.get(dd);
          b && (Dm(b), Em(b).catch(function() {
          }), a.F = a.i.get(dd), a.i.delete(dd));
          a.u = null;
        }
        function Nm(a, b) {
          for (var c = 0 > a.g.gb(), d = t(a.i.values()), e = d.next(); !e.done; e = d.next()) e = e.value, e.ja && e.ja.ed(c), e.ba && e.ba.ed(c);
          d = t(a.o.values());
          for (e = d.next(); !e.done; e = d.next()) e.value.ed(c);
          if (c = a.i.get("video")) {
            if (d = c.stream) {
              if (b) (b = d.trickModeVideo) && !c.fc && (Om(a, b, false, 0, false), c.fc = d);
              else if (b = c.fc) c.fc = null, Om(a, b, true, 0, false);
            }
          }
        }
        function Pm(a, b, c, d, e, f) {
          c = void 0 === c ? false : c;
          d = void 0 === d ? 0 : d;
          e = void 0 === e ? false : e;
          f = void 0 === f ? false : f;
          a.l = b;
          a.I && (b.video && Om(a, b.video, c, d, e, f), b.audio && Om(a, b.audio, c, d, e, f));
        }
        function Qm(a, b) {
          Q(function(c) {
            if (1 == c.g) return a.F = null, a.u = b, a.I ? b.segmentIndex ? c.s(2) : F(c, b.createSegmentIndex(), 2) : c.return();
            Om(a, b, true, 0, false);
            I(c);
          });
        }
        function Rm(a, b) {
          for (var c = t(a.K.entries()), d = c.next(); !d.done; d = c.next()) {
            var e = t(d.value);
            d = e.next().value;
            e = e.next().value;
            d.includes(b.type) && (e(), a.K.delete(d));
          }
        }
        function Om(a, b, c, d, e, f) {
          var g = a.i.get(b.type);
          g || b.type != dd ? g && (g.fc && (b.trickModeVideo ? (g.fc = b, b = b.trickModeVideo) : g.fc = null), g.stream != b || e) && (a.o.has(b) ? g.ba = a.o.get(b) : g.ba && tm(g.ba, b), b.type == dd && (e = lf(b.mimeType, b.codecs), Tk(a.g.aa, e, a.j.sequenceMode, b.external)), !a.o.has(g.stream) && g.stream.closeSegmentIndex && (g.Da ? (e = "(" + g.type + ":" + g.stream.id + ")", a.K.has(e) || a.K.set(e, g.stream.closeSegmentIndex)) : g.stream.closeSegmentIndex()), e = g.stream.isAudioMuxedInVideo != b.isAudioMuxedInVideo, g.stream = b, g.ja = null, g.bf = !!f, b.dependencyStream ? g.nd = Km(a, b.dependencyStream) : g.nd = null, e ? Sm(a, true, false) : (c ? g.nc ? g.Re = true : g.Da ? (g.lc = true, g.Vd = d, g.Re = true) : (Dm(g), Tm(a, g, true, d).catch(function(h) {
            if (a.g) a.g.onError(h);
          })) : g.Da || g.kb || Lm(a, g, 0), Um(a, g).catch(function(h) {
            if (a.g) a.g.onError(h);
          }))) : Jm(a, b);
        }
        function Um(a, b) {
          var c, d;
          return Q(function(e) {
            if (1 == e.g) {
              if (!b.rb) return e.return();
              c = b.stream;
              d = b.rb;
              return c.segmentIndex ? e.s(2) : F(e, c.createSegmentIndex(), 2);
            }
            if (b.rb != d || b.stream != c) return e.return();
            var f = a.g.Rc();
            var g = Zk(a.g.aa, b.type), h = b.stream.segmentIndex.find(b.xa ? b.xa.endTime : f), k2 = null == h ? null : b.stream.segmentIndex.get(h);
            h = k2 ? k2.wa ? k2.wa - k2.Sa : null : null;
            k2 && !h && (h = (k2.endTime - k2.getStartTime()) * (b.stream.bandwidth || 0) / 8);
            h ? ((k2 = k2.$) && (h += (k2.wa ? k2.wa - k2.Sa : null) || 0), k2 = a.g.getBandwidthEstimate(), f = 8 * h / k2 < (g || 0) - f - a.h.rebufferingGoal || b.rb.h.g > h ? true : false) : f = false;
            f && b.rb.abort();
            I(e);
          });
        }
        r.Fc = function() {
          if (this.g) {
            for (var a = this.g.Rc(), b = t(this.i.keys()), c = b.next(); !c.done; c = b.next()) {
              var d = c.value;
              c = this.i.get(d);
              var e = this.g.aa;
              d == dd ? (e = e.h, e = null == e.g || null == e.h ? false : a >= e.g && a < e.h) : (e = Yk(e, d), e = Tj(e, a));
              if (!e) {
                this.L = 0;
                c.ba && (c.ba.g = null);
                if ("audio" === c.type) {
                  e = t(this.o.values());
                  for (var f = e.next(); !f.done; f = e.next()) f.value.g = null;
                }
                c.ja = null;
                (null != Zk(this.g.aa, d) || c.Da) && Vm(this, c);
                c.rb && (c.rb.abort(), c.rb = null);
                d === dd && (d = this.g.aa, d.L && d.L.g());
                c.Fc = true;
              }
            }
            "keep" !== this.h.crossBoundaryStrategy && Wm(this);
          }
        };
        function Vm(a, b) {
          b.nc || b.lc || (b.Da ? (b.lc = true, b.Vd = 0) : null == Xk(a.g.aa, b.type) ? null == b.kb && Lm(a, b, 0) : (Dm(b), Tm(a, b, false, 0).catch(function(c) {
            if (a.g) a.g.onError(c);
          })));
        }
        function Im(a, b) {
          var c, d, e, f, g, h, k2, l, m, n;
          return Q(function(p) {
            if (1 == p.g) {
              c = fd;
              if (!a.l) throw new U(2, 5, 5006);
              d = /* @__PURE__ */ new Map();
              e = /* @__PURE__ */ new Set();
              a.l.audio && (d.set(c.V, a.l.audio), e.add(a.l.audio));
              a.l.video && (d.set(c.la, a.l.video), e.add(a.l.video));
              a.u && (d.set(c.za, a.u), e.add(a.u));
              f = a.g.aa;
              return F(p, f.init(d, a.j.sequenceMode, a.j.type, a.j.ignoreManifestTimestampsInSegmentsMode), 2);
            }
            uh(a.m);
            a.updateDuration();
            g = t(d.keys());
            for (h = g.next(); !h.done; h = g.next()) k2 = h.value, l = d.get(k2), a.i.has(k2) || (m = Km(a, l), b.has(l.id) && (n = b.get(l.id), jm(n, function(q, u, w) {
              return Xm(q, u, w || null, a.h.retryParameters, a.g.Xb);
            }), m.ba = n), a.i.set(k2, m), Lm(a, m, 0));
            I(p);
          });
        }
        function Km(a, b) {
          var c = { stream: b, type: b.type, ja: null, ba: Fm(a, b), xa: null, yb: null, he: null, Ac: null, zc: null, fe: null, ge: null, fc: null, endOfStream: false, Da: false, kb: null, lc: false, Vd: 0, Re: false, nc: false, Fc: true, bf: false, bg: false, sd: false, rb: null, nd: null };
          b.dependencyStream && (c.nd = Km(a, b.dependencyStream));
          return c;
        }
        function Fm(a, b) {
          if ("video" === b.type && a.h.disableVideoPrefetch || "audio" === b.type && a.h.disableAudioPrefetch || b.type === dd && ("application/cea-608" == b.mimeType || "application/cea-708" == b.mimeType) || b.type === dd && a.h.disableTextPrefetch) return null;
          if (a.o.has(b)) return a.o.get(b);
          var c = a.i.get(b.type);
          return (c = c && c.ba) && b === c.i ? c : 0 < a.h.segmentPrefetchLimit ? new im(a.h.segmentPrefetchLimit, b, function(d, e, f) {
            return Xm(d, e, f || null, a.h.retryParameters, a.g.Xb);
          }, 0 > a.g.gb()) : null;
        }
        function Gm(a) {
          for (var b = a.h.segmentPrefetchLimit, c = a.h.prefetchAudioLanguages, d = t(a.j.variants), e = d.next(), f = {}; !e.done; f = { wb: void 0 }, e = d.next()) if (f.wb = e.value, f.wb.audio) if (a.o.has(f.wb.audio)) {
            if (e = a.o.get(f.wb.audio), sm(e, b), !(0 < b && c.some(/* @__PURE__ */ function(h) {
              return function(k2) {
                return Nf(h.wb.audio.language, k2);
              };
            }(f)))) {
              var g = a.i.get(f.wb.audio.type);
              e !== (g && g.ba) && rm(e);
              a.o.delete(f.wb.audio);
            }
          } else 0 >= b || !c.some(/* @__PURE__ */ function(h) {
            return function(k2) {
              return Nf(h.wb.audio.language, k2);
            };
          }(f)) || !(e = Fm(a, f.wb.audio)) || (f.wb.audio.segmentIndex || f.wb.audio.createSegmentIndex(), a.o.set(f.wb.audio, e));
        }
        r.updateDuration = function() {
          var a = pd(), b = this.j.presentationTimeline.getDuration();
          Infinity > b ? (a && (this.A && this.A.stop(), pl(this.g.aa)), this.g.aa.bb(b)) : a ? (this.A && this.A.ua(0.5), this.g.aa.bb(Infinity)) : this.g.aa.bb(Math.pow(2, 32));
        };
        function Ym(a, b) {
          var c, d, e, f, g, h;
          return Q(function(k2) {
            switch (k2.g) {
              case 1:
                uh(a.m);
                if (b.Da || null == b.kb || b.nc) return k2.return();
                b.kb = null;
                if (!b.lc) {
                  k2.s(2);
                  break;
                }
                return F(k2, Tm(a, b, b.Re, b.Vd), 3);
              case 3:
                return k2.return();
              case 2:
                Rm(a, b);
                if (b.stream.segmentIndex) {
                  k2.s(4);
                  break;
                }
                c = b.stream;
                xa(k2, 5);
                return F(k2, b.stream.createSegmentIndex(), 7);
              case 7:
                Aa(k2, 6);
                break;
              case 5:
                return d = Ba(k2), F(k2, Zm(a, b, d), 8);
              case 8:
                return k2.return();
              case 6:
                if (c != b.stream) return c.closeSegmentIndex && c.closeSegmentIndex(), b.Da || b.kb || Lm(a, b, 0), k2.return();
              case 4:
                xa(k2, 9);
                e = $m(a, b);
                null != e && (Lm(a, b, e), b.sd = false);
                Aa(k2, 10);
                break;
              case 9:
                return f = Ba(k2), F(k2, Zm(a, b, f), 11);
              case 11:
                return k2.return();
              case 10:
                g = Array.from(a.i.values());
                if (!a.I || !g.every(function(l) {
                  return l.endOfStream;
                })) {
                  k2.s(0);
                  break;
                }
                return F(k2, a.g.aa.endOfStream(), 13);
              case 13:
                uh(a.m), h = a.g.aa.getDuration(), 0 != h && h < a.j.presentationTimeline.getDuration() && a.j.presentationTimeline.bb(h), I(k2);
            }
          });
        }
        function $m(a, b) {
          if (an(b)) return gl(a.g.aa, b.stream.originalId || ""), null;
          b.type == dd && hl(a.g.aa);
          if (b.stream.isAudioMuxedInVideo) return null;
          var c = a.h.updateIntervalSeconds / Math.max(1, Math.abs(a.g.gb()));
          if (!Wk(a.g.aa) && b.type != dd) return c / 2;
          var d = a.g.Rc();
          if ("audio" === b.type) for (var e = t(a.o.keys()), f = e.next(); !f.done; f = e.next()) f = a.o.get(f.value), f.Oa(d, true), km(f, d);
          e = b.xa ? b.xa.endTime : d;
          var g = $k(a.g.aa, b.type, d), h = Math.max(1, Math.max(a.h.rebufferingGoal, a.h.bufferingGoal) * a.C), k2 = a.j.presentationTimeline.getDuration() - e;
          f = Zk(a.g.aa, b.type);
          if (1e-6 > k2 && f) return b.endOfStream = true, "video" == b.type && (a = a.i.get(dd)) && an(a) && (a.endOfStream = true), null;
          b.endOfStream = false;
          if (g >= h) return c / 2;
          h = !b.ja;
          f = bn(a, b, d, f);
          if (!f) return c;
          g = false;
          h && b.bf && (g = true, b.bf = false);
          h = Infinity;
          k2 = Array.from(a.i.values());
          k2 = t(k2);
          for (var l = k2.next(); !l.done; l = k2.next()) l = l.value, an(l) || l.ja && !l.ja.current() || (h = Math.min(h, l.xa ? l.xa.endTime : d));
          if (e >= h + a.j.presentationTimeline.h) return c;
          if ("keep" !== a.h.crossBoundaryStrategy && cn(a, b, f)) return null;
          b.ba && b.ja && !a.o.has(b.stream) && (b.ba.Oa(f.startTime), km(b.ba, f.startTime).catch(function() {
          }));
          dn(a, b, d, f, g).catch(function() {
          });
          b.nd && en(a, b.nd, d);
          return null;
        }
        function bn(a, b, c, d) {
          if (b.ja) return (c = b.ja.current()) && b.xa && 1e-3 > Math.abs(b.xa.startTime - c.startTime) && (c = b.ja.next().value), c;
          if (b.xa || d) return c = b.xa ? b.xa.endTime : d, a = 0 > a.g.gb(), b.stream.segmentIndex && (b.ja = b.stream.segmentIndex.Gb(c, false, a)), b.ja && b.ja.next().value;
          d = a.j.sequenceMode ? 0 : a.h.inaccurateManifestTolerance;
          var e = Math.max(c - d, 0);
          a = 0 > a.g.gb();
          var f = null;
          d && (b.stream.segmentIndex && (b.ja = b.stream.segmentIndex.Gb(e, false, a)), f = b.ja && b.ja.next().value);
          f || (b.stream.segmentIndex && (b.ja = b.stream.segmentIndex.Gb(
            c,
            false,
            a
          )), f = b.ja && b.ja.next().value);
          return f;
        }
        function dn(a, b, c, d, e) {
          var f, g, h, k2, l, n, p, q, u, w, v, x, z, C, D, G, B;
          return Q(function(A) {
            switch (A.g) {
              case 1:
                f = fd;
                g = b.stream;
                h = b.ja;
                b.Da = true;
                xa(A, 2);
                if (2 == d.dc()) throw new U(1, 1, 1011);
                return F(A, fn(a, b, d, e), 4);
              case 4:
                uh(a.m);
                if (a.B) return A.return();
                k2 = "video/mp4" == g.mimeType || "audio/mp4" == g.mimeType;
                l = window2.ReadableStream;
                if (a.h.lowLatencyMode && a.j.isLowLatency && l && k2 && ("HLS" != a.j.type || d.m)) return q = new Uint8Array(0), w = u = false, x = function(H) {
                  var E, K, M;
                  return Q(function(L) {
                    switch (L.g) {
                      case 1:
                        if (u) return L.return();
                        w = true;
                        uh(a.m);
                        if (a.B) return L.return();
                        xa(L, 2);
                        q = gn(q, H);
                        E = false;
                        K = 0;
                        new Fh().box("mdat", function(N) {
                          K = N.size + N.start;
                          E = true;
                        }).parse(q, false, true);
                        if (!E) {
                          L.s(4);
                          break;
                        }
                        M = q.subarray(0, K);
                        q = q.subarray(K);
                        return F(L, hn(a, b, c, g, d, M, true, e), 5);
                      case 5:
                        b.ba && b.ja && km(b.ba, d.startTime, true);
                      case 4:
                        Aa(L, 0);
                        break;
                      case 2:
                        v = Ba(L), I(L);
                    }
                  });
                }, F(A, jn(a, b, d, x), 9);
                n = jn(a, b, d);
                return F(A, n, 7);
              case 7:
                p = A.h;
                uh(a.m);
                if (a.B) return A.return();
                uh(a.m);
                return b.lc ? (b.Da = false, Lm(a, b, 0), A.return()) : F(A, hn(a, b, c, g, d, p, false, e), 6);
              case 9:
                z = A.h;
                if (v) throw v;
                if (w) {
                  A.s(10);
                  break;
                }
                u = true;
                uh(a.m);
                return a.B ? A.return() : b.lc ? (b.Da = false, Lm(a, b, 0), A.return()) : F(A, hn(a, b, c, g, d, z, false, e), 10);
              case 10:
                b.ba && b.ja && km(b.ba, d.startTime, true);
              case 6:
                uh(a.m);
                if (a.B) return A.return();
                b.xa = d;
                h.next();
                b.Da = false;
                b.bg = false;
                C = a.g.aa.Fb();
                D = C[b.type];
                hb(JSON.stringify(D));
                b.lc || (G = null, b.type === f.la ? G = a.i.get(f.V) : b.type === f.V && (G = a.i.get(f.la)), G && G.type == f.V ? a.g.qe(d, b.stream, G.stream.isAudioMuxedInVideo) : a.g.qe(d, b.stream, b.stream.codecs.includes(",")));
                Lm(a, b, 0);
                Aa(A, 0);
                break;
              case 2:
                B = Ba(A);
                uh(a.m, B);
                if (a.B) return A.return();
                b.Da = false;
                if (7001 == B.code) b.Da = false, Dm(b), Lm(a, b, 0), A.s(0);
                else if (b.type == f.za && a.h.ignoreTextStreamFailures) a.i.delete(f.za), A.s(0);
                else {
                  if (3017 == B.code) return F(A, kn(a, b, B), 0);
                  b.sd = true;
                  1 == B.category && b.ba && qm(b.ba, d);
                  B.severity = 2;
                  return F(A, Zm(a, b, B), 0);
                }
            }
          });
        }
        function en(a, b, c) {
          var d, e, f, g, h, k2, l, m;
          Q(function(n) {
            switch (n.g) {
              case 1:
                d = b.stream;
                f = (e = d.segmentIndex.Gb(c)) && e.next().value;
                if (!f) {
                  n.s(0);
                  break;
                }
                g = f.$;
                if (!g || Mj(g, b.yb)) {
                  n.s(3);
                  break;
                }
                b.yb = g;
                xa(n, 4);
                return F(n, jn(a, b, g), 6);
              case 6:
                h = n.h;
                var p = a.g.aa;
                p.I && jd(p.I, h, 0, d);
                Aa(n, 3);
                break;
              case 4:
                throw k2 = Ba(n), b.yb = null, k2;
              case 3:
                if (b.xa && b.xa == f) {
                  n.s(0);
                  break;
                }
                b.xa = f;
                xa(n, 8);
                return F(n, jn(a, b, f), 10);
              case 10:
                l = n.h;
                p = a.g.aa;
                p.I && jd(p.I, l, 0, d);
                Aa(n, 0);
                break;
              case 8:
                throw m = Ba(n), b.xa = null, m;
            }
          });
        }
        function gn(a, b) {
          var c = new Uint8Array(a.length + b.length);
          c.set(a);
          c.set(b, a.length);
          return c;
        }
        function kn(a, b, c) {
          var d, f, h, k2;
          return Q(function(l) {
            if (1 == l.g) {
              d = Array.from(a.i.values());
              if (d.some(function(m) {
                return m != b && m.bg;
              })) return l.s(2);
              f = 0 === a.h.maxDisabledTime && 1011 == c.code ? 1 : a.h.maxDisabledTime;
              if (a.g.disableStream(b.stream, f)) return l.return();
              if (a.h.avoidEvictionOnQuotaExceededError) return Lm(a, b, 4), l.return();
              h = Math.round(100 * a.C);
              if (20 < h) a.C -= 0.2;
              else if (4 < h) a.C -= 0.04;
              else return b.sd = true, a.B = true, a.g.onError(c), l.return();
              b.bg = true;
              k2 = a.g.Rc();
              return F(l, ln(a, b, k2), 2);
            }
            Lm(a, b, 4);
            I(l);
          });
        }
        function fn(a, b, c, d) {
          var e, f, g, h, k2, l, m, n, p, q, u, w, v, x, z, C;
          return Q(function(D) {
            switch (D.g) {
              case 1:
                e = fd;
                f = null == b.xa;
                g = [];
                h = Math.max(0, Math.max(c.appendWindowStart, a.W) - 0.1);
                k2 = Math.min(c.appendWindowEnd, a.T) + 0.01;
                l = c.codecs || b.stream.codecs;
                m = uf(l);
                n = vf(c.mimeType || b.stream.mimeType);
                p = c.timestampOffset;
                if (p == b.he && h == b.Ac && k2 == b.zc && m == b.fe && n == b.ge) {
                  D.s(2);
                  break;
                }
                q = b.fe && b.ge && wl(a.g.aa, b.type, n, l);
                if (!q) {
                  D.s(3);
                  break;
                }
                u = null;
                b.type === e.la ? u = a.i.get(e.V) : b.type === e.V && (u = a.i.get(e.la));
                if (!u) {
                  D.s(3);
                  break;
                }
                return F(
                  D,
                  Em(u).catch(function() {
                  }),
                  5
                );
              case 5:
                u.yb = null, u.Ac = null, u.zc = null, Vm(a, u);
              case 3:
                return F(D, mn(a, b, p, h, k2, c, m, n), 2);
              case 2:
                return Mj(c.$, b.yb) || (b.yb = c.$, c.l && c.$ && (w = jn(a, b, c.$), v = function() {
                  var G, B, A, H, E, K, M;
                  return Q(function(J) {
                    switch (J.g) {
                      case 1:
                        return xa(J, 2), F(J, w, 4);
                      case 4:
                        return G = J.h, uh(a.m), B = null, A = /* @__PURE__ */ new Map(), H = { projection: null, hfov: null }, E = new Fh(), E.box("moov", Kh).box("trak", Kh).box("mdia", Kh).R("mdhd", function(L) {
                          B = Yi(L.reader, L.version).timescale;
                        }).box("hdlr", function(L) {
                          L = L.reader;
                          L.skip(8);
                          switch (L.Cc()) {
                            case "soun":
                              A.set(e.V, B);
                              break;
                            case "vide":
                              A.set(e.la, B);
                          }
                          B = null;
                        }).box("minf", Kh).box("stbl", Kh).R("stsd", Mh).box("encv", Nh).box("avc1", Nh).box("avc3", Nh).box("hev1", Nh).box("hvc1", Nh).box("dvav", Nh).box("dva1", Nh).box("dvh1", Nh).box("dvhe", Nh).box("dvc1", Nh).box("dvi1", Nh).box("vexu", Kh).box("proj", Kh).R("prji", function(L) {
                          L = L.reader.Cc();
                          H.projection = L;
                        }).box("hfov", function(L) {
                          L = L.reader.S() / 1e3;
                          H.hfov = L;
                        }).parse(G), b.type === e.la && nn(a, H), A.has(b.type) ? c.$.timescale = A.get(b.type) : null != B && (c.$.timescale = B), K = b.stream.closedCaptions && 0 < b.stream.closedCaptions.size, F(J, a.g.Fg(b.type, G), 5);
                      case 5:
                        return F(J, bl(a.g.aa, b.type, G, null, b.stream, K, b.Fc, d), 6);
                      case 6:
                        Aa(J, 0);
                        break;
                      case 2:
                        throw M = Ba(J), b.yb = null, M;
                    }
                  });
                }, x = c.startTime, f && (z = Zk(a.g.aa, b.type), null != z && (x = z)), a.g.fj(x, c.$), g.push(v()))), C = b.xa ? b.xa.i : null, c.i != C && g.push(ml(a.g.aa, b.type, c.startTime)), F(D, Promise.all(g), 0);
            }
          });
        }
        function mn(a, b, c, d, e, f, g, h) {
          var k2, l, m, n;
          return Q(function(p) {
            if (1 == p.g) return k2 = fd, l = /* @__PURE__ */ new Map(), a.l.audio && l.set(k2.V, a.l.audio), a.l.video && l.set(k2.la, a.l.video), xa(p, 2), b.Ac = d, b.zc = e, g && (b.fe = g), h && (b.ge = h), b.he = c, m = a.j.sequenceMode || "HLS" == a.j.type, F(p, kl(a.g.aa, b.type, c, d, e, m, f.mimeType || b.stream.mimeType, f.codecs || b.stream.codecs, l), 4);
            if (2 != p.g) return Aa(p, 0);
            n = Ba(p);
            b.Ac = null;
            b.zc = null;
            b.fe = null;
            b.ge = null;
            b.he = null;
            throw n;
          });
        }
        function hn(a, b, c, d, e, f, g, h) {
          g = void 0 === g ? false : g;
          h = void 0 === h ? false : h;
          var k2, l, m, n, p, q;
          return Q(function(u) {
            switch (u.g) {
              case 1:
                return k2 = d.closedCaptions && 0 < d.closedCaptions.size, a.h.shouldFixTimestampOffset && (m = "video/mp4" == d.mimeType || "audio/mp4" == d.mimeType, n = null, e.$ && (n = e.$.timescale), (p = m && n && "video" === d.type && "DASH" == a.j.type) && (l = new Fh()), p && l.box("moof", Kh).box("traf", Kh).R("tfdt", function(w) {
                  var v, x, z, C, D, G;
                  return Q(function(B) {
                    v = Xi(w.reader, w.version);
                    x = v.baseMediaDecodeTime;
                    if (!x) return B.return();
                    z = -x / n;
                    C = Number(b.he) || 0;
                    if (!(C < z)) return B.s(0);
                    D = b.Ac;
                    G = b.zc;
                    return F(B, mn(a, b, z, D, G, e), 0);
                  });
                }), p && l.parse(f, false, g)), F(u, ln(a, b, c), 2);
              case 2:
                return uh(a.m), q = b.Fc, b.Fc = false, F(u, a.g.Fg(b.type, f), 3);
              case 3:
                return F(u, bl(a.g.aa, b.type, f, e, d, k2, q, h, g), 4);
              case 4:
                uh(a.m), I(u);
            }
          });
        }
        function ln(a, b, c) {
          var d, e, f, g, h, k2, l, m;
          return Q(function(n) {
            if (1 == n.g) {
              d = b.stream.segmentIndex;
              d instanceof Vl && d.Oa(a.j.presentationTimeline.pb());
              e = Math.max(a.h.bufferBehind * a.C, a.j.presentationTimeline.h);
              f = Xk(a.g.aa, b.type);
              if (null == f) return a.F == b && (a.F = null), n.return();
              g = c - f;
              h = a.h.evictionGoal;
              k2 = a.j.presentationTimeline.Hb();
              l = a.j.presentationTimeline.ob();
              m = g - e;
              l - k2 > h && (m = Math.max(g - e, k2 - h - f));
              return m <= h ? n.return() : F(n, a.g.aa.remove(b.type, f, f + m), 2);
            }
            if (4 != n.g) return uh(a.m), a.F ? F(n, ln(
              a,
              a.F,
              c
            ), 4) : n.s(0);
            uh(a.m);
            I(n);
          });
        }
        function an(a) {
          return a && a.type == dd && ("application/cea-608" == a.stream.mimeType || "application/cea-708" == a.stream.mimeType);
        }
        function jn(a, b, c, d) {
          var e, f, g, h, k2;
          return Q(function(l) {
            switch (l.g) {
              case 1:
                if (e = c.Ib()) return l.return(e);
                f = null;
                if (b.ba) {
                  var m = b.ba, n = m.h;
                  c instanceof Lj && (n = m.j);
                  n.has(c) ? (m = n.get(c), d && (m.pg = d), f = m.Gd) : f = null;
                }
                f || (f = Xm(c, b.stream, d || null, a.h.retryParameters, a.g.Xb));
                g = 0;
                b.ja && (g = b.ja.h);
                b.rb = f;
                return F(l, f.promise, 2);
              case 2:
                h = l.h;
                b.rb = null;
                k2 = h.data;
                if (!c.aesKey) {
                  l.s(3);
                  break;
                }
                return F(l, zm(k2, c.aesKey, g), 4);
              case 4:
                k2 = l.h;
              case 3:
                return l.return(k2);
            }
          });
        }
        function Xm(a, b, c, d, e, f) {
          f = void 0 === f ? false : f;
          var g = a instanceof Nj ? a : void 0, h = g ? 1 : 0;
          a = Am(a.N(), a.Sa, a.wa, d, c);
          a.contentType = b.type;
          return e.request(rh, a, { type: h, stream: b, segment: g, isPreload: f });
        }
        function Tm(a, b, c, d) {
          var e, f;
          return Q(function(g) {
            if (1 == g.g) return b.lc = false, b.Re = false, b.Vd = 0, b.nc = true, b.xa = null, b.ja = null, b.ba && !a.o.has(b.stream) && rm(b.ba), d ? (e = a.g.Rc(), f = a.g.aa.getDuration(), F(g, a.g.aa.remove(b.type, e + d, f), 3)) : F(g, jl(a.g.aa, b.type), 4);
            if (3 != g.g) return uh(a.m), c ? F(g, a.g.aa.flush(b.type), 3) : g.s(3);
            uh(a.m);
            b.nc = false;
            b.endOfStream = false;
            b.Da || b.kb || Lm(a, b, 0);
            I(g);
          });
        }
        function Lm(a, b, c) {
          var d = b.type;
          if (d != dd || a.i.has(d)) b.kb = new dc(function() {
            var e;
            return Q(function(f) {
              if (1 == f.g) return xa(f, 2), F(f, Ym(a, b), 4);
              if (2 != f.g) return Aa(f, 0);
              e = Ba(f);
              if (a.g) a.g.onError(e);
              I(f);
            });
          }).da(c);
        }
        function Dm(a) {
          null != a.kb && (a.kb.stop(), a.kb = null);
        }
        function Em(a) {
          return Q(function(b) {
            return a.rb ? F(b, a.rb.abort(), 0) : b.s(0);
          });
        }
        function Zm(a, b, c) {
          var d;
          return Q(function(e) {
            if (1 == e.g) return 3024 == c.code ? (b.Da = false, Dm(b), Lm(a, b, 0), e.return()) : F(e, Tg(a.P), 2);
            uh(a.m);
            if (1 === c.category && 1003 != c.code) {
              if (b.fc) return Nm(a, false), e.return();
              d = 0 === a.h.maxDisabledTime && 1011 == c.code ? 1 : a.h.maxDisabledTime;
              c.handled = a.g.disableStream(b.stream, d);
              c.handled && (c.severity = 1);
            }
            if (!c.handled || 1011 != c.code) a.g.onError(c);
            c.handled || a.h.failureCallback(c);
            I(e);
          });
        }
        function Sm(a, b, c) {
          b = void 0 === b ? false : b;
          c = void 0 === c ? true : c;
          var d, e, f, g, h, k2;
          return Q(function(l) {
            if (1 == l.g) {
              d = Date.now() / 1e3;
              e = a.h.minTimeBetweenRecoveries;
              if (!b) {
                if (!a.h.allowMediaSourceRecoveries || d - a.L < e) return l.return(false);
                a.L = d;
              }
              f = fd;
              if (g = a.i.get(f.V)) g.yb = null, g.Ac = null, g.zc = null, c && Vm(a, g), Em(g).catch(function() {
              }), g.ja && g.ja.dg();
              if (h = a.i.get(f.la)) h.yb = null, h.Ac = null, h.zc = null, c && Vm(a, h), Em(h).catch(function() {
              }), h.ja && h.ja.dg();
              k2 = /* @__PURE__ */ new Map();
              a.l.audio && k2.set(f.V, a.l.audio);
              a.l.video && k2.set(f.la, a.l.video);
              return F(l, ul(a.g.aa, k2), 2);
            }
            !h || h.nc || h.Da || h.kb || Lm(a, h, 0);
            !g || g.nc || g.Da || g.kb || Lm(a, g, 0);
            return l.return(true);
          });
        }
        function nn(a, b) {
          if (a.M.projection != b.projection || a.M.hfov != b.hfov) {
            if (null != b.projection || null != b.hfov) {
              var c = (/* @__PURE__ */ new Map()).set("detail", b);
              c = new V("spatialvideoinfo", c);
            } else c = new V("nospatialvideoinfo");
            c.cancelable = true;
            a.g.onEvent(c);
            a.M = b;
          }
        }
        function Wm(a) {
          if ("keep" !== a.h.crossBoundaryStrategy) {
            a.H.stop();
            var b = a.g.Rc(), c = a.i.get("video") || a.i.get("audio");
            c && (c = c.yb) && null !== c.g && (b = c.g - b, 0 > b || 1 < b || (a.G = c.g + 0.01, a.H.da(b)));
          }
        }
        function cn(a, b, c) {
          if (b.type === dd) return false;
          var d = b.yb;
          if (!d) return false;
          c = c.$;
          var e = d.g !== c.g;
          "reset_to_encrypted" === a.h.crossBoundaryStrategy && (d.encrypted || c.encrypted || (e = false), d.encrypted && (a.h.crossBoundaryStrategy = "keep"));
          "RESET_ON_ENCRYPTION_CHANGE" === a.h.crossBoundaryStrategy && d.encrypted == c.encrypted && (e = false);
          if (e && b.Fc) {
            var f = a.g.video, g = f.paused;
            Sm(a, true).then(function() {
              a.g.onEvent(new V("boundarycrossed"));
              g || f.play();
            });
          }
          return e;
        }
        function on2() {
        }
        function pn(a, b, c, d, e) {
          var f = e in d;
          var g = f ? c.constructor == Object && 0 == Object.keys(d).length : c.constructor == Object && 0 == Object.keys(c).length;
          var h = f || g, k2 = true, l;
          for (l in b) {
            var m = e + "." + l, n = f ? d[e] : c[l];
            h || l in c ? void 0 === b[l] ? void 0 === n || h ? delete a[l] : a[l] = Nd(n) : g ? a[l] = b[l] : n.constructor == Object && b[l] && b[l].constructor == Object ? (a[l] || (a[l] = Nd(n)), m = pn(a[l], b[l], n, d, m), k2 = k2 && m) : typeof b[l] != typeof n || null == b[l] || "function" != typeof b[l] && b[l].constructor != n.constructor ? (ab("Invalid config, wrong type for " + m), k2 = false) : ("function" == typeof c[l] && c[l].length != b[l].length && bb("Unexpected number of arguments for " + m), a[l] = b[l]) : (ab("Invalid config, unrecognized key " + m), k2 = false);
          }
          return k2;
        }
        function qn(a, b) {
          for (var c = {}, d = c, e = 0, f = 0; ; ) {
            e = a.indexOf(".", e);
            if (0 > e) break;
            if (0 == e || "\\" != a[e - 1]) f = a.substring(f, e).replace(/\\\./g, "."), d[f] = {}, d = d[f], f = e + 1;
            e += 1;
          }
          d[a.substring(f).replace(/\\\./g, ".")] = b;
          return c;
        }
        function rn(a, b) {
          return a && b;
        }
        function sn(a, b) {
          function c(f) {
            for (var g = t(Object.keys(f)), h = g.next(); !h.done; h = g.next()) if (h = h.value, !(f[h] instanceof HTMLElement)) if (e(f[h]) && 0 === Object.keys(f[h]).length) delete f[h];
            else {
              var k2 = f[h];
              Array.isArray(k2) && 0 === k2.length ? delete f[h] : "function" == typeof f[h] ? delete f[h] : e(f[h]) && (c(f[h]), 0 === Object.keys(f[h]).length && delete f[h]);
            }
          }
          function d(f, g) {
            return Object.keys(f).reduce(function(h, k2) {
              var l = f[k2];
              if (g.hasOwnProperty(k2)) if (l instanceof HTMLElement && g[k2] instanceof HTMLElement) l.isEqualNode(g[k2]) || (h[k2] = l);
              else if (e(l) && e(g[k2])) {
                if (l = d(l, g[k2]), 0 < Object.keys(l).length || !e(l)) h[k2] = l;
              } else Array.isArray(l) && Array.isArray(g[k2]) ? Dd(l, g[k2]) || (h[k2] = l) : Number.isNaN(l) && Number.isNaN(g[k2]) || l !== g[k2] && (h[k2] = l);
              else h[k2] = l;
              return h;
            }, {});
          }
          function e(f) {
            return f && "object" === typeof f && !Array.isArray(f);
          }
          a = d(a, b);
          c(a);
          return a;
        }
        T("shaka.util.ConfigUtils", on2);
        on2.getDifferenceFromConfigObjects = sn;
        on2.convertToConfigObject = qn;
        on2.mergeConfigObjects = pn;
        function tn() {
        }
        function un(a) {
          a = Kc(a);
          return new yb(a).nb;
        }
        function vn(a, b, c) {
          function d(h) {
            Vb(f).setUint32(g, h.byteLength, true);
            g += 4;
            f.set(Qb(h), g);
            g += h.byteLength;
          }
          if (!c || !c.byteLength) throw new U(2, 6, 6015);
          var e;
          "string" == typeof b ? e = Mc(b, true) : e = b;
          a = Kc(a);
          a = Mc(a, true);
          var f = new Uint8Array(12 + a.byteLength + e.byteLength + c.byteLength), g = 0;
          d(a);
          d(e);
          d(c);
          return f;
        }
        function wn(a, b, c) {
          if ("skd" !== b) return a;
          b = c.serverCertificate;
          c = Kc(a).split("skd://").pop();
          return vn(a, c, b);
        }
        function xn(a, b) {
          2 === a && (a = b.drmInfo) && ac(a.keySystem) && (b.headers["Content-Type"] = "application/octet-stream");
        }
        T("shaka.drm.FairPlay", tn);
        tn.commonFairPlayResponse = function(a, b) {
          if (2 === a && (a = b.originalRequest.drmInfo) && ac(a.keySystem)) {
            try {
              var c = Hc(b.data);
            } catch (e) {
              return;
            }
            a = false;
            c = c.trim();
            "<ckc>" === c.substr(0, 5) && "</ckc>" === c.substr(-6) && (c = c.slice(5, -6), a = true);
            if (!a) try {
              var d = JSON.parse(c);
              d.ckc && (c = d.ckc, a = true);
              d.CkcMessage && (c = d.CkcMessage, a = true);
              d.License && (c = d.License, a = true);
            } catch (e) {
            }
            a && (b.data = Sb(Tc(c)));
          }
        };
        tn.muxFairPlayRequest = function(a, b) {
          xn(a, b);
        };
        tn.expressplayFairPlayRequest = function(a, b) {
          if (2 === a) {
            var c = b.drmInfo;
            c && ac(c.keySystem) && xn(a, b);
          }
        };
        tn.conaxFairPlayRequest = function(a, b) {
          xn(a, b);
        };
        tn.ezdrmFairPlayRequest = function(a, b) {
          xn(a, b);
        };
        tn.verimatrixFairPlayRequest = function(a, b) {
          2 === a && (a = b.drmInfo) && ac(a.keySystem) && (a = Qb(b.body), a = Sc(a), b.headers["Content-Type"] = "application/x-www-form-urlencoded", b.body = Lc("spc=" + a));
        };
        tn.muxInitDataTransform = function(a, b, c) {
          return wn(a, b, c);
        };
        tn.expressplayInitDataTransform = function(a, b, c) {
          return wn(a, b, c);
        };
        tn.conaxInitDataTransform = function(a, b, c) {
          if ("skd" !== b) return a;
          b = c.serverCertificate;
          c = Kc(a).split("skd://").pop().split("?").shift();
          c = window2.atob(c);
          var d = new ArrayBuffer(2 * c.length);
          d = Ub(d);
          for (var e = 0, f = c.length; e < f; e++) d[e] = c.charCodeAt(e);
          return vn(a, d, b);
        };
        tn.ezdrmInitDataTransform = function(a, b, c) {
          if ("skd" !== b) return a;
          b = c.serverCertificate;
          c = Kc(a).split(";").pop();
          return vn(a, c, b);
        };
        tn.verimatrixInitDataTransform = function(a, b, c) {
          return wn(a, b, c);
        };
        tn.initDataTransform = vn;
        tn.defaultGetContentId = un;
        tn.isFairPlaySupported = function() {
          var a;
          return Q(function(b) {
            if (1 == b.g) return a = { initDataTypes: ["cenc", "sinf", "skd"], videoCapabilities: [{ contentType: 'video/mp4; codecs="avc1.42E01E"' }] }, xa(b, 2), F(b, navigator.requestMediaKeySystemAccess("com.apple.fps", [a]), 4);
            if (2 != b.g) return b.return(true);
            Ba(b);
            return b.return(false);
          });
        };
        function yn() {
          this.g = null;
        }
        yn.prototype.configure = function(a) {
          this.g = a;
        };
        yn.prototype.create = function(a) {
          var b;
          if (this.g.language) {
            var c = zn(a, this.g.language);
            c.length && (b = c);
          }
          b || (b = a.filter(function(d) {
            return d.primary;
          }), b = b.length ? b : a);
          a = An(b, this.g.role);
          a.length && (b = a);
          this.g.videoLayout && (a = Bn(b, this.g.videoLayout), a.length && (b = a));
          this.g.Sc && (a = Cn(b, this.g.Sc), a.length && (b = a));
          this.g.channelCount && (a = Dn(b, this.g.channelCount), a.length && (b = a));
          this.g.Kc && (a = En(b, this.g.Kc), a.length && (b = a));
          this.g.fd && (a = Fn(b, this.g.fd), a.length && (b = a));
          a = Gn(b, this.g.spatialAudio);
          a.length && (b = a);
          this.g.audioCodec && (a = Hn(b, this.g.audioCodec), a.length && (b = a));
          return new Di(b[0], b, !("smooth" == this.g.codecSwitchingStrategy && od()));
        };
        function zn(a, b) {
          b = Of(b);
          var c = ag(b, a.map(function(d) {
            return $f(d);
          }));
          return c ? a.filter(function(d) {
            return c == $f(d);
          }) : [];
        }
        function An(a, b) {
          return a.filter(function(c) {
            return c.audio ? b ? c.audio.roles.includes(b) : 0 == c.audio.roles.length : false;
          });
        }
        function En(a, b) {
          return a.filter(function(c) {
            return c.audio && c.audio.label ? c.audio.label.toLowerCase() == b.toLowerCase() : false;
          });
        }
        function Fn(a, b) {
          return a.filter(function(c) {
            return c.video && c.video.label ? c.video.label.toLowerCase() == b.toLowerCase() : false;
          });
        }
        function Dn(a, b) {
          return a.filter(function(c) {
            return c.audio && c.audio.channelsCount && c.audio.channelsCount > b ? false : true;
          }).sort(function(c, d) {
            return c.audio || d.audio ? c.audio ? d.audio ? (d.audio.channelsCount || 0) - (c.audio.channelsCount || 0) : 1 : -1 : 0;
          });
        }
        function Cn(a, b) {
          if ("AUTO" == b) {
            var c = a.some(function(d) {
              return d.video && d.video.hdr && "HLG" == d.video.hdr ? true : false;
            });
            b = Fc(c);
          }
          return a.filter(function(d) {
            return d.video && d.video.hdr && d.video.hdr != b ? false : true;
          });
        }
        function Bn(a, b) {
          return a.filter(function(c) {
            return c.video && c.video.videoLayout && c.video.videoLayout != b ? false : true;
          });
        }
        function Gn(a, b) {
          return a.filter(function(c) {
            return c.audio && c.audio.spatialAudio != b ? false : true;
          });
        }
        function Hn(a, b) {
          return a.filter(function(c) {
            return c.audio && c.audio.codecs != b ? false : true;
          });
        }
        function In() {
        }
        function Jn() {
          var a = Infinity;
          navigator.connection && navigator.connection.saveData && (a = 360);
          var b = {
            retryParameters: Sg(),
            servers: {},
            clearKeys: {},
            advanced: {},
            delayLicenseRequestUntilPlayed: false,
            persistentSessionOnlinePlayback: false,
            persistentSessionsMetadata: [],
            initDataTransform: function(m, n, p) {
              "apple" === window2.shakaMediaKeysPolyfill && "skd" == n && (n = p.serverCertificate, p = un(m), m = vn(m, p, n));
              return m;
            },
            logLicenseExchange: false,
            updateExpirationTime: 1,
            preferredKeySystems: [],
            keySystemsMapping: {},
            parseInbandPsshEnabled: jc(),
            minHdcpVersion: "",
            ignoreDuplicateInitData: !kc("Tizen 2"),
            defaultAudioRobustnessForWidevine: "SW_SECURE_CRYPTO",
            defaultVideoRobustnessForWidevine: "SW_SECURE_DECODE"
          };
          (jc() || uc()) && b.preferredKeySystems.push("com.microsoft.playready");
          var c = "reload", d = false;
          !od() || lc() || uc() || tc() || nc() && 79 === pc() || qc() && !yc() && !zc() || xc() && ic() || (c = "smooth", d = true);
          d = {
            retryParameters: Sg(),
            availabilityWindowOverride: NaN,
            disableAudio: false,
            disableVideo: false,
            disableText: false,
            disableThumbnails: false,
            disableIFrames: false,
            defaultPresentationDelay: 0,
            segmentRelativeVttTiming: false,
            raiseFatalErrorOnManifestUpdateRequestFailure: false,
            continueLoadingWhenPaused: true,
            ignoreSupplementalCodecs: false,
            updatePeriod: -1,
            ignoreDrmInfo: false,
            dash: { clockSyncUri: "", disableXlinkProcessing: true, xlinkFailGracefully: false, ignoreMinBufferTime: false, autoCorrectDrift: true, initialSegmentLimit: 1e3, ignoreSuggestedPresentationDelay: false, ignoreEmptyAdaptationSet: false, ignoreMaxSegmentDuration: false, keySystemsByURI: {
              "urn:uuid:1077efec-c0b2-4d02-ace3-3c1e52e2fb4b": "org.w3.clearkey",
              "urn:uuid:e2719d58-a985-b3c9-781a-b030af78d30e": "org.w3.clearkey",
              "urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed": "com.widevine.alpha",
              "urn:uuid:9a04f079-9840-4286-ab92-e65be0885f95": "com.microsoft.playready",
              "urn:uuid:79f0049a-4098-8642-ab92-e65be0885f95": "com.microsoft.playready",
              "urn:uuid:94ce86fb-07ff-4f43-adb8-93d2fa968ca2": "com.apple.fps",
              "urn:uuid:3d5e6d35-9b9a-41e8-b843-dd3c6e72c42c": "com.huawei.wiseplay"
            }, manifestPreprocessor: Kn, manifestPreprocessorTXml: Ln, sequenceMode: false, multiTypeVariantsAllowed: d, useStreamOnceInPeriodFlattening: false, enableFastSwitching: true },
            hls: { ignoreTextStreamFailures: false, ignoreImageStreamFailures: false, defaultAudioCodec: "mp4a.40.2", defaultVideoCodec: "avc1.42E01E", ignoreManifestProgramDateTime: false, ignoreManifestProgramDateTimeForTypes: [], mediaPlaylistFullMimeType: 'video/mp2t; codecs="avc1.42E01E, mp4a.40.2"', liveSegmentsDelay: 3, sequenceMode: Dc(), ignoreManifestTimestampsInSegmentsMode: false, disableCodecGuessing: false, disableClosedCaptionsDetection: false, allowLowLatencyByteRangeOptimization: true, allowRangeRequestsToGuessMimeType: false },
            mss: {
              manifestPreprocessor: Kn,
              manifestPreprocessorTXml: Ln,
              sequenceMode: false,
              keySystemsBySystemId: { "9a04f079-9840-4286-ab92-e65be0885f95": "com.microsoft.playready", "79f0049a-4098-8642-ab92-e65be0885f95": "com.microsoft.playready" }
            }
          };
          var e = {
            retryParameters: Sg(),
            failureCallback: function(m) {
              return rn([m]);
            },
            rebufferingGoal: 0,
            bufferingGoal: 10,
            bufferBehind: 30,
            evictionGoal: 1,
            ignoreTextStreamFailures: false,
            alwaysStreamText: false,
            startAtSegmentBoundary: false,
            gapDetectionThreshold: 0.5,
            gapPadding: 0,
            gapJumpTimerTime: 0.25,
            durationBackoff: 1,
            safeSeekOffset: 5,
            safeSeekEndOffset: 0,
            stallEnabled: true,
            stallThreshold: 1,
            stallSkip: 0.1,
            useNativeHlsForFairPlay: true,
            inaccurateManifestTolerance: 2,
            lowLatencyMode: false,
            forceHTTP: false,
            forceHTTPS: false,
            minBytesForProgressEvents: 16e3,
            preferNativeDash: false,
            preferNativeHls: false,
            updateIntervalSeconds: 1,
            observeQualityChanges: false,
            maxDisabledTime: 30,
            segmentPrefetchLimit: 1,
            prefetchAudioLanguages: [],
            disableAudioPrefetch: false,
            disableTextPrefetch: false,
            disableVideoPrefetch: false,
            liveSync: {
              enabled: false,
              targetLatency: 0.5,
              targetLatencyTolerance: 0.5,
              maxPlaybackRate: 1.1,
              minPlaybackRate: 0.95,
              panicMode: false,
              panicThreshold: 60,
              dynamicTargetLatency: { enabled: false, stabilityThreshold: 60, rebufferIncrement: 0.5, maxAttempts: 10, maxLatency: 4, minLatency: 1 }
            },
            allowMediaSourceRecoveries: true,
            minTimeBetweenRecoveries: 5,
            vodDynamicPlaybackRate: false,
            vodDynamicPlaybackRateLowBufferRate: 0.95,
            vodDynamicPlaybackRateBufferRatio: 0.5,
            preloadNextUrlWindow: 30,
            loadTimeout: 30,
            clearDecodingCache: uc() || tc(),
            dontChooseCodecs: false,
            shouldFixTimestampOffset: nc() || lc(),
            avoidEvictionOnQuotaExceededError: false,
            crossBoundaryStrategy: "keep"
          };
          if (nc() || lc() || qc() || vc()) e.stallSkip = 0;
          if (navigator.userAgent.match(/Edge\//) || jc()) e.gapPadding = 0.01;
          lc() && (e.gapPadding = 2);
          oc() && (e.crossBoundaryStrategy = "reset");
          mc() && (e.crossBoundaryStrategy = "reset_to_encrypted");
          var f = { trackSelectionCallback: function(m) {
            return Q(function(n) {
              return n.return(m);
            });
          }, downloadSizeCallback: function(m) {
            var n;
            return Q(function(p) {
              if (1 == p.g) return navigator.storage && navigator.storage.estimate ? F(p, navigator.storage.estimate(), 3) : p.return(true);
              n = p.h;
              return p.return(n.usage + m < 0.95 * n.quota);
            });
          }, progressCallback: function(m, n) {
            return rn([m, n]);
          }, usePersistentLicense: true, numberOfParallelDownloads: 5 };
          a = { enabled: true, useNetworkInformation: true, defaultBandwidthEstimate: 1e6, switchInterval: 8, bandwidthUpgradeTarget: 0.85, bandwidthDowngradeTarget: 0.95, restrictions: { minWidth: 0, maxWidth: Infinity, minHeight: 0, maxHeight: a, minPixels: 0, maxPixels: Infinity, minFrameRate: 0, maxFrameRate: Infinity, minBandwidth: 0, maxBandwidth: Infinity, minChannelsCount: 0, maxChannelsCount: Infinity }, advanced: {
            minTotalBytes: 128e3,
            minBytes: 16e3,
            fastHalfLife: 2,
            slowHalfLife: 5
          }, restrictToElementSize: false, restrictToScreenSize: false, ignoreDevicePixelRatio: false, clearBufferSwitch: false, safeMarginSwitch: 0, cacheLoadThreshold: 20, minTimeToSwitch: rc() ? 0.5 : 0, preferNetworkInformationBandwidth: false };
          c = { codecSwitchingStrategy: c, addExtraFeaturesToSourceBuffer: function(m) {
            return rn([m], "");
          }, forceTransmux: false, insertFakeEncryptionInInit: true, modifyCueCallback: function(m, n) {
            return rn([m, n]);
          }, dispatchAllEmsgBoxes: false };
          var g = false, h = false, k2 = true;
          Ac() && (h = g = true, k2 = false);
          var l = {
            drm: b,
            manifest: d,
            streaming: e,
            mediaSource: c,
            offline: f,
            abrFactory: function() {
              return new Mg();
            },
            adaptationSetCriteriaFactory: function() {
              return new (Function.prototype.bind.apply(yn, [null].concat(y(Na.apply(0, arguments)))))();
            },
            abr: a,
            autoShowText: 3,
            preferredAudioLanguage: "",
            preferredAudioLabel: "",
            preferredTextLanguage: "",
            preferredVariantRole: "",
            preferredTextRole: "",
            preferredAudioChannelCount: 2,
            preferredVideoHdrLevel: "AUTO",
            preferredVideoLayout: "",
            preferredVideoLabel: "",
            preferredVideoCodecs: [],
            preferredAudioCodecs: [],
            preferredTextFormats: [],
            preferForcedSubs: false,
            preferSpatialAudio: false,
            preferredDecodingAttributes: [],
            restrictions: { minWidth: 0, maxWidth: Infinity, minHeight: 0, maxHeight: Infinity, minPixels: 0, maxPixels: Infinity, minFrameRate: 0, maxFrameRate: Infinity, minBandwidth: 0, maxBandwidth: Infinity, minChannelsCount: 0, maxChannelsCount: Infinity },
            playRangeStart: 0,
            playRangeEnd: Infinity,
            textDisplayer: { captionsUpdatePeriod: 0.25, fontScaleFactor: 1 },
            textDisplayFactory: function() {
              return null;
            },
            cmcd: {
              enabled: false,
              sessionId: "",
              contentId: "",
              rtpSafetyFactor: 5,
              useHeaders: false,
              includeKeys: [],
              version: 1
            },
            cmsd: { enabled: true, applyMaximumSuggestedBitrate: true, estimatedThroughputWeightRatio: 0.5 },
            lcevc: { enabled: false, dynamicPerformanceScaling: true, logLevel: 0, drawLogo: false, poster: true },
            ads: { customPlayheadTracker: g, skipPlayDetection: h, supportsMultipleMediaElements: k2, disableHLSInterstitial: false, disableDASHInterstitial: false, allowPreloadOnDomElements: true },
            ignoreHardwareResolution: false
          };
          f.trackSelectionCallback = function(m) {
            return Q(function(n) {
              return n.return(Mn(
                m,
                l.preferredAudioLanguage,
                l.preferredVideoHdrLevel
              ));
            });
          };
          return l;
        }
        function Nn() {
          return { streaming: { inaccurateManifestTolerance: 0, segmentPrefetchLimit: 2, updateIntervalSeconds: 0.1, maxDisabledTime: 1, retryParameters: { baseDelay: 100 } }, manifest: { dash: { autoCorrectDrift: false }, retryParameters: { baseDelay: 100 } }, drm: { retryParameters: { baseDelay: 100 } } };
        }
        function On(a, b, c) {
          var d = { ".drm.keySystemsMapping": "", ".drm.servers": "", ".drm.clearKeys": "", ".drm.advanced": { distinctiveIdentifierRequired: false, persistentStateRequired: false, videoRobustness: [], audioRobustness: [], sessionType: "", serverCertificate: new Uint8Array(0), serverCertificateUri: "", individualizationServer: "", headers: {} } };
          return pn(a, b, c || Jn(), d, "");
        }
        function Mn(a, b, c) {
          var d = c;
          "AUTO" == d && (c = a.some(function(h) {
            return h.hdr && "HLG" == h.hdr ? true : false;
          }), d = Fc(c));
          var e = a.filter(function(h) {
            return "variant" != h.type || h.hdr && h.hdr != d ? false : true;
          });
          c = [];
          var f = ag(b, e.map(function(h) {
            return h.language;
          }));
          f && (c = e.filter(function(h) {
            return Of(h.language) == f;
          }));
          0 == c.length && (c = e.filter(function(h) {
            return h.primary;
          }));
          0 == c.length && (e.map(function(h) {
            return h.language;
          }), c = e);
          var g = c.filter(function(h) {
            return h.height && 480 >= h.height;
          });
          g.length && (g.sort(function(h, k2) {
            return k2.height - h.height;
          }), c = g.filter(function(h) {
            return h.height == g[0].height;
          }));
          b = [];
          c.length && (e = Math.floor(c.length / 2), c.sort(function(h, k2) {
            return h.bandwidth - k2.bandwidth;
          }), b.push(c[e]));
          a = t(a);
          for (c = a.next(); !c.done; c = a.next()) c = c.value, c.type != dd && "image" != c.type || b.push(c);
          return b;
        }
        function Kn(a) {
          return rn([a], a);
        }
        function Ln(a) {
          return rn([a], a);
        }
        T("shaka.util.PlayerConfiguration", In);
        In.mergeConfigObjects = On;
        In.createDefaultForLL = Nn;
        In.createDefault = Jn;
        function Pn() {
          this.g = null;
          this.h = [];
        }
        function Qn(a, b) {
          var c = 0;
          a.g && a.g.state == b && (c += a.g.duration);
          a = t(a.h);
          for (var d = a.next(); !d.done; d = a.next()) d = d.value, c += d.state == b ? d.duration : 0;
          return c;
        }
        function Rn(a) {
          function b(f) {
            return { timestamp: f.timestamp, state: f.state, duration: f.duration };
          }
          for (var c = [], d = t(a.h), e = d.next(); !e.done; e = d.next()) c.push(b(e.value));
          a.g && c.push(b(a.g));
          return c;
        }
        function go() {
          this.i = this.h = null;
          this.g = [];
        }
        function ho(a, b, c) {
          a.i != b && (a.i = b, a.g.push({ timestamp: Date.now() / 1e3, id: b.id, type: "text", fromAdaptation: c, bandwidth: null }));
        }
        function io() {
          this.mc = this.bh = this.u = this.A = this.I = this.B = this.o = this.j = this.H = this.C = this.i = this.P = this.T = this.L = this.M = this.O = this.l = this.m = NaN;
          this.K = 0;
          this.F = this.G = NaN;
          this.g = new Pn();
          this.h = new go();
        }
        function jo(a, b, c, d) {
          dh.call(this);
          this.O = a;
          this.Y = b;
          this.Fa = d.networkingEngine;
          this.B = c;
          this.o = null;
          this.ya = 0;
          this.Ma = d.Lc;
          this.F = d.Zi;
          this.Na = d.$i;
          this.g = d.config;
          this.l = this.G = this.h = null;
          this.pa = false;
          this.H = d.kj;
          this.sa = false;
          this.i = null;
          this.ka = false;
          this.j = this.C = null;
          this.ea = false;
          this.M = /* @__PURE__ */ new Map();
          this.Aa = false;
          this.Ga = d.jj;
          this.Z = new io();
          this.oa = new Ug();
          this.m = new Ug();
          this.P = null;
          this.u = false;
          this.fa = d.Uh;
          this.W = this.K = null;
          this.La = d.Th;
          this.T = false;
          this.L = [];
          this.I = [];
          this.A = true;
        }
        qa(jo, dh);
        function ko(a, b, c) {
          (a = b ? a.I : a.L) ? a.push(c) : c();
        }
        function lo(a) {
          if (a.I) for (var b = t(a.I), c = b.next(); !c.done; c = b.next()) c = c.value, c();
          a.I = null;
        }
        function mo(a, b) {
          a.P = b;
          a.T = true;
          if (a.L) {
            b = t(a.L);
            for (var c = b.next(); !c.done; c = b.next()) c = c.value, c();
          }
          a.L = null;
        }
        r = jo.prototype;
        r.getStartTime = function() {
          return this.B;
        };
        r.Qc = function() {
          return this.O;
        };
        r.Hf = function() {
          return this.h;
        };
        function no(a) {
          a.ea = true;
          return a.j;
        }
        function oo(a) {
          a.sa = true;
          return a.H;
        }
        r.getStats = function() {
          return this.Z;
        };
        function po(a) {
          a.ka = true;
          return a.i;
        }
        r.Ai = function() {
          return this.K ? xg(this.K) : null;
        };
        r.zi = function() {
          return this.W ? yg(this.W) : null;
        };
        function qo(a) {
          a.Aa = true;
          return a.M;
        }
        r.start = function() {
          var a = this;
          (function() {
            var b;
            return Q(function(c) {
              switch (c.g) {
                case 1:
                  return F(c, Promise.resolve(), 2);
                case 2:
                  return xa(c, 3), F(c, ro(a), 5);
                case 5:
                  so(a);
                  if ("webkit" === window2.shakaMediaKeysPolyfill) {
                    c.s(6);
                    break;
                  }
                  return F(c, to(a), 7);
                case 7:
                  so(a);
                case 6:
                  return F(c, uo(a), 8);
                case 8:
                  so(a);
                  if (!a.fa || !a.i) {
                    c.s(9);
                    break;
                  }
                  return F(c, yi(a.i), 10);
                case 10:
                  so(a);
                case 9:
                  a.m.resolve();
                  Aa(c, 0);
                  break;
                case 3:
                  b = Ba(c), b instanceof U && (7001 == b.code || 7003 == b.code) || a.m.reject(b), I(c);
              }
            });
          })();
        };
        r.dispatchEvent = function(a) {
          return this.P ? this.P.dispatchEvent(a) : dh.prototype.dispatchEvent.call(this, a);
        };
        r.onError = function(a) {
          2 === a.severity && (this.m.reject(a), this.destroy());
          var b = (/* @__PURE__ */ new Map()).set("detail", a);
          b = new V("error", b);
          this.dispatchEvent(b);
          b.defaultPrevented && (a.handled = true);
        };
        function so(a) {
          if (a.u) throw new U(2, 7, 7003);
        }
        function vo(a, b) {
          a.dispatchEvent(new V("onstatechange", (/* @__PURE__ */ new Map()).set("state", b)));
        }
        function ro(a) {
          var b, c, d, e, f, g, h, k2, l;
          return Q(function(m) {
            switch (m.g) {
              case 1:
                vo(a, "manifest-parser");
                a.l || (a.G = Vi(a.O, a.Y), a.l = a.G(), a.l.configure(a.g.manifest, function() {
                  return a.A;
                }));
                b = Date.now() / 1e3;
                vo(a, "manifest");
                if (a.h) {
                  m.s(2);
                  break;
                }
                return F(m, a.l.start(a.O, a.Na), 3);
              case 3:
                a.h = m.h;
                if (1 != a.h.variants.length) {
                  m.s(2);
                  break;
                }
                c = [];
                d = a.h.variants[0];
                e = t([d.video, d.audio]);
                for (f = e.next(); !f.done; f = e.next()) (g = f.value) && !g.segmentIndex && c.push(g.createSegmentIndex());
                if (!(0 < c.length)) {
                  m.s(2);
                  break;
                }
                return F(
                  m,
                  Promise.all(c),
                  2
                );
              case 2:
                return a.oa.resolve(), h = new V("manifestparsed", void 0), F(m, Promise.resolve(), 7);
              case 7:
                a.dispatchEvent(h);
                if (0 == a.h.variants.length) throw new U(2, 4, 4036);
                wo(a.h);
                k2 = Date.now() / 1e3;
                l = k2 - b;
                a.Z.H = l;
                I(m);
            }
          });
        }
        function to(a, b) {
          var c, d, e, f, g, h;
          return Q(function(k2) {
            switch (k2.g) {
              case 1:
                if (!a.h || a.i) return k2.return();
                vo(a, "drm-engine");
                a.ya = Date.now() / 1e3;
                a.i = a.Ma();
                a.F.h = a.i;
                a.i.configure(a.g.drm, function() {
                  return a.A;
                });
                c = Ni(a.F, a.h);
                if (!c) {
                  k2.s(2);
                  break;
                }
                d = new V("trackschanged", void 0);
                return F(k2, Promise.resolve(), 3);
              case 3:
                so(a), a.dispatchEvent(d);
              case 2:
                return e = Hg(a.h.variants), f = true, a.h && a.h.presentationTimeline && "HLS" != a.h.type && (f = a.h.presentationTimeline.U()), F(k2, Zh(a.i, e, a.h.offlineSessionIds, f), 4);
              case 4:
                so(a);
                if (!b) {
                  k2.s(5);
                  break;
                }
                return F(k2, a.i.Lb(b), 6);
              case 6:
                so(a);
              case 5:
                return F(k2, Li(a.F, a.h), 7);
              case 7:
                g = k2.h;
                if (!g) {
                  k2.s(0);
                  break;
                }
                h = new V("trackschanged", void 0);
                return F(k2, Promise.resolve(), 9);
              case 9:
                a.dispatchEvent(h), I(k2);
            }
          });
        }
        r.configure = function(a, b) {
          a = qn(a, b);
          On(this.g, a);
        };
        r.getConfiguration = function() {
          return Nd(this.g);
        };
        function uo(a) {
          var b, c, d, e, f, g, h;
          return Q(function(k2) {
            a.o || (a.o = a.g.adaptationSetCriteriaFactory(), a.o.configure({ language: a.g.preferredAudioLanguage, role: a.g.preferredVariantRole, channelCount: a.g.preferredAudioChannelCount, Sc: a.g.preferredVideoHdrLevel, spatialAudio: a.g.preferSpatialAudio, videoLayout: a.g.preferredVideoLayout, Kc: a.g.preferredAudioLabel, fd: a.g.preferredVideoLabel, codecSwitchingStrategy: a.g.mediaSource.codecSwitchingStrategy, audioCodec: "" }));
            a.La && (b = a.g.abrFactory, a.C = b, a.j = b(), a.j.configure(a.g.abr));
            if (!a.fa) return k2.s(0);
            c = a.h.presentationTimeline.U();
            d = Hg(a.h.variants);
            e = a.o.create(d);
            a.j.configure(a.g.abr);
            a.j.setVariants(Array.from(e.values()));
            f = a.j.chooseVariant();
            if (!f) return k2.s(0);
            g = [];
            a.K = f;
            f.video && g.push(xo(a, f.video, c));
            f.audio && g.push(xo(a, f.audio, c));
            (h = Ig(a.h.textStreams, a.g.preferredTextLanguage, a.g.preferredTextRole, a.g.preferForcedSubs)[0] || null) && Lg(f.audio, h, a.g) && (g.push(xo(a, h, c)), a.W = h);
            return F(k2, Promise.all(g), 0);
          });
        }
        function xo(a, b, c) {
          var d, e, f, g, h;
          return Q(function(k2) {
            if (1 == k2.g) return d = a.g.streaming.segmentPrefetchLimit || 2, e = new im(d, b, function(l, m, n) {
              return Xm(l, m, n || null, a.g.streaming.retryParameters, a.Fa, a.A);
            }, false), a.M.set(b.id, e), b.segmentIndex ? k2.s(2) : F(k2, b.createSegmentIndex(), 2);
            f = a.B || 0;
            g = b.segmentIndex.Gb(f);
            h = null;
            g && (h = g.current(), h || (h = g.next().value));
            h || (h = Ag(b.segmentIndex));
            return h ? c ? h.$ ? F(k2, lm(e, h.$), 0) : k2.s(0) : F(k2, km(e, h.startTime), 0) : k2.s(0);
          });
        }
        r.Lj = function() {
          return this.m;
        };
        r.destroy = function() {
          var a = this, b, c, d;
          return Q(function(e) {
            switch (e.g) {
              case 1:
                a.u = true;
                if (!a.l || a.pa) {
                  e.s(2);
                  break;
                }
                return F(e, a.l.stop(), 2);
              case 2:
                if (!a.j || a.ea) {
                  e.s(4);
                  break;
                }
                return F(e, a.j.stop(), 4);
              case 4:
                a.H && !a.sa && a.H.release();
                if (!a.i || a.ka) {
                  e.s(6);
                  break;
                }
                return F(e, a.i.destroy(), 6);
              case 6:
                if (0 < a.M.size && !a.Aa) for (b = t(a.M.values()), c = b.next(); !c.done; c = b.next()) d = c.value, rm(d);
                I(e);
            }
          });
        };
        function wo(a) {
          function b(c) {
            return c.video && c.audio || c.video && c.video.codecs.includes(",");
          }
          a.variants.some(b) && (a.variants = a.variants.filter(b));
        }
        T("shaka.media.PreloadManager", jo);
        jo.prototype.destroy = jo.prototype.destroy;
        jo.prototype.waitForFinish = jo.prototype.Lj;
        jo.prototype.getPrefetchedTextTrack = jo.prototype.zi;
        jo.prototype.getPrefetchedVariantTrack = jo.prototype.Ai;
        function yo(a, b) {
          dh.call(this);
          var c = this;
          this.i = a;
          this.l = b;
          this.g = /* @__PURE__ */ new Map();
          this.m = [{ Jc: null, Ic: zo, xc: function(d, e) {
            return Ao(c, "enter", d, e);
          } }, { Jc: Bo, Ic: zo, xc: function(d, e) {
            return Ao(c, "enter", d, e);
          } }, { Jc: Co, Ic: zo, xc: function(d, e) {
            return Ao(c, "enter", d, e);
          } }, { Jc: zo, Ic: Bo, xc: function(d, e) {
            return Ao(c, "exit", d, e);
          } }, { Jc: zo, Ic: Co, xc: function(d, e) {
            return Ao(c, "exit", d, e);
          } }, { Jc: Bo, Ic: Co, xc: function(d, e) {
            e ? Ao(c, "skip", d, e) : (Ao(c, "enter", d, e), Ao(c, "exit", d, e));
          } }, { Jc: Co, Ic: Bo, xc: function(d, e) {
            return Ao(
              c,
              "skip",
              d,
              e
            );
          } }];
          this.h = new lb();
          this.h.D(this.i, "regionremove", function(d) {
            c.g.delete(d.region);
          });
        }
        qa(yo, dh);
        yo.prototype.release = function() {
          this.i = null;
          this.g.clear();
          this.h.release();
          this.h = null;
          dh.prototype.release.call(this);
        };
        yo.prototype.j = function(a, b) {
          if (!this.l || 0 != a) {
            this.l = false;
            for (var c = t(this.i.h.values()), d = c.next(); !d.done; d = c.next()) {
              d = d.value;
              var e = this.g.get(d), f = a < d.startTime ? Bo : a > d.endTime ? Co : zo;
              this.g.set(d, f);
              for (var g = t(this.m), h = g.next(); !h.done; h = g.next()) h = h.value, h.Jc == e && h.Ic == f && h.xc(d, b);
            }
          }
        };
        function Ao(a, b, c, d) {
          b = new V(b, /* @__PURE__ */ new Map([["region", c], ["seeking", d]]));
          a.dispatchEvent(b);
        }
        var Bo = 1, zo = 2, Co = 3;
        function Do(a, b, c) {
          var d, e, f, g, h, k2, l;
          return Q(function(m) {
            switch (m.g) {
              case 1:
                var n = new yb(a).ab.split("/").pop().split(".");
                d = 1 == n.length ? "" : n.pop().toLowerCase();
                if (e = Eo.get(d)) return m.return(e);
                f = 0;
                g = lh([a], c);
                xa(m, 2);
                g.method = "HEAD";
                return F(m, b.request(f, g).promise, 4);
              case 4:
                h = m.h;
                e = h.headers["content-type"];
                Aa(m, 3);
                break;
              case 2:
                k2 = Ba(m);
                if (!k2 || 1002 != k2.code && 1001 != k2.code) {
                  m.s(3);
                  break;
                }
                g.method = "GET";
                return F(m, b.request(f, g).promise, 6);
              case 6:
                l = m.h, e = l.headers["content-type"];
              case 3:
                return m.return(e ? e.toLowerCase().split(";").shift() : "");
            }
          });
        }
        var Eo = (/* @__PURE__ */ new Map()).set("mp4", "video/mp4").set("m4v", "video/mp4").set("m4a", "audio/mp4").set("webm", "video/webm").set("weba", "audio/webm").set("mkv", "video/webm").set("ts", "video/mp2t").set("ogv", "video/ogg").set("ogg", "audio/ogg").set("mpg", "video/mpeg").set("mpeg", "video/mpeg").set("mov", "video/quicktime").set("m3u8", "application/x-mpegurl").set("mpd", "application/dash+xml").set("ism", "application/vnd.ms-sstr+xml").set("mp3", "audio/mpeg").set("aac", "audio/aac").set("flac", "audio/flac").set("wav", "audio/wav").set(
          "sbv",
          "text/x-subviewer"
        ).set("srt", "text/srt").set("vtt", "text/vtt").set("webvtt", "text/vtt").set("ttml", "application/ttml+xml").set("lrc", "application/x-subtitle-lrc").set("ssa", "text/x-ssa").set("ass", "text/x-ssa").set("jpeg", "image/jpeg").set("jpg", "image/jpeg").set("png", "image/png").set("svg", "image/svg+xml").set("webp", "image/webp").set("avif", "image/avif").set("html", "text/html").set("htm", "text/html");
        function Fo(a, b) {
          if (a.lineBreak) return "\n";
          if (a.nestedCues.length) return a.nestedCues.map(function(g) {
            return Fo(g, a);
          }).join("");
          if (!a.payload) return a.payload;
          var c = [], d = a.fontWeight >= Ve, e = a.fontStyle == We, f = a.textDecoration.includes(Xe);
          d && c.push(["b"]);
          e && c.push(["i"]);
          f && c.push(["u"]);
          e = a.color;
          "" == e && b && (e = b.color);
          d = "";
          (e = Go(e)) && (d += "." + e);
          e = a.backgroundColor;
          "" == e && b && (e = b.backgroundColor);
          (b = Go(e)) && (d += ".bg_" + b);
          d && c.push(["c", d]);
          return c.reduceRight(function(g, h) {
            var k2 = t(h);
            h = k2.next().value;
            k2 = k2.next().value;
            return "<" + h + (void 0 === k2 ? "" : k2) + ">" + g + "</" + h + ">";
          }, a.payload);
        }
        function Go(a) {
          a = a.toLowerCase();
          var b = a.replace(/\s/g, "").match(/^rgba?\((\d+),(\d+),(\d+),?([^,\s)]+)?/i);
          b ? a = "#" + (parseInt(b[1], 10) | 256).toString(16).slice(1) + (parseInt(b[2], 10) | 256).toString(16).slice(1) + (parseInt(b[3], 10) | 256).toString(16).slice(1) : a.startsWith("#") && 7 < a.length && (a = a.slice(0, 7));
          switch (a) {
            case "white":
            case "#fff":
            case "#ffffff":
              return "white";
            case "lime":
            case "#0f0":
            case "#00ff00":
              return "lime";
            case "cyan":
            case "#0ff":
            case "#00ffff":
              return "cyan";
            case "red":
            case "#f00":
            case "#ff0000":
              return "red";
            case "yellow":
            case "#ff0":
            case "#ffff00":
              return "yellow";
            case "magenta":
            case "#f0f":
            case "#ff00ff":
              return "magenta";
            case "blue":
            case "#00f":
            case "#0000ff":
              return "blue";
            case "black":
            case "#000":
            case "#000000":
              return "black";
          }
          return null;
        }
        function Ho(a, b) {
          var c = [];
          a = t(Io(a));
          for (var d = a.next(); !d.done; d = a.next()) if (d = d.value, d.isContainer) c.push.apply(c, y(Ho(d.nestedCues, d)));
          else {
            var e = d.clone();
            e.nestedCues = [];
            e.payload = Fo(d, b);
            c.push(e);
          }
          return c;
        }
        function Io(a) {
          var b = [];
          a = t(a);
          for (var c = a.next(), d = {}; !c.done; d = { jf: void 0 }, c = a.next()) d.jf = c.value, b.some(/* @__PURE__ */ function(e) {
            return function(f) {
              return Le(e.jf, f);
            };
          }(d)) || b.push(d.jf);
          return b;
        }
        function Jo(a) {
          function b(d) {
            for (var e = 5381, f = d.length; f; ) e = 33 * e ^ d.charCodeAt(--f);
            return (e >>> 0).toString();
          }
          if (a.startTime >= a.endTime) return null;
          var c = new VTTCue(a.startTime, a.endTime, a.payload);
          c.id = b(a.startTime.toString()) + b(a.endTime.toString()) + b(a.payload);
          c.lineAlign = a.lineAlign;
          c.positionAlign = a.positionAlign;
          a.size && (c.size = a.size);
          try {
            c.align = a.textAlign;
          } catch (d) {
          }
          "center" == a.textAlign && "center" != c.align && (c.align = "middle");
          "vertical-lr" == a.writingMode ? c.vertical = "lr" : "vertical-rl" == a.writingMode && (c.vertical = "rl");
          1 == a.lineInterpretation && (c.snapToLines = false);
          null != a.line && (c.line = a.line);
          null != a.position && (c.position = a.position);
          return c;
        }
        function Ko(a, b) {
          this.h = a;
          this.i = b;
          this.g = null;
          a = t(Array.from(this.h.textTracks));
          for (b = a.next(); !b.done; b = a.next()) b = b.value, "metadata" !== b.kind && "chapters" !== b.kind && (b.mode = "disabled", b.label == this.i && (this.g = b));
          this.g && (this.g.mode = "hidden");
        }
        r = Ko.prototype;
        r.configure = function() {
        };
        r.remove = function(a, b) {
          if (!this.g) return false;
          Lo(this.g, function(c) {
            return c.startTime < b && c.endTime > a;
          });
          return true;
        };
        r.append = function(a) {
          if (this.g) {
            var b = Ho(a), c = [];
            a = this.g.cues ? Array.from(this.g.cues) : [];
            b = t(b);
            for (var d = b.next(), e = {}; !d.done; e = { Tc: void 0 }, d = b.next()) e.Tc = d.value, !a.some(/* @__PURE__ */ function(f) {
              return function(g) {
                return g.startTime == f.Tc.startTime && g.endTime == f.Tc.endTime && g.text == f.Tc.payload ? true : false;
              };
            }(e)) && e.Tc.payload && (d = Jo(e.Tc)) && c.push(d);
            a = c.slice().sort(function(f, g) {
              return f.startTime != g.startTime ? f.startTime - g.startTime : f.endTime != g.endTime ? f.endTime - g.startTime : "line" in VTTCue.prototype ? c.indexOf(g) - c.indexOf(f) : c.indexOf(f) - c.indexOf(g);
            });
            a = t(a);
            for (b = a.next(); !b.done; b = a.next()) this.g.addCue(b.value);
          }
        };
        r.destroy = function() {
          this.g && (Lo(this.g, function() {
            return true;
          }), this.g.mode = "disabled");
          this.g = this.h = null;
          return Promise.resolve();
        };
        r.isTextVisible = function() {
          return this.g ? "showing" == this.g.mode : false;
        };
        r.setTextVisibility = function(a) {
          a && !this.g && Mo(this);
          this.g && (this.g.mode = a ? "showing" : "hidden");
        };
        r.setTextLanguage = function() {
        };
        r.enableTextDisplayer = function() {
          Mo(this);
        };
        function Mo(a) {
          a.h && !a.g && (a.g = a.h.addTextTrack("subtitles", a.i), a.g.mode = "hidden");
        }
        function Lo(a, b) {
          var c = a.mode;
          a.mode = "showing" == c ? "showing" : "hidden";
          for (var d = t(Array.from(a.cues)), e = d.next(); !e.done; e = d.next()) (e = e.value) && b(e) && a.removeCue(e);
          a.mode = c;
        }
        T("shaka.text.SimpleTextDisplayer", Ko);
        Ko.prototype.enableTextDisplayer = Ko.prototype.enableTextDisplayer;
        Ko.prototype.setTextLanguage = Ko.prototype.setTextLanguage;
        Ko.prototype.setTextVisibility = Ko.prototype.setTextVisibility;
        Ko.prototype.isTextVisible = Ko.prototype.isTextVisible;
        Ko.prototype.destroy = Ko.prototype.destroy;
        Ko.prototype.append = Ko.prototype.append;
        Ko.prototype.remove = Ko.prototype.remove;
        Ko.prototype.configure = Ko.prototype.configure;
        function No() {
        }
        r = No.prototype;
        r.configure = function() {
        };
        r.remove = function() {
        };
        r.append = function() {
        };
        r.destroy = function() {
        };
        r.isTextVisible = function() {
          return false;
        };
        r.setTextVisibility = function() {
        };
        r.setTextLanguage = function() {
        };
        r.enableTextDisplayer = function() {
        };
        T("shaka.text.StubTextDisplayer", No);
        No.prototype.enableTextDisplayer = No.prototype.enableTextDisplayer;
        No.prototype.setTextLanguage = No.prototype.setTextLanguage;
        No.prototype.setTextVisibility = No.prototype.setTextVisibility;
        No.prototype.isTextVisible = No.prototype.isTextVisible;
        No.prototype.destroy = No.prototype.destroy;
        No.prototype.append = No.prototype.append;
        No.prototype.remove = No.prototype.remove;
        No.prototype.configure = No.prototype.configure;
        function Oo(a, b) {
          var c = this;
          document.fullscreenEnabled || bb("Using UITextDisplayer in a browser without Fullscreen API support causes subtitles to not be rendered in fullscreen");
          this.A = false;
          this.h = [];
          this.j = a;
          this.C = b;
          this.u = this.m = null;
          this.g = document.createElement("div");
          this.g.classList.add("shaka-text-container");
          this.g.style.textAlign = "center";
          this.g.style.display = "flex";
          this.g.style.flexDirection = "column";
          this.g.style.alignItems = "center";
          this.g.style.justifyContent = "flex-end";
          this.C.appendChild(this.g);
          this.o = new ec(function() {
            c.j.paused || Po(c);
          });
          Qo(this);
          this.l = /* @__PURE__ */ new Map();
          this.i = new lb();
          this.i.D(document, "fullscreenchange", function() {
            Po(c, true);
          });
          this.i.D(this.j, "seeking", function() {
            Po(c, true);
          });
          this.i.D(this.j, "ratechange", function() {
            Qo(c);
          });
          this.i.D(this.j, "resize", function() {
            var d = c.j, e = d.videoWidth;
            d = d.videoHeight;
            e && d ? c.m = e / d : c.m = null;
          });
          this.B = null;
          "ResizeObserver" in window2 && (this.B = new ResizeObserver(function() {
            Po(c, true);
          }), this.B.observe(this.g));
          this.F = /* @__PURE__ */ new Map();
        }
        r = Oo.prototype;
        r.configure = function(a) {
          this.u = a;
          Qo(this);
          Po(this, true);
        };
        r.append = function(a) {
          var b = [].concat(y(this.h));
          a = t(Io(a));
          for (var c = a.next(), d = {}; !c.done; d = { kf: void 0 }, c = a.next()) d.kf = c.value, b.some(/* @__PURE__ */ function(e) {
            return function(f) {
              return Le(f, e.kf);
            };
          }(d)) || this.h.push(d.kf);
          this.h.length && Qo(this);
          Po(this);
        };
        r.destroy = function() {
          if (!this.g) return Promise.resolve();
          this.C.removeChild(this.g);
          this.g = null;
          this.A = false;
          this.h = [];
          this.o && (this.o.stop(), this.o = null);
          this.l.clear();
          this.i && (this.i.release(), this.i = null);
          this.B && (this.B.disconnect(), this.B = null);
          return Promise.resolve();
        };
        r.remove = function(a, b) {
          if (!this.g) return false;
          var c = this.h.length;
          this.h = this.h.filter(function(d) {
            return d.startTime < a || d.endTime >= b;
          });
          Po(this, c > this.h.length);
          this.h.length || Qo(this);
          return true;
        };
        r.isTextVisible = function() {
          return this.A;
        };
        r.setTextVisibility = function(a) {
          this.A = a;
          Po(this, true);
        };
        r.setTextLanguage = function(a) {
          a && "und" != a ? this.g.setAttribute("lang", a) : this.g.setAttribute("lang", "");
        };
        r.enableTextDisplayer = function() {
        };
        function Qo(a) {
          a.o && (a.h.length ? a.o.ua((a.u ? a.u.captionsUpdatePeriod : 0.25) / Math.max(1, Math.abs(a.j.playbackRate))) : a.o.stop());
        }
        function Ro(a, b) {
          for (; null != b; ) {
            if (b == a.g) return true;
            b = b.parentElement;
          }
          return false;
        }
        function So(a, b, c, d, e) {
          var f = false, g = [], h = [];
          b = t(b);
          for (var k2 = b.next(); !k2.done; k2 = b.next()) {
            k2 = k2.value;
            e.push(k2);
            var l = a.l.get(k2), m = k2.startTime <= d && k2.endTime > d, n = l ? l.Nh : null;
            l && (g.push(l.lf), l.Ec && g.push(l.Ec), m || (f = true, a.l.delete(k2), l = null));
            m && (h.push(k2), l ? Ro(a, n) || (f = true) : (To(a, k2, e), l = a.l.get(k2), n = l.Nh, f = true));
            0 < k2.nestedCues.length && n && So(a, k2.nestedCues, n, d, e);
            e.pop();
          }
          if (f) {
            d = t(g);
            for (e = d.next(); !e.done; e = d.next()) e = e.value, e.parentElement && e.parentElement.removeChild(e);
            h.sort(function(p, q) {
              return p.startTime != q.startTime ? p.startTime - q.startTime : p.endTime - q.endTime;
            });
            h = t(h);
            for (d = h.next(); !d.done; d = h.next()) d = a.l.get(d.value), d.Ec ? (d.Ec.contains(c) && d.Ec.removeChild(c), c.appendChild(d.Ec), d.Ec.appendChild(d.lf)) : c.appendChild(d.lf);
          }
        }
        function Po(a, b) {
          if (a.g) {
            var c = a.j.currentTime;
            if (!a.A || (void 0 === b ? 0 : b)) {
              b = t(a.F.values());
              for (var d = b.next(); !d.done; d = b.next()) Zj(d.value);
              Zj(a.g);
              a.l.clear();
              a.F.clear();
            }
            a.A && So(a, a.h, a.g, c, []);
          }
        }
        function To(a, b, c) {
          var d = 1 < c.length, e = d ? "span" : "div";
          b.lineBreak && (e = "br");
          b.rubyTag && (e = b.rubyTag);
          d = !d && 0 < b.nestedCues.length;
          var f = document.createElement(e);
          "br" != e && Uo(a, f, b, c, d);
          c = null;
          if (b.region && b.region.id) {
            var g = b.region, h = a.m === 4 / 3 ? 2.5 : 1.9;
            c = g.id + "_" + g.width + "x" + g.height + (g.heightUnits == zd ? "%" : "px") + "-" + g.viewportAnchorX + "x" + g.viewportAnchorY + (g.viewportAnchorUnits == zd ? "%" : "px");
            if (a.F.has(c)) c = a.F.get(c);
            else {
              e = document.createElement("span");
              var k2 = g.heightUnits == zd ? "%" : "px", l = g.widthUnits == zd ? "%" : "px", m = g.viewportAnchorUnits == zd ? "%" : "px";
              e.id = "shaka-text-region---" + c;
              e.classList.add("shaka-text-region");
              e.style.position = "absolute";
              var n = g.height, p = g.width;
              2 === g.heightUnits && (n = 5.33 * g.height, k2 = "%");
              2 === g.widthUnits && (p = g.width * h, l = "%");
              e.style.height = n + k2;
              e.style.width = p + l;
              2 === g.viewportAnchorUnits ? (h = g.viewportAnchorY / 75 * 100, k2 = g.viewportAnchorX / (a.m === 4 / 3 ? 160 : 210) * 100, h -= g.regionAnchorY * n / 100, k2 -= g.regionAnchorX * p / 100, e.style.top = h + "%", e.style.left = k2 + "%") : (e.style.top = g.viewportAnchorY - g.regionAnchorY * n / 100 + m, e.style.left = g.viewportAnchorX - g.regionAnchorX * p / 100 + m);
              0 !== g.heightUnits && 0 !== g.widthUnits && 0 !== g.viewportAnchorUnits && (g = Math.max(0, Math.min(100 - (parseInt(e.style.width.slice(0, -1), 10) || 0), parseInt(e.style.left.slice(0, -1), 10) || 0)), e.style.top = Math.max(0, Math.min(100 - (parseInt(e.style.height.slice(0, -1), 10) || 0), parseInt(e.style.top.slice(0, -1), 10) || 0)) + "%", e.style.left = g + "%");
              e.style.display = "flex";
              e.style.flexDirection = "column";
              e.style.alignItems = "center";
              e.style.justifyContent = "before" == b.displayAlign ? "flex-start" : "center" == b.displayAlign ? "center" : "flex-end";
              a.F.set(c, e);
              c = e;
            }
          }
          e = f;
          d && (e = document.createElement("span"), e.classList.add("shaka-text-wrapper"), e.style.backgroundColor = b.backgroundColor, e.style.lineHeight = "normal", f.appendChild(e));
          a.l.set(b, { lf: f, Nh: e, Ec: c });
        }
        function Vo(a) {
          var b = a.direction, c = a.positionAlign;
          a = a.textAlign;
          return c !== Be ? c : "left" === a || "start" === a && b === De || "end" === a && "rtl" === b ? "line-left" : "right" === a || "start" === a && "rtl" === b || "end" === a && b === De ? "line-right" : "center";
        }
        function Uo(a, b, c, d, e) {
          var f = b.style, g = 0 == c.nestedCues.length, h = 1 < d.length;
          f.whiteSpace = "pre-wrap";
          var k2 = c.payload.replace(/\s+$/g, function(m) {
            return " ".repeat(m.length);
          });
          f.webkitTextStrokeColor = c.textStrokeColor;
          f.webkitTextStrokeWidth = c.textStrokeWidth;
          f.color = c.color;
          f.direction = c.direction;
          f.opacity = c.opacity;
          f.paddingLeft = Wo(c.linePadding, c, a.C);
          f.paddingRight = Wo(c.linePadding, c, a.C);
          f.textCombineUpright = c.textCombineUpright;
          f.textShadow = c.textShadow;
          if (c.backgroundImage) f.backgroundImage = "url('" + c.backgroundImage + "')", f.backgroundRepeat = "no-repeat", f.backgroundSize = "contain", f.backgroundPosition = "center", c.backgroundColor && (f.backgroundColor = c.backgroundColor), f.width = "100%", f.height = "100%";
          else {
            if (c.nestedCues.length) var l = b;
            else l = document.createElement("span"), b.appendChild(l);
            c.border && (l.style.border = c.border);
            e || ((b = Xo(d, function(m) {
              return m.backgroundColor;
            })) ? l.style.backgroundColor = b : k2 && (l.style.backgroundColor = "rgba(0, 0, 0, 0.8)"));
            k2 && (l.textContent = k2);
          }
          if (h && !d[d.length - 1].isContainer) f.display = "inline";
          else {
            f.display = "flex";
            f.flexDirection = "column";
            f.alignItems = "center";
            if ("left" == c.textAlign || "start" == c.textAlign) f.width = "100%", f.alignItems = "start";
            else if ("right" == c.textAlign || "end" == c.textAlign) f.width = "100%", f.alignItems = "end";
            f.justifyContent = "before" == c.displayAlign ? "flex-start" : "center" == c.displayAlign ? "center" : "flex-end";
          }
          g || (f.margin = "0");
          f.fontFamily = c.fontFamily;
          f.fontWeight = c.fontWeight.toString();
          f.fontStyle = c.fontStyle;
          f.letterSpacing = c.letterSpacing;
          f.fontSize = Wo(c.fontSize, c, a.C, a.u ? a.u.fontScaleFactor : 1);
          d = c.line;
          null != d && (g = c.lineInterpretation, g == Fe && (g = 1, h = 16, a.m && 1 > a.m && (h = 32), d = 0 > d ? 100 + d / h * 100 : d / h * 100), 1 == g && (f.position = "absolute", c.writingMode == Ee ? (f.width = "100%", c.lineAlign == Ge ? f.top = d + "%" : "end" == c.lineAlign && (f.bottom = 100 - d + "%")) : "vertical-lr" == c.writingMode ? (f.height = "100%", c.lineAlign == Ge ? f.left = d + "%" : "end" == c.lineAlign && (f.right = 100 - d + "%")) : (f.height = "100%", c.lineAlign == Ge ? f.right = d + "%" : "end" == c.lineAlign && (f.left = 100 - d + "%"))));
          f.lineHeight = c.lineHeight;
          a = Vo(c);
          "line-left" == a ? (f.cssFloat = "left", null !== c.position && (f.position = "absolute", c.writingMode == Ee ? (f.left = c.position + "%", f.width = "auto") : f.top = c.position + "%")) : "line-right" == a ? (f.cssFloat = "right", null !== c.position && (f.position = "absolute", c.writingMode == Ee ? (f.right = 100 - c.position + "%", f.width = "auto") : f.bottom = c.position + "%")) : null !== c.position && 50 != c.position && (f.position = "absolute", c.writingMode == Ee ? (f.left = c.position + "%", f.width = "auto") : f.top = c.position + "%");
          f.textAlign = c.textAlign;
          f.textDecoration = c.textDecoration.join(" ");
          f.writingMode = c.writingMode;
          "writingMode" in document.documentElement.style && f.writingMode == c.writingMode || (f.webkitWritingMode = c.writingMode);
          c.size && (c.writingMode == Ee ? f.width = c.size + "%" : f.height = c.size + "%");
        }
        function Wo(a, b, c, d) {
          d = void 0 === d ? 1 : d;
          var e = (e = new RegExp(/(\d*\.?\d+)([a-z]+|%+)/).exec(a)) ? { value: Number(e[1]), unit: e[2] } : null;
          if (!e) return a;
          a = e.unit;
          d *= e.value;
          switch (a) {
            case "%":
              return d / 100 * c.clientHeight / b.cellResolution.rows + "px";
            case "c":
              return c.clientHeight * d / b.cellResolution.rows + "px";
            default:
              return d + a;
          }
        }
        function Xo(a, b) {
          for (var c = a.length - 1; 0 <= c; c--) {
            var d = b(a[c]);
            if (d || 0 === d) return d;
          }
          return null;
        }
        T("shaka.text.UITextDisplayer", Oo);
        Oo.prototype.enableTextDisplayer = Oo.prototype.enableTextDisplayer;
        Oo.prototype.setTextLanguage = Oo.prototype.setTextLanguage;
        Oo.prototype.setTextVisibility = Oo.prototype.setTextVisibility;
        Oo.prototype.isTextVisible = Oo.prototype.isTextVisible;
        Oo.prototype.remove = Oo.prototype.remove;
        Oo.prototype.destroy = Oo.prototype.destroy;
        Oo.prototype.append = Oo.prototype.append;
        Oo.prototype.configure = Oo.prototype.configure;
        function Yo(a, b) {
          function c(f) {
            for (var g = f, h = t(b), k2 = h.next(); !k2.done; k2 = h.next()) k2 = k2.value, k2.end && k2.start < f && (g += k2.end - k2.start);
            f = Math.floor(g / 3600);
            h = Math.floor(g / 60 % 60);
            k2 = Math.floor(g % 60);
            g = Math.floor(1e3 * g % 1e3);
            return (10 > f ? "0" : "") + f + ":" + (10 > h ? "0" : "") + h + ":" + (10 > k2 ? "0" : "") + k2 + "." + (100 > g ? 10 > g ? "00" : "0" : "") + g;
          }
          var d = Ho(a);
          a = "WEBVTT\n\n";
          d = t(d);
          for (var e = d.next(); !e.done; e = d.next()) e = e.value, a += c(e.startTime) + " --> " + c(e.endTime) + function(f) {
            var g = [];
            switch (f.textAlign) {
              case "left":
                g.push("align:left");
                break;
              case "right":
                g.push("align:right");
                break;
              case Ce:
                g.push("align:middle");
                break;
              case "start":
                g.push("align:start");
                break;
              case "end":
                g.push("align:end");
            }
            switch (f.writingMode) {
              case "vertical-lr":
                g.push("vertical:lr");
                break;
              case "vertical-rl":
                g.push("vertical:rl");
            }
            return g.length ? " " + g.join(" ") : "";
          }(e) + "\n", a += e.payload + "\n\n";
          return a;
        }
        T("shaka.text.WebVttGenerator", function() {
        });
        function Zo(a, b) {
          this.h = a;
          this.g = b;
          this.i = void 0;
          this.u = false;
          this.F = true;
          this.l = this.B = false;
          this.o = this.m = void 0;
          this.A = 0;
          this.G = false;
          this.C = new lb();
          this.j = null;
        }
        Zo.prototype.setMediaElement = function(a) {
          this.j = a;
          $o(this);
        };
        Zo.prototype.configure = function(a) {
          this.g = a;
        };
        function ap(a) {
          a.u = false;
          a.F = true;
          a.B = false;
          a.l = false;
          a.m = 0;
          a.o = 0;
          a.A = 0;
          a.G = false;
          a.j = null;
          a.C.Qa();
        }
        function bp(a, b) {
          a.l = b;
          a.l ? a.i == cp ? a.i = dp : a.i == ep && (a.i = fp) : a.i == dp ? a.i = cp : a.i == fp && (a.i = ep);
        }
        function gp(a, b) {
          if (a.g && a.g.enabled && a.g.version == hp && a.j && a.j.autoplay) {
            var c = a.j.play();
            c && c.then(function() {
              a.A = b;
            }).catch(function() {
              a.A = 0;
            });
          }
        }
        function ip(a, b, c) {
          try {
            if (!a.g.enabled) return b;
            var d = jp(a);
            a: {
              switch (c.toLowerCase()) {
                case "audio/mp4":
                case "audio/webm":
                case "audio/ogg":
                case "audio/mpeg":
                case "audio/aac":
                case "audio/flac":
                case "audio/wav":
                  var e = kp;
                  break a;
                case "video/webm":
                case "video/mp4":
                case "video/mpeg":
                case "video/mp2t":
                  e = lp;
                  break a;
                case "application/x-mpegurl":
                case "application/vnd.apple.mpegurl":
                case "application/dash+xml":
                case "video/vnd.mpeg.dash.mpd":
                case "application/vnd.ms-sstr+xml":
                  e = mp;
                  break a;
              }
              e = void 0;
            }
            d.ot = e;
            d.su = true;
            var f = np(d);
            return op(b, f);
          } catch (g) {
            return cb("CMCD_SRC_ERROR", "Could not generate src CMCD data.", g), b;
          }
        }
        function $o(a) {
          a.C.ma(a.j, "play", function() {
            a.m || (a.m = Date.now());
          });
          a.C.ma(a.j, "playing", function() {
            a.o || (a.o = Date.now());
          });
        }
        function jp(a) {
          a.g.sessionId || (a.g.sessionId = window2.crypto.randomUUID());
          return { v: a.g.version, sf: a.i, sid: a.g.sessionId, cid: a.g.contentId, mtp: a.h.getBandwidthEstimate() / 1e3 };
        }
        function pp(a, b, c) {
          c = void 0 === c ? {} : c;
          var d = void 0 === d ? a.g.useHeaders : d;
          if (a.g.enabled) {
            Object.assign(c, jp(a));
            c.pr = a.h.gb();
            var e = c.ot === qp || c.ot === lp;
            a.B && e && (c.bs = true, c.su = true, a.B = false);
            null == c.su && (c.su = a.F);
            c.v === hp && (a.h.U() && (c.ltc = a.h.Zd()), e = !a.G && a.o && a.m ? a.o - (a.A || a.m) : void 0, void 0 != e && (c.msd = e, a.G = true));
            a = rp(a, c);
            if (d) d = sp(a), Object.keys(d).length && Object.assign(b.headers, d);
            else {
              var f = np(a);
              f && (b.uris = b.uris.map(function(g) {
                return op(g, f);
              }));
            }
          }
        }
        function rp(a, b) {
          var c = a.g.includeKeys;
          return c.length ? Object.keys(b).reduce(function(d, e) {
            c.includes(e) && (d[e] = b[e]);
            return d;
          }, {}) : b;
        }
        function tp(a) {
          if (0 === a.type) return up;
          if (a = a.stream) {
            var b = a.type;
            if ("video" == b) return a.codecs && a.codecs.includes(",") ? lp : qp;
            if ("audio" == b) return kp;
            if ("text" == b) return "application/mp4" === a.mimeType ? vp : wp;
          }
        }
        function xp(a, b) {
          b = a.h.Fb()[b];
          if (!b.length) return NaN;
          var c = a.h.getCurrentTime();
          return (a = b.find(function(d) {
            return d.start <= c && d.end >= c;
          })) ? 1e3 * (a.end - c) : NaN;
        }
        function yp(a, b) {
          b = a.h.Fb()[b];
          if (!b.length) return 0;
          var c = a.h.getCurrentTime();
          return (a = b.find(function(d) {
            return d.start <= c && d.end >= c;
          })) ? 1e3 * (a.end - c) : 0;
        }
        function zp(a, b) {
          var c = a.h.Rb();
          if (!c.length) return NaN;
          a = c[0];
          c = t(c);
          for (var d = c.next(); !d.done; d = c.next()) d = d.value, "variant" === d.type && d.bandwidth > a.bandwidth && (a = d);
          switch (b) {
            case qp:
              return a.videoBandwidth || NaN;
            case kp:
              return a.audioBandwidth || NaN;
            default:
              return a.bandwidth;
          }
        }
        function np(a) {
          function b(n) {
            return 100 * c(n / 100);
          }
          function c(n) {
            return Math.round(n);
          }
          function d(n) {
            return !Number.isNaN(n) && null != n && "" !== n && false !== n;
          }
          var e = [], f = { br: c, d: c, bl: b, dl: b, mtp: b, nor: function(n) {
            return encodeURIComponent(n);
          }, rtp: b, tb: c }, g = Object.keys(a || {}).sort();
          g = t(g);
          for (var h = g.next(); !h.done; h = g.next()) {
            h = h.value;
            var k2 = a[h];
            if (d(k2) && ("v" !== h || 1 !== k2) && ("pr" != h || 1 !== k2)) {
              var l = f[h];
              l && (k2 = l(k2));
              l = typeof k2;
              var m = void 0;
              m = "string" === l && "ot" !== h && "sf" !== h && "st" !== h ? h + "=" + JSON.stringify(k2) : "boolean" === l ? h : "symbol" === l ? h + "=" + k2.description : h + "=" + k2;
              e.push(m);
            }
          }
          return e.join(",");
        }
        function sp(a) {
          var b = Object.keys(a), c = {}, d = ["Object", "Request", "Session", "Status"], e = [{}, {}, {}, {}], f = { br: 0, d: 0, ot: 0, tb: 0, bl: 1, dl: 1, mtp: 1, nor: 1, nrr: 1, su: 1, ltc: 1, cid: 2, pr: 2, sf: 2, sid: 2, st: 2, v: 2, msd: 2, bs: 3, rtp: 3 };
          b = t(b);
          for (var g = b.next(); !g.done; g = b.next()) g = g.value, e[null != f[g] ? f[g] : 1][g] = a[g];
          for (a = 0; a < e.length; a++) (f = np(e[a])) && (c["CMCD-" + d[a]] = f);
          return c;
        }
        function op(a, b) {
          if (!b || a.includes("offline:")) return a;
          a = new yb(a);
          a.g.set("CMCD", b);
          return a.toString();
        }
        var mp = "m", kp = "a", qp = "v", lp = "av", up = "i", wp = "c", vp = "tt", hp = 2, cp = "d", dp = "ld", ep = "h", fp = "lh";
        T("shaka.util.CmcdManager.StreamingFormat", { DASH: cp, hk: dp, HLS: ep, ik: fp, wk: "s", OTHER: "o" });
        function Ap(a) {
          this.h = a;
          this.g = null;
        }
        r = Ap.prototype;
        r.configure = function(a) {
          this.h = a;
        };
        r.Ug = function() {
          return this.h.enabled && this.h.applyMaximumSuggestedBitrate && this.g && this.g.has(Bp) ? 1e3 * this.g.get(Bp) : null;
        };
        r.Sg = function() {
          return this.h.enabled && this.g && this.g.has(Cp) ? 1e3 * this.g.get(Cp) : null;
        };
        r.Ci = function() {
          return this.h.enabled && this.g && this.g.has(Dp) ? this.g.get(Dp) : null;
        };
        r.Di = function() {
          return this.h.enabled && this.g && this.g.has(Ep) ? this.g.get(Ep) : null;
        };
        r.getBandwidthEstimate = function(a) {
          var b = this.Sg();
          if (!b) return a;
          var c = this.h.estimatedThroughputWeightRatio;
          return 0 < c && 1 >= c ? a * (1 - c) + b * c : a;
        };
        function Fp(a) {
          return a ? "false" === a.toLowerCase() ? false : /^[-0-9]/.test(a) ? parseInt(a, 10) : a.replace(/["]+/g, "") : true;
        }
        T("shaka.util.CmsdManager", Ap);
        Ap.prototype.getBandwidthEstimate = Ap.prototype.getBandwidthEstimate;
        Ap.prototype.getRoundTripTime = Ap.prototype.Di;
        Ap.prototype.getResponseDelay = Ap.prototype.Ci;
        Ap.prototype.getEstimatedThroughput = Ap.prototype.Sg;
        Ap.prototype.getMaxBitrate = Ap.prototype.Ug;
        var Cp = "etp", Bp = "mb", Dp = "rd", Ep = "rtt";
        function Gp() {
          this.g = null;
          this.h = [];
        }
        function Hp(a, b) {
          return Q(function(c) {
            if (1 == c.g) return a.g ? F(c, new Promise(function(d) {
              return a.h.push(d);
            }), 2) : c.s(2);
            a.g = b;
            I(c);
          });
        }
        Gp.prototype.release = function() {
          0 < this.h.length ? this.h.shift()() : this.g = null;
        };
        function X(a, b, c) {
          b = void 0 === b ? null : b;
          dh.call(this);
          var d = this;
          this.m = Ip;
          this.h = null;
          this.ue = b;
          this.oa = false;
          this.Qe = new lb();
          this.zd = new lb();
          this.l = new lb();
          this.Na = new lb();
          this.Sb = new lb();
          this.G = this.I = this.C = this.F = null;
          this.Te = 0;
          this.Z = new Gp();
          this.Y = this.Pb = this.T = this.i = this.Qb = this.H = this.j = this.xd = this.O = this.yg = this.fa = this.L = this.Ga = this.Aa = this.yd = this.M = this.pa = this.K = this.La = null;
          this.sa = false;
          this.Fa = this.o = null;
          this.We = 1e9;
          this.Oe = [];
          this.Ve = -1;
          this.g = Jp(this);
          this.Xe = Nn();
          this.P = null;
          this.Ue = -1;
          this.Ma = null;
          this.ka = { width: Infinity, height: Infinity };
          this.te = new Ki(this.g, this.ka, null);
          this.Ee = [];
          this.A = null;
          this.W = this.g.adaptationSetCriteriaFactory();
          this.W.configure({
            language: this.g.preferredAudioLanguage,
            role: this.g.preferredVariantRole,
            channelCount: this.g.preferredAudioChannelCount,
            Sc: this.g.preferredVideoHdrLevel,
            spatialAudio: this.g.preferSpatialAudio,
            videoLayout: this.g.preferredVideoLayout,
            Kc: this.g.preferredAudioLabel,
            fd: this.g.preferredVideoLabel,
            codecSwitchingStrategy: this.g.mediaSource.codecSwitchingStrategy,
            audioCodec: ""
          });
          this.Tb = this.g.preferredTextLanguage;
          this.Hd = this.g.preferredTextRole;
          this.Fd = this.g.preferForcedSubs;
          this.Cd = [];
          c && c(this);
          this.L = Kp(this);
          this.fa = new Ap(this.g.cmsd);
          this.F = Lp(this);
          this.F.kg(this.g.streaming.forceHTTP);
          this.F.lg(this.g.streaming.forceHTTPS);
          this.F.o = this.g.streaming.minBytesForProgressEvents;
          this.Ub = this.ea = this.u = null;
          this.Ze = false;
          this.Ye = new ec(function() {
            return Q(function(e) {
              if (1 == e.g) return d.ea ? F(e, d.Lb(d.Ub, true), 3) : e.s(0);
              if (4 != e.g) return F(e, d.load(d.ea), 4);
              d.Ze ? d.Ub.pause() : d.Ub.play();
              d.ea = null;
              d.Ze = false;
              I(e);
            });
          });
          Mp && (this.u = Mp(), this.u.configure(this.g.ads), this.Sb.D(this.u, "ad-content-pause-requested", function(e) {
            var f;
            return Q(function(g) {
              if (1 == g.g) {
                d.Ye.stop();
                if (d.ea) return g.s(0);
                d.Ub = d.h;
                d.Ze = d.Uc();
                f = e.saveLivePosition || false;
                return F(g, d.Lg(true, f), 3);
              }
              d.ea = g.h;
              I(g);
            });
          }), this.Sb.D(this.u, "ad-content-resume-requested", function(e) {
            e = e.offset || 0;
            if (d.ea) {
              var f = d.ea;
              f.B && e && (f.B += e);
            }
            d.Ye.da(0.1);
          }), this.Sb.D(this.u, "ad-content-attach-requested", function() {
            return Q(function(e) {
              return d.h || !d.Ub ? e.s(0) : F(e, d.Lb(d.Ub, true), 0);
            });
          }));
          this.Qe.D(window2, "online", function() {
            Np(d);
            d.eg();
          });
          this.xe = new ec(function() {
            for (var e = Date.now() / 1e3, f = false, g = true, h = t(d.i.variants), k2 = h.next(); !k2.done; k2 = h.next()) k2 = k2.value, 0 < k2.disabledUntilTime && k2.disabledUntilTime <= e && (k2.disabledUntilTime = 0, f = true), 0 < k2.disabledUntilTime && (g = false);
            g && d.xe.stop();
            f && Op(d, false, void 0, false, false);
          });
          this.ya = null;
          a && (sb("Player w/ mediaElement", "Please migrate from initializing Player with a mediaElement; use the attach method instead."), this.Lb(
            a,
            true
          ));
          this.B = null;
        }
        qa(X, dh);
        function Pp(a) {
          null != a.O && (kd(a.O), a.O.release(), a.O = null);
        }
        function Qp(a, b, c) {
          c || b.lcevc.enabled ? (Pp(a), null == a.O && (a.O = new id(a.h, a.yg, b.lcevc, c), a.I && (a.I.I = a.O))) : Pp(a);
        }
        function Rp(a, b) {
          return new V(a, b);
        }
        r = X.prototype;
        r.destroy = function() {
          var a = this, b;
          return Q(function(c) {
            switch (c.g) {
              case 1:
                if (a.m == Sp) return c.return();
                Pp(a);
                b = a.detach();
                a.m = Sp;
                return F(c, b, 2);
              case 2:
                return F(c, a.pf(), 3);
              case 3:
                a.Qe && (a.Qe.release(), a.Qe = null);
                a.zd && (a.zd.release(), a.zd = null);
                a.l && (a.l.release(), a.l = null);
                a.Na && (a.Na.release(), a.Na = null);
                a.Sb && (a.Sb.release(), a.Sb = null);
                a.Fa = null;
                a.g = null;
                a.A = null;
                a.ue = null;
                a.L = null;
                a.fa = null;
                if (!a.F) {
                  c.s(4);
                  break;
                }
                return F(c, a.F.destroy(), 5);
              case 5:
                a.F = null;
              case 4:
                a.o && (a.o.release(), a.o = null), dh.prototype.release.call(a), I(c);
            }
          });
        };
        function Tp(a, b) {
          Up.set(a, b);
        }
        function Vp(a, b) {
          a.dispatchEvent(Rp("onstatechange", (/* @__PURE__ */ new Map()).set("state", b)));
        }
        r.Lb = function(a, b) {
          b = void 0 === b ? true : b;
          var c = this, d, e, f;
          return Q(function(g) {
            switch (g.g) {
              case 1:
                if (c.m == Sp) throw new U(2, 7, 7e3);
                d = c.h && c.h == a;
                if (!c.h || c.h == a) {
                  g.s(2);
                  break;
                }
                return F(g, c.detach(), 2);
              case 2:
                return F(g, Wp(c, "attach"), 4);
              case 4:
                if (g.h) return g.return();
                xa(g, 5, 6);
                d || (Vp(c, "attach"), e = function() {
                  var h = Xp(c, false);
                  h && Yp(c, h);
                }, c.zd.D(a, "error", e), c.h = a, c.L && c.L.setMediaElement(a));
                if (!b || !fc() || c.I) {
                  g.s(6);
                  break;
                }
                return F(g, Zp(c), 6);
              case 6:
                Da(g);
                c.Z.release();
                Ea(g, 0);
                break;
              case 5:
                return f = Ba(g), F(g, c.detach(), 10);
              case 10:
                throw f;
            }
          });
        };
        r.Vh = function(a) {
          this.yg = a;
        };
        r.detach = function(a) {
          a = void 0 === a ? false : a;
          var b = this;
          return Q(function(c) {
            if (1 == c.g) {
              if (b.m == Sp) throw new U(2, 7, 7e3);
              return F(c, b.kc(false, a), 2);
            }
            if (3 != c.g) return F(c, Wp(b, "detach"), 3);
            if (c.h) return c.return();
            try {
              b.h && (b.zd.Qa(), b.h = null), Vp(b, "detach"), b.u && !a && b.u.release();
            } finally {
              b.Z.release();
            }
            I(c);
          });
        };
        function Wp(a, b) {
          var c;
          return Q(function(d) {
            return 1 == d.g ? (c = ++a.Te, F(d, Hp(a.Z, b), 2)) : c != a.Te ? (a.Z.release(), d.return(true)) : d.return(false);
          });
        }
        r.kc = function(a, b) {
          a = void 0 === a ? true : a;
          b = void 0 === b ? false : b;
          var c = this, d, e, f, g, h, k2, l, m, n, p;
          return Q(function(q) {
            switch (q.g) {
              case 1:
                return c.m != Sp && (c.m = Ip), F(q, Wp(c, "unload"), 2);
              case 2:
                if (q.h) return q.return();
                za(q, 3);
                c.sa = false;
                Vp(c, "unload");
                Pp(c);
                d = c.Cd.map(function(u) {
                  return u();
                });
                c.Cd = [];
                return F(q, Promise.all(d), 5);
              case 5:
                c.dispatchEvent(Rp("unloading"));
                c.yd && (c.yd.release(), c.yd = null);
                c.Aa && (c.Aa.release(), c.Aa = null);
                c.Ga && (c.Ga.release(), c.Ga = null);
                c.h && (c.l.Qa(), c.Na.Qa());
                c.xe.stop();
                c.La && (c.La.release(), c.La = null);
                c.pa && (c.pa.stop(), c.pa = null);
                if (!c.H) {
                  q.s(6);
                  break;
                }
                return F(q, c.H.stop(), 7);
              case 7:
                c.H = null, c.Qb = null;
              case 6:
                if (!c.o) {
                  q.s(8);
                  break;
                }
                return F(q, c.o.stop(), 8);
              case 8:
                if (!c.j) {
                  q.s(10);
                  break;
                }
                return F(q, c.j.destroy(), 11);
              case 11:
                c.j = null;
              case 10:
                c.K && (c.K.release(), c.K = null);
                c.G && (c.G.release(), c.G = null);
                if ("webkit" !== window2.shakaMediaKeysPolyfill || !c.C) {
                  q.s(12);
                  break;
                }
                return F(q, c.C.destroy(), 13);
              case 13:
                c.C = null;
              case 12:
                if (!c.I) {
                  q.s(14);
                  break;
                }
                return F(q, c.I.destroy(), 15);
              case 15:
                c.I = null;
              case 14:
                if (c.u && !b) c.u.onAssetUnload();
                c.ea && !b && (c.ea.destroy(), c.ea = null);
                b || c.Ye.stop();
                c.L && ap(c.L);
                c.fa && (c.fa.g = null);
                if (!c.B) {
                  q.s(16);
                  break;
                }
                return F(q, c.B.destroy(), 17);
              case 17:
                c.B = null;
              case 16:
                c.h && (Zj(c.h), c.h.src && (c.h.removeAttribute("src"), c.h.load()));
                if (!c.C) {
                  q.s(18);
                  break;
                }
                return F(q, c.C.destroy(), 19);
              case 19:
                c.C = null;
              case 18:
                c.ya && c.T != c.ya.Qc() && (c.ya.u || c.ya.destroy(), c.ya = null);
                c.T = null;
                c.Pb = null;
                c.M = null;
                if (c.i) {
                  e = t(c.i.variants);
                  for (f = e.next(); !f.done; f = e.next()) for (g = f.value, h = t([g.audio, g.video]), k2 = h.next(); !k2.done; k2 = h.next()) (l = k2.value) && l.segmentIndex && l.segmentIndex.release();
                  m = t(c.i.textStreams);
                  for (n = m.next(); !n.done; n = m.next()) p = n.value, p.segmentIndex && p.segmentIndex.release();
                }
                c.g && c.g.streaming.clearDecodingCache && (pg.clear(), cc.clear());
                c.i = null;
                c.A = new io();
                c.Se = null;
                c.Ma = null;
                c.P = null;
                c.Ue = -1;
                c.Oe = [];
                c.Ve = -1;
                c.F && c.F.Hg();
                $p(c);
              case 3:
                Da(q);
                c.Z.release();
                Ea(q, 4);
                break;
              case 4:
                if (a && fc() && !c.I && c.h) return F(q, Zp(c), 0);
                q.s(0);
            }
          });
        };
        r.Kj = function(a) {
          this.Y = a;
        };
        r.load = function(a, b, c) {
          b = void 0 === b ? null : b;
          var d = this, e, f, g, h, k2, l, m, n, p, q, u, w, v;
          return Q(function(x) {
            switch (x.g) {
              case 1:
                if (d.m == Sp) throw new U(2, 7, 7e3);
                e = null;
                f = "";
                if (a instanceof jo) {
                  if (a.u) throw new U(2, 7, 7006);
                  e = a;
                  f = e.Qc() || "";
                } else f = a || "";
                return F(x, Hp(d.Z, "load"), 2);
              case 2:
                d.Z.release();
                if (!d.h) throw new U(2, 7, 7002);
                if (!d.T) {
                  x.s(3);
                  break;
                }
                d.T = f;
                return F(x, d.kc(false), 3);
              case 3:
                g = ++d.Te;
                h = function() {
                  return Q(function(z) {
                    if (1 == z.g) return d.Te == g ? z.s(0) : e ? F(z, e.destroy(), 3) : z.s(3);
                    throw new U(2, 7, 7e3);
                  });
                };
                k2 = function(z, C) {
                  return Q(function(D) {
                    switch (D.g) {
                      case 1:
                        return za(D, 2), F(D, Hp(d.Z, C), 4);
                      case 4:
                        return F(D, h(), 5);
                      case 5:
                        return F(D, z(), 6);
                      case 6:
                        return F(D, h(), 7);
                      case 7:
                        e && d.g && (e.g = d.g);
                      case 2:
                        Da(D), d.Z.release(), Ea(D, 0);
                    }
                  });
                };
                xa(x, 5, 6);
                null == b && e && (b = e.getStartTime());
                d.Y = b;
                d.sa = false;
                d.dispatchEvent(Rp("loading"));
                if (e) {
                  c = e.Y;
                  x.s(8);
                  break;
                }
                if (c) {
                  x.s(8);
                  break;
                }
                return F(x, k2(function() {
                  return Q(function(z) {
                    if (1 == z.g) return F(z, aq(d, f), 2);
                    c = z.h;
                    I(z);
                  });
                }, "guessMimeType_"), 8);
              case 8:
                l = !!e;
                if (e) {
                  mo(e, d);
                  d.A = e.getStats();
                  x.s(11);
                  break;
                }
                return F(x, bq(d, f, b, c, true), 12);
              case 12:
                (e = x.h) ? (e.A = false, mo(e, d), d.A = e.getStats(), e.start(), e.m.catch(function() {
                })) : d.A = new io();
              case 11:
                m = !e;
                n = Date.now() / 1e3;
                d.A = e ? e.getStats() : new io();
                d.T = f;
                d.Pb = c || null;
                d.Aa = new fm(function() {
                  return d.Ra();
                });
                if (m) return F(x, k2(function() {
                  return Q(function(z) {
                    return F(z, cq(d, c), 0);
                  });
                }, "initializeSrcEqualsDrmInner_"), 23);
                d.Ga = new fm(function() {
                  return d.Ra();
                });
                return F(x, k2(function() {
                  return Q(function(z) {
                    if (1 == z.g) return F(z, Promise.race([
                      e.oa,
                      e.m
                    ]), 2);
                    d.Qb = e.G;
                    var C = e;
                    C.pa = true;
                    d.H = C.l;
                    d.i = e.Hf();
                    I(z);
                  });
                }, "waitForFinish"), 15);
              case 15:
                if (d.I) {
                  x.s(16);
                  break;
                }
                return F(x, k2(function() {
                  return Q(function(z) {
                    return F(z, Zp(d), 0);
                  });
                }, "initializeMediaSourceEngineInner_"), 16);
              case 16:
                return d.i && d.i.textStreams.length && (d.B.enableTextDisplayer ? d.B.enableTextDisplayer() : sb("Text displayer w/ enableTextDisplayer", 'Text displayer should have a "enableTextDisplayer" method!')), F(x, k2(function() {
                  return Q(function(z) {
                    return F(z, e.m, 0);
                  });
                }, "waitForFinish"), 18);
              case 18:
                d.g = e.getConfiguration();
                d.te = e.F;
                d.H && d.H.setMediaElement && d.h && d.H.setMediaElement(d.h);
                d.yd = oo(e);
                d.xd = e.Ga;
                if (p = e.o) d.W = p;
                l && d.h && "AUDIO" === d.h.nodeName && (dq(d), d.configure("manifest.disableVideo", true));
                if (e.i) {
                  x.s(19);
                  break;
                }
                return F(x, k2(function() {
                  return Q(function(z) {
                    return F(z, to(e, d.h), 0);
                  });
                }, "drmEngine_.init"), 19);
              case 19:
                return d.C = po(e), F(x, k2(function() {
                  return Q(function(z) {
                    return F(z, d.C.Lb(d.h), 0);
                  });
                }, "drmEngine_.attach"), 21);
              case 21:
                return !(q = e.C) || d.Fa && d.Fa == q || (d.o = no(e), d.Fa = e.C, "function" != typeof d.o.setMediaElement && (sb("AbrManager w/o setMediaElement", "Please use an AbrManager with setMediaElement function."), d.o.setMediaElement = function() {
                }), "function" != typeof d.o.setCmsdManager && (sb("AbrManager w/o setCmsdManager", "Please use an AbrManager with setCmsdManager function."), d.o.setCmsdManager = function() {
                }), "function" != typeof d.o.trySuggestStreams && (sb("AbrManager w/o trySuggestStreams", "Please use an AbrManager with trySuggestStreams function."), d.o.trySuggestStreams = function() {
                })), u = qo(e), w = e.K, F(x, k2(function() {
                  return Q(function(z) {
                    return F(z, eq(d, n, w, u), 0);
                  });
                }, "loadInner_"), 22);
              case 22:
                lo(e);
                d.Pb && rc() && xf(d.Pb) && Nk(d.I, d.T, d.Pb);
                x.s(14);
                break;
              case 23:
                return F(x, k2(function() {
                  return Q(function(z) {
                    return F(z, fq(d, n, c), 0);
                  });
                }, "srcEqualsInner_"), 14);
              case 14:
                d.dispatchEvent(Rp("loaded"));
              case 6:
                Da(x);
                if (!e) {
                  x.s(25);
                  break;
                }
                return F(x, e.destroy(), 25);
              case 25:
                d.ya = null;
                Ea(x, 0);
                break;
              case 5:
                v = Ba(x);
                if (!v || 7e3 == v.code) {
                  x.s(27);
                  break;
                }
                return F(x, d.kc(false), 27);
              case 27:
                throw v;
            }
          });
        };
        function dq(a) {
          for (var b = t(a.i.variants), c = b.next(); !c.done; c = b.next()) c = c.value, c.video && (c.video.closeSegmentIndex(), c.video = null), c.bandwidth = c.audio && c.audio.bandwidth ? c.audio.bandwidth : 0;
          a.i.variants = a.i.variants.filter(function(d) {
            return d.audio;
          });
        }
        r.Gj = function(a, b) {
          a = void 0 === a ? true : a;
          b = void 0 === b ? false : b;
          var c = this, d;
          return Q(function(e) {
            return 1 == e.g ? F(e, gq(c), 2) : 3 != e.g ? (d = e.h, F(e, c.kc(a, b), 3)) : e.return(d);
          });
        };
        r.Lg = function(a, b) {
          a = void 0 === a ? false : a;
          b = void 0 === b ? false : b;
          var c = this, d;
          return Q(function(e) {
            return 1 == e.g ? F(e, gq(c, b), 2) : 3 != e.g ? (d = e.h, F(e, c.detach(a), 3)) : e.return(d);
          });
        };
        function gq(a, b) {
          b = void 0 === b ? false : b;
          var c, d;
          return Q(function(e) {
            if (1 == e.g) {
              c = null;
              if (!(a.i && a.H && a.Qb && a.T)) return e.s(2);
              d = a.h.currentTime;
              a.U() && !b && (d = null);
              return F(e, hq(a, a.T, d, a.Pb, true, false, false), 3);
            }
            if (2 != e.g) {
              c = e.h;
              a.Ee.push(c);
              a.H && a.H.setMediaElement && a.H.setMediaElement(null);
              var f = c, g = a.H, h = a.Qb;
              f.h = a.i;
              f.l = g;
              f.G = h;
              f = c;
              g = a.Fa;
              f.j = a.o;
              f.C = g;
              c.o = a.W;
              c.start();
              a.i = null;
              a.H = null;
              a.Qb = null;
              a.o = null;
              a.Fa = null;
            }
            return e.return(c);
          });
        }
        r.preload = function(a, b, c) {
          b = void 0 === b ? null : b;
          var d = this, e;
          return Q(function(f) {
            if (1 == f.g) return F(f, bq(d, a, b, c), 2);
            (e = f.h) ? e.start() : Yp(d, new U(2, 7, 7005));
            return f.return(e);
          });
        };
        r.pf = function() {
          var a = this, b, c, d, e;
          return Q(function(f) {
            b = [];
            c = t(a.Ee);
            for (d = c.next(); !d.done; d = c.next()) e = d.value, e.u || b.push(e.destroy());
            a.Ee = [];
            return F(f, Promise.all(b), 0);
          });
        };
        function bq(a, b, c, d, e) {
          e = void 0 === e ? false : e;
          var g, h, k2;
          return Q(function(l) {
            if (1 == l.g) return d ? l.s(2) : F(l, aq(a, b), 3);
            2 != l.g && (d = l.h);
            if (iq(a, d)) return l.return(null);
            g = false;
            h = true;
            e && (a.o && a.Fa == a.g.abrFactory && (h = false), a.h && "AUDIO" === a.h.nodeName && (g = true));
            k2 = hq(a, b, c, d || null, !e, g, h);
            k2 = e ? k2.then(function(m) {
              m.A = false;
              return m;
            }) : k2.then(function(m) {
              a.Ee.push(m);
              return m;
            });
            return l.return(k2);
          });
        }
        function hq(a, b, c, d, e, f, g) {
          e = void 0 === e ? true : e;
          f = void 0 === f ? false : f;
          g = void 0 === g ? true : g;
          var h, k2, l, m, n, p, q, u, w, v, x, z, C, D;
          return Q(function(G) {
            if (1 == G.g) return h = null, k2 = Nd(a.g), f && (k2.manifest.disableVideo = true), l = function() {
              return h.T && h.u ? null : h;
            }, m = function() {
              return l() ? l().getConfiguration() : a.g;
            }, Infinity != a.ka.width || Infinity != a.ka.height || a.g.ignoreHardwareResolution ? G.s(2) : F(G, Ec(), 3);
            2 != G.g && (n = G.h, a.ka.width = n.width, a.ka.height = n.height);
            p = new Ki(k2, a.ka, null);
            q = { networkingEngine: a.F, filter: function(B) {
              var A, H;
              return Q(function(E) {
                if (1 == E.g) return F(E, Li(p, B), 2);
                if (4 != E.g) {
                  A = E.h;
                  if (!A) return E.s(0);
                  H = Rp("trackschanged");
                  return F(E, Promise.resolve(), 4);
                }
                h.dispatchEvent(H);
                I(E);
              });
            }, makeTextStreamsForClosedCaptions: function(B) {
              return jq(a, B);
            }, onTimelineRegionAdded: function(B) {
              gm(h.H, B);
            }, onEvent: function(B) {
              return h.dispatchEvent(B);
            }, onError: function(B) {
              return h.onError(B);
            }, isLowLatencyMode: function() {
              return m().streaming.lowLatencyMode;
            }, updateDuration: function() {
              a.j && h.T && a.j.updateDuration();
            }, newDrmInfo: function(B) {
              var A = h.i, H = A ? A.h : null;
              H && A.A && Oi(p, H.keySystem, B);
            }, onManifestUpdated: function() {
              var B = (/* @__PURE__ */ new Map()).set("isLive", a.U());
              h.dispatchEvent(Rp("manifestupdated", B));
              ko(h, false, function() {
                if (a.u) a.u.onManifestUpdated(a.U());
              });
            }, getBandwidthEstimate: function() {
              return a.o.getBandwidthEstimate();
            }, onMetadata: function(B, A, H, E) {
              var K = B;
              if ("com.apple.hls.interstitial" == B && (K = "com.apple.quicktime.HLS", B = { startTime: A, endTime: H, values: E }, a.u)) a.u.onHLSInterstitialMetadata(a, a.h, B);
              E = t(E);
              B = E.next();
              for (var M = {}; !B.done; M = { Zf: void 0 }, B = E.next()) M.Zf = B.value, "ID" != M.Zf.name && ko(h, false, /* @__PURE__ */ function(J) {
                return function() {
                  kq(a, A, H, K, J.Zf);
                };
              }(M));
            }, disableStream: function(B) {
              return a.disableStream(B, a.g.streaming.maxDisabledTime);
            }, addFont: function(B, A) {
              return a.addFont(B, A);
            } };
            u = new fm(function() {
              return a.Ra();
            });
            u.addEventListener("regionadd", function(B) {
              var A = B.region;
              lq(a, "timelineregionadded", A, h);
              ko(h, false, function() {
                a.u && (a.u.onDashTimedMetadata(A), a.u.onDASHInterstitialMetadata(a, a.h, A));
              });
            });
            w = null;
            k2.streaming.observeQualityChanges && (w = new $l(function() {
              return a.Fb();
            }), w.addEventListener("qualitychange", function(B) {
              mq(a, B.quality, B.position);
            }), w.addEventListener("audiotrackchange", function(B) {
              mq(a, B.quality, B.position, true);
            }));
            v = true;
            x = { Xb: a.F, onError: function(B) {
              return h.onError(B);
            }, pe: function(B) {
              ko(h, true, function() {
                a: {
                  var A = B, H = Rp("keystatuschanged");
                  a.dispatchEvent(H);
                  var E = Object.keys(A);
                  1 == E.length && "" == E[0] && (E = ["00"], A = { "00": A[""] });
                  H = 1 == E.length && "00" == E[0];
                  var K = false;
                  if (E.length) {
                    E = a.keySystem();
                    for (var M = Ah(a.g.drm.clearKeys), J = t(a.i.variants), L = J.next(); !L.done; L = J.next()) {
                      L = L.value;
                      var N = [];
                      L.audio && N.push(L.audio);
                      L.video && N.push(L.video);
                      N = t(N);
                      for (var P = N.next(); !P.done; P = N.next()) {
                        var O = P.value;
                        P = L.allowedByKeySystem;
                        if (O.keyIds.size) {
                          if (O.drmInfos.length && !M.size) {
                            O = t(O.drmInfos);
                            for (var R = O.next(); !R.done; R = O.next()) if (R = R.value, R.keyIds.size && R.keySystem == E) {
                              L.allowedByKeySystem = true;
                              R = t(R.keyIds);
                              for (var S = R.next(); !S.done; S = R.next()) if (S = S.value, (S = A[H ? "00" : S]) || a.C.F) L.allowedByKeySystem = L.allowedByKeySystem && !!S && !Qi.includes(S);
                            }
                          } else for (L.allowedByKeySystem = true, O = t(O.keyIds), R = O.next(); !R.done; R = O.next()) if (R = R.value, (R = A[H ? "00" : R]) || a.C.F) L.allowedByKeySystem = L.allowedByKeySystem && !!R && !Qi.includes(R);
                        }
                        P != L.allowedByKeySystem && (K = true);
                      }
                    }
                  }
                  if (K && (nq(a), !oq(a))) break a;
                  (A = a.j.l) && !A.allowedByKeySystem && Op(a);
                }
              });
            }, onExpirationUpdated: function(B, A) {
              var H = Rp("expirationupdated");
              h.dispatchEvent(H);
              if ((H = h.l) && H.onExpirationUpdated) H.onExpirationUpdated(B, A);
            }, onEvent: function(B) {
              h.dispatchEvent(B);
              "drmsessionupdate" == B.type && v && (v = false, B = Date.now() / 1e3 - h.ya, (a.A || h.getStats()).j = B, a.O && kd(a.O));
            } };
            z = Lp(a, l);
            kh(a.F, z);
            C = function() {
              return a.Lc(x);
            };
            D = { config: k2, $i: q, kj: u, jj: w, Lc: C, Zi: p, networkingEngine: z, Uh: e, Th: g };
            h = new jo(b, d, c, D);
            return G.return(h);
          });
        }
        function aq(a, b) {
          var c, d;
          return Q(function(e) {
            if (1 == e.g) return c = a.g.manifest.retryParameters, F(e, Do(b, a.F, c), 2);
            d = e.h;
            "application/x-mpegurl" == d && rc() && (d = "application/vnd.apple.mpegurl");
            return e.return(d);
          });
        }
        function iq(a, b) {
          if (!fc()) return true;
          if (b) {
            if ("" == (a.h || hc()).canPlayType(b)) return false;
            if (!fc() || !Ti.has(b)) return true;
            if (xf(b)) return rc() && (a.g.drm.servers["com.apple.fps"] || a.g.drm.servers["com.apple.fps.1_0"]) ? a.g.streaming.useNativeHlsForFairPlay : a.g.streaming.preferNativeHls;
            if ("application/dash+xml" === b || "video/vnd.mpeg.dash.mpd" === b) return a.g.streaming.preferNativeDash;
          }
          return false;
        }
        function pq(a) {
          var b = a.g.textDisplayFactory;
          b !== a.Se && (a.B = b(), a.B.configure ? a.B.configure(a.g.textDisplayer) : sb("Text displayer w/ configure", 'Text displayer should have a "configure" method!'), a.Se = b, a.B.setTextVisibility(a.oa));
        }
        function Zp(a) {
          var b, c, d;
          return Q(function(e) {
            if (1 == e.g) return Vp(a, "media-source"), a.h.removeAttribute("src"), Zj(a.h), pq(a), b = qq(a.h, a.B, { si: function() {
              return a.keySystem();
            }, onMetadata: function(f, g, h) {
              f = t(f);
              for (var k2 = f.next(); !k2.done; k2 = f.next()) if (k2 = k2.value, k2.data && "number" == typeof k2.cueTime && k2.frames) {
                var l = k2.cueTime + g, m = h;
                m && l > m && (m = l);
                for (var n = t(k2.frames), p = n.next(); !p.done; p = n.next()) kq(a, l, m, "org.id3", p.value);
                if (a.u) a.u.onHlsTimedMetadata(k2, l);
              }
            }, ej: function(f) {
              a.Ga && gm(a.Ga, {
                schemeIdUri: f.schemeIdUri,
                startTime: f.startTime,
                endTime: f.endTime,
                id: String(f.id),
                emsg: f
              });
            }, onEvent: function(f) {
              return a.dispatchEvent(f);
            }, gj: function() {
              a.H && a.H.update && a.H.update();
            } }, a.O), b.configure(a.g.mediaSource), c = a.g.manifest, d = c.segmentRelativeVttTiming, b.Ea = d, F(e, b.G, 2);
            a.I = b;
            I(e);
          });
        }
        function rq(a, b, c) {
          function d() {
            return sq(a);
          }
          a.l.D(b, "playing", d);
          a.l.D(b, "pause", d);
          a.l.D(b, "ended", d);
          a.l.D(b, "ratechange", function() {
            var e = a.h.playbackRate;
            0 != e && (a.K && (a.K.set(e), a.m == tq && a.o.playbackRateChanged(e), uq(a, e)), e = Rp("ratechange"), a.dispatchEvent(e));
          });
          b.remote && (a.l.D(b.remote, "connect", function() {
            return nq(a);
          }), a.l.D(b.remote, "connecting", function() {
            return nq(a);
          }), a.l.D(b.remote, "disconnect", function() {
            return Q(function(e) {
              if (1 == e.g) return a.j && "disconnected" == b.remote.state ? F(
                e,
                Sm(a.j),
                2
              ) : e.s(2);
              nq(a);
              I(e);
            });
          }));
          b.audioTracks && (a.l.D(b.audioTracks, "addtrack", function() {
            return nq(a);
          }), a.l.D(b.audioTracks, "removetrack", function() {
            return nq(a);
          }), a.l.D(b.audioTracks, "change", function() {
            return nq(a);
          }));
          b.textTracks && (a.l.D(b.textTracks, "addtrack", function(e) {
            if (e.track) switch (e = e.track, e.kind) {
              case "metadata":
                vq(a, e);
                break;
              case "chapters":
                wq(a, e);
                break;
              default:
                nq(a);
            }
          }), a.l.D(b.textTracks, "removetrack", function() {
            return nq(a);
          }), a.l.D(b.textTracks, "change", function() {
            return nq(a);
          }), "keep" !== a.g.streaming.crossBoundaryStrategy && (a.l.D(b, "waiting", function() {
            a.j && Wm(a.j);
          }), a.l.D(b, "timeupdate", function() {
            a.j && Wm(a.j);
          })));
          "none" != b.preload && a.l.ma(b, "loadedmetadata", function() {
            a.A.C = Date.now() / 1e3 - c;
          });
        }
        function eq(a, b, c, d) {
          var e, f, g, h, k2, l, m, n, p, q, u, w, v, x, z, C, D, G, B, A, H, E, K, M, J, L;
          return Q(function(N) {
            switch (N.g) {
              case 1:
                Vp(a, "load");
                e = a.h;
                a.K = new Wl({ $d: function() {
                  return e.playbackRate;
                }, sc: function() {
                  return e.defaultPlaybackRate;
                }, mg: function(P) {
                  e.playbackRate = P;
                }, gh: function(P) {
                  e.currentTime += P;
                } });
                rq(a, e, b);
                f = false;
                g = t(a.i.variants);
                for (h = g.next(); !h.done; h = g.next()) k2 = h.value, (l = k2.video && k2.video.dependencyStream) && (f = ld(l));
                Qp(a, a.g, f);
                a.Tb = a.g.preferredTextLanguage;
                a.Hd = a.g.preferredTextRole;
                a.Fd = a.g.preferForcedSubs;
                xq(a.i.presentationTimeline, a.g.playRangeStart, a.g.playRangeEnd);
                a.o.init(function(P, O, R) {
                  a.i && a.j && P != a.j.l && yq(a, P, true, void 0 === O ? false : O, void 0 === R ? 0 : R);
                });
                a.o.setMediaElement(e);
                a.o.setCmsdManager(a.fa);
                a.j = zq(a);
                a.j.configure(a.g.streaming);
                a.m = tq;
                a.dispatchEvent(Rp("streaming"));
                m = c;
              case 2:
                (p = a.j.l) || m || (m = oq(a) ? a.o.chooseVariant() : null);
                q = [];
                n = p || m;
                u = t([n.video, n.audio]);
                for (w = u.next(); !w.done; w = u.next()) (v = w.value) && !v.segmentIndex && (q.push(v.createSegmentIndex()), v.dependencyStream && q.push(v.dependencyStream.createSegmentIndex()));
                if (!(0 < q.length)) {
                  N.s(4);
                  break;
                }
                return F(N, Promise.all(q), 4);
              case 4:
                if (!n || 0 != n.disabledUntilTime) {
                  N.s(2);
                  break;
                }
                if (a.H && a.H.onInitialVariantChosen) a.H.onInitialVariantChosen(n);
                a.i.isLowLatency && (a.g.streaming.lowLatencyMode ? a.configure(a.Xe) : bb("Low-latency live stream detected, but low-latency streaming mode is not enabled in Shaka Player. Set streaming.lowLatencyMode configuration to true, and see https://bit.ly/3clctcj for details."));
                a.L && (bp(a.L, a.i.isLowLatency && a.g.streaming.lowLatencyMode), gp(a.L, 1e3 * b));
                xq(a.i.presentationTimeline, a.g.playRangeStart, a.g.playRangeEnd);
                Hm(a.j, a.g.playRangeStart, a.g.playRangeEnd);
                x = function(P) {
                  a.G = Aq(a, P);
                  a.La = Bq(a, P);
                  Cq(a, e, false);
                };
                a.g.streaming.startAtSegmentBoundary || (z = a.Y, null == z && a.i.startTime && (z = a.i.startTime), x(z));
                if (p) {
                  N.s(7);
                  break;
                }
                if (!a.g.streaming.startAtSegmentBoundary) {
                  N.s(8);
                  break;
                }
                C = a.i.presentationTimeline;
                D = a.Y || a.h.currentTime;
                null == a.Y && a.i.startTime && (D = a.i.startTime);
                G = C.Hb();
                B = C.ob();
                D < G ? D = G : D > B && (D = B);
                return F(N, Dq(m, D), 9);
              case 9:
                A = N.h, x(A);
              case 8:
                yq(a, m, true, false, 0);
              case 7:
                return a.G.ready(), H = a.vc().find(function(P) {
                  return P.active;
                }), H || ((E = Ig(a.i.textStreams, a.Tb, a.Hd, a.Fd)[0] || null) && ho(a.A.h, E, true), m && (E ? (Lg(m.audio, E, a.g) && (a.oa = true), a.oa && a.B.setTextVisibility(true), Eq(a)) : a.oa = false), E && (a.g.streaming.alwaysStreamText || a.Pf()) && (Qm(a.j, E), Fq(a))), F(N, a.j.start(d), 10);
              case 10:
                a.g.abr.enabled && (a.o.enable(), Gq(a));
                nq(a);
                oq(a);
                a.i.variants.some(function(P) {
                  return P.primary;
                });
                if ((K = a.U()) && (a.g.streaming.liveSync && a.g.streaming.liveSync.enabled || a.i.serviceDescription || a.g.streaming.liveSync.panicMode) || a.g.streaming.vodDynamicPlaybackRate) M = function() {
                  return Hq(a);
                }, a.l.D(e, "timeupdate", M);
                K || (J = function() {
                  return Iq(a);
                }, a.l.D(e, "timeupdate", J), Iq(a), a.i.nextUrl && (0 < a.g.streaming.preloadNextUrlWindow && (L = function() {
                  var P;
                  return Q(function(O) {
                    if (1 == O.g) {
                      P = a.Ra().end - a.h.currentTime;
                      if (isNaN(P) || !(P <= a.g.streaming.preloadNextUrlWindow)) return O.s(0);
                      a.l.Ja(e, "timeupdate", L);
                      return F(O, a.preload(a.i.nextUrl), 4);
                    }
                    a.ya = O.h;
                    I(O);
                  });
                }, a.l.D(
                  e,
                  "timeupdate",
                  L
                )), a.l.D(e, "ended", function() {
                  a.load(a.ya || a.i.nextUrl);
                })));
                if (a.u) a.u.onManifestUpdated(K);
                a.sa = true;
                I(N);
            }
          });
        }
        function cq(a, b) {
          var c, d, e, f, g;
          return Q(function(h) {
            return 1 == h.g ? (c = fd, d = Date.now() / 1e3, e = true, a.C = a.Lc({ Xb: a.F, onError: function(k2) {
              Yp(a, k2);
            }, pe: function() {
            }, onExpirationUpdated: function() {
              var k2 = Rp("expirationupdated");
              a.dispatchEvent(k2);
            }, onEvent: function(k2) {
              a.dispatchEvent(k2);
              "drmsessionupdate" == k2.type && e && (e = false, a.A.j = Date.now() / 1e3 - d);
            } }), a.C.configure(a.g.drm), f = { id: 0, language: "und", disabledUntilTime: 0, primary: false, audio: null, video: null, bandwidth: 100, allowedByApplication: true, allowedByKeySystem: true, decodingInfos: [] }, g = {
              id: 0,
              originalId: null,
              groupId: null,
              createSegmentIndex: function() {
                return Promise.resolve();
              },
              segmentIndex: null,
              mimeType: b ? vf(b) : "",
              codecs: b ? wf(b) : "",
              encrypted: true,
              drmInfos: [],
              keyIds: /* @__PURE__ */ new Set(),
              language: "und",
              originalLanguage: null,
              label: null,
              type: c.la,
              primary: false,
              trickModeVideo: null,
              dependencyStream: null,
              emsgSchemeIdUris: null,
              roles: [],
              forced: false,
              channelsCount: null,
              audioSamplingRate: null,
              spatialAudio: false,
              closedCaptions: null,
              accessibilityPurpose: null,
              external: false,
              fastSwitching: false,
              fullMimeTypes: /* @__PURE__ */ new Set(),
              isAudioMuxedInVideo: false,
              baseOriginalId: null
            }, g.fullMimeTypes.add(lf(g.mimeType, g.codecs)), b.startsWith("audio/") ? (g.type = c.V, f.audio = g) : f.video = g, a.C.Z = true, F(h, Zh(a.C, [f], []), 2)) : F(h, a.C.Lb(a.h), 0);
          });
        }
        function fq(a, b, c) {
          var d, e, f, g, h, k2, l, m, n, p, q, u;
          return Q(function(w) {
            switch (w.g) {
              case 1:
                Vp(a, "src-equals");
                d = a.h;
                a.G = new Nl(d);
                e = false;
                a.Cd.push(function() {
                  e = true;
                });
                null != a.Y && a.G.af(a.Y);
                a.La = Jq(a, a.Y || 0);
                a.K = new Wl({ $d: function() {
                  return d.playbackRate;
                }, sc: function() {
                  return d.defaultPlaybackRate;
                }, mg: function(v) {
                  d.playbackRate = v;
                }, gh: function(v) {
                  d.currentTime += v;
                } });
                Cq(a, d, true);
                d.textTracks && (pq(a), f = function() {
                  var v = Kq(a).find(function(x) {
                    return "disabled" !== x.mode;
                  });
                  v && (v.mode = "showing");
                }, g = function() {
                  var v = Kq(a).find(function(x) {
                    return "disabled" !== x.mode;
                  });
                  v && (v.mode = "hidden");
                }, a.l.D(d, "enterpictureinpicture", function() {
                  return f();
                }), a.l.D(d, "leavepictureinpicture", function() {
                  return g();
                }), d.remote ? (a.l.D(d.remote, "connect", function() {
                  return g();
                }), a.l.D(d.remote, "connecting", function() {
                  return g();
                }), a.l.D(d.remote, "disconnect", function() {
                  return g();
                })) : "webkitCurrentPlaybackTargetIsWireless" in d && a.l.D(d, "webkitcurrentplaybacktargetiswirelesschanged", function() {
                  return g();
                }), h = d, h.webkitSupportsFullscreen && a.l.D(h, "webkitpresentationmodechanged", function() {
                  "inline" != h.webkitPresentationMode ? f() : g();
                }));
                rq(a, d, b);
                k2 = ip(a.L, a.T, c);
                !k2.includes("#t=") && (0 < a.g.playRangeStart || isFinite(a.g.playRangeEnd)) && (k2 += "#t=", 0 < a.g.playRangeStart && (k2 += a.g.playRangeStart), isFinite(a.g.playRangeEnd) && (k2 += "," + a.g.playRangeEnd));
                if (!a.I) {
                  w.s(2);
                  break;
                }
                return F(w, a.I.destroy(), 3);
              case 3:
                a.I = null;
              case 2:
                return Zj(d), d.src = k2, (lc() || nc()) && d.load(), "none" != d.preload && !d.autoplay && xf(c) && rc() && d.load(), a.m = Lq, a.dispatchEvent(Rp("streaming")), l = new Ug(), El(d, HTMLMediaElement.HAVE_METADATA, a.l, function() {
                  a.G.ready();
                  l.resolve();
                }), m = function() {
                  return new Promise(function(v) {
                    var x = new ec(v);
                    a.l.D(d.textTracks, "change", function() {
                      return x.da(0.5);
                    });
                    x.da(0.5);
                  });
                }, El(d, HTMLMediaElement.HAVE_CURRENT_DATA, a.l, function() {
                  var v, x, z, C, D;
                  return Q(function(G) {
                    if (1 == G.g) return F(G, m(), 2);
                    if (e) return G.return();
                    Mq(a);
                    v = Kq(a);
                    v.some(function(B) {
                      return "showing" === B.mode;
                    }) && (a.oa = true, a.B.setTextVisibility(true));
                    v.length && (a.B.enableTextDisplayer ? a.B.enableTextDisplayer() : sb("Text displayer w/ enableTextDisplayer", 'Text displayer should have a "enableTextDisplayer" method!'));
                    x = false;
                    z = t(v);
                    for (C = z.next(); !C.done; C = z.next()) D = C.value, "disabled" !== D.mode && (x ? (D.mode = "disabled", bb("Found more than one enabled text track, disabling it", D)) : (Nq(a, D), x = true));
                    Oq(a);
                    I(G);
                  });
                }), d.error ? l.reject(Xp(a)) : "none" == d.preload && (bb('With <video preload="none">, the browser will not load anything until play() is called. We are unable to measure load latency in a meaningful way, and we cannot provide track info yet. Please do not use preload="none" with Shaka Player.'), l.resolve()), a.l.ma(d, "error", function() {
                  l.reject(Xp(a));
                }), F(w, Lf(a.g.streaming.loadTimeout, l), 4);
              case 4:
                if ((n = a.U()) && (a.g.streaming.liveSync && a.g.streaming.liveSync.enabled || a.g.streaming.liveSync.panicMode) || a.g.streaming.vodDynamicPlaybackRate) p = function() {
                  return Hq(a);
                }, a.l.D(d, "timeupdate", p);
                n || (q = function() {
                  return Iq(a);
                }, a.l.D(d, "timeupdate", q), Iq(a));
                a.u && (a.u.onManifestUpdated(n), n && (u = a.Ra().end, a.l.D(d, "progress", function() {
                  var v = a.Ra().end;
                  u != v && (a.u.onManifestUpdated(a.U()), u = v);
                })));
                a.sa = true;
                I(w);
            }
          });
        }
        function Mq(a) {
          var b = a.g.preferredAudioLanguage;
          "" != b && a.sh(b, a.g.preferredVariantRole);
        }
        function Oq(a) {
          var b = a.g.preferredTextLanguage;
          "" != b && a.hg(b, a.g.preferredTextRole, a.g.preferForcedSubs);
        }
        function vq(a, b) {
          if ("metadata" == b.kind) {
            b.mode = "hidden";
            a.l.D(b, "cuechange", function() {
              if (b.activeCues) {
                for (var d = t(b.activeCues), e = d.next(); !e.done; e = d.next()) if (e = e.value, kq(a, e.startTime, e.endTime, e.type, e.value), a.u) a.u.onCueMetadataChange(e.value);
              }
              if (b.cues) {
                d = [];
                e = t(b.cues);
                for (var f = e.next(), g = {}; !f.done; g = { bc: void 0 }, f = e.next()) g.bc = f.value, "com.apple.quicktime.HLS" == g.bc.type && null != g.bc.startTime && (f = d.find(/* @__PURE__ */ function(h) {
                  return function(k2) {
                    return k2.startTime == h.bc.startTime && k2.endTime == h.bc.endTime;
                  };
                }(g)), f || (f = { startTime: g.bc.startTime, endTime: g.bc.endTime, values: [] }, d.push(f)), f.values.push(g.bc.value));
                d = t(d);
                for (e = d.next(); !e.done; e = d.next()) e = e.value, e.values.some(function(h) {
                  return "X-ASSET-URI" == h.key || "X-ASSET-LIST" == h.key;
                }) && a.u && (e.values.push({ key: "CUE", description: "", data: 0 != e.startTime || a.U() ? "ONCE" : "ONCE,PRE", mimeType: null, pictureType: null }), a.u.onHLSInterstitialMetadata(a, a.h, e));
              }
            });
            var c = new ec(function() {
              var d = Pq(a);
              d = t(d);
              for (var e = d.next(); !e.done; e = d.next()) e.value.mode = "hidden";
            }).sb().da(0.5);
            a.Cd.push(function() {
              c.stop();
            });
          }
        }
        function Qq(a, b) {
          b = (/* @__PURE__ */ new Map()).set("startTime", b.startTime).set("endTime", b.endTime).set("metadataType", b.schemeIdUri).set("payload", b.payload);
          a.dispatchEvent(Rp("metadata", b));
        }
        function kq(a, b, c, d, e) {
          a.Aa && (b = { schemeIdUri: d, startTime: b, endTime: c || Infinity, id: "", payload: e }, b.id = JSON.stringify(b), gm(a.Aa, b));
        }
        function wq(a, b) {
          if (b && "chapters" == b.kind) {
            b.mode = "hidden";
            var c = new ec(function() {
              b.mode = "hidden";
            }).sb().da(0.5);
            a.Cd.push(function() {
              c.stop();
            });
          }
        }
        r.oj = function() {
          for (var a = this.Z; a.g; ) a.release();
        };
        r.Lc = function(a) {
          return new Sh(a);
        };
        function Lp(a, b) {
          function c(e) {
            b() ? b().dispatchEvent(e) : a.dispatchEvent(e);
          }
          function d(e) {
            b() ? ko(b(), true, e) : e();
          }
          b || (b = function() {
            return null;
          });
          return new gh(function(e, f, g, h) {
            var k2 = b() ? b().j : a.o;
            k2 && k2.segmentDownloaded(e, f, g, h);
          }, function(e, f, g) {
            f = (/* @__PURE__ */ new Map()).set("headers", e).set("request", f).set("requestType", g);
            c(Rp("downloadheadersreceived", f));
            d(function() {
              if (a.fa) {
                var h = a.fa;
                if (h.h.enabled) {
                  var k2 = e["cmsd-static"];
                  if (k2) try {
                    var l = /* @__PURE__ */ new Map(), m = k2.split(",");
                    for (k2 = 0; k2 < m.length; k2++) {
                      var n = m[k2].split("=");
                      l.set(
                        n[0],
                        Fp(n[1])
                      );
                    }
                  } catch (v) {
                  }
                  if (l = e["cmsd-dynamic"]) {
                    try {
                      var p = /* @__PURE__ */ new Map(), q = l.split(";");
                      for (l = 1; l < q.length; l++) {
                        var u = q[l].split("=");
                        p.set(u[0], Fp(u[1]));
                      }
                      var w = p;
                    } catch (v) {
                      w = null;
                    }
                    w && (h.g = w);
                  }
                }
              }
            });
          }, function(e, f) {
            e = (/* @__PURE__ */ new Map()).set("request", e).set("response", f);
            c(Rp("downloadcompleted", e));
          }, function(e, f, g, h) {
            e = (/* @__PURE__ */ new Map()).set("request", e).set("error", f).set("httpResponseCode", g).set("aborted", h);
            c(Rp("downloadfailed", e));
          }, function(e, f, g) {
            d(function() {
              var h = a.L, k2 = g;
              k2 = void 0 === k2 ? {} : k2;
              if (h.g.enabled) if ("HEAD" === f.method) pp(
                h,
                f
              );
              else switch (e) {
                case 0:
                  try {
                    if (h.g.enabled) {
                      if (k2.type) {
                        a: {
                          switch (k2.type) {
                            case 4:
                              var l = h.l ? dp : cp;
                              break a;
                            case 3:
                            case 2:
                              l = h.l ? fp : ep;
                              break a;
                            case 5:
                              l = "s";
                              break a;
                          }
                          l = void 0;
                        }
                        h.i = l;
                      }
                      pp(h, f, { ot: mp, su: !h.u });
                    }
                  } catch (N) {
                    cb("CMCD_MANIFEST_ERROR", "Could not generate manifest CMCD data.", N);
                  }
                  break;
                case rh:
                  try {
                    if (h.g.enabled) {
                      var m = k2.segment;
                      l = 0;
                      m && (l = m.endTime - m.startTime);
                      var n = { d: 1e3 * l, st: h.h.U() ? "l" : "v" };
                      n.ot = tp(k2);
                      var p = n.ot === qp || n.ot === kp || n.ot === lp || n.ot === vp, q = k2.stream;
                      if (q) {
                        var u = h.h.gb();
                        if (p && (n.bl = xp(
                          h,
                          q.type
                        ), n.ot !== vp)) {
                          var w = yp(h, q.type);
                          n.dl = u ? w / Math.abs(u) : w;
                        }
                        q.bandwidth && (n.br = q.bandwidth / 1e3);
                        if (q.segmentIndex && m) {
                          var v = q.segmentIndex.Gb(m.endTime, true, 0 > u);
                          if (v) {
                            var x = v.next().value;
                            if (x && x != m) {
                              if (!Ed(m.N(), x.N())) {
                                var z = x.N()[0], C = f.uris[0], D = new URL(z), G = new URL(C);
                                if (D.origin !== G.origin) var B = z;
                                else {
                                  for (var A = D.pathname.split("/").slice(1), H = G.pathname.split("/").slice(1, -1); A[0] === H[0]; ) A.shift(), H.shift();
                                  for (; H.length; ) H.shift(), A.unshift("..");
                                  B = A.join("/");
                                }
                                n.nor = B;
                              }
                              if ((x.Sa || x.wa) && (m.Sa != x.Sa || m.wa != x.wa)) {
                                var E = x.Sa + "-";
                                x.wa && (E += x.wa);
                                n.nrr = E;
                              }
                            }
                          }
                          var K = h.h.gb() || 1, M = yp(h, q.type) || 500, J = q.bandwidth;
                          var L = J ? J * (m.endTime - m.startTime) / 1e3 / (M / K / 1e3) * h.g.rtpSafetyFactor : NaN;
                          isNaN(L) || (n.rtp = L);
                        }
                      }
                      p && n.ot !== vp && (n.tb = zp(h, n.ot) / 1e3);
                      pp(h, f, n);
                    }
                  } catch (N) {
                    cb("CMCD_SEGMENT_ERROR", "Could not generate segment CMCD data.", N);
                  }
                  break;
                case 2:
                case 5:
                case 6:
                  pp(h, f, { ot: "k" });
                  break;
                case 4:
                  pp(h, f, { ot: "o" });
              }
            });
          }, function(e, f, g, h) {
            (e = b() ? b().l : a.H) && e.banLocation && e.banLocation(h);
          }, function(e, f) {
            if (f.data) {
              f = f.data.byteLength;
              var g = b() ? b().getStats() : a.A;
              g && (g.mc = isNaN(g.mc) ? f : g.mc + f, 0 === e && (g.bh = f));
            }
          });
        }
        function Aq(a, b) {
          return new Ol(a.h, a.i, a.g.streaming, b, function() {
            a.La && Zl(a.La, true);
            a.j && a.j.Fc();
            a.M && Rq(a);
          }, function(c) {
            return a.dispatchEvent(c);
          });
        }
        function Bq(a, b) {
          var c = a.U() || 0 < b;
          b = new yo(a.yd, c);
          b.addEventListener("enter", function(f) {
            lq(a, "timelineregionenter", f.region);
          });
          b.addEventListener("exit", function(f) {
            lq(a, "timelineregionexit", f.region);
          });
          b.addEventListener("skip", function(f) {
            var g = f.region;
            f.seeking || (lq(a, "timelineregionenter", g), lq(a, "timelineregionexit", g));
          });
          var d = new yo(a.Aa, c);
          d.addEventListener("enter", function(f) {
            Qq(a, f.region);
          });
          c = new yo(a.Ga, c);
          c.addEventListener("enter", function(f) {
            f = (/* @__PURE__ */ new Map()).set("detail", f.region.emsg);
            a.dispatchEvent(Rp("emsg", f));
          });
          var e = new Yl(a.h);
          e.g.add(b);
          e.g.add(d);
          e.g.add(c);
          a.xd && e.g.add(a.xd);
          return e;
        }
        function Jq(a, b) {
          b = new yo(a.Aa, 0 < b);
          b.addEventListener("enter", function(d) {
            Qq(a, d.region);
          });
          var c = new Yl(a.h);
          c.g.add(b);
          return c;
        }
        function Cq(a, b, c) {
          a.M = new Hi();
          a.M.g = Ji;
          Sq(a);
          $p(a);
          a.pa = new ec(function() {
            Rq(a);
          });
          a.g.streaming.rebufferingGoal && a.pa.ua(0.25);
          a.l.D(b, "waiting", function() {
            return Rq(a);
          });
          a.l.D(b, "canplaythrough", function() {
            return Rq(a);
          });
          a.l.D(b, "playing", function() {
            return Rq(a);
          });
          a.l.D(b, "seeked", function() {
            return Rq(a);
          });
          c && (a.l.D(b, "stalled", function() {
            return Rq(a);
          }), a.l.D(b, "progress", function() {
            return Rq(a);
          }), a.l.D(b, "timeupdate", function() {
            return Rq(a);
          }));
        }
        function Sq(a) {
          var b = a.g.streaming.rebufferingGoal;
          a.M.i.set(Ii, Math.min(0.5, b / 2)).set(Ji, b);
        }
        function Rq(a) {
          switch (a.m) {
            case Lq:
              if (a.Uc()) var b = true;
              else {
                var c = Sj(a.h.buffered);
                b = null != c && c >= a.h.duration - 1;
              }
              break;
            case tq:
              a: if (a.Uc() || Qk(a.I)) b = true;
              else {
                if (a.i.presentationTimeline.U()) {
                  c = a.i.presentationTimeline.cc();
                  var d = Sj(a.h.buffered);
                  if (null != d && d >= c) {
                    b = true;
                    break a;
                  }
                }
                b = false;
              }
              break;
            default:
              b = false;
          }
          d = Uj(a.h.buffered, a.h.currentTime);
          c = a.M;
          var e = b, f = c.i.get(c.g);
          b = c.g;
          d = e || d >= f && 0 < d ? Ii : Ji;
          c.g = d;
          (b = b != d) && d === Ii && (c.h = Date.now());
          b && $p(a);
        }
        function qq(a, b, c, d) {
          return new Jk(a, b, c, d);
        }
        function Kp(a) {
          return new Zo({ getBandwidthEstimate: function() {
            return a.o ? a.o.getBandwidthEstimate() : NaN;
          }, Fb: function() {
            return a.Fb();
          }, getCurrentTime: function() {
            return a.h ? a.h.currentTime : 0;
          }, gb: function() {
            return a.gb();
          }, xb: function() {
            return a.xb();
          }, Rb: function() {
            return a.Rb();
          }, U: function() {
            return a.U();
          }, Zd: function() {
            return a.Zd();
          } }, a.g.cmcd);
        }
        function zq(a) {
          return new Bm(a.i, { Rc: function() {
            return a.G ? a.G.Od() : 0;
          }, getBandwidthEstimate: function() {
            return a.o.getBandwidthEstimate();
          }, gb: function() {
            return a.gb();
          }, video: a.h, aa: a.I, Xb: a.F, onError: function(b) {
            return Yp(a, b);
          }, onEvent: function(b) {
            return a.dispatchEvent(b);
          }, qe: function(b, c, d) {
            var e = b.startTime;
            b = b.endTime;
            c = c.type;
            if (c != dd) {
              if (a.G) {
                a.G.ih();
                var f = Xk(a.I, c);
                !a.U() && a.h.paused && !a.h.seeking && null != f && 0 < f && a.G.Od() < f && a.G.af(f);
              }
              Rq(a);
            }
            d = (/* @__PURE__ */ new Map()).set("start", e).set("end", b).set(
              "contentType",
              c
            ).set("isMuxed", d);
            a.dispatchEvent(Rp("segmentappended", d));
          }, fj: function(b, c) {
            (c = c.Wc) && a.xd && bm(a.xd, c, b);
          }, Fg: function(b, c) {
            var d = a.C;
            if (d.g.parseInbandPsshEnabled && !d.F && ["audio", "video"].includes(b)) {
              b = new Qh(Qb(c));
              c = 0;
              for (var e = t(b.data), f = e.next(); !f.done; f = e.next()) c += f.value.length;
              if (0 == c) d = Promise.resolve();
              else {
                c = new Uint8Array(c);
                e = 0;
                b = t(b.data);
                for (f = b.next(); !f.done; f = b.next()) f = f.value, c.set(f, e), e += f.length;
                hi(d, "cenc", c);
                d = d.m;
              }
            } else d = Promise.resolve();
            return d;
          }, disableStream: function(b, c) {
            return a.disableStream(b, c);
          } });
        }
        r.configure = function(a, b) {
          2 == arguments.length && "string" == typeof a && (a = qn(a, b));
          a.streaming && "forceTransmuxTS" in a.streaming && (sb("streaming.forceTransmuxTS configuration", "Please Use mediaSource.forceTransmux instead."), a.mediaSource.mediaSource = a.streaming.forceTransmuxTS, delete a.streaming.forceTransmuxTS);
          a.streaming && "forceTransmux" in a.streaming && (sb("streaming.forceTransmux configuration", "Please Use mediaSource.forceTransmux instead."), a.mediaSource.mediaSource = a.streaming.forceTransmux, delete a.streaming.forceTransmux);
          a.streaming && "useNativeHlsOnSafari" in a.streaming && (sb("streaming.useNativeHlsOnSafari configuration", "Please Use streaming.useNativeHlsForFairPlay or streaming.preferNativeHls instead."), a.streaming.preferNativeHls = a.streaming.useNativeHlsOnSafari && rc(), delete a.streaming.useNativeHlsOnSafari);
          if (a.streaming && "boolean" == typeof a.streaming.liveSync) {
            sb("streaming.liveSync", "Please Use streaming.liveSync.enabled instead.");
            var c = a.streaming.liveSync;
            a.streaming.liveSync = {};
            a.streaming.liveSync.enabled = c;
          }
          if (a.streaming && !(a.streaming.liveSync && "targetLatency" in a.streaming.liveSync) && ("liveSyncMinLatency" in a.streaming || "liveSyncMaxLatency" in a.streaming)) {
            c = a.streaming.liveSyncMinLatency || 0;
            var d = Math.abs((a.streaming.liveSyncMaxLatency || 1) - c) / 2;
            a.streaming.liveSync = a.streaming.liveSync || {};
            a.streaming.liveSync.targetLatency = c + d;
            a.streaming.liveSync.targetLatencyTolerance = d;
          }
          a.streaming && "liveSyncMaxLatency" in a.streaming && (sb("streaming.liveSyncMaxLatency", "Please Use streaming.liveSync.targetLatency and streaming.liveSync.targetLatencyTolerance instead. Or, set the values in your DASH manifest"), delete a.streaming.liveSyncMaxLatency);
          a.streaming && "liveSyncMinLatency" in a.streaming && (sb("streaming.liveSyncMinLatency", "Please Use streaming.liveSync.targetLatency and streaming.liveSync.targetLatencyTolerance instead. Or, set the values in your DASH manifest"), delete a.streaming.liveSyncMinLatency);
          a.streaming && "liveSyncTargetLatency" in a.streaming && (sb("streaming.liveSyncTargetLatency", "Please Use streaming.liveSync.targetLatency instead."), a.streaming.liveSync = a.streaming.liveSync || {}, a.streaming.liveSync.targetLatency = a.streaming.liveSyncTargetLatency, delete a.streaming.liveSyncTargetLatency);
          a.streaming && "liveSyncTargetLatencyTolerance" in a.streaming && (sb("streaming.liveSyncTargetLatencyTolerance", "Please Use streaming.liveSync.targetLatencyTolerance instead."), a.streaming.liveSync = a.streaming.liveSync || {}, a.streaming.liveSync.targetLatencyTolerance = a.streaming.liveSyncTargetLatencyTolerance, delete a.streaming.liveSyncTargetLatencyTolerance);
          a.streaming && "liveSyncPlaybackRate" in a.streaming && (sb(
            "streaming.liveSyncPlaybackRate",
            "Please Use streaming.liveSync.maxPlaybackRate instead."
          ), a.streaming.liveSync = a.streaming.liveSync || {}, a.streaming.liveSync.maxPlaybackRate = a.streaming.liveSyncPlaybackRate, delete a.streaming.liveSyncPlaybackRate);
          a.streaming && "liveSyncMinPlaybackRate" in a.streaming && (sb("streaming.liveSyncMinPlaybackRate", "Please Use streaming.liveSync.minPlaybackRate instead."), a.streaming.liveSync = a.streaming.liveSync || {}, a.streaming.liveSync.minPlaybackRate = a.streaming.liveSyncMinPlaybackRate, delete a.streaming.liveSyncMinPlaybackRate);
          a.streaming && "liveSyncPanicMode" in a.streaming && (sb("streaming.liveSyncPanicMode", "Please Use streaming.liveSync.panicMode instead."), a.streaming.liveSync = a.streaming.liveSync || {}, a.streaming.liveSync.panicMode = a.streaming.liveSyncPanicMode, delete a.streaming.liveSyncPanicMode);
          a.streaming && "liveSyncPanicThreshold" in a.streaming && (sb("streaming.liveSyncPanicThreshold", "Please Use streaming.liveSync.panicThreshold instead."), a.streaming.liveSync = a.streaming.liveSync || {}, a.streaming.liveSync.panicThreshold = a.streaming.liveSyncPanicThreshold, delete a.streaming.liveSyncPanicThreshold);
          if (a.mediaSource && "sourceBufferExtraFeatures" in a.mediaSource) {
            sb("mediaSource.sourceBufferExtraFeatures configuration", "Please Use mediaSource.addExtraFeaturesToSourceBuffer() instead.");
            var e = a.mediaSource.sourceBufferExtraFeatures;
            a.mediaSource.addExtraFeaturesToSourceBuffer = function() {
              return e;
            };
            delete a.mediaSource.sourceBufferExtraFeatures;
          }
          a.manifest && a.manifest.hls && "useSafariBehaviorForLive" in a.manifest.hls && (sb(
            "manifest.hls.useSafariBehaviorForLive configuration",
            "Please Use liveSync config to keep on live Edge instead."
          ), delete a.manifest.hls.useSafariBehaviorForLive);
          a.streaming && "parsePrftBox" in a.streaming && (sb("streaming.parsePrftBox configuration", "Now fired without needing a configuration."), delete a.streaming.parsePrftBox);
          a.manifest && a.manifest.dash && "enableAudioGroups" in a.manifest.dash && (sb("manifest.dash.enableAudioGroups configuration", "It is now enabled by default and cannot be disabled."), delete a.manifest.dash.enableAudioGroups);
          a.streaming && "dispatchAllEmsgBoxes" in a.streaming && (sb("streaming.dispatchAllEmsgBoxes configuration", "Please Use mediaSource.dispatchAllEmsgBoxes instead."), a.mediaSource.dispatchAllEmsgBoxes = a.streaming.dispatchAllEmsgBoxes, delete a.streaming.dispatchAllEmsgBoxes);
          a.streaming && "autoLowLatencyMode" in a.streaming && (sb("streaming.autoLowLatencyMode configuration", "Please Use streaming.lowLatencyMode instead."), a.streaming.lowLatencyMode = a.streaming.autoLowLatencyMode, delete a.streaming.autoLowLatencyMode);
          a.manifest && a.manifest.dash && "ignoreSupplementalCodecs" in a.manifest.dash && (sb("manifest.dash.ignoreSupplementalCodecs configuration", "Please Use manifest.ignoreSupplementalCodecs instead."), a.manifest.ignoreSupplementalCodecs = a.manifest.dash.ignoreSupplementalCodecs, delete a.manifest.dash.ignoreSupplementalCodecs);
          a.manifest && a.manifest.hls && "ignoreSupplementalCodecs" in a.manifest.hls && (sb("manifest.hls.ignoreSupplementalCodecs configuration", "Please Use manifest.ignoreSupplementalCodecs instead."), a.manifest.ignoreSupplementalCodecs = a.manifest.hls.ignoreSupplementalCodecs, delete a.manifest.hls.ignoreSupplementalCodecs);
          a.manifest && a.manifest.dash && "updatePeriod" in a.manifest.dash && (sb("manifest.dash.updatePeriod configuration", "Please Use manifest.updatePeriod instead."), a.manifest.updatePeriod = a.manifest.dash.updatePeriod, delete a.manifest.dash.updatePeriod);
          a.manifest && a.manifest.hls && "updatePeriod" in a.manifest.hls && (sb("manifest.hls.updatePeriod configuration", "Please Use manifest.updatePeriod instead."), a.manifest.updatePeriod = a.manifest.hls.updatePeriod, delete a.manifest.hls.updatePeriod);
          a.manifest && a.manifest.dash && "ignoreDrmInfo" in a.manifest.dash && (sb("manifest.dash.ignoreDrmInfo configuration", "Please Use manifest.ignoreDrmInfo instead."), a.manifest.ignoreDrmInfo = a.manifest.dash.ignoreDrmInfo, delete a.manifest.dash.ignoreDrmInfo);
          if (a.drm && a.drm.advanced) {
            c = false;
            for (var f in a.drm.advanced) {
              var g = a.drm.advanced[f];
              d = g.videoRobustness;
              g = g.audioRobustness;
              "videoRobustness" in a.drm.advanced[f] && !Array.isArray(a.drm.advanced[f].videoRobustness) && (a.drm.advanced[f].videoRobustness = [d], c = true);
              "audioRobustness" in a.drm.advanced[f] && !Array.isArray(a.drm.advanced[f].audioRobustness) && (a.drm.advanced[f].audioRobustness = [g], c = true);
            }
            c && sb("AdvancedDrmConfiguration's videoRobustness and audioRobustness", "These properties are no longer strings but array of strings, please update your usage of these properties.");
          }
          a.streaming && "crossBoundaryStrategy" in a.streaming && "keep" != a.streaming.crossBoundaryStrategy && (a.streaming.inaccurateManifestTolerance = 0);
          f = On(this.g, a, Jp(this));
          Tq(this);
          return f;
        };
        r.ci = function(a) {
          this.Xe = a;
        };
        function Tq(a) {
          a.te = new Ki(a.g, a.ka, a.C);
          if (a.H) {
            var b = Nd(a.g.manifest);
            a.h && "AUDIO" === a.h.nodeName && (b.disableVideo = true);
            a.H.configure(b);
          }
          a.C && a.C.configure(a.g.drm);
          if (a.j) {
            a.j.configure(a.g.streaming);
            try {
              a.m != Sp && Mi(a.te, a.i) && nq(a);
            } catch (e) {
              Yp(a, e);
            }
            a.o && oq(a);
            b = a.j.l;
            !b || b.allowedByApplication && b.allowedByKeySystem || Op(a);
          }
          a.F && (a.F.kg(a.g.streaming.forceHTTP), a.F.lg(a.g.streaming.forceHTTPS), a.F.o = a.g.streaming.minBytesForProgressEvents);
          a.I && (a.I.configure(a.g.mediaSource), a.I.Ea = a.g.manifest.segmentRelativeVttTiming);
          if (a.B) if (b = a.g.textDisplayFactory, a.Se != b) {
            var c = a.B;
            a.B = b();
            a.B.configure ? a.B.configure(a.g.textDisplayer) : sb("Text displayer w/ configure", 'Text displayer should have a "configure" method!');
            a.B.setTextLanguage || sb("Text displayer w/ setTextLanguage", 'Text displayer should have a "setTextLanguage" method!');
            a.B.setTextVisibility(c.isTextVisible());
            c.destroy();
            if (a.I) {
              c = a.I;
              var d = a.B;
              c.ea = d;
              c.h && (c.h.j = d);
            }
            a.Se = b;
            a.j && (b = a.j, (c = b.i.get(dd)) && Om(b, c.stream, true, 0, true));
          } else a.B.configure && a.B.configure(a.g.textDisplayer);
          a.o && (a.o.configure(a.g.abr), a.g.abr.enabled ? a.o.enable() : a.o.disable(), Gq(a));
          a.M && Sq(a);
          a.pa && (a.g.streaming.rebufferingGoal ? a.pa.ua(0.25) : a.pa.stop());
          a.i && xq(a.i.presentationTimeline, a.g.playRangeStart, a.g.playRangeEnd);
          a.u && a.u.configure(a.g.ads);
          a.L && a.L.configure(a.g.cmcd);
          a.fa && a.fa.configure(a.g.cmsd);
        }
        r.getConfiguration = function() {
          var a = Jp(this);
          On(a, this.g, Jp(this));
          return a;
        };
        r.ki = function() {
          return this.Xe;
        };
        r.Vg = function() {
          var a = Jp(this);
          On(a, this.g, Jp(this));
          return sn(this.g, Jp(this));
        };
        r.Qg = function() {
          if (this.h) {
            var a = this.h.buffered.length;
            a = a ? this.h.buffered.end(a - 1) : 0;
            var b = this.getConfiguration().streaming.bufferingGoal;
            b = Math.min(this.h.currentTime + b, this.Ra().end);
            if (a >= b) return 1;
            if (!(a <= this.h.currentTime) && a < b) return (a - this.h.currentTime) / (b - this.h.currentTime);
          }
          return 0;
        };
        r.sj = function() {
          for (var a in this.g) delete this.g[a];
          On(this.g, Jp(this), Jp(this));
          Tq(this);
        };
        r.ti = function() {
          return this.m;
        };
        r.Tg = function() {
          return this.i ? this.i.type : null;
        };
        r.xi = function() {
          return this.h;
        };
        r.xb = function() {
          return this.F;
        };
        r.Qc = function() {
          return this.T;
        };
        r.Pg = function() {
          return this.u ? this.u : null;
        };
        r.U = function() {
          return this.i && !this.Pa() ? this.i.presentationTimeline.U() : this.h && this.h.src ? Infinity == this.h.duration : false;
        };
        r.yc = function() {
          return this.i ? this.i.presentationTimeline.yc() : false;
        };
        r.Qi = function() {
          if (this.i && !this.Pa()) {
            var a = this.i.variants;
            return a.length ? !a[0].video : false;
          }
          return this.h && this.h.src ? this.h.videoTracks ? 0 == this.h.videoTracks.length : 0 == this.h.videoHeight : false;
        };
        r.Ra = function() {
          if (this.i && !this.Pa()) {
            if (!this.sa && "HLS" == this.i.type) return { start: 0, end: 0 };
            var a = this.i.presentationTimeline;
            return { start: a.Hb(), end: a.ob() };
          }
          if (this.h && this.h.src && (a = this.h.seekable) && a.length) {
            var b = this.g ? this.g.playRangeStart : 0;
            b = Math.max(a.start(0), b);
            var c = this.g ? this.g.playRangeEnd : Infinity;
            a = Math.min(a.end(a.length - 1), c);
            return { start: b, end: a };
          }
          return { start: 0, end: 0 };
        };
        r.Ni = function() {
          this.U() && (this.h.currentTime = this.Ra().end);
        };
        r.Ri = function() {
          return this.sa;
        };
        r.keySystem = function() {
          var a = this.drmInfo();
          return a ? a.keySystem : "";
        };
        r.drmInfo = function() {
          return this.C ? this.C.h : null;
        };
        r.pd = function() {
          return this.C ? this.C.pd() : Infinity;
        };
        r.Gf = function() {
          return this.C ? this.C.Gf() : [];
        };
        r.Yd = function() {
          return this.C ? this.C.Yd() : {};
        };
        r.Of = function() {
          return this.M ? this.M.g == Ji : false;
        };
        r.gb = function() {
          return this.h ? this.K ? this.K.i : 1 : 0;
        };
        r.Md = function(a, b) {
          b = void 0 === b ? true : b;
          0 == a ? bb("A trick play rate of 0 is unsupported!") : (this.K.set(a), this.m == tq && (this.o.playbackRateChanged(a), Nm(this.j, b && 1 < Math.abs(a))), uq(this, a));
        };
        r.gd = function() {
          var a = this.K.sc();
          this.m == Lq && this.K.set(a);
          this.m == tq && (this.K.set(a), this.o.playbackRateChanged(a), Nm(this.j, false));
          this.Na.Qa();
        };
        r.Rb = function() {
          if (this.i && !this.Pa()) {
            for (var a = this.j ? this.j.l : null, b = [], c = 0, d = t(this.i.variants), e = d.next(); !e.done; e = d.next()) if (e = e.value, Gg(e)) {
              var f = xg(e);
              f.active = e == a;
              f.active || 1 == c || null == a || e.video != a.video || e.audio != a.audio || (f.active = true);
              f.active && c++;
              b.push(f);
            }
            return b;
          }
          return this.h && this.h.audioTracks ? Array.from(this.h.audioTracks).map(function(g) {
            return Fg(g);
          }) : [];
        };
        r.vc = function() {
          if (this.i && !this.Pa()) {
            for (var a = this.j ? this.j.u : null, b = [], c = t(this.i.textStreams), d = c.next(); !d.done; d = c.next()) {
              d = d.value;
              var e = yg(d);
              e.active = d == a;
              b.push(e);
            }
            return b;
          }
          return this.h && this.h.src && this.h.textTracks ? Kq(this).map(function(f) {
            return Dg(f);
          }) : [];
        };
        r.pi = function() {
          var a = this.Oe;
          this.i && (a = this.i.imageStreams);
          return a.map(function(b) {
            return zg(b);
          });
        };
        r.fi = function(a) {
          var b = this, c, d;
          return Q(function(e) {
            if (1 == e.g) return F(e, Uq(b, a), 2);
            c = e.h;
            if (!c) return e.return(null);
            d = [];
            c.segmentIndex.Eb(function(f) {
              var g = Vq(f.tilesLayout || c.tilesLayout);
              if (g) {
                g = g.rows * g.oc;
                for (var h = f.j - f.startTime, k2 = 0; k2 < g; k2++) {
                  var l = Wq(c, f.startTime + h * k2 / g);
                  l && d.push(l);
                }
              }
            });
            c.closeSegmentIndex && c.closeSegmentIndex();
            return e.return(d);
          });
        };
        function Vq(a) {
          return a ? (a = /(\d+)x(\d+)/.exec(a)) ? { oc: parseInt(a[1], 10), rows: parseInt(a[2], 10) } : null : null;
        }
        r.Hi = function(a, b) {
          var c = this, d;
          return Q(function(e) {
            return 1 == e.g ? F(e, Uq(c, a), 2) : (d = e.h) ? e.return(Wq(d, b)) : e.return(null);
          });
        };
        function Uq(a, b) {
          var c, d;
          return Q(function(e) {
            if (1 == e.g) {
              if (a.m != tq && a.m != Lq) return e.return(null);
              c = a.Oe;
              a.i && (c = a.i.imageStreams);
              d = c[0];
              if (!d) return e.return(null);
              null != b && (d = c.find(function(f) {
                return f.id == b;
              }));
              return d ? d.segmentIndex ? e.s(2) : F(e, d.createSegmentIndex(), 2) : e.return(null);
            }
            return e.return(d);
          });
        }
        function Wq(a, b) {
          var c = a.segmentIndex.find(b);
          if (null == c) return null;
          c = a.segmentIndex.get(c);
          var d = Vq(c.tilesLayout || a.tilesLayout);
          if (!d) return null;
          var e = a.width || 0, f = a.height || 0, g = e / d.oc, h = f / d.rows, k2 = d.oc * d.rows, l = c.j - c.startTime;
          l = c.B || l / k2;
          var m = c.startTime, n = 0, p = 0;
          1 < k2 && (b = Math.floor((b - c.startTime) / l), m = c.startTime + b * l, n = b % d.oc * g, p = Math.floor(b / d.oc) * h);
          b = false;
          if (d = c.thumbnailSprite) b = true, h = d.height, n = d.positionX, p = d.positionY, g = d.width;
          return {
            segment: c,
            imageHeight: f,
            imageWidth: e,
            height: h,
            positionX: n,
            positionY: p,
            startTime: m,
            duration: l,
            uris: c.N(),
            width: g,
            sprite: b,
            mimeType: c.mimeType || a.mimeType,
            codecs: c.codecs || a.codecs
          };
        }
        r.th = function(a) {
          function b() {
            var d = c.i.textStreams.find(function(e) {
              return e.id == a.id;
            });
            d && d != c.j.u && (ho(c.A.h, d, false), Qm(c.j, d), Xq(c), Fq(c), c.Tb = d.language);
          }
          var c = this;
          if (this.i && this.G && (b(), !this.Pa())) return;
          (function() {
            if (c.h && c.h.textTracks) {
              var d = Kq(c), e = d.find(function(f) {
                return "disabled" !== f.mode;
              });
              if (d = d.find(function(f) {
                return Bg(f) === a.id;
              })) e !== d && (e && (e.mode = "disabled", c.l.Ja(e, "cuechange"), c.B.remove(0, Infinity)), d && Nq(c, d)), Xq(c), Fq(c);
            }
          })();
        };
        function Nq(a, b) {
          a.l.D(b, "cuechange", function() {
            a.B.remove(0, Math.max(0, a.h.currentTime - a.g.streaming.bufferBehind));
            var c = { periodStart: 0, segmentStart: 0, segmentEnd: a.h.duration, vttOffset: 0 }, d = [], e = Array.from(b.activeCues || []);
            e = t(e);
            for (var f = e.next(); !f.done; f = e.next()) {
              f = f.value;
              if (Infinity === f.endTime || f.endTime < f.startTime) f = null;
              else {
                var g = new Ae(f.startTime, f.endTime, f.text);
                g.line = "number" === typeof f.line ? f.line : null;
                f.lineAlign && (g.lineAlign = f.lineAlign);
                g.lineInterpretation = f.snapToLines ? Fe : 1;
                g.position = "number" === typeof f.position ? f.position : null;
                f.positionAlign && (g.positionAlign = f.positionAlign);
                g.size = f.size;
                g.textAlign = f.align;
                "lr" === f.vertical ? g.writingMode = "vertical-lr" : "rl" === f.vertical && (g.writingMode = "vertical-rl");
                f.region && (g.region.id = f.region.id, g.region.height = f.region.lines, g.region.heightUnits = 2, g.region.regionAnchorX = f.region.regionAnchorX, g.region.regionAnchorY = f.region.regionAnchorY, g.region.scroll = f.region.scroll, g.region.viewportAnchorX = f.region.viewportAnchorX, g.region.viewportAnchorY = f.region.viewportAnchorY, g.region.viewportAnchorUnits = zd, g.region.width = f.region.width, g.region.widthUnits = zd);
                Me(g);
                f = g;
              }
              f && ((g = a.g.mediaSource.modifyCueCallback) && g(f, null, c), d.push(f));
            }
            a.B.append(d);
          });
          b.mode = document.pictureInPictureElement ? "showing" : "hidden";
        }
        r.Be = function(a, b, c) {
          function d() {
            var f = e.i.variants.find(function(h) {
              return h.id == a.id;
            });
            if (f && Gg(f)) {
              var g = e.j.l;
              e.g.abr.enabled && (g.video != f.video || g.audio && f.audio && g.audio.language == f.audio.language && g.audio.channelsCount == f.audio.channelsCount && g.audio.label == f.audio.label) && bb("Changing tracks while abr manager is enabled will likely result in the selected track being overridden. Consider disabling abr before calling selectVariantTrack().");
              e.Pa() ? yq(e, f, false, false, 0) : yq(e, f, false, b || false, c || 0);
              e.W.configure({
                language: f.language,
                role: f.audio && f.audio.roles && f.audio.roles[0] || "",
                channelCount: f.audio && f.audio.channelsCount ? f.audio.channelsCount : 0,
                Sc: f.video && f.video.hdr ? f.video.hdr : "",
                spatialAudio: f.audio && f.audio.spatialAudio ? f.audio.spatialAudio : false,
                videoLayout: f.video && f.video.videoLayout ? f.video.videoLayout : "",
                Kc: f.audio && f.audio.label ? f.audio.label : "",
                fd: "",
                codecSwitchingStrategy: e.g.mediaSource.codecSwitchingStrategy,
                audioCodec: f.audio && f.audio.codecs ? f.audio.codecs : ""
              });
              oq(e);
            }
          }
          var e = this;
          b = void 0 === b ? false : b;
          c = void 0 === c ? 0 : c;
          if (this.i && this.G && (d(), !this.Pa())) return;
          (function() {
            if (e.h && e.h.audioTracks) {
              var f = Array.from(e.h.audioTracks);
              f = t(f);
              for (var g = f.next(); !g.done; g = f.next()) if (g = g.value, Bg(g) == a.id) {
                Yq(e, g);
                break;
              }
            }
          })();
        };
        r.xj = function(a, b) {
          b = void 0 === b ? 0 : b;
          var c = this.Rb();
          if (c.length) {
            var d = c.find(function(e) {
              return e.active;
            });
            d && (c = c.find(function(e) {
              return e.videoId === d.videoId && e.language == a.language && e.label == a.label && e.audioMimeType == a.mimeType && e.audioCodec == a.codecs && e.primary == a.primary && Ed(e.audioRoles, a.roles) && e.accessibilityPurpose == a.accessibilityPurpose && e.channelsCount == a.channelsCount && e.audioSamplingRate == a.audioSamplingRate && e.spatialAudio == a.spatialAudio;
            })) && !c.active && this.Be(c, true, b);
          }
        };
        r.getAudioTracks = function() {
          var a = this.Rb();
          if (!a.length) return [];
          var b = a.find(function(e) {
            return e.active;
          });
          if (!b) return [];
          var c = a;
          this.m == tq && (c = a.filter(function(e) {
            return e.originalVideoId === b.originalVideoId && e.audioCodec;
          }));
          if (!c.length) return [];
          a = /* @__PURE__ */ new Set();
          c = t(c);
          for (var d = c.next(); !d.done; d = c.next()) d = d.value, a.add({
            active: d.active,
            language: d.language,
            label: d.label,
            mimeType: d.audioMimeType,
            codecs: d.audioCodec,
            primary: d.primary,
            roles: d.audioRoles || [],
            accessibilityPurpose: d.accessibilityPurpose,
            channelsCount: d.channelsCount,
            audioSamplingRate: d.audioSamplingRate,
            spatialAudio: d.spatialAudio,
            originalLanguage: d.originalLanguage
          });
          return a.size ? Array.from(a) : [];
        };
        r.hi = function() {
          return Zq(this.Rb());
        };
        r.Fi = function() {
          return Zq(this.vc());
        };
        r.gi = function() {
          return Array.from($q(this.Rb()));
        };
        r.Ei = function() {
          return Array.from($q(this.vc()));
        };
        r.sh = function(a, b, c, d, e, f, g) {
          function h() {
            function l(u, w) {
              return u.video || w.video ? u.video && w.video ? Math.abs((u.video.height || 0) - (w.video.height || 0)) + Math.abs((u.video.width || 0) - (w.video.width || 0)) : Infinity : 0;
            }
            k2.W = k2.g.adaptationSetCriteriaFactory();
            k2.W.configure({ language: a, role: b || "", channelCount: c || 0, Sc: "", spatialAudio: f || false, videoLayout: "", Kc: g || "", fd: "", codecSwitchingStrategy: k2.g.mediaSource.codecSwitchingStrategy, audioCodec: e || "" });
            var m = k2.j.l, n = k2.W.create(k2.i.variants), p = null;
            n = t(n.values());
            for (var q = n.next(); !q.done; q = n.next()) q = q.value, Gg(q) && (!p || l(p, m) > l(q, m)) && (p = q);
            p != m && (p ? (m = xg(p), k2.Be(m, true, d || 0)) : Op(k2));
          }
          var k2 = this;
          c = void 0 === c ? 0 : c;
          d = void 0 === d ? 0 : d;
          e = void 0 === e ? "" : e;
          f = void 0 === f ? false : f;
          g = void 0 === g ? "" : g;
          if (this.i && this.G && (h(), !this.Pa())) return;
          (function() {
            if (k2.h && k2.h.audioTracks) {
              var l = Ig(k2.Rb(), a, b || "", false)[0];
              l && k2.Be(l);
            }
          })();
        };
        r.hg = function(a, b, c) {
          function d() {
            e.Tb = a;
            e.Hd = b || "";
            e.Fd = c || false;
            var f = Ig(e.i.textStreams, e.Tb, e.Hd, e.Fd)[0] || null;
            f && f != e.j.u && (ho(e.A.h, f, false), e.g.streaming.alwaysStreamText || e.Pf()) && (Qm(e.j, f), Xq(e), Fq(e));
          }
          var e = this;
          c = void 0 === c ? false : c;
          if (this.i && this.G && (d(), !this.Pa())) return;
          (function() {
            var f = Ig(e.vc(), a, b || "", c || false)[0];
            f && e.th(f);
          })();
        };
        r.yj = function(a, b, c) {
          function d() {
            for (var f = null, g = t(e.i.variants), h = g.next(); !h.done; h = g.next()) if (h = h.value, h.audio.label == a) {
              f = h;
              break;
            }
            null != f && (e.W = e.g.adaptationSetCriteriaFactory(), e.W.configure({ language: f.language, role: "", channelCount: 0, Sc: "", spatialAudio: false, videoLayout: "", fd: "", Kc: a, codecSwitchingStrategy: e.g.mediaSource.codecSwitchingStrategy, audioCodec: "" }), Op(e, b, c));
          }
          var e = this;
          b = void 0 === b ? true : b;
          c = void 0 === c ? 0 : c;
          if (this.i && this.G && (d(), !this.Pa())) return;
          (function() {
            if (e.h && e.h.audioTracks) {
              var f = Array.from(e.h.audioTracks), g = null;
              f = t(f);
              for (var h = f.next(); !h.done; h = f.next()) h = h.value, h.label == a && (g = h);
              g && Yq(e, g);
            }
          })();
        };
        r.Pf = function() {
          var a = this.oa;
          return this.B ? this.B.isTextVisible() : a;
        };
        r.Rg = function() {
          return this.h && this.h.currentSrc && this.h.textTracks ? ar(this).map(function(a) {
            return Dg(a);
          }) : [];
        };
        r.ji = function(a) {
          if (!this.h || !this.h.currentSrc || !this.h.textTracks) return [];
          var b = Of(a), c = ar(this).filter(function(h) {
            return Of(h.language) == b;
          });
          if (!c || !c.length) return [];
          a = [];
          var d = /* @__PURE__ */ new Set();
          c = t(c);
          for (var e = c.next(); !e.done; e = c.next()) if ((e = e.value) && e.cues) {
            e = t(e.cues);
            for (var f = e.next(); !f.done; f = e.next()) {
              var g = f.value;
              (f = g.id) && "" != f || (f = g.startTime + "-" + g.endTime + "-" + g.text);
              g = { id: f, title: g.text, startTime: g.startTime, endTime: g.endTime };
              d.has(f) || (a.push(g), d.add(f));
            }
          }
          return a;
        };
        function Kq(a) {
          return Array.from(a.h.textTracks).filter(function(b) {
            return "metadata" != b.kind && "chapters" != b.kind && "Shaka Player TextTrack" != b.label;
          });
        }
        function Pq(a) {
          return Array.from(a.h.textTracks).filter(function(b) {
            return "metadata" == b.kind;
          });
        }
        function ar(a) {
          return Array.from(a.h.textTracks).filter(function(b) {
            return "chapters" == b.kind;
          });
        }
        r.zh = function(a) {
          a = !!a;
          this.oa != a && (this.oa = a, this.m == tq ? (this.B.setTextVisibility(a), this.g.streaming.alwaysStreamText || (a ? this.j.u || (a = Ig(this.i.textStreams, this.Tb, this.Hd, this.Fd), 0 < a.length && (Qm(this.j, a[0]), Xq(this), Fq(this))) : Mm(this.j))) : this.h && this.h.src && this.h.textTracks && this.B.setTextVisibility(a), Eq(this));
        };
        r.yi = function() {
          if (this.G) var a = this.G.Od();
          else {
            if (null == this.Y) return /* @__PURE__ */ new Date();
            a = this.Y;
          }
          if (this.i && !this.Pa()) {
            var b = this.i.presentationTimeline;
            return new Date(1e3 * ((b.m || b.i) + a));
          }
          return this.h && this.h.getStartDate ? (b = this.h.getStartDate(), isNaN(b.getTime()) ? null : new Date(b.getTime() + 1e3 * a)) : null;
        };
        r.Wg = function() {
          if (this.i && !this.Pa()) {
            var a = this.i.presentationTimeline;
            return new Date(1e3 * (a.m || a.i));
          }
          return this.h && this.h.getStartDate ? (a = this.h.getStartDate(), isNaN(a.getTime()) ? null : a) : null;
        };
        r.ae = function() {
          return this.U() ? this.i ? this.i.presentationTimeline.ae() : null : null;
        };
        r.Fb = function() {
          if (this.m == tq) return this.I.Fb();
          var a = { total: [], audio: [], video: [], text: [] };
          this.m == Lq && (a.total = Vj(this.h.buffered));
          return a;
        };
        r.Zd = function() {
          if (!this.h || !this.h.currentTime) return null;
          var a = this.Wg().getTime() + 1e3 * this.h.currentTime;
          return Math.floor(Date.now() - a);
        };
        r.getStats = function() {
          if (this.m != tq && this.m != Lq) return {
            width: NaN,
            height: NaN,
            streamBandwidth: NaN,
            decodedFrames: NaN,
            droppedFrames: NaN,
            corruptedFrames: NaN,
            stallsDetected: NaN,
            gapsJumped: NaN,
            estimatedBandwidth: NaN,
            completionPercent: NaN,
            loadLatency: NaN,
            manifestTimeSeconds: NaN,
            drmTimeSeconds: NaN,
            playTime: NaN,
            pauseTime: NaN,
            bufferingTime: NaN,
            licenseTime: NaN,
            liveLatency: NaN,
            maxSegmentDuration: NaN,
            manifestSizeBytes: NaN,
            bytesDownloaded: NaN,
            nonFatalErrorCount: NaN,
            manifestPeriodCount: NaN,
            manifestGapCount: NaN,
            switchHistory: [],
            stateHistory: []
          };
          sq(this);
          var a = this.h, b = a.currentTime / a.duration;
          if (!isNaN(b) && !this.U()) {
            var c = this.A;
            b = Math.round(100 * b);
            c.i = isNaN(c.i) ? b : Math.max(c.i, b);
          }
          this.G && (this.A.P = this.G.zg(), this.A.T = this.G.Ag());
          if (a.getVideoPlaybackQuality) {
            c = a.getVideoPlaybackQuality();
            b = this.A;
            var d = Number(c.totalVideoFrames);
            b.O = Number(c.droppedVideoFrames);
            b.M = d;
            this.A.L = Number(c.corruptedVideoFrames);
          }
          this.C ? (c = this.C, c = c.H ? c.H : NaN) : c = NaN;
          this.A.o = c;
          if (this.m == tq) {
            c = this.j.l;
            b = this.j.u;
            if (c) {
              d = this.K ? this.K.i : 1;
              var e = d * c.bandwidth;
              b && b.bandwidth && (e += d * b.bandwidth);
              this.A.A = e;
            }
            c && c.video && (b = this.A, d = c.video.height || NaN, b.m = c.video.width || NaN, b.l = d);
            this.U() && (c = this.Zd() || 0, this.A.B = c / 1e3);
            this.i && (this.A.G = this.i.periodCount, this.A.F = this.i.gapCount, this.i.presentationTimeline && (this.A.I = this.i.presentationTimeline.h));
            c = this.o.getBandwidthEstimate();
            this.A.u = c;
          }
          this.m == Lq && (c = this.A, c.mc = isNaN(c.mc) ? NaN : c.mc + NaN, c = this.A, b = a.videoHeight || NaN, c.m = a.videoWidth || NaN, c.l = b);
          var f = this.A;
          a = f.m;
          c = f.l;
          b = f.A;
          d = f.M;
          e = f.O;
          var g = f.L, h = f.T, k2 = f.P, l = f.u, m = f.i, n = f.C, p = f.H, q = f.j, u = Qn(f.g, "playing"), w = Qn(f.g, "paused"), v = Qn(f.g, "buffering"), x = f.o, z = f.B, C = f.I, D = f.bh, G = f.mc, B = f.K, A = f.G, H = f.F, E = Rn(f.g), K = [];
          f = t(f.h.g);
          for (var M = f.next(); !M.done; M = f.next()) M = M.value, K.push({ timestamp: M.timestamp, id: M.id, type: M.type, fromAdaptation: M.fromAdaptation, bandwidth: M.bandwidth });
          return {
            width: a,
            height: c,
            streamBandwidth: b,
            decodedFrames: d,
            droppedFrames: e,
            corruptedFrames: g,
            stallsDetected: h,
            gapsJumped: k2,
            estimatedBandwidth: l,
            completionPercent: m,
            loadLatency: n,
            manifestTimeSeconds: p,
            drmTimeSeconds: q,
            playTime: u,
            pauseTime: w,
            bufferingTime: v,
            licenseTime: x,
            liveLatency: z,
            maxSegmentDuration: C,
            manifestSizeBytes: D,
            bytesDownloaded: G,
            nonFatalErrorCount: B,
            manifestPeriodCount: A,
            manifestGapCount: H,
            stateHistory: E,
            switchHistory: K
          };
        };
        r.Rh = function(a, b, c, d, e, f, g) {
          g = void 0 === g ? false : g;
          var h = this, k2, l, m, n, p, q, u, w, v, x, z, C, D;
          return Q(function(G) {
            switch (G.g) {
              case 1:
                if (h.m != tq && h.m != Lq) throw new U(1, 7, 7004);
                "subtitles" != c && "captions" != c && bb("Using a kind value different of `subtitles` or `captions` can cause unwanted issues.");
                if (d) {
                  G.s(2);
                  break;
                }
                return F(G, br(h, a), 3);
              case 3:
                d = G.h;
              case 2:
                k2 = [];
                h.u && (k2 = h.u.getCuePoints());
                if (h.m != Lq) {
                  G.s(4);
                  break;
                }
                g && (c = "forced");
                return F(G, cr(h, a, b, c, d, f || "", k2), 5);
              case 5:
                l = Of(b);
                m = h.vc();
                if (n = m.find(function(B) {
                  return Of(B.language) == l && B.label == (f || "") && B.kind == c;
                })) return nq(h), G.return(n);
                throw new U(1, 2, 2012);
              case 4:
                p = fd;
                q = h.Ra();
                u = q.end - q.start;
                h.i && (u = h.i.presentationTimeline.getDuration());
                if (Infinity == u) throw new U(1, 4, 4033);
                if (!k2.length) {
                  G.s(6);
                  break;
                }
                return F(G, dr(h, a, h.F, h.g.streaming.retryParameters), 7);
              case 7:
                w = G.h, v = er(h, w, d, k2), x = new Blob([v], { type: "text/vtt" }), a = Mk(x), d = "text/vtt";
              case 6:
                z = { id: h.We++, originalId: null, groupId: null, createSegmentIndex: function() {
                  return Promise.resolve();
                }, segmentIndex: Ul(0, u, [a]), mimeType: d || "", codecs: e || "", kind: c, encrypted: false, drmInfos: [], keyIds: /* @__PURE__ */ new Set(), language: b, originalLanguage: b, label: f || null, type: p.za, primary: false, trickModeVideo: null, dependencyStream: null, emsgSchemeIdUris: null, roles: [], forced: !!g, channelsCount: null, audioSamplingRate: null, spatialAudio: false, closedCaptions: null, accessibilityPurpose: null, external: true, fastSwitching: false, fullMimeTypes: /* @__PURE__ */ new Set([lf(d || "", e || "")]), isAudioMuxedInVideo: false, baseOriginalId: null };
                C = lf(z.mimeType, z.codecs);
                D = Cf(C);
                if (!D) throw new U(2, 2, 2014, d);
                h.i.textStreams.push(z);
                nq(h);
                return G.return(yg(z));
            }
          });
        };
        r.Sh = function(a, b) {
          var c = this, d, e, f, g, h, k2, l, m, n, p, q, u, w, v, x, z, C, D;
          return Q(function(G) {
            switch (G.g) {
              case 1:
                if (c.m != tq && c.m != Lq) throw new U(1, 7, 7004);
                if (b) {
                  G.s(2);
                  break;
                }
                return F(G, br(c, a), 3);
              case 3:
                b = G.h;
              case 2:
                if ("text/vtt" != b) throw new U(1, 2, 2017, a);
                d = fd;
                e = c.Ra();
                f = e.end - e.start;
                c.i && (f = c.i.presentationTimeline.getDuration());
                if (Infinity == f) throw new U(1, 4, 4045);
                return F(G, dr(c, a, c.F, c.g.streaming.retryParameters), 4);
              case 4:
                g = G.h;
                h = Bf(b);
                if (!h) throw new U(2, 2, 2014, b);
                k2 = h();
                l = {
                  periodStart: 0,
                  segmentStart: 0,
                  segmentEnd: f,
                  vttOffset: 0
                };
                m = Qb(g);
                n = k2.parseMedia(m, l, a, []);
                p = [];
                q = t(n);
                u = q.next();
                for (w = {}; !u.done; w = { Ne: void 0, Mc: void 0 }, u = q.next()) w.Mc = u.value, w.Ne = null, v = /* @__PURE__ */ function(B) {
                  return function() {
                    null == B.Ne && (B.Ne = Xc([a], [B.Mc.payload]));
                    return B.Ne || [];
                  };
                }(w), x = new Nj(w.Mc.startTime, w.Mc.endTime, v, 0, null, null, 0, 0, Infinity), w.Mc.payload.includes("#xywh") && (z = w.Mc.payload.split("#xywh=")[1].split(","), 4 === z.length && x.De({ height: parseInt(z[3], 10), positionX: parseInt(z[0], 10), positionY: parseInt(z[1], 10), width: parseInt(
                  z[2],
                  10
                ) })), p.push(x);
                C = b;
                if (!p.length) {
                  G.s(5);
                  break;
                }
                return F(G, Do(p[0].N()[0], c.F, c.g.manifest.retryParameters), 6);
              case 6:
                C = G.h;
              case 5:
                return D = {
                  id: c.We++,
                  originalId: null,
                  groupId: null,
                  createSegmentIndex: function() {
                    return Promise.resolve();
                  },
                  segmentIndex: new Sl(p),
                  mimeType: C || "",
                  codecs: "",
                  kind: "",
                  encrypted: false,
                  drmInfos: [],
                  keyIds: /* @__PURE__ */ new Set(),
                  language: "und",
                  originalLanguage: null,
                  label: null,
                  type: d.$e,
                  primary: false,
                  trickModeVideo: null,
                  dependencyStream: null,
                  emsgSchemeIdUris: null,
                  roles: [],
                  forced: false,
                  channelsCount: null,
                  audioSamplingRate: null,
                  spatialAudio: false,
                  closedCaptions: null,
                  tilesLayout: "1x1",
                  accessibilityPurpose: null,
                  external: true,
                  fastSwitching: false,
                  fullMimeTypes: /* @__PURE__ */ new Set([lf(C || "", "")]),
                  isAudioMuxedInVideo: false,
                  baseOriginalId: null
                }, c.m == Lq ? c.Oe.push(D) : c.i.imageStreams.push(D), nq(c), G.return(zg(D));
            }
          });
        };
        r.Qh = function(a, b, c) {
          var d = this, e, f, g, h;
          return Q(function(k2) {
            switch (k2.g) {
              case 1:
                if (d.m != tq && d.m != Lq) throw new U(1, 7, 7004);
                if (c) {
                  k2.s(2);
                  break;
                }
                return F(k2, br(d, a), 3);
              case 3:
                c = k2.h;
              case 2:
                return e = [], d.u && (e = d.u.getCuePoints()), F(k2, cr(d, a, b, "chapters", c, "", e), 4);
              case 4:
                f = k2.h;
                g = d.Rg();
                h = g.find(function(l) {
                  return l.language == b;
                });
                if (!h) {
                  k2.s(5);
                  break;
                }
                return F(k2, new Promise(function(l, m) {
                  d.l.ma(f, "load", l);
                  d.l.ma(f, "error", function() {
                    m(new U(1, 2, 2015));
                  });
                }), 6);
              case 6:
                return nq(d), k2.return(h);
              case 5:
                throw new U(
                  1,
                  2,
                  2012
                );
            }
          });
        };
        function br(a, b) {
          var c;
          return Q(function(d) {
            switch (d.g) {
              case 1:
                return xa(d, 2), F(d, Do(b, a.F, a.g.streaming.retryParameters), 4);
              case 4:
                c = d.h;
                Aa(d, 3);
                break;
              case 2:
                Ba(d);
              case 3:
                if (c) return d.return(c);
                throw new U(1, 2, 2011, b);
            }
          });
        }
        function cr(a, b, c, d, e, f, g) {
          var h, k2, l, m;
          return Q(function(n) {
            if (1 == n.g) return "text/vtt" != e || g.length ? F(n, dr(a, b, a.F, a.g.streaming.retryParameters), 3) : n.s(2);
            2 != n.g && (h = n.h, k2 = er(a, h, e, g), l = new Blob([k2], { type: "text/vtt" }), b = Mk(l), e = "text/vtt");
            m = document.createElement("track");
            var p = a.L, q = b;
            try {
              if (p.g.enabled) {
                var u = jp(p);
                u.ot = wp;
                u.su = true;
                var w = np(u);
                var v = op(q, w);
              } else v = q;
            } catch (x) {
              cb("CMCD_TEXT_TRACK_ERROR", "Could not generate text track CMCD data.", x), v = q;
            }
            m.src = v;
            m.label = f;
            m.kind = d;
            m.srclang = c;
            a.h.getAttribute("crossorigin") || a.h.setAttribute("crossorigin", "anonymous");
            a.h.appendChild(m);
            return n.return(m);
          });
        }
        function dr(a, b, c, d) {
          var e, f, g;
          return Q(function(h) {
            if (1 == h.g) {
              e = rh;
              f = lh([b], d);
              f.method = "GET";
              var k2 = a.L;
              try {
                k2.g.enabled && pp(k2, f, { ot: wp, su: true });
              } catch (l) {
                cb("CMCD_TEXT_ERROR", "Could not generate text CMCD data.", l);
              }
              return F(h, c.request(e, f).promise, 2);
            }
            g = h.h;
            return h.return(g.data);
          });
        }
        function er(a, b, c, d) {
          var e = Bf(c);
          if (e) return c = e(), a = { periodStart: 0, segmentStart: 0, segmentEnd: a.h.duration, vttOffset: 0 }, b = Qb(b), b = c.parseMedia(b, a, null, []), Yo(b, d);
          throw new U(2, 2, 2014, c);
        }
        r.Dj = function(a, b) {
          this.ka.width = a;
          this.ka.height = b;
        };
        r.eg = function(a) {
          if (this.m == tq) {
            var b = this.j;
            a = void 0 === a ? 0.1 : a;
            if (b.m.g) b = false;
            else if (b.B) b = false;
            else {
              for (var c = t(b.i.values()), d = c.next(); !d.done; d = c.next()) d = d.value, !d.sd || d.Da || d.kb || (d.sd = false, Lm(b, d, a));
              b = true;
            }
          } else b = false;
          return b;
        };
        r.Hf = function() {
          bb("Shaka Player's internal Manifest structure is NOT covered by semantic versioning compatibility guarantees.  It may change at any time!  Please consider filing a feature request for whatever you use getManifest() for.");
          return this.i;
        };
        r.ui = function() {
          return this.Qb;
        };
        r.ni = function() {
          var a = { video: null, audio: null, text: null };
          if (this.m != tq) return a;
          var b = this.j.l, c = this.h.currentTime;
          b = t([b.video, b.audio, this.j.u]);
          for (var d = b.next(); !d.done; d = b.next()) if ((d = d.value) && d.segmentIndex) {
            var e = d.segmentIndex.find(c);
            e = d.segmentIndex.get(e);
            e = { codecs: e.codecs || d.codecs, mimeType: e.mimeType || d.mimeType, bandwidth: e.bandwidth || d.bandwidth };
            "video" == d.type ? (e.width = d.width, e.height = d.height, a.video = e) : "audio" == d.type ? a.audio = e : d.type == dd && (a.text = e);
          }
          return a;
        };
        function Jp(a) {
          var b = Jn();
          b.streaming.failureCallback = function(c) {
            if (a.U()) {
              var d = null;
              1001 == c.code || 1002 == c.code ? (d = 1, a.g.streaming.lowLatencyMode && (d = 0.1)) : 1003 == c.code && (d = 0.1);
              null != d && (c.severity = 1, a.eg(d));
            }
          };
          b.textDisplayFactory = function() {
            return !a.ue || rc() && !document.fullscreenEnabled ? "addTextTrack" in a.h ? new Ko(a.h, "Shaka Player TextTrack") : new No() : new Oo(a.h, a.ue);
          };
          return b;
        }
        r.Ch = function(a) {
          this.ue = a;
        };
        function jq(a, b) {
          for (var c = /* @__PURE__ */ new Set(), d = t(b.textStreams), e = d.next(); !e.done; e = d.next()) e = e.value, "application/cea-608" != e.mimeType && "application/cea-708" != e.mimeType || c.add(e.originalId);
          d = t(b.variants);
          for (e = d.next(); !e.done; e = d.next()) if ((e = e.value.video) && e.closedCaptions) {
            for (var f = t(e.closedCaptions.keys()), g = f.next(); !g.done; g = f.next()) if (g = g.value, !c.has(g)) {
              var h = g.startsWith("CC") ? "application/cea-608" : "application/cea-708", k2 = new Vl(), l = e.closedCaptions.get(g);
              h = {
                id: a.We++,
                originalId: g,
                groupId: null,
                createSegmentIndex: function() {
                  return Promise.resolve();
                },
                segmentIndex: k2,
                mimeType: h,
                codecs: "",
                kind: "caption",
                encrypted: false,
                drmInfos: [],
                keyIds: /* @__PURE__ */ new Set(),
                language: l,
                originalLanguage: l,
                label: null,
                type: dd,
                primary: false,
                trickModeVideo: null,
                dependencyStream: null,
                emsgSchemeIdUris: null,
                roles: e.roles,
                forced: false,
                channelsCount: null,
                audioSamplingRate: null,
                spatialAudio: false,
                closedCaptions: null,
                accessibilityPurpose: null,
                external: false,
                fastSwitching: false,
                fullMimeTypes: /* @__PURE__ */ new Set([lf(h, "")]),
                isAudioMuxedInVideo: false,
                baseOriginalId: null
              };
              b.textStreams.push(h);
              c.add(g);
            }
          }
        }
        function Dq(a, b) {
          var c, d, e, f, g;
          return Q(function(h) {
            if (1 == h.g) return c = a.audio, d = a.video, e = function(k2, l) {
              var m, n, p;
              return Q(function(q) {
                if (1 == q.g) return k2 ? k2.segmentIndex ? q.s(2) : F(q, k2.createSegmentIndex(), 2) : q.return(null);
                n = (m = k2.segmentIndex.Gb(l)) ? m.next().value : null;
                if (!n) return q.return(null);
                p = n.startTime;
                return q.return(p);
              });
            }, F(h, e(c, b), 2);
            if (3 != h.g) return f = h.h, F(h, e(d, b), 3);
            g = h.h;
            return null != g && null != f ? h.return(Math.max(g, f)) : null != g ? h.return(g) : null != f ? h.return(f) : h.return(b);
          });
        }
        function $p(a) {
          var b = a.Of();
          if (a.A && a.M && a.G) {
            if (0 == a.g.streaming.rebufferingGoal) {
              var c = a.K;
              c.j = false;
              Xl(c);
            } else c = a.K, c.j = b, Xl(c);
            a.L && (c = a.L, b || c.u || (c.u = true), c.u && b && (c.B = true), c.F = b);
            sq(a);
            c = a.g.streaming.liveSync.dynamicTargetLatency.maxAttempts;
            if (a.g.streaming.liveSync.dynamicTargetLatency.enabled && b && a.Ue < c) {
              c = a.g.streaming.liveSync.dynamicTargetLatency.maxLatency;
              var d = a.g.streaming.liveSync.targetLatencyTolerance, e = a.g.streaming.liveSync.dynamicTargetLatency.rebufferIncrement;
              a.P && (a.P = Math.min(a.P + ++a.Ue * e, c - d));
            }
          }
          b = (/* @__PURE__ */ new Map()).set("buffering", b);
          a.dispatchEvent(Rp("buffering", b));
        }
        function uq(a, b) {
          a.Na.Qa();
          a.Na.D(a.h, "timeupdate", function() {
            var c = a.h.currentTime, d = a.Ra(), e = a.U() ? a.g.streaming.safeSeekOffset : 0;
            0 < b ? Math.floor(c) >= Math.floor(d.end) && a.gd() : Math.floor(c) <= Math.floor(d.start + e) && a.gd();
          });
        }
        function sq(a) {
          if (a.A && a.M) {
            var b = a.A.g, c = "playing";
            a.M.g == Ji ? c = "buffering" : a.Uc() ? c = "ended" : a.h.paused && (c = "paused");
            var d = c;
            if (null == b.g) b.g = { timestamp: Date.now() / 1e3, state: d, duration: 0 }, b = true;
            else {
              var e = Date.now() / 1e3;
              b.g.duration = e - b.g.timestamp;
              b.g.state == d ? b = false : (b.h.push(b.g), b.g = { timestamp: e, state: d, duration: 0 }, b = true);
            }
            b && (c = (/* @__PURE__ */ new Map()).set("newstate", c), a.dispatchEvent(Rp("statechanged", c)));
          }
        }
        function Hq(a) {
          var b = a.h.playbackRate, c = a.U();
          if (a.g.streaming.vodDynamicPlaybackRate && !c) {
            var d = a.g.streaming.vodDynamicPlaybackRateLowBufferRate, e = a.Qg();
            e <= a.g.streaming.vodDynamicPlaybackRateBufferRatio ? b != d && a.Md(d, false) : 1 == e && b !== a.K.sc() && a.gd();
          }
          if (c && (c = a.Ra(), Number.isFinite(c.end) && !(a.h.currentTime < c.start || a.h.paused))) {
            d = a.g.streaming.liveSync.targetLatencyTolerance;
            e = a.g.streaming.liveSync.dynamicTargetLatency.enabled;
            var f = a.g.streaming.liveSync.dynamicTargetLatency.stabilityThreshold;
            if (a.g.streaming.liveSync && a.g.streaming.liveSync.enabled) {
              var g = a.g.streaming.liveSync.targetLatency;
              var h = g + d;
              var k2 = Math.max(0, g - d);
              var l = a.g.streaming.liveSync.maxPlaybackRate;
              var m = a.g.streaming.liveSync.minPlaybackRate;
            } else a.i && a.i.serviceDescription && (g = a.i.serviceDescription.targetLatency, null != a.i.serviceDescription.targetLatency ? h = a.i.serviceDescription.targetLatency + d : null != a.i.serviceDescription.maxLatency && (h = a.i.serviceDescription.maxLatency), null != a.i.serviceDescription.targetLatency ? k2 = Math.max(0, a.i.serviceDescription.targetLatency - d) : null != a.i.serviceDescription.minLatency && (k2 = a.i.serviceDescription.minLatency), l = a.i.serviceDescription.maxPlaybackRate || a.g.streaming.liveSync.maxPlaybackRate, m = a.i.serviceDescription.minPlaybackRate || a.g.streaming.liveSync.minPlaybackRate);
            a.P || "number" !== typeof g || (a.P = g);
            var n = a.g.streaming.liveSync.dynamicTargetLatency.maxAttempts;
            e && a.Ma && null !== a.P && "number" === typeof g && a.Ue < n && Date.now() - a.Ma > 1e3 * f && (f = a.g.streaming.liveSync.dynamicTargetLatency.minLatency, a.P = Math.max(a.P - (g - f) / 2, f + d), a.Ma = Date.now());
            e && null !== a.P && (h = a.P + d, k2 = a.P - d);
            g = c.end - a.h.currentTime;
            d = 0;
            a.m == Lq && (e = a.h.buffered, 0 < e.length && (d = e.end(e.length - 1), d = Math.max(l, d - c.end)));
            c = a.g.streaming.liveSync.panicMode;
            e = 1e3 * a.g.streaming.liveSync.panicThreshold;
            f = Date.now() - a.M.h;
            c && !m && (m = a.g.streaming.liveSync.minPlaybackRate);
            c && m && f <= e ? b != m && a.Md(m, false) : void 0 != h && l && g - d > h ? (b != l && a.Md(l, false), a.Ma = null) : void 0 != k2 && m && g - d < k2 ? (b != m && a.Md(m, false), a.Ma = null) : b !== a.K.sc() && (a.gd(), a.Ma = Date.now());
          }
        }
        function Iq(a) {
          if (a.h) {
            var b = function(e, f) {
              var g = void 0 === g ? Number.EPSILON : g;
              if (e === f) g = true;
              else {
                var h = Math.abs(e - f);
                g = h <= g ? true : g !== Number.EPSILON ? Math.abs(h - g) <= Number.EPSILON : false;
              }
              return (g || f > e) && a.Ve < e ? (a.Ve = e, true) : false;
            }, c = a.Ra();
            c = c.end - c.start;
            c = 0 < c ? a.h.currentTime / c : 0;
            if (!isNaN(c)) {
              c *= 100;
              if (b(0, c)) var d = Rp("started");
              else b(25, c) ? d = Rp("firstquartile") : b(50, c) ? d = Rp("midpoint") : b(75, c) ? d = Rp("thirdquartile") : (b(100, c) && (d = Rp("complete")), a.g && Infinity != a.g.playRangeEnd && a.Uc() && a.h.pause());
              d && a.dispatchEvent(d);
            }
          }
        }
        function oq(a) {
          try {
            Pi(a.te, a.i);
          } catch (c) {
            return Yp(a, c), false;
          }
          var b = Hg(a.i.variants);
          b = a.W.create(b);
          a.o.setVariants(Array.from(b.values()));
          return true;
        }
        function Op(a, b, c, d, e) {
          b = void 0 === b ? true : b;
          c = void 0 === c ? 0 : c;
          d = void 0 === d ? false : d;
          e = void 0 === e ? true : e;
          var f;
          (f = oq(a) ? a.o.chooseVariant() : null) && yq(a, f, e, b, c, d);
        }
        function yq(a, b, c, d, e, f) {
          f = void 0 === f ? false : f;
          var g = a.j.l;
          if (b == g) d && Pm(a.j, b, d, e, true);
          else {
            var h = a.A.h;
            h.h != b && (h.h = b, h.g.push({ timestamp: Date.now() / 1e3, id: b.id, type: "variant", fromAdaptation: c, bandwidth: b.bandwidth }));
            Pm(a.j, b, d, e, f, c);
            d = null;
            g && (d = xg(g));
            g = xg(b);
            g.active = true;
            if (a.O && (e = a.O, b = b.video)) {
              b.dependencyStream && (b = b.dependencyStream);
              f = 0;
              h = -1;
              switch (b.mimeType) {
                case "video/webm":
                  f = 1;
                  break;
                case "video/mp4":
                  f = 2;
              }
              switch (a.Tg()) {
                case "DASH":
                  h = 1;
                  break;
                case "HLS":
                  h = 0;
              }
              e.g && (e.g.setLevelSwitching(
                b.id,
                true
              ), e.g.setContainerFormat(f), e.j || e.g.setStreamingFormat(h));
            }
            c ? (c = (/* @__PURE__ */ new Map()).set("oldTrack", d).set("newTrack", g), c = Rp("adaptation", c), fr(a, c)) : gr(a, d, g);
            hr(a, d, g);
          }
        }
        function Yq(a, b) {
          var c = Array.from(a.h.audioTracks).find(function(d) {
            return d.enabled;
          });
          b.enabled = true;
          c && (b.id !== c.id && (c.enabled = false), c = Fg(c), b = Fg(b), gr(a, c, b), hr(a, c, b));
        }
        function nq(a) {
          var b = Rp("trackschanged");
          fr(a, b);
          ir(a);
        }
        function gr(a, b, c) {
          b = (/* @__PURE__ */ new Map()).set("oldTrack", b).set("newTrack", c);
          b = Rp("variantchanged", b);
          fr(a, b);
        }
        function hr(a, b, c) {
          var d = false;
          b && b.audioId == c.audioId && b.audioGroupId == c.audioGroupId || (d = true);
          d && ir(a);
        }
        function ir(a) {
          var b = Rp("audiotrackschanged");
          fr(a, b);
        }
        function Xq(a) {
          var b = Rp("textchanged");
          fr(a, b);
        }
        function Eq(a) {
          var b = Rp("texttrackvisibility");
          fr(a, b);
        }
        function Gq(a) {
          a.g.abr.enabled || Np(a);
          var b = (/* @__PURE__ */ new Map()).set("newStatus", a.g.abr.enabled);
          fr(a, Rp("abrstatuschanged", b));
        }
        function Fq(a) {
          var b = a.vc().find(function(c) {
            return c.active;
          });
          b && a.B && a.B.setTextLanguage && a.B.setTextLanguage(b.language);
        }
        function Np(a, b) {
          b = void 0 === b ? true : b;
          if (a.m == tq) {
            a.xe.stop();
            for (var c = t(a.i.variants), d = c.next(); !d.done; d = c.next()) d.value.disabledUntilTime = 0;
            b && oq(a);
          }
        }
        r.disableStream = function(a, b) {
          if (!this.g.abr.enabled || this.m === Sp || !navigator.onLine || 0 == b || !this.i) return false;
          if (this.i.variants.some(function(h) {
            var k2 = h[a.type];
            return k2 && k2.id !== a.id && !h.disabledUntilTime ? "audio" == a.type ? a.language === k2.language : true : false;
          })) {
            for (var c = false, d = false, e = t(this.i.variants), f = e.next(); !f.done; f = e.next()) {
              f = f.value;
              var g = f[a.type];
              g && (g.id === a.id ? (f.disabledUntilTime = Date.now() / 1e3 + b, c = true) : g.trickModeVideo && g.trickModeVideo.id == a.id && (d = true));
            }
            if (!c && d) return false;
            this.xe.ua(1);
            b = this.Fb().video.reduce(function(h, k2) {
              return h + k2.end - k2.start;
            }, 0);
            Op(this, false, b, true, false);
            return true;
          }
          return false;
        };
        function Yp(a, b) {
          var c, d, e, f;
          return Q(function(g) {
            switch (g.g) {
              case 1:
                if (a.m == Sp) return g.return();
                1 === b.severity && a.A.K++;
                c = true;
                if (!(a.sa && a.i && a.j) || 3016 != b.code && 3014 != b.code && 3015 != b.code && 3018 != b.code) {
                  g.s(2);
                  break;
                }
                if (rc() && 3016 == b.code) return g.return();
                xa(g, 3);
                return F(g, Sm(a.j), 5);
              case 5:
                d = g.h;
                c = !d;
                d && (e = Rp("mediasourcerecovered"), a.dispatchEvent(e));
                Aa(g, 2);
                break;
              case 3:
                Ba(g), c = true;
              case 2:
                if (!c) return g.return();
                2 === b.severity && Np(a, false);
                f = Rp("error", (/* @__PURE__ */ new Map()).set("detail", b));
                a.dispatchEvent(f);
                f.defaultPrevented && (b.handled = true);
                I(g);
            }
          });
        }
        r.addFont = function(a, b) {
          var c, d, e, f, g;
          return Q(function(h) {
            if (1 == h.g) return "fonts" in document && "FontFace" in window2 ? F(h, document.fonts.ready, 3) : h.s(0);
            if (!("entries" in document.fonts)) return h.return();
            c = function(k2) {
              k2 = k2.entries();
              for (var l = [], m = k2.next(); false === m.done; ) l.push(m.value), m = k2.next();
              return l;
            };
            d = t(c(document.fonts));
            for (e = d.next(); !e.done; e = d.next()) if (f = e.value, f.family == a && "swap" == f.display) return h.return();
            g = new FontFace(a, "url(" + b + ")", { display: "swap" });
            document.fonts.add(g);
            I(h);
          });
        };
        function lq(a, b, c, d) {
          d = void 0 === d ? a : d;
          a = (/* @__PURE__ */ new Map()).set("detail", { schemeIdUri: c.schemeIdUri, value: c.value, startTime: c.startTime, endTime: c.endTime, id: c.id, timescale: c.timescale, eventElement: c.eventElement, eventNode: c.eventNode });
          d.dispatchEvent(Rp(b, a));
        }
        function mq(a, b, c, d) {
          d = void 0 === d ? false : d;
          b = (/* @__PURE__ */ new Map()).set("mediaQuality", { bandwidth: b.bandwidth, audioSamplingRate: b.audioSamplingRate, codecs: b.codecs, contentType: b.contentType, frameRate: b.frameRate, height: b.height, mimeType: b.mimeType, channelsCount: b.channelsCount, pixelAspectRatio: b.pixelAspectRatio, width: b.width, label: b.label, roles: b.roles, language: b.language }).set("position", c);
          a.dispatchEvent(Rp(d ? "audiotrackchanged" : "mediaqualitychanged", b));
        }
        function Xp(a, b) {
          b = void 0 === b ? true : b;
          if (!a.h.error) return b ? new U(2, 3, 3016) : null;
          var c = a.h.error.code;
          if (!b && 1 == c) return null;
          if (b = a.h.error.msExtendedCode) 0 > b && (b += Math.pow(2, 32)), b = b.toString(16);
          return new U(2, 3, 3016, c, b, a.h.error.message);
        }
        function xq(a, b, c) {
          0 < b && (a.U() || a.Bh(b));
          b = a.getDuration();
          c < b && (a.U() || a.bb(c));
        }
        function fr(a, b) {
          Q(function(c) {
            if (1 == c.g) return F(c, Promise.resolve(), 2);
            a.m != Sp && a.dispatchEvent(b);
            I(c);
          });
        }
        function $q(a) {
          var b = /* @__PURE__ */ new Set();
          a = t(a);
          for (var c = a.next(); !c.done; c = a.next()) c = c.value, c.language ? b.add(Of(c.language)) : b.add("und");
          return b;
        }
        function Zq(a) {
          var b = /* @__PURE__ */ new Map(), c = /* @__PURE__ */ new Map();
          a = t(a);
          for (var d = a.next(); !d.done; d = a.next()) {
            d = d.value;
            var e = "und", f = [];
            d.language && (e = Of(d.language));
            "variant" == d.type ? f = d.audioRoles : f = d.roles;
            f && f.length || (f = [""]);
            b.has(e) || b.set(e, /* @__PURE__ */ new Set());
            f = t(f);
            for (var g = f.next(); !g.done; g = f.next()) g = g.value, b.get(e).add(g), d.label && (c.has(e) || c.set(e, /* @__PURE__ */ new Map()), c.get(e).set(g, d.label));
          }
          var h = [];
          b.forEach(function(k2, l) {
            k2 = t(k2);
            for (var m = k2.next(); !m.done; m = k2.next()) {
              m = m.value;
              var n = null;
              c.has(l) && c.get(l).has(m) && (n = c.get(l).get(m));
              h.push({ language: l, role: m, label: n });
            }
          });
          return h;
        }
        r.Pa = function() {
          return this.h && this.h.remote ? "disconnected" != this.h.remote.state : false;
        };
        r.Uc = function() {
          return !this.h || this.h.ended ? true : this.sa && !this.U() && this.h.currentTime >= this.Ra().end;
        };
        T("shaka.Player", X);
        X.prototype.isEnded = X.prototype.Uc;
        X.prototype.isRemotePlayback = X.prototype.Pa;
        X.prototype.addFont = X.prototype.addFont;
        X.prototype.setVideoContainer = X.prototype.Ch;
        X.prototype.getFetchedPlaybackInfo = X.prototype.ni;
        X.prototype.getManifestParserFactory = X.prototype.ui;
        X.prototype.getManifest = X.prototype.Hf;
        X.prototype.retryStreaming = X.prototype.eg;
        X.prototype.setMaxHardwareResolution = X.prototype.Dj;
        X.prototype.addChaptersTrack = X.prototype.Qh;
        X.prototype.addThumbnailsTrack = X.prototype.Sh;
        X.prototype.addTextTrackAsync = X.prototype.Rh;
        X.prototype.getStats = X.prototype.getStats;
        X.prototype.getBufferedInfo = X.prototype.Fb;
        X.prototype.getSegmentAvailabilityDuration = X.prototype.ae;
        X.prototype.getPresentationStartTimeAsDate = X.prototype.Wg;
        X.prototype.getPlayheadTimeAsDate = X.prototype.yi;
        X.prototype.setTextTrackVisibility = X.prototype.zh;
        X.prototype.getChapters = X.prototype.ji;
        X.prototype.getChaptersTracks = X.prototype.Rg;
        X.prototype.isTextTrackVisible = X.prototype.Pf;
        X.prototype.selectVariantsByLabel = X.prototype.yj;
        X.prototype.selectTextLanguage = X.prototype.hg;
        X.prototype.selectAudioLanguage = X.prototype.sh;
        X.prototype.getTextLanguages = X.prototype.Ei;
        X.prototype.getAudioLanguages = X.prototype.gi;
        X.prototype.getTextLanguagesAndRoles = X.prototype.Fi;
        X.prototype.getAudioLanguagesAndRoles = X.prototype.hi;
        X.prototype.getAudioTracks = X.prototype.getAudioTracks;
        X.prototype.selectAudioTrack = X.prototype.xj;
        X.prototype.selectVariantTrack = X.prototype.Be;
        X.prototype.selectTextTrack = X.prototype.th;
        X.prototype.getThumbnails = X.prototype.Hi;
        X.prototype.getAllThumbnails = X.prototype.fi;
        X.prototype.getImageTracks = X.prototype.pi;
        X.prototype.getTextTracks = X.prototype.vc;
        X.prototype.getVariantTracks = X.prototype.Rb;
        X.prototype.cancelTrickPlay = X.prototype.gd;
        X.prototype.trickPlay = X.prototype.Md;
        X.prototype.getPlaybackRate = X.prototype.gb;
        X.prototype.isBuffering = X.prototype.Of;
        X.prototype.getKeyStatuses = X.prototype.Yd;
        X.prototype.getActiveSessionsMetadata = X.prototype.Gf;
        X.prototype.getExpiration = X.prototype.pd;
        X.prototype.drmInfo = X.prototype.drmInfo;
        X.prototype.keySystem = X.prototype.keySystem;
        X.prototype.isFullyLoaded = X.prototype.Ri;
        X.prototype.goToLive = X.prototype.Ni;
        X.prototype.seekRange = X.prototype.Ra;
        X.prototype.isAudioOnly = X.prototype.Qi;
        X.prototype.isInProgress = X.prototype.yc;
        X.prototype.isLive = X.prototype.U;
        X.prototype.getAdManager = X.prototype.Pg;
        X.prototype.getAssetUri = X.prototype.Qc;
        X.prototype.getNetworkingEngine = X.prototype.xb;
        X.prototype.getMediaElement = X.prototype.xi;
        X.prototype.getManifestType = X.prototype.Tg;
        X.prototype.getLoadMode = X.prototype.ti;
        X.prototype.resetConfiguration = X.prototype.sj;
        X.prototype.getBufferFullness = X.prototype.Qg;
        X.prototype.getNonDefaultConfiguration = X.prototype.Vg;
        X.prototype.getConfigurationForLowLatency = X.prototype.ki;
        X.prototype.getConfiguration = X.prototype.getConfiguration;
        X.prototype.configurationForLowLatency = X.prototype.ci;
        X.prototype.configure = X.prototype.configure;
        X.prototype.releaseAllMutexes = X.prototype.oj;
        X.prototype.destroyAllPreloads = X.prototype.pf;
        X.prototype.preload = X.prototype.preload;
        X.prototype.detachAndSavePreload = X.prototype.Lg;
        X.prototype.unloadAndSavePreload = X.prototype.Gj;
        X.prototype.load = X.prototype.load;
        X.prototype.updateStartTime = X.prototype.Kj;
        X.prototype.unload = X.prototype.kc;
        X.prototype.detach = X.prototype.detach;
        X.prototype.attachCanvas = X.prototype.Vh;
        X.prototype.attach = X.prototype.Lb;
        X.probeSupport = function(a) {
          a = void 0 === a ? true : a;
          var b, c, d, e, f, g;
          return Q(function(h) {
            switch (h.g) {
              case 1:
                b = {};
                if (!a) {
                  h.s(2);
                  break;
                }
                return F(h, Bi(), 3);
              case 3:
                b = h.h;
              case 2:
                return c = Ui(), d = Pk(), F(h, Ec(), 4);
              case 4:
                return e = h.h, f = { manifest: c, media: d, drm: b, hardwareResolution: e }, g = Up, g.forEach(function(k2, l) {
                  f[l] = k2();
                }), h.return(f);
            }
          });
        };
        X.isBrowserSupported = function() {
          window2.Promise || bb("A Promise implementation or polyfill is required");
          return window2.Promise && window2.Uint8Array && Array.prototype.forEach && !kc("Trident/") ? fc() ? true : gc("application/x-mpegurl") : false;
        };
        X.setAdManagerFactory = function(a) {
          Mp = a;
        };
        X.registerSupportPlugin = Tp;
        X.prototype.destroy = X.prototype.destroy;
        var Sp = 0, Ip = 1, tq = 2, Lq = 3;
        X.LoadMode = { DESTROYED: Sp, NOT_LOADED: Ip, MEDIA_SOURCE: tq, SRC_EQUALS: Lq };
        X.version = "v4.14.8";
        var jr = ["4", "14"];
        tb = new function(a) {
          this.g = a;
          this.i = vb;
          this.h = wb;
        }(new rb(Number(jr[0]), Number(jr[1])));
        var Up = /* @__PURE__ */ new Map(), Mp = null;
        function kr() {
          this.g = [];
          this.i = this.m = this.l = this.j = this.h = 0;
        }
        function lr(a) {
          return a.g.length ? a.g.reduce(function(b, c) {
            return b + c;
          }, 0) / a.g.length : 0;
        }
        function mr(a, b, c) {
          var d = this;
          this.g = a;
          this.h = b;
          this.j = c;
          this.i = false;
          this.l = this.h.getVolume();
          this.m = new lb();
          this.m.D(this.h, google.ima.AdEvent.Type.PAUSED, function() {
            d.i = true;
          });
          this.m.D(this.h, google.ima.AdEvent.Type.RESUMED, function() {
            d.i = false;
          });
        }
        r = mr.prototype;
        r.needsSkipUI = function() {
          return false;
        };
        r.isClientRendering = function() {
          return true;
        };
        r.hasCustomClick = function() {
          return true;
        };
        r.isUsingAnotherMediaElement = function() {
          return true;
        };
        r.getDuration = function() {
          return this.g.getDuration();
        };
        r.getMinSuggestedDuration = function() {
          return this.g.getMinSuggestedDuration();
        };
        r.getRemainingTime = function() {
          return this.h.getRemainingTime();
        };
        r.isPaused = function() {
          return this.i;
        };
        r.isSkippable = function() {
          return 0 <= this.g.getSkipTimeOffset();
        };
        r.getTimeUntilSkippable = function() {
          var a = this.g.getSkipTimeOffset();
          a = this.getRemainingTime() - a;
          return Math.max(a, 0);
        };
        r.canSkipNow = function() {
          return this.h.getAdSkippableState();
        };
        r.skip = function() {
          return this.h.skip();
        };
        r.pause = function() {
          return this.h.pause();
        };
        r.play = function() {
          return this.h.resume();
        };
        r.getVolume = function() {
          return this.h.getVolume();
        };
        r.setVolume = function(a) {
          this.j.volume = a;
          return this.h.setVolume(a);
        };
        r.isMuted = function() {
          return 0 == this.h.getVolume();
        };
        r.isLinear = function() {
          return this.g.isLinear();
        };
        r.resize = function(a, b) {
          var c = false, d = this.j;
          document.fullscreenEnabled ? c = !!document.fullscreenElement : d.webkitSupportsFullscreen && (c = d.webkitDisplayingFullscreen);
          this.h.resize(a, b, c ? google.ima.ViewMode.FULLSCREEN : google.ima.ViewMode.NORMAL);
        };
        r.setMuted = function(a) {
          (this.j.muted = a) ? (this.l = this.getVolume(), this.h.setVolume(0)) : this.h.setVolume(this.l);
        };
        r.getSequenceLength = function() {
          var a = this.g.getAdPodInfo();
          return null == a ? 1 : a.getTotalAds();
        };
        r.getPositionInSequence = function() {
          var a = this.g.getAdPodInfo();
          return null == a ? 1 : a.getAdPosition();
        };
        r.getTitle = function() {
          return this.g.getTitle();
        };
        r.getDescription = function() {
          return this.g.getDescription();
        };
        r.getVastMediaBitrate = function() {
          return this.g.getVastMediaBitrate();
        };
        r.getVastMediaHeight = function() {
          return this.g.getVastMediaHeight();
        };
        r.getVastMediaWidth = function() {
          return this.g.getVastMediaWidth();
        };
        r.getAdId = function() {
          return this.g.getAdId();
        };
        r.getCreativeAdId = function() {
          return this.g.getCreativeAdId();
        };
        r.getAdvertiserName = function() {
          return this.g.getAdvertiserName();
        };
        r.getMediaUrl = function() {
          return this.g.getMediaUrl();
        };
        r.getTimeOffset = function() {
          var a = this.g.getAdPodInfo();
          return null == a ? 0 : a.getTimeOffset();
        };
        r.getPodIndex = function() {
          var a = this.g.getAdPodInfo();
          return null == a ? 0 : a.getPodIndex();
        };
        r.release = function() {
          this.h = this.g = null;
        };
        T("shaka.ads.ClientSideAd", mr);
        mr.prototype.release = mr.prototype.release;
        mr.prototype.getPodIndex = mr.prototype.getPodIndex;
        mr.prototype.getTimeOffset = mr.prototype.getTimeOffset;
        mr.prototype.getMediaUrl = mr.prototype.getMediaUrl;
        mr.prototype.getAdvertiserName = mr.prototype.getAdvertiserName;
        mr.prototype.getCreativeAdId = mr.prototype.getCreativeAdId;
        mr.prototype.getAdId = mr.prototype.getAdId;
        mr.prototype.getVastMediaWidth = mr.prototype.getVastMediaWidth;
        mr.prototype.getVastMediaHeight = mr.prototype.getVastMediaHeight;
        mr.prototype.getVastMediaBitrate = mr.prototype.getVastMediaBitrate;
        mr.prototype.getDescription = mr.prototype.getDescription;
        mr.prototype.getTitle = mr.prototype.getTitle;
        mr.prototype.getPositionInSequence = mr.prototype.getPositionInSequence;
        mr.prototype.getSequenceLength = mr.prototype.getSequenceLength;
        mr.prototype.setMuted = mr.prototype.setMuted;
        mr.prototype.resize = mr.prototype.resize;
        mr.prototype.isLinear = mr.prototype.isLinear;
        mr.prototype.isMuted = mr.prototype.isMuted;
        mr.prototype.setVolume = mr.prototype.setVolume;
        mr.prototype.getVolume = mr.prototype.getVolume;
        mr.prototype.play = mr.prototype.play;
        mr.prototype.pause = mr.prototype.pause;
        mr.prototype.skip = mr.prototype.skip;
        mr.prototype.canSkipNow = mr.prototype.canSkipNow;
        mr.prototype.getTimeUntilSkippable = mr.prototype.getTimeUntilSkippable;
        mr.prototype.isSkippable = mr.prototype.isSkippable;
        mr.prototype.isPaused = mr.prototype.isPaused;
        mr.prototype.getRemainingTime = mr.prototype.getRemainingTime;
        mr.prototype.getMinSuggestedDuration = mr.prototype.getMinSuggestedDuration;
        mr.prototype.getDuration = mr.prototype.getDuration;
        mr.prototype.isUsingAnotherMediaElement = mr.prototype.isUsingAnotherMediaElement;
        mr.prototype.hasCustomClick = mr.prototype.hasCustomClick;
        mr.prototype.isClientRendering = mr.prototype.isClientRendering;
        mr.prototype.needsSkipUI = mr.prototype.needsSkipUI;
        function nr() {
        }
        function or(a, b) {
          var c = [];
          a = t(Yd(a, "Ad"));
          for (var d = a.next(); !d.done; d = a.next()) if (d = be(d.value, "InLine")) {
            if (d = be(d, "Creatives")) {
              d = t(Yd(d, "Creative"));
              for (var e = d.next(); !e.done; e = d.next()) {
                e = e.value;
                var f = be(e, "Linear");
                f && pr(c, b, f);
                if (e = be(e, "NonLinearAds")) {
                  e = Yd(e, "NonLinear");
                  e = t(e);
                  for (var g = e.next(); !g.done; g = e.next()) a: {
                    f = c;
                    var h = b, k2 = g.value, l = be(k2, "StaticResource");
                    if (l) g = l.attributes.creativeType;
                    else {
                      l = be(k2, "HTMLResource");
                      if (!l) break a;
                      g = "text/html";
                    }
                    if (l = $d(l)) {
                      "text/html" === g && (l = "data:text/html;charset=UTF-8," + encodeURIComponent(l));
                      var m = he(k2, "width", ne) || he(k2, "expandedWidth", ne), n = he(k2, "height", ne) || he(k2, "expandedHeight", ne);
                      if (m || n) {
                        var p = null;
                        (k2 = k2.attributes.minSuggestedDuration) && (p = Md(k2));
                        k2 = 0;
                        null != h && (k2 = h);
                        f.push({
                          id: null,
                          groupId: null,
                          startTime: k2,
                          endTime: null,
                          uri: l,
                          mimeType: g,
                          isSkippable: false,
                          skipOffset: null,
                          skipFor: null,
                          canJump: false,
                          resumeOffset: 0,
                          playoutLimit: p,
                          once: true,
                          pre: null == h,
                          post: Infinity == h,
                          timelineRange: false,
                          loop: false,
                          overlay: { viewport: { x: 0, y: 0 }, topLeft: { x: 0, y: 0 }, size: { x: m || 0, y: n || 0 } },
                          displayOnBackground: false,
                          currentVideo: null,
                          background: null
                        });
                      }
                    }
                  }
                }
              }
            }
          }
          return c;
        }
        function pr(a, b, c) {
          var d = 0;
          null != b && (d = b);
          var e = null;
          c.attributes.skipoffset && (e = Md(c.attributes.skipoffset), isNaN(e) && (e = null));
          if (c = be(c, "MediaFiles")) {
            var f = Yd(c, "MediaFile");
            c = f;
            f = f.filter(function(h) {
              return "streaming" == h.attributes.delivery;
            });
            f.length && (c = f);
            c = c.sort(function(h, k2) {
              return (parseInt(k2.attributes.height, 10) || 0) - (parseInt(h.attributes.height, 10) || 0);
            });
            c = t(c);
            for (f = c.next(); !f.done; f = c.next()) if (f = f.value, !f.attributes.apiFramework) {
              var g = $d(f);
              if (g) {
                a.push({
                  id: null,
                  groupId: null,
                  startTime: d,
                  endTime: null,
                  uri: g,
                  mimeType: f.attributes.type || null,
                  isSkippable: null != e,
                  skipOffset: e,
                  skipFor: null,
                  canJump: false,
                  resumeOffset: 0,
                  playoutLimit: null,
                  once: true,
                  pre: null == b,
                  post: Infinity == b,
                  timelineRange: false,
                  loop: false,
                  overlay: null,
                  displayOnBackground: false,
                  currentVideo: null,
                  background: null
                });
                break;
              }
            }
          }
        }
        T("shaka.ads.Utils", nr);
        nr.ADS_LOADED = "ads-loaded";
        nr.AD_STARTED = "ad-started";
        nr.AD_FIRST_QUARTILE = "ad-first-quartile";
        nr.AD_MIDPOINT = "ad-midpoint";
        nr.AD_THIRD_QUARTILE = "ad-third-quartile";
        nr.AD_COMPLETE = "ad-complete";
        nr.AD_STOPPED = "ad-stopped";
        nr.AD_SKIPPED = "ad-skipped";
        nr.AD_VOLUME_CHANGED = "ad-volume-changed";
        nr.AD_MUTED = "ad-muted";
        nr.AD_PAUSED = "ad-paused";
        nr.AD_RESUMED = "ad-resumed";
        nr.AD_SKIP_STATE_CHANGED = "ad-skip-state-changed";
        nr.CUEPOINTS_CHANGED = "ad-cue-points-changed";
        nr.IMA_AD_MANAGER_LOADED = "ima-ad-manager-loaded";
        nr.IMA_STREAM_MANAGER_LOADED = "ima-stream-manager-loaded";
        nr.AD_CLICKED = "ad-clicked";
        nr.AD_PROGRESS = "ad-progress";
        nr.AD_BUFFERING = "ad-buffering";
        nr.AD_IMPRESSION = "ad-impression";
        nr.AD_DURATION_CHANGED = "ad-duration-changed";
        nr.AD_CLOSED = "ad-closed";
        nr.AD_LOADED = "ad-loaded";
        nr.ALL_ADS_COMPLETED = "all-ads-completed";
        nr.AD_LINEAR_CHANGED = "ad-linear-changed";
        nr.AD_METADATA = "ad-metadata";
        nr.AD_RECOVERABLE_ERROR = "ad-recoverable-error";
        nr.AD_ERROR = "ad-error";
        nr.AD_BREAK_READY = "ad-break-ready";
        nr.AD_INTERACTION = "ad-interaction";
        nr.AD_CONTENT_PAUSE_REQUESTED = "ad-content-pause-requested";
        nr.AD_CONTENT_RESUME_REQUESTED = "ad-content-resume-requested";
        nr.AD_CONTENT_ATTACH_REQUESTED = "ad-content-attach-requested";
        function qr(a, b, c, d, e) {
          var f = this;
          this.u = a;
          this.i = b;
          this.F = false;
          this.A = this.o = null;
          this.G = NaN;
          this.l = e;
          this.j = null;
          this.h = new lb();
          google.ima.settings.setLocale(c);
          google.ima.settings.setDisableCustomPlaybackForIOS10Plus(true);
          this.C = new google.ima.AdDisplayContainer(this.u, this.i);
          this.C.initialize();
          this.m = new google.ima.AdsLoader(this.C);
          this.m.getSettings().setPlayerType("shaka-player");
          this.m.getSettings().setPlayerVersion("v4.14.8");
          this.g = null;
          this.B = d || new google.ima.AdsRenderingSettings();
          this.h.D(
            this.m,
            google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,
            function(g) {
              rr(f, g);
            }
          );
          this.h.D(this.m, google.ima.AdErrorEvent.Type.AD_ERROR, function(g) {
            sr(f, g);
          });
          this.h.D(this.i, "ended", function() {
            f.m.contentComplete();
          });
          this.h.ma(this.i, "play", function() {
            f.F = true;
          });
        }
        qr.prototype.configure = function(a) {
          this.o = a;
        };
        qr.prototype.stop = function() {
          this.g && this.g.stop();
          this.u && Zj(this.u);
        };
        qr.prototype.release = function() {
          this.stop();
          this.A && this.A.disconnect();
          this.h && this.h.release();
          this.g && this.g.destroy();
          this.m.destroy();
          this.C.destroy();
        };
        function sr(a, b) {
          b.getError();
          b = (/* @__PURE__ */ new Map()).set("originalEvent", b);
          a.l(new V("ad-error", b));
          tr(a, null);
          a.l(new V("ad-cue-points-changed", (/* @__PURE__ */ new Map()).set("cuepoints", [])));
        }
        function rr(a, b) {
          a.l(new V("ads-loaded", (/* @__PURE__ */ new Map()).set("loadTime", Date.now() / 1e3 - a.G)));
          if (a.o.customPlayheadTracker) {
            var c = { currentTime: a.i.currentTime };
            a.g = b.getAdsManager(c, a.B);
            a.i.muted ? a.g.setVolume(0) : a.g.setVolume(a.i.volume);
            a.h.D(a.i, "timeupdate", function() {
              a.i.duration && (c.currentTime = a.i.currentTime);
            });
            a.h.D(a.i, "volumechange", function() {
              a.j && (a.j.setVolume(a.i.volume), a.i.muted && a.j.setMuted(true));
            });
          } else a.g = b.getAdsManager(a.i, a.B);
          a.l(new V("ima-ad-manager-loaded", (/* @__PURE__ */ new Map()).set(
            "imaAdManager",
            a.g
          )));
          var d = a.g.getCuePoints();
          if (d.length) {
            b = [];
            d = t(d);
            for (var e = d.next(); !e.done; e = d.next()) b.push({ start: e.value, end: null });
            a.l(new V("ad-cue-points-changed", (/* @__PURE__ */ new Map()).set("cuepoints", b)));
          }
          ur(a);
          try {
            a.g.init(a.i.offsetWidth, a.i.offsetHeight, vr(a) ? google.ima.ViewMode.FULLSCREEN : google.ima.ViewMode.NORMAL), a.h.D(a.i, "loadeddata", function() {
              a.g.resize(a.i.offsetWidth, a.i.offsetHeight, vr(a) ? google.ima.ViewMode.FULLSCREEN : google.ima.ViewMode.NORMAL);
            }), "ResizeObserver" in window2 ? (a.A = new ResizeObserver(function() {
              a.g.resize(
                a.i.offsetWidth,
                a.i.offsetHeight,
                vr(a) ? google.ima.ViewMode.FULLSCREEN : google.ima.ViewMode.NORMAL
              );
            }), a.A.observe(a.i)) : a.h.D(document, "fullscreenchange", function() {
              a.g.resize(a.i.offsetWidth, a.i.offsetHeight, vr(a) ? google.ima.ViewMode.FULLSCREEN : google.ima.ViewMode.NORMAL);
            }), a.F || a.o.skipPlayDetection ? a.g.start() : a.h.ma(a.i, "play", function() {
              a.F = true;
              a.g.start();
            });
          } catch (f) {
            tr(a, null);
          }
        }
        function vr(a) {
          if (document.fullscreenEnabled) return !!document.fullscreenElement;
          a = a.i;
          return a.webkitSupportsFullscreen ? a.webkitDisplayingFullscreen : false;
        }
        function ur(a) {
          function b(c, d) {
            c = (/* @__PURE__ */ new Map()).set("originalEvent", c);
            a.l(new V(d, c));
          }
          a.h.D(a.g, google.ima.AdErrorEvent.Type.AD_ERROR, function(c) {
            sr(a, c);
          });
          a.h.D(a.g, google.ima.AdEvent.Type.CONTENT_PAUSE_REQUESTED, function(c) {
            wr(a, c);
          });
          a.h.D(a.g, google.ima.AdEvent.Type.STARTED, function(c) {
            wr(a, c);
          });
          a.h.D(a.g, google.ima.AdEvent.Type.FIRST_QUARTILE, function(c) {
            b(c, "ad-first-quartile");
          });
          a.h.D(a.g, google.ima.AdEvent.Type.MIDPOINT, function(c) {
            b(c, "ad-midpoint");
          });
          a.h.D(
            a.g,
            google.ima.AdEvent.Type.THIRD_QUARTILE,
            function(c) {
              b(c, "ad-third-quartile");
            }
          );
          a.h.D(a.g, google.ima.AdEvent.Type.COMPLETE, function(c) {
            b(c, "ad-complete");
          });
          a.h.D(a.g, google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED, function(c) {
            tr(a, c);
          });
          a.h.D(a.g, google.ima.AdEvent.Type.ALL_ADS_COMPLETED, function(c) {
            tr(a, c);
          });
          a.h.D(a.g, google.ima.AdEvent.Type.SKIPPED, function(c) {
            b(c, "ad-skipped");
          });
          a.h.D(a.g, google.ima.AdEvent.Type.VOLUME_CHANGED, function(c) {
            b(c, "ad-volume-changed");
          });
          a.h.D(a.g, google.ima.AdEvent.Type.VOLUME_MUTED, function(c) {
            b(c, "ad-muted");
          });
          a.h.D(a.g, google.ima.AdEvent.Type.PAUSED, function(c) {
            a.j && (a.j.i = true, b(c, "ad-paused"));
          });
          a.h.D(a.g, google.ima.AdEvent.Type.RESUMED, function(c) {
            a.j && (a.j.i = false, b(c, "ad-resumed"));
          });
          a.h.D(a.g, google.ima.AdEvent.Type.SKIPPABLE_STATE_CHANGED, function(c) {
            a.j && b(c, "ad-skip-state-changed");
          });
          a.h.D(a.g, google.ima.AdEvent.Type.CLICK, function(c) {
            b(c, "ad-clicked");
          });
          a.h.D(a.g, google.ima.AdEvent.Type.AD_PROGRESS, function(c) {
            b(c, "ad-progress");
          });
          a.h.D(a.g, google.ima.AdEvent.Type.AD_BUFFERING, function(c) {
            b(c, "ad-buffering");
          });
          a.h.D(a.g, google.ima.AdEvent.Type.IMPRESSION, function(c) {
            b(c, "ad-impression");
          });
          a.h.D(a.g, google.ima.AdEvent.Type.DURATION_CHANGE, function(c) {
            b(c, "ad-duration-changed");
          });
          a.h.D(a.g, google.ima.AdEvent.Type.USER_CLOSE, function(c) {
            b(c, "ad-closed");
          });
          a.h.D(a.g, google.ima.AdEvent.Type.LOADED, function(c) {
            b(c, "ad-loaded");
          });
          a.h.D(a.g, google.ima.AdEvent.Type.ALL_ADS_COMPLETED, function(c) {
            b(c, "all-ads-completed");
          });
          a.h.D(a.g, google.ima.AdEvent.Type.LINEAR_CHANGED, function(c) {
            b(c, "ad-linear-changed");
          });
          a.h.D(
            a.g,
            google.ima.AdEvent.Type.AD_METADATA,
            function(c) {
              b(c, "ad-metadata");
            }
          );
          a.h.D(a.g, google.ima.AdEvent.Type.LOG, function(c) {
            b(c, "ad-recoverable-error");
          });
          a.h.D(a.g, google.ima.AdEvent.Type.AD_BREAK_READY, function(c) {
            b(c, "ad-break-ready");
          });
          a.h.D(a.g, google.ima.AdEvent.Type.INTERACTION, function(c) {
            b(c, "ad-interaction");
          });
        }
        function wr(a, b) {
          var c = b.getAd();
          c ? (a.j = new mr(c, a.g, a.i), b.type != google.ima.AdEvent.Type.CONTENT_PAUSE_REQUESTED || a.o.supportsMultipleMediaElements || a.l(new V("ad-content-pause-requested")), b = (/* @__PURE__ */ new Map()).set("ad", a.j).set("sdkAdObject", c).set("originalEvent", b), a.l(new V("ad-started", b)), a.j.isLinear() && (a.u.setAttribute("ad-active", "true"), a.o.customPlayheadTracker || a.i.pause(), a.i.muted ? (b = a.j, b.l = a.i.volume, b.h.setVolume(0)) : a.j.setVolume(a.i.volume))) : bb("The IMA SDK fired a " + b.type + " event with no associated ad. Unable to play ad!");
        }
        function tr(a, b) {
          b && b.type == google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED && !a.o.supportsMultipleMediaElements && a.l(new V("ad-content-resume-requested"));
          a.l(new V("ad-stopped", (/* @__PURE__ */ new Map()).set("originalEvent", b)));
          a.j && a.j.isLinear() && (a.u.removeAttribute("ad-active"), a.o.customPlayheadTracker || a.i.ended || a.i.play());
        }
        function xr(a, b, c, d, e, f) {
          this.g = a;
          this.i = b;
          this.j = (this.h = b.isSkippable) ? b.skipOffset || 0 : b.skipOffset;
          this.l = b.skipFor;
          this.A = c;
          this.o = d;
          this.m = e;
          this.u = f;
          this.B = b.overlay;
        }
        r = xr.prototype;
        r.needsSkipUI = function() {
          return true;
        };
        r.isClientRendering = function() {
          return true;
        };
        r.hasCustomClick = function() {
          return false;
        };
        r.isUsingAnotherMediaElement = function() {
          return this.u;
        };
        r.getDuration = function() {
          var a = this.g.duration;
          return isNaN(a) ? -1 : a;
        };
        r.getMinSuggestedDuration = function() {
          return this.getDuration();
        };
        r.getRemainingTime = function() {
          var a = this.g.duration;
          return isNaN(a) ? -1 : a - this.g.currentTime;
        };
        r.isPaused = function() {
          return this.g.paused;
        };
        r.isSkippable = function() {
          return this.h && null != this.l ? this.getDuration() - this.getRemainingTime() < this.j + this.l : this.h;
        };
        r.getTimeUntilSkippable = function() {
          if (this.isSkippable()) {
            var a = this.getRemainingTime() + this.j - this.getDuration();
            return Math.max(a, 0);
          }
          return Math.max(this.getRemainingTime(), 0);
        };
        r.canSkipNow = function() {
          return this.h && 0 == this.getTimeUntilSkippable();
        };
        r.skip = function() {
          this.canSkipNow() && this.A();
        };
        r.pause = function() {
          return this.g.pause();
        };
        r.play = function() {
          return this.g.play();
        };
        r.getVolume = function() {
          return this.g.volume;
        };
        r.setVolume = function(a) {
          this.g.volume = a;
        };
        r.isMuted = function() {
          return this.g.muted;
        };
        r.isLinear = function() {
          return null == this.B;
        };
        r.resize = function() {
        };
        r.setMuted = function(a) {
          this.g.muted = a;
        };
        r.getSequenceLength = function() {
          return this.o;
        };
        r.getPositionInSequence = function() {
          return this.m;
        };
        r.getTitle = function() {
          return "";
        };
        r.getDescription = function() {
          return "";
        };
        r.getVastMediaBitrate = function() {
          return 0;
        };
        r.getVastMediaHeight = function() {
          return 0;
        };
        r.getVastMediaWidth = function() {
          return 0;
        };
        r.getAdId = function() {
          return this.i.id || "";
        };
        r.getCreativeAdId = function() {
          return "";
        };
        r.getAdvertiserName = function() {
          return "";
        };
        r.getMediaUrl = function() {
          return this.i.uri;
        };
        r.getTimeOffset = function() {
          return 0;
        };
        r.getPodIndex = function() {
          return 0;
        };
        r.release = function() {
          this.g = null;
        };
        T("shaka.ads.InterstitialAd", xr);
        xr.prototype.release = xr.prototype.release;
        xr.prototype.getPodIndex = xr.prototype.getPodIndex;
        xr.prototype.getTimeOffset = xr.prototype.getTimeOffset;
        xr.prototype.getMediaUrl = xr.prototype.getMediaUrl;
        xr.prototype.getAdvertiserName = xr.prototype.getAdvertiserName;
        xr.prototype.getCreativeAdId = xr.prototype.getCreativeAdId;
        xr.prototype.getAdId = xr.prototype.getAdId;
        xr.prototype.getVastMediaWidth = xr.prototype.getVastMediaWidth;
        xr.prototype.getVastMediaHeight = xr.prototype.getVastMediaHeight;
        xr.prototype.getVastMediaBitrate = xr.prototype.getVastMediaBitrate;
        xr.prototype.getDescription = xr.prototype.getDescription;
        xr.prototype.getTitle = xr.prototype.getTitle;
        xr.prototype.getPositionInSequence = xr.prototype.getPositionInSequence;
        xr.prototype.getSequenceLength = xr.prototype.getSequenceLength;
        xr.prototype.setMuted = xr.prototype.setMuted;
        xr.prototype.resize = xr.prototype.resize;
        xr.prototype.isLinear = xr.prototype.isLinear;
        xr.prototype.isMuted = xr.prototype.isMuted;
        xr.prototype.setVolume = xr.prototype.setVolume;
        xr.prototype.getVolume = xr.prototype.getVolume;
        xr.prototype.play = xr.prototype.play;
        xr.prototype.pause = xr.prototype.pause;
        xr.prototype.skip = xr.prototype.skip;
        xr.prototype.canSkipNow = xr.prototype.canSkipNow;
        xr.prototype.getTimeUntilSkippable = xr.prototype.getTimeUntilSkippable;
        xr.prototype.isSkippable = xr.prototype.isSkippable;
        xr.prototype.isPaused = xr.prototype.isPaused;
        xr.prototype.getRemainingTime = xr.prototype.getRemainingTime;
        xr.prototype.getMinSuggestedDuration = xr.prototype.getMinSuggestedDuration;
        xr.prototype.getDuration = xr.prototype.getDuration;
        xr.prototype.isUsingAnotherMediaElement = xr.prototype.isUsingAnotherMediaElement;
        xr.prototype.hasCustomClick = xr.prototype.hasCustomClick;
        xr.prototype.isClientRendering = xr.prototype.isClientRendering;
        xr.prototype.needsSkipUI = xr.prototype.needsSkipUI;
        function yr(a, b, c) {
          this.g = a;
          this.j = b;
          this.h = c;
          this.i = null == a.overlay;
        }
        r = yr.prototype;
        r.needsSkipUI = function() {
          return true;
        };
        r.isClientRendering = function() {
          return true;
        };
        r.hasCustomClick = function() {
          return false;
        };
        r.isUsingAnotherMediaElement = function() {
          return false;
        };
        r.getDuration = function() {
          return -1;
        };
        r.getMinSuggestedDuration = function() {
          return this.getDuration();
        };
        r.getRemainingTime = function() {
          return -1;
        };
        r.isPaused = function() {
          return false;
        };
        r.isSkippable = function() {
          return false;
        };
        r.getTimeUntilSkippable = function() {
          return 0;
        };
        r.canSkipNow = function() {
          return false;
        };
        r.skip = function() {
        };
        r.pause = function() {
        };
        r.play = function() {
        };
        r.getVolume = function() {
          return 1;
        };
        r.setVolume = function() {
        };
        r.isMuted = function() {
          return false;
        };
        r.isLinear = function() {
          return this.i;
        };
        r.resize = function() {
        };
        r.setMuted = function() {
        };
        r.getSequenceLength = function() {
          return this.j;
        };
        r.getPositionInSequence = function() {
          return this.h;
        };
        r.getTitle = function() {
          return "";
        };
        r.getDescription = function() {
          return "";
        };
        r.getVastMediaBitrate = function() {
          return 0;
        };
        r.getVastMediaHeight = function() {
          return 0;
        };
        r.getVastMediaWidth = function() {
          return 0;
        };
        r.getAdId = function() {
          return this.g.id || "";
        };
        r.getCreativeAdId = function() {
          return "";
        };
        r.getAdvertiserName = function() {
          return "";
        };
        r.getMediaUrl = function() {
          return this.g.uri;
        };
        r.getTimeOffset = function() {
          return 0;
        };
        r.getPodIndex = function() {
          return 0;
        };
        r.release = function() {
        };
        T("shaka.ads.InterstitialStaticAd", yr);
        yr.prototype.release = yr.prototype.release;
        yr.prototype.getPodIndex = yr.prototype.getPodIndex;
        yr.prototype.getTimeOffset = yr.prototype.getTimeOffset;
        yr.prototype.getMediaUrl = yr.prototype.getMediaUrl;
        yr.prototype.getAdvertiserName = yr.prototype.getAdvertiserName;
        yr.prototype.getCreativeAdId = yr.prototype.getCreativeAdId;
        yr.prototype.getAdId = yr.prototype.getAdId;
        yr.prototype.getVastMediaWidth = yr.prototype.getVastMediaWidth;
        yr.prototype.getVastMediaHeight = yr.prototype.getVastMediaHeight;
        yr.prototype.getVastMediaBitrate = yr.prototype.getVastMediaBitrate;
        yr.prototype.getDescription = yr.prototype.getDescription;
        yr.prototype.getTitle = yr.prototype.getTitle;
        yr.prototype.getPositionInSequence = yr.prototype.getPositionInSequence;
        yr.prototype.getSequenceLength = yr.prototype.getSequenceLength;
        yr.prototype.setMuted = yr.prototype.setMuted;
        yr.prototype.resize = yr.prototype.resize;
        yr.prototype.isLinear = yr.prototype.isLinear;
        yr.prototype.isMuted = yr.prototype.isMuted;
        yr.prototype.setVolume = yr.prototype.setVolume;
        yr.prototype.getVolume = yr.prototype.getVolume;
        yr.prototype.play = yr.prototype.play;
        yr.prototype.pause = yr.prototype.pause;
        yr.prototype.skip = yr.prototype.skip;
        yr.prototype.canSkipNow = yr.prototype.canSkipNow;
        yr.prototype.getTimeUntilSkippable = yr.prototype.getTimeUntilSkippable;
        yr.prototype.isSkippable = yr.prototype.isSkippable;
        yr.prototype.isPaused = yr.prototype.isPaused;
        yr.prototype.getRemainingTime = yr.prototype.getRemainingTime;
        yr.prototype.getMinSuggestedDuration = yr.prototype.getMinSuggestedDuration;
        yr.prototype.getDuration = yr.prototype.getDuration;
        yr.prototype.isUsingAnotherMediaElement = yr.prototype.isUsingAnotherMediaElement;
        yr.prototype.hasCustomClick = yr.prototype.hasCustomClick;
        yr.prototype.isClientRendering = yr.prototype.isClientRendering;
        yr.prototype.needsSkipUI = yr.prototype.needsSkipUI;
        function zr(a, b, c, d) {
          var e = this;
          this.T = null;
          this.A = a;
          this.H = b;
          this.g = c;
          this.F = null;
          this.B = true;
          this.h = this.g;
          this.i = d;
          this.W = /* @__PURE__ */ new Set();
          this.G = /* @__PURE__ */ new Set();
          this.C = /* @__PURE__ */ new Map();
          this.L = /* @__PURE__ */ new Map();
          this.j = new X();
          Ar(this);
          this.I = new lb();
          this.l = new lb();
          this.K = false;
          this.ea = this.m = this.u = this.o = null;
          this.fa = false;
          this.O = -1;
          this.Z = function() {
            if (!e.K && e.o && !e.H.Pa()) {
              e.o = e.g.currentTime;
              e.u && !e.u.pre && !e.u.post && e.o < e.u.startTime && (e.u = null);
              var f = Br(e);
              f && Cr(e, f, 1, 1, Date.now());
            }
          };
          this.Y = function() {
            if (!(e.K || e.o || e.H.Pa())) {
              e.o = e.g.currentTime;
              var f = Br(e, true);
              f && Cr(e, f, 1, 1, Date.now());
            }
          };
          this.P = new ec(this.Z);
          this.M = new ec(function() {
            var f, g, h, k2, l, m, n, p, q, u, w;
            return Q(function(v) {
              switch (v.g) {
                case 1:
                  if (!e.G.size || null == e.o) {
                    v.s(0);
                    break;
                  }
                  f = e.H.m;
                  if (f == Sp || f == Ip) return v.return();
                  g = false;
                  h = Array.from(e.G);
                  k2 = e.H.Ra();
                  l = t(h);
                  m = l.next();
                case 3:
                  if (m.done) {
                    v.s(5);
                    break;
                  }
                  n = m.value;
                  if (n == e.u) {
                    v.s(4);
                    break;
                  }
                  p = n.endTime || n.startTime;
                  if (!(1 <= k2.start - p)) {
                    q = n.startTime - e.o;
                    0 < q && 10 >= q && (!e.C.has(n) && Dr(n) && e.C.set(n, e.j.preload(n.uri, null, n.mimeType || void 0)), Er(e, n));
                    v.s(4);
                    break;
                  }
                  if (!e.C.has(n)) {
                    v.s(7);
                    break;
                  }
                  return F(v, e.C.get(n), 8);
                case 8:
                  (u = v.h) && u.destroy(), e.C.delete(n);
                case 7:
                  Fr(e, n), w = JSON.stringify(n), e.W.has(w) && e.W.delete(w), e.G.delete(n), Gr(e), n.overlay || (g = true);
                case 4:
                  m = l.next();
                  v.s(3);
                  break;
                case 5:
                  g && Hr(e), I(v);
              }
            });
          });
        }
        r = zr.prototype;
        r.configure = function(a) {
          this.T = a;
          Ir(this);
        };
        function Jr(a) {
          if (!a.fa && a.G.size) {
            a.I.D(a.g, "playing", a.Y);
            a.I.D(a.g, "timeupdate", a.Y);
            a.I.D(a.g, "ended", a.Z);
            if ("requestVideoFrameCallback" in a.g && !Ac()) {
              var b = a.g, c = function() {
                -1 != a.O && (a.Z(), -1 != a.O && (a.O = b.requestVideoFrameCallback(c)));
              };
              a.O = b.requestVideoFrameCallback(c);
            } else a.P.ua(0.025);
            a.M && a.M.ua(1);
            a.fa = true;
          }
        }
        function Gr(a) {
          a.fa && !a.G.size && (a.I.Ja(a.g, "playing", a.Y), a.I.Ja(a.g, "timeupdate", a.Y), a.I.Ja(a.g, "ended", a.Z), -1 != a.O && (a.g.cancelVideoFrameCallback(a.O), a.O = -1), a.P && a.P.stop(), a.M && a.M.stop(), a.fa = false);
        }
        function Ir(a) {
          if (a.A && a.T && !a.K) {
            var b = a.T.supportsMultipleMediaElements, c = a.g;
            c.webkitSupportsFullscreen && c.webkitDisplayingFullscreen && (b = false);
            a.B == b && (a.B = !b, a.B ? (a.h = a.g, a.F && (a.F.parentElement && a.A.removeChild(a.F), a.F = null)) : (a.F || (b = document.createElement(a.g.tagName), b.autoplay = true, b.style.position = "absolute", b.style.top = "0", b.style.left = "0", b.style.width = "100%", b.style.height = "100%", b.style.display = "none", b.setAttribute("playsinline", ""), a.F = b), a.h = a.F));
          }
        }
        r.stop = function() {
          this.l && this.l.Qa();
          this.W.clear();
          this.G.clear();
          this.j.pf();
          if (this.C.size) {
            var a = Array.from(this.C.values());
            a = t(a);
            for (var b = a.next(); !b.done; b = a.next()) (b = b.value) && b.then(function(c) {
              c && c.destroy();
            });
          }
          this.C.clear();
          if (this.L.size) for (a = Array.from(this.L.keys()), a = t(a), b = a.next(); !b.done; b = a.next()) Fr(this, b.value);
          this.L.clear();
          this.j.detach();
          this.K = false;
          this.u = this.o = null;
          this.B = true;
          this.h = this.g;
          this.F = null;
          Kr(this);
          Gr(this);
          this.A && Zj(this.A);
          this.m && (this.m.stop(), this.m = null);
        };
        r.release = function() {
          this.stop();
          this.I && this.I.release();
          this.l && this.l.release();
          this.P && (this.P.stop(), this.P = null);
          this.M && (this.M.stop(), this.M = null);
          this.j.destroy();
        };
        r.If = function() {
          return this.j;
        };
        function Lr(a, b) {
          var c;
          Q(function(d) {
            if (1 == d.g) return Ar(a), F(d, Mr(a, b), 2);
            c = d.h;
            c.length ? Nr(a, c) : bb("Unsupported HLS interstitial", b);
            I(d);
          });
        }
        function Or(a, b) {
          var c = be(b.eventNode, "OverlayEvent"), d = c.attributes.uri, e = c.attributes.mimeType, f = "true" == c.attributes.loop, g = he(c, "z", ne);
          if (d && 0 != g) {
            var h = { viewport: { x: 1920, y: 1080 }, topLeft: { x: 0, y: 0 }, size: { x: 1920, y: 1080 } }, k2 = be(c, "Viewport"), l = be(c, "TopLeft"), m = be(c, "Size");
            if (k2 && l && m) {
              h = he(k2, "x", ne);
              if (null == h) return;
              k2 = he(k2, "y", ne);
              if (null == k2) return;
              var n = he(l, "x", ne);
              if (null == n) return;
              l = he(l, "y", ne);
              if (null == l) return;
              var p = he(m, "x", ne);
              if (null == p) return;
              m = he(m, "y", ne);
              if (null == m) return;
              h = { viewport: {
                x: h,
                y: k2
              }, topLeft: { x: n, y: l }, size: { x: p, y: m } };
            }
            m = be(c, "SqueezeCurrent");
            c = null;
            m && (m = he(m, "percentage", qe)) && (c = { viewport: { x: 1920, y: 1080 }, topLeft: { x: 0, y: 0 }, size: { x: 1920 * m, y: 1080 * m } });
            Nr(a, [{ id: b.id, groupId: null, startTime: b.startTime, endTime: b.endTime, uri: d, mimeType: e, isSkippable: false, skipOffset: null, skipFor: null, canJump: true, resumeOffset: null, playoutLimit: null, once: false, pre: false, post: false, timelineRange: true, loop: f, overlay: h, displayOnBackground: -1 == g, currentVideo: c, background: null }]);
          }
        }
        r.addAdUrlInterstitial = function(a) {
          var b = this, c, d, e, f, g, h, k2, l, m;
          return Q(function(n) {
            switch (n.g) {
              case 1:
                return c = { type: 12 }, F(n, Pr(b, a, c), 2);
              case 2:
                d = n.h;
                e = Qd(d, "VAST,vmap:VMAP");
                if (!e) throw new U(2, 10, 10007);
                f = [];
                if ("VAST" == e.tagName) {
                  f = or(e, b.o);
                  n.s(3);
                  break;
                }
                if ("vmap:VMAP" != e.tagName) {
                  n.s(3);
                  break;
                }
                for (var p = [], q = t(Yd(e, "vmap:AdBreak")), u = q.next(); !u.done; u = q.next()) {
                  var w = u.value, v = w.attributes.timeOffset;
                  v && (u = null, "start" == v ? u = 0 : "end" == v ? u = Infinity : u = Md(v), (w = be(w, "vmap:AdSource")) && (w = be(w, "vmap:AdTagURI")) && (w = Zd(w)) && p.push({ time: u, uri: w }));
                }
                g = t(p);
                h = g.next();
              case 5:
                if (h.done) {
                  n.s(3);
                  break;
                }
                k2 = h.value;
                return F(n, Pr(b, k2.uri, c), 8);
              case 8:
                l = n.h;
                m = Qd(l, "VAST");
                if (!m) throw new U(2, 10, 10007);
                f.push.apply(f, y(or(m, k2.time)));
                h = g.next();
                n.s(5);
                break;
              case 3:
                Nr(b, f), I(n);
            }
          });
        };
        function Nr(a, b) {
          var c, d, e, f, g, h, k2, l;
          Q(function(m) {
            switch (m.g) {
              case 1:
                c = false, d = t(b), e = d.next();
              case 2:
                if (e.done) {
                  m.s(4);
                  break;
                }
                f = e.value;
                if (!f.uri) {
                  bb("Missing URL in interstitial", f);
                  m.s(3);
                  break;
                }
                if (f.mimeType) {
                  m.s(5);
                  break;
                }
                xa(m, 6);
                g = a.j.xb();
                return F(m, Do(f.uri, g, a.H.getConfiguration().streaming.retryParameters), 8);
              case 8:
                f.mimeType = m.h;
                Aa(m, 5);
                break;
              case 6:
                Ba(m);
              case 5:
                h = f.id || JSON.stringify(f);
                if (a.W.has(h)) {
                  m.s(3);
                  break;
                }
                f.loop && !f.overlay && bb("Loop is only supported in overlay interstitials", f);
                f.overlay || (c = true);
                a.W.add(h);
                a.G.add(f);
                k2 = false;
                f.pre && null == a.o ? k2 = true : 0 != f.startTime || f.canJump ? null != a.o && (l = f.startTime - a.o, 0 < l && 10 >= l && (k2 = true)) : k2 = true;
                k2 && (!a.C.has(f) && Dr(f) && a.C.set(f, a.j.preload(f.uri, null, f.mimeType || void 0)), Er(a, f));
              case 3:
                e = d.next();
                m.s(2);
                break;
              case 4:
                c && Hr(a), Jr(a), I(m);
            }
          });
        }
        function Br(a, b, c) {
          b = void 0 === b ? false : b;
          c = void 0 === c ? null : c;
          var d = 0, e = null;
          if (a.G.size && null != a.o) {
            var f = a.g.ended, g = Array.from(a.G).sort(function(m, n) {
              return n.startTime - m.startTime;
            }), h = g;
            h = b ? g.filter(function(m) {
              return m.pre;
            }) : f ? g.filter(function(m) {
              return m.post;
            }) : g.filter(function(m) {
              return !m.pre && !m.post;
            });
            g = t(h);
            for (h = g.next(); !h.done; h = g.next()) {
              h = h.value;
              var k2 = false;
              if (b) k2 = h.pre;
              else if (f) k2 = h.post;
              else if (!h.pre && !h.post) {
                var l = a.o - Math.round(1e3 * h.startTime) / 1e3;
                0 < l && (1 >= l || !h.canJump) && (k2 = null == c && a.u && !a.u.pre && !a.u.post && a.u.startTime >= h.startTime ? false : true);
              }
              k2 && (!a.u || h.startTime >= a.u.startTime) && (d == (c || 0) ? e = h : e && !h.canJump && 1e-3 < Math.round(1e3 * h.startTime) / 1e3 - Math.round(1e3 * e.startTime) / 1e3 && (e = h, d = 0), d++);
            }
          }
          return e;
        }
        function Cr(a, b, c, d, e, f) {
          f = void 0 === f ? 0 : f;
          a.u = b;
          Ir(a);
          !a.h.parentElement && a.A && a.A.appendChild(a.h);
          1 == d && 1 == c && (c = Array.from(a.G).filter(function(g) {
            return b.pre ? g.pre == b.pre : b.post ? g.post == b.post : 1e-3 > Math.abs(g.startTime - b.startTime);
          }).length);
          b.once && (f++, a.G.delete(b), Gr(a), b.overlay || Hr(a));
          b.mimeType && (b.mimeType.startsWith("image/") || "text/html" === b.mimeType) ? b.overlay ? Qr(a, b, c, d, f) : bb("Unsupported interstitial", b) : a.B && b.overlay ? bb("Unsupported interstitial", b) : Rr(a, b, c, d, e, f);
        }
        function Qr(a, b, c, d, e) {
          function f() {
            a.m && (a.m.stop(), a.m = null);
            a.A.removeChild(k2);
            Kr(a, b);
            a.i(new V("ad-stopped"));
            var p = Br(a, b.pre, d - e);
            p ? (a.l.Qa(), Cr(a, p, c, ++d, Date.now(), e)) : a.K = false;
          }
          var g = b.overlay, h = "text/html" == b.mimeType ? "iframe" : "img", k2 = document.createElement(h);
          k2.style.objectFit = "contain";
          k2.style.position = "absolute";
          k2.style.border = "none";
          Sr(a, b);
          a.i(new V("ad-started", (/* @__PURE__ */ new Map()).set("ad", new yr(b, c, d))));
          "iframe" == h ? k2.src = b.uri : (k2.src = b.uri, k2.onerror = function(p) {
            a.i(new V("ad-error", (/* @__PURE__ */ new Map()).set(
              "originalEvent",
              p
            )));
            f();
          });
          var l = g.viewport, m = g.topLeft;
          g = g.size;
          0 == l.x && 0 == l.y ? (k2.width = b.overlay.size.x, k2.height = b.overlay.size.y, k2.style.bottom = "10%", k2.style.left = "0", k2.style.right = "0", k2.style.width = "100%", b.overlay.size.y || "iframe" != h || (k2.style.height = "auto")) : (k2.style.height = g.y / l.y * 100 + "%", k2.style.left = m.x / l.x * 100 + "%", k2.style.top = m.y / l.y * 100 + "%", k2.style.width = g.x / l.x * 100 + "%");
          a.A.appendChild(k2);
          var n = Date.now();
          a.m && a.m.stop();
          a.m = new ec(function() {
            b.playoutLimit && (Date.now() - n) / 1e3 > b.playoutLimit ? (a.i(new V("ad-complete")), f()) : b.endTime && a.g.currentTime > b.endTime ? (a.i(new V("ad-complete")), f()) : a.g.currentTime < b.startTime && (a.i(new V("ad-skipped")), f());
          });
          b.playoutLimit && !b.endTime ? a.m.da(b.playoutLimit) : b.endTime && a.m.ua(0.025);
          a.l.D(a.g, "seeked", function() {
            var p = a.g.currentTime;
            if (p < b.startTime || b.endTime && p > b.endTime) a.m && a.m.stop(), a.i(new V("ad-skipped")), f();
          });
        }
        function Rr(a, b, c, d, e, f) {
          var g, h, k2, l, m, n, p, q, u, w, v, x, z, C, D, G, B;
          Q(function(A) {
            switch (A.g) {
              case 1:
                g = Date.now();
                a.K = true;
                if (!a.B || 1 != d) {
                  A.s(2);
                  break;
                }
                a.i(new V("ad-content-pause-requested", (/* @__PURE__ */ new Map()).set("saveLivePosition", true)));
                h = new Ug();
                k2 = function(H) {
                  return Q(function(E) {
                    if (1 == E.g) return "detach" != H.state ? E.s(0) : Ac() ? F(E, new Promise(function(K) {
                      return new ec(K).da(0.1);
                    }), 3) : E.s(3);
                    h.resolve();
                    a.l.Ja(a.H, "onstatechange", k2);
                    I(E);
                  });
                };
                a.l.D(a.H, "onstatechange", k2);
                return F(A, h, 2);
              case 2:
                return Sr(a, b), a.B || (a.h.style.display = "", b.overlay ? (a.h.loop = b.loop, l = b.overlay.viewport, m = b.overlay.topLeft, n = b.overlay.size, a.h.style.height = n.y / l.y * 100 + "%", a.h.style.left = m.x / l.x * 100 + "%", a.h.style.top = m.y / l.y * 100 + "%", a.h.style.width = n.x / l.x * 100 + "%") : (a.g.pause(), null != b.resumeOffset && 0 != b.resumeOffset && (a.g.currentTime += b.resumeOffset), a.h.loop = false, a.h.style.height = "100%", a.h.style.left = "0", a.h.style.top = "0", a.h.style.width = "100%")), p = false, q = function() {
                  if (!a.B && !b.overlay && null == b.resumeOffset) if (b.timelineRange && b.endTime && Infinity != b.endTime) a.g.currentTime != b.endTime && (a.g.currentTime = b.endTime);
                  else {
                    var H = Date.now();
                    a.g.currentTime += (H - e) / 1e3;
                    e = H;
                  }
                }, u = function(H) {
                  var E, K;
                  return Q(function(M) {
                    if (1 == M.g) {
                      q();
                      E = Br(a, b.pre, d - f);
                      if (H && b.groupId) for (; E && E.groupId == b.groupId; ) d++, E = Br(a, b.pre, d - f);
                      a.m && (!b.groupId || E && E.groupId != b.groupId) && (a.m.stop(), a.m = null);
                      Kr(a, b);
                      if (E && !E.overlay) return M.s(2);
                      b.post && (a.o = null, a.u = null);
                      return a.B ? F(M, a.j.detach(), 4) : F(M, a.j.kc(), 4);
                    }
                    2 != M.g && (a.B && (K = b.resumeOffset, null == K && (K = b.timelineRange && b.endTime && Infinity != b.endTime ? b.endTime - (a.o || 0) : (Date.now() - e) / 1e3), a.i(new V("ad-content-resume-requested", (/* @__PURE__ */ new Map()).set("offset", K)))), a.i(new V("ad-stopped")), a.l.Qa(), a.K = false, a.B ? Hr(a) : (a.h.style.display = "none", q(), a.g.ended || a.g.play()));
                    Ir(a);
                    E && (a.i(new V("ad-stopped")), a.l.Qa(), Cr(a, E, c, ++d, e, f));
                    I(M);
                  });
                }, w = function(H) {
                  return Q(function(E) {
                    if (p) return E.return();
                    p = true;
                    a.i(new V("ad-error", (/* @__PURE__ */ new Map()).set("originalEvent", H)));
                    return F(E, u(false), 0);
                  });
                }, v = function() {
                  return Q(function(H) {
                    if (1 == H.g) {
                      if (p) return H.return();
                      p = true;
                      return F(H, u(false), 2);
                    }
                    a.i(new V("ad-complete"));
                    I(H);
                  });
                }, a.ea = function() {
                  return Q(function(H) {
                    if (p) return H.return();
                    p = true;
                    a.i(new V("ad-skipped"));
                    return F(H, u(true), 0);
                  });
                }, x = new xr(a.h, b, a.ea, c, d, !a.B), a.B || (x.setMuted(a.g.muted), x.setVolume(a.g.volume)), a.i(new V("ad-started", (/* @__PURE__ */ new Map()).set("ad", x))), (z = x.canSkipNow()) && a.i(new V("ad-skip-state-changed")), a.l.ma(a.j, "error", w), a.l.D(a.h, "timeupdate", function() {
                  if (a.h.duration) {
                    var H = x.canSkipNow();
                    z != H && 0 < x.getRemainingTime() && 0 < x.getDuration() && a.i(new V("ad-skip-state-changed"));
                    z = H;
                  }
                }), a.l.ma(a.j, "firstquartile", function() {
                  q();
                  a.i(new V("ad-first-quartile"));
                }), a.l.ma(a.j, "midpoint", function() {
                  q();
                  a.i(new V("ad-midpoint"));
                }), a.l.ma(a.j, "thirdquartile", function() {
                  q();
                  a.i(new V("ad-third-quartile"));
                }), a.l.ma(a.j, "complete", v), a.l.D(a.h, "play", function() {
                  a.i(new V("ad-resumed"));
                }), a.l.D(a.h, "pause", function() {
                  var H = a.j.getConfiguration();
                  a.h.currentTime >= H.playRangeEnd ? v() : a.i(new V("ad-paused"));
                }), a.l.D(a.h, "volumechange", function() {
                  a.h.muted ? a.i(new V("ad-muted")) : a.i(new V("ad-volume-changed"));
                }), xa(A, 4), Ar(a), b.startTime && b.endTime && Infinity != b.endTime && b.startTime != b.endTime && (C = b.endTime - b.startTime, 0 < C && a.j.configure("playRangeEnd", C)), b.playoutLimit && !a.m && (a.m = new ec(function() {
                  a.ea();
                }).da(b.playoutLimit), a.j.configure("playRangeEnd", b.playoutLimit)), F(A, a.j.Lb(a.h), 6);
              case 6:
                return a.C.has(b) ? F(A, a.C.get(b), 10) : F(A, a.j.load(b.uri, null, b.mimeType || void 0), 8);
              case 10:
                return D = A.h, a.C.delete(b), D ? F(A, a.j.load(D), 8) : F(A, a.j.load(
                  b.uri,
                  null,
                  b.mimeType || void 0
                ), 8);
              case 8:
                a.h.play();
                G = (Date.now() - g) / 1e3;
                a.i(new V("ads-loaded", (/* @__PURE__ */ new Map()).set("loadTime", G)));
                a.B && a.g.play();
                b.overlay && (a.l.D(a.g, "seeking", function() {
                  var H = a.g.currentTime - b.startTime;
                  0.1 < Math.abs(H - a.h.currentTime) && (a.h.currentTime = H);
                }), a.l.D(a.g, "seeked", function() {
                  var H = a.g.currentTime;
                  (H < b.startTime || b.endTime && H > b.endTime) && a.ea();
                }));
                Aa(A, 0);
                break;
              case 4:
                B = Ba(A);
                if (!a.K) return A.return();
                w(B);
                I(A);
            }
          });
        }
        function Sr(a, b) {
          b.displayOnBackground && (a.g.style.zIndex = "1");
          if (null != b.currentVideo) {
            var c = b.currentVideo;
            a.g.style.transformOrigin = "top left";
            var d = true, e = [], f = c.topLeft.x / c.viewport.x * 100;
            0 < f && 100 >= f && (e.push("translateX(" + f + "%)"), d = false);
            f = c.topLeft.y / c.viewport.y * 100;
            0 < f && 100 >= f && (e.push("translateY(" + f + "%)"), d = false);
            f = c.size.x / c.viewport.x;
            1 > f && e.push("scaleX(" + f + ")");
            c = c.size.y / c.viewport.y;
            1 > f && e.push("scaleY(" + c + ")");
            e.length && (a.g.style.transform = e.join(" "));
            d && (a.g.style.transition = "transform 250ms");
          }
          a.A && (a.A.style.pointerEvents = "none", b.background && (a.A.style.background = b.background));
          a.F && (a.F.style.background = b.overlay ? "" : "rgb(0, 0, 0)");
        }
        function Kr(a, b) {
          if (!b || b.displayOnBackground) a.g.style.zIndex = "";
          b && null == b.currentVideo || (a.g.style.transformOrigin = "", a.g.style.transition = "", a.g.style.transform = "");
          a.A && (a.A.style.pointerEvents = "", !b || b.background) && (a.A.style.background = "");
          a.F && (a.F.style.background = "");
        }
        function Mr(a, b) {
          var c, d, e, f, g, h, k2, l, m, n, p, q, u, w, v, x, z, C, D, G, B, A, H, E, K, M, J, L, N, P, O, R, S, pa, Z, Fa, Ia, sa, ka, Ca, ra, ya;
          return Q(function(na) {
            switch (na.g) {
              case 1:
                c = [];
                if (!b) return na.return(c);
                d = b.values.find(function(ta) {
                  return "X-ASSET-URI" == ta.key;
                });
                e = b.values.find(function(ta) {
                  return "X-ASSET-LIST" == ta.key;
                });
                if (!d && !e) return na.return(c);
                f = null;
                if (g = b.values.find(function(ta) {
                  return "ID" == ta.key;
                })) f = g.data;
                h = null == f ? Math.floor(10 * b.startTime) / 10 : b.startTime;
                (k2 = b.endTime) && Infinity != b.endTime && "number" == typeof b.endTime && (k2 = null == f ? Math.floor(10 * b.endTime) / 10 : b.endTime);
                l = b.values.find(function(ta) {
                  return "X-RESTRICT" == ta.key;
                });
                n = m = true;
                l && l.data && (p = l.data, m = !p.includes("SKIP"), n = !p.includes("JUMP"));
                q = m ? 0 : null;
                if (u = b.values.find(function(ta) {
                  return "X-ENABLE-SKIP-AFTER" == ta.key;
                })) w = u.data, q = parseFloat(w), isNaN(q) && (q = m ? 0 : null);
                v = null;
                if (x = b.values.find(function(ta) {
                  return "X-ENABLE-SKIP-FOR" == ta.key;
                })) z = x.data, v = parseFloat(z), isNaN(q) && (v = null);
                C = null;
                if (D = b.values.find(function(ta) {
                  return "X-RESUME-OFFSET" == ta.key;
                })) G = D.data, C = parseFloat(G), isNaN(C) && (C = null);
                B = null;
                if (A = b.values.find(function(ta) {
                  return "X-PLAYOUT-LIMIT" == ta.key;
                })) H = A.data, B = parseFloat(H), isNaN(B) && (B = null);
                M = K = E = false;
                if (J = b.values.find(function(ta) {
                  return "CUE" == ta.key;
                })) L = J.data, E = L.includes("ONCE"), K = L.includes("PRE"), M = L.includes("POST");
                N = false;
                (P = b.values.find(function(ta) {
                  return "X-TIMELINE-OCCUPIES" == ta.key;
                })) ? (O = P.data, N = O.includes("RANGE")) : !D && a.H.U() && (N = !K && !M);
                if (d) {
                  R = d.data;
                  if (!R) return na.return(c);
                  c.push({
                    id: f,
                    groupId: null,
                    startTime: h,
                    endTime: k2,
                    uri: R,
                    mimeType: null,
                    isSkippable: m,
                    skipOffset: q,
                    skipFor: v,
                    canJump: n,
                    resumeOffset: C,
                    playoutLimit: B,
                    once: E,
                    pre: K,
                    post: M,
                    timelineRange: N,
                    loop: false,
                    overlay: null,
                    displayOnBackground: false,
                    currentVideo: null,
                    background: null
                  });
                  na.s(2);
                  break;
                }
                if (!e) {
                  na.s(2);
                  break;
                }
                S = e.data;
                if (!S) return na.return(c);
                xa(na, 4);
                pa = { type: 11 };
                return F(na, Pr(a, S, pa), 6);
              case 6:
                Z = na.h;
                Fa = Hc(Z);
                Ia = JSON.parse(Fa);
                if (sa = Ia["SKIP-CONTROL"]) ka = sa["ENABLE-SKIP-AFTER"], "number" == typeof ka && (q = parseFloat(ka), isNaN(ka) && (q = m ? 0 : null)), Ca = sa["ENABLE-SKIP-FOR"], "number" == typeof Ca && (v = parseFloat(Ca), isNaN(Ca) && (v = null));
                for (ra = 0; ra < Ia.ASSETS.length; ra++) ya = Ia.ASSETS[ra], ya.URI && c.push({ id: f + "_shaka_asset_" + ra, groupId: f, startTime: h, endTime: k2, uri: ya.URI, mimeType: null, isSkippable: m, skipOffset: q, skipFor: v, canJump: n, resumeOffset: C, playoutLimit: B, once: E, pre: K, post: M, timelineRange: N, loop: false, overlay: null, displayOnBackground: false, currentVideo: null, background: null });
                Aa(na, 2);
                break;
              case 4:
                Ba(na);
              case 2:
                return na.return(c);
            }
          });
        }
        function Hr(a) {
          for (var b = [], c = t(a.G), d = c.next(), e = {}; !d.done; e = { $b: void 0 }, d = c.next()) d = d.value, d.overlay || (e.$b = { start: d.startTime, end: null }, d.pre ? (e.$b.start = 0, e.$b.end = null) : d.post ? (e.$b.start = -1, e.$b.end = null) : d.timelineRange && (e.$b.end = d.endTime), b.find(/* @__PURE__ */ function(f) {
            return function(g) {
              return f.$b.start == g.start && f.$b.end == g.end;
            };
          }(e)) || b.push(e.$b));
          a.i(new V("ad-cue-points-changed", (/* @__PURE__ */ new Map()).set("cuepoints", b)));
        }
        function Ar(a) {
          a.j.configure(a.H.Vg());
          a.j.configure("ads.disableHLSInterstitial", true);
          a.j.configure("ads.disableDASHInterstitial", true);
          a.j.configure("playRangeEnd", Infinity);
          kh(a.H.xb(), a.j.xb());
        }
        function Pr(a, b, c) {
          var d, e, f;
          return Q(function(g) {
            if (1 == g.g) return d = lh([b], Sg()), e = a.H.xb().request(7, d, c), F(g, e.promise, 2);
            f = g.h;
            return g.return(f.data);
          });
        }
        function Dr(a) {
          return (a = a.mimeType) ? !a.startsWith("image/") && "text/html" !== a : true;
        }
        function Er(a, b) {
          if (!(a.L.has(b) || a.T && !a.T.allowPreloadOnDomElements)) {
            var c = function(f) {
              var g = document.createElement("link");
              g.rel = "preload";
              g.href = f;
              g.as = "image";
              document.head.appendChild(g);
              return g;
            }, d = [];
            if (b.background) {
              var e = b.background.match(/url\(('|")?([^'"()]+)('|")\)?/);
              e && d.push(c(e[2]));
            }
            b.mimeType.startsWith("image/") && d.push(c(b.uri));
            a.L.set(b, d);
          }
        }
        function Fr(a, b) {
          if (a.L.has(b)) {
            var c = a.L.get(b);
            c = t(c);
            for (var d = c.next(); !d.done; d = c.next()) d = d.value, d.parentNode.removeChild(d);
            a.L.delete(b);
          }
        }
        function Tr(a, b, c, d, e) {
          this.h = a;
          this.j = Md(this.h.skipOffset);
          this.g = e;
          this.i = b;
          this.l = c;
          this.o = d;
          this.m = false;
        }
        r = Tr.prototype;
        r.needsSkipUI = function() {
          return true;
        };
        r.isClientRendering = function() {
          return false;
        };
        r.hasCustomClick = function() {
          return false;
        };
        r.isUsingAnotherMediaElement = function() {
          return false;
        };
        r.getDuration = function() {
          return this.h.durationInSeconds;
        };
        r.getMinSuggestedDuration = function() {
          return this.getDuration();
        };
        r.getRemainingTime = function() {
          return this.h.startTimeInSeconds + this.h.durationInSeconds - this.g.currentTime;
        };
        r.isPaused = function() {
          return this.g.paused;
        };
        r.isSkippable = function() {
          return "number" == typeof this.j ? true : false;
        };
        r.getTimeUntilSkippable = function() {
          if ("number" != typeof this.j) return this.getRemainingTime();
          var a = this.getRemainingTime() + this.j - this.getDuration();
          return Math.max(a, 0);
        };
        r.canSkipNow = function() {
          return 0 == this.getTimeUntilSkippable();
        };
        r.skip = function() {
          this.m = true;
          this.g.currentTime += this.getRemainingTime();
        };
        r.pause = function() {
          return this.g.pause();
        };
        r.play = function() {
          return this.g.play();
        };
        r.getVolume = function() {
          return this.g.volume;
        };
        r.setVolume = function(a) {
          this.g.volume = a;
        };
        r.isMuted = function() {
          return this.g.muted;
        };
        r.isLinear = function() {
          return this.o;
        };
        r.resize = function() {
        };
        r.setMuted = function(a) {
          this.g.muted = a;
        };
        r.getSequenceLength = function() {
          return this.l ? this.l : 1;
        };
        r.getPositionInSequence = function() {
          return this.i ? this.i : 1;
        };
        r.getTitle = function() {
          return this.h.adTitle;
        };
        r.getDescription = function() {
          return "";
        };
        r.getVastMediaBitrate = function() {
          return 0;
        };
        r.getVastMediaHeight = function() {
          return 0;
        };
        r.getVastMediaWidth = function() {
          return 0;
        };
        r.getAdId = function() {
          return this.h.adId;
        };
        r.getCreativeAdId = function() {
          return this.h.creativeId;
        };
        r.getAdvertiserName = function() {
          return "";
        };
        r.getMediaUrl = function() {
          return null;
        };
        r.getTimeOffset = function() {
          return 0;
        };
        r.getPodIndex = function() {
          return 0;
        };
        r.release = function() {
          this.l = this.i = this.g = this.h = null;
        };
        T("shaka.ads.MediaTailorAd", Tr);
        Tr.prototype.release = Tr.prototype.release;
        Tr.prototype.getPodIndex = Tr.prototype.getPodIndex;
        Tr.prototype.getTimeOffset = Tr.prototype.getTimeOffset;
        Tr.prototype.getMediaUrl = Tr.prototype.getMediaUrl;
        Tr.prototype.getAdvertiserName = Tr.prototype.getAdvertiserName;
        Tr.prototype.getCreativeAdId = Tr.prototype.getCreativeAdId;
        Tr.prototype.getAdId = Tr.prototype.getAdId;
        Tr.prototype.getVastMediaWidth = Tr.prototype.getVastMediaWidth;
        Tr.prototype.getVastMediaHeight = Tr.prototype.getVastMediaHeight;
        Tr.prototype.getVastMediaBitrate = Tr.prototype.getVastMediaBitrate;
        Tr.prototype.getDescription = Tr.prototype.getDescription;
        Tr.prototype.getTitle = Tr.prototype.getTitle;
        Tr.prototype.getPositionInSequence = Tr.prototype.getPositionInSequence;
        Tr.prototype.getSequenceLength = Tr.prototype.getSequenceLength;
        Tr.prototype.setMuted = Tr.prototype.setMuted;
        Tr.prototype.resize = Tr.prototype.resize;
        Tr.prototype.isLinear = Tr.prototype.isLinear;
        Tr.prototype.isMuted = Tr.prototype.isMuted;
        Tr.prototype.setVolume = Tr.prototype.setVolume;
        Tr.prototype.getVolume = Tr.prototype.getVolume;
        Tr.prototype.play = Tr.prototype.play;
        Tr.prototype.pause = Tr.prototype.pause;
        Tr.prototype.skip = Tr.prototype.skip;
        Tr.prototype.canSkipNow = Tr.prototype.canSkipNow;
        Tr.prototype.getTimeUntilSkippable = Tr.prototype.getTimeUntilSkippable;
        Tr.prototype.isSkippable = Tr.prototype.isSkippable;
        Tr.prototype.isPaused = Tr.prototype.isPaused;
        Tr.prototype.getRemainingTime = Tr.prototype.getRemainingTime;
        Tr.prototype.getMinSuggestedDuration = Tr.prototype.getMinSuggestedDuration;
        Tr.prototype.getDuration = Tr.prototype.getDuration;
        Tr.prototype.isUsingAnotherMediaElement = Tr.prototype.isUsingAnotherMediaElement;
        Tr.prototype.hasCustomClick = Tr.prototype.hasCustomClick;
        Tr.prototype.isClientRendering = Tr.prototype.isClientRendering;
        Tr.prototype.needsSkipUI = Tr.prototype.needsSkipUI;
        function Ur(a, b, c, d) {
          this.B = a;
          this.K = b;
          this.h = c;
          this.l = null;
          this.P = NaN;
          this.i = d;
          this.I = false;
          this.A = null;
          this.j = [];
          this.M = [];
          this.L = this.C = this.g = null;
          this.F = /* @__PURE__ */ new Map();
          this.m = [];
          this.u = [];
          this.G = "";
          this.O = true;
          this.H = "";
          this.o = new lb();
        }
        Ur.prototype.stop = function() {
          for (var a = t(this.m), b = a.next(); !b.done; b = a.next()) b = b.value, this.o.Ja(b.target, b.type, b.listener);
          Vr(this);
          this.m = [];
          this.u = [];
          this.G = "";
          this.O = true;
          this.H = "";
          this.A = null;
          this.j = [];
          this.M = [];
          this.F.clear();
        };
        Ur.prototype.release = function() {
          this.stop();
          this.o && this.o.release();
        };
        Ur.prototype.onManifestUpdated = function(a) {
          this.I = a;
          "" != this.G && (Wr(this, this.G, this.O), this.O = false);
        };
        Ur.prototype.getCuePoints = function() {
          for (var a = [], b = t(this.j), c = b.next(); !c.done; c = b.next()) {
            c = t(c.value.ads);
            for (var d = c.next(); !d.done; d = c.next()) d = d.value, a.push({ start: d.startTimeInSeconds, end: d.startTimeInSeconds + d.durationInSeconds });
          }
          return a;
        };
        function Xr(a, b, c) {
          var d, e, f, g, h, k2, l, m, n, p, q, u;
          Q(function(w) {
            if (1 == w.g) return d = { type: 7 }, e = lh([b], Sg()), e.method = "POST", c && (f = JSON.stringify(c), e.body = Lc(f)), g = a.K.request(7, e, d), xa(w, 2), F(w, g.promise, 4);
            if (2 != w.g) {
              h = w.h;
              k2 = Hc(h.data);
              l = JSON.parse(k2);
              if (l.manifestUrl && l.trackingUrl) m = new yb(b), n = new yb(l.trackingUrl), a.G = m.resolve(n).toString(), p = Date.now() / 1e3, q = p - a.P, a.i(new V("ads-loaded", (/* @__PURE__ */ new Map()).set("loadTime", q))), u = new yb(l.manifestUrl), a.l.resolve(m.resolve(u).toString()), a.l = null;
              else throw Error("Insufficient data from MediaTailor.");
              return Aa(w, 0);
            }
            Ba(w);
            if (!a.H.length) return a.l.reject("MediaTailor request returned an error and there was no backup asset uri provided."), a.l = null, w.return();
            a.l.resolve(a.H);
            a.l = null;
            I(w);
          });
        }
        function Wr(a, b, c) {
          var d, e, f, g, h, k2, l, m, n, p, q, u, w, v, x, z;
          Q(function(C) {
            if (1 == C.g) return d = { type: 8 }, e = lh([b], Sg()), f = a.K.request(7, e, d), xa(C, 2), F(C, f.promise, 4);
            if (2 != C.g) {
              g = C.h;
              h = [];
              k2 = Hc(g.data);
              l = JSON.parse(k2);
              if (0 < l.avails.length) {
                if (JSON.stringify(a.j) != JSON.stringify(l.avails)) {
                  a.j = l.avails;
                  m = t(a.j);
                  for (n = m.next(); !n.done; n = m.next()) for (p = n.value, q = t(p.nonLinearAdsList), u = q.next(); !u.done; u = q.next()) for (w = u.value, v = t(w.nonLinearAdList), x = v.next(); !x.done; x = v.next()) z = x.value, Yr(a, z);
                  h = a.getCuePoints();
                  a.i(new V("ad-cue-points-changed", (/* @__PURE__ */ new Map()).set("cuepoints", h)));
                }
              } else a.j.length && a.i(new V("ad-cue-points-changed", (/* @__PURE__ */ new Map()).set("cuepoints", h))), Vr(a), a.j = [];
              c && (a.I || 0 < h.length) && Zr(a);
              return Aa(C, 0);
            }
            Ba(C);
            I(C);
          });
        }
        function Yr(a, b) {
          var c, e, f, g, h, k2, l, m;
          Q(function(n) {
            if (1 == n.g) {
              if (!b.staticResource) return n.return();
              c = $r(b);
              if (a.F.get(c)) return n.return();
              e = { type: 9 };
              f = lh([b.staticResource], Sg());
              g = a.K.request(7, f, e);
              xa(n, 2);
              a.F.set(c, []);
              return F(n, g.promise, 4);
            }
            if (2 != n.g) return h = n.h, k2 = Hc(h.data), l = JSON.parse(k2), m = l.apps, a.F.set(c, m), Aa(n, 0);
            Ba(n);
            a.F.delete(c);
            I(n);
          });
        }
        function $r(a) {
          return [a.adId, a.adParameters, a.adSystem, a.adTitle, a.creativeAdId, a.creativeId, a.creativeSequence, a.height, a.width, a.staticResource].join("");
        }
        function Zr(a) {
          as(a);
          a.I || (bs(a), a.o.D(a.h, "seeked", function() {
            bs(a);
          }), a.o.D(a.h, "ended", function() {
            Vr(a);
          }));
          a.o.D(a.h, "timeupdate", function() {
            as(a);
          });
        }
        function bs(a) {
          var b = a.h.currentTime;
          if (0 != b && null == a.A) {
            for (var c, d, e = t(a.j), f = e.next(); !f.done; f = e.next()) {
              f = f.value;
              for (var g = t(f.ads), h = g.next(); !h.done; h = g.next()) if (h = h.value, !d) h.startTimeInSeconds < b && (d = h, c = f);
              else if (h.startTimeInSeconds < b && h.startTimeInSeconds > d.startTimeInSeconds + d.durationInSeconds) {
                d = h;
                c = f;
                break;
              }
            }
            c && d && !a.M.includes(d.adId) && (a.A = b, a.h.currentTime = c.startTimeInSeconds);
          }
        }
        function as(a) {
          if (a.h.duration && (a.g || a.j.length)) {
            var b = a.h.currentTime, c = false;
            if (a.g) {
              c = true;
              var d = a.C, e = d.startTimeInSeconds + 0.5 * d.durationInSeconds, f = d.startTimeInSeconds + 0.75 * d.durationInSeconds;
              b >= d.startTimeInSeconds + 0.25 * d.durationInSeconds && !a.u.includes("firstQuartile") ? (a.u.push("firstQuartile"), cs(a, "firstQuartile")) : b >= e && !a.u.includes("midpoint") ? (a.u.push("midpoint"), cs(a, "midpoint")) : b >= f && !a.u.includes("thirdQuartile") && (a.u.push("thirdQuartile"), cs(a, "thirdQuartile"));
              d = a.g.getRemainingTime();
              e = a.g.getDuration();
              a.g.canSkipNow() && 0 < d && 0 < e && cs(a, "skipStateChanged");
              0 < e && (0 >= d || d > e) && Vr(a);
            }
            if (!a.g || !a.g.isLinear()) {
              a: for (d = t(a.j), e = d.next(); !e.done; e = d.next()) {
                e = e.value;
                if (a.g && a.g.isLinear()) break;
                for (f = 0; f < e.ads.length; f++) {
                  var g = e.ads[f], h = g.startTimeInSeconds + g.durationInSeconds;
                  if (g.startTimeInSeconds <= b && h > b) {
                    if (a.M.includes(g.adId)) {
                      if (a.h.ended) continue;
                      a.h.currentTime = h;
                      break a;
                    }
                    Vr(a);
                    a.L = e;
                    a.g = new Tr(g, f + 1, e.ads.length, true, a.h);
                    a.C = g;
                    0 === f && cs(a, "breakStart");
                    ds(a);
                    break;
                  }
                }
              }
              if (!a.g) for (d = t(a.j), e = d.next(); !e.done; e = d.next()) {
                e = e.value;
                if (a.g) break;
                for (f = 0; f < e.nonLinearAdsList.length; f++) if (g = e.nonLinearAdsList[f], g.nonLinearAdList.length) {
                  h = e.startTimeInSeconds;
                  var k2 = a.F.get($r(g.nonLinearAdList[0]));
                  if (h <= b && k2 && k2.length) {
                    Vr(a);
                    h = a;
                    k2 = t(k2);
                    for (var l = k2.next(); !l.done; l = k2.next()) if (l = l.value, l.data.source.length) {
                      var m = document.createElement("img");
                      m.src = l.data.source[0].url;
                      m.style.top = (l.placeholder.top || 0) + "%";
                      m.style.height = 100 - (l.placeholder.top || 0) + "%";
                      m.style.left = (l.placeholder.left || 0) + "%";
                      m.style.maxWidth = 100 - (l.placeholder.left || 0) + "%";
                      m.style.objectFit = "contain";
                      m.style.position = "absolute";
                      h.B.appendChild(m);
                    }
                    a.L = e;
                    a.g = new Tr(g, f + 1, e.ads.length, false, a.h);
                    a.C = g;
                    0 === f && cs(a, "breakStart");
                    ds(a);
                    break;
                  }
                }
              }
              c && !a.g && (b = a.h.currentTime, a.A && a.A > b && (a.h.currentTime = a.A), a.A = null);
            }
          }
        }
        function Vr(a) {
          if (a.g) {
            for (; a.B.lastChild; ) a.B.removeChild(a.B.firstChild);
            a.I || a.M.push(a.C.adId);
            var b = a.g.m;
            (void 0 === b ? 0 : b) ? cs(a, "skip") : cs(a, "complete");
            b = t(a.m);
            for (var c = b.next(); !c.done; c = b.next()) c = c.value, a.o.Ja(c.target, c.type, c.listener);
            a.m = [];
            a.u = [];
            b = a.g.getPositionInSequence();
            c = a.g.getSequenceLength();
            b === c && cs(a, "breakEnd");
            a.g = null;
            a.C = null;
            a.L = null;
          }
        }
        function ds(a) {
          var b = false;
          a.h.paused ? b = true : (cs(a, "impression"), cs(a, "start"));
          a.m.push({ target: a.h, type: "volumechange", listener: function() {
            a.h.muted && cs(a, "mute");
          } });
          a.m.push({ target: a.h, type: "volumechange", listener: function() {
            a.h.muted || cs(a, "unmute");
          } });
          a.m.push({ target: a.h, type: "play", listener: function() {
            b ? (cs(a, "impression"), cs(a, "start"), b = false) : cs(a, "resume");
          } });
          a.m.push({ target: a.h, type: "pause", listener: function() {
            cs(a, "pause");
          } });
          for (var c = t(a.m), d = c.next(); !d.done; d = c.next()) d = d.value, a.o.D(
            d.target,
            d.type,
            d.listener
          );
        }
        function cs(a, b) {
          var c = a.C.trackingEvents.find(function(f) {
            return f.eventType == b;
          });
          c || (c = a.L.adBreakTrackingEvents.find(function(f) {
            return f.eventType == b;
          }));
          if (c) {
            var d = { type: 10 };
            c = t(c.beaconUrls);
            for (var e = c.next(); !e.done; e = c.next()) (e = e.value) && "" != e && (e = lh([e], Sg()), e.method = "POST", a.K.request(7, e, d));
          }
          switch (b) {
            case "impression":
              a.i(new V("ad-impression"));
              break;
            case "start":
              a.i(new V("ad-started", (/* @__PURE__ */ new Map()).set("ad", a.g)));
              break;
            case "mute":
              a.i(new V("ad-muted"));
              break;
            case "unmute":
              a.i(new V("ad-volume-changed"));
              break;
            case "resume":
              a.i(new V("ad-resumed"));
              break;
            case "pause":
              a.i(new V("ad-paused"));
              break;
            case "firstQuartile":
              a.i(new V("ad-first-quartile"));
              break;
            case "midpoint":
              a.i(new V("ad-midpoint"));
              break;
            case "thirdQuartile":
              a.i(new V("ad-third-quartile"));
              break;
            case "complete":
              a.i(new V("ad-complete"));
              a.i(new V("ad-stopped"));
              break;
            case "skip":
              a.i(new V("ad-skipped"));
              a.i(new V("ad-stopped"));
              break;
            case "breakStart":
              a.B.setAttribute("ad-active", "true");
              break;
            case "breakEnd":
              a.B.removeAttribute("ad-active");
              break;
            case "skipStateChanged":
              a.i(new V("ad-skip-state-changed"));
          }
        }
        function es(a, b) {
          this.g = a;
          this.i = null;
          this.h = b;
        }
        r = es.prototype;
        r.needsSkipUI = function() {
          return true;
        };
        r.isClientRendering = function() {
          return false;
        };
        r.hasCustomClick = function() {
          return true;
        };
        r.isUsingAnotherMediaElement = function() {
          return false;
        };
        r.getDuration = function() {
          return this.i ? this.i.duration : -1;
        };
        r.getMinSuggestedDuration = function() {
          return this.getDuration();
        };
        r.getRemainingTime = function() {
          return this.i ? this.i.duration - this.i.currentTime : -1;
        };
        r.isPaused = function() {
          return this.h.paused;
        };
        r.isSkippable = function() {
          return this.g.isSkippable();
        };
        r.getTimeUntilSkippable = function() {
          var a = this.g.getSkipTimeOffset();
          a = this.getRemainingTime() - a;
          return Math.max(a, 0);
        };
        r.canSkipNow = function() {
          return 0 == this.getTimeUntilSkippable();
        };
        r.skip = function() {
          this.h.currentTime += this.getRemainingTime();
        };
        r.pause = function() {
          return this.h.pause();
        };
        r.play = function() {
          return this.h.play();
        };
        r.getVolume = function() {
          return this.h.volume;
        };
        r.setVolume = function(a) {
          this.h.volume = a;
        };
        r.isMuted = function() {
          return this.h.muted;
        };
        r.isLinear = function() {
          return true;
        };
        r.resize = function() {
        };
        r.setMuted = function(a) {
          this.h.muted = a;
        };
        r.getSequenceLength = function() {
          var a = this.g.getAdPodInfo();
          return null == a ? 1 : a.getTotalAds();
        };
        r.getPositionInSequence = function() {
          var a = this.g.getAdPodInfo();
          return null == a ? 1 : a.getAdPosition();
        };
        r.getTitle = function() {
          return this.g.getTitle();
        };
        r.getDescription = function() {
          return this.g.getDescription();
        };
        r.getVastMediaBitrate = function() {
          return 0;
        };
        r.getVastMediaHeight = function() {
          return this.g.getVastMediaHeight();
        };
        r.getVastMediaWidth = function() {
          return this.g.getVastMediaWidth();
        };
        r.getAdId = function() {
          return this.g.getAdId();
        };
        r.getCreativeAdId = function() {
          return this.g.getCreativeAdId();
        };
        r.getAdvertiserName = function() {
          return this.g.getAdvertiserName();
        };
        r.getMediaUrl = function() {
          return null;
        };
        r.getTimeOffset = function() {
          var a = this.g.getAdPodInfo();
          return null == a ? 0 : a.getTimeOffset();
        };
        r.getPodIndex = function() {
          var a = this.g.getAdPodInfo();
          return null == a ? 0 : a.getPodIndex();
        };
        r.release = function() {
          this.h = this.i = this.g = null;
        };
        T("shaka.ads.ServerSideAd", es);
        es.prototype.release = es.prototype.release;
        es.prototype.getPodIndex = es.prototype.getPodIndex;
        es.prototype.getTimeOffset = es.prototype.getTimeOffset;
        es.prototype.getMediaUrl = es.prototype.getMediaUrl;
        es.prototype.getAdvertiserName = es.prototype.getAdvertiserName;
        es.prototype.getCreativeAdId = es.prototype.getCreativeAdId;
        es.prototype.getAdId = es.prototype.getAdId;
        es.prototype.getVastMediaWidth = es.prototype.getVastMediaWidth;
        es.prototype.getVastMediaHeight = es.prototype.getVastMediaHeight;
        es.prototype.getVastMediaBitrate = es.prototype.getVastMediaBitrate;
        es.prototype.getDescription = es.prototype.getDescription;
        es.prototype.getTitle = es.prototype.getTitle;
        es.prototype.getPositionInSequence = es.prototype.getPositionInSequence;
        es.prototype.getSequenceLength = es.prototype.getSequenceLength;
        es.prototype.setMuted = es.prototype.setMuted;
        es.prototype.resize = es.prototype.resize;
        es.prototype.isLinear = es.prototype.isLinear;
        es.prototype.isMuted = es.prototype.isMuted;
        es.prototype.setVolume = es.prototype.setVolume;
        es.prototype.getVolume = es.prototype.getVolume;
        es.prototype.play = es.prototype.play;
        es.prototype.pause = es.prototype.pause;
        es.prototype.skip = es.prototype.skip;
        es.prototype.canSkipNow = es.prototype.canSkipNow;
        es.prototype.getTimeUntilSkippable = es.prototype.getTimeUntilSkippable;
        es.prototype.isSkippable = es.prototype.isSkippable;
        es.prototype.isPaused = es.prototype.isPaused;
        es.prototype.getRemainingTime = es.prototype.getRemainingTime;
        es.prototype.getMinSuggestedDuration = es.prototype.getMinSuggestedDuration;
        es.prototype.getDuration = es.prototype.getDuration;
        es.prototype.isUsingAnotherMediaElement = es.prototype.isUsingAnotherMediaElement;
        es.prototype.hasCustomClick = es.prototype.hasCustomClick;
        es.prototype.isClientRendering = es.prototype.isClientRendering;
        es.prototype.needsSkipUI = es.prototype.needsSkipUI;
        function fs(a, b, c, d) {
          var e = this;
          this.u = a;
          this.l = b;
          this.j = null;
          this.F = NaN;
          this.i = d;
          this.G = false;
          this.A = this.m = this.o = null;
          this.B = "";
          this.C = [];
          this.h = new lb();
          a = new google.ima.dai.api.UiSettings();
          a.setLocale(c);
          this.g = new google.ima.dai.api.StreamManager(this.l, this.u, a);
          this.i(new V("ima-stream-manager-loaded", (/* @__PURE__ */ new Map()).set("imaStreamManager", this.g)));
          this.h.D(this.g, google.ima.dai.api.StreamEvent.Type.LOADED, function(f) {
            gs(e, f);
          });
          this.h.D(this.g, google.ima.dai.api.StreamEvent.Type.ERROR, function() {
            e.B.length ? e.j.resolve(e.B) : e.j.reject("IMA Stream request returned an error and there was no backup asset uri provided.");
            e.j = null;
          });
          this.h.D(this.g, google.ima.dai.api.StreamEvent.Type.AD_BREAK_STARTED, function() {
          });
          this.h.D(this.g, google.ima.dai.api.StreamEvent.Type.STARTED, function(f) {
            f = f.getAd();
            e.m = new es(f, e.l);
            e.A && (e.m.i = e.A);
            e.i(new V("ad-started", (/* @__PURE__ */ new Map()).set("ad", e.m)));
            e.u.setAttribute("ad-active", "true");
          });
          this.h.D(this.g, google.ima.dai.api.StreamEvent.Type.AD_BREAK_ENDED, function() {
            e.u.removeAttribute("ad-active");
            var f = e.l.currentTime;
            e.o && e.o > f && (e.l.currentTime = e.o, e.o = null);
          });
          this.h.D(this.g, google.ima.dai.api.StreamEvent.Type.AD_PROGRESS, function(f) {
            e.A = f.getStreamData().adProgressData;
            e.m && (e.m.i = e.A);
          });
          this.h.D(this.g, google.ima.dai.api.StreamEvent.Type.FIRST_QUARTILE, function() {
            e.i(new V("ad-first-quartile"));
          });
          this.h.D(this.g, google.ima.dai.api.StreamEvent.Type.MIDPOINT, function() {
            e.i(new V("ad-midpoint"));
          });
          this.h.D(this.g, google.ima.dai.api.StreamEvent.Type.THIRD_QUARTILE, function() {
            e.i(new V("ad-third-quartile"));
          });
          this.h.D(this.g, google.ima.dai.api.StreamEvent.Type.COMPLETE, function() {
            e.i(new V("ad-complete"));
            e.i(new V("ad-stopped"));
            e.u.removeAttribute("ad-active");
            e.m = null;
          });
          this.h.D(this.g, google.ima.dai.api.StreamEvent.Type.SKIPPED, function() {
            e.i(new V("ad-skipped"));
            e.i(new V("ad-stopped"));
          });
          this.h.D(this.g, google.ima.dai.api.StreamEvent.Type.CUEPOINTS_CHANGED, function(f) {
            var g = f.getStreamData();
            f = [];
            g = t(g.cuepoints);
            for (var h = g.next(); !h.done; h = g.next()) h = h.value, f.push({ start: h.start, end: h.end });
            e.C = f;
            e.i(new V("ad-cue-points-changed", (/* @__PURE__ */ new Map()).set("cuepoints", f)));
          });
        }
        r = fs.prototype;
        r.configure = function() {
        };
        r.stop = function() {
          this.B = "";
          this.o = null;
          this.C = [];
        };
        r.release = function() {
          this.stop();
          this.h && this.h.release();
        };
        r.onCueMetadataChange = function(a) {
          if (a.key && a.data) {
            var b = {};
            b[a.key] = a.data;
            this.g.onTimedMetadata(b);
          }
        };
        r.getCuePoints = function() {
          return this.C;
        };
        function gs(a, b) {
          a.i(new V("ads-loaded", (/* @__PURE__ */ new Map()).set("loadTime", Date.now() / 1e3 - a.F)));
          b = b.getStreamData().url;
          a.j.resolve(b);
          a.j = null;
          a.G || a.h.D(a.l, "seeked", function() {
            var c = a.l.currentTime;
            if (0 != c) {
              a.g.streamTimeForContentTime(c);
              var d = a.g.previousCuePointForStreamTime(c);
              d && !d.played && (a.o = c, a.l.currentTime = d.start);
            }
          });
        }
        function Y() {
          dh.call(this);
          this.h = this.i = this.j = this.g = null;
          this.m = new kr();
          this.o = navigator.language;
          this.l = null;
        }
        qa(Y, dh);
        r = Y.prototype;
        r.setLocale = function(a) {
          this.o = a;
        };
        r.configure = function(a) {
          this.l = a;
          this.g && this.g.configure(this.l);
          this.j && this.j.configure(this.l);
          this.h && this.h.configure(this.l);
        };
        r.initInterstitial = function(a, b, c) {
          var d = this;
          this.g && this.g.release();
          this.g = new zr(a, b, c, function(e) {
            return hs(d, e);
          });
          this.g.configure(this.l);
        };
        r.initClientSide = function(a, b, c) {
          var d = this;
          if (!window2.google || !google.ima || !google.ima.AdsLoader) throw new U(2, 10, 1e4);
          this.j && this.j.release();
          this.j = new qr(a, b, this.o, c, function(e) {
            return hs(d, e);
          });
          this.j.configure(this.l);
        };
        r.release = function() {
          this.g && (this.g.release(), this.g = null);
          this.j && (this.j.release(), this.j = null);
          this.i && (this.i.release(), this.i = null);
          this.h && (this.h.release(), this.h = null);
          dh.prototype.release.call(this);
        };
        r.onAssetUnload = function() {
          this.g && this.g.stop();
          this.j && this.j.stop();
          this.i && this.i.stop();
          this.h && this.h.stop();
          this.dispatchEvent(new V("ad-stopped"));
          this.dispatchEvent(new V("ad-content-attach-requested"));
          this.m = new kr();
        };
        r.requestClientSideAds = function(a) {
          if (!this.j) throw new U(1, 10, 10001);
          var b = this.j;
          b.g && b.g.destroy();
          b.m && b.m.contentComplete();
          b.G = Date.now() / 1e3;
          b.m.requestAds(a);
        };
        r.updateClientSideAdsRenderingSettings = function(a) {
          if (!this.j) throw new U(1, 10, 10001);
          var b = this.j;
          b.B = a;
          b.g && b.g.updateAdsRenderingSettings(b.B);
        };
        r.initMediaTailor = function(a, b, c) {
          var d = this;
          this.i && this.i.release();
          this.i = new Ur(a, b, c, function(e) {
            return hs(d, e);
          });
        };
        r.requestMediaTailorStream = function(a, b, c) {
          if (!this.i) throw new U(1, 10, 10005);
          var d = this.i;
          c = void 0 === c ? "" : c;
          d.l ? a = Promise.reject(new U(1, 10, 10004)) : (d.l = new Ug(), Xr(d, a, b), d.H = c || "", d.P = Date.now() / 1e3, a = d.l);
          return a;
        };
        r.addMediaTailorTrackingUrl = function(a) {
          if (!this.i) throw new U(1, 10, 10005);
          var b = this.i;
          b.G = a;
          b.i(new V("ads-loaded", (/* @__PURE__ */ new Map()).set("loadTime", 0)));
        };
        r.initServerSide = function(a, b) {
          var c = this;
          if (!window2.google || !google.ima || !google.ima.dai) throw new U(2, 10, 10002);
          this.h && this.h.release();
          this.h = new fs(a, b, this.o, function(d) {
            return hs(c, d);
          });
          this.h.configure(this.l);
        };
        r.requestServerSideStream = function(a, b) {
          b = void 0 === b ? "" : b;
          if (!this.h) throw new U(1, 10, 10003);
          a.adTagParameters || (a.adTagParameters = {});
          var c = a.adTagParameters;
          (c.mpt || c.mpv) && bb('You have attempted to set "mpt" and/or "mpv" parameters of the ad tag. Please note that those parameters are used for Shaka adoption tracking and will be overridden.');
          a.adTagParameters.mpt = "shaka-player";
          a.adTagParameters.mpv = "v4.14.8";
          c = this.h;
          c.j ? a = Promise.reject(new U(1, 10, 10004)) : (a instanceof google.ima.dai.api.LiveStreamRequest && (c.G = true), c.j = new Ug(), c.g.requestStream(a), c.B = b || "", c.F = Date.now() / 1e3, a = c.j);
          return a;
        };
        r.replaceServerSideAdTagParameters = function(a) {
          if (!this.h) throw new U(1, 10, 10003);
          (a.mpt || a.mpv) && bb('You have attempted to set "mpt" and/or "mpv" parameters of the ad tag. Please note that those parameters are used for Shaka adoption tracking and will be overridden.');
          a.mpt = "Shaka Player";
          a.mpv = "v4.14.8";
          this.h.g.replaceAdTagParameters(a);
        };
        r.getServerSideCuePoints = function() {
          sb("AdManager.getServerSideCuePoints", "Please use getCuePoints function.");
          return this.getCuePoints();
        };
        r.getCuePoints = function() {
          var a = [];
          this.h && (a = a.concat(this.h.getCuePoints()));
          this.i && (a = a.concat(this.i.getCuePoints()));
          return a;
        };
        r.getStats = function() {
          var a = this.m;
          return { loadTimes: a.g, averageLoadTime: lr(a), started: a.h, overlayAds: a.j, playedCompletely: a.l, skipped: a.m, errors: a.i };
        };
        r.onManifestUpdated = function(a) {
          if (this.i) this.i.onManifestUpdated(a);
        };
        r.onDashTimedMetadata = function(a) {
          this.h && "urn:google:dai:2018" == a.schemeIdUri && this.h.g.processMetadata(a.schemeIdUri, a.eventNode ? a.eventNode.attributes.messageData : null, a.startTime);
        };
        r.onHlsTimedMetadata = function(a, b) {
          this.h && this.h.g.processMetadata("ID3", a.data, b);
        };
        r.onCueMetadataChange = function(a) {
          if (this.h) this.h.onCueMetadataChange(a);
        };
        r.onHLSInterstitialMetadata = function(a, b, c) {
          this.l && this.l.disableHLSInterstitial || (this.g || this.initInterstitial(null, a, b), this.g && Lr(this.g, c));
        };
        r.onDASHInterstitialMetadata = function(a, b, c) {
          if (!this.l || !this.l.disableDASHInterstitial) {
            var d = c.schemeIdUri;
            if ("urn:mpeg:dash:event:alternativeMPD:insert:2025" == d || "urn:mpeg:dash:event:alternativeMPD:replace:2025" == d) {
              if (this.g || this.initInterstitial(null, a, b), this.g && (a = this.g, b = "urn:mpeg:dash:event:alternativeMPD:replace:2025" == c.schemeIdUri, d = "urn:mpeg:dash:event:alternativeMPD:insert:2025" == c.schemeIdUri, b || d)) {
                for (var e = c.startTime, f = c.endTime, g = null, h = 0, k2, l = t(c.eventNode.children), m = l.next(); !m.done; m = l.next()) if (m = m.value, "AlternativeMPD" == m.tagName) {
                  if (m = m.attributes.uri) {
                    k2 = m;
                    break;
                  }
                } else if ("InsertPresentation" == m.tagName || "ReplacePresentation" == m.tagName) {
                  var n = m.attributes.url;
                  if (n) {
                    k2 = n;
                    (l = he(m, "maxDuration", ne)) && (g = l / c.timescale);
                    (l = he(m, "returnOffset", ne)) && (h = l / c.timescale);
                    b && h && (f = e + h);
                    break;
                  }
                }
                k2 && Nr(a, [{ id: c.id, groupId: null, startTime: e, endTime: f, uri: k2, mimeType: null, isSkippable: false, skipOffset: null, skipFor: null, canJump: true, resumeOffset: d ? h : null, playoutLimit: g, once: false, pre: false, post: false, timelineRange: b && !d, loop: false, overlay: null, displayOnBackground: false, currentVideo: null, background: null }]);
              }
            } else ("urn:mpeg:dash:event:2012" == d || "urn:scte:dash:scte214-events" == d) && c.eventNode && be(c.eventNode, "OverlayEvent") && (this.g || this.initInterstitial(null, a, b), this.g && Or(this.g, c));
          }
        };
        r.addCustomInterstitial = function(a) {
          if (!this.g) throw new U(1, 10, 10006);
          Nr(this.g, [a]);
        };
        r.addAdUrlInterstitial = function(a) {
          if (!this.g) throw new U(1, 10, 10006);
          return this.g.addAdUrlInterstitial(a);
        };
        r.getInterstitialPlayer = function() {
          if (!this.g) throw new U(1, 10, 10006);
          return this.g.If();
        };
        function hs(a, b) {
          if (b && b.type) switch (b.type) {
            case "ads-loaded":
              a.m.g.push(b.loadTime);
              break;
            case "ad-started":
              a.m.h++;
              var c = b.ad;
              c && !c.isLinear() && a.m.j++;
              break;
            case "ad-complete":
              a.m.l++;
              break;
            case "ad-skipped":
              a.m.m++;
              break;
            case "ad-error":
              a.m.i++;
          }
          a.dispatchEvent(b);
        }
        T("shaka.ads.AdManager", Y);
        Y.prototype.getInterstitialPlayer = Y.prototype.getInterstitialPlayer;
        Y.prototype.addAdUrlInterstitial = Y.prototype.addAdUrlInterstitial;
        Y.prototype.addCustomInterstitial = Y.prototype.addCustomInterstitial;
        Y.prototype.onDASHInterstitialMetadata = Y.prototype.onDASHInterstitialMetadata;
        Y.prototype.onHLSInterstitialMetadata = Y.prototype.onHLSInterstitialMetadata;
        Y.prototype.onCueMetadataChange = Y.prototype.onCueMetadataChange;
        Y.prototype.onHlsTimedMetadata = Y.prototype.onHlsTimedMetadata;
        Y.prototype.onDashTimedMetadata = Y.prototype.onDashTimedMetadata;
        Y.prototype.onManifestUpdated = Y.prototype.onManifestUpdated;
        Y.prototype.getStats = Y.prototype.getStats;
        Y.prototype.getCuePoints = Y.prototype.getCuePoints;
        Y.prototype.getServerSideCuePoints = Y.prototype.getServerSideCuePoints;
        Y.prototype.replaceServerSideAdTagParameters = Y.prototype.replaceServerSideAdTagParameters;
        Y.prototype.requestServerSideStream = Y.prototype.requestServerSideStream;
        Y.prototype.initServerSide = Y.prototype.initServerSide;
        Y.prototype.addMediaTailorTrackingUrl = Y.prototype.addMediaTailorTrackingUrl;
        Y.prototype.requestMediaTailorStream = Y.prototype.requestMediaTailorStream;
        Y.prototype.initMediaTailor = Y.prototype.initMediaTailor;
        Y.prototype.updateClientSideAdsRenderingSettings = Y.prototype.updateClientSideAdsRenderingSettings;
        Y.prototype.requestClientSideAds = Y.prototype.requestClientSideAds;
        Y.prototype.onAssetUnload = Y.prototype.onAssetUnload;
        Y.prototype.release = Y.prototype.release;
        Y.prototype.initClientSide = Y.prototype.initClientSide;
        Y.prototype.initInterstitial = Y.prototype.initInterstitial;
        Y.prototype.configure = Y.prototype.configure;
        Y.prototype.setLocale = Y.prototype.setLocale;
        Y.ADS_LOADED = "ads-loaded";
        Y.AD_STARTED = "ad-started";
        Y.AD_FIRST_QUARTILE = "ad-first-quartile";
        Y.AD_MIDPOINT = "ad-midpoint";
        Y.AD_THIRD_QUARTILE = "ad-third-quartile";
        Y.AD_COMPLETE = "ad-complete";
        Y.AD_STOPPED = "ad-stopped";
        Y.AD_SKIPPED = "ad-skipped";
        Y.AD_VOLUME_CHANGED = "ad-volume-changed";
        Y.AD_MUTED = "ad-muted";
        Y.AD_PAUSED = "ad-paused";
        Y.AD_RESUMED = "ad-resumed";
        Y.AD_SKIP_STATE_CHANGED = "ad-skip-state-changed";
        Y.CUEPOINTS_CHANGED = "ad-cue-points-changed";
        Y.IMA_AD_MANAGER_LOADED = "ima-ad-manager-loaded";
        Y.IMA_STREAM_MANAGER_LOADED = "ima-stream-manager-loaded";
        Y.AD_CLICKED = "ad-clicked";
        Y.AD_PROGRESS = "ad-progress";
        Y.AD_BUFFERING = "ad-buffering";
        Y.AD_IMPRESSION = "ad-impression";
        Y.AD_DURATION_CHANGED = "ad-duration-changed";
        Y.AD_CLOSED = "ad-closed";
        Y.AD_LOADED = "ad-loaded";
        Y.ALL_ADS_COMPLETED = "all-ads-completed";
        Y.AD_LINEAR_CHANGED = "ad-linear-changed";
        Y.AD_METADATA = "ad-metadata";
        Y.AD_RECOVERABLE_ERROR = "ad-recoverable-error";
        Y.AD_ERROR = "ad-error";
        Y.AD_BREAK_READY = "ad-break-ready";
        Y.AD_INTERACTION = "ad-interaction";
        Y.AD_CONTENT_PAUSE_REQUESTED = "ad-content-pause-requested";
        Y.AD_CONTENT_RESUME_REQUESTED = "ad-content-resume-requested";
        Y.AD_CONTENT_ATTACH_REQUESTED = "ad-content-attach-requested";
        Mp = function() {
          return new Y();
        };
        function is(a) {
          return JSON.stringify(a, function(b, c) {
            if ("function" != typeof c) {
              if (c instanceof Event || c instanceof V) {
                var d = {};
                for (e in c) (b = c[e]) && "object" == typeof b ? "detail" == e && (d[e] = b) : e in Event || (d[e] = b);
                return d;
              }
              if (c instanceof Error) {
                var e = /* @__PURE__ */ new Set(["name", "message", "stack"]);
                for (d in c) e.add(d);
                d = t(Object.getOwnPropertyNames(c));
                for (b = d.next(); !b.done; b = d.next()) e.add(b.value);
                d = {};
                e = t(e);
                for (b = e.next(); !b.done; b = e.next()) b = b.value, d[b] = c[b];
                c = { __type__: "Error", contents: d };
              } else if (c instanceof TimeRanges) {
                e = { __type__: "TimeRanges", length: c.length, start: [], end: [] };
                c = t(Vj(c));
                for (d = c.next(); !d.done; d = c.next()) d = d.value, b = d.end, e.start.push(d.start), e.end.push(b);
                c = e;
              } else c = ArrayBuffer.isView(c) && 1 === c.BYTES_PER_ELEMENT ? { __type__: "Uint8Array", entries: Array.from(c) } : "number" == typeof c ? isNaN(c) ? "NaN" : isFinite(c) ? c : 0 > c ? "-Infinity" : "Infinity" : c;
              return c;
            }
          });
        }
        function js(a) {
          return JSON.parse(a, function(b, c) {
            if ("NaN" == c) var d = NaN;
            else if ("-Infinity" == c) d = -Infinity;
            else if ("Infinity" == c) d = Infinity;
            else if (c && "object" == typeof c && "TimeRanges" == c.__type__) d = ks(c);
            else if (c && "object" == typeof c && "Uint8Array" == c.__type__) d = new Uint8Array(c.entries);
            else if (c && "object" == typeof c && "Error" == c.__type__) {
              b = c.contents;
              c = Error(b.message);
              for (d in b) c[d] = b[d];
              d = c;
            } else d = c;
            return d;
          });
        }
        function ks(a) {
          return { length: a.length, start: function(b) {
            return a.start[b];
          }, end: function(b) {
            return a.end[b];
          } };
        }
        var ls = "ended play playing pause pausing ratechange seeked seeking timeupdate volumechange".split(" "), ms = "buffered currentTime duration ended loop muted paused playbackRate seeking videoHeight videoWidth volume".split(" "), ns = ["loop", "playbackRate"], os = ["pause", "play"], ps = (/* @__PURE__ */ new Map()).set("getAssetUri", 2).set("getAudioLanguages", 4).set("getAudioLanguagesAndRoles", 4).set("getBufferFullness", 1).set("getBufferedInfo", 2).set("getExpiration", 2).set("getKeyStatuses", 2).set("getPlaybackRate", 2).set(
          "getTextLanguages",
          4
        ).set("getTextLanguagesAndRoles", 4).set("getImageTracks", 2).set("getThumbnails", 2).set("isAudioOnly", 10).set("isBuffering", 1).set("isInProgress", 1).set("isLive", 10).set("isTextTrackVisible", 1).set("keySystem", 10).set("seekRange", 1).set("getLoadMode", 10).set("getManifestType", 10).set("isFullyLoaded", 1).set("isEnded", 1), qs = (/* @__PURE__ */ new Map()).set("getConfiguration", 4).set("getConfigurationForLowLatency", 4).set("getStats", 5).set("getAudioTracks", 2).set("getTextTracks", 2).set("getVariantTracks", 2), rs = (/* @__PURE__ */ new Map()).set(
          "getPlayheadTimeAsDate",
          1
        ).set("getPresentationStartTimeAsDate", 20).set("getSegmentAvailabilityDuration", 20), ss = [["getConfiguration", "configure", "getConfigurationForLowLatency", "configurationForLowLatency"]], ts = [["isTextTrackVisible", "setTextTrackVisibility"]], us = "addChaptersTrack addTextTrackAsync addThumbnailsTrack cancelTrickPlay configure configurationForLowLatency getChapters getChaptersTracks resetConfiguration retryStreaming selectAudioLanguage selectAudioTrack selectTextLanguage selectTextTrack selectVariantTrack selectVariantsByLabel setTextTrackVisibility trickPlay updateStartTime goToLive".split(" "), vs = ["attach", "attachCanvas", "detach", "load", "unload"];
        function ws(a, b, c, d, e, f, g) {
          var h = this;
          this.G = a;
          this.K = g;
          this.l = new ec(b);
          this.L = c;
          this.u = false;
          this.A = d;
          this.F = e;
          this.M = f;
          this.i = this.m = false;
          this.I = "";
          this.o = null;
          this.B = function() {
            return xs(h);
          };
          this.C = function(k2, l) {
            k2 = js(l);
            switch (k2.type) {
              case "event":
                var m = k2.targetName, n = bh(k2.event);
                h.A(m, n);
                break;
              case "update":
                m = k2.update;
                for (n in m) {
                  k2 = h.g[n] || {};
                  for (var p in m[n]) k2[p] = m[n][p];
                }
                h.u && (h.L(), h.u = false);
                break;
              case "asyncComplete":
                if (n = k2.id, p = k2.error, k2 = h.h.get(n), h.h.delete(n), k2) if (p) {
                  n = new U(
                    p.severity,
                    p.category,
                    p.code
                  );
                  for (m in p) n[m] = p[m];
                  k2.reject(n);
                } else k2.resolve();
            }
          };
          this.g = { video: {}, player: {} };
          this.H = 0;
          this.h = /* @__PURE__ */ new Map();
          this.j = null;
          ys.add(this);
        }
        r = ws.prototype;
        r.destroy = function() {
          ys.delete(this);
          zs(this);
          As && Bs(this);
          this.l && (this.l.stop(), this.l = null);
          this.F = this.A = null;
          this.i = this.m = false;
          this.C = this.B = this.j = this.h = this.g = this.o = null;
          return Promise.resolve();
        };
        r.qb = function() {
          return this.i;
        };
        r.ag = function() {
          return this.I;
        };
        r.init = function() {
          if (this.G.length) if (window2.chrome && chrome.cast && chrome.cast.isAvailable) {
            this.m = true;
            this.l.sb();
            var a = new chrome.cast.SessionRequest(this.G, [], null, this.K, null);
            a = new chrome.cast.ApiConfig(a, function(b) {
              for (var c = t(ys), d = c.next(); !d.done; d = c.next()) {
                d = d.value;
                var e = b;
                d.j = new Ug();
                d.u = true;
                Cs(d, e);
              }
            }, function(b) {
              for (var c = t(ys), d = c.next(); !d.done; d = c.next()) d = d.value, Ds = "available" == b, d.l.sb();
            }, "origin_scoped");
            chrome.cast.initialize(a, function() {
            }, function() {
            });
            Ds && this.l.da(Es);
            (a = As) && a.status != chrome.cast.SessionStatus.STOPPED ? (this.j = new Ug(), this.u = true, Cs(this, a)) : As = null;
          } else window2.__onGCastApiAvailable !== Fs && (Gs = window2.__onGCastApiAvailable || null, window2.__onGCastApiAvailable = Fs);
        };
        r.ig = function(a) {
          this.o = a;
          this.i && Hs(this, { type: "appData", appData: this.o });
        };
        r.cast = function() {
          var a = this;
          return Q(function(b) {
            if (!a.m) throw new U(1, 8, 8e3);
            if (!Ds) throw new U(1, 8, 8001);
            if (a.i) throw new U(1, 8, 8002);
            a.j = new Ug();
            chrome.cast.requestSession(function(c) {
              return Cs(a, c);
            }, function(c) {
              return Is(a, c);
            });
            return F(b, a.j, 0);
          });
        };
        function Js(a) {
          a.i && chrome.cast.requestSession(function(b) {
            return Cs(a, b);
          }, function(b) {
            return Is(a, b);
          });
        }
        r.Pc = function() {
          if (this.i) {
            zs(this);
            if (As) {
              Bs(this);
              try {
                As.stop(function() {
                }, function() {
                });
              } catch (a) {
              }
              As = null;
            }
            xs(this);
          }
        };
        r.get = function(a, b) {
          var c = this;
          if ("video" == a) {
            if (os.includes(b)) return function() {
              return c.oh.apply(c, [a, b].concat(y(Na.apply(0, arguments))));
            };
          } else if ("player" == a) {
            if (rs.has(b) && !this.get("player", "isLive")()) return function() {
            };
            if (us.includes(b)) return function() {
              return c.oh.apply(c, [a, b].concat(y(Na.apply(0, arguments))));
            };
            if (vs.includes(b)) return function() {
              return c.pj.apply(c, [a, b].concat(y(Na.apply(0, arguments))));
            };
            if (ps.has(b) || qs.has(b)) return function() {
              return c.g[a][b];
            };
          }
          return this.g[a][b];
        };
        r.set = function(a, b, c) {
          this.g[a][b] = c;
          Hs(this, { type: "set", targetName: a, property: b, value: c });
        };
        function Cs(a, b) {
          var c = a.M();
          As = b;
          b.addUpdateListener(a.B);
          b.addMessageListener("urn:x-cast:com.google.shaka.v2", a.C);
          xs(a);
          Hs(a, { type: "init", initState: c, appData: a.o });
          a.j.resolve();
        }
        function Is(a, b) {
          var c = 8003;
          switch (b.code) {
            case "cancel":
              c = 8004;
              break;
            case "timeout":
              c = 8005;
              break;
            case "receiver_unavailable":
              c = 8006;
          }
          a.j.reject(new U(2, 8, c, b));
        }
        r.oh = function(a, b) {
          Hs(this, { type: "call", targetName: a, methodName: b, args: Na.apply(2, arguments) });
        };
        r.pj = function(a, b) {
          var c = Na.apply(2, arguments), d = new Ug(), e = this.H.toString();
          this.H++;
          this.h.set(e, d);
          try {
            Hs(this, { type: "asyncCall", targetName: a, methodName: b, args: c, id: e });
          } catch (f) {
            d.reject(f);
          }
          return d;
        };
        function Bs(a) {
          var b = As;
          b.removeUpdateListener(a.B);
          b.removeMessageListener("urn:x-cast:com.google.shaka.v2", a.C);
        }
        function xs(a) {
          var b = As ? "connected" == As.status : false;
          if (a.i && !b) {
            a.F();
            for (var c in a.g) a.g[c] = {};
            zs(a);
          }
          a.i = b;
          a.I = b ? As.receiver.friendlyName : "";
          a.l.sb();
        }
        function zs(a) {
          if (a.h) for (var b = t(a.h.keys()), c = b.next(); !c.done; c = b.next()) {
            c = c.value;
            var d = a.h.get(c);
            a.h.delete(c);
            d.reject(new U(1, 7, 7e3));
          }
        }
        function Hs(a, b) {
          b = is(b);
          var c = As;
          try {
            c.sendMessage("urn:x-cast:com.google.shaka.v2", b, function() {
            }, gb);
          } catch (d) {
            throw b = new U(2, 8, 8005, d), c = new V("error", (/* @__PURE__ */ new Map()).set("detail", b)), a.A("player", c), a.Pc(), b;
          }
        }
        var Es = 0.02, Ds = false, As = null, Gs = null, ys = /* @__PURE__ */ new Set();
        function Fs(a) {
          Gs ? window2.__onGCastApiAvailable = Gs : delete window2.__onGCastApiAvailable;
          Gs = null;
          if (a) for (var b = t(ys), c = b.next(); !c.done; c = b.next()) c.value.init();
          "function" === typeof window2.__onGCastApiAvailable && window2.__onGCastApiAvailable(a);
        }
        function Ks(a, b, c, d) {
          d = void 0 === d ? false : d;
          dh.call(this);
          var e = this;
          this.i = a;
          this.h = b;
          this.m = this.o = this.l = this.u = this.j = null;
          this.C = c;
          this.B = d;
          this.A = /* @__PURE__ */ new Map();
          this.g = null;
          window2.chrome ? (this.g = new ws(c, function() {
            return Ls(e);
          }, function() {
            return Ms(e);
          }, function(f, g) {
            return Ns(e, f, g);
          }, function() {
            return Os(e);
          }, function() {
            return Ps(e);
          }, d), Qs(this)) : (this.j = this.i, this.u = this.h);
        }
        qa(Ks, dh);
        r = Ks.prototype;
        r.destroy = function(a) {
          this.g && a && this.g.Pc();
          this.m && (this.m.release(), this.m = null);
          a = [];
          this.h && (a.push(this.h.destroy()), this.h = null);
          this.g && (a.push(this.g.destroy()), this.g = null);
          this.u = this.j = this.i = null;
          dh.prototype.release.call(this);
          return Promise.all(a);
        };
        r.Li = function() {
          return this.j;
        };
        r.If = function() {
          return this.u;
        };
        r.Xh = function() {
          return this.g ? this.g.m && Ds : false;
        };
        r.qb = function() {
          return this.g ? this.g.qb() : false;
        };
        r.ag = function() {
          return this.g ? this.g.ag() : "";
        };
        r.cast = function() {
          var a = this;
          return Q(function(b) {
            return 1 == b.g ? a.g ? F(b, a.g.cast(), 2) : b.return() : a.h ? F(b, a.h.kc(), 0) : b.return();
          });
        };
        r.ig = function(a) {
          this.g && this.g.ig(a);
        };
        r.Ej = function() {
          this.g && Js(this.g);
        };
        r.Pc = function() {
          this.g && this.g.Pc();
        };
        r.Yh = function(a, b) {
          b = void 0 === b ? false : b;
          var c = this;
          return Q(function(d) {
            if (1 == d.g) {
              if (a == c.C && b == c.B) return d.return();
              c.C = a;
              c.B = b;
              if (!c.g) return d.return();
              c.g.Pc();
              return F(d, c.g.destroy(), 2);
            }
            c.g = null;
            c.g = new ws(a, function() {
              return Ls(c);
            }, function() {
              return Ms(c);
            }, function(e, f) {
              return Ns(c, e, f);
            }, function() {
              return Os(c);
            }, function() {
              return Ps(c);
            }, b);
            c.g.init();
            I(d);
          });
        };
        function Qs(a) {
          a.g.init();
          a.m = new lb();
          for (var b = t(ls), c = b.next(); !c.done; c = b.next()) a.m.D(a.i, c.value, function(f) {
            a.g.qb() || (f = bh(f), a.l.dispatchEvent(f));
          });
          for (var d in ch) a.m.D(a.h, ch[d], function(f) {
            a.g.qb() || a.o.dispatchEvent(f);
          });
          a.j = {};
          b = {};
          for (var e in a.i) b = { wd: b.wd }, b.wd = e, Object.defineProperty(a.j, b.wd, { configurable: false, enumerable: true, get: /* @__PURE__ */ function(f) {
            return function() {
              return Rs(a, f.wd);
            };
          }(b), set: /* @__PURE__ */ function(f) {
            return function(g) {
              var h = f.wd;
              a.g.qb() ? a.g.set("video", h, g) : a.i[h] = g;
            };
          }(b) });
          a.u = {};
          Ss(
            a,
            function(f) {
              Object.defineProperty(a.u, f, { configurable: false, enumerable: true, get: function() {
                return Ts(a, f);
              } });
            }
          );
          Us(a);
          a.l = new dh();
          a.l.Ge = a.j;
          a.o = new dh();
          a.o.Ge = a.u;
        }
        function Us(a) {
          var b = /* @__PURE__ */ new Map();
          Ss(a, function(c, d) {
            b.has(d) ? (d = b.get(d), c.length < d.length ? a.A.set(c, d) : a.A.set(d, c)) : b.set(d, c);
          });
        }
        function Ss(a, b) {
          function c(k2) {
            return "constructor" == k2 || "function" != typeof d[k2] ? false : !e.has(k2);
          }
          var d = a.h, e = /* @__PURE__ */ new Set(), f;
          for (f in d) c(f) && (e.add(f), b(f, d[f]));
          a = Object.getPrototypeOf(d);
          for (f = Object.getPrototypeOf({}); a && a != f; ) {
            for (var g = t(Object.getOwnPropertyNames(a)), h = g.next(); !h.done; h = g.next()) h = h.value, c(h) && (e.add(h), b(h, d[h]));
            a = Object.getPrototypeOf(a);
          }
        }
        function Ps(a) {
          var b = { video: {}, player: {}, playerAfterLoad: {}, manifest: a.h.Qc(), startTime: null };
          a.i.pause();
          for (var c = t(ns), d = c.next(); !d.done; d = c.next()) d = d.value, b.video[d] = a.i[d];
          a.i.ended || (b.startTime = a.i.currentTime);
          c = t(ss);
          for (d = c.next(); !d.done; d = c.next()) {
            var e = d.value;
            d = e[1];
            e = a.h[e[0]]();
            b.player[d] = e;
          }
          c = t(ts);
          for (d = c.next(); !d.done; d = c.next()) e = d.value, d = e[1], e = a.h[e[0]](), b.playerAfterLoad[d] = e;
          return b;
        }
        function Ls(a) {
          var b = new V("caststatuschanged");
          a.dispatchEvent(b);
        }
        function Ms(a) {
          var b = new V(a.j.paused ? "pause" : "play");
          a.l.dispatchEvent(b);
        }
        function Os(a) {
          for (var b = t(ss), c = b.next(); !c.done; c = b.next()) {
            var d = c.value;
            c = d[1];
            d = a.g.get("player", d[0])();
            a.h[c](d);
          }
          var e = a.g.get("player", "getAssetUri")();
          d = a.g.get("video", "ended");
          b = Promise.resolve();
          var f = a.i.autoplay;
          c = null;
          d || (c = a.g.get("video", "currentTime"));
          var g;
          (d = a.g.get("player", "getTextTracks")()) && d.length && (g = d.find(function(l) {
            return l.active;
          }));
          var h = a.g.get("player", "isTextTrackVisible")();
          e && (a.i.autoplay = false, b = a.h.load(e, c));
          var k2 = {};
          c = t(ns);
          for (d = c.next(); !d.done; d = c.next()) d = d.value, k2[d] = a.g.get("video", d);
          b.then(function() {
            if (a.i) {
              for (var l = t(ns), m = l.next(); !m.done; m = l.next()) m = m.value, a.i[m] = k2[m];
              l = t(ts);
              for (m = l.next(); !m.done; m = l.next()) {
                var n = m.value;
                m = n[1];
                n = a.g.get("player", n[0])();
                a.h[m](n);
              }
              a.h.zh(h);
              g && a.h.hg(g.language, g.roles, g.forced);
              a.i.autoplay = f;
              e && a.i.play();
            }
          }, function(l) {
            l = (/* @__PURE__ */ new Map()).set("detail", l);
            l = new V("error", l);
            a.h.dispatchEvent(l);
          });
        }
        function Rs(a, b) {
          if ("addEventListener" == b) return function(d, e, f) {
            return a.l.addEventListener(d, e, f);
          };
          if ("removeEventListener" == b) return function(d, e, f) {
            return a.l.removeEventListener(d, e, f);
          };
          if (a.g.qb() && 0 == Object.keys(a.g.g.video).length) {
            var c = a.i[b];
            if ("function" != typeof c) return c;
          }
          return a.g.qb() ? a.g.get("video", b) : (b = a.i[b], "function" == typeof b && (b = b.bind(a.i)), b);
        }
        function Ts(a, b) {
          a.A.has(b) && (b = a.A.get(b));
          if ("addEventListener" == b) return function(c, d, e) {
            return a.o.addEventListener(c, d, e);
          };
          if ("removeEventListener" == b) return function(c, d, e) {
            return a.o.removeEventListener(c, d, e);
          };
          if ("getMediaElement" == b) return function() {
            return a.j;
          };
          if ("getSharedConfiguration" == b) return a.g.get("player", "getConfiguration");
          if ("getNetworkingEngine" == b) return function() {
            return a.h.xb();
          };
          if ("getDrmEngine" == b) return function() {
            return a.h.C;
          };
          if ("getAdManager" == b) return function() {
            return a.h.Pg();
          };
          if ("setVideoContainer" == b) return function(c) {
            return a.h.Ch(c);
          };
          if (a.g.qb()) {
            if ("getManifest" == b || "drmInfo" == b) return function() {
              bb(b + "() does not work while casting!");
              return null;
            };
            if ("attach" == b || "detach" == b) return function() {
              bb(b + "() does not work while casting!");
              return Promise.resolve();
            };
          }
          return a.g.qb() && 0 == Object.keys(a.g.g.video).length && (ps.has(b) || qs.has(b)) || !a.g.qb() ? a.h[b].bind(a.h) : a.g.get("player", b);
        }
        function Ns(a, b, c) {
          a.g.qb() && ("video" == b ? a.l.dispatchEvent(c) : "player" == b && a.o.dispatchEvent(c));
        }
        T("shaka.cast.CastProxy", Ks);
        Ks.prototype.changeReceiverId = Ks.prototype.Yh;
        Ks.prototype.forceDisconnect = Ks.prototype.Pc;
        Ks.prototype.suggestDisconnect = Ks.prototype.Ej;
        Ks.prototype.setAppData = Ks.prototype.ig;
        Ks.prototype.cast = Ks.prototype.cast;
        Ks.prototype.receiverName = Ks.prototype.ag;
        Ks.prototype.isCasting = Ks.prototype.qb;
        Ks.prototype.canCast = Ks.prototype.Xh;
        Ks.prototype.getPlayer = Ks.prototype.If;
        Ks.prototype.getVideo = Ks.prototype.Li;
        Ks.prototype.destroy = Ks.prototype.destroy;
        function Vs(a, b, c, d) {
          dh.call(this);
          var e = this;
          this.g = a;
          this.h = b;
          this.j = new lb();
          this.H = { video: a, player: b };
          this.F = c || function() {
          };
          this.I = d || function(f) {
            return f;
          };
          this.i = null;
          this.G = false;
          this.o = true;
          this.m = 0;
          this.B = false;
          this.A = true;
          this.u = this.l = null;
          this.C = new ec(function() {
            Ws(e);
          });
          Xs(this);
        }
        qa(Vs, dh);
        r = Vs.prototype;
        r.isConnected = function() {
          return this.G;
        };
        r.Si = function() {
          return this.o;
        };
        r.Bj = function(a) {
          this.i = a;
        };
        r.bi = function() {
          this.i = null;
        };
        r.Cj = function(a) {
          this.i || (this.i = { metadataType: cast.receiver.media.MetadataType.GENERIC });
          this.i.title = a;
        };
        r.Aj = function(a) {
          this.i || (this.i = { metadataType: cast.receiver.media.MetadataType.GENERIC });
          this.i.images = [{ url: a }];
        };
        r.zj = function(a) {
          this.i || (this.i = {});
          this.i.artist = a;
          this.i.metadataType = cast.receiver.media.MetadataType.MUSIC_TRACK;
        };
        r.destroy = function() {
          var a = this, b, c;
          return Q(function(d) {
            if (1 == d.g) return a.j && (a.j.release(), a.j = null), b = [], a.h && (b.push(a.h.destroy()), a.h = null), a.C && (a.C.stop(), a.C = null), a.g = null, a.H = null, a.F = null, a.G = false, a.o = true, a.l = null, a.u = null, dh.prototype.release.call(a), F(d, Promise.all(b), 2);
            c = cast.receiver.CastReceiverManager.getInstance();
            c.stop();
            I(d);
          });
        };
        function Xs(a) {
          var b = cast.receiver.CastReceiverManager.getInstance();
          b.onSenderConnected = function() {
            return Ys(a);
          };
          b.onSenderDisconnected = function() {
            return Ys(a);
          };
          b.onSystemVolumeChanged = function() {
            var e = cast.receiver.CastReceiverManager.getInstance().getSystemVolume();
            e && Zs(a, { type: "update", update: { video: { volume: e.level, muted: e.muted } } }, a.l);
            Zs(a, { type: "event", targetName: "video", event: { type: "volumechange" } }, a.l);
          };
          a.u = b.getCastMessageBus("urn:x-cast:com.google.cast.media");
          a.u.onMessage = function(e) {
            return $s(
              a,
              e
            );
          };
          a.l = b.getCastMessageBus("urn:x-cast:com.google.shaka.v2");
          a.l.onMessage = function(e) {
            return at(a, e);
          };
          b.start();
          b = t(ls);
          for (var c = b.next(); !c.done; c = b.next()) a.j.D(a.g, c.value, function(e) {
            return bt(a, "video", e);
          });
          for (var d in ch) a.j.D(a.h, ch[d], function(e) {
            return bt(a, "player", e);
          });
          a.j.D(a.g, "loadeddata", function() {
            a.B = true;
          });
          a.j.D(a.h, "loading", function() {
            a.o = false;
            ct(a);
          });
          a.j.D(a.g, "playing", function() {
            a.o = false;
            ct(a);
          });
          a.j.D(a.g, "pause", function() {
            ct(a);
          });
          a.j.D(a.h, "unloading", function() {
            a.o = true;
            ct(a);
          });
          a.j.D(a.g, "ended", function() {
            new ec(function() {
              a.g && a.g.ended && (a.o = true, ct(a));
            }).da(dt);
          });
        }
        function Ys(a) {
          a.m = 0;
          a.A = true;
          a.G = 0 != cast.receiver.CastReceiverManager.getInstance().getSenders().length;
          ct(a);
        }
        function ct(a) {
          var b;
          Q(function(c) {
            if (1 == c.g) return F(c, Promise.resolve(), 2);
            if (!a.h) return c.return();
            b = new V("caststatuschanged");
            a.dispatchEvent(b);
            et(a) || ft(a);
            I(c);
          });
        }
        function gt(a, b, c) {
          var d, e, f, g, h, k2, l, m, n, p;
          Q(function(q) {
            switch (q.g) {
              case 1:
                for (d in b.player) e = b.player[d], a.h[d](e);
                a.F(c);
                f = a.g.autoplay;
                return b.manifest ? (a.g.autoplay = false, xa(q, 5), F(q, a.h.load(b.manifest, b.startTime), 7)) : F(q, Promise.resolve(), 3);
              case 7:
                Aa(q, 3);
                break;
              case 5:
                return g = Ba(q), h = (/* @__PURE__ */ new Map()).set("detail", g), k2 = new V("error", h), a.h && a.h.dispatchEvent(k2), q.return();
              case 3:
                if (!a.h) return q.return();
                for (l in b.video) m = b.video[l], a.g[l] = m;
                for (n in b.playerAfterLoad) p = b.playerAfterLoad[n], a.h[n](p);
                a.g.autoplay = f;
                b.manifest && (a.g.play(), ft(a));
                I(q);
            }
          });
        }
        function bt(a, b, c) {
          a.h && (Ws(a), Zs(a, { type: "event", targetName: b, event: c }, a.l));
        }
        function Ws(a) {
          a.C.da(ht);
          for (var b = { video: {}, player: {} }, c = t(ms), d = c.next(); !d.done; d = c.next()) d = d.value, b.video[d] = a.g[d];
          a.h.U() && rs.forEach(function(e, f) {
            0 == a.m % e && (b.player[f] = a.h[f]());
          });
          ps.forEach(function(e, f) {
            0 == a.m % e && (b.player[f] = a.h[f]());
          });
          if (c = cast.receiver.CastReceiverManager.getInstance().getSystemVolume()) b.video.volume = c.level, b.video.muted = c.muted;
          Zs(a, { type: "update", update: b }, a.l);
          qs.forEach(function(e, f) {
            0 == a.m % e && (e = { player: {} }, e.player[f] = a.h[f](), Zs(
              a,
              { type: "update", update: e },
              a.l
            ));
          });
          a.B && (a.m += 1);
          et(a);
        }
        function et(a) {
          return a.A && (a.g.duration || a.h.U()) ? (it(a), a.A = false, true) : false;
        }
        function it(a, b) {
          var c = { contentId: a.h.Qc(), streamType: a.h.U() ? "LIVE" : "BUFFERED", contentType: "" };
          a.h.U() || (c.duration = a.g.duration);
          a.i && (c.metadata = a.i);
          ft(a, void 0 === b ? 0 : b, c);
        }
        function at(a, b) {
          var c = js(b.data);
          switch (c.type) {
            case "init":
              a.m = 0;
              a.B = false;
              a.A = true;
              gt(a, c.initState, c.appData);
              Ws(a);
              break;
            case "appData":
              a.F(c.appData);
              break;
            case "set":
              var d = c.targetName, e = c.property;
              c = c.value;
              if ("video" == d) {
                if (b = cast.receiver.CastReceiverManager.getInstance(), "volume" == e) {
                  b.setSystemVolumeLevel(c);
                  break;
                } else if ("muted" == e) {
                  b.setSystemVolumeMuted(c);
                  break;
                }
              }
              a.H[d][e] = c;
              break;
            case "call":
              d = a.H[c.targetName];
              d[c.methodName].apply(d, c.args);
              break;
            case "asyncCall":
              d = c.targetName;
              e = c.methodName;
              "player" == d && "load" == e && (a.m = 0, a.B = false);
              var f = c.id, g = b.senderId;
              b = a.H[d];
              c = b[e].apply(b, c.args);
              "player" == d && "load" == e && (c = c.then(function() {
                a.A = true;
              }));
              c.then(function() {
                return jt(a, g, f, null);
              }, function(h) {
                return jt(a, g, f, h);
              });
          }
        }
        function $s(a, b) {
          var c = js(b.data);
          switch (c.type) {
            case "PLAY":
              a.g.play();
              ft(a);
              break;
            case "PAUSE":
              a.g.pause();
              ft(a);
              break;
            case "SEEK":
              b = c.currentTime;
              var d = c.resumeState;
              null != b && (a.g.currentTime = Number(b));
              d && "PLAYBACK_START" == d ? (a.g.play(), ft(a)) : d && "PLAYBACK_PAUSE" == d && (a.g.pause(), ft(a));
              break;
            case "STOP":
              a.h.kc().then(function() {
                a.h && ft(a);
              });
              break;
            case "GET_STATUS":
              it(a, Number(c.requestId));
              break;
            case "VOLUME":
              d = c.volume;
              b = d.level;
              d = d.muted;
              var e = a.g.volume, f = a.g.muted;
              null != b && (a.g.volume = Number(b));
              null != d && (a.g.muted = d);
              e == a.g.volume && f == a.g.muted || ft(a);
              break;
            case "LOAD":
              a.m = 0;
              a.B = false;
              a.A = false;
              b = c.media;
              d = c.currentTime;
              e = a.I(b.contentId);
              f = c.autoplay || true;
              a.F(b.customData);
              f && (a.g.autoplay = true);
              a.h.load(e, d).then(function() {
                a.h && it(a);
              }).catch(function(g) {
                var h = "LOAD_FAILED";
                7 == g.category && 7e3 == g.code && (h = "LOAD_CANCELLED");
                Zs(a, { requestId: Number(c.requestId), type: h }, a.u);
              });
              break;
            default:
              Zs(a, { requestId: Number(c.requestId), type: "INVALID_REQUEST", reason: "INVALID_COMMAND" }, a.u);
          }
        }
        function jt(a, b, c, d) {
          a.h && Zs(a, { type: "asyncComplete", id: c, error: d }, a.l, b);
        }
        function Zs(a, b, c, d) {
          a.G && (a = is(b), d ? c.getCastChannel(d).send(a) : c.broadcast(a));
        }
        function ft(a, b, c) {
          c = void 0 === c ? null : c;
          var d = { mediaSessionId: 0, playbackRate: a.g.playbackRate, playerState: a.o ? kt : a.h.Of() ? lt : a.g.paused ? mt : nt, currentTime: a.g.currentTime, supportedMediaCommands: 63, volume: { level: a.g.volume, muted: a.g.muted } };
          c && (d.media = c);
          Zs(a, { requestId: void 0 === b ? 0 : b, type: "MEDIA_STATUS", status: [d] }, a.u);
        }
        T("shaka.cast.CastReceiver", Vs);
        Vs.prototype.destroy = Vs.prototype.destroy;
        Vs.prototype.setContentArtist = Vs.prototype.zj;
        Vs.prototype.setContentImage = Vs.prototype.Aj;
        Vs.prototype.setContentTitle = Vs.prototype.Cj;
        Vs.prototype.clearContentMetadata = Vs.prototype.bi;
        Vs.prototype.setContentMetadata = Vs.prototype.Bj;
        Vs.prototype.isIdle = Vs.prototype.Si;
        Vs.prototype.isConnected = Vs.prototype.isConnected;
        var ht = 0.5, dt = 5, kt = "IDLE", nt = "PLAYING", lt = "BUFFERING", mt = "PAUSED";
        function ot(a, b, c, d, e) {
          if (d >= e) return null;
          for (var f = -1, g = -1, h = 0; h < c.length; h++) if (c[h].some(function(D) {
            return null != D && "" != D.g.trim();
          })) {
            f = h;
            break;
          }
          for (h = c.length - 1; 0 <= h; h--) if (c[h].some(function(D) {
            return null != D && "" != D.g.trim();
          })) {
            g = h;
            break;
          }
          if (-1 === f || -1 === g) return null;
          for (var k2 = h = false, l = "white", m = "black", n = pt(d, e, h, k2, l, m); f <= g; f++) {
            for (var p = c[f], q = -1, u = -1, w = 0; w < p.length; w++) if (null != p[w] && "" !== p[w].g.trim()) {
              q = w;
              break;
            }
            for (w = p.length - 1; 0 <= w; w--) if (null != p[w] && "" !== p[w].g.trim()) {
              u = w;
              break;
            }
            if (-1 === q || -1 === u) p = qt(d, e), a.nestedCues.push(p);
            else {
              for (; q <= u; q++) if (w = p[q]) {
                var v = w.l, x = w.i, z = w.j, C = w.h;
                if (v != h || x != k2 || z != l || C != m) n.payload && a.nestedCues.push(n), n = pt(d, e, v, x, z, C), h = v, k2 = x, l = z, m = C;
                n.payload += w.g;
              } else n.payload += " ";
              n.payload && a.nestedCues.push(n);
              f !== g && (n = qt(d, e), a.nestedCues.push(n));
              n = pt(d, e, h, k2, l, m);
            }
          }
          return a.nestedCues.length ? { cue: a, stream: b } : null;
        }
        function pt(a, b, c, d, e, f) {
          a = new Ae(a, b, "");
          c && a.textDecoration.push(Xe);
          d && (a.fontStyle = We);
          a.color = e;
          a.backgroundColor = f;
          return a;
        }
        function qt(a, b) {
          a = new Ae(a, b, "");
          a.lineBreak = true;
          return a;
        }
        function rt(a, b, c, d, e) {
          this.g = a;
          this.l = b;
          this.i = c;
          this.h = d;
          this.j = e;
        }
        function st(a, b) {
          this.i = [];
          this.g = 1;
          this.h = 0;
          this.C = a;
          this.B = b;
          this.j = this.m = false;
          this.l = "white";
          this.o = "black";
          this.u = this.A = null;
          tt(this);
        }
        function ut(a, b, c) {
          var d = "CC" + ((a.C << 1 | a.B) + 1), e = new Ae(b, c, "");
          e.lineInterpretation = 1;
          var f = vt.get(a.g);
          f && (e.line = f);
          null != a.u && null != a.A && (e.position = 10 + Math.min(70, 10 * a.u) + 2.5 * a.A);
          (b = ot(e, d, a.i, b, c)) && 15 < a.g + b.cue.nestedCues.length - 3 && (f = vt.get(a.g + 3 - b.cue.nestedCues.length)) && (e.line = f);
          return b;
        }
        function tt(a) {
          wt(a, 0, 15);
          a.g = 1;
        }
        function xt(a, b, c) {
          if (!(32 > c || 127 < c)) {
            var d = "";
            switch (b) {
              case 0:
                d = yt.has(c) ? yt.get(c) : String.fromCharCode(c);
                break;
              case 1:
                d = zt.get(c);
                break;
              case 2:
                a.i[a.g].pop();
                d = At.get(c);
                break;
              case 3:
                a.i[a.g].pop(), d = Bt.get(c);
            }
            d && a.i[a.g].push(new rt(d, a.m, a.j, a.o, a.l));
          }
        }
        function Ct(a, b, c, d) {
          if (!(0 > c || 0 > b)) if (b >= c) for (--d; 0 <= d; d--) a.i[b + d] = a.i[c + d].map(function(f) {
            return f;
          });
          else for (var e = 0; e < d; e++) a.i[b + e] = a.i[c + e].map(function(f) {
            return f;
          });
        }
        function wt(a, b, c) {
          for (var d = 0; d <= c; d++) a.i[b + d] = [];
        }
        var yt = /* @__PURE__ */ new Map([[39, "’"], [42, "á"], [92, "é"], [92, "é"], [94, "í"], [95, "ó"], [96, "ú"], [123, "ç"], [124, "÷"], [125, "Ñ"], [126, "ñ"], [127, "█"]]), zt = /* @__PURE__ */ new Map([[48, "®"], [49, "°"], [50, "½"], [51, "¿"], [52, "™"], [53, "¢"], [54, "£"], [55, "♪"], [56, "à"], [57, " "], [58, "è"], [59, "â"], [60, "ê"], [61, "î"], [62, "ô"], [63, "û"]]), At = /* @__PURE__ */ new Map([
          [32, "Á"],
          [33, "É"],
          [34, "Ó"],
          [35, "Ú"],
          [36, "Ü"],
          [37, "ü"],
          [38, "‘"],
          [39, "¡"],
          [40, "*"],
          [41, "'"],
          [42, "─"],
          [43, "©"],
          [44, "℠"],
          [45, "·"],
          [46, "“"],
          [47, "”"],
          [48, "À"],
          [49, "Â"],
          [50, "Ç"],
          [51, "È"],
          [52, "Ê"],
          [53, "Ë"],
          [54, "ë"],
          [55, "Î"],
          [56, "Ï"],
          [57, "ï"],
          [58, "Ô"],
          [59, "Ù"],
          [60, "ù"],
          [61, "Û"],
          [62, "«"],
          [63, "»"]
        ]), Bt = /* @__PURE__ */ new Map([
          [32, "Ã"],
          [33, "ã"],
          [34, "Í"],
          [35, "Ì"],
          [36, "ì"],
          [37, "Ò"],
          [38, "ò"],
          [39, "Õ"],
          [40, "õ"],
          [41, "{"],
          [42, "}"],
          [43, "\\"],
          [44, "^"],
          [45, "_"],
          [46, "|"],
          [47, "~"],
          [48, "Ä"],
          [49, "ä"],
          [50, "Ö"],
          [51, "ö"],
          [52, "ß"],
          [53, "¥"],
          [54, "¤"],
          [55, "│"],
          [56, "Å"],
          [57, "å"],
          [58, "Ø"],
          [59, "ø"],
          [60, "┌"],
          [61, "┐"],
          [62, "└"],
          [63, "┘"]
        ]), vt = /* @__PURE__ */ new Map([[1, 10], [2, 15.33], [3, 20.66], [4, 26], [5, 31.33], [6, 36.66], [7, 42], [8, 47.33], [9, 52.66], [10, 58], [11, 63.33], [12, 68.66], [13, 74], [14, 79.33], [15, 84.66]]);
        function Dt(a, b) {
          this.h = 0;
          this.o = new st(a, b);
          this.i = new st(a, b);
          this.g = this.j = new st(a, b);
          this.l = 0;
          this.m = null;
        }
        function Et(a, b, c) {
          a.g = a.i;
          var d = a.g, e = null;
          3 !== a.h && 4 !== a.h && (e = ut(d, a.l, c), c = a.i, c.g = 0 < c.h ? c.h : 0, wt(c, 0, 15), c = a.j, c.g = 0 < c.h ? c.h : 0, wt(c, 0, 15), d.g = 15);
          a.h = 3;
          d.h = b;
          return e;
        }
        function Ft(a) {
          a.h = 1;
          a.g = a.j;
          a.g.h = 0;
        }
        function Gt(a) {
          cb("Cea608DataChannel", "CEA-608 text mode entered, but is unsupported");
          a.g = a.o;
          a.h = 4;
        }
        var Ht = "black green blue cyan red yellow magenta black".split(" "), It = "white green blue cyan red yellow magenta white_italics".split(" ");
        function Jt(a, b) {
          this.I = b;
          this.M = a;
          this.K = this.l = false;
          this.m = this.o = this.G = this.L = this.H = 0;
          this.F = 2;
          this.i = [];
          this.g = this.h = this.j = 0;
          this.C = this.A = false;
          this.B = "white";
          this.u = "black";
          Kt(this);
        }
        function Kt(a) {
          a.i = [];
          for (var b = 0; 16 > b; b++) a.i.push(Lt());
        }
        function Lt() {
          for (var a = [], b = 0; 42 > b; b++) a.push(null);
          return a;
        }
        function Mt(a, b) {
          Nt(a) && (a.i[a.h][a.g] = new rt(b, a.C, a.A, a.u, a.B), a.g++);
        }
        function Nt(a) {
          var b = a.g < a.m && 0 <= a.g;
          return a.h < a.o && 0 <= a.h && b;
        }
        Jt.prototype.isVisible = function() {
          return this.l;
        };
        function Ot(a) {
          for (var b = 0, c = 1; 16 > c; c++, b++) a.i[b] = a.i[c];
          for (c = 0; 1 > c; c++, b++) a.i[b] = Lt();
        }
        function Pt(a, b, c) {
          var d = new Ae(a.j, b, "");
          d.textAlign = 0 === a.F ? "left" : 1 === a.F ? "right" : Ce;
          var e = d.region;
          a.I && (e.id += "svc" + a.I);
          e.id += "win" + a.M;
          e.height = a.o;
          e.width = a.m;
          e.heightUnits = 2;
          e.widthUnits = 2;
          e.viewportAnchorX = a.H;
          e.viewportAnchorY = a.L;
          e.viewportAnchorUnits = a.K ? zd : 2;
          switch (a.G) {
            case 0:
              e.regionAnchorX = 0;
              e.regionAnchorY = 0;
              break;
            case 1:
              e.regionAnchorX = 50;
              e.regionAnchorY = 0;
              break;
            case 2:
              e.regionAnchorX = 100;
              e.regionAnchorY = 0;
              break;
            case 3:
              e.regionAnchorX = 0;
              e.regionAnchorY = 50;
              break;
            case 4:
              e.regionAnchorX = 50;
              e.regionAnchorY = 50;
              break;
            case 5:
              e.regionAnchorX = 100;
              e.regionAnchorY = 50;
              break;
            case 6:
              e.regionAnchorX = 0;
              e.regionAnchorY = 100;
              break;
            case 7:
              e.regionAnchorX = 50;
              e.regionAnchorY = 100;
              break;
            case 8:
              e.regionAnchorX = 100, e.regionAnchorY = 100;
          }
          if (c = ot(d, "svc" + c, a.i, a.j, b)) a.j = b;
          return c;
        }
        Jt.prototype.display = function() {
          this.l = true;
        };
        function Qt() {
          this.i = [];
          this.h = null;
          this.g = 0;
        }
        function Rt(a, b) {
          3 === b.type ? (a.g = 2 * (b.value & 63) - 1, a.h = []) : a.h && (0 < a.g && (a.h.push(b), a.g--), 0 === a.g && (a.i.push(new St(a.h)), a.h = null, a.g = 0));
        }
        function St(a) {
          this.g = 0;
          this.h = a;
        }
        St.prototype.ta = function() {
          return this.g < this.h.length;
        };
        St.prototype.Ba = function() {
          return this.g;
        };
        function Tt(a) {
          if (!a.ta()) throw new U(2, 2, 3e3);
          return a.h[a.g++];
        }
        St.prototype.skip = function(a) {
          if (this.g + a > this.h.length) throw new U(2, 2, 3e3);
          this.g += a;
        };
        St.prototype.qh = function(a) {
          if (0 > this.g - a) throw new U(2, 2, 3e3);
          this.g -= a;
        };
        function Ut(a) {
          this.i = a;
          this.h = [null, null, null, null, null, null, null, null];
          this.g = null;
        }
        function Vt(a, b, c, d) {
          if (!a.g) return [];
          if (24 == c) return c = Tt(b).value, d = Tt(b).value, c = function(f) {
            return f.map(function(g) {
              return ("0" + (g & 255).toString(16)).slice(-2);
            }).join("");
          }([c, d]), Mt(a.g, String.fromCharCode(parseInt(c, 16))), [];
          b = a.g;
          var e = null;
          switch (c) {
            case 8:
              !Nt(b) || 0 >= b.g && 0 >= b.h || (0 >= b.g ? (b.g = b.m - 1, b.h--) : b.g--, b.i[b.h][b.g] = null);
              break;
            case 13:
              b.isVisible() && (e = Pt(b, d, a.i));
              b.h + 1 >= b.o ? Ot(b) : b.h++;
              b.g = 0;
              break;
            case 14:
              b.isVisible() && (e = Pt(b, d, a.i));
              b.i[b.h] = Lt();
              b.g = 0;
              break;
            case 12:
              b.isVisible() && (e = Pt(b, d, a.i)), Kt(b), b.h = 0, b.g = 0;
          }
          return e ? [e] : [];
        }
        function Wt(a, b, c, d) {
          if (128 <= c && 135 >= c) d = c & 7, a.h[d] && (a.g = a.h[d]);
          else {
            if (136 === c) {
              c = Tt(b).value;
              b = [];
              c = t(Xt(a, c));
              for (var e = c.next(); !e.done; e = c.next()) {
                e = a.h[e.value];
                if (e.isVisible()) {
                  var f = Pt(e, d, a.i);
                  f && b.push(f);
                }
                Kt(e);
              }
              return b;
            }
            if (137 === c) for (b = Tt(b).value, b = t(Xt(a, b)), c = b.next(); !c.done; c = b.next()) c = a.h[c.value], c.isVisible() || (c.j = d), c.display();
            else {
              if (138 === c) {
                c = Tt(b).value;
                b = null;
                c = t(Xt(a, c));
                for (e = c.next(); !e.done; e = c.next()) e = a.h[e.value], e.isVisible() && (b = Pt(e, d, a.i)), e.l = false;
                return b ? [b] : [];
              }
              if (139 === c) {
                c = Tt(b).value;
                b = null;
                c = t(Xt(a, c));
                for (e = c.next(); !e.done; e = c.next()) e = a.h[e.value], e.isVisible() ? b = Pt(e, d, a.i) : e.j = d, e.l = !e.l;
                return b ? [b] : [];
              }
              if (140 === c) return b = Tt(b).value, Yt(a, b, d);
              if (143 === c) return d = Yt(a, 255, d), Zt(a), d;
              if (144 === c) b.skip(1), d = Tt(b).value, a.g && (a.g.A = 0 < (d & 128), a.g.C = 0 < (d & 64));
              else if (145 === c) d = Tt(b).value, c = Tt(b).value, b.skip(1), a.g && (b = $t((c & 48) >> 4, (c & 12) >> 2, c & 3), a.g.B = $t((d & 48) >> 4, (d & 12) >> 2, d & 3), a.g.u = b);
              else if (146 === c) d = Tt(b).value, b = Tt(b).value, a.g && (a = a.g, a.h = d & 15, a.g = b & 63);
              else if (151 === c) b.skip(1), b.skip(1), d = Tt(b).value, b.skip(1), a.g && (a.g.F = d & 3);
              else if (152 <= c && 159 >= c) {
                c = (c & 15) - 8;
                e = null !== a.h[c];
                e || (f = new Jt(c, a.i), f.j = d, a.h[c] = f);
                d = Tt(b).value;
                f = Tt(b).value;
                var g = Tt(b).value, h = Tt(b).value, k2 = Tt(b).value;
                b = Tt(b).value;
                e && 0 === (b & 7) || (b = a.h[c], b.h = 0, b.g = 0, b.C = false, b.A = false, b.B = "white", b.u = "black");
                b = a.h[c];
                b.l = 0 < (d & 32);
                b.L = f & 127;
                b.H = g;
                b.G = (h & 240) >> 4;
                b.K = 0 < (f & 128);
                b.o = (h & 15) + 1;
                b.m = (k2 & 63) + 1;
                a.g = a.h[c];
              }
            }
          }
          return [];
        }
        function Xt(a, b) {
          for (var c = [], d = 0; 8 > d; d++) 1 === (b & 1) && a.h[d] && c.push(d), b >>= 1;
          return c;
        }
        function Yt(a, b, c) {
          var d = [];
          b = t(Xt(a, b));
          for (var e = b.next(); !e.done; e = b.next()) {
            e = e.value;
            var f = a.h[e];
            f.isVisible() && (f = Pt(f, c, a.i)) && d.push(f);
            a.h[e] = null;
          }
          return d;
        }
        function Zt(a) {
          a.g = null;
          a.h = [null, null, null, null, null, null, null, null];
        }
        function $t(a, b, c) {
          var d = { 0: 0, 1: 0, 2: 1, 3: 1 };
          a = d[a];
          b = d[b];
          c = d[c];
          return au[a << 2 | b << 1 | c];
        }
        var bu = /* @__PURE__ */ new Map([[32, " "], [33, " "], [37, "…"], [42, "Š"], [44, "Œ"], [48, "█"], [49, "‘"], [50, "’"], [51, "“"], [52, "”"], [53, "•"], [57, "™"], [58, "š"], [60, "œ"], [61, "℠"], [63, "Ÿ"], [118, "⅛"], [119, "⅜"], [120, "⅝"], [121, "⅞"], [122, "│"], [123, "┐"], [124, "└"], [125, "─"], [126, "┘"], [127, "┌"]]), au = "black blue green cyan red magenta yellow white".split(" ");
        function cu() {
          this.h = [];
          this.g = [];
          this.i = new Qt();
          this.l = 0;
          this.m = /* @__PURE__ */ new Map([["CC1", new Dt(0, 0)], ["CC2", new Dt(0, 1)], ["CC3", new Dt(1, 0)], ["CC4", new Dt(1, 1)]]);
          this.u = this.o = 0;
          this.j = /* @__PURE__ */ new Map();
          this.B = true;
          this.A = /* @__PURE__ */ new Set();
          du(this);
        }
        cu.prototype.clear = function() {
          this.l = 0;
          this.h = [];
          this.g = [];
          var a = this.i;
          a.i = [];
          a.h = [];
          a.g = 0;
          du(this);
          a = t(this.j.values());
          for (var b = a.next(); !b.done; b = a.next()) Zt(b.value);
        };
        function du(a) {
          a.o = 0;
          a.u = 0;
          for (var b = t(a.m.values()), c = b.next(); !c.done; c = b.next()) c = c.value, c.h = 0, c.g = c.j, c.m = null, tt(c.i), tt(c.j), tt(c.o);
          a.B = true;
        }
        cu.prototype.extract = function(a, b) {
          if (this.B) {
            for (var c = t(this.m.values()), d = c.next(); !d.done; d = c.next()) d.value.l = b;
            this.B = false;
          }
          a = new Ch(a, 0);
          if (!(8 > a.getLength()) && 181 === a.X() && 49 === a.na() && 1195456820 === a.S() && 3 === a.X() && (c = a.X(), 0 !== (c & 64))) for (c &= 31, a.skip(1), d = 0; d < c; d++) {
            var e = a.X(), f = (e & 4) >> 2, g = a.X(), h = a.X();
            f && (e &= 3, 0 === e || 1 === e ? this.h.push({ pts: b, type: e, mb: g, Mb: h, order: this.h.length }) : (this.g.push({ pts: b, type: e, value: g, order: this.g.length }), this.g.push({ pts: b, type: 2, value: h, order: this.g.length })));
          }
        };
        cu.prototype.decode = function() {
          function a(e, f) {
            return e.pts - f.pts || e.order - f.order;
          }
          var b = [];
          this.h.sort(a);
          this.g.sort(a);
          for (var c = t(this.h), d = c.next(); !d.done; d = c.next()) (d = eu(this, d.value)) && b.push(d);
          c = t(this.g);
          for (d = c.next(); !d.done; d = c.next()) Rt(this.i, d.value);
          c = t(this.i.i);
          for (d = c.next(); !d.done; d = c.next()) d = fu(this, d.value), b.push.apply(b, y(d));
          this.i.i = [];
          this.h = [];
          this.g = [];
          return b;
        };
        function eu(a, b) {
          var c = b.type;
          if (16 === (b.mb & 112)) {
            var d = b.mb >> 3 & 1;
            0 === c ? a.o = d : a.u = d;
          }
          d = "CC" + ((c << 1 | (c ? a.u : a.o)) + 1);
          c = a.m.get(d);
          if (255 === b.mb && 255 === b.Mb || !b.mb && !b.Mb || !gu(b.mb) || !gu(b.Mb)) return 45 <= ++a.l && du(a), null;
          a.l = 0;
          b.mb &= 127;
          b.Mb &= 127;
          var e = b.mb;
          if (1 <= e && 15 >= e || !b.mb && !b.Mb) return null;
          e = null;
          if (16 === (b.mb & 112)) a: {
            a.A.add(d), d = b.mb;
            a = b.Mb;
            if (c.m === (d << 8 | a)) c.m = null;
            else if (c.m = d << 8 | a, 16 === (d & 240) && 64 === (a & 192)) {
              b = [11, 11, 1, 2, 3, 4, 12, 13, 14, 15, 5, 6, 7, 8, 9, 10][(d & 7) << 1 | a >> 5 & 1];
              d = "white";
              e = false;
              var f = null;
              var g = 95 < a ? a - 96 : a - 64;
              13 >= g ? d = It[Math.floor(g / 2)] : 15 >= g ? e = true : f = Math.floor((g - 16) / 2);
              a = 1 === (a & 1);
              4 !== c.h && (g = c.g, 3 === c.h && b !== g.g && (c = 1 + b - g.h, Ct(g, c, 1 + g.g - g.h, g.h), wt(g, 0, c - 1), wt(g, b + 1, 15 - b)), g.g = b, g.m = a, g.j = e, g.l = d, g.u = f, g.o = "black");
            } else if (17 === (d & 247) && 32 === (a & 240)) c.g.m = false, c.g.j = false, c.g.l = "white", xt(c.g, 0, 32), d = false, b = It[(a & 14) >> 1], "white_italics" === b && (b = "white", d = true), c.g.m = 1 === (a & 1), c.g.j = d, c.g.l = b;
            else if (16 === (d & 247) && 32 === (a & 240) || 23 === (d & 247) && 45 === (a & 255)) b = "black", 0 === (d & 7) && (b = Ht[(a & 14) >> 1]), c.g.o = b;
            else if (17 === (d & 247) && 48 === (a & 240)) xt(c.g, 1, a);
            else if (18 === (d & 246) && 32 === (a & 224)) xt(c.g, d & 1 ? 3 : 2, a);
            else {
              if (20 === (d & 246) && 32 === (a & 240)) {
                a = b.pts;
                d = null;
                switch (b.Mb) {
                  case 32:
                    Ft(c);
                    break;
                  case 33:
                    c = c.g;
                    c.i[c.g].pop();
                    break;
                  case 37:
                    d = Et(c, 2, a);
                    break;
                  case 38:
                    d = Et(c, 3, a);
                    break;
                  case 39:
                    d = Et(c, 4, a);
                    break;
                  case 40:
                    xt(c.g, 0, 32);
                    break;
                  case 41:
                    c.h = 2;
                    c.g = c.i;
                    c.g.h = 0;
                    c.l = a;
                    break;
                  case 42:
                    tt(c.o);
                    Gt(c);
                    break;
                  case 43:
                    Gt(c);
                    break;
                  case 44:
                    b = c.i;
                    d = null;
                    4 !== c.h && (d = ut(b, c.l, a));
                    wt(b, 0, 15);
                    break;
                  case 45:
                    b = c.g;
                    3 !== c.h ? d = null : (d = ut(b, c.l, a), e = b.g - b.h + 1, Ct(b, e - 1, e, b.h), wt(b, 0, e - 1), wt(b, b.g, 15 - b.g), c.l = a);
                    break;
                  case 46:
                    wt(c.j, 0, 15);
                    break;
                  case 47:
                    b = null, 4 !== c.h && (b = ut(c.i, c.l, a)), d = c.j, c.j = c.i, c.i = d, Ft(c), c.l = a, d = b;
                }
                e = d;
                break a;
              }
              (23 == d || 31 == d) && 33 <= a && 35 >= a && (c.g.A = a - 32);
            }
            e = null;
          }
          else a = b.Mb, xt(c.g, 0, b.mb), xt(c.g, 0, a);
          return e;
        }
        function fu(a, b) {
          var c = [];
          try {
            for (; b.ta(); ) {
              var d = Tt(b).value, e = (d & 224) >> 5, f = d & 31;
              7 === e && 0 != f && (e = Tt(b).value & 63);
              if (0 != e) {
                a.A.add("svc" + e);
                a.j.has(e) || a.j.set(e, new Ut(e));
                for (var g = a.j.get(e), h = b.Ba(); b.Ba() - h < f; ) {
                  e = g;
                  var k2 = b, l = Tt(k2), m = l.value, n = l.pts;
                  if (16 === m) {
                    var p = Tt(k2);
                    m = m << 16 | p.value;
                  }
                  if (0 <= m && 31 >= m) var q = Vt(e, k2, m, n);
                  else if (128 <= m && 159 >= m) q = Wt(e, k2, m, n);
                  else {
                    if (4096 <= m && 4127 >= m) e = k2, k2 = m & 255, 8 <= k2 && 15 >= k2 ? e.skip(1) : 16 <= k2 && 23 >= k2 ? e.skip(2) : 24 <= k2 && 31 >= k2 && e.skip(3);
                    else if (4224 <= m && 4255 >= m) e = k2, k2 = m & 255, 128 <= k2 && 135 >= k2 ? e.skip(4) : 136 <= k2 && 143 >= k2 && e.skip(5);
                    else if (32 <= m && 127 >= m) k2 = m, e.g && (127 === k2 ? Mt(e.g, "♪") : Mt(e.g, String.fromCharCode(k2)));
                    else if (160 <= m && 255 >= m) e.g && Mt(e.g, String.fromCharCode(m));
                    else if (4128 <= m && 4223 >= m) {
                      if (k2 = m & 255, e.g) if (bu.has(k2)) {
                        var u = bu.get(k2);
                        Mt(e.g, u);
                      } else Mt(e.g, "_");
                    } else 4256 <= m && 4351 >= m && e.g && (160 != (m & 255) ? Mt(e.g, "_") : Mt(e.g, "[CC]"));
                    q = [];
                  }
                  c.push.apply(c, y(q));
                }
              }
            }
          } catch (w) {
            if (w instanceof U && 3e3 === w.code) cb("CEA708_INVALID_DATA", "Buffer read out of bounds / invalid CEA-708 Data.");
            else throw w;
          }
          return c;
        }
        function gu(a) {
          for (var b = 0; a; ) b ^= a & 1, a >>= 1;
          return 1 === b;
        }
        cu.prototype.getStreams = function() {
          return Array.from(this.A);
        };
        T("shaka.cea.CeaDecoder", cu);
        vd = function() {
          return new cu();
        };
        function hu(a) {
          for (var b = [], c = a, d = a = 0; d < c.length; ) 2 == a && 3 == c[d] ? (a = 0, c = [].concat(y(c)), c.splice(d, 1), c = new Uint8Array(c)) : 0 == c[d] ? a++ : a = 0, d++;
          a = c;
          for (d = 0; d < a.length; ) {
            for (c = 0; 255 == a[d]; ) c += 255, d++;
            c += a[d++];
            for (var e = 0; 255 == a[d]; ) e += 255, d++;
            e += a[d++];
            4 == c && b.push(a.subarray(d, d + e));
            d += e;
          }
          return b;
        }
        function iu() {
          this.j = /* @__PURE__ */ new Map();
          this.i = this.h = 0;
          this.g = ju;
        }
        iu.prototype.init = function(a) {
          function b(f) {
            f = f.name;
            ku.has(f) && (c.g = ku.get(f));
          }
          var c = this, d = [], e = [];
          new Fh().box("moov", Kh).box("mvex", Kh).R("trex", function(f) {
            var g = f.reader;
            g.skip(4);
            g.skip(4);
            f = g.S();
            g = g.S();
            c.h = f;
            c.i = g;
          }).box("trak", Kh).R("tkhd", function(f) {
            var g = f.reader;
            f = f.version;
            1 == f ? (g.skip(8), g.skip(8)) : (g.skip(4), g.skip(4));
            var h = g.S();
            1 == f ? g.skip(8) : g.skip(4);
            g.skip(4);
            g.skip(8);
            g.skip(2);
            g.skip(2);
            g.skip(2);
            g.skip(2);
            g.skip(36);
            g.na();
            g.na();
            g.na();
            g.na();
            d.push(h);
          }).box("mdia", Kh).R(
            "mdhd",
            function(f) {
              f = Yi(f.reader, f.version);
              e.push(f.timescale);
            }
          ).box("minf", Kh).box("stbl", Kh).R("stsd", Mh).box("avc1", b).box("avc3", b).box("dvav", b).box("dva1", b).box("hev1", b).box("hvc1", b).box("dvh1", b).box("dvhe", b).box("vvc1", b).box("vvi1", b).box("dvc1", b).box("dvi1", b).box("encv", Nh).box("sinf", Kh).box("frma", function(f) {
            f = aj(f.reader).codec;
            ku.has(f) && (c.g = ku.get(f));
          }).parse(a, true);
          if (!d.length || !e.length || d.length != e.length) throw new U(2, 2, 2010);
          this.g == ju && bb("Unable to determine bitstream format for CEA parsing!");
          d.forEach(function(f, g) {
            c.j.set(f, e[g]);
          });
        };
        iu.prototype.parse = function(a) {
          var b = this;
          if (this.g == ju) return [];
          var c = [], d = 0, e = [];
          new Fh().box("moof", function(f) {
            d = f.start;
            e = [];
            Kh(f);
          }).box("traf", function(f) {
            e.push({ baseMediaDecodeTime: null, ld: b.h, md: b.i, lh: [], timescale: 9e4 });
            Kh(f);
          }).R("trun", function(f) {
            var g = e[e.length - 1];
            f = Zi(f.reader, f.version, f.flags);
            g.lh.push(f);
          }).R("tfhd", function(f) {
            var g = e[e.length - 1];
            f = Wi(f.reader, f.flags);
            g.ld = f.ld || b.h;
            g.md = f.md || b.i;
            f = f.trackId;
            b.j.has(f) && (g.timescale = b.j.get(f));
          }).R("tfdt", function(f) {
            var g = e[e.length - 1];
            f = Xi(f.reader, f.version);
            g.baseMediaDecodeTime = f.baseMediaDecodeTime;
          }).box("mdat", function(f) {
            for (var g = d - f.start - 8, h = f.reader.Ba(), k2 = t(e), l = k2.next(); !l.done; l = k2.next()) {
              l = l.value;
              if (null === l.baseMediaDecodeTime) throw bb("Unable to find base media decode time for CEA captions!"), new U(2, 2, 2010);
              f.reader.seek(h);
              lu(b, f.reader, l.baseMediaDecodeTime, l.timescale, l.ld, l.md, g, l.lh, c);
            }
          }).parse(a, false);
          return c;
        };
        function lu(a, b, c, d, e, f, g, h, k2) {
          var l = 0, m = f, n = h.map(function(u) {
            return u.fg;
          });
          n = [].concat.apply([], y(n));
          n.length && (m = n[0].sampleSize || f);
          for (b.skip(g + h[0].nf); b.ta(); ) {
            g = b.S();
            var p = b.X(), q = null;
            q = false;
            h = 1;
            switch (a.g) {
              case mu:
                q = p & 31;
                q = 6 == q;
                break;
              case nu:
                h = 2;
                b.skip(1);
                q = p >> 1 & 63;
                q = 39 == q || 40 == q;
                break;
              case ou:
                h = 2;
                b.skip(1);
                q = p >> 1 & 63;
                q = 23 == q || 24 == q;
                break;
              default:
                return;
            }
            if (q) for (p = 0, l < n.length && (p = n[l].ye || 0), p = (c + p) / d, h = t(hu(b.Cb(g - h))), q = h.next(); !q.done; q = h.next()) k2.push({ packet: q.value, pts: p });
            else try {
              b.skip(g - h);
            } catch (u) {
              break;
            }
            m -= g + 4;
            0 == m && (c = l < n.length ? c + (n[l].gg || e) : c + e, l++, l < n.length ? m = n[l].sampleSize || f : m = f);
          }
        }
        T("shaka.cea.Mp4CeaParser", iu);
        var ju = 0, mu = 1, nu = 2, ou = 3, ku = (/* @__PURE__ */ new Map()).set("avc1", mu).set("avc3", mu).set("dvav", mu).set("dva1", mu).set("hev1", nu).set("hvc1", nu).set("dvh1", nu).set("dvhe", nu).set("vvc1", ou).set("vvi1", ou).set("dvc1", ou).set("dvi1", ou);
        wd("video/mp4", function() {
          return new iu();
        });
        function pu() {
          this.g = null;
        }
        pu.prototype.init = function() {
        };
        pu.prototype.parse = function(a) {
          this.g ? this.g.clearData() : this.g = new Ak();
          var b = [];
          a = Qb(a);
          if (!Ik(a)) return b;
          a = this.g.parse(a);
          var c = a.od(), d = a.be();
          a = [];
          switch (c.video) {
            case "avc":
              a.push(6);
              break;
            case "hvc":
              a.push(39), a.push(40);
          }
          if (!a.length) return b;
          c = t(d);
          for (d = c.next(); !d.done; d = c.next()) if (d = d.value, a.includes(d.type) && null != d.time) for (var e = t(hu(d.data)), f = e.next(); !f.done; f = e.next()) b.push({ packet: f.value, pts: d.time });
          return b;
        };
        T("shaka.cea.TsCeaParser", pu);
        wd("video/mp2t", function() {
          return new pu();
        });
        function qu(a) {
          var b = 0, c = Vb(a), d = c.getUint32(b, true);
          if (d != a.byteLength) return [];
          a: {
            a = b + 6;
            for (b = []; a < c.byteLength - 1; ) {
              d = c.getUint16(a, true);
              a += 2;
              var e = c.getUint16(a, true);
              a += 2;
              if (0 != (e & 1) || e + a > c.byteLength) {
                c = [];
                break a;
              }
              var f = Qb(c, a, e);
              b.push({ type: d, value: f });
              a += e;
            }
            c = b;
          }
          return c;
        }
        function ru(a) {
          a = Tc(Zd(a));
          a = qu(a).filter(function(b) {
            return b.type === su;
          })[0];
          if (!a) return null;
          a = Ic(a.value, true);
          return (a = Rd(a, "WRMHEADER")) ? a : null;
        }
        function tu(a) {
          try {
            var b = ru(a);
            if (b) a: {
              for (var c = t(ae(b, "DATA")), d = c.next(); !d.done; d = c.next()) {
                var e = d.value;
                if (e.children) for (var f = t(e.children), g = f.next(); !g.done; g = f.next()) {
                  var h = g.value;
                  if ("LA_URL" == h.tagName) {
                    var k2 = Zd(h);
                    break a;
                  }
                }
              }
              k2 = "";
            }
            else k2 = "";
            return k2;
          } catch (l) {
            return "";
          }
        }
        var su = 1;
        function uu(a, b, c) {
          var d = vu(a), e = null;
          a = [];
          var f = [], g = null, h = new Set(d.map(function(l) {
            return l.keyId;
          }));
          h.delete(null);
          var k2 = "cenc";
          if (1 < h.size) throw new U(2, 4, 4010);
          if (!b) {
            f = d.filter(function(l) {
              return "urn:mpeg:dash:sea:2012" == l.cd;
            });
            if (1 < f.length) throw new U(2, 4, 4050);
            f.length && (g = wu(f[0]));
            (f = d.find(function(l) {
              return "urn:mpeg:dash:mp4protection:2011" == l.cd;
            })) && f.encryptionScheme && (k2 = f.encryptionScheme);
            f = d.filter(function(l) {
              return "urn:mpeg:dash:mp4protection:2011" == l.cd ? (e = l.init || e, false) : "urn:mpeg:dash:sea:2012" != l.cd;
            });
            f.length && (a = xu(e, k2, f, c, h), 0 == a.length && (a = [Yc("", k2, e)]));
          }
          if (d.length && !g && (b || !f.length)) for (a = [], b = t(Object.values(c)), c = b.next(); !c.done; c = b.next()) c = c.value, "org.w3.clearkey" != c && a.push(Yc(c, k2, e));
          if (h = Array.from(h)[0] || null) for (k2 = t(a), b = k2.next(); !b.done; b = k2.next()) for (b = t(b.value.initData), c = b.next(); !c.done; c = b.next()) c.value.keyId = h;
          return { Jg: h, Pk: e, drmInfos: a, cf: g, Og: true };
        }
        function yu(a, b, c, d) {
          var e = uu(a, c, d);
          if (b.Og) {
            a = 1 == b.drmInfos.length && !b.drmInfos[0].keySystem;
            c = 0 == e.drmInfos.length;
            if (0 == b.drmInfos.length || a && !c) b.drmInfos = e.drmInfos;
            b.Og = false;
          } else if (0 < e.drmInfos.length && (b.drmInfos = b.drmInfos.filter(function(f) {
            return e.drmInfos.some(function(g) {
              return g.keySystem == f.keySystem;
            });
          }), 0 == b.drmInfos.length)) throw new U(2, 4, 4008);
          return e.Jg || b.Jg;
        }
        function zu(a) {
          var b = ce(a.node, "https://dashif.org/CPS", "Laurl");
          if (b && (b = Zd(b))) return b;
          if ((b = ce(a.node, "urn:microsoft:playready", "pro")) && Zd(b)) return tu(b);
          if (a = ce(a.node, "urn:mpeg:cenc:2013", "pssh")) {
            if (a = Zd(a)) {
              b = Tc(a);
              a = 8;
              b = Vb(b);
              var c = b.getUint8(a);
              a += 20;
              0 < c && (a += 4 + 16 * b.getUint32(a));
              a = Qb(b, a + 4);
              a = Rc(a);
              a = Rd("<pro>" + a + "</pro>");
              return tu(a);
            }
          }
          return "";
        }
        function xu(a, b, c, d, e) {
          var f = [];
          c = t(c);
          for (var g = c.next(); !g.done; g = c.next()) {
            g = g.value;
            var h = d[g.cd];
            if (h) {
              var k2;
              if ((k2 = ce(g.node, "urn:microsoft:playready", "pro")) && Zd(k2)) {
                k2 = Zd(k2);
                k2 = Tc(k2);
                var l = new Uint8Array([154, 4, 240, 121, 152, 64, 66, 134, 171, 146, 230, 91, 224, 136, 95, 149]);
                k2 = [{ initData: Rh(k2, l, /* @__PURE__ */ new Set(), 0), initDataType: "cenc", keyId: g.keyId }];
              } else k2 = null;
              l = null;
              if ("urn:uuid:e2719d58-a985-b3c9-781a-b030af78d30e" === g.cd) {
                l = g;
                var m = e;
                if (0 == m.size) l = null;
                else {
                  var n = new Uint8Array([
                    16,
                    119,
                    239,
                    236,
                    192,
                    178,
                    77,
                    2,
                    172,
                    227,
                    60,
                    30,
                    82,
                    226,
                    251,
                    75
                  ]), p = new Uint8Array([]);
                  l = [{ initData: Rh(p, n, m, 1), initDataType: "cenc", keyId: l.keyId }];
                }
              }
              k2 = Yc(h, b, g.init || a || k2 || l);
              if (h = Au.get(h)) k2.licenseServerUri = h(g);
              f.push(k2);
            }
          }
          return f;
        }
        function vu(a) {
          var b = [];
          a = t(a);
          for (var c = a.next(); !c.done; c = a.next()) (c = Bu(c.value)) && b.push(c);
          return b;
        }
        function Bu(a) {
          var b = a.attributes.schemeIdUri, c = ie(a, "urn:mpeg:cenc:2013", "default_KID"), d = ee(a, "urn:mpeg:cenc:2013", "pssh").map($d), e = a.attributes.value;
          if (!b) return null;
          b = b.toLowerCase();
          if (c && (c = c.replace(/-/g, "").toLowerCase(), c.includes(" "))) throw new U(2, 4, 4009);
          var f = [];
          try {
            f = d.map(function(g) {
              return { initDataType: "cenc", initData: Tc(g), keyId: null };
            });
          } catch (g) {
            throw new U(2, 4, 4007);
          }
          return { node: a, cd: b, keyId: c, init: 0 < f.length ? f : null, encryptionScheme: e };
        }
        function wu(a) {
          if (!window2.crypto || !window2.crypto.subtle) throw bb("Web Crypto API is not available to decrypt AES-128. (Web Crypto only exists in secure origins like https)"), new U(2, 4, 4042);
          var b = ce(a.node, "urn:mpeg:dash:schema:sea:2012", "SegmentEncryption");
          if (!b) throw new U(2, 4, 4051);
          if ("urn:mpeg:dash:sea:aes128-cbc:2013" != b.attributes.schemeIdUri) throw new U(2, 4, 4051);
          b = ce(a.node, "urn:mpeg:dash:schema:sea:2012", "CryptoPeriod");
          if (!b) throw new U(2, 4, 4051);
          a = b.attributes.IV;
          b = Pc(b.attributes.keyUriTemplate);
          if (!a || !b) throw new U(2, 4, 4051);
          a = Uc(a.substr(2));
          if (16 != a.byteLength) throw new U(2, 4, 4048);
          return { Xi: b, iv: a };
        }
        var Au = (/* @__PURE__ */ new Map()).set("com.apple.fps", function(a) {
          if ("apple" === window2.shakaMediaKeysPolyfill) throw new U(2, 4, 4054);
          if (a = ce(a.node, "https://dashif.org/CPS", "Laurl")) {
            if (a = Zd(a)) return a;
          }
          return "";
        }).set("com.widevine.alpha", function(a) {
          var b = ce(a.node, "https://dashif.org/CPS", "Laurl");
          return b && (b = Zd(b)) ? b : (a = ce(a.node, "urn:microsoft", "laurl")) ? Pc(a.attributes.licenseUrl) || "" : "";
        }).set("com.microsoft.playready", zu).set("com.microsoft.playready.recommendation", zu).set(
          "com.microsoft.playready.software",
          zu
        ).set("com.microsoft.playready.hardware", zu).set("org.w3.clearkey", function(a) {
          var b = ce(a.node, "https://dashif.org/CPS", "Laurl");
          return b && (b = Zd(b)) ? b : (a = ce(a.node, "http://dashif.org/guidelines/clearKey", "Laurl")) && "EME-1.0" === a.attributes.Lic_type && a && (a = Zd(a)) ? a : "";
        });
        function Cu(a, b, c, d, e, f) {
          var g = (/* @__PURE__ */ new Map()).set("RepresentationID", b).set("Number", c).set("SubNumber", d).set("Bandwidth", e).set("Time", f);
          return a.replace(/\$(RepresentationID|Number|SubNumber|Bandwidth|Time)?(?:%0([0-9]+)([diouxX]))?\$/g, function(h, k2, l, m) {
            if ("$$" == h) return "$";
            var n = g.get(k2);
            if (null == n) return h;
            "RepresentationID" == k2 && l && (l = void 0);
            "Time" == k2 && "bigint" != typeof n && (0.2 <= Math.abs(n - Math.round(n)) && bb("Calculated $Time$ values must be close to integers"), n = Math.round(n));
            switch (m) {
              case void 0:
              case "d":
              case "i":
              case "u":
                h = n.toString();
                break;
              case "o":
                h = n.toString(8);
                break;
              case "x":
                h = n.toString(16);
                break;
              case "X":
                h = n.toString(16).toUpperCase();
                break;
              default:
                h = n.toString();
            }
            l = window2.parseInt(l, 10) || 1;
            return Array(Math.max(0, l - h.length) + 1).join("0") + h;
          });
        }
        function Du(a, b) {
          var c = Eu(a, b, "timescale"), d = 1;
          c && (d = oe(c) || 1);
          c = Eu(a, b, "duration");
          var e = (c = oe(c || "")) ? c / d : null, f = Eu(a, b, "startNumber"), g = Number(Eu(a, b, "presentationTimeOffset")) || 0, h = pe(f || "");
          if (null == f || null == h) h = 1;
          f = null;
          if (b = Fu(a, b, "SegmentTimeline")) {
            b = Yd(b, "S");
            f = d;
            a = a.ha.duration || Infinity;
            for (var k2 = h, l = [], m = -g, n = 0; n < b.length; ++n) {
              var p = b[n], q = b[n + 1], u = he(p, "t", pe), w = he(p, "d", pe), v = he(p, "r", ne);
              p = he(p, "k", ne) || 0;
              null != u && (u -= g);
              if (w) {
                u = null != u ? u : m;
                v = v || 0;
                if (0 > v) if (q) {
                  q = he(q, "t", pe);
                  if (null == q) break;
                  else if (u >= q) break;
                  v = Math.ceil((q - u) / w) - 1;
                } else {
                  if (Infinity == a) break;
                  else if (u / f >= a) break;
                  v = Math.ceil((a * f - u) / w) - 1;
                }
                0 < l.length && u != m && (l[l.length - 1].end = u / f);
                for (q = 0; q <= v; ++q) m = u + w, l.push({ start: u / f, end: m / f, xg: u, Jb: p, wj: l.length + k2 }), u = m;
              }
            }
            f = l;
          }
          return { timescale: d, He: c, Wa: e, Ld: h, hc: g / d || 0, wg: g, timeline: f };
        }
        function Gu(a, b) {
          return [b(a.J), b(a.ga), b(a.qa)].filter(Kf);
        }
        function Eu(a, b, c) {
          b = Gu(a, b);
          a = null;
          b = t(b);
          for (var d = b.next(); !d.done && !(a = d.value.attributes[c]); d = b.next()) ;
          return a;
        }
        function Fu(a, b, c) {
          b = Gu(a, b);
          a = null;
          b = t(b);
          for (var d = b.next(); !d.done && !(a = be(d.value, c)); d = b.next()) ;
          return a;
        }
        function Hu(a, b, c, d, e, f) {
          for (var g = ie(a, "http://www.w3.org/1999/xlink", "href"), h = ie(a, "http://www.w3.org/1999/xlink", "actuate") || "onRequest", k2 = t(Object.keys(a.attributes)), l = k2.next(); !l.done; l = k2.next()) {
            l = l.value;
            var m = l.split(":"), n = Td("http://www.w3.org/1999/xlink");
            m[0] == n && delete a.attributes[l];
          }
          if (5 <= f) return Wg(new U(2, 4, 4028));
          if ("onLoad" != h) return Wg(new U(2, 4, 4027));
          var p = Xc([d], [g]);
          return e.request(0, lh(p, b)).Ha(function(q) {
            q = Qd(q.data, a.tagName);
            if (!q) return Wg(new U(2, 4, 4001, g));
            for (a.children = []; q.children.length; ) {
              var u = q.children.shift();
              a.children.push(u);
            }
            u = t(Object.keys(q.attributes));
            for (var w = u.next(); !w.done; w = u.next()) w = w.value, a.attributes[w] = q.attributes[w];
            return Iu(a, b, c, p[0], e, f + 1);
          });
        }
        function Iu(a, b, c, d, e, f) {
          f = void 0 === f ? 0 : f;
          if (ie(a, "http://www.w3.org/1999/xlink", "href")) {
            var g = Hu(a, b, c, d, e, f);
            c && (g = g.Ha(void 0, function() {
              return Iu(a, b, c, d, e, f);
            }));
            return g;
          }
          g = [];
          for (var h = t(Xd(a)), k2 = h.next(), l = {}; !k2.done; l = { hd: void 0 }, k2 = h.next()) l.hd = k2.value, "urn:mpeg:dash:resolve-to-zero:2013" == ie(l.hd, "http://www.w3.org/1999/xlink", "href") ? a.children = a.children.filter(/* @__PURE__ */ function(m) {
            return function(n) {
              return n !== m.hd;
            };
          }(l)) : "SegmentTimeline" != l.hd.tagName && g.push(Iu(l.hd, b, c, d, e, f));
          return $g(g).Ha(function() {
            return a;
          });
        }
        function Ju(a, b, c, d, e, f, g) {
          var h, k2 = new Fh().R("sidx", function(l) {
            h = Ku(b, d, e, f, g, c, l);
          });
          a && k2.parse(a);
          if (h) return h;
          throw new U(2, 3, 3004);
        }
        function Ku(a, b, c, d, e, f, g) {
          var h = [];
          g.reader.skip(4);
          var k2 = g.reader.S();
          if (0 == k2) throw new U(2, 3, 3005);
          if (0 == g.version) {
            var l = g.reader.S();
            var m = g.reader.S();
          } else l = g.reader.bd(), m = g.reader.bd();
          g.reader.skip(2);
          var n = g.reader.na();
          a = a + g.size + m;
          for (m = 0; m < n; m++) {
            var p = g.reader.S(), q = (p & 2147483648) >>> 31;
            p &= 2147483647;
            var u = g.reader.S();
            g.reader.skip(4);
            if (1 == q) throw new U(2, 3, 3006);
            h.push(new Nj(l / k2 + c, (l + u) / k2 + c, function() {
              return f;
            }, a, a + p - 1, b, c, d, e));
            l += u;
            a += p;
          }
          g.parser.stop();
          return h;
        }
        function Lu(a) {
          this.h = Vb(a);
          this.g = new Ch(this.h, 0);
        }
        Lu.prototype.ta = function() {
          return this.g.ta();
        };
        function Mu(a) {
          var b = Nu(a);
          if (7 < b.length) throw new U(2, 3, 3002);
          var c = 0;
          b = t(b);
          for (var d = b.next(); !d.done; d = b.next()) c = 256 * c + d.value;
          b = Nu(a);
          a: {
            d = t(Ou);
            for (var e = d.next(); !e.done; e = d.next()) if (Pb(b, new Uint8Array(e.value))) {
              d = true;
              break a;
            }
            d = false;
          }
          if (d) b = a.h.byteLength - a.g.Ba();
          else {
            if (8 == b.length && b[1] & 224) throw new U(2, 3, 3001);
            for (e = d = 0; e < b.length; e++) {
              var f = b[e];
              d = 0 == e ? f & (1 << 8 - b.length) - 1 : 256 * d + f;
            }
            b = d;
          }
          b = a.g.Ba() + b <= a.h.byteLength ? b : a.h.byteLength - a.g.Ba();
          d = Vb(a.h, a.g.Ba(), b);
          a.g.skip(b);
          return new Pu(
            c,
            d
          );
        }
        function Nu(a) {
          var b = a.g.Ba(), c = a.g.X();
          if (0 == c) throw new U(2, 3, 3002);
          c = 8 - Math.floor(Math.log2(c));
          a.g.skip(c - 1);
          return Qb(a.h, b, c);
        }
        var Ou = [[255], [127, 255], [63, 255, 255], [31, 255, 255, 255], [15, 255, 255, 255, 255], [7, 255, 255, 255, 255, 255], [3, 255, 255, 255, 255, 255, 255], [1, 255, 255, 255, 255, 255, 255, 255]];
        function Pu(a, b) {
          this.id = a;
          this.g = b;
        }
        function Qu(a) {
          if (8 < a.g.byteLength) throw new U(2, 3, 3002);
          if (8 == a.g.byteLength && a.g.getUint8(0) & 224) throw new U(2, 3, 3001);
          for (var b = 0, c = 0; c < a.g.byteLength; c++) {
            var d = a.g.getUint8(c);
            b = 256 * b + d;
          }
          return b;
        }
        function Ru(a, b, c, d, e, f, g, h, k2) {
          function l() {
            return e;
          }
          var m = [];
          a = new Lu(a.g);
          for (var n = null, p = null; a.ta(); ) {
            var q = Mu(a);
            if (187 == q.id) {
              var u = Su(q);
              u && (q = c * u.Jj, u = b + u.nj, null != n && m.push(new Nj(n + g, q + g, l, p, u - 1, f, g, h, k2)), n = q, p = u);
            }
          }
          null != n && m.push(new Nj(n + g, d + g, l, p, null, f, g, h, k2));
          return m;
        }
        function Su(a) {
          var b = new Lu(a.g);
          a = Mu(b);
          if (179 != a.id) throw new U(2, 3, 3013);
          a = Qu(a);
          b = Mu(b);
          if (183 != b.id) throw new U(2, 3, 3012);
          b = new Lu(b.g);
          for (var c = 0; b.ta(); ) {
            var d = Mu(b);
            if (241 == d.id) {
              c = Qu(d);
              break;
            }
          }
          return { Jj: a, nj: c };
        }
        function Tu(a, b, c) {
          b = Fu(a, b, "Initialization");
          if (!b) return null;
          var d = a.J.Ua(), e = b.attributes.sourceURL;
          e && (d = Xc(d, [Pc(e)], a.vb()));
          e = 0;
          var f = null;
          if (b = he(b, "range", me)) e = b.start, f = b.end;
          c = new Lj(function() {
            return d;
          }, e, f, Uu(a), null, null, c, a.ga.encrypted);
          c.codecs = a.J.codecs;
          c.mimeType = a.J.mimeType;
          a.ha && (c.g = a.ha.start + a.ha.duration);
          return c;
        }
        function Vu(a, b, c) {
          var d = Number(Eu(a, Wu, "presentationTimeOffset")) || 0, e = Eu(a, Wu, "timescale"), f = 1;
          e && (f = oe(e) || 1);
          var g = d / f || 0, h = Tu(a, Wu, c);
          Xu(a, h);
          var k2 = Od(a);
          return { rc: function() {
            var l = Fu(k2, Wu, "RepresentationIndex");
            var m = k2.J.Ua();
            l && (l = Pc(l.attributes.sourceURL)) && (m = Xc(m, [l], k2.vb()));
            l = Yu(k2);
            return Zu(k2, b, h, m, l.start, l.end, g);
          } };
        }
        function Zu(a, b, c, d, e, f, g) {
          var h, k2, l, m, n, p, q, u, w, v, x, z, C, D, G, B, A, H;
          return Q(function(E) {
            if (1 == E.g) return h = a.presentationTimeline, k2 = !a.Ob || !a.ha.$g, l = a.ha.start, m = a.ha.duration, n = a.J.mimeType.split("/")[1], p = b, q = null, u = [p(d, e, f, false), "webm" == n ? p(c.N(), c.Sa, c.wa, true) : null], p = null, F(E, Promise.all(u), 2);
            w = E.h;
            v = w[0];
            x = w[1] || null;
            z = null;
            C = l - g;
            D = l;
            G = m ? l + m : Infinity;
            if ("mp4" == n) var K = Ju(v, e, d, c, C, D, G);
            else {
              K = v;
              var M = new Lu(x);
              if (440786851 != Mu(M).id) throw new U(2, 3, 3008);
              var J = Mu(M);
              if (408125543 != J.id) throw new U(
                2,
                3,
                3009
              );
              M = J.g.byteOffset;
              J = new Lu(J.g);
              for (var L = null; J.ta(); ) {
                var N = Mu(J);
                if (357149030 == N.id) {
                  L = N;
                  break;
                }
              }
              if (!L) throw new U(2, 3, 3010);
              L = new Lu(L.g);
              N = 1e6;
              for (J = null; L.ta(); ) {
                var P = Mu(L);
                if (2807729 == P.id) N = Qu(P);
                else if (17545 == P.id) if (4 == P.g.byteLength) J = P.g.getFloat32(0);
                else if (8 == P.g.byteLength) J = P.g.getFloat64(0);
                else throw new U(2, 3, 3003);
              }
              if (null == J) throw new U(2, 3, 3011);
              L = N / 1e9;
              J *= L;
              K = Mu(new Lu(K));
              if (475249515 != K.id) throw new U(2, 3, 3007);
              K = Ru(K, M, L, J, d, c, C, D, G);
            }
            z = K;
            B = t(z);
            for (A = B.next(); !A.done; A = B.next()) H = A.value, H.codecs = a.J.codecs, H.mimeType = a.J.mimeType, H.bandwidth = a.bandwidth;
            h.Ed(z);
            q = new Sl(z);
            k2 && q.Oc(D, G, true);
            return E.return(q);
          });
        }
        function Wu(a) {
          return a.dd;
        }
        function Yu(a) {
          var b = Fu(a, Wu, "RepresentationIndex");
          a = Eu(a, Wu, "indexRange");
          a = me(a || "");
          b && (a = he(b, "range", me, a));
          return a;
        }
        function Xu(a, b) {
          $u(a, b);
          if (!Yu(a)) throw new U(2, 4, 4002);
        }
        function $u(a, b) {
          var c = a.J.mimeType.split("/")[1];
          if (a.J.contentType != dd && "mp4" != c && "webm" != c) throw new U(2, 4, 4006);
          if ("webm" == c && !b) throw new U(2, 4, 4005);
        }
        function Uu(a) {
          var b = a.J;
          return { bandwidth: a.bandwidth, audioSamplingRate: b.audioSamplingRate, codecs: b.codecs, contentType: b.contentType, frameRate: b.frameRate || null, height: b.height || null, mimeType: b.mimeType, channelsCount: b.oe, pixelAspectRatio: b.pixelAspectRatio || null, width: b.width || null, label: a.ga.label || null, roles: a.roles || null, language: a.ga.language || null };
        }
        function av(a, b, c) {
          var d = Tu(a, bv, c), e = cv(a);
          if (!e.Wa && !e.timeline && 1 < e.Xc.length) throw new U(2, 4, 4002);
          if (!e.Wa && !a.ha.duration && !e.timeline && 1 == e.Xc.length) throw new U(2, 4, 4002);
          if (e.timeline && 0 == e.timeline.length) throw new U(2, 4, 4002);
          var f = null, g = null;
          a.qa.id && a.J.id && (g = b.get(a.qa.id + "," + a.J.id)) && (f = g.segmentIndex);
          var h = dv(a.ha.start, a.ha.duration, a.J.Ua, e, d, c, a.J.mimeType, a.J.codecs, a.bandwidth, a.vb);
          b = !f;
          f ? f.Bd(h, a.presentationTimeline.pb()) : f = new Sl(h);
          a.presentationTimeline.Ed(h);
          a.Ob && a.ha.$g || f.Oc(a.ha.start, a.ha.duration ? a.ha.start + a.ha.duration : Infinity, b);
          g && (g.segmentIndex = f);
          return { rc: function() {
            f && 0 != f.getNumReferences() || f.ke(h);
            return Promise.resolve(f);
          } };
        }
        function bv(a) {
          return a.Zb;
        }
        function cv(a) {
          var b = ev(a);
          a = Du(a, bv);
          var c = a.Ld;
          0 == c && (c = 1);
          var d = 0;
          a.Wa ? d = a.Wa * (c - 1) : a.timeline && 0 < a.timeline.length && (d = a.timeline[0].start);
          return { Wa: a.Wa, startTime: d, Ld: c, hc: a.hc, timeline: a.timeline, Xc: b };
        }
        function dv(a, b, c, d, e, f, g, h, k2, l) {
          var m = d.Xc.length;
          d.timeline && d.timeline.length != d.Xc.length && (m = Math.min(d.timeline.length, d.Xc.length));
          for (var n = a - d.hc, p = b ? a + b : Infinity, q = [], u = d.startTime, w = {}, v = 0; v < m; w = { Je: void 0, ze: void 0 }, v++) {
            w.ze = d.Xc[v];
            var x = u;
            u = void 0;
            u = null != d.Wa ? x + d.Wa : d.timeline ? d.timeline[v].end : x + b;
            w.Je = null;
            w = new Nj(a + x, a + u, /* @__PURE__ */ function(z) {
              return function() {
                null == z.Je && (z.Je = Xc(c(), [z.ze.cj], l()));
                return z.Je;
              };
            }(w), w.ze.start, w.ze.end, e, n, a, p, [], "", null, null, Oj, f);
            w.codecs = h;
            w.mimeType = g;
            w.bandwidth = k2;
            q.push(w);
          }
          return q;
        }
        function ev(a) {
          return [a.J.Zb, a.ga.Zb, a.qa.Zb].filter(Kf).map(function(b) {
            return Yd(b, "SegmentURL");
          }).reduce(function(b, c) {
            return 0 < b.length ? b : c;
          }).map(function(b) {
            b.attributes.indexRange && !a.Lf && (a.Lf = true);
            var c = Pc(b.attributes.media);
            b = he(b, "mediaRange", me, { start: 0, end: null });
            return { cj: c, start: b.start, end: b.end };
          });
        }
        function fv(a, b, c, d, e, f, g, h, k2) {
          k2 || a.J.de || (a.J.de = Eu(a, gv, "initialization"));
          var l = a.J.de ? hv(a, g) : null, m = iv(a);
          jv(m);
          var n = Od(a);
          if (m.vd) return $u(a, l), { rc: function() {
            var w = Cu(m.vd, n.J.originalId, null, null, n.bandwidth || null, null);
            w = Xc(n.J.Ua(), [w]);
            return Zu(n, b, l, w, 0, null, m.hc);
          } };
          if (m.Wa) return d || "image" === a.ga.contentType || "text" === a.ga.contentType || (c = a.ha.start, d = a.qa.id, k2 = a.ha.duration, d = (d = null != d && f.get(d) || k2) ? c + d : Infinity, a.presentationTimeline.Tf(m.Wa), a.presentationTimeline.jh(c, d)), { rc: function() {
            return kv(
              n,
              m,
              e,
              l,
              f,
              g,
              h,
              a.J.Ae
            );
          } };
          var p = null;
          d = d = null;
          a.qa.id && a.J.id && (d = a.qa.id + "," + a.J.id, d = c.get(d)) && (p = d.segmentIndex);
          var q = a.ha.start, u = a.ha.duration ? q + a.ha.duration : Infinity;
          p ? (c = p, lv(c, m, q, u, l), c.Oa(a.presentationTimeline.pb())) : p = new mv(m, a.J.originalId, a.bandwidth, a.J.Ua, a.vb, q, u, l, g, a.J.Ae);
          m.timeline && "image" !== a.ga.contentType && "text" !== a.ga.contentType && a.presentationTimeline.kh(p.h ? p.h.timeline : [], q);
          d && a.Ob && (d.segmentIndex = p);
          return { rc: function() {
            p instanceof mv && 0 == p.getNumReferences() && lv(
              p,
              m,
              q,
              u,
              l
            );
            return Promise.resolve(p);
          } };
        }
        function gv(a) {
          return a.ic;
        }
        function iv(a) {
          var b = Du(a, gv), c = Eu(a, gv, "media"), d = Eu(a, gv, "index"), e = Eu(a, gv, "k"), f = 0;
          e && (f = parseInt(e, 10));
          return { He: b.He, Wa: b.Wa, timescale: b.timescale, Ld: b.Ld, hc: b.hc, wg: b.wg, timeline: b.timeline, ec: c && Pc(c), vd: d, mimeType: a.J.mimeType, codecs: a.J.codecs, bandwidth: a.bandwidth, dj: f };
        }
        function jv(a) {
          var b = a.vd ? 1 : 0;
          b += a.timeline ? 1 : 0;
          b += a.Wa ? 1 : 0;
          if (0 == b) throw new U(2, 4, 4002);
          1 != b && (a.vd && (a.timeline = null), a.He = null, a.Wa = null);
          if (!a.vd && !a.ec) throw new U(2, 4, 4002);
        }
        function kv(a, b, c, d, e, f, g, h) {
          function k2(J) {
            var L = J - v, N = L * w, P = b.He, O = L * P;
            "BigInt" in window2 && O > Number.MAX_SAFE_INTEGER && (O = BigInt(L) * BigInt(P));
            N += p;
            L = N + w;
            P = Math.min(L, m());
            var R = [], S = b.dj;
            if (S) for (var pa = (P - N) / S, Z = {}, Fa = 0; Fa < S; Z = { Eh: void 0 }, Fa++) {
              var Ia = N + pa * Fa, sa = Ia + pa;
              Z.Eh = Fa + 1;
              Z = new Nj(Ia, sa, /* @__PURE__ */ function(ka) {
                return function() {
                  var Ca = Cu(x, C, J, ka.Eh, z, O);
                  return Xc(D(), [Ca], G());
                };
              }(Z), 0, null, d, B, p, m(), [], "", null, null, Oj, f);
              Z.codecs = a.J.codecs;
              Z.mimeType = a.J.mimeType;
              0 == h ? 0 < Fa && Z.Vc() : 0 != Fa % h && Z.Vc();
              R.push(Z);
            }
            N = new Nj(N, P, function() {
              if (S) return [];
              var ka = Cu(x, C, J, null, z, O);
              return Xc(D(), [ka], G());
            }, 0, null, d, B, p, m(), R, "", null, null, Oj, f, 0 < R.length);
            N.codecs = a.J.codecs;
            N.mimeType = a.J.mimeType;
            N.bandwidth = a.bandwidth;
            N.j = L;
            return N;
          }
          function l() {
            var J = [Math.max(n.pb(), p), Math.min(n.cc(), m())].map(function(L) {
              return L - p;
            });
            J = [Math.ceil(J[0] / w), Math.ceil(J[1] / w) - 1];
            a.J.cb && J[1]++;
            return J.map(function(L) {
              return L + v;
            });
          }
          function m() {
            var J = null != q && e.get(q) || u;
            return J ? p + J : Infinity;
          }
          var n = a.presentationTimeline, p = a.ha.start, q = a.qa.id, u = a.ha.duration, w = b.Wa, v = b.Ld, x = b.ec, z = a.bandwidth || null, C = a.J.id, D = a.J.Ua, G = a.vb, B = p - b.hc, A = l();
          c = a.Ob ? Math.max(A[0], A[1] - c + 1) : A[0];
          g = g || A[1];
          A = [];
          for (var H = c; H <= g; ++H) {
            var E = k2(H);
            A.push(E);
          }
          var K = new Sl(A);
          A = n.cc() < m();
          H = n.U();
          if (A || H) {
            var M = Math.max(c, g + 1);
            c = w;
            a.J.cb && (c = 0.1);
            K.Ie(c, function() {
              var J = n.pb();
              K.Oa(J);
              var L = t(l());
              L.next();
              L = L.next().value;
              for (var N = []; M <= L; ) {
                var P = k2(M);
                N.push(P);
                M++;
              }
              return J > m() && !N.length ? null : N;
            });
          }
          return Promise.resolve(K);
        }
        function hv(a, b) {
          var c = a.J.de;
          c || (c = Eu(a, gv, "initialization"));
          if (!c) return null;
          c = Pc(c);
          var d = a.J.originalId, e = a.bandwidth || null, f = a.J.Ua, g = a.vb;
          b = new Lj(function() {
            var h = Cu(c, d, null, null, e, null);
            return Xc(f(), [h], g());
          }, 0, null, Uu(a), null, null, b, a.ga.encrypted);
          b.codecs = a.J.codecs;
          b.mimeType = a.J.mimeType;
          a.ha && (b.g = a.ha.start + a.ha.duration);
          return b;
        }
        function mv(a, b, c, d, e, f, g, h, k2, l) {
          Sl.call(this, []);
          this.h = a;
          this.F = b;
          this.B = c;
          this.C = d;
          this.H = e;
          this.j = f;
          this.l = g;
          this.u = h;
          this.A = k2;
          this.G = l;
          nv(this);
        }
        qa(mv, Sl);
        r = mv.prototype;
        r.getNumReferences = function() {
          return this.h ? this.h.timeline.length : 0;
        };
        r.release = function() {
          Sl.prototype.release.call(this);
          this.h = null;
        };
        r.Oa = function(a) {
          if (this.h) {
            for (var b = 0, c = this.h.timeline, d = 0; d < c.length; d += 1) if (c[d].end + this.j <= a) b += 1;
            else break;
            0 < b && (this.h.timeline = c.slice(b), this.g.length >= b && (this.g = this.g.slice(b)), this.i += b, 0 === this.getNumReferences() && this.release());
          }
        };
        function lv(a, b, c, d, e) {
          ov(a, e);
          if (a.h) {
            c = a.h.timeline;
            a.h.ec !== b.ec && (a.h.ec = b.ec);
            if (c.length) {
              var f = c[c.length - 1];
              b = b.timeline.filter(function(g) {
                return g.end > f.end;
              });
            } else b = b.timeline.slice();
            0 < b.length && a.h.timeline.push.apply(a.h.timeline, y(b));
            a.l !== d && (a.l = d);
          } else a.h = b, a.j = c, a.l = d;
          nv(a);
        }
        function ov(a, b) {
          if (a.u !== b) {
            a.u = b;
            a = t(a.g);
            for (var c = a.next(); !c.done; c = a.next()) (c = c.value) && Qj(c, b);
          }
        }
        function nv(a) {
          if (a.h && !a.o) {
            for (var b = [], c = t(a.h.timeline), d = c.next(); !d.done; d = c.next()) d = d.value, d.start >= a.l || 0 >= d.end || b.push(d);
            a.h.timeline = b;
            a.Oa(a.j);
          }
        }
        r.find = function(a) {
          if (this.h && this.h.timeline && this.h.timeline.length && a < this.h.timeline[0].start + this.j) return this.i;
          if (!this.h) return null;
          var b = this.h.timeline;
          if (a < this.j || a >= this.l) return null;
          for (var c = b.length - 1, d = 0; d < b.length; d++) {
            var e = b[d], f = e.start + this.j;
            e = d < c ? b[d + 1].start + this.j : Infinity === this.l ? e.end + this.j : this.l;
            if (a >= f && a < e) return d + this.i;
          }
          return null;
        };
        r.get = function(a) {
          var b = this;
          a -= this.i;
          if (0 > a || a >= this.getNumReferences() || !this.h) return null;
          var c = this.g[a];
          if (!c) {
            var d = this.h.timeline[a], e = d.wj, f = d.xg + this.h.wg;
            c = this.j - this.h.hc;
            var g = this.j + d.end, h = g;
            a === this.getNumReferences() - 1 && Infinity !== this.l && (h = this.l);
            for (var k2 = this.h.codecs, l = this.h.mimeType, m = this.h.bandwidth, n = [], p = (d.end - d.start) / d.Jb, q = {}, u = 0; u < d.Jb; q = { Ke: void 0, Fh: void 0 }, u++) {
              var w = d.start + p * u, v = w + p;
              q.Fh = u + 1;
              q.Ke = null;
              q = new Nj(this.j + w, this.j + v, /* @__PURE__ */ function(x) {
                return function() {
                  if (!b.h) return [];
                  null == x.Ke && (x.Ke = pv(b.h.ec, b.F, e, b.B, f, x.Fh, b.C, b.H));
                  return x.Ke;
                };
              }(q), 0, null, this.u, c, this.j, this.l, [], "", null, null, Oj, this.A);
              q.codecs = k2;
              q.mimeType = l;
              q.bandwidth = m;
              0 == this.G ? 0 < u && q.Vc() : 0 != u % this.G && q.Vc();
              n.push(q);
            }
            c = new Nj(this.j + d.start, h, function() {
              return 0 < d.Jb || !b.h ? [] : pv(b.h.ec, b.F, e, b.B, f, null, b.C, b.H);
            }, 0, null, this.u, c, this.j, this.l, n, "", null, null, Oj, this.A, 0 < d.Jb);
            c.codecs = k2;
            c.mimeType = l;
            c.j = g;
            c.bandwidth = m;
            this.g[a] = c;
          }
          return c;
        };
        r.Eb = function(a) {
          nv(this);
          for (var b = 0; b < this.getNumReferences(); b++) {
            var c = this.get(b + this.i);
            c && a(c);
          }
        };
        function pv(a, b, c, d, e, f, g, h) {
          a = Cu(a, b, c, f, d || null, e);
          return Xc(g(), [a], h()).map(function(k2) {
            return k2.toString();
          });
        }
        function qv(a) {
          this.o = null;
          this.A = a;
          this.G = new eh();
          this.i = [];
          this.h = null;
          this.m = [];
          this.B = null;
          this.F = [];
          this.C = 300;
          this.l = /* @__PURE__ */ new Map();
          this.j = /* @__PURE__ */ new Map();
          this.g = null;
          this.u = "UNKNOWN";
        }
        qv.prototype.configure = function(a) {
          this.o = a;
        };
        qv.prototype.destroy = function() {
          this.A = this.o = null;
          this.i = [];
          this.h = null;
          this.m = [];
          this.F = [];
          this.l.clear();
          null != this.g && (this.g.stop(), this.g = null);
          return this.G.destroy();
        };
        qv.prototype.setManifestType = function(a) {
          this.u = a;
        };
        function rv(a, b) {
          var c, d, e, f, g, h, k2;
          return Q(function(l) {
            if (1 == l.g) return c = Xc(a.i, [sv(a, b)]), d = lh(c, a.o.retryParameters), e = a.A.networkingEngine.request(8, d), fh(a.G, e), xa(l, 2), F(l, e.promise, 4);
            if (2 != l.g) return f = l.h, g = Hc(f.data), h = JSON.parse(g), 1 == h.VERSION && tv(a, h, f.uri), Aa(l, 0);
            if ((k2 = Ba(l)) && 7001 == k2.code) return l.return();
            null != a.g && (a.g.stop(), a.g = null);
            a.g = new ec(function() {
              rv(a, b);
            });
            a.g.da(a.C);
            I(l);
          });
        }
        function sv(a, b) {
          if (!a.m.length) return b;
          b = new yb(b);
          var c = a.B || a.m[0], d = Math.round(a.A.getBandwidthEstimate()), e = b.g;
          "DASH" == a.u ? (e.add("_DASH_pathway", c), e.add("_DASH_throughput", String(d))) : "HLS" == a.u && (e.add("_HLS_pathway", c), e.add("_HLS_throughput", String(d)));
          Nb(e) && Cb(b, e);
          return b.toString();
        }
        function tv(a, b, c) {
          null != a.g && (a.g.stop(), a.g = null);
          var d = b["RELOAD-URI"] || c;
          a.g = new ec(function() {
            rv(a, d);
          });
          if (c = b.TTL) a.C = c;
          a.g.da(a.C);
          a.m = b["PATHWAY-PRIORITY"] || [];
          a.F = b["PATHWAY-CLONES"] || [];
        }
        function uv(a, b, c, d) {
          var e = a.l.get(b);
          e || (e = /* @__PURE__ */ new Map());
          e.set(c, d);
          a.l.set(b, e);
        }
        qv.prototype.banLocation = function(a) {
          this.j.set(a, Date.now() + 6e4);
        };
        function vv(a, b, c) {
          c = void 0 === c ? false : c;
          b = a.l.get(b) || /* @__PURE__ */ new Map();
          for (var d = [], e = t(a.m), f = e.next(), g = {}; !f.done; g = { Zc: void 0 }, f = e.next()) if (g.Zc = f.value, f = b.get(g.Zc)) d.push({ Yf: g.Zc, location: f });
          else if (f = a.F.find(/* @__PURE__ */ function(k2) {
            return function(l) {
              return l.ek == k2.Zc;
            };
          }(g))) {
            var h = b.get(f["BASE-ID"]);
            h && (f["URI-REPLACEMENT"].Oh ? (h = new yb(h), Ab(h, f["URI-REPLACEMENT"].Oh), d.push({ Yf: g.Zc, location: h.toString() })) : d.push({ Yf: g.Zc, location: h }));
          }
          e = Date.now();
          g = t(a.j.keys());
          for (f = g.next(); !f.done; f = g.next()) f = f.value, h = a.j.get(f), e > h && a.j.delete(f);
          d = d.filter(function(k2) {
            for (var l = t(a.j.keys()), m = l.next(); !m.done; m = l.next()) if (m.value.includes(new yb(k2.location).nb)) return false;
            return true;
          });
          d.length && (a.B = d[0].Yf);
          d = d.map(function(k2) {
            return k2.location;
          });
          if (!d.length && a.h) {
            for (e = t(a.h.split(",")), g = e.next(); !g.done; g = e.next()) if (g = b.get(g.value)) a.B = a.h, d.push(g);
          }
          if (!d.length) for (b = t(b.values()), e = b.next(); !e.done; e = b.next()) d.push(e.value);
          return c ? d : Xc(a.i, d);
        }
        function wv() {
          this.l = [];
          this.h = [];
          this.g = [];
          this.j = [];
          this.i = [];
          this.u = this.o = false;
          this.m = /* @__PURE__ */ new Set();
        }
        r = wv.prototype;
        r.release = function() {
          for (var a = t(this.h.concat(this.g, this.j, this.i)), b = a.next(); !b.done; b = a.next()) b = b.value, b.segmentIndex && b.segmentIndex.release();
          this.h = [];
          this.g = [];
          this.j = [];
          this.i = [];
          this.l = [];
          this.u = this.o = false;
          this.m.clear();
        };
        r.Ki = function() {
          return this.l;
        };
        r.Jf = function() {
          return this.j.slice();
        };
        r.oi = function() {
          return this.i;
        };
        r.Kg = function(a, b) {
          if (a) {
            if ("audio" == a.type) for (var c = t(this.h), d = c.next(); !d.done; d = c.next()) d = d.value, d.matchedStreams = d.matchedStreams.filter(function(e) {
              return e !== a;
            });
            else if ("video" == a.type) for (c = t(this.g), d = c.next(); !d.done; d = c.next()) d = d.value, d.matchedStreams = d.matchedStreams.filter(function(e) {
              return e !== a;
            }), d.trickModeVideo && (d.trickModeVideo.matchedStreams = d.trickModeVideo.matchedStreams.filter(function(e) {
              return e !== a;
            })), d.dependencyStream && (d.dependencyStream.matchedStreams = d.dependencyStream.matchedStreams.filter(function(e) {
              return e !== a;
            }));
            else if (a.type == dd) for (c = t(this.j), d = c.next(); !d.done; d = c.next()) d = d.value, d.matchedStreams = d.matchedStreams.filter(function(e) {
              return e !== a;
            });
            else if ("image" == a.type) for (c = t(this.i), d = c.next(); !d.done; d = c.next()) d = d.value, d.matchedStreams = d.matchedStreams.filter(function(e) {
              return e !== a;
            });
            a.segmentIndex && a.closeSegmentIndex();
            this.m.delete(b);
          }
        };
        function xv(a, b) {
          var c = [], d = [], e = [], f = [];
          a = t(a);
          for (var g = a.next(); !g.done; g = a.next()) {
            var h = g.value;
            g = new Map(h.audioStreams.map(function(n) {
              return [yv(n), n];
            }));
            var k2 = new Map(h.videoStreams.map(function(n) {
              return [zv(n), n];
            })), l = new Map(h.textStreams.map(function(n) {
              return [Av(n), n];
            }));
            h = new Map(h.imageStreams.map(function(n) {
              return [Bv(n), n];
            }));
            if (b) {
              var m = Cv(dd);
              l.set(Av(m), m);
              m = Cv("image");
              h.set(Bv(m), m);
            }
            c.push(g);
            d.push(k2);
            e.push(l);
            f.push(h);
          }
          return { Dg: c, Mh: d, Ih: e, Yg: f };
        }
        r.gf = function(a, b, c) {
          c = void 0 === c ? false : c;
          var d = this, e, f, g, h, k2, l, m, n, p, q, u, w, v, x, z, C, D, G, B, A, H, E, K, M, J, L, N, P, O, R, S, pa;
          return Q(function(Z) {
            if (1 == Z.g) {
              e = fd;
              if (!b && 1 == a.length) return f = xv(a, false), g = f.Dg, h = f.Mh, k2 = f.Ih, l = f.Yg, d.h = Array.from(g[0].values()), d.g = Array.from(h[0].values()), d.j = Array.from(k2[0].values()), d.i = Array.from(l[0].values()), Z.s(2);
              m = c ? d.m.size : 0;
              n = -1;
              for (p = 0; p < a.length; p++) q = a[p], d.m.has(q.id) || (d.m.add(q.id), -1 == n && (n = p));
              if (-1 == n) return Z.return();
              u = xv(a, true);
              w = u.Dg;
              v = u.Mh;
              x = u.Ih;
              z = u.Yg;
              return F(Z, Promise.all([Dv(d, d.h, w, n, Ev, Fv, m), Dv(d, d.g, v, n, Ev, Fv, m), Dv(d, d.j, x, n, Ev, Fv, m), Dv(d, d.i, z, n, Ev, Fv, m)]), 2);
            }
            C = 0;
            D = [];
            if (d.g.length && d.h.length) for (M = t(d.h), J = M.next(); !J.done; J = M.next()) for (L = J.value, N = t(d.g), P = N.next(); !P.done; P = N.next()) O = P.value, R = Zb(L.drmInfos, O.drmInfos), L.drmInfos.length && O.drmInfos.length && !R.length || (S = (L.bandwidth || 0) + (O.bandwidth || 0), L.dependencyStream && (S += L.dependencyStream.bandwidth || 0), O.dependencyStream && (S += O.dependencyStream.bandwidth || 0), pa = C++, D.push({
              id: pa,
              language: L.language,
              disabledUntilTime: 0,
              primary: L.primary,
              audio: L,
              video: O,
              bandwidth: S,
              drmInfos: R,
              allowedByApplication: true,
              allowedByKeySystem: true,
              decodingInfos: []
            }));
            else for (G = d.g.length ? d.g : d.h, B = t(G), A = B.next(); !A.done; A = B.next()) H = A.value, E = C++, K = H.bandwidth || 0, H.dependencyStream && (K += H.dependencyStream.bandwidth || 0), D.push({
              id: E,
              language: H.language,
              disabledUntilTime: 0,
              primary: H.primary,
              audio: H.type == e.V ? H : null,
              video: H.type == e.la ? H : null,
              bandwidth: K,
              drmInfos: H.drmInfos,
              allowedByApplication: true,
              allowedByKeySystem: true,
              decodingInfos: []
            });
            d.l = D;
            I(Z);
          });
        };
        function Gv(a) {
          var b, c, d, e, f, g, h, k2, l, m, n, p, q, u, w, v, x, z, C, D, G, B, A, H, E, K, M, J, L, N;
          return Q(function(P) {
            switch (P.g) {
              case 1:
                b = fd;
                if (1 == a.length) return P.return(a[0]);
                c = a.map(function(O) {
                  return new Map(O.filter(function(R) {
                    return R.type === b.V;
                  }).map(function(R) {
                    return [yv(R), R];
                  }));
                });
                d = a.map(function(O) {
                  return new Map(O.filter(function(R) {
                    return R.type === b.la;
                  }).map(function(R) {
                    return [zv(R), R];
                  }));
                });
                e = a.map(function(O) {
                  return new Map(O.filter(function(R) {
                    return R.type === b.za;
                  }).map(function(R) {
                    return [Av(R), R];
                  }));
                });
                f = a.map(function(O) {
                  return new Map(O.filter(function(R) {
                    return R.type === b.$e;
                  }).map(function(R) {
                    return [Bv(R), R];
                  }));
                });
                g = t(e);
                for (h = g.next(); !h.done; h = g.next()) k2 = h.value, l = Hv(b.za), k2.set(Av(l), l);
                m = t(f);
                for (n = m.next(); !n.done; n = m.next()) p = n.value, q = Hv(b.$e), p.set(Bv(q), q);
                u = new wv();
                return F(P, Dv(u, [], c, 0, Iv, Jv, 0), 2);
              case 2:
                return w = P.h, F(P, Dv(u, [], d, 0, Iv, Jv, 0), 3);
              case 3:
                return v = P.h, F(P, Dv(u, [], e, 0, Iv, Jv, 0), 4);
              case 4:
                return x = P.h, F(P, Dv(u, [], f, 0, Iv, Jv, 0), 5);
              case 5:
                z = P.h;
                C = 0;
                if (v.length && w.length) for (H = t(w), E = H.next(); !E.done; E = H.next()) for (K = E.value, M = t(v), J = M.next(); !J.done; J = M.next()) L = J.value, N = C++, L.variantIds.push(N), K.variantIds.push(N);
                else for (D = v.concat(w), G = t(D), B = G.next(); !B.done; B = G.next()) A = B.value, A.variantIds = [C++];
                return P.return(v.concat(w).concat(x).concat(z));
            }
          });
        }
        function Dv(a, b, c, d, e, f, g) {
          var h, k2, l, m, n, p, q, u, w, v, x, z, C, D, G, B, A, H, E;
          return Q(function(M) {
            switch (M.g) {
              case 1:
                h = [];
                for (k2 = 0; k2 < c.length; k2++) k2 >= d ? h.push(new Set(c[k2].values())) : h.push(/* @__PURE__ */ new Set());
                l = t(b);
                m = l.next();
              case 2:
                if (m.done) {
                  M.s(4);
                  break;
                }
                n = m.value;
                return F(M, Kv(a, n, c, d, f, h, g), 5);
              case 5:
                p = M.h;
                if (!p) throw new U(2, 4, 4037);
                m = l.next();
                M.s(2);
                break;
              case 4:
                q = t(h);
                for (u = q.next(); !u.done; u = q.next()) for (w = u.value, v = t(w), x = v.next(); !x.done; x = v.next()) z = x.value, (C = aw(a, z, c, e, f, h)) && b.push(C);
                D = t(h);
                for (G = D.next(); !G.done; G = D.next()) for (B = G.value, A = t(B), H = A.next(), E = {}; !H.done; E = { ng: void 0 }, H = A.next()) if (E.ng = H.value, !bw(E.ng) && b.some(/* @__PURE__ */ function(J) {
                  return function(L) {
                    return cw(a, J.ng, L);
                  };
                }(E))) throw new U(2, 4, 4037);
                return M.return(b);
            }
          });
        }
        function Kv(a, b, c, d, e, f, g) {
          return Q(function(h) {
            if (1 == h.g) return dw(a, c, b, 0 < g), b.matchedStreams ? b.segmentIndex ? F(h, ew(b, d + g), 2) : h.s(2) : h.return(false);
            fw(b, d, e, f, g);
            return h.return(true);
          });
        }
        function ew(a, b) {
          var c, d, e, f, g, h;
          return Q(function(k2) {
            if (1 == k2.g) {
              c = [];
              d = a.matchedStreams;
              for (e = b; e < d.length; e++) f = d[e], c.push(f.createSegmentIndex()), f.trickModeVideo && !f.trickModeVideo.segmentIndex && c.push(f.trickModeVideo.createSegmentIndex()), f.dependencyStream && !f.dependencyStream.segmentIndex && c.push(f.dependencyStream.createSegmentIndex());
              return F(k2, Promise.all(c), 2);
            }
            if (a.segmentIndex instanceof Vl) for (g = b; g < d.length; g++) h = d[g], h.segmentIndex && a.segmentIndex.h.push(h.segmentIndex);
            I(k2);
          });
        }
        function aw(a, b, c, d, e, f) {
          if (bw(b)) return null;
          var g = d(b);
          dw(a, c, g);
          g.createSegmentIndex && (g.createSegmentIndex = function() {
            return Q(function(h) {
              if (g.segmentIndex) return h.s(0);
              g.segmentIndex = new Vl();
              return F(h, ew(g, 0), 0);
            });
          });
          if (!g.matchedStreams || !g.matchedStreams.length) return null;
          fw(g, 0, e, f, 0);
          return g;
        }
        function fw(a, b, c, d, e) {
          var f = a.matchedStreams;
          for (b += e; b < f.length; b++) {
            var g = f[b];
            c(a, g);
            var h = true;
            "audio" == a.type && 0 == Uf(a.language, g.language) && (h = false);
            if (h && (d[b - e].delete(g), g.fullMimeTypes)) for (g = t(g.fullMimeTypes.values()), h = g.next(); !h.done; h = g.next()) a.fullMimeTypes.add(h.value);
          }
        }
        function Ev(a) {
          var b = Object.assign({}, a);
          b.originalId = null;
          b.createSegmentIndex = function() {
            return Promise.resolve();
          };
          b.closeSegmentIndex = function() {
            b.segmentIndex && (b.segmentIndex.release(), b.segmentIndex = null);
            if (b.matchedStreams) for (var c = t(b.matchedStreams), d = c.next(); !d.done; d = c.next()) d = d.value, d.segmentIndex && (d.segmentIndex.release(), d.segmentIndex = null);
          };
          b.roles = b.roles.slice();
          b.segmentIndex = null;
          b.emsgSchemeIdUris = [];
          b.keyIds = new Set(a.keyIds);
          b.closedCaptions = a.closedCaptions ? new Map(a.closedCaptions) : null;
          b.trickModeVideo = null;
          b.dependencyStream = null;
          return b;
        }
        function Iv(a) {
          var b = Object.assign({}, a);
          b.roles = b.roles.slice();
          b.keyIds = new Set(a.keyIds);
          b.segments = [];
          b.variantIds = [];
          b.closedCaptions = a.closedCaptions ? new Map(a.closedCaptions) : null;
          return b;
        }
        function Fv(a, b) {
          function c(g, h) {
            g || (g = []);
            h = t(h);
            for (var k2 = h.next(); !k2.done; k2 = h.next()) k2 = k2.value, g.includes(k2) || g.push(k2);
            return g;
          }
          a.roles = c(a.roles, b.roles);
          b.emsgSchemeIdUris && (a.emsgSchemeIdUris = c(a.emsgSchemeIdUris, b.emsgSchemeIdUris));
          for (var d = t(b.keyIds), e = d.next(); !e.done; e = d.next()) a.keyIds.add(e.value);
          null == a.originalId ? a.originalId = b.originalId : (d = b.originalId || "") && !a.originalId.endsWith(d) && (a.originalId += "," + d);
          d = Zb(a.drmInfos, b.drmInfos);
          if (b.drmInfos.length && a.drmInfos.length && !d.length) throw new U(
            2,
            4,
            4038
          );
          a.drmInfos = d;
          a.encrypted = a.encrypted || b.encrypted;
          if (b.closedCaptions) for (a.closedCaptions || (a.closedCaptions = /* @__PURE__ */ new Map()), d = t(b.closedCaptions), e = d.next(); !e.done; e = d.next()) {
            var f = t(e.value);
            e = f.next().value;
            f = f.next().value;
            a.closedCaptions.set(e, f);
          }
          a.bandwidth && b.bandwidth && (a.bandwidth = Math.max(a.bandwidth, b.bandwidth));
          b.trickModeVideo ? (a.trickModeVideo || (a.trickModeVideo = Ev(b.trickModeVideo), a.trickModeVideo.matchedStreams = [], a.trickModeVideo.createSegmentIndex = function() {
            if (a.trickModeVideo.segmentIndex) return Promise.resolve();
            for (var g = new Vl(), h = t(a.trickModeVideo.matchedStreams), k2 = h.next(); !k2.done; k2 = h.next()) g.h.push(k2.value.segmentIndex);
            a.trickModeVideo.segmentIndex = g;
            return Promise.resolve();
          }), a.trickModeVideo.matchedStreams.push(b.trickModeVideo), Fv(a.trickModeVideo, b.trickModeVideo)) : a.trickModeVideo && (a.trickModeVideo.matchedStreams.push(b), Fv(a.trickModeVideo, b));
          b.dependencyStream ? (a.dependencyStream || (a.dependencyStream = Ev(b.dependencyStream), a.dependencyStream.matchedStreams = [], a.dependencyStream.createSegmentIndex = function() {
            if (a.dependencyStream.segmentIndex) return Promise.resolve();
            for (var g = new Vl(), h = t(a.dependencyStream.matchedStreams), k2 = h.next(); !k2.done; k2 = h.next()) g.h.push(k2.value.segmentIndex);
            a.dependencyStream.segmentIndex = g;
            return Promise.resolve();
          }), a.dependencyStream.matchedStreams.push(b.dependencyStream), Fv(a.dependencyStream, b.dependencyStream)) : a.dependencyStream && (a.dependencyStream.matchedStreams.push(b), Fv(a.dependencyStream, b));
        }
        function Jv(a, b) {
          var c = a.roles;
          c || (c = []);
          for (var d = t(b.roles), e = d.next(); !e.done; e = d.next()) e = e.value, c.includes(e) || c.push(e);
          a.roles = c;
          c = t(b.keyIds);
          for (d = c.next(); !d.done; d = c.next()) a.keyIds.add(d.value);
          a.encrypted = a.encrypted && b.encrypted;
          a.segments.push.apply(a.segments, y(b.segments));
          if (b.closedCaptions) for (a.closedCaptions || (a.closedCaptions = /* @__PURE__ */ new Map()), b = t(b.closedCaptions), c = b.next(); !c.done; c = b.next()) d = t(c.value), c = d.next().value, d = d.next().value, a.closedCaptions.set(c, d);
        }
        function dw(a, b, c, d) {
          d = (void 0 === d ? 0 : d) ? c.matchedStreams : [];
          b = t(b);
          for (var e = b.next(); !e.done; e = b.next()) {
            e = gw(a, e.value, c);
            if (!e) return;
            d.push(e);
          }
          c.matchedStreams = d;
        }
        function gw(a, b, c) {
          var d = { audio: yv, video: zv, text: Av, image: Bv }[c.type], e = null, f = d(c);
          if (b.has(f)) e = b.get(f);
          else {
            f = { audio: function(l, m) {
              return cw(a, l, m);
            }, video: function(l, m) {
              return cw(a, l, m);
            }, text: hw, image: iw }[c.type];
            for (var g = { audio: jw, video: kw, text: lw, image: mw }[c.type], h = t(b.values()), k2 = h.next(); !k2.done; k2 = h.next()) k2 = k2.value, !f(c, k2) || c.fastSwitching != k2.fastSwitching || e && !g(c, e, k2) || (e = k2);
          }
          a.u && !bw(e) && b.delete(d(e));
          return e;
        }
        function nw(a, b) {
          return a.mimeType != b.mimeType ? false : ow(a.codecs) === ow(b.codecs);
        }
        r.uh = function(a) {
          this.o = a;
        };
        r.Ah = function(a) {
          this.u = a;
        };
        function cw(a, b, c) {
          return !nw(b, c) && !a.o || b.drmInfos && !Yb(b.drmInfos, c.drmInfos) ? false : true;
        }
        function hw(a, b) {
          return b.language ? a.forced !== b.forced || 0 == Uf(a.language, b.language) || b.kind != a.kind ? false : true : true;
        }
        function iw() {
          return true;
        }
        function jw(a, b, c) {
          var d = nw(a, b), e = nw(a, c);
          if (d && !e) return false;
          if (!d && e) return true;
          d = Uf(a.language, b.language);
          e = Uf(a.language, c.language);
          if (e > d) return true;
          if (e < d) return false;
          if (b.label !== c.label) {
            if (a.label === b.label) return false;
            if (a.label === c.label) return true;
          }
          if (a.roles.length) {
            d = b.roles.filter(function(f) {
              return a.roles.includes(f);
            });
            e = c.roles.filter(function(f) {
              return a.roles.includes(f);
            });
            if (e.length > d.length) return true;
            if (e.length < d.length) return false;
            if (c.roles.length !== b.roles.length) return c.roles.length < b.roles.length;
          } else {
            if (!c.roles.length && b.roles.length) return true;
            if (c.roles.length && !b.roles.length) return false;
          }
          if (!b.primary && c.primary) return true;
          if (b.primary && !c.primary) return false;
          d = pw(a.channelsCount, b.channelsCount, c.channelsCount);
          if (d == qw) return true;
          if (d == rw) return false;
          d = pw(a.audioSamplingRate, b.audioSamplingRate, c.audioSamplingRate);
          return d == qw ? true : d == rw ? false : a.bandwidth && sw(a.bandwidth, b.bandwidth, c.bandwidth) == qw ? true : false;
        }
        function kw(a, b, c) {
          var d = nw(a, b), e = nw(a, c);
          if (d && !e) return false;
          if (!d && e) return true;
          d = pw(a.width * a.height, b.width * b.height, c.width * c.height);
          if (d == qw) return true;
          if (d == rw) return false;
          if (a.frameRate) {
            d = pw(a.frameRate, b.frameRate, c.frameRate);
            if (d == qw) return true;
            if (d == rw) return false;
          }
          return a.bandwidth && sw(a.bandwidth, b.bandwidth, c.bandwidth) == qw ? true : false;
        }
        function lw(a, b, c) {
          var d = Uf(a.language, b.language), e = Uf(a.language, c.language);
          if (e > d) return true;
          if (e < d) return false;
          if (!b.primary && c.primary) return true;
          if (b.primary && !c.primary) return false;
          if (b.label !== c.label) {
            if (a.label === b.label) return false;
            if (a.label === c.label) return true;
          }
          if (a.roles.length) {
            d = b.roles.filter(function(f) {
              return a.roles.includes(f);
            });
            e = c.roles.filter(function(f) {
              return a.roles.includes(f);
            });
            if (e.length > d.length) return true;
            if (e.length < d.length) return false;
          } else {
            if (!c.roles.length && b.roles.length) return true;
            if (c.roles.length && !b.roles.length) return false;
          }
          return c.mimeType != a.mimeType || c.codecs != a.codecs || b.mimeType == a.mimeType && b.codecs == a.codecs ? false : true;
        }
        function mw(a, b, c) {
          return pw(a.width * a.height, b.width * b.height, c.width * c.height) == qw ? true : false;
        }
        function Hv(a) {
          return { id: 0, originalId: "", groupId: null, primary: false, type: a, mimeType: "", codecs: "", language: "", originalLanguage: null, label: null, width: null, height: null, encrypted: false, keyIds: /* @__PURE__ */ new Set(), segments: [], variantIds: [], roles: [], forced: false, channelsCount: null, audioSamplingRate: null, spatialAudio: false, closedCaptions: null, external: false, fastSwitching: false, isAudioMuxedInVideo: false, baseOriginalId: null };
        }
        function Cv(a) {
          return {
            id: 0,
            originalId: "",
            groupId: null,
            createSegmentIndex: function() {
              return Promise.resolve();
            },
            segmentIndex: new Sl([]),
            mimeType: "",
            codecs: "",
            encrypted: false,
            drmInfos: [],
            keyIds: /* @__PURE__ */ new Set(),
            language: "",
            originalLanguage: null,
            label: null,
            type: a,
            primary: false,
            trickModeVideo: null,
            dependencyStream: null,
            emsgSchemeIdUris: null,
            roles: [],
            forced: false,
            channelsCount: null,
            audioSamplingRate: null,
            spatialAudio: false,
            closedCaptions: null,
            accessibilityPurpose: null,
            external: false,
            fastSwitching: false,
            fullMimeTypes: /* @__PURE__ */ new Set(),
            isAudioMuxedInVideo: false,
            baseOriginalId: null
          };
        }
        function pw(a, b, c) {
          if (b == a && a != c) return rw;
          if (c == a && a != b) return qw;
          if (b > a) {
            if (c <= a || c - a < b - a) return qw;
            if (c - a > b - a) return rw;
          } else {
            if (c > a) return rw;
            if (a - c < a - b) return qw;
            if (a - c > a - b) return rw;
          }
          return tw;
        }
        function sw(a, b, c) {
          b = Math.abs(a - b);
          a = Math.abs(a - c);
          return a < b ? qw : b < a ? rw : tw;
        }
        function bw(a) {
          switch (a.type) {
            case dd:
              return !a.language;
            case "image":
              return !a.tilesLayout;
            default:
              return false;
          }
        }
        function zv(a) {
          return JSON.stringify([a.fastSwitching, a.width, a.frameRate, ow(a.codecs), a.mimeType, a.label, a.roles, a.closedCaptions ? Array.from(a.closedCaptions.entries()) : null, a.bandwidth, a.dependencyStream ? a.dependencyStream.baseOriginalId : null, Array.from(a.keyIds)]);
        }
        function yv(a) {
          return JSON.stringify([a.fastSwitching, a.channelsCount, a.language, a.bandwidth, a.label, ow(a.codecs), a.mimeType, a.roles, a.audioSamplingRate, a.primary, a.dependencyStream ? a.dependencyStream.baseOriginalId : null, Array.from(a.keyIds)]);
        }
        function Av(a) {
          return JSON.stringify([a.language, a.label, a.codecs, a.mimeType, a.bandwidth, a.roles]);
        }
        function Bv(a) {
          return JSON.stringify([a.width, a.codecs, a.mimeType]);
        }
        function ow(a) {
          if (!uw.has(a)) {
            var b = sf(a);
            uw.set(a, b);
          }
          return uw.get(a);
        }
        T("shaka.util.PeriodCombiner", wv);
        wv.prototype.setUseStreamOnce = wv.prototype.Ah;
        wv.prototype.setAllowMultiTypeVariants = wv.prototype.uh;
        wv.prototype.combinePeriods = wv.prototype.gf;
        wv.prototype.deleteStream = wv.prototype.Kg;
        wv.prototype.getImageStreams = wv.prototype.oi;
        wv.prototype.getTextStreams = wv.prototype.Jf;
        wv.prototype.getVariants = wv.prototype.Ki;
        var qw = 1, tw = 0, rw = -1, uw = /* @__PURE__ */ new Map();
        function vw(a, b) {
          var c = new DOMParser(), d = ww.value()(a);
          a = null;
          try {
            a = c.parseFromString(d, "text/xml");
          } catch (e) {
            return null;
          }
          c = a.documentElement;
          if (!c || c.getElementsByTagName("parsererror").length || c.tagName != b) return null;
          if (!("createNodeIterator" in document)) return c;
          for (b = document.createNodeIterator(a, NodeFilter.SHOW_ALL); a = b.nextNode(); ) if (a instanceof HTMLElement || a instanceof SVGElement) return null;
          return c;
        }
        function xw(a, b) {
          try {
            var c = Kc(a);
            return vw(c, b);
          } catch (d) {
            return null;
          }
        }
        var ww = new Xb(function() {
          if ("undefined" !== typeof trustedTypes) {
            var a = trustedTypes.createPolicy("shaka-player#xml", { createHTML: function(b) {
              return b;
            } });
            return function(b) {
              return a.createHTML(b);
            };
          }
          return function(b) {
            return b;
          };
        });
        function yw() {
          var a = this;
          this.j = this.g = null;
          this.A = [];
          this.i = null;
          this.pa = 1;
          this.F = [];
          this.l = { me: "", type: "", profiles: [], Wb: null, cb: 0, Ua: null, Id: 0 };
          this.u = /* @__PURE__ */ new Map();
          this.o = /* @__PURE__ */ new Map();
          this.B = /* @__PURE__ */ new Map();
          this.ka = /* @__PURE__ */ new Map();
          this.m = new wv();
          this.I = 0;
          this.oa = new Xa(5);
          this.K = new ec(function() {
            if (a.H && !a.g.continueLoadingWhenPaused && (a.G.Ja(a.H, "timeupdate"), a.H.paused)) {
              a.G.ma(a.H, "timeupdate", function() {
                return zw(a);
              });
              return;
            }
            zw(a);
          });
          this.O = new eh();
          this.M = null;
          this.C = [];
          this.Z = Infinity;
          this.fa = false;
          this.h = null;
          this.L = 0;
          this.P = false;
          this.G = new lb();
          this.H = null;
          this.T = false;
          this.Y = "";
          this.ea = function() {
            return false;
          };
          this.W = [];
        }
        r = yw.prototype;
        r.configure = function(a, b) {
          var c = this.j && a.updatePeriod != this.g.updatePeriod && 0 <= a.updatePeriod;
          this.g = a;
          b && (this.ea = b);
          c && this.i && this.i.presentationTimeline.U() && this.K.sb();
          this.h && this.h.configure(this.g);
          this.m && (this.m.uh(this.g.dash.multiTypeVariantsAllowed && od()), this.m.Ah(this.g.dash.useStreamOnceInPeriodFlattening));
        };
        r.start = function(a, b) {
          var c = this, d;
          return Q(function(e) {
            if (1 == e.g) return c.fa = b.isLowLatencyMode(), c.A = [a], c.j = b, F(e, Aw(c), 2);
            d = e.h;
            c.j && Bw(c, d);
            if (!c.j) throw new U(2, 7, 7001);
            return e.return(c.i);
          });
        };
        r.stop = function() {
          for (var a = t(this.o.values()), b = a.next(); !b.done; b = a.next()) b = b.value, b.segmentIndex && b.segmentIndex.release();
          this.m && this.m.release();
          this.g = this.j = null;
          this.A = [];
          this.i = null;
          this.o.clear();
          this.B.clear();
          this.u.clear();
          this.l = { me: "", type: "", profiles: [], Wb: null, cb: 0, Ua: null, Id: 0 };
          this.m = null;
          null != this.K && (this.K.stop(), this.K = null);
          this.h && this.h.destroy();
          this.G && (this.G.release(), this.G = null);
          return this.O.destroy();
        };
        r.update = function() {
          var a = this, b;
          return Q(function(c) {
            if (1 == c.g) return xa(c, 2), F(c, Aw(a), 4);
            if (2 != c.g) return Aa(c, 0);
            b = Ba(c);
            if (!a.j || !b) return c.return();
            a.j.onError(b);
            I(c);
          });
        };
        r.onExpirationUpdated = function() {
        };
        r.onInitialVariantChosen = function(a) {
          if (this.i && this.i.presentationTimeline.U()) {
            var b = a.video || a.audio;
            if (b && b.segmentIndex) {
              a = this.i.presentationTimeline.cc();
              var c = b.segmentIndex.find(a);
              null != c && (b = b.segmentIndex.get(c)) && (this.I = b.endTime - a, Bw(this, 0));
            }
          }
        };
        r.banLocation = function(a) {
          this.h && this.h.banLocation(a);
        };
        r.setMediaElement = function(a) {
          this.H = a;
        };
        function Aw(a) {
          var b, c, d, e, f, g, h, k2, l, m, n;
          return Q(function(p) {
            if (1 == p.g) return b = 4, c = "MPD", d = Cw(a), e = a.A, d.length ? (e = d, c = "Patch", b = 6) : 1 < a.A.length && a.h && (f = vv(a.h, "Location", true), f.length && (e = f)), g = lh(e, a.g.retryParameters), h = Date.now(), F(p, Dw(a, g, 0, { type: b }), 2);
            if (3 != p.g) {
              k2 = p.h;
              if (!a.j) return p.return(0);
              k2.uri && k2.uri != k2.originalUri && !a.A.includes(k2.uri) && a.A.unshift(k2.uri);
              l = new yb(k2.uri);
              a.Y = l.g.toString();
              return F(p, Ew(a, k2.data, k2.uri, c), 3);
            }
            m = Date.now();
            n = (m - h) / 1e3;
            a.oa.sample(1, n);
            return p.return(n);
          });
        }
        function Ew(a, b, c, d) {
          var e, f, g, h, k2, l, m, p, q, u;
          return Q(function(w) {
            if (1 == w.g) {
              e = b;
              f = a.g.dash.manifestPreprocessor;
              g = Kn;
              if (f != g) {
                sb("manifest.dash.manifestPreprocessor configuration", "Please Use manifest.dash.manifestPreprocessorTXml instead.");
                h = xw(e, d);
                if (!h) throw new U(2, 4, 4001, c);
                f(h);
                e = Lc(h.outerHTML);
              }
              k2 = Qd(e, d);
              if (!k2) throw new U(2, 4, 4001, c);
              l = a.g.dash.manifestPreprocessorTXml;
              m = Ln;
              l != m && l(k2);
              if ("Patch" === d) return w.return(Fw(a, k2));
              if (a.g.dash.disableXlinkProcessing) return w.return(Gw(a, k2, c));
              p = a.g.dash.xlinkFailGracefully;
              q = Iu(k2, a.g.retryParameters, p, c, a.j.networkingEngine);
              fh(a.O, q);
              return F(w, q.promise, 2);
            }
            u = w.h;
            return w.return(Gw(a, u, c));
          });
        }
        function Gw(a, b, c) {
          var d, e, f, g, h, k2, l, m, n, p, q, u, w, v, x, C, D, G, B, A, H, E, K, M, J, L, N, P, O, R, S, pa, Z, Fa, Ia, sa, ka, Ca, ra, ya, na, ta, Pa, ob, eb, jb, ub, ye, Oc, de, Qf, Rf;
          return Q(function(Zc) {
            switch (Zc.g) {
              case 1:
                a.h && a.h.l.clear();
                d = [c];
                e = [];
                f = /* @__PURE__ */ new Map();
                g = Yd(b, "Location");
                h = t(g);
                for (k2 = h.next(); !k2.done; k2 = h.next()) if (l = k2.value, m = l.attributes.serviceLocation, n = $d(l)) p = Xc(d, [n])[0], m && (a.h ? uv(a.h, "Location", m, p) : f.set(m, p)), e.push(p);
                a.h ? (q = vv(a.h, "Location", true), 0 < q.length && (d = a.A = q)) : e.length && (d = a.A = e);
                a.l.me = b.attributes.id || "";
                a.l.Id = he(b, "publishTime", ke) || 0;
                a.F = Yd(b, "PatchLocation");
                u = Promise.resolve();
                if ((w = be(b, "ContentSteering")) && a.j) {
                  v = w.attributes.defaultServiceLocation;
                  if (a.h) a.h.i = d, a.h.h = v;
                  else if (a.h = new qv(a.j), a.h.configure(a.g), a.h.setManifestType("DASH"), a.h.i = d, a.h.h = v, x = $d(w)) he(w, "queryBeforeStart", re, false) ? u = rv(a.h, x) : rv(a.h, x);
                  C = t(f.keys());
                  for (D = C.next(); !D.done; D = C.next()) G = D.value, B = f.get(G), uv(a.h, "Location", G, B);
                }
                A = Yd(b, "BaseURL");
                H = false;
                if (a.h) for (E = t(A), K = E.next(); !K.done; K = E.next()) M = K.value, J = M.attributes.serviceLocation, L = $d(M), J && L && (uv(a.h, "BaseURL", J, L), H = true);
                a.W = null;
                H && a.h || (N = A.map($d), a.W = Xc(d, N));
                P = function() {
                  return a.h && H ? vv(a.h, "BaseURL") : a.W ? a.W : [];
                };
                a.l.Ua = P;
                O = 0;
                A && A.length && (O = he(A[0], "availabilityTimeOffset", qe) || 0);
                a.l.cb = O;
                a.I = he(b, "minimumUpdatePeriod", le, -1);
                R = he(b, "availabilityStartTime", ke);
                S = he(b, "timeShiftBufferDepth", le);
                pa = a.g.dash.ignoreSuggestedPresentationDelay;
                Z = null;
                pa || (Z = he(b, "suggestedPresentationDelay", le));
                Fa = a.g.dash.ignoreMaxSegmentDuration;
                Ia = null;
                Fa || (Ia = he(b, "maxSegmentDuration", le));
                sa = b.attributes.type || "static";
                a.i && a.i.presentationTimeline && (a.T = a.i.presentationTimeline.U() && "static" == sa);
                a.l.type = sa;
                if (a.i) for (ka = a.i.presentationTimeline, Ca = ka.pb(), ra = t(a.o.values()), ya = ra.next(); !ya.done; ya = ra.next()) na = ya.value, na.segmentIndex && na.segmentIndex.Oa(Ca);
                else ta = a.g.dash.ignoreMinBufferTime, Pa = 0, ta || (Pa = he(b, "minBufferTime", le) || 0), ob = 0, ob = null != Z ? Math.min(Z, S || Infinity) : 0 < a.g.defaultPresentationDelay ? a.g.defaultPresentationDelay : Math.min(1.5 * Pa, S || Infinity), ka = new xl(R, ob, a.g.dash.autoCorrectDrift);
                ka.Gc("static" == sa);
                ka.U() && !isNaN(a.g.availabilityWindowOverride) && (S = a.g.availabilityWindowOverride);
                null == S && (S = Infinity);
                ka.Ce(S);
                eb = b.attributes.profiles || "";
                a.l.profiles = eb.split(",");
                jb = { Ob: "static" != sa, presentationTimeline: ka, qa: null, ha: null, ga: null, J: null, bandwidth: 0, Lf: false, cb: O, Wb: null, profiles: eb.split(","), roles: null, vb: function() {
                  return "";
                } };
                return F(Zc, u, 2);
              case 2:
                a.L = 0;
                ub = Hw(a, jb, P, b, false);
                ye = ub.duration;
                Oc = ub.periods;
                ("static" != sa || a.T) && ub.Mg || ka.bb(ye || Infinity);
                a.P && a.fa && ka.vh(a.Z);
                ka.Tf(Ia || 1);
                a.P && a.fa && (de = null != Z ? Z : a.g.defaultPresentationDelay, ka.jg(de));
                if (!a.i) return F(Zc, a.m.gf(Oc, jb.Ob), 6);
                a.i.periodCount = Oc.length;
                a.i.gapCount = a.L;
                return F(Zc, Iw(a, Oc, false), 4);
              case 6:
                a.i = {
                  presentationTimeline: ka,
                  variants: a.m.l,
                  textStreams: a.m.Jf(),
                  imageStreams: a.m.i,
                  offlineSessionIds: [],
                  sequenceMode: a.g.dash.sequenceMode,
                  ignoreManifestTimestampsInSegmentsMode: false,
                  type: "DASH",
                  serviceDescription: Jw(b),
                  nextUrl: Kw(b),
                  periodCount: Oc.length,
                  gapCount: a.L,
                  isLowLatency: a.P,
                  startTime: null
                };
                if (!ka.Kh()) {
                  Zc.s(7);
                  break;
                }
                Qf = Yd(b, "UTCTiming");
                return F(Zc, Lw(a, P, Qf), 8);
              case 8:
                Rf = Zc.h;
                if (!a.j) return Zc.return();
                ka.wh(Rf);
              case 7:
                ka.ie(), a.m && !a.i.presentationTimeline.U() && a.m.release();
              case 4:
                a.j.makeTextStreamsForClosedCaptions(a.i), Mw(a), I(Zc);
            }
          });
        }
        function Iw(a, b, c) {
          var d;
          return Q(function(e) {
            if (1 == e.g) return F(e, a.m.gf(b, true, c), 2);
            a.i.variants = a.m.l;
            d = a.m.Jf();
            0 < d.length && (a.i.textStreams = d);
            a.i.imageStreams = a.m.i;
            a.j.filter(a.i);
            I(e);
          });
        }
        function Fw(a, b) {
          var c, d, e, f, g, h, k2, l, m, n, p, q, u, w, v, x, z, C, D, G, B, A, H, E, K, M, J;
          return Q(function(L) {
            if (1 == L.g) {
              c = b.attributes.mpdId;
              d = he(b, "originalPublishTime", ke);
              if (!c || c !== a.l.me || d !== a.l.Id) throw a.F = [], new U(1, 4, 4052);
              e = [];
              f = [];
              g = /* @__PURE__ */ new Set();
              h = t(Xd(b));
              for (k2 = h.next(); !k2.done; k2 = h.next()) if (l = k2.value, m = te(l.attributes.sel || ""), n = m[m.length - 1], p = $d(l) || "", "MPD" === n.name) if ("mediaPresentationDuration" === n.ac) {
                q = $d(l) || "";
                var N = le(q);
                if (null != N) {
                  a.l.Wb = N;
                  for (var P = t(a.u.values()), O = P.next(); !O.done; O = P.next()) O.value.Wb = N;
                }
              } else if ("type" === n.ac) {
                a.i.presentationTimeline.Gc("static" == p);
                a.l.type = p;
                N = t(a.u.values());
                for (P = N.next(); !P.done; P = N.next()) P.value.Ob = "dynamic" == p;
                "static" == p && (a.I = -1);
              } else "publishTime" === n.ac ? a.l.Id = ke(p) || 0 : null === n.ac && "add" === l.tagName && f.push(l);
              else if ("PatchLocation" === n.name) ue(a.F, l);
              else if ("Period" === n.name) "add" === l.tagName ? f.push(l) : "remove" === l.tagName && n.id && Nw(a, n.id);
              else if ("SegmentTemplate" === n.name) {
                P = te(l.attributes.sel || "");
                N = P[P.length - 1];
                if (N.ac) {
                  P = Ow(a, P);
                  O = $d(l) || "";
                  for (var R = t(P), S = R.next(); !S.done; S = R.next()) S = a.u.get(S.value), we(S.J.ic, l.tagName, N.ac, O);
                  N = P;
                } else N = [];
                u = N;
                w = t(u);
                for (v = w.next(); !v.done; v = w.next()) x = v.value, g.add(x);
              } else if ("SegmentTimeline" === n.name || "S" === n.name) {
                N = te(l.attributes.sel || "");
                N = Ow(a, N);
                P = t(N);
                for (O = P.next(); !O.done; O = P.next()) O = a.u.get(O.value), O = Fu(O, gv, "SegmentTimeline"), R = Yd(O, "S"), ue(R, l), O.children = R;
                z = N;
                C = t(z);
                for (D = C.next(); !D.done; D = C.next()) G = D.value, g.add(G);
              }
              B = t(g);
              for (A = B.next(); !A.done; A = B.next()) H = A.value, Pw(
                a,
                H
              );
              E = t(f);
              for (K = E.next(); !K.done; K = E.next()) M = K.value, e.push.apply(e, y(Qw(a, M)));
              if (!e.length) return L.s(2);
              a.i.periodCount += e.length;
              a.i.gapCount = a.L;
              return F(L, Iw(a, e, true), 2);
            }
            "static" == a.l.type && (J = a.l.Wb, a.i.presentationTimeline.bb(J || Infinity));
            I(L);
          });
        }
        function Qw(a, b) {
          return Hw(a, { Ob: "dynamic" == a.l.type, presentationTimeline: a.i.presentationTimeline, qa: null, ha: null, ga: null, J: null, bandwidth: 0, Lf: false, cb: a.l.cb, profiles: a.l.profiles, Wb: a.l.Wb, roles: null, vb: function() {
            return "";
          } }, a.l.Ua, b, true).periods;
        }
        function Nw(a, b) {
          a.i.periodCount--;
          for (var c = t(a.u.keys()), d = c.next(); !d.done; d = c.next()) if (d = d.value, d.startsWith(b)) {
            var e = a.u.get(d);
            Fu(e, gv, "SegmentTimeline").children = [];
            Pw(a, d);
            a.u.delete(d);
          }
          a.C = a.C.filter(function(f) {
            return f !== b;
          });
        }
        function Ow(a, b) {
          var c = "", d = "", e = -1, f = "";
          b = t(b);
          for (var g = b.next(); !g.done; g = b.next()) g = g.value, "Period" === g.name ? c = g.id : "AdaptationSet" === g.name ? (d = g.id, null !== g.position && (e = g.position)) : "Representation" === g.name && (f = g.id);
          b = [];
          if (f) b.push(c + "," + f);
          else if (d) for (e = t(a.u.values()), a = e.next(); !a.done; a = e.next()) a = a.value, a.qa.id === c && a.ga.id === d && a.J.id && b.push(c + "," + a.J.id);
          else if (-1 < e) for (d = t(a.u.values()), a = d.next(); !a.done; a = d.next()) a = a.value, a.qa.id === c && a.ga.position === e && a.J.id && b.push(c + "," + a.J.id);
          return b;
        }
        function Pw(a, b) {
          var c = a.u.get(b), d = a.o.get(b);
          d.segmentIndex && d.segmentIndex.Oa(a.i.presentationTimeline.pb());
          try {
            var e = fv(c, function(f, g, h, k2) {
              return Rw(a, f, g, h, k2);
            }, a.o, true, a.g.dash.initialSegmentLimit, a.ka, c.J.aesKey, null, true);
            d.createSegmentIndex = function() {
              return Q(function(f) {
                if (1 == f.g) return d.segmentIndex ? f.s(0) : F(f, e.rc(), 3);
                d.segmentIndex = f.h;
                I(f);
              });
            };
          } catch (f) {
            if (b = c.J.contentType, b != dd && "application" != b && "image" != b || 4002 != f.code) throw f;
          }
        }
        function Jw(a) {
          var b = be(a, "ServiceDescription");
          if (!b) return null;
          a = be(b, "Latency");
          b = be(b, "PlaybackRate");
          if (!a && !b) return null;
          var c = {};
          a && ("target" in a.attributes && (c.targetLatency = parseInt(a.attributes.target, 10) / 1e3), "max" in a.attributes && (c.maxLatency = parseInt(a.attributes.max, 10) / 1e3), "min" in a.attributes && (c.minLatency = parseInt(a.attributes.min, 10) / 1e3));
          b && ("max" in b.attributes && (c.maxPlaybackRate = parseFloat(b.attributes.max)), "min" in b.attributes && (c.minPlaybackRate = parseFloat(b.attributes.min)));
          return c;
        }
        function Kw(a) {
          a = Yd(a, "SupplementalProperty");
          if (!a.length) return null;
          a = t(a);
          for (var b = a.next(); !b.done; b = a.next()) if (b = b.value, "urn:mpeg:dash:chaining:2016" == b.attributes.schemeIdUri) return b.attributes.value;
          return null;
        }
        function Hw(a, b, c, d, e) {
          var f = b.Wb;
          f || (f = he(d, "mediaPresentationDuration", le), a.l.Wb = f);
          var g = 0;
          a.i && a.i.presentationTimeline && a.T && (g = a.i.presentationTimeline.Hb());
          var h = [], k2 = g;
          d = Yd(d, "Period");
          for (var l = 0; l < d.length; l++) {
            var m = d[l], n = d[l + 1], p = he(m, "start", le, k2), q = m.attributes.id, u = he(m, "duration", le);
            p = 0 == l && 0 == p && a.T ? g : p;
            var w = null;
            if (n) {
              var v = he(n, "start", le);
              null != v && (w = v - p + g);
            } else null != f && (w = f - p + g);
            v = gd;
            w && u && Math.abs(w - u) > v && w > u && a.L++;
            null == w && (w = u);
            if (!(null !== a.M && null !== q && null !== p && p < a.M) || a.C.includes(q) || l + 1 == d.length) {
              null !== p && (null === a.M || p > a.M) && (a.M = p);
              k2 = Sw(a, b, c, { start: p, duration: w, node: m, $g: null == w || !n });
              h.push(k2);
              b.qa.id && w && a.ka.set(b.qa.id, w);
              if (null == w) {
                k2 = null;
                break;
              }
              k2 = p + w;
            }
          }
          if (e) for (b = t(h), c = b.next(); !c.done; c = b.next()) c = c.value.id, a.C.includes(c) || a.C.push(c);
          else a.C = h.map(function(x) {
            return x.id;
          });
          return null != f ? { periods: h, duration: f + g, Mg: false } : { periods: h, duration: k2, Mg: true };
        }
        function Mw(a) {
          var b = Array.from(a.B.keys()).filter(function(h) {
            return !a.C.includes(h);
          });
          b = t(b);
          for (var c = b.next(); !c.done; c = b.next()) {
            c = c.value;
            for (var d = true, e = t(a.B.get(c)), f = e.next(); !f.done; f = e.next()) {
              f = f.value;
              var g = a.o.get(f);
              g && (g.segmentIndex && 0 != g.segmentIndex.getNumReferences() ? d = false : (a.m && a.m.Kg(g, c), a.o.delete(f)));
            }
            d && a.B.delete(c);
          }
        }
        function Sw(a, b, c, d) {
          b.qa = Tw(a, d.node, null, c);
          b.ha = d;
          b.qa.cb = b.cb;
          b.qa.id || (b.qa.id = "__shaka_period_" + d.start);
          var e = Yd(d.node, "EventStream");
          c = b.presentationTimeline.pb();
          e = t(e);
          for (var f = e.next(); !f.done; f = e.next()) Uw(a, d.start, d.duration, f.value, c);
          c = Yd(d.node, "SupplementalProperty");
          c = t(c);
          for (e = c.next(); !e.done; e = c.next()) if (e = e.value, "urn:mpeg:dash:urlparam:2014" == e.attributes.schemeIdUri && (e = Vw(a, e))) b.vb = e;
          c = Yd(d.node, "AdaptationSet").map(function(q, u) {
            return Ww(a, b, u, q);
          }).filter(Kf);
          if (b.Ob) {
            e = [];
            f = t(c);
            for (var g = f.next(); !g.done; g = f.next()) {
              g = t(g.value.rj);
              for (var h = g.next(); !h.done; h = g.next()) e.push(h.value);
            }
            if (e.length != new Set(e).size) throw new U(2, 4, 4018);
          }
          e = /* @__PURE__ */ new Map();
          f = t(c);
          for (g = f.next(); !g.done; g = f.next()) for (g = t(g.value.ei), h = g.next(); !h.done; h = g.next()) {
            var k2 = t(h.value);
            h = k2.next().value;
            k2 = k2.next().value;
            e.set(h, k2);
          }
          if (e.size) for (f = null, g = t(c), h = g.next(); !h.done; h = g.next()) {
            h = h.value;
            k2 = [];
            for (var l = t(h.streams), m = l.next(), n = {}; !m.done; n = { og: void 0 }, m = l.next()) if (n.og = m.value, e.has(n.og.originalId)) {
              f || (f = Yd(d.node, "AdaptationSet").map(function(q, u) {
                return Ww(a, b, u, q);
              }).filter(Kf));
              m = t(f);
              for (var p = m.next(); !p.done; p = m.next()) if (p = p.value.streams.find(/* @__PURE__ */ function(q) {
                return function(u) {
                  return u.originalId == q.og.originalId;
                };
              }(n))) p.dependencyStream = e.get(p.originalId), k2.push(p);
            }
            k2.length && h.streams.push.apply(h.streams, y(k2));
          }
          d = c.filter(function(q) {
            return !q.vg;
          });
          c = c.filter(function(q) {
            return q.vg;
          });
          if (!a.g.disableIFrames) {
            for (c = t(c), e = c.next(); !e.done; e = c.next()) for (e = e.value, f = e.vg.split(" "), g = t(d), h = g.next(); !h.done; h = g.next()) if (h = h.value, f.includes(h.id)) for (h = t(h.streams), k2 = h.next(); !k2.done; k2 = h.next()) Kg(k2.value, e.streams);
          }
          c = Xw(a.g.disableAudio, d, "audio");
          e = Xw(a.g.disableVideo, d, "video");
          f = Xw(a.g.disableText, d, dd);
          d = Xw(a.g.disableThumbnails, d, "image");
          if (0 === e.length && 0 === c.length) throw new U(2, 4, 4004);
          return { id: b.qa.id, audioStreams: c, videoStreams: e, textStreams: f, imageStreams: d };
        }
        function Xw(a, b, c) {
          return a || !b.length ? [] : b.reduce(function(d, e) {
            if (e.contentType != c) return d;
            d.push.apply(d, y(e.streams));
            return d;
          }, []);
        }
        function Ww(a, b, c, d) {
          function e(J) {
            var L = J.attributes["dvb:fontFamily"];
            J = J.attributes["dvb:url"];
            L && J && (J = Xc(b.ga.Ua(), [J], b.vb()), a.j.addFont(L, J[0]));
          }
          function f(J) {
            switch (J) {
              case 1:
              case 5:
              case 6:
              case 7:
                return "srgb";
              case 9:
                return "rec2020";
              case 11:
              case 12:
                return "p3";
            }
          }
          function g(J) {
            switch (J) {
              case 1:
              case 6:
              case 13:
              case 14:
              case 15:
                return "SDR";
              case 16:
                return "PQ";
              case 18:
                return "HLG";
            }
          }
          b.ga = Tw(a, d, b.qa, null);
          b.ga.position = c;
          var h = false;
          c = Yd(d, "Role");
          var k2 = c.map(function(J) {
            return J.attributes.value;
          }).filter(Kf), l = void 0, m = b.ga.contentType == dd;
          m && (l = "subtitle");
          c = t(c);
          for (var n = c.next(); !n.done; n = c.next()) {
            n = n.value;
            var p = n.attributes.schemeIdUri;
            if (null == p || "urn:mpeg:dash:role:2011" == p) switch (n = n.attributes.value, n) {
              case "main":
                h = true;
                break;
              case "caption":
              case "subtitle":
                l = n;
            }
          }
          var q = Yd(d, "EssentialProperty");
          c = null;
          var u = false;
          n = null;
          p = false;
          q = t(q);
          for (var w = q.next(); !w.done; w = q.next()) {
            w = w.value;
            var v = w.attributes.schemeIdUri;
            if ("http://dashif.org/guidelines/trickmode" == v) c = w.attributes.value;
            else if ("urn:mpeg:mpegB:cicp:TransferCharacteristics" == v) var x = g(parseInt(w.attributes.value, 10));
            else if ("urn:mpeg:mpegB:cicp:ColourPrimaries" == v) var z = f(parseInt(w.attributes.value, 10));
            else "urn:mpeg:mpegB:cicp:MatrixCoefficients" != v && ("urn:mpeg:dash:ssr:2023" == v && a.g.dash.enableFastSwitching ? u = true : "urn:dvb:dash:fontdownload:2014" == v ? e(w) : "urn:mpeg:dash:urlparam:2014" == v ? (n = Vw(a, w)) || (p = true) : p = true);
          }
          if (p) return null;
          var C = null;
          p = Yd(d, "SupplementalProperty");
          p = t(p);
          for (q = p.next(); !q.done; q = p.next()) q = q.value, w = q.attributes.schemeIdUri, "http://dashif.org/guidelines/last-segment-number" == w ? C = parseInt(q.attributes.value, 10) - 1 : "urn:mpeg:mpegB:cicp:TransferCharacteristics" == w ? x = g(parseInt(q.attributes.value, 10)) : "urn:mpeg:mpegB:cicp:ColourPrimaries" == w ? z = f(parseInt(q.attributes.value, 10)) : "urn:dvb:dash:fontdownload:2014" == w ? e(q) : "urn:mpeg:dash:urlparam:2014" == w && (n = Vw(a, q));
          n && (b.vb = n);
          n = Yd(d, "Accessibility");
          var D = /* @__PURE__ */ new Map(), G;
          n = t(n);
          for (p = n.next(); !p.done; p = n.next()) if (q = p.value, p = q.attributes.schemeIdUri, q = q.attributes.value, "urn:scte:dash:cc:cea-608:2015" != p || a.g.disableText) if ("urn:scte:dash:cc:cea-708:2015" != p || a.g.disableText) "urn:mpeg:dash:role:2011" == p ? null != q && (k2.push(q), "captions" == q && (l = "caption")) : "urn:tva:metadata:cs:AudioPurposeCS:2007" == p && ("1" == q ? G = "visually impaired" : "2" == q && (G = "hard of hearing"));
          else if (p = 1, null != q) for (q = t(q.split(";")), w = q.next(); !w.done; w = q.next()) {
            v = w.value;
            var B = w = void 0;
            v.includes("=") ? (v = v.split("="), w = "svc" + v[0], B = v[1].split(",")[0].split(":").pop()) : (w = "svc" + p, p++, B = v);
            D.set(w, Of(B));
          }
          else D.set("svc1", "und");
          else if (p = 1, null != q) for (q = q.split(";"), w = t(q), v = w.next(); !v.done; v = w.next()) {
            B = v.value;
            var A = v = void 0;
            B.includes("=") ? (B = B.split("="), v = B[0].startsWith("CC") ? B[0] : "CC" + B[0], A = B[1] || "und") : (v = "CC" + p, 2 == q.length ? p += 2 : p++, A = B);
            D.set(v, Of(A));
          }
          else D.set("CC1", "und");
          n = Yd(d, "ContentProtection");
          var H = uu(n, a.g.ignoreDrmInfo, a.g.dash.keySystemsByURI);
          b.ga.encrypted = 0 < n.length;
          var E = Of(b.ga.language || "und"), K = b.ga.label, M = /* @__PURE__ */ new Map();
          d = Yd(d, "Representation");
          if (!a.g.ignoreSupplementalCodecs) {
            n = [];
            p = t(d);
            for (q = p.next(); !q.done; q = p.next()) if (w = q.value, q = ie(
              w,
              "urn:scte:dash:scte214-extensions",
              "supplementalCodecs"
            )) w = Nd(w), w.attributes.codecs = q.split(" ").join(","), w.attributes.id && (w.attributes.supplementalId = w.attributes.id + "_supplementalCodecs"), n.push(w);
            d.push.apply(d, y(n));
          }
          n = d.map(function(J) {
            var L = Yw(a, b, H, l, E, K, h, k2, D, J, G, C);
            return L && (L.hdr = L.hdr || x, L.colorGamut = L.colorGamut || z, L.fastSwitching = u, J = J.attributes.dependencyId) ? (L.baseOriginalId = J, M.set(J, L), null) : L;
          }).filter(function(J) {
            return !!J;
          });
          if (0 == n.length && 0 == M.size) {
            c = "image" == b.ga.contentType;
            if (a.g.dash.ignoreEmptyAdaptationSet || m || c) return null;
            throw new U(2, 4, 4003);
          }
          if (!b.ga.contentType || "application" == b.ga.contentType) for (b.ga.contentType = Zw(n[0].mimeType, n[0].codecs), m = t(n), p = m.next(); !p.done; p = m.next()) p.value.type = b.ga.contentType;
          m = b.ga.id || "__fake__" + a.pa++;
          p = t(n);
          for (q = p.next(); !q.done; q = p.next()) {
            q = q.value;
            w = t(H.drmInfos);
            for (v = w.next(); !v.done; v = w.next()) v = v.value, v.keyIds = v.keyIds && q.keyIds ? new Set([].concat(y(v.keyIds), y(q.keyIds))) : v.keyIds || q.keyIds;
            q.groupId = m;
          }
          d = d.map(function(J) {
            return J.attributes.supplementalId || J.attributes.id;
          }).filter(Kf);
          return { id: m, contentType: b.ga.contentType, language: E, Qk: h, streams: n, drmInfos: H.drmInfos, vg: c, rj: d, ei: M };
        }
        function Vw(a, b) {
          if ((b = ce(b, "urn:mpeg:dash:schema:urlparam:2014", "UrlQueryInfo")) && he(b, "useMPDUrlQuery", re, false)) {
            var c = b.attributes.queryTemplate;
            if (c) return function() {
              return "$querypart$" == c ? a.Y : c.split("&").map(function(d) {
                if ("$querypart$" == d) return a.Y;
                var e = /\$query:(.*?)\$/g.exec(d);
                if (e && 2 == e.length) {
                  e = e[1];
                  var f = new Eb(a.Y).get(e);
                  if (f.length) return e + "=" + f[0];
                }
                return d;
              }).join("&");
            };
          }
          return null;
        }
        function Yw(a, b, c, d, e, f, g, h, k2, l, m, n) {
          b.J = Tw(a, l, b.ga, null);
          var p = b.J.id;
          a.Z = Math.min(a.Z, b.J.cb);
          a.P = 0 < a.Z;
          if (!$w(b.J)) return null;
          var q = b.ha.start;
          b.bandwidth = he(l, "bandwidth", oe) || 0;
          b.roles = h;
          var u = Yd(l, "SupplementalProperty"), w = Yd(l, "EssentialProperty"), v = Yd(l, "ContentProtection");
          l = null;
          var x = w.find(function(P) {
            return "urn:mpeg:dash:urlparam:2014" == P.attributes.schemeIdUri;
          });
          x ? l = Vw(a, x) : (x = u.find(function(P) {
            return "urn:mpeg:dash:urlparam:2014" == P.attributes.schemeIdUri;
          })) && (l = Vw(a, x));
          l && (b.vb = l);
          x = b.J.contentType;
          l = x == dd || "application" == x;
          x = "image" == x;
          v.length && (b.ga.encrypted = true);
          try {
            var z = void 0;
            if (c.cf) {
              var C = b.J.Ua, D = b.vb, G = Xc(C(), [c.cf.Xi], D()), B = lh(G, a.g.retryParameters);
              z = { bitsKey: 128, blockCipherMode: "CBC", iv: c.cf.iv, firstMediaSequenceNumber: 0, fetchKey: function() {
                var P, O, R;
                return Q(function(S) {
                  if (1 == S.g) return F(S, Dw(a, B, 6), 2);
                  if (3 != S.g) {
                    P = S.h;
                    if (!P.data || 16 != P.data.byteLength) throw new U(2, 4, 4049);
                    O = { name: "AES-CBC" };
                    R = z;
                    return F(S, window2.crypto.subtle.importKey(
                      "raw",
                      P.data,
                      O,
                      true,
                      ["decrypt"]
                    ), 3);
                  }
                  R.cryptoKey = S.h;
                  z.fetchKey = void 0;
                  I(S);
                });
              } };
            }
            b.J.aesKey = z;
            C = function(P, O, R, S) {
              return Rw(a, P, O, R, S);
            };
            if (b.J.dd) var A = Vu(b, C, z);
            else if (b.J.Zb) A = av(b, a.o, z);
            else if (b.J.ic) A = fv(b, C, a.o, !!a.i, a.g.dash.initialSegmentLimit, a.ka, z, n, false);
            else {
              var H = b.ha.duration || 0, E = b.J.Ua, K = b.J.mimeType, M = b.J.codecs;
              A = { rc: function() {
                var P = Ul(q, H, E());
                P.Eb(function(O) {
                  O.mimeType = K;
                  O.codecs = M;
                });
                return Promise.resolve(P);
              } };
            }
          } catch (P) {
            if ((l || x) && 4002 == P.code) return null;
            throw P;
          }
          n = yu(
            v,
            c,
            a.g.ignoreDrmInfo,
            a.g.dash.keySystemsByURI
          );
          n = new Set(n ? [n] : []);
          v = false;
          u.some(function(P) {
            return "tag:dolby.com,2018:dash:EC3_ExtensionType:2018" == P.attributes.schemeIdUri && "JOC" == P.attributes.value;
          }) && (v = true);
          u = false;
          l && (u = h.includes("forced_subtitle") || h.includes("forced-subtitle"));
          var J;
          if (x && ((w = w.find(function(P) {
            return ["http://dashif.org/thumbnail_tile", "http://dashif.org/guidelines/thumbnail_tile"].includes(P.attributes.schemeIdUri);
          })) && (J = w.attributes.value), !J)) return null;
          var L;
          l = b.J.codecs;
          b.profiles.includes("http://dashif.org/guidelines/dash-if-uhd#hevc-hdr-pq10") && (l.includes("hvc1.2.4.L153.B0") || l.includes("hev1.2.4.L153.B0")) && (L = "PQ");
          w = b.J.id ? b.qa.id + "," + b.J.id : "";
          a.F.length && p && a.u.set(b.qa.id + "," + p, ax(b));
          var N = w && a.o.has(w) ? a.o.get(w) : {
            id: a.pa++,
            originalId: b.J.id,
            groupId: null,
            createSegmentIndex: function() {
              return Promise.resolve();
            },
            closeSegmentIndex: function() {
              N.segmentIndex && (N.segmentIndex.release(), N.segmentIndex = null);
            },
            segmentIndex: null,
            mimeType: b.J.mimeType,
            codecs: l,
            frameRate: b.J.frameRate,
            pixelAspectRatio: b.J.pixelAspectRatio,
            bandwidth: b.bandwidth,
            width: b.J.width,
            height: b.J.height,
            kind: d,
            encrypted: 0 < c.drmInfos.length,
            drmInfos: c.drmInfos,
            keyIds: n,
            language: e,
            originalLanguage: b.ga.language,
            label: f,
            type: b.ga.contentType,
            primary: g,
            trickModeVideo: null,
            dependencyStream: null,
            emsgSchemeIdUris: b.J.emsgSchemeIdUris,
            roles: h,
            forced: u,
            channelsCount: b.J.oe,
            audioSamplingRate: b.J.audioSamplingRate,
            spatialAudio: v,
            closedCaptions: k2,
            hdr: L,
            colorGamut: void 0,
            videoLayout: void 0,
            tilesLayout: J,
            accessibilityPurpose: m,
            external: false,
            fastSwitching: false,
            fullMimeTypes: /* @__PURE__ */ new Set([lf(
              b.J.mimeType,
              b.J.codecs
            )]),
            isAudioMuxedInVideo: false,
            baseOriginalId: null
          };
          N.createSegmentIndex = function() {
            var P;
            return Q(function(O) {
              if (1 == O.g) {
                if (N.segmentIndex) return O.s(0);
                P = N;
                return F(O, A.rc(), 3);
              }
              P.segmentIndex = O.h;
              I(O);
            });
          };
          w && b.Ob && !a.o.has(w) && (b = b.qa.id || "", a.B.has(b) || a.B.set(b, []), a.o.set(w, N), a.B.get(b).push(w));
          return N;
        }
        function ax(a) {
          function b(c) {
            if (!c) return null;
            c = Od(c);
            c.dd = null;
            c.Zb = null;
            c.ic = ze(c.ic);
            return c;
          }
          a = Od(a);
          a.qa = b(a.qa);
          a.ga = b(a.ga);
          a.J = b(a.J);
          a.ha && (a.ha = Od(a.ha), a.ha.node = null);
          return a;
        }
        function zw(a) {
          var b, c;
          return Q(function(d) {
            switch (d.g) {
              case 1:
                return b = 0, xa(d, 2), F(d, Aw(a), 4);
              case 4:
                b = d.h;
                Aa(d, 3);
                break;
              case 2:
                if (c = Ba(d), a.j) {
                  if (a.g.raiseFatalErrorOnManifestUpdateRequestFailure) return a.j.onError(c), d.return();
                  c.severity = 1;
                  a.j.onError(c);
                }
              case 3:
                if (!a.j) return d.return();
                a.j.onManifestUpdated();
                Bw(a, b);
                I(d);
            }
          });
        }
        function Bw(a, b) {
          if (!(0 > a.I)) {
            var c = a.I;
            0 <= a.g.updatePeriod && (c = a.g.updatePeriod);
            a.K.da(Math.max(c - b, Ya(a.oa)));
          }
        }
        function Tw(a, b, c, d) {
          c = c || { contentType: "", mimeType: "", codecs: "", emsgSchemeIdUris: [], frameRate: void 0, pixelAspectRatio: void 0, oe: null, audioSamplingRate: null, cb: 0, Ae: 0, encrypted: false };
          d = d || c.Ua;
          var e = b.attributes.id, f = b.attributes.supplementalId, g = Yd(b, "BaseURL"), h, k2 = false;
          if (a.h) for (var l = t(g), m = l.next(); !m.done; m = l.next()) {
            var n = m.value;
            m = n.attributes.serviceLocation;
            n = $d(n);
            m && n && (uv(a.h, e, m, n), k2 = true);
          }
          k2 && a.h || (h = g.map($d));
          l = b.attributes.contentType || c.contentType;
          m = b.attributes.mimeType || c.mimeType;
          n = wm([b.attributes.codecs || c.codecs]).join(",");
          var p = he(b, "frameRate", se) || c.frameRate, q = b.attributes.sar || c.pixelAspectRatio, u = bx(Yd(b, "InbandEventStream"), c.emsgSchemeIdUris), w = Yd(b, "AudioChannelConfiguration");
          w = cx(w) || c.oe;
          var v = he(b, "audioSamplingRate", pe) || c.audioSamplingRate;
          l || (l = Zw(m, n));
          var x = be(b, "SegmentBase"), z = be(b, "SegmentTemplate"), C = x ? he(x, "availabilityTimeOffset", qe) || 0 : 0, D = z ? he(z, "availabilityTimeOffset", qe) || 0 : 0, G = g && g.length ? he(g[0], "availabilityTimeOffset", qe) || 0 : 0;
          C = c.cb + G + C + D;
          D = null;
          (G = be(b, "SegmentSequenceProperties")) && (G = be(G, "SAP")) && (D = he(G, "cadence", ne));
          G = b.attributes.label;
          var B = Yd(b, "Label");
          B && B.length && (B = B[0], Zd(B) && (G = Zd(B)));
          return {
            Ua: function() {
              return Xc(d(), g.length ? a.h && k2 ? vv(a.h, e) : h ? h : [] : []);
            },
            dd: x || c.dd,
            Zb: be(b, "SegmentList") || c.Zb,
            ic: z || c.ic,
            width: he(b, "width", pe) || c.width,
            height: he(b, "height", pe) || c.height,
            contentType: l,
            mimeType: m,
            codecs: n,
            frameRate: p,
            pixelAspectRatio: q,
            emsgSchemeIdUris: u,
            id: f || e,
            originalId: e,
            language: b.attributes.lang,
            oe: w,
            audioSamplingRate: v,
            cb: C,
            de: null,
            Ae: D || c.Ae,
            label: G || null,
            encrypted: false
          };
        }
        function bx(a, b) {
          b = b.slice();
          a = t(a);
          for (var c = a.next(); !c.done; c = a.next()) c = c.value.attributes.schemeIdUri, b.includes(c) || b.push(c);
          return b;
        }
        function cx(a) {
          a = t(a);
          for (var b = a.next(); !b.done; b = a.next()) {
            b = b.value;
            var c = b.attributes.schemeIdUri;
            if (c && (b = b.attributes.value)) switch (c) {
              case "urn:mpeg:dash:outputChannelPositionList:2012":
                return b.trim().split(/ +/).length;
              case "urn:mpeg:dash:23003:3:audio_channel_configuration:2011":
              case "urn:dts:dash:audio_channel_configuration:2012":
                b = parseInt(b, 10);
                if (!b) continue;
                return b;
              case "tag:dolby.com,2015:dash:audio_channel_configuration:2015":
                c = [2, 1, 2, 2, 2, 2, 1, 2, 2, 1, 1, 1, 1, 2, 1, 1, 2, 2];
                b = parseInt(
                  b,
                  16
                );
                if (!b) continue;
                for (var d = 0, e = 0; e < c.length; e++) b & 1 << e && (d += c[e]);
                if (d) return d;
                continue;
              case "tag:dolby.com,2014:dash:audio_channel_configuration:2011":
              case "urn:dolby:dash:audio_channel_configuration:2011":
                c = [1, 1, 1, 1, 1, 2, 2, 1, 1, 2, 2, 2, 1, 2, 1, 1].reverse();
                b = parseInt(b, 16);
                if (!b) continue;
                for (e = d = 0; e < c.length; e++) b & 1 << e && (d += c[e]);
                if (d) return d;
                continue;
              case "urn:mpeg:mpegB:cicp:ChannelConfiguration":
                if (c = [0, 1, 2, 3, 4, 5, 6, 8, 2, 3, 4, 7, 8, 24, 8, 12, 10, 12, 14, 12, 14], (b = parseInt(b, 10)) && 0 < b && b < c.length) return c[b];
            }
          }
          return null;
        }
        function $w(a) {
          var b = a.dd ? 1 : 0;
          b += a.Zb ? 1 : 0;
          b += a.ic ? 1 : 0;
          if (0 == b) return a.contentType == dd || "application" == a.contentType ? true : false;
          1 != b && (a.dd && (a.Zb = null), a.ic = null);
          return true;
        }
        function dx(a, b, c, d) {
          var e, f, g, h, k2, l, m;
          return Q(function(n) {
            if (1 == n.g) return e = [Pc(c)], f = Xc(b(), e), g = lh(f, a.g.retryParameters), g.method = d, h = a.j.networkingEngine.request(4, g, { isPreload: a.ea() }), fh(a.O, h), F(n, h.promise, 2);
            k2 = n.h;
            if ("HEAD" == d) {
              if (!k2.headers || !k2.headers.date) return n.return(0);
              l = k2.headers.date;
            } else l = Hc(k2.data);
            m = Date.parse(l);
            return isNaN(m) ? n.return(0) : n.return(m - Date.now());
          });
        }
        function Lw(a, b, c) {
          var d, e, f, g, h, k2, l, m;
          return Q(function(n) {
            switch (n.g) {
              case 1:
                d = c.map(function(p) {
                  return { scheme: p.attributes.schemeIdUri, value: p.attributes.value };
                }), e = a.g.dash.clockSyncUri, !d.length && e && d.push({ scheme: "urn:mpeg:dash:utc:http-head:2014", value: e }), f = t(d), g = f.next();
              case 2:
                if (g.done) {
                  n.s(4);
                  break;
                }
                h = g.value;
                xa(n, 5);
                k2 = h.scheme;
                l = h.value;
                switch (k2) {
                  case "urn:mpeg:dash:utc:http-head:2014":
                  case "urn:mpeg:dash:utc:http-head:2012":
                    return n.s(7);
                  case "urn:mpeg:dash:utc:http-xsdate:2014":
                  case "urn:mpeg:dash:utc:http-iso:2014":
                  case "urn:mpeg:dash:utc:http-xsdate:2012":
                  case "urn:mpeg:dash:utc:http-iso:2012":
                    return n.s(8);
                  case "urn:mpeg:dash:utc:direct:2014":
                  case "urn:mpeg:dash:utc:direct:2012":
                    return m = Date.parse(l), n.return(isNaN(m) ? 0 : m - Date.now());
                  case "urn:mpeg:dash:utc:http-ntp:2014":
                  case "urn:mpeg:dash:utc:ntp:2014":
                  case "urn:mpeg:dash:utc:sntp:2014":
                    bb("NTP UTCTiming scheme is not supported");
                    break;
                  default:
                    bb("Unrecognized scheme in UTCTiming element", k2);
                }
                n.s(9);
                break;
              case 7:
                return F(n, dx(a, b, l, "HEAD"), 10);
              case 10:
                return n.return(n.h);
              case 8:
                return F(n, dx(a, b, l, "GET"), 11);
              case 11:
                return n.return(n.h);
              case 9:
                Aa(
                  n,
                  3
                );
                break;
              case 5:
                Ba(n);
              case 3:
                g = f.next();
                n.s(2);
                break;
              case 4:
                return bb("A UTCTiming element should always be given in live manifests! This content may not play on clients with bad clocks!"), n.return(0);
            }
          });
        }
        function Uw(a, b, c, d, e) {
          var f = d.attributes.schemeIdUri || "", g = d.attributes.value || "", h = he(d, "timescale", pe) || 1, k2 = he(d, "presentationTimeOffset", pe) || 0;
          d = t(Yd(d, "Event"));
          for (var l = d.next(); !l.done; l = d.next()) {
            l = l.value;
            var m = he(l, "presentationTime", pe) || 0, n = he(l, "duration", pe) || 0;
            m = Math.max((m - k2) / h + b, b);
            n = m + n / h;
            null != c && (m = Math.min(m, b + c), n = Math.min(n, b + c));
            n < e || (l = { schemeIdUri: f, value: g, startTime: m, endTime: n, id: l.attributes.id || "", timescale: h, eventElement: xe(l), eventNode: ze(l) }, a.j.onTimelineRegionAdded(l));
          }
        }
        function Rw(a, b, c, d, e) {
          var f, g, h, k2;
          return Q(function(l) {
            if (1 == l.g) return f = rh, g = e ? 0 : 1, h = Am(b, c, d, a.g.retryParameters), F(l, Dw(a, h, f, { type: g }), 2);
            k2 = l.h;
            return l.return(k2.data);
          });
        }
        function Zw(a, b) {
          b = lf(a, b);
          return Cf(b) ? dd : a.split("/")[0];
        }
        function Dw(a, b, c, d) {
          d || (d = {});
          d.isPreload = a.ea();
          b = a.j.networkingEngine.request(c, b, d);
          fh(a.O, b);
          return b.promise;
        }
        function Cw(a) {
          var b = a.l.Id;
          if (!a.l.me || !b || !a.F.length) return [];
          var c = Date.now() / 1e3, d = a.F.filter(function(e) {
            e = pe(e.attributes.ttl);
            return !e || b + e > c;
          }).map($d).filter(Kf);
          return d.length ? Xc(a.A, d) : [];
        }
        T("shaka.dash.DashParser", yw);
        Si("application/dash+xml", function() {
          return new yw();
        });
        Si("video/vnd.mpeg.dash.mpd", function() {
          return new yw();
        });
        function ex() {
        }
        T("shaka.dependencies", ex);
        ex.has = function(a) {
          return fx.has(a);
        };
        ex.add = function(a, b) {
          if (!gx[a]) throw Error(a + " is not supported");
          a == hx ? sb("mux.js", "mux.js is no longer used in Shaka Player.") : fx.set(a, function() {
            return b;
          });
        };
        var hx = "muxjs", gx = { Rk: hx, ISOBoxer: "ISOBoxer" };
        ex.Allowed = gx;
        var fx = /* @__PURE__ */ new Map([["ISOBoxer", function() {
          return window2.ISOBoxer;
        }]]);
        function ix(a, b, c) {
          this.type = a;
          this.ca = b;
          this.segments = c || null;
        }
        function jx(a, b, c, d) {
          this.id = a;
          this.name = b;
          this.attributes = c;
          this.value = void 0 === d ? null : d;
        }
        jx.prototype.toString = function(a) {
          function b(e) {
            return e.name + "=" + (isNaN(Number(e.value)) ? '"' + e.value + '"' : e.value);
          }
          var c = "#" + this.name, d = this.attributes ? this.attributes.filter(function(e) {
            return a ? !a.has(e.name) : true;
          }).map(b) : [];
          this.value && d.unshift(this.value);
          0 < d.length && (c += ":" + d.join(","));
          return c;
        };
        function kx(a, b) {
          if (b) return a.toString();
          b = (/* @__PURE__ */ new Set()).add("AUDIO").add("VIDEO").add("SUBTITLES").add("PATHWAY-ID").add("GROUP-ID").add("URI");
          return a.toString(b);
        }
        function lx(a, b) {
          a = a.attributes.filter(function(c) {
            return c.name == b;
          });
          return a.length ? a[0] : null;
        }
        function mx(a, b, c) {
          return (a = lx(a, b)) ? a.value : c || null;
        }
        function nx(a, b) {
          a = lx(a, b);
          if (!a) throw new U(2, 4, 4023, b);
          return a.value;
        }
        function ox(a, b, c) {
          c = void 0 === c ? [] : c;
          this.ca = b;
          this.g = a;
          this.Jb = c;
        }
        function px(a, b) {
          this.name = a;
          this.value = b;
        }
        function qx(a, b) {
          return a.filter(function(c) {
            return c.name == b;
          });
        }
        function rx(a, b) {
          return a.filter(function(c) {
            return nx(c, "TYPE") == b;
          });
        }
        function sx(a, b) {
          a = t(a);
          for (var c = a.next(); !c.done; c = a.next()) if (c = c.value, c.name === b) return c;
          return null;
        }
        function tx(a, b, c) {
          c = void 0 === c ? 0 : c;
          return (a = sx(a, b)) ? Number(a.value) : c;
        }
        function ux(a, b, c) {
          return b ? vx(a, [b], c) : [];
        }
        function vx(a, b, c) {
          if (!b.length) return [];
          var d = b;
          c && c.size && (d = b.map(function(e) {
            return wx(e, c);
          }));
          return Xc(a, d);
        }
        function wx(a, b) {
          if (!b || !b.size) return a;
          a = String(a).replace(/%7B/g, "{").replace(/%7D/g, "}");
          var c = a.match(/{\$\w*}/g);
          if (c) {
            c = t(c);
            for (var d = c.next(); !d.done; d = c.next()) {
              d = d.value;
              var e = d.slice(2, d.length - 1), f = b.get(e);
              if (f) a = a.replace(d, f);
              else throw new U(2, 4, 4039, e);
            }
          }
          return a;
        }
        function xx() {
          this.g = 0;
        }
        function yx(a, b) {
          b = Hc(b);
          b = b.replace(/\r\n|\r(?=[^\n]|$)/gm, "\n").trim();
          var c = b.split(/\n+/m);
          if (!/^#EXTM3U($|[ \t\n])/m.test(c[0])) throw new U(2, 4, 4015);
          b = 0;
          for (var d = true, e = t(c), f = e.next(); !f.done; f = e.next()) if (f = f.value, /^#(?!EXT)/m.test(f) || d) d = false;
          else if (f = zx(a, f), --a.g, Ax.includes(f.name)) {
            b = 1;
            break;
          } else "EXT-X-STREAM-INF" == f.name && (d = true);
          e = [];
          d = true;
          for (f = 0; f < c.length; f++) {
            var g = c[f], h = c[f + 1];
            if (/^#(?!EXT)/m.test(g) || d) d = false;
            else {
              g = zx(a, g);
              if (Bx.includes(g.name)) {
                if (1 != b) throw new U(2, 4, 4017);
                g = c.splice(f, c.length - f);
                c = [];
                d = [];
                f = [];
                h = null;
                g = t(g);
                for (var k2 = g.next(); !k2.done; k2 = g.next()) k2 = k2.value, /^(#EXT)/.test(k2) ? (k2 = zx(a, k2), Ax.includes(k2.name) ? e.push(k2) : "EXT-X-MAP" == k2.name ? h = k2 : "EXT-X-PART" == k2.name ? f.push(k2) : "EXT-X-PRELOAD-HINT" == k2.name ? "PART" == mx(k2, "TYPE") ? f.push(k2) : "MAP" == mx(k2, "TYPE") && (k2.name = "EXT-X-MAP", h = k2) : d.push(k2)) : /^#(?!EXT)/m.test(k2) || (k2 = k2.trim(), h && d.push(h), c.push(new ox(k2, d, f)), d = [], f = []);
                f.length && (h && d.push(h), c.push(new ox("", d, f)));
                return new ix(b, e, c);
              }
              e.push(g);
              "EXT-X-STREAM-INF" == g.name && (g.attributes.push(new px("URI", h)), d = true);
            }
          }
          return new ix(b, e);
        }
        function zx(a, b) {
          a = a.g++;
          var c = b.match(/^#(EXT[^:]*)(?::(.*))?$/);
          if (!c) throw new U(2, 4, 4016, b);
          b = c[1];
          var d = c[2];
          c = [];
          var e;
          if (d) {
            d = new Fd(d);
            var f;
            (f = Hd(d, /^([^,=]+)(?:,|$)/g)) && (e = f[1]);
            for (var g = /([^=]+)=(?:"([^"]*)"|([^",]*))(?:,|$)/g; f = Hd(d, g); ) c.push(new px(f[1], f[2] || f[3])), Gd(d);
          }
          return new jx(a, b, c, e);
        }
        var Ax = "EXT-X-TARGETDURATION EXT-X-MEDIA-SEQUENCE EXT-X-DISCONTINUITY-SEQUENCE EXT-X-PLAYLIST-TYPE EXT-X-I-FRAMES-ONLY EXT-X-ENDLIST EXT-X-SERVER-CONTROL EXT-X-SKIP EXT-X-PART-INF EXT-X-DATERANGE".split(" "), Bx = "EXTINF EXT-X-BYTERANGE EXT-X-DISCONTINUITY EXT-X-PROGRAM-DATE-TIME EXT-X-KEY EXT-X-DATERANGE EXT-X-MAP EXT-X-GAP EXT-X-TILES".split(" ");
        function Cx() {
        }
        function Dx(a, b) {
          try {
            var c = Ex(a);
            return Yg({ uri: a, originalUri: a, data: c.data, headers: { "content-type": c.contentType }, originalRequest: b });
          } catch (d) {
            return Wg(d);
          }
        }
        function Ex(a) {
          var b = a.split(":");
          if (2 > b.length || "data" != b[0]) throw new U(2, 1, 1004, a);
          b = b.slice(1).join(":").split(",");
          if (2 > b.length) throw new U(2, 1, 1004, a);
          var c = b[0];
          a = window2.decodeURIComponent(b.slice(1).join(","));
          b = c.split(";");
          c = b[0];
          var d = false;
          1 < b.length && "base64" == b[b.length - 1] && (d = true, b.pop());
          var e;
          d ? e = Tc(a) : e = Lc(a);
          return { data: e, contentType: c };
        }
        T("shaka.net.DataUriPlugin", Cx);
        Cx.parse = Dx;
        hh("data", Dx);
        function Fx() {
          var a = this;
          this.g = this.h = null;
          this.F = 1;
          this.A = /* @__PURE__ */ new Map();
          this.I = /* @__PURE__ */ new Map();
          this.M = /* @__PURE__ */ new Map();
          this.M.set("video", /* @__PURE__ */ new Map());
          this.M.set("audio", /* @__PURE__ */ new Map());
          this.M.set(dd, /* @__PURE__ */ new Map());
          this.M.set("image", /* @__PURE__ */ new Map());
          this.Sb = (/* @__PURE__ */ new Map()).set("com.apple.streamingkeydelivery", function(b, c, d) {
            return Gx(a, b, c, d);
          }).set("urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed", function(b) {
            var c = nx(b, "METHOD");
            if (["SAMPLE-AES", "SAMPLE-AES-CTR"].includes(c)) {
              var d = "cenc";
              "SAMPLE-AES" == c && (d = "cbcs");
              c = nx(b, "URI");
              c = Ex(c.split("?")[0]);
              c = Qb(c.data);
              d = Yc("com.widevine.alpha", d, [{ initDataType: "cenc", initData: c }]);
              (b = mx(b, "KEYID")) && d.keyIds.add(b.toLowerCase().substr(2));
              b = Promise.resolve(d);
            } else b = Promise.resolve(null);
            return b;
          }).set("com.microsoft.playready", function(b) {
            var c = nx(b, "METHOD");
            if (["SAMPLE-AES", "SAMPLE-AES-CTR"].includes(c)) {
              var d = "cenc";
              "SAMPLE-AES" == c && (d = "cbcs");
              b = nx(b, "URI");
              b = Ex(b.split("?")[0]);
              b = Qb(b.data);
              c = new Uint8Array([154, 4, 240, 121, 152, 64, 66, 134, 171, 146, 230, 91, 224, 136, 95, 149]);
              c = Rh(b, c, /* @__PURE__ */ new Set(), 0);
              d = Yc(
                "com.microsoft.playready",
                d,
                [{ initDataType: "cenc", initData: c }]
              );
              if (b = Rd(["<PLAYREADY>", Sc(b), "</PLAYREADY>"].join("\n"))) d.licenseServerUri = tu(b);
              d = Promise.resolve(d);
            } else d = Promise.resolve(null);
            return d;
          }).set("urn:uuid:3d5e6d35-9b9a-41e8-b843-dd3c6e72c42c", function(b) {
            var c = nx(b, "METHOD");
            if (["SAMPLE-AES", "SAMPLE-AES-CTR"].includes(c)) {
              var d = "cenc";
              "SAMPLE-AES" == c && (d = "cbcs");
              c = nx(b, "URI");
              c = Ex(c.split("?")[0]);
              c = Qb(c.data);
              d = Yc("com.huawei.wiseplay", d, [{ initDataType: "cenc", initData: c }]);
              (b = mx(b, "KEYID")) && d.keyIds.add(b.toLowerCase().substr(2));
              b = Promise.resolve(d);
            } else b = Promise.resolve(null);
            return b;
          });
          this.Na = /* @__PURE__ */ new Set();
          this.i = /* @__PURE__ */ new Map();
          this.l = null;
          this.C = "";
          this.Ga = new xx();
          this.K = -1;
          this.ea = Infinity;
          this.Z = this.Ub = this.Ma = false;
          this.B = new ec(function() {
            if (a.W && !a.g.continueLoadingWhenPaused && (a.T.Ja(a.W, "timeupdate"), a.W.paused)) {
              a.T.ma(a.W, "timeupdate", function() {
                return Hx(a);
              });
              return;
            }
            Hx(a);
          });
          this.Ea = Ix;
          this.m = null;
          this.La = 0;
          this.o = Infinity;
          this.Fa = this.Aa = this.P = 0;
          this.Y = new eh();
          this.G = /* @__PURE__ */ new Map();
          this.H = /* @__PURE__ */ new Map();
          this.sa = /* @__PURE__ */ new Map();
          this.ka = /* @__PURE__ */ new Map();
          this.L = /* @__PURE__ */ new Map();
          this.oa = /* @__PURE__ */ new Map();
          this.pa = /* @__PURE__ */ new Map();
          this.Tb = this.fa = false;
          this.Pb = new Xa(5);
          this.j = null;
          this.O = true;
          this.ya = /* @__PURE__ */ new Set();
          this.T = new lb();
          this.u = this.W = null;
          this.Qb = function() {
            return false;
          };
        }
        r = Fx.prototype;
        r.configure = function(a, b) {
          var c = this.h && a.updatePeriod != this.g.updatePeriod && 0 <= a.updatePeriod;
          this.g = a;
          b && (this.Qb = b);
          this.j && this.j.configure(this.g);
          c && this.m && this.m.presentationTimeline.U() && this.B.sb();
        };
        r.start = function(a, b) {
          var c = this, d;
          return Q(function(e) {
            return 1 == e.g ? (c.h = b, c.fa = b.isLowLatencyMode(), F(e, Jx(c, [a]).promise, 2)) : 3 != e.g ? (d = e.h, c.C = d.uri, F(e, Kx(c, d.data), 3)) : e.return(c.m);
          });
        };
        r.stop = function() {
          this.B && (this.B.stop(), this.B = null);
          var a = [];
          this.Y && (a.push(this.Y.destroy()), this.Y = null);
          this.g = this.h = null;
          this.Na.clear();
          this.m = null;
          this.i.clear();
          this.I.clear();
          this.H.clear();
          this.A.clear();
          this.sa.clear();
          this.ka.clear();
          this.L.clear();
          this.oa.clear();
          this.pa.clear();
          this.ya.clear();
          this.j && this.j.destroy();
          this.T && (this.T.release(), this.T = null);
          return Promise.all(a);
        };
        r.update = function() {
          var a = this, b, c, d, e, f, g, h, k2, l, m, n, p;
          return Q(function(q) {
            if (1 == q.g) {
              if (!Lx(a)) return q.return();
              b = [];
              c = Array.from(a.i.values());
              a.o = Infinity;
              a.m.gapCount = 0;
              d = c.filter(function(u) {
                return u.stream.segmentIndex;
              });
              e = t(d);
              for (f = e.next(); !f.done; f = e.next()) g = f.value, b.push(Mx(a, g));
              return F(q, Promise.all(b), 2);
            }
            Nx(a, d.map(function(u) {
              return u.stream;
            }));
            h = d.some(function(u) {
              return 0 == u.rd;
            });
            d.length && !h && (k2 = Ox, Px(a, k2.Ph), l = d.map(function(u) {
              return u.Vb;
            }), a.l.bb(Math.min.apply(Math, y(l))), a.h.updateDuration());
            h && Qx(a);
            m = t(d);
            for (n = m.next(); !n.done; n = m.next()) p = n.value, p.stream.isAudioMuxedInVideo || !p.stream.segmentIndex || Ag(p.stream.segmentIndex) || a.h.disableStream(p.stream);
            I(q);
          });
        };
        function Rx(a, b) {
          return Lx(a) ? a.M.get(b.type) : b.je;
        }
        function Mx(a, b) {
          var c, d, e, f, g, h, k2, l, m, n, p, q, u, w, v, x, z, C, D, G, B, A, H, E, K, M, J, L, N, P, O, R, S, pa, Z, Fa;
          return Q(function(sa) {
            switch (sa.g) {
              case 1:
                if (b.stream.isAudioMuxedInVideo) return sa.return();
                c = [];
                d = t(b.N());
                for (e = d.next(); !e.done; e = d.next()) f = e.value, g = new yb(f), h = g.g, b.Td && (0 <= b.Ab && h.add("_HLS_msn", String(b.Ab)), 0 <= b.Bb && h.add("_HLS_part", String(b.Bb))), b.Ud && h.add("_HLS_skip", "YES"), Nb(h) && Cb(g, Db(h.toString())), c.push(g.toString());
                xa(sa, 2);
                return F(sa, Jx(a, c, true).promise, 4);
              case 4:
                k2 = sa.h;
                Aa(
                  sa,
                  3
                );
                break;
              case 2:
                throw l = Ba(sa), a.h && a.h.disableStream(b.stream), l;
              case 3:
                if (!b.stream.segmentIndex) return sa.return();
                m = yx(a.Ga, k2.data);
                if (1 != m.type) throw new U(2, 4, 4017);
                n = k2.uri;
                n == k2.originalUri || b.N().includes(n) || b.ve.push(n);
                p = qx(m.ca, "EXT-X-DEFINE");
                q = Sx(a, p, n);
                u = b.stream;
                w = Rx(a, b);
                return F(sa, Tx(a, m, u.mimeType, b.N, q), 5);
              case 5:
                v = sa.h;
                x = v.keyIds;
                z = v.drmInfos;
                C = v.encrypted;
                D = v.Bg;
                u.encrypted || !C || D || (u.encrypted = true);
                G = function(ka, Ca) {
                  return ka.size === Ca.size && [].concat(y(ka)).every(function(ra) {
                    return Ca.has(ra);
                  });
                };
                G(u.keyIds, x) || (u.keyIds = x, u.drmInfos = z, a.h.newDrmInfo(u));
                B = Ux(a, m, w, q, b.N, b.type);
                A = B.segments;
                if (H = B.bandwidth) u.bandwidth = H;
                E = em(u);
                K = t(A);
                for (M = K.next(); !M.done; M = K.next()) J = M.value, J.$ && (J.$.Wc = E);
                u.segmentIndex.Bd(A, a.l.pb());
                A.length && (L = tx(m.ca, "EXT-X-MEDIA-SEQUENCE", 0), P = (N = sx(m.ca, "EXT-X-SKIP")) ? Number(mx(N, "SKIPPED-SEGMENTS")) : 0, O = Vx(L, A), R = O.Ab, S = O.Bb, b.Ab = R + P, b.Bb = S, pa = w.get(L), u.segmentIndex.Oa(pa));
                if (Z = Ag(u.segmentIndex)) b.Bc = Z.startTime, Fa = A[A.length - 1], b.Vb = Fa.endTime;
                if (sx(
                  m.ca,
                  "EXT-X-ENDLIST"
                )) b.rd = true;
                Wx(a, m);
                Xx(a, m.ca, u.type, q, b.N);
                I(sa);
            }
          });
        }
        r.onExpirationUpdated = function() {
        };
        r.onInitialVariantChosen = function() {
        };
        r.banLocation = function(a) {
          this.j && this.j.banLocation(a);
        };
        r.setMediaElement = function(a) {
          this.W = a;
        };
        function Yx(a, b, c) {
          c = void 0 === c ? false : c;
          for (var d = -1 == a.K, e = t(b), f = e.next(); !f.done; f = e.next()) {
            f = f.value;
            var g = f.stream.segmentIndex, h = Rx(a, f);
            if (g = Ag(g)) {
              h = t(h);
              for (var k2 = h.next(); !k2.done; k2 = h.next()) {
                k2 = t(k2.value);
                var l = k2.next().value;
                if (k2.next().value == g.startTime) {
                  d && (a.K = Math.max(a.K, l));
                  f.qf = l;
                  break;
                }
              }
            }
          }
          if (!(0 > a.K)) {
            for (b = t(b), d = b.next(); !d.done; d = b.next()) if (d = d.value, Zx(a, d.type) || c) {
              if (e = d.stream.segmentIndex) {
                if (f = a.K - d.qf, 0 < f && (e.g.splice(0, f), e = Ag(e))) e = -e.startTime, d.stream.segmentIndex.offset(e), $x(a, d, e);
              }
            }
          }
        }
        function ay(a, b) {
          if (Infinity == a.ea) {
            b = t(b);
            for (var c = b.next(); !c.done; c = b.next()) c = Ag(c.value.stream.segmentIndex), null != c && null != c.h && (a.ea = Math.min(a.ea, c.h));
          }
          b = a.ea;
          if (Infinity != b) {
            c = t(a.i.values());
            for (var d = c.next(); !d.done; d = c.next()) if (d = d.value, !Zx(a, d.type)) {
              var e = d.stream.segmentIndex;
              if (null != e) {
                var f = Ag(e);
                if (f) if (null == f.h) ab("Missing EXT-X-PROGRAM-DATE-TIME for stream", d.N(), "Expect AV sync issues!");
                else for ($x(a, d, f.h - b - f.startTime), d = t(e), e = d.next(); !e.done; e = d.next()) e.value.qg(b);
              }
            }
          }
        }
        function $x(a, b, c) {
          if (!(1e-3 > Math.abs(c))) {
            b.Bc += c;
            b.Vb += c;
            a = Rx(a, b);
            for (var d = t(a), e = d.next(); !e.done; e = d.next()) {
              var f = t(e.value);
              e = f.next().value;
              f = f.next().value;
              a.set(e, f + c);
            }
            b.N();
          }
        }
        function Kx(a, b) {
          var c, d, e, f, g, h, k2, l, m, n, p, q, u, w, v, x, z, C, D, G, B, A, H, E, K, M, J, L, N, P, O, R, S, pa, Z, Fa, Ia, sa, ka, Ca, ra, ya;
          return Q(function(na) {
            switch (na.g) {
              case 1:
                c = fd;
                d = yx(a.Ga, b);
                e = qx(d.ca, "EXT-X-DEFINE");
                f = [];
                g = [];
                h = [];
                a.l = new xl(null, 0);
                a.l.Gc(true);
                k2 = function() {
                  return [a.C];
                };
                l = null;
                m = /* @__PURE__ */ new Map();
                if (1 == d.type) return a.O = false, R = qx(d.ca, "EXT-X-DEFINE"), m = Sx(a, R, a.C), l = c.la, S = "", pa = /* @__PURE__ */ new Map(), F(na, by(a, a.F++, m, d, k2, "", l, S, true, "Media Playlist", null, pa, null, false, null, false), 7);
                cy(a, e);
                n = qx(d.ca, "EXT-X-MEDIA");
                p = qx(d.ca, "EXT-X-STREAM-INF");
                q = qx(d.ca, "EXT-X-IMAGE-STREAM-INF");
                u = qx(d.ca, "EXT-X-I-FRAME-STREAM-INF");
                w = qx(d.ca, "EXT-X-SESSION-KEY");
                v = qx(d.ca, "EXT-X-SESSION-DATA");
                x = qx(d.ca, "EXT-X-CONTENT-STEERING");
                dy(a, v);
                return F(na, ey(a, x), 4);
              case 4:
                if (!a.g.ignoreSupplementalCodecs) {
                  z = [];
                  C = t(p);
                  D = C.next();
                  for (G = {}; !D.done; G = { Gh: void 0 }, D = C.next()) if (B = D.value, A = mx(B, "SUPPLEMENTAL-CODECS")) G.Gh = A.split(/\s*,\s*/).map(function(ta) {
                    return ta.split("/")[0];
                  }), H = B.attributes.map(/* @__PURE__ */ function(ta) {
                    return function(Pa) {
                      var ob = Pa.name, db = Pa.value;
                      "CODECS" == ob && (db = ta.Gh.join(","), Pa = Pa.value.split(","), 1 < Pa.length && (Pa = bd("audio", Pa)) && (db += "," + Pa));
                      return new px(ob, db);
                    };
                  }(G)), z.push(new jx(B.id, B.name, H, null));
                  p.push.apply(p, y(z));
                  E = [];
                  K = t(u);
                  M = K.next();
                  for (J = {}; !M.done; J = { Hh: void 0 }, M = K.next()) if (L = M.value, N = mx(L, "SUPPLEMENTAL-CODECS")) J.Hh = N.split(/\s*,\s*/).map(function(ta) {
                    return ta.split("/")[0];
                  }), P = L.attributes.map(/* @__PURE__ */ function(ta) {
                    return function(Pa) {
                      var ob = Pa.name;
                      Pa = Pa.value;
                      "CODECS" == ob && (Pa = ta.Hh.join(","));
                      return new px(ob, Pa);
                    };
                  }(J)), E.push(new jx(
                    L.id,
                    L.name,
                    P,
                    null
                  ));
                  u.push.apply(u, y(E));
                }
                fy(a, p);
                gy(a, n);
                O = hy(a, u);
                return F(na, iy(a, p, w, n, k2, a.A, O), 5);
              case 5:
                return f = na.h, g = jy(a, n), F(na, ky(a, q, u), 6);
              case 6:
                h = na.h;
                na.s(3);
                break;
              case 7:
                Z = na.h, a.i.set(a.C, Z), Z.stream && (Fa = em(Z.stream), Z.stream.segmentIndex.Eb(function(ta) {
                  ta.$ && (ta.$.Wc = Fa);
                })), l = Z.stream.type, f.push({
                  id: 0,
                  language: Of(S || "und"),
                  disabledUntilTime: 0,
                  primary: true,
                  audio: "audio" == l ? Z.stream : null,
                  video: "video" == l ? Z.stream : null,
                  bandwidth: Z.stream.bandwidth || 0,
                  allowedByApplication: true,
                  allowedByKeySystem: true,
                  decodingInfos: []
                });
              case 3:
                if (!a.h) throw new U(2, 7, 7001);
                ly(a, d);
                1 == d.type && (Lx(a) && (my(a, d), Ia = a.o, a.B.da(Ia)), sa = Array.from(a.i.values()), ny(a, sa), Qx(a), Xx(a, d.ca, l, m, k2));
                a.m = { presentationTimeline: a.l, variants: f, textStreams: g, imageStreams: h, offlineSessionIds: [], sequenceMode: a.g.hls.sequenceMode, ignoreManifestTimestampsInSegmentsMode: a.g.hls.ignoreManifestTimestampsInSegmentsMode, type: "HLS", serviceDescription: null, nextUrl: null, periodCount: 1, gapCount: 0, isLowLatency: false, startTime: a.u };
                if (a.Z || !a.g.hls.disableCodecGuessing) {
                  na.s(8);
                  break;
                }
                ka = [];
                Ca = t(a.m.variants);
                for (ra = Ca.next(); !ra.done; ra = Ca.next()) ya = ra.value, ya.audio && "" === ya.audio.codecs && ka.push(ya.audio.createSegmentIndex()), ya.video && "" === ya.video.codecs && ka.push(ya.video.createSegmentIndex());
                return F(na, Promise.all(ka), 8);
              case 8:
                a.h.makeTextStreamsForClosedCaptions(a.m), I(na);
            }
          });
        }
        function oy(a, b) {
          var c, d, e, f, g, h, k2, l, m, n, p, q, u, w, v, x, z, C;
          return Q(function(D) {
            if (1 == D.g) {
              c = um(a.g.hls.mediaPlaylistFullMimeType);
              if (!b.length) return D.return(c);
              d = py(a, b);
              e = d.segment;
              f = d.segmentIndex;
              g = e.N();
              h = g[0];
              k2 = new yb(h);
              l = k2.ab.split(".").pop();
              return (m = qy.get(l)) ? D.return(um(m)) : F(D, Promise.all([ry(a, e.$, 0), ry(a, e, f)]), 2);
            }
            n = D.h;
            p = n[0].mimeType;
            q = n[1].mimeType;
            u = n[0].data;
            w = n[1].data;
            v = "mp4 mp4a m4s m4i m4a m4f cmfa mp4v m4v cmfv fmp4".split(" ");
            x = ["audio/mp4", "video/mp4", "video/iso.segment"];
            if (Ik(Qb(w))) {
              var G = w, B = a.g.disableAudio, A = a.g.disableVideo, H = a.g.disableText;
              var E = Qb(G);
              var K = new Ak().parse(E), M = K.od();
              E = K.Kf();
              var J = [], L = false, N = false;
              if (!B) switch (M.audio) {
                case "aac":
                case "aac-loas":
                  K.fb().length && (J.push("mp4a.40.2"), L = true);
                  break;
                case "mp3":
                  K.fb().length && (J.push("mp4a.40.34"), L = true);
                  break;
                case "ac3":
                  K.fb().length && (J.push("ac-3"), L = true);
                  break;
                case "ec3":
                  K.fb().length && (J.push("ec-3"), L = true);
                  break;
                case "opus":
                  K.fb().length && (J.push("opus"), L = true);
              }
              if (!A) switch (M.video) {
                case "avc":
                  E.codec ? J.push(E.codec) : J.push("avc1.42E01E");
                  N = true;
                  break;
                case "hvc":
                  E.codec ? J.push(E.codec) : J.push("hvc1.1.6.L93.90");
                  N = true;
                  break;
                case "av1":
                  J.push("av01.0.01M.08"), N = true;
              }
              if (J.length) {
                B = L && !N;
                A = /* @__PURE__ */ new Map();
                if (N && !H) {
                  H = new td("video/mp2t");
                  H.i(G);
                  G = t(H.j());
                  for (N = G.next(); !N.done; N = G.next()) N = N.value, A.set(N, N);
                  H.g();
                }
                E = { type: B ? "audio" : "video", mimeType: "video/mp2t", codecs: J.join(", "), language: null, height: E.height, width: E.width, channelCount: null, sampleRate: null, closedCaptions: A, Nd: null, colorGamut: null, frameRate: E.frameRate };
              } else E = null;
              if (z = E) return D.return(z);
            } else if (v.includes(l) || x.includes(q) || p && x.includes(p)) {
              if (C = vm(u, w, a.g.disableText)) return D.return(C);
            }
            return q ? D.return(um(q)) : p ? D.return(um(p)) : D.return(c);
          });
        }
        function ry(a, b, c) {
          var d, e, f, g, h, k2;
          return Q(function(l) {
            switch (l.g) {
              case 1:
                if (!b) return l.return({ mimeType: null, data: null });
                d = rh;
                e = Am(b.N(), b.uc(), b.tc(), a.g.retryParameters);
                f = b instanceof Nj ? 1 : 0;
                return F(l, sy(a, e, d, { type: f }).promise, 2);
              case 2:
                g = l.h;
                h = g.data;
                if (!b.aesKey) {
                  l.s(3);
                  break;
                }
                return F(l, zm(h, b.aesKey, c), 4);
              case 4:
                h = l.h;
              case 3:
                return b instanceof Nj ? b.Kd(h, true) : b.Kd(h), (k2 = g.headers["content-type"]) && (k2 = k2.split(";")[0].toLowerCase()), l.return({ mimeType: k2, data: h });
            }
          });
        }
        function Qx(a) {
          if (Lx(a)) {
            if (a.Ea == ty) {
              for (var b = Infinity, c = Infinity, d = t(a.i.values()), e = d.next(); !e.done; e = d.next()) e = e.value, e.stream.segmentIndex && "text" != e.stream.type && !e.stream.isAudioMuxedInVideo && (b = Math.min(b, e.Vb), c = Math.min(c, e.Bc));
              b = b - c || 0;
              isNaN(a.g.availabilityWindowOverride) || (b = a.g.availabilityWindowOverride);
              a.l.Ce(b);
            }
          } else a.l.bb(uy(a));
          if (!a.l.u) for (b = t(a.i.values()), c = b.next(); !c.done; c = b.next()) c = c.value, !c.stream.segmentIndex || "audio" != c.type && "video" != c.type || (c = Ag(c.stream.segmentIndex)) && c.h && a.l.xh(c.h);
          a.l.ie();
        }
        function cy(a, b) {
          var c = new yb(a.C).g;
          b = t(b);
          for (var d = b.next(); !d.done; d = b.next()) {
            var e = d.value;
            d = mx(e, "NAME");
            var f = mx(e, "VALUE");
            e = mx(e, "QUERYPARAM");
            d && f && (a.A.has(d) || a.A.set(d, f));
            e && (d = c.get(e)[0]) && !a.A.has(d) && a.A.set(e, d);
          }
        }
        function Sx(a, b, c) {
          c = new yb(c).g;
          var d = /* @__PURE__ */ new Map();
          b = t(b);
          for (var e = b.next(); !e.done; e = b.next()) {
            var f = e.value, g = mx(f, "NAME"), h = mx(f, "VALUE");
            e = mx(f, "QUERYPARAM");
            f = mx(f, "IMPORT");
            g && h && (d.has(g) || d.set(g, h));
            e && (g = c.get(e)[0]) && !d.has(g) && d.set(e, g);
            f && (e = a.A.get(f)) && d.set(f, e);
          }
          return d;
        }
        function fy(a, b) {
          b = t(b);
          for (var c = b.next(); !c.done; c = b.next()) {
            var d = c.value, e = mx(d, "AUDIO");
            c = mx(d, "VIDEO");
            var f = mx(d, "SUBTITLES");
            d = vy(a, d);
            if (f) {
              var g = bd(dd, d);
              a.H.set(f, g);
              Cd(d, g);
            }
            e && (f = bd("audio", d), f || (f = a.g.hls.defaultAudioCodec), a.H.set(e, f));
            c && (e = bd("video", d), e || (e = a.g.hls.defaultVideoCodec), a.H.set(c, e));
          }
        }
        function dy(a, b) {
          b = t(b);
          for (var c = b.next(); !c.done; c = b.next()) {
            var d = c.value, e = mx(d, "DATA-ID");
            c = mx(d, "URI");
            var f = mx(d, "LANGUAGE");
            d = mx(d, "VALUE");
            e = (/* @__PURE__ */ new Map()).set("id", e);
            c && e.set("uri", ux([a.C], c, a.A)[0]);
            f && e.set("language", f);
            d && e.set("value", d);
            c = new V("sessiondata", e);
            if (a.h) a.h.onEvent(c);
          }
        }
        function ey(a, b) {
          var c, d, e, f, g, h;
          return Q(function(k2) {
            if (!a.h || !a.g) return k2.return();
            d = t(b);
            for (e = d.next(); !e.done; e = d.next()) if (f = e.value, g = mx(f, "PATHWAY-ID"), h = mx(f, "SERVER-URI"), g && h) {
              a.j = new qv(a.h);
              a.j.configure(a.g);
              a.j.i = [a.C];
              a.j.setManifestType("HLS");
              a.j.h = g;
              c = rv(a.j, h);
              break;
            }
            return F(k2, c, 0);
          });
        }
        function jy(a, b) {
          var c = rx(b, "SUBTITLES");
          b = c.map(function(g) {
            if (a.g.disableText) return null;
            try {
              return wy(a, [g], /* @__PURE__ */ new Map()).stream;
            } catch (h) {
              if (a.g.hls.ignoreTextStreamFailures) return null;
              throw h;
            }
          });
          c = t(c);
          for (var d = c.next(); !d.done; d = c.next()) {
            var e = nx(d.value, "GROUP-ID");
            if (d = a.H.get(e)) {
              if (e = a.I.get(e)) {
                e = t(e);
                for (var f = e.next(); !f.done; f = e.next()) f = f.value, f.stream.codecs = d, f.stream.mimeType = xy(dd, d) || yy(dd), zy(f.stream);
              }
            }
          }
          return b.filter(function(g) {
            return g;
          });
        }
        function zy(a) {
          var b = /* @__PURE__ */ new Set([lf(a.mimeType, a.codecs)]);
          a.segmentIndex && a.segmentIndex.Eb(function(c) {
            c.mimeType && b.add(lf(c.mimeType, a.codecs));
          });
          a.fullMimeTypes = b;
        }
        function ky(a, b, c) {
          var d, e;
          return Q(function(f) {
            if (1 == f.g) return d = b.map(function(g) {
              var k2, l;
              return Q(function(m) {
                if (1 == m.g) {
                  if (a.g.disableThumbnails) return m.return(null);
                  xa(m, 2);
                  return F(m, Ay(a, g), 4);
                }
                if (2 != m.g) return k2 = m.h, m.return(k2.stream);
                l = Ba(m);
                if (a.g.hls.ignoreImageStreamFailures) return m.return(null);
                throw l;
              });
            }).concat(c.map(function(g) {
              if (a.g.disableThumbnails) return null;
              try {
                var h = By(a, g);
                return "image" !== h.stream.type ? null : h.stream;
              } catch (k2) {
                if (a.g.hls.ignoreImageStreamFailures) return null;
                throw k2;
              }
            })), F(f, Promise.all(d), 2);
            e = f.h;
            return f.return(e.filter(function(g) {
              return g;
            }));
          });
        }
        function Cy(a, b, c) {
          b = b.filter(function(h) {
            var k2 = mx(h, "URI") || "";
            h = mx(h, "TYPE");
            return "SUBTITLES" != h && ("" != k2 || "AUDIO" == h);
          });
          var d = {};
          b = t(b);
          for (var e = b.next(); !e.done; e = b.next()) {
            e = e.value;
            var f = kx(e, !a.j);
            d[f] ? d[f].push(e) : d[f] = [e];
          }
          for (var g in d) wy(a, d[g], c, false);
        }
        function hy(a, b) {
          return b.map(function(c) {
            c = By(a, c);
            return "video" !== c.stream.type ? null : c.stream;
          }).filter(function(c) {
            return c;
          });
        }
        function iy(a, b, c, d, e, f, g) {
          var h, k2, l, m, n, p, q, u, w, v, x, z, C, D, G, B, A, H, E, K, M, J, L, N, P, O, R, S, pa, Z, Fa, Ia, sa, ka, Ca, ra;
          return Q(function(ya) {
            switch (ya.g) {
              case 1:
                h = [];
                k2 = /* @__PURE__ */ new Set();
                if (a.g.ignoreDrmInfo || !(0 < c.length)) {
                  ya.s(2);
                  break;
                }
                l = t(c);
                m = l.next();
              case 3:
                if (m.done) {
                  ya.s(2);
                  break;
                }
                n = m.value;
                p = nx(n, "METHOD");
                q = mx(n, "KEYFORMAT") || "identity";
                u = null;
                if ("NONE" == p) {
                  ya.s(4);
                  break;
                }
                if (Dy(p)) {
                  w = ux(e(), nx(n, "URI"), f);
                  v = w.sort().join("");
                  a.L.has(v) || (x = lh(w, a.g.retryParameters), z = sy(a, x, 6).promise, a.L.set(v, z));
                  ya.s(4);
                  break;
                }
                if ("identity" == q) return F(ya, Ey(a, n, "", e, null, f), 12);
                C = a.Sb.get(q);
                if (!C) {
                  D = null;
                  ya.s(10);
                  break;
                }
                return F(ya, C(n, "", null), 11);
              case 11:
                D = ya.h;
              case 10:
                u = D;
                ya.s(6);
                break;
              case 12:
                u = ya.h;
              case 6:
                if (u) {
                  if (u.keyIds) for (G = t(u.keyIds), B = G.next(); !B.done; B = G.next()) A = B.value, k2.add(A);
                  h.push(u);
                }
              case 4:
                m = l.next();
                ya.s(3);
                break;
              case 2:
                H = {};
                E = t(b);
                for (K = E.next(); !K.done; K = E.next()) M = K.value, J = kx(M, !a.j), H[J] ? H[J].push(M) : H[J] = [M];
                L = [];
                for (N in H) P = H[N], O = P[0], R = mx(O, "FRAME-RATE"), S = Number(mx(O, "AVERAGE-BANDWIDTH")) || Number(nx(
                  O,
                  "BANDWIDTH"
                )), pa = mx(O, "RESOLUTION"), Z = t(pa ? pa.split("x") : [null, null]), Fa = Z.next().value, Ia = Z.next().value, sa = mx(O, "VIDEO-RANGE"), (ka = mx(O, "REQ-VIDEO-LAYOUT")) && ka.includes(",") && (Ca = ka.split(",").filter(function(na) {
                  return "CH-STEREO" == na || "CH-MONO" == na;
                }), ka = Ca[0]), ka = ka || "CH-MONO", ra = Fy(a, P, d), L.push.apply(L, y(Gy(a, ra.audio, ra.video, S, Fa, Ia, R, sa, ka, h, k2, g)));
                return ya.return(L.filter(function(na) {
                  return null != na;
                }));
            }
          });
        }
        function Fy(a, b, c) {
          for (var d = { audio: [], video: [] }, e = /* @__PURE__ */ new Map(), f = [], g = false, h = false, k2 = t(b), l = k2.next(); !l.done; l = k2.next()) {
            var m = l.value;
            l = mx(m, "AUDIO");
            var n = mx(m, "VIDEO"), p = l || n;
            p && (f.includes(p) || f.push(p), (m = mx(m, "PATHWAY-ID")) && e.set(p, m), l ? g = true : n && (h = true));
          }
          f.length && c.length && (c = c.filter(function(u) {
            return f.includes(nx(u, "GROUP-ID"));
          }), Cy(a, c, e));
          c = (e = f.sort().join(",")) && a.I.has(e) ? a.I.get(e) : [];
          g ? d.audio.push.apply(d.audio, y(c)) : h && d.video.push.apply(d.video, y(c));
          g = false;
          var q = b.map(function(u) {
            return nx(
              u,
              "URI"
            );
          });
          l = d.audio.find(function(u) {
            return u && u.N().find(function(w) {
              return q.includes(w);
            });
          });
          h = vy(a, b[0]);
          c = bd("video", h);
          (k2 = bd("audio", h)) && !c ? (l = "audio", g = 0 < d.audio.length) : !d.audio.length && !d.video.length && k2 && c ? (l = "video", h = [[c, k2].join()]) : d.audio.length && l ? (l = "audio", g = true) : l = d.video.length && !d.audio.length ? "audio" : "video";
          g || (a = Hy(a, b, h, l), e && (a.stream.groupId = e), d[a.stream.type] = [a]);
          return d;
        }
        function vy(a, b) {
          b = mx(b, "CODECS") || "";
          a.Z = 0 < b.length;
          a.Z || a.g.hls.disableCodecGuessing || (b = [], a.g.disableVideo || b.push(a.g.hls.defaultVideoCodec), a.g.disableAudio || b.push(a.g.hls.defaultAudioCodec), b = b.join(","));
          return wm(b.split(/\s*,\s*/));
        }
        function Gy(a, b, c, d, e, f, g, h, k2, l, m, n) {
          for (var p = t(c), q = p.next(); !q.done; q = p.next()) Iy(q.value.stream, e, f, g, h, k2, null);
          e = a.g.disableAudio;
          if (!b.length || e) b = [null];
          e = a.g.disableVideo;
          if (!c.length || e) c = [null];
          e = [];
          b = t(b);
          for (f = b.next(); !f.done; f = b.next()) for (f = f.value, g = t(c), h = g.next(); !h.done; h = g.next()) {
            var u = h.value;
            if (h = f ? f.stream : null) h.drmInfos = l, h.keyIds = m;
            if (k2 = u ? u.stream : null) k2.drmInfos = l, k2.keyIds = m, a.g.disableIFrames || Kg(k2, n);
            k2 && !h && (k2.bandwidth = d);
            !k2 && h && (h.bandwidth = d);
            p = f ? f.stream.drmInfos : null;
            q = u ? u.stream.drmInfos : null;
            u = u ? u.N().sort().join(",") : "";
            var w = f ? f.N().sort().join(",") : "", v = [];
            h && h.codecs && v.push(h.codecs);
            k2 && k2.codecs && v.push(k2.codecs);
            u = [u, w, v.sort()].join("-");
            h && k2 && !Yb(p, q) || a.Na.has(u) || (h = { id: a.F++, language: h ? h.language : "und", disabledUntilTime: 0, primary: !!h && h.primary || !!k2 && k2.primary, audio: h, video: k2, bandwidth: d, allowedByApplication: true, allowedByKeySystem: true, decodingInfos: [] }, e.push(h), a.Na.add(u));
          }
          return e;
        }
        function gy(a, b) {
          b = rx(b, "CLOSED-CAPTIONS");
          a.O = 0 == b.length;
          b = t(b);
          for (var c = b.next(); !c.done; c = b.next()) {
            var d = c.value, e = mx(d, "LANGUAGE");
            c = Of(e || "und");
            e || (e = mx(d, "NAME")) && (c = e);
            e = nx(d, "GROUP-ID");
            d = nx(d, "INSTREAM-ID").replace("SERVICE", "svc");
            a.G.get(e) || a.G.set(e, /* @__PURE__ */ new Map());
            a.G.get(e).set(d, c);
          }
        }
        function wy(a, b, c, d) {
          d = void 0 === d ? true : d;
          for (var e = [], f = [], g = /* @__PURE__ */ new Map(), h = t(b), k2 = h.next(); !k2.done; k2 = h.next()) {
            var l = k2.value;
            k2 = d ? nx(l, "URI") : mx(l, "URI") || "shaka://hls-muxed";
            l = nx(l, "GROUP-ID");
            e.push(k2);
            f.push(l);
            g.set(l, k2);
          }
          d = f.sort().join(",");
          k2 = b[0];
          b = "";
          h = nx(k2, "TYPE").toLowerCase();
          "subtitles" == h && (h = dd);
          if (h == dd) b = mx(k2, "CODECS") || "";
          else for (f = t(f), l = f.next(); !l.done; l = f.next()) if (l = l.value, a.H.has(l)) {
            b = a.H.get(l);
            break;
          }
          f = e.sort().join(",");
          if (a.i.has(f)) return a.i.get(f);
          l = a.F++;
          if (a.j) {
            g = t(g);
            for (var m = g.next(); !m.done; m = g.next()) {
              var n = t(m.value);
              m = n.next().value;
              n = n.next().value;
              (m = c.get(m)) && uv(a.j, l, m, n);
            }
          }
          c = mx(k2, "LANGUAGE");
          g = mx(k2, "NAME");
          m = "YES" == mx(k2, "DEFAULT");
          "audio" == h ? n = (n = mx(k2, "CHANNELS")) ? parseInt(n.split("/")[0], 10) : null : n = null;
          var p;
          "audio" == h ? (p = mx(k2, "CHANNELS")) ? (p = p.split("/"), p = 2 != p.length ? false : "JOC" === p[1] || p[1].includes("ATMOS")) : p = false : p = false;
          var q = mx(k2, "CHARACTERISTICS"), u = "YES" == mx(k2, "FORCED");
          "audio" == h ? k2 = (k2 = mx(k2, "SAMPLE-RATE")) ? parseInt(k2, 10) : null : k2 = null;
          e = Jy(
            a,
            l,
            e,
            b,
            h,
            c,
            m,
            g,
            n,
            null,
            q,
            u,
            k2,
            p
          );
          e.stream && (e.stream.groupId = d);
          a.I.has(d) ? a.I.get(d).push(e) : a.I.set(d, [e]);
          a.i.set(f, e);
          return e;
        }
        function Ay(a, b) {
          var c, d, e, f, g, h, k2, l, m, n;
          return Q(function(p) {
            if (1 == p.g) {
              c = nx(b, "URI");
              d = mx(b, "CODECS", "jpeg") || "";
              if (a.i.has(c)) return p.return(a.i.get(c));
              e = mx(b, "LANGUAGE");
              f = mx(b, "NAME");
              g = mx(b, "CHARACTERISTICS");
              h = Jy(a, a.F++, [c], d, "image", e, false, f, null, null, g, false, null, false);
              return (k2 = mx(b, "RESOLUTION")) ? F(p, h.stream.createSegmentIndex(), 3) : p.s(2);
            }
            2 != p.g && (l = Ag(h.stream.segmentIndex), m = l.tilesLayout) && (h.stream.width = Number(k2.split("x")[0]) * Number(m.split("x")[0]), h.stream.height = Number(k2.split("x")[1]) * Number(m.split("x")[1]));
            if (n = mx(b, "BANDWIDTH")) h.stream.bandwidth = Number(n);
            a.i.set(c, h);
            return p.return(h);
          });
        }
        function By(a, b) {
          var c = "video", d = nx(b, "URI"), e = mx(b, "CODECS") || "";
          "mjpg" == e && (c = "image");
          if (a.i.has(d)) return a.i.get(d);
          var f = mx(b, "LANGUAGE"), g = mx(b, "NAME"), h = mx(b, "CHARACTERISTICS");
          c = Jy(a, a.F++, [d], e, c, f, false, g, null, null, h, false, null, false);
          e = mx(b, "RESOLUTION");
          f = t(e ? e.split("x") : [null, null]);
          e = f.next().value;
          f = f.next().value;
          c.stream.width = Number(e) || void 0;
          c.stream.height = Number(f) || void 0;
          if (b = mx(b, "BANDWIDTH")) c.stream.bandwidth = Number(b);
          a.i.set(d, c);
          return c;
        }
        function Hy(a, b, c, d) {
          for (var e = a.F++, f = [], g = t(b), h = g.next(); !h.done; h = g.next()) {
            var k2 = h.value;
            h = nx(k2, "URI");
            k2 = mx(k2, "PATHWAY-ID");
            a.j && k2 && uv(a.j, e, k2, h);
            f.push(h);
          }
          g = f.sort().join(",") + c.sort().join(",");
          if (a.i.has(g)) return a.i.get(g);
          h = f.join(",");
          a: {
            b = mx(b[0], "CLOSED-CAPTIONS");
            if ("video" == d) {
              if (a.g.disableText) {
                a.O = false;
                b = null;
                break a;
              }
              if (b) {
                if ("NONE" != b) {
                  b = a.G.get(b);
                  break a;
                }
                a.O = false;
              } else if (!b && a.G.size) for (b = t(a.G.keys()).next(); !b.done; ) {
                b = a.G.get(b.value);
                break a;
              }
            }
            b = null;
          }
          c = ad(d, c);
          d = Jy(
            a,
            e,
            f,
            c,
            d,
            null,
            false,
            h,
            null,
            b,
            null,
            false,
            null,
            false
          );
          a.i.set(g, d);
          return d;
        }
        function Jy(a, b, c, d, e, f, g, h, k2, l, m, n, p, q) {
          function u(D) {
            var G, B, A, H, E, K, M, J, L, N, P, O, R, S, pa, Z, Fa, Ia, sa, ka, Ca, ra, ya;
            return Q(function(na) {
              switch (na.g) {
                case 1:
                  return G = fd, xa(na, 2), F(na, D.promise, 4);
                case 4:
                  B = na.h;
                  if (D.aborted) return na.return();
                  A = B.uri;
                  A != B.originalUri && (H = x.N(), H.includes(A) || x.ve.push(A));
                  E = yx(a.Ga, B.data);
                  if (1 != E.type) throw new U(2, 4, 4017);
                  K = qx(E.ca, "EXT-X-DEFINE");
                  M = Sx(a, K, A);
                  J = false;
                  (!a.Z && a.g.hls.disableCodecGuessing || a.O && e == G.la && !a.g.hls.disableClosedCaptionsDetection) && 0 < E.segments.length && (a.O = false, J = true);
                  L = !a.Z && a.g.hls.disableCodecGuessing;
                  N = Lx(a);
                  return F(na, by(a, 0, M, E, w, d, e, f, g, h, k2, l, m, n, p, q, void 0, J, L), 5);
                case 5:
                  P = na.h;
                  if (D.aborted) return na.return();
                  O = P.stream;
                  ly(a, E);
                  Lx(a) && !N && my(a, E);
                  x.Bc = P.Bc;
                  x.Vb = P.Vb;
                  x.Ud = P.Ud;
                  x.Td = P.Td;
                  x.rd = P.rd;
                  x.je = P.je;
                  x.Ab = P.Ab;
                  x.Bb = P.Bb;
                  x.Rf = true;
                  v.segmentIndex = O.segmentIndex;
                  v.encrypted = O.encrypted;
                  v.drmInfos = O.drmInfos;
                  v.keyIds = O.keyIds;
                  v.mimeType = O.mimeType;
                  v.bandwidth = v.bandwidth || O.bandwidth;
                  v.codecs = v.codecs || O.codecs;
                  v.closedCaptions = v.closedCaptions || O.closedCaptions;
                  v.width = v.width || O.width;
                  v.height = v.height || O.height;
                  v.hdr = v.hdr || O.hdr;
                  v.colorGamut = v.colorGamut || O.colorGamut;
                  v.frameRate = v.frameRate || O.frameRate;
                  "und" == v.language && "und" != O.language && (v.language = O.language);
                  v.language = v.language || O.language;
                  v.channelsCount = v.channelsCount || O.channelsCount;
                  v.audioSamplingRate = v.audioSamplingRate || O.audioSamplingRate;
                  zy(v);
                  v.drmInfos.length && a.h.newDrmInfo(v);
                  R = false;
                  if (!l && v.closedCaptions || l && v.closedCaptions && l.size != v.closedCaptions.size) R = true;
                  a.m && R && a.h.makeTextStreamsForClosedCaptions(a.m);
                  if (e == G.la || e == G.V) for (S = t(a.i.values()), pa = S.next(); !pa.done; pa = S.next()) Z = pa.value, Z.Rf || Z.type != e || (Z.stream.mimeType = O.mimeType, zy(Z.stream));
                  e == G.za && (Fa = Ag(O.segmentIndex)) && Fa.$ && (v.mimeType = "application/mp4", zy(v));
                  Ia = em(v);
                  v.segmentIndex.Eb(function(ta) {
                    ta.$ && (ta.$.Wc = Ia);
                  });
                  Ky(a) && (a.Ub ? ny(a, [x]) : (a.Ub = true, sa = Array.from(a.i.values()), ka = sa.filter(function(ta) {
                    return ta.stream.segmentIndex;
                  }), ny(a, ka), Qx(a), Ca = a.o, 0 < Ca && a.B.da(Ca)));
                  Xx(
                    a,
                    E.ca,
                    v.type,
                    M,
                    w
                  );
                  a.m && (a.m.startTime = a.u);
                  Aa(na, 0);
                  break;
                case 2:
                  ra = Ba(na);
                  v.closeSegmentIndex();
                  if (7001 === ra.code) return na.return();
                  ya = a.h.disableStream(v);
                  if (!ya) throw ra;
                  I(na);
              }
            });
          }
          function w() {
            return a.j && 1 < c.length ? vv(a.j, b) : x.ve.concat(vx([a.C], c, a.A));
          }
          var v = Ly(a, d, e, f, g, h, k2, l, m, n, p, q);
          c.includes("shaka://hls-muxed") && (v.isAudioMuxedInVideo = true, v.mimeType = "video/mp2t", zy(v));
          var x = { stream: v, type: e, ve: [], Bc: 0, Vb: 0, je: /* @__PURE__ */ new Map(), Ud: false, Td: false, rd: false, qf: -1, Ab: -1, Bb: -1, Rf: false, N: w }, z = null, C;
          v.createSegmentIndex = function() {
            if (z) return z;
            if (v.isAudioMuxedInVideo) return v.segmentIndex = new Sl([]), Promise.resolve();
            C = Jx(a, x.N(), true);
            return z = new Promise(function(D) {
              D(u(C));
            });
          };
          v.closeSegmentIndex = function() {
            z && !v.segmentIndex && C.abort();
            v.segmentIndex && (v.segmentIndex.release(), v.segmentIndex = null);
            z = null;
          };
          return x;
        }
        function uy(a) {
          var b = Infinity;
          a = t(a.i.values());
          for (var c = a.next(); !c.done; c = a.next()) c = c.value, c.stream.segmentIndex && "text" != c.stream.type && !c.stream.isAudioMuxedInVideo && (b = Math.min(b, c.Vb));
          return b;
        }
        function Nx(a, b) {
          var c = [];
          b = t(b);
          for (var d = b.next(); !d.done; d = b.next()) d = d.value, d.segmentIndex && d.segmentIndex.Eb(function(e) {
            c.push(e);
          });
          a.l.Ed(c);
        }
        function ny(a, b) {
          if (!Lx(a)) for (var c = uy(a), d = t(b), e = d.next(); !e.done; e = d.next()) e.value.stream.segmentIndex.Oc(0, c);
          Nx(a, b.map(function(f) {
            return f.stream;
          }));
          d = Array.from(a.i.values()).filter(function(f) {
            return f.stream.segmentIndex;
          });
          c = d.some(function(f) {
            return "audio" == f.stream.type;
          });
          e = d.some(function(f) {
            return "video" == f.stream.type;
          });
          d = Lx(a) && !a.Ma;
          c = !Lx(a) && a.Ma && !(c && e);
          a.g.hls.ignoreManifestProgramDateTime || d || c ? Yx(a, b, d) : (ay(a, b), 0 < a.g.hls.ignoreManifestProgramDateTimeForTypes.length && Yx(
            a,
            b
          ));
        }
        function Zx(a, b) {
          return a.g.hls.ignoreManifestProgramDateTime ? true : a.g.hls.ignoreManifestProgramDateTimeForTypes.includes(b);
        }
        function Ky(a) {
          if (!a.m) return false;
          var b = [], c = [];
          a = t(a.m.variants);
          for (var d = a.next(); !d.done; d = a.next()) d = d.value, d.video && b.push(d.video), d.audio && c.push(d.audio);
          return 0 < b.length && !b.some(function(e) {
            return e.segmentIndex;
          }) || 0 < c.length && !c.some(function(e) {
            return e.segmentIndex;
          }) ? false : true;
        }
        function by(a, b, c, d, e, f, g, h, k2, l, m, n, p, q, u, w, v, x, z) {
          x = void 0 === x ? true : x;
          z = void 0 === z ? true : z;
          var C, D, G, B, A, H, E, K, M, J, L, N, P, O, R, S, pa, Z, Fa, Ia, sa, ka, Ca, ra, ya, na, ta, Pa, ob;
          return Q(function(db) {
            switch (db.g) {
              case 1:
                C = d.segments || [];
                D = C.every(function(eb) {
                  return sx(eb.ca, "EXT-X-GAP") ? true : false;
                });
                if (!C.length || D) throw new U(2, 4, 4053);
                My(a, d);
                Lx(a) && Wx(a, d);
                G = Lx(a) ? a.M.get(g) : /* @__PURE__ */ new Map();
                B = Ux(a, d, G, c, e, g);
                A = B.segments;
                H = B.bandwidth;
                L = J = M = K = E = null;
                if (!(0 < A.length && x)) {
                  db.s(2);
                  break;
                }
                return F(db, oy(a, A), 3);
              case 3:
                N = db.h, g = N.type, h = N.language, m = N.channelCount, u = N.sampleRate, a.g.disableText || (n = N.closedCaptions), K = N.height, E = N.width, M = N.Nd, J = N.colorGamut, L = N.frameRate, z && (v = N.mimeType, f = N.codecs);
              case 2:
                if (v) {
                  db.s(4);
                  break;
                }
                return F(db, Ny(a, g, f, A), 5);
              case 5:
                v = db.h, g != dd || f || "application/mp4" != v || !A[0] || A[0].$ || (v = "text/vtt");
              case 4:
                return F(db, Tx(a, d, v, e, c), 6);
              case 6:
                P = db.h;
                O = P.drmInfos;
                R = P.keyIds;
                S = P.encrypted;
                pa = P.Bg;
                if (S && !O.length && !pa) throw new U(2, 4, 4026);
                Z = Ly(a, f, g, h, k2, l, m, n, p, q, u, w);
                Z.encrypted = S && !pa;
                Z.drmInfos = O;
                Z.keyIds = R;
                Z.mimeType = v;
                H && (Z.bandwidth = H);
                zy(Z);
                "video" == g && (E || K || M || J) && Iy(Z, E, K, L, M, null, J);
                Lx(a) && Wx(a, d);
                Fa = A[0].startTime;
                Ia = A[A.length - 1];
                sa = Ia.endTime;
                ka = new Sl(A);
                Z.segmentIndex = ka;
                ra = (Ca = sx(d.ca, "EXT-X-SERVER-CONTROL")) ? null != lx(Ca, "CAN-SKIP-UNTIL") : false;
                ya = Ca ? null != lx(Ca, "CAN-BLOCK-RELOAD") : false;
                na = tx(d.ca, "EXT-X-MEDIA-SEQUENCE", 0);
                ta = Vx(na, A);
                Pa = ta.Ab;
                ob = ta.Bb;
                return db.return({ stream: Z, type: g, ve: [], N: e, Bc: Fa, Vb: sa, Ud: ra, Td: ya, rd: false, qf: -1, Ab: Pa, Bb: ob, je: G, Rf: false });
            }
          });
        }
        function Vx(a, b) {
          a = a + b.length - 1;
          var c = -1;
          if (!b.length) return a++, { Ab: a, Bb: c };
          b = b[b.length - 1];
          var d = b.g;
          if (!b.g.length) return a++, b.m && (c = 0), { Ab: a, Bb: c };
          c = d.length - 1;
          d[d.length - 1].isPreload() || (a++, c = 0);
          return { Ab: a, Bb: c };
        }
        function Ly(a, b, c, d, e, f, g, h, k2, l, m, n) {
          var p = xy(c, b) || yy(c), q = [];
          if (k2) {
            k2 = t(k2.split(","));
            for (var u = k2.next(); !u.done; u = k2.next()) q.push(u.value);
          }
          k2 = void 0;
          u = null;
          c == dd ? k2 = q.includes("public.accessibility.transcribes-spoken-dialog") && q.includes("public.accessibility.describes-music-and-sound") ? "caption" : "subtitle" : q.includes("public.accessibility.describes-video") && (u = "visually impaired");
          q.length || "subtitle" !== k2 || q.push("subtitle");
          a = {
            id: a.F++,
            originalId: f,
            groupId: null,
            createSegmentIndex: function() {
              return Promise.resolve();
            },
            segmentIndex: null,
            mimeType: p,
            codecs: b,
            kind: c == dd ? "subtitle" : void 0,
            encrypted: false,
            drmInfos: [],
            keyIds: /* @__PURE__ */ new Set(),
            language: Of(d || "und"),
            originalLanguage: d,
            label: f,
            type: c,
            primary: e,
            trickModeVideo: null,
            dependencyStream: null,
            emsgSchemeIdUris: null,
            frameRate: void 0,
            pixelAspectRatio: void 0,
            width: void 0,
            height: void 0,
            bandwidth: void 0,
            roles: q,
            forced: l,
            channelsCount: g,
            audioSamplingRate: m,
            spatialAudio: n,
            closedCaptions: h,
            hdr: void 0,
            colorGamut: void 0,
            videoLayout: void 0,
            tilesLayout: void 0,
            accessibilityPurpose: u,
            external: false,
            fastSwitching: false,
            fullMimeTypes: /* @__PURE__ */ new Set(),
            isAudioMuxedInVideo: false,
            baseOriginalId: null
          };
          zy(a);
          return a;
        }
        function Tx(a, b, c, d, e) {
          var f, g, h, k2, l, m, n, p, q, u, w, v, x, z, C, D, G, B, A, H, E, K, M, J, L, N, P, O, R;
          return Q(function(S) {
            switch (S.g) {
              case 1:
                f = /* @__PURE__ */ new Map();
                if (!a.g.ignoreDrmInfo && b.segments) {
                  for (g = t(b.segments), h = g.next(); !h.done; h = g.next()) if (k2 = h.value, l = qx(k2.ca, "EXT-X-KEY"), m = null, l.length) for (m = Oy(a, b, k2.ca, d, e), n = t(l), p = n.next(); !p.done; p = n.next()) q = p.value, f.set(q, m);
                }
                w = u = false;
                v = [];
                x = /* @__PURE__ */ new Set();
                z = t(f);
                C = z.next();
              case 2:
                if (C.done) {
                  S.s(4);
                  break;
                }
                D = C.value;
                G = t(D);
                B = G.next().value;
                A = G.next().value;
                H = B;
                E = A;
                K = nx(H, "METHOD");
                if ("NONE" == K) {
                  S.s(3);
                  break;
                }
                u = true;
                M = mx(H, "KEYFORMAT") || "identity";
                J = null;
                if (Dy(K)) {
                  w = true;
                  S.s(3);
                  break;
                }
                if ("identity" == M) return F(S, Ey(a, H, c, d, E, e), 11);
                L = a.Sb.get(M);
                if (!L) {
                  N = null;
                  S.s(9);
                  break;
                }
                return F(S, L(H, c, E), 10);
              case 10:
                N = S.h;
              case 9:
                J = N;
                S.s(6);
                break;
              case 11:
                J = S.h;
              case 6:
                if (J) {
                  if (J.keyIds) for (P = t(J.keyIds), O = P.next(); !O.done; O = P.next()) R = O.value, x.add(R);
                  v.push(J);
                }
              case 3:
                C = z.next();
                S.s(2);
                break;
              case 4:
                return S.return({ drmInfos: v, keyIds: x, encrypted: u, Bg: w });
            }
          });
        }
        function Py(a, b, c, d, e) {
          if (!window2.crypto || !window2.crypto.subtle) throw bb("Web Crypto API is not available to decrypt AES. (Web Crypto only exists in secure origins like https)"), new U(2, 4, 4042);
          var f = 0, g = mx(b, "IV", "");
          if (g) {
            var h = Uc(g.substr(2));
            if (16 != h.byteLength) throw new U(2, 4, 4048);
          } else f = tx(c.ca, "EXT-X-MEDIA-SEQUENCE", 0);
          var k2 = ux(d(), nx(b, "URI"), e), l = k2.sort().join("");
          c = b.toString() + "-" + f + "-" + l;
          if (!a.ka.has(c)) {
            var m = { bitsKey: 128, blockCipherMode: "CBC", iv: h, firstMediaSequenceNumber: f };
            switch (nx(
              b,
              "METHOD"
            )) {
              case "AES-256":
                m.bitsKey = 256;
                break;
              case "AES-256-CTR":
                m.bitsKey = 256, m.blockCipherMode = "CTR";
            }
            m.fetchKey = function() {
              var n, p, q, u;
              return Q(function(w) {
                if (1 == w.g) return a.L.has(l) || (n = lh(k2, a.g.retryParameters), p = sy(a, n, 6).promise, a.L.set(l, p)), F(w, a.L.get(l), 2);
                if (3 != w.g) {
                  q = w.h;
                  if (!q.data || q.data.byteLength != m.bitsKey / 8) throw new U(2, 4, 4049);
                  u = { name: "CTR" == m.blockCipherMode ? "AES-CTR" : "AES-CBC", length: m.bitsKey };
                  return F(w, window2.crypto.subtle.importKey("raw", q.data, u, true, ["decrypt"]), 3);
                }
                m.cryptoKey = w.h;
                m.fetchKey = void 0;
                I(w);
              });
            };
            a.ka.set(c, m);
          }
          return a.ka.get(c);
        }
        function ly(a, b) {
          null == a.u && (b = sx(b.ca, "EXT-X-START")) && (a.u = Number(nx(b, "TIME-OFFSET")));
        }
        function My(a, b) {
          var c = sx(b.ca, "EXT-X-PLAYLIST-TYPE");
          b = sx(b.ca, "EXT-X-ENDLIST");
          b = c && "VOD" == c.value || b;
          c = c && "EVENT" == c.value && !b;
          c = !b && !c;
          b ? Px(a, Ix) : c ? Px(a, ty) : Px(a, Qy);
        }
        function Wx(a, b) {
          var c = Infinity, d = b.segments;
          if (d.length) for (var e = d.length - 1; 0 <= e; ) {
            var f = sx(d[e].ca, "EXTINF");
            if (f) {
              c = Number(f.value.split(",")[0]);
              break;
            }
            e--;
          }
          d = sx(b.ca, "EXT-X-TARGETDURATION");
          if (!d) throw new U(2, 4, 4024, "EXT-X-TARGETDURATION");
          d = Number(d.value);
          if (e = sx(b.ca, "EXT-X-PART-INF")) a.P = Number(nx(e, "PART-TARGET"));
          b = sx(b.ca, "EXT-X-SERVER-CONTROL");
          a.fa && a.P ? (a.o = a.Tb ? 5 * a.P <= c ? Math.min(a.P, a.o) : Math.min(c, a.o) : Math.min(a.P, a.o), a.Fa = b ? Number(nx(b, "PART-HOLD-BACK")) : 0) : (a.o = Math.min(c, a.o), c = b ? lx(b, "HOLD-BACK") : null, a.Aa = c ? Number(c.value) : 0);
          a.La = Math.max(d, a.La);
        }
        function my(a, b) {
          var c = 0;
          if (a.g.defaultPresentationDelay) c = a.g.defaultPresentationDelay;
          else if (a.Fa) c = a.Fa;
          else if (a.Aa) c = a.Aa;
          else {
            var d = b.segments.length, e = a.g.hls.liveSegmentsDelay;
            e > d - 2 && (e = Math.max(1, d - 2));
            for (e = d - e; e < d; e++) {
              var f = sx(b.segments[e].ca, "EXTINF");
              c = f ? c + Math.ceil(Number(f.value.split(",")[0])) : c + a.La;
            }
          }
          a.u && 0 > a.u && (c = Math.min(-a.u, c), a.u += c);
          a.l.yh(0);
          a.l.jg(c);
          a.l.Gc(false);
        }
        function Oy(a, b, c, d, e) {
          var f = sx(c, "EXT-X-MAP");
          if (!f) return null;
          var g = nx(f, "URI"), h = ux(d(), g, e);
          g = [h.toString(), mx(f, "BYTERANGE", "")].join("-");
          if (!a.sa.has(g)) {
            var k2 = void 0, l = null, m = false;
            c = t(c);
            for (var n = c.next(); !n.done; n = c.next()) n = n.value, "EXT-X-KEY" == n.name ? (m = nx(n, "METHOD"), Dy(m) && n.id < f.id ? (m = false, k2 = Py(a, n, b, d, e)) : m = "NONE" != m) : "EXT-X-BYTERANGE" == n.name && n.id < f.id && (l = n);
            b = Ry(h, f, l, k2, m);
            a.sa.set(g, b);
          }
          return a.sa.get(g);
        }
        function Ry(a, b, c, d, e) {
          var f = 0, g = null;
          b = mx(b, "BYTERANGE");
          !b && c && (b = c.value);
          b && (f = b.split("@"), g = Number(f[0]), f = Number(f[1]), g = f + g - 1, d && (c = g + 1 - f, c % 16 && (g += 16 - c % 16)));
          return new Lj(function() {
            return a;
          }, f, g, null, null, null, d, e);
        }
        function Sy(a, b, c, d, e, f, g, h, k2) {
          function l(S) {
            S = new yb(S).ab.split(".").pop();
            var pa = Ty.get(g).get(S);
            pa || (pa = qy.get(S));
            return pa;
          }
          var m = d.ca, n = sx(m, "EXTINF"), p = 0, q = 0, u = null;
          d.Jb.length && (a.m.isLowLatency = true);
          var w = null;
          if (!a.g.hls.ignoreManifestProgramDateTime) {
            var v = sx(m, "EXT-X-PROGRAM-DATE-TIME");
            v && v.value && (w = ke(v.value), a.Ma = true);
          }
          var x = Oj;
          sx(m, "EXT-X-GAP") && (a.m.gapCount++, x = 2);
          if (!n) {
            if (0 == d.Jb.length) throw new U(2, 4, 4024, "EXTINF");
            if (!a.fa) return null;
          }
          var z = [];
          v = false;
          var C = null, D = false, G = false;
          if (a.fa && d.Jb.length) {
            p = b && window2.ReadableStream && a.g.hls.allowLowLatencyByteRangeOptimization;
            for (var B = w, A = {}, H = 0; H < d.Jb.length; A = { Le: void 0, re: void 0 }, H++) {
              var E = d.Jb[H], K = 0 == H ? c : z[z.length - 1], M = 0 == H ? e : K.endTime, J = Number(mx(E, "DURATION")) || a.P;
              if (J) {
                var L = M + J, N = 0, P = null;
                "EXT-X-PRELOAD-HINT" == E.name ? (N = (N = mx(E, "BYTERANGE-START")) ? Number(N) : 0, (K = mx(E, "BYTERANGE-LENGTH")) ? P = N + Number(K) - 1 : N && (P = Number.MAX_SAFE_INTEGER)) : (N = mx(E, "BYTERANGE"), P = t(Uy(K, N)), N = P.next().value, P = P.next().value);
                A.re = mx(E, "URI");
                if (A.re) {
                  K = Oj;
                  "YES" == mx(E, "GAP") && (a.m.gapCount++, K = 2, D = true);
                  A.Le = null;
                  var O = /* @__PURE__ */ function(S) {
                    return function() {
                      null == S.Le && (S.Le = ux(h(), S.re, f));
                      return S.Le;
                    };
                  }(A);
                  p && 0 <= N && null != P && (C = O, v = true);
                  M = new Nj(M, L, O, N, P, b, 0, 0, Infinity, [], "", null, B, K, k2);
                  "EXT-X-PRELOAD-HINT" == E.name && (M.Sf(), G = true);
                  "YES" != mx(E, "INDEPENDENT") && 0 < H && M.Vc();
                  if (A = l(A.re)) M.mimeType = A, Vy.has(A) && (M.$ = null);
                  z.push(M);
                  B && (B += J);
                }
              }
            }
          }
          if (n) {
            n = Number(n.value.split(",")[0]);
            if (0 == n) return null;
            p = e + n;
          } else if (z.length) p = z[z.length - 1].endTime;
          else return null;
          v && (D || 0 != z[0].Sa ? (v = false, C = null) : z = []);
          (n = sx(m, "EXT-X-BYTERANGE")) ? (u = t(Uy(c, n.value)), q = u.next().value, u = u.next().value) : z.length && (q = z[0].Sa, u = z[z.length - 1].wa);
          c = "";
          n = null;
          "image" == g && (c = "1x1", m = sx(m, "EXT-X-TILES")) && (c = nx(m, "LAYOUT"), (m = mx(m, "DURATION")) && (n = Number(m)));
          var R = null;
          b = new Nj(e, p, function() {
            if (C) return C();
            null == R && (R = ux(h(), d.g, f));
            return R || [];
          }, q, u, b, 0, 0, Infinity, z, c, n, w, x, k2, 0 < z.length && !!d.g);
          if (e = l(d.g)) b.mimeType = e, Vy.has(e) && (b.$ = null);
          v && (a.Tb = true, b.dh(), G && b.Sf());
          return b;
        }
        function Uy(a, b) {
          var c = 0, d = null;
          b && (c = b.split("@"), b = Number(c[0]), c = c[1] ? Number(c[1]) : a.wa + 1, d = c + b - 1);
          return [c, d];
        }
        function Xx(a, b, c, d, e) {
          if ("video" == c || "audio" == c) {
            var f = a.l.m;
            if (f && !Zx(a, c)) for (b = qx(b, "EXT-X-DATERANGE"), b = b.filter(function(M) {
              return null != lx(M, "START-DATE");
            }).sort(function(M, J) {
              M = nx(M, "START-DATE");
              J = nx(J, "START-DATE");
              return M < J ? -1 : M > J ? 1 : 0;
            }), c = 0; c < b.length; c++) {
              var g = b[c];
              try {
                var h = nx(g, "ID");
                if (!a.ya.has(h)) {
                  var k2 = nx(g, "START-DATE"), l = ke(k2);
                  if (!isNaN(l)) {
                    var m = Math.max(0, l - f), n = null, p = mx(g, "END-DATE");
                    if (p) {
                      var q = ke(p);
                      if (!isNaN(q) && (n = q - f, 0 > n)) continue;
                    }
                    if (null == n) {
                      var u = mx(g, "DURATION") || mx(g, "PLANNED-DURATION");
                      if (u) {
                        var w = parseFloat(u);
                        isNaN(w) || (n = m + w);
                        if (0 > l - f + w) continue;
                      }
                    }
                    var v = mx(g, "CLASS") || "com.apple.quicktime.HLS", x = "YES" == mx(g, "END-ON-NEXT");
                    if (null == n && x) {
                      for (var z = c + 1; z < b.length; z++) {
                        var C = mx(b[z], "CLASS") || "com.apple.quicktime.HLS";
                        if (v == C) {
                          var D = nx(b[z], "START-DATE"), G = ke(D);
                          if (!isNaN(G) && G && G > l) {
                            n = Math.max(0, G - f);
                            break;
                          }
                        }
                      }
                      if (null == n) continue;
                    }
                    z = ["CLASS", "START-DATE", "END-DATE", "DURATION", "END-ON-NEXT"];
                    for (var B = [], A = t(g.attributes), H = A.next(); !H.done; H = A.next()) {
                      var E = H.value;
                      if (!z.includes(E.name)) {
                        var K = wx(E.value, d);
                        if ("X-ASSET-URI" == E.name || "X-ASSET-LIST" == E.name) K = ux(e(), E.value, d)[0];
                        B.push({ key: E.name, description: "", data: K, mimeType: null, pictureType: null });
                      }
                    }
                    if (1 < B.length) a.h.onMetadata(v, m, n, B);
                    a.ya.add(h);
                  }
                }
              } catch (M) {
              }
            }
          }
        }
        function Ux(a, b, c, d, e, f) {
          var g = b.segments, h = void 0, k2 = tx(b.ca, "EXT-X-DISCONTINUITY-SEQUENCE", -1), l = tx(b.ca, "EXT-X-MEDIA-SEQUENCE", 0), m = sx(b.ca, "EXT-X-SKIP"), n = m ? Number(mx(m, "SKIPPED-SEGMENTS")) : 0, p = l + n, q = 0;
          Lx(a) && c.has(p) && (q = c.get(p));
          0 === q && a.Ea == ty && 0 < c.size && !c.has(p) && null != a.l.i && (q = a.l.pb());
          var u = [], w = null;
          m = [];
          for (var v = 0; v < g.length; v++) {
            var x = g[v], z = 0 == v ? q : w.endTime;
            p = l + n + v;
            sx(x.ca, "EXT-X-DISCONTINUITY") && (k2++, w && w.$ && (w.$.g = z));
            var C = t(x.ca);
            for (var D = C.next(); !D.done; D = C.next()) D = D.value, "EXT-X-KEY" == D.name && (Dy(nx(D, "METHOD")) ? h = Py(a, D, b, e, d) : h = void 0);
            c.set(p, z);
            C = Oy(a, b, x.ca, e, d);
            if (z = Sy(a, C, w, x, z, d, f, e, h)) (w = tx(x.ca, "EXT-X-BITRATE")) ? m.push({ bitrate: w, duration: z.endTime - z.startTime }) : m.length && (w = m.pop(), w.duration += z.endTime - z.startTime, m.push(w)), w = z, z.i = k2, Zx(a, f) && null != a.K && p < a.K || u.push(z);
          }
          b = void 0;
          m.length && (b = m.reduce(function(G, B) {
            return G + B.duration;
          }, 0), b = Math.round(m.reduce(function(G, B) {
            return G + B.bitrate * B.duration;
          }, 0) / b * 1e3));
          if (m = u.some(function(G) {
            return null != G.h;
          })) {
            for (c = {}, d = 0; d < u.length; c = { Xd: void 0, Wd: void 0, Qd: void 0, Dc: void 0, Pd: void 0 }, d++) if (c.Dc = u[d], null == c.Dc.h) for (c.Wd = 0, c.Xd = d, e = /* @__PURE__ */ function(G) {
              return function() {
                var B = u[G.Xd];
                if (B) {
                  if (null != B.h) return B.h + G.Wd;
                  G.Wd -= B.endTime - B.startTime;
                  G.Xd += 1;
                }
                return null;
              };
            }(c), c.Pd = 0, c.Qd = d, g = /* @__PURE__ */ function(G) {
              return function() {
                var B = u[G.Qd];
                if (B) {
                  B != G.Dc && (G.Pd += B.endTime - B.startTime);
                  if (null != B.h) return B.h + G.Pd;
                  --G.Qd;
                }
                return null;
              };
            }(c); null == c.Dc.h; ) c.Dc.h = g(), null == c.Dc.h && (c.Dc.h = e());
          }
          if (m) for (c = t(u), d = c.next(); !d.done; d = c.next()) for (e = d.value, d = e.h, e = t(e.g), g = e.next(); !g.done; g = e.next()) g = g.value, g.h = d, d += g.endTime - g.startTime;
          c = a.ea;
          if (m && Infinity != c && !Zx(a, f)) for (a = t(u), f = a.next(); !f.done; f = a.next()) f.value.qg(c);
          return { segments: u, bandwidth: b };
        }
        function xy(a, b) {
          if (a == dd) {
            if ("vtt" == b || "wvtt" == b) return "text/vtt";
            if (b && "" !== b) return "application/mp4";
          }
          return "image" != a || b && "jpeg" != b ? "audio" == a && "mp4a.40.34" == b ? "audio/mpeg" : "mjpg" == b ? "application/mp4" : null : "image/jpeg";
        }
        function yy(a) {
          return a == dd ? "text/vtt" : Ty.get(a).get("mp4");
        }
        function py(a, b) {
          a = Lx(a) ? Math.trunc((b.length - 1) / 2) : 0;
          for (var c = b[a]; 2 == c.dc() && a + 1 < b.length; ) a++, c = b[a];
          return { segment: c, segmentIndex: a };
        }
        function Ny(a, b, c, d) {
          var e, f, g, h, k2, l, m, n, p, q, u, w, v;
          return Q(function(x) {
            switch (x.g) {
              case 1:
                e = rh;
                f = py(a, d);
                g = f.segment;
                if (2 == g.status) return x.return(yy(b));
                h = g.N();
                k2 = new yb(h[0]);
                l = k2.ab.split(".").pop();
                m = Ty.get(b);
                if ((n = m.get(l)) || (n = qy.get(l)) || (n = xy(b, c))) return x.return(n);
                q = 1;
                u = lh(h, a.g.retryParameters);
                xa(x, 2);
                u.method = "HEAD";
                return F(x, sy(a, u, e, { type: q }).promise, 4);
              case 4:
                w = x.h;
                p = w.headers["content-type"];
                Aa(x, 3);
                break;
              case 2:
                v = Ba(x);
                if (!v || 1002 != v.code && 1001 != v.code) {
                  x.s(3);
                  break;
                }
                u.method = "GET";
                a.g.hls.allowRangeRequestsToGuessMimeType && (u.headers.Range = "bytes=0-0");
                return F(x, sy(a, u, e, { type: q }).promise, 6);
              case 6:
                w = x.h, p = w.headers["content-type"];
              case 3:
                if (!p) {
                  x.s(7);
                  break;
                }
                n = p.toLowerCase().split(";")[0];
                if ("application/octet-stream" != n) {
                  x.s(8);
                  break;
                }
                if (w.data.byteLength) {
                  x.s(9);
                  break;
                }
                u.method = "GET";
                return F(x, sy(a, u, e, { type: q }).promise, 10);
              case 10:
                w = x.h;
              case 9:
                Ik(Qb(w.data)) && (n = "video/mp2t");
              case 8:
                if ("application/octet-stream" != n) return x.return(n);
              case 7:
                return x.return(yy(b));
            }
          });
        }
        function Iy(a, b, c, d, e, f, g) {
          a && (a.width = Number(b) || void 0, a.height = Number(c) || void 0, a.frameRate = Number(d) || void 0, a.hdr = e || void 0, a.videoLayout = f || void 0, a.colorGamut = g || void 0);
        }
        function Jx(a, b, c) {
          return sy(a, lh(b, a.g.retryParameters), 0, { type: c ? 2 : 3 });
        }
        function Hx(a) {
          var b, c, d, e, f, g;
          return Q(function(h) {
            switch (h.g) {
              case 1:
                if (!a.h) return h.return();
                xa(h, 2);
                b = Date.now();
                return F(h, a.update(), 4);
              case 4:
                c = Date.now();
                Lx(a) && (d = (c - b) / 1e3, a.Pb.sample(1, d), e = 0 < a.g.updatePeriod ? a.g.updatePeriod : a.o, f = Math.max(0, e - Ya(a.Pb)), a.B.da(f));
                Aa(h, 3);
                break;
              case 2:
                g = Ba(h);
                if (!a.h) return h.return();
                if (a.g.raiseFatalErrorOnManifestUpdateRequestFailure) return a.h.onError(g), h.return();
                g.severity = 1;
                a.h.onError(g);
                a.B.da(0.1);
              case 3:
                if (!a.h) return h.return();
                a.h.onManifestUpdated();
                I(h);
            }
          });
        }
        function Lx(a) {
          return a.Ea != Ix;
        }
        function Px(a, b) {
          a.Ea = b;
          a.l && a.l.Gc(!Lx(a));
          Lx(a) || a.B.stop();
        }
        function sy(a, b, c, d) {
          if (!a.Y) throw new U(2, 7, 7001);
          d || (d = {});
          d.isPreload = a.Qb();
          b = a.h.networkingEngine.request(c, b, d);
          fh(a.Y, b);
          return b;
        }
        function Dy(a) {
          return "AES-128" == a || "AES-256" == a || "AES-256-CTR" == a;
        }
        function Gx(a, b, c, d) {
          var e, f, g, h, k2, l;
          return Q(function(m) {
            if (1 == m.g) {
              if ("video/mp2t" == c) throw new U(2, 4, 4040);
              if ("apple" === window2.shakaMediaKeysPolyfill) throw new U(2, 4, 4041);
              e = nx(b, "METHOD");
              f = ["SAMPLE-AES", "SAMPLE-AES-CTR"];
              if (!f.includes(e)) return m.return(null);
              g = "cenc";
              "SAMPLE-AES" == e && (g = "cbcs");
              h = nx(b, "URI");
              k2 = Yc("com.apple.fps", g, [{ initDataType: "sinf", initData: new Uint8Array(0), keyId: null }], h);
              var n = new yb(h).nb.replace(/-/g, "").toLowerCase();
              return (l = 32 === n.length && /^[0-9a-f]+$/.test(n) ? n : null) || !d ? m.s(2) : F(m, Wy(a, d), 3);
            }
            2 != m.g && (l = m.h);
            l && k2.keyIds.add(l);
            return m.return(k2);
          });
        }
        function Ey(a, b, c, d, e, f) {
          var g, h, k2, l, m, n, p, q, u, w, v, x;
          return Q(function(z) {
            switch (z.g) {
              case 1:
                if ("video/mp2t" == c) throw new U(2, 4, 4040);
                if ("apple" === window2.shakaMediaKeysPolyfill) throw new U(2, 4, 4041);
                g = nx(b, "METHOD");
                h = ["SAMPLE-AES", "SAMPLE-AES-CTR"];
                if (!h.includes(g)) return z.return(null);
                k2 = ux(d(), nx(b, "URI"), f);
                if (k2[0].startsWith("data:text/plain;base64,")) {
                  l = Vc(Tc(k2[0].split("data:text/plain;base64,").pop()));
                  z.s(2);
                  break;
                }
                m = k2.sort().join("");
                a.oa.has(m) || (n = lh(k2, a.g.retryParameters), p = sy(a, n, 6).promise, a.oa.set(m, p));
                return F(z, a.oa.get(m), 3);
              case 3:
                q = z.h, l = Vc(q.data);
              case 2:
                u = "00000000000000000000000000000000";
                if (!e) {
                  z.s(4);
                  break;
                }
                return F(z, Wy(a, e), 5);
              case 5:
                (w = z.h) && (u = w);
              case 4:
                return v = /* @__PURE__ */ new Map(), v.set(u, l), x = "cenc", "SAMPLE-AES" == g && (x = "cbcs"), z.return($c(v, x));
            }
          });
        }
        function Wy(a, b) {
          var c, d, e, f;
          return Q(function(g) {
            if (1 == g.g) {
              c = null;
              if (a.pa.has(b)) return c = a.pa.get(b), g.s(2);
              d = Am(b.N(), b.uc(), b.tc(), a.g.retryParameters);
              e = rh;
              return F(g, sy(a, d, e, { type: 0 }).promise, 3);
            }
            2 != g.g && (f = g.h, b.Kd(f.data), c = ym(f.data), a.pa.set(b, c));
            return g.return(c);
          });
        }
        T("shaka.hls.HlsParser", Fx);
        var qy = (/* @__PURE__ */ new Map()).set("aac", "audio/aac").set("ac3", "audio/ac3").set("ec3", "audio/ec3").set("mp3", "audio/mpeg"), Xy = (/* @__PURE__ */ new Map()).set("mp4", "audio/mp4").set("mp4a", "audio/mp4").set("m4s", "audio/mp4").set("m4i", "audio/mp4").set("m4a", "audio/mp4").set("m4f", "audio/mp4").set("cmfa", "audio/mp4").set("ts", "video/mp2t").set("tsa", "video/mp2t"), Yy = (/* @__PURE__ */ new Map()).set("mp4", "video/mp4").set("mp4v", "video/mp4").set("m4s", "video/mp4").set("m4i", "video/mp4").set("m4v", "video/mp4").set("m4f", "video/mp4").set("cmfv", "video/mp4").set(
          "ts",
          "video/mp2t"
        ).set("tsv", "video/mp2t"), Zy = (/* @__PURE__ */ new Map()).set("mp4", "application/mp4").set("m4s", "application/mp4").set("m4i", "application/mp4").set("m4f", "application/mp4").set("cmft", "application/mp4").set("vtt", "text/vtt").set("webvtt", "text/vtt").set("ttml", "application/ttml+xml"), $y = (/* @__PURE__ */ new Map()).set("jpg", "image/jpeg").set("png", "image/png").set("svg", "image/svg+xml").set("webp", "image/webp").set("avif", "image/avif"), Ty = (/* @__PURE__ */ new Map()).set("audio", Xy).set("video", Yy).set("text", Zy).set("image", $y), Vy = new Set(["video/mp2t"].concat(y(mf))), Ix = "VOD", Qy = "EVENT", ty = "LIVE", Ox = { Ph: Ix, Zj: Qy, gk: ty };
        Si("application/x-mpegurl", function() {
          return new Fx();
        });
        Si("application/vnd.apple.mpegurl", function() {
          return new Fx();
        });
        function az(a) {
          return tu(a);
        }
        var bz = (/* @__PURE__ */ new Map()).set("com.microsoft.playready", az).set("com.microsoft.playready.recommendation", az).set("com.microsoft.playready.software", az).set("com.microsoft.playready.hardware", az);
        function cz() {
          var a = this;
          this.h = this.g = null;
          this.l = [];
          this.j = null;
          this.u = 1;
          this.i = null;
          this.C = new Xa(5);
          this.o = new ec(function() {
            dz(a);
          });
          this.B = new eh();
          this.m = /* @__PURE__ */ new Map();
          this.A = function() {
            return false;
          };
        }
        r = cz.prototype;
        r.configure = function(a, b) {
          this.g = a;
          b && (this.A = b);
        };
        r.start = function(a, b) {
          var c = this;
          return Q(function(d) {
            if (1 == d.g) return c.l = [a], c.h = b, F(d, ez(c), 2);
            if (!c.h) throw new U(2, 7, 7001);
            return d.return(c.j);
          });
        };
        function dz(a) {
          var b;
          Q(function(c) {
            switch (c.g) {
              case 1:
                return xa(c, 2), F(c, ez(a), 4);
              case 4:
                Aa(c, 3);
                break;
              case 2:
                b = Ba(c), a.h && (b.severity = 1, a.h.onError(b));
              case 3:
                if (!a.h) return c.return();
                I(c);
            }
          });
        }
        r.stop = function() {
          this.g = this.h = null;
          this.l = [];
          this.j = null;
          null != this.o && (this.o.stop(), this.o = null);
          this.m.clear();
          return this.B.destroy();
        };
        r.update = function() {
          var a = this, b;
          return Q(function(c) {
            if (1 == c.g) return xa(c, 2), F(c, ez(a), 4);
            if (2 != c.g) return Aa(c, 0);
            b = Ba(c);
            if (!a.h || !b) return c.return();
            a.h.onError(b);
            I(c);
          });
        };
        r.onExpirationUpdated = function() {
        };
        r.onInitialVariantChosen = function() {
        };
        r.banLocation = function() {
        };
        r.setMediaElement = function() {
        };
        function ez(a) {
          var b, c, d, e, f, g, h;
          return Q(function(k2) {
            if (1 == k2.g) return b = lh(a.l, a.g.retryParameters), c = a.h.networkingEngine, d = Date.now(), e = c.request(0, b, { type: 5, isPreload: a.A() }), fh(a.B, e), F(k2, e.promise, 2);
            f = k2.h;
            if (!a.h) return k2.return();
            f.uri && !a.l.includes(f.uri) && a.l.unshift(f.uri);
            var l = f.uri, m = f.data, n = a.g.mss.manifestPreprocessor;
            if (n != Kn) {
              sb("manifest.mss.manifestPreprocessor configuration", "Please Use manifest.mss.manifestPreprocessorTXml instead.");
              m = xw(m, "SmoothStreamingMedia");
              if (!m) throw new U(
                2,
                4,
                4046,
                l
              );
              n(m);
              m = Lc(m.outerHTML);
            }
            var p = Qd(m, "SmoothStreamingMedia");
            if (!p) throw new U(2, 4, 4046, l);
            l = a.g.mss.manifestPreprocessorTXml;
            l != Ln && l(p);
            a.i || (a.i = new xl(null, 0));
            if (l = he(p, "IsLive", re, false)) throw new U(2, 4, 4047);
            a.i.Gc(!l);
            n = he(p, "TimeScale", pe, 1e7);
            m = he(p, "DVRWindowLength", pe);
            l && (0 === m || isNaN(m)) && (m = Infinity);
            var q = he(p, "CanSeek", re, false);
            0 === m && q && (m = Infinity);
            q = null;
            m && 0 < m && (q = m / n);
            l && !isNaN(a.g.availabilityWindowOverride) && (q = a.g.availabilityWindowOverride);
            null == q && (q = Infinity);
            a.i.Ce(q);
            m = he(p, "Duration", pe, Infinity);
            l || a.i.bb(m / n);
            l = { variants: [], textStreams: [], timescale: n, duration: m / n };
            var u;
            q = Yd(p, "Protection");
            n = a.g.mss.keySystemsBySystemId;
            m = [];
            q = t(q);
            for (u = q.next(); !u.done; u = q.next()) m = m.concat(Yd(u.value, "ProtectionHeader"));
            if (m.length) {
              q = [];
              for (u = 0; u < m.length; u++) {
                var w = m[u], v = w.attributes.SystemID.toLowerCase(), x = n[v];
                if (x) {
                  var z;
                  a: {
                    if (z = ru(w)) {
                      z = t(ae(z, "DATA"));
                      for (var C = z.next(); !C.done; C = z.next()) if (C = be(C.value, "KID")) {
                        z = Tc(Zd(C));
                        z = new Uint8Array([
                          z[3],
                          z[2],
                          z[1],
                          z[0],
                          z[5],
                          z[4],
                          z[7],
                          z[6]
                        ].concat(y(z.slice(8))));
                        z = Vc(z);
                        break a;
                      }
                    }
                    z = null;
                  }
                  C = Tc(Zd(w));
                  v = Uc(v.replace(/-/g, ""));
                  v = [{ initData: Rh(C, v, /* @__PURE__ */ new Set(), 0), initDataType: "cenc", keyId: z }];
                  v = Yc(x, "cenc", v);
                  z && v.keyIds.add(z);
                  if (x = bz.get(x)) v.licenseServerUri = x(w);
                  q.push(v);
                }
              }
              n = q;
            } else n = [];
            u = n;
            q = [];
            n = [];
            m = [];
            p = Yd(p, "StreamIndex");
            p = t(p);
            for (w = p.next(); !w.done; w = p.next()) {
              w = w.value;
              x = Yd(w, "QualityLevel");
              v = l.timescale;
              z = l.duration;
              C = Yd(w, "c");
              for (var D = [], G = 0, B = 0; B < C.length; ++B) {
                var A = C[B], H = C[B + 1], E = he(A, "t", pe), K = he(
                  A,
                  "d",
                  pe
                );
                A = he(A, "r", ne);
                if (!K) break;
                E = null != E ? E : G;
                (A = A || 0) && A--;
                if (0 > A) if (H) {
                  H = he(H, "t", pe);
                  if (null == H) break;
                  else if (E >= H) break;
                  A = Math.ceil((H - E) / K) - 1;
                } else {
                  if (Infinity == z) break;
                  else if (E / v >= z) break;
                  A = Math.ceil((z * v - E) / K) - 1;
                }
                for (H = 0; H <= A; ++H) G = E + K, D.push({ start: E / v, end: G / v, xg: E }), E = G;
              }
              v = D;
              x = t(x);
              for (z = x.next(); !z.done; z = x.next()) (z = fz(a, w, z.value, v, u, l)) && ("audio" != z.type || a.g.disableAudio ? "video" != z.type || a.g.disableVideo ? z.type != dd || a.g.disableText || m.push(z) : n.push(z) : q.push(z));
            }
            p = [];
            q = t(0 < q.length ? q : [null]);
            for (u = q.next(); !u.done; u = q.next()) for (u = u.value, w = t(0 < n.length ? n : [null]), D = w.next(); !D.done; D = w.next()) x = p, v = x.push, z = a, C = u, D = D.value, B = 0, C && C.bandwidth && 0 < C.bandwidth && (B += C.bandwidth), D && D.bandwidth && 0 < D.bandwidth && (B += D.bandwidth), z = { id: z.u++, language: C ? C.language : "und", disabledUntilTime: 0, primary: !!C && C.primary || !!D && D.primary, audio: C, video: D, bandwidth: B, allowedByApplication: true, allowedByKeySystem: true, decodingInfos: [] }, v.call(x, z);
            l.variants = p;
            l.textStreams = m;
            a.j ? (a.j.variants = l.variants, a.j.textStreams = l.textStreams, a.h.filter(a.j)) : (a.j = { presentationTimeline: a.i, variants: l.variants, textStreams: l.textStreams, imageStreams: [], offlineSessionIds: [], sequenceMode: a.g.mss.sequenceMode, ignoreManifestTimestampsInSegmentsMode: false, type: "MSS", serviceDescription: null, nextUrl: null, periodCount: 1, gapCount: 0, isLowLatency: false, startTime: null }, a.i.ie());
            Promise.resolve();
            g = Date.now();
            h = (g - d) / 1e3;
            a.C.sample(1, h);
            I(k2);
          });
        }
        function fz(a, b, c, d, e, f) {
          var g = b.attributes.Type;
          if ("audio" !== g && "video" !== g && "text" !== g) return bb("Ignoring unrecognized type:", g), null;
          var h = b.attributes.Language, k2 = a.u++, l = he(c, "Bitrate", oe), m = he(c, "MaxWidth", oe), n = he(c, "MaxHeight", oe), p = he(c, "Channels", oe), q = he(c, "SamplingRate", oe), u = f.duration;
          d.length && (u = d[d.length - 1].end - d[0].start);
          var w = a.i.getDuration();
          a.i.bb(Math.min(u, w));
          var v = {
            id: k2,
            originalId: b.attributes.Name || String(k2),
            groupId: null,
            createSegmentIndex: function() {
              return Promise.resolve();
            },
            closeSegmentIndex: function() {
              return Promise.resolve();
            },
            segmentIndex: null,
            mimeType: "",
            codecs: "",
            frameRate: void 0,
            pixelAspectRatio: void 0,
            bandwidth: l || 0,
            width: m || void 0,
            height: n || void 0,
            kind: "",
            encrypted: 0 < e.length,
            drmInfos: e,
            keyIds: /* @__PURE__ */ new Set(),
            language: Of(h || "und"),
            originalLanguage: h,
            label: "",
            type: "",
            primary: false,
            trickModeVideo: null,
            dependencyStream: null,
            emsgSchemeIdUris: [],
            roles: [],
            forced: false,
            channelsCount: p,
            audioSamplingRate: q,
            spatialAudio: false,
            closedCaptions: null,
            hdr: void 0,
            colorGamut: void 0,
            videoLayout: void 0,
            tilesLayout: void 0,
            matchedStreams: [],
            mssPrivateData: { duration: u, timescale: f.timescale, codecPrivateData: null },
            accessibilityPurpose: null,
            external: false,
            fastSwitching: false,
            fullMimeTypes: /* @__PURE__ */ new Set(),
            isAudioMuxedInVideo: false,
            baseOriginalId: null
          };
          if (e = b.attributes.Subtype) (e = gz.get(e)) && v.roles.push(e), "main" === e && (v.primary = true);
          e = c.attributes.FourCC;
          if (null === e || "" === e) e = b.attributes.FourCC;
          if (!e) {
            if ("audio" === g) e = "AAC";
            else if ("video" === g) return bb('FourCC is not defined whereas it is required for a QualityLevel element for a StreamIndex of type "video"'), null;
          }
          if (!hz.includes(e.toUpperCase())) return bb("Codec not supported:", e), null;
          c = iz(c, g, e, v);
          v.mssPrivateData.codecPrivateData = c;
          switch (g) {
            case "audio":
              if (!c) return bb("Quality unsupported without CodecPrivateData", g), null;
              v.type = "audio";
              v.mimeType = "mss/audio/mp4";
              v.codecs = jz(e, c);
              break;
            case "video":
              if (!c) return bb("Quality unsupported without CodecPrivateData", g), null;
              v.type = "video";
              v.mimeType = "mss/video/mp4";
              v.codecs = kz(c);
              break;
            case "text":
              if (v.type = dd, v.mimeType = "application/mp4", "TTML" === e || "DFXP" === e) v.codecs = "stpp";
          }
          v.fullMimeTypes.add(lf(v.mimeType, v.codecs));
          v.createSegmentIndex = function() {
            if (v.segmentIndex) return Promise.resolve();
            if (a.m.has(v.id)) var x = a.m.get(v.id);
            else x = [], "video" == v.type && (x = v.mssPrivateData.codecPrivateData.split("00000001").slice(1)), x = { id: v.id, type: v.type, codecs: v.codecs, encrypted: v.encrypted, timescale: v.mssPrivateData.timescale, duration: v.mssPrivateData.duration, lb: x, ra: new Uint8Array([]), Ca: new Uint8Array([]), Ia: 0, Ka: 0, data: null, stream: v }, x = kj(new ej([x])), a.m.set(v.id, x);
            x = lz(a, new Lj(function() {
              return [];
            }, 0, null, em(v), v.mssPrivateData.timescale, x, null, v.encrypted), v, b, d);
            v.segmentIndex = new Sl(x);
            return Promise.resolve();
          };
          v.closeSegmentIndex = function() {
            v.segmentIndex && (v.segmentIndex.release(), v.segmentIndex = null);
          };
          return v;
        }
        function iz(a, b, c, d) {
          if (a = a.attributes.CodecPrivateData) return a;
          if ("audio" !== b) return null;
          b = d.channelsCount || 2;
          a = d.audioSamplingRate || 44100;
          var e = { 96e3: 0, 88200: 1, 64e3: 2, 48e3: 3, 44100: 4, 32e3: 5, 24e3: 6, 22050: 7, 16e3: 8, 12e3: 9, 11025: 10, 8e3: 11, 7350: 12 };
          d = e[a];
          if ("AACH" === c) return c = new Uint8Array(4), a = e[2 * a], c[0] = 40 | d >> 1, c[1] = d << 7 | b << 3 | a >> 1, c[2] = a << 7 | 8, c[3] = 0, b = new Uint16Array(2), b[0] = (c[0] << 8) + c[1], b[1] = (c[2] << 8) + c[3], b[0].toString(16) + b[1].toString(16);
          c = new Uint8Array(2);
          c[0] = 16 | d >> 1;
          c[1] = d << 7 | b << 3;
          b = new Uint16Array(1);
          b[0] = (c[0] << 8) + c[1];
          return b[0].toString(16);
        }
        function jz(a, b) {
          var c = 0;
          "AACH" === a && (c = 5);
          b ? 0 === c && (c = (parseInt(b.substr(0, 2), 16) & 248) >> 3) : (c = 2, "AACH" === a && (c = 5));
          return "mp4a.40." + c;
        }
        function kz(a) {
          var b = /00000001[0-9]7/.exec(a);
          return b.length && a ? "avc1." + a.substr(a.indexOf(b[0]) + 10, 6) : "";
        }
        function lz(a, b, c, d, e) {
          var f = d.attributes.Url.replace("{bitrate}", String(c.bandwidth));
          d = [];
          e = t(e);
          for (var g = e.next(), h = {}; !g.done; h = { Fe: void 0 }, g = e.next()) h.Fe = g.value, d.push(new Nj(h.Fe.start, h.Fe.end, /* @__PURE__ */ function(k2) {
            return function() {
              return Xc(a.l, [f.replace("{start time}", String(k2.Fe.xg))]);
            };
          }(h), 0, null, b, 0, 0, c.mssPrivateData.duration));
          return d;
        }
        T("shaka.mss.MssParser", cz);
        var hz = "AAC AACL AACH AACP AVC1 H264 TTML DFXP".split(" "), gz = (/* @__PURE__ */ new Map()).set("CAPT", "main").set("SUBT", "alternate").set("DESC", "main");
        Si("application/vnd.ms-sstr+xml", function() {
          return new cz();
        });
        function mz(a, b, c, d, e, f, g) {
          if (200 <= c && 299 >= c && 202 != c || 304 == c) return { uri: e || d, originalUri: d, data: b, status: c, headers: a, fromCache: !!a["x-shaka-from-cache"], originalRequest: f };
          f = null;
          try {
            f = Kc(b);
          } catch (h) {
          }
          throw new U(401 == c || 403 == c ? 2 : 1, 1, 1001, d, c, f, a, g, e || d);
        }
        function nz() {
        }
        function oz(a, b, c, d, e, f) {
          var g = new pz();
          Ah(b.headers).forEach(function(m, n) {
            g.append(n, m);
          });
          var h = new qz(), k2 = { Gg: false, Jh: false };
          a = rz(a, b, c, { body: b.body || void 0, headers: g, method: b.method, signal: h.signal, credentials: b.allowCrossSiteCredentials ? "include" : void 0 }, k2, d, e, b.streamDataCallback, f.minBytesForProgressEvents || 0);
          a = new Vg(a, function() {
            k2.Gg = true;
            h.abort();
            return Promise.resolve();
          });
          if (b = b.retryParameters.timeout) {
            var l = new ec(function() {
              k2.Jh = true;
              h.abort();
            });
            l.da(b / 1e3);
            a.finally(function() {
              l.stop();
            });
          }
          return a;
        }
        function rz(a, b, c, d, e, f, g, h, k2) {
          var l, m, n, p, q, u, w, v, x, z, C, D, G, B;
          return Q(function(A) {
            switch (A.g) {
              case 1:
                return l = sz, m = tz, p = new ArrayBuffer(0), u = q = 0, w = Date.now(), xa(A, 2), F(A, l(a, d), 4);
              case 4:
                n = A.h;
                g(uz(n.headers));
                if ("HEAD" == d.method) {
                  A.s(5);
                  break;
                }
                x = (v = n.headers.get("Content-Length")) ? parseInt(v, 10) : 0;
                if (!n.body) return F(A, n.arrayBuffer(), 9);
                z = n.clone().body.getReader();
                C = function(H) {
                  function E() {
                    var K, M, J, L;
                    return Q(function(N) {
                      switch (N.g) {
                        case 1:
                          return xa(N, 2), F(N, z.read(), 4);
                        case 4:
                          K = N.h;
                          Aa(N, 3);
                          break;
                        case 2:
                          return Ba(N), N.return();
                        case 3:
                          if (K.done) {
                            N.s(5);
                            break;
                          }
                          q += K.value.byteLength;
                          if (!h) {
                            N.s(5);
                            break;
                          }
                          return F(N, h(K.value), 5);
                        case 5:
                          M = Date.now();
                          J = q - u;
                          if (100 < M - w && J >= k2 || K.done) L = K.done ? 0 : x - q, f(M - w, J, L), u = q, w = M;
                          K.done ? H.close() : (H.enqueue(K.value), E());
                          I(N);
                      }
                    });
                  }
                  E();
                };
                new m({ start: C });
                return F(A, n.arrayBuffer(), 8);
              case 8:
                p = A.h;
                A.s(5);
                break;
              case 9:
                p = A.h, D = Date.now(), f(D - w, p.byteLength, 0);
              case 5:
                Aa(A, 3);
                break;
              case 2:
                G = Ba(A);
                if (e.Gg) throw new U(1, 1, 7001, a, c);
                if (e.Jh) throw new U(1, 1, 1003, a, c);
                throw new U(
                  1,
                  1,
                  1002,
                  a,
                  G,
                  c
                );
              case 3:
                return B = uz(n.headers), A.return(mz(B, p, n.status, a, n.url, b, c));
            }
          });
        }
        function uz(a) {
          var b = {};
          a.forEach(function(c, d) {
            b[d.trim()] = c;
          });
          return b;
        }
        function vz() {
          if (window2.ReadableStream) try {
            new ReadableStream({});
          } catch (a) {
            return false;
          }
          else return false;
          if (window2.Response) {
            if (!new Response("").body) return false;
          } else return false;
          return !(!window2.fetch || "polyfill" in window2.fetch || !window2.AbortController);
        }
        T("shaka.net.HttpFetchPlugin", nz);
        nz.isSupported = vz;
        nz.parse = oz;
        var sz = window2.fetch, qz = window2.AbortController, tz = window2.ReadableStream, pz = window2.Headers;
        vz() && (hh("http", oz, 2, true), hh("https", oz, 2, true), hh("blob", oz, 2, true));
        function wz() {
        }
        function xz(a, b, c, d, e, f) {
          var g = new yz(), h = Date.now(), k2 = 0, l = new Promise(function(m, n) {
            g.open(b.method, a, true);
            g.responseType = "arraybuffer";
            g.timeout = b.retryParameters.timeout;
            g.withCredentials = b.allowCrossSiteCredentials;
            g.onabort = function() {
              n(new U(1, 1, 7001, a, c));
            };
            var p = false;
            g.onreadystatechange = function() {
              if (2 == g.readyState && !p) {
                var u = zz(g);
                e(u);
                p = true;
              }
            };
            g.onload = function(u) {
              var w = zz(g), v = g.response;
              try {
                d(Date.now() - h, u.loaded - k2, 0);
                var x = mz(w, v, g.status, a, g.responseURL, b, c);
                m(x);
              } catch (z) {
                n(z);
              }
            };
            g.onerror = function(u) {
              n(new U(1, 1, 1002, a, u, c));
            };
            g.ontimeout = function() {
              n(new U(1, 1, 1003, a, c));
            };
            g.onprogress = function(u) {
              var w = Date.now(), v = f.minBytesForProgressEvents || 0, x = u.loaded - k2;
              if (100 < w - h && x >= v || u.lengthComputable && u.loaded == u.total) d(w - h, x, 4 == g.readyState ? 0 : u.total - u.loaded), k2 = u.loaded, h = w;
            };
            for (var q in b.headers) g.setRequestHeader(q.toLowerCase(), b.headers[q]);
            g.send(b.body);
          });
          return new Vg(l, function() {
            g.abort();
            return Promise.resolve();
          });
        }
        function zz(a) {
          var b = a.getAllResponseHeaders().trim().split("\r\n");
          a = {};
          b = t(b);
          for (var c = b.next(); !c.done; c = b.next()) c = c.value.split(": "), a[c[0].toLowerCase()] = c.slice(1).join(": ");
          return a;
        }
        T("shaka.net.HttpXHRPlugin", wz);
        wz.parse = xz;
        var yz = window2.XMLHttpRequest;
        hh("http", xz, 1, true);
        hh("https", xz, 1, true);
        hh("blob", xz, 1, true);
        function Az(a, b, c, d, e) {
          this.g = a;
          this.i = b;
          this.groupId = c;
          this.h = d;
          this.j = e;
        }
        function Bz(a) {
          var b = a.Ib(false);
          return b ? Sc(b) : a.N().map(function(c) {
            return "{" + encodeURI(c.split("#xywh=")[0]) + "}";
          }).join("") + ":" + a.Sa + ":" + a.wa;
        }
        function Cz(a, b) {
          return Am(a.g.N(), a.g.Sa, a.g.wa, b.streaming.retryParameters);
        }
        function Dz() {
          this.g = this.j = this.i = 0;
          this.h = /* @__PURE__ */ new Map();
          this.l = 0;
        }
        function Ez(a, b) {
          a.i += b;
          var c = a.l;
          a.l++;
          a.h.set(c, b);
          return c;
        }
        Dz.prototype.close = function(a, b) {
          if (this.h.has(a)) {
            var c = this.h.get(a);
            this.h.delete(a);
            this.j += c;
            this.g += b;
          }
        };
        function Fz(a) {
          return 0 == a.i ? 0 : a.j / a.i;
        }
        function Gz(a) {
          var b = this;
          this.u = a;
          this.i = /* @__PURE__ */ new Map();
          this.h = new th(function() {
            return Hz(b).catch(function() {
            });
          });
          this.j = [];
          this.o = function() {
          };
          this.m = function() {
          };
          this.g = new Dz();
          this.l = false;
        }
        Gz.prototype.destroy = function() {
          return this.h.destroy();
        };
        function Iz(a, b, c) {
          a.o = b;
          a.m = c;
        }
        function Hz(a) {
          a.l = true;
          var b = a.j.map(function(c) {
            return c();
          });
          a.j = [];
          return Promise.all(b);
        }
        function Jz(a, b, c, d, e, f) {
          uh(a.h);
          var g = (a.i.get(b) || Promise.resolve()).then(function() {
            var h, k2, l, m, n, p, q;
            return Q(function(u) {
              if (1 == u.g) return F(u, Kz(a, c), 2);
              h = u.h;
              if (a.h.g) throw new U(2, 9, 7001);
              if (e) for (m in k2 = Qb(h), l = new Qh(k2), l.data) n = Number(m), p = l.data[n], q = l.g[n], a.m(p, q);
              a.g.close(d, h.byteLength);
              a.o(Fz(a.g), a.g.g);
              return u.return(f(h));
            });
          });
          a.i.set(b, g);
        }
        function Lz(a, b, c, d, e, f) {
          uh(a.h);
          var g = (a.i.get(b) || Promise.resolve()).then(function() {
            if (a.h.g) throw new U(2, 9, 7001);
            if (e) {
              var h = Qb(c);
              h = new Qh(h);
              for (var k2 in h.data) {
                var l = Number(k2);
                a.m(h.data[l], h.g[l]);
              }
            }
            a.g.close(d, c.byteLength);
            a.o(Fz(a.g), a.g.g);
            return f(c);
          });
          a.i.set(b, g);
        }
        function Mz(a) {
          return Q(function(b) {
            return 1 == b.g ? F(b, Promise.all(a.i.values()), 2) : b.return(a.g.g);
          });
        }
        function Kz(a, b) {
          var c, d, e, f;
          return Q(function(g) {
            if (1 == g.g) return c = rh, d = a.u.request(c, b), e = function() {
              return d.abort();
            }, a.j.push(e), F(g, d.promise, 2);
            f = g.h;
            Cd(a.j, e);
            return g.return(f.data);
          });
        }
        function Nz(a, b) {
          var c = this;
          this.i = a;
          this.h = a.objectStore(b);
          this.g = new Ug();
          a.onabort = function(d) {
            d.preventDefault();
            c.g.reject();
          };
          a.onerror = function(d) {
            d.preventDefault();
            c.g.reject();
          };
          a.oncomplete = function() {
            c.g.resolve();
          };
        }
        Nz.prototype.abort = function() {
          var a = this;
          return Q(function(b) {
            if (1 == b.g) {
              try {
                a.i.abort();
              } catch (c) {
              }
              xa(b, 2);
              return F(b, a.g, 4);
            }
            if (2 != b.g) return Aa(b, 0);
            Ba(b);
            I(b);
          });
        };
        function Oz(a, b) {
          return new Promise(function(c, d) {
            var e = a.h.openCursor();
            e.onerror = d;
            e.onsuccess = function() {
              var f;
              return Q(function(g) {
                if (1 == g.g) {
                  if (null == e.result) return c(), g.return();
                  f = e.result;
                  return F(g, b(f.key, f.value, f), 2);
                }
                f.continue();
                I(g);
              });
            };
          });
        }
        Nz.prototype.store = function() {
          return this.h;
        };
        Nz.prototype.promise = function() {
          return this.g;
        };
        function Pz(a) {
          this.h = a;
          this.g = [];
        }
        Pz.prototype.destroy = function() {
          return Promise.all(this.g.map(function(a) {
            return a.abort();
          }));
        };
        function Qz(a, b) {
          return Rz(a, b, "readwrite");
        }
        function Rz(a, b, c) {
          c = a.h.transaction([b], c);
          var d = new Nz(c, b);
          a.g.push(d);
          d.promise().then(function() {
            Cd(a.g, d);
          }, function() {
            Cd(a.g, d);
          });
          return d;
        }
        function Sz(a, b, c) {
          this.h = new Pz(a);
          this.i = b;
          this.g = c;
        }
        r = Sz.prototype;
        r.destroy = function() {
          return this.h.destroy();
        };
        r.hasFixedKeySpace = function() {
          return true;
        };
        r.addSegments = function() {
          return Tz(this.i);
        };
        r.removeSegments = function(a, b) {
          return Uz(this, this.i, a, b);
        };
        r.getSegments = function(a) {
          var b = this, c;
          return Q(function(d) {
            if (1 == d.g) return F(d, Vz(b, b.i, a), 2);
            c = d.h;
            return d.return(c.map(function(e) {
              return b.Ig(e);
            }));
          });
        };
        r.addManifests = function() {
          return Tz(this.g);
        };
        r.updateManifest = function() {
          return Promise.reject(new U(2, 9, 9016, "Cannot modify values in " + this.g));
        };
        function Wz(a, b, c) {
          a = Qz(a.h, a.g);
          var d = a.store();
          d.get(b).onsuccess = function() {
            d.put(c, b);
          };
          return a.promise();
        }
        r.updateManifestExpiration = function(a, b) {
          var c = Qz(this.h, this.g), d = c.store();
          d.get(a).onsuccess = function(e) {
            if (e = e.target.result) e.expiration = b, d.put(e, a);
          };
          return c.promise();
        };
        r.removeManifests = function(a, b) {
          return Uz(this, this.g, a, b);
        };
        r.getManifests = function(a) {
          var b = this, c;
          return Q(function(d) {
            if (1 == d.g) return F(d, Vz(b, b.g, a), 2);
            c = d.h;
            return d.return(Promise.all(c.map(function(e) {
              return b.jd(e);
            })));
          });
        };
        r.getAllManifests = function() {
          var a = this, b, c;
          return Q(function(d) {
            return 1 == d.g ? (b = Rz(a.h, a.g, "readonly"), c = /* @__PURE__ */ new Map(), F(d, Oz(b, function(e, f) {
              var g;
              return Q(function(h) {
                if (1 == h.g) return F(h, a.jd(f), 2);
                g = h.h;
                c.set(e, g);
                I(h);
              });
            }), 2)) : 3 != d.g ? F(d, b.promise(), 3) : d.return(c);
          });
        };
        r.Ig = function(a) {
          return a;
        };
        r.jd = function(a) {
          return Promise.resolve(a);
        };
        function Tz(a) {
          return Promise.reject(new U(2, 9, 9011, "Cannot add new value to " + a));
        }
        r.add = function(a, b) {
          var c = this, d, e, f, g, h, k2, l;
          return Q(function(m) {
            if (1 == m.g) {
              d = Qz(c.h, a);
              e = d.store();
              f = [];
              g = t(b);
              h = g.next();
              for (k2 = {}; !h.done; k2 = { cg: void 0 }, h = g.next()) l = h.value, k2.cg = e.add(l), k2.cg.onsuccess = /* @__PURE__ */ function(n) {
                return function() {
                  f.push(n.cg.result);
                };
              }(k2);
              return F(m, d.promise(), 2);
            }
            return m.return(f);
          });
        };
        function Uz(a, b, c, d) {
          a = Qz(a.h, b);
          b = a.store();
          c = t(c);
          for (var e = c.next(), f = {}; !e.done; f = { Qf: void 0 }, e = c.next()) f.Qf = e.value, b.delete(f.Qf).onsuccess = /* @__PURE__ */ function(g) {
            return function() {
              return d(g.Qf);
            };
          }(f);
          return a.promise();
        }
        function Vz(a, b, c) {
          var d, e, f, g, h, k2, l;
          return Q(function(m) {
            if (1 == m.g) {
              d = Rz(a.h, b, "readonly");
              e = d.store();
              f = {};
              g = [];
              h = t(c);
              k2 = h.next();
              for (l = {}; !k2.done; l = { we: void 0, ee: void 0 }, k2 = h.next()) l.ee = k2.value, l.we = e.get(l.ee), l.we.onsuccess = /* @__PURE__ */ function(n) {
                return function() {
                  void 0 == n.we.result && g.push(n.ee);
                  f[n.ee] = n.we.result;
                };
              }(l);
              return F(m, d.promise(), 2);
            }
            if (g.length) throw new U(2, 9, 9012, "Could not find values for " + g);
            return m.return(c.map(function(n) {
              return f[n];
            }));
          });
        }
        function Xz(a) {
          this.g = new Pz(a);
        }
        Xz.prototype.destroy = function() {
          return this.g.destroy();
        };
        Xz.prototype.getAll = function() {
          var a = this, b, c;
          return Q(function(d) {
            return 1 == d.g ? (b = Rz(a.g, "session-ids", "readonly"), c = [], F(d, Oz(b, function(e, f) {
              c.push(f);
            }), 2)) : 3 != d.g ? F(d, b.promise(), 3) : d.return(c);
          });
        };
        Xz.prototype.add = function(a) {
          var b = Qz(this.g, "session-ids"), c = b.store();
          a = t(a);
          for (var d = a.next(); !d.done; d = a.next()) c.add(d.value);
          return b.promise();
        };
        Xz.prototype.remove = function(a) {
          var b = this, c;
          return Q(function(d) {
            return 1 == d.g ? (c = Qz(b.g, "session-ids"), F(d, Oz(c, function(e, f, g) {
              a.includes(f.sessionId) && g.delete();
            }), 2)) : F(d, c.promise(), 0);
          });
        };
        function Yz() {
          this.g = /* @__PURE__ */ new Map();
        }
        Yz.prototype.destroy = function() {
          for (var a = [], b = t(this.g.values()), c = b.next(); !c.done; c = b.next()) a.push(c.value.destroy());
          this.g.clear();
          return Promise.all(a);
        };
        Yz.prototype.init = function() {
          var a = this;
          Zz.forEach(function(e, f) {
            (e = e()) && a.g.set(f, e);
          });
          for (var b = [], c = t(this.g.values()), d = c.next(); !d.done; d = c.next()) b.push(d.value.init());
          return Promise.all(b);
        };
        function $z(a) {
          var b = null;
          a.g.forEach(function(c, d) {
            c.getCells().forEach(function(e, f) {
              e.hasFixedKeySpace() || b || (b = { path: { zb: d, Ta: f }, Ta: e });
            });
          });
          if (b) return b;
          throw new U(2, 9, 9013, "Could not find a cell that supports add-operations");
        }
        function aA(a, b) {
          a.g.forEach(function(c, d) {
            c.getCells().forEach(function(e, f) {
              b({ zb: d, Ta: f }, e);
            });
          });
        }
        function bA(a, b, c) {
          a = a.g.get(b);
          if (!a) throw new U(2, 9, 9013, "Could not find mechanism with name " + b);
          b = a.getCells().get(c);
          if (!b) throw new U(2, 9, 9013, "Could not find cell with name " + c);
          return b;
        }
        function cA(a, b) {
          a.g.forEach(function(c) {
            b(c.getEmeSessionCell());
          });
        }
        function dA(a) {
          var b = Array.from(a.g.keys());
          if (!b.length) throw new U(2, 9, 9e3, "No supported storage mechanisms found");
          return a.g.get(b[0]).getEmeSessionCell();
        }
        function eA(a) {
          var b, c, d;
          return Q(function(e) {
            return 1 == e.g ? (b = Array.from(a.g.values()), c = 0 < b.length, c || (d = Zz, d.forEach(function(f) {
              (f = f()) && b.push(f);
            })), F(e, Promise.all(b.map(function(f) {
              return f.erase();
            })), 2)) : c ? e.s(0) : F(e, Promise.all(b.map(function(f) {
              return f.destroy();
            })), 0);
          });
        }
        function fA(a, b) {
          Zz.set(a, b);
        }
        T("shaka.offline.StorageMuxer", Yz);
        Yz.unregister = function(a) {
          Zz.delete(a);
        };
        Yz.register = fA;
        Yz.prototype.destroy = Yz.prototype.destroy;
        var Zz = /* @__PURE__ */ new Map();
        function gA() {
          Sz.apply(this, arguments);
        }
        qa(gA, Sz);
        gA.prototype.updateManifestExpiration = function(a, b) {
          var c = this, d, e, f;
          return Q(function(g) {
            d = Qz(c.h, c.g);
            e = d.store();
            f = new Ug();
            e.get(a).onsuccess = function(h) {
              (h = h.target.result) ? (h.expiration = b, e.put(h), f.resolve()) : f.reject(new U(2, 9, 9012, "Could not find values for " + a));
            };
            return F(g, Promise.all([d.promise(), f]), 0);
          });
        };
        gA.prototype.jd = function(a) {
          var b, c, d, e, f, g;
          return Q(function(h) {
            if (1 == h.g) {
              b = [];
              for (c = 0; c < a.periods.length; ++c) d = c == a.periods.length - 1 ? a.duration : a.periods[c + 1].startTime, e = d - a.periods[c].startTime, f = hA(a.periods[c], e), b.push(f);
              return F(h, Gv(b), 2);
            }
            g = h.h;
            return h.return({ creationTime: 0, originalManifestUri: a.originalManifestUri, duration: a.duration, size: a.size, expiration: null == a.expiration ? Infinity : a.expiration, streams: g, sessionIds: a.sessionIds, drmInfo: a.drmInfo, appMetadata: a.appMetadata, sequenceMode: false });
          });
        };
        function hA(a, b) {
          iA(a);
          for (var c = t(a.streams), d = c.next(); !d.done; d = c.next()) ;
          return a.streams.map(function(e) {
            return jA(e, a.startTime, b);
          });
        }
        function jA(a, b, c) {
          var d = a.initSegmentUri ? kA(a.initSegmentUri) : null, e = b + a.presentationTimeOffset, f = b + c;
          return { id: a.id, originalId: null, groupId: null, primary: a.primary, type: a.contentType, mimeType: a.mimeType, codecs: a.codecs, frameRate: a.frameRate, pixelAspectRatio: void 0, hdr: void 0, colorGamut: void 0, videoLayout: void 0, kind: a.kind, language: a.language, originalLanguage: a.language || null, label: a.label, width: a.width, height: a.height, initSegmentKey: d, encrypted: a.encrypted, keyIds: /* @__PURE__ */ new Set([a.keyId]), segments: a.segments.map(function(g) {
            var h = kA(g.uri);
            return { startTime: b + g.startTime, endTime: b + g.endTime, dataKey: h, initSegmentKey: d, appendWindowStart: b, appendWindowEnd: f, timestampOffset: e, tilesLayout: "", mimeType: null, codecs: null, thumbnailSprite: null };
          }), variantIds: a.variantIds, roles: [], forced: false, audioSamplingRate: null, channelsCount: null, spatialAudio: false, closedCaptions: null, tilesLayout: void 0, external: false, fastSwitching: false, isAudioMuxedInVideo: false };
        }
        gA.prototype.Ig = function(a) {
          return { data: a.data };
        };
        function kA(a) {
          var b;
          if ((b = /^offline:[0-9]+\/[0-9]+\/([0-9]+)$/.exec(a)) || (b = /^offline:segment\/([0-9]+)$/.exec(a))) return Number(b[1]);
          throw new U(2, 9, 9004, "Could not parse uri " + a);
        }
        function iA(a) {
          var b = a.streams.filter(function(h) {
            return "audio" == h.contentType;
          });
          a = a.streams.filter(function(h) {
            return "video" == h.contentType;
          });
          if (!b.every(function(h) {
            return h.variantIds;
          }) || !a.every(function(h) {
            return h.variantIds;
          })) {
            for (var c = t(b), d = c.next(); !d.done; d = c.next()) d.value.variantIds = [];
            c = t(a);
            for (d = c.next(); !d.done; d = c.next()) d.value.variantIds = [];
            c = 0;
            if (a.length && !b.length) {
              d = c++;
              for (var e = t(a), f = e.next(); !f.done; f = e.next()) f.value.variantIds.push(d);
            }
            if (!a.length && b.length) for (d = c++, e = t(b), f = e.next(); !f.done; f = e.next()) f.value.variantIds.push(d);
            if (a.length && b.length) for (b = t(b), d = b.next(); !d.done; d = b.next()) for (d = d.value, e = t(a), f = e.next(); !f.done; f = e.next()) {
              f = f.value;
              var g = c++;
              d.variantIds.push(g);
              f.variantIds.push(g);
            }
          }
        }
        function lA() {
          Sz.apply(this, arguments);
        }
        qa(lA, Sz);
        lA.prototype.jd = function(a) {
          var b, c, d, e, f, g;
          return Q(function(h) {
            if (1 == h.g) {
              b = [];
              for (c = 0; c < a.periods.length; ++c) {
                d = c == a.periods.length - 1 ? a.duration : a.periods[c + 1].startTime;
                e = d - a.periods[c].startTime;
                for (var k2 = a.periods[c], l = [], m = t(k2.streams), n = m.next(); !n.done; n = m.next()) n = n.value, 0 != n.variantIds.length && l.push(mA(n, k2.startTime, k2.startTime + e));
                f = l;
                b.push(f);
              }
              return F(h, Gv(b), 2);
            }
            g = h.h;
            return h.return({ appMetadata: a.appMetadata, creationTime: 0, drmInfo: a.drmInfo, duration: a.duration, expiration: null == a.expiration ? Infinity : a.expiration, originalManifestUri: a.originalManifestUri, sessionIds: a.sessionIds, size: a.size, streams: g, sequenceMode: false });
          });
        };
        function mA(a, b, c) {
          return { id: a.id, originalId: a.originalId, groupId: null, primary: a.primary, type: a.contentType, mimeType: a.mimeType, codecs: a.codecs, frameRate: a.frameRate, pixelAspectRatio: a.pixelAspectRatio, hdr: void 0, colorGamut: void 0, videoLayout: void 0, kind: a.kind, language: a.language, originalLanguage: a.language || null, label: a.label, width: a.width, height: a.height, encrypted: a.encrypted, keyIds: /* @__PURE__ */ new Set([a.keyId]), segments: a.segments.map(function(d) {
            return {
              startTime: b + d.startTime,
              endTime: b + d.endTime,
              initSegmentKey: a.initSegmentKey,
              appendWindowStart: b,
              appendWindowEnd: c,
              timestampOffset: b - a.presentationTimeOffset,
              dataKey: d.dataKey,
              tilesLayout: "",
              mimeType: null,
              codecs: null,
              thumbnailSprite: null
            };
          }), variantIds: a.variantIds, roles: [], forced: false, audioSamplingRate: null, channelsCount: null, spatialAudio: false, closedCaptions: null, tilesLayout: void 0, external: false, fastSwitching: false, isAudioMuxedInVideo: false };
        }
        function nA() {
          Sz.apply(this, arguments);
        }
        qa(nA, Sz);
        r = nA.prototype;
        r.hasFixedKeySpace = function() {
          return false;
        };
        r.addSegments = function(a) {
          return this.add(this.i, a);
        };
        r.addManifests = function(a) {
          return this.add(this.g, a);
        };
        r.updateManifest = function(a, b) {
          return Wz(this, a, b);
        };
        r.jd = function(a) {
          null == a.expiration && (a.expiration = Infinity);
          return Promise.resolve(a);
        };
        function oA() {
          this.m = this.j = this.i = this.h = this.g = this.l = null;
        }
        r = oA.prototype;
        r.init = function() {
          var a = this, b = new Ug(), c = false, d = new ec(function() {
            c = true;
            b.reject(new U(2, 9, 9017));
          });
          d.da(5);
          var e = window2.indexedDB.open("shaka_offline_db", 5);
          e.onsuccess = function() {
            if (!c) {
              var f = e.result;
              a.l = f;
              var g = f.objectStoreNames;
              g = g.contains("manifest") && g.contains("segment") ? new gA(f, "segment", "manifest") : null;
              a.g = g;
              g = f.objectStoreNames;
              g = g.contains("manifest-v2") && g.contains("segment-v2") ? new lA(f, "segment-v2", "manifest-v2") : null;
              a.h = g;
              g = f.objectStoreNames;
              g = g.contains("manifest-v3") && g.contains("segment-v3") ? new lA(f, "segment-v3", "manifest-v3") : null;
              a.i = g;
              g = f.objectStoreNames;
              g = g.contains("manifest-v5") && g.contains("segment-v5") ? new nA(f, "segment-v5", "manifest-v5") : null;
              a.j = g;
              f = f.objectStoreNames.contains("session-ids") ? new Xz(f) : null;
              a.m = f;
              d.stop();
              b.resolve();
            }
          };
          e.onupgradeneeded = function() {
            for (var f = e.result, g = t(["segment-v5", "manifest-v5", "session-ids"]), h = g.next(); !h.done; h = g.next()) h = h.value, f.objectStoreNames.contains(h) || f.createObjectStore(h, { autoIncrement: true });
          };
          e.onerror = function(f) {
            c || (b.reject(new U(
              2,
              9,
              9001,
              e.error
            )), d.stop(), f.preventDefault());
          };
          return b;
        };
        r.destroy = function() {
          var a = this;
          return Q(function(b) {
            switch (b.g) {
              case 1:
                if (!a.g) {
                  b.s(2);
                  break;
                }
                return F(b, a.g.destroy(), 2);
              case 2:
                if (!a.h) {
                  b.s(4);
                  break;
                }
                return F(b, a.h.destroy(), 4);
              case 4:
                if (!a.i) {
                  b.s(6);
                  break;
                }
                return F(b, a.i.destroy(), 6);
              case 6:
                if (!a.j) {
                  b.s(8);
                  break;
                }
                return F(b, a.j.destroy(), 8);
              case 8:
                if (!a.m) {
                  b.s(10);
                  break;
                }
                return F(b, a.m.destroy(), 10);
              case 10:
                a.l && a.l.close(), I(b);
            }
          });
        };
        r.getCells = function() {
          var a = /* @__PURE__ */ new Map();
          this.g && a.set("v1", this.g);
          this.h && a.set("v2", this.h);
          this.i && a.set("v3", this.i);
          this.j && a.set("v5", this.j);
          return a;
        };
        r.getEmeSessionCell = function() {
          return this.m;
        };
        r.erase = function() {
          var a = this;
          return Q(function(b) {
            switch (b.g) {
              case 1:
                if (!a.g) {
                  b.s(2);
                  break;
                }
                return F(b, a.g.destroy(), 2);
              case 2:
                if (!a.h) {
                  b.s(4);
                  break;
                }
                return F(b, a.h.destroy(), 4);
              case 4:
                if (!a.i) {
                  b.s(6);
                  break;
                }
                return F(b, a.i.destroy(), 6);
              case 6:
                if (!a.j) {
                  b.s(8);
                  break;
                }
                return F(b, a.j.destroy(), 8);
              case 8:
                return a.l && a.l.close(), F(b, pA(), 10);
              case 10:
                return a.l = null, a.g = null, a.h = null, a.i = null, a.j = null, F(b, a.init(), 0);
            }
          });
        };
        function pA() {
          var a = new Ug(), b = window2.indexedDB.deleteDatabase("shaka_offline_db");
          b.onblocked = function() {
          };
          b.onsuccess = function() {
            a.resolve();
          };
          b.onerror = function(c) {
            a.reject(new U(2, 9, 9001, b.error));
            c.preventDefault();
          };
          return a;
        }
        fA("idb", function() {
          return (!qc() || qc() && yc()) && !jc() && window2.indexedDB ? new oA() : null;
        });
        function qA(a, b, c, d) {
          this.g = a;
          this.i = b;
          this.h = c;
          this.l = d;
          this.j = ["offline:", a, "/", b, "/", c, "/", d].join("");
        }
        qA.prototype.zb = function() {
          return this.i;
        };
        qA.prototype.Ta = function() {
          return this.h;
        };
        qA.prototype.key = function() {
          return this.l;
        };
        qA.prototype.toString = function() {
          return this.j;
        };
        function rA(a) {
          a = /^offline:([a-z]+)\/([^/]+)\/([^/]+)\/([0-9]+)$/.exec(a);
          if (null == a) return null;
          var b = a[1];
          if ("manifest" != b && "segment" != b) return null;
          var c = a[2];
          if (!c) return null;
          var d = a[3];
          return d && null != b ? new qA(b, c, d, Number(a[4])) : null;
        }
        function sA(a, b) {
          this.h = a;
          this.g = b;
        }
        function tA(a, b) {
          var c = new xl(null, 0);
          c.bb(b.duration);
          var d = b.streams.filter(function(l) {
            return "audio" == l.type;
          }), e = b.streams.filter(function(l) {
            return "video" == l.type;
          });
          d = uA(a, d, e, c);
          e = b.streams.filter(function(l) {
            return l.type == dd;
          }).map(function(l) {
            return vA(a, l, c);
          });
          var f = b.streams.filter(function(l) {
            return "image" == l.type;
          }).map(function(l) {
            return vA(a, l, c);
          }), g = b.drmInfo ? [b.drmInfo] : [];
          if (b.drmInfo) for (var h = t(d.values()), k2 = h.next(); !k2.done; k2 = h.next()) k2 = k2.value, k2.audio && k2.audio.encrypted && (k2.audio.drmInfos = g), k2.video && k2.video.encrypted && (k2.video.drmInfos = g);
          return { presentationTimeline: c, offlineSessionIds: b.sessionIds, variants: Array.from(d.values()), textStreams: e, imageStreams: f, sequenceMode: b.sequenceMode || false, ignoreManifestTimestampsInSegmentsMode: false, type: b.type || "UNKNOWN", serviceDescription: null, nextUrl: null, periodCount: 1, gapCount: 0, isLowLatency: false, startTime: null };
        }
        function uA(a, b, c, d) {
          for (var e = /* @__PURE__ */ new Set(), f = t(b), g = f.next(); !g.done; g = f.next()) {
            g = t(g.value.variantIds);
            for (var h = g.next(); !h.done; h = g.next()) e.add(h.value);
          }
          f = t(c);
          for (g = f.next(); !g.done; g = f.next()) for (g = t(g.value.variantIds), h = g.next(); !h.done; h = g.next()) e.add(h.value);
          f = /* @__PURE__ */ new Map();
          e = t(e);
          for (g = e.next(); !g.done; g = e.next()) g = g.value, f.set(g, { id: g, language: "", disabledUntilTime: 0, primary: false, audio: null, video: null, bandwidth: 0, allowedByApplication: true, allowedByKeySystem: true, decodingInfos: [] });
          b = t(b);
          for (e = b.next(); !e.done; e = b.next()) for (g = e.value, e = vA(a, g, d), g = t(g.variantIds), h = g.next(); !h.done; h = g.next()) h = f.get(h.value), h.language = e.language, h.primary = h.primary || e.primary, h.audio = e;
          c = t(c);
          for (b = c.next(); !b.done; b = c.next()) for (e = b.value, b = vA(a, e, d), e = t(e.variantIds), g = e.next(); !g.done; g = e.next()) g = f.get(g.value), g.primary = g.primary || b.primary, g.video = b;
          return f;
        }
        function vA(a, b, c) {
          var d = b.segments.map(function(e) {
            return wA(a, e, b);
          });
          c.Ed(d);
          return { id: b.id, originalId: b.originalId, groupId: b.groupId, createSegmentIndex: function() {
            return Promise.resolve();
          }, segmentIndex: new Sl(d), mimeType: b.mimeType, codecs: b.codecs, width: b.width || void 0, height: b.height || void 0, frameRate: b.frameRate, pixelAspectRatio: b.pixelAspectRatio, hdr: b.hdr, colorGamut: b.colorGamut, videoLayout: b.videoLayout, kind: b.kind, encrypted: b.encrypted, drmInfos: [], keyIds: b.keyIds, language: b.language, originalLanguage: b.originalLanguage || null, label: b.label, type: b.type, primary: b.primary, trickModeVideo: null, dependencyStream: null, emsgSchemeIdUris: null, roles: b.roles, forced: b.forced, channelsCount: b.channelsCount, audioSamplingRate: b.audioSamplingRate, spatialAudio: b.spatialAudio, closedCaptions: b.closedCaptions, tilesLayout: b.tilesLayout, mssPrivateData: b.mssPrivateData, accessibilityPurpose: null, external: b.external, fastSwitching: b.fastSwitching, fullMimeTypes: /* @__PURE__ */ new Set([lf(b.mimeType, b.codecs)]), isAudioMuxedInVideo: false, baseOriginalId: null };
        }
        function wA(a, b, c) {
          var d = new qA("segment", a.h, a.g, b.dataKey);
          a = new Nj(b.startTime, b.endTime, function() {
            return [d.toString()];
          }, 0, null, null != b.initSegmentKey ? xA(a, b.initSegmentKey) : null, b.timestampOffset, b.appendWindowStart, b.appendWindowEnd, [], b.tilesLayout || "");
          a.mimeType = b.mimeType || c.mimeType || "";
          a.codecs = b.codecs || c.codecs || "";
          b.thumbnailSprite && a.De(b.thumbnailSprite);
          return a;
        }
        function xA(a, b) {
          var c = new qA("segment", a.h, a.g, b);
          return new Lj(function() {
            return [c.toString()];
          }, 0, null);
        }
        function yA() {
          this.g = null;
        }
        r = yA.prototype;
        r.configure = function() {
        };
        r.start = function(a, b) {
          var c = this, d, e, f, g, h, k2, l;
          return Q(function(m) {
            switch (m.g) {
              case 1:
                d = rA(a);
                c.g = d;
                if (null == d || "manifest" != d.g) throw new U(2, 1, 9004, a);
                e = new Yz();
                za(m, 2);
                return F(m, e.init(), 4);
              case 4:
                return F(m, bA(e, d.zb(), d.Ta()), 5);
              case 5:
                return f = m.h, F(m, f.getManifests([d.key()]), 6);
              case 6:
                return g = m.h, h = g[0], k2 = new sA(d.zb(), d.Ta()), l = tA(k2, h), b.makeTextStreamsForClosedCaptions(l), m.return(l);
              case 2:
                return Da(m), F(m, e.destroy(), 7);
              case 7:
                Ea(m, 0);
            }
          });
        };
        r.stop = function() {
          return Promise.resolve();
        };
        r.update = function() {
        };
        r.onExpirationUpdated = function(a, b) {
          var c = this, d, e, f, g, h, k2, l;
          return Q(function(m) {
            switch (m.g) {
              case 1:
                return d = c.g, e = new Yz(), xa(m, 2, 3), F(m, e.init(), 5);
              case 5:
                return F(m, bA(e, d.zb(), d.Ta()), 6);
              case 6:
                return f = m.h, F(m, f.getManifests([d.key()]), 7);
              case 7:
                g = m.h;
                h = g[0];
                k2 = h.sessionIds.includes(a);
                l = void 0 == h.expiration || h.expiration > b;
                if (!k2 || !l) {
                  m.s(3);
                  break;
                }
                return F(m, f.updateManifestExpiration(d.key(), b), 3);
              case 3:
                return Da(m), F(m, e.destroy(), 10);
              case 10:
                Ea(m, 0);
                break;
              case 2:
                Ba(m), m.s(3);
            }
          });
        };
        r.onInitialVariantChosen = function() {
        };
        r.banLocation = function() {
        };
        r.setMediaElement = function() {
        };
        Si("application/x-offline-manifest", function() {
          return new yA();
        });
        function zA() {
        }
        function AA(a, b) {
          var c = rA(a);
          c && "manifest" == c.g ? (a = { uri: a, originalUri: a, data: new ArrayBuffer(0), headers: { "content-type": "application/x-offline-manifest" }, originalRequest: b }, a = Yg(a)) : a = c && "segment" == c.g ? BA(c.key(), c, b) : Wg(new U(2, 1, 9004, a));
          return a;
        }
        function BA(a, b, c) {
          var d = new Yz();
          return Yg(void 0).Ha(function() {
            return d.init();
          }).Ha(function() {
            return bA(d, b.zb(), b.Ta());
          }).Ha(function(e) {
            return e.getSegments([b.key()]);
          }).Ha(function(e) {
            return { uri: b, data: e[0].data, headers: {}, originalRequest: c };
          }).finally(function() {
            return d.destroy();
          });
        }
        T("shaka.offline.OfflineScheme", zA);
        zA.plugin = AA;
        hh("offline", AA);
        function CA(a, b, c) {
          var d, e, f, g, h, k2;
          return Q(function(l) {
            switch (l.g) {
              case 1:
                d = [];
                for (var m = [], n = t(c), p = n.next(); !p.done; p = n.next()) {
                  p = p.value;
                  for (var q = false, u = t(m), w = u.next(); !w.done; w = u.next()) if (w = w.value, DA(w.info, p)) {
                    w.sessionIds.push(p.sessionId);
                    q = true;
                    break;
                  }
                  q || m.push({ info: p, sessionIds: [p.sessionId] });
                }
                e = t(m);
                f = e.next();
              case 2:
                if (f.done) {
                  l.s(4);
                  break;
                }
                g = f.value;
                h = EA(a, b, g);
                return F(l, h, 5);
              case 5:
                k2 = l.h;
                d = d.concat(k2);
                f = e.next();
                l.s(2);
                break;
              case 4:
                return l.return(d);
            }
          });
        }
        function EA(a, b, c) {
          var d, e;
          return Q(function(f) {
            switch (f.g) {
              case 1:
                return d = new Sh({ Xb: b, onError: function() {
                }, pe: function() {
                }, onExpirationUpdated: function() {
                }, onEvent: function() {
                } }), xa(f, 2), d.configure(a), F(f, $h(d, c.info.keySystem, c.info.licenseUri, c.info.serverCertificate, c.info.audioCapabilities, c.info.videoCapabilities), 4);
              case 4:
                Aa(f, 3);
                break;
              case 2:
                return Ba(f), F(f, d.destroy(), 5);
              case 5:
                return f.return([]);
              case 3:
                return e = [], F(f, Promise.all(c.sessionIds.map(function(g) {
                  return Q(function(h) {
                    if (1 == h.g) return xa(h, 2), F(h, li(d, g), 4);
                    if (2 != h.g) return e.push(g), Aa(h, 0);
                    Ba(h);
                    I(h);
                  });
                })), 6);
              case 6:
                return F(f, d.destroy(), 7);
              case 7:
                return f.return(e);
            }
          });
        }
        function DA(a, b) {
          function c(d, e) {
            return d.robustness == e.robustness && d.contentType == e.contentType;
          }
          return a.keySystem == b.keySystem && a.licenseUri == b.licenseUri && Dd(a.audioCapabilities, b.audioCapabilities, c) && Dd(a.videoCapabilities, b.videoCapabilities, c);
        }
        function FA(a, b, c) {
          var d = b.presentationTimeline.getDuration();
          b = GA(b);
          return { offlineUri: null, originalManifestUri: a, duration: d, size: 0, expiration: Infinity, tracks: b, appMetadata: c, isIncomplete: false };
        }
        function HA(a, b) {
          var c = tA(new sA(a.zb(), a.Ta()), b), d = b.appMetadata || {};
          c = GA(c);
          return { offlineUri: a.toString(), originalManifestUri: b.originalManifestUri, duration: b.duration, size: b.size, expiration: b.expiration, tracks: c, appMetadata: d, isIncomplete: b.isIncomplete || false };
        }
        function GA(a) {
          var b = [], c = Hg(a.variants);
          c = t(c);
          for (var d = c.next(); !d.done; d = c.next()) b.push(xg(d.value));
          a = t(a.textStreams);
          for (c = a.next(); !c.done; c = a.next()) b.push(yg(c.value));
          return b;
        }
        function IA() {
          this.g = /* @__PURE__ */ new Map();
        }
        function JA(a, b) {
          var c = b.audio, d = b.video;
          c && !d && a.g.set(c.id, c.bandwidth || b.bandwidth);
          !c && d && a.g.set(d.id, d.bandwidth || b.bandwidth);
          if (c && d) {
            var e = c.bandwidth || 393216, f = d.bandwidth || b.bandwidth - e;
            0 >= f && (f = b.bandwidth);
            a.g.set(c.id, e);
            a.g.set(d.id, f);
          }
        }
        function KA(a, b) {
          a.g.set(b.id, b.bandwidth || 2048);
        }
        function LA(a, b) {
          a = a.g.get(b);
          null == a && (a = 0);
          return a;
        }
        function MA(a) {
          var b = this;
          if (a && a.constructor != X) throw new U(2, 9, 9008);
          this.g = this.h = null;
          a ? (this.h = a.g, this.g = a.xb()) : (this.h = Jn(), this.g = new gh());
          this.i = [];
          this.l = [];
          var c = !a;
          this.j = new th(function() {
            var d, e, f, g, h;
            return Q(function(k2) {
              switch (k2.g) {
                case 1:
                  return F(k2, Promise.all(b.l.map(function(l) {
                    return Hz(l);
                  })), 2);
                case 2:
                  d = function() {
                  };
                  e = [];
                  f = t(b.i);
                  for (g = f.next(); !g.done; g = f.next()) h = g.value, e.push(h.then(d, d));
                  return F(k2, Promise.all(e), 3);
                case 3:
                  if (!c) {
                    k2.s(4);
                    break;
                  }
                  return F(k2, b.g.destroy(), 4);
                case 4:
                  b.h = null, b.g = null, I(k2);
              }
            });
          });
          this.m = 1e9;
        }
        function NA() {
          if (fc()) a: {
            var a = t(Zz.values());
            for (var b = a.next(); !b.done; b = a.next()) if (b = b.value, b = b()) {
              b.destroy();
              a = true;
              break a;
            }
            a = false;
          }
          else a = false;
          return a;
        }
        r = MA.prototype;
        r.destroy = function() {
          return this.j.destroy();
        };
        r.configure = function(a, b) {
          2 == arguments.length && "string" == typeof a && (a = qn(a, b));
          return On(this.h, a);
        };
        r.getConfiguration = function() {
          var a = Jn();
          On(a, this.h, Jn());
          return a;
        };
        r.xb = function() {
          return this.g;
        };
        r.store = function(a, b, c, d, e) {
          var f = this, g = this.getConfiguration(), h = new Gz(this.g);
          this.l.push(h);
          b = OA(this, a, b || {}, d || [], e || [], function() {
            var k2;
            return Q(function(l) {
              if (1 == l.g) return c ? l.s(2) : F(l, Do(a, f.g, g.manifest.retryParameters), 3);
              2 != l.g && (c = l.h);
              k2 = Vi(a, c || null);
              return l.return(k2());
            });
          }, g, h);
          b = new Vg(b, function() {
            return Hz(h);
          });
          b.finally(function() {
            Cd(f.l, h);
          });
          return PA(this, b);
        };
        function OA(a, b, c, d, e, f, g, h) {
          var k2, l, m, n, p, q, u, w, v, x, z, C, D, G, B, A, H, E, K, M, J, L, N, P;
          return Q(function(O) {
            switch (O.g) {
              case 1:
                return QA(), l = k2 = null, m = new Yz(), q = p = n = null, xa(O, 2, 3), F(O, f(), 5);
              case 5:
                return k2 = O.h, F(O, RA(a, b, k2, g), 6);
              case 6:
                u = O.h;
                SA(a);
                w = !u.presentationTimeline.U() && !u.presentationTimeline.yc();
                if (!w) throw new U(2, 9, 9005, b);
                v = t(d);
                x = v.next();
              case 7:
                if (x.done) {
                  O.s(9);
                  break;
                }
                z = x.value;
                return F(O, TA(a, z, u), 10);
              case 10:
                C = O.h;
                u.imageStreams.push(C);
                SA(a);
                x = v.next();
                O.s(7);
                break;
              case 9:
                D = t(e), G = D.next();
              case 11:
                if (G.done) return bi(g.drm.clearKeys, u.variants), H = u.variants.some(function(R) {
                  if (R.audio) {
                    for (var S = t(R.audio.drmInfos), pa = S.next(); !pa.done; pa = S.next()) if (pa.value.licenseServerUri.startsWith("data:")) return true;
                  }
                  if (R.video) {
                    for (R = t(R.video.drmInfos), S = R.next(); !S.done; S = R.next()) if (S.value.licenseServerUri.startsWith("data:")) return true;
                  }
                  return false;
                }), E = g.offline.usePersistentLicense, H && (E = false), F(O, a.Lc(u, function(R) {
                  q = q || R;
                }, g, E), 15);
                B = G.value;
                return F(
                  O,
                  UA(a, u, B.uri, B.language, B.kind, B.mime, B.codecs),
                  14
                );
              case 14:
                A = O.h;
                u.textStreams.push(A);
                SA(a);
                G = D.next();
                O.s(11);
                break;
              case 15:
                l = O.h;
                SA(a);
                if (q) throw q;
                return F(O, VA(u, l, g, E), 16);
              case 16:
                return F(O, m.init(), 17);
              case 17:
                return SA(a), F(O, $z(m), 18);
              case 18:
                return n = O.h, SA(a), K = WA(l, u, b, c, g, h, E), M = K.Yi, J = K.tg, F(O, n.Ta.addManifests([M]), 19);
              case 19:
                L = O.h;
                SA(a);
                p = L[0];
                SA(a);
                if (q) throw q;
                return F(O, XA(a, J, p, M, h, g, n.Ta, u, l, E), 20);
              case 20:
                return SA(a), YA(u, M, l, E), F(O, n.Ta.updateManifest(p, M), 21);
              case 21:
                return SA(a), N = new qA(
                  "manifest",
                  n.path.zb,
                  n.path.Ta,
                  p
                ), O.return(HA(N, M));
              case 3:
                return Da(O), F(O, m.destroy(), 22);
              case 22:
                if (!k2) {
                  O.s(23);
                  break;
                }
                return F(O, k2.stop(), 23);
              case 23:
                if (!l) {
                  O.s(25);
                  break;
                }
                return F(O, l.destroy(), 25);
              case 25:
                Ea(O, 0);
                break;
              case 2:
                P = Ba(O);
                if (null == p) {
                  O.s(27);
                  break;
                }
                return F(O, ZA(p), 27);
              case 27:
                throw q || P;
            }
          });
        }
        function XA(a, b, c, d, e, f, g, h, k2, l) {
          var m, n, p, q, u, w, v, x, z, C, D;
          return Q(function(G) {
            switch (G.g) {
              case 1:
                m = {};
                n = 0;
                p = function() {
                  if (a.j.g || e.l) throw new U(2, 9, 7001);
                };
                q = function(B, A) {
                  var H, E, K, M, J, L, N, P, O;
                  return Q(function(R) {
                    if (1 == R.g) {
                      H = t(B);
                      E = H.next();
                      for (K = {}; !E.done; K = { Nb: void 0 }, E = H.next()) K.Nb = E.value, p(), M = Cz(K.Nb, f), J = K.Nb.i, L = K.Nb.h, N = /* @__PURE__ */ function(S) {
                        return function(pa) {
                          var Z, Fa, Ia, sa;
                          return Q(function(ka) {
                            switch (ka.g) {
                              case 1:
                                Z = S.Nb.g;
                                Fa = Z.Ib(false);
                                if (!Z.aesKey || Fa) {
                                  ka.s(2);
                                  break;
                                }
                                return F(ka, zm(
                                  pa,
                                  Z.aesKey,
                                  S.Nb.j
                                ), 3);
                              case 3:
                                pa = ka.h;
                              case 2:
                                return Ia = Bz(Z), F(ka, g.addSegments([{ data: pa }]), 4);
                              case 4:
                                sa = ka.h, p(), m[Ia] = sa[0], n += pa.byteLength, I(ka);
                            }
                          });
                        };
                      }(K), P = K.Nb.g, (O = P.Ib(false)) ? Lz(e, K.Nb.groupId, O, J, L, N) : Jz(e, K.Nb.groupId, M, J, L, N);
                      return F(R, Mz(e), 2);
                    }
                    p();
                    if (!A || e.l) return R.s(0);
                    YA(h, d, k2, l);
                    return F(R, g.updateManifest(c, d), 0);
                  });
                };
                u = false;
                xa(G, 2);
                if (!$A(h) || !u || aB(h)) {
                  G.s(4);
                  break;
                }
                return F(G, q(b.filter(function(B) {
                  return B.h;
                }), true), 5);
              case 5:
                return p(), b = b.filter(function(B) {
                  return !B.h;
                }), w = m, v = n, m = {}, n = 0, F(G, bB(
                  g,
                  c,
                  d,
                  w,
                  v,
                  function() {
                    return SA(a);
                  }
                ), 6);
              case 6:
                p();
              case 4:
                if (u) {
                  G.s(7);
                  break;
                }
                return F(G, q(b, false), 8);
              case 8:
                return p(), x = m, z = n, m = {}, n = 0, F(G, bB(g, c, d, x, z, function() {
                  return p();
                }), 9);
              case 9:
                p();
              case 7:
                Aa(G, 0);
                break;
              case 2:
                return C = Ba(G), D = Object.values(m), F(G, g.removeSegments(D, function() {
                }), 10);
              case 10:
                throw C;
            }
          });
        }
        function ZA(a) {
          var b, c, d, e;
          return Q(function(f) {
            switch (f.g) {
              case 1:
                return b = new Yz(), F(f, b.init(), 2);
              case 2:
                return F(f, $z(b), 3);
              case 3:
                return c = f.h, d = new qA("manifest", c.path.zb, c.path.Ta, a), F(f, b.destroy(), 4);
              case 4:
                return e = new MA(), F(f, e.remove(d.toString()), 0);
            }
          });
        }
        function bB(a, b, c, d, e, f) {
          var g, h, k2, l, m, n, p, q, u, w, v;
          return Q(function(x) {
            switch (x.g) {
              case 1:
                g = false;
                xa(x, 2);
                h = true;
                k2 = t(c.streams);
                for (l = k2.next(); !l.done; l = k2.next()) for (m = l.value, n = t(m.segments), p = n.next(); !p.done; p = n.next()) q = p.value, u = q.pendingSegmentRefId ? d[q.pendingSegmentRefId] : null, null != u && (q.dataKey = u, q.pendingSegmentRefId = void 0), u = q.pendingInitSegmentRefId ? d[q.pendingInitSegmentRefId] : null, null != u && (q.initSegmentKey = u, q.pendingInitSegmentRefId = void 0), q.pendingSegmentRefId && (h = false), q.pendingInitSegmentRefId && (h = false);
                c.size += e;
                h && (c.isIncomplete = false);
                return F(x, a.updateManifest(b, c), 4);
              case 4:
                g = true;
                f();
                Aa(x, 0);
                break;
              case 2:
                return w = Ba(x), F(x, ZA(b), 5);
              case 5:
                if (g) {
                  x.s(6);
                  break;
                }
                v = Object.values(d);
                return F(x, a.removeSegments(v, function() {
                }), 6);
              case 6:
                throw w;
            }
          });
        }
        function VA(a, b, c, d) {
          var e, f, g, h, k2, l, m, n, p, q, u, w, v, x, z, C, D, G, B, A, H, E, K, M, J, L, N, P, O, R;
          return Q(function(S) {
            switch (S.g) {
              case 1:
                return e = { width: Infinity, height: Infinity }, eg(a, c.restrictions, e), F(S, hg(b, a, d, c.drm.preferredKeySystems, c.drm.keySystemsMapping), 2);
              case 2:
                f = [];
                g = c.preferredDecodingAttributes;
                h = c.preferredVideoCodecs;
                k2 = c.preferredAudioCodecs;
                l = c.preferredTextFormats;
                cg(a, h, k2, g, l);
                m = t(a.variants);
                for (n = m.next(); !n.done; n = m.next()) p = n.value, f.push(xg(p));
                q = t(a.textStreams);
                for (u = q.next(); !u.done; u = q.next()) w = u.value, f.push(yg(w));
                v = t(a.imageStreams);
                for (x = v.next(); !x.done; x = v.next()) z = x.value, f.push(zg(z));
                return F(S, c.offline.trackSelectionCallback(f), 3);
              case 3:
                C = S.h;
                D = a.presentationTimeline.getDuration();
                G = 0;
                B = t(C);
                for (A = B.next(); !A.done; A = B.next()) H = A.value, E = H.bandwidth * D / 8, G += E;
                xa(S, 4);
                return F(S, c.offline.downloadSizeCallback(G), 6);
              case 6:
                K = S.h;
                if (!K) throw new U(2, 9, 9014);
                Aa(S, 5);
                break;
              case 4:
                M = Ba(S);
                if (M instanceof U) throw M;
                throw new U(2, 9, 9015);
              case 5:
                J = /* @__PURE__ */ new Set();
                L = /* @__PURE__ */ new Set();
                N = /* @__PURE__ */ new Set();
                P = t(C);
                for (O = P.next(); !O.done; O = P.next()) R = O.value, "variant" == R.type && J.add(R.id), "text" == R.type && L.add(R.id), "image" == R.type && N.add(R.id);
                a.variants = a.variants.filter(function(pa) {
                  return J.has(pa.id);
                });
                a.textStreams = a.textStreams.filter(function(pa) {
                  return L.has(pa.id);
                });
                a.imageStreams = a.imageStreams.filter(function(pa) {
                  return N.has(pa.id);
                });
                cB(a);
                I(S);
            }
          });
        }
        function WA(a, b, c, d, e, f, g) {
          var h = FA(c, b, d), k2 = e.offline.progressCallback;
          Iz(f, function(u, w) {
            h.size = w;
            k2(h, u);
          }, function(u, w) {
            l && g && m == w && hi(a, "cenc", u);
          });
          var l = $A(b) && !aB(b), m = null;
          l && (m = dB.get(a.h.keySystem));
          for (var n = new IA(), p = t(b.textStreams), q = p.next(); !q.done; q = p.next()) n.g.set(q.value.id, 52);
          p = t(b.imageStreams);
          for (q = p.next(); !q.done; q = p.next()) KA(n, q.value);
          p = t(b.variants);
          for (q = p.next(); !q.done; q = p.next()) JA(n, q.value);
          f = eB(f, n, b, e);
          e = f.streams;
          f = f.tg;
          (n = a.h) && g && (n.initData = []);
          return { Yi: {
            creationTime: Date.now(),
            originalManifestUri: c,
            duration: b.presentationTimeline.getDuration(),
            size: 0,
            expiration: a.pd(),
            streams: e,
            sessionIds: g ? qi(a) : [],
            drmInfo: n,
            appMetadata: d,
            isIncomplete: true,
            sequenceMode: b.sequenceMode,
            type: b.type
          }, tg: f };
        }
        function $A(a) {
          return a.variants.some(function(b) {
            var c = b.audio && b.audio.encrypted;
            return b.video && b.video.encrypted || c;
          });
        }
        function aB(a) {
          return a.variants.some(function(b) {
            return (b.video ? b.video.drmInfos : []).concat(b.audio ? b.audio.drmInfos : []).some(function(c) {
              return c.initData && c.initData.length;
            });
          });
        }
        function YA(a, b, c, d) {
          b.expiration = c.pd();
          c = qi(c);
          b.sessionIds = d ? c : [];
          if ($A(a) && d && !c.length) throw new U(2, 9, 9007);
        }
        r.remove = function(a) {
          return fB(this, gB(this, a));
        };
        function gB(a, b) {
          var c, d, e, f, g, h;
          return Q(function(k2) {
            switch (k2.g) {
              case 1:
                QA();
                c = rA(b);
                if (null == c || "manifest" != c.g) throw new U(2, 9, 9004, b);
                d = c;
                e = new Yz();
                za(k2, 2);
                return F(k2, e.init(), 4);
              case 4:
                return F(k2, bA(e, d.zb(), d.Ta()), 5);
              case 5:
                return f = k2.h, F(k2, f.getManifests([d.key()]), 6);
              case 6:
                return g = k2.h, h = g[0], F(k2, Promise.all([hB(a, h, e), iB(f, d, h)]), 2);
              case 2:
                return Da(k2), F(k2, e.destroy(), 8);
              case 8:
                Ea(k2, 0);
            }
          });
        }
        function jB(a, b) {
          for (var c = [], d = t(a.streams), e = d.next(); !e.done; e = d.next()) e = e.value, b && "video" == e.type ? c.push({ contentType: lf(e.mimeType, e.codecs), robustness: a.drmInfo.videoRobustness }) : b || "audio" != e.type || c.push({ contentType: lf(e.mimeType, e.codecs), robustness: a.drmInfo.audioRobustness });
          return c;
        }
        function hB(a, b, c) {
          return Q(function(d) {
            return F(d, kB(a.g, a.h.drm, c, b), 0);
          });
        }
        function iB(a, b, c) {
          function d() {
          }
          var e = lB(c);
          HA(b, c);
          return Promise.all([a.removeSegments(e, d), a.removeManifests([b.key()], d)]);
        }
        r.qj = function() {
          return fB(this, mB(this));
        };
        function mB(a) {
          var b, c, d, e, f, g, h, k2, l, m;
          return Q(function(n) {
            switch (n.g) {
              case 1:
                return QA(), b = a.g, c = a.h.drm, d = new Yz(), e = false, za(n, 2), F(n, d.init(), 4);
              case 4:
                f = [], cA(d, function(p) {
                  return f.push(p);
                }), g = t(f), h = g.next();
              case 5:
                if (h.done) {
                  n.s(2);
                  break;
                }
                k2 = h.value;
                return F(n, k2.getAll(), 8);
              case 8:
                return l = n.h, F(n, CA(c, b, l), 9);
              case 9:
                return m = n.h, F(n, k2.remove(m), 10);
              case 10:
                m.length != l.length && (e = true);
                h = g.next();
                n.s(5);
                break;
              case 2:
                return Da(n), F(n, d.destroy(), 11);
              case 11:
                Ea(n, 3);
                break;
              case 3:
                return n.return(!e);
            }
          });
        }
        r.list = function() {
          return fB(this, nB());
        };
        function nB() {
          var a, b, c;
          return Q(function(d) {
            switch (d.g) {
              case 1:
                return QA(), a = [], b = new Yz(), za(d, 2), F(d, b.init(), 4);
              case 4:
                return c = Promise.resolve(), aA(b, function(e, f) {
                  c = c.then(function() {
                    var g;
                    return Q(function(h) {
                      if (1 == h.g) return F(h, f.getAllManifests(), 2);
                      g = h.h;
                      g.forEach(function(k2, l) {
                        k2 = HA(new qA("manifest", e.zb, e.Ta, l), k2);
                        a.push(k2);
                      });
                      I(h);
                    });
                  });
                }), F(d, c, 2);
              case 2:
                return Da(d), F(d, b.destroy(), 6);
              case 6:
                Ea(d, 3);
                break;
              case 3:
                return d.return(a);
            }
          });
        }
        function RA(a, b, c, d) {
          var e, f, g, h, k2;
          return Q(function(l) {
            if (1 == l.g) return e = null, f = a.g, g = {
              networkingEngine: f,
              filter: function() {
                return Promise.resolve();
              },
              makeTextStreamsForClosedCaptions: function() {
              },
              onTimelineRegionAdded: function() {
              },
              onEvent: function() {
              },
              onError: function(m) {
                e = m;
              },
              isLowLatencyMode: function() {
                return false;
              },
              updateDuration: function() {
              },
              newDrmInfo: function() {
              },
              onManifestUpdated: function() {
              },
              getBandwidthEstimate: function() {
                return d.abr.defaultBandwidthEstimate;
              },
              onMetadata: function() {
              },
              disableStream: function() {
              },
              addFont: function() {
              }
            }, c.configure(d.manifest), SA(a), F(l, c.start(b, g), 2);
            if (3 != l.g) return h = l.h, SA(a), k2 = oB(h), F(l, Promise.all(vh(k2, function(m) {
              return m.createSegmentIndex();
            })), 3);
            SA(a);
            if (e) throw e;
            return l.return(h);
          });
        }
        function TA(a, b, c) {
          var d, e, f, g, h, k2, l, m, n, p, q, u, w, v, x;
          return Q(function(z) {
            switch (z.g) {
              case 1:
                return F(z, pB(a, b), 2);
              case 2:
                d = z.h;
                if ("text/vtt" != d) throw new U(1, 2, 2017, b);
                return F(z, qB(b, a.g, a.h.streaming.retryParameters), 3);
              case 3:
                e = z.h;
                f = Bf(d);
                if (!f) throw new U(2, 2, 2014, d);
                g = f();
                h = { periodStart: 0, segmentStart: 0, segmentEnd: c.presentationTimeline.getDuration(), vttOffset: 0 };
                k2 = Qb(e);
                l = g.parseMedia(k2, h, b, []);
                m = [];
                n = t(l);
                p = n.next();
                for (q = {}; !p.done; q = { Me: void 0, Nc: void 0 }, p = n.next()) q.Nc = p.value, q.Me = null, u = /* @__PURE__ */ function(C) {
                  return function() {
                    null == C.Me && (C.Me = Xc([b], [C.Nc.payload]));
                    return C.Me || [];
                  };
                }(q), w = new Nj(q.Nc.startTime, q.Nc.endTime, u, 0, null, null, 0, 0, Infinity), q.Nc.payload.includes("#xywh") && (v = q.Nc.payload.split("#xywh=")[1].split(","), 4 === v.length && w.De({ height: parseInt(v[3], 10), positionX: parseInt(v[0], 10), positionY: parseInt(v[1], 10), width: parseInt(v[2], 10) })), m.push(w);
                x = d;
                if (!m.length) {
                  z.s(4);
                  break;
                }
                return F(z, Do(m[0].N()[0], a.g, a.h.manifest.retryParameters), 5);
              case 5:
                x = z.h;
              case 4:
                return z.return({
                  id: a.m++,
                  originalId: null,
                  groupId: null,
                  createSegmentIndex: function() {
                    return Promise.resolve();
                  },
                  segmentIndex: new Sl(m),
                  mimeType: x || "",
                  codecs: "",
                  kind: "",
                  encrypted: false,
                  drmInfos: [],
                  keyIds: /* @__PURE__ */ new Set(),
                  language: "und",
                  originalLanguage: null,
                  label: null,
                  type: "image",
                  primary: false,
                  trickModeVideo: null,
                  dependencyStream: null,
                  emsgSchemeIdUris: null,
                  roles: [],
                  forced: false,
                  channelsCount: null,
                  audioSamplingRate: null,
                  spatialAudio: false,
                  closedCaptions: null,
                  tilesLayout: "1x1",
                  accessibilityPurpose: null,
                  external: true,
                  fastSwitching: false,
                  fullMimeTypes: /* @__PURE__ */ new Set([lf(x || "", "")]),
                  isAudioMuxedInVideo: false,
                  baseOriginalId: null
                });
            }
          });
        }
        function UA(a, b, c, d, e, f, g) {
          var h, k2, l;
          return Q(function(m) {
            if (1 == m.g) return f ? m.s(2) : F(m, pB(a, c), 3);
            2 != m.g && (f = m.h);
            h = {
              id: a.m++,
              originalId: null,
              groupId: null,
              createSegmentIndex: function() {
                return Promise.resolve();
              },
              segmentIndex: Ul(0, b.presentationTimeline.getDuration(), [c]),
              mimeType: f || "",
              codecs: g || "",
              kind: e,
              encrypted: false,
              drmInfos: [],
              keyIds: /* @__PURE__ */ new Set(),
              language: d,
              originalLanguage: d,
              label: null,
              type: dd,
              primary: false,
              trickModeVideo: null,
              dependencyStream: null,
              emsgSchemeIdUris: null,
              roles: [],
              forced: false,
              channelsCount: null,
              audioSamplingRate: null,
              spatialAudio: false,
              closedCaptions: null,
              accessibilityPurpose: null,
              external: true,
              fastSwitching: false,
              fullMimeTypes: /* @__PURE__ */ new Set([lf(f || "", g || "")]),
              isAudioMuxedInVideo: false,
              baseOriginalId: null
            };
            k2 = lf(h.mimeType, h.codecs);
            l = Cf(k2);
            if (!l) throw new U(2, 2, 2014, f);
            return m.return(h);
          });
        }
        function pB(a, b) {
          var c;
          return Q(function(d) {
            switch (d.g) {
              case 1:
                return xa(d, 2), F(d, Do(b, a.g, a.h.streaming.retryParameters), 4);
              case 4:
                c = d.h;
                Aa(d, 3);
                break;
              case 2:
                Ba(d);
              case 3:
                if (c) return d.return(c);
                throw new U(1, 2, 2011, b);
            }
          });
        }
        function qB(a, b, c) {
          var d, e, f;
          return Q(function(g) {
            if (1 == g.g) return d = rh, e = lh([a], c), e.method = "GET", F(g, b.request(d, e).promise, 2);
            f = g.h;
            return g.return(f.data);
          });
        }
        r.Lc = function(a, b, c, d) {
          var e = this, f;
          return Q(function(g) {
            return 1 == g.g ? (f = new Sh({ Xb: e.g, onError: b, pe: function() {
            }, onExpirationUpdated: function() {
            }, onEvent: function() {
            } }), f.configure(c.drm), F(g, Xh(f, a.variants, d), 2)) : 3 != g.g ? F(g, ji(f), 3) : g.return(f);
          });
        };
        function eB(a, b, c, d) {
          var e = /* @__PURE__ */ new Map(), f = oB(c), g = /* @__PURE__ */ new Map();
          f = t(f);
          for (var h = f.next(); !h.done; h = f.next()) {
            h = h.value;
            var k2 = rB(a, b, c, h, d, e);
            g.set(h.id, k2);
          }
          a = t(c.variants);
          for (b = a.next(); !b.done; b = a.next()) b = b.value, b.audio && g.get(b.audio.id).variantIds.push(b.id), b.video && g.get(b.video.id).variantIds.push(b.id);
          return { streams: Array.from(g.values()), tg: Array.from(e.values()) };
        }
        function rB(a, b, c, d, e, f) {
          var g = {
            id: d.id,
            originalId: d.originalId,
            groupId: d.groupId,
            primary: d.primary,
            type: d.type,
            mimeType: d.mimeType,
            codecs: d.codecs,
            frameRate: d.frameRate,
            pixelAspectRatio: d.pixelAspectRatio,
            hdr: d.hdr,
            colorGamut: d.colorGamut,
            videoLayout: d.videoLayout,
            kind: d.kind,
            language: d.language,
            originalLanguage: d.originalLanguage,
            label: d.label,
            width: d.width || null,
            height: d.height || null,
            encrypted: d.encrypted,
            keyIds: d.keyIds,
            segments: [],
            variantIds: [],
            roles: d.roles,
            forced: d.forced,
            channelsCount: d.channelsCount,
            audioSamplingRate: d.audioSamplingRate,
            spatialAudio: d.spatialAudio,
            closedCaptions: d.closedCaptions,
            tilesLayout: d.tilesLayout,
            mssPrivateData: d.mssPrivateData,
            external: d.external,
            fastSwitching: d.fastSwitching,
            isAudioMuxedInVideo: d.isAudioMuxedInVideo
          }, h = e.offline.numberOfParallelDownloads, k2 = 0 === h ? d.id : 0;
          sB(d, c.presentationTimeline.pb(), function(l, m) {
            var n = Bz(l), p = void 0;
            if (!f.has(n)) {
              var q = l.endTime - l.startTime;
              q = LA(b, d.id) * q;
              q = Ez(a.g, q);
              f.set(n, new Az(l, q, k2, false, m));
            }
            l.$ && (p = Bz(l.$), f.has(p) || (q = 0.5 * LA(
              b,
              d.id
            ), q = Ez(a.g, q), f.set(p, new Az(l.$, q, k2, true, m))));
            g.segments.push({ pendingInitSegmentRefId: p, initSegmentKey: p ? 0 : null, startTime: l.startTime, endTime: l.endTime, appendWindowStart: l.appendWindowStart, appendWindowEnd: l.appendWindowEnd, timestampOffset: l.timestampOffset, tilesLayout: l.tilesLayout, pendingSegmentRefId: n, dataKey: 0, mimeType: l.mimeType, codecs: l.codecs, thumbnailSprite: l.thumbnailSprite });
            0 !== h && (k2 = (k2 + 1) % h);
          });
          return g;
        }
        function sB(a, b, c) {
          b = a.segmentIndex.find(b);
          if (null != b) for (var d = a.segmentIndex.get(b); d; ) c(d, b), d = a.segmentIndex.get(++b);
        }
        function SA(a) {
          if (a.j.g) throw new U(2, 9, 7001);
        }
        function QA() {
          if (!NA()) throw new U(2, 9, 9e3);
        }
        function fB(a, b) {
          return Q(function(c) {
            if (1 == c.g) return a.i.push(b), za(c, 2), F(c, b, 4);
            if (2 != c.g) return c.return(c.h);
            Da(c);
            Cd(a.i, b);
            return Ea(c, 0);
          });
        }
        function PA(a, b) {
          var c = b.promise;
          a.i.push(c);
          return b.finally(function() {
            Cd(a.i, c);
          });
        }
        function lB(a) {
          var b = /* @__PURE__ */ new Set();
          a = t(a.streams);
          for (var c = a.next(); !c.done; c = a.next()) {
            c = t(c.value.segments);
            for (var d = c.next(); !d.done; d = c.next()) d = d.value, null != d.initSegmentKey && b.add(d.initSegmentKey), b.add(d.dataKey);
          }
          return Array.from(b);
        }
        function kB(a, b, c, d) {
          var e, f, g;
          return Q(function(h) {
            if (1 == h.g) {
              if (!d.drmInfo) return h.return();
              e = dA(c);
              f = d.sessionIds.map(function(k2) {
                return { sessionId: k2, keySystem: d.drmInfo.keySystem, licenseUri: d.drmInfo.licenseServerUri, serverCertificate: d.drmInfo.serverCertificate, audioCapabilities: jB(d, false), videoCapabilities: jB(d, true) };
              });
              return F(h, CA(b, a, f), 2);
            }
            return 3 != h.g ? (g = h.h, F(h, e.remove(g), 3)) : F(h, e.add(f.filter(function(k2) {
              return !g.includes(k2.sessionId);
            })), 0);
          });
        }
        function oB(a) {
          for (var b = /* @__PURE__ */ new Set(), c = t(a.variants), d = c.next(); !d.done; d = c.next()) d = d.value, d.audio && b.add(d.audio), d.video && b.add(d.video);
          c = t(a.textStreams);
          for (d = c.next(); !d.done; d = c.next()) b.add(d.value);
          a = t(a.imageStreams);
          for (c = a.next(); !c.done; c = a.next()) b.add(c.value);
          return b;
        }
        function cB(a) {
          a.variants.map(function(f) {
            return f.video;
          });
          var b = new Set(a.variants.map(function(f) {
            return f.audio;
          }));
          a = a.textStreams;
          for (var c = t(b), d = c.next(); !d.done; d = c.next()) {
            d = t(b);
            for (var e = d.next(); !e.done; e = d.next()) ;
          }
          b = t(a);
          for (c = b.next(); !c.done; c = b.next()) for (c = t(a), d = c.next(); !d.done; d = c.next()) ;
        }
        T("shaka.offline.Storage", MA);
        MA.deleteAll = function() {
          var a;
          return Q(function(b) {
            return 1 == b.g ? (a = new Yz(), za(b, 2), F(b, eA(a), 2)) : 5 != b.g ? (Da(b), F(b, a.destroy(), 5)) : Ea(b, 0);
          });
        };
        MA.prototype.list = MA.prototype.list;
        MA.prototype.removeEmeSessions = MA.prototype.qj;
        MA.prototype.remove = MA.prototype.remove;
        MA.prototype.store = MA.prototype.store;
        MA.prototype.getNetworkingEngine = MA.prototype.xb;
        MA.prototype.getConfiguration = MA.prototype.getConfiguration;
        MA.prototype.configure = MA.prototype.configure;
        MA.prototype.destroy = MA.prototype.destroy;
        MA.support = NA;
        var dB = (/* @__PURE__ */ new Map()).set("org.w3.clearkey", "1077efecc0b24d02ace33c1e52e2fb4b").set("com.widevine.alpha", "edef8ba979d64acea3c827dcd51d21ed").set("com.microsoft.playready", "9a04f07998404286ab92e65be0885f95").set("com.microsoft.playready.recommendation", "9a04f07998404286ab92e65be0885f95").set("com.microsoft.playready.software", "9a04f07998404286ab92e65be0885f95").set("com.microsoft.playready.hardware", "9a04f07998404286ab92e65be0885f95").set("com.huawei.wiseplay", "3d5e6d359b9a41e8b843dd3c6e72c42c");
        Tp("offline", NA);
        function tB() {
        }
        function uB(a, b) {
          a = { priority: b || 0, callback: a };
          for (b = 0; b < vB.length; b++) if (vB[b].priority < a.priority) {
            vB.splice(b, 0, a);
            return;
          }
          vB.push(a);
        }
        T("shaka.polyfill", tB);
        tB.register = uB;
        tB.installAll = function() {
          for (var a = t(vB), b = a.next(); !b.done; b = a.next()) {
            b = b.value;
            try {
              b.callback();
            } catch (c) {
              bb("Error installing polyfill!", c);
            }
          }
        };
        var vB = [];
        function wB() {
        }
        function xB() {
          if (!Object.getOwnPropertyDescriptor(Element.prototype, "ariaHidden")) for (var a = t(["ariaHidden", "ariaLabel", "ariaPressed", "ariaSelected"]), b = a.next(); !b.done; b = a.next()) yB(b.value);
        }
        function yB(a) {
          var b = "aria-" + a.toLowerCase().replace(/^aria/, "");
          Object.defineProperty(Element.prototype, a, { get: function() {
            return this.getAttribute(b);
          }, set: function(c) {
            null == c || void 0 == c ? this.removeAttribute(b) : this.setAttribute(b, c);
          } });
        }
        tB.Aria = wB;
        wB.install = xB;
        uB(xB);
        function zB() {
        }
        function AB() {
          uc() || kc("Sky_STB") || BB();
        }
        tB.EncryptionScheme = zB;
        zB.install = AB;
        uB(AB, -2);
        function CB() {
        }
        function DB() {
          if (window2.Document) {
            var a = Element.prototype;
            a.requestFullscreen = a.requestFullscreen || a.mozRequestFullScreen || a.msRequestFullscreen || a.webkitRequestFullscreen;
            a = Document.prototype;
            a.exitFullscreen = a.exitFullscreen || a.mozCancelFullScreen || a.msExitFullscreen || a.webkitCancelFullScreen;
            "fullscreenElement" in document || (Object.defineProperty(document, "fullscreenElement", { get: function() {
              return document.mozFullScreenElement || document.msFullscreenElement || document.webkitCurrentFullScreenElement || document.webkitFullscreenElement;
            } }), Object.defineProperty(document, "fullscreenEnabled", { get: function() {
              return document.mozFullScreenEnabled || document.msFullscreenEnabled || document.webkitFullscreenEnabled;
            } }));
            document.addEventListener("webkitfullscreenchange", EB);
            document.addEventListener("webkitfullscreenerror", EB);
            document.addEventListener("mozfullscreenchange", EB);
            document.addEventListener("mozfullscreenerror", EB);
            document.addEventListener("MSFullscreenChange", EB);
            document.addEventListener("MSFullscreenError", EB);
          }
        }
        function EB(a) {
          var b = a.type.replace(/^(webkit|moz|MS)/, "").toLowerCase(), c = document.createEvent("Event");
          c.initEvent(b, a.bubbles, a.cancelable);
          a.target.dispatchEvent(c);
        }
        tB.Fullscreen = CB;
        CB.install = DB;
        uB(DB);
        function FB() {
        }
        function GB() {
          var a = true;
          if (qc() && !yc() && !zc() || rc() || tc() || uc() || nc() || lc() || vc() || sc() && !rc()) a = false;
          a && navigator.mediaCapabilities || (navigator.mediaCapabilities || (navigator.mediaCapabilities = {}), HB = navigator.mediaCapabilities, navigator.mediaCapabilities.decodingInfo = IB);
        }
        function IB(a) {
          var b, c, d, e, f, g, h, k2, l, m, n;
          return Q(function(p) {
            switch (p.g) {
              case 1:
                b = { supported: false, powerEfficient: true, smooth: true, keySystemAccess: null, configuration: a };
                c = a.video;
                d = a.audio;
                if ("media-source" != a.type) {
                  if ("file" == a.type) {
                    if (c && (e = c.contentType, f = gc(e), !f) || d && (g = d.contentType, h = gc(g), !h)) return p.return(b);
                  } else return p.return(b);
                  p.s(2);
                  break;
                }
                if (!fc()) return p.return(b);
                if (!c) {
                  p.s(3);
                  break;
                }
                return F(p, JB(c), 4);
              case 4:
                if (k2 = p.h, !k2) return p.return(b);
              case 3:
                if (d) {
                  var q = d.contentType;
                  qc() && d.spatialRendering && (q += "; spatialRendering=true");
                  l = md(q);
                  if (!l) return p.return(b);
                }
              case 2:
                if (!a.keySystemConfiguration) return b.supported = true, p.return(b);
                m = a.keySystemConfiguration;
                return F(p, KB(c, d, m), 6);
              case 6:
                if (n = p.h) b.supported = true, b.keySystemAccess = n;
              case 5:
                return p.return(b);
            }
          });
        }
        function JB(a) {
          var b, c;
          return Q(function(d) {
            return 1 == d.g ? qc() ? F(d, LB(a), 3) : lc() ? (b = a.contentType, a.width && a.height && (b += "; width=" + a.width, b += "; height=" + a.height), a.framerate && (b += "; framerate=" + a.framerate), a.bitrate && (b += "; bitrate=" + a.bitrate), d.return(md(b))) : d.s(2) : 2 != d.g ? (c = d.h, d.return(c)) : d.return(md(a.contentType));
          });
        }
        function KB(a, b, c) {
          var d, e, f, g, h, k2, l, m, n, p, q;
          return Q(function(u) {
            switch (u.g) {
              case 1:
                d = [];
                e = [];
                c.audio && (f = { robustness: c.audio.robustness || "", contentType: b.contentType }, lc() && b.contentType.includes('codecs="ac-3"') && (f.contentType = 'audio/mp4; codecs="ec-3"'), c.audio.encryptionScheme && (f.encryptionScheme = c.audio.encryptionScheme), d.push(f));
                c.video && (g = { robustness: c.video.robustness || "", contentType: a.contentType }, c.video.encryptionScheme && (g.encryptionScheme = c.video.encryptionScheme), e.push(g));
                h = { initDataTypes: [c.initDataType], distinctiveIdentifier: c.distinctiveIdentifier, persistentState: c.persistentState, sessionTypes: c.sessionTypes };
                d.length && (h.audioCapabilities = d);
                e.length && (h.videoCapabilities = e);
                k2 = a ? a.contentType : "";
                l = b ? b.contentType : "";
                m = vf(k2) + ";" + uf(k2);
                n = vf(l) + ";" + uf(l);
                p = c.keySystem;
                q = null;
                xa(u, 2);
                if (cc.has(m + "#" + n + "#" + p)) {
                  q = cc.get(m + "#" + n + "#" + p) || null;
                  u.s(4);
                  break;
                }
                return F(u, navigator.requestMediaKeySystemAccess(c.keySystem, [h]), 5);
              case 5:
                q = u.h, cc.set(m + "#" + n + "#" + p, q);
              case 4:
                Aa(
                  u,
                  3
                );
                break;
              case 2:
                Ba(u);
              case 3:
                return u.return(q);
            }
          });
        }
        function LB(a) {
          var b, c, d, e, f;
          return Q(function(g) {
            if (1 == g.g) {
              if (!(window2.cast && cast.__platform__ && cast.__platform__.canDisplayType)) return g.return(md(a.contentType));
              b = a.contentType;
              a.width && a.height && 1280 < a.width && 720 < a.height && (b += "; width=" + a.width + "; height=" + a.height);
              a.framerate && (c = Math.round(a.framerate), 24 > c || 30 < c) && (b += "; framerate=" + a.framerate);
              d = a.transferFunction || "";
              switch (d) {
                case "":
                case "srgb":
                  break;
                case "pq":
                  b += "; eotf=smpte2084";
                  break;
                case "hlg":
                  b += "; eotf=arib-std-b67";
                  break;
                default:
                  return g.return(false);
              }
              e = false;
              f = MB;
              return f.has(b) ? (e = f.get(b), g.s(2)) : F(g, cast.__platform__.canDisplayType(b), 3);
            }
            2 != g.g && (e = g.h, f.set(b, e));
            return g.return(e);
          });
        }
        tB.MediaCapabilities = FB;
        FB.install = GB;
        var HB = null;
        FB.originalMcap = HB;
        var MB = /* @__PURE__ */ new Map();
        uB(GB, -1);
        function NB() {
        }
        function OB() {
          var a = wc();
          if (window2.MediaSource || window2.ManagedMediaSource) a && window2.MediaSource ? 12 >= a ? (PB(), QB()) : 15 >= a && PB() : kc("DT_STB_BCM") ? (PB(), QB()) : (kc("Tizen 2") || mc() || kc("Tizen 4")) && RB();
          (window2.MediaSource || window2.ManagedMediaSource) && SB();
          window2.MediaSource && MediaSource.isTypeSupported('video/webm; codecs="vp9"') && !MediaSource.isTypeSupported('video/webm; codecs="vp09.00.10.08"') && TB();
        }
        function PB() {
          var a = MediaSource.prototype.addSourceBuffer;
          MediaSource.prototype.addSourceBuffer = function() {
            var b = a.apply(this, Na.apply(0, arguments));
            b.abort = function() {
            };
            return b;
          };
        }
        function QB() {
          var a = SourceBuffer.prototype.remove;
          SourceBuffer.prototype.remove = function(b, c) {
            return a.call(this, b, c - 1e-3);
          };
        }
        function SB() {
          if (window2.MediaSource) {
            var a = MediaSource.isTypeSupported.bind(MediaSource);
            MediaSource.isTypeSupported = function(c) {
              return "mp2t" != rf(c) && a(c);
            };
          }
          if (window2.ManagedMediaSource) {
            var b = ManagedMediaSource.isTypeSupported.bind(ManagedMediaSource);
            window2.ManagedMediaSource.isTypeSupported = function(c) {
              return "mp2t" != rf(c) && b(c);
            };
          }
        }
        function RB() {
          var a = MediaSource.isTypeSupported.bind(MediaSource);
          MediaSource.isTypeSupported = function(c) {
            return "opus" != uf(c) && a(c);
          };
          if (window2.ManagedMediaSource) {
            var b = ManagedMediaSource.isTypeSupported.bind(ManagedMediaSource);
            window2.ManagedMediaSource.isTypeSupported = function(c) {
              return "opus" != uf(c) && b(c);
            };
          }
        }
        function TB() {
          var a = MediaSource.isTypeSupported;
          nc() || (MediaSource.isTypeSupported = function(b) {
            var c = b.split(/ *; */), d = c.findIndex(function(g) {
              return g.startsWith("codecs=");
            });
            if (0 > d) return a(b);
            var e = c[d].replace("codecs=", "").replace(/"/g, "").split(/\s*,\s*/), f = e.findIndex(function(g) {
              return g.startsWith("vp09");
            });
            0 <= f && (e[f] = "vp9", c[d] = 'codecs="' + e.join(",") + '"', b = c.join("; "));
            return a(b);
          });
        }
        tB.MediaSource = NB;
        NB.install = OB;
        uB(OB);
        function UB() {
        }
        function VB() {
          screen.orientation && screen.orientation.unlock || (void 0 != screen.orientation ? WB() : void 0 != window2.orientation && XB());
        }
        function WB() {
          void 0 === screen.orientation.lock && (screen.orientation.lock = function() {
            return Promise.resolve();
          });
          void 0 === screen.orientation.unlock && (screen.orientation.unlock = function() {
          });
        }
        function XB() {
          function a() {
            switch (window2.orientation) {
              case -90:
                b.type = "landscape-secondary";
                b.angle = 270;
                break;
              case 0:
                b.type = "portrait-primary";
                b.angle = 0;
                break;
              case 90:
                b.type = "landscape-primary";
                b.angle = 90;
                break;
              case 180:
                b.type = "portrait-secondary", b.angle = 180;
            }
          }
          var b = new YB();
          screen.orientation = b;
          a();
          window2.addEventListener("orientationchange", function() {
            a();
            var c = new V("change");
            b.dispatchEvent(c);
          });
        }
        tB.Orientation = UB;
        UB.install = VB;
        function YB() {
          dh.call(this);
          this.type = "";
          this.angle = 0;
        }
        qa(YB, dh);
        YB.prototype.lock = function(a) {
          function b(d) {
            return screen.lockOrientation ? screen.lockOrientation(d) : screen.mozLockOrientation ? screen.mozLockOrientation(d) : screen.msLockOrientation ? screen.msLockOrientation(d) : false;
          }
          var c = false;
          switch (a) {
            case "natural":
              c = b("default");
              break;
            case "any":
              c = true;
              this.unlock();
              break;
            default:
              c = b(a);
          }
          if (c) return Promise.resolve();
          a = Error("screen.orientation.lock() is not available on this device");
          a.name = "NotSupportedError";
          a.code = DOMException.NOT_SUPPORTED_ERR;
          return Promise.reject(a);
        };
        YB.prototype.unlock = function() {
          screen.unlockOrientation ? screen.unlockOrientation() : screen.mozUnlockOrientation ? screen.mozUnlockOrientation() : screen.msUnlockOrientation && screen.msUnlockOrientation();
        };
        uB(VB);
        function ZB() {
        }
        var $B, aC, bC, cC, dC, eC;
        function fC(a) {
          if (window2.HTMLVideoElement && window2.WebKitMediaKeys) {
            if (void 0 === a ? 0 : a) $B = true, aC = Object.getOwnPropertyDescriptor(HTMLMediaElement.prototype, "mediaKeys"), bC = HTMLMediaElement.prototype.setMediaKeys, cC = window2.MediaKeys, dC = window2.MediaKeySystemAccess, eC = navigator.requestMediaKeySystemAccess;
            delete HTMLMediaElement.prototype.mediaKeys;
            HTMLMediaElement.prototype.mediaKeys = null;
            HTMLMediaElement.prototype.setMediaKeys = gC;
            window2.MediaKeys = hC;
            window2.MediaKeySystemAccess = iC;
            navigator.requestMediaKeySystemAccess = jC;
            window2.shakaMediaKeysPolyfill = kC;
            pg.clear();
            cc.clear();
          }
        }
        function jC(a, b) {
          try {
            var c = new iC(a, b);
            return Promise.resolve(c);
          } catch (d) {
            return Promise.reject(d);
          }
        }
        function gC(a) {
          var b = this.mediaKeys;
          b && b != a && lC(b, null);
          delete this.mediaKeys;
          return (this.mediaKeys = a) ? lC(a, this) : Promise.resolve();
        }
        function mC(a) {
          a = Qb(a.initData);
          if (Vb(a).getUint32(0, true) + 4 != a.byteLength) throw new RangeError("Malformed FairPlay init data");
          a = Ic(a.subarray(4), true);
          a = Lc(a);
          var b = new Event("encrypted");
          b.initDataType = "skd";
          b.initData = Sb(a);
          this.dispatchEvent(b);
        }
        tB.PatchedMediaKeysApple = ZB;
        ZB.uninstall = function() {
          $B && ($B = false, Object.defineProperty(HTMLMediaElement.prototype, "mediaKeys", aC), HTMLMediaElement.prototype.setMediaKeys = bC, window2.MediaKeys = cC, window2.MediaKeySystemAccess = dC, navigator.requestMediaKeySystemAccess = eC, aC = eC = bC = dC = cC = null, window2.shakaMediaKeysPolyfill = "", pg.clear(), cc.clear());
        };
        ZB.install = fC;
        function iC(a, b) {
          this.keySystem = a;
          if (a.startsWith("com.apple.fps")) for (a = t(b), b = a.next(); !b.done; b = a.next()) {
            var c = b.value;
            if ("required" == c.persistentState) b = null;
            else {
              b = { audioCapabilities: [], videoCapabilities: [], persistentState: "optional", distinctiveIdentifier: "optional", initDataTypes: c.initDataTypes, sessionTypes: ["temporary"], label: c.label };
              var d = false, e = false;
              if (c.audioCapabilities) for (var f = t(c.audioCapabilities), g = f.next(); !g.done; g = f.next()) g = g.value, g.contentType && (d = true, WebKitMediaKeys.isTypeSupported(
                this.keySystem,
                g.contentType.split(";")[0]
              ) && (b.audioCapabilities.push(g), e = true));
              if (c.videoCapabilities) for (c = t(c.videoCapabilities), f = c.next(); !f.done; f = c.next()) f = f.value, f.contentType && (d = true, WebKitMediaKeys.isTypeSupported(this.keySystem, f.contentType.split(";")[0]) && (b.videoCapabilities.push(f), e = true));
              d || (e = WebKitMediaKeys.isTypeSupported(this.keySystem, "video/mp4"));
              b = e ? b : null;
            }
            if (b) {
              this.g = b;
              return;
            }
          }
          a = Error("Unsupported keySystem");
          a.name = "NotSupportedError";
          a.code = DOMException.NOT_SUPPORTED_ERR;
          throw a;
        }
        iC.prototype.createMediaKeys = function() {
          var a = new hC(this.keySystem);
          return Promise.resolve(a);
        };
        iC.prototype.getConfiguration = function() {
          return this.g;
        };
        function hC(a) {
          this.h = new WebKitMediaKeys(a);
          this.g = new lb();
        }
        hC.prototype.createSession = function(a) {
          a = a || "temporary";
          if ("temporary" != a) throw new TypeError("Session type " + a + " is unsupported on this platform.");
          return new nC(this.h);
        };
        hC.prototype.setServerCertificate = function() {
          return Promise.resolve(false);
        };
        function lC(a, b) {
          a.g.Qa();
          if (!b) return Promise.resolve();
          a.g.D(b, "webkitneedkey", mC);
          try {
            return El(b, HTMLMediaElement.HAVE_METADATA, a.g, function() {
              b.webkitSetMediaKeys(a.h);
            }), Promise.resolve();
          } catch (c) {
            return Promise.reject(c);
          }
        }
        hC.prototype.getStatusForPolicy = function() {
          return Promise.resolve("usable");
        };
        function nC(a) {
          dh.call(this);
          this.i = null;
          this.l = a;
          this.g = this.h = null;
          this.j = new lb();
          this.sessionId = "";
          this.expiration = NaN;
          this.closed = new Ug();
          this.keyStatuses = new oC();
        }
        qa(nC, dh);
        r = nC.prototype;
        r.generateRequest = function(a, b) {
          var c = this;
          this.h = new Ug();
          try {
            var d = this.l.createSession("video/mp4", Qb(b));
            this.i = d;
            this.sessionId = d.sessionId || "";
            this.j.D(this.i, "webkitkeymessage", function(e) {
              c.h && (c.h.resolve(), c.h = null);
              e = (/* @__PURE__ */ new Map()).set("messageType", void 0 == c.keyStatuses.dc() ? "license-request" : "license-renewal").set("message", Sb(e.message));
              e = new V("message", e);
              c.dispatchEvent(e);
            });
            this.j.D(d, "webkitkeyadded", function() {
              c.g && (pC(c, "usable"), c.g.resolve(), c.g = null);
            });
            this.j.D(
              d,
              "webkitkeyerror",
              function() {
                var e = Error("EME PatchedMediaKeysApple key error");
                e.errorCode = c.i.error;
                if (null != c.h) c.h.reject(e), c.h = null;
                else if (null != c.g) c.g.reject(e), c.g = null;
                else switch (c.i.error.code) {
                  case WebKitMediaKeyError.MEDIA_KEYERR_OUTPUT:
                  case WebKitMediaKeyError.MEDIA_KEYERR_HARDWARECHANGE:
                    pC(c, "output-not-allowed");
                    break;
                  default:
                    pC(c, "internal-error");
                }
              }
            );
            pC(this, "status-pending");
          } catch (e) {
            this.h.reject(e);
          }
          return this.h;
        };
        r.load = function() {
          return Promise.reject(Error("MediaKeySession.load not yet supported"));
        };
        r.update = function(a) {
          this.g = new Ug();
          try {
            this.i.update(Qb(a));
          } catch (b) {
            this.g.reject(b);
          }
          return this.g;
        };
        r.close = function() {
          try {
            this.i.close(), this.closed.resolve(), this.j.Qa();
          } catch (a) {
            this.closed.reject(a);
          }
          return this.closed;
        };
        r.remove = function() {
          return Promise.reject(Error("MediaKeySession.remove is only applicable for persistent licenses, which are not supported on this platform"));
        };
        function pC(a, b) {
          var c = a.keyStatuses;
          c.size = void 0 == b ? 0 : 1;
          c.g = b;
          b = new V("keystatuseschange");
          a.dispatchEvent(b);
        }
        function oC() {
          this.size = 0;
          this.g = void 0;
        }
        r = oC.prototype;
        r.dc = function() {
          return this.g;
        };
        r.forEach = function(a) {
          this.g && a(this.g, bc.value());
        };
        r.get = function(a) {
          if (this.has(a)) return this.g;
        };
        r.has = function(a) {
          var b = bc.value();
          return this.g && Pb(a, b) ? true : false;
        };
        r.entries = function() {
        };
        r.keys = function() {
        };
        r.values = function() {
        };
        var kC = "apple";
        uB(function() {
          window2.HTMLVideoElement && window2.WebKitMediaKeys && (navigator.requestMediaKeySystemAccess && MediaKeySystemAccess.prototype.getConfiguration || fC());
        });
        function qC() {
        }
        function rC() {
          window2.MediaKeys && (!MediaKeys.prototype.setServerCertificate || mc() || kc("Tizen 4") || kc("Tizen 5.0") || oc()) && (MediaKeys.prototype.setServerCertificate = sC);
        }
        function sC() {
          return Promise.resolve(false);
        }
        tB.PatchedMediaKeysCert = qC;
        qC.install = rC;
        uB(rC);
        function tC() {
        }
        function uC() {
          if (!(!window2.HTMLVideoElement || navigator.requestMediaKeySystemAccess && MediaKeySystemAccess.prototype.getConfiguration)) {
            if (HTMLMediaElement.prototype.webkitGenerateKeyRequest) vC = "webkit";
            else if (!HTMLMediaElement.prototype.generateKeyRequest) return;
            navigator.requestMediaKeySystemAccess = wC;
            delete HTMLMediaElement.prototype.mediaKeys;
            HTMLMediaElement.prototype.mediaKeys = null;
            HTMLMediaElement.prototype.setMediaKeys = xC;
            window2.MediaKeys = yC;
            window2.MediaKeySystemAccess = zC;
            window2.shakaMediaKeysPolyfill = AC;
          }
        }
        function BC(a) {
          var b = vC;
          return b ? b + a.charAt(0).toUpperCase() + a.slice(1) : a;
        }
        function wC(a, b) {
          try {
            var c = new zC(a, b);
            return Promise.resolve(c);
          } catch (d) {
            return Promise.reject(d);
          }
        }
        function xC(a) {
          var b = this.mediaKeys;
          b && b != a && CC(b, null);
          delete this.mediaKeys;
          (this.mediaKeys = a) && CC(a, this);
          return Promise.resolve();
        }
        tB.PatchedMediaKeysWebkit = tC;
        tC.install = uC;
        function zC(a, b) {
          this.g = this.keySystem = a;
          var c = false;
          "org.w3.clearkey" == a && (this.g = "webkit-org.w3.clearkey", c = false);
          var d = false;
          var e = document.getElementsByTagName("video");
          e = e.length ? e[0] : document.createElement("video");
          b = t(b);
          for (var f = b.next(); !f.done; f = b.next()) {
            f = f.value;
            var g = { audioCapabilities: [], videoCapabilities: [], persistentState: "optional", distinctiveIdentifier: "optional", initDataTypes: f.initDataTypes, sessionTypes: ["temporary"], label: f.label }, h = false;
            if (f.audioCapabilities) for (var k2 = t(f.audioCapabilities), l = k2.next(); !l.done; l = k2.next()) l = l.value, l.contentType && (h = true, e.canPlayType(l.contentType.split(";")[0], this.g) && (g.audioCapabilities.push(l), d = true));
            if (f.videoCapabilities) for (k2 = t(f.videoCapabilities), l = k2.next(); !l.done; l = k2.next()) l = l.value, l.contentType && (h = true, e.canPlayType(l.contentType, this.g) && (g.videoCapabilities.push(l), d = true));
            h || (d = e.canPlayType("video/mp4", this.g) || e.canPlayType("video/webm", this.g));
            "required" == f.persistentState && (c ? (g.persistentState = "required", g.sessionTypes = ["persistent-license"]) : d = false);
            if (d) {
              this.h = g;
              return;
            }
          }
          c = "Unsupported keySystem";
          if ("org.w3.clearkey" == a || "com.widevine.alpha" == a) c = "None of the requested configurations were supported.";
          a = Error(c);
          a.name = "NotSupportedError";
          a.code = DOMException.NOT_SUPPORTED_ERR;
          throw a;
        }
        zC.prototype.createMediaKeys = function() {
          var a = new yC(this.g);
          return Promise.resolve(a);
        };
        zC.prototype.getConfiguration = function() {
          return this.h;
        };
        function yC(a) {
          this.l = a;
          this.h = null;
          this.g = new lb();
          this.i = [];
          this.j = /* @__PURE__ */ new Map();
        }
        function CC(a, b) {
          a.h = b;
          a.g.Qa();
          var c = vC;
          b && (a.g.D(b, c + "needkey", function(d) {
            var e = new CustomEvent("encrypted");
            e.initDataType = "cenc";
            e.initData = Sb(d.initData);
            a.h.dispatchEvent(e);
          }), a.g.D(b, c + "keymessage", function(d) {
            var e = DC(a, d.sessionId);
            e && (d = (/* @__PURE__ */ new Map()).set("messageType", void 0 == e.keyStatuses.dc() ? "licenserequest" : "licenserenewal").set("message", d.message), d = new V("message", d), e.h && (e.h.resolve(), e.h = null), e.dispatchEvent(d));
          }), a.g.D(b, c + "keyadded", function(d) {
            (d = DC(a, d.sessionId)) && d.ready();
          }), a.g.D(b, c + "keyerror", function(d) {
            var e = DC(a, d.sessionId);
            if (e) {
              var f = Error("EME v0.1b key error"), g = d.errorCode;
              g.systemCode = d.systemCode;
              f.errorCode = g;
              !d.sessionId && e.h ? (45 == d.systemCode && (f.message = "Unsupported session type."), e.h.reject(f), e.h = null) : d.sessionId && e.g ? (e.g.reject(f), e.g = null) : (f = d.systemCode, d.errorCode.code == MediaKeyError.MEDIA_KEYERR_OUTPUT ? EC(e, "output-restricted") : 1 == f ? EC(e, "expired") : EC(e, "internal-error"));
            }
          }));
        }
        yC.prototype.createSession = function(a) {
          a = a || "temporary";
          if ("temporary" != a && "persistent-license" != a) throw new TypeError("Session type " + a + " is unsupported on this platform.");
          var b = this.h || document.createElement("video");
          b.src || (b.src = "about:blank");
          a = new FC(b, this.l, a);
          this.i.push(a);
          return a;
        };
        yC.prototype.setServerCertificate = function() {
          return Promise.resolve(false);
        };
        yC.prototype.getStatusForPolicy = function() {
          return Promise.resolve("usable");
        };
        function DC(a, b) {
          var c = a.j.get(b);
          return c ? c : (c = a.i.shift()) ? (c.sessionId = b, a.j.set(b, c), c) : null;
        }
        function FC(a, b, c) {
          dh.call(this);
          this.j = a;
          this.m = false;
          this.g = this.h = null;
          this.i = b;
          this.l = c;
          this.sessionId = "";
          this.expiration = NaN;
          this.closed = new Ug();
          this.keyStatuses = new GC();
        }
        qa(FC, dh);
        r = FC.prototype;
        r.ready = function() {
          EC(this, "usable");
          this.g && this.g.resolve();
          this.g = null;
        };
        function HC(a, b, c) {
          if (a.m) return Promise.reject(Error("The session is already initialized."));
          a.m = true;
          try {
            if ("persistent-license" == a.l) if (c) var d = Qb(Lc("LOAD_SESSION|" + c));
            else {
              var e = Lc("PERSISTENT|");
              d = Wc(e, b);
            }
            else d = Qb(b);
          } catch (g) {
            return Promise.reject(g);
          }
          a.h = new Ug();
          var f = BC("generateKeyRequest");
          try {
            a.j[f](a.i, d);
          } catch (g) {
            if ("InvalidStateError" != g.name) return a.h = null, Promise.reject(g);
            new ec(function() {
              try {
                a.j[f](a.i, d);
              } catch (h) {
                a.h.reject(h), a.h = null;
              }
            }).da(0.01);
          }
          return a.h;
        }
        function IC(a, b, c) {
          if (a.g) a.g.then(function() {
            return IC(a, b, c);
          }).catch(function() {
            return IC(a, b, c);
          });
          else {
            a.g = b;
            if ("webkit-org.w3.clearkey" == a.i) {
              var d = Hc(c);
              var e = JSON.parse(d);
              "oct" != e.keys[0].kty && (a.g.reject(Error("Response is not a valid JSON Web Key Set.")), a.g = null);
              d = Tc(e.keys[0].k);
              e = Tc(e.keys[0].kid);
            } else d = Qb(c), e = null;
            var f = BC("addKey");
            try {
              a.j[f](a.i, d, e, a.sessionId);
            } catch (g) {
              a.g.reject(g), a.g = null;
            }
          }
        }
        function EC(a, b) {
          var c = a.keyStatuses;
          c.size = void 0 == b ? 0 : 1;
          c.g = b;
          b = new V("keystatuseschange");
          a.dispatchEvent(b);
        }
        r.generateRequest = function(a, b) {
          return HC(this, b, null);
        };
        r.load = function(a) {
          return "persistent-license" == this.l ? HC(this, null, a) : Promise.reject(Error("Not a persistent session."));
        };
        r.update = function(a) {
          var b = new Ug();
          IC(this, b, a);
          return b;
        };
        r.close = function() {
          if ("persistent-license" != this.l) {
            if (!this.sessionId) return this.closed.reject(Error("The session is not callable.")), this.closed;
            var a = BC("cancelKeyRequest");
            try {
              this.j[a](this.i, this.sessionId);
            } catch (b) {
            }
          }
          this.closed.resolve();
          return this.closed;
        };
        r.remove = function() {
          return "persistent-license" != this.l ? Promise.reject(Error("Not a persistent session.")) : this.close();
        };
        function GC() {
          this.size = 0;
          this.g = void 0;
        }
        r = GC.prototype;
        r.dc = function() {
          return this.g;
        };
        r.forEach = function(a) {
          this.g && a(this.g, bc.value());
        };
        r.get = function(a) {
          if (this.has(a)) return this.g;
        };
        r.has = function(a) {
          var b = bc.value();
          return this.g && Pb(a, b) ? true : false;
        };
        r.entries = function() {
        };
        r.keys = function() {
        };
        r.values = function() {
        };
        var vC = "", AC = "webkit";
        uB(uC);
        function JC() {
        }
        function KC() {
          if (window2.HTMLVideoElement) {
            var a = HTMLVideoElement.prototype;
            a.requestPictureInPicture && document.exitPictureInPicture || !a.webkitSupportsPresentationMode || (document.pictureInPictureEnabled = true, document.pictureInPictureElement = null, a.requestPictureInPicture = LC, Object.defineProperty(a, "disablePictureInPicture", { get: MC, set: NC, enumerable: true, configurable: true }), document.exitPictureInPicture = OC, document.addEventListener("webkitpresentationmodechanged", PC, true));
          }
        }
        function PC(a) {
          a = a.target;
          if ("picture-in-picture" == a.webkitPresentationMode) {
            document.pictureInPictureElement = a;
            var b = new Event("enterpictureinpicture");
            a.dispatchEvent(b);
          } else document.pictureInPictureElement == a && (document.pictureInPictureElement = null), b = new Event("leavepictureinpicture"), a.dispatchEvent(b);
        }
        function LC() {
          return this.webkitSupportsPresentationMode("picture-in-picture") ? (this.webkitSetPresentationMode("picture-in-picture"), document.pictureInPictureElement = this, Promise.resolve()) : Promise.reject(Error("PiP not allowed by video element"));
        }
        function OC() {
          var a = document.pictureInPictureElement;
          return a ? (a.webkitSetPresentationMode("inline"), document.pictureInPictureElement = null, Promise.resolve()) : Promise.reject(Error("No picture in picture element found"));
        }
        function MC() {
          return this.hasAttribute("disablePictureInPicture") ? true : !this.webkitSupportsPresentationMode("picture-in-picture");
        }
        function NC(a) {
          a ? this.setAttribute("disablePictureInPicture", "") : this.removeAttribute("disablePictureInPicture");
        }
        tB.PiPWebkit = JC;
        JC.install = KC;
        uB(KC);
        function QC() {
        }
        function RC() {
          window2.crypto && ("randomUUID" in window2.crypto || (window2.crypto.randomUUID = SC));
        }
        function SC() {
          var a = URL.createObjectURL(new Blob()), b = a.toString();
          URL.revokeObjectURL(a);
          return b.substr(b.lastIndexOf("/") + 1);
        }
        tB.RandomUUID = QC;
        QC.install = RC;
        uB(RC);
        function TC() {
        }
        function UC() {
          var a = Symbol.prototype;
          "description" in a || Object.defineProperty(a, "description", { get: VC });
        }
        function VC() {
          var a = /\((.*)\)/.exec(this.toString());
          return a ? a[1] : void 0;
        }
        tB.Symbol = TC;
        TC.install = UC;
        uB(UC);
        function WC() {
        }
        function XC() {
          if (window2.HTMLMediaElement) {
            var a = HTMLMediaElement.prototype.play;
            HTMLMediaElement.prototype.play = function() {
              var b = a.apply(this);
              b && b.catch(function() {
              });
              return b;
            };
          }
        }
        tB.VideoPlayPromise = WC;
        WC.install = XC;
        uB(XC);
        function YC() {
        }
        function ZC() {
          if (window2.HTMLVideoElement) {
            var a = HTMLVideoElement.prototype;
            !a.getVideoPlaybackQuality && ("webkitDroppedFrameCount" in a || oc()) && (a.getVideoPlaybackQuality = $C);
          }
        }
        function $C() {
          return { droppedVideoFrames: this.webkitDroppedFrameCount, totalVideoFrames: this.webkitDecodedFrameCount, corruptedVideoFrames: 0, creationTime: NaN, totalFrameDelay: 0 };
        }
        tB.VideoPlaybackQuality = YC;
        YC.install = ZC;
        uB(ZC);
        function aD() {
        }
        function bD() {
          if (!window2.VTTCue && window2.TextTrackCue) {
            var a = null, b = TextTrackCue.length;
            if (3 == b) a = cD;
            else if (6 == b) a = dD;
            else {
              try {
                var c = !!cD(1, 2, "");
              } catch (d) {
                c = false;
              }
              c && (a = cD);
            }
            a && (window2.VTTCue = function(d, e, f) {
              return a(d, e, f);
            });
          }
        }
        function cD(a, b, c) {
          return new window2.TextTrackCue(a, b, c);
        }
        function dD(a, b, c) {
          return new window2.TextTrackCue(a + "-" + b + "-" + c, a, b, c);
        }
        tB.VTTCue = aD;
        aD.install = bD;
        uB(bD);
        function eD() {
        }
        eD.prototype.parseInit = function() {
        };
        eD.prototype.setSequenceMode = function() {
        };
        eD.prototype.setManifestType = function() {
        };
        eD.prototype.parseMedia = function(a, b) {
          var c = null, d = [];
          a = Hc(a).split(/\r?\n/);
          a = t(a);
          for (var e = a.next(); !e.done; e = a.next()) if ((e = e.value) && !/^\s+$/.test(e) && (e = fD.exec(e))) {
            var f = gD.exec(e[1]);
            f = 60 * parseInt(f[1], 10) + parseFloat(f[2].replace(",", "."));
            e = new Ae(f, b.segmentEnd ? b.segmentEnd : f + 2, e[2]);
            c && (c.endTime = f, d.push(c));
            c = e;
          }
          c && d.push(c);
          return d;
        };
        T("shaka.text.LrcTextParser", eD);
        eD.prototype.parseMedia = eD.prototype.parseMedia;
        eD.prototype.setManifestType = eD.prototype.setManifestType;
        eD.prototype.setSequenceMode = eD.prototype.setSequenceMode;
        eD.prototype.parseInit = eD.prototype.parseInit;
        var fD = /^\[(\d{1,2}:\d{1,2}(?:[.,]\d{1,3})?)\](.*)/, gD = /^(\d+):(\d{1,2}(?:[.,]\d{1,3})?)$/;
        zf("application/x-subtitle-lrc", function() {
          return new eD();
        });
        function hD() {
        }
        hD.prototype.parseInit = function() {
        };
        hD.prototype.setSequenceMode = function() {
        };
        hD.prototype.setManifestType = function() {
        };
        hD.prototype.parseMedia = function(a, b, c, d) {
          var e = Hc(a);
          a = [];
          if ("" == e) return a;
          var f = Rd(e, "tt", true);
          if (!f) throw new U(2, 2, 2005, "Failed to parse TTML.");
          e = ae(f, "body")[0];
          if (!e) return [];
          var g = je(f, iD, "frameRate"), h = je(f, iD, "subFrameRate"), k2 = je(f, iD, "frameRateMultiplier"), l = je(f, iD, "tickRate"), m = je(f, iD, "cellResolution"), n = f.attributes["xml:space"] || "default", p = je(f, jD, "extent");
          if ("default" != n && "preserve" != n) throw new U(2, 2, 2005, "Invalid xml:space value: " + n);
          n = "default" == n;
          g = new kD(g, h, k2, l);
          m = lD(m);
          h = ae(f, "metadata")[0];
          h = (h ? h.children : []).filter(function(w) {
            return "\n" != w;
          });
          k2 = ae(f, "style");
          f = ae(f, "region");
          l = [];
          for (var q = t(f), u = q.next(); !u.done; u = q.next()) (u = mD(u.value, k2, p)) && l.push(u);
          if (Yd(e, "p").length) throw new U(2, 2, 2001, "<p> can only be inside <div> in TTML");
          p = t(Yd(e, "div"));
          for (q = p.next(); !q.done; q = p.next()) if (Yd(q.value, "span").length) throw new U(2, 2, 2001, "<span> can only be inside <p> in TTML");
          if (b = nD(e, b, g, h, k2, f, l, n, m, null, false, c, d)) b.backgroundColor || (b.backgroundColor = "transparent"), a.push(b);
          return a;
        };
        function nD(a, b, c, d, e, f, g, h, k2, l, m, n, p) {
          var q = l;
          if (Wd(a)) {
            if (!m) return null;
            var u = { tagName: "span", children: [Zd(a)], attributes: {}, parent: null };
          } else u = a;
          for (var w = null, v = t(oD), x = v.next(); !x.done && !(w = pD(u, "backgroundImage", d, "#", x.value)[0]); x = v.next()) ;
          v = null;
          x = je(u, oD, "backgroundImage");
          var z = /^(urn:)(mpeg:[a-z0-9][a-z0-9-]{0,31}:)(subs:)([0-9]+)$/;
          if (x && z.test(x)) {
            v = parseInt(x.split(":").pop(), 10) - 1;
            if (v >= p.length) return null;
            v = p[v];
          } else n && x && !x.startsWith("#") && (z = new yb(n), x = new yb(x), (x = z.resolve(x).toString()) && (v = x));
          if ("p" == a.tagName || w || v) m = true;
          a = m;
          x = "default" == (u.attributes["xml:space"] || (h ? "default" : "preserve"));
          z = u.children.every(Wd);
          h = [];
          if (!z) for (var C = t(u.children), D = C.next(); !D.done; D = C.next()) (D = nD(D.value, b, c, d, e, f, g, x, k2, u, m, n, p)) && h.push(D);
          d = null != l;
          n = Zd(u);
          n = u.children.length && n && /\S/.test(n);
          C = u.attributes.begin || u.attributes.end || u.attributes.dur;
          if (!(C || n || "br" == u.tagName || 0 != h.length || d && !x)) return null;
          p = qD(u, c);
          n = p.start;
          for (p = p.end; q && q.tagName && "tt" != q.tagName; ) p = rD(q, c, n, p), n = p.start, p = p.end, q = q.parent;
          null == n && (n = 0);
          n += b.periodStart;
          p = null == p ? Infinity : p + b.periodStart;
          n = Math.max(n, b.segmentStart);
          p = Math.min(p, b.segmentEnd);
          if (!C && 0 < h.length) for (n = Infinity, p = 0, b = t(h), c = b.next(); !c.done; c = b.next()) c = c.value, n = Math.min(n, c.startTime), p = Math.max(p, c.endTime);
          if ("br" == u.tagName) return e = new Ae(n, p, ""), e.lineBreak = true, e;
          b = "";
          z && (b = Pc(Zd(u) || ""), x && (b = b.replace(/\s+/g, " ")));
          b = new Ae(n, p, b);
          b.nestedCues = h;
          m || (b.isContainer = true);
          k2 && (b.cellResolution = k2);
          k2 = pD(u, "region", f, "")[0];
          if (u.attributes.region && k2 && k2.attributes["xml:id"]) {
            var G = k2.attributes["xml:id"];
            b.region = g.filter(function(B) {
              return B.id == G;
            })[0];
          }
          g = k2;
          l && d && !u.attributes.region && !u.attributes.style && (g = pD(l, "region", f, "")[0]);
          sD(b, u, g, w, v, e, a, 0 == h.length);
          return b;
        }
        function mD(a, b, c) {
          var d = new yd(), e = a.attributes["xml:id"];
          if (!e) return null;
          d.id = e;
          e = null;
          c && (e = tD.exec(c) || uD.exec(c));
          c = e ? Number(e[1]) : null;
          e = e ? Number(e[2]) : null;
          var f, g = vD(a, b, "extent");
          if (g) {
            var h = (f = tD.exec(g)) || uD.exec(g);
            null != h && (d.width = Number(h[1]), d.height = Number(h[2]), f || (null != c && (d.width = 100 * d.width / c), null != e && (d.height = 100 * d.height / e)), d.widthUnits = f || null != c ? zd : 0, d.heightUnits = f || null != e ? zd : 0);
          }
          if (a = vD(a, b, "origin")) {
            if (h = (f = tD.exec(a)) || uD.exec(a), null != h) d.viewportAnchorX = Number(h[1]), d.viewportAnchorY = Number(h[2]), f ? g || (d.width = 100 - d.viewportAnchorX, d.widthUnits = zd, d.height = 100 - d.viewportAnchorY, d.heightUnits = zd) : (null != e && (d.viewportAnchorY = 100 * d.viewportAnchorY / e), null != c && (d.viewportAnchorX = 100 * d.viewportAnchorX / c)), d.viewportAnchorUnits = f || null != c ? zd : 0;
          }
          return d;
        }
        function wD(a) {
          var b = a.match(/rgba\(([^)]+)\)/);
          return b && (b = b[1].split(","), 4 == b.length) ? (b[3] = String(Number(b[3]) / 255), "rgba(" + b.join(",") + ")") : a;
        }
        function sD(a, b, c, d, e, f, g, h) {
          g = g || h;
          "rtl" == xD(b, c, f, "direction", g) && (a.direction = "rtl");
          h = xD(b, c, f, "writingMode", g);
          "tb" == h || "tblr" == h ? a.writingMode = "vertical-lr" : "tbrl" == h ? a.writingMode = "vertical-rl" : "rltb" == h || "rl" == h ? a.direction = "rtl" : h && (a.direction = De);
          (h = xD(b, c, f, "textAlign", true)) ? (a.positionAlign = yD.get(h), a.lineAlign = zD.get(h), a.textAlign = Ye[h.toUpperCase()]) : a.textAlign = Ce;
          if (h = xD(b, c, f, "displayAlign", true)) a.displayAlign = Ze[h.toUpperCase()];
          if (h = xD(b, c, f, "color", g)) a.color = wD(h);
          if (h = xD(
            b,
            c,
            f,
            "backgroundColor",
            g
          )) a.backgroundColor = wD(h);
          if (h = xD(b, c, f, "border", g)) a.border = h;
          if (h = xD(b, c, f, "fontFamily", g)) switch (h) {
            case "monospaceSerif":
              a.fontFamily = "Courier New,Liberation Mono,Courier,monospace";
              break;
            case "proportionalSansSerif":
              a.fontFamily = "Arial,Helvetica,Liberation Sans,sans-serif";
              break;
            case "sansSerif":
              a.fontFamily = "sans-serif";
              break;
            case "monospaceSansSerif":
              a.fontFamily = "Consolas,monospace";
              break;
            case "proportionalSerif":
              a.fontFamily = "serif";
              break;
            default:
              a.fontFamily = h.split(",").filter(function(k2) {
                return "default" != k2;
              }).join(",");
          }
          (h = xD(b, c, f, "fontWeight", g)) && "bold" == h && (a.fontWeight = Ve);
          h = xD(b, c, f, "wrapOption", g);
          a.wrapLine = h && "noWrap" == h ? false : true;
          (h = xD(b, c, f, "lineHeight", g)) && h.match(AD) && (a.lineHeight = h);
          (h = xD(b, c, f, "fontSize", g)) && (h.match(AD) || h.match(BD)) && (a.fontSize = h);
          if (h = xD(b, c, f, "fontStyle", g)) a.fontStyle = af[h.toUpperCase()];
          d ? (e = d.attributes.imageType || d.attributes.imagetype, h = d.attributes.encoding, d = Zd(d).trim(), "PNG" == e && "Base64" == h && d && (a.backgroundImage = "data:image/png;base64," + d)) : e && (a.backgroundImage = e);
          if (d = xD(b, c, f, "textOutline", g)) d = d.split(" "), d[0].match(AD) ? a.textStrokeColor = a.color : (a.textStrokeColor = wD(d[0]), d.shift()), d[0] && d[0].match(AD) ? a.textStrokeWidth = d[0] : a.textStrokeColor = "";
          (d = xD(b, c, f, "letterSpacing", g)) && d.match(AD) && (a.letterSpacing = d);
          (d = xD(b, c, f, "linePadding", g)) && d.match(AD) && (a.linePadding = d);
          if (d = xD(b, c, f, "opacity", g)) a.opacity = parseFloat(d);
          (d = vD(c, f, "textDecoration")) && CD(a, d);
          (d = DD(b, f, "textDecoration")) && CD(a, d);
          if (d = xD(b, c, f, "textCombine", g)) a.textCombineUpright = d;
          switch (xD(b, c, f, "ruby", g)) {
            case "container":
              a.rubyTag = "ruby";
              break;
            case "text":
              a.rubyTag = "rt";
          }
        }
        function CD(a, b) {
          b = t(b.split(" "));
          for (var c = b.next(); !c.done; c = b.next()) switch (c.value) {
            case "underline":
              a.textDecoration.includes(Xe) || a.textDecoration.push(Xe);
              break;
            case "noUnderline":
              a.textDecoration.includes(Xe) && Cd(a.textDecoration, Xe);
              break;
            case "lineThrough":
              a.textDecoration.includes("lineThrough") || a.textDecoration.push("lineThrough");
              break;
            case "noLineThrough":
              a.textDecoration.includes("lineThrough") && Cd(a.textDecoration, "lineThrough");
              break;
            case "overline":
              a.textDecoration.includes("overline") || a.textDecoration.push("overline");
              break;
            case "noOverline":
              a.textDecoration.includes("overline") && Cd(a.textDecoration, "overline");
          }
        }
        function xD(a, b, c, d, e) {
          e = void 0 === e ? true : e;
          return (a = DD(a, c, d)) ? a : e ? vD(b, c, d) : null;
        }
        function vD(a, b, c) {
          if (!a) return null;
          var d = je(a, jD, c);
          return d ? d : ED(a, b, c);
        }
        function DD(a, b, c) {
          var d = je(a, jD, c);
          return d ? d : ED(a, b, c);
        }
        function ED(a, b, c) {
          a = pD(a, "style", b, "");
          for (var d = null, e = 0; e < a.length; e++) {
            var f = ie(a[e], "urn:ebu:tt:style", c);
            f || (f = je(a[e], jD, c));
            f || (f = DD(a[e], b, c));
            f && (d = f);
          }
          return d;
        }
        function pD(a, b, c, d, e) {
          var f = [];
          if (!a || 1 > c.length) return f;
          var g = a;
          for (a = null; !a && !(a = e ? ie(g, e, b) : g.attributes[b]) && (g = g.parent, g); ) ;
          if (b = a) {
            for (b = t(b.split(" ")), e = b.next(); !e.done; e = b.next()) for (e = e.value, a = t(c), g = a.next(); !g.done; g = a.next()) if (g = g.value, d + g.attributes["xml:id"] == e) {
              f.push(g);
              break;
            }
          }
          return f;
        }
        function rD(a, b, c, d) {
          a = qD(a, b);
          null == c ? c = a.start : null != a.start && (c += a.start);
          null == d ? d = a.end : null != a.start && (d += a.start);
          return { start: c, end: d };
        }
        function qD(a, b) {
          var c = FD(a.attributes.begin, b), d = FD(a.attributes.end, b);
          a = FD(a.attributes.dur, b);
          null == d && null != a && (d = c + a);
          return { start: c, end: d };
        }
        function FD(a, b) {
          var c = null;
          if (GD.test(a)) {
            a = GD.exec(a);
            c = Number(a[1]);
            var d = Number(a[2]), e = Number(a[3]), f = Number(a[4]);
            f += (Number(a[5]) || 0) / b.h;
            e += f / b.frameRate;
            c = e + 60 * d + 3600 * c;
          } else if (HD.test(a)) c = ID(HD, a);
          else if (JD.test(a)) c = ID(JD, a);
          else if (KD.test(a)) a = KD.exec(a), c = Number(a[1]) / b.frameRate;
          else if (LD.test(a)) a = LD.exec(a), c = Number(a[1]) / b.g;
          else if (MD.test(a)) c = ID(MD, a);
          else if (a) throw new U(2, 2, 2001, "Could not parse cue time range in TTML");
          return c;
        }
        function ID(a, b) {
          a = a.exec(b);
          return null == a || "" == a[0] ? null : (Number(a[4]) || 0) / 1e3 + (Number(a[3]) || 0) + 60 * (Number(a[2]) || 0) + 3600 * (Number(a[1]) || 0);
        }
        function lD(a) {
          return a ? (a = /^(\d+) (\d+)$/.exec(a)) ? { oc: parseInt(a[1], 10), rows: parseInt(a[2], 10) } : null : null;
        }
        T("shaka.text.TtmlTextParser", hD);
        hD.prototype.parseMedia = hD.prototype.parseMedia;
        hD.prototype.setManifestType = hD.prototype.setManifestType;
        hD.prototype.setSequenceMode = hD.prototype.setSequenceMode;
        hD.prototype.parseInit = hD.prototype.parseInit;
        function kD(a, b, c, d) {
          this.frameRate = Number(a) || 30;
          this.h = Number(b) || 1;
          this.g = Number(d);
          0 == this.g && (this.g = a ? this.frameRate * this.h : 1);
          c && (a = /^(\d+) (\d+)$/g.exec(c)) && (this.frameRate *= Number(a[1]) / Number(a[2]));
        }
        var tD = /^(\d{1,2}(?:\.\d+)?|100(?:\.0+)?)% (\d{1,2}(?:\.\d+)?|100(?:\.0+)?)%$/, BD = /^(\d{1,4}(?:\.\d+)?|100)%$/, AD = /^(\d+px|\d+em|\d*\.?\d+c)$/, uD = /^(\d+)px (\d+)px$/, GD = /^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/, HD = /^(?:(\d{2,}):)?(\d{2}):(\d{2})$/, JD = /^(?:(\d{2,}):)?(\d{2}):(\d{2}\.\d+)$/, KD = /^(\d*(?:\.\d*)?)f$/, LD = /^(\d*(?:\.\d*)?)t$/, MD = RegExp("^(?:(\\d*(?:\\.\\d*)?)h)?(?:(\\d*(?:\\.\\d*)?)m)?(?:(\\d*(?:\\.\\d*)?)s)?(?:(\\d*(?:\\.\\d*)?)ms)?$"), zD = (/* @__PURE__ */ new Map()).set("left", Ge).set("center", "center").set(
          "right",
          "end"
        ).set("start", Ge).set("end", "end"), yD = (/* @__PURE__ */ new Map()).set("left", "line-left").set("center", "center").set("right", "line-right"), iD = ["http://www.w3.org/ns/ttml#parameter", "http://www.w3.org/2006/10/ttaf1#parameter"], jD = ["http://www.w3.org/ns/ttml#styling", "http://www.w3.org/2006/10/ttaf1#styling"], oD = ["http://www.smpte-ra.org/schemas/2052-1/2010/smpte-tt", "http://www.smpte-ra.org/schemas/2052-1/2013/smpte-tt"];
        zf("application/ttml+xml", function() {
          return new hD();
        });
        function ND() {
          this.g = new hD();
        }
        ND.prototype.parseInit = function(a) {
          var b = false;
          new Fh().box("moov", Kh).box("trak", Kh).box("mdia", Kh).box("minf", Kh).box("stbl", Kh).R("stsd", Mh).box("stpp", function(c) {
            b = true;
            c.parser.stop();
          }).parse(a);
          if (!b) throw new U(2, 2, 2007);
        };
        ND.prototype.setSequenceMode = function() {
        };
        ND.prototype.setManifestType = function() {
        };
        ND.prototype.parseMedia = function(a, b, c) {
          var d = [], e = null, f = [], g = /* @__PURE__ */ new Map(), h = [];
          new Fh().box("moof", Kh).box("traf", Kh).R("tfhd", function(x) {
            e = Wi(x.reader, x.flags).md;
          }).R("trun", function(x) {
            x = Zi(x.reader, x.version, x.flags);
            x = t(x.fg);
            for (var z = x.next(); !z.done; z = x.next()) h.push(z.value.sampleSize || e || 0);
          }).R("subs", function(x) {
            for (var z = x.reader, C = z.S(), D = -1, G = 0; G < C; G++) {
              var B = z.S();
              D += B;
              B = z.na();
              for (var A = [], H = 0; H < B; H++) 1 == x.version ? A.push(z.S()) : A.push(z.na()), z.X(), z.X(), z.S();
              g.set(D, A);
            }
          }).box(
            "mdat",
            Ph(function(x) {
              f.push(x);
            })
          ).parse(a, false);
          if (0 == f.length) throw new U(2, 2, 2007);
          for (var k2 = Wc.apply(Qc, y(f)), l = 0, m = 0; m < h.length; m++) {
            var n = Qb(k2, l, h[m]);
            l += h[m];
            var p = g.get(m);
            if (p && p.length) {
              n = Qb(n, 0, p[0]);
              for (var q = [], u = p[0], w = 1; w < p.length; w++) {
                var v = Qb(a, u, p[w]);
                v = Rc(v);
                q.push("data:image/png;base64," + v);
                u += p[w];
              }
              d = d.concat(this.g.parseMedia(n, b, c, q));
            } else d = d.concat(this.g.parseMedia(n, b, c, []));
          }
          return d;
        };
        T("shaka.text.Mp4TtmlParser", ND);
        ND.prototype.parseMedia = ND.prototype.parseMedia;
        ND.prototype.setManifestType = ND.prototype.setManifestType;
        ND.prototype.setSequenceMode = ND.prototype.setSequenceMode;
        ND.prototype.parseInit = ND.prototype.parseInit;
        zf('application/mp4; codecs="stpp"', function() {
          return new ND();
        });
        zf('application/mp4; codecs="stpp.ttml"', function() {
          return new ND();
        });
        zf('application/mp4; codecs="stpp.ttml.im1i"', function() {
          return new ND();
        });
        zf('application/mp4; codecs="stpp.ttml.im1t"', function() {
          return new ND();
        });
        zf('application/mp4; codecs="stpp.ttml.im2i"', function() {
          return new ND();
        });
        zf('application/mp4; codecs="stpp.ttml.im2t"', function() {
          return new ND();
        });
        zf('application/mp4; codecs="stpp.ttml.etd1"', function() {
          return new ND();
        });
        zf('application/mp4; codecs="stpp.ttml.etd1|im1t"', function() {
          return new ND();
        });
        zf('application/mp4; codecs="stpp.ttml.im1t|etd1"', function() {
          return new ND();
        });
        zf('application/mp4; codecs="stpp.TTML.im1t"', function() {
          return new ND();
        });
        function OD() {
          this.g = "UNKNOWN";
        }
        OD.prototype.parseInit = function() {
        };
        OD.prototype.setSequenceMode = function() {
        };
        OD.prototype.setManifestType = function(a) {
          this.g = a;
        };
        OD.prototype.parseMedia = function(a, b) {
          a = Hc(a);
          a = a.replace(/\r\n|\r(?=[^\n]|$)/gm, "\n");
          var c = a.split(/\n{2,}/m);
          if (!/^WEBVTT($|[ \t\n])/m.test(c[0])) throw new U(2, 2, 2e3);
          a = b.vttOffset;
          if ("HLS" == this.g) if (c[0].includes("X-TIMESTAMP-MAP")) {
            var d = c[0];
            a = d.match(/LOCAL:((?:(\d{1,}):)?(\d{2}):(\d{2})\.(\d{3}))/m);
            d = d.match(/MPEGTS:(\d+)/m);
            if (!a || !d) throw new U(2, 2, 2e3);
            a = Md(a[1]);
            if (null == a) throw new U(2, 2, 2e3);
            d = Number(d[1]);
            for (var e = b.segmentStart - b.periodStart; 95443.7176888889 <= e; ) e -= 95443.7176888889, d += 8589934592;
            a = b.periodStart + d / 9e4 - a;
          } else b.periodStart && b.vttOffset == b.periodStart && (a = 0);
          b = [];
          d = t(c[0].split("\n"));
          for (e = d.next(); !e.done; e = d.next()) if (e = e.value, /^Region:/.test(e)) {
            e = new Fd(e);
            var f = new yd();
            Id(e);
            Gd(e);
            for (var g = Id(e); g; ) {
              var h = f, k2 = g;
              (g = /^id=(.*)$/.exec(k2)) ? h.id = g[1] : (g = /^width=(\d{1,2}|100)%$/.exec(k2)) ? h.width = Number(g[1]) : (g = /^lines=(\d+)$/.exec(k2)) ? (h.height = Number(g[1]), h.heightUnits = 2) : (g = /^regionanchor=(\d{1,2}|100)%,(\d{1,2}|100)%$/.exec(k2)) ? (h.regionAnchorX = Number(g[1]), h.regionAnchorY = Number(g[2])) : (g = /^viewportanchor=(\d{1,2}|100)%,(\d{1,2}|100)%$/.exec(k2)) ? (h.viewportAnchorX = Number(g[1]), h.viewportAnchorY = Number(g[2])) : /^scroll=up$/.exec(k2) && (h.scroll = "up");
              Gd(e);
              g = Id(e);
            }
            b.push(f);
          }
          d = /* @__PURE__ */ new Map();
          Ne(d);
          e = [];
          c = t(c.slice(1));
          for (f = c.next(); !f.done; f = c.next()) {
            f = f.value.split("\n");
            if ((1 != f.length || f[0]) && !/^NOTE($|[ \t])/.test(f[0]) && "STYLE" == f[0]) {
              h = [];
              g = -1;
              for (k2 = 1; k2 < f.length; k2++) f[k2].includes("::cue") && (h.push([]), g = h.length - 1), -1 != g && (h[g].push(f[k2]), f[k2].includes("}") && (g = -1));
              h = t(h);
              for (g = h.next(); !g.done; g = h.next()) {
                var l = g.value;
                g = "global";
                (k2 = l[0].match(/\((.*)\)/)) && (g = k2.pop());
                k2 = l.slice(1, -1);
                l[0].includes("}") && (l = /\{(.*?)\}/.exec(l[0])) && (k2 = l[1].split(";"));
                (l = d.get(g)) || (l = new Ae(0, 0, ""));
                for (var m = false, n = 0; n < k2.length; n++) {
                  var p = /^\s*([^:]+):\s*(.*)/.exec(k2[n]);
                  if (p) {
                    var q = p[2].trim().replace(";", "");
                    switch (p[1].trim()) {
                      case "background-color":
                      case "background":
                        m = true;
                        l.backgroundColor = q;
                        break;
                      case "color":
                        m = true;
                        l.color = q;
                        break;
                      case "font-family":
                        m = true;
                        l.fontFamily = q;
                        break;
                      case "font-size":
                        m = true;
                        l.fontSize = q;
                        break;
                      case "font-weight":
                        if (700 <= parseInt(q, 10) || "bold" == q) m = true, l.fontWeight = Ve;
                        break;
                      case "font-style":
                        switch (q) {
                          case "normal":
                            m = true;
                            l.fontStyle = Je;
                            break;
                          case "italic":
                            m = true;
                            l.fontStyle = We;
                            break;
                          case "oblique":
                            m = true, l.fontStyle = "oblique";
                        }
                        break;
                      case "opacity":
                        m = true;
                        l.opacity = parseFloat(q);
                        break;
                      case "text-combine-upright":
                        m = true;
                        l.textCombineUpright = q;
                        break;
                      case "text-shadow":
                        m = true;
                        l.textShadow = q;
                        break;
                      case "white-space":
                        m = true, l.wrapLine = "noWrap" != q;
                    }
                  }
                }
                m && d.set(
                  g,
                  l
                );
              }
            }
            l = f;
            m = a;
            if (1 == l.length && !l[0] || /^NOTE($|[ \t])/.test(l[0]) || "STYLE" == l[0] || "REGION" == l[0]) f = null;
            else if (f = null, l[0].includes("-->") || (f = l[0], l.splice(0, 1)), h = new Fd(l[0]), g = Kd(h), n = Hd(h, /[ \t]+--\x3e[ \t]+/g), k2 = Kd(h), null == g || null == n || null == k2) bb("Failed to parse VTT time code. Cue skipped:", f, l), f = null;
            else {
              g += m;
              k2 += m;
              m = l.slice(1).join("\n").trim();
              d.has("global") ? (l = d.get("global").clone(), l.startTime = g, l.endTime = k2, l.payload = m) : l = new Ae(g, k2, m);
              Gd(h);
              for (g = Id(h); g; ) PD(l, g, b), Gd(h), g = Id(h);
              Me(l, d);
              null != f && (l.id = f);
              f = l;
            }
            f && e.push(f);
          }
          return e;
        };
        function PD(a, b, c) {
          var d;
          if (d = /^align:(start|middle|center|end|left|right)$/.exec(b)) b = d[1], "middle" == b ? a.textAlign = Ce : a.textAlign = Ye[b.toUpperCase()];
          else if (d = /^vertical:(lr|rl)$/.exec(b)) a.writingMode = "lr" == d[1] ? "vertical-lr" : "vertical-rl";
          else if (d = /^size:([\d.]+)%$/.exec(b)) a.size = Number(d[1]);
          else if (d = /^position:([\d.]+)%(?:,(line-left|line-right|middle|center|start|end|auto))?$/.exec(b)) a.position = Number(d[1]), d[2] && (b = d[2], a.positionAlign = "line-left" == b || "start" == b ? "line-left" : "line-right" == b || "end" == b ? "line-right" : "center" == b || "middle" == b ? "center" : Be);
          else if (d = /^region:(.*)$/.exec(b)) {
            if (b = QD(c, d[1])) a.region = b;
          } else if (c = /^line:([\d.]+)%(?:,(start|end|center))?$/.exec(b)) a.lineInterpretation = 1, a.line = Number(c[1]), c[2] && (a.lineAlign = $e[c[2].toUpperCase()]);
          else if (c = /^line:(-?\d+)(?:,(start|end|center))?$/.exec(b)) a.lineInterpretation = Fe, a.line = Number(c[1]), c[2] && (a.lineAlign = $e[c[2].toUpperCase()]);
        }
        function QD(a, b) {
          a = a.filter(function(c) {
            return c.id == b;
          });
          return a.length ? a[0] : null;
        }
        T("shaka.text.VttTextParser", OD);
        OD.prototype.parseMedia = OD.prototype.parseMedia;
        OD.prototype.setManifestType = OD.prototype.setManifestType;
        OD.prototype.setSequenceMode = OD.prototype.setSequenceMode;
        OD.prototype.parseInit = OD.prototype.parseInit;
        zf("text/vtt", function() {
          return new OD();
        });
        zf('text/vtt; codecs="vtt"', function() {
          return new OD();
        });
        zf('text/vtt; codecs="wvtt"', function() {
          return new OD();
        });
        function RD() {
          this.g = null;
        }
        RD.prototype.parseInit = function(a) {
          var b = this, c = false;
          new Fh().box("moov", Kh).box("trak", Kh).box("mdia", Kh).R("mdhd", function(d) {
            d = Yi(d.reader, d.version);
            b.g = d.timescale;
          }).box("minf", Kh).box("stbl", Kh).R("stsd", Mh).box("wvtt", function() {
            c = true;
          }).parse(a);
          if (!this.g) throw new U(2, 2, 2008);
          if (!c) throw new U(2, 2, 2008);
        };
        RD.prototype.setSequenceMode = function() {
        };
        RD.prototype.setManifestType = function() {
        };
        RD.prototype.parseMedia = function(a, b) {
          if (!a.length) return [];
          if (!this.g) throw new U(2, 2, 2008);
          var c = 0, d = [], e, f = [], g = false, h = false, k2 = false, l = null;
          new Fh().box("moof", Kh).box("traf", Kh).R("tfdt", function(C) {
            g = true;
            c = Xi(C.reader, C.version).baseMediaDecodeTime;
          }).R("tfhd", function(C) {
            l = Wi(C.reader, C.flags).ld;
          }).R("trun", function(C) {
            h = true;
            d = Zi(C.reader, C.version, C.flags).fg;
          }).box("mdat", Ph(function(C) {
            k2 = true;
            e = C;
          })).parse(a, false);
          if (!k2 && !g && !h) throw new U(2, 2, 2008);
          a = c;
          for (var m = new Ch(e, 0), n = t(d), p = n.next(); !p.done; p = n.next()) {
            p = p.value;
            var q = p.gg || l, u = p.ye ? c + p.ye : a;
            a = u + (q || 0);
            var w = 0;
            do {
              var v = m.S();
              w += v;
              var x = m.S(), z = null;
              "vttc" == Jh(x) ? 8 < v && (z = m.Cb(v - 8)) : m.skip(v - 8);
              q && z && (v = SD(z, b.periodStart + u / this.g, b.periodStart + a / this.g), f.push(v));
            } while (p.sampleSize && w < p.sampleSize);
          }
          return f.filter(Kf);
        };
        function SD(a, b, c) {
          var d, e, f;
          new Fh().box("payl", Ph(function(g) {
            d = Hc(g);
          })).box("iden", Ph(function(g) {
            e = Hc(g);
          })).box("sttg", Ph(function(g) {
            f = Hc(g);
          })).parse(a);
          return d ? TD(d, e, f, b, c) : null;
        }
        function TD(a, b, c, d, e) {
          a = new Ae(d, e, a);
          Me(a);
          b && (a.id = b);
          if (c) for (b = new Fd(c), c = Id(b); c; ) PD(a, c, []), Gd(b), c = Id(b);
          return a;
        }
        T("shaka.text.Mp4VttParser", RD);
        RD.prototype.parseMedia = RD.prototype.parseMedia;
        RD.prototype.setManifestType = RD.prototype.setManifestType;
        RD.prototype.setSequenceMode = RD.prototype.setSequenceMode;
        RD.prototype.parseInit = RD.prototype.parseInit;
        zf('application/mp4; codecs="wvtt"', function() {
          return new RD();
        });
        function UD() {
        }
        UD.prototype.parseInit = function() {
        };
        UD.prototype.setSequenceMode = function() {
        };
        UD.prototype.setManifestType = function() {
        };
        UD.prototype.parseMedia = function(a) {
          var b = Hc(a).replace(/\r+/g, "");
          b = b.trim();
          a = [];
          if ("" == b) return a;
          b = t(b.split("\n\n"));
          for (var c = b.next(); !c.done; c = b.next()) {
            c = c.value.split("\n");
            var d = new Fd(c[0]), e = Kd(d), f = Hd(d, /,/g);
            d = Kd(d);
            if (null == e || null == f || null == d) throw new U(2, 2, 2001, "Could not parse cue time range in SubViewer");
            a.push(new Ae(e, d, c.slice(1).join("\n").trim()));
          }
          return a;
        };
        T("shaka.text.SbvTextParser", UD);
        UD.prototype.parseMedia = UD.prototype.parseMedia;
        UD.prototype.setManifestType = UD.prototype.setManifestType;
        UD.prototype.setSequenceMode = UD.prototype.setSequenceMode;
        UD.prototype.parseInit = UD.prototype.parseInit;
        zf("text/x-subviewer", function() {
          return new UD();
        });
        function VD() {
          this.g = new OD();
        }
        VD.prototype.parseInit = function() {
        };
        VD.prototype.setSequenceMode = function() {
        };
        VD.prototype.setManifestType = function() {
        };
        VD.prototype.parseMedia = function(a, b, c) {
          a = Hc(a);
          a = WD(a);
          a = Qb(Lc(a));
          return this.g.parseMedia(a, b, c, []);
        };
        function WD(a) {
          var b = "WEBVTT\n\n";
          if ("" == a) return b;
          a = a.replace(/\r+/g, "");
          a = a.trim();
          a = t(a.split("\n\n"));
          for (var c = a.next(); !c.done; c = a.next()) c = c.value.split(/\n/), c[0].match(/\d+/) && c.shift(), c[0] = c[0].replace(/,/g, "."), b += c.join("\n").replace(/{b}/g, "<b>").replace(/{\/b}/g, "</b>").replace(/{i}/g, "<i>").replace(/{\/i}/g, "</i>").replace(/{u}/g, "<u>").replace(/{\/u}/g, "</u>") + "\n\n";
          return b;
        }
        T("shaka.text.SrtTextParser", VD);
        VD.srt2webvtt = WD;
        VD.prototype.parseMedia = VD.prototype.parseMedia;
        VD.prototype.setManifestType = VD.prototype.setManifestType;
        VD.prototype.setSequenceMode = VD.prototype.setSequenceMode;
        VD.prototype.parseInit = VD.prototype.parseInit;
        zf("text/srt", function() {
          return new VD();
        });
        function XD() {
        }
        XD.prototype.parseInit = function() {
        };
        XD.prototype.setSequenceMode = function() {
        };
        XD.prototype.setManifestType = function() {
        };
        XD.prototype.parseMedia = function(a) {
          var b = "", c = "", d = null, e = null;
          e = Hc(a).split(/\r?\n\s*\r?\n/);
          a = t(e);
          for (e = a.next(); !e.done; e = a.next()) {
            var f = e.value;
            e = f;
            if (f = YD.exec(f)) d = f[1], e = f[2];
            "V4 Styles" == d || "V4+ Styles" == d ? (b = e, b = c ? b + ("\n" + e) : e) : "Events" == d && (c = c ? c + ("\n" + e) : e);
          }
          d = [];
          e = null;
          b = t(b.split(/\r?\n/));
          for (a = b.next(); !a.done; a = b.next()) if (a = a.value, !/^\s*;/.test(a) && (f = ZD.exec(a))) {
            if (a = f[1].trim(), f = f[2].trim(), "Format" == a) e = f.split($D);
            else if ("Style" == a) {
              a = f.split($D);
              f = {};
              for (var g = 0; g < e.length && g < a.length; g++) f[e[g]] = a[g];
              d.push(f);
            }
          }
          e = [];
          b = null;
          c = t(c.split(/\r?\n/));
          f = c.next();
          for (a = {}; !f.done; a = { Dh: void 0 }, f = c.next()) if (f = f.value, !/^\s*;/.test(f) && (g = ZD.exec(f))) {
            if (f = g[1].trim(), g = g[2].trim(), "Format" == f) b = g.split($D);
            else if ("Dialogue" == f) {
              g = g.split($D);
              f = {};
              for (var h = 0; h < b.length && h < g.length; h++) f[b[h]] = g[h];
              h = aE(f.Start);
              var k2 = aE(f.End);
              g = new Ae(h, k2, g.slice(b.length - 1).join(",").replace(/\\N/g, "\n").replace(/\{[^}]+\}/g, ""));
              a.Dh = f.Style;
              (a = d.find(/* @__PURE__ */ function(l) {
                return function(m) {
                  return m.Name == l.Dh;
                };
              }(a))) && bE(g, a);
              e.push(g);
            }
          }
          return e;
        };
        function bE(a, b) {
          var c = b.Fontname;
          c && (a.fontFamily = c);
          if (c = b.Fontsize) a.fontSize = c + "px";
          if (c = b.PrimaryColour) {
            if (c = cE(c)) a.color = c;
          }
          if (c = b.BackColour) {
            if (c = cE(c)) a.backgroundColor = c;
          }
          b.Bold && (a.fontWeight = Ve);
          b.Italic && (a.fontStyle = We);
          b.Underline && a.textDecoration.push(Xe);
          if (c = b.Spacing) a.letterSpacing = c + "px";
          if (c = b.Alignment) switch (parseInt(c, 10)) {
            case 1:
              a.displayAlign = He;
              a.textAlign = "start";
              break;
            case 2:
              a.displayAlign = He;
              a.textAlign = Ce;
              break;
            case 3:
              a.displayAlign = He;
              a.textAlign = "end";
              break;
            case 5:
              a.displayAlign = "before";
              a.textAlign = "start";
              break;
            case 6:
              a.displayAlign = "before";
              a.textAlign = Ce;
              break;
            case 7:
              a.displayAlign = "before";
              a.textAlign = "end";
              break;
            case 9:
              a.displayAlign = "center";
              a.textAlign = "start";
              break;
            case 10:
              a.displayAlign = "center";
              a.textAlign = Ce;
              break;
            case 11:
              a.displayAlign = "center", a.textAlign = "end";
          }
          if (b = b.AlphaLevel) a.opacity = parseFloat(b);
        }
        function cE(a) {
          a = parseInt(a.replace("&H", ""), 16);
          return 0 <= a ? "rgba(" + (a & 255) + "," + (a >> 8 & 255) + "," + (a >> 16 & 255) + "," + (a >> 24 & 255 ^ 255) / 255 + ")" : null;
        }
        function aE(a) {
          a = dE.exec(a);
          return 3600 * (a[1] ? parseInt(a[1].replace(":", ""), 10) : 0) + 60 * parseInt(a[2], 10) + parseFloat(a[3]);
        }
        T("shaka.text.SsaTextParser", XD);
        XD.prototype.parseMedia = XD.prototype.parseMedia;
        XD.prototype.setManifestType = XD.prototype.setManifestType;
        XD.prototype.setSequenceMode = XD.prototype.setSequenceMode;
        XD.prototype.parseInit = XD.prototype.parseInit;
        var YD = /^\s*\[([^\]]+)\]\r?\n([\s\S]*)/, ZD = /^\s*([^:]+):\s*(.*)/, $D = /\s*,\s*/, dE = /^(\d+:)?(\d{1,2}):(\d{1,2}(?:[.]\d{1,3})?)?$/;
        zf("text/x-ssa", function() {
          return new XD();
        });
        function eE(a, b) {
          var c = a[b + 1] & 1 ? 7 : 9;
          return b + c <= a.length && (a = ((a[b + 3] & 3) << 11 | a[b + 4] << 3 | (a[b + 5] & 224) >>> 5) - c, 0 < a) ? { ud: c, ia: a } : null;
        }
        function fE(a, b) {
          var c = [96e3, 88200, 64e3, 48e3, 44100, 32e3, 24e3, 22050, 16e3, 12e3, 11025, 8e3, 7350], d = (a[b + 2] & 60) >>> 2;
          if (d > c.length - 1) return null;
          var e = ((a[b + 2] & 192) >>> 6) + 1, f = (a[b + 2] & 1) << 2;
          f |= (a[b + 3] & 192) >>> 6;
          return { sampleRate: c[d], channelCount: f, codec: "mp4a.40." + e };
        }
        function gE(a, b) {
          if (b + 1 < a.length && 255 === a[b] && 240 === (a[b + 1] & 246)) {
            var c = a[b + 1] & 1 ? 7 : 9;
            if (b + c >= a.length) return false;
            var d = (a[b + 3] & 3) << 11 | a[b + 4] << 3 | (a[b + 5] & 224) >>> 5;
            if (d <= c) return false;
            b += d;
            return b === a.length || b + 1 < a.length && 255 === a[b] && 240 === (a[b + 1] & 246);
          }
          return false;
        }
        function hE(a, b) {
          switch (a) {
            case "mp4a.40.2":
              if (1 === b) return new Uint8Array([0, 200, 0, 128, 35, 128]);
              if (2 === b) return new Uint8Array([33, 0, 73, 144, 2, 25, 0, 35, 128]);
              if (3 === b) return new Uint8Array([0, 200, 0, 128, 32, 132, 1, 38, 64, 8, 100, 0, 142]);
              if (4 === b) return new Uint8Array([0, 200, 0, 128, 32, 132, 1, 38, 64, 8, 100, 0, 128, 44, 128, 8, 2, 56]);
              if (5 === b) return new Uint8Array([0, 200, 0, 128, 32, 132, 1, 38, 64, 8, 100, 0, 130, 48, 4, 153, 0, 33, 144, 2, 56]);
              if (6 === b) return new Uint8Array([
                0,
                200,
                0,
                128,
                32,
                132,
                1,
                38,
                64,
                8,
                100,
                0,
                130,
                48,
                4,
                153,
                0,
                33,
                144,
                2,
                0,
                178,
                0,
                32,
                8,
                224
              ]);
              break;
            default:
              if (1 === b) return new Uint8Array([1, 64, 34, 128, 163, 78, 230, 128, 186, 8, 0, 0, 0, 28, 6, 241, 193, 10, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 94]);
              if (2 === b || 3 === b) return new Uint8Array([1, 64, 34, 128, 163, 94, 230, 128, 186, 8, 0, 0, 0, 0, 149, 0, 6, 241, 161, 10, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 94]);
          }
          return null;
        }
        function iE(a) {
          this.j = a;
          this.h = 0;
          this.g = /* @__PURE__ */ new Map();
          this.i = null;
        }
        r = iE.prototype;
        r.destroy = function() {
          this.g.clear();
        };
        r.isSupported = function(a) {
          return "audio/aac" == a.toLowerCase().split(";")[0] ? md(this.convertCodecs("audio", a)) : false;
        };
        r.convertCodecs = function(a, b) {
          return "audio/aac" == b.toLowerCase().split(";")[0] ? 'audio/mp4; codecs="' + (wf(b) || "mp4a.40.2") + '"' : b;
        };
        r.getOriginalMimeType = function() {
          return this.j;
        };
        r.transmux = function(a, b, c, d) {
          for (var e = Qb(a), f = ok(e), g = f.length; g < e.length && !gE(e, g); g++) ;
          a = 1e3 * c.endTime;
          f = nk(f);
          f.length && c && (f = f.find(function(m) {
            return "com.apple.streaming.transportStreamTimestamp" === m.description;
          })) && (a = f.data);
          f = fE(e, g);
          if (!f) return Promise.reject(new U(2, 3, 3018, c ? c.N()[0] : null));
          b.audioSamplingRate = f.sampleRate;
          b.channelsCount = f.channelCount;
          for (var h = []; g < e.length; ) {
            var k2 = eE(e, g);
            if (!k2) return Promise.reject(new U(2, 3, 3018, c ? c.N()[0] : null));
            var l = k2.ud + k2.ia;
            g + l <= e.length && h.push({ data: e.subarray(g + k2.ud, g + l), size: k2.ia, duration: 1024, eb: 0, flags: { hb: 0, $a: 0, Za: 0, Xa: 0, Ya: 2, ib: 0 } });
            g += l;
          }
          e = f.sampleRate;
          a = Math.floor(a * e / 1e3);
          d = { id: b.id, type: "audio", codecs: f.codec, encrypted: b.encrypted && 0 < b.drmInfos.length, timescale: e, duration: d, lb: [], ra: new Uint8Array([]), Ca: new Uint8Array([]), Ia: 0, Ka: 0, data: { Db: this.h, baseMediaDecodeTime: a, jb: h }, stream: b };
          d = new ej([d]);
          c = b.id + "_" + c.i;
          this.g.has(c) ? b = this.g.get(c) : (b = kj(d), this.g.set(c, b));
          c = this.i !== b;
          d = Cj(d);
          this.i = b;
          this.h++;
          return c ? (b = Wc(b, d), Promise.resolve(b)) : Promise.resolve(d);
        };
        T("shaka.transmuxer.AacTransmuxer", iE);
        iE.prototype.transmux = iE.prototype.transmux;
        iE.prototype.getOriginalMimeType = iE.prototype.getOriginalMimeType;
        iE.prototype.convertCodecs = iE.prototype.convertCodecs;
        iE.prototype.isSupported = iE.prototype.isSupported;
        iE.prototype.destroy = iE.prototype.destroy;
        cf("audio/aac", function() {
          return new iE("audio/aac");
        }, jf);
        function jE(a, b) {
          if (b + 8 > a.length || 11 !== a[b] || 119 !== a[b + 1]) return null;
          var c = a[b + 4] >> 6;
          if (3 <= c) return null;
          var d = a[b + 4] & 63, e = 2 * [
            64,
            69,
            96,
            64,
            70,
            96,
            80,
            87,
            120,
            80,
            88,
            120,
            96,
            104,
            144,
            96,
            105,
            144,
            112,
            121,
            168,
            112,
            122,
            168,
            128,
            139,
            192,
            128,
            140,
            192,
            160,
            174,
            240,
            160,
            175,
            240,
            192,
            208,
            288,
            192,
            209,
            288,
            224,
            243,
            336,
            224,
            244,
            336,
            256,
            278,
            384,
            256,
            279,
            384,
            320,
            348,
            480,
            320,
            349,
            480,
            384,
            417,
            576,
            384,
            418,
            576,
            448,
            487,
            672,
            448,
            488,
            672,
            512,
            557,
            768,
            512,
            558,
            768,
            640,
            696,
            960,
            640,
            697,
            960,
            768,
            835,
            1152,
            768,
            836,
            1152,
            896,
            975,
            1344,
            896,
            976,
            1344,
            1024,
            1114,
            1536,
            1024,
            1115,
            1536,
            1152,
            1253,
            1728,
            1152,
            1254,
            1728,
            1280,
            1393,
            1920,
            1280,
            1394,
            1920
          ][3 * d + c];
          if (b + e > a.length) return null;
          var f = a[b + 6] >> 5, g = 0;
          2 === f ? g += 2 : (f & 1 && 1 !== f && (g += 2), f & 4 && (g += 2));
          g = (a[b + 6] << 8 | a[b + 7]) >> 12 - g & 1;
          var h = a[b + 5] & 7;
          a = new Uint8Array([c << 6 | a[b + 5] >> 3 << 1 | h >> 2, (h & 3) << 6 | f << 3 | g << 2 | d >> 4, d << 4 & 224]);
          return { sampleRate: [48e3, 44100, 32e3][c], channelCount: [2, 1, 2, 3, 3, 4, 4, 5][f] + g, ra: a, ia: e };
        }
        function kE(a, b) {
          if (11 === a[b] && 119 === a[b + 1]) {
            var c = 0, d = 5;
            b += d;
            for (var e, f; 0 < d; ) {
              f = a[b];
              var g = Math.min(d, 8), h = 8 - g;
              e = 4278190080 >>> 24 + h << h;
              e = (f & e) >> h;
              c = c ? c << g | e : e;
              b += 1;
              d -= g;
            }
            if (16 > c) return true;
          }
          return false;
        }
        function lE(a) {
          this.j = a;
          this.h = 0;
          this.g = /* @__PURE__ */ new Map();
          this.i = null;
        }
        r = lE.prototype;
        r.destroy = function() {
          this.g.clear();
        };
        r.isSupported = function(a) {
          return "audio/ac3" == a.toLowerCase().split(";")[0] ? md(this.convertCodecs("audio", a)) : false;
        };
        r.convertCodecs = function(a, b) {
          return "audio/ac3" == b.toLowerCase().split(";")[0] ? mc() ? 'audio/mp4; codecs="ec-3"' : 'audio/mp4; codecs="ac-3"' : b;
        };
        r.getOriginalMimeType = function() {
          return this.j;
        };
        r.transmux = function(a, b, c, d) {
          a = Qb(a);
          for (var e = ok(a), f = e.length; f < a.length && !kE(a, f); f++) ;
          var g = 1e3 * c.endTime;
          e = nk(e);
          e.length && c && (e = e.find(function(m) {
            return "com.apple.streaming.transportStreamTimestamp" === m.description;
          })) && (g = e.data);
          e = 0;
          for (var h = new Uint8Array([]), k2 = []; f < a.length; ) {
            var l = jE(a, f);
            if (!l) return Promise.reject(new U(2, 3, 3018, c ? c.N()[0] : null));
            b.audioSamplingRate = l.sampleRate;
            b.channelsCount = l.channelCount;
            e = l.sampleRate;
            h = l.ra;
            k2.push({
              data: a.subarray(f, f + l.ia),
              size: l.ia,
              duration: 1536,
              eb: 0,
              flags: { hb: 0, $a: 0, Za: 0, Xa: 0, Ya: 2, ib: 0 }
            });
            f += l.ia;
          }
          a = Math.floor(g * e / 1e3);
          d = { id: b.id, type: "audio", codecs: "ac-3", encrypted: b.encrypted && 0 < b.drmInfos.length, timescale: e, duration: d, lb: [], ra: h, Ca: new Uint8Array([]), Ia: 0, Ka: 0, data: { Db: this.h, baseMediaDecodeTime: a, jb: k2 }, stream: b };
          d = new ej([d]);
          c = b.id + "_" + c.i;
          this.g.has(c) ? b = this.g.get(c) : (b = kj(d), this.g.set(c, b));
          c = this.i !== b;
          d = Cj(d);
          this.i = b;
          this.h++;
          return c ? (b = Wc(b, d), Promise.resolve(b)) : Promise.resolve(d);
        };
        T("shaka.transmuxer.Ac3Transmuxer", lE);
        lE.prototype.transmux = lE.prototype.transmux;
        lE.prototype.getOriginalMimeType = lE.prototype.getOriginalMimeType;
        lE.prototype.convertCodecs = lE.prototype.convertCodecs;
        lE.prototype.isSupported = lE.prototype.isSupported;
        lE.prototype.destroy = lE.prototype.destroy;
        cf("audio/ac3", function() {
          return new lE("audio/ac3");
        }, jf);
        function mE(a, b) {
          if (b + 8 > a.length || 2935 !== (a[b] << 8 | a[b + 1] << 0)) return null;
          var c = new pk(a.subarray(b + 2));
          rk(c, 2);
          rk(c, 3);
          var d = sk(c, 11) + 1 << 1, e = sk(c, 2);
          if (3 == e) {
            e = sk(c, 2);
            e = [24e3, 22060, 16e3][e];
            var f = 3;
          } else e = [48e3, 44100, 32e3][e], f = sk(c, 2);
          var g = sk(c, 3), h = sk(c, 1);
          c = sk(c, 5);
          if (b + d > a.byteLength) return null;
          a = Math.floor(d * e / (16 * [1, 2, 3, 6][f]));
          a = new Uint8Array([(a & 8160) >> 5, (a & 31) << 3, e << 6 | c << 1 | 0, 0 | g << 1 | h << 0, 0]);
          return { sampleRate: e, channelCount: [2, 1, 2, 3, 3, 4, 4, 5][g] + h, ra: a, ia: d };
        }
        function nE(a) {
          this.j = a;
          this.h = 0;
          this.g = /* @__PURE__ */ new Map();
          this.i = null;
        }
        r = nE.prototype;
        r.destroy = function() {
          this.g.clear();
        };
        r.isSupported = function(a) {
          return "audio/ec3" == a.toLowerCase().split(";")[0] ? md(this.convertCodecs("audio", a)) : false;
        };
        r.convertCodecs = function(a, b) {
          return "audio/ec3" == b.toLowerCase().split(";")[0] ? 'audio/mp4; codecs="ec-3"' : b;
        };
        r.getOriginalMimeType = function() {
          return this.j;
        };
        r.transmux = function(a, b, c, d) {
          a = Qb(a);
          for (var e = ok(a), f = e.length; f < a.length && 2935 !== (a[f] << 8 | a[f + 1] << 0); f++) ;
          var g = 1e3 * c.endTime;
          e = nk(e);
          e.length && c && (e = e.find(function(m) {
            return "com.apple.streaming.transportStreamTimestamp" === m.description;
          })) && (g = e.data);
          e = 0;
          for (var h = new Uint8Array([]), k2 = []; f < a.length; ) {
            var l = mE(a, f);
            if (!l) return Promise.reject(new U(2, 3, 3018, c ? c.N()[0] : null));
            b.audioSamplingRate = l.sampleRate;
            b.channelsCount = l.channelCount;
            e = l.sampleRate;
            h = l.ra;
            k2.push({
              data: a.subarray(f, f + l.ia),
              size: l.ia,
              duration: 1536,
              eb: 0,
              flags: { hb: 0, $a: 0, Za: 0, Xa: 0, Ya: 2, ib: 0 }
            });
            f += l.ia;
          }
          a = Math.floor(g * e / 1e3);
          d = { id: b.id, type: "audio", codecs: "ec-3", encrypted: b.encrypted && 0 < b.drmInfos.length, timescale: e, duration: d, lb: [], ra: h, Ca: new Uint8Array([]), Ia: 0, Ka: 0, data: { Db: this.h, baseMediaDecodeTime: a, jb: k2 }, stream: b };
          d = new ej([d]);
          c = b.id + "_" + c.i;
          this.g.has(c) ? b = this.g.get(c) : (b = kj(d), this.g.set(c, b));
          c = this.i !== b;
          d = Cj(d);
          this.i = b;
          this.h++;
          return c ? (b = Wc(b, d), Promise.resolve(b)) : Promise.resolve(d);
        };
        T("shaka.transmuxer.Ec3Transmuxer", nE);
        nE.prototype.transmux = nE.prototype.transmux;
        nE.prototype.getOriginalMimeType = nE.prototype.getOriginalMimeType;
        nE.prototype.convertCodecs = nE.prototype.convertCodecs;
        nE.prototype.isSupported = nE.prototype.isSupported;
        nE.prototype.destroy = nE.prototype.destroy;
        cf("audio/ec3", function() {
          return new nE("audio/ec3");
        }, jf);
        function oE(a) {
          if (!a.length) return null;
          var b = a.find(function(w) {
            return 7 == w.type;
          });
          a = a.find(function(w) {
            return 8 == w.type;
          });
          if (!b || !a) return null;
          var c = new pk(b.data), d = xk(c);
          xk(c);
          xk(c);
          uk(c);
          if (pE.includes(d) && (d = W(c), 3 === d && rk(c, 1), uk(c), uk(c), rk(c, 1), wk(c))) {
            d = 3 !== d ? 8 : 12;
            for (var e = 0; e < d; e++) wk(c) && (6 > e ? yk(c, 16) : yk(c, 64));
          }
          uk(c);
          d = W(c);
          if (0 === d) W(c);
          else if (1 === d) for (rk(c, 1), uk(c), uk(c), d = W(c), e = 0; e < d; e++) uk(c);
          uk(c);
          rk(c, 1);
          var f = W(c), g = W(c), h = sk(c, 1);
          0 === h && rk(c, 1);
          rk(c, 1);
          var k2 = 0, l = 0, m = 0, n = 0;
          wk(c) && (k2 = W(c), l = W(c), m = W(c), n = W(c));
          e = d = 1;
          if (wk(c) && wk(c)) {
            var p = xk(c), q = [1, 12, 10, 16, 40, 24, 20, 32, 80, 18, 15, 64, 160, 4, 3, 2], u = [1, 11, 11, 11, 33, 11, 11, 11, 33, 11, 11, 33, 99, 3, 2, 1];
            0 < p && 16 >= p ? (d = q[p - 1], e = u[p - 1]) : 255 === p && (d = sk(c, 16), e = sk(c, 16));
          }
          c = (2 - h) * (g + 1) * 16 - 2 * m - 2 * n;
          f = 16 * (f + 1) - 2 * k2 - 2 * l;
          k2 = [];
          b = b.fullData;
          k2.push(b.byteLength >>> 8 & 255);
          k2.push(b.byteLength & 255);
          k2 = k2.concat.apply(k2, y(b));
          b = [];
          a = a.fullData;
          b.push(a.byteLength >>> 8 & 255);
          b.push(a.byteLength & 255);
          b = b.concat.apply(b, y(a));
          a = new Uint8Array([
            1,
            k2[3],
            k2[4],
            k2[5],
            255,
            225
          ].concat(k2, [1], b));
          return { height: c, width: f, Ca: a, Ia: d, Ka: e };
        }
        function qE(a) {
          function b(u) {
            e = { data: new Uint8Array([]), frame: false, isKeyframe: false, pts: u.pts, dts: u.dts, nalus: [] };
          }
          function c() {
            if (e && e.nalus.length && e.frame) {
              for (var u = [], w = t(e.nalus), v = w.next(); !v.done; v = w.next()) {
                v = v.value;
                var x = v.fullData.byteLength, z = new Uint8Array(4);
                z[0] = x >> 24 & 255;
                z[1] = x >> 16 & 255;
                z[2] = x >> 8 & 255;
                z[3] = x & 255;
                u.push(z);
                u.push(v.fullData);
              }
              e.data = Wc.apply(Qc, y(u));
              d.push(e);
            }
          }
          for (var d = [], e = null, f = false, g = 0; g < a.length; g++) {
            var h = a[g], k2 = h.nalus, l = false;
            e && k2.length && !f && (c(), b(h));
            k2 = t(h.nalus);
            for (var m = k2.next(); !m.done; m = k2.next()) {
              m = m.value;
              var n = false;
              switch (m.type) {
                case 1:
                  var p = false;
                  n = true;
                  var q = m.data;
                  l && 4 < q.length && (q = zk(new pk(q)), 2 === q || 4 === q || 7 === q || 9 === q) && (p = true);
                  p && e && e.frame && !e.isKeyframe && (c(), e = null);
                  e || b(h);
                  e.frame = true;
                  e.isKeyframe = p;
                  break;
                case 5:
                  n = true;
                  e && e.frame && !e.isKeyframe && (c(), e = null);
                  e || b(h);
                  e.frame = true;
                  e.isKeyframe = true;
                  break;
                case 6:
                  n = true;
                  break;
                case 7:
                  l = n = true;
                  break;
                case 8:
                  n = true;
                  break;
                case 9:
                  f = n = true;
                  e && e.frame && (c(), e = null);
                  e || b(h);
                  break;
                case 12:
                  n = true;
                  break;
                default:
                  n = false;
              }
              e && n && e.nalus.push(m);
            }
          }
          c();
          return d;
        }
        var pE = [100, 110, 122, 244, 44, 83, 86, 118, 128, 138, 139, 134];
        function rE(a) {
          if (!a.length) return null;
          var b = a.find(function(g) {
            return 32 == g.type;
          }), c = a.find(function(g) {
            return 33 == g.type;
          }), d = a.find(function(g) {
            return 34 == g.type;
          });
          if (!b || !c || !d) return null;
          var e = sE(b.fullData);
          a = tE(c.fullData);
          var f = uE(d.fullData);
          b = vE(b.fullData, c.fullData, d.fullData, { Uf: e.Uf, rg: e.rg, Ef: a.Ef, Ff: a.Ff, yf: a.yf, Df: a.Df, zf: a.zf, Af: a.Af, Bf: a.Bf, Cf: a.Cf, rf: a.rf, tf: a.tf, uf: a.uf, vf: a.vf, wf: a.wf, xf: a.xf, hf: a.hf, le: a.le, ff: a.ff, ef: a.ef, df: a.df, Wf: f.Wf });
          return {
            height: a.height,
            width: a.width,
            Ca: b,
            Ia: a.vj,
            Ka: a.uj
          };
        }
        function sE(a) {
          var b = new pk(a, true);
          xk(b);
          xk(b);
          sk(b, 4);
          sk(b, 2);
          sk(b, 6);
          a = sk(b, 3);
          b = wk(b);
          return { Uf: a + 1, rg: b };
        }
        function tE(a) {
          a = new pk(a, true);
          xk(a);
          xk(a);
          var b = 0, c = 0, d = 0, e = 0;
          sk(a, 4);
          var f = sk(a, 3);
          wk(a);
          for (var g = sk(a, 2), h = sk(a, 1), k2 = sk(a, 5), l = xk(a), m = xk(a), n = xk(a), p = xk(a), q = xk(a), u = xk(a), w = xk(a), v = xk(a), x = xk(a), z = xk(a), C = xk(a), D = [], G = [], B = 0; B < f; B++) D.push(wk(a)), G.push(wk(a));
          if (0 < f) for (B = f; 8 > B; B++) sk(a, 2);
          for (B = 0; B < f; B++) D[B] && sk(a, 88), G[B] && xk(a);
          W(a);
          D = W(a);
          3 == D && sk(a, 1);
          G = W(a);
          B = W(a);
          wk(a) && (b += W(a), c += W(a), d += W(a), e += W(a));
          var A = W(a), H = W(a), E = W(a);
          if (wk(a)) for (var K = 0; K <= f; K++) W(a), W(a), W(a);
          else W(a), W(a), W(a);
          W(a);
          W(a);
          W(a);
          W(a);
          W(a);
          W(a);
          if (wk(a) && wk(a)) for (K = 0; 4 > K; K++) for (var M = 0; M < (3 === K ? 2 : 6); M++) if (wk(a)) {
            var J = Math.min(64, 1 << 4 + (K << 1));
            1 < K && vk(a);
            for (var L = 0; L < J; L++) vk(a);
          } else W(a);
          wk(a);
          wk(a);
          wk(a) && (xk(a), W(a), W(a), wk(a));
          K = W(a);
          for (J = M = 0; J < K; J++) if (L = false, 0 !== J && (L = wk(a)), L) {
            J === K && W(a);
            wk(a);
            W(a);
            for (var N = L = 0; N <= M; N++) {
              var P = wk(a), O = false;
              P || (O = wk(a));
              (P || O) && L++;
            }
            M = L;
          } else {
            N = W(a);
            L = W(a);
            M = N + L;
            for (P = 0; P < N; P++) W(a), wk(a);
            for (N = 0; N < L; N++) W(a), wk(a);
          }
          if (wk(a)) for (K = W(a), M = 0; M < K; M++) {
            for (J = 0; J < E + 4; J++) sk(a, 1);
            sk(a, 1);
          }
          K = E = 1;
          M = 0;
          wk(a);
          wk(a);
          if (wk(a)) {
            wk(a) && (J = xk(a), L = [1, 12, 10, 16, 40, 24, 20, 32, 80, 18, 15, 64, 160, 4, 3, 2], N = [1, 11, 11, 11, 33, 11, 11, 11, 33, 11, 11, 33, 99, 3, 2, 1], 0 < J && 16 >= J ? (E = L[J - 1], K = N[J - 1]) : 255 === J && (E = sk(a, 16), K = sk(a, 16)));
            wk(a) && wk(a);
            wk(a) && (sk(a, 3), wk(a), wk(a) && (xk(a), xk(a), xk(a)));
            wk(a) && (W(a), W(a));
            wk(a);
            wk(a);
            wk(a);
            if (J = wk(a)) W(a), W(a), W(a), W(a);
            if (wk(a) && (sk(a, 32), sk(a, 32), wk(a) && W(a), wk(a))) {
              N = false;
              J = wk(a);
              L = wk(a);
              if (J || L) {
                if (N = wk(a)) xk(a), sk(a, 5), wk(a), sk(a, 5);
                sk(a, 4);
                sk(a, 4);
                N && sk(a, 4);
                sk(a, 5);
                sk(a, 5);
                sk(a, 5);
              }
              for (P = 0; P <= f; P++) {
                var R = true;
                O = 1;
                wk(a) || (R = wk(a));
                var S = false;
                R ? W(a) : S = wk(a);
                S || (O = W(a) + 1);
                if (J) {
                  for (R = 0; R < O; R++) W(a), W(a), N && (W(a), W(a));
                  wk(a);
                }
                if (L) {
                  for (R = 0; R < O; R++) W(a), W(a), N && (W(a), W(a));
                  wk(a);
                }
              }
            }
            wk(a) && (wk(a), wk(a), wk(a), M = W(a), W(a), W(a), W(a), W(a));
          }
          return { yf: C, Ef: g, Ff: h, Df: k2, zf: l, Af: m, Bf: n, Cf: p, rf: q, tf: u, uf: w, vf: v, wf: x, xf: z, le: M, hf: 0, ff: D, ef: A, df: H, width: G - (b + c) * (1 === D || 2 === D ? 2 : 1), height: B - (d + e) * (1 === D ? 2 : 1), vj: E, uj: K };
        }
        function uE(a) {
          var b = new pk(a, true);
          xk(b);
          xk(b);
          W(b);
          W(b);
          wk(b);
          wk(b);
          sk(b, 3);
          wk(b);
          wk(b);
          W(b);
          W(b);
          vk(b);
          wk(b);
          wk(b);
          wk(b) && W(b);
          vk(b);
          vk(b);
          wk(b);
          wk(b);
          wk(b);
          wk(b);
          a = wk(b);
          b = wk(b);
          var c = 1;
          b && a ? c = 0 : b ? c = 3 : a && (c = 2);
          return { Wf: c };
        }
        function vE(a, b, c, d) {
          var e = new Uint8Array(23 + (5 + a.byteLength) + (5 + b.byteLength) + (5 + c.byteLength));
          e[0] = 1;
          e[1] = (d.Ef & 3) << 6 | (d.Ff ? 1 : 0) << 5 | d.Df & 31;
          e[2] = d.zf;
          e[3] = d.Af;
          e[4] = d.Bf;
          e[5] = d.Cf;
          e[6] = d.rf;
          e[7] = d.tf;
          e[8] = d.uf;
          e[9] = d.vf;
          e[10] = d.wf;
          e[11] = d.xf;
          e[12] = d.yf;
          e[13] = 240 | (d.le & 3840) >> 8;
          e[14] = d.le & 255;
          e[15] = 252 | d.Wf & 3;
          e[16] = 252 | d.ff & 3;
          e[17] = 248 | d.ef & 7;
          e[18] = 248 | d.df & 7;
          e[19] = 0;
          e[20] = 0;
          e[21] = (d.hf & 3) << 6 | (d.Uf & 7) << 3 | (d.rg ? 1 : 0) << 2 | 3;
          e[22] = 3;
          e[23] = 160;
          e[24] = 0;
          e[25] = 1;
          e[26] = (a.byteLength & 65280) >> 8;
          e[27] = (a.byteLength & 255) >> 0;
          e.set(a, 28);
          e[23 + (5 + a.byteLength)] = 161;
          e[a.byteLength + 29] = 0;
          e[a.byteLength + 30] = 1;
          e[a.byteLength + 31] = (b.byteLength & 65280) >> 8;
          e[a.byteLength + 32] = (b.byteLength & 255) >> 0;
          e.set(b, a.byteLength + 33);
          e[23 + (a.byteLength + 10 + b.byteLength)] = 162;
          e[a.byteLength + 10 + b.byteLength + 24] = 0;
          e[a.byteLength + 10 + b.byteLength + 25] = 1;
          e[a.byteLength + 10 + b.byteLength + 26] = (c.byteLength & 65280) >> 8;
          e[a.byteLength + 10 + b.byteLength + 27] = (c.byteLength & 255) >> 0;
          e.set(c, a.byteLength + 10 + b.byteLength + 28);
          return e;
        }
        function wE(a, b) {
          var c = a[b + 1] >> 3 & 3, d = a[b + 1] >> 1 & 3, e = a[b + 2] >> 4 & 15, f = a[b + 2] >> 2 & 3;
          if (1 !== c && 0 !== e && 15 !== e && 3 !== f) {
            var g = a[b + 3] >> 6;
            e = 1e3 * xE[14 * (3 === c ? 3 - d : 3 === d ? 3 : 4) + e - 1];
            f = yE[3 * (3 === c ? 0 : 2 === c ? 1 : 2) + f];
            c = zE[c][d];
            var h = AE[d], k2 = Math.floor(c * e / f + (a[b + 2] >> 1 & 1)) * h, l = (navigator.userAgent || "").match(/Chrome\/(\d+)/i);
            (l = l ? parseInt(l[1], 10) : 0) && 87 >= l && 2 === d && 224e3 <= e && 0 === g && (a[b + 3] |= 128);
            return { sampleRate: f, channelCount: 3 === g ? 1 : 2, ia: k2, tj: 8 * c * h };
          }
          return null;
        }
        function BE(a, b) {
          return 255 === a[b] && 224 === (a[b + 1] & 224) && 0 !== (a[b + 1] & 6);
        }
        function CE(a, b) {
          if (b + 1 < a.length && BE(a, b)) {
            var c = wE(a, b), d = 4;
            c && c.ia && (d = c.ia);
            b += d;
            return b === a.length || b + 1 < a.length && BE(a, b);
          }
          return false;
        }
        var xE = [32, 64, 96, 128, 160, 192, 224, 256, 288, 320, 352, 384, 416, 448, 32, 48, 56, 64, 80, 96, 112, 128, 160, 192, 224, 256, 320, 384, 32, 40, 48, 56, 64, 80, 96, 112, 128, 160, 192, 224, 256, 320, 32, 48, 56, 64, 80, 96, 112, 128, 144, 160, 176, 192, 224, 256, 8, 16, 24, 32, 40, 48, 56, 64, 80, 96, 112, 128, 144, 160], yE = [44100, 48e3, 32e3, 22050, 24e3, 16e3, 11025, 12e3, 8e3], zE = [[0, 72, 144, 12], [0, 0, 0, 0], [0, 72, 144, 12], [0, 144, 144, 12]], AE = [0, 1, 1, 4];
        function DE(a) {
          this.j = a;
          this.h = 0;
          this.g = /* @__PURE__ */ new Map();
          this.i = null;
        }
        r = DE.prototype;
        r.destroy = function() {
          this.g.clear();
        };
        r.isSupported = function(a) {
          return "audio/mpeg" == a.toLowerCase().split(";")[0] ? md(this.convertCodecs("audio", a)) : false;
        };
        r.convertCodecs = function(a, b) {
          return "audio/mpeg" == b.toLowerCase().split(";")[0] ? 'audio/mp4; codecs="mp3"' : b;
        };
        r.getOriginalMimeType = function() {
          return this.j;
        };
        r.transmux = function(a, b, c, d) {
          for (var e = Qb(a), f = ok(e).length; f < e.length && !CE(e, f); f++) ;
          var g;
          for (a = []; f < e.length; ) {
            var h = wE(e, f);
            if (!h) return Promise.reject(new U(2, 3, 3018, c ? c.N()[0] : null));
            g || (g = h);
            f + h.ia <= e.length && a.push({ data: e.subarray(f, f + h.ia), size: h.ia, duration: 1152, eb: 0, flags: { hb: 0, $a: 0, Za: 0, Xa: 0, Ya: 2, ib: 0 } });
            f += h.ia;
          }
          if (!g) return Promise.reject(new U(2, 3, 3018, c ? c.N()[0] : null));
          e = 9e4 * g.tj / g.sampleRate * this.h;
          d = {
            id: b.id,
            type: "audio",
            codecs: "mp3",
            encrypted: b.encrypted && 0 < b.drmInfos.length,
            timescale: g.sampleRate,
            duration: d,
            lb: [],
            ra: new Uint8Array([]),
            Ca: new Uint8Array([]),
            Ia: 0,
            Ka: 0,
            data: { Db: this.h, baseMediaDecodeTime: e, jb: a },
            stream: b
          };
          d = new ej([d]);
          c = b.id + "_" + c.i;
          this.g.has(c) ? b = this.g.get(c) : (b = kj(d), this.g.set(c, b));
          c = this.i !== b;
          d = Cj(d);
          this.i = b;
          this.h++;
          return c ? (b = Wc(b, d), Promise.resolve(b)) : Promise.resolve(d);
        };
        T("shaka.transmuxer.Mp3Transmuxer", DE);
        DE.prototype.transmux = DE.prototype.transmux;
        DE.prototype.getOriginalMimeType = DE.prototype.getOriginalMimeType;
        DE.prototype.convertCodecs = DE.prototype.convertCodecs;
        DE.prototype.isSupported = DE.prototype.isSupported;
        DE.prototype.destroy = DE.prototype.destroy;
        cf("audio/mpeg", function() {
          return new DE("audio/mpeg");
        }, jf);
        function EE(a) {
          this.h = a;
          this.g = null;
        }
        r = EE.prototype;
        r.destroy = function() {
        };
        r.isSupported = function(a) {
          if ("video/mp2t" != a.toLowerCase().split(";")[0]) return false;
          var b = wf(a).split(","), c = bd("audio", b);
          b = bd("video", b);
          return !c || b || "mp3" != sf(c) ? false : md(this.convertCodecs("audio", a));
        };
        r.convertCodecs = function(a, b) {
          return "video/mp2t" == b.toLowerCase().split(";")[0] ? "audio/mpeg" : b;
        };
        r.getOriginalMimeType = function() {
          return this.h;
        };
        r.transmux = function(a, b, c, d, e) {
          this.g ? this.g.clearData() : this.g = new Ak();
          a = Qb(a);
          a = this.g.parse(a);
          if ("mp3" != a.od().audio || "audio" != e) return Promise.reject(new U(2, 3, 3018, c ? c.N()[0] : null));
          c = new Uint8Array([]);
          e = t(a.fb());
          for (a = e.next(); !a.done; a = e.next()) if (a = a.value.data) for (b = 0; b < a.length; ) (d = wE(a, b)) ? (b + d.ia <= a.length && (c = Wc(c, a.subarray(b, b + d.ia))), b += d.ia) : b++;
          return Promise.resolve(c);
        };
        T("shaka.transmuxer.MpegTsTransmuxer", EE);
        EE.prototype.transmux = EE.prototype.transmux;
        EE.prototype.getOriginalMimeType = EE.prototype.getOriginalMimeType;
        EE.prototype.convertCodecs = EE.prototype.convertCodecs;
        EE.prototype.isSupported = EE.prototype.isSupported;
        EE.prototype.destroy = EE.prototype.destroy;
        cf("video/mp2t", function() {
          return new EE("video/mp2t");
        }, hf);
        /*
         @license
         MSS Transmuxer
         Copyright 2015 Dash Industry Forum
         SPDX-License-Identifier: BSD-3-Clause
        */
        function FE(a) {
          this.h = a;
          (this.g = fx.get("ISOBoxer")()) && GE(this);
        }
        function GE(a) {
          function b() {
            this._procFullBox();
            this.flags & 1 && (this._procField("AlgorithmID", "uint", 24), this._procField("IV_size", "uint", 8), this._procFieldArray("KID", 16, "uint", 8));
            this._procField("sample_count", "uint", 32);
            this._procEntries("entry", this.sample_count, function(c) {
              this._procEntryField(c, "InitializationVector", "data", 8);
              this.flags & 2 && (this._procEntryField(c, "NumberOfEntries", "uint", 16), this._procSubEntries(c, "clearAndCryptedData", c.NumberOfEntries, function(d) {
                this._procEntryField(
                  d,
                  "BytesOfClearData",
                  "uint",
                  16
                );
                this._procEntryField(d, "BytesOfEncryptedData", "uint", 32);
              }));
            });
          }
          a.g.addBoxProcessor("saio", function() {
            this._procFullBox();
            this.flags & 1 && (this._procField("aux_info_type", "uint", 32), this._procField("aux_info_type_parameter", "uint", 32));
            this._procField("entry_count", "uint", 32);
            this._procFieldArray("offset", this.entry_count, "uint", 1 === this.version ? 64 : 32);
          });
          a.g.addBoxProcessor("saiz", function() {
            this._procFullBox();
            this.flags & 1 && (this._procField("aux_info_type", "uint", 32), this._procField(
              "aux_info_type_parameter",
              "uint",
              32
            ));
            this._procField("default_sample_info_size", "uint", 8);
            this._procField("sample_count", "uint", 32);
            0 === this.default_sample_info_size && this._procFieldArray("sample_info_size", this.sample_count, "uint", 8);
          });
          a.g.addBoxProcessor("senc", b);
          a.g.addBoxProcessor("uuid", function() {
            for (var c = true, d = 0; 16 > d; d++) this.usertype[d] !== HE[d] && (c = false);
            c && (this._parsing && (this.type = "sepiff"), b.call(this));
          });
        }
        r = FE.prototype;
        r.destroy = function() {
        };
        r.isSupported = function(a, b) {
          var c = a.startsWith("mss/");
          if (!this.g || !c) return false;
          if (b) return md(this.convertCodecs(b, a));
          b = this.convertCodecs("audio", a);
          a = this.convertCodecs("video", a);
          return md(b) || md(a);
        };
        r.convertCodecs = function(a, b) {
          return b.replace("mss/", "");
        };
        r.getOriginalMimeType = function() {
          return this.h;
        };
        r.transmux = function(a, b, c) {
          if (!c) return Promise.resolve(Qb(a));
          if (!b.mssPrivateData) return Promise.reject(new U(2, 3, 3020, c ? c.N()[0] : null));
          try {
            var d, e = this.g.parseBuffer(a), f = e.fetch("tfhd");
            f.track_ID = b.id + 1;
            var g = e.fetch("tfdt"), h = e.fetch("traf");
            null === g && (g = this.g.createFullBox("tfdt", h, f), g.version = 1, g.flags = 0, g.baseMediaDecodeTime = Math.floor(c.startTime * b.mssPrivateData.timescale));
            var k2 = e.fetch("trun"), l = e.fetch("tfxd");
            l && l._parent.boxes.splice(l._parent.boxes.indexOf(l), 1);
            var m = e.fetch("tfrf");
            m && m._parent.boxes.splice(m._parent.boxes.indexOf(m), 1);
            var n = e.fetch("sepiff");
            if (null !== n) {
              n.type = "senc";
              n.usertype = void 0;
              var p = e.fetch("saio");
              if (null === p) {
                p = this.g.createFullBox("saio", h);
                p.version = 0;
                p.flags = 0;
                p.entry_count = 1;
                p.offset = [0];
                var q = this.g.createFullBox("saiz", h);
                q.version = 0;
                q.flags = 0;
                q.sample_count = n.sample_count;
                q.default_sample_info_size = 0;
                q.sample_info_size = [];
                if (n.flags & 2) for (d = 0; d < n.sample_count; d += 1) q.sample_info_size[d] = 10 + 6 * n.entry[d].NumberOfEntries;
                else q.default_sample_info_size = 8;
              }
            }
            f.flags &= 16777214;
            f.flags |= 131072;
            k2.flags |= 1;
            var u = e.fetch("moof");
            k2.data_offset = u.getLength() + 8;
            var w = e.fetch("saio");
            null !== w && (w.offset[0] = IE(u, "traf") + IE(h, "senc") + 16);
            var v = Qb(e.write());
            return Promise.resolve(v);
          } catch (x) {
            return x instanceof U ? Promise.reject(x) : Promise.reject(new U(2, 3, 3022, c ? c.N()[0] : null));
          }
        };
        function IE(a, b) {
          for (var c = 8, d = 0; d < a.boxes.length && a.boxes[d].type !== b; d++) c += a.boxes[d].size;
          return c;
        }
        T("shaka.transmuxer.MssTransmuxer", FE);
        FE.prototype.transmux = FE.prototype.transmux;
        FE.prototype.getOriginalMimeType = FE.prototype.getOriginalMimeType;
        FE.prototype.convertCodecs = FE.prototype.convertCodecs;
        FE.prototype.isSupported = FE.prototype.isSupported;
        FE.prototype.destroy = FE.prototype.destroy;
        var HE = new Uint8Array([162, 57, 79, 82, 90, 155, 79, 20, 162, 68, 108, 66, 124, 100, 141, 244]);
        cf("mss/audio/mp4", function() {
          return new FE("mss/audio/mp4");
        }, jf);
        cf("mss/video/mp4", function() {
          return new FE("mss/video/mp4");
        }, jf);
        function JE(a) {
          this.m = a;
          this.g = 0;
          this.i = /* @__PURE__ */ new Map();
          this.l = this.h = this.j = null;
        }
        r = JE.prototype;
        r.destroy = function() {
          this.i.clear();
          this.h && this.h.destroy();
        };
        r.isSupported = function(a, b) {
          if ("video/mp2t" != a.toLowerCase().split(";")[0]) return false;
          var c = a;
          b && (c = this.convertCodecs(b, a));
          var d = wf(c).split(",");
          c = bd("audio", d);
          d = bd("video", d);
          if (c && (c = sf(c), !KE.includes(c)) || d && (c = sf(d), !LE.includes(c))) return false;
          if (b) return md(this.convertCodecs(b, a));
          b = this.convertCodecs("audio", a);
          a = this.convertCodecs("video", a);
          return md(b) || md(a);
        };
        r.convertCodecs = function(a, b) {
          return "video/mp2t" == b.toLowerCase().split(";")[0] ? (b = wf(b).replace("mp4a.40.34", "mp3").split(",").map(function(c) {
            return sg(c, "audio/mp4");
          }).map(tg).join(","), "audio" == a ? 'audio/mp4; codecs="' + b + '"' : 'video/mp4; codecs="' + b + '"') : b;
        };
        r.getOriginalMimeType = function() {
          return this.m;
        };
        r.transmux = function(a, b, c, d, e) {
          var f = Qb(a);
          if ("audio" == e && !Ik(f)) {
            for (var g = ok(f), h = g.length; h < f.length; h++) if (CE(f, h)) return Promise.reject(new U(2, 3, 3018, c ? c.N()[0] : null));
            for (h = g.length; h < f.length; h++) if (gE(f, h)) return this.h || (this.h = new iE("audio/aac")), this.h.transmux(a, b, c, d, e);
            return Promise.reject(new U(2, 3, 3018, c ? c.N()[0] : null));
          }
          this.j ? this.j.clearData() : this.j = new Ak();
          var k2 = this.j.parse(f), l = [], m = k2.od();
          try {
            var n = null;
            if ("video" == e) {
              switch (m.video) {
                case "avc":
                  var p = [], q = null, u = k2.wc(), w = qE(u);
                  if (!w.length) throw new U(2, 3, 3023, c ? c.N()[0] : null);
                  for (var v = 0; v < w.length; v++) {
                    var x = w[v];
                    null == q && (q = x.dts);
                    var z = void 0;
                    z = v + 1 < w.length ? (w[v + 1].dts || 0) - (x.dts || 0) : 1 < w.length ? (x.dts || 0) - (w[v - 1].dts || 0) : 9e4 * (c.endTime - c.startTime);
                    p.push({ data: x.data, size: x.data.byteLength, duration: z, eb: Math.round((x.pts || 0) - (x.dts || 0)), flags: { hb: 0, $a: 0, Za: 0, Xa: 0, Ya: x.isKeyframe ? 2 : 1, ib: x.isKeyframe ? 0 : 1 } });
                  }
                  for (var C = [], D = t(u), G = D.next(); !G.done; G = D.next()) C.push.apply(C, y(G.value.nalus));
                  var B = oE(C);
                  if (!B || null == q) throw new U(2, 3, 3018, c ? c.N()[0] : null);
                  b.height = B.height;
                  b.width = B.width;
                  n = { id: b.id, type: "video", codecs: "avc1", encrypted: b.encrypted && 0 < b.drmInfos.length, timescale: 9e4, duration: d, lb: [], ra: new Uint8Array([]), Ca: B.Ca, Ia: B.Ia, Ka: B.Ka, data: { Db: this.g, baseMediaDecodeTime: q, jb: p }, stream: b };
                  break;
                case "hvc":
                  var A = [], H = null, E = [], K = k2.wc();
                  if (!K.length) throw new U(2, 3, 3023, c ? c.N()[0] : null);
                  for (var M = 0; M < K.length; M++) {
                    var J = K[M], L = J.nalus;
                    E.push.apply(E, y(L));
                    for (var N = false, P = [], O = false, R = t(L), S = R.next(); !S.done; S = R.next()) {
                      var pa = S.value;
                      switch (pa.type) {
                        case 1:
                        case 0:
                          var Z = O = true;
                          break;
                        case 19:
                        case 20:
                        case 21:
                          N = Z = O = true;
                          break;
                        case 32:
                          Z = true;
                          break;
                        case 33:
                          Z = true;
                          break;
                        case 34:
                          Z = true;
                          break;
                        case 35:
                          O = Z = true;
                          break;
                        case 39:
                        case 40:
                          Z = true;
                          break;
                        default:
                          Z = false;
                      }
                      if (O && Z) {
                        var Fa = pa.fullData.byteLength, Ia = new Uint8Array(4);
                        Ia[0] = Fa >> 24 & 255;
                        Ia[1] = Fa >> 16 & 255;
                        Ia[2] = Fa >> 8 & 255;
                        Ia[3] = Fa & 255;
                        P.push(Ia);
                        P.push(pa.fullData);
                      }
                    }
                    var sa = P.length ? { data: Wc.apply(Qc, y(P)), isKeyframe: N } : null;
                    if (sa) {
                      null == H && null != J.dts && (H = J.dts);
                      var ka = void 0;
                      ka = M + 1 < K.length ? (K[M + 1].dts || 0) - (J.dts || 0) : 1 < K.length ? (J.dts || 0) - (K[M - 1].dts || 0) : 9e4 * (c.endTime - c.startTime);
                      A.push({ data: sa.data, size: sa.data.byteLength, duration: ka, eb: Math.round((J.pts || 0) - (J.dts || 0)), flags: { hb: 0, $a: 0, Za: 0, Xa: 0, Ya: sa.isKeyframe ? 2 : 1, ib: sa.isKeyframe ? 0 : 1 } });
                    }
                  }
                  var Ca = rE(E);
                  if (!Ca || null == H) throw new U(2, 3, 3018, c ? c.N()[0] : null);
                  b.height = Ca.height;
                  b.width = Ca.width;
                  n = {
                    id: b.id,
                    type: "video",
                    codecs: "hvc1",
                    encrypted: b.encrypted && 0 < b.drmInfos.length,
                    timescale: 9e4,
                    duration: d,
                    lb: [],
                    ra: new Uint8Array([]),
                    Ca: Ca.Ca,
                    Ia: Ca.Ia,
                    Ka: Ca.Ka,
                    data: { Db: this.g, baseMediaDecodeTime: H, jb: A },
                    stream: b
                  };
              }
              n && (l.push(n), n = null);
            }
            if ("audio" == e) {
              switch (m.audio) {
                case "aac":
                  for (var ra = [], ya, na = null, ta = null, Pa = null, ob = t(k2.fb()), db = ob.next(); !db.done; db = ob.next()) {
                    var eb = db.value, jb = eb.data;
                    if (jb) {
                      var ub = 0;
                      if (-1 == ta && Pa) jb = Wc(Pa, eb.data), ta = null;
                      else if (null != ta && Pa) {
                        ub = Math.max(0, ta);
                        var ye = Wc(Pa, jb.subarray(0, ub));
                        ra.push({ data: ye, size: ye.byteLength, duration: 1024, eb: 0, flags: { hb: 0, $a: 0, Za: 0, Xa: 0, Ya: 2, ib: 0 } });
                        ta = Pa = null;
                      }
                      ya = fE(
                        jb,
                        ub
                      );
                      if (!ya) throw new U(2, 3, 3018, c ? c.N()[0] : null);
                      b.audioSamplingRate = ya.sampleRate;
                      b.channelsCount = ya.channelCount;
                      null == na && null !== eb.pts && (na = eb.pts);
                      for (; ub < jb.length; ) {
                        var Oc = eE(jb, ub);
                        if (!Oc) {
                          Pa = jb.subarray(ub, jb.length);
                          ta = -1;
                          break;
                        }
                        var de = Oc.ud + Oc.ia;
                        ta = Math.max(0, ub + de - jb.length);
                        0 != ta ? Pa = jb.subarray(ub + Oc.ud, ub + de) : ub + de <= jb.length && ra.push({ data: jb.subarray(ub + Oc.ud, ub + de), size: Oc.ia, duration: 1024, eb: 0, flags: { hb: 0, $a: 0, Za: 0, Xa: 0, Ya: 2, ib: 0 } });
                        ub += de;
                      }
                    }
                  }
                  if (!ya || null == na) {
                    if (!k2.wc().length) throw new U(
                      2,
                      3,
                      3018,
                      c ? c.N()[0] : null
                    );
                    na = 9e4 * c.startTime;
                    var Qf = bd("audio", b.codecs.split(","));
                    if (!Qf || !b.channelsCount || !b.audioSamplingRate) throw new U(2, 3, 3018, c ? c.N()[0] : null);
                    ya = { sampleRate: b.audioSamplingRate, channelCount: b.channelsCount, codec: Qf };
                    var Rf = hE(Qf, b.channelsCount);
                    if (!Rf) throw new U(2, 3, 3018, c ? c.N()[0] : null);
                    for (var Zc = na + 9e4 * (c.endTime - c.startTime), Lv = na; Lv < Zc; ) ra.push({ data: Rf, size: Rf.byteLength, duration: 1024, eb: 0, flags: { hb: 0, $a: 0, Za: 0, Xa: 0, Ya: 2, ib: 0 } }), Lv += 1024 / ya.sampleRate * 9e4;
                  }
                  var Mv = ya.sampleRate, eF = na / 9e4 * Mv;
                  n = { id: b.id, type: "audio", codecs: ya.codec, encrypted: b.encrypted && 0 < b.drmInfos.length, timescale: Mv, duration: d, lb: [], ra: new Uint8Array([]), Ca: new Uint8Array([]), Ia: 0, Ka: 0, data: { Db: this.g, baseMediaDecodeTime: eF, jb: ra }, stream: b };
                  break;
                case "ac3":
                  for (var Nv = [], ak = 0, Sn = new Uint8Array([]), bk = null, Ov = t(k2.fb()), Tn = Ov.next(); !Tn.done; Tn = Ov.next()) {
                    var Un = Tn.value, Vn = Un.data;
                    null == bk && null !== Un.pts && (bk = Un.pts);
                    for (var Wf = 0; Wf < Vn.length; ) {
                      var fe = jE(Vn, Wf);
                      fe ? (b.audioSamplingRate = fe.sampleRate, b.channelsCount = fe.channelCount, ak = fe.sampleRate, Sn = fe.ra, Nv.push({ data: Vn.subarray(Wf, Wf + fe.ia), size: fe.ia, duration: 1536, eb: 0, flags: { hb: 0, $a: 0, Za: 0, Xa: 0, Ya: 2, ib: 0 } }), Wf += fe.ia) : Wf++;
                    }
                  }
                  if (0 == ak || 0 == Sn.byteLength || null == bk) throw new U(2, 3, 3018, c ? c.N()[0] : null);
                  var fF = bk / 9e4 * ak;
                  n = { id: b.id, type: "audio", codecs: "ac-3", encrypted: b.encrypted && 0 < b.drmInfos.length, timescale: ak, duration: d, lb: [], ra: Sn, Ca: new Uint8Array([]), Ia: 0, Ka: 0, data: { Db: this.g, baseMediaDecodeTime: fF, jb: Nv }, stream: b };
                  break;
                case "ec3":
                  for (var Pv = [], ck = 0, Wn = new Uint8Array([]), dk = null, Qv = t(k2.fb()), Xn = Qv.next(); !Xn.done; Xn = Qv.next()) {
                    var Yn = Xn.value, Zn = Yn.data;
                    null == dk && null !== Yn.pts && (dk = Yn.pts);
                    for (var Xf = 0; Xf < Zn.length; ) {
                      var ge = mE(Zn, Xf);
                      ge ? (b.audioSamplingRate = ge.sampleRate, b.channelsCount = ge.channelCount, ck = ge.sampleRate, Wn = ge.ra, Pv.push({ data: Zn.subarray(Xf, Xf + ge.ia), size: ge.ia, duration: 1536, eb: 0, flags: { hb: 0, $a: 0, Za: 0, Xa: 0, Ya: 2, ib: 0 } }), Xf += ge.ia) : Xf++;
                    }
                  }
                  if (0 == ck || 0 == Wn.byteLength || null == dk) throw new U(2, 3, 3018, c ? c.N()[0] : null);
                  var gF = dk / 9e4 * ck;
                  n = { id: b.id, type: "audio", codecs: "ec-3", encrypted: b.encrypted && 0 < b.drmInfos.length, timescale: ck, duration: d, lb: [], ra: Wn, Ca: new Uint8Array([]), Ia: 0, Ka: 0, data: { Db: this.g, baseMediaDecodeTime: gF, jb: Pv }, stream: b };
                  break;
                case "mp3":
                  for (var Rv = [], ek, fk = null, Sv = t(k2.fb()), $n = Sv.next(); !$n.done; $n = Sv.next()) {
                    var ao = $n.value, xh = ao.data;
                    if (xh) {
                      null == fk && null !== ao.pts && (fk = ao.pts);
                      for (var Oe = 0; Oe < xh.length; ) {
                        var Yf = wE(xh, Oe);
                        Yf ? (ek || (ek = Yf), Oe + Yf.ia <= xh.length && Rv.push({
                          data: xh.subarray(Oe, Oe + Yf.ia),
                          size: Yf.ia,
                          duration: 1152,
                          eb: 0,
                          flags: { hb: 0, $a: 0, Za: 0, Xa: 0, Ya: 2, ib: 0 }
                        }), Oe += Yf.ia) : Oe++;
                      }
                    }
                  }
                  if (!ek || null == fk) throw new U(2, 3, 3018, c ? c.N()[0] : null);
                  var Tv = ek.sampleRate, hF = fk / 9e4 * Tv;
                  n = { id: b.id, type: "audio", codecs: "mp3", encrypted: b.encrypted && 0 < b.drmInfos.length, timescale: Tv, duration: d, lb: [], ra: new Uint8Array([]), Ca: new Uint8Array([]), Ia: 0, Ka: 0, data: { Db: this.g, baseMediaDecodeTime: hF, jb: Rv }, stream: b };
                  break;
                case "opus":
                  var Uv = [], gk = null, hd = k2.F;
                  if (!hd) throw new U(2, 3, 3018, c ? c.N()[0] : null);
                  var Rb = [];
                  switch (hd.Zh) {
                    case 1:
                    case 2:
                      Rb = [0];
                      break;
                    case 0:
                      Rb = [255, 1, 1, 0, 1];
                      break;
                    case 128:
                      Rb = [255, 2, 0, 0, 1];
                      break;
                    case 3:
                      Rb = [1, 2, 1, 0, 2, 1];
                      break;
                    case 4:
                      Rb = [1, 2, 2, 0, 1, 2, 3];
                      break;
                    case 5:
                      Rb = [1, 3, 2, 0, 4, 1, 2, 3];
                      break;
                    case 6:
                      Rb = [1, 4, 2, 0, 4, 1, 2, 3, 5];
                      break;
                    case 7:
                      Rb = [1, 4, 2, 0, 4, 1, 2, 3, 5, 6];
                      break;
                    case 8:
                      Rb = [1, 5, 3, 0, 6, 1, 2, 3, 4, 5, 7];
                      break;
                    case 130:
                      Rb = [1, 1, 2, 0, 1];
                      break;
                    case 131:
                      Rb = [1, 1, 3, 0, 1, 2];
                      break;
                    case 132:
                      Rb = [1, 1, 4, 0, 1, 2, 3];
                      break;
                    case 133:
                      Rb = [1, 1, 5, 0, 1, 2, 3, 4];
                      break;
                    case 134:
                      Rb = [1, 1, 6, 0, 1, 2, 3, 4, 5];
                      break;
                    case 135:
                      Rb = [1, 1, 7, 0, 1, 2, 3, 4, 5, 6];
                      break;
                    case 136:
                      Rb = [1, 1, 8, 0, 1, 2, 3, 4, 5, 6, 7];
                  }
                  var Vv = new Uint8Array([0, hd.channelCount, 0, 0, hd.sampleRate >>> 24 & 255, hd.sampleRate >>> 17 & 255, hd.sampleRate >>> 8 & 255, hd.sampleRate >>> 0 & 255, 0, 0].concat(y(Rb)));
                  for (var Wv = hd.sampleRate, Xv = t(k2.fb()), bo = Xv.next(); !bo.done; bo = Xv.next()) {
                    var co = bo.value, Zf = co.data;
                    null == gk && null !== co.pts && (gk = co.pts);
                    for (var yh = 0; yh < Zf.length; ) {
                      for (var iF = 0 !== (Zf[yh + 1] & 16), jF = 0 !== (Zf[yh + 1] & 8), Jd = yh + 2, hk = 0; 255 === Zf[Jd]; ) hk += 255, Jd += 1;
                      hk += Zf[Jd];
                      Jd += 1;
                      Jd += iF ? 2 : 0;
                      Jd += jF ? 2 : 0;
                      var Yv = Zf.slice(Jd, Jd + hk);
                      Uv.push({
                        data: Yv,
                        size: Yv.byteLength,
                        duration: 960,
                        eb: 0,
                        flags: { hb: 0, $a: 0, Za: 0, Xa: 0, Ya: 2, ib: 0 }
                      });
                      yh = Jd + hk;
                    }
                  }
                  if (0 == Vv.byteLength || null == gk) throw new U(2, 3, 3018, c ? c.N()[0] : null);
                  b.audioSamplingRate = hd.sampleRate;
                  b.channelsCount = hd.channelCount;
                  var kF = gk / 9e4 * Wv;
                  n = { id: b.id, type: "audio", codecs: "opus", encrypted: b.encrypted && 0 < b.drmInfos.length, timescale: Wv, duration: d, lb: [], ra: Vv, Ca: new Uint8Array([]), Ia: 0, Ka: 0, data: { Db: this.g, baseMediaDecodeTime: kF, jb: Uv }, stream: b };
              }
              n && (l.push(n), n = null);
            }
          } catch (eo) {
            return eo && 3023 == eo.code ? Promise.resolve(new Uint8Array([])) : Promise.reject(eo);
          }
          if (!l.length) return Promise.reject(new U(2, 3, 3018, c ? c.N()[0] : null));
          var Zv = new ej(l), fo = b.id + "_" + c.i;
          if (this.i.has(fo)) var zh = this.i.get(fo);
          else zh = kj(Zv), this.i.set(fo, zh);
          var lF = this.l !== zh, $v = Cj(Zv);
          this.l = zh;
          this.g++;
          if (lF) {
            var mF = Wc(zh, $v);
            return Promise.resolve(mF);
          }
          return Promise.resolve($v);
        };
        T("shaka.transmuxer.TsTransmuxer", JE);
        JE.prototype.transmux = JE.prototype.transmux;
        JE.prototype.getOriginalMimeType = JE.prototype.getOriginalMimeType;
        JE.prototype.convertCodecs = JE.prototype.convertCodecs;
        JE.prototype.isSupported = JE.prototype.isSupported;
        JE.prototype.destroy = JE.prototype.destroy;
        var KE = ["aac", "ac-3", "ec-3", "mp3", "opus"], LE = ["avc", "hevc"];
        cf("video/mp2t", function() {
          return new JE("video/mp2t");
        }, gf);
        function ME() {
        }
        qa(ME, tn);
        T("shaka.util.FairPlayUtils", ME);
        /*
         @license
         EME Encryption Scheme Polyfill
         Copyright 2019 Google LLC
         SPDX-License-Identifier: Apache-2.0
        */
        function NE() {
        }
        var OE;
        function PE() {
          OE || navigator.emeEncryptionSchemePolyfilled ? console.debug("EmeEncryptionSchemePolyfill: Already installed.") : navigator.requestMediaKeySystemAccess && MediaKeySystemAccess.prototype.getConfiguration ? (OE = navigator.requestMediaKeySystemAccess, console.debug("EmeEncryptionSchemePolyfill: Waiting to detect encryptionScheme support."), navigator.requestMediaKeySystemAccess = QE, navigator.emeEncryptionSchemePolyfilled = true) : console.debug("EmeEncryptionSchemePolyfill: EME not found");
        }
        function QE(a, b) {
          var c = this, d;
          return Q(function(e) {
            if (1 == e.g) return console.assert(c == navigator, 'bad "this" for requestMediaKeySystemAccess'), F(e, OE.call(c, a, b), 2);
            d = e.h;
            if (RE(d)) return console.debug("EmeEncryptionSchemePolyfill: Native encryptionScheme support found."), navigator.requestMediaKeySystemAccess = OE, e.return(d);
            console.debug("EmeEncryptionSchemePolyfill: No native encryptionScheme support found. Patching encryptionScheme support.");
            navigator.requestMediaKeySystemAccess = SE;
            return e.return(SE.call(
              c,
              a,
              b
            ));
          });
        }
        function SE(a, b) {
          var c = this, d, e, f, g, h, k2, l, m, n, p, q, u;
          return Q(function(w) {
            if (1 == w.g) {
              console.assert(c == navigator, 'bad "this" for requestMediaKeySystemAccess');
              d = TE(a);
              e = [];
              f = t(b);
              for (g = f.next(); !g.done; g = f.next()) h = g.value, k2 = UE(h.videoCapabilities, d), l = UE(h.audioCapabilities, d), h.videoCapabilities && h.videoCapabilities.length && !k2.length || h.audioCapabilities && h.audioCapabilities.length && !l.length || (m = Object.assign({}, h), m.videoCapabilities = k2, m.audioCapabilities = l, e.push(m));
              if (!e.length) throw n = Error("Unsupported keySystem or supportedConfigurations."), n.name = "NotSupportedError", n.code = DOMException.NOT_SUPPORTED_ERR, n;
              return F(w, OE.call(c, a, e), 2);
            }
            p = w.h;
            u = q = null;
            e[0] && (e[0].videoCapabilities && (q = e[0].videoCapabilities[0].encryptionScheme), e[0].audioCapabilities && (u = e[0].audioCapabilities[0].encryptionScheme));
            return w.return(new VE(p, q, u));
          });
        }
        function UE(a, b) {
          return a ? a.filter(function(c) {
            return WE(c.encryptionScheme, b);
          }) : a;
        }
        T("EmeEncryptionSchemePolyfill", NE);
        NE.install = PE;
        function XE() {
        }
        var YE;
        function ZE() {
          YE || navigator.mediaCapabilitiesEncryptionSchemePolyfilled ? console.debug("McEncryptionSchemePolyfill: Already installed.") : navigator.mediaCapabilities ? (YE = navigator.mediaCapabilities.decodingInfo, console.debug("McEncryptionSchemePolyfill: Waiting to detect encryptionScheme support."), navigator.mediaCapabilities.decodingInfo = $E, navigator.mediaCapabilitiesEncryptionSchemePolyfilled = true) : console.debug("McEncryptionSchemePolyfill: MediaCapabilities not found");
        }
        function $E(a) {
          var b = this, c, d;
          return Q(function(e) {
            switch (e.g) {
              case 1:
                return console.assert(b == navigator.mediaCapabilities, 'bad "this" for decodingInfo'), F(e, YE.call(b, a), 2);
              case 2:
                c = e.h;
                if (!c.supported || !a.keySystemConfiguration) return e.return(c);
                if ((d = c.keySystemAccess) && RE(d)) return console.debug("McEncryptionSchemePolyfill: Native encryptionScheme support found."), navigator.mediaCapabilities.decodingInfo = YE, e.return(c);
                console.debug("McEncryptionSchemePolyfill: No native encryptionScheme support found. Patching encryptionScheme support.");
                navigator.mediaCapabilities.decodingInfo = aF;
                if (d) {
                  e.s(3);
                  break;
                }
                return F(e, bF(a), 4);
              case 4:
                return c.keySystemAccess = e.h, e.return(c);
              case 3:
                return e.return(aF.call(b, a));
            }
          });
        }
        function aF(a) {
          var b = this, c, d, e, f, g, h, k2;
          return Q(function(l) {
            switch (l.g) {
              case 1:
                return console.assert(b == navigator.mediaCapabilities, 'bad "this" for decodingInfo'), d = c = null, !a.keySystemConfiguration || (e = a.keySystemConfiguration, f = e.keySystem, d = e.audio && e.audio.encryptionScheme, c = e.video && e.video.encryptionScheme, g = TE(f), h = { powerEfficient: false, smooth: false, supported: false, keySystemAccess: null, configuration: a }, WE(d, g) && WE(c, g)) ? F(l, YE.call(b, a), 2) : l.return(h);
              case 2:
                k2 = l.h;
                if (k2.keySystemAccess) {
                  k2.keySystemAccess = new VE(k2.keySystemAccess, c, d);
                  l.s(3);
                  break;
                }
                if (!a.keySystemConfiguration) {
                  l.s(3);
                  break;
                }
                return F(l, bF(a), 5);
              case 5:
                k2.keySystemAccess = l.h;
              case 3:
                return l.return(k2);
            }
          });
        }
        function bF(a) {
          var b, c;
          return Q(function(d) {
            if (1 == d.g) {
              var e = a.keySystemConfiguration, f = [], g = [];
              e.audio && f.push({ robustness: e.audio.robustness || "", contentType: a.audio.contentType, encryptionScheme: e.audio.encryptionScheme });
              e.video && g.push({ robustness: e.video.robustness || "", contentType: a.video.contentType, encryptionScheme: e.video.encryptionScheme });
              e = { initDataTypes: e.initDataType ? [e.initDataType] : [], distinctiveIdentifier: e.distinctiveIdentifier, persistentState: e.persistentState, sessionTypes: e.sessionTypes };
              f.length && (e.audioCapabilities = f);
              g.length && (e.videoCapabilities = g);
              b = e;
              return F(d, navigator.requestMediaKeySystemAccess(a.keySystemConfiguration.keySystem, [b]), 2);
            }
            c = d.h;
            return d.return(c);
          });
        }
        T("McEncryptionSchemePolyfill", XE);
        XE.install = ZE;
        function VE(a, b, c) {
          this.g = a;
          this.i = b || null;
          this.h = c || null;
          this.keySystem = a.keySystem;
        }
        VE.prototype.getConfiguration = function() {
          var a = this.g.getConfiguration();
          if (a.videoCapabilities) for (var b = t(a.videoCapabilities), c = b.next(); !c.done; c = b.next()) c.value.encryptionScheme = this.i;
          if (a.audioCapabilities) for (b = t(a.audioCapabilities), c = b.next(); !c.done; c = b.next()) c.value.encryptionScheme = this.h;
          return a;
        };
        VE.prototype.createMediaKeys = function() {
          return this.g.createMediaKeys();
        };
        function TE(a) {
          if (a.startsWith("com.widevine") || a.startsWith("com.microsoft") || a.startsWith("com.chromecast") || a.startsWith("com.adobe") || a.startsWith("org.w3")) return "cenc";
          if (a.startsWith("com.apple")) return "cbcs";
          if (a.startsWith("com.huawei")) return "cenc";
          console.warn("EmeEncryptionSchemePolyfill: Unknown key system:", a, "Please contribute!");
          return null;
        }
        function RE(a) {
          a = a.getConfiguration();
          var b = a.audioCapabilities && a.audioCapabilities[0];
          return (a = a.videoCapabilities && a.videoCapabilities[0] || b) && void 0 !== a.encryptionScheme ? true : false;
        }
        function WE(a, b) {
          if (!a || a == b) return true;
          if ("cbcs" == a || "cbcs-1-9" == a) {
            if (cF || dF || nF) return true;
          }
          return false;
        }
        function oF() {
        }
        function BB() {
          PE();
          ZE();
        }
        T("EncryptionSchemePolyfills", oF);
        oF.install = BB;
        var nF = navigator.userAgent.includes("CrKey"), cF = 100 <= parseInt(navigator.userAgent.split("Firefox/").pop(), 10), pF;
        var qF = navigator.userAgent || "";
        if (qF.includes("Web0S")) {
          var rF = qF.match(/Chrome\/(\d+)/);
          pF = rF ? 79 <= parseInt(rF[1], 10) : false;
        } else pF = false;
        var dF = pF;
        "undefined" !== typeof module && module.exports && (module.exports = oF);
      }).call(exportTo, innerGlobal, innerGlobal, void 0);
      for (var k in exportTo.shaka) exports[k] = exportTo.shaka[k];
    })();
  })(shakaPlayer_compiled);
  return shakaPlayer_compiled;
}
var shakaPlayer_compiledExports = requireShakaPlayer_compiled();
const shaka = /* @__PURE__ */ getDefaultExportFromCjs(shakaPlayer_compiledExports);
let player;
let videoElement;
const init = async (element) => {
  shaka.polyfill.installAll();
  videoElement = element;
  if (!videoElement) {
    videoElement = document.createElement("video");
    videoElement.style.cssText = "position: absolute; top: 0; left: 0; z-index: -1";
    videoElement.width = window.innerWidth;
    videoElement.height = window.innerHeight;
    player = new shaka.Player();
    await player.attach(videoElement);
    videoElement.autoplay = true;
    videoElement.preload = true;
    videoElement.muted = true;
    player.addEventListener("error", (err) => {
      console.error(err);
    });
    document.body.insertBefore(videoElement, document.body.firstChild);
  }
};
const load = async (config) => {
  if (!player || !videoElement) {
    throw "Player not initialized yet";
  }
  await player.load(config.streamUrl);
};
const play = () => {
  videoElement.play().then(() => {
  });
};
const Player = () => {
  let parent;
  const navigate = useNavigate();
  ({
    color: hexColor("00000000")
  });
  onMount(() => {
    setGlobalBackground(255);
    parent = document.querySelector('[data-testid="player"]');
    init(parent);
    load({
      streamUrl: "https://bitdash-a.akamaihd.net/content/sintel/hls/playlist.m3u8"
    });
    play();
  });
  return createComponent(View, {
    autofocus: true,
    onBack: () => navigate(-1)
  });
};
function Background() {
  const params2 = new URLSearchParams(window.location.search);
  const disableBG = params2.get("disableBG") === "true";
  let bg1, bg2, heroMask;
  let active = 0;
  const alpha = 1;
  const animationSettings = {
    duration: 550,
    easing: "ease-in-out"
  };
  const bgStyles = {
    alpha,
    color: 4294967295
  };
  onMount(() => {
    if (disableBG) {
      heroMask.src = "";
      heroMask.colorLeft = 255;
      heroMask.colorRight = 0;
      return;
    }
  });
  function changeBackgrounds(img) {
    if (disableBG) {
      heroMask.src = "";
      heroMask.colorLeft = 255;
      heroMask.colorRight = 0;
      return;
    }
    if (typeof img !== "string") {
      bg1.color = img;
      bg1.src = "";
      bg1.alpha = 1;
      active = 1;
      bg2.alpha = 0;
      heroMask.alpha = 0;
      return;
    } else {
      bg1.color = 4294967295;
      heroMask.alpha = 1;
    }
    const currentBg = active === 1 ? bg2 : bg1;
    const nextBg = active === 1 ? bg1 : bg2;
    currentBg.src = img;
    if (active === 0) {
      currentBg.alpha = 1;
    } else {
      currentBg.alpha = 0.01;
      currentBg.animate({
        alpha: 1
      }, animationSettings).start();
    }
    nextBg.animate({
      alpha: 0.01
    }, animationSettings).start();
    active = active === 1 ? 2 : 1;
  }
  createEffect(on(globalBackground, (img) => {
    changeBackgrounds(img);
  }, {
    defer: true
  }));
  return createComponent(View, {
    width: 1920,
    height: 1080,
    zIndex: -5,
    get children() {
      return [createComponent(View, {
        ref(r$) {
          var _ref$ = bg1;
          typeof _ref$ === "function" ? _ref$(r$) : bg1 = r$;
        },
        style: bgStyles
      }), createComponent(View, {
        ref(r$) {
          var _ref$2 = bg2;
          typeof _ref$2 === "function" ? _ref$2(r$) : bg2 = r$;
        },
        style: bgStyles,
        alpha: 0
      }), createComponent(View, {
        ref(r$) {
          var _ref$3 = heroMask;
          typeof _ref$3 === "function" ? _ref$3(r$) : heroMask = r$;
        },
        src: "./assets/hero-mask-inverted.png",
        get color() {
          return hexColor(theme.color.materialBrand);
        },
        width: 1920,
        height: 1080
      })];
    }
  });
}
const styles = {
  Column: {
    flexDirection: "column",
    display: "flex",
    width: 140,
    height: 600,
    y: 360,
    gap: 20,
    zIndex: 101,
    transition: {
      x: {
        duration: 250,
        easing: "ease-in-out"
      }
    },
    x: 8,
    $focus: {
      width: 500,
      x: theme.layout.marginX
    }
  },
  Gradient: {
    zIndex: 99,
    color: 255,
    src: "./assets/sidenav.png",
    alpha: 0,
    width: 200,
    height: 1080,
    $focus: {
      alpha: 1,
      width: 1600
    },
    transition: { alpha: true, width: true }
  },
  NavButton: {
    zIndex: 102,
    height: 70,
    width: 100,
    borderRadius: 8,
    color: 0,
    $focus: {
      color: 1111638783
    },
    $active: {
      width: 328,
      height: 70
    }
  }
};
const basePath = "/solid-demo-app/";
const icons = [{
  name: "experiment",
  width: 81,
  height: 100,
  x: 0,
  y: 0
}, {
  name: "trending",
  width: 100,
  height: 56,
  x: 81,
  y: 0
}, {
  name: "tv",
  width: 100,
  height: 68,
  x: 181,
  y: 0
}, {
  name: "movie",
  width: 94,
  height: 100,
  x: 282,
  y: 0
}];
let sprite;
function Icon(props) {
  sprite = sprite || createSpriteMap(basePath + "assets/icons_white.png", icons);
  return createComponent(View, mergeProps(props, {
    get texture() {
      return sprite[props.name];
    },
    get width() {
      return sprite[props.name].props.width;
    },
    get height() {
      return sprite[props.name].props.height;
    },
    get x() {
      return (100 - (sprite[props.name].props.width || 0)) / 2;
    },
    get y() {
      return (100 - (sprite[props.name].props.height || 0)) / 2;
    }
  }));
}
const NavButtonTextStyles = {
  fontSize: 38,
  x: 116,
  y: 18,
  height: 50,
  alpha: 0,
  $active: {
    alpha: 1
  }
};
function NavButton(props) {
  return createComponent(View, mergeProps(props, {
    forwardStates: true,
    get style() {
      return styles.NavButton;
    },
    get children() {
      return [createComponent(View, {
        y: -16,
        get children() {
          return createComponent(Icon, {
            scale: 0.5,
            get name() {
              return props.icon;
            }
          });
        }
      }), createComponent(Text$1, {
        style: NavButtonTextStyles,
        get children() {
          return props.children;
        }
      })];
    }
  }));
}
function NavDrawer(props) {
  let backdrop;
  const navigate = useNavigate();
  function onFocus() {
    backdrop.states.add("$focus");
    this.children.forEach((c) => c.states.add("$active"));
    this.children[this.selected || 0].setFocus();
  }
  function onBlur() {
    backdrop.states.remove("$focus");
    this.selected = 0;
    this.children.forEach((c) => c.states.remove("$active"));
  }
  function handleNavigate(page) {
    const isOnPage = useMatch(() => page);
    if (isOnPage()) {
      return props.focusPage();
    }
    navigate(page);
  }
  return [createComponent(View, {
    flexItem: false,
    width: 300,
    height: 150,
    x: 30,
    y: 15,
    zIndex: 105,
    get alpha() {
      return props.showWidgets ? 1 : 0.01;
    },
    get children() {
      return [createComponent(Text$1, {
        x: 80,
        fontSize: 28,
        color: 4143380036,
        children: "Built With:"
      }), createComponent(View, {
        y: 22,
        src: "./assets/solidWord.png",
        width: 280,
        height: 52
      }), createComponent(View, {
        x: 0,
        y: 110,
        src: "./assets/tmdb.png",
        width: 80,
        height: 41
      }), createComponent(Text$1, {
        x: 90,
        y: 110,
        contain: "width",
        width: 160,
        fontSize: 12,
        color: 4143380036,
        children: "This product uses the TMDB API but is not endorsed or certified by TMDB."
      })];
    }
  }), createComponent(Column, mergeProps(props, {
    onFocus,
    onBlur,
    get style() {
      return styles.Column;
    },
    announce: "Main Menu",
    scroll: "none",
    get children() {
      return [createComponent(NavButton, {
        onEnter: () => handleNavigate("/browse/all"),
        announce: ["Trending Browse", "button"],
        icon: "trending",
        children: "Trending"
      }), createComponent(NavButton, {
        icon: "movie",
        announce: ["Movies Browse", "button"],
        onEnter: () => handleNavigate("/browse/movie"),
        children: "Movies"
      }), createComponent(NavButton, {
        icon: "tv",
        announce: ["TV Browse", "button"],
        onEnter: () => handleNavigate("/browse/tv"),
        children: "TV"
      }), createComponent(NavButton, {
        icon: "experiment",
        announce: ["Examples", "button"],
        onEnter: () => handleNavigate("/examples"),
        children: "Examples"
      })];
    }
  })), createComponent(View, {
    skipFocus: true,
    ref(r$) {
      var _ref$ = backdrop;
      typeof _ref$ === "function" ? _ref$(r$) : backdrop = r$;
    },
    get style() {
      return styles.Gradient;
    }
  })];
}
const LeftNavWrapper = (props) => {
  const navigate = useNavigate();
  const announcer = useAnnouncer();
  announcer.debug = true;
  announcer.enabled = false;
  let navDrawer, lastFocused;
  setupFPS({
    renderer: renderer$1
  });
  function focusNavDrawer() {
    if (navDrawer.states.has("focus")) {
      return false;
    }
    lastFocused = activeElement();
    return navDrawer.setFocus();
  }
  const [showWidgets, setShowWidgets] = createSignal(true);
  const location2 = useLocation();
  const showOnPaths = ["/browse", "/entity"];
  createEffect(() => {
    const currentPath = location2.pathname;
    let matchesPartial = showOnPaths.some((path) => currentPath.startsWith(path));
    if (currentPath === "/") {
      matchesPartial = true;
    }
    setShowWidgets(matchesPartial);
  });
  const [lastKey, setLastKey] = createSignal();
  const [lastError, setLastError] = createSignal();
  const keyPressHandler = (e) => {
    setLastKey("Last key: ".concat(e.key, ", Code: ").concat(e.keyCode));
  };
  document.addEventListener("keydown", keyPressHandler);
  const displayError = (e) => {
    setLastError((p) => (p || "") + "\n" + e.message);
  };
  document.addEventListener("onerror", displayError);
  onCleanup(() => {
    document.removeEventListener("onerror", displayError);
    document.removeEventListener("keydown", keyPressHandler);
  });
  let pageContainer;
  return createComponent(View, {
    ref(r$) {
      var _ref$ = window.APP;
      typeof _ref$ === "function" ? _ref$(r$) : window.APP = r$;
    },
    onAnnouncer: () => announcer.enabled = !announcer.enabled,
    onLast: () => history.back(),
    onMenu: () => navigate("/"),
    onBack: () => navigate(-1),
    style: {
      width: 1920,
      height: 1080
    },
    onBackspace: focusNavDrawer,
    onLeft: focusNavDrawer,
    onRight: () => navDrawer.states.has("focus") && (lastFocused || pageContainer).setFocus(),
    get children() {
      return [createComponent(Background, {}), createComponent(FPSCounter, {
        mountX: 1,
        x: 1910,
        y: 10,
        get alpha() {
          return showWidgets() ? 1 : 0.01;
        }
      }), createComponent(View, {
        mountX: 1,
        width: 330,
        height: 28,
        x: 1910,
        y: 190,
        color: 255,
        get hidden() {
          return !showWidgets();
        },
        get children() {
          return createComponent(Text$1, {
            fontSize: 20,
            y: 4,
            x: 4,
            get children() {
              return lastKey();
            }
          });
        }
      }), createComponent(Text$1, {
        x: 270,
        y: 20,
        fontSize: 24,
        contain: "width",
        width: 800,
        get children() {
          return lastError();
        }
      }), createComponent(View, {
        ref(r$) {
          var _ref$2 = pageContainer;
          typeof _ref$2 === "function" ? _ref$2(r$) : pageContainer = r$;
        },
        forwardFocus: 0,
        get children() {
          return props.children;
        }
      }), createComponent(NavDrawer, {
        ref(r$) {
          var _ref$3 = navDrawer;
          typeof _ref$3 === "function" ? _ref$3(r$) : navDrawer = r$;
        },
        focusPage: () => lastFocused.setFocus(),
        get showWidgets() {
          return showWidgets();
        }
      })];
    }
  });
};
const Grid = lazy(() => __vitePreload(() => import("./Grid-CItkuVNS.js"), true ? [] : void 0));
const Loops = lazy(() => __vitePreload(() => import("./Loops-CXRvG6cT.js"), true ? __vite__mapDeps([0,1]) : void 0));
const Infinite = lazy(() => __vitePreload(() => import("./Infinite-CZ6Ia1xh.js"), true ? __vite__mapDeps([2,1]) : void 0));
const TMDBGrid = lazy(() => __vitePreload(() => import("./TMDBGrid-MQP-4Mq5.js"), true ? [] : void 0));
const Portal = lazy(() => __vitePreload(() => import("./Portal--bhFOsMd.js"), true ? [] : void 0));
const TextPage = lazy(() => __vitePreload(() => import("./Text-vLMPHHDv.js"), true ? [] : void 0));
const TextPosterPage = lazy(() => __vitePreload(() => import("./TextPoster-CTZ8255W.js"), true ? [] : void 0));
const CreatePage = lazy(() => __vitePreload(() => import("./Create-BGeT2Qyc.js"), true ? [] : void 0));
const ViewportPage = lazy(() => __vitePreload(() => import("./Viewport-ZE9dxlxQ.js"), true ? [] : void 0));
const PositioningPage = lazy(() => __vitePreload(() => import("./Positioning-r7J0nQcR.js"), true ? [] : void 0));
const LayoutPage = lazy(() => __vitePreload(() => import("./Layout-DN9cyUl4.js"), true ? [] : void 0));
const FocusBasicsPage = lazy(() => __vitePreload(() => import("./FocusBasics-B2Aj6AYw.js"), true ? [] : void 0));
const KeyHandlingPage = lazy(() => __vitePreload(() => import("./KeyHandling-C5NBh5Po.js"), true ? [] : void 0));
const TransitionsPage = lazy(() => __vitePreload(() => import("./Transitions-CSY1HoQ6.js"), true ? [] : void 0));
const ComponentsPage = lazy(() => __vitePreload(() => import("./Components-MCvxekoP.js"), true ? [] : void 0));
const FocusHandlingPage = lazy(() => __vitePreload(() => import("./FocusHandling-DVDsV0Eu.js"), true ? [] : void 0));
const GradientsPage = lazy(() => __vitePreload(() => import("./Gradients-D9TZVIXK.js"), true ? [] : void 0));
const FlexPage = lazy(() => __vitePreload(() => import("./Flex-sYMIKk2k.js"), true ? [] : void 0));
const FlexGrowPage = lazy(() => __vitePreload(() => import("./FlexGrow-BgA6cwLh.js"), true ? [] : void 0));
const FlexMenuPage = lazy(() => __vitePreload(() => import("./FlexMenu-ZY7Iyk0A.js"), true ? [] : void 0));
const FlexSizePage = lazy(() => __vitePreload(() => import("./FlexSize-DbUXRSph.js"), true ? [] : void 0));
const FlexColumnSizePage = lazy(() => __vitePreload(() => import("./FlexColumnSize-DuEldQdU.js"), true ? [] : void 0));
const FlexColumnPage = lazy(() => __vitePreload(() => import("./FlexColumn-CsS6A8-R.js"), true ? [] : void 0));
const ButtonsMaterialPage = lazy(() => __vitePreload(() => import("./ButtonsMaterial-DIagnbx0.js"), true ? [] : void 0));
const SuperFlexPage = lazy(() => __vitePreload(() => import("./SuperFlex-Bs-P_eUx.js"), true ? [] : void 0));
const Entity = lazy(() => __vitePreload(() => import("./Entity-EfR0CcwX.js"), true ? [] : void 0));
const People = lazy(() => __vitePreload(() => import("./People-DaFaotee.js"), true ? [] : void 0));
const FireboltPage = lazy(() => __vitePreload(() => import("./Firebolt-CzTe9Dhk.js"), true ? [] : void 0));
let numImageWorkers = 3;
const urlParams = new URLSearchParams(window.location.search);
const numWorkers = urlParams.get("numImageWorkers");
const screenSize = urlParams.get("size") || "default";
const rendererMode = urlParams.get("mode") || "webgl";
const animationsEnabled = urlParams.get("animate") || "true";
if (numWorkers) {
  numImageWorkers = parseInt(numWorkers);
}
const deviceLogicalPixelRatio = {
  "720": 0.666667,
  "medium": 0.8,
  "1080": 1,
  "4k": 2,
  default: window.innerHeight / 1080
}[screenSize];
Config.debug = false;
Config.animationsEnabled = animationsEnabled === "true";
Config.simpleAnimationsEnabled = true;
Config.fontSettings.fontFamily = "Roboto";
Config.fontSettings.color = 4143380223;
Config.fontSettings.fontSize = 32;
Config.rendererOptions = {
  fpsUpdateInterval: 1e3,
  inspector: void 0,
  // textureMemory: {
  //   criticalThreshold: 80e6,
  // },
  numImageWorkers,
  // temp fix for renderer bug
  // Set the resolution based on window height
  // 720p = 0.666667, 1080p = 1, 1440p = 1.5, 2160p = 2
  deviceLogicalPixelRatio,
  devicePhysicalPixelRatio: 1,
  createImageBitmapSupport: "auto"
};
if (rendererMode === "canvas") {
  Config.rendererOptions.fontEngines = [CanvasTextRenderer];
  Config.rendererOptions.renderEngine = CanvasCoreRenderer;
} else {
  Config.rendererOptions.fontEngines = [SdfTextRenderer];
  Config.rendererOptions.renderEngine = WebGlCoreRenderer;
}
const {
  render
} = createRenderer();
loadFonts(fonts);
render(() => createComponent(FocusStackProvider, {
  get children() {
    return createComponent(HashRouter, {
      root: (props) => createComponent(App, props),
      get children() {
        return [createComponent(Route, {
          path: "",
          component: LeftNavWrapper,
          get children() {
            return [createComponent(Route, {
              path: "",
              component: Browse,
              preload: browsePreload
            }), createComponent(Route, {
              path: "examples",
              component: Portal,
              get children() {
                return [createComponent(Route, {
                  path: "/"
                }), createComponent(Route, {
                  path: "tmdb",
                  component: TMDB,
                  preload: tmdbData
                })];
              }
            }), createComponent(Route, {
              path: "browse/:filter",
              component: Browse,
              preload: browsePreload
            }), createComponent(Route, {
              path: "loops",
              component: Loops,
              preload: tmdbData
            }), createComponent(Route, {
              path: "infinite",
              component: Infinite,
              preload: tmdbData
            }), createComponent(Route, {
              path: "tmdbgrid",
              component: TMDBGrid,
              preload: tmdbData
            }), createComponent(Route, {
              path: "destroy",
              component: Destroy,
              preload: destroyData
            }), createComponent(Route, {
              path: "grid",
              component: Grid
            }), createComponent(Route, {
              path: "text",
              component: TextPage
            }), createComponent(Route, {
              path: "firebolt",
              component: FireboltPage
            }), createComponent(Route, {
              path: "textposter",
              component: TextPosterPage
            }), createComponent(Route, {
              path: "positioning",
              component: PositioningPage
            }), createComponent(Route, {
              path: "layout",
              component: LayoutPage
            }), createComponent(Route, {
              path: "focusbasics",
              component: FocusBasicsPage
            }), createComponent(Route, {
              path: "transitions",
              component: TransitionsPage
            }), createComponent(Route, {
              path: "components",
              component: ComponentsPage
            }), createComponent(Route, {
              path: "focushandling",
              component: FocusHandlingPage
            }), createComponent(Route, {
              path: "keyhandling",
              component: KeyHandlingPage
            }), createComponent(Route, {
              path: "gradients",
              component: GradientsPage
            }), createComponent(Route, {
              path: "flex",
              component: FlexPage
            }), createComponent(Route, {
              path: "create",
              component: CreatePage
            }), createComponent(Route, {
              path: "viewport",
              component: ViewportPage
            }), createComponent(Route, {
              path: "flexsize",
              component: FlexSizePage
            }), createComponent(Route, {
              path: "flexmenu",
              component: FlexMenuPage
            }), createComponent(Route, {
              path: "flexcolumnsize",
              component: FlexColumnSizePage
            }), createComponent(Route, {
              path: "flexcolumn",
              component: FlexColumnPage
            }), createComponent(Route, {
              path: "flexgrow",
              component: FlexGrowPage
            }), createComponent(Route, {
              path: "keepalive",
              get component() {
                return lazy(() => __vitePreload(() => import("./KeepAlive-DfkmDv7m.js"), true ? [] : void 0));
              }
            }), createComponent(Route, {
              path: "suspense",
              get component() {
                return lazy(() => __vitePreload(() => import("./suspense-DFMLPjzX.js"), true ? [] : void 0));
              }
            }), createComponent(Route, {
              path: "superflex",
              component: SuperFlexPage
            }), createComponent(Route, {
              path: "buttonsmaterial",
              component: ButtonsMaterialPage
            }), createComponent(Route, {
              path: "entity/people/:id",
              component: People
            }), createComponent(Route, {
              path: "entity/:type/:id",
              component: Entity,
              preload: entityPreload
            }), createComponent(Route, {
              path: "*all",
              component: NotFound
            })];
          }
        }), createComponent(Route, {
          path: "player",
          get children() {
            return createComponent(Route, {
              path: ":id",
              component: Player
            });
          }
        })];
      }
    });
  }
}));
export {
  $TRACK as $,
  children as A,
  Announcer as B,
  Column as C,
  memo as D,
  ElementNode as E,
  For as F,
  assertTruthy as G,
  hexColor as H,
  Index as I,
  combineStyles as J,
  Block as K,
  LazyRow as L,
  Dynamic as M,
  Button as N,
  styles$1 as O,
  Poster as P,
  MaterialButtonText as Q,
  Row as R,
  Show as S,
  Text$1 as T,
  TileRow as U,
  View as V,
  api as W,
  getImageUrl as X,
  convertItemsToTiles as Y,
  useParams as Z,
  insertNode as _,
  __vite_legacy_guard,
  createResource as a,
  setProp as a0,
  getOwner as a1,
  effect as a2,
  Config as a3,
  Suspense as a4,
  createTextNode as a5,
  createComputed as b,
  createSignal as c,
  batch as d,
  createSelector as e,
  createEffect as f,
  onMount as g,
  createComponent as h,
  createMemo as i,
  onCleanup as j,
  createRoot as k,
  createElement as l,
  mergeProps as m,
  chainRefs as n,
  on as o,
  use as p,
  spread as q,
  insert as r,
  setGlobalBackground as s,
  theme as t,
  untrack as u,
  debounce as v,
  activeElement as w,
  ContentBlock as x,
  useNavigate as y,
  useFocusStack as z
};
