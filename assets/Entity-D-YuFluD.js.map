{"version":3,"file":"Entity-D-YuFluD.js","sources":["../../src/api/providers/entity.js","../../src/pages/Entity.tsx"],"sourcesContent":["import api, { getImageUrl } from \"..\";\nimport { convertItemsToTiles } from \"../formatters/ItemFormatter\";\n\nexport function minutesToHMM(minutes) {\n  const hours = Math.floor(minutes / 60);\n  const remainingMinutes = minutes % 60;\n  return (\n    hours + \"h \" + (remainingMinutes < 10 ? \"0\" : \"\") + remainingMinutes + \"min\"\n  );\n}\n\nfunction formatDate(dateString) {\n  const parts = dateString.split(\"-\");\n  return parts[1] + \"/\" + parts[2] + \"/\" + parts[0];\n}\n\nfunction justYear(dateString) {\n  const parts = dateString.split(\"-\");\n  return parts[0];\n}\n\nexport function getRecommendations({ type, id }) {\n  return api.get(`/${type}/${id}/recommendations`).then(({ results }) => {\n    if (results.length) {\n      return convertItemsToTiles(results.slice(0, 7));\n    }\n    return api\n      .get(`/trending/${type}/week?page=1`)\n      .then(({ results }) => convertItemsToTiles(results.slice(0, 7)));\n  });\n}\n\nexport function getCredits({ type, id }) {\n  return api\n    .get(`/${type}/${id}/credits`)\n    .then(({ cast }) => convertItemsToTiles(cast.slice(0, 7)));\n}\n\nexport function getInfo({ type, id }) {\n  let rt =\n    type === \"movie\"\n      ? {\n          rtCrit: 86,\n          rtFan: 92,\n        }\n      : {};\n\n  return api.get(`/${type}/${id}`).then((data) => ({\n    backgroundImage: getImageUrl(data.backdrop_path, \"w1280\"),\n    heroContent: {\n      title: data.title || data.name,\n      description: data.overview,\n      badges: [\"HD\", \"CC\"],\n      voteAverage: data.vote_average,\n      voteCount: data.vote_count,\n      metaText:\n        type === \"movie\"\n          ? minutesToHMM(data.runtime) + \"   \" + formatDate(data.release_date)\n          : `${justYear(data.first_air_date)} - ${justYear(data.last_air_date)}`,\n      reviews: rt,\n    },\n    ...data,\n  }));\n}\n","import {\n  ElementNode,\n  Text,\n  View,\n  Show,\n  hexColor,\n  setActiveElement,\n} from \"@lightningjs/solid\";\nimport { Column, Button, Row } from \"@lightningjs/solid-ui\";\nimport { useParams } from \"@solidjs/router\";\nimport { createEffect, createResource, on, createSignal } from \"solid-js\";\nimport { TileRow } from \"../components\";\nimport { setGlobalBackground } from \"../state\";\nimport ContentBlock from \"../components/ContentBlock\";\nimport { useNavigate } from \"@solidjs/router\";\nimport styles from \"../styles\";\nimport * as provider from \"../api/providers/entity\";\nimport { assertTruthy } from \"@lightningjs/renderer/utils\";\nimport type { Tile } from \"../api/formatters/ItemFormatter\";\nimport { playVideo, closeVideo } from \"../video\";\n\nconst Entity = () => {\n  const params = useParams();\n  const navigate = useNavigate();\n\n  const [data] = createResource(() => ({ ...params }), provider.getInfo);\n  const [credits] = createResource<any, Tile[]>(\n    () => ({ ...params }),\n    provider.getCredits,\n  );\n  const [recommendations] = createResource<any, Tile[]>(\n    () => ({ ...params }),\n    provider.getRecommendations,\n  );\n  const [backdropAlpha, setBackdropAlpha] = createSignal(0);\n\n  createEffect(\n    on(\n      data,\n      (data) => {\n        setGlobalBackground(data.backgroundImage);\n      },\n      { defer: true },\n    ),\n  );\n\n  const columnY = 640;\n\n  const Backdrop = {\n    color: hexColor(\"#000000\"),\n    alpha: 0,\n    width: 1900,\n    height: 890,\n    x: -160,\n    y: columnY,\n    borderRadius: 30,\n  };\n\n  function onRowFocus(this: ElementNode) {\n    this.children.selected?.setFocus();\n    columnRef.y = columnY;\n    backdropRef.y = columnY;\n    backdropRef.alpha = 0;\n  }\n\n  function onRowFocusAnimate(this: ElementNode) {\n    this.children.selected?.setFocus();\n    columnRef.y = 200;\n    backdropRef.y = 160;\n    backdropRef.alpha = 0.9;\n  }\n\n  function onEnter(this: ElementNode) {\n    let entity = this.children.find((c) => c.states!.has(\"focus\"));\n    assertTruthy(entity && entity.href);\n    navigate(entity.href);\n  }\n\n  function onEscape() {\n    closeVideo();\n    // Set focus back to lightning app\n    document.getElementsByTagName(\"canvas\")[0].focus();\n    entityActions.setFocus();\n    setBackdropAlpha(0);\n  }\n\n  function onEnterTrailer() {\n    const video = playVideo();\n    setActiveElement(video);\n    setBackdropAlpha(0.9);\n  }\n\n  let columnRef, backdropRef, entityActions;\n\n  return (\n    <Show when={data()} keyed>\n      <View x={170} onUp={() => entityActions.setFocus()} onEscape={onEscape}>\n        <ContentBlock y={260} content={data().heroContent}></ContentBlock>\n        <Row\n          ref={entityActions}\n          y={500}\n          scroll=\"none\"\n          height={90}\n          width={640}\n          gap={40}\n          onDown={() => columnRef.setFocus()}\n          onEnter={onEnterTrailer}\n        >\n          <Button width={300} autofocus>\n            Play\n          </Button>\n          <Button width={300}>Resume</Button>\n        </Row>\n\n        <Column\n          ref={columnRef}\n          x={0}\n          y={columnY}\n          style={styles.Column}\n          height={880}\n          scroll=\"none\"\n          zIndex={5}\n        >\n          <Show when={recommendations() && credits()}>\n            <Text skipFocus style={styles.RowTitle}>\n              Recommendations\n            </Text>\n            <TileRow\n              onFocus={onRowFocus}\n              onEnter={onEnter}\n              items={recommendations()}\n              width={1620}\n            />\n            <Text skipFocus style={styles.RowTitle}>\n              Cast and Crew\n            </Text>\n            <TileRow\n              onFocus={onRowFocusAnimate}\n              onEnter={onEnter}\n              items={credits()}\n              width={1620}\n            />\n          </Show>\n        </Column>\n        <View\n          ref={backdropRef}\n          style={Backdrop}\n          transition={{ alpha: true, y: true }}\n        />\n      </View>\n      <View\n        alpha={backdropAlpha()}\n        color={hexColor(\"#000000\")}\n        skipFocus\n        zIndex={200}\n        transition={{ alpha: true }}\n      />\n    </Show>\n  );\n};\n\nexport default Entity;\n"],"names":["minutesToHMM","minutes","hours","remainingMinutes","formatDate","dateString","parts","justYear","getRecommendations","type","id","api","results","convertItemsToTiles","getCredits","cast","getInfo","rt","data","getImageUrl","Entity","params","useParams","navigate","useNavigate","createResource","provider","credits","recommendations","backdropAlpha","setBackdropAlpha","createSignal","on","setGlobalBackground","backgroundImage","defer","columnY","Backdrop","color","hexColor","alpha","width","height","x","y","borderRadius","onRowFocus","children","selected","setFocus","columnRef","backdropRef","onRowFocusAnimate","onEnter","entity","find","c","states","has","href","onEscape","closeVideo","document","getElementsByTagName","focus","entityActions","onEnterTrailer","video","playVideo","setActiveElement","_$createComponent","Show","when","keyed","View","onUp","ContentBlock","content","heroContent","Row","ref","r$","_ref$","scroll","gap","onDown","Button","autofocus","Column","_ref$2","style","styles","zIndex","_$memo","Text","skipFocus","RowTitle","TileRow","onFocus","items","_ref$3","transition"],"mappings":"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"}